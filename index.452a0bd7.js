function $parcel$export(e,t,i,r){Object.defineProperty(e,t,{get:i,set:r,enumerable:!0,configurable:!0})}var $71ecd547b7457eca$var$cachedSetTimeout,$71ecd547b7457eca$var$cachedClearTimeout,$71ecd547b7457eca$var$currentQueue,$0a029741d8f7787c$var$now,$parcel$global="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},$parcel$modules={},$parcel$inits={},parcelRequire=$parcel$global.parcelRequire94c2;null==parcelRequire&&((parcelRequire=function(e){if(e in $parcel$modules)return $parcel$modules[e].exports;if(e in $parcel$inits){var t=$parcel$inits[e];delete $parcel$inits[e];var i={id:e,exports:{}};return $parcel$modules[e]=i,t.call(i.exports,i,i.exports),i.exports}var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){$parcel$inits[e]=t},$parcel$global.parcelRequire94c2=parcelRequire),parcelRequire.register("5XTH3",function(module,exports){$parcel$export(module.exports,"DrawWallTool",()=>DrawWallTool);var $4xklQ=parcelRequire("4xklQ"),$9HO6e=parcelRequire("9HO6e"),$ia4Lh=parcelRequire("ia4Lh"),$7WCxl=parcelRequire("7WCxl"),$g4HAh=parcelRequire("g4HAh"),$6Hryq=parcelRequire("6Hryq"),$2C75G=parcelRequire("2C75G");parcelRequire("hrM0U");class DrawWallTool{constructor(e=""){this.btmFaceList=[],this.imagePath="./assets/img/banner/uvGrid.jpg",this.imagePath="../../../../static/assets/images/banner/uvGrid.jpg",this.material=""==e?new $4xklQ.MeshBasicMaterial({color:"#363636",side:$4xklQ.DoubleSide,transparent:!0,opacity:.8}):e,this.reset()}create2DWallAAA(e,t=[]){this.btmFaceList=t;let i=[];for(let t=0;t<e.length;t++){let r,o=e[t],a=new $4xklQ.Vector2(o.start.x,o.start.y),n=new $4xklQ.Vector2(o.end.x,o.end.y);if(o.isArc){let e,t,r=a.clone().add(n).divideScalar(2),s=a.distanceTo(r);this.findCrossFace2(a,n);let l=new $4xklQ.Vector2(a.x,a.y),h=new $4xklQ.Vector2(n.x,n.y),c=l.clone().sub(r).angle(),d=h.clone().sub(r).angle();"down"==o.direction?l.x>=h.x?(e=d,t=c):(e=c,t=d):l.x<=h.x?(e=d,t=c):(e=c,t=d);let p=new $4xklQ.Path;p.arc(r.x,r.y,s,e,t,!1);let u=Math.round(Math.PI/Math.asin(o.thickness/2/(s+o.thickness/2))/2),m=p.getPoints(u),g=[];for(let e=0;e<m.length-1;e++){let t=new $4xklQ.Vector2(parseFloat(Number(m[e].x).toFixed(10)),parseFloat(Number(m[e].y).toFixed(10))),i=new $4xklQ.Vector2(parseFloat(Number(m[e+1].x).toFixed(10)),parseFloat(Number(m[e+1].y).toFixed(10))),r=this.createBottomFace(t,i,o.line,o.thickness);r.startPoint=t,r.endPoint=i,r.direction=o.direction,r.useType="wall",this.recordInfo(r,o),g.push(r),this.btmFaceList.push(r),this.handleIntersect2(r)}i.push(g)}else(r=this.createBottomFace(a.clone(),n.clone(),o.line,o.thickness)).startPoint=a,r.endPoint=n,r.useType="wall",this.recordInfo(r,o),this.handleIntersectNew(r),this.btmFaceList.push(r)}for(let e=0;e<i.length;e++){let t=i[e],r=this.mergeArcFace(t);this.btmFaceList.splice(this.btmFaceList.indexOf(t[0]),t.length),this.btmFaceList.push(r)}return this.btmFaceList}createCircle(e){let t=new $4xklQ.SphereGeometry(50),i=new $4xklQ.Mesh(t,new $4xklQ.MeshBasicMaterial({color:16711680}));return i.position.copy(e),i}create2DWall(e,t=[],i=!1){return window.performance.now(),this.btmFaceList=t,this.btmFaceList=(0,$2C75G.WallCreator).create2DWall(e),this.stroke(),this.btmFaceList}stroke(){let e=[];for(let t=0;t<this.btmFaceList.length;t++){this.btmFaceList[t].origin2DWall=this.btmFaceList[t].clone();let i=new $4xklQ.Group,r=Array.from(this.btmFaceList[t].geometry.attributes.position.array),o=[],a=[];for(let e=0;e<r.length/9;e++)o.push(new $4xklQ.Vector2(r[9*e],r[9*e+1])),a.push(new $4xklQ.Vector2(r[(3*e+2)*3],r[(3*e+2)*3+1]));let n=this.createLine(o,0),s=this.createLine(a,0);i.add(n,s),i.wallID=this.btmFaceList[t].wallID,e.push(i)}this.btmFaceList.push(e)}createLine(e,t=0,i=!1){let r=[];e.forEach(e=>{r.push(e.x,e.y,0)});var o=new(0,$g4HAh.LineGeometry)().setPositions(r),a=new $7WCxl.LineMaterial({color:t,linewidth:1,dashed:i,transparent:!0});a.resolution.set(window.innerWidth,window.innerHeight);var n=new $ia4Lh.Line2(o,a);return n.renderOrder=100,n.computeLineDistances(),n}itemInArr(e,t){let i=new $4xklQ.Vector2(e.start.x,e.start.y),r=new $4xklQ.Vector2(e.end.x,e.end.y);for(let e=0;e<t.length;e++)if(i.equals(t[e])||r.equals(t[e]))return!0}removeSingleLine(e){let t=[];for(let i=0;i<e.length;i++){let r=0,o=0,a=new $4xklQ.Vector2(e[i].start.x,e[i].start.y),n=new $4xklQ.Vector2(e[i].end.x,e[i].end.y);for(let t=0;t<e.length;t++)if(i!==t){let i=new $4xklQ.Vector2(e[t].start.x,e[t].start.y),s=new $4xklQ.Vector2(e[t].end.x,e[t].end.y);(a.equals(i)||a.equals(s))&&r++,(n.equals(i)||n.equals(s))&&o++}(0==r||0==o)&&t.push(e[i])}for(let i=0;i<t.length;i++)this.delete(e,t[i])}detectClosedGraph(e){for(let t=0;t<e.length;t++){e[t].startPoint;let i=e[t].endPoint,r=[e[t]];this.getNextLine(i,r,e)}}getIntersectLine(e,t){let i=[],r=[];for(let o=0;o<t.length;o++){let a=t[o];if(a.startPoint.equals(e)){i.push(a);let t=a.endPoint.clone().sub(e).angle();r.push(t)}if(a.endPoint.equals(e)){i.push(a);let t=a.startPoint.clone().sub(e).angle();r.push(t)}}return[i,r]}getNextLine(e,t,i){let r=t[t.length-1],o=this.getIntersectLine(e,i),a=o[0],n=o[1],s=this.getLineAngle(e,r)[0];this.delete(a,r),this.delete(n,s);for(let e=0;e<n.length;e++)s>n[e]&&(n[e]+=2*Math.PI);for(let i=0;i<a.length;i++){let r=a[i],o=this.getLineAngle(e,r),l=o[0],h=o[1];l<s&&(l+=2*Math.PI);let c=this.checkBetweenAngle(n,s,l,"inner");Math.abd(l-s)>=Math.PI?this.checkBetweenAngle(n,s,l,"outer"):!c&&(t.push(r),t.length>2&&h.equals(t[0].startPoint)&&this.graphArr.push(t))}}getLineAngle(e,t){let i=e.equals(t.startPoint)?t.endPoint:t.startPoint;return[i.clone().sub(e).angle(),i]}getNextLine2(e,t,i,r){let o=t[t.length-1],a,n=t[0].startPoint;i.equals(o.startPoint)?a=o.endPoint.clone().sub(i).angle():i.equals(o.endPoint)&&(a=o.startPoint.clone().sub(i).angle());let s,l=!1,h=[];for(let t=0;t<e.length;t++){let r,o=e[t];i.equals(o.startPoint)?((r=o.endPoint.clone().sub(i).angle())<a&&(r+=2*Math.PI),this.checkBetweenAngle(h,a,r,"inner")||(s=o,l=o.endPoint)):i.equals(o.endPoint)&&((r=o.startPoint.clone().sub(i).angle())<a&&(r+=2*Math.PI),this.checkBetweenAngle(h,a,r,"inner")||(s=o,l=o.startPoint)),h.push(r)}return!!l&&(l.equals(n)?t:(t.push(s),[t,l]))}mergeArcFace(e){let t=[],i=[];for(let r=0;r<e.length;r++){let o=Array.from(e[r].geometry.attributes.position.array);for(let e=0;e<9;e++)t.push(o[e]);if(r==e.length-1)for(let e=9;e<18;e++)t.push(o[e]);i.push(3*r,3*r+3,3*r+4,3*r+1,3*r,3*r+4,3*r+1,3*r+4,3*r+5,3*r+2,3*r+1,3*r+5)}let r=this.createMesh(t,i,e[0].material);return this.recordInfo(r,e[0]),r.wallID=e[0].wallID,r.arcCenter=e[0].arcCenter,r.cp=e[0].cp,r}getFacePoints(e){e.updateWorldMatrix(!0,!1);let t=e.geometry.attributes.position.array,i=[];for(let r=0;r<t.length/3;r++)i.push(e.localToWorld(new $4xklQ.Vector3(t[3*r],t[3*r+1],t[3*r+2])));return i}handleIntersect(e){let t=e.startPoint,i=e.endPoint,r=this.findCrossFaceByPoint(t,i),o=r[0],a=r[1];console.log("cross - start - end",o,a);let n=this.getLineData(this.facePoints[0],this.facePoints[3]),s=this.getLineData(this.facePoints[2],this.facePoints[5]);if(o.length>0){let r=[];if(o.length>1)for(let e=0;e<o.length;e++){let i=o[e].startPoint,a=o[e].endPoint,n;i.equals(t)?n=a.clone().sub(t):a.equals(t)&&(n=i.clone().sub(t)),r.push(n.angle())}if(r.length>1){let a=i.clone().sub(t).angle();for(let i=0;i<o.length;i++){let l,h,c,d,p,u,m,g,f,w,y;let b=o[i],x=b.startPoint,P=b.endPoint,v=this.getAllPoints(b),M=this.getLineData(v[0],v[3]),C=this.getLineData(v[2],v[5]);if(x.equals(t)?(l=P.clone().sub(t).angle(),d=n,p=C,g=0,f=2,u=s,m=M,w=2,y=0):P.equals(t)&&(l=x.clone().sub(t).angle(),h=this.checkBetweenAngle(r,a,l,"inner"),c=this.checkBetweenAngle(r,a,l,"outer"),d=n,p=M,g=0,f=3,u=s,m=C,w=2,y=5),h=this.checkBetweenAngle(r,a,l,"inner"),c=this.checkBetweenAngle(r,a,l,"outer"),a<l){if(h){if(!c){let i=this.computeIntersectPoint(u,m,t);i&&2e3>i.distanceTo(t)&&this.updateVertex(e,w,i),i&&2e3>i.distanceTo(t)&&this.updateVertex(b,y,i)}}else{let i=this.computeIntersectPoint(d,p,t);i&&2e3>i.distanceTo(t)&&this.updateVertex(e,g,i),i&&2e3>i.distanceTo(t)&&this.updateVertex(b,f,i)}}else if(h){if(!c){let i=this.computeIntersectPoint(d,p,t);i&&2e3>i.distanceTo(t)&&this.updateVertex(e,g,i),i&&2e3>i.distanceTo(t)&&this.updateVertex(b,f,i)}}else{let i=this.computeIntersectPoint(u,m,t);i&&2e3>i.distanceTo(t)&&this.updateVertex(e,w,i),i&&2e3>i.distanceTo(t)&&this.updateVertex(b,y,i)}}}else{let r,a,l=o[0],h=l.startPoint,c=l.endPoint,d=this.getAllPoints(l);if(e.isArc&&!l.isArc){let r=i.clone().sub(t).angle(),o;if(h.equals(t)){if(Math.abs(r-(o=c.clone().sub(t).angle()))<Math.PI/2){this.updateVertex(e,0,d[0]),this.updateVertex(e,2,d[2]);return}}else if(c.equals(t)&&Math.abs(r-(o=h.clone().sub(t).angle()))<Math.PI/2){this.updateVertex(e,0,d[5]),this.updateVertex(e,2,d[3]);return}}let p=this.getLineData(d[0],d[3]),u=this.getLineData(d[2],d[5]);h.equals(t)?(r=this.computeIntersectPoint(n,u,t),a=this.computeIntersectPoint(s,p,t),r&&2e3>r.distanceTo(t)&&this.updateVertex(l,2,r),a&&2e3>a.distanceTo(t)&&this.updateVertex(l,0,a)):c.equals(t)&&(r=this.computeIntersectPoint(n,p,t),a=this.computeIntersectPoint(s,u,t),r&&2e3>r.distanceTo(t)&&this.updateVertex(l,3,r),a&&2e3>a.distanceTo(t)&&this.updateVertex(l,5,a)),r&&2e3>r.distanceTo(t)&&this.updateVertex(e,0,r),a&&2e3>a.distanceTo(t)&&this.updateVertex(e,2,a)}}if(a.length>0){let r=[];if(a.length>1)for(let e=0;e<a.length;e++){let t=a[e].startPoint,o=a[e].endPoint,n;t.equals(i)?n=o.clone().sub(i):o.equals(i)&&(n=t.clone().sub(i)),r.push(n.angle())}if(r.length>1){let o=t.clone().sub(i).angle();for(let t=0;t<a.length;t++){let l,h,c,d,p,u,m,g,f,w,y;let b=a[t],x=b.startPoint,P=b.endPoint,v=this.getAllPoints(b),M=this.getLineData(v[0],v[3]),C=this.getLineData(v[2],v[5]);if(x.equals(i)?(l=P.clone().sub(i).angle(),d=s,p=C,g=5,f=2,u=n,m=M,w=3,y=0):P.equals(i)&&(l=x.clone().sub(i).angle(),d=s,p=M,g=5,f=3,u=n,m=C,w=3,y=5),h=this.checkBetweenAngle(r,o,l,"inner"),c=this.checkBetweenAngle(r,o,l,"outer"),o<l){if(h){if(!c){let t=this.computeIntersectPoint(u,m,i);t&&2e3>t.distanceTo(i)&&this.updateVertex(e,w,t),t&&2e3>t.distanceTo(i)&&this.updateVertex(b,y,t)}}else{let t=this.computeIntersectPoint(d,p,i);t&&2e3>t.distanceTo(i)&&this.updateVertex(e,g,t),t&&2e3>t.distanceTo(i)&&this.updateVertex(b,f,t)}}else if(h){if(!c){let t=this.computeIntersectPoint(d,p,i);t&&2e3>t.distanceTo(i)&&this.updateVertex(e,g,t),t&&2e3>t.distanceTo(i)&&this.updateVertex(b,f,t)}}else{let t=this.computeIntersectPoint(u,m,i);t&&2e3>t.distanceTo(i)&&this.updateVertex(e,w,t),t&&2e3>t.distanceTo(i)&&this.updateVertex(b,y,t)}}}else{let r,o,l=a[0],h=l.startPoint,c=l.endPoint,d=this.getAllPoints(l);if(e.isArc&&!l.isArc){console.log("endCross - btm arc");let r=t.clone().sub(i).angle(),o;if(h.equals(i)){if(Math.abs(r-(o=c.clone().sub(i).angle()))<Math.PI/2){this.updateVertex(e,5,d[0]),this.updateVertex(e,3,d[2]);return}}else if(c.equals(i)&&Math.abs(r-(o=h.clone().sub(i).angle()))<Math.PI/2){this.updateVertex(e,5,d[5]),this.updateVertex(e,3,d[3]);return}}let p=this.getLineData(d[0],d[3]),u=this.getLineData(d[2],d[5]);h.equals(i)?(r=this.computeIntersectPoint(n,p,i),o=this.computeIntersectPoint(s,u,i),r&&2e3>r.distanceTo(i)&&this.updateVertex(l,0,r),o&&2e3>o.distanceTo(i)&&this.updateVertex(l,2,o)):c.equals(i)&&(r=this.computeIntersectPoint(n,u,i),o=this.computeIntersectPoint(s,p,i),r&&2e3>r.distanceTo(i)&&this.updateVertex(l,5,r),o&&2e3>o.distanceTo(i)&&this.updateVertex(l,3,o)),r&&2e3>r.distanceTo(i)&&this.updateVertex(e,3,r),o&&2e3>o.distanceTo(i)&&this.updateVertex(e,5,o)}}}handleIntersectNew(e){let t=this.findCrossFace(e);if(t.length>0){let i=e.startPoint,r=e.endPoint,o=this.getLineData(this.facePoints[0],this.facePoints[3]);this.getLineData(this.facePoints[1],this.facePoints[4]);let a=this.getLineData(this.facePoints[2],this.facePoints[5]);for(let n=0;n<t.length;n++){let s,l,h,c,d,p,u,m,g,f,w,y=t[n],b=y.startPoint,x=y.endPoint,P=!1,v=[];for(let e=0;e<t.length;e++)if(y!==t[e]&&this.whetherCross(b,x,t[e])){let o=this.whetherCross2(b,x,t[e]),a=this.whetherCross2(i,r,t[e]);if(o.equals(a)){let i;P=!0,o.equals(t[e].startPoint)?i=t[e].endPoint.clone().sub(o):o.equals(t[e].endPoint)&&(i=t[e].startPoint.clone().sub(o)),v.push(i.angle())}}let M=this.getFacePoints(y),C=this.getLineData(M[0],M[3]);this.getLineData(M[1],M[4]);let D=this.getLineData(M[2],M[5]);i.equals(x)?(f=r.clone().sub(i),w=b.clone().sub(x),s=i,l=o,h=C,c=0,d=3,p=a,u=D,m=2,g=5):i.equals(b)?(f=r.clone().sub(i),w=x.clone().sub(b),s=i,l=o,h=D,c=0,d=2,p=a,u=C,m=2,g=0):r.equals(x)?(f=i.clone().sub(r),w=b.clone().sub(x),s=r,l=a,h=C,c=5,d=3,p=o,u=D,m=3,g=5):r.equals(b)&&(f=i.clone().sub(r),w=x.clone().sub(b),s=r,l=a,h=D,c=5,d=2,p=o,u=C,m=3,g=0);let T=f.angle(),S=w.angle();if(P){let t=this.checkBetweenAngle(v,T,S,"inner"),i=this.checkBetweenAngle(v,T,S,"outer");if(T<S){if(t){if(!i){let t=this.computeIntersectPoint(p,u,s);this.updateVertex(e,m,t),this.updateVertex(y,g,t)}}else{let t=this.computeIntersectPoint(l,h,s);this.updateVertex(e,c,t),this.updateVertex(y,d,t)}}else if(t){if(!i){let t=this.computeIntersectPoint(l,h,s);this.updateVertex(e,c,t),this.updateVertex(y,d,t)}}else{let t=this.computeIntersectPoint(p,u,s);this.updateVertex(e,m,t),this.updateVertex(y,g,t)}}else{let t=this.computeIntersectPoint(l,h,s);this.updateVertex(e,c,t),this.updateVertex(y,d,t);let i=this.computeIntersectPoint(p,u,s);this.updateVertex(e,m,i),this.updateVertex(y,g,i)}}}}checkBetweenAngle(e,t,i,r){let o=Math.min(t,i),a=Math.max(t,i);for(let t=0;t<e.length;t++)if("inner"==r&&e[t]>o&&e[t]<a||"outer"==r&&(e[t]<o||e[t]>a))return!0;return!1}checkAndUpdate(e,t,i,r,o,a,n){let s=this.getFacePoints(n);e?this.checkLegitimacy(t,s[i],s[i+3])&&(this.updateVertex(n,r,t),this.updateVertex(a,o,t)):(this.updateVertex(n,r,t),this.updateVertex(a,o,t))}checkAndUpdate2(e,t,i,r,o,a,n,s=!1){let l=this.getFacePoints(n);if(s){let s=this.checkLegitimacy(e,l[t],l[t+3]),h=this.checkLegitimacy(e,this.facePoints[i],this.facePoints[i+3]);s&&h&&(this.updateVertex(n,r,e),this.updateVertex(a,o,e))}else this.updateVertex(n,r,e),this.updateVertex(a,o,e)}handleIntersect2(e){let t=e.startPoint,i=e.endPoint,r=this.findCrossFace2(t,i);if(r.splice(r.indexOf(e),1),r.length>0)for(let o=0;o<r.length;o++){let a,n,s,l=r[o],h=l.startPoint,c=l.endPoint,d=this.getFacePoints(l),p=!1;for(let e=0;e<r.length;e++)if(l!==r[e]&&this.whetherCross(h,c,r[e])){p=!0;break}if(t.equals(c)){a=h,n=t,s=i;let r=this.computeMiter(a,n,s,l.thickness/2,e.thickness/2),o=n.clone().add(r),c=n.clone().add(r.clone().negate());if(p){let t=this.checkLegitimacy(o,d[0],d[3]),i=this.checkLegitimacy(o,d[2],d[5]),r=this.checkLegitimacy(c,d[0],d[3]),a=this.checkLegitimacy(c,d[2],d[5]);(t||i)&&(this.updateVertex(l,3,o),this.updateVertex(e,0,o)),(r||a)&&(this.updateVertex(l,5,c),this.updateVertex(e,2,c))}else this.updateVertex(l,3,o),this.updateVertex(e,0,o),this.updateVertex(l,5,c),this.updateVertex(e,2,c)}else if(i.equals(h)){a=t,n=i,s=c;let r=this.computeMiter(a,n,s,l.thickness/2,e.thickness/2),o=n.clone().add(r),h=n.clone().add(r.clone().negate());if(p){let t=this.checkLegitimacy(o,d[0],d[3]),i=this.checkLegitimacy(o,d[2],d[5]),r=this.checkLegitimacy(h,d[0],d[3]),a=this.checkLegitimacy(h,d[2],d[5]);(t||i)&&(this.updateVertex(l,0,o),this.updateVertex(e,3,o)),(r||a)&&(this.updateVertex(l,2,h),this.updateVertex(e,5,h))}else this.updateVertex(l,0,o),this.updateVertex(e,3,o),this.updateVertex(l,2,h),this.updateVertex(e,5,h)}else if(t.equals(h)){a=c,n=t,s=i;let r=this.computeMiter(a,n,s,l.thickness/2,e.thickness/2),o=n.clone().add(r),h=n.clone().add(r.clone().negate());if(p){let t=this.checkLegitimacy(o,d[0],d[3]),i=this.checkLegitimacy(o,d[2],d[5]),r=this.checkLegitimacy(h,d[0],d[3]),a=this.checkLegitimacy(h,d[2],d[5]);(t||i)&&(this.updateVertex(l,2,o),this.updateVertex(e,0,o)),(r||a)&&(this.updateVertex(l,0,h),this.updateVertex(e,2,h))}else this.updateVertex(l,2,o),this.updateVertex(e,0,o),this.updateVertex(l,0,h),this.updateVertex(e,2,h)}else if(i.equals(c)){a=t,n=i,s=h;let r=this.computeMiter(a,n,s,l.thickness/2,e.thickness/2),o=n.clone().add(r),c=n.clone().add(r.clone().negate());if(p){let t=this.checkLegitimacy(o,d[0],d[3]),i=this.checkLegitimacy(o,d[2],d[5]),r=this.checkLegitimacy(c,d[0],d[3]),a=this.checkLegitimacy(c,d[2],d[5]);(t||i)&&(this.updateVertex(l,5,o),this.updateVertex(e,3,o)),(r||a)&&(this.updateVertex(l,3,c),this.updateVertex(e,5,c))}else this.updateVertex(l,5,o),this.updateVertex(e,3,o),this.updateVertex(l,3,c),this.updateVertex(e,5,c)}}}findCrossFace(e){let t=[];for(let i=0;i<this.btmFaceList.length;i++)this.whetherCross(e.startPoint,e.endPoint,this.btmFaceList[i])&&t.push(this.btmFaceList[i]);return t}findCrossFace2(e,t){let i=[];for(let r=0;r<this.btmFaceList.length;r++)this.whetherCross(e,t,this.btmFaceList[r])&&i.push(this.btmFaceList[r]);return i}whetherCross(e,t,i){let r=i.startPoint,o=i.endPoint;return e.equals(r)||e.equals(o)||t.equals(r)||t.equals(o)}whetherCross2(e,t,i){let r=i.startPoint,o=i.endPoint;return(0,$9HO6e.UtilCore).isSameVector(e,r)||(0,$9HO6e.UtilCore).isSameVector(e,o)?e:!!((0,$9HO6e.UtilCore).isSameVector(t,r)||(0,$9HO6e.UtilCore).isSameVector(t,o))&&t}checkLegitimacy(e,t,i){let r=Math.min(t.x,i.x),o=Math.min(t.y,i.y),a=Math.max(t.x,i.x),n=Math.max(t.y,i.y),s=e.x>=r,l=e.x<=a,h=e.y>=o,c=e.y<=n;return s&&l&&h&&c}createBottomFace(e,t,i,r){let o=this.getLineData(e,t,r/2);switch(i){case 0:var a=e.clone().add(o[2].clone().negate()),n=e,s=e.clone().add(o[2]),l=t.clone().add(o[2].clone().negate()),h=t,c=t.clone().add(o[2]);break;case 1:var d=o[2].negate(),s=e,n=s.clone().add(d),a=n.clone().add(d),c=t,h=c.clone().add(d),l=h.clone().add(d);break;case 2:var a=e,n=a.clone().add(o[2]),s=n.clone().add(o[2]),l=t,h=l.clone().add(o[2]),c=h.clone().add(o[2])}this.facePoints=[a,n,s,l,h,c];var p=[];this.facePoints.forEach(function(e){p.push(e.x,e.y,0)});var u=[0,3,4,1,0,4,1,4,5,2,1,5];let m=this.material.clone();return m.transparent=!0,m.opacity=roomOpacity,this.createMesh(p,u,m)}createMesh(e,t,i,r=[]){var o=new $4xklQ.BufferGeometry;o.attributes.position=new $4xklQ.BufferAttribute(new Float32Array(e),3),r.length>1&&(o.attributes.normal=new $4xklQ.BufferAttribute(new Float32Array(r),3)),o.index=new $4xklQ.BufferAttribute(new Uint16Array(t),1);var a=new $4xklQ.Mesh(o,i);return a.renderOrder=2,a}getLineData(e,t,i=1){if(e.x==t.x)var r="X",o=e.x;else if(e.y==t.y)var r="Y",o=e.y;else{var r=(e.y-t.y)/(e.x-t.x);r=Math.round(100*r)/100;var o=e.y-r*e.x}o=Math.round(100*o)/100;var a=new $4xklQ.Vector2().subVectors(e,t);return a=new $4xklQ.Vector2(-a.y,a.x).normalize(),1!=i&&a.setLength(i),[r,o,a]}computeIntersectPoint(e,t,i){if("X"==e[0]){if("X"==t[0])return e[1]==t[1]&&new $4xklQ.Vector2(e[1],i.y);if("Y"==t[0])return new $4xklQ.Vector2(e[1],t[1]);var r=t[0]*e[1]+t[1];return new $4xklQ.Vector2(e[1],r)}if("Y"==e[0]){if("X"==t[0])return new $4xklQ.Vector2(t[1],e[1]);if("Y"==t[0])return e[1]==t[1]&&new $4xklQ.Vector2(i.x,e[1]);var o=(e[1]-t[1])/t[0];return new $4xklQ.Vector2(o,e[1])}if("X"==t[0]){var r=Math.round((e[0]*t[1]+e[1])*100)/100;return new $4xklQ.Vector2(t[1],r)}if("Y"==t[0]){var o=Math.round((t[1]-e[1])/e[0]*100)/100;return new $4xklQ.Vector2(o,t[1])}if(e[0]==t[0])return!1;var o=Math.round((t[1]-e[1])/(e[0]-t[0])*100)/100,r=Math.round((e[0]*o+e[1])*100)/100;return new $4xklQ.Vector2(o,r)}updateVertex(e,t,i){let r=e.geometry.attributes.position.array;r[3*t]=i.x,r[3*t+1]=i.y,e.geometry.attributes.position=new $4xklQ.BufferAttribute(new Float32Array(r),3),e.updateMatrix()}checkWhetherLegitimacy(e,t,i,r,o,a){return"X"==e[0]?i.y>t.y?a.y>t.y&&(faceVertices[1]=a.y):a.y<t.y&&(faceVertices[1]=a.y):"Y"==e[0]?i.x>t.x?a.x>t.x&&(faceVertices[0]=a.x):a.x<t.x&&(faceVertices[0]=a.x):i.x>t.x?a.x>t.x&&(r[3*o]=a.x,r[3*o+1]=a.y):a.x<t.x&&(r[3*o]=a.x,r[3*o+1]=a.y),r}recordInfo(e,t){e.line=t.line,e.style=t.style,e.thickness=t.thickness,e.height=t.height,e.wallID=t.id,e.name=t.id,e.offsetXY=t.offsetXY,e.isArc=t.isArc,e.useType="wall"}computeMiter(e,t,i,r,o){let a=new $4xklQ.Vector2().subVectors(t,e).normalize(),n=new $4xklQ.Vector2().subVectors(i,t).normalize(),s=new $4xklQ.Vector2(-n.y,n.x).normalize(),l=o/a.dot(s),h=a.clone().setLength(l),c=new $4xklQ.Vector2(-a.y,a.x).normalize(),d=r/n.clone().negate().dot(c),p=n.clone().negate().setLength(d);return h.add(p)}unique(e){for(var t=[],i=0;i<e.length-1;i++){for(var r=!1,o=0;o<t.length;o++)if(e[i].equals(t[o])){r=!0;break}r||t.push(e[i])}return t}delete(e,t){let i=e.indexOf(t);-1!=t&&e.splice(i,1)}reset(){this._lastPoint=!1,this._currentPoint=!1,this._nextPoint=!1,this._lastWall=!1,this.firstPoint=!1,this.firstWall=!1,this.facePoints=!1,this.arcFace=[],this.N=1e5,this.graph=Array.from(Array(this.N),()=>[]),this.cycles=Array.from(Array(this.N),()=>[])}switchTo3D(e){window.performance.now();let t=[],i={steps:2,depth:2800,bevelEnabled:!0,bevelThickness:0,bevelSize:0,bevelSegments:1};for(let n=0;n<e.length;n++){let s=e[n];i.depth=s.height;let l=Array.from(s.geometry.attributes.position.array),h=[];if(s.isArc){let e=[],t=[];for(let i=0;i<l.length/9;i++)e.push(new $4xklQ.Vector2(l[9*i],l[9*i+1])),t.push(new $4xklQ.Vector2(l[(3*i+2)*3],l[(3*i+2)*3+1]));e.unshift(new $4xklQ.Vector2(l[3],l[4])),e.push(new $4xklQ.Vector2(l[((l.length/9-1)*3+1)*3],l[((l.length/9-1)*3+1)*3+1])),h=e.concat(t.reverse())}else[0,1,2,5,4,3].forEach(e=>{h.push(new $4xklQ.Vector2(l[3*e],l[3*e+1]))});h.push(h[0]);let c=new $4xklQ.Shape;c.moveTo(h[0].x,h[0].y);for(let e=1;e<h.length;e++)c.lineTo(h[e].x,h[e].y);new $4xklQ.ExtrudeGeometry(c,i);let d=new $2C75G.Wall3DGeometry(s),p=new $4xklQ.Mesh(d,new $4xklQ.MeshStandardMaterial({color:16777215}));p.geometry.computeBoundingBox();var r,o,a=p.geometry.boundingBox.min,r=p.geometry.boundingBox.max,o=a.clone().add(r).divideScalar(2);p.geometry.center(),p.position.set(o.x,o.y,o.z),p.arcCenter=s.arcCenter,this.paramInherit(p,s),p.geometry.computeVertexNormals(),p.updateMatrix(),p.modelType="3DWall",p.startPoint=new $4xklQ.Vector2(p.startPoint.x/1e3,p.startPoint.y/1e3),p.endPoint=new $4xklQ.Vector2(p.endPoint.x/1e3,p.endPoint.y/1e3),p.thickness=p.thickness/1e3,t.push(p)}return t.forEach(e=>{let t=new $6Hryq.Brush(e.geometry,e.material);e.geometry=t.geometry,e.material=t.material,e.origin3DWall=e.clone()}),t}computeFaceUVs(e,t,i){e.geometry.computeBoundingBox();let r=e.geometry.boundingBox.min,o=e.geometry.boundingBox.max,a=[],n=Array.from(e.geometry.attributes.position.array);var s=new $4xklQ.TextureLoader().load(this.imagePath);if(s.wrapS=$4xklQ.RepeatWrapping,s.wrapT=$4xklQ.RepeatWrapping,r.z==o.z){let e=new $4xklQ.Vector2(n[3],n[4]),i=new $4xklQ.Vector2(n[n.length-6],n[n.length-5]),s=i.clone().sub(e).angle(),c=e.distanceTo(i),d=o.y-r.y,p=new $4xklQ.MeshStandardMaterial({color:"#9e9b9b",side:$4xklQ.DoubleSide});t.push(p);let u=[r.x,r.y];for(var l=0;l<n.length/3;l++){var h=[n[3*l],n[3*l+1]];a.push(...[(h[0]-u[0])/c,(h[1]-u[1])/d])}let m=new $4xklQ.Matrix3().setUvTransform(0,0,c/1024,d/1024,s,0,0),g=new $4xklQ.BufferAttribute(new Float32Array(a),2);g.applyMatrix3(m),a=Array.from(g.array)}else{let e=o.z-r.z,s,h;if(i){let e=new $4xklQ.Vector2(n[0],n[1]),t=new $4xklQ.Vector2(n[n.length-3],n[n.length-2]);s=Math.PI*(e.distanceTo(t)/2)}else s=((o.x-r.x)**2+(o.y-r.y)**2)**.5;let c=new $4xklQ.MeshStandardMaterial({color:"#9e9b9b",side:$4xklQ.DoubleSide});t.push(c);let d=2;(5==t.length||6==t.length)&&(d=3);for(let t=0;t<n.length/3;t+=d)if(0==t){h=[n[0],n[1],n[2]];for(let i=0;i<d;i++){let r=[n[(t+i)*3],n[(t+i)*3+1],n[(t+i)*3+2]],o=((r[0]-h[0])**2+(r[1]-h[1])**2)**.5;a.push(...[o/s,(r[2]-h[2])/e])}}else{h=[n[(t-d)*3],n[(t-d)*3+1],n[(t-d)*3+2]];for(let i=0;i<d;i++){let r=[n[(t+i)*3],n[(t+i)*3+1],n[(t+i)*3+2]],o=((r[0]-h[0])**2+(r[1]-h[1])**2)**.5;a.push(...[o/s+a[(t-d)*2],(r[2]-h[2])/e+a[(t-d)*2+1]])}}if(-1!=[3].indexOf(t.length))for(var l=0;l<a.length;l+=2)a[l]=-a[l]}return a}createTopFace(e,t){let i=[];for(let r=0,o=0;r<e.length/3;r++)i.push(e[o],e[o+1],t),o+=3;let r=[];for(let e=0,t=0;e<i.length/9-1;e++)r.push(t,t+1,t+3,t+1,t+4,t+3,t+1,t+2,t+4,t+2,t+5,t+4),t+=3;return[i,r]}createInnerOuterFace(e,t){let i=[],r=[];for(let o=0,a=0;o<e.length/3-1;o++)i=(i=(i=(i=i.concat(e[a])).concat(t[a])).concat(e[a+3])).concat(t[a+3]),r=(r=(r=(r=r.concat(e[a+2])).concat(t[a+2])).concat(e[a+5])).concat(t[a+5]),a+=3;let o=[],a=[];for(let e=0,t=0;e<i.length/12;e++)o.push(t,t+1,t+2,t+1,t+3,t+2),a.push(t+1,t,t+3,t,t+2,t+3),t+=4;return[[i,o],[r,a]]}createLeftRightFace(e,t){var i=e.slice(0,3).concat(t.slice(0,3)),r=[];i.forEach(function(e){r.push(e[0],e[1],e[2])});var o=[3,0,1,1,4,3,4,1,2,2,5,4],a=e.length,n=e.slice(a-3,a).concat(t.slice(a-3,a)),s=[];return n.forEach(function(e){s.push(e[0],e[1],e[2])}),[[r,o],[s,[0,3,4,4,1,0,1,4,5,5,2,1]]]}createFullWall(e,t,i){let r=[],o=[];for(let t=0;t<e.length;t++){let i=r.length/3;r=r.concat(e[t][0]),e[t][1].forEach(function(e){o.push(e+i)})}let a=this.createMesh(r,o,t);return this.paramInherit(a,i),a}paramInherit(target,origin){["line","name","style","isArc","height","wallID","offsetXY","thickness","startPoint","endPoint"].forEach(function(item){eval("target."+item+"= origin."+item)})}handleIntersectNew3(e,t){let i=[e,[]],r=this.getFacePoints(e);if(t.length>0){let o=e.startPoint,a=e.endPoint,n=this.getLineData(r[0],r[3]),s=this.getLineData(r[2],r[5]);for(let r=0;r<t.length;r++){let l,h,c,d,p,u,m,g,f,w,y,b=t[r].clone();b.line=t[r].line,b.style=t[r].style,b.thickness=t[r].thickness,b.height=t[r].height,b.offsetXY=t[r].offsetXY,b.isArc=t[r].isArc,b.startPoint=t[r].startPoint,b.endPoint=t[r].endPoint,b.useType=t[r].useType;let x=b.startPoint,P=b.endPoint,v=!1,M=[];for(let e=0;e<t.length;e++)if(b!==t[e]&&this.whetherCross(x,P,t[e])){let i=this.whetherCross2(x,P,t[e]),r=this.whetherCross2(o,a,t[e]);if(i.equals(r)){let r;v=!0,i.equals(t[e].startPoint)?r=t[e].endPoint.clone().sub(i):i.equals(t[e].endPoint)&&(r=t[e].startPoint.clone().sub(i)),M.push(r.angle())}}let C=this.getFacePoints(b),D=this.getLineData(C[0],C[3]);this.getLineData(C[1],C[4]);let T=this.getLineData(C[2],C[5]);(0,$9HO6e.UtilCore).isSameVector(o,P)?(w=a.clone().sub(o),y=x.clone().sub(P),l=o,h=n,c=D,d=0,p=3,u=s,m=T,g=2,f=5):(0,$9HO6e.UtilCore).isSameVector(o,x)?(w=a.clone().sub(o),y=P.clone().sub(x),l=o,h=n,c=T,d=0,p=2,u=s,m=D,g=2,f=0):(0,$9HO6e.UtilCore).isSameVector(a,P)?(w=o.clone().sub(a),y=x.clone().sub(P),l=a,h=s,c=D,d=5,p=3,u=n,m=T,g=3,f=5):(0,$9HO6e.UtilCore).isSameVector(a,x)&&(w=o.clone().sub(a),y=P.clone().sub(x),l=a,h=s,c=T,d=5,p=2,u=n,m=D,g=3,f=0);let S=w.angle(),k=y.angle();if(v){let t=this.checkBetweenAngle(M,S,k,"inner"),i=this.checkBetweenAngle(M,S,k,"outer");if(S<k){if(t){if(!i){let t=this.computeIntersectPoint(u,m,l);this.updateVertex(e,g,t),this.updateVertex(b,f,t)}}else{let t=this.computeIntersectPoint(h,c,l);this.updateVertex(e,d,t),this.updateVertex(b,p,t)}}else if(t){if(!i){let t=this.computeIntersectPoint(h,c,l);this.updateVertex(e,d,t),this.updateVertex(b,p,t)}}else{let t=this.computeIntersectPoint(u,m,l);this.updateVertex(e,g,t),this.updateVertex(b,f,t)}}else{let t=this.computeIntersectPoint(h,c,l);this.updateVertex(e,d,t),this.updateVertex(b,p,t);let i=this.computeIntersectPoint(u,m,l);this.updateVertex(e,g,i),this.updateVertex(b,f,i)}i[1].push(b)}}return i}findCrossFaceByPoint(e,t){let i=[],r=[];for(let o=0;o<this.btmFaceList.length;o++)this.whetherCross3(e,this.btmFaceList[o])&&i.push(this.btmFaceList[o]),this.whetherCross3(t,this.btmFaceList[o])&&r.push(this.btmFaceList[o]);return[i,r]}whetherCross3(e,t){let i=t.startPoint,r=t.endPoint;return e.equals(i)||e.equals(r)}getAllPoints(e){let t=Array.from(e.geometry.attributes.position.array),i=[];for(let e=0;e<t.length/3;e++)i.push(new $4xklQ.Vector2(t[3*e],t[3*e+1]));return i}}}),parcelRequire.register("2C75G",function(e,t){$parcel$export(e.exports,"WallCreator",()=>a),$parcel$export(e.exports,"Wall3DGeometry",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("hrM0U");class o extends i.Mesh{constructor(e,t){super(e,t),this.useType="wall",this.parameter={}}computeVertices(){let e=Array.from(this.geometry.attributes.position.array),t=[];for(let r=0;r<e.length;r+=3)t.push(new i.Vector2(e[r],e[r+1]));this.parameter.points=t}computeLineEquation(){this.isArc,!1==this.isArc&&(this.parameter.innerLineEquation=(0,r.CommonFunc).getLineEquation(this.parameter.points[0],this.parameter.points[3]),this.parameter.middleLineEquation=(0,r.CommonFunc).getLineEquation(this.parameter.points[1],this.parameter.points[4]),this.parameter.outerLineEquation=(0,r.CommonFunc).getLineEquation(this.parameter.points[2],this.parameter.points[5])),this.isArc}updateVertex(e,t){let r=this.geometry.attributes.position.array;r[3*e]=t.x,r[3*e+1]=t.y,this.geometry.attributes.position=new i.BufferAttribute(new Float32Array(r),3);let o=this.geometry.attributes.position.array;this.parameter.points[e]=new i.Vector2(o[3*e],o[3*e+1]),this.updateMatrix()}updateVertex2(e,t){this.parameter.points.forEach(e=>{e.equals()})}getIndex(e){for(let t=0;t<this.parameter.points.length;t++)if(this.parameter.points[t].equals(e))return t}}class a{static wallList2D=[];static wallList3D=[];static create2DWall(e){let t=[];for(let i=0;i<e.length;i++)if(e[i].isArc)t.push(e[i]);else{let t=this.create2D(e[i]);this.recordInfo(t,e[i]),t.computeLineEquation(),this.handleIntersection(t),this.wallList2D.push(t)}let o=[];this.wallList2D.forEach(e=>{o.push(e.startPoint,e.endPoint)});let a=[];for(;t.length>0;){let e=this.getLinkArcJson(o,t);e||(e=t.splice(0,1)[0],o.push(new i.Vector2(e.start.x,e.start.y),new i.Vector2(e.end.x,e.end.y)));let n=new i.Vector2(e.start.x,e.start.y),s=new i.Vector2(e.end.x,e.end.y),l,h,c=!0,d;if(e.cp)d=new i.Vector2(e.cp.x,e.cp.y),h=(l=(0,r.CommonFunc).getCircleCenter(d,n,s)).distanceTo(n),c=(0,r.CommonFunc).getClockWise(n,d,s);else{l=n.clone().add(s).divideScalar(2),h=n.distanceTo(l),c=this.getArcClockwise(n,s);let e=n.clone().sub(l);d=c?new i.Vector2(l.x+e.y,l.y-e.x):new i.Vector2(l.x-e.y,l.y+e.x)}let p=n.clone().sub(l).angle(),u=s.clone().sub(l).angle();e.thickness,e.thickness;let m=Math.round(Math.PI/Math.asin(e.thickness/2/(h+e.thickness/2))/2);m=m>100?100:m;let g=this.getArcPoints({type:e.isArc,center:l,radius:h,beginAngle:p,endAngle:u,clockWise:c,pointNum:m,start:n,end:s,controlP:d}),f=[],w=Object.assign({},e);w.isArc=!1;for(let t=0;t<g.length-1;t++){let o=new i.Vector2((0,r.CommonFunc).keepDecimalRound(g[t].x,2),(0,r.CommonFunc).keepDecimalRound(g[t].y,2)),a=new i.Vector2((0,r.CommonFunc).keepDecimalRound(g[t+1].x,2),(0,r.CommonFunc).keepDecimalRound(g[t+1].y,2));w.start.x=o.x,w.start.y=o.y,w.end.x=a.x,w.end.y=a.y;let n=this.create2D(w);n.isArc=!1,n.arcCenter=l,n.cp=d,n.computeLineEquation(),this.recordInfo(n,e),this.handleIntersection(n),this.wallList2D.push(n),f.push(n)}f.push(n,s),a.push(f)}return this.unionArcWall(a),this.resetWallList2D(this.wallList2D)}static resetWallList2D(){let e=Array.from(this.wallList2D);return this.wallList2D=[],e}static getLinkArcJson(e,t){let r;for(let o=0;o<t.length;o++)if(this.whetherCrossWall(t[o],e)){r=t.splice(o,1)[0],e.push(new i.Vector2(r.start.x,r.start.y),new i.Vector2(r.end.x,r.end.y));break}return r}static getArcClockwise(e,t){let i=this.findCrossWall(e,t);i=[...i[0],...i[1]];let o=0,a=0;for(let n=0;n<i.length;n++){let s=i[n],l=s.startPoint.clone().add(s.endPoint).divideScalar(2);(0,r.CommonFunc).getClockWise(e,l,t)?a++:o++}return!(o<a)}static getArcPoints(e){let t;if("circle"==e.type){let r=new i.Path;r.arc(e.center.x,e.center.y,e.radius,e.beginAngle,e.endAngle,e.clockWise),t=r.getPoints(e.pointNum)}return"bezier"===e.type&&(t=new i.QuadraticBezierCurve3(e.start,e.controlP,e.end).getPoints(e.pointNum)),t}static unionArcWall(e){for(let t=0;t<e.length;t++){let i=e[t].pop(),r=e[t].pop(),o=[],a=[];for(let i=0;i<e[t].length;i++){let r=Array.from(e[t][i].geometry.attributes.position.array);for(let e=0;e<9;e++)o.push(r[e]);if(i==e[t].length-1)for(let e=9;e<18;e++)o.push(r[e]);a.push(3*i,3*i+3,3*i+4,3*i+1,3*i,3*i+4,3*i+1,3*i+4,3*i+5,3*i+2,3*i+1,3*i+5)}let n=this.createMesh(o,a,e[t][0].material);this.recordInfo(n,e[t][0]),n.wallID=e[t][0].wallID,n.arcCenter=e[t][0].arcCenter,n.cp=e[t][0].cp,n.startPoint=r,n.endPoint=i,this.wallList2D.splice(this.wallList2D.indexOf(e[t][0]),e[t].length),this.wallList2D.push(n)}}static create2D(e){let t=new i.Vector2(e.start.x,e.start.y),r=new i.Vector2(e.end.x,e.end.y);var o=new(0,i.Vector2)().subVectors(t,r);switch(o=new(0,i.Vector2)(-o.y,o.x).normalize().setLength(e.thickness/2),e.line){case 0:var a=t.clone().add(o.clone().negate()),n=t.clone(),s=t.clone().add(o.clone()),l=r.clone().add(o.clone().negate()),h=r.clone(),c=r.clone().add(o.clone());break;case 1:var o=o.clone().negate(),s=t.clone(),n=s.clone().add(o.clone()),a=n.clone().add(o.clone()),c=r.clone(),h=c.clone().add(o.clone()),l=h.clone().add(o.clone());break;case 2:var a=t.clone(),n=a.clone().add(o.clone()),s=n.clone().add(o.clone()),l=r.clone(),h=l.clone().add(o.clone()),c=h.clone().add(o.clone())}let d=[];[a,n,s,l,h,c].forEach(e=>{d.push(e.x,e.y,0)});let p=[0,3,4,1,0,4,1,4,5,2,1,5],u=new i.MeshBasicMaterial({color:3552822,side:i.DoubleSide,transparent:!0,opacity:.8}),m=this.createMesh(d,p,u);return m.position.z=1,m.startPoint=t,m.endPoint=r,m}static createMesh(e,t,r){let a=new i.BufferGeometry;a.attributes.position=new i.BufferAttribute(new Float32Array(e),3),a.index=new i.BufferAttribute(new Uint16Array(t),1);let n=new o(a,r);return n.computeVertices(),n.renderOrder=2,n}static recordInfo(e,t){e.line=t.line,e.style=t.style,e.thickness=t.thickness,e.height=t.height,e.wallID=t.id,e.name=t.id,e.offsetXY=t.offsetXY,e.isArc=t.isArc}static handleIntersection(e){let t=e.startPoint.clone(),i=e.endPoint.clone(),[o,a]=this.findCrossWall(t,i);if(o.length>0){let a=[];if(o.length>1&&this.getIntersectAngle(o,t,a),a.length>1){let n=i.clone().sub(t).angle();for(let i=0;i<o.length;i++){let s,l=0,h,c=2,d,p=e.parameter.innerLineEquation,u,m=e.parameter.outerLineEquation,g,f=o[i],[w,y]=[f.startPoint,f.endPoint];w.equals(t)?(s=y.clone().sub(t).angle(),u=f.parameter.outerLineEquation,g=f.parameter.innerLineEquation,h=2,d=0):y.equals(t)&&(s=w.clone().sub(t).angle(),u=f.parameter.innerLineEquation,g=f.parameter.outerLineEquation,h=3,d=5);let[b,x]=this.checkBetweenAngle(a,n,s);if(n<s){if(b){if(!x){let i=(0,r.CommonFunc).getIntersectPoint(m,g,t);this.checkIntersect(i)&&(e.updateVertex(c,i),f.updateVertex(d,i))}}else{let i=(0,r.CommonFunc).getIntersectPoint(p,u,t);this.checkIntersect(i)&&(e.updateVertex(l,i),f.updateVertex(h,i))}}else if(b){if(!x){let i=(0,r.CommonFunc).getIntersectPoint(p,u,t);this.checkIntersect(i)&&(e.updateVertex(l,i),f.updateVertex(h,i))}}else{let i=(0,r.CommonFunc).getIntersectPoint(m,g,t);this.checkIntersect(i)&&(e.updateVertex(c,i),f.updateVertex(d,i))}}}else{let i=o[0],[a,n]=[i.startPoint,i.endPoint],s,l;if(e.isArc){if(i.isArc)e.updateVertex(0,i.parameter.points[3]),e.updateVertex(2,i.parameter.points[5]);else{let o,s;a.equals(t)?(o=(0,r.CommonFunc).getIntersectPoint(e.parameter.innerLineEquation,i.parameter.outerLineEquation),s=(0,r.CommonFunc).getIntersectPoint(e.parameter.outerLineEquation,i.parameter.innerLineEquation),this.checkIntersect(o)&&i.updateVertex(2,o),this.checkIntersect(s)&&i.updateVertex(0,s)):n.equals(t)&&(o=(0,r.CommonFunc).getIntersectPoint(e.parameter.innerLineEquation,i.parameter.innerLineEquation),s=(0,r.CommonFunc).getIntersectPoint(e.parameter.outerLineEquation,i.parameter.outerLineEquation),this.checkIntersect(o)&&i.updateVertex(3,o),this.checkIntersect(s)&&i.updateVertex(5,s)),this.checkAndUpdate(e,3,0,o),this.checkAndUpdate(e,5,2,s)}}else a.equals(t)?(s=(0,r.CommonFunc).getIntersectPoint(e.parameter.innerLineEquation,i.parameter.outerLineEquation),l=(0,r.CommonFunc).getIntersectPoint(e.parameter.outerLineEquation,i.parameter.innerLineEquation),this.checkIntersect(s)&&i.updateVertex(2,s),this.checkIntersect(l)&&i.updateVertex(0,l)):n.equals(t)&&(s=(0,r.CommonFunc).getIntersectPoint(e.parameter.innerLineEquation,i.parameter.innerLineEquation),l=(0,r.CommonFunc).getIntersectPoint(e.parameter.outerLineEquation,i.parameter.outerLineEquation),this.checkIntersect(s)&&i.updateVertex(3,s),this.checkIntersect(l)&&i.updateVertex(5,l)),this.checkIntersect(s)&&e.updateVertex(0,s),this.checkIntersect(l)&&e.updateVertex(2,l)}}if(a.length>0){let o=[];if(a.length>1&&this.getIntersectAngle(a,i,o),o.length>1){let n=t.clone().sub(i).angle();for(let t=0;t<a.length;t++){let s,l=5,h,c=3,d,p=e.parameter.outerLineEquation,u,m=e.parameter.innerLineEquation,g,f=a[t],[w,y]=[f.startPoint,f.endPoint];w.equals(i)?(s=y.clone().sub(i).angle(),u=f.parameter.outerLineEquation,g=f.parameter.innerLineEquation,h=2,d=0):y.equals(i)&&(s=w.clone().sub(i).angle(),u=f.parameter.innerLineEquation,g=f.parameter.outerLineEquation,h=3,d=5);let[b,x]=this.checkBetweenAngle(o,n,s);if(n<s){if(b){if(!x){let t=(0,r.CommonFunc).getIntersectPoint(m,g,i);this.checkIntersect(t)&&(e.updateVertex(c,t),f.updateVertex(d,t))}}else{let t=(0,r.CommonFunc).getIntersectPoint(p,u,i);this.checkIntersect(t)&&(e.updateVertex(l,t),f.updateVertex(h,t))}}else if(b){if(!x){let t=(0,r.CommonFunc).getIntersectPoint(p,u,i);this.checkIntersect(t)&&(e.updateVertex(l,t),f.updateVertex(h,t))}}else{let t=(0,r.CommonFunc).getIntersectPoint(m,g,i);this.checkIntersect(t)&&(e.updateVertex(c,t),f.updateVertex(d,t))}}}else{let t=a[0],[o,n]=[t.startPoint,t.endPoint],s,l;if(e.isArc){if(t.isArc)console.log("arc with arc");else{let a,s;o.equals(i)?(a=(0,r.CommonFunc).getIntersectPoint(e.parameter.innerLineEquation,t.parameter.innerLineEquation),s=(0,r.CommonFunc).getIntersectPoint(e.parameter.outerLineEquation,t.parameter.outerLineEquation),this.checkIntersect(a)&&t.updateVertex(0,a),this.checkIntersect(s)&&t.updateVertex(2,s)):n.equals(i)&&(a=(0,r.CommonFunc).getIntersectPoint(e.parameter.innerLineEquation,t.parameter.outerLineEquation),s=(0,r.CommonFunc).getIntersectPoint(e.parameter.outerLineEquation,t.parameter.innerLineEquation),this.checkIntersect(a)&&t.updateVertex(5,a),this.checkIntersect(s)&&t.updateVertex(3,s)),this.checkAndUpdate(e,0,3,a),this.checkAndUpdate(e,2,5,s);return}}o.equals(i)?(s=(0,r.CommonFunc).getIntersectPoint(e.parameter.innerLineEquation,t.parameter.innerLineEquation),l=(0,r.CommonFunc).getIntersectPoint(e.parameter.outerLineEquation,t.parameter.outerLineEquation),this.checkIntersect(s)&&t.updateVertex(0,s),this.checkIntersect(l)&&t.updateVertex(2,l)):n.equals(i)&&(s=(0,r.CommonFunc).getIntersectPoint(e.parameter.innerLineEquation,t.parameter.outerLineEquation),l=(0,r.CommonFunc).getIntersectPoint(e.parameter.outerLineEquation,t.parameter.innerLineEquation),this.checkIntersect(s)&&t.updateVertex(5,s),this.checkIntersect(l)&&t.updateVertex(3,l)),this.checkIntersect(s)&&e.updateVertex(3,s),this.checkIntersect(l)&&e.updateVertex(5,l)}}}static getIntersectAngle(e,t,i=[]){for(let r=0;r<e.length;r++){let o=e[r].startPoint,a=e[r].endPoint,n=o.equals(t)?a.clone().sub(t):o.clone().sub(t);i.push(n.angle())}return i}static checkBetweenAngle(e,t,i){let r=Math.min(t,i),o=Math.max(t,i),a=!1,n=!1;for(let t=0;t<e.length;t++)e[t]>r&&e[t]<o&&(a=!0),(e[t]<r||e[t]>o)&&(n=!0);return[a,n]}static checkIntersect(e){return!1!=e&&"whole"!=e}static checkAndUpdate(e,t,i,r){if(!1==r||"whole"==r)return;let o=e.parameter.points[t],a=e.parameter.points[i];e.updateVertex(i,r),o.y==a.y?o.x>a.x?r.x>o.x&&e.updateVertex(t,r):r.x<o.x&&e.updateVertex(t,r):o.y>a.y?r.y>o.y&&e.updateVertex(t,r):r.y<o.y&&e.updateVertex(t,r)}static findCrossWall(e,t,i=this.wallList2D){let r=[],o=[];for(let a=0;a<i.length;a++)this.whetherCross(e,i[a])&&r.push(i[a]),this.whetherCross(t,i[a])&&o.push(i[a]);return[r,o]}static whetherCross(e,t){let i=t.startPoint,r=t.endPoint;return e.equals(i)||e.equals(r)}static whetherCrossWall(e,t){let r=new i.Vector2(e.start.x,e.start.y),o=new i.Vector2(e.end.x,e.end.y);for(let e=0;e<t.length;e++)if(r.equals(t[e])||o.equals(t[e]))return!0}}class n extends i.BufferGeometry{constructor(e){let t,r;super(),this.type="Wall3DGeometry";let o=e.geometry.attributes.position,a=this,n=[],s=[],l=[],h=[],c=0,d=0,p=new i.Vector3(0,0,1);if("circle"==e.isArc){t=e.arcCenter?e.arcCenter.distanceTo(e.endPoint):e.startPoint.distanceTo(e.endPoint)/2;let i=e.startPoint.clone().sub(e.arcCenter),o=e.endPoint.clone().sub(e.arcCenter);r=this.getIncludeAngle(i,o)}function u(u){let m,g,f=[],w=o.count;if(0==u&&f.push(w-1,w-2,w-3),1==u&&f.push(0,1,2),2==u||3==u){let e=2==u?2:0;for(let t=0;t<w/3;t++)f.push(e+3*t);3==u&&f.reverse()}let y=0,b=0,x=a.getPoint(o,f[0]),P=a.getPoint(o,f[f.length-1]).clone().sub(x),v=new i.Vector3(P.y,-P.x,0),M=[];f.forEach(t=>{let i=(t=a.getPoint(o,t)).clone();i.z=e.height,M.push(t,i)});let C=new(0,i.Box3)().setFromPoints(M),D=C.max.clone().sub(C.min),T=D.angleTo(p),S=(m=e.isArc&&[2,3].includes(u)?t*r:D.length()*Math.sin(T))>(g=D.length()*Math.cos(T))?m:g,k=a.getPoint(o,f[f.length-1]);k.z=e.height;let V=1,A=1;for(let t=0;t<f.length;t++)for(let i=0;i<2;i++){let r=a.getPoint(o,f[t]).clone();0==i&&(r.z=e.height),s.push(...r.toArray()),l.push(...v.toArray());let n=k.clone().sub(r),c=n.angleTo(p),d=n.length()*Math.sin(c),u=n.length()*Math.cos(c),m=V+d/S,g=A+u/S;h.push(m,-g),k=r,V=m,A=g,y+=1}for(let e=0;e<f.length-1;e++)for(let t=0;t<1;t++){let i=c+t+2*e,r=c+t+2*(e+1),o=c+(t+1)+2*(e+1),a=c+(t+1)+2*e;n.push(a,r,i),n.push(a,o,r),b+=6}a.addGroup(d,b,u),d+=b,c+=y}function m(t,i,r){t=[];for(let e=0;e<o.count/3;e++)t.push([3*e,3*e+1,3*e+2]);if(5==i)for(let e=0;e<t.length;e++)t[e].reverse();let p=0,u=0;for(let i=0;i<t.length;i++)for(let n=0;n<t[i].length;n++){let c=a.getPoint(o,t[i][n]);s.push(c.x,c.y,"top"==r?e.height:0),l.push(0,0,"btm"==r?-1:1),h.push(n/(t[i].length-1),1-i),p+=1}for(let e=0;e<t.length-1;e++)for(let i=0;i<t[e].length-1;i++){let r=c+i+t[e].length*e,o=c+i+t[e].length*(e+1),a=c+(i+1)+t[e].length*(e+1),s=c+(i+1)+t[e].length*e;n.push(s,o,r),n.push(s,a,o),u+=6}a.addGroup(d,u,i),d+=u,c+=p}u(0),u(1),u(2),u(3),m([[0,1,2],[3,4,5]],4,"top"),m([[2,1,0],[5,4,3]],5,"btm"),this.setIndex(n),this.setAttribute("position",new i.Float32BufferAttribute(s,3)),this.setAttribute("normal",new i.Float32BufferAttribute(l,3)),this.setAttribute("uv",new i.Float32BufferAttribute(h,2))}getPoint(e,t){let r=e.getX(t),o=e.getY(t);if(2==e.itemSize)return new i.Vector2(r,o);if(3==e.itemSize){let a=e.getZ(t);return new i.Vector3(r,o,a)}}getIncludeAngle(e,t){let i=Math.atan2(e.y,e.x)-Math.atan2(t.y,t.x);return i<0&&(i=2*Math.PI+i),i}}}),parcelRequire.register("hrM0U",function(e,t){$parcel$export(e.exports,"CommonFunc",()=>d);var i=parcelRequire("4xklQ"),r=parcelRequire("ia4Lh"),o=parcelRequire("g4HAh"),a=parcelRequire("7WCxl"),n=parcelRequire("7BJhL"),s=parcelRequire("6Hryq"),l=parcelRequire("94t2y"),h=parcelRequire("ckwVR"),c=parcelRequire("jDRRp");class d{constructor(){this.getMiddlePoint=d.getMiddlePoint.bind(this),this.getLineEquation=d.getLineEquation.bind(this),this.getVerticalLineEquation=d.getVerticalLineEquation.bind(this),this.getVecByEquation=d.getVecByEquation.bind(this),this.getProjectVecByEquation=d.getProjectVecByEquation.bind(this),this.getIntersectPoint=d.getIntersectPoint.bind(this),this.getProjectPoint=d.getProjectPoint.bind(this),this.createThreeDimensionLabel=d.createThreeDimensionLabel.bind(this),this.getRandomNum=d.getRandomNum.bind(this),this.arrayTransformToVector=d.arrayTransformToVector.bind(this),this.vectorTransformToArray=d.vectorTransformToArray.bind(this),this.vectorTransformToObject=d.vectorTransformToObject.bind(this),this.filterArray=d.filterArray.bind(this),this.filterObjArray=d.filterObjArray.bind(this),this.removeItemFromArr=d.removeItemFromArr.bind(this),this.keepDecimalRound=d.keepDecimalRound.bind(this),this.isParallel2=d.isParallel2.bind(this),this.isSameDirection2=d.isSameDirection2.bind(this),this.includeUndefined=d.includeUndefined.bind(this),this.transToVector2=d.transToVector2.bind(this),this.transToVector3=d.transToVector3.bind(this),this.findNewItem=d.findNewItem.bind(this),this.isCollinear=d.isCollinear.bind(this),this.getClockWise=d.getClockWise.bind(this),this.getCircleCenter=d.getCircleCenter.bind(this),this.createPoint=d.createPoint.bind(this),this.createLine=d.createLine.bind(this),this.createShapeByPoints=d.createShapeByPoints.bind(this),this.createShape=d.createShape.bind(this)}static boolean(e,t,r="subtract"){"subtract"==r&&(r=n.SUBTRACTION),"union"==r&&(r=n.ADDITION),"intersect"==r&&(r=n.INTERSECTION),e.updateMatrixWorld(!0);let o=new s.Brush(e.geometry,e.material),a=new s.Brush(t.geometry,t.material);o.applyMatrix4(e.matrix),a.applyMatrix4(t.matrix),o.updateMatrixWorld(),a.updateMatrixWorld(),o.geometry.computeBoundsTree({maxLeafTris:5,strategy:parseFloat(h.CENTER)}),o.geometry.boundsTree.splitStrategy=h.CENTER,a.geometry.computeBoundsTree({maxLeafTris:5,strategy:parseFloat(h.CENTER)}),a.geometry.boundsTree.splitStrategy=h.CENTER;let c=new l.Evaluator;if(c.attributes=["position","normal"],c.debug.enabled=!0,c.useGroups=!0,r==n.ADDITION||r==n.INTERSECTION)return c.evaluate(o,a,r);if(r==n.SUBTRACTION){let t=new i.Mesh(new i.BufferGeometry,new i.MeshStandardMaterial({color:16711680,flatShading:!1,polygonOffset:!0,polygonOffsetUnits:.1,polygonOffsetFactor:.1}));return t.castShadow=!0,t.receiveShadow=!0,c.evaluate(o,a,r,t),t.geometry.computeBoundingBox(),t.geometry.center(),t.applyMatrix4(e.matrix),t}}static getMiddlePoint(e,t){if((!e.isVector2||t.isVector2)&&(!e.isVector3||t.isVector3)&&(!e.isVector4||t.isVector4))return e.clone().add(t).divideScalar(2)}static getLineEquation(e,t){let i,r;return Array.isArray(e)&&(e=this.arrayTransformToVector(e)),Array.isArray(t)&&(t=this.arrayTransformToVector(t)),e.x==t.x?(i="X",r=e.x):e.y==t.y?(i="Y",r=e.y):(i=(e.y-t.y)/(e.x-t.x),r=e.y-i*e.x),{slope:i,constant:r}}static getCircleEquation(e,t){return{a:e.x,b:e.y,r:t}}static getNormalVecOffset(e,t,r){var o=new(0,i.Vector2)().subVectors(t,e);o=new(0,i.Vector2)(-o.y,o.x).normalize().setLength(r);let a=e.clone().add(o),n=t.clone().add(o);return[a.x,a.y,n.x,n.y]}static getVerticalLineEquation(e,t=new i.Vector2){let r,o;return"X"==e.slope?(r="Y",o=t.y):"Y"==e.slope?(r="X",o=t.x):(r=-1/e.slope,o=t.y-r*t.x),{slope:r,constant:o}}static getVecByEquation(e,t=1){return"X"==e.slope?new i.Vector2(0,t):"Y"==e.slope?new i.Vector2(t,0):new(0,i.Vector2)(1,e.slope+e.constant).setLength(t)}static getProjectVecByEquation(e,t=1){let r=this.getVecByEquation(e);return new(0,i.Vector2)(-r.y,r.x).setLength(t)}static getIntersectPoint(e,t,r=!1){let o;if(e.slope==t.slope){if(e.constant!=t.constant){if(!(1>Math.abs(e.constant-t.constant)))return!1;{let t=this.getVerticalLineEquation(e,r);return this.getIntersectPoint(t,e)}}if(!r)return"whole";{let t=this.getVerticalLineEquation(e,r);return this.getIntersectPoint(t,e)}}if("X"==e.slope)o="Y"==t.slope?new i.Vector2(e.constant,t.constant):new i.Vector2(e.constant,t.slope*e.constant+t.constant);else if("Y"==e.slope)o="X"==t.slope?new i.Vector2(t.constant,e.constant):new i.Vector2((e.constant-t.constant)/t.slope,e.constant);else if("X"==t.slope)o=new i.Vector2(t.constant,e.slope*t.constant+e.constant);else if("Y"==t.slope)o=new i.Vector2((t.constant-e.constant)/e.slope,t.constant);else{let r=(t.constant-e.constant)/(e.slope-t.slope),a=e.slope*r+e.constant;t.slope,t.constant,o=new i.Vector2(r,a)}return o}static getIntersectPoint2(e,t){let r=Object.assign({},e);r.slope="Y"==e.slope?0:"X"==e.slope?1/0:e.slope;let o=-2*(r.slope*r.constant-r.slope*t.b-t.a),a=(2*(r.slope*r.constant-r.slope*t.b-t.a))**2-4*(1+r.slope**2)*(t.a**2+(r.constant-t.b)**2-t.r**2),n=2*(1+r.slope**2),s=(o+a**.5)/n,l=(o-a**.5)/n;return[new i.Vector2(s,r.slope*s+r.constant),new i.Vector2(l,r.slope*l+r.constant)]}static getProjectPoint(e,t){let r;if(e.r){let o=new i.Vector2(e.a,e.b),a=new i.Vector2(t.x,t.y),n=d.getLineEquation(o,a);o.distanceTo(a),e.r;let s=this.getIntersectPoint2(n,e);console.log("res",s),r=a.distanceTo(s[0])<a.distanceTo(s[1])?s[0]:s[1]}else{let i=this.getVerticalLineEquation(e,t);r=this.getIntersectPoint(e,i)}return r}static createThreeDimensionLabel(e,t,r=0){e=new i.Vector3(e.x,e.y,e.z),t=new i.Vector3(t.x,t.y,t.z);let o=.1,a=this.getLineEquation(e,t),n=this.getVerticalLineEquation(a,t),s="X"==n.slope?0:"Y"==n.slope?1/0:n.slope,l=new i.Vector3(Math.sin(Math.atan(s))*o/2,Math.cos(Math.atan(s))*o/2),h=t.clone().add(l),c=t.clone().add(l.negate()),d=new i.LineSegments(new(0,i.BufferGeometry)().setFromPoints([e,t,h,c]),new i.MeshBasicMaterial({color:r,side:i.DoubleSide,depthTest:!1}));return d.name="label",d.labelLength=e.distanceTo(t),d.center=e.clone().add(t).divideScalar(2),d}static getRandomNum(e,t){return Math.floor(Math.random()*(t-e+1))+e}static arrayTransformToVector(e){return 2==e.length?new i.Vector2(e[0],e[1]):3==e.length?new i.Vector3(e[0],e[1],e[2]):4==e.length?new i.Vector4(e[0],e[1],e[2],e[3]):void console.log("Check Array length again.")}static vectorTransformToArray(e,t=3){if(e.isVector2){if(2==t)return[e.x,e.y];if(3==t)return[e.x,e.y,0];if(4==t)return[e.x,e.y,0,0]}if(e.isVector3){if(2==t)return[e.x,e.y];if(3==t)return[e.x,e.y,e.z];if(4==t)return[e.x,e.y,e.z,0]}if(e.isVector4){if(2==t)return[e.x,e.y];if(3==t)return[e.x,e.y,e.z];if(4==t)return[e.x,e.y,e.z,e.w]}if(Array.isArray(e)){let i=[];return e.forEach(e=>{i.push(...this.vectorTransformToArray(e,t))}),i}}static vectorTransformToObject(e,t=!1,i=!0){let r={};return e.isVector2&&(i&&(r.x=e.x,r.y=e.y),t&&(r.X=e.x,r.Y=e.y)),e.isVector3&&(i&&(r.x=e.x,r.y=e.y,r.z=e.z),t&&(r.X=e.x,r.Y=e.y,r.Z=e.z)),e.isVector4&&(i&&(r.x=e.x,r.y=e.y,r.z=e.z,r.w=e.w),t&&(r.X=e.x,r.Y=e.y,r.Z=e.z,r.W=e.w)),r}static filterArray(e){let t=[];return e.forEach(e=>{let i=!0;t.forEach(r=>{r?e[0]===r[0]&&e[1]===r[1]&&(i=!1):t.push(e)}),i&&t.push(e)}),t}static filterArray2(e){let t=[];return e.forEach(e=>{let i=!0;t.forEach(r=>{r?(e[0]===r[0]&&e[1]===r[1]&&(i=!1),e[0]===r[1]&&e[1]===r[0]&&(i=!1)):t.push(e)}),i&&t.push(e)}),t}static isInclude(e,t){for(let i=0;i<e.length;i++)if(e[i].equals(t))return!0;return!1}static filterArray3(e){let t=[];return e.forEach(e=>{let i=!0;t.forEach(r=>{r?e.equals(r)&&(i=!1):t.push(e)}),i&&t.push(e)}),t}static getIndex(e,t){for(let i=0;i<e.length;i++)if(t[0]==e[i][0]&&t[1]==e[i][1])return i;return!1}static filterObjArray(e){let t=[],i={};for(let r of e)i[r]||(t.push(r),i[r]=1);return t}static isEqualArray(e,t){if(e.length!=t.length)return!1;let i=Array.from(e),r=0;for(var o of t)if(Array.isArray(o)){for(let e of t)if(e.length==o.length){let t=!0;for(let i=0;i<e.length;i++)-1==o.indexOf(e[i])&&(t=!1);t&&r++}}else i.includes(o)&&r++;return r==i.length}static whetherSameItemExist(e,t){for(let i=0;i<e.length;i++){let r=e[i];for(let e=0;e<t.length;e++){let o=t[e];if(r.x==o.x&&r.y==o.y)return[i,e]}}return!1}static compareArray(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!=t[i])return!1;return!0}static removeItemFromArr(e,t){e.splice(e.indexOf(t),1)}static keepDecimalRound(e,t){return Math.round(e*10**t)/10**t}static isParallel2(e,t){return e.angle()%Math.PI==t.angle()%Math.PI}static isSameDirection2(e,t){return e.angle()%(2*Math.PI)==t.angle()%(2*Math.PI)}static isParallel3(){}static includeUndefined(e){for(let t=0;t<e.length;t++)if(Array.isArray(e[t])){let i=this.includeUndefined(e[t]);if(i)return i}else if(void 0==e[t])return!0;return!1}static transToVector2(e){return new i.Vector2(e.x,e.y)}static transToVector3(e){return e.isVector2?new i.Vector3(e.x,e.y,0):e.isVector3?e:new i.Vector3(e.x,e.y,e.y)}static findNewItem(e,t){for(let i=0;i<e.length;i++)if(-1==t.indexOf(e[i]))return e[i]}static isCollinear(e,t,i){e=this.transToVector2(e.clone()),t=this.transToVector2(t.clone()),i=this.transToVector2(i.clone());let r=this.getLineEquation(e,t),o=this.getLineEquation(t,i);return r.slope==o.slope&&r.constant==o.constant}static getClockWise(e,t,i){e=this.transToVector2(e.clone()),t=this.transToVector2(t.clone()),i=this.transToVector2(i.clone());let r=(t.x-e.x)*(i.y-t.y)-(t.y-e.y)*(i.x-t.x);return 0==r?0:r<0}static getCircleCenter(e,t,i){if(this.isCollinear(e,t,i))return;let r=this.getVerticalLineEquation(this.getLineEquation(e,t),this.getMiddlePoint(e,t)),o=this.getVerticalLineEquation(this.getLineEquation(t,i),this.getMiddlePoint(t,i));return this.getIntersectPoint(r,o)}static createFloor3D(e,t){let r=new i.Shape;r.moveTo(e[0].x,e[0].y);for(let t=1;t<e.length;t++)r.lineTo(e[t].x,e[t].y);if(r.lineTo(e[0].x,e[0].y),0==window.floorDep){let o=new i.ShapeGeometry(r),a=new i.MeshStandardMaterial({map:t});this.recomputeUV(o);let n=new c.Floor3D(o,a);return n.allPoints=e,n}let o={steps:2,depth:window.floorDep,bevelEnabled:!1},a=new i.ExtrudeGeometry(r,o),n=new i.MeshStandardMaterial({map:t});this.recomputeUV(a);let s=new c.Floor3D(a,n);return s.geometry.translate(0,0,-window.floorDep),s.allPoints=e,s}static recomputeUV(e){let t=e.attributes.position.array,r=e.attributes.normal.array,o=e.attributes.uv,a={};for(let e=0;e<r.length;e+=3){let o=`${r[e]}_${r[e+1]}_${r[e+2]}`,n=new i.Vector3(t[e],t[e+1],t[e+2]);a[o]?a[o].push({index:e/3,vertex:n}):a[o]=[{index:e/3,vertex:n}]}let n=new i.Vector3(1,0,0),s=new i.Vector3(0,0,1);for(let e in a){let t,r,l=e.split("_").map(e=>parseFloat(e)),h=new(0,i.Vector3)().fromArray(l),c=[];for(let t=0;t<a[e].length;t++)c.push(a[e][t].vertex);let d=new(0,i.Box3)().setFromPoints(c),p=Math.PI/2-d.max.clone().sub(d.min).angleTo(s),u=this.getOriginP(c,h);for(let i=0;i<a[e].length;i++){let l=a[e][i],h=l.vertex.clone().sub(u),c=0==p?h.angleTo(n):Math.PI/2-h.angleTo(s);t=h.length()*Math.cos(c),r=h.length()*Math.sin(c),o.setXY(l.index,t/960,r/960)}}}static getOriginP(e,t){let r=new i.Vector3,o=new(0,i.Box3)().setFromPoints(e),a=new i.Vector3(1,0,0),n=new i.Vector3(0,1,0),s=new i.Vector3(0,0,1);if(t.equals(s))r=o.min;else if(t.equals(s.negate()))r=o.max;else if(t.equals(a))r=o.min;else if(t.equals(a.negate()))r=new i.Vector3(o.max.x,o.max.y,o.min.z);else if(t.equals(n))r=new i.Vector3(o.max.x,o.max.y,o.min.z);else if(t.equals(n.negate()))r=o.min;else{let e=t.angleTo(a),s=t.angleTo(n);console.log("normal - angleX - angleY - ",t,e,s),e<Math.PI/2&&s<Math.PI/2&&(r=new i.Vector3(o.min.x,o.max.y,o.min.z)),e<Math.PI/2&&s>Math.PI/2&&(r=o.max),e>Math.PI/2&&s<Math.PI/2&&(r=o.min),e>Math.PI/2&&s>Math.PI/2&&(r=new i.Vector3(o.max.x,o.min.y,o.min.y))}return r}static between(e,t,i){let r,o;return t>i?(r=t,o=i):(r=i,o=t),e<=r&&e>=o}static createPoint(e={},t,r){let o=e.radius||10,a=new i.SphereGeometry(o),n=new i.Mesh(a,r);return n.position.set(t.x,t.y,t.z),n}static createLine(e,t={}){t.color=t.color||0,t.linewidth=t.linewidth||1.5,t.dashed=t.dashed||!1;let i=[];e.forEach(e=>{i.push(...d.transToVector3(e).toArray())});let n=new(0,o.LineGeometry)().setPositions(i),s=new a.LineMaterial(t);s.resolution.set(window.innerWidth,window.innerHeight);let l=new r.Line2(n,s);return l.computeLineDistances(),l}static createShapeByPoints(e,t=!1){let r=new i.Shape;if(r.moveTo(e[e.length-1].x,e[e.length-1].y),e.forEach(e=>{r.lineTo(e.x,e.y)}),!t)return r;let o=new i.ShapeGeometry(r);return new i.Mesh(o,t)}static createShape(e,t,r){let o=new i.BufferGeometry;return o.attributes.position=new i.BufferAttribute(new Float32Array(e),3),o.index=new i.BufferAttribute(new Uint16Array(t),1),new i.Mesh(o,r)}static createCone(e={},t=0){e.radius||=1,e.height||=1,e.radialSegments||=8,e.heightSegments||=1,e.openEnded||=!1,e.thetaStart||=0,e.thetaLength||=2*Math.PI;let r=new i.ConeGeometry(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength),o=new i.MeshBasicMaterial({color:t});return new i.Mesh(r,o)}static getJsonLength(e){let t=0;for(let i in e)t++;return t}static contrastVec(e,t){return this.getJsonLength(e)==this.getJsonLength(t)&&2==this.getJsonLength(e)?e.x==t.x&&e.y==t.y:this.getJsonLength(e)==this.getJsonLength(t)&&3==this.getJsonLength(e)?e.x==t.x&&e.y==t.y&&e.z==t.z:void 0}}}),parcelRequire.register("jDRRp",function(e,t){$parcel$export(e.exports,"Floor3D",()=>o);var i=parcelRequire("4xklQ"),r=parcelRequire("hrM0U");class o extends i.Mesh{constructor(e,t){super(e,t),this.type="Floor3D"}refresh(){let e=Object.assign({},this.geometry.parameters.options);this.geometry.parameters.shapes,e.depth=window.floorDep,this.geometry.dispose();let t=(0,r.CommonFunc).createFloor3D(this.allPoints,this.material.map);this.geometry=t.geometry.clone(),t.geometry.dispose()}computeUVs(){}changeMaterial(){}}}),parcelRequire.register("5sV3G",function(module,exports){$parcel$export(module.exports,"DigHole",()=>DigHole);var $4xklQ=parcelRequire("4xklQ");parcelRequire("jPMpS");var $cTA6h=parcelRequire("cTA6h"),$hu0fb=parcelRequire("hu0fb"),$9QhXH=parcelRequire("9QhXH"),$4xgHd=parcelRequire("4xgHd"),$7BJhL=parcelRequire("7BJhL"),$6Hryq=parcelRequire("6Hryq"),$94t2y=parcelRequire("94t2y"),$ckwVR=parcelRequire("ckwVR"),$4J2OP=parcelRequire("4J2OP");$4xklQ.BufferGeometry.prototype.computeBoundsTree=$4J2OP.computeBoundsTree,$4xklQ.BufferGeometry.prototype.disposeBoundsTree=$4J2OP.disposeBoundsTree;class DigHole{constructor(e){this.scene=e.wallGroup3D,this.editor=e;let t=this.editor.config.uvGridTexture;t.wrapS=$4xklQ.RepeatWrapping,t.wrapT=$4xklQ.RepeatWrapping,this.material=new $4xklQ.MeshBasicMaterial({map:t}),this.resultObject=new $4xklQ.Mesh(new $4xklQ.BufferGeometry,new $4xklQ.MeshStandardMaterial({color:16711680,flatShading:!1,polygonOffset:!0,polygonOffsetUnits:.1,polygonOffsetFactor:.1})),this.resultObject.castShadow=!0,this.resultObject.receiveShadow=!0,this.tmpM=new $4xklQ.Mesh(new $4xklQ.BoxGeometry(1,1,1),new $4xklQ.MeshBasicMaterial({color:16711680})),this.tmpM.position.set(-1,-1,-1)}resetResultObj(){this.resultObject.geometry=new $4xklQ.BufferGeometry}workOld(e,t){let i=[];for(let r=0;r<t.length;r++){let o,a,n,s=t[r];if(e.forEach(function(e,t){e.wallID==s.wallID&&(o=e,a=t)}),o){let e=o.startPoint,t=o.endPoint;if(s.isArc){let i,r,a=e.clone().add(t).divideScalar(2),l=a.distanceTo(o.startPoint);switch(o.line){case 0:i=l-o.thickness/2-1,r=l+o.thickness/2+1;break;case 1:i=l-1,r=l+o.thickness+1;break;case 2:i=l-o.thickness-1,r=l+1}let h=this.createArcMesh(a,i,r,s.startRadian,s.endRadian,s.height,s.positionZ);n=this.boolean(o,h),s.path&&this.createArcWindow(i,r,o,s)}else{let i=e.clone().add(t).divideScalar(2);i=new $4xklQ.Vector3(i.x,i.y,o.height/2);let r=t.clone().sub(e).angle(),a=new $4xklQ.Vector3(s.location.x,s.location.y,s.location.z),l=this.createBooleanMesh(s.width,s.height,s.windowThick+2,s.withSector,r);l.position.set(a.x,a.y,a.z),n=this.boolean(o,l),s.path&&n&&this.placeWindow(this.scene,s,o,a,r)}n&&(this.paramInherit(n,o),this.recomputeUVs(n),i.push(n))}}return this.scene}work(e,t){let i=[],r=[];for(let i=0;i<t.length;i++){let o=t[i];for(let t=0;t<e.length;t++)if(e[t].wallID==o.wallID){r[t]?r[t].push(o):r[t]=[o];break}}for(let t=0;t<e.length;t++){let o=[],a=e[t];if(r[t]){let e=a.startPoint,n=a.endPoint;if(a.isArc)for(let e=0;e<r[t].length;e++){let i,n,s=r[t][e],l=a.arcCenter,h=Math.round(100*l.distanceTo(new $4xklQ.Vector2(1e3*a.startPoint.x,1e3*a.startPoint.y)))/100;switch(a.line){case 0:i=h-1e3*a.thickness/2-1,n=h+1e3*a.thickness/2+1;break;case 1:i=h-1,n=h+1e3*a.thickness+1;break;case 2:i=h-1e3*a.thickness-1,n=h+1}let c=this.createArcMesh(l,i-1,n+1,s.startRadian,s.endRadian,s.height,s.positionZ);c.updateMatrix(),o.push(c),this.place3DWindow(this.scene,s,a)}else for(let i=0;i<r[t].length;i++){let s,l=r[t][i],h=n.clone().sub(e).angle();(l.masterAngle||0==l.masterAngle)&&(h=l.masterAngle);let c=new $4xklQ.Vector3(l.location.x,l.location.y,l.location.z);"UWindow"==l.dir&&(l.path="uWindow"),"dooropen"==l.dir&&(l.path="dooropen"),l.path&&(l.path.includes("LWindow")&&(l.width+=2*l.diff),this.place3DWindow(this.scene,l,a,c,h)),("UWindow"==l.dir||l.path)&&(l.windowThick+=1e3*a.thickness,l.windowThickL+=1e3*a.thickness,l.windowThickR+=1e3*a.thickness),l.path.includes("uWindow")?(s=this.createUWindowBooleanMesh(l,h,c)).geometry.translate(0,-(l.windowThickL-1200)/2,0):s=this.createBooleanMesh(l.width,l.height,l.windowThick+2,l.withSector,h),s.position.add(c),s.updateMatrix(),o.push(s)}let s=o[0];1==o.length&&(s=this.boolean(s,this.tmpM,"union"));for(let e=1;e<o.length;e++)s=this.boolean(s,o[e],"union");let l=this.boolean(a,s);this.scene.add(l),l?(this.paramInherit(l,a),i.push(l)):console.log("boolean error",r[t],a)}}return this.scene}place3DWindow(e,t,i,r,o){let a,n=new $4xklQ.Group;if(t.path.includes("baseDoor")&&(n=(0,$4xgHd.Entry3D).createBaseDoor({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:o,editor:this.editor}),("rightSide"==t.doorDir||"leftSide"==t.doorDir)&&(n.rotation.y+=Math.PI)),t.path.includes("doubleOpenDoor")&&(n=(0,$4xgHd.Entry3D).createDoubleOpenDoor({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:o,editor:this.editor})),t.path.includes("slidingDoor")&&(n=(0,$4xgHd.Entry3D).createSlidingDoor({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:o,editor:this.editor})),t.path.includes("baseWindow")&&(n=(0,$4xgHd.Entry3D).createBaseWindow({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:o,style:1,editor:this.editor})),t.path.includes("frenchWindow")&&(n=(0,$4xgHd.Entry3D).createFrenchWindow({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:o,editor:this.editor})),t.path.includes("lashDoor")&&(n=(0,$4xgHd.Entry3D).createLashDoor({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:o,editor:this.editor}),("rightSide"==t.doorDir||"leftSide"==t.doorDir)&&(n.rotation.y+=Math.PI)),t.path.includes("pass")&&(n=(0,$4xgHd.Entry3D).createPass({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:o,editor:this.editor})),t.path.includes("sectorDoor")&&(n=(0,$4xgHd.Entry3D).createSectorDoor({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:o,editor:this.editor,arcHei:t.arcHei})),t.path.includes("sectorWindow")&&(n=(0,$4xgHd.Entry3D).createSectorWindow({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:o,editor:this.editor})),t.path.includes("arcWindow")&&(n=(0,$4xgHd.Entry3D).createArcWindow({hole:t,wall:i,editor:this.editor})),t.path.includes("LWindow")){if(this.info=this.info||[],t.path.includes("left")){if(0==this.info.length)this.info.push({leftWidth:t.width-t.diff,leftDepth:i.thickness/2*1e3,leftSP:new $4xklQ.Vector2(1e3*i.startPoint.x,1e3*i.startPoint.y),leftEP:new $4xklQ.Vector2(1e3*i.endPoint.x,1e3*i.endPoint.y),commonPoint:t.commonPoint});else{let e=!0;for(let r=0;r<this.info.length;r++)if(this.info[r].commonPoint.x==t.commonPoint.x&&this.info[r].commonPoint.y==t.commonPoint.y&&this.info[r].commonPoint.z==t.commonPoint.z){let o=new $4xklQ.Vector2(1e3*i.startPoint.x,1e3*i.startPoint.y),a=new $4xklQ.Vector2(1e3*i.endPoint.x,1e3*i.endPoint.y);e=!1,this.info[r].leftWidth=t.width-t.diff,this.info[r].leftDepth=i.thickness/2*1e3,this.info[r].leftSP=o,this.info[r].leftEP=a}e&&this.info.push({leftWidth:t.width-t.diff,leftDepth:i.thickness/2*1e3,leftSP:new $4xklQ.Vector2(1e3*i.startPoint.x,1e3*i.startPoint.y),leftEP:new $4xklQ.Vector2(1e3*i.endPoint.x,1e3*i.endPoint.y),commonPoint:t.commonPoint})}}if(t.path.includes("right")){if(0==this.info.length)this.info.push({rightWidth:t.width-t.diff,rightDepth:i.thickness/2*1e3,rightSP:new $4xklQ.Vector2(1e3*i.startPoint.x,1e3*i.startPoint.y),rightEP:new $4xklQ.Vector2(1e3*i.endPoint.x,1e3*i.endPoint.y),commonPoint:t.commonPoint});else{let e=!0;for(let r=0;r<this.info.length;r++)if(this.info[r].commonPoint.x==t.commonPoint.x&&this.info[r].commonPoint.y==t.commonPoint.y&&this.info[r].commonPoint.z==t.commonPoint.z){let o=new $4xklQ.Vector2(1e3*i.startPoint.x,1e3*i.startPoint.y),a=new $4xklQ.Vector2(1e3*i.endPoint.x,1e3*i.endPoint.y);e=!1,this.info[r].rightWidth=t.width-t.diff,this.info[r].rightDepth=i.thickness/2*1e3,this.info[r].rightSP=o,this.info[r].rightEP=a}e&&this.info.push({rightWidth:t.width-t.diff,rightDepth:i.thickness/2*1e3,rightSP:new $4xklQ.Vector2(1e3*i.startPoint.x,1e3*i.startPoint.y),rightEP:new $4xklQ.Vector2(1e3*i.endPoint.x,1e3*i.endPoint.y),commonPoint:t.commonPoint})}}let e=[];for(let i=0;i<this.info.length;i++){let o=this.info[i];o.leftSP&&o.rightSP&&(o.leftSP.equals(o.rightSP)||o.leftSP.equals(o.rightEP)?(o.commonPoint=o.leftSP,o.leftVec=o.leftEP.clone().sub(o.leftSP).normalize(),o.leftSP.equals(o.rightSP)?o.rightVec=o.rightEP.clone().sub(o.leftSP).normalize():o.rightVec=o.leftSP.clone().sub(o.rightEP).normalize()):(o.commonPoint=o.leftEP,o.leftVec=o.leftSP.clone().sub(o.leftEP).normalize(),o.leftEP.equals(o.rightSP)?o.rightVec=o.rightEP.clone().sub(o.rightSP).normalize():o.rightVec=o.rightSP.clone().sub(o.rightEP).normalize()),n=(0,$4xgHd.Entry3D).createLWindow({leftPoint:o.commonPoint.clone().add(o.leftVec.setLength(o.leftWidth)),rightPoint:o.commonPoint.clone().add(o.rightVec.setLength(o.rightWidth)),commonPoint:o.commonPoint,height:t.height,leftDepth:o.leftDepth,rightDepth:o.rightDepth,position:r,editor:this.editor}),e.push(o))}e.forEach(e=>{this.info.splice(this.info.indexOf(e),1)})}if(t.path.includes("panoramicWindow")&&(n=(0,$4xgHd.Entry3D).createPanoramicWindow({width:t.width,height:t.height,position:r,thickness:1e3*i.thickness,rotAngle:o,editor:this.editor})),(t.path.includes("uWindow")||"UWindow"==t.dir)&&(this.uwInfo=this.uwInfo||{wallArr:[],wallList:[],editor:this.editor},this.uwInfo.wallArr.push(t.wallID),t.path.includes("uWindow")&&!t.dir?this.uwInfo.middleWall=i:this.uwInfo.wallList.push(i),this.uwInfo.width||(this.uwInfo.width=t.width,this.uwInfo.height=t.height,this.uwInfo.windowThick=t.windowThick,this.uwInfo.windowThickL=t.windowThickL,this.uwInfo.windowThickR=t.windowThickR,this.uwInfo.rotAngle=o,this.uwInfo.position=r),t.uuid&&(this.uwInfo.uuid=t.uuid),3==this.uwInfo.wallArr.length&&(n=(0,$4xgHd.Entry3D).createUWindow(this.uwInfo),t.uuid=this.uwInfo.uuid,delete this.uwInfo)),"dooropen"==t.path&&(n=(0,$4xgHd.Entry3D).createDooropen({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:o,editor:this.editor})),n.parameter){for(let e=0;e<this.editor.otherMeshs.length;e++)if(this.editor.otherMeshs[e].uuid==t.uuid){a=this.editor.otherMeshs[e];break}a&&n.parameter&&(n.parameter.tdm=a),a&&(a.parameter=[n]),n.modelType="CodeModel",n.modelPath=t.path,n.isLock=t.isLock,e.add(n)}}createBooleanMesh(e,t,i,r,o){r&&(t-=e/2);let a=new $4xklQ.MeshBasicMaterial({color:255,side:$4xklQ.DoubleSide}),n=new $4xklQ.Mesh(new $4xklQ.BoxGeometry(e,i,t),a);if(r){var s=new $4xklQ.Mesh(new $4xklQ.CylinderGeometry(e/2,e/2,i,50),a);s.position.add(new $4xklQ.Vector3(0,0,t/2)),s.updateMatrix(),n.material=new $4xklQ.MeshBasicMaterial({color:65520,side:$4xklQ.DoubleSide}),n=this.boolean(n,s,"union")}return n.geometry.computeBoundingBox(),n.geometry.center(),n.rotateZ(o),n}createUWindowBooleanMesh(e,t,i){let r=new $4xklQ.MeshBasicMaterial({color:16711680,side:$4xklQ.DoubleSide}),o=new $4xklQ.MeshBasicMaterial({color:65280,side:$4xklQ.DoubleSide}),a=10,n=new $4xklQ.Mesh(new $4xklQ.BoxGeometry(e.width/2+1,e.windowThickL+a,e.height),r);n.geometry.translate(-e.width/4,-(e.windowThickL-1200)/2,0);let s=new $4xklQ.Mesh(new $4xklQ.BoxGeometry(e.width/2+1,e.windowThickR+a,e.height),o);s.geometry.translate(e.width/4,-(e.windowThickR-1200)/2,0);let l=this.boolean(n,s,"union");return l.geometry.computeBoundingBox(),l.geometry.center(),l.geometry.translate(0,a,0),l.rotateZ(t),l}createArcMesh(e,t,i,r,o,a,n){var s=new $4xklQ.Path;s.arc(e.x,e.y,t,r,o,!1);let l=Math.round(Math.PI/Math.asin(120/(t+120))/2);l=l>100?100:l;var h=s.getPoints(l),c=new $4xklQ.Path;c.arc(e.x,e.y,i,r,o,!1);let d=Math.round(Math.PI/Math.asin(120/(t+120))/2);d=d>100?100:d;var p=c.getPoints(d),u=h.concat(p.reverse()),m=u.shift(),g=new $4xklQ.Shape;g.moveTo(m.x,m.y),u.forEach(function(e){g.lineTo(e.x,e.y)}),g.lineTo(m.x,m.y);var f={steps:2,depth:a,bevelEnabled:!1,bevelThickness:1,bevelSize:1,bevelSegments:1},w=new $4xklQ.ExtrudeGeometry(g,f),y=new $4xklQ.MeshBasicMaterial({color:16777215*Math.random()}),b=new $4xklQ.Mesh(w,y);b.geometry.computeBoundingBox();var x=b.geometry.boundingBox.min,P=b.geometry.boundingBox.max,v=x.clone().add(P).divideScalar(2);return b.geometry.center(),b.position.set(v.x,v.y,n-1e-5),b}booleanBack(e,t,i="subtract"){var r;e.updateMatrix(),t.updateMatrix();let o=(0,$cTA6h.CSG).fromMesh(e),a=(0,$cTA6h.CSG).fromMesh(t);if("union"==i)r=o.union(a);else{if(0==o.intersect(a).polygons.length)return!1;"subtract"==i&&(r=o.subtract(a)),"intersect"==i&&(r=o.intersect(a))}let n=(0,$cTA6h.CSG).toMesh(r,e.matrix,e.material);return this.scene.remove(e),n}boolean(e,t,i="subtract"){"subtract"==i&&(i=$7BJhL.SUBTRACTION),"union"==i&&(i=$7BJhL.ADDITION),"intersect"==i&&(i=$7BJhL.INTERSECTION),e.updateMatrixWorld(!0);let r=new $6Hryq.Brush(e.geometry,e.material),o=new $6Hryq.Brush(t.geometry,t.material);r.applyMatrix4(e.matrix),o.applyMatrix4(t.matrix),r.updateMatrixWorld(),o.updateMatrixWorld(),r.geometry.computeBoundsTree({maxLeafTris:5,strategy:parseFloat($ckwVR.CENTER)}),r.geometry.boundsTree.splitStrategy=$ckwVR.CENTER,o.geometry.computeBoundsTree({maxLeafTris:5,strategy:parseFloat($ckwVR.CENTER)}),o.geometry.boundsTree.splitStrategy=$ckwVR.CENTER,this.scene.remove(e);let a=new $94t2y.Evaluator;if(a.attributes=["position","normal"],a.debug.enabled=!0,a.useGroups=!0,i==$7BJhL.ADDITION||i==$7BJhL.INTERSECTION)return a.evaluate(r,o,i);if(i==$7BJhL.SUBTRACTION){let t=new $4xklQ.Mesh(new $4xklQ.BufferGeometry,new $4xklQ.MeshStandardMaterial({color:16711680,flatShading:!1,polygonOffset:!0,polygonOffsetUnits:.1,polygonOffsetFactor:.1}));return t.castShadow=!0,t.receiveShadow=!0,a.evaluate(r,o,i,t),t.geometry.computeBoundingBox(),t.geometry.center(),t.applyMatrix4(e.matrix),t}}paramInherit(target,origin){target.layers.mask=origin.layers.mask,["line","name","style","isArc","height","wallID","offsetXY","thickness","startPoint","endPoint","modelType","arcCenter","origin3DWall"].forEach(function(item){eval("target."+item+"= origin."+item)})}placeWindow(e,t,i,r,o){if(t.path.includes("LWindow")){this.createLWindow(e,t,i,r,o);return}let a=this.editor;new(0,$hu0fb.GLTFLoader)().load(t.path,function(n){let s;var l=n.scene,h=new $4xklQ.Box3().setFromObject(l),c=h.max.x-h.min.x,d=h.max.y-h.min.y,p=h.max.z-h.min.z,u=t.width,m=t.height,g=t.windowThick;if(t.withSector&&(m+=u/2),-1!=t.path.indexOf("WaveWindow")){g=3*i.thickness;var f=new $4xklQ.Vector3(vector.y,-vector.x,0).setLength(i.thickness);l.position.add(f);var w=u;if(-1!=t.path.indexOf("leftLWaveWindow")){var f=vector.negate();u=(u-i.thickness)*2e3/1420,f=new $4xklQ.Vector3(f.x,f.y,0).setLength((u-w)/2),l.position.add(f)}-1!=t.path.indexOf("rightLWaveWindow")&&(u=(u-i.thickness)*2e3/1420,f=new $4xklQ.Vector3(vector.x,vector.y,0).setLength((u-w)/2),l.position.add(f))}if(l.scale.set(u/c,m/d,g/p),l.rotateX(Math.PI/2),l.rotateY(o),-1!=t.path.indexOf("panoramicWindow")){let e=new $4xklQ.Vector3(0,(g-i.thickness)/2,0),t=new $4xklQ.Matrix4().makeRotationZ(o);l.position.add(e.applyMatrix4(t))}l.position.add(r),a.addBoxForMesh(l,[]),l.layers.set(2),l.traverse(function(e){e.layers.set(2)}),l.modelPath=t.path;for(let e=0;e<a.otherMeshs.length;e++)if(a.otherMeshs[e].uuid==t.uuid){s=a.otherMeshs[e];break}s&&(l.parameter={tdm:s},l.isLock=!1,s.isLock&&(l.isLock=s.isLock)),l.modelType="CodeModel",e.add(l)})}createArcWindow(e,t,i,r){let o=i.arcCenter;var a=(e+t)/2,n=a-i.thickness/4,s=a+i.thickness/4,l=this.createArcMesh(o,n,s,r.startRadian,r.endRadian,r.height,r.positionZ);l.material=new $4xklQ.MeshStandardMaterial({color:new $4xklQ.Color(.0385,.0385,.0385),roughness:.9,metalness:.1,normalScale:new $4xklQ.Vector2(1,-1)}),this.scene.add(l);var h=50,c=50/n,d=r.startRadian+c,p=r.endRadian-c,u=r.height-2*h,m=this.createArcMesh(o,n-1,s+1,d,p,u,r.positionZ);let g=this.boolean(l,m);this.scene.add(g),h-=1,c=h/n,d=r.startRadian+c,p=r.endRadian-c,u=r.height-2*h;var f=a-i.thickness/8,w=a+i.thickness/8,y=this.createArcMesh(o,f,w,d,p,u,r.positionZ);y.material=new $4xklQ.MeshStandardMaterial({color:new $4xklQ.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new $4xklQ.Vector2(1,-1),side:2,transparent:!0,opacity:.64,roughness:.9}),this.scene.add(y)}createLWindow(e,t,i,r,o){let a,n,s,l=50,h=10;if(t.path.includes("leftLWindow")){let e=new $4xklQ.Vector2(-t.width/2,i.thickness/2),r=new $4xklQ.Vector2(t.width/2,i.thickness/2),o=new $4xklQ.Vector2(t.width/2-t.diff,0),c=new $4xklQ.Vector2(-t.width/2,0);a=(0,$9QhXH.DM).createShapeByPointArr([e,r,o,c],"shape");let d=new $4xklQ.Vector2(-t.width/2+l,i.thickness/2),p=new $4xklQ.Vector2(t.width/2-t.diff,i.thickness/2),u=new $4xklQ.Vector2(t.width/2-t.diff,0),m=new $4xklQ.Vector2(-t.width/2+l,0);n=(0,$9QhXH.DM).createShapeByPointArr([d,p,u,m],"shape");let g=new $4xklQ.Vector2(-t.width/2+l-h,3*i.thickness/8),f=new $4xklQ.Vector2(t.width/2-t.diff/4,3*i.thickness/8),w=new $4xklQ.Vector2(t.width/2-3*t.diff/4,i.thickness/8),y=new $4xklQ.Vector2(-t.width/2+l-h,i.thickness/8);s=(0,$9QhXH.DM).createShapeByPointArr([g,f,w,y],"shape")}if(t.path.includes("rightLWindow")){let e=new $4xklQ.Vector2(-t.width/2,i.thickness/2),r=new $4xklQ.Vector2(t.width/2,i.thickness/2),o=new $4xklQ.Vector2(t.width/2,0),c=new $4xklQ.Vector2(-t.width/2+t.diff,0);a=(0,$9QhXH.DM).createShapeByPointArr([e,r,o,c],"shape");let d=new $4xklQ.Vector2(-t.width/2+t.diff,i.thickness/2),p=new $4xklQ.Vector2(t.width/2-l,i.thickness/2),u=new $4xklQ.Vector2(t.width/2-l,0),m=new $4xklQ.Vector2(-t.width/2+t.diff,0);n=(0,$9QhXH.DM).createShapeByPointArr([d,p,u,m],"shape");let g=new $4xklQ.Vector2(-t.width/2+t.diff/4,3*i.thickness/8),f=new $4xklQ.Vector2(t.width/2-l+h,3*i.thickness/8),w=new $4xklQ.Vector2(t.width/2-l+h,i.thickness/8),y=new $4xklQ.Vector2(-t.width/2+3*t.diff/4,i.thickness/8);s=(0,$9QhXH.DM).createShapeByPointArr([g,f,w,y],"shape")}let c=new $4xklQ.MeshStandardMaterial({color:new $4xklQ.Color(.0385,.0385,.0385),roughness:.9,metalness:.1,normalScale:new $4xklQ.Vector2(1,-1)}),d=this.createMeshByParam(t.height,a,c);d.position.set(r.x,r.y,r.z-t.height/2),d.rotation.z=o,e.add(d);let p=this.createMeshByParam(t.height-2*l,n,c);p.position.set(r.x,r.y,r.z-(t.height-2*l)/2),p.rotation.z=o;let u=this.boolean(d,p);e.add(u);let m=new $4xklQ.MeshStandardMaterial({color:new $4xklQ.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new $4xklQ.Vector2(1,-1),side:2,transparent:!0,opacity:.64,roughness:.9}),g=t.height-2*l+2*h,f=this.createMeshByParam(g,s,m);f.position.set(r.x,r.y,r.z-g/2),f.rotation.z=o,e.add(f)}createMeshByParam(e,t,i){let r={steps:2,depth:e,bevelEnabled:!1,bevelThickness:1,bevelSize:1,bevelSegments:1},o=new $4xklQ.ExtrudeGeometry(t,r);return new $4xklQ.Mesh(o,i)}recomputeUVs(e){let t=e.startPoint,i=e.endPoint,r=Array.from(e.geometry.attributes.position.array),o=[],a=[];for(let e=0;e<r.length/3;e++)o.push(new $4xklQ.Vector3(r[3*e],r[3*e+1],r[3*e+2]));for(let e=0;e<o.length/3;e++)a.push([o[3*e],o[3*e+1],o[3*e+2]]);let n=[],s=[];if(e.isArc){let r=t.clone().add(i).divideScalar(2);r=new $4xklQ.Vector2(1e3*r.x,1e3*r.y);let o=t.distanceTo(i)/2*Math.PI,l=new $4xklQ.Matrix3().setUvTransform(0,0,o/1024,e.height/1024,0,0,0);e.geometry.attributes.uv.applyMatrix3(l),a.forEach(function(t){var i=t[0],o=t[1],a=t[2];i.applyMatrix4(e.matrixWorld),o.applyMatrix4(e.matrixWorld),a.applyMatrix4(e.matrixWorld);var l=new $4xklQ.Vector3(r.x,r.y,o.z).sub(o),h=l.clone().negate(),c=a.clone().sub(o),d=i.clone().sub(o),p=c.cross(d).normalize(),u=180*p.angleTo(l)/Math.PI,m=180*p.angleTo(h)/Math.PI;u<6&&n.push(...t),m<6&&s.push(...t)})}else{let r=t.distanceTo(i),o=new $4xklQ.Matrix3().setUvTransform(0,0,r/1024,e.height/1024,0,0,0);e.geometry.attributes.uv.applyMatrix3(o);let l=i.clone().sub(t).normalize(),h=new $4xklQ.Vector3;0==l.y?h.x=0:h.x=-Math.round(1e3*l.y)/1e3,0==l.x?h.y=0:h.y=Math.round(1e3*l.x)/1e3;let c=h.clone().negate();for(let t=0;t<a.length;t++){let i=a[t][0],r=a[t][1],o=a[t][2];i.applyMatrix4(e.matrixWorld),r.applyMatrix4(e.matrixWorld),o.applyMatrix4(e.matrixWorld);let l=o.clone().sub(r),d=i.clone().sub(r),p=l.cross(d).normalize();0==p.x?p.x=0:p.x=Math.round(1e3*p.x)/1e3,0==p.y?p.y=0:p.y=Math.round(1e3*p.y)/1e3,0==p.z?p.z=0:p.z=Math.round(1e3*p.z)/1e3,p.equals(h)&&n.push(...a[t]),p.equals(c)&&s.push(...a[t])}}let l=[],h=[];n.forEach(function(e){l.push(o.indexOf(e))}),s.forEach(function(e){h.push(o.indexOf(e))});var c=[],d=Math.min(...l),p=Math.max(...h);let u=new $4xklQ.MeshStandardMaterial({color:"#9e9b9b"}),m=[u,u,u];0!=d&&c.push({start:0,count:d,materialIndex:0});for(var g=l[0],f=l[0],w=[],y=1,b=1;y<l.length;y++)l[y]-f==1?b++:(w.push({start:g,count:b,materialIndex:1}),w.push({start:l[y-1]+1,count:l[y]-l[y-1]-1,materialIndex:0}),g=l[y],b=1),f=l[y],y==l.length-1&&w.push({start:g,count:b,materialIndex:1});c.push(...w);for(var g=h[0],f=h[0],x=[],y=1,b=1;y<h.length;y++)h[y]-f==1?b++:(x.push({start:g,count:b,materialIndex:2}),x.push({start:h[y-1]+1,count:h[y]-h[y-1]-1,materialIndex:0}),g=h[y],b=1),f=h[y],y==h.length-1&&x.push({start:g,count:b,materialIndex:2});c.push(...x),c.push({start:p+1,count:r.length/3-p-1,materialIndex:0}),e.geometry.groups=c,e.material=m}}DigHole.prototype.boolean=DigHole.prototype.booleanBack}),parcelRequire.register("jPMpS",function(e,t){$parcel$export(e.exports,"CSG",()=>parcelRequire("cTA6h").CSG);"use strict";var i=parcelRequire("4xklQ"),r=parcelRequire("cTA6h");parcelRequire("i56yD");let{BufferGeometry:o,Vector3:a,Vector2:n}=i;r.CSG.fromGeometry=function(e,t){let i=[];if(e.isGeometry){let o=e.faces,a=e.vertices,n=["a","b","c"];for(let s=0;s<o.length;s++){let l=o[s],h=[];for(let t=0;t<3;t++)h.push(new r.Vertex(a[l[n[t]]],l.vertexNormals[t],e.faceVertexUvs[0][s][t]));i.push(new r.Polygon(h,t))}}else if(e.isBufferGeometry){let o,a=e.attributes.position,n=e.attributes.normal,s=e.attributes.uv,l=e.attributes.color;if(e.index)o=e.index.array;else{o=Array(a.array.length/a.itemSize|0);for(let e=0;e<o.length;e++)o[e]=e}i=Array(o.length/3|0);for(let e=0,h=0,c=o.length;e<c;e+=3,h++){let c=[,,,];for(let t=0;t<3;t++){let i=o[e+t],h=3*i,d=2*i,p=a.array[h],u=a.array[h+1],m=a.array[h+2],g=n.array[h],f=n.array[h+1],w=n.array[h+2];c[t]=new r.Vertex({x:p,y:u,z:m},{x:g,y:f,z:w},s&&{x:s.array[d],y:s.array[d+1],z:0},l&&{x:l.array[d],y:l.array[d+1],z:l.array[d+2]})}i[h]=new r.Polygon(c,t)}}else console.error("Unsupported CSG input type:"+e.type);return(0,r.CSG).fromPolygons(i)};let s=new i.Vector3,l=new i.Matrix3;r.CSG.fromMesh=function(e,t){e.geometry.computeVertexNormals();let i=(0,r.CSG).fromGeometry(e.geometry,t);l.getNormalMatrix(e.matrix);for(let t=0;t<i.polygons.length;t++){let r=i.polygons[t];for(let t=0;t<r.vertices.length;t++){let i=r.vertices[t];i.pos.copy(s.copy(i.pos).applyMatrix4(e.matrix)),i.normal.copy(s.copy(i.normal).applyMatrix3(l))}}return i};let h=e=>({top:0,array:new Float32Array(e),write:function(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y,this.array[this.top++]=e.z}}),c=e=>({top:0,array:new Float32Array(e),write:function(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y}});r.CSG.toGeometry=function(e,t=!0){let r,o=e.polygons;if(t){let e,t,a=0;o.forEach(e=>a+=e.vertices.length-2),r=new i.BufferGeometry;let n=h(9*a),s=h(9*a),l=[];if(o.forEach(i=>{let r=i.vertices,o=r.length;void 0===i.shared||l[i.shared]||(l[i.shared]=[]),o&&(void 0===r[0].color||t||(t=h(9*a)),void 0===r[0].uv||e||(e=c(6*a)));for(let a=3;a<=o;a++)void 0!==i.shared&&l[i.shared].push(n.top/3,n.top/3+1,n.top/3+2),n.write(r[0].pos),n.write(r[a-2].pos),n.write(r[a-1].pos),s.write(r[0].normal),s.write(r[a-2].normal),s.write(r[a-1].normal),e&&r[0].uv&&(e.write(r[0].uv)||e.write(r[a-2].uv)||e.write(r[a-1].uv)),t&&(t.write(r[0].color)||t.write(r[a-2].color)||t.write(r[a-1].color))}),r.setAttribute("position",new i.BufferAttribute(n.array,3)),r.setAttribute("normal",new i.BufferAttribute(s.array,3)),e&&r.setAttribute("uv",new i.BufferAttribute(e.array,2)),t&&r.setAttribute("color",new i.BufferAttribute(t.array,3)),l.length){let e=[],t=0;for(let i=0;i<l.length;i++)r.addGroup(t,l[i].length,i),t+=l[i].length,e=e.concat(l[i]);r.setIndex(e)}}else{let e=(r=new Geometry).vertices,t=r.faceVertexUvs[0];for(let a=0;a<o.length;a++){let n=o[a],s=n.vertices,l=e.length,h=s.length;for(let t=0;t<h;t++)e.push(new i.Vector3().copy(s[t].pos));for(let e=3;e<=h;e++){let o=new i.Face3,a=[];t.push(a);let h=o.vertexNormals;o.a=l,o.b=l+e-2,o.c=l+e-1,h.push(new i.Vector3().copy(s[0].normal)),h.push(new i.Vector3().copy(s[e-2].normal)),h.push(new i.Vector3().copy(s[e-1].normal)),a.push(new i.Vector3().copy(s[0].uv)),a.push(new i.Vector3().copy(s[e-2].uv)),a.push(new i.Vector3().copy(s[e-1].uv)),o.normal=new i.Vector3().copy(n.plane.normal),r.faces.push(o)}}(r=new i.BufferGeometry().fromGeometry(r)).verticesNeedUpdate=r.elementsNeedUpdate=r.normalsNeedUpdate=!0}return r},r.CSG.toMesh=function(e,t,o){let a=(0,r.CSG).toGeometry(e),n=new i.Matrix4().copy(t).invert();a.applyMatrix4(n),a.computeBoundingSphere(),a.computeBoundingBox();let s=new i.Mesh(a,o);return s.matrix.copy(t),s.matrix.decompose(s.position,s.quaternion,s.scale),s.rotation.setFromQuaternion(s.quaternion),s.updateMatrixWorld(),s.castShadow=s.receiveShadow=!0,s}}),parcelRequire.register("cTA6h",function(e,t){$parcel$export(e.exports,"CSG",()=>i),$parcel$export(e.exports,"Vertex",()=>n),$parcel$export(e.exports,"Polygon",()=>l);class i{constructor(){this.polygons=[]}clone(){let e=new i;return e.polygons=this.polygons.map(e=>e.clone()),e}toPolygons(){return this.polygons}union(e){let t=new h(this.clone().polygons),r=new h(e.clone().polygons);return t.clipTo(r),r.clipTo(t),r.invert(),r.clipTo(t),r.invert(),t.build(r.allPolygons()),i.fromPolygons(t.allPolygons())}subtract(e){let t=new h(this.clone().polygons),r=new h(e.clone().polygons);return t.invert(),t.clipTo(r),r.clipTo(t),r.invert(),r.clipTo(t),r.invert(),t.build(r.allPolygons()),t.invert(),i.fromPolygons(t.allPolygons())}intersect(e){let t=new h(this.clone().polygons),r=new h(e.clone().polygons);return t.invert(),r.clipTo(t),r.invert(),t.clipTo(r),r.clipTo(t),t.build(r.allPolygons()),t.invert(),i.fromPolygons(t.allPolygons())}inverse(){let e=this.clone();return e.polygons.forEach(e=>e.flip()),e}}i.fromPolygons=function(e){let t=new i;return t.polygons=e,t};class r{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new r(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}times(e){return this.x*=e,this.y*=e,this.z*=e,this}dividedBy(e){return this.x/=e,this.y/=e,this.z/=e,this}lerp(e,t){return this.add(o.copy(e).sub(this).times(t))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(this.x**2+this.y**2+this.z**2)}normalize(){return this.unit()}cross(e){let t=this,i=t.x,r=t.y,o=t.z,a=e.x,n=e.y,s=e.z;return this.x=r*s-o*n,this.y=o*a-i*s,this.z=i*n-r*a,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}}let o=new r,a=new r;class n{constructor(e,t,i,o){this.pos=new r().copy(e),this.normal=new r().copy(t),i&&(this.uv=new r().copy(i))&&(this.uv.z=0),o&&(this.color=new r().copy(o))}clone(){return new n(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(e,t){return new n(this.pos.clone().lerp(e.pos,t),this.normal.clone().lerp(e.normal,t),this.uv&&e.uv&&this.uv.clone().lerp(e.uv,t),this.color&&e.color&&this.color.clone().lerp(e.color,t))}}class s{constructor(e,t){this.normal=e,this.w=t}clone(){return new s(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(e,t,i,r,a){let n=0,h=1,c=2,d=3,p=0,u=[];for(let t=0;t<e.vertices.length;t++){let i=this.normal.dot(e.vertices[t].pos)-this.w,r=i<-s.EPSILON?c:i>s.EPSILON?h:n;p|=r,u.push(r)}switch(p){case n:(this.normal.dot(e.plane.normal)>0?t:i).push(e);break;case h:r.push(e);break;case c:a.push(e);break;case d:let m=[],g=[];for(let t=0;t<e.vertices.length;t++){let i=(t+1)%e.vertices.length,r=u[t],a=u[i],n=e.vertices[t],s=e.vertices[i];if(r!=c&&m.push(n),r!=h&&g.push(r!=c?n.clone():n),(r|a)==d){let e=(this.w-this.normal.dot(n.pos))/this.normal.dot(o.copy(s.pos).sub(n.pos)),t=n.interpolate(s,e);m.push(t),g.push(t.clone())}}m.length>=3&&r.push(new l(m,e.shared)),g.length>=3&&a.push(new l(g,e.shared))}}}s.EPSILON=1e-5,s.fromPoints=function(e,t,i){let r=o.copy(t).sub(e).cross(a.copy(i).sub(e)).normalize();return new s(r.clone(),r.dot(e))};class l{constructor(e,t){this.vertices=e,this.shared=t,this.plane=s.fromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){return new l(this.vertices.map(e=>e.clone()),this.shared)}flip(){this.vertices.reverse().forEach(e=>e.flip()),this.plane.flip()}}class h{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)}clone(){let e=new h;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map(e=>e.clone()),e}invert(){for(let e=0;e<this.polygons.length;e++)this.polygons[e].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();let e=this.front;this.front=this.back,this.back=e}clipPolygons(e){if(!this.plane)return e.slice();let t=[],i=[];for(let r=0;r<e.length;r++)this.plane.splitPolygon(e[r],t,i,t,i);return this.front&&(t=this.front.clipPolygons(t)),i=this.back?this.back.clipPolygons(i):[],t.concat(i)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}build(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());let t=[],i=[];for(let r=0;r<e.length;r++)this.plane.splitPolygon(e[r],this.polygons,this.polygons,t,i);t.length&&(this.front||(this.front=new h),this.front.build(t)),i.length&&(this.back||(this.back=new h),this.back.build(i))}}i.fromJSON=function(e){return i.fromPolygons(e.polygons.map(e=>new l(e.vertices.map(e=>new n(e.pos,e.normal,e.uv)),e.shared)))}}),parcelRequire.register("i56yD",function(e,t){let i,r;var o=parcelRequire("cTA6h");let a=!1,n=0,s={},l=()=>{let e=new Worker(r);return e.onmessage=function(e){let t=JSON.parse(e.data),r=s[t.taskId];delete s[t.taskId],r.resolve((0,o.CSG).fromJSON(t.result)),i.busy=!1},i={worker:e,busy:!1}},h=()=>a?i&&!i.busy?(i.busy=!0,{then:e=>e(i)}):{then:function(){return this}}:(a=!0,fetch("../csg-lib.js").then(function(e){return e.text().then(function(e){e=e.slice(0,e.lastIndexOf("export"));let t=e+`
                    self.onmessage=(message)=>{
                    let task = JSON.parse(message.data)
                    //console.log("Got task:"+task.op+' '+task.taskId)
                    postMessage(JSON.stringify({
                        taskId:task.taskId,
                        result : CSG.fromJSON(task.a)[task.op](CSG.fromJSON(task.b))
                    }))
                }
                console.log('CSG worker started!')`,i=new Blob([t],{type:"application/javascript"});r=URL.createObjectURL(i)}).then(()=>l())}));o.CSG.doAsync=(e,t,i)=>h().then(r=>{let o={a:e,op:t,b:i,taskId:n};return s[n]=o,n++,o.result=new Promise((e,t)=>{o.resolve=e,r.busy=!0,r.worker.postMessage(JSON.stringify(o))}),o.result})}),parcelRequire.register("hu0fb",function(e,t){$parcel$export(e.exports,"GLTFLoader",()=>r);var i=parcelRequire("4xklQ");class r extends i.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new h(e)}),this.register(function(e){return new f(e)}),this.register(function(e){return new w(e)}),this.register(function(e){return new d(e)}),this.register(function(e){return new p(e)}),this.register(function(e){return new u(e)}),this.register(function(e){return new m(e)}),this.register(function(e){return new l(e)}),this.register(function(e){return new g(e)}),this.register(function(e){return new c(e)}),this.register(function(e){return new n(e)}),this.register(function(e){return new y(e)})}load(e,t,r,o){let a;let n=this;a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:(0,i.LoaderUtils).extractUrlBase(e),this.manager.itemStart(e);let s=function(t){o?o(t):console.error(t),n.manager.itemError(e),n.manager.itemEnd(e)},l=new i.FileLoader(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(i){try{n.parse(i,a,function(i){t(i),n.manager.itemEnd(e)},s)}catch(e){s(e)}},r,s)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return -1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return -1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,o){let n;let l={},h={};if("string"==typeof e)n=e;else{let t=(0,i.LoaderUtils).decodeText(new Uint8Array(e,0,4));if(t===b){try{l[a.KHR_BINARY_GLTF]=new v(e)}catch(e){o&&o(e);return}n=l[a.KHR_BINARY_GLTF].content}else n=(0,i.LoaderUtils).decodeText(new Uint8Array(e))}let c=JSON.parse(n);if(void 0===c.asset||c.asset.version[0]<2){o&&o(Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let d=new J(c,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});d.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){let t=this.pluginCallbacks[e](d);h[t.name]=t,l[t.name]=!0}if(c.extensionsUsed)for(let e=0;e<c.extensionsUsed.length;++e){let t=c.extensionsUsed[e],i=c.extensionsRequired||[];switch(t){case a.KHR_MATERIALS_UNLIT:l[t]=new s;break;case a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:l[t]=new T;break;case a.KHR_DRACO_MESH_COMPRESSION:l[t]=new M(c,this.dracoLoader);break;case a.KHR_TEXTURE_TRANSFORM:l[t]=new C;break;case a.KHR_MESH_QUANTIZATION:l[t]=new S;break;default:i.indexOf(t)>=0&&void 0===h[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}d.setExtensions(l),d.setPlugins(h),d.parse(r,o)}parseAsync(e,t){let i=this;return new Promise(function(r,o){i.parse(e,t,r,o)})}}function o(){let e={};return{get:function(t){return e[t]},add:function(t,i){e[t]=i},remove:function(t){delete e[t]},removeAll:function(){e={}}}}let a={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class n{constructor(e){this.parser=e,this.name=a.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let e=this.parser,t=this.parser.json.nodes||[];for(let i=0,r=t.length;i<r;i++){let r=t[i];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){let t;let r=this.parser,o="light:"+e,a=r.cache.get(o);if(a)return a;let n=r.json,s=n.extensions&&n.extensions[this.name]||{},l=s.lights||[],h=l[e],c=new i.Color(16777215);void 0!==h.color&&c.fromArray(h.color);let d=void 0!==h.range?h.range:0;switch(h.type){case"directional":(t=new i.DirectionalLight(c)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new i.PointLight(c)).distance=d;break;case"spot":(t=new i.SpotLight(c)).distance=d,h.spot=h.spot||{},h.spot.innerConeAngle=void 0!==h.spot.innerConeAngle?h.spot.innerConeAngle:0,h.spot.outerConeAngle=void 0!==h.spot.outerConeAngle?h.spot.outerConeAngle:Math.PI/4,t.angle=h.spot.outerConeAngle,t.penumbra=1-h.spot.innerConeAngle/h.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw Error("THREE.GLTFLoader: Unexpected light type: "+h.type)}return t.position.set(0,0,0),t.decay=2,void 0!==h.intensity&&(t.intensity=h.intensity),t.name=r.createUniqueName(h.name||"light_"+e),a=Promise.resolve(t),r.cache.add(o,a),a}createNodeAttachment(e){let t=this,i=this.parser,r=i.json,o=r.nodes[e],a=o.extensions&&o.extensions[this.name]||{},n=a.light;return void 0===n?null:this._loadLight(n).then(function(e){return i._getNodeRef(t.cache,n,e)})}}class s{constructor(){this.name=a.KHR_MATERIALS_UNLIT}getMaterialType(){return i.MeshBasicMaterial}extendParams(e,t,r){let o=[];e.color=new i.Color(1,1,1),e.opacity=1;let a=t.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){let t=a.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==a.baseColorTexture&&o.push(r.assignTexture(e,"map",a.baseColorTexture,i.sRGBEncoding))}return Promise.all(o)}}class l{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){let i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let o=r.extensions[this.name].emissiveStrength;return void 0!==o&&(t.emissiveIntensity=o),Promise.resolve()}}class h{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){let t=this.parser,r=t.json.materials[e];return r.extensions&&r.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,o=r.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();let a=[],n=o.extensions[this.name];if(void 0!==n.clearcoatFactor&&(t.clearcoat=n.clearcoatFactor),void 0!==n.clearcoatTexture&&a.push(r.assignTexture(t,"clearcoatMap",n.clearcoatTexture)),void 0!==n.clearcoatRoughnessFactor&&(t.clearcoatRoughness=n.clearcoatRoughnessFactor),void 0!==n.clearcoatRoughnessTexture&&a.push(r.assignTexture(t,"clearcoatRoughnessMap",n.clearcoatRoughnessTexture)),void 0!==n.clearcoatNormalTexture&&(a.push(r.assignTexture(t,"clearcoatNormalMap",n.clearcoatNormalTexture)),void 0!==n.clearcoatNormalTexture.scale)){let e=n.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new i.Vector2(e,e)}return Promise.all(a)}}class c{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){let t=this.parser,r=t.json.materials[e];return r.extensions&&r.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let o=[],a=r.extensions[this.name];return void 0!==a.iridescenceFactor&&(t.iridescence=a.iridescenceFactor),void 0!==a.iridescenceTexture&&o.push(i.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),void 0!==a.iridescenceIor&&(t.iridescenceIOR=a.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==a.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),void 0!==a.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),void 0!==a.iridescenceThicknessTexture&&o.push(i.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(o)}}class d{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_SHEEN}getMaterialType(e){let t=this.parser,r=t.json.materials[e];return r.extensions&&r.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,o=r.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();let a=[];t.sheenColor=new i.Color(0,0,0),t.sheenRoughness=0,t.sheen=1;let n=o.extensions[this.name];return void 0!==n.sheenColorFactor&&t.sheenColor.fromArray(n.sheenColorFactor),void 0!==n.sheenRoughnessFactor&&(t.sheenRoughness=n.sheenRoughnessFactor),void 0!==n.sheenColorTexture&&a.push(r.assignTexture(t,"sheenColorMap",n.sheenColorTexture,i.sRGBEncoding)),void 0!==n.sheenRoughnessTexture&&a.push(r.assignTexture(t,"sheenRoughnessMap",n.sheenRoughnessTexture)),Promise.all(a)}}class p{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){let t=this.parser,r=t.json.materials[e];return r.extensions&&r.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let o=[],a=r.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&o.push(i.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(o)}}class u{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_VOLUME}getMaterialType(e){let t=this.parser,r=t.json.materials[e];return r.extensions&&r.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,o=r.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();let a=[],n=o.extensions[this.name];t.thickness=void 0!==n.thicknessFactor?n.thicknessFactor:0,void 0!==n.thicknessTexture&&a.push(r.assignTexture(t,"thicknessMap",n.thicknessTexture)),t.attenuationDistance=n.attenuationDistance||0;let s=n.attenuationColor||[1,1,1];return t.attenuationColor=new i.Color(s[0],s[1],s[2]),Promise.all(a)}}class m{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_IOR}getMaterialType(e){let t=this.parser,r=t.json.materials[e];return r.extensions&&r.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let o=r.extensions[this.name];return t.ior=void 0!==o.ior?o.ior:1.5,Promise.resolve()}}class g{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_SPECULAR}getMaterialType(e){let t=this.parser,r=t.json.materials[e];return r.extensions&&r.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,o=r.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();let a=[],n=o.extensions[this.name];t.specularIntensity=void 0!==n.specularFactor?n.specularFactor:1,void 0!==n.specularTexture&&a.push(r.assignTexture(t,"specularIntensityMap",n.specularTexture));let s=n.specularColorFactor||[1,1,1];return t.specularColor=new i.Color(s[0],s[1],s[2]),void 0!==n.specularColorTexture&&a.push(r.assignTexture(t,"specularColorMap",n.specularColorTexture,i.sRGBEncoding)),Promise.all(a)}}class f{constructor(e){this.parser=e,this.name=a.KHR_TEXTURE_BASISU}loadTexture(e){let t=this.parser,i=t.json,r=i.textures[e];if(!r.extensions||!r.extensions[this.name])return null;let o=r.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(!(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures")}return t.loadTextureImage(e,o.source,a)}}class w{constructor(e){this.parser=e,this.name=a.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){let t=this.name,i=this.parser,r=i.json,o=r.textures[e];if(!o.extensions||!o.extensions[t])return null;let a=o.extensions[t],n=r.images[a.source],s=i.textureLoader;if(n.uri){let e=i.options.manager.getHandler(n.uri);null!==e&&(s=e)}return this.detectSupport().then(function(o){if(o)return i.loadTextureImage(e,a.source,s);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class y{constructor(e){this.name=a.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){let t=this.parser.json,i=t.bufferViews[e];if(!i.extensions||!i.extensions[this.name])return null;{let e=i.extensions[this.name],r=this.parser.getDependency("buffer",e.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(!(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files")}return r.then(function(t){let i=e.byteOffset||0,r=e.byteLength||0,a=e.count,n=e.byteStride,s=new Uint8Array(t,i,r);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(a,n,s,e.mode,e.filter).then(function(e){return e.buffer}):o.ready.then(function(){let t=new ArrayBuffer(a*n);return o.decodeGltfBuffer(new Uint8Array(t),a,n,s,e.mode,e.filter),t})})}}}let b="glTF",x=12,P={JSON:1313821514,BIN:5130562};class v{constructor(e){this.name=a.KHR_BINARY_GLTF,this.content=null,this.body=null;let t=new DataView(e,0,x);if(this.header={magic:(0,i.LoaderUtils).decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==b)throw Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw Error("THREE.GLTFLoader: Legacy binary file detected.");let r=this.header.length-x,o=new DataView(e,x),n=0;for(;n<r;){let t=o.getUint32(n,!0);n+=4;let r=o.getUint32(n,!0);if(n+=4,r===P.JSON){let r=new Uint8Array(e,x+n,t);this.content=(0,i.LoaderUtils).decodeText(r)}else if(r===P.BIN){let i=x+n;this.body=e.slice(i,i+t)}n+=t}if(null===this.content)throw Error("THREE.GLTFLoader: JSON content not found.")}}class M{constructor(e,t){if(!t)throw Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=a.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){let i=this.json,r=this.dracoLoader,o=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,n={},s={},l={};for(let e in a){let t=E[e]||e.toLowerCase();n[t]=a[e]}for(let t in e.attributes){let r=E[t]||t.toLowerCase();if(void 0!==a[t]){let o=i.accessors[e.attributes[t]],a=W[o.componentType];l[r]=a.name,s[r]=!0===o.normalized}}return t.getDependency("bufferView",o).then(function(e){return new Promise(function(t){r.decodeDracoFile(e,function(e){for(let t in e.attributes){let i=e.attributes[t],r=s[t];void 0!==r&&(i.normalized=r)}t(e)},n,l)})})}}class C{constructor(){this.name=a.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class D extends i.MeshStandardMaterial{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;let t="#ifdef USE_SPECULARMAP\n	uniform sampler2D specularMap;\n#endif",r="#ifdef USE_GLOSSINESSMAP\n	uniform sampler2D glossinessMap;\n#endif",o="vec3 specularFactor = specular;\n#ifdef USE_SPECULARMAP\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture\n	specularFactor *= texelSpecular.rgb;\n#endif",a="float glossinessFactor = glossiness;\n#ifdef USE_GLOSSINESSMAP\n	vec4 texelGlossiness = texture2D( glossinessMap, vUv );\n	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture\n	glossinessFactor *= texelGlossiness.a;\n#endif",n="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.\nmaterial.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\nmaterial.specularColor = specularFactor;",s={specular:{value:new(0,i.Color)().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=s,this.onBeforeCompile=function(e){for(let t in s)e.uniforms[t]=s[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",r).replace("#include <roughnessmap_fragment>",o).replace("#include <metalnessmap_fragment>",a).replace("#include <lights_physical_fragment>",n)},Object.defineProperties(this,{specular:{get:function(){return s.specular.value},set:function(e){s.specular.value=e}},specularMap:{get:function(){return s.specularMap.value},set:function(e){s.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return s.glossiness.value},set:function(e){s.glossiness.value=e}},glossinessMap:{get:function(){return s.glossinessMap.value},set:function(e){s.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class T{constructor(){this.name=a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return D}extendParams(e,t,r){let o=t.extensions[this.name];e.color=new i.Color(1,1,1),e.opacity=1;let a=[];if(Array.isArray(o.diffuseFactor)){let t=o.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==o.diffuseTexture&&a.push(r.assignTexture(e,"map",o.diffuseTexture,i.sRGBEncoding)),e.emissive=new i.Color(0,0,0),e.glossiness=void 0!==o.glossinessFactor?o.glossinessFactor:1,e.specular=new i.Color(1,1,1),Array.isArray(o.specularFactor)&&e.specular.fromArray(o.specularFactor),void 0!==o.specularGlossinessTexture){let t=o.specularGlossinessTexture;a.push(r.assignTexture(e,"glossinessMap",t)),a.push(r.assignTexture(e,"specularMap",t,i.sRGBEncoding))}return Promise.all(a)}createMaterial(e){let t=new D(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=void 0===e.emissiveIntensity?1:e.emissiveIntensity,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=i.TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t}}class S{constructor(){this.name=a.KHR_MESH_QUANTIZATION}}class k extends i.Interpolant{constructor(e,t,i,r){super(e,t,i,r)}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,o=e*r*3+r;for(let e=0;e!==r;e++)t[e]=i[o+e];return t}interpolate_(e,t,i,r){let o=this.resultBuffer,a=this.sampleValues,n=this.valueSize,s=2*n,l=3*n,h=r-t,c=(i-t)/h,d=c*c,p=d*c,u=e*l,m=u-l,g=-2*p+3*d,f=p-d,w=1-g,y=f-d+c;for(let e=0;e!==n;e++){let t=a[m+e+n],i=a[m+e+s]*h,r=a[u+e+n],l=a[u+e]*h;o[e]=w*t+y*i+g*r+f*l}return o}}let V=new i.Quaternion;class A extends k{interpolate_(e,t,i,r){let o=super.interpolate_(e,t,i,r);return V.fromArray(o).normalize().toArray(o),o}}let L={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},W={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},I={9728:i.NearestFilter,9729:i.LinearFilter,9984:i.NearestMipmapNearestFilter,9985:i.LinearMipmapNearestFilter,9986:i.NearestMipmapLinearFilter,9987:i.LinearMipmapLinearFilter},R={33071:i.ClampToEdgeWrapping,33648:i.MirroredRepeatWrapping,10497:i.RepeatWrapping},B={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},E={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},O={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},F={CUBICSPLINE:void 0,LINEAR:i.InterpolateLinear,STEP:i.InterpolateDiscrete},z={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function G(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new i.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:i.FrontSide})),e.DefaultMaterial}function H(e,t,i){for(let r in i.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=i.extensions[r])}function j(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function _(e,t,i){let r=!1,o=!1,a=!1;for(let e=0,i=t.length;e<i;e++){let i=t[e];if(void 0!==i.POSITION&&(r=!0),void 0!==i.NORMAL&&(o=!0),void 0!==i.COLOR_0&&(a=!0),r&&o&&a)break}if(!r&&!o&&!a)return Promise.resolve(e);let n=[],s=[],l=[];for(let h=0,c=t.length;h<c;h++){let c=t[h];if(r){let t=void 0!==c.POSITION?i.getDependency("accessor",c.POSITION):e.attributes.position;n.push(t)}if(o){let t=void 0!==c.NORMAL?i.getDependency("accessor",c.NORMAL):e.attributes.normal;s.push(t)}if(a){let t=void 0!==c.COLOR_0?i.getDependency("accessor",c.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(n),Promise.all(s),Promise.all(l)]).then(function(t){let i=t[0],n=t[1],s=t[2];return r&&(e.morphAttributes.position=i),o&&(e.morphAttributes.normal=n),a&&(e.morphAttributes.color=s),e.morphTargetsRelative=!0,e})}function U(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let i=0,r=t.weights.length;i<r;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){let i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(let t=0,r=i.length;t<r;t++)e.morphTargetDictionary[i[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function N(e){let t=e.extensions&&e.extensions[a.KHR_DRACO_MESH_COMPRESSION];return t?"draco:"+t.bufferView+":"+t.indices+":"+q(t.attributes):e.indices+":"+q(e.attributes)+":"+e.mode}function q(e){let t="",i=Object.keys(e).sort();for(let r=0,o=i.length;r<o;r++)t+=i[r]+":"+e[i[r]]+";";return t}function Y(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function X(e){return e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/)?"image/jpeg":e.search(/\.webp($|\?)/i)>0||0===e.search(/^data\:image\/webp/)?"image/webp":"image/png"}class J{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new o,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),a=navigator.userAgent.indexOf("Firefox")>-1,n=a?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;"undefined"==typeof createImageBitmap||r||a&&n<98?this.textureLoader=new i.TextureLoader(this.options.manager):this.textureLoader=new i.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new i.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){let i=this,r=this.json,o=this.extensions;this.cache.removeAll(),this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(t){let a={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:i,userData:{}};H(o,a,r),j(a,r),Promise.all(i._invokeAll(function(e){return e.afterRoot&&e.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){let e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let i=0,r=t.length;i<r;i++){let r=t[i].joints;for(let t=0,i=r.length;t<i;t++)e[r[t]].isBone=!0}for(let t=0,r=e.length;t<r;t++){let r=e[t];void 0!==r.mesh&&(this._addNodeRef(this.meshCache,r.mesh),void 0!==r.skin&&(i[r.mesh].isSkinnedMesh=!0)),void 0!==r.camera&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;let r=i.clone(),o=(e,t)=>{let i=this.associations.get(e);for(let[r,a]of(null!=i&&this.associations.set(t,i),e.children.entries()))o(a,t.children[r])};return o(i,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){let t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){let r=e(t[i]);if(r)return r}return null}_invokeAll(e){let t=Object.values(this.plugins);t.unshift(this);let i=[];for(let r=0;r<t.length;r++){let o=e(t[r]);o&&i.push(o)}return i}getDependency(e,t){let i=e+":"+t,r=this.cache.get(i);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:throw Error("Unknown type: "+e)}this.cache.add(i,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){let i=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map(function(t,r){return i.getDependency(e,r)})),this.cache.add(e,t)}return t}loadBuffer(e){let t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[a.KHR_BINARY_GLTF].body);let o=this.options;return new Promise(function(e,a){r.load((0,i.LoaderUtils).resolveURL(t.uri,o.path),e,void 0,function(){a(Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){let t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){let i=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+i)})}loadAccessor(e){let t=this,r=this.json,o=this.json.accessors[e];if(void 0===o.bufferView&&void 0===o.sparse)return Promise.resolve(null);let a=[];return void 0!==o.bufferView?a.push(this.getDependency("bufferView",o.bufferView)):a.push(null),void 0!==o.sparse&&(a.push(this.getDependency("bufferView",o.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",o.sparse.values.bufferView))),Promise.all(a).then(function(e){let a,n;let s=e[0],l=B[o.type],h=W[o.componentType],c=h.BYTES_PER_ELEMENT,d=c*l,p=o.byteOffset||0,u=void 0!==o.bufferView?r.bufferViews[o.bufferView].byteStride:void 0,m=!0===o.normalized;if(u&&u!==d){let e=Math.floor(p/u),r="InterleavedBuffer:"+o.bufferView+":"+o.componentType+":"+e+":"+o.count,d=t.cache.get(r);d||(a=new h(s,e*u,o.count*u/c),d=new i.InterleavedBuffer(a,u/c),t.cache.add(r,d)),n=new i.InterleavedBufferAttribute(d,l,p%u/c,m)}else a=null===s?new h(o.count*l):new h(s,p,o.count*l),n=new i.BufferAttribute(a,l,m);if(void 0!==o.sparse){let t=B.SCALAR,r=W[o.sparse.indices.componentType],a=o.sparse.indices.byteOffset||0,c=o.sparse.values.byteOffset||0,d=new r(e[1],a,o.sparse.count*t),p=new h(e[2],c,o.sparse.count*l);null!==s&&(n=new i.BufferAttribute(n.array.slice(),n.itemSize,n.normalized));for(let e=0,t=d.length;e<t;e++){let t=d[e];if(n.setX(t,p[e*l]),l>=2&&n.setY(t,p[e*l+1]),l>=3&&n.setZ(t,p[e*l+2]),l>=4&&n.setW(t,p[e*l+3]),l>=5)throw Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return n})}loadTexture(e){let t=this.json,i=this.options,r=t.textures[e],o=r.source,a=t.images[o],n=this.textureLoader;if(a.uri){let e=i.manager.getHandler(a.uri);null!==e&&(n=e)}return this.loadTextureImage(e,o,n)}loadTextureImage(e,t,r){let o=this,a=this.json,n=a.textures[e],s=a.images[t],l=(s.uri||s.bufferView)+":"+n.sampler;if(this.textureCache[l])return this.textureCache[l];let h=this.loadImageSource(t,r).then(function(t){t.flipY=!1,n.name&&(t.name=n.name);let r=a.samplers||{},s=r[n.sampler]||{};return t.magFilter=I[s.magFilter]||i.LinearFilter,t.minFilter=I[s.minFilter]||i.LinearMipmapLinearFilter,t.wrapS=R[s.wrapS]||i.RepeatWrapping,t.wrapT=R[s.wrapT]||i.RepeatWrapping,o.associations.set(t,{textures:e}),t}).catch(function(){return null});return this.textureCache[l]=h,h}loadImageSource(e,t){let r=this,o=this.json,a=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());let n=o.images[e],s=self.URL||self.webkitURL,l=n.uri||"",h=!1;if(void 0!==n.bufferView)l=r.getDependency("bufferView",n.bufferView).then(function(e){h=!0;let t=new Blob([e],{type:n.mimeType});return l=s.createObjectURL(t)});else if(void 0===n.uri)throw Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");let c=Promise.resolve(l).then(function(e){return new Promise(function(r,o){let n=r;!0===t.isImageBitmapLoader&&(n=function(e){let t=new i.Texture(e);t.needsUpdate=!0,r(t)}),t.load((0,i.LoaderUtils).resolveURL(e,a.path),n,void 0,o)})}).then(function(e){return!0===h&&s.revokeObjectURL(l),e.userData.mimeType=n.mimeType||X(n.uri),e}).catch(function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),e});return this.sourceCache[e]=c,c}assignTexture(e,t,i,r){let o=this;return this.getDependency("texture",i.index).then(function(n){if(void 0===i.texCoord||0==i.texCoord||"aoMap"===t&&1==i.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+t+" not yet supported."),o.extensions[a.KHR_TEXTURE_TRANSFORM]){let e=void 0!==i.extensions?i.extensions[a.KHR_TEXTURE_TRANSFORM]:void 0;if(e){let t=o.associations.get(n);n=o.extensions[a.KHR_TEXTURE_TRANSFORM].extendTexture(n,e),o.associations.set(n,t)}}return void 0!==r&&(n.encoding=r),e[t]=n,n})}assignFinalMaterial(e){let t=e.geometry,r=e.material,o=void 0===t.attributes.tangent,a=void 0!==t.attributes.color,n=void 0===t.attributes.normal;if(e.isPoints){let e="PointsMaterial:"+r.uuid,t=this.cache.get(e);t||(t=new i.PointsMaterial,(0,i.Material).prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,t.sizeAttenuation=!1,this.cache.add(e,t)),r=t}else if(e.isLine){let e="LineBasicMaterial:"+r.uuid,t=this.cache.get(e);t||(t=new i.LineBasicMaterial,(0,i.Material).prototype.copy.call(t,r),t.color.copy(r.color),this.cache.add(e,t)),r=t}if(o||a||n){let e="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),o&&(e+="derivative-tangents:"),a&&(e+="vertex-colors:"),n&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=r.clone(),a&&(t.vertexColors=!0),n&&(t.flatShading=!0),o&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(r))),r=t}r.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=r}getMaterialType(){return i.MeshStandardMaterial}loadMaterial(e){let t;let r=this,o=this.json,n=this.extensions,s=o.materials[e],l={},h=s.extensions||{},c=[];if(h[a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){let e=n[a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=e.getMaterialType(),c.push(e.extendParams(l,s,r))}else if(h[a.KHR_MATERIALS_UNLIT]){let e=n[a.KHR_MATERIALS_UNLIT];t=e.getMaterialType(),c.push(e.extendParams(l,s,r))}else{let o=s.pbrMetallicRoughness||{};if(l.color=new i.Color(1,1,1),l.opacity=1,Array.isArray(o.baseColorFactor)){let e=o.baseColorFactor;l.color.fromArray(e),l.opacity=e[3]}void 0!==o.baseColorTexture&&c.push(r.assignTexture(l,"map",o.baseColorTexture,i.sRGBEncoding)),l.metalness=void 0!==o.metallicFactor?o.metallicFactor:1,l.roughness=void 0!==o.roughnessFactor?o.roughnessFactor:1,void 0!==o.metallicRoughnessTexture&&(c.push(r.assignTexture(l,"metalnessMap",o.metallicRoughnessTexture)),c.push(r.assignTexture(l,"roughnessMap",o.metallicRoughnessTexture))),t=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,l)})))}!0===s.doubleSided&&(l.side=i.DoubleSide);let d=s.alphaMode||z.OPAQUE;if(d===z.BLEND?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,d===z.MASK&&(l.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&t!==i.MeshBasicMaterial&&(c.push(r.assignTexture(l,"normalMap",s.normalTexture)),l.normalScale=new i.Vector2(1,1),void 0!==s.normalTexture.scale)){let e=s.normalTexture.scale;l.normalScale.set(e,e)}return void 0!==s.occlusionTexture&&t!==i.MeshBasicMaterial&&(c.push(r.assignTexture(l,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(l.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&t!==i.MeshBasicMaterial&&(l.emissive=new(0,i.Color)().fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&t!==i.MeshBasicMaterial&&c.push(r.assignTexture(l,"emissiveMap",s.emissiveTexture,i.sRGBEncoding)),Promise.all(c).then(function(){let i;return i=t===D?n[a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(l):new t(l),s.name&&(i.name=s.name),j(i,s),r.associations.set(i,{materials:e}),s.extensions&&H(n,i,s),i})}createUniqueName(e){let t=(0,i.PropertyBinding).sanitizeNodeName(e||""),r=t;for(let e=1;this.nodeNamesUsed[r];++e)r=t+"_"+e;return this.nodeNamesUsed[r]=!0,r}loadGeometries(e){let t=this,r=this.extensions,o=this.primitiveCache;function n(e){return r[a.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(i){return K(i,e,t)})}let s=[];for(let r=0,l=e.length;r<l;r++){let l=e[r],h=N(l),c=o[h];if(c)s.push(c.promise);else{let e;e=l.extensions&&l.extensions[a.KHR_DRACO_MESH_COMPRESSION]?n(l):K(new i.BufferGeometry,l,t),o[h]={primitive:l,promise:e},s.push(e)}}return Promise.all(s)}loadMesh(e){let t=this,r=this.json,o=this.extensions,a=r.meshes[e],n=a.primitives,s=[];for(let e=0,t=n.length;e<t;e++){let t=void 0===n[e].material?G(this.cache):this.getDependency("material",n[e].material);s.push(t)}return s.push(t.loadGeometries(n)),Promise.all(s).then(function(r){let s=r.slice(0,r.length-1),l=r[r.length-1],h=[];for(let r=0,c=l.length;r<c;r++){let c;let d=l[r],p=n[r],u=s[r];if(p.mode===L.TRIANGLES||p.mode===L.TRIANGLE_STRIP||p.mode===L.TRIANGLE_FAN||void 0===p.mode)!0!==(c=!0===a.isSkinnedMesh?new i.SkinnedMesh(d,u):new i.Mesh(d,u)).isSkinnedMesh||c.geometry.attributes.skinWeight.normalized||c.normalizeSkinWeights(),p.mode===L.TRIANGLE_STRIP?c.geometry=ee(c.geometry,i.TriangleStripDrawMode):p.mode===L.TRIANGLE_FAN&&(c.geometry=ee(c.geometry,i.TriangleFanDrawMode));else if(p.mode===L.LINES)c=new i.LineSegments(d,u);else if(p.mode===L.LINE_STRIP)c=new i.Line(d,u);else if(p.mode===L.LINE_LOOP)c=new i.LineLoop(d,u);else if(p.mode===L.POINTS)c=new i.Points(d,u);else throw Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);Object.keys(c.geometry.morphAttributes).length>0&&U(c,a),c.name=t.createUniqueName(a.name||"mesh_"+e),j(c,a),p.extensions&&H(o,c,p),t.assignFinalMaterial(c),h.push(c)}for(let i=0,r=h.length;i<r;i++)t.associations.set(h[i],{meshes:e,primitives:i});if(1===h.length)return h[0];let c=new i.Group;t.associations.set(c,{meshes:e});for(let e=0,t=h.length;e<t;e++)c.add(h[e]);return c})}loadCamera(e){let t;let r=this.json.cameras[e],o=r[r.type];if(!o){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return"perspective"===r.type?t=new i.PerspectiveCamera((0,i.MathUtils).radToDeg(o.yfov),o.aspectRatio||1,o.znear||1,o.zfar||2e6):"orthographic"===r.type&&(t=new i.OrthographicCamera(-o.xmag,o.xmag,o.ymag,-o.ymag,o.znear,o.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),j(t,r),Promise.resolve(t)}loadSkin(e){let t=this.json.skins[e],i={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(i):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return i.inverseBindMatrices=e,i})}loadAnimation(e){let t=this.json,r=t.animations[e],o=[],a=[],n=[],s=[],l=[];for(let e=0,t=r.channels.length;e<t;e++){let t=r.channels[e],i=r.samplers[t.sampler],h=t.target,c=h.node,d=void 0!==r.parameters?r.parameters[i.input]:i.input,p=void 0!==r.parameters?r.parameters[i.output]:i.output;o.push(this.getDependency("node",c)),a.push(this.getDependency("accessor",d)),n.push(this.getDependency("accessor",p)),s.push(i),l.push(h)}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(n),Promise.all(s),Promise.all(l)]).then(function(t){let o=t[0],a=t[1],n=t[2],s=t[3],l=t[4],h=[];for(let e=0,t=o.length;e<t;e++){let t;let r=o[e],c=a[e],d=n[e],p=s[e],u=l[e];if(void 0===r)continue;switch(r.updateMatrix(),O[u.path]){case O.weights:t=i.NumberKeyframeTrack;break;case O.rotation:t=i.QuaternionKeyframeTrack;break;case O.position:case O.scale:default:t=i.VectorKeyframeTrack}let m=r.name?r.name:r.uuid,g=void 0!==p.interpolation?F[p.interpolation]:i.InterpolateLinear,f=[];O[u.path]===O.weights?r.traverse(function(e){e.morphTargetInfluences&&f.push(e.name?e.name:e.uuid)}):f.push(m);let w=d.array;if(d.normalized){let e=Y(w.constructor),t=new Float32Array(w.length);for(let i=0,r=w.length;i<r;i++)t[i]=w[i]*e;w=t}for(let e=0,r=f.length;e<r;e++){let r=new t(f[e]+"."+O[u.path],c.array,w,g);"CUBICSPLINE"===p.interpolation&&(r.createInterpolant=function(e){let t=this instanceof i.QuaternionKeyframeTrack?A:k;return new t(this.times,this.values,this.getValueSize()/3,e)},r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),h.push(r)}}let c=r.name?r.name:"animation_"+e;return new i.AnimationClip(c,void 0,h)})}createNodeMesh(e){let t=this.json,i=this,r=t.nodes[e];return void 0===r.mesh?null:i.getDependency("mesh",r.mesh).then(function(e){let t=i._getNodeRef(i.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,i=r.weights.length;t<i;t++)e.morphTargetInfluences[t]=r.weights[t]}),t})}loadNode(e){let t=this.json,r=this.extensions,o=this,a=t.nodes[e],n=a.name?o.createUniqueName(a.name):"";return(function(){let t=[],i=o._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return i&&t.push(i),void 0!==a.camera&&t.push(o.getDependency("camera",a.camera).then(function(e){return o._getNodeRef(o.cameraCache,a.camera,e)})),o._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){t.push(e)}),Promise.all(t)})().then(function(t){let s;if((s=!0===a.isBone?new i.Bone:t.length>1?new i.Group:1===t.length?t[0]:new i.Object3D)!==t[0])for(let e=0,i=t.length;e<i;e++)s.add(t[e]);if(a.name&&(s.userData.name=a.name,s.name=n),j(s,a),a.extensions&&H(r,s,a),void 0!==a.matrix){let e=new i.Matrix4;e.fromArray(a.matrix),s.applyMatrix4(e)}else void 0!==a.translation&&s.position.fromArray(a.translation),void 0!==a.rotation&&s.quaternion.fromArray(a.rotation),void 0!==a.scale&&s.scale.fromArray(a.scale);return o.associations.has(s)||o.associations.set(s,{}),o.associations.get(s).nodes=e,s})}loadScene(e){let t=this.json,r=this.extensions,o=this.json.scenes[e],a=this,n=new i.Group;o.name&&(n.name=a.createUniqueName(o.name)),j(n,o),o.extensions&&H(r,n,o);let s=o.nodes||[],l=[];for(let e=0,i=s.length;e<i;e++)l.push(Q(s[e],n,t,a));return Promise.all(l).then(function(){let e=e=>{let t=new Map;for(let[e,r]of a.associations)(e instanceof i.Material||e instanceof i.Texture)&&t.set(e,r);return e.traverse(e=>{let i=a.associations.get(e);null!=i&&t.set(e,i)}),t};return a.associations=e(n),n})}}function Q(e,t,r,o){let a=r.nodes[e];return o.getDependency("node",e).then(function(e){let t;return void 0===a.skin?e:o.getDependency("skin",a.skin).then(function(e){t=e;let i=[];for(let e=0,r=t.joints.length;e<r;e++)i.push(o.getDependency("node",t.joints[e]));return Promise.all(i)}).then(function(r){return e.traverse(function(e){if(!e.isMesh)return;let o=[],a=[];for(let e=0,n=r.length;e<n;e++){let n=r[e];if(n){o.push(n);let r=new i.Matrix4;void 0!==t.inverseBindMatrices&&r.fromArray(t.inverseBindMatrices.array,16*e),a.push(r)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}e.bind(new i.Skeleton(o,a),e.matrixWorld)}),e})}).then(function(e){t.add(e);let i=[];if(a.children){let t=a.children;for(let a=0,n=t.length;a<n;a++){let n=t[a];i.push(Q(n,e,r,o))}}return Promise.all(i)})}function Z(e,t,r){let o=t.attributes,a=new i.Box3;if(void 0===o.POSITION)return;{let e=r.json.accessors[o.POSITION],t=e.min,n=e.max;if(void 0!==t&&void 0!==n){if(a.set(new i.Vector3(t[0],t[1],t[2]),new i.Vector3(n[0],n[1],n[2])),e.normalized){let t=Y(W[e.componentType]);a.min.multiplyScalar(t),a.max.multiplyScalar(t)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}let n=t.targets;if(void 0!==n){let e=new i.Vector3,t=new i.Vector3;for(let i=0,o=n.length;i<o;i++){let o=n[i];if(void 0!==o.POSITION){let i=r.json.accessors[o.POSITION],a=i.min,n=i.max;if(void 0!==a&&void 0!==n){if(t.setX(Math.max(Math.abs(a[0]),Math.abs(n[0]))),t.setY(Math.max(Math.abs(a[1]),Math.abs(n[1]))),t.setZ(Math.max(Math.abs(a[2]),Math.abs(n[2]))),i.normalized){let e=Y(W[i.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}a.expandByVector(e)}e.boundingBox=a;let s=new i.Sphere;a.getCenter(s.center),s.radius=a.min.distanceTo(a.max)/2,e.boundingSphere=s}function K(e,t,i){let r=t.attributes,o=[];function a(t,r){return i.getDependency("accessor",t).then(function(t){e.setAttribute(r,t)})}for(let t in r){let i=E[t]||t.toLowerCase();i in e.attributes||o.push(a(r[t],i))}if(void 0!==t.indices&&!e.index){let r=i.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});o.push(r)}return j(e,t),Z(e,t,i),Promise.all(o).then(function(){return void 0!==t.targets?_(e,t.targets,i):e})}function ee(e,t){let r=e.getIndex();if(null===r){let t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),r=e.getIndex()}let o=r.count-2,a=[];if(t===i.TriangleFanDrawMode)for(let e=1;e<=o;e++)a.push(r.getX(0)),a.push(r.getX(e)),a.push(r.getX(e+1));else for(let e=0;e<o;e++)e%2==0?(a.push(r.getX(e)),a.push(r.getX(e+1)),a.push(r.getX(e+2))):(a.push(r.getX(e+2)),a.push(r.getX(e+1)),a.push(r.getX(e)));a.length/3!==o&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let n=e.clone();return n.setIndex(a),n}}),parcelRequire.register("9QhXH",function(e,t){$parcel$export(e.exports,"DM",()=>M);var i=parcelRequire("4xklQ"),r=parcelRequire("ia4Lh"),o=parcelRequire("7WCxl"),a=parcelRequire("g4HAh"),n=parcelRequire("5XTH3"),s=parcelRequire("9HO6e"),l=parcelRequire("jizqJ"),h=parcelRequire("9f3nc"),c=parcelRequire("5HP0C"),d=parcelRequire("kHWob"),p=parcelRequire("xl6VI"),u=parcelRequire("gMe2U"),m=parcelRequire("lUO0N"),g=parcelRequire("arwMC"),f=parcelRequire("8C2VU"),w=parcelRequire("1Wv1c"),y=parcelRequire("eZ4ri"),b=parcelRequire("bWffP"),x=parcelRequire("lDEcB"),P=parcelRequire("kKNer"),v=parcelRequire("iDVm9");parcelRequire("hrM0U");class M{static thickness=240;static lineRenderOrder=100;static shapeRenderOrder=90;static componentZ=10;static cornerWindowWidth=500;static doubleSlidingDoorLimit=2e3;static tripleSlidingDoorLimit=2500;static tool=new n.DrawWallTool;static addDoorParam(e,t,r,o,a,n,s,l,h=""){e.updateMatrixWorld(),e.doorWid=t,e.wallDep=r,""!=o&&(e.wallStartPoint=o),""!=a&&(e.wallEndPoint=a),e.center=n,e.startPoint=e.localToWorld(new i.Vector3(-t/2,0,0)),e.endPoint=e.localToWorld(new i.Vector3(t/2,0,0)),e.angle=s,e.modelType=l,e.doorDir=h,e.height=2100,e.floorHei=500,(l.includes("Door")||l.includes("door"))&&(e.height=2300,e.floorHei=0),"frenchwindows"==l&&(e.floorHei=0),"leftSide"==h&&(e.scale.x=-1),"inside"==h&&(e.scale.y=-1),"rightSide"==h&&(e.scale.x=-1,e.scale.y=-1)}static addMemberParam(e,t,i,r,o,a,n){e.angle=t,i&&(e.width=i),e.height=r,e.depth=o,e.center=a,e.modelType=n}static createScaleTool(e,t){let r=240,o=e.clone().distanceTo(t.clone()),a=(0,s.UtilCore).getPointsCenter(e,t),n=new i.Group,l=new i.Vector2(-o/2,-r/2),h=new i.Vector2(-o/2,r/2),c=new i.Vector2(o/2,r/2),d=new i.Vector2(o/2,-r/2),p=this.createShapeByPointArr([l,h,c,d],"mesh","rgb(57,110,254)");p.useType="scaleHelpTool";let u=50,m=0;for(let e=0;e<parseInt(o/u);e++){m+=u;let t=new i.Vector2(-o/2+m,r/2-20),a=new i.Vector2(-o/2+m,0);(e+1)%5==0&&(a.y=-r/4);let s=this.createLine([t,a],16777215);s.useType="scaleHelpTool",n.add(s)}l.y=-r,h.y=r,c.y=r,d.y=-r;let g=this.createLine([l,h],"rgb(57,110,254)"),f=this.createLine([c,d],"rgb(57,110,254)");g.useType="scaleHelpTool",f.useType="scaleHelpTool",n.position.set(a.x,a.y,this.componentZ),n.add(p,g,f);let w=new i.Vector2(t.x,t.y).sub(new i.Vector2(e.x,e.y)).angle();return n.rotation.z=w,n}static createBaseDoor(e,t,r="outside",o=0,a=this.thickness,n="",s=""){let l=new i.Group,h=new i.Vector2(-t/2,-a/2),c=new i.Vector2(-t/2,a/2),d=new i.Vector2(t/2,a/2),p=new i.Vector2(t/2,-a/2),u=this.createShapeByPointArr([h,c,d,p]),m=new i.Vector2(a/2-t/2,a/2),g=new i.Vector2(-t/2,0),f=new i.Vector2(-t/2,g.y+t),w=new i.Vector2(f.x+a/2,f.y),y=new i.Vector2(w.x,g.y),b=this.createShapeByPointArr([c,f,w,m]),x=this.createLine([h,f,w,y,g]),P=this.createLine([d,p]),v=this.createArc(m,t-a/2,0,Math.PI/2,14145753),C=this.createArc(m,t-a/2,0,Math.PI/2,16777215,!0);C.push(m);let D=this.createShapeByPointArr(C,"mesh",16185336);return l.add(u,b,x,P,v,D),"inside"==r&&(l.scale.y=-1),l.rotation.z=o,l.position.set(e.x,e.y,this.componentZ),M.addDoorParam(l,t,a,n,s,e,o,"door",r),l.modelPath=url+"/assets/model/door/baseDoor/baseDoor.glb",l}static createSectorDoor(e,t,r=0,o=this.thickness,a="",n="",s=""){let l=new i.Group,h=new i.Vector2(-t/2,-o/2),c=new i.Vector2(-t/2,o/2),d=new i.Vector2(t/2,o/2),p=new i.Vector2(t/2,-o/2),u=c.clone().add(d).divideScalar(2),m=c.distanceTo(d)/2;s||(s=m);let g=c.clone().sub(u).angle(),f=d.clone().sub(u).angle(),w=this.createArc(u,m,f,g,16777215,!0),y=this.createShapeByPointArr([...w,h,p]),b=this.createLine([p,...w,h]);return l.add(y,b),l.rotation.z=r,l.position.set(e.x,e.y,this.componentZ),M.addDoorParam(l,t,o,a,n,e,r,"archDoor"),l.modelPath=url+"/assets/model/door/sectorDoor/sectorDoor.glb",l.arcHei=s,l}static createSectorWindow(e,t,r=0,o=this.thickness,a="",n=""){let s=new i.Group,l=new i.Vector2(-t/2,-o/2),h=new i.Vector2(-t/2,o/2),c=new i.Vector2(t/2,o/2),d=new i.Vector2(t/2,-o/2),p=l.clone().add(d).divideScalar(2),u=h.clone().add(c).divideScalar(2),m=h.distanceTo(c)/2,g=h.clone().sub(u).angle(),f=c.clone().sub(u).angle(),w=this.createArc(u,m,f,g,16777215,!0),y=this.createShapeByPointArr([...w,l,d]),b=this.createLine([d,...w,l]),x=this.createLine([c,h]),P=this.createLine([u,p]);return s.add(y,b,x,P),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),M.addDoorParam(s,t,o,a,n,e,r,"archWindow"),s.modelPath=url+"/assets/model/window/sectorWindow/sectorWindow.glb",s}static createDODoor(e,t,r=0,o=this.thickness,a="",n="",s="outside"){let l=new i.Group,h=new i.Vector2(-t/2,-o/2),c=new i.Vector2(-t/2,o/2),d=new i.Vector2(t/2,o/2),p=new i.Vector2(t/2,-o/2),u=this.createShapeByPointArr([c,d,p,h]),m=new i.Vector2(-t/2,0),g=new i.Vector2(m.x,m.y+t/2),f=new i.Vector2(g.x+o/2,g.y),w=new i.Vector2(f.x,f.y-t/2),y=new i.Vector2(w.x,w.y+o/2),b=this.createArc(y,(t-o)/2,0,Math.PI/2,14145753),x=this.createShapeByPointArr([g,f,w,m]),P=this.createLine([h,g,f,w,m]),v=new i.Vector2(-m.x,m.y),C=new i.Vector2(-g.x,g.y),D=new i.Vector2(-f.x,f.y),T=new i.Vector2(-w.x,w.y),S=new i.Vector2(-y.x,y.y),k=this.createArc(S,(t-o)/2,Math.PI/2,Math.PI,14145753),V=this.createShapeByPointArr([C,D,T,v]),A=this.createLine([p,C,D,T,v]);return l.add(u,x,P,V,A,b,k),l.rotation.z=r,l.position.set(e.x,e.y,this.componentZ),M.addDoorParam(l,t,o,a,n,e,r,"doubledoor",s),l.modelPath=url+"/assets/model/door/doubleOpenDoor/doubleOpenDoor.glb",l}static createLashDoor(e,t=1450,r=0,o=this.thickness,a="",n="",s="outside"){let l=new i.Group,h=new i.Vector2(-t/2,-o/2),c=new i.Vector2(-t/2,o/2),d=new i.Vector2(t/2,o/2),p=new i.Vector2(t/2,-o/2),u=this.createShapeByPointArr([h,c,d,p]),m=this.createLine([h,c,d,p,h]),g=new i.Vector2(-t/2,-o/6),f=new i.Vector2(-t/2,o/6),w=new i.Vector2(t/2,o/6),y=new i.Vector2(t/2,-o/6),b=new i.Vector2(t/4,o/6),x=new i.Vector2(t/4,-o/6),P=this.createLine([g,y]),v=this.createLine([f,w]),C=this.createLine([b,x]);return l.add(u,m,P,v,C),l.rotation.z=r,l.position.set(e.x,e.y,this.componentZ),M.addDoorParam(l,t,o,a,n,e,r,"childMotherDoor",s),l.modelPath=url+"/assets/model/door/lashDoor/lashDoor.glb",l}static createSlidingDoor(e,t,r=0,o=this.thickness,a="",n="",s="outside"){let l=new i.Group,h=10,c=new i.Vector2(-t/2,-o/2),d=new i.Vector2(-t/2,o/2),p=new i.Vector2(t/2,o/2),u=new i.Vector2(t/2,-o/2),m=this.createShapeByPointArr([d,p,u,c]),g=this.createLine([c,d,p,u,c]);if(t<=this.doubleSlidingDoorLimit){let e=2*t/3,r=new i.Vector2(h-t/2,0),a=new i.Vector2(r.x,r.y+o/4),n=new i.Vector2(a.x+e,a.y),s=new i.Vector2(n.x,n.y-o/4),c=this.createLine([r,a,n,s,r]),d=new i.Vector2(-r.x,-r.y),p=new i.Vector2(-a.x,-a.y),u=new i.Vector2(-n.x,-n.y),m=new i.Vector2(-s.x,-s.y),g=this.createLine([d,p,u,m,d]);l.add(c,g)}else if(t<=this.tripleSlidingDoorLimit){let e=2*t/5,r=new i.Vector2(h-t/2,-o/4),a=new i.Vector2(r.x,r.y+o/4),n=new i.Vector2(a.x+e,a.y),s=new i.Vector2(n.x,n.y-o/4),c=this.createLine([r,a,n,s,r]),d=new i.Vector2(-s.x,s.y),p=new i.Vector2(-n.x,n.y),u=new i.Vector2(-a.x,a.y),m=new i.Vector2(-r.x,r.y),g=this.createLine([d,p,u,m,d]),f=new i.Vector2(-e/2,0),w=new i.Vector2(f.x,f.y+o/4),y=new i.Vector2(w.x+e,w.y),b=new i.Vector2(y.x,y.y-o/4),x=this.createLine([f,w,y,b,f]);l.add(c,g,x)}else{let e=t/4,r=new i.Vector2(h-t/2,o/4),a=new i.Vector2(r.x,r.y-o/4),n=new i.Vector2(a.x+e,a.y),s=new i.Vector2(n.x,n.y+o/4),c=this.createLine([r,a,n,s,r]),d=new i.Vector2(n.x-e/4,n.y),p=new i.Vector2(d.x,d.y-o/4),u=new i.Vector2(p.x+e,p.y),m=new i.Vector2(u.x,u.y+o/4),g=this.createLine([d,p,u,m,d]),f=new i.Vector2(-r.x,r.y),w=new i.Vector2(-a.x,a.y),y=new i.Vector2(-n.x,n.y),b=new i.Vector2(-s.x,s.y),x=this.createLine([f,w,y,b,f]),P=new i.Vector2(-d.x,d.y),v=new i.Vector2(-p.x,p.y),M=new i.Vector2(-u.x,u.y),C=new i.Vector2(-m.x,m.y),D=this.createLine([P,v,M,C,P]);l.add(c,g,x,D)}return l.add(m,g),l.rotation.z=r,l.position.set(e.x,e.y,this.componentZ),M.addDoorParam(l,t,o,a,n,e,r,"slidingdoor",s),l.modelPath=url+"/assets/model/door/slidingDoor/slidingDoor.glb",l}static createPass(e,t,r=0,o=this.thickness,a="",n="",s="outside"){let l=new i.Group,h=new i.Vector2(-t/2,o/2),c=new i.Vector2(t/2,o/2),d=new i.Vector2(t/2,o/6),p=new i.Vector2(-t/2,o/6),u=new i.Vector2(-t/2,-o/6),m=new i.Vector2(t/2,-o/6),g=new i.Vector2(t/2,-o/2),f=new i.Vector2(-t/2,-o/2),w=this.createShapeByPointArr([h,c,g,f]),y=this.createLine([h,c,d,p,h]),b=this.createLine([u,m,g,f,u]);return l.add(w,y,b),l.rotation.z=r,l.position.set(e.x,e.y,this.componentZ),M.addDoorParam(l,t,o,a,n,e,r,"passDoor",s),l.modelPath=url+"/assets/model/door/pass/pass1.glb",l}static createLWindow(e,t,r,o=1200,a=1200){let n=0,s=new i.Group,l=new i.Vector2(-t/2,-r/2-a),h=new i.Vector2(-t/2,r/2),c=new i.Vector2(h.x+t+o,r/2),d=new i.Vector2(c.x,c.y-r),p=new i.Vector2(t/2,-r/2),u=new i.Vector2(l.x+t,l.y),m=this.createShapeByPointArr([l,h,c,d,p,u]),g=this.createLine([l,h,c,d,p,u,l]),f=new i.Vector2(0,-r/2-a),w=new i.Vector2(t/2+o,0),y=this.createLine([f,new i.Vector2,w]);return s.add(m,g,y),s.rotation.z=n,s.position.set(e.x,e.y,this.componentZ),M.addDoorParam(s,o,r,0,0,e,n,"LWindow"),s}static createLWindowNew(e,t,r,o=1200,a=1200){let n,s,l,h,c,d,p,u=new i.Group,m=new x.LWindowGeometry(t,r,o,a),f=new i.Mesh(m,new i.MeshBasicMaterial({color:16777215})),w=new(0,g.DWHelper)().active(f);u.add(f,w);let y="",b="";if(t&&r){let u,m;let g=this.getCommonPoint(t,r);d=t.startPoint.x==g.x&&t.startPoint.y==g.y?(u=new i.Vector2(t.endPoint.x,t.endPoint.y)).clone().sub(t.startPoint):(u=new i.Vector2(t.startPoint.x,t.startPoint.y)).clone().sub(t.endPoint),p=r.startPoint.x==g.x&&r.startPoint.y==g.y?(m=new i.Vector2(r.endPoint.x,r.endPoint.y)).clone().sub(r.startPoint):(m=new i.Vector2(r.startPoint.x,r.startPoint.y)).clone().sub(r.endPoint),s=d.angle(),l=p.angle(),n=this.tool.computeMiter(u,g,m,t.thickness,r.thickness).angle(),h=t.thickness,c=r.thickness,y=e.clone().add(d.clone().setLength(o+r.thickness/2)),b=e.clone().add(p.clone().setLength(a+t.thickness/2))}else h=this.thickness,c=this.thickness,d=new i.Vector2(0,-1),p=new i.Vector2(1,0),n=((s=d.angle())+(l=p.angle()))/2;let P=Math.abs(c/2/Math.tan(n>l?n-l:n+2*Math.PI-l)),v=Math.abs(h/2/Math.tan(n<s?Math.PI-s+n:n-s-Math.PI)),C=e.clone().add(d.clone().setLength(o/2)),D=e.clone().add(p.clone().setLength(a/2));u.position.set(e.x,e.y,this.componentZ),u.leftWindow=[t,o,C,url+"/assets/model/window/LWindow/leftLWindow.glb",v,y],u.rightWindow=[r,a,D,url+"/assets/model/window/LWindow/rightLWindow.glb",P,b];let T=o+c,S=a+h;return M.addDoorParam(u,T,S,"","",e,"","LWindow"),u}static getCommonPoint(e,t){let r=new i.Vector2(e.startPoint.x,e.startPoint.y),o=new i.Vector2(e.endPoint.x,e.endPoint.y),a=new i.Vector2(t.startPoint.x,t.startPoint.y),n=new i.Vector2(t.endPoint.x,t.endPoint.y);return r.equals(a)||r.equals(n)?r:o.equals(a)||o.equals(n)?o:void 0}static createBaseWindow(e,t,r=0,o=this.thickness,a="",n=""){let s=new i.Group,l=new i.Vector2().add(new i.Vector2(-t/2,o/2)),h=new i.Vector2().add(new i.Vector2(-t/2,0)),c=new i.Vector2().add(new i.Vector2(-t/2,-o/2)),d=new i.Vector2().add(new i.Vector2(t/2,o/2)),p=new i.Vector2().add(new i.Vector2(t/2,0)),u=new i.Vector2().add(new i.Vector2(t/2,-o/2)),m=this.createShapeByPointArr([l,c,u,d]),g=this.createLine([h,c,u,d,l,h,p]);return s.add(m,g),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),M.addDoorParam(s,t,o,a,n,e,r,"window"),s.modelPath=url+"/assets/model/window/baseWindow/baseWindow.glb",s}static createArcBaseWindow(e,t=!1,r=this.thickness,o=Math.PI/12){let a=new i.Group,n,s,l=1500;if(e=new i.Vector2(e.x,e.y),t){let r=e.clone().sub(t);l=r.length();let a=new i.Vector2(r.x,r.y).angle();n=a-o,s=a+o}else t=new i.Vector2(e.x,e.y).add(new i.Vector2(0,-1).setLength(l)),n=5*Math.PI/12,s=7*Math.PI/12;let h=this.createArc(t,l+r/2,n,s,16777215,!0),c=this.createArc(t,l,n,s,16777215,!0),d=this.createArc(t,l-r/2,n,s,16777215,!0);h.unshift(d[0]),d.reverse().forEach(e=>{h.push(e)});let p=this.createLine(h),u=this.createLine(c);h.shift();let m=this.createShapeByPointArr(h);return m.geometry.computeBoundingBox(),a.add(p,u,m),M.addDoorParam(a,1e3,r,c[0],c[c.length-1],e,o,"arcWindow"),a.startPoint=c[0],a.endPoint=c[c.length-1],a.arcCenter=t,a.position.z=this.componentZ,a.modelPath=url+"/assets/model/window/05/arcWindow.glb",a}static createLWaveWindow(e,t,r,o,a,n=0,s=500,l=500){let h=new i.Group,c=new i.Vector2(o/2,a/2-r),d=new i.Vector2(c.x-o-s,c.y),p=new i.Vector2(d.x,d.y+r+l),u=new i.Vector2(p.x+s+t,p.y),m=new i.Vector2(u.x,u.y-l-a),g=new i.Vector2(o/2,-a/2),f=this.createShapeByPointArr([c,d,p,u,m,g],"mesh",13421772),w=this.createLine([c,d,p,u,m,g,c]),y=new i.Vector2(-o/2,a/2-r-this.thickness/2),b=new i.Vector2(y.x-s-this.thickness/2,y.y),x=new i.Vector2(b.x,b.y+this.thickness+r+l),P=new i.Vector2(x.x+this.thickness+t+s,x.y),v=new i.Vector2(P.x,P.y-this.thickness/2-l),M=new i.Vector2(c.x-o,c.y),C=new i.Vector2(m.x,m.y+a),D=[M,y,b,x,P,v,C,u,p,d],T=this.createShapeByPointArr(D),S=this.createLine([M,y,b,x,P,v,C]),k=new i.Vector2(M.x,M.y-this.thickness/4),V=new i.Vector2(k.x-s-this.thickness/4,k.y),A=new i.Vector2(V.x,V.y+this.thickness/2+r+l),L=new i.Vector2(A.x+this.thickness/2+t+s,A.y),W=new i.Vector2(L.x,L.y-this.thickness/4-l),I=this.createLine([k,V,A,L,W]);return h.add(f,w,T,S,I),h.rotation.z=n,h.position.set(e.x,e.y,this.componentZ),h}static createUWindow(e,t,r,o,a=1200,n=1200){let l=new i.Group,h=240,c=240,d=240,p=0,u=2500,m="",g="";if(t&&r&&o){let e,i;h=t.thickness,c=r.thickness,d=o.thickness,u=r.startPoint.distanceTo(r.endPoint)-h/2-d/2;let l=r.startPoint,f=r.endPoint,w=t.startPoint,y=t.endPoint,b=o.startPoint,x=o.endPoint;l.equals(w)||l.equals(y)?e=l:(f.equals(w)||f.equals(y))&&(e=f),l.equals(b)||l.equals(x)?i=l:(f.equals(b)||f.equals(x))&&(i=f);let P=(0,s.UtilCore).getMeshOtherPoint(t,e),v=(0,s.UtilCore).getMeshOtherPoint(o,i);m=e.clone().add(P.clone().sub(e).setLength(a+c/2)),g=i.clone().add(v.clone().sub(i).setLength(n+c/2)),e&&i&&(p=i.clone().sub(e).angle())}let f=new i.Vector2(-u/2,-a-c/2),w=new i.Vector2(f.x-h,f.y),y=new i.Vector2(w.x,w.y+a+c),b=new i.Vector2(y.x+h+u+d,y.y),x=new i.Vector2(b.x,b.y-c-n),P=new i.Vector2(x.x-d,x.y),v=new i.Vector2(P.x,P.y+n),C=new i.Vector2(v.x-u,v.y),D=this.createShapeByPointArr([f,w,y,b,x,P,v,C]),T=this.createLine([f,w,y,b,x,P,v,C,f]),S=new i.Vector2(f.x-h/2,f.y),k=new i.Vector2(S.x,0),V=new i.Vector2(u/2+d/2,k.y),A=new i.Vector2(V.x,V.y-c/2-n),L=this.createLine([S,k,V,A]);l.add(D,T,L),l.rotation.z=p,l.position.set(e.x,e.y,this.componentZ),l.leftWindow=[t,a,m],l.rightWindow=[o,n,g];let W=a+c;return n>a&&(W=n+c),M.addDoorParam(l,u+h+d,W,"","",e,p,"UWindow"),l.modelPath=url+"/assets/model/window/uWindow/uWindow.glb",l}static createUWindowOld(e,t,r,o,a,n=0,s=1200,l=1200){let h=new i.Group,c=new i.Vector2(-a/2,-s-r/2),d=new i.Vector2(c.x-t,c.y),p=new i.Vector2(d.x,d.y+s+r),u=new i.Vector2(p.x+t+a+o,p.y),m=new i.Vector2(u.x,u.y-r-l),g=new i.Vector2(m.x-o,m.y),f=new i.Vector2(g.x,g.y+l),w=new i.Vector2(f.x-a,f.y),y=this.createShapeByPointArr([c,d,p,u,m,g,f,w]),b=this.createLine([c,d,p,u,m,g,f,w,c]),x=new i.Vector2(c.x-t/2,c.y),P=new i.Vector2(x.x,0),v=new i.Vector2(a/2+o/2,P.y),C=new i.Vector2(v.x,v.y-r/2-l),D=this.createLine([x,P,v,C]);return h.add(y,b,D),h.rotation.z=n,h.position.set(e.x,e.y,this.componentZ),M.addDoorParam(h,a+t+o,r,"","",e,n,"UWindow"),h.modelPath=url+"/assets/model/window/uWindow/uWindow.glb",h}static createUWaveWindow(e,t,r,o,a,n=0,s=1e3,l=500,h=500,c=500){let d=new i.Group,p=new i.Vector2(-t/2,-o/2-s),u=new i.Vector2(p.x-r-l,p.y),m=new i.Vector2(u.x,o/2+h),g=new i.Vector2(t/2+a+c,m.y),f=new i.Vector2(g.x,p.y),w=new i.Vector2(t/2,f.y),y=new i.Vector2(w.x,-o/2),b=new i.Vector2(-t/2,y.y),x=this.createShapeByPointArr([p,u,m,g,f,w,y,b],"mesh",13421772),P=this.createLine([p,u,m,g,f,w,y,b,p]),v=new i.Vector2(-t/2-r,p.y),M=new i.Vector2(v.x,v.y-this.thickness/2),C=new i.Vector2(M.x-l-this.thickness/2,M.y),D=new i.Vector2(C.x,m.y+this.thickness/2),T=new i.Vector2(g.x+this.thickness/2,D.y),S=new i.Vector2(T.x,f.y-this.thickness/2),k=new i.Vector2(t/2+a,S.y),V=new i.Vector2(k.x,k.y+this.thickness/2),A=this.createShapeByPointArr([v,M,C,D,T,S,k,V,f,g,m,u]),L=this.createLine([v,M,C,D,T,S,k,V]),W=new i.Vector2(v.x,v.y-this.thickness/4),I=new i.Vector2(u.x-this.thickness/4,W.y),R=new i.Vector2(I.x,m.y+this.thickness/4),B=new i.Vector2(g.x+this.thickness/4,R.y),E=new i.Vector2(B.x,f.y-this.thickness/4),O=new i.Vector2(V.x,E.y),F=this.createLine([W,I,R,B,E,O]);return d.add(x,P,A,L,F),d.rotation.z=n,d.position.set(e.x,e.y,this.componentZ),d.modelPath=url+"/assets/model/window/waveWindow/waveWindow.glb",d}static createFrenchWindow(e,t,r=0,o=this.thickness,a="",n=""){let s=new i.Group,l=new i.Vector2(-t/2,-o/2),h=new i.Vector2(-t/2,o/2),c=new i.Vector2(t/2,o/2),d=new i.Vector2(t/2,-o/2),p=this.createShapeByPointArr([h,c,d,l]),u=this.createLine([l,h,c,d,l]),m=new i.Vector2(-t/2,-o/6),g=new i.Vector2(t/2,-o/6),f=new i.Vector2(-t/2,0),w=new i.Vector2(t/2,0),y=new i.Vector2(-t/2,o/6),b=new i.Vector2(t/2,o/6),x=new i.Vector2(0,o/6),P=new i.Vector2(0,-o/6),v=this.createLine([m,g]),C=this.createLine([f,w]),D=this.createLine([y,b]),T=this.createLine([x,P]);return s.add(p,u,v,C,D,T),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),M.addDoorParam(s,t,o,a,n,e,r,"frenchwindows"),s.modelPath=url+"/assets/model/window/frenchWindow/frenchWindow.glb",s}static createPanoramicWindow(e,t,r=0,o=this.thickness,a="",n=""){let s=new i.Group,l=t-o,h=new i.Vector2(-l/2,-o/2),c=new i.Vector2(h.x,h.y+this.cornerWindowWidth),d=new i.Vector2(c.x+l,c.y),p=new i.Vector2(l/2,-o/2),u=this.createShapeByPointArr([c,d,p,h],"mesh",13421772),m=this.createLine([h,c,d,p,h]),g=new i.Vector2(-l/2,o/2),f=new i.Vector2(g.x-o,g.y),w=new i.Vector2(f.x,f.y+this.cornerWindowWidth),y=new i.Vector2(w.x+t+o,w.y),b=new i.Vector2(y.x,y.y-this.cornerWindowWidth),x=new i.Vector2(b.x-o,b.y),P=new i.Vector2(g.x-o/2,g.y),v=new i.Vector2(P.x,P.y+this.cornerWindowWidth-o/2),C=new i.Vector2(v.x+l+o,v.y),D=new i.Vector2(C.x,C.y-this.cornerWindowWidth+o/2),T=this.createShapeByPointArr([f,w,y,b,x,d,c,g]),S=this.createLine([g,f,w,y,b,x]),k=this.createLine([P,v,C,D]);return s.add(u,m,T,S,k),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),M.addDoorParam(s,t,this.cornerWindowWidth+o,a,n,e,r,"straightBayWindow"),s.modelPath=url+"/assets/model/window/panoramicWindow/panoramicWindow.glb",s}static createBeam(e,t,r=0,o=400,a=400,n=!1,s=!1,l="R"){let h,c,d=new i.Group;if("beam"==t){let t=new v.BeamMesh({position:e,rotation:r,thickness:o,depth:a,wallList:n,width:s,model:l});return t.create(),M.addMemberParam(t,r,t.parameter.width,o,a,e,"beam"),t.name="bridge",t}if("pillars"==t){let t=new i.Vector2(-s/2,-o/2),n=new i.Vector2(s/2,-o/2),l=new i.Vector2(s/2,o/2),p=new i.Vector2(-s/2,o/2);c=this.createShapeByPointArr([n,l,p,t],"mesh",0),h=this.createLine([t,n,l,p,t]),d.add(c,h),d.rotation.z=r,d.position.set(e.x,e.y,this.componentZ),d.name="post",M.addMemberParam(d,r,s,o,a,e,"pillars")}return c.position.z=5,d}static getIntersect(e,t,r,o,a){let n=[],s=[],l=[],h=[],c="",d="";for(let c=0;c<o.length;c++){let d=Array.from(o[c].geometry.attributes.position.array),p=new i.Vector2(d[0],d[1]),u=new i.Vector2(d[6],d[7]),m=new i.Vector2(d[9],d[10]),g=new i.Vector2(d[15],d[16]),f=this.getAndCheck(p,m,[t,r],a),w=this.getAndCheck(u,g,[t,r],a);if(f&&w){let t=e.distanceTo(f)>e.distanceTo(w)?w:f;t.x>e.x?(n.push(t),l.push(o[c])):t.x<e.x?(s.push(t),h.push(o[c])):t.y>e.y?(n.push(t),l.push(o[c])):(s.push(t),h.push(o[c]))}}return n.length>1?n.forEach(t=>{if(""==c)c=t;else{let i=e.distanceTo(c);e.distanceTo(t)<i&&(c=t)}}):(c=n[0])&&(c.wall=l[0]),s.length>1?s.forEach(t=>{if(""==d)d=t;else{let i=e.distanceTo(d);e.distanceTo(t)<i&&(d=t)}}):(d=s[0])&&(d.wall=h[0]),[d,c]}static getAndCheck(e,t,r,o){let a=o.getLineData(e,t),n=o.computeIntersectPoint(a,r,new i.Vector2(0,0)),s=Math.min(Math.round(1e3*e.x)/1e3,Math.round(1e3*t.x)/1e3),l=Math.max(Math.round(1e3*e.x)/1e3,Math.round(1e3*t.x)/1e3),h=Math.min(Math.round(1e3*e.y)/1e3,Math.round(1e3*t.y)/1e3),c=Math.max(Math.round(1e3*e.y)/1e3,Math.round(1e3*t.y)/1e3);if(!n)return!1;{let e=n.x>=s&&n.x<=l,t=n.y>=h&&n.y<=c;return!!e&&!!t&&n}}static createFlue(e,t=650,r=650,o=0){let a=500/650,n=155/650,s=new i.Group,l=new i.Vector2(-t/2,r/2),h=new i.Vector2(t/2,r/2),c=new i.Vector2(t/2,-r/2),d=new i.Vector2(-t/2,-r/2),p=new i.Vector2(l.x+40,l.y-40),u=new i.Vector2(h.x-40,h.y-40),m=new i.Vector2(c.x-40,c.y+40),g=new i.Vector2(d.x+40,d.y+40),f=new i.Vector2(t*a-t/2,r/2-r*n),w=this.createShapeByPointArr([l,h,c,d]),y=this.createLine([l,h,c,d,l]),b=this.createLine([p,u,m,g,p,f,m]);return s.add(w,y,b),s.position.set(e.x,e.y,this.componentZ),s.rotation.z=o,M.addMemberParam(s,o,t,r,window.storeyHei,e,"flue"),s.name="flue",s}static createDoorHole(e,t,r=0,o=this.thickness,a="",n=""){let s=new i.Group,l=new i.Vector2(-t/2,o/2),h=new i.Vector2(t/2,o/2),c=new i.Vector2(t/2,-o/2),d=new i.Vector2(-t/2,-o/2),p=this.createShapeByPointArr([l,h,c,d]),u=this.createLine([l,h],0,!0),m=this.createLine([h,c]),g=this.createLine([c,d],0,!0),f=this.createLine([d,l]);return s.add(p,u,m,g,f),s.position.set(e.x,e.y,this.componentZ),s.rotation.z=r,M.addDoorParam(s,t,o,a,n,e,r,"dooropen"),s}static createLine(e,t=0,n=!1,s=1.5){let l=[];e.forEach(e=>{l.push(e.x,e.y,0)});var h=new(0,a.LineGeometry)().setPositions(l),c=new o.LineMaterial({color:t,linewidth:s,dashed:n,transparent:!0,side:i.DoubleSide});c.resolution.set(window.innerWidth,window.innerHeight);var d=new r.Line2(h,c);return d.renderOrder=this.lineRenderOrder,d.computeLineDistances(),d}static createShapeByPointArr(e,t="mesh",r=16777215){let o=new i.Shape;if(o.moveTo(e[e.length-1].x,e[e.length-1].y),e.forEach(e=>{o.lineTo(e.x,e.y)}),"shape"==t)return o;let a=new i.ShapeGeometry(o),n=new i.Mesh(a,new i.MeshBasicMaterial({color:r}));return n.renderOrder=this.shapeRenderOrder,n.position.z=-5,n}static createArc(e,t,r,o,a=0,n=!1){let s=new i.Path().arc(e.x,e.y,t,r,o,!1).getPoints();if(n)return s;let l=new i.BufferGeometry().setFromPoints(s),h=new i.Line(l,new i.LineBasicMaterial({color:a}));return h.renderOrder=this.lineRenderOrder,h}static createBaseDoorNew(e,t,r="outside",o="left",a=0,n=this.thickness,s="",h=""){let c=new i.Group,d=new l.BaseDoorGeometry(t,n,r,o),p=new i.Mesh(d,new i.MeshBasicMaterial({color:16777215})),u=new(0,g.DWHelper)().active(p);return c.add(p,u),c.rotation.z=a,c.position.set(e.x,e.y,this.componentZ),M.addDoorParam(c,t,n,s,h,e,a,"door",r),c.modelPath=url+"/assets/model/door/baseDoor/baseDoor.glb",c}static createDODoorNew(e,t,r="outside",o=0,a=this.thickness,n="",s=""){let l=new i.Group,c=new h.DoubleOpenDoorGeometry(t,a,r),d=new i.Mesh(c,new i.MeshBasicMaterial({color:16777215})),p=new(0,g.DWHelper)().active(d);return l.add(d,p),l.rotation.z=o,l.position.set(e.x,e.y,this.componentZ),M.addDoorParam(l,t,a,n,s,e,o,"doubledoor"),l.modelPath=url+"/assets/model/door/doubleOpenDoor/doubleOpenDoor.glb",l}static createSlidingDoorNew(e,t,r=0,o=this.thickness,a="",n=""){let s=new i.Group,l=new c.SlidingDoorGeometry(t,o),h=new i.Mesh(l,new i.MeshBasicMaterial({color:16777215})),d=new(0,g.DWHelper)().active(h);return s.add(h,d),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),M.addDoorParam(s,t,o,a,n,e,r,"slidingdoor"),s.modelPath=url+"/assets/model/door/slidingDoor/slidingDoor.glb",s}static createBaseWindowNew(e,t,r=0,o=this.thickness,a="",n=""){let s=new i.Group,l=new d.BaseWindowGeometry(t,o),h=new i.Mesh(l,new i.MeshPhongMaterial({color:16777215})),c=new(0,g.DWHelper)().active(h);return s.add(h,c),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),M.addDoorParam(s,t,o,a,n,e,r,"window"),s.modelPath=url+"/assets/model/window/baseWindow/baseWindow.glb",s}static createPanoramicWindowNew(e,t,r=0,o=this.thickness,a="",n=""){let s=new i.Group,l=new p.PanoramicWindowGeometry(t,o);console.log(l);let h=new i.Mesh(l,[new i.MeshBasicMaterial({color:13421772}),new i.MeshBasicMaterial({color:16777215})]),c=new(0,g.DWHelper)().active(h);return s.add(h,c),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),M.addDoorParam(s,t,o,a,n,e,r,"straightBayWindow"),s.modelPath=url+"/assets/model/window/panoramicWindow/panoramicWindow.glb",s}static createFrenchWindowNew(e,t,r=0,o=this.thickness,a="",n=""){let s=new i.Group,l=new u.FrenchWindowGeometry(t,o),h=new i.Mesh(l,new i.MeshBasicMaterial({color:16777215})),c=new(0,g.DWHelper)().active(h);return s.add(h,c),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),M.addDoorParam(s,t,o,a,n,e,r,"frenchwindows"),s.modelPath=url+"/assets/model/window/frenchWindow/frenchWindow.glb",s}static createLashDoorNew(e,t=1450,r=0,o=this.thickness,a="",n=""){let s=new i.Group,l=new m.LashDoorGeometry(t,o),h=new i.Mesh(l,new i.MeshBasicMaterial({color:16777215})),c=new(0,g.DWHelper)().active(h);return s.add(h,c),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),M.addDoorParam(s,t,o,a,n,e,r,"childMotherDoor"),s.modelPath=url+"/assets/model/door/lashDoor/lashDoor.glb",s}static createPassNew(e,t,r=0,o=this.thickness,a="",n=""){let s=new i.Group,l=new f.PassGeometry(t,o),h=new i.Mesh(l,new i.MeshBasicMaterial({color:16777215})),c=new(0,g.DWHelper)().active(h);return s.add(h,c),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),M.addDoorParam(s,t,o,a,n,e,r,"passDoor"),s.modelPath=url+"/assets/model/door/pass/pass1.glb",s}static createSectorDoorNew(e,t,r=0,o=this.thickness,a="",n=""){let s=new i.Group,l=new w.SectorDoorGeometry(t,o),h=new i.Mesh(l,new i.MeshBasicMaterial({color:16777215})),c=new(0,g.DWHelper)().active(h);return s.add(h,c),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),M.addDoorParam(s,t,o,a,n,e,r,"archDoor"),s.modelPath=url+"/assets/model/door/sectorDoor/sectorDoor.glb",s}static createSectorWindowNew(e,t,r=0,o=this.thickness,a="",n=""){let s=new i.Group,l=new y.SectorWindowGeometry(t,o),h=new i.Mesh(l,new i.MeshBasicMaterial({color:16777215})),c=new(0,g.DWHelper)().active(h);return s.add(h,c),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),M.addDoorParam(s,t,o,a,n,e,r,"archWindow"),s.modelPath=url+"/assets/model/window/sectorWindow/sectorWindow.glb",s}static createArcBaseWindowNew(e,t=!1,r=this.thickness,o=Math.PI/12){let a=new i.Group,n,s,l=1500;if(e=new i.Vector2(e.x,e.y),t){let r=e.clone().sub(t);l=r.length();let a=new i.Vector2(r.x,r.y).angle();n=a-o,s=a+o}else t=new i.Vector2(e.x,e.y).add(new i.Vector2(0,-1).setLength(l)),n=5*Math.PI/12,s=7*Math.PI/12;let h=this.createArc(t,l,n,s,16777215,!0),c=new b.ArcBaseWindowGeometry(t,l,r,n,s),d=new i.Mesh(c,new i.MeshBasicMaterial({color:16777215})),p=new(0,g.DWHelper)().active(d);return a.add(d,p),M.addDoorParam(a,1e3,r,h[0],h[h.length-1],e,o,"arcWindow"),a.startPoint=h[0],a.endPoint=h[h.length-1],a.arcCenter=t,a.position.z=this.componentZ,a.modelPath=url+"/assets/model/window/05/arcWindow.glb",a}static createUWindowNew(e,t,r,o,a=1200,n=1200){let s=new i.Group,l=240,h=240,c=240,d=0,p=2500;if(t&&r&&o){let e,i;l=t.thickness,h=r.thickness,c=o.thickness,p=r.startPoint.distanceTo(r.endPoint)-l/2-c/2;let a=r.startPoint,n=r.endPoint,s=t.startPoint,u=t.endPoint,m=o.startPoint,g=o.endPoint;a.equals(s)||a.equals(u)?e=a:(n.equals(s)||n.equals(u))&&(e=n),a.equals(m)||a.equals(g)?i=a:(n.equals(m)||n.equals(g))&&(i=n),e&&i&&(d=i.clone().sub(e).angle())}let u=new P.UWindowGeometry(p,a,n,l,h,c),m=new i.Mesh(u,new i.MeshBasicMaterial({color:16777215})),f=new(0,g.DWHelper)().active(m);return s.add(m,f),s.rotation.z=d,s.position.set(e.x,e.y,this.componentZ),s.leftWindow=[t,a],s.rightWindow=[o,n],M.addDoorParam(s,p+l+c,h,"","",e,d,"UWindow"),s.modelPath=url+"/assets/model/window/uWindow/uWindow.glb",s}static getHoleJson(e,t){let i=[];return e.forEach(e=>{let r=e.modelType;if(!r)return;let o=e.center,a=e.doorWid,n=e.wallId,l="",h=e.wallDep,c=1*e.floorHei,d=1*e.height;if(r.includes("Door")||r.includes("door"))l={location:{x:o.x,y:o.y,z:d/2+c},width:a,height:d,withSector:!1,offsetXY:0,wallID:n,windowThick:h},e.doorDir&&(l.doorDir=e.doorDir),"archDoor"==r&&(l.withSector=!0),"dooropen"==r&&(l.dir=r);else if(r.includes("Window")||r.includes("window")){if(l={location:{x:o.x,y:o.y,z:d/2+c},width:a,height:d,withSector:!1,offsetXY:0,wallID:n,windowThick:h},"UWindow"==r&&(l.windowThickL=e.leftWindow[1],l.windowThickR=e.rightWindow[1]),"waveWindow"==r&&(l.windowThick+=500),"straightBayWindow"==r&&(l.masterAngle=e.rotation.z,l.windowThick+=500),"archWindow"==r&&(l.withSector=!0),"arcWindow"==r){l.isArc=!0;let t=e.center.clone().sub(e.arcCenter.clone()).angle();l.startRadian=t-e.angle,l.endRadian=t+e.angle,l.positionZ=d/2+c}}else l={location:{x:o.x,y:o.y,z:d/2+c},width:a,height:d,withSector:!1,offsetXY:0,wallID:n,windowThick:h};if("LWindow"==r){let t=e.leftWindow,r=e.rightWindow;l.commonPoint=l.location,l.location={x:t[2].x,y:t[2].y,z:d/2+c},l.width=t[1],l.wallID=t[0].wallID,l.windowThick=t[0].thickness,l.path=t[3],l.diff=t[4];let o=JSON.parse(JSON.stringify(l));o.location={x:r[2].x,y:r[2].y,z:d/2+c},o.width=r[1],o.wallID=r[0].wallID,o.windowThick=r[0].thickness,o.path=r[3],o.diff=r[4],o.uuid=e.uuid,i.push(o)}if("UWindow"==r){let r=t.getWallByWallId(l.wallID),a=(0,s.UtilCore).getSamePointWall(r,t.allWalls),n=r.startPoint,h=(0,s.UtilCore).getMeshOtherPoint(a[1],n);((0,s.UtilCore).isSameVector(a[0].startPoint,n)||(0,s.UtilCore).isSameVector(a[0].endPoint,n))&&(h=(0,s.UtilCore).getMeshOtherPoint(a[0],n));let c=h.clone().sub(n.clone()).setLength(480);l.location.x=o.x+c.x,l.location.y=o.y+c.y;let d=JSON.parse(JSON.stringify(l));d.masterAngle=e.angle,d.width+=1,d.wallID=a[0].wallID,d.dir="UWindow";let p=JSON.parse(JSON.stringify(l));p.wallID=a[1].wallID,p.masterAngle=e.angle,p.width+=1,p.dir="UWindow",i.push(d),i.push(p)}e.modelPath&&(l.path=e.modelPath),e.arcHei&&(l.arcHei=e.arcHei),l.isLock=!!e.isLock,l.uuid=e.uuid,i.push(l)}),i}static memberJson(e){let t=[];return e.forEach(e=>{let i=e.position,r={location:{x:i.x,y:i.y,z:e.depth/2},height:Math.round(e.height*e.scale.y),depth:e.depth,rotation:e.rotation.z,angle:e.angle,type:e.modelType,id:e.id,isLock:!!e.isLock};"beam"==e.modelType&&(r.location.z=window.storeyHei-e.depth/2),"flue"==e.modelType&&(r.location.z=window.storeyHei/2),e.width&&(r.width=Math.round(e.width*e.scale.x)),t.push(r)}),t}static getWallJson(e){let t=[],r=0,o=this.getWallId(e);return 0!=o.length&&(r=Math.max(...o)),e.forEach(e=>{if((0,s.UtilCore).isSameVector(e.startPoint,e.endPoint)||"remove"==e.status)return;e.wallID||(r+=1),t.forEach(t=>{let r=(0,s.UtilCore).handleLineData(t.start,t.end);if(!(0,s.UtilCore).pointInLine(e.startPoint,r))return;let o=new i.Vector2(t.start.x,t.start.y),a=new i.Vector2(t.end.x,t.end.y),n=o.clone().distanceTo(e.startPoint.clone()),l=o.clone().distanceTo(e.endPoint.clone()),h=a.clone().distanceTo(e.startPoint.clone()),c=a.clone().distanceTo(e.endPoint.clone()),d=30;n<=30&&(e.startPoint=o.clone()),l<=d&&(e.endPoint=o.clone()),h<=d&&(e.startPoint=a.clone()),c<=d&&(e.endPoint=a.clone())});let o={start:{x:e.startPoint.x,y:e.startPoint.y,z:0},end:{x:e.endPoint.x,y:e.endPoint.y,z:0},id:e.wallID?e.wallID:r,style:e.style,line:e.line,isArc:e.isArc,thickness:e.thickness,height:e.height,offsetXY:100};e.isArc&&e.cp&&(o.cp={x:1*e.cp.x.toFixed(2),y:1*e.cp.y.toFixed(2),z:0}),t.push(o)}),t}static getModelJson(e,t=[],i=!1){return e.forEach(e=>{let r={},o=editor.getRealSize(e);if(e.imgPath){r={imgPath:e.imgPath,modelPath:e.modelPath,width:o[0]/e.scale.x,height:o[1]/e.scale.y,depth:o[2]/e.scale.z,rotation:e.rotation.y,modelPosition:e.modelPosition,location:{x:e.position.x,y:e.position.y,z:e.position.z},rotate:{x:e.rotation.x,y:e.rotation.y,z:e.rotation.z},scale:{x:e.scale.x,y:e.scale.y,z:e.scale.z},imgLayer:e.param[0].position.z},e.param[0].position.z<=-.1&&(r.imgLayer=-.1),r.isLock=!!e.isLock,t.push(r),e.sliceArr&&(r.sliceArr=e.sliceArr);return}r.child=M.getModelJson(e.children,[],i),r.modelType=e.modelType,r.location={x:e.position.x,y:e.position.y,z:e.position.z},r.isLock=!!e.isLock,r.rotation=e.rotation.y,r.rotate={x:e.rotation.x,y:e.rotation.y,z:e.rotation.z},r.scale={x:e.scale.x,y:e.scale.y,z:e.scale.z},r.width=o[0]/e.scale.x,r.height=o[1]/e.scale.y,r.depth=o[2]/e.scale.z,t.push(r)}),t}static getSplitLineJson(e){let t=[];return e.forEach(e=>{let i={start:{x:1*e.startPoint.x.toFixed(2),y:1*e.startPoint.y.toFixed(2),z:0},end:{x:1*e.endPoint.x.toFixed(2),y:1*e.endPoint.y.toFixed(2),z:0},useType:e.useType};t.push(i)}),t}static getWallId(e){let t=[];return e.forEach(e=>{e.wallID&&t.push(e.wallID)}),t}}}),parcelRequire.register("jizqJ",function(e,t){$parcel$export(e.exports,"BaseDoorGeometry",()=>o);var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class o extends i.BufferGeometry{constructor(e,t,o,a){super(),this.type="BaseDoorGeometry",this.parameters={width:e,height:t,openType:o,openDirection:a};let n=[],s=[],l=[],h=[];function c(e,t,i){return"outside"==t?"right"==i&&(e.x=-e.x):"inside"==t&&("left"==i?e.y=-e.y:"right"==i&&(e.x=-e.x,e.y=-e.y)),e}(function(e,t,r,o){let a=new i.Shape,d=new i.Vector2(e/2,t/2),p=new i.Vector2(e/2,-t/2),u=new i.Vector2(-e/2,-t/2),m=new i.Vector2(-e/2,e),g=new i.Vector2(-e/2+t/2,e),f=new i.Vector2(-e/2+t/2,t/2);[d,p,u,m,g,f].forEach(e=>{e=c(e,r,o)}),a.moveTo(f.x,f.y),[d,p,u,m,g,f].forEach(e=>{a.lineTo(e.x,e.y)});let w=new i.ShapeGeometry(a);n.push(...Array.from(w.index.array)),s.push(...Array.from(w.attributes.position.array)),l.push(...Array.from(w.attributes.normal.array)),h.push(...Array.from(w.attributes.uv.array))})(e,t,o,a),this.setIndex(n),this.setAttribute("position",new r.Float32BufferAttribute(s,3)),this.setAttribute("normal",new r.Float32BufferAttribute(l,3)),this.setAttribute("uv",new r.Float32BufferAttribute(h,2))}}}),parcelRequire.register("7UrFP",function(e,t){$parcel$export(e.exports,"Float32BufferAttribute",()=>h);var i=parcelRequire("1cnge"),r=parcelRequire("90poP"),o=parcelRequire("lYiBp"),a=parcelRequire("fpCf6");let n=new i.Vector3,s=new r.Vector2;class l{constructor(e,t,i){if(Array.isArray(e))throw TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.usage=a.StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,o=this.itemSize;r<o;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)s.fromBufferAttribute(this,t),s.applyMatrix3(e),this.setXY(t,s.x,s.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)n.fromBufferAttribute(this,t),n.applyMatrix3(e),this.setXYZ(t,n.x,n.y,n.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)n.fromBufferAttribute(this,t),n.applyMatrix4(e),this.setXYZ(t,n.x,n.y,n.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)n.fromBufferAttribute(this,t),n.applyNormalMatrix(e),this.setXYZ(t,n.x,n.y,n.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)n.fromBufferAttribute(this,t),n.transformDirection(e),this.setXYZ(t,n.x,n.y,n.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=(0,o.denormalize)(t,this.array)),t}setX(e,t){return this.normalized&&(t=(0,o.normalize)(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=(0,o.denormalize)(t,this.array)),t}setY(e,t){return this.normalized&&(t=(0,o.normalize)(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=(0,o.denormalize)(t,this.array)),t}setZ(e,t){return this.normalized&&(t=(0,o.normalize)(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=(0,o.denormalize)(t,this.array)),t}setW(e,t){return this.normalized&&(t=(0,o.normalize)(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=(0,o.normalize)(t,this.array),i=(0,o.normalize)(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=(0,o.normalize)(t,this.array),i=(0,o.normalize)(i,this.array),r=(0,o.normalize)(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,a){return e*=this.itemSize,this.normalized&&(t=(0,o.normalize)(t,this.array),i=(0,o.normalize)(i,this.array),r=(0,o.normalize)(r,this.array),a=(0,o.normalize)(a,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=a,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==a.StaticDrawUsage&&(e.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class h extends l{constructor(e,t,i){super(new Float32Array(e),t,i)}}}),parcelRequire.register("1cnge",function(e,t){$parcel$export(e.exports,"Vector3",()=>o);var i=parcelRequire("lYiBp"),r=parcelRequire("deibi");class o{constructor(e=0,t=0,i=0){o.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(n.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(n.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,i=this.y,r=this.z,o=e.elements;return this.x=o[0]*t+o[3]*i+o[6]*r,this.y=o[1]*t+o[4]*i+o[7]*r,this.z=o[2]*t+o[5]*i+o[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,o=e.elements,a=1/(o[3]*t+o[7]*i+o[11]*r+o[15]);return this.x=(o[0]*t+o[4]*i+o[8]*r+o[12])*a,this.y=(o[1]*t+o[5]*i+o[9]*r+o[13])*a,this.z=(o[2]*t+o[6]*i+o[10]*r+o[14])*a,this}applyQuaternion(e){let t=this.x,i=this.y,r=this.z,o=e.x,a=e.y,n=e.z,s=e.w,l=s*t+a*r-n*i,h=s*i+n*t-o*r,c=s*r+o*i-a*t,d=-o*t-a*i-n*r;return this.x=l*s+-(d*o)+-(h*n)- -(c*a),this.y=h*s+-(d*a)+-(c*o)- -(l*n),this.z=c*s+-(d*n)+-(l*a)- -(h*o),this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,i=this.y,r=this.z,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r,this.y=o[1]*t+o[5]*i+o[9]*r,this.z=o[2]*t+o[6]*i+o[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let i=e.x,r=e.y,o=e.z,a=t.x,n=t.y,s=t.z;return this.x=r*s-o*n,this.y=o*a-i*s,this.z=i*n-r*a,this}projectOnVector(e){let t=e.lengthSq();if(0===t)return this.set(0,0,0);let i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return a.copy(this).projectOnVector(e),this.sub(a)}reflect(e){return this.sub(a.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;let r=this.dot(e)/t;return Math.acos(i.clamp(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){let r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}let a=new o,n=new r.Quaternion}),parcelRequire.register("lYiBp",function(e,t){function i(e,t,i){return Math.max(t,Math.min(i,e))}function r(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw Error("Invalid component type.")}}function o(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw Error("Invalid component type.")}}$parcel$export(e.exports,"clamp",()=>i),$parcel$export(e.exports,"denormalize",()=>r),$parcel$export(e.exports,"normalize",()=>o)}),parcelRequire.register("deibi",function(e,t){$parcel$export(e.exports,"Quaternion",()=>r);var i=parcelRequire("lYiBp");class r{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,o,a,n){let s=i[r+0],l=i[r+1],h=i[r+2],c=i[r+3],d=o[a+0],p=o[a+1],u=o[a+2],m=o[a+3];if(0===n){e[t+0]=s,e[t+1]=l,e[t+2]=h,e[t+3]=c;return}if(1===n){e[t+0]=d,e[t+1]=p,e[t+2]=u,e[t+3]=m;return}if(c!==m||s!==d||l!==p||h!==u){let e=1-n,t=s*d+l*p+h*u+c*m,i=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){let o=Math.sqrt(r),a=Math.atan2(o,t*i);e=Math.sin(e*a)/o,n=Math.sin(n*a)/o}let o=n*i;if(s=s*e+d*o,l=l*e+p*o,h=h*e+u*o,c=c*e+m*o,e===1-n){let e=1/Math.sqrt(s*s+l*l+h*h+c*c);s*=e,l*=e,h*=e,c*=e}}e[t]=s,e[t+1]=l,e[t+2]=h,e[t+3]=c}static multiplyQuaternionsFlat(e,t,i,r,o,a){let n=i[r],s=i[r+1],l=i[r+2],h=i[r+3],c=o[a],d=o[a+1],p=o[a+2],u=o[a+3];return e[t]=n*u+h*c+s*p-l*d,e[t+1]=s*u+h*d+l*c-n*p,e[t+2]=l*u+h*p+n*d-s*c,e[t+3]=h*u-n*c-s*d-l*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){let i=e._x,r=e._y,o=e._z,a=e._order,n=Math.cos,s=Math.sin,l=n(i/2),h=n(r/2),c=n(o/2),d=s(i/2),p=s(r/2),u=s(o/2);switch(a){case"XYZ":this._x=d*h*c+l*p*u,this._y=l*p*c-d*h*u,this._z=l*h*u+d*p*c,this._w=l*h*c-d*p*u;break;case"YXZ":this._x=d*h*c+l*p*u,this._y=l*p*c-d*h*u,this._z=l*h*u-d*p*c,this._w=l*h*c+d*p*u;break;case"ZXY":this._x=d*h*c-l*p*u,this._y=l*p*c+d*h*u,this._z=l*h*u+d*p*c,this._w=l*h*c-d*p*u;break;case"ZYX":this._x=d*h*c-l*p*u,this._y=l*p*c+d*h*u,this._z=l*h*u-d*p*c,this._w=l*h*c+d*p*u;break;case"YZX":this._x=d*h*c+l*p*u,this._y=l*p*c+d*h*u,this._z=l*h*u-d*p*c,this._w=l*h*c-d*p*u;break;case"XZY":this._x=d*h*c-l*p*u,this._y=l*p*c-d*h*u,this._z=l*h*u+d*p*c,this._w=l*h*c+d*p*u;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,i=t[0],r=t[4],o=t[8],a=t[1],n=t[5],s=t[9],l=t[2],h=t[6],c=t[10],d=i+n+c;if(d>0){let e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(h-s)*e,this._y=(o-l)*e,this._z=(a-r)*e}else if(i>n&&i>c){let e=2*Math.sqrt(1+i-n-c);this._w=(h-s)/e,this._x=.25*e,this._y=(r+a)/e,this._z=(o+l)/e}else if(n>c){let e=2*Math.sqrt(1+n-i-c);this._w=(o-l)/e,this._x=(r+a)/e,this._y=.25*e,this._z=(s+h)/e}else{let e=2*Math.sqrt(1+c-i-n);this._w=(a-r)/e,this._x=(o+l)/e,this._y=(s+h)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(i.clamp(this.dot(e),-1,1)))}rotateTowards(e,t){let i=this.angleTo(e);if(0===i)return this;let r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let i=e._x,r=e._y,o=e._z,a=e._w,n=t._x,s=t._y,l=t._z,h=t._w;return this._x=i*h+a*n+r*l-o*s,this._y=r*h+a*s+o*n-i*l,this._z=o*h+a*l+i*s-r*n,this._w=a*h-i*n-r*s-o*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);let i=this._x,r=this._y,o=this._z,a=this._w,n=a*e._w+i*e._x+r*e._y+o*e._z;if(n<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,n=-n):this.copy(e),n>=1)return this._w=a,this._x=i,this._y=r,this._z=o,this;let s=1-n*n;if(s<=Number.EPSILON){let e=1-t;return this._w=e*a+t*this._w,this._x=e*i+t*this._x,this._y=e*r+t*this._y,this._z=e*o+t*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(s),h=Math.atan2(l,n),c=Math.sin((1-t)*h)/l,d=Math.sin(t*h)/l;return this._w=a*c+this._w*d,this._x=i*c+this._x*d,this._y=r*c+this._y*d,this._z=o*c+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){let e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),o=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(o),i*Math.cos(o),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}}),parcelRequire.register("90poP",function(e,t){$parcel$export(e.exports,"Vector2",()=>i);class i{constructor(e=0,t=0){i.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){let e=Math.atan2(-this.y,-this.x)+Math.PI;return e}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let i=Math.cos(t),r=Math.sin(t),o=this.x-e.x,a=this.y-e.y;return this.x=o*i-a*r+e.x,this.y=o*r+a*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}}),parcelRequire.register("fpCf6",function(e,t){$parcel$export(e.exports,"StaticDrawUsage",()=>i);let i=35044}),parcelRequire.register("9f3nc",function(e,t){$parcel$export(e.exports,"DoubleOpenDoorGeometry",()=>o);var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class o extends i.BufferGeometry{constructor(e,t,o){super(),this.type="DoubleOpenDoorGeometry",this.parameters={width:e,height:t,openType:o};let a=[],n=[],s=[],l=[];(function(e,t,r){let o=new i.Shape,h=new i.Vector2(e/2-t/2,t/2),c=new i.Vector2(e/2-t/2,e/2),d=new i.Vector2(e/2,e/2),p=new i.Vector2(e/2,-t/2),u=new i.Vector2(-h.x,h.y),m=new i.Vector2(-c.x,c.y),g=new i.Vector2(-d.x,d.y),f=new i.Vector2(-p.x,p.y);"inside"==r&&[h,c,d,p,f,g,m,u].forEach(e=>{e.y=-e.y}),o.moveTo(u.x,u.y),[h,c,d,p,f,g,m,u].forEach(e=>{o.lineTo(e.x,e.y)});let w=new i.ShapeGeometry(o);a.push(...Array.from(w.index.array)),n.push(...Array.from(w.attributes.position.array)),s.push(...Array.from(w.attributes.normal.array)),l.push(...Array.from(w.attributes.uv.array))})(e,t,o),this.setIndex(a),this.setAttribute("position",new r.Float32BufferAttribute(n,3)),this.setAttribute("normal",new r.Float32BufferAttribute(s,3)),this.setAttribute("uv",new r.Float32BufferAttribute(l,2))}}}),parcelRequire.register("5HP0C",function(e,t){$parcel$export(e.exports,"SlidingDoorGeometry",()=>r);var i=parcelRequire("lmKU8");class r extends i.RectangularGeometry{constructor(e,t){super(e,t),this.type="SlidingDoorGeometry",this.parameters={width:e,height:t}}}}),parcelRequire.register("lmKU8",function(e,t){$parcel$export(e.exports,"RectangularGeometry",()=>o);var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class o extends i.BufferGeometry{constructor(e,t){super(),this.parameters={width:e,height:t};let o=[],a=[],n=[],s=[];(function(e,t){let r=new i.Shape,l=new i.Vector2(e/2,t/2),h=new i.Vector2(e/2,-t/2),c=new i.Vector2(-e/2,-t/2),d=new i.Vector2(-e/2,t/2);r.moveTo(d.x,d.y),[l,h,c,d].forEach(e=>{r.lineTo(e.x,e.y)});let p=new i.ShapeGeometry(r);o.push(...Array.from(p.index.array)),a.push(...Array.from(p.attributes.position.array)),n.push(...Array.from(p.attributes.normal.array)),s.push(...Array.from(p.attributes.uv.array))})(e,t),this.setIndex(o),this.setAttribute("position",new r.Float32BufferAttribute(a,3)),this.setAttribute("normal",new r.Float32BufferAttribute(n,3)),this.setAttribute("uv",new r.Float32BufferAttribute(s,2))}}}),parcelRequire.register("kHWob",function(e,t){$parcel$export(e.exports,"BaseWindowGeometry",()=>r);var i=parcelRequire("lmKU8");class r extends i.RectangularGeometry{constructor(e,t){super(e,t),this.type="BaseWindowGeometry",this.parameters={width:e,height:t}}}}),parcelRequire.register("xl6VI",function(e,t){$parcel$export(e.exports,"PanoramicWindowGeometry",()=>o);var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class o extends i.BufferGeometry{constructor(e,t,o=500){super(),this.type="PanoramicWindowGeometry",this.parameters={width:e,thickness:t,platHeight:o};let a=[],n=[],s=[],l=[],h=[];(function(e,t,r){let o=e-t,c=new i.Shape,d=new i.Vector2(-o/2,-t/2),p=new i.Vector2(-o/2,d.y+r),u=new i.Vector2(o/2,p.y),m=new i.Vector2(o/2,-t/2);c.moveTo(m.x,m.y),[d,p,u,m].forEach(e=>{c.lineTo(e.x,e.y)});let g=new i.ShapeGeometry(c);a.push(...Array.from(g.index.array)),n.push(...Array.from(g.attributes.position.array)),s.push(...Array.from(g.attributes.normal.array)),l.push(...Array.from(g.attributes.uv.array)),h.push({start:0,count:g.index.array.length,materialIndex:0});let f=new i.Shape,w=new i.Vector2(-o/2,t/2),y=new i.Vector2(-e/2-t/2,t/2),b=new i.Vector2(-e/2-t/2,t/2+r),x=new i.Vector2(e/2+t/2,t/2+r),P=new i.Vector2(e/2+t/2,t/2),v=new i.Vector2(o/2,t/2);f.moveTo(p.x,p.y),[w,y,b,x,P,v,u,p].forEach(e=>{f.lineTo(e.x,e.y)});let M=new i.ShapeGeometry(f),C=Array.from(M.index.array);for(let e=0;e<C.length;e++)C[e]+=g.attributes.position.array.length/3;a.push(...C),n.push(...Array.from(M.attributes.position.array)),s.push(...Array.from(M.attributes.normal.array)),l.push(...Array.from(M.attributes.uv.array)),h.push({start:g.index.array.length,count:M.index.array.length,materialIndex:1})})(e,t,o),this.setIndex(a),this.setAttribute("position",new r.Float32BufferAttribute(n,3)),this.setAttribute("normal",new r.Float32BufferAttribute(s,3)),this.setAttribute("uv",new r.Float32BufferAttribute(l,2)),this.groups=h}}}),parcelRequire.register("gMe2U",function(e,t){$parcel$export(e.exports,"FrenchWindowGeometry",()=>r);var i=parcelRequire("lmKU8");class r extends i.RectangularGeometry{constructor(e,t){super(e,t),this.type="FrenchWindowGeometry",this.parameters={width:e,height:t}}}}),parcelRequire.register("lUO0N",function(e,t){$parcel$export(e.exports,"LashDoorGeometry",()=>r);var i=parcelRequire("lmKU8");class r extends i.RectangularGeometry{constructor(e,t){super(e,t),this.type="LashDoorGeometry",this.parameters={width:e,height:t}}}}),parcelRequire.register("arwMC",function(e,t){$parcel$export(e.exports,"DWHelper",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("7WCxl"),o=parcelRequire("3KKM9"),a=parcelRequire("bnZk5");class n extends o.LineSegments2{constructor(e=new a.LineSegmentsGeometry,t=new r.LineMaterial({color:16777215*Math.random()})){super(e,t),this.type="DWHelper",this.matrixAutoUpdate=!1}active(e,t=0){let i,o;this.object=e;let n=[];switch(this.vertices=n,"BaseDoorGeometry"==e.geometry.type&&(i=.0015,o=!1,this.getBaseDoorVertices(e)),e.geometry.type){case"BaseDoorGeometry":i=.0015,o=!1,this.getBaseDoorVertices(e);break;case"DoubleOpenDoorGeometry":i=.0015,o=!1,this.getDoubleOpenDoorVertices(e);break;case"SlidingDoorGeometry":i=.0015,o=!1,this.getSlidingDoorVertices(e);break;case"BaseWindowGeometry":i=.0015,o=!1,this.getBaseWindowVertices(e);break;case"PanoramicWindowGeometry":i=.001,o=!1,this.getPanoramicWindowVertices(e);break;case"FrenchWindowGeometry":i=.001,o=!1,this.getFrenchWindowVertices(e);break;case"LashDoorGeometry":i=.001,o=!1,this.getLashDoorVertices(e);break;case"PassGeometry":i=.001,o=!1,this.getPassVertices(e);break;case"SectorDoorGeometry":i=.001,o=!1,this.getSectorDoorVertices(e);break;case"SectorWindowGeometry":i=.001,o=!1,this.getSectorWindowVertices(e);break;case"ArcBaseWindowGeometry":i=.001,o=!1,this.getArcBaseWindowVertices(e);break;case"LWindowGeometry":i=.001,o=!1,this.getLWindowVertices(e);break;case"UWindowGeometry":i=.001,o=!1,this.getUWindowVertices(e)}let s=new(0,a.LineSegmentsGeometry)().setPositions(n);return this.geometry.dispose(),this.geometry=s,this.material=new r.LineMaterial({color:t,linewidth:i,dashed:o}),this}getBaseDoorVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,o=e.geometry.parameters.openType,a=e.geometry.parameters.openDirection,n=new i.Vector2(t/2,r/2),s=new i.Vector2(t/2,-r/2),l=new i.Vector2(-t/2,-r/2),h=new i.Vector2(-t/2,t),c=new i.Vector2(-t/2+r/2,t),d=new i.Vector2(-t/2+r/2,0),p=new i.Vector2(-t/2,0);[n,s,l,h,c,d,p].forEach(e=>{e=getNewPoint(e,o,a)}),[n,s,l,h,h,c,c,d,d,p].forEach(e=>{vertices.push(e.x,e.y,0)});let u=getAngle(o,a,"start"),m=getAngle(o,a,"end"),g=new(0,i.Path)().arc(p.x,p.y,t,u,m).getPoints();g.forEach((e,t)=>{t!=g.length-1&&(vertices.push(e.x,e.y,0),vertices.push(g[t+1].x,g[t+1].y,0))})}getNewPoint(e,t,i){return"outside"==t?"right"==i&&(e.x=-e.x):"inside"==t&&("left"==i?e.y=-e.y:"right"==i&&(e.x=-e.x,e.y=-e.y)),e}getAngle(e,t,i){if("outside"==e){if("left"==t){if("start"==i)return 0;if("end"==i)return Math.PI/2}if("right"==t){if("start"==i)return Math.PI/2;if("end"==i)return Math.PI}}if("inside"==e){if("left"==t){if("start"==i)return 3*Math.PI/2;if("end"==i)return 0}if("right"==t){if("start"==i)return Math.PI;if("end"==i)return 3*Math.PI/2}}}getDoubleOpenDoorVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,o=e.geometry.parameters.openType,a=new i.Vector2(t/2,-r/2),n=new i.Vector2(t/2,t/2),s=new i.Vector2(t/2-r/2,t/2),l=new i.Vector2(t/2-r/2,0),h=new i.Vector2(t/2,0),c=new i.Vector2(-a.x,a.y),d=new i.Vector2(-n.x,n.y),p=new i.Vector2(-s.x,s.y),u=new i.Vector2(-l.x,l.y),m=new i.Vector2(-h.x,h.y);"inside"==o&&[a,n,s,l,h,c,d,p,u,m].forEach(e=>{e.y=-e.y}),[a,n,n,s,s,l,l,h].forEach(e=>{vertices.push(e.x,e.y,0)}),[c,d,d,p,p,u,u,m].forEach(e=>{vertices.push(e.x,e.y,0)});let g=m,f=h,w=0,y=Math.PI/2,b=Math.PI;"inside"==o&&(g=h,f=m,w=Math.PI,y=3*Math.PI/2,b=0);let x=new(0,i.Path)().arc(g.x,g.y,t/2,w,y).getPoints();x.forEach((e,t)=>{t!=x.length-1&&(vertices.push(e.x,e.y,0),vertices.push(x[t+1].x,x[t+1].y,0))});let P=new(0,i.Path)().arc(f.x,f.y,t/2,y,b).getPoints();P.forEach((e,t)=>{t!=x.length-1&&(vertices.push(e.x,e.y,0),vertices.push(P[t+1].x,P[t+1].y,0))})}getSlidingDoorVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,o=10,a=2e3,n=2500,s=new i.Vector2(t/2,-r/2),l=new i.Vector2(t/2,r/2),h=new i.Vector2(-t/2,r/2),c=new i.Vector2(-t/2,-r/2);if([s,l,l,h,h,c,c,s].forEach(e=>{vertices.push(e.x,e.y,0)}),t<=a){let e=2*t/3,a=new i.Vector2(o-t/2,0),n=new i.Vector2(a.x,a.y+r/4),s=new i.Vector2(n.x+e,n.y),l=new i.Vector2(s.x,s.y-r/4);[a,n,n,s,s,l,l,a].forEach(e=>{vertices.push(e.x,e.y,0)});let h=new i.Vector2(-a.x,-a.y),c=new i.Vector2(-n.x,-n.y),d=new i.Vector2(-s.x,-s.y),p=new i.Vector2(-l.x,-l.y);[h,c,c,d,d,p,p,h].forEach(e=>{vertices.push(e.x,e.y,0)})}else if(t<=n){let e=2*t/5,a=new i.Vector2(o-t/2,-r/4),n=new i.Vector2(a.x,a.y+r/4),s=new i.Vector2(n.x+e,n.y),l=new i.Vector2(s.x,s.y-r/4);[a,n,n,s,s,l,l,a].forEach(e=>{vertices.push(e.x,e.y,0)});let h=new i.Vector2(-l.x,l.y),c=new i.Vector2(-s.x,s.y),d=new i.Vector2(-n.x,n.y),p=new i.Vector2(-a.x,a.y);[h,c,c,d,d,p,p,h].forEach(e=>{vertices.push(e.x,e.y,0)});let u=new i.Vector2(-e/2,0),m=new i.Vector2(u.x,u.y+r/4),g=new i.Vector2(m.x+e,m.y),f=new i.Vector2(g.x,g.y-r/4);[u,m,m,g,g,f,f,u].forEach(e=>{vertices.push(e.x,e.y,0)})}else{let e=t/4,a=new i.Vector2(o-t/2,-r/4),n=new i.Vector2(a.x,a.y+r/4),s=new i.Vector2(n.x+e,n.y),l=new i.Vector2(s.x,s.y-r/4);[a,n,n,s,s,l,l,a].forEach(e=>{vertices.push(e.x,e.y,0)});let h=new i.Vector2(s.x-e/4,s.y),c=new i.Vector2(h.x,h.y+r/4),d=new i.Vector2(c.x+e,c.y),p=new i.Vector2(d.x,d.y-r/4);[h,c,c,d,d,p,p,h].forEach(e=>{vertices.push(e.x,e.y,0)});let u=new i.Vector2(-a.x,a.y),m=new i.Vector2(-n.x,n.y),g=new i.Vector2(-s.x,s.y),f=new i.Vector2(-l.x,l.y);[u,m,m,g,g,f,f,u].forEach(e=>{vertices.push(e.x,e.y,0)});let w=new i.Vector2(-h.x,h.y),y=new i.Vector2(-c.x,c.y),b=new i.Vector2(-d.x,d.y),x=new i.Vector2(-p.x,p.y);[w,y,y,b,b,x,x,w].forEach(e=>{vertices.push(e.x,e.y,0)})}}getBaseWindowVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,o=new i.Vector2(t/2,0),a=new i.Vector2(t/2,-r/2),n=new i.Vector2(-t/2,-r/2),s=new i.Vector2(-t/2,0),l=[o,a,n,s,new i.Vector2(-t/2,r/2),new i.Vector2(t/2,r/2),o,s];this.getContinuousLine(l)}getPanoramicWindowVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.thickness,o=t-r,a=e.geometry.parameters.platHeight,n=new i.Vector2(-t/2-r/2,r/2),s=new i.Vector2(-t/2-r/2,r/2+a),l=new i.Vector2(t/2+r/2,r/2+a),h=new i.Vector2(t/2+r/2,r/2),c=new i.Vector2(t/2,r/2),d=new i.Vector2(t/2,a),p=new i.Vector2(-t/2,a),u=new i.Vector2(-t/2,r/2),m=new i.Vector2(-o/2,r/2),g=new i.Vector2(-o/2,a-r/2),f=new i.Vector2(o/2,a-r/2),w=new i.Vector2(o/2,r/2),y=new i.Vector2(o/2,-r/2),b=new i.Vector2(-o/2,-r/2),x=[n,s,l,h,c,d,p,u,m,g,f,w,y,b];this.getContinuousLine(x),this.getContinuousLine([n,u]),this.getContinuousLine([c,w]),this.getContinuousLine([m,b])}getFrenchWindowVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,o=new i.Vector2(-t/2,r/2),a=new i.Vector2(t/2,r/2),n=new i.Vector2(t/2,-r/2),s=new i.Vector2(-t/2,-r/2);this.getContinuousLine([o,a,n,s,o]);let l=new i.Vector2(-t/2,r/6),h=new i.Vector2(t/2,r/6);this.getContinuousLine([l,h]);let c=new i.Vector2(-t/2,0),d=new i.Vector2(t/2,0);this.getContinuousLine([c,d]);let p=new i.Vector2(-t/2,-r/6),u=new i.Vector2(t/2,-r/6);this.getContinuousLine([p,u]);let m=new i.Vector2(0,r/6),g=new i.Vector2(0,-r/6);this.getContinuousLine([m,g])}getLashDoorVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,o=new i.Vector2(-t/2,-r/2),a=new i.Vector2(-t/2,r/2),n=new i.Vector2(t/2,r/2),s=new i.Vector2(t/2,-r/2);this.getContinuousLine([o,a,n,s,o]);let l=new i.Vector2(-t/2,-r/6),h=new i.Vector2(-t/2,r/6),c=new i.Vector2(t/2,r/6),d=new i.Vector2(t/2,-r/6),p=new i.Vector2(-t/4,r/6),u=new i.Vector2(-t/4,-r/6);this.getContinuousLine([l,d]),this.getContinuousLine([h,c]),this.getContinuousLine([p,u])}getPassVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,o=new i.Vector2(-t/2,r/2),a=new i.Vector2(t/2,r/2),n=new i.Vector2(t/2,r/6),s=new i.Vector2(-t/2,r/6),l=new i.Vector2(-t/2,-r/6),h=new i.Vector2(t/2,-r/6),c=new i.Vector2(t/2,-r/2),d=new i.Vector2(-t/2,-r/2);this.getContinuousLine([o,a,n,s,o]),this.getContinuousLine([l,h,c,d,l])}getSectorDoorVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,o=new i.Vector2(-t/2,-r/2),a=new i.Vector2(-t/2,r/2),n=new i.Vector2(t/2,r/2),s=new i.Vector2(t/2,-r/2),l=a.clone().add(n).divideScalar(2),h=a.distanceTo(n)/2,c=a.clone().sub(l).angle(),d=n.clone().sub(l).angle(),p=[s,...new(0,i.Path)().arc(l.x,l.y,h,d,c,!1).getPoints(),o];this.getContinuousLine(p)}getSectorWindowVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,o=new i.Vector2(-t/2,-r/2),a=new i.Vector2(-t/2,r/2),n=new i.Vector2(t/2,r/2),s=new i.Vector2(t/2,-r/2),l=o.clone().add(s).divideScalar(2),h=a.clone().add(n).divideScalar(2),c=a.distanceTo(n)/2,d=a.clone().sub(h).angle(),p=n.clone().sub(h).angle(),u=[s,...new(0,i.Path)().arc(h.x,h.y,c,p,d,!1).getPoints(),o];this.getContinuousLine(u),this.getContinuousLine([n,a]),this.getContinuousLine([h,l])}getArcBaseWindowVertices(e){let t=e.geometry.parameters.center,r=e.geometry.parameters.radius,o=e.geometry.parameters.thickness,a=e.geometry.parameters.startAngle,n=e.geometry.parameters.endAngle,s=r+o/2,l=r-o/2,h=new(0,i.Path)().arc(t.x,t.y,s,a,n,!1).getPoints(),c=new(0,i.Path)().arc(t.x,t.y,r,a,n,!1).getPoints(),d=new(0,i.Path)().arc(t.x,t.y,l,a,n,!1).getPoints();this.getContinuousLine(h),this.getContinuousLine(c),this.getContinuousLine(d),this.getContinuousLine([d[0],h[0]]),this.getContinuousLine([d[d.length-1],h[h.length-1]])}getLWindowVertices(e){let t=e.geometry.parameters.rightDiff,r=e.geometry.parameters.leftDiff,o=e.geometry.parameters.thicknessR,a=e.geometry.parameters.thicknessL,n=e.geometry.parameters.rightAngle,s=e.geometry.parameters.leftAngle,l=e.geometry.parameters.widthR,h=e.geometry.parameters.widthL,c=new i.Vector3,d=new i.Vector3(-t,o/2,0),p=new i.Vector3(l+t,o/2,0),u=new i.Vector3(l+t,0,0),m=new i.Vector3(l+t,-o/2,0),g=new i.Vector3(t,-o/2,0);[d,p,u,m,g,c].forEach(e=>{e.applyAxisAngle(new i.Vector3(0,0,1),n)}),this.getContinuousLine([d,p,m,g]),this.getContinuousLine([u,c]);let f=new i.Vector3(r,a/2,0),w=new i.Vector3(h+r,a/2,0),y=new i.Vector3(h+r,0,0),b=new i.Vector3(h+r,-a/2,0),x=new i.Vector3(-r,-a/2,0);[f,w,y,b,x].forEach(e=>{e.applyAxisAngle(new i.Vector3(0,0,1),s)}),this.getContinuousLine([f,w,b,x]),this.getContinuousLine([y,c])}getUWindowVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.heightL,o=e.geometry.parameters.heightR,a=e.geometry.parameters.thicknessL,n=e.geometry.parameters.thicknessM,s=e.geometry.parameters.thicknessR,l=new i.Vector2(-t/2,-r-n/2),h=new i.Vector2(l.x-a,l.y),c=new i.Vector2(h.x,h.y+r+n),d=new i.Vector2(c.x+a+t+s,c.y),p=new i.Vector2(d.x,d.y-n-o),u=new i.Vector2(p.x-s,p.y),m=new i.Vector2(u.x,u.y+o),g=new i.Vector2(m.x-t,m.y);this.getContinuousLine([l,h,c,d,p,u,m,g,l]);let f=new i.Vector2(l.x-a/2,l.y),w=new i.Vector2(f.x,0),y=new i.Vector2(t/2+s/2,w.y),b=new i.Vector2(y.x,y.y-n/2-o);this.getContinuousLine([f,w,y,b])}getContinuousLine(e){for(let t=0;t<e.length-1;t++)this.vertices.push(e[t].x,e[t].y,0),this.vertices.push(e[t+1].x,e[t+1].y,0)}}}),parcelRequire.register("8C2VU",function(e,t){$parcel$export(e.exports,"PassGeometry",()=>r);var i=parcelRequire("lmKU8");class r extends i.RectangularGeometry{constructor(e,t){super(e,t),this.type="PassGeometry",this.parameters={width:e,height:t}}}}),parcelRequire.register("1Wv1c",function(e,t){$parcel$export(e.exports,"SectorDoorGeometry",()=>o);var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class o extends i.BufferGeometry{constructor(e,t){super(),this.type="SectorDoorGeometry",this.parameters={width:e,height:t};let o=[],a=[],n=[],s=[];(function(e,t){let r=new i.Shape,l=new i.Vector2(-e/2,-t/2),h=new i.Vector2(-e/2,t/2),c=new i.Vector2(e/2,t/2),d=new i.Vector2(e/2,-t/2),p=h.clone().add(c).divideScalar(2),u=h.distanceTo(c)/2,m=h.clone().sub(p).angle(),g=c.clone().sub(p).angle(),f=[...new(0,i.Path)().arc(p.x,p.y,u,g,m,!1).getPoints(),l,d];r.moveTo(d.x,d.y),f.forEach(e=>{r.lineTo(e.x,e.y)});let w=new i.ShapeGeometry(r);o.push(...Array.from(w.index.array)),a.push(...Array.from(w.attributes.position.array)),n.push(...Array.from(w.attributes.normal.array)),s.push(...Array.from(w.attributes.uv.array))})(e,t),this.setIndex(o),this.setAttribute("position",new r.Float32BufferAttribute(a,3)),this.setAttribute("normal",new r.Float32BufferAttribute(n,3)),this.setAttribute("uv",new r.Float32BufferAttribute(s,2))}}}),parcelRequire.register("eZ4ri",function(e,t){$parcel$export(e.exports,"SectorWindowGeometry",()=>o);var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class o extends i.BufferGeometry{constructor(e,t){super(),this.type="SectorWindowGeometry",this.parameters={width:e,height:t};let o=[],a=[],n=[],s=[];(function(e,t){let r=new i.Shape,l=new i.Vector2(-e/2,-t/2),h=new i.Vector2(-e/2,t/2),c=new i.Vector2(e/2,t/2),d=new i.Vector2(e/2,-t/2),p=h.clone().add(c).divideScalar(2),u=h.distanceTo(c)/2,m=h.clone().sub(p).angle(),g=c.clone().sub(p).angle(),f=[...new(0,i.Path)().arc(p.x,p.y,u,g,m,!1).getPoints(),l,d];r.moveTo(d.x,d.y),f.forEach(e=>{r.lineTo(e.x,e.y)});let w=new i.ShapeGeometry(r);o.push(...Array.from(w.index.array)),a.push(...Array.from(w.attributes.position.array)),n.push(...Array.from(w.attributes.normal.array)),s.push(...Array.from(w.attributes.uv.array))})(e,t),this.setIndex(o),this.setAttribute("position",new r.Float32BufferAttribute(a,3)),this.setAttribute("normal",new r.Float32BufferAttribute(n,3)),this.setAttribute("uv",new r.Float32BufferAttribute(s,2))}}}),parcelRequire.register("bWffP",function(e,t){$parcel$export(e.exports,"ArcBaseWindowGeometry",()=>o);var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class o extends i.BufferGeometry{constructor(e,t,o,a,n){super(),this.type="ArcBaseWindowGeometry",this.parameters={center:e,radius:t,thickness:o,startAngle:a,endAngle:n};let s=[],l=[],h=[],c=[];(function(e,t,r,o,a){let n=t+r/2,d=t-r/2,p=new(0,i.Path)().arc(e.x,e.y,n,o,a,!1).getPoints(),u=new(0,i.Path)().arc(e.x,e.y,d,o,a,!1).getPoints(),m=new i.Shape;m.moveTo(u[0].x,u[0].y),u.reverse().forEach(e=>{p.push(e)}),p.forEach(e=>{m.lineTo(e.x,e.y)});let g=new i.ShapeGeometry(m);s.push(...Array.from(g.index.array)),l.push(...Array.from(g.attributes.position.array)),h.push(...Array.from(g.attributes.normal.array)),c.push(...Array.from(g.attributes.uv.array))})(e,t,o,a,n),this.setIndex(s),this.setAttribute("position",new r.Float32BufferAttribute(l,3)),this.setAttribute("normal",new r.Float32BufferAttribute(h,3)),this.setAttribute("uv",new r.Float32BufferAttribute(c,2))}}}),parcelRequire.register("lDEcB",function(e,t){$parcel$export(e.exports,"LWindowGeometry",()=>o);var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class o extends i.BufferGeometry{constructor(e,t,o,a){super(),this.type="LWindowGeometry",this.parameters={leftWall:e,widthL:o,rightWall:t,widthR:a};let n=this,s=[],l=[],h=[],c=[];function d(e,t){let r=new i.Vector2(e.startPoint.x,e.startPoint.y),o=new i.Vector2(e.endPoint.x,e.endPoint.y),a=new i.Vector2(t.startPoint.x,t.startPoint.y),n=new i.Vector2(t.endPoint.x,t.endPoint.y);return r.equals(a)||r.equals(n)?r:o.equals(a)||o.equals(n)?o:void 0}function p(e,t,r,o,a){let n=new(0,i.Vector2)().subVectors(t,e).normalize(),s=new(0,i.Vector2)().subVectors(r,t).normalize(),l=new(0,i.Vector2)(-s.y,s.x).normalize(),h=a/n.dot(l),c=n.clone().setLength(h),d=new(0,i.Vector2)(-n.y,n.x).normalize(),p=o/s.clone().negate().dot(d),u=s.clone().negate().setLength(p);return c.add(u)}(function(e,t,r,o){let a,u,m,g,f,w,y;if(e&&t){let r,o;let n=d(e,t);w=e.startPoint.x==n.x&&e.startPoint.y==n.y?(r=new i.Vector2(e.endPoint.x,e.endPoint.y)).clone().sub(e.startPoint):(r=new i.Vector2(e.startPoint.x,e.startPoint.y)).clone().sub(e.endPoint),y=t.startPoint.x==n.x&&t.startPoint.y==n.y?(o=new i.Vector2(t.endPoint.x,t.endPoint.y)).clone().sub(t.startPoint):(o=new i.Vector2(t.startPoint.x,t.startPoint.y)).clone().sub(t.endPoint),u=w.angle(),m=y.angle(),a=p(r,n,o,e.thickness,t.thickness).angle(),g=e.thickness,f=t.thickness}else g=240,f=240,w=new i.Vector2(0,-1),y=new i.Vector2(1,0),a=((u=w.angle())+(m=y.angle()))/2;let b=Math.abs(f/2/Math.tan(a>m?a-m:a+2*Math.PI-m)),x=Math.abs(g/2/Math.tan(a<u?Math.PI-u+a:a-u-Math.PI));n.parameters.rightDiff=b,n.parameters.leftDiff=x,n.parameters.thicknessR=f,n.parameters.thicknessL=g,n.parameters.rightAngle=m,n.parameters.leftAngle=u,n.parameters.widthR=o,n.parameters.widthL=r;let P=new i.Vector3(-b,f/2,0),v=new i.Vector3(o+b,f/2,0),M=new i.Vector3(o+b,-f/2,0),C=new i.Vector3(b,-f/2,0),D=new i.Shape,T=C.clone().applyAxisAngle(new i.Vector3(0,0,1),m);D.moveTo(T.x,T.y),[P,v,M,C].forEach(e=>{let t=e.clone().applyAxisAngle(new i.Vector3(0,0,1),m);D.lineTo(t.x,t.y)});let S=new i.ShapeGeometry(D);s.push(...Array.from(S.index.array)),l.push(...Array.from(S.attributes.position.array)),h.push(...Array.from(S.attributes.normal.array)),c.push(...Array.from(S.attributes.uv.array));let k=new i.Vector3(x,g/2,0),V=new i.Vector3(r+x,g/2,0),A=new i.Vector3(r+x,-g/2,0),L=new i.Vector3(-x,-g/2,0),W=new i.Shape,I=L.clone().applyAxisAngle(new i.Vector3(0,0,1),u);W.moveTo(I.x,I.y),[k,V,A,L].forEach(e=>{let t=e.clone().applyAxisAngle(new i.Vector3(0,0,1),u);W.lineTo(t.x,t.y)});let R=new i.ShapeGeometry(W),B=Array.from(R.index.array);for(let e=0;e<B.length;e++)B[e]+=S.attributes.position.array.length/3;s.push(...B),l.push(...Array.from(R.attributes.position.array)),h.push(...Array.from(R.attributes.normal.array)),c.push(...Array.from(R.attributes.uv.array))})(e,t,o,a),this.setIndex(s),this.setAttribute("position",new r.Float32BufferAttribute(l,3)),this.setAttribute("normal",new r.Float32BufferAttribute(h,3)),this.setAttribute("uv",new r.Float32BufferAttribute(c,2))}}}),parcelRequire.register("kKNer",function(e,t){$parcel$export(e.exports,"UWindowGeometry",()=>o);var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class o extends i.BufferGeometry{constructor(e,t,o,a,n,s){super(),this.type="UWindowGeometry",this.parameters={width:e,heightL:t,heightR:o,thicknessL:a,thicknessM:n,thicknessR:s};let l=[],h=[],c=[],d=[];(function(e,t,r,o,a,n){let s=new i.Vector2(-e/2,-t-a/2),p=new i.Vector2(s.x-o,s.y),u=new i.Vector2(p.x,p.y+t+a),m=new i.Vector2(u.x+o+e+n,u.y),g=new i.Vector2(m.x,m.y-a-r),f=new i.Vector2(g.x-n,g.y),w=new i.Vector2(f.x,f.y+r),y=new i.Vector2(w.x-e,w.y),b=new i.Shape;b.moveTo(y.x,y.y),[s,p,u,m,g,f,w,y].forEach(e=>{b.lineTo(e.x,e.y)});let x=new i.ShapeGeometry(b);l.push(...Array.from(x.index.array)),h.push(...Array.from(x.attributes.position.array)),c.push(...Array.from(x.attributes.normal.array)),d.push(...Array.from(x.attributes.uv.array))})(e,t,o,a,n,s),this.setIndex(l),this.setAttribute("position",new r.Float32BufferAttribute(h,3)),this.setAttribute("normal",new r.Float32BufferAttribute(c,3)),this.setAttribute("uv",new r.Float32BufferAttribute(d,2))}}}),parcelRequire.register("iDVm9",function(e,t){$parcel$export(e.exports,"BeamMesh",()=>a);var i=parcelRequire("9vZPJ"),r=parcelRequire("4xklQ"),o=parcelRequire("hrM0U");class a extends i.Base3DMesh{constructor(e={}){super(),this.type="Group",e.position=e.position?new r.Vector2((0,o.CommonFunc).keepDecimalRound(e.position.x,3),(0,o.CommonFunc).keepDecimalRound(e.position.y,3)):new r.Vector2,e.center=e.position,e.rotation=e.rotation||0,e.thickness=e.thickness||400,e.depth=e.depth||400,e.wallList=e.wallList||[],e.width=e.width||!1,e.model=e.model||"R",e.material=e.material||new r.MeshBasicMaterial({color:16777215}),this.parameter=e,this.parameter.leftWall=[],this.parameter.rightWall=[]}create(){this.getLineData();let e={slope:this.parameter.equation.slope,constant:this.parameter.upConstant},t=this.getIntersectPoint(this.parameter.locationUp,this.parameter.rotationVec,e),i=this.getIntersectPoint(this.parameter.position,this.parameter.rotationVec,this.parameter.equation),a={slope:this.parameter.equation.slope,constant:this.parameter.downConstant},n=this.getIntersectPoint(this.parameter.locationDown,this.parameter.rotationVec,a),s=(0,o.CommonFunc).includeUndefined(t),l=(0,o.CommonFunc).includeUndefined(i),h=(0,o.CommonFunc).includeUndefined(n);if(s||l||h||(this.parameter.leftWall=(0,o.CommonFunc).filterObjArray([t[0].wall.wallID,i[0].wall.wallID,n[0].wall.wallID]),this.parameter.rightWall=(0,o.CommonFunc).filterObjArray([t[1].wall.wallID,i[1].wall.wallID,n[1].wall.wallID])),s||l||h||"R"!=this.parameter.model){let e=new r.Vector2(-this.parameter.width/2,-this.parameter.thickness/2),t=[new r.Vector2(this.parameter.width/2,-this.parameter.thickness/2),new r.Vector2(this.parameter.width/2,this.parameter.thickness/2),new r.Vector2(-this.parameter.width/2,this.parameter.thickness/2),e],i=(0,o.CommonFunc).createShapeByPoints(t,this.parameter.material);i.position.z=10;let a=(0,o.CommonFunc).createLine([...t,t[0]]);this.add(i,a),this.parameter.model="L"}else{let e=[],a=i[0].clone().add(i[1]).multiplyScalar(.5);[t[0],i[0],...n,i[1],t[1]].forEach(t=>{let i=t.clone().sub(a),o=new(0,r.Vector3)(i.x,i.y,0).applyMatrix4(new(0,r.Matrix4)().makeRotationZ(-this.parameter.rotation));e.push(new r.Vector2(o.x,o.y))});let s=(0,o.CommonFunc).createShapeByPoints(e,this.parameter.material);s.position.z=10;let l=(0,o.CommonFunc).createLine([...e,e[0]]);this.add(s,l),this.parameter.center=a,this.parameter.width=parseInt(i[0].distanceTo(i[1]))}this.position.set(this.parameter.center.x,this.parameter.center.y,10),this.rotation.z=this.parameter.rotation}getLineData(){let e=this.parameter.rotation%(2*Math.PI);0==e||e==Math.PI?(this.parameter.equation={slope:"Y",constant:this.parameter.position.y},0==e&&(this.parameter.rotationVec=new r.Vector2(1,0)),e==Math.PI&&(this.parameter.rotationVec=new r.Vector2(-1,0))):e==Math.PI/2||e==3*Math.PI/2?(this.parameter.equation={slope:"X",constant:this.parameter.position.x},e==Math.PI/2&&(this.parameter.rotationVec=new r.Vector2(0,1)),e==3*Math.PI/2&&(this.parameter.rotationVec=new r.Vector2(0,-1))):(this.parameter.equation={slope:Math.round(1e3*Math.tan(this.parameter.rotation))/1e3},this.parameter.equation.constant=this.parameter.position.y-this.parameter.equation.slope*this.parameter.position.x,this.parameter.rotationVec=new r.Vector2(1,this.parameter.equation.slope));let t=new r.Vector2(-this.parameter.rotationVec.y,this.parameter.rotationVec.x);this.parameter.locationUp=this.parameter.position.clone().add(t.setLength(this.parameter.thickness/2)),this.parameter.locationDown=this.parameter.position.clone().add(t.clone().negate()),"X"==this.parameter.equation.slope?(this.parameter.upConstant=this.parameter.locationUp.x,this.parameter.downConstant=this.parameter.locationDown.x):"Y"==this.parameter.equation.slope?(this.parameter.upConstant=this.parameter.locationUp.y,this.parameter.downConstant=this.parameter.locationDown.y):(this.parameter.upConstant=this.parameter.locationUp.y-this.parameter.equation.slope*this.parameter.locationUp.x,this.parameter.downConstant=this.parameter.locationDown.y-this.parameter.equation.slope*this.parameter.locationDown.x)}getIntersectPoint(e,t,i){let a=[],n=[],s,l,h=[],c=[];for(let s=0;s<this.parameter.wallList.length;s++){let l,d=this.parameter.wallList[s],p=Array.from(d.geometry.attributes.position.array),u=new r.Vector2(p[0],p[1]),m=new r.Vector2(p[6],p[7]),g=new r.Vector2(p[9],p[10]),f=new r.Vector2(p[15],p[16]),w=this.getAndCheck(u,g,i),y=this.getAndCheck(m,f,i);if(w&&y?l=e.distanceTo(w)>e.distanceTo(y)?y:w:(w&&(l=w),y&&(l=y)),l){let i=l.clone().sub(e);(0,o.CommonFunc).isSameDirection2(i,t)?(n.push(l),c.push(d)):(a.push(l),h.push(d))}}if(n.length>0){(l=n[0]).wall=c[0];for(let t=1;t<n.length;t++)l.distanceTo(e)>n[t].distanceTo(e)&&((l=n[t]).wall=c[t])}if(a.length>0){(s=a[0]).wall=h[0];for(let t=1;t<a.length;t++)s.distanceTo(e)>a[t].distanceTo(e)&&((s=a[t]).wall=h[t])}return[s,l]}getAndCheck(e,t,i){let r=(0,o.CommonFunc).getLineEquation(e,t),a=(0,o.CommonFunc).getIntersectPoint(i,r);if(a){let i=Math.min(e.x,t.x),r=Math.max(e.x,t.x),o=Math.min(e.y,t.y),n=Math.max(e.y,t.y),s=a.x>=i&&a.x<=r,l=a.y>=o&&a.y<=n;return!!s&&!!l&&a}return!1}setModel(e,t=!1){this.parameter.model=e,t&&this.refresh()}refresh(e={}){e.position&&(this.parameter.position=e.position,this.parameter.center=e.position),e.rotation&&(this.parameter.rotation=e.rotation),e.thickness&&(this.parameter.thickness=e.thickness),e.depth&&(this.parameter.rotation=e.rotation),e.wallList&&(this.parameter.wallList=e.wallList),e.width&&(this.parameter.width=e.width),e.model&&(this.parameter.model=e.model),e.material&&(this.parameter.material=e.material),console.log("refresh",this.angle,this.rotation.z,this.angle!=this.rotation.z,this.parameter.rotation),this.angle!=this.rotation.z&&console.log(this.angle,this.rotation.z,this.parameter.rotation),this.children=[],this.create(),console.log("refresh finish",this.rotation.z)}}}),parcelRequire.register("9vZPJ",function(e,t){$parcel$export(e.exports,"Base3DMesh",()=>a);var i=parcelRequire("4xklQ");parcelRequire("jPMpS");var r=parcelRequire("cTA6h"),o=parcelRequire("9QhXH");class a extends i.Object3D{constructor(){super(),this.type="Base3DMesh"}createLine(e,t=0){this.add((0,o.DM).createLine(e,t))}createBox(e){let t=e.width,r=e.height,o=e.depth,a=new i.BoxGeometry(t,r,o);a.computeBoundingBox();let n=e.material?e.material:new i.MeshStandardMaterial({color:0}),s=a.attributes.position,l=a.attributes.uv,h=a.attributes.normal,c=new i.Vector3(0,0,1),d=new i.Vector3(0,1,0),p=new i.Vector3(1,0,0);for(let e=0;e<s.count;e++){let a=new i.Vector3(h.getX(e),h.getY(e),h.getZ(e));(a.equals(p)||a.equals(p.clone().negate()))&&l.setX(e,l.getX(e)*o/r),(a.equals(c)||a.equals(c.clone().negate()))&&l.setX(e,l.getX(e)*t/r),(a.equals(d)||a.equals(d.clone().negate()))&&(l.setY(e,l.getY(e)*o/t*t/r),l.setX(e,l.getX(e)*t/r))}return new i.Mesh(a,n)}createArchBox(e){let t=e.width,r=e.height+e.width/2,o=e.depth,a=t>r?t:r>o?r:o,n=new i.Shape,s=new i.Vector2(-e.width/2,-e.height/2),l=new i.Vector2(-e.width/2,e.height/2),h=new i.Vector2(e.width/2,-e.height/2),c=new i.Vector2(0,e.height/2);n.moveTo(s.x,s.y),n.lineTo(l.x,l.y),n.absarc(c.x,c.y,e.width/2,Math.PI,0,!0),n.lineTo(h.x,h.y);let d={steps:2,depth:e.depth,bevelEnabled:!0,bevelThickness:0,bevelSize:0,bevelSegments:1},p=new i.ExtrudeGeometry(n,d);p.translate(0,0,-e.depth/2);let u=p.attributes.uv;for(let e=0;e<u.count;e++)u.setX(e,u.getX(e)/a),u.setY(e,u.getY(e)/a);return new i.Mesh(p,e.material)}createDoorstone(){this.parameter.width,this.parameter.depth,this.parameter.width,this.parameter.depth,this.parameter.width,this.parameter.depth,this.parameter.width,this.parameter.depth;let e=new i.PlaneGeometry(this.parameter.width,this.parameter.depth),t=e.attributes.uv;for(let e=0;e<t.count;e++)t.setY(e,t.getY(e)*this.parameter.depth/this.parameter.width*this.parameter.width/this.parameter.height),t.setX(e,t.getX(e)*this.parameter.width/this.parameter.height);let r=this.parameter.editor.config.marbleTexture;r.wrapS=i.RepeatWrapping,r.wrapT=i.RepeatWrapping;let o=new i.MeshStandardMaterial({map:r,side:i.DoubleSide}),a=new i.Mesh(e,o);return a.name="DoorStone",a.rotation.x=-Math.PI/2,a.position.y=-this.parameter.height/2+3,a}createBox_Back(e){let t=e.width/1e3,r=e.height/1e3,o=e.depth/1e3,a=new i.BoxGeometry(t,r,o);a.computeBoundingBox();let n=e.material?e.material:new i.MeshBasicMaterial({color:0});return new i.Mesh(a,n)}createSingleWindow(e,t,r,o){let a={width:e/2+r/2,height:t,depth:o,material:this.parameter.windowTexture||this.parameter.frameTexture},n={width:a.width-2*r,height:a.height-2*r,depth:a.depth,material:this.parameter.mirrorTexture},s=new i.Group,l=this.createBox(a),h=this.createBox(n);l=this.boolean(l,h),n.depth/=4;let c=this.createBox(n);return c.name="glass",c.position.add(new i.Vector3(0,0,-(a.depth-n.depth)/2)),s.add(l,c),s}createTriangle(e){let t=e.width/1e3,r=e.height/1e3,o=e.depth/1e3,a=new i.Vector2(-t/2,-r/2),n=new i.Vector2(t/2,-r/2),s=new i.Vector2(0,r/2),l=new i.Shape;l.moveTo(a.x,a.y),[n,s,a].forEach(e=>{l.lineTo(e.x,e.y)});let h={steps:2,depth:o,bevelEnabled:!1,bevelThickness:1,bevelSize:1,bevelSegments:1},c=new i.ExtrudeGeometry(l,h),d=e.mat?e.mat:16711680,p=new i.Mesh(c,new i.MeshBasicMaterial({color:d}));return p.rotation.x=Math.PI/2,p.position.add(new i.Vector3(0,o/2,0)),p}createShapeOrStereoscopic(e,t,r){let o=e.shift(),a=new i.Shape,n;if(a.moveTo(o.x,o.y),e.forEach(function(e){a.lineTo(e.x,e.y)}),a.lineTo(o.x,o.y),1*t!=0){let e={steps:2,depth:t,bevelEnabled:!1,bevelThickness:1,bevelSize:1,bevelSegments:1},o=new i.ExtrudeGeometry(a,e),s=o.attributes.uv;for(let e=0;e<s.count;e++)s.setX(e,s.getX(e)/t),s.setY(e,s.getY(e)/t);n=new i.Mesh(o,r)}else{let e=new i.ShapeGeometry(a);n=new i.Mesh(e,r)}return n.rotation.x=-Math.PI/2,n}createStyle(e){console.log("Base3DMesh.createStyle")}boolean(e,t,i="subtract"){var o;e.updateMatrix(),t.updateMatrix();let a=(0,r.CSG).fromMesh(e),n=(0,r.CSG).fromMesh(t);if("union"==i)o=a.union(n);else{if(0==a.intersect(n).polygons.length)return!1;"subtract"==i&&(o=a.subtract(n)),"intersect"==i&&(o=a.intersect(n))}return(0,r.CSG).toMesh(o,e.matrix,e.material)}create(){console.log("暂时不支持创建。")}destroy(){this.parent?this.parent.remove(this):console.log("无法删除，没有父级。")}update(){0==this.children.length?console.log("子数组为空，不支持更新。"):(this.children=[],this.create(),this.inheritLayers(this.layers.mask))}setParameter(e,t,i=!1){this.parameter[e]?(this.parameter[e]=t,i&&this.update()):console.log("参数不存在，请检查参数名称。")}setLayers(e,t=this){t.layers.set(e),t.children.forEach(t=>{"Group"==t.type?this.setLayers(e,t):this.setLayer(t,e)})}setLayer(e,t){e.layers.set(t)}enableLayers(e,t=this){t.layers.enable(e),t.children.forEach(t=>{"Group"==t.type?this.enableLayers(e,t):this.enableLayer(t,e)})}enableLayer(e,t){e.layers.enable(t)}inheritLayers(e,t=this){t.layers.mask=e,t.children.forEach(t=>{"Group"==t.type?this.inheritLayers(e,t):this.inheritLayer(t,e)})}inheritLayer(e,t){e.layers.mask=t}setWidth(e,t=!1){this.setParameter("width",e,t)}getWidth(){return this.parameter.width}setHeight(e,t=!1){this.setParameter("height",e,t)}getHeight(){return this.parameter.height}setDepth(e,t=!1){this.setParameter("depth",e,t)}getDepth(){return this.parameter.depth}}}),parcelRequire.register("4xgHd",function(e,t){$parcel$export(e.exports,"Entry3D",()=>w);var i=parcelRequire("4xklQ"),r=parcelRequire("evkYu"),o=parcelRequire("5L0a9"),a=parcelRequire("8y3mE"),n=parcelRequire("4cEbr"),s=parcelRequire("eDeYG"),l=parcelRequire("b4XIY"),h=parcelRequire("gKzkd"),c=parcelRequire("7T7Cq"),d=parcelRequire("fxI5g"),p=parcelRequire("eiZ6q"),u=parcelRequire("heK7I"),m=parcelRequire("3tFct"),g=parcelRequire("dFygm"),f=parcelRequire("k63JT");class w{static createBaseDoor(e){let t=new r.BaseDoorMesh({width:e.width,height:e.height,depth:e.thickness,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.copy(e.position),t.rotation.y=e.rotAngle,t}static createDoubleOpenDoor(e){let t=new o.DoubleOpenDoorMesh({width:e.width,height:e.height,depth:e.thickness,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.copy(e.position),t.rotation.y=e.rotAngle,t}static createSlidingDoor(e){let t=new a.SlidingDoorMesh({width:e.width,height:e.height,depth:e.thickness,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.copy(e.position),t.rotation.y=e.rotAngle,t}static createBaseWindow(e){let t=new n.BaseWindowMesh({width:e.width,height:e.height,depth:e.thickness,heightFromGround:e.position.z-e.height/2,style:e.style,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.copy(e.position),t.rotation.y=e.rotAngle,t}static createFrenchWindow(e){let t=new s.FrenchWindowMesh({width:e.width,height:e.height,depth:e.thickness,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.copy(e.position),t.rotation.y=e.rotAngle,t}static createLashDoor(e){let t=new l.LashDoorMesh({width:e.width,height:e.height,depth:e.thickness,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.copy(e.position),t.rotation.y=e.rotAngle,t}static createPass(e){let t=new h.PassMesh({width:e.width,height:e.height,depth:e.thickness,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.copy(e.position),t.rotation.y=e.rotAngle,t}static createDooropen(e){let t=new f.DooropenMesh({width:e.width,height:e.height,depth:e.thickness,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.copy(e.position),t.rotation.y=e.rotAngle,t}static createSectorDoor(e){let t=new c.SectorDoorMesh({width:e.width,height:e.height-e.width/2,depth:e.thickness,editor:e.editor,arcHei:e.arcHei});return t.create(),t.rotation.x=Math.PI/2,t.position.set(e.position.x,e.position.y,e.position.z-e.width/4),t.rotation.y=e.rotAngle,t}static createSectorWindow(e){let t=new d.SectorWindowMesh({width:e.width,height:e.height-e.width/2,depth:e.thickness,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.set(e.position.x,e.position.y,e.position.z-e.width/4),t.rotation.y=e.rotAngle,t}static createArcWindow(e){let t=e.hole,r=e.wall,o=new i.Vector2(1e3*r.startPoint.x,1e3*r.startPoint.y);new i.Vector2(1e3*r.endPoint.x,1e3*r.endPoint.y);let a=r.arcCenter.distanceTo(o);console.log(t,r,t.startRadian,t.endRadian,a);let n=new p.ArcBaseWindowMesh({height:t.height,startAngle:t.startRadian,endAngle:t.endRadian,radius:a,thickness:1e3*r.thickness,editor:e.editor});return n.create(),console.log(n),n.position.set(r.arcCenter.x,r.arcCenter.y,t.positionZ-t.height/2),n.rotation.x=Math.PI/2,n}static createLWindow(e){let t=new u.LWindowMesh(e);return t.create(),t.rotation.x=Math.PI/2,t.position.z=e.position.z-e.height/2,t}static createPanoramicWindow(e){let t=new m.PanoramicWindowMesh(e);return t.create(),t.rotation.x=Math.PI/2,t.position.set(e.position.x,e.position.y,e.position.z),t.rotation.y=e.rotAngle,t}static createUWindow(e){let t=new g.UWindowMesh(e);return t.create(),t.rotation.x=Math.PI/2,t.children.forEach(e=>{e.geometry.translate(0,480,0)}),t.position.set(e.position.x,e.position.y,e.position.z-e.height/2),t.rotation.y=e.rotAngle,t}}}),parcelRequire.register("evkYu",function(e,t){$parcel$export(e.exports,"BaseDoorMesh",()=>a);var i=parcelRequire("9vZPJ"),r=parcelRequire("4xklQ"),o=parcelRequire("hu0fb");class a extends i.Base3DMesh{constructor(e={}){if(super(),this.type="BaseDoorMesh",e.width=e.width||900,e.height=e.height||2200,e.depth=e.depth||150,e.doorDep=e.doorDep||50,e.frameBorder=e.frameBorder||38,e.handleEdge=e.handleEdge||50,e.handleBtm=e.handleBtm||1e3,!e.frameTexture){let t=e.editor.config.baseDoorFrame;t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,e.frameTexture=new r.MeshStandardMaterial({map:t})}if(!e.doorTexture){let t=e.editor.config.baseDoorFace;t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,e.doorTexture=new r.MeshStandardMaterial({map:t})}this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.frameTexture},t=this.createBox(e),i={width:this.parameter.width-2*this.parameter.frameBorder,height:this.parameter.height-this.parameter.frameBorder,depth:this.parameter.depth,material:new r.MeshBasicMaterial({color:16711680})},o=this.createBox(i);o.position.add(new r.Vector3(0,-this.parameter.frameBorder/2,0)),t=this.boolean(t,o);let a={width:this.parameter.width-2*this.parameter.frameBorder,height:this.parameter.height-this.parameter.frameBorder,depth:this.parameter.doorDep,material:this.parameter.doorTexture},n=this.createBox(a);n.position.add(new r.Vector3(0,-this.parameter.frameBorder/2,0));let s=this.createDoorstone();this.addHandle(),this.add(t,n,s)}addHandle(){let e=new o.GLTFLoader,t=this;e.load(window.url+"/assets/component/outerHandle.glb",function(e){let i=e.scene.children[0];i.applyMatrix4(new(0,r.Matrix4)().makeScale(-1e3,1e3,1e3)),e.scene.traverse(function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)});let o=new r.Box3().setFromObject(i);i.translateX(t.parameter.width/2-o.max.x-t.parameter.frameBorder-t.parameter.handleEdge),i.translateY(o.max.y-t.parameter.height/2+t.parameter.handleBtm),i.translateZ(-(o.max.z+t.parameter.doorDep/2)),t.add(i)}),e.load(window.url+"/assets/component/innerHandle.glb",function(e){let i=e.scene.children[0];i.applyMatrix4(new(0,r.Matrix4)().makeScale(-1e3,1e3,1e3)),e.scene.traverse(function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)});let o=new r.Box3().setFromObject(i);i.translateX(t.parameter.width/2-o.max.x-t.parameter.frameBorder-t.parameter.handleEdge),i.translateY(o.max.y-t.parameter.height/2+t.parameter.handleBtm-59.08065149103135),i.translateZ(o.max.z+t.parameter.doorDep/2),t.add(i)})}}}),parcelRequire.register("5L0a9",function(e,t){$parcel$export(e.exports,"DoubleOpenDoorMesh",()=>a);var i=parcelRequire("4xklQ"),r=parcelRequire("9vZPJ"),o=parcelRequire("hu0fb");class a extends r.Base3DMesh{constructor(e={}){if(super(),this.type="DoubleOpenDoorMesh",e.width=e.width||1500,e.height=e.height||2200,e.depth=e.depth||150,e.frameBorder=e.frameBorder||38,e.doorDep=e.doorDep||50,e.handleEdge=e.handleEdge||50,e.handleBtm=e.handleBtm||1e3,!e.frameTexture){let t=e.editor.config.baseDoorFrame;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.frameTexture=new i.MeshStandardMaterial({map:t})}if(!e.doorTexture){let t=e.editor.config.baseDoorFace;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.doorTexture=new i.MeshStandardMaterial({map:t})}this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.frameTexture},t=this.createBox(e),r={width:this.parameter.width-2*this.parameter.frameBorder,height:this.parameter.height-this.parameter.frameBorder,depth:this.parameter.depth},o=this.createBox(r);o.position.add(new i.Vector3(0,-this.parameter.frameBorder/2,0)),t=this.boolean(t,o),this.add(t);let a={width:this.parameter.width/2-this.parameter.frameBorder,height:this.parameter.height-this.parameter.frameBorder,depth:this.parameter.doorDep,material:this.parameter.doorTexture},n=this.createBox(a);n.position.add(new i.Vector3(-a.width/2,-this.parameter.frameBorder/2,0));let s=this.createBox(a);s.position.add(new i.Vector3(a.width/2,-this.parameter.frameBorder/2,0));let l=this.createDoorstone();this.addHandle(a.width/2),this.add(n,s,l)}addHandle(e){let t=new o.GLTFLoader,r=this;t.load(window.url+"/assets/component/outerHandle.glb",function(e){let t=e.scene.children[0];t.applyMatrix4(new(0,i.Matrix4)().makeScale(-1e3,1e3,1e3)),e.scene.traverse(function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)});let o=new i.Box3().setFromObject(t);t.translateX(-o.max.x-r.parameter.handleEdge),t.translateY(o.max.y-r.parameter.height/2+r.parameter.handleBtm),t.translateZ(-(o.max.z+r.parameter.doorDep/2)),r.add(t)}),t.load(window.url+"/assets/component/innerHandle.glb",function(e){let t=e.scene.children[0];t.applyMatrix4(new(0,i.Matrix4)().makeScale(-1e3,1e3,1e3)),e.scene.traverse(function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)});let o=new i.Box3().setFromObject(t);t.translateX(-o.max.x-r.parameter.handleEdge),t.translateY(o.max.y-r.parameter.height/2+r.parameter.handleBtm-59.08065149103135),t.translateZ(o.max.z+r.parameter.doorDep/2),r.add(t)}),t.load(window.url+"/assets/component/outerHandle.glb",function(e){let t=e.scene.children[0];t.applyMatrix4(new(0,i.Matrix4)().makeScale(1e3,1e3,1e3)),e.scene.traverse(function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)});let o=new i.Box3().setFromObject(t);t.translateX(o.max.x+r.parameter.handleEdge),t.translateY(o.max.y-r.parameter.height/2+r.parameter.handleBtm),t.translateZ(-(o.max.z+r.parameter.doorDep/2)),r.add(t)}),t.load(window.url+"/assets/component/innerHandle.glb",function(e){let t=e.scene.children[0];t.applyMatrix4(new(0,i.Matrix4)().makeScale(1e3,1e3,1e3)),e.scene.traverse(function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)});let o=new i.Box3().setFromObject(t);t.translateX(o.max.x+r.parameter.handleEdge),t.translateY(o.max.y-r.parameter.height/2+r.parameter.handleBtm-59.08065149103135),t.translateZ(o.max.z+r.parameter.doorDep/2),r.add(t)})}}}),parcelRequire.register("8y3mE",function(e,t){$parcel$export(e.exports,"SlidingDoorMesh",()=>o);var i=parcelRequire("9vZPJ"),r=parcelRequire("4xklQ");class o extends i.Base3DMesh{constructor(e={}){if(super(),this.type="SlidingDoorMesh",e.width=e.width||1660,e.height=e.height||2200,e.depth=e.depth||100,e.doorDepth=e.doorDepth||35,e.frameBorder=e.frameBorder||30,e.doorNum=e.doorNum||t(e.width),e.doorCoincide=e.doorCoincide||18,e.doorBorder=e.doorBorder||150,e.doorGap=e.doorGap||2,!e.frameTexture){let t=e.editor.config.slidingDoorframe;t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,e.frameTexture=new r.MeshStandardMaterial({map:t})}if(!e.doorTexture){let t=e.editor.config.slidingDoorFace;t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,e.doorTexture=new r.MeshStandardMaterial({map:t})}function t(e){return e<=2e3?2:e<2500?3:4}this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.frameTexture},t=this.createBox(e),i=this.parameter.width-2*this.parameter.frameBorder,o=this.parameter.height-this.parameter.frameBorder,a={width:i,height:o,depth:this.parameter.depth},n=this.createBox(a);n.position.add(new r.Vector3(0,-this.parameter.frameBorder/2,0));let s=this.boolean(t,n),l={width:i/this.parameter.doorNum+this.parameter.doorCoincide,height:o,depth:this.parameter.doorDepth,material:this.parameter.doorTexture},h={width:l.width-2*this.parameter.doorBorder,height:l.height-2*this.parameter.doorBorder,depth:l.depth,material:new r.MeshStandardMaterial({color:new r.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new r.Vector2(1,-1),side:2,transparent:!0,opacity:.1,roughness:.1})};if(2===this.parameter.doorNum){let e=this.createDoor(l,h),t=e.clone();e.position.add(new r.Vector3(-(i-l.width)/2,0,-(l.depth+this.parameter.doorGap)/2)),t.position.add(new r.Vector3((i-l.width)/2,0,(l.depth+this.parameter.doorGap)/2)),this.add(e,t)}if(3===this.parameter.doorNum){let e=this.createDoor(l,h),t=e.clone(),o=e.clone();e.position.add(new r.Vector3(-(i-l.width)/2,0,(l.depth+this.parameter.doorGap)/2)),t.position.add(new r.Vector3(0,0,-(l.depth+this.parameter.doorGap)/2)),o.position.add(new r.Vector3((i-l.width)/2,0,(l.depth+this.parameter.doorGap)/2)),this.add(e,t,o)}if(4===this.parameter.doorNum){let e=this.createDoor(l,h),t=e.clone(),o=e.clone(),a=e.clone();e.position.add(new r.Vector3(-(i-l.width)/2,0,-(l.depth+this.parameter.doorGap)/2)),t.position.add(new r.Vector3(-l.width/2,0,(l.depth+this.parameter.doorGap)/2)),o.position.add(new r.Vector3(l.width/2,0,(l.depth+this.parameter.doorGap)/2)),a.position.add(new r.Vector3((i-l.width)/2,0,-(l.depth+this.parameter.doorGap)/2)),this.add(e,t,o,a)}let c=this.createDoorstone();this.add(s,c)}createDoor(e,t){let i=new r.Group,o=this.createBox(e),a=this.createBox(t);o=this.boolean(o,a),t.depth/=3;let n=this.createBox(t);return i.add(o,n),i}setFrameBorder(e,t=!1){this.setParameter("frameBorder",e,t)}getFrameBorder(){return this.parameter.frameBorder}setDoorDepth(e,t=!1){this.setParameter("doorDepth",e,t)}getDoorDepth(){return this.parameter.doorDepth}setDoorNum(e,t=!1){this.setParameter("doorNum",e,t)}getDoorNum(){return this.parameter.doorNum}setDoorCoincide(e,t=!1){this.setParameter("doorCoincide",e,t)}getDoorCoincide(){return this.parameter.doorCoincide}setFrameTexture(e,t=!1){this.setParameter("frameTexture",e,t)}getFrameTexture(){return this.parameter.frameTexture}setDoorTexture(e,t=!1){this.setParameter("doorTexture",e,t)}getDoorTexture(){return this.parameter.doorTexture}setDoorBorder(e,t=!1){this.setParameter("doorBorder",e,t)}getDoorBorder(){return this.parameter.doorBorder}setDoorGap(e,t=!1){this.setParameter("doorGap",e,t)}getDoorGap(){return this.parameter.doorGap}}}),parcelRequire.register("4cEbr",function(e,t){$parcel$export(e.exports,"BaseWindowMesh",()=>o);var i=parcelRequire("9vZPJ"),r=parcelRequire("4xklQ");class o extends i.Base3DMesh{constructor(e={}){if(super(),this.type="BaseWindowMesh",e.style=e.style||1,e.width=e.width||1600,e.height=e.height||1200,e.depth=e.depth||100,e.frameBorder=e.frameBorder||50,e.windowDepth=e.windowDepth||40,e.windowBorder=e.windowBorder||50,e.windowCoincide=e.windowCoincide||50,e.heightFromGround=e.heightFromGround||500,2==e.style&&(e.height=e.height||1500,e.top=e.top||"double",e.bottom=e.bottom||"double",e.rungPosition=e.rungPosition||"top|"+(e.height-3*e.frameBorder)/4,e.rungHeight=e.rungHeight||50),!e.frameTexture){let t=e.editor.config.baseWindowFrame;t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,e.frameTexture=new r.MeshStandardMaterial({map:t})}if(!e.windowTexture){let t=e.editor.config.baseWindowFace;t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,e.windowTexture=new r.MeshStandardMaterial({map:t})}e.mirrorTexture=new r.MeshStandardMaterial({color:new r.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new r.Vector2(1,-1),side:2,transparent:!0,opacity:.1,roughness:.1}),this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.frameTexture},t=this.createBox(e);1==this.parameter.style&&this.createStyle1(t),2==this.parameter.style&&this.createStyle2(t)}createStyle1(e){let t=this.parameter.width-2*this.parameter.frameBorder,i=this.parameter.height-2*this.parameter.frameBorder,o={width:t,height:i,depth:this.parameter.depth},a=this.createBox(o),n=this.boolean(e,a),s=this.createSingleWindow(t,i,this.parameter.windowBorder,this.parameter.windowDepth),l=t/2+this.parameter.windowBorder/2,h=s.clone();s.position.add(new r.Vector3((this.parameter.windowBorder-l)/2,0,this.parameter.windowDepth/2)),h.position.add(new r.Vector3(-(this.parameter.windowBorder-l)/2,0,-this.parameter.windowDepth/2)),this.add(n,s,h)}createStyle2(e){let t,i=this.parameter.width-2*this.parameter.frameBorder,o=this.parameter.height-2*this.parameter.frameBorder,a=this.parameter.rungPosition.split("|"),n=parseFloat(a[1]);if(n>o-this.parameter.rungHeight){console.log("数据不合法，请检查参数。");return}console.log(a);let s=this.getFinalFrame(e,a[0],n,i,o);this.add(s);let l={width:i,depth:this.parameter.windowDepth/4,material:new r.MeshBasicMaterial({color:16711680,transparent:!0,opacity:.5})},h=i/2+this.parameter.windowBorder/2;if("single"==this.parameter.top){"top"==a[0]&&(l.height=n),"bottom"==a[0]&&(l.height=o-n-this.parameter.rungHeight);let e=this.createBox(l);e.position.add(new r.Vector3(0,(o-l.height)/2,0)),this.add(e)}else if("double"==this.parameter.top){"top"==a[0]&&(t=n),"bottom"==a[0]&&(t=o-n-this.parameter.rungHeight);let e=this.createSingleWindow(i,t,this.parameter.windowBorder,this.parameter.windowDepth);e.position.add(new r.Vector3((this.parameter.windowBorder-h)/2,(o-t)/2,this.parameter.windowDepth/2));let s=this.createSingleWindow(i,t,this.parameter.windowBorder,this.parameter.windowDepth);s.position.add(new r.Vector3(-(this.parameter.windowBorder-h)/2,(o-t)/2,-this.parameter.windowDepth/2)),this.add(e,s)}if("single"==this.parameter.bottom){"top"==a[0]&&(l.height=o-n-this.parameter.rungHeight),"bottom"==a[0]&&(l.height=n);let e=this.createBox(l);e.position.add(new r.Vector3(0,-(o-l.height)/2,0)),this.add(e)}else if("double"==this.parameter.bottom){"top"==a[0]&&(t=o-n-this.parameter.rungHeight),"bottom"==a[0]&&(t=n);let e=this.createSingleWindow(i,t,this.parameter.windowBorder,this.parameter.windowDepth);e.position.add(new r.Vector3((this.parameter.windowBorder-h)/2,-(o-t)/2,this.parameter.windowDepth/2));let s=this.createSingleWindow(i,t,this.parameter.windowBorder,this.parameter.windowDepth);s.position.add(new r.Vector3(-(this.parameter.windowBorder-h)/2,-(o-t)/2,-this.parameter.windowDepth/2)),this.add(e,s)}}getFinalFrame(e,t,i,o,a){let n,s;if("top"==t){let e={width:o,height:i,depth:this.parameter.depth,material:new r.MeshBasicMaterial({color:65280})};(n=this.createBox(e)).position.add(new r.Vector3(0,(a-i)/2,0));let t={width:o,height:a-i-this.parameter.rungHeight,depth:this.parameter.depth,material:new r.MeshBasicMaterial({color:16711680})};(s=this.createBox(t)).position.add(new r.Vector3(0,(t.height-a)/2,0))}if("bottom"==t){let e={width:o,height:i,depth:this.parameter.depth,material:new r.MeshBasicMaterial({color:16711680})};(s=this.createBox(e)).position.add(new r.Vector3(0,-(a-i)/2,0));let t={width:o,height:a-i-this.parameter.rungHeight,depth:this.parameter.depth,material:new r.MeshBasicMaterial({color:65280})};(n=this.createBox(t)).position.add(new r.Vector3(0,(a-t.height)/2,0))}let l=this.boolean(n,s,"union");return e=this.boolean(e,l)}setFrameBorder(e,t=!1){this.setParameter("frameBorder",e,t)}getFrameBorder(){return this.parameter.frameBorder}setWindowDepth(e,t=!1){this.setParameter("windowDepth",e,t)}getWindowDepth(){return this.parameter.windowDepth}setWindowBorder(e,t=!1){this.setParameter("windowBorder",e,t)}getWindowBorder(){return this.parameter.windowBorder}setWindowCoincide(e,t=!1){this.setParameter("windowCoincide",e,t)}getWindowCoincide(){return this.parameter.windowCoincide}setFrameTexture(e,t=!1){this.setParameter("frameTexture",e,t)}getFrameTexture(){return this.parameter.frameTexture}}}),parcelRequire.register("eDeYG",function(e,t){$parcel$export(e.exports,"FrenchWindowMesh",()=>o);var i=parcelRequire("9vZPJ"),r=parcelRequire("4xklQ");class o extends i.Base3DMesh{constructor(e={}){super(),this.type="FrenchWindowMesh",e.style=e.style||1,e.width=e.width||2e3,e.height=e.height||1800,e.depth=e.depth||80,e.frameBorder=e.frameBorder||50,e.middleRatio=e.middleRatio||750/1800,e.gap=e.gap||15,e.bulge=e.bulge||5;let t=e.editor.config.baseWindowFrame;t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,e.frameTexture=new r.MeshStandardMaterial({map:t});let i=e.editor.config.baseWindowFace;i.wrapS=r.RepeatWrapping,i.wrapT=r.RepeatWrapping,e.windowTexture=new r.MeshStandardMaterial({map:i}),e.mirrorTexture=new r.MeshStandardMaterial({color:new r.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new r.Vector2(1,-1),side:2,transparent:!0,opacity:.1,roughness:.1}),this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.frameTexture},t=this.createBox(e);1==this.parameter.style&&this.createStyle1(t),2==this.parameter.style&&this.createStyle2(t)}createStyle1(e){let t=this.parameter.width-4*this.parameter.frameBorder,i=this.parameter.height-3*this.parameter.frameBorder,o=this.getStyle1Hole(t,i),a=this.boolean(e,o);this.add(a);let n={width:t*this.parameter.middleRatio,height:.75*i,depth:this.parameter.depth/8,material:this.parameter.mirrorTexture},s=this.createBox(n);s.name="glass",s.position.add(new r.Vector3(0,(i-n.height)/2,0));let l={width:(t+this.parameter.frameBorder)/2,height:.25*i,depth:this.parameter.depth/8,material:this.parameter.mirrorTexture},h=this.createBox(l);h.name="glass",h.position.add(new r.Vector3(-(t+2*this.parameter.frameBorder-l.width)/2,(l.height-(i+this.parameter.frameBorder))/2,0));let c=this.createBox(l);c.name="glass",c.position.add(new r.Vector3((t+2*this.parameter.frameBorder-l.width)/2,(l.height-(i+this.parameter.frameBorder))/2,0)),this.add(s,h,c);let d=this.createTuWindow(t,i);d.position.add(new r.Vector3(-((t-t*(1-this.parameter.middleRatio)/2-this.parameter.gap)/2+this.parameter.frameBorder),.25*i/2,this.parameter.depth/4+this.parameter.bulge));let p=this.createTuWindow(t,i);p.position.add(new r.Vector3((t-t*(1-this.parameter.middleRatio)/2-this.parameter.gap)/2+this.parameter.frameBorder,.25*i/2,this.parameter.depth/4+this.parameter.bulge)),this.add(d,p)}createTuWindow(e,t){let i=new r.Group,o={width:e*(1-this.parameter.middleRatio)/2+this.parameter.gap,height:.75*t+2*this.parameter.gap,depth:this.parameter.depth/2,material:this.parameter.windowTexture},a=this.createBox(o),n={width:o.width,height:this.parameter.gap,depth:o.depth-this.parameter.bulge,material:new r.MeshBasicMaterial({color:16711680})},s={width:this.parameter.gap/2,height:o.height,depth:o.depth-this.parameter.bulge,material:new r.MeshBasicMaterial({color:16711680})},l=this.createBox(n);l.position.add(new r.Vector3(0,(o.height-n.height)/2,-this.parameter.bulge/1));let h=this.createBox(n);h.position.add(new r.Vector3(0,(n.height-o.height)/2,-this.parameter.bulge/1));let c=this.createBox(s);c.position.add(new r.Vector3(-(s.width-o.width)/2,0,-this.parameter.bulge/1));let d=this.createBox(s);d.position.add(new r.Vector3((s.width-o.width)/2,0,-this.parameter.bulge/1));let p={width:o.width-2*this.parameter.frameBorder,height:o.height-2*this.parameter.frameBorder,depth:o.depth,material:this.parameter.mirrorTexture},u=this.createBox(p);[l,h,c,d].forEach(e=>{u=this.boolean(u,e,"union")}),a=this.boolean(a,u);let m=this.createBox(p);return m.name="glass",i.add(a,m),i}getStyle1Hole(e,t){let i={width:e*(1-this.parameter.middleRatio)/2,height:.75*t,depth:this.parameter.depth},o={width:e*this.parameter.middleRatio,height:.75*t,depth:this.parameter.depth},a={width:(e+this.parameter.frameBorder)/2,height:.25*t,depth:this.parameter.depth},n=this.createBox(i);n.position.add(new r.Vector3(-((e-i.width)/2+this.parameter.frameBorder)/1,(t-i.height)/2,0));let s=this.createBox(i);s.position.add(new r.Vector3(((e-i.width)/2+this.parameter.frameBorder)/1,(t-i.height)/2,0));let l=this.createBox(o);l.position.add(new r.Vector3(0,(t-o.height)/2,0));let h=this.createBox(a);h.position.add(new r.Vector3(-(e+2*this.parameter.frameBorder-a.width)/2,(a.height-(t+this.parameter.frameBorder))/2,0));let c=this.createBox(a);c.position.add(new r.Vector3((e+2*this.parameter.frameBorder-a.width)/2,(a.height-(t+this.parameter.frameBorder))/2,0));let d=n;return[s,l,h,c].forEach(e=>{d=this.boolean(d,e,"union")}),d}createStyle2(e){}}}),parcelRequire.register("b4XIY",function(e,t){$parcel$export(e.exports,"LashDoorMesh",()=>a);var i=parcelRequire("4xklQ"),r=parcelRequire("9vZPJ"),o=parcelRequire("hu0fb");class a extends r.Base3DMesh{constructor(e={}){if(super(),this.type="LashDoorMesh",e.style=e.style||1,e.width=e.width||1100,e.height=e.height||2200,e.depth=e.depth||240,e.frameBorder=e.frameBorder||10,e.coincide=e.coincide||3,e.doorDep=e.doorDep||50,e.handleEdge=e.handleEdge||50,e.handleBtm=e.handleBtm||1e3,!e.frameTexture){let t=e.editor.config.baseDoorFrame;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.frameTexture=new i.MeshStandardMaterial({map:t})}if(!e.doorTexture){let t=e.editor.config.baseDoorFace;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.doorTexture=new i.MeshStandardMaterial({map:t})}if(!e.partitionTexture){let t=e.editor.config.lashDoorPartition;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.partitionTexture=new i.MeshStandardMaterial({map:t})}this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.frameTexture},t=this.createBox(e);1==this.parameter.style&&this.createStyle1(t),2==this.parameter.style&&this.createStyle2(t);let i=this.createDoorstone();this.add(i)}createStyle1(e){let t=this.parameter.width-2*this.parameter.frameBorder,r=this.parameter.height-this.parameter.frameBorder,o={width:t,height:r,depth:this.parameter.depth},a=this.createBox(o);a.position.set(0,-this.parameter.frameBorder/2,0);let n=this.boolean(e,a);this.add(n);let s={width:.33*t-this.parameter.coincide/2,height:r,depth:this.parameter.doorDep,material:this.parameter.doorTexture},l=this.createBox(s);l.position.add(new i.Vector3((t-s.width+this.parameter.coincide/2)/2,-this.parameter.frameBorder/2,0)),console.log("partition - ",this.parameter.coincide);let h={width:this.parameter.coincide,height:r,depth:this.parameter.doorDep,material:this.parameter.partitionTexture},c=this.createBox(h);c.translateX(.17*t),c.translateY(-this.parameter.frameBorder/2),this.add(c);let d={width:.67*t-this.parameter.coincide/2,height:r,depth:this.parameter.doorDep,material:this.parameter.doorTexture},p=this.createBox(d);return p.position.add(new i.Vector3(-(t-d.width+this.parameter.coincide/2)/2,-this.parameter.frameBorder/2,0)),this.add(l,p),this.addHandle(),this}createStyle2(e){}addHandle(){let e=new o.GLTFLoader,t=this;e.load(window.url+"/assets/component/outerHandle.glb",function(e){let r=e.scene.children[0];r.applyMatrix4(new(0,i.Matrix4)().makeScale(-1e3,1e3,1e3)),e.scene.traverse(function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)});let o=new i.Box3().setFromObject(r);r.translateX(.17*t.parameter.width-o.max.x-t.parameter.handleEdge),r.translateY(o.max.y-t.parameter.height/2+t.parameter.handleBtm),r.translateZ(-(o.max.z+t.parameter.doorDep/2)),t.add(r)}),e.load(window.url+"/assets/component/innerHandle.glb",function(e){let r=e.scene.children[0];r.applyMatrix4(new(0,i.Matrix4)().makeScale(-1e3,1e3,1e3)),e.scene.traverse(function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)});let o=new i.Box3().setFromObject(r);r.translateX(.17*t.parameter.width-o.max.x-t.parameter.handleEdge),r.translateY(o.max.y-t.parameter.height/2+t.parameter.handleBtm-59.08065149103135),r.translateZ(o.max.z+t.parameter.doorDep/2),t.add(r)})}}}),parcelRequire.register("gKzkd",function(e,t){$parcel$export(e.exports,"PassMesh",()=>o);var i=parcelRequire("9vZPJ"),r=parcelRequire("4xklQ");class o extends i.Base3DMesh{constructor(e={}){if(super(),this.type="PassDoorMesh",e.width=e.width||900,e.height=e.height||2250,e.depth=e.depth||100,e.frameBorder=e.frameBorder||50,!e.frameTexture){let t=e.editor.config.passMeshTexture;t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,e.frameTexture=new r.MeshStandardMaterial({map:t})}this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.frameTexture},t=this.createBox(e),i={width:this.parameter.width-2*this.parameter.frameBorder,height:this.parameter.height-this.parameter.frameBorder,depth:this.parameter.depth},r=this.createBox(i);r.position.set(0,-this.parameter.frameBorder,0);let o=this.boolean(t,r),a=this.createDoorstone();this.add(o,a)}}}),parcelRequire.register("7T7Cq",function(e,t){$parcel$export(e.exports,"SectorDoorMesh",()=>a);var i=parcelRequire("4xklQ"),r=parcelRequire("9vZPJ"),o=parcelRequire("hu0fb");class a extends r.Base3DMesh{constructor(e={}){if(super(),this.type="SectorDoorMesh",e.width=e.width||860,e.height=e.height||2e3,e.depth=e.depth||65,e.frameBorder=e.frameBorder||38,e.doorDep=e.doorDep||50,e.handleEdge=e.handleEdge||50,e.handleBtm=e.handleBtm||1e3,!e.frameTexture){let t=e.editor.config.baseDoorFrame;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.frameTexture=new i.MeshStandardMaterial({map:t})}if(!e.texture){let t=e.editor.config.sectorDoorTexture;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.texture=new i.MeshStandardMaterial({map:t})}this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.frameTexture},t=this.createArchBox(e),i={width:this.parameter.width-2*this.parameter.frameBorder,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.texture},r=this.createArchBox(i);t=this.boolean(t,r),i.depth=this.parameter.doorDep;let o=this.createArchBox(i),a=this.createDoorstone();this.add(t,o,a),this.addHandle()}addHandle(){let e=new o.GLTFLoader,t=this;e.load(window.url+"/assets/component/outerHandle.glb",function(e){let r=e.scene.children[0];r.applyMatrix4(new(0,i.Matrix4)().makeScale(-1e3,1e3,1e3)),e.scene.traverse(function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)});let o=new i.Box3().setFromObject(r);r.translateX(t.parameter.width/2-o.max.x-t.parameter.frameBorder-t.parameter.handleEdge),r.translateY(o.max.y-t.parameter.height/2+t.parameter.handleBtm),r.translateZ(-(o.max.z+t.parameter.doorDep/2)),t.add(r)}),e.load(window.url+"/assets/component/innerHandle.glb",function(e){let r=e.scene.children[0];r.applyMatrix4(new(0,i.Matrix4)().makeScale(-1e3,1e3,1e3)),e.scene.traverse(function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)});let o=new i.Box3().setFromObject(r);r.translateX(t.parameter.width/2-o.max.x-t.parameter.frameBorder-t.parameter.handleEdge),r.translateY(o.max.y-t.parameter.height/2+t.parameter.handleBtm-59.08065149103135),r.translateZ(o.max.z+t.parameter.doorDep/2),t.add(r)})}}}),parcelRequire.register("fxI5g",function(e,t){$parcel$export(e.exports,"SectorWindowMesh",()=>o);var i=parcelRequire("4xklQ"),r=parcelRequire("9vZPJ");class o extends r.Base3DMesh{constructor(e={}){if(super(),this.type="SectorWindowMesh",e.style=e.style||1,e.width=e.width||1600,e.height=e.height||1600,e.depth=e.depth||100,e.frameBorder=e.frameBorder||50,!e.texture){let t=e.editor.config.baseWindowFrame;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.texture=new i.MeshStandardMaterial({map:t})}if(!e.windowTexture){let t=e.editor.config.baseWindowFace;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.windowTexture=new i.MeshStandardMaterial({map:t})}e.mirrorTexture=new i.MeshStandardMaterial({color:new i.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new i.Vector2(1,-1),side:2,transparent:!0,opacity:.1,roughness:.1}),this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.texture},t=this.createBox(e),r={width:this.parameter.width-2*this.parameter.frameBorder,height:this.parameter.height-2*this.parameter.frameBorder,depth:this.parameter.depth,material:new i.MeshBasicMaterial({color:16711680})},o=this.createBox(r),a=this.boolean(t,o);this.add(a);let n=new i.CylinderGeometry(this.parameter.width/2,this.parameter.width/2,this.parameter.depth/1,32),s=new i.Mesh(n,this.parameter.texture);s.position.y=this.parameter.height/2/1,s.rotation.x=Math.PI/2,s=this.boolean(s,t);let l=(this.parameter.width-2*this.parameter.frameBorder)/2,h=new i.CylinderGeometry(l,l,this.parameter.depth/1,32),c=new i.Mesh(h,new i.MeshBasicMaterial({color:16711680}));c.position.y=this.parameter.height/2/1,c.rotation.x=Math.PI/2,c=this.boolean(c,t),s=this.boolean(s,c),this.add(s);let d=new i.CylinderGeometry(l,l,this.parameter.depth/10,32),p=new i.Mesh(d,this.parameter.mirrorTexture);p.position.y=this.parameter.height/2/1,p.rotation.x=Math.PI/2,(p=this.boolean(p,t)).name="glass",this.add(p),1==this.parameter.style&&this.createStyle1(),2==this.parameter.style&&this.createStyle2()}createStyle1(){let e=40,t=this.parameter.width-2*this.parameter.frameBorder,r=this.parameter.height-2*this.parameter.frameBorder,o=this.createSingleWindow(t,r,this.parameter.frameBorder,e);o.position.add(new i.Vector3((-t/2+this.parameter.frameBorder/2)/2,0,e/2));let a=this.createSingleWindow(t,r,this.parameter.frameBorder,e);a.position.add(new i.Vector3((t/2-this.parameter.frameBorder/2)/2,0,-e/2)),this.add(o,a)}createStyle2(){let e={width:this.parameter.width-2*this.parameter.frameBorder,height:this.parameter.height-2*this.parameter.frameBorder,depth:this.parameter.depth/10,material:this.parameter.mirrorTexture},t=this.createBox(e);this.add(t)}}}),parcelRequire.register("eiZ6q",function(e,t){$parcel$export(e.exports,"ArcBaseWindowMesh",()=>o);var i=parcelRequire("4xklQ"),r=parcelRequire("9vZPJ");class o extends r.Base3DMesh{constructor(e={}){if(super(),this.type="ArcBaseWindowMesh",e.height=e.height||1600,e.startAngle=e.startAngle||Math.PI/4,e.endAngle=e.endAngle||.75*Math.PI,e.radius=e.radius||2e3,e.thickness=e.thickness||120,e.frameBorder=e.frameBorder||50,!e.texture){let t=e.editor.config.baseWindowFrame;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.texture=new i.MeshStandardMaterial({map:t})}this.mirrorTexture=new i.MeshStandardMaterial({color:new i.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new i.Vector2(1,-1),side:2,transparent:!0,opacity:.1,roughness:.1}),this.parameter=e}create(){console.log(this.parameter.radius,this.parameter.thickness);let e=this.parameter.radius+this.parameter.thickness/2,t=this.parameter.radius-this.parameter.thickness/2,r=Math.round(Math.PI/Math.asin(this.parameter.thickness/(e+this.parameter.thickness))/2);r=r>100?100:r;let o=this.getArcPath(e,this.parameter.startAngle,this.parameter.endAngle,r,!0),a=this.getArcPath(t,this.parameter.startAngle,this.parameter.endAngle,r,!0),n=o.concat(a.reverse()),s=this.createShapeOrStereoscopic(n,this.parameter.height,this.parameter.texture),l=this.parameter.frameBorder/t,h=this.parameter.startAngle+l,c=this.parameter.endAngle-l,d=this.parameter.height-2*this.parameter.frameBorder,p=this.getArcPath(e+1,h,c,r,!0),u=this.getArcPath(t-1,h,c,r,!0),m=p.concat(u.reverse()),g=this.createShapeOrStereoscopic(m,d,new i.MeshBasicMaterial({color:16711680}));g.position.y=this.parameter.frameBorder;let f=this.boolean(s,g);this.add(f);let w=this.parameter.radius+this.parameter.thickness/4,y=this.parameter.radius-this.parameter.thickness/4,b=this.getArcPath(w,h,c,r,!0),x=this.getArcPath(y,h,c,r,!0),P=b.concat(x.reverse()),v=this.createShapeOrStereoscopic(P,d,this.mirrorTexture);v.position.y=this.parameter.frameBorder,v.name="glass",this.add(v)}getArcPath(e,t,r,o,a=!1){let n=new i.Path;return n.arc(0,0,e,t,r,!1),a?n.getPoints(o):n}}}),parcelRequire.register("heK7I",function(e,t){$parcel$export(e.exports,"LWindowMesh",()=>o);var i=parcelRequire("4xklQ"),r=parcelRequire("9vZPJ");class o extends r.Base3DMesh{constructor(e={}){if(super(),this.type="LWindowMesh",e.style=e.style||1,e.leftPoint=e.leftPoint||new i.Vector2(0,-1320),e.commonPoint=e.commonPoint||new i.Vector2,e.rightPoint=e.rightPoint||new i.Vector2(1320,0),e.height=e.height||1600,e.leftDepth=e.leftDepth||120,e.rightDepth=e.rightDepth||120,e.frameBorder=e.frameBorder||50,!e.texture){let t=e.editor.config.baseWindowFrame;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.texture=new i.MeshStandardMaterial({map:t})}function t(e,t,r,o,a){let n=new(0,i.Vector2)().subVectors(t,e).normalize(),s=new(0,i.Vector2)().subVectors(r,t).normalize(),l=new(0,i.Vector2)(-s.y,s.x).normalize(),h=a/n.dot(l),c=n.clone().setLength(h),d=new(0,i.Vector2)(-n.y,n.x).normalize(),p=o/s.clone().negate().dot(d),u=s.clone().negate().setLength(p);return c.add(u)}this.mirrorTexture=new i.MeshStandardMaterial({color:new i.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new i.Vector2(1,-1),side:2,transparent:!0,opacity:.1,roughness:.1}),function(e){let i=t(e.leftPoint,e.commonPoint,e.rightPoint,e.leftDepth/2,e.rightDepth/2),r=i.angle(),o=e.leftPoint.clone().sub(e.commonPoint).angle(),a=e.rightPoint.clone().sub(e.commonPoint).angle(),n=r>a?r-a:r+2*Math.PI-a,s=r<o?Math.PI-o+r:r-o-Math.PI,l=Math.abs(e.rightDepth/2/Math.tan(n)),h=Math.abs(e.leftDepth/2/Math.tan(s));e.miter=i,e.leftDiff=Math.round(100*h)/100,e.rightDiff=Math.round(100*l)/100}(e),this.parameter=e}create(){let e=this.parameter.commonPoint.clone().add(this.parameter.miter),t=e.clone().add(this.parameter.miter),r=e.clone().add(this.parameter.commonPoint).divideScalar(2),o=e.clone().add(t).divideScalar(2),a=this.parameter.leftPoint.clone().sub(this.parameter.commonPoint),n=this.parameter.leftPoint.clone().distanceTo(this.parameter.commonPoint)+2*this.parameter.leftDiff,s=t.clone().add(a.clone().setLength(n)),l=[this.parameter.commonPoint,this.parameter.leftPoint,s,t],h=this.createShapeOrStereoscopic(l,this.parameter.height,this.parameter.texture),c=this.parameter.leftPoint.clone().add(a.clone().negate().setLength(this.parameter.frameBorder)),d=s.clone().add(a.clone().negate().setLength(this.parameter.frameBorder)),p=10,u=this.parameter.commonPoint.clone().add(this.parameter.commonPoint.clone().sub(t).setLength(p));u=u.clone().add(u.clone().sub(c).setLength(p));let m=t.clone().add(t.clone().sub(this.parameter.commonPoint).setLength(p));m=m.clone().add(m.clone().sub(d).setLength(p));let g=c.clone().add(c.clone().sub(d).setLength(p)),f=d.clone().add(d.clone().sub(c).setLength(p)),w=[u,g,f,m],y=this.createShapeOrStereoscopic(w,this.parameter.height-2*this.parameter.frameBorder,new i.MeshBasicMaterial({color:65280}));y.position.y=this.parameter.frameBorder,h=this.boolean(h,y);let b=r.clone().add(a.clone().setLength(a.length()-this.parameter.frameBorder+this.parameter.leftDiff/2)),x=o.clone().add(a.clone().setLength(a.length()-this.parameter.frameBorder+3*this.parameter.leftDiff/2)),P=[r,b,x,o],v=this.createShapeOrStereoscopic(P,this.parameter.height-2*this.parameter.frameBorder,this.mirrorTexture);v.position.y=this.parameter.frameBorder,v.name="glass";let M=this.parameter.rightPoint.clone().sub(this.parameter.commonPoint),C=this.parameter.rightPoint.clone().distanceTo(this.parameter.commonPoint)+2*this.parameter.rightDiff,D=t.clone().add(M.clone().setLength(C)),T=[this.parameter.commonPoint,this.parameter.rightPoint,D,t],S=this.createShapeOrStereoscopic(T,this.parameter.height,this.parameter.texture),k=this.parameter.rightPoint.clone().add(M.clone().negate().setLength(this.parameter.frameBorder)),V=D.clone().add(M.clone().negate().setLength(this.parameter.frameBorder));u=(u=this.parameter.commonPoint.clone().add(this.parameter.commonPoint.clone().sub(t).setLength(p))).clone().add(u.clone().sub(k).setLength(p)),m=(m=t.clone().add(t.clone().sub(this.parameter.commonPoint).setLength(p))).clone().add(m.clone().sub(V).setLength(p));let A=[u,g=k.clone().add(k.clone().sub(V).setLength(p)),f=V.clone().add(V.clone().sub(k).setLength(p)),m],L=this.createShapeOrStereoscopic(A,this.parameter.height-2*this.parameter.frameBorder,new i.MeshBasicMaterial({color:255}));L.position.y=this.parameter.frameBorder,S=this.boolean(S,L);let W=r.clone().add(M.clone().setLength(M.length()-this.parameter.frameBorder+this.parameter.rightDiff/2)),I=o.clone().add(M.clone().setLength(M.length()-this.parameter.frameBorder+3*this.parameter.rightDiff/2)),R=[r,W,I,o],B=this.createShapeOrStereoscopic(R,this.parameter.height-2*this.parameter.frameBorder,this.mirrorTexture);B.position.y=this.parameter.frameBorder,B.name="glass";let E=[b,x,o,I,W,r],O=this.createShapeOrStereoscopic(E,this.parameter.height-2*this.parameter.frameBorder,this.mirrorTexture);O.position.y=this.parameter.frameBorder,O.name="glass",this.add(h,S),this.add(O)}}}),parcelRequire.register("3tFct",function(e,t){$parcel$export(e.exports,"PanoramicWindowMesh",()=>o);var i=parcelRequire("4xklQ"),r=parcelRequire("9vZPJ");class o extends r.Base3DMesh{constructor(e={}){if(super(),this.type="PanoramicWindowMesh",e.width=e.width||2e3,e.height=e.height||2e3,e.depth=e.depth||1e3,e.platformBorder=e.platformBorder||100,e.windowFrameBorder=e.windowFrameBorder||50,e.thickness=e.thickness||240,e.top=e.top||"double",e.bottom=e.bottom||"double",e.rungPosition=e.rungPosition||"bottom|"+(e.height-3*e.windowFrameBorder)/4,!e.texture){let t=e.editor.config.baseWindowFrame;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.texture=new i.MeshStandardMaterial({map:t})}e.mirrorTexture=new i.MeshStandardMaterial({color:new i.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new i.Vector2(1,-1),side:2,transparent:!0,opacity:.1,roughness:.1}),this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:new i.MeshStandardMaterial({color:16777215})},t=this.createBox(e),r={width:this.parameter.width-2*this.parameter.platformBorder,height:this.parameter.height-2*this.parameter.platformBorder,depth:this.parameter.depth},o=this.createBox(r);(t=this.boolean(t,o)).position.add(new i.Vector3(0,0,this.parameter.thickness/2-e.depth/2)),this.createWindow(),this.add(t)}createWindow(){let e=this.parameter.width-2*this.parameter.platformBorder-2*this.parameter.windowFrameBorder,t=this.parameter.height-2*this.parameter.platformBorder-2*this.parameter.windowFrameBorder,i=this.parameter.rungPosition.split("|"),r=parseFloat(i[1]);if(r>t-this.parameter.windowFrameBorder){console.log("数据不合法，请检查参数。");return}this.getFinalWindow(i[0],r,e,t)}getFinalWindow(e,t,r,o){let a,n,s=new i.Group,l=100,h={width:this.parameter.width-2*this.parameter.platformBorder,height:this.parameter.height-2*this.parameter.platformBorder,depth:l,material:this.parameter.texture},c=this.createBox(h);if("top"==e){if("single"==this.parameter.top){let e={width:r,height:t,depth:100,material:new i.MeshBasicMaterial({color:65280})};(a=this.createBox(e)).position.add(new i.Vector3(0,(o-t)/2,0)),e.depth/=2,e.material=this.parameter.mirrorTexture;let n=this.createBox(e);n.position.add(new i.Vector3(0,(o-t)/2,0)),n.name="glass",s.add(n)}else if("double"==this.parameter.top){let e={width:(r-this.parameter.windowFrameBorder)/2,height:t,depth:100,material:new i.MeshBasicMaterial({color:65280})},n=this.createBox(e),l=n.clone();n.position.add(new i.Vector3(-(r+this.parameter.windowFrameBorder)/4,(o-t)/2,0)),l.position.add(new i.Vector3((r+this.parameter.windowFrameBorder)/4,(o-t)/2,0)),a=this.boolean(n,l,"union"),e.depth/=2,e.material=this.parameter.mirrorTexture;let h=this.createBox(e),c=h.clone();h.position.add(new i.Vector3(-(r+this.parameter.windowFrameBorder)/4,(o-t)/2,0)),c.position.add(new i.Vector3((r+this.parameter.windowFrameBorder)/4,(o-t)/2,0)),h.name="glass",c.name="glass",s.add(h,c)}if("single"==this.parameter.bottom){let e={width:r,height:o-t-this.parameter.windowFrameBorder,depth:100,material:new i.MeshBasicMaterial({color:16711680})};(n=this.createBox(e)).position.add(new i.Vector3(0,(e.height-o)/2,0)),e.depth/=2,e.material=this.parameter.mirrorTexture;let a=this.createBox(e);a.position.add(new i.Vector3(0,(e.height-o)/2,0)),a.name="glass",s.add(a)}else if("double"==this.parameter.bottom){let e={width:(r-this.parameter.windowFrameBorder)/2,height:o-t-this.parameter.windowFrameBorder,depth:100,material:new i.MeshBasicMaterial({color:16711680})},a=this.createBox(e),l=a.clone();a.position.add(new i.Vector3(-(r+this.parameter.windowFrameBorder)/4,(e.height-o)/2,0)),l.position.add(new i.Vector3((r+this.parameter.windowFrameBorder)/4,(e.height-o)/2,0)),n=this.boolean(a,l,"union"),e.depth/=2,e.material=this.parameter.mirrorTexture;let h=this.createBox(e),c=h.clone();h.position.add(new i.Vector3(-(r+this.parameter.windowFrameBorder)/4,(e.height-o)/2,0)),c.position.add(new i.Vector3((r+this.parameter.windowFrameBorder)/4,(e.height-o)/2,0)),h.name="glass",c.name="glass",s.add(h,c)}}else if("bottom"==e){if("single"==this.parameter.top){let e={width:r,height:o-t-this.parameter.windowFrameBorder,depth:100,material:new i.MeshBasicMaterial({color:65280})};(a=this.createBox(e)).position.add(new i.Vector3(0,(o-e.height)/2,0)),e.depth/=2,e.material=this.parameter.mirrorTexture;let n=this.createBox(e);n.position.add(new i.Vector3(0,(o-e.height)/2,0)),n.name="glass",s.add(n)}else if("double"==this.parameter.top){let e={width:(r-this.parameter.windowFrameBorder)/2,height:o-t-this.parameter.windowFrameBorder,depth:100,material:new i.MeshBasicMaterial({color:65280})},n=this.createBox(e),l=n.clone();n.position.add(new i.Vector3(-(r+this.parameter.windowFrameBorder)/4,(o-e.height)/2,0)),l.position.add(new i.Vector3((r+this.parameter.windowFrameBorder)/4,(o-e.height)/2,0)),a=this.boolean(n,l,"union"),e.depth/=2,e.material=this.parameter.mirrorTexture;let h=this.createBox(e),c=h.clone();h.position.add(new i.Vector3(-(r+this.parameter.windowFrameBorder)/4,(o-e.height)/2,0)),c.position.add(new i.Vector3((r+this.parameter.windowFrameBorder)/4,(o-e.height)/2,0)),h.name="glass",c.name="glass",s.add(h,c)}if("single"==this.parameter.bottom){let e={width:r,height:t,depth:100,material:new i.MeshBasicMaterial({color:16711680})};(n=this.createBox(e)).position.add(new i.Vector3(0,-(o-t)/2,0)),e.depth/=2,e.material=this.parameter.mirrorTexture;let a=this.createBox(e);a.position.add(new i.Vector3(0,-(o-t)/2,0)),a.name="glass",s.add(a)}else if("double"==this.parameter.bottom){let e={width:(r-this.parameter.windowFrameBorder)/2,height:t,depth:100,material:new i.MeshBasicMaterial({color:16711680})},a=this.createBox(e),l=a.clone();a.position.add(new i.Vector3(-(r+this.parameter.windowFrameBorder)/4,-(o-t)/2,0)),l.position.add(new i.Vector3((r+this.parameter.windowFrameBorder)/4,-(o-t)/2,0)),n=this.boolean(a,l,"union"),e.depth/=2,e.material=this.parameter.mirrorTexture;let h=this.createBox(e),c=h.clone();h.position.add(new i.Vector3(-(r+this.parameter.windowFrameBorder)/4,-(o-t)/2,0)),c.position.add(new i.Vector3((r+this.parameter.windowFrameBorder)/4,-(o-t)/2,0)),h.name="glass",c.name="glass",s.add(h,c)}}let d=this.boolean(a,n,"union");c=this.boolean(c,d),s.add(c),s.position.add(new i.Vector3(0,0,-this.parameter.depth+this.parameter.thickness/2+l/2)),this.add(s)}}}),parcelRequire.register("dFygm",function(e,t){$parcel$export(e.exports,"UWindowMesh",()=>a);var i=parcelRequire("4xklQ"),r=parcelRequire("9vZPJ"),o=parcelRequire("hrM0U");class a extends r.Base3DMesh{constructor(e={}){super(),this.type="UWindowMesh";let t=e.wallList[0].position,r=e.wallList[1].position;if((0,o.CommonFunc).getClockWise(t,e.middleWall.position,r)?(e.leftWall=e.wallList[1],e.rightWall=e.wallList[0]):(e.leftWall=e.wallList[0],e.rightWall=e.wallList[1]),e.leftPoint=new i.Vector2(-(e.width/2-3e3*e.leftWall.thickness/4),-(250*e.middleWall.thickness)),e.leftBPoint=new i.Vector2(e.leftPoint.x,-(e.windowThickL+500*e.middleWall.thickness)),e.rightPoint=new i.Vector2(e.width/2-3e3*e.rightWall.thickness/4,-(250*e.middleWall.thickness)),e.rightBPoint=new i.Vector2(e.rightPoint.x,-(e.windowThickR+500*e.middleWall.thickness)),e.frameBorer=e.frameBorer||50,!e.texture){let t=e.editor.config.baseWindowFrame;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.texture=new i.MeshStandardMaterial({map:t})}this.mirrorTexture=new i.MeshStandardMaterial({color:new i.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new i.Vector2(1,-1),side:2,transparent:!0,opacity:.1,roughness:.1}),this.parameter=e}create(){let e=this.parameter.leftPoint.clone().sub(this.parameter.leftBPoint),t=this.parameter.rightPoint.clone().sub(this.parameter.leftPoint),r=t.clone().negate().setLength(500*this.parameter.leftWall.thickness),o=this.parameter.leftBPoint.clone().add(r),a=this.parameter.leftPoint.clone().add(r),n=e.clone().setLength(500*this.parameter.middleWall.thickness),s=this.parameter.leftPoint.clone().add(n);this.parameter.rightPoint.clone().add(n);let l=t.clone().setLength(500*this.parameter.rightWall.thickness),h=this.parameter.rightPoint.clone().add(l),c=this.parameter.rightBPoint.clone().add(l),d=new(0,i.Path)().arc(this.parameter.leftPoint.x,this.parameter.leftPoint.y,500*this.parameter.leftWall.thickness,Math.PI,Math.PI/2,!0).getPoints(),p=new(0,i.Path)().arc(this.parameter.rightPoint.x,this.parameter.rightPoint.y,500*this.parameter.rightWall.thickness,Math.PI/2,0,!0).getPoints(),u=[this.parameter.leftBPoint,o,...d,...p,c,this.parameter.rightBPoint,this.parameter.rightPoint,this.parameter.leftPoint],m=this.createShapeOrStereoscopic(u,this.parameter.height,this.parameter.texture),g=e.clone().setLength(this.parameter.frameBorer),f=this.parameter.leftBPoint.clone().add(g),w=o.clone().add(g),y=a.clone().add(n),b=h.clone().add(n),x=c.clone().add(g),P=this.parameter.rightBPoint.clone().add(g),v=[f,w,y,b,x,P,this.parameter.rightPoint,this.parameter.leftPoint],M=this.createShapeOrStereoscopic(v,this.parameter.height-2*this.parameter.frameBorer,new i.MeshBasicMaterial({color:16711680}));M.position.y+=this.parameter.frameBorer,m=this.boolean(m,M);let C=f.clone().add(t.clone().negate().setLength(125*this.parameter.leftWall.thickness)),D=w.clone().add(t.clone().setLength(125*this.parameter.leftWall.thickness)),T=s.clone().add(e.clone().negate().setLength(125*this.parameter.middleWall.thickness)),S=new i.Vector2(D.x,T.y),k=h.clone().add(t.clone().negate().setLength(125*this.parameter.rightWall.thickness)),V=new i.Vector2(k.x,S.y),A=x.clone().add(t.clone().negate().setLength(125*this.parameter.rightWall.thickness)),L=P.clone().add(t.clone().setLength(125*this.parameter.rightWall.thickness)),W=h.clone().add(e.clone().setLength(125*this.parameter.middleWall.thickness)),I=new i.Vector2(L.x,W.y),R=new i.Vector2(C.x,I.y),B=[C,D,S,V,A,L,I,R],E=this.createShapeOrStereoscopic(B,this.parameter.height-2*this.parameter.frameBorer,this.mirrorTexture);E.name="glass",E.position.y+=this.parameter.frameBorer,this.add(m,E)}}}),parcelRequire.register("k63JT",function(e,t){$parcel$export(e.exports,"DooropenMesh",()=>r);var i=parcelRequire("9vZPJ");class r extends i.Base3DMesh{constructor(e={}){super(),this.type="PassMesh",this.parameter=e}create(){let e=this.createDoorstone();this.add(e)}}}),parcelRequire.register("ajbOv",function(e,t){e.exports=import("./"+parcelRequire("dRo73").resolve("fF1VX")).then(()=>parcelRequire("iNXBD"))}),parcelRequire.register("awRkS",function(e,t){$parcel$export(e.exports,"RGBELoader",()=>r);var i=parcelRequire("4xklQ");class r extends i.DataTextureLoader{constructor(e){super(e),this.type=i.HalfFloatType}parse(e){let t=-1,r=1,o=2,a=3,n=4,s=function(e,i){switch(e){case r:console.error("THREE.RGBELoader Read Error: "+(i||""));break;case o:console.error("THREE.RGBELoader Write Error: "+(i||""));break;case a:console.error("THREE.RGBELoader Bad File Format: "+(i||""));break;default:console.error("THREE.RGBELoader: Error: "+(i||""))}return t},l=1,h=2,c=4,d="\n",p=function(e,t,i){let r=128;t=t||1024;let o=e.pos,a=-1,n=0,s="",l=String.fromCharCode.apply(null,new Uint16Array(e.subarray(o,o+r)));for(;0>(a=l.indexOf(d))&&n<t&&o<e.byteLength;)s+=l,n+=l.length,o+=r,l+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(o,o+r)));return -1<a&&(!1!==i&&(e.pos+=n+a+1),s+l.slice(0,a))},u=function(e){let t,i;let o=/^#\?(\S+)/,n=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,d=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,u=/^\s*FORMAT=(\S+)\s*$/,m=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,g={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(t=p(e)))return s(r,"no header found");if(!(i=t.match(o)))return s(a,"bad initial token");for(g.valid|=l,g.programtype=i[1],g.string+=t+"\n";!1!==(t=p(e));){if(g.string+=t+"\n","#"===t.charAt(0)){g.comments+=t+"\n";continue}if((i=t.match(n))&&(g.gamma=parseFloat(i[1])),(i=t.match(d))&&(g.exposure=parseFloat(i[1])),(i=t.match(u))&&(g.valid|=h,g.format=i[1]),(i=t.match(m))&&(g.valid|=c,g.height=parseInt(i[1],10),g.width=parseInt(i[2],10)),g.valid&h&&g.valid&c)break}return g.valid&h?g.valid&c?g:s(a,"missing image size specifier"):s(a,"missing format specifier")},m=function(e,t,i){let o=t;if(o<8||o>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(o!==(e[2]<<8|e[3]))return s(a,"wrong scanline width");let l=new Uint8Array(4*t*i);if(!l.length)return s(n,"unable to allocate buffer space");let h=0,c=0,d=4*o,p=new Uint8Array(4),u=new Uint8Array(d),m=i;for(;m>0&&c<e.byteLength;){if(c+4>e.byteLength)return s(r);if(p[0]=e[c++],p[1]=e[c++],p[2]=e[c++],p[3]=e[c++],2!=p[0]||2!=p[1]||(p[2]<<8|p[3])!=o)return s(a,"bad rgbe scanline format");let t=0,i;for(;t<d&&c<e.byteLength;){i=e[c++];let r=i>128;if(r&&(i-=128),0===i||t+i>d)return s(a,"bad scanline data");if(r){let r=e[c++];for(let e=0;e<i;e++)u[t++]=r}else u.set(e.subarray(c,c+i),t),t+=i,c+=i}let n=o;for(let e=0;e<n;e++){let t=0;l[h]=u[e+t],t+=o,l[h+1]=u[e+t],t+=o,l[h+2]=u[e+t],t+=o,l[h+3]=u[e+t],h+=4}m--}return l},g=function(e,t,i,r){let o=e[t+3],a=Math.pow(2,o-128)/255;i[r+0]=e[t+0]*a,i[r+1]=e[t+1]*a,i[r+2]=e[t+2]*a,i[r+3]=1},f=function(e,t,r,o){let a=e[t+3],n=Math.pow(2,a-128)/255;r[o+0]=(0,i.DataUtils).toHalfFloat(Math.min(e[t+0]*n,65504)),r[o+1]=(0,i.DataUtils).toHalfFloat(Math.min(e[t+1]*n,65504)),r[o+2]=(0,i.DataUtils).toHalfFloat(Math.min(e[t+2]*n,65504)),r[o+3]=(0,i.DataUtils).toHalfFloat(1)},w=new Uint8Array(e);w.pos=0;let y=u(w);if(t!==y){let e=y.width,r=y.height,o=m(w.subarray(w.pos),e,r);if(t!==o){let t,a,n;switch(this.type){case i.FloatType:n=o.length/4;let s=new Float32Array(4*n);for(let e=0;e<n;e++)g(o,4*e,s,4*e);t=s,a=i.FloatType;break;case i.HalfFloatType:n=o.length/4;let l=new Uint16Array(4*n);for(let e=0;e<n;e++)f(o,4*e,l,4*e);t=l,a=i.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:e,height:r,data:t,header:y.string,gamma:y.gamma,exposure:y.exposure,type:a}}}return null}setDataType(e){return this.type=e,this}load(e,t,r,o){function a(e,r){switch(e.type){case i.FloatType:case i.HalfFloatType:e.encoding=i.LinearEncoding,e.minFilter=i.LinearFilter,e.magFilter=i.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)}return super.load(e,a,r,o)}}});var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ"),$0f7bfe5028a81ceb$var$tmp=new $4xklQ.Vector2,$0f7bfe5028a81ceb$var$capEnd=new $4xklQ.Vector2,$0f7bfe5028a81ceb$var$lineA=new $4xklQ.Vector2,$0f7bfe5028a81ceb$var$lineB=new $4xklQ.Vector2,$0f7bfe5028a81ceb$var$tangent=new $4xklQ.Vector2,$0f7bfe5028a81ceb$var$miter=new $4xklQ.Vector2;function $0f7bfe5028a81ceb$export$18d19c7a3aa33064(e){if(!(this instanceof $0f7bfe5028a81ceb$export$18d19c7a3aa33064))return new $0f7bfe5028a81ceb$export$18d19c7a3aa33064(e);e=e||{},this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||20,this.thickrules=e.thickrules||[],this.join=e.join||"miter",this.cap=e.cap||"butt",this._normal=null,this._lastFlip=-1,this._started=!1}function $0f7bfe5028a81ceb$var$extrusions(e,t,i,r,o,a){$0f7bfe5028a81ceb$var$scaleAndAdd($0f7bfe5028a81ceb$var$tmp,r,o,-a),e.push($0f7bfe5028a81ceb$var$tmp.clone().toArray()),i.push($0f7bfe5028a81ceb$var$tmp.clone().toArray()),$0f7bfe5028a81ceb$var$scaleAndAdd($0f7bfe5028a81ceb$var$tmp,r,o,a),e.push($0f7bfe5028a81ceb$var$tmp.clone().toArray()),t.push($0f7bfe5028a81ceb$var$tmp.clone().toArray())}function $0f7bfe5028a81ceb$var$direction(e,t,i){var r=new $4xklQ.Vector2(t[0],t[1]),o=new $4xklQ.Vector2(i[0],i[1]);return e.subVectors(r,o).normalize(),e}function $0f7bfe5028a81ceb$var$normal(e,t){return e.set(-t.y,t.x),e}function $0f7bfe5028a81ceb$var$scaleAndAdd(e,t,i,r){var o=new $4xklQ.Vector2(t[0],t[1]),a=i.clone().setLength(r);return e.addVectors(o,a)}function $0f7bfe5028a81ceb$var$computeMiter(e,t,i,r,o,a){var n=new(0,$4xklQ.Vector2)(-r.y,r.x).normalize(),s=a/i.dot(n),l=i.clone().setLength(s),h=new(0,$4xklQ.Vector2)(-i.y,i.x).normalize(),c=o/r.clone().negate().dot(h),d=r.clone().negate().setLength(c);return t.addVectors(l,d),t.length()}$0f7bfe5028a81ceb$export$18d19c7a3aa33064.prototype.mapThickness=function(e,t,i){var r=null;return this.thickrules.forEach(function(e){t>=e[0]&&t<=e[1]&&(r=e[2])}),null!=r?r:this.thickness},$0f7bfe5028a81ceb$export$18d19c7a3aa33064.prototype.clockwise=function(e){return e},$0f7bfe5028a81ceb$export$18d19c7a3aa33064.prototype.build=function(e){var t={positions:[],cells:[],outter:[],innner:[]};if(e.length<=1)return t;var i=e.length;this._lastFlip=-1,this._started=!1,this._normal=null;for(var r=1,o=0;r<i;r++){var a=e[r-1],n=e[r],s=r<e.length-1?e[r+1]:null,l=this.mapThickness(n,r,e),h=this.mapThickness(s,r+1,e),c=this._seg(t,o,a,n,s,l/2,h/2);o+=c}return this.clockwise(t)},$0f7bfe5028a81ceb$export$18d19c7a3aa33064.prototype._seg=function(e,t,i,r,o,a,n){var s=0,l=e.cells,h=e.positions,c=e.outter,d=e.innner,p="square"===this.cap,u="bevel"===this.join;if($0f7bfe5028a81ceb$var$direction($0f7bfe5028a81ceb$var$lineA,r,i),this._normal||(this._normal=new $4xklQ.Vector2,$0f7bfe5028a81ceb$var$normal(this._normal,$0f7bfe5028a81ceb$var$lineA)),this._started||(this._started=!0,p&&($0f7bfe5028a81ceb$var$scaleAndAdd($0f7bfe5028a81ceb$var$capEnd,i,$0f7bfe5028a81ceb$var$lineA,-a),i=$0f7bfe5028a81ceb$var$capEnd.toArray()),$0f7bfe5028a81ceb$var$extrusions(h,c,d,i,this._normal,a)),l.push([t+0,t+1,t+2]),o){$0f7bfe5028a81ceb$var$direction($0f7bfe5028a81ceb$var$lineB,o,r);var m=$0f7bfe5028a81ceb$var$computeMiter($0f7bfe5028a81ceb$var$tangent,$0f7bfe5028a81ceb$var$miter,$0f7bfe5028a81ceb$var$lineA,$0f7bfe5028a81ceb$var$lineB,a,n),g=0>$0f7bfe5028a81ceb$var$tangent.dot(this._normal)?-1:1,f=u;!f&&"miter"===this.join&&m/a>this.miterLimit&&(f=!0),f||($0f7bfe5028a81ceb$var$extrusions(h,c,d,r,$0f7bfe5028a81ceb$var$miter,m),l.push(1===this._lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3]),g=-1,this.normal=$0f7bfe5028a81ceb$var$miter.clone(),s+=2),this._lastFlip=g}else $0f7bfe5028a81ceb$var$normal(this._normal,$0f7bfe5028a81ceb$var$lineA),p&&($0f7bfe5028a81ceb$var$scaleAndAdd($0f7bfe5028a81ceb$var$capEnd,r,$0f7bfe5028a81ceb$var$lineA,a),r=$0f7bfe5028a81ceb$var$capEnd.toArray()),$0f7bfe5028a81ceb$var$extrusions(h,c,d,r,this._normal,a),l.push(1===this._lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3]),s+=2;return s};var $4xklQ=parcelRequire("4xklQ");const $a82ce66e6c7e4e60$export$4c2b49800098dff3={triangulate:function(e,t,i=2){let r,o,a,n,s,l,h;let c=t&&t.length,d=c?t[0]*i:e.length,p=$a82ce66e6c7e4e60$var$linkedList(e,0,d,i,!0),u=[];if(!p||p.next===p.prev)return u;if(c&&(p=$a82ce66e6c7e4e60$var$eliminateHoles(e,t,p,i)),e.length>80*i){r=a=e[0],o=n=e[1];for(let t=i;t<d;t+=i)s=e[t],l=e[t+1],s<r&&(r=s),l<o&&(o=l),s>a&&(a=s),l>n&&(n=l);h=0!==(h=Math.max(a-r,n-o))?1/h:0}return $a82ce66e6c7e4e60$var$earcutLinked(p,u,i,r,o,h),u}};function $a82ce66e6c7e4e60$var$linkedList(e,t,i,r,o){let a,n;if(o===$a82ce66e6c7e4e60$var$signedArea(e,t,i,r)>0)for(a=t;a<i;a+=r)n=$a82ce66e6c7e4e60$var$insertNode(a,e[a],e[a+1],n);else for(a=i-r;a>=t;a-=r)n=$a82ce66e6c7e4e60$var$insertNode(a,e[a],e[a+1],n);return n&&$a82ce66e6c7e4e60$var$equals(n,n.next)&&($a82ce66e6c7e4e60$var$removeNode(n),n=n.next),n}function $a82ce66e6c7e4e60$var$filterPoints(e,t){if(!e)return e;t||(t=e);let i=e,r;do if(r=!1,!i.steiner&&($a82ce66e6c7e4e60$var$equals(i,i.next)||0===$a82ce66e6c7e4e60$var$area(i.prev,i,i.next))){if($a82ce66e6c7e4e60$var$removeNode(i),(i=t=i.prev)===i.next)break;r=!0}else i=i.next;while(r||i!==t)return t}function $a82ce66e6c7e4e60$var$earcutLinked(e,t,i,r,o,a,n){if(!e)return;!n&&a&&$a82ce66e6c7e4e60$var$indexCurve(e,r,o,a);let s=e,l,h;for(;e.prev!==e.next;){if(l=e.prev,h=e.next,a?$a82ce66e6c7e4e60$var$isEarHashed(e,r,o,a):$a82ce66e6c7e4e60$var$isEar(e)){t.push(l.i/i),t.push(e.i/i),t.push(h.i/i),$a82ce66e6c7e4e60$var$removeNode(e),e=h.next,s=h.next;continue}if((e=h)===s){n?1===n?$a82ce66e6c7e4e60$var$earcutLinked(e=$a82ce66e6c7e4e60$var$cureLocalIntersections($a82ce66e6c7e4e60$var$filterPoints(e),t,i),t,i,r,o,a,2):2===n&&$a82ce66e6c7e4e60$var$splitEarcut(e,t,i,r,o,a):$a82ce66e6c7e4e60$var$earcutLinked($a82ce66e6c7e4e60$var$filterPoints(e),t,i,r,o,a,1);break}}}function $a82ce66e6c7e4e60$var$isEar(e){let t=e.prev,i=e,r=e.next;if($a82ce66e6c7e4e60$var$area(t,i,r)>=0)return!1;let o=e.next.next;for(;o!==e.prev;){if($a82ce66e6c7e4e60$var$pointInTriangle(t.x,t.y,i.x,i.y,r.x,r.y,o.x,o.y)&&$a82ce66e6c7e4e60$var$area(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function $a82ce66e6c7e4e60$var$isEarHashed(e,t,i,r){let o=e.prev,a=e,n=e.next;if($a82ce66e6c7e4e60$var$area(o,a,n)>=0)return!1;let s=o.x<a.x?o.x<n.x?o.x:n.x:a.x<n.x?a.x:n.x,l=o.y<a.y?o.y<n.y?o.y:n.y:a.y<n.y?a.y:n.y,h=o.x>a.x?o.x>n.x?o.x:n.x:a.x>n.x?a.x:n.x,c=o.y>a.y?o.y>n.y?o.y:n.y:a.y>n.y?a.y:n.y,d=$a82ce66e6c7e4e60$var$zOrder(s,l,t,i,r),p=$a82ce66e6c7e4e60$var$zOrder(h,c,t,i,r),u=e.prevZ,m=e.nextZ;for(;u&&u.z>=d&&m&&m.z<=p;){if(u!==e.prev&&u!==e.next&&$a82ce66e6c7e4e60$var$pointInTriangle(o.x,o.y,a.x,a.y,n.x,n.y,u.x,u.y)&&$a82ce66e6c7e4e60$var$area(u.prev,u,u.next)>=0||(u=u.prevZ,m!==e.prev&&m!==e.next&&$a82ce66e6c7e4e60$var$pointInTriangle(o.x,o.y,a.x,a.y,n.x,n.y,m.x,m.y)&&$a82ce66e6c7e4e60$var$area(m.prev,m,m.next)>=0))return!1;m=m.nextZ}for(;u&&u.z>=d;){if(u!==e.prev&&u!==e.next&&$a82ce66e6c7e4e60$var$pointInTriangle(o.x,o.y,a.x,a.y,n.x,n.y,u.x,u.y)&&$a82ce66e6c7e4e60$var$area(u.prev,u,u.next)>=0)return!1;u=u.prevZ}for(;m&&m.z<=p;){if(m!==e.prev&&m!==e.next&&$a82ce66e6c7e4e60$var$pointInTriangle(o.x,o.y,a.x,a.y,n.x,n.y,m.x,m.y)&&$a82ce66e6c7e4e60$var$area(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function $a82ce66e6c7e4e60$var$cureLocalIntersections(e,t,i){let r=e;do{let o=r.prev,a=r.next.next;!$a82ce66e6c7e4e60$var$equals(o,a)&&$a82ce66e6c7e4e60$var$intersects(o,r,r.next,a)&&$a82ce66e6c7e4e60$var$locallyInside(o,a)&&$a82ce66e6c7e4e60$var$locallyInside(a,o)&&(t.push(o.i/i),t.push(r.i/i),t.push(a.i/i),$a82ce66e6c7e4e60$var$removeNode(r),$a82ce66e6c7e4e60$var$removeNode(r.next),r=e=a),r=r.next}while(r!==e)return $a82ce66e6c7e4e60$var$filterPoints(r)}function $a82ce66e6c7e4e60$var$splitEarcut(e,t,i,r,o,a){let n=e;do{let e=n.next.next;for(;e!==n.prev;){if(n.i!==e.i&&$a82ce66e6c7e4e60$var$isValidDiagonal(n,e)){let s=$a82ce66e6c7e4e60$var$splitPolygon(n,e);n=$a82ce66e6c7e4e60$var$filterPoints(n,n.next),s=$a82ce66e6c7e4e60$var$filterPoints(s,s.next),$a82ce66e6c7e4e60$var$earcutLinked(n,t,i,r,o,a),$a82ce66e6c7e4e60$var$earcutLinked(s,t,i,r,o,a);return}e=e.next}n=n.next}while(n!==e)}function $a82ce66e6c7e4e60$var$eliminateHoles(e,t,i,r){let o,a,n,s,l;let h=[];for(o=0,a=t.length;o<a;o++)n=t[o]*r,s=o<a-1?t[o+1]*r:e.length,(l=$a82ce66e6c7e4e60$var$linkedList(e,n,s,r,!1))===l.next&&(l.steiner=!0),h.push($a82ce66e6c7e4e60$var$getLeftmost(l));for(h.sort($a82ce66e6c7e4e60$var$compareX),o=0;o<h.length;o++)$a82ce66e6c7e4e60$var$eliminateHole(h[o],i),i=$a82ce66e6c7e4e60$var$filterPoints(i,i.next);return i}function $a82ce66e6c7e4e60$var$compareX(e,t){return e.x-t.x}function $a82ce66e6c7e4e60$var$eliminateHole(e,t){if(t=$a82ce66e6c7e4e60$var$findHoleBridge(e,t)){let i=$a82ce66e6c7e4e60$var$splitPolygon(t,e);$a82ce66e6c7e4e60$var$filterPoints(t,t.next),$a82ce66e6c7e4e60$var$filterPoints(i,i.next)}}function $a82ce66e6c7e4e60$var$findHoleBridge(e,t){let i=t,r=e.x,o=e.y,a=-1/0,n;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){let e=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=r&&e>a){if(a=e,e===r){if(o===i.y)return i;if(o===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t)if(!n)return null;if(r===a)return n;let s=n,l=n.x,h=n.y,c=1/0,d;i=n;do r>=i.x&&i.x>=l&&r!==i.x&&$a82ce66e6c7e4e60$var$pointInTriangle(o<h?r:a,o,l,h,o<h?a:r,o,i.x,i.y)&&(d=Math.abs(o-i.y)/(r-i.x),$a82ce66e6c7e4e60$var$locallyInside(i,e)&&(d<c||d===c&&(i.x>n.x||i.x===n.x&&$a82ce66e6c7e4e60$var$sectorContainsSector(n,i)))&&(n=i,c=d)),i=i.next;while(i!==s)return n}function $a82ce66e6c7e4e60$var$sectorContainsSector(e,t){return 0>$a82ce66e6c7e4e60$var$area(e.prev,e,t.prev)&&0>$a82ce66e6c7e4e60$var$area(t.next,e,e.next)}function $a82ce66e6c7e4e60$var$indexCurve(e,t,i,r){let o=e;do null===o.z&&(o.z=$a82ce66e6c7e4e60$var$zOrder(o.x,o.y,t,i,r)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==e)o.prevZ.nextZ=null,o.prevZ=null,$a82ce66e6c7e4e60$var$sortLinked(o)}function $a82ce66e6c7e4e60$var$sortLinked(e){let t,i,r,o,a,n,s,l,h=1;do{for(i=e,e=null,a=null,n=0;i;){for(n++,r=i,s=0,t=0;t<h&&(s++,r=r.nextZ);t++);for(l=h;s>0||l>0&&r;)0!==s&&(0===l||!r||i.z<=r.z)?(o=i,i=i.nextZ,s--):(o=r,r=r.nextZ,l--),a?a.nextZ=o:e=o,o.prevZ=a,a=o;i=r}a.nextZ=null,h*=2}while(n>1)return e}function $a82ce66e6c7e4e60$var$zOrder(e,t,i,r,o){return(e=((e=((e=((e=((e=32767*(e-i)*o)|e<<8)&16711935)|e<<4)&252645135)|e<<2)&858993459)|e<<1)&1431655765)|(t=((t=((t=((t=((t=32767*(t-r)*o)|t<<8)&16711935)|t<<4)&252645135)|t<<2)&858993459)|t<<1)&1431655765)<<1}function $a82ce66e6c7e4e60$var$getLeftmost(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e)return i}function $a82ce66e6c7e4e60$var$pointInTriangle(e,t,i,r,o,a,n,s){return(o-n)*(t-s)-(e-n)*(a-s)>=0&&(e-n)*(r-s)-(i-n)*(t-s)>=0&&(i-n)*(a-s)-(o-n)*(r-s)>=0}function $a82ce66e6c7e4e60$var$isValidDiagonal(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!$a82ce66e6c7e4e60$var$intersectsPolygon(e,t)&&($a82ce66e6c7e4e60$var$locallyInside(e,t)&&$a82ce66e6c7e4e60$var$locallyInside(t,e)&&$a82ce66e6c7e4e60$var$middleInside(e,t)&&($a82ce66e6c7e4e60$var$area(e.prev,e,t.prev)||$a82ce66e6c7e4e60$var$area(e,t.prev,t))||$a82ce66e6c7e4e60$var$equals(e,t)&&$a82ce66e6c7e4e60$var$area(e.prev,e,e.next)>0&&$a82ce66e6c7e4e60$var$area(t.prev,t,t.next)>0)}function $a82ce66e6c7e4e60$var$area(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function $a82ce66e6c7e4e60$var$equals(e,t){return e.x===t.x&&e.y===t.y}function $a82ce66e6c7e4e60$var$intersects(e,t,i,r){let o=$a82ce66e6c7e4e60$var$sign($a82ce66e6c7e4e60$var$area(e,t,i)),a=$a82ce66e6c7e4e60$var$sign($a82ce66e6c7e4e60$var$area(e,t,r)),n=$a82ce66e6c7e4e60$var$sign($a82ce66e6c7e4e60$var$area(i,r,e)),s=$a82ce66e6c7e4e60$var$sign($a82ce66e6c7e4e60$var$area(i,r,t));return!!(o!==a&&n!==s||0===o&&$a82ce66e6c7e4e60$var$onSegment(e,i,t)||0===a&&$a82ce66e6c7e4e60$var$onSegment(e,r,t)||0===n&&$a82ce66e6c7e4e60$var$onSegment(i,e,r)||0===s&&$a82ce66e6c7e4e60$var$onSegment(i,t,r))}function $a82ce66e6c7e4e60$var$onSegment(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function $a82ce66e6c7e4e60$var$sign(e){return e>0?1:e<0?-1:0}function $a82ce66e6c7e4e60$var$intersectsPolygon(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&$a82ce66e6c7e4e60$var$intersects(i,i.next,e,t))return!0;i=i.next}while(i!==e)return!1}function $a82ce66e6c7e4e60$var$locallyInside(e,t){return 0>$a82ce66e6c7e4e60$var$area(e.prev,e,e.next)?$a82ce66e6c7e4e60$var$area(e,t,e.next)>=0&&$a82ce66e6c7e4e60$var$area(e,e.prev,t)>=0:0>$a82ce66e6c7e4e60$var$area(e,t,e.prev)||0>$a82ce66e6c7e4e60$var$area(e,e.next,t)}function $a82ce66e6c7e4e60$var$middleInside(e,t){let i=e,r=!1,o=(e.x+t.x)/2,a=(e.y+t.y)/2;do i.y>a!=i.next.y>a&&i.next.y!==i.y&&o<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e)return r}function $a82ce66e6c7e4e60$var$splitPolygon(e,t){let i=new $a82ce66e6c7e4e60$var$Node(e.i,e.x,e.y),r=new $a82ce66e6c7e4e60$var$Node(t.i,t.x,t.y),o=e.next,a=t.prev;return e.next=t,t.prev=e,i.next=o,o.prev=i,r.next=i,i.prev=r,a.next=r,r.prev=a,r}function $a82ce66e6c7e4e60$var$insertNode(e,t,i,r){let o=new $a82ce66e6c7e4e60$var$Node(e,t,i);return r?(o.next=r.next,o.prev=r,r.next.prev=o,r.next=o):(o.prev=o,o.next=o),o}function $a82ce66e6c7e4e60$var$removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function $a82ce66e6c7e4e60$var$Node(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function $a82ce66e6c7e4e60$var$signedArea(e,t,i,r){let o=0;for(let a=t,n=i-r;a<i;a+=r)o+=(e[n]-e[a])*(e[a+1]+e[n+1]),n=a;return o}class $b590b02110506a77$export$96bdf6d9c66d7ba8{static area(e){let t=e.length,i=0;for(let r=t-1,o=0;o<t;r=o++)i+=e[r].x*e[o].y-e[o].x*e[r].y;return .5*i}static isClockWise(e){return 0>$b590b02110506a77$export$96bdf6d9c66d7ba8.area(e)}static triangulateShape(e,t){let i=[],r=[],o=[];$b590b02110506a77$var$removeDupEndPts(e),$b590b02110506a77$var$addContour(i,e);let a=e.length;t.forEach($b590b02110506a77$var$removeDupEndPts);for(let e=0;e<t.length;e++)r.push(a),a+=t[e].length,$b590b02110506a77$var$addContour(i,t[e]);let n=$a82ce66e6c7e4e60$export$4c2b49800098dff3.triangulate(i,r);for(let e=0;e<n.length;e+=3)o.push(n.slice(e,e+3));return o}}function $b590b02110506a77$var$removeDupEndPts(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function $b590b02110506a77$var$addContour(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}var $9HO6e=parcelRequire("9HO6e"),$4xklQ=parcelRequire("4xklQ");const $44a90fc8a2825c34$var$a={c:null,u:[new $4xklQ.Vector3,new $4xklQ.Vector3,new $4xklQ.Vector3],e:[]},$44a90fc8a2825c34$var$b={c:null,u:[new $4xklQ.Vector3,new $4xklQ.Vector3,new $4xklQ.Vector3],e:[]},$44a90fc8a2825c34$var$R=[[],[],[]],$44a90fc8a2825c34$var$AbsR=[[],[],[]],$44a90fc8a2825c34$var$t=[],$44a90fc8a2825c34$var$xAxis=new $4xklQ.Vector3,$44a90fc8a2825c34$var$yAxis=new $4xklQ.Vector3,$44a90fc8a2825c34$var$zAxis=new $4xklQ.Vector3,$44a90fc8a2825c34$var$v1=new $4xklQ.Vector3,$44a90fc8a2825c34$var$size=new $4xklQ.Vector3,$44a90fc8a2825c34$var$closestPoint=new $4xklQ.Vector3,$44a90fc8a2825c34$var$rotationMatrix=new $4xklQ.Matrix3,$44a90fc8a2825c34$var$aabb=new $4xklQ.Box3,$44a90fc8a2825c34$var$matrix=new $4xklQ.Matrix4,$44a90fc8a2825c34$var$inverse=new $4xklQ.Matrix4,$44a90fc8a2825c34$var$localRay=new $4xklQ.Ray;class $44a90fc8a2825c34$export$f7a1f6dc3f8b082f{constructor(e=new $4xklQ.Vector3,t=new $4xklQ.Vector3,i=new $4xklQ.Matrix3){this.center=e,this.halfSize=t,this.rotation=i}set(e,t,i){return this.center=e,this.halfSize=t,this.rotation=i,this}copy(e){return this.center.copy(e.center),this.halfSize.copy(e.halfSize),this.rotation.copy(e.rotation),this}clone(){return new this.constructor().copy(this)}getSize(e){return e.copy(this.halfSize).multiplyScalar(2)}clampPoint(e,t){let i=this.halfSize;$44a90fc8a2825c34$var$v1.subVectors(e,this.center),this.rotation.extractBasis($44a90fc8a2825c34$var$xAxis,$44a90fc8a2825c34$var$yAxis,$44a90fc8a2825c34$var$zAxis),t.copy(this.center);let r=(0,$4xklQ.MathUtils).clamp($44a90fc8a2825c34$var$v1.dot($44a90fc8a2825c34$var$xAxis),-i.x,i.x);t.add($44a90fc8a2825c34$var$xAxis.multiplyScalar(r));let o=(0,$4xklQ.MathUtils).clamp($44a90fc8a2825c34$var$v1.dot($44a90fc8a2825c34$var$yAxis),-i.y,i.y);t.add($44a90fc8a2825c34$var$yAxis.multiplyScalar(o));let a=(0,$4xklQ.MathUtils).clamp($44a90fc8a2825c34$var$v1.dot($44a90fc8a2825c34$var$zAxis),-i.z,i.z);return t.add($44a90fc8a2825c34$var$zAxis.multiplyScalar(a)),t}containsPoint(e){return $44a90fc8a2825c34$var$v1.subVectors(e,this.center),this.rotation.extractBasis($44a90fc8a2825c34$var$xAxis,$44a90fc8a2825c34$var$yAxis,$44a90fc8a2825c34$var$zAxis),Math.abs($44a90fc8a2825c34$var$v1.dot($44a90fc8a2825c34$var$xAxis))<=this.halfSize.x&&Math.abs($44a90fc8a2825c34$var$v1.dot($44a90fc8a2825c34$var$yAxis))<=this.halfSize.y&&Math.abs($44a90fc8a2825c34$var$v1.dot($44a90fc8a2825c34$var$zAxis))<=this.halfSize.z}intersectsBox3(e){return this.intersectsOBB($44a90fc8a2825c34$var$obb.fromBox3(e))}intersectsSphere(e){return this.clampPoint(e.center,$44a90fc8a2825c34$var$closestPoint),$44a90fc8a2825c34$var$closestPoint.distanceToSquared(e.center)<=e.radius*e.radius}intersectsOBB(e,t=Number.EPSILON){let i,r;$44a90fc8a2825c34$var$a.c=this.center,$44a90fc8a2825c34$var$a.e[0]=this.halfSize.x,$44a90fc8a2825c34$var$a.e[1]=this.halfSize.y,$44a90fc8a2825c34$var$a.e[2]=this.halfSize.z,this.rotation.extractBasis($44a90fc8a2825c34$var$a.u[0],$44a90fc8a2825c34$var$a.u[1],$44a90fc8a2825c34$var$a.u[2]),$44a90fc8a2825c34$var$b.c=e.center,$44a90fc8a2825c34$var$b.e[0]=e.halfSize.x,$44a90fc8a2825c34$var$b.e[1]=e.halfSize.y,$44a90fc8a2825c34$var$b.e[2]=e.halfSize.z,e.rotation.extractBasis($44a90fc8a2825c34$var$b.u[0],$44a90fc8a2825c34$var$b.u[1],$44a90fc8a2825c34$var$b.u[2]);for(let e=0;e<3;e++)for(let t=0;t<3;t++)$44a90fc8a2825c34$var$R[e][t]=$44a90fc8a2825c34$var$a.u[e].dot($44a90fc8a2825c34$var$b.u[t]);$44a90fc8a2825c34$var$v1.subVectors($44a90fc8a2825c34$var$b.c,$44a90fc8a2825c34$var$a.c),$44a90fc8a2825c34$var$t[0]=$44a90fc8a2825c34$var$v1.dot($44a90fc8a2825c34$var$a.u[0]),$44a90fc8a2825c34$var$t[1]=$44a90fc8a2825c34$var$v1.dot($44a90fc8a2825c34$var$a.u[1]),$44a90fc8a2825c34$var$t[2]=$44a90fc8a2825c34$var$v1.dot($44a90fc8a2825c34$var$a.u[2]);for(let e=0;e<3;e++)for(let i=0;i<3;i++)$44a90fc8a2825c34$var$AbsR[e][i]=Math.abs($44a90fc8a2825c34$var$R[e][i])+t;for(let e=0;e<3;e++)if(i=$44a90fc8a2825c34$var$a.e[e],r=$44a90fc8a2825c34$var$b.e[0]*$44a90fc8a2825c34$var$AbsR[e][0]+$44a90fc8a2825c34$var$b.e[1]*$44a90fc8a2825c34$var$AbsR[e][1]+$44a90fc8a2825c34$var$b.e[2]*$44a90fc8a2825c34$var$AbsR[e][2],Math.abs($44a90fc8a2825c34$var$t[e])>i+r)return!1;for(let e=0;e<3;e++)if(i=$44a90fc8a2825c34$var$a.e[0]*$44a90fc8a2825c34$var$AbsR[0][e]+$44a90fc8a2825c34$var$a.e[1]*$44a90fc8a2825c34$var$AbsR[1][e]+$44a90fc8a2825c34$var$a.e[2]*$44a90fc8a2825c34$var$AbsR[2][e],r=$44a90fc8a2825c34$var$b.e[e],Math.abs($44a90fc8a2825c34$var$t[0]*$44a90fc8a2825c34$var$R[0][e]+$44a90fc8a2825c34$var$t[1]*$44a90fc8a2825c34$var$R[1][e]+$44a90fc8a2825c34$var$t[2]*$44a90fc8a2825c34$var$R[2][e])>i+r)return!1;return i=$44a90fc8a2825c34$var$a.e[1]*$44a90fc8a2825c34$var$AbsR[2][0]+$44a90fc8a2825c34$var$a.e[2]*$44a90fc8a2825c34$var$AbsR[1][0],r=$44a90fc8a2825c34$var$b.e[1]*$44a90fc8a2825c34$var$AbsR[0][2]+$44a90fc8a2825c34$var$b.e[2]*$44a90fc8a2825c34$var$AbsR[0][1],!(Math.abs($44a90fc8a2825c34$var$t[2]*$44a90fc8a2825c34$var$R[1][0]-$44a90fc8a2825c34$var$t[1]*$44a90fc8a2825c34$var$R[2][0])>i+r)&&(i=$44a90fc8a2825c34$var$a.e[1]*$44a90fc8a2825c34$var$AbsR[2][1]+$44a90fc8a2825c34$var$a.e[2]*$44a90fc8a2825c34$var$AbsR[1][1],r=$44a90fc8a2825c34$var$b.e[0]*$44a90fc8a2825c34$var$AbsR[0][2]+$44a90fc8a2825c34$var$b.e[2]*$44a90fc8a2825c34$var$AbsR[0][0],!(Math.abs($44a90fc8a2825c34$var$t[2]*$44a90fc8a2825c34$var$R[1][1]-$44a90fc8a2825c34$var$t[1]*$44a90fc8a2825c34$var$R[2][1])>i+r)&&(i=$44a90fc8a2825c34$var$a.e[1]*$44a90fc8a2825c34$var$AbsR[2][2]+$44a90fc8a2825c34$var$a.e[2]*$44a90fc8a2825c34$var$AbsR[1][2],r=$44a90fc8a2825c34$var$b.e[0]*$44a90fc8a2825c34$var$AbsR[0][1]+$44a90fc8a2825c34$var$b.e[1]*$44a90fc8a2825c34$var$AbsR[0][0],!(Math.abs($44a90fc8a2825c34$var$t[2]*$44a90fc8a2825c34$var$R[1][2]-$44a90fc8a2825c34$var$t[1]*$44a90fc8a2825c34$var$R[2][2])>i+r)&&(i=$44a90fc8a2825c34$var$a.e[0]*$44a90fc8a2825c34$var$AbsR[2][0]+$44a90fc8a2825c34$var$a.e[2]*$44a90fc8a2825c34$var$AbsR[0][0],r=$44a90fc8a2825c34$var$b.e[1]*$44a90fc8a2825c34$var$AbsR[1][2]+$44a90fc8a2825c34$var$b.e[2]*$44a90fc8a2825c34$var$AbsR[1][1],!(Math.abs($44a90fc8a2825c34$var$t[0]*$44a90fc8a2825c34$var$R[2][0]-$44a90fc8a2825c34$var$t[2]*$44a90fc8a2825c34$var$R[0][0])>i+r)&&(i=$44a90fc8a2825c34$var$a.e[0]*$44a90fc8a2825c34$var$AbsR[2][1]+$44a90fc8a2825c34$var$a.e[2]*$44a90fc8a2825c34$var$AbsR[0][1],r=$44a90fc8a2825c34$var$b.e[0]*$44a90fc8a2825c34$var$AbsR[1][2]+$44a90fc8a2825c34$var$b.e[2]*$44a90fc8a2825c34$var$AbsR[1][0],!(Math.abs($44a90fc8a2825c34$var$t[0]*$44a90fc8a2825c34$var$R[2][1]-$44a90fc8a2825c34$var$t[2]*$44a90fc8a2825c34$var$R[0][1])>i+r)&&(i=$44a90fc8a2825c34$var$a.e[0]*$44a90fc8a2825c34$var$AbsR[2][2]+$44a90fc8a2825c34$var$a.e[2]*$44a90fc8a2825c34$var$AbsR[0][2],r=$44a90fc8a2825c34$var$b.e[0]*$44a90fc8a2825c34$var$AbsR[1][1]+$44a90fc8a2825c34$var$b.e[1]*$44a90fc8a2825c34$var$AbsR[1][0],!(Math.abs($44a90fc8a2825c34$var$t[0]*$44a90fc8a2825c34$var$R[2][2]-$44a90fc8a2825c34$var$t[2]*$44a90fc8a2825c34$var$R[0][2])>i+r)&&(i=$44a90fc8a2825c34$var$a.e[0]*$44a90fc8a2825c34$var$AbsR[1][0]+$44a90fc8a2825c34$var$a.e[1]*$44a90fc8a2825c34$var$AbsR[0][0],r=$44a90fc8a2825c34$var$b.e[1]*$44a90fc8a2825c34$var$AbsR[2][2]+$44a90fc8a2825c34$var$b.e[2]*$44a90fc8a2825c34$var$AbsR[2][1],!(Math.abs($44a90fc8a2825c34$var$t[1]*$44a90fc8a2825c34$var$R[0][0]-$44a90fc8a2825c34$var$t[0]*$44a90fc8a2825c34$var$R[1][0])>i+r)&&(i=$44a90fc8a2825c34$var$a.e[0]*$44a90fc8a2825c34$var$AbsR[1][1]+$44a90fc8a2825c34$var$a.e[1]*$44a90fc8a2825c34$var$AbsR[0][1],r=$44a90fc8a2825c34$var$b.e[0]*$44a90fc8a2825c34$var$AbsR[2][2]+$44a90fc8a2825c34$var$b.e[2]*$44a90fc8a2825c34$var$AbsR[2][0],!(Math.abs($44a90fc8a2825c34$var$t[1]*$44a90fc8a2825c34$var$R[0][1]-$44a90fc8a2825c34$var$t[0]*$44a90fc8a2825c34$var$R[1][1])>i+r)&&(i=$44a90fc8a2825c34$var$a.e[0]*$44a90fc8a2825c34$var$AbsR[1][2]+$44a90fc8a2825c34$var$a.e[1]*$44a90fc8a2825c34$var$AbsR[0][2],r=$44a90fc8a2825c34$var$b.e[0]*$44a90fc8a2825c34$var$AbsR[2][1]+$44a90fc8a2825c34$var$b.e[1]*$44a90fc8a2825c34$var$AbsR[2][0],!(Math.abs($44a90fc8a2825c34$var$t[1]*$44a90fc8a2825c34$var$R[0][2]-$44a90fc8a2825c34$var$t[0]*$44a90fc8a2825c34$var$R[1][2])>i+r)))))))))}intersectsPlane(e){this.rotation.extractBasis($44a90fc8a2825c34$var$xAxis,$44a90fc8a2825c34$var$yAxis,$44a90fc8a2825c34$var$zAxis);let t=this.halfSize.x*Math.abs(e.normal.dot($44a90fc8a2825c34$var$xAxis))+this.halfSize.y*Math.abs(e.normal.dot($44a90fc8a2825c34$var$yAxis))+this.halfSize.z*Math.abs(e.normal.dot($44a90fc8a2825c34$var$zAxis)),i=e.normal.dot(this.center)-e.constant;return Math.abs(i)<=t}intersectRay(e,t){return(this.getSize($44a90fc8a2825c34$var$size),$44a90fc8a2825c34$var$aabb.setFromCenterAndSize($44a90fc8a2825c34$var$v1.set(0,0,0),$44a90fc8a2825c34$var$size),$44a90fc8a2825c34$var$matrix.setFromMatrix3(this.rotation),$44a90fc8a2825c34$var$matrix.setPosition(this.center),$44a90fc8a2825c34$var$inverse.copy($44a90fc8a2825c34$var$matrix).invert(),$44a90fc8a2825c34$var$localRay.copy(e).applyMatrix4($44a90fc8a2825c34$var$inverse),$44a90fc8a2825c34$var$localRay.intersectBox($44a90fc8a2825c34$var$aabb,t))?t.applyMatrix4($44a90fc8a2825c34$var$matrix):null}intersectsRay(e){return null!==this.intersectRay(e,$44a90fc8a2825c34$var$v1)}fromBox3(e){return e.getCenter(this.center),e.getSize(this.halfSize).multiplyScalar(.5),this.rotation.identity(),this}equals(e){return e.center.equals(this.center)&&e.halfSize.equals(this.halfSize)&&e.rotation.equals(this.rotation)}applyMatrix4(e){let t=e.elements,i=$44a90fc8a2825c34$var$v1.set(t[0],t[1],t[2]).length(),r=$44a90fc8a2825c34$var$v1.set(t[4],t[5],t[6]).length(),o=$44a90fc8a2825c34$var$v1.set(t[8],t[9],t[10]).length(),a=e.determinant();a<0&&(i=-i),$44a90fc8a2825c34$var$rotationMatrix.setFromMatrix4(e);let n=1/i,s=1/r,l=1/o;return $44a90fc8a2825c34$var$rotationMatrix.elements[0]*=n,$44a90fc8a2825c34$var$rotationMatrix.elements[1]*=n,$44a90fc8a2825c34$var$rotationMatrix.elements[2]*=n,$44a90fc8a2825c34$var$rotationMatrix.elements[3]*=s,$44a90fc8a2825c34$var$rotationMatrix.elements[4]*=s,$44a90fc8a2825c34$var$rotationMatrix.elements[5]*=s,$44a90fc8a2825c34$var$rotationMatrix.elements[6]*=l,$44a90fc8a2825c34$var$rotationMatrix.elements[7]*=l,$44a90fc8a2825c34$var$rotationMatrix.elements[8]*=l,this.rotation.multiply($44a90fc8a2825c34$var$rotationMatrix),this.halfSize.x*=i,this.halfSize.y*=r,this.halfSize.z*=o,$44a90fc8a2825c34$var$v1.setFromMatrixPosition(e),this.center.add($44a90fc8a2825c34$var$v1),this}}const $44a90fc8a2825c34$var$obb=new $44a90fc8a2825c34$export$f7a1f6dc3f8b082f;var $g4HAh=parcelRequire("g4HAh"),$7WCxl=parcelRequire("7WCxl"),$ia4Lh=parcelRequire("ia4Lh");class $d0f874000594cf7a$export$a955f3d6a39ce4b2{drawWallHelp(e,t,i=400){let r=this.createLineDimensionsLine(e,t,!0,i),o=this.createCircleDimensionsLine(e,t),a=.1>Math.abs(e.x-t.x)||.1>Math.abs(e.x-t.y),n=.1>Math.abs(e.y-t.x)||.1>Math.abs(e.y-t.y),s=new $4xklQ.Group;return s.add(r),s.lineLength=r.lineLength,s.lineCenter=r.center,a||n?(s.realAngle="",s.arcCenter=""):(s.add(o[0]),s.add(o[1]),s.add(o[2]),s.add(o[3]),s.realAngle=o[0].realAngle,s.arcCenter=o[0].center),s}createSplitWallMesh(e,t){var i=[];e.forEach(function(e){i.push(e.x,e.y,-1)});var r=[0,1,2,2,1,3],o=new $4xklQ.BufferGeometry;return o.attributes.position=new $4xklQ.BufferAttribute(new Float32Array(i),3),o.index=new $4xklQ.BufferAttribute(new Uint16Array(r),1),new $4xklQ.Mesh(o,t)}createCurveHelp(e,t,i){let r=new $4xklQ.Group,o=$523a84362d27c3e8$export$b680ca477a72be07.makeControlPoint(i);var a=new(0,$4xklQ.BufferGeometry)().setFromPoints([e,i,t]),n=new $4xklQ.Line(a,new $4xklQ.MeshBasicMaterial({color:"#1E90FF",side:$4xklQ.DoubleSide,transparent:!0}));return r.add(o),r.add(n),r.useType="arcHelper",r.controlMesh=o,r}createLineDimensionsLine(e,t,i=!0,r=280,o="#000000",a=6){e=new $4xklQ.Vector3(e.x,e.y,0),t=new $4xklQ.Vector3(t.x,t.y,0);let n=new(0,$4xklQ.Vector3)().subVectors(t,e),s=new $4xklQ.Vector3(-n.y,n.x,0);i&&(s=s.negate()),s.setLength(r);let l=e.clone().add(s),h=t.clone().add(s),c=new $4xklQ.MeshBasicMaterial({color:o,side:$4xklQ.DoubleSide,depthTest:!1,transparent:!0}),d=[l,h];d=(d=this.createEndpoint(l,s).concat(d)).concat(this.createEndpoint(h,s));let p=new $4xklQ.Line(new(0,$4xklQ.BufferGeometry)().setFromPoints(d),c);p.renderOrder=a;let u=new $4xklQ.Vector3((l.x+h.x)/2,(l.y+h.y)/2,0),m=Math.round(e.clone().distanceTo(t.clone()));return p.center=u,p.lineLength=m,p.startPoint=e,p.endPoint=t,p}createDimensionsLineForDoor(e,t,i,r=280){e=new $4xklQ.Vector3(e.x,e.y,0),t=new $4xklQ.Vector3(t.x,t.y,0);let o=new(0,$4xklQ.Vector3)().subVectors(t,e),a=new(0,$4xklQ.Vector3)(-o.y,o.x,0).negate();a.setLength(r);let n=e.clone().add(a.setLength(r)),s=t.clone().add(a.setLength(r)),l=new $4xklQ.MeshBasicMaterial({color:"#000000",side:$4xklQ.DoubleSide,depthTest:!1,transparent:!0}),h=[n,s];h=(h=this.createEndpoint(n,a,80).concat(h)).concat(this.createEndpoint(s,a,80));let c=new $4xklQ.Line(new(0,$4xklQ.BufferGeometry)().setFromPoints(h),l);c.renderOrder=400;let d=new $4xklQ.Vector3((n.x+s.x)/2,(n.y+s.y)/2,0),p=Math.round(e.clone().distanceTo(t.clone()));return c.center=d,c.startPoint=e,c.endPoint=t,c.lineLength=p,c}createCircleLine(e,t,i,r=3){let o=(0,$9HO6e.UtilCore).getMeshOtherPoint(t,e),a=t.startPoint.clone().distanceTo(t.endPoint.clone()),n=i.startPoint.clone().distanceTo(i.endPoint.clone()),s=a<n?a:n,l=o.clone().sub(e.clone()),h=(0,$9HO6e.UtilCore).getMeshOtherPoint(i,e).clone().sub(e.clone()),c=(0,$9HO6e.UtilCore).toVector3(l).angleTo((0,$9HO6e.UtilCore).toVector3(h));c=Math.round(180/Math.PI*c);let d=(0,$9HO6e.UtilCore).toVector2(l).angle(),p=(0,$9HO6e.UtilCore).getMeshOtherPoint(i,e),u=p.clone().sub(e.clone()),m=(0,$9HO6e.UtilCore).toVector2(u).angle(),g=(0,$9HO6e.UtilCore).getClockWise(o,e,p);g=g>0;let f=new $4xklQ.MeshBasicMaterial({color:"#1C1C1C",side:$4xklQ.DoubleSide,transparent:!0}),w=new $4xklQ.EllipseCurve(e.x,e.y,s/r,s/r,d,m,g).getPoints(50),y=new $4xklQ.Line(new(0,$4xklQ.BufferGeometry)().setFromPoints(w),f),b=w[Math.round(w.length/2)];return y.renderOrder=6,y.realAngle=c+"\xb0",y.center=new $4xklQ.Vector3(b.x,b.y,0),y}createCircleDimensionsLine(e,t,i=600){e=new $4xklQ.Vector3(e.x,e.y,0),t=new $4xklQ.Vector3(t.x,t.y,0);let r=e.distanceTo(t)+i,o=new $4xklQ.Vector3(1,0,0),a=new(0,$4xklQ.Vector3)().subVectors(t,e).angleTo(o),n=!1,s=0,l=180/Math.PI*a,h=new $4xklQ.LineDashedMaterial({color:"#1C1C1C",dashSize:3,gapSize:3}),c=new $4xklQ.MeshBasicMaterial({color:"#1C1C1C",side:$4xklQ.DoubleSide,transparent:!0});e.x<t.x&&e.y>t.y&&(n=!0,a*=-1),e.x>t.x&&e.y<t.y&&(s=Math.PI,n=!0,l=180/Math.PI*(Math.PI-a)),e.x>t.x&&e.y>t.y&&(s=Math.PI,n=!1,l=180/Math.PI*(Math.PI-a),a*=-1);let d=new $4xklQ.EllipseCurve(e.x,e.y,r/10,r/10,s,a,n).getPoints(50),p=new $4xklQ.Line(new(0,$4xklQ.BufferGeometry)().setFromPoints(d),h);var u=new $4xklQ.EllipseCurve(e.x,e.y,r,r,s,a,n).getPoints(50);let m=new $4xklQ.Line(new(0,$4xklQ.BufferGeometry)().setFromPoints([e,u[0]]),h),g=new $4xklQ.Line(new(0,$4xklQ.BufferGeometry)().setFromPoints([e,u[u.length-1]]),h);m.computeLineDistances(),g.computeLineDistances();let f=new(0,$4xklQ.Vector3)().subVectors(e.clone(),u[0].clone()),w=new(0,$4xklQ.Vector3)().subVectors(e.clone(),u[u.length-1].clone());f.z=0,w.z=0,u=(u=this.createEndpoint(u[0],f).concat(u)).concat(this.createEndpoint(u[u.length-1],w));let y=new $4xklQ.Line(new(0,$4xklQ.BufferGeometry)().setFromPoints(u),c),b=u[Math.round(u.length/2)];return y.realAngle=Math.round(l)+"\xb0",y.center=new $4xklQ.Vector3(b.x,b.y,0),[y,m,g,p]}createCircleAngleLine(e,t,i,r,o){let a=new $4xklQ.MeshBasicMaterial({color:"#1C1C1C",side:$4xklQ.DoubleSide,transparent:!0}),n=new $4xklQ.EllipseCurve(e.x,e.y,t/2,t/2,i,r,o).getPoints(50),s=new $4xklQ.Line(new(0,$4xklQ.BufferGeometry)().setFromPoints(n),a),l=n[Math.round(n.length/2)];return s.center=new $4xklQ.Vector3(l.x,l.y,0),s}createEndpoint(e,t,i=100){let r=t.clone().setLength(i),o=t.clone().negate().setLength(i),a=r.clone().applyAxisAngle(new $4xklQ.Vector3(0,0,1),70),n=a.clone().negate().setLength(i),s=e.clone().add(r),l=e.clone().add(o),h=e.clone().add(a),c=e.clone().add(n);return[s,l,e,h,c]}createPoint(e,t="",i=80){let r=new $4xklQ.Group;""==t&&(t=e);var o=new $4xklQ.CircleGeometry(i/3,32),a=new $4xklQ.MeshBasicMaterial({color:"#363636",transparent:!0}),n=new $4xklQ.CircleGeometry(i,32),s=new $4xklQ.MeshBasicMaterial({color:"#FFFF00",depthTest:!1,transparent:!0}),l=new $4xklQ.Mesh(o,a),h=new $4xklQ.Mesh(n,s);return l.position.set(e.x,e.y,10),h.position.set(e.x,e.y,10),l.renderOrder=5,h.renderOrder=4,r.add(l),r.add(h),r.center=t,l.useType="dragPoint",h.useType="dragPoint",r.radio=i,r}createDragPoint(e,t="",i=80){let r=new $4xklQ.Group;""==t&&(t=e);var o=new $4xklQ.CircleGeometry(i,32),a=new $4xklQ.MeshBasicMaterial({color:"#ffffff",transparent:!0,opacity:.4}),n=new $4xklQ.Mesh(o,a);return n.position.set(e.x,e.y,10),n.renderOrder=6,r.add(n),r.center=t,r.radio=i,n.useType="dragPoint",r}createScaleToolPoint(e,t,i=60){var r=new $4xklQ.CircleGeometry(i,32),o=new $4xklQ.MeshBasicMaterial({color:"rgb(f,f,f)",depthTest:!1,transparent:!0,opacity:.8,side:$4xklQ.DoubleSide}),a=new $4xklQ.Mesh(r,o);return a.position.set(e.x,e.y,10),a.renderOrder=100,a.useType="movePoint",a.positionType=t,a.positionCenter=e,a}createDoorPoint(e,t,i=60){var r=new $4xklQ.CircleGeometry(i,32),o=new $4xklQ.MeshBasicMaterial({color:"rgb(62, 130, 247)",depthTest:!1,transparent:!0,opacity:.8}),a=new $4xklQ.Mesh(r,o);return a.position.set(e.x,e.y,100),a.renderOrder=6,a.useType="movePoint",a.positionType=t,a.positionCenter=e,a}createNormalPoint(e,t=60){var i=new $4xklQ.CircleGeometry(t,32),r=new $4xklQ.MeshBasicMaterial({color:"#FFFF00",depthTest:!1,transparent:!0,opacity:.8}),o=new $4xklQ.Mesh(i,r);return o.position.set(e.x,e.y,10),o.renderOrder=6,o}createDoorOuterPoint(e,t=100,i="rgb(255, 255, 255)",r=0){var o=new $4xklQ.CircleGeometry(t,32),a=new $4xklQ.MeshBasicMaterial({color:i,depthTest:!1,transparent:!0}),n=new $4xklQ.Mesh(o,a);return n.position.set(e.x,e.y,r),n.renderOrder=5,n.useType="moveOuterPoint",n.positionCenter=e,n}createHelperForMumber(e,t=60){let i="";e.children.forEach(e=>{if("Mesh"==e.type){i=e;return}}),e.modelType&&e.modelType.indexOf("Model")>=0&&(i=e);let r=this.addScaleTool(i),o=0;return o=e.rotation.z,[r,this.addAngleTool(i,1500,o-Math.PI/8,o+Math.PI/8)]}addAngleTool(e,t,i,r,o="rgb(153,193,244)"){let a=100,n=this.getMeshCenter(e),s=this.makeRotateToolGem(n,i,r,t,o,a,!0);return s.currentModel=e,s}getMeshCenter(e){let t=new $4xklQ.Vector3;return e.updateWorldMatrix(),e.getWorldPosition(t),t}addBoxFor2dModel(e,t=window.editor.config.boxLineColor,i="line"){let r=[e[0],e[1],e[2],e[3],e[0]],o=[];r.forEach(e=>{o.push(e.x,e.y,e.z)});var a=new(0,$g4HAh.LineGeometry)().setPositions(o),n=new $7WCxl.LineMaterial({color:t,linewidth:window.editor.config.boxLineWidth,side:$4xklQ.DoubleSide});"line"!=i&&(n=new $7WCxl.LineMaterial({color:0,dashScale:20,side:$4xklQ.DoubleSide,dashed:!0})),n.resolution.set(window.innerWidth,window.innerHeight);var s=new $ia4Lh.Line2(a,n);return s.computeLineDistances(),s.renderOrder=100,s}addScaleTool(e,t=60){let i=this.getModelVertex(e),r=new $4xklQ.Group;for(let e=0;e<i.length;e++){var o=new $4xklQ.CircleGeometry(t,32),a=new $4xklQ.MeshBasicMaterial({color:"rgb(26, 122, 251)",depthTest:!1,transparent:!0,opacity:.8}),n=new $4xklQ.Mesh(o,a);n.position.set(i[e].x,i[e].y,10),n.renderOrder=10,n.useType="scalePoint",n.arcCenter=new $4xklQ.Vector3(i[e].x,i[e].y,0),0==e&&(n.scaleDir="-XY",n.linePoint=[i[0],i[2]]),2==e&&(n.scaleDir="X-Y",n.linePoint=[i[0],i[2]]),1==e&&(n.scaleDir="-X-Y",n.linePoint=[i[1],i[3]]),3==e&&(n.scaleDir="XY",n.linePoint=[i[1],i[3]]),4==e&&(n.scaleDir="-X",n.linePoint=[i[4],i[7]]),7==e&&(n.scaleDir="X",n.linePoint=[i[4],i[7]]),5==e&&(n.scaleDir="-Y",n.linePoint=[i[5],i[6]]),6==e&&(n.scaleDir="Y",n.linePoint=[i[5],i[6]]),r.add(n)}"2dModelGroup"==e.modelType&&(r=new $4xklQ.Group),r.useType="scaleTool",r.currentModel=e;let s=this.addBoxFor2dModel(i);return r.add(s),r}getWorldRotation(e){let t=(e,t)=>new $4xklQ.Vector3(e.x+t.x,e.y+t.y,e.z+t.z);return null===e?new $4xklQ.Vector3:t(e.rotation,this.getWorldRotation(e.parent))}addOBB2DBox(e,t=window.editor.config.boxLineColor){let i=1e3*e.width/2,r=1e3*e.depth/2,o=new $4xklQ.Vector3(-i,r,0),a=new $4xklQ.Vector3(-i,-r,0),n=new $4xklQ.Vector3(i,-r,0),s=new $4xklQ.Vector3(i,r,0),l=e.position.clone(),h=e.rot,c=this.addBoxFor2dModel([o,a,n,s,o],t);return l.x*=1e3,l.y=-1e3*l.z,l.z=.1,c.rotation.set(h.x,0,h.y),c.position.set(l.x,l.y,l.z),c}addOBBbox(e,t=window.editor.config.boxLineColor){var i="";if("Mesh"==e.type&&"pillars"!=e.modeType&&"beam"!=e.modeType&&e.parent&&"3dwall"!=e.parent.name){let r=new $4xklQ.EdgesGeometry(e.geometry,4);(i=new $4xklQ.LineSegments(r,new $4xklQ.LineBasicMaterial({color:t}))).position.set(e.position.x,e.position.z,-e.position.y),i.rotation.x=-Math.PI/2,i.rotation.z=e.rotation.z,i.scale.copy(e.scale);let o=new(0,$4xklQ.Matrix4)().makeScale(.001,.001,.001);i.applyMatrix4(o)}else{let r=e.rotation.x,o=e.rotation.y,a=e.rotation.z,n=this.getWorldRotation(e);e.rotation.set(0,0,0);let s=new $4xklQ.Vector3;e.updateWorldMatrix(!0),e.getWorldPosition(s);let l=new $4xklQ.Box3,h=new $44a90fc8a2825c34$export$f7a1f6dc3f8b082f,c=l.setFromObject(e);e.rotation.set(r,o,a);let d=h.fromBox3(c),p=2*d.halfSize.x,u=2*d.halfSize.y,m=2*d.halfSize.z;if("CodeModel"!=e.modelType){let t=e.clone(),i=new(0,$4xklQ.Vector3)().setFromMatrixScale(e.matrixWorld);t.scale.copy(i),t.rotation.set(0,0,0);let r=l.setFromObject(t),o=h.fromBox3(r);p=2*o.halfSize.x,u=2*o.halfSize.y,m=2*o.halfSize.z}if((i=this.obbBoxMain(p,u,m,t)).position.set(s.x,s.y+.01,s.z),"CodeModel"==e.modelType){if(i.rotation.set(r,a,Math.PI-o),i.position.y=e.position.z/1e3+.01,"PanoramicWindowMesh"==e.type){let t=new $4xklQ.Vector3(0,1,0);t.applyEuler(new $4xklQ.Euler(e.rotation.x,0,0,"XYZ")),t.applyEuler(new $4xklQ.Euler(0,e.rotation.y,0,"XYZ")),t.applyEuler(new $4xklQ.Euler(0,0,e.rotation.z,"XYZ")),t.setLength(-m/4),i.position.add(t)}}else i.rotation.set(n.x,n.y,n.z);i.width=p,i.height=u,i.depth=m,i.rot=n}return i}addOBBDotBox(e,t=window.editor.config.boxLineColor){let i=e.rotation.x,r=e.rotation.y,o=e.rotation.z;e.rotation.set(0,0,0);let a=new(0,$4xklQ.Box3)().setFromObject(e);e.rotation.set(i,r,o);let n=new $44a90fc8a2825c34$export$f7a1f6dc3f8b082f().fromBox3(a),s=this.obbBoxMain(2.5*n.halfSize.x,2.5*n.halfSize.y,2.5*n.halfSize.z,t,"dash");return s.position.set(n.center.x,n.center.y+.01,n.center.z),s.rotation.set(i,r,o),s}obbBoxMain(e,t,i,r=window.editor.config.boxLineColor,o="line"){let a=new $4xklQ.Vector3(e/2,-t/2,-i/2),n=new $4xklQ.Vector3(e/2,-t/2,i/2),s=new $4xklQ.Vector3(-e/2,-t/2,i/2),l=new $4xklQ.Vector3(-e/2,-t/2,-i/2),h=new $4xklQ.Vector3(e/2,t/2,-i/2),c=new $4xklQ.Vector3(e/2,t/2,i/2),d=new $4xklQ.Vector3(-e/2,t/2,i/2),p=new $4xklQ.Vector3(-e/2,t/2,-i/2),u=[];[a,n,s,l,a,h,c,n,c,d,s,d,p,l,p,h].forEach(e=>{u.push(e.x,e.y,e.z)});var m=new(0,$g4HAh.LineGeometry)().setPositions(u),g=new $7WCxl.LineMaterial({color:r,linewidth:window.editor.config.boxLineWidth,side:$4xklQ.DoubleSide});"line"!=o&&(g=new $7WCxl.LineMaterial({color:0,dashScale:20,side:$4xklQ.DoubleSide,dashed:!0})),g.resolution.set(window.innerWidth,window.innerHeight);var f=new $ia4Lh.Line2(m,g);return f.computeLineDistances(),f.renderOrder=100,f}addRotateTool(e,t=1500){let i=0,r=0,o="#6495ED",a=new $4xklQ.Group,n=this.getMeshCenter(e),s=100;for(;i<8;){let e=this.makeRotateToolGem(n,r+Math.PI/180,2*Math.PI/8*(i+1),t,o,s);r=2*Math.PI/8*(i+1),i++,a.add(e)}return a.useType="rotateClock",a.arcCenter=n,a.arcRadio=t,a}makeRotateToolGem(e,t,i,r,o,a,n=!1){let s=$0f7bfe5028a81ceb$export$18d19c7a3aa33064({thickness:140});var l=new $4xklQ.EllipseCurve(e.x,e.y,r,r,t,i,!1,0).getPoints(50),h=[];l.forEach(function(e){h.push([e.x,e.y])});var c=s.build(h);c=this.process(h,c);var d=[];c.positions.forEach(function(e){d.push(e[0],e[1],0)});var p=[];c.cells.forEach(function(e){p.push(e[0],e[1],e[2])});var u=new $4xklQ.BufferGeometry;u.attributes.position=new $4xklQ.BufferAttribute(new Float32Array(d),3),u.index=new $4xklQ.BufferAttribute(new Uint16Array(p),1);var m=new $4xklQ.MeshBasicMaterial({color:o,side:$4xklQ.DoubleSide,depthTest:!1,transparent:!0,opacity:1}),c=new $4xklQ.Mesh(u,m);c.position.z=20,c.renderOrder=99;let g=new $4xklQ.Group;if(g.add(c),n){c.useType="rotateTool",g.useType="rotateTool";var f=new $4xklQ.Vector3(h[0][0],h[0][1],0),w=new $4xklQ.Vector3(h[1][0],h[1][1],0);let e=f.clone().sub(w.clone());e.normalize();var y=200,b=new $4xklQ.ArrowHelper(e,f,y,o,2.5*a,2.5*a),x=new $4xklQ.Vector3(h[h.length-1][0],h[h.length-1][1],0),P=new $4xklQ.Vector3(h[h.length-2][0],h[h.length-2][1],0);let t=x.clone().sub(P.clone());t.normalize();var v=new $4xklQ.ArrowHelper(t,x,y,o,2.5*a,2.5*a);b.position.z=10,v.position.z=10,g.add(b),g.add(v)}return g.startAngle=t,g.endAngle=i,g.arcCenter=e,g.arcRadio=r,g}process(e,t,i=[]){return t.innner=[],t.outter=[],e.forEach(function(e){i.push(new $4xklQ.Vector2(e[0],e[1]))}),t.clock=$b590b02110506a77$export$96bdf6d9c66d7ba8.isClockWise(i),t.positions.forEach(function(e,i){i%2==0?t.clock?t.innner.push(e):t.outter.push(e):t.clock?t.outter.push(e):t.innner.push(e)}),t}getModelVertex(e,t=1){let i=e.parent;e.modelType&&e.modelType.indexOf("Model")>=0&&(i=e),i.updateWorldMatrix(!0,!0);let r=i.clone();r.scale.set(1,1,1),r.rotation.set(0,0,0);let o=new(0,$4xklQ.Box3)().setFromObject(r),a=new $44a90fc8a2825c34$export$f7a1f6dc3f8b082f().fromBox3(o),n=1*a.halfSize.x.toFixed(2)*t,s=1*a.halfSize.y.toFixed(2)*t;i.width&&(n=1*i.width/2*t,s=1*i.height/2*t),i.realWidth&&(n=1*i.realWidth/2);let l=[new $4xklQ.Vector3(-n,s,0),new $4xklQ.Vector3(-n,-s,0),new $4xklQ.Vector3(n,-s,0),new $4xklQ.Vector3(n,s,0),new $4xklQ.Vector3(-n,0,0),new $4xklQ.Vector3(0,-s,0),new $4xklQ.Vector3(0,s,0),new $4xklQ.Vector3(n,0,0)],h=e.parent;e.modelType&&e.modelType.indexOf("Model")>=0&&(h=e),h.updateWorldMatrix(!0,!1);for(let e=0;e<l.length;e++){let t=h.localToWorld(l[e]);t.z=.1,l[e]=t}return l}}var $5XTH3=parcelRequire("5XTH3");function $2176137edde06fbe$export$fee71b7b1f0877fa(e,t){let i=[];for(;e.length>0;){let t=$2176137edde06fbe$var$reduceWalk($2176137edde06fbe$var$closedWalkFrom($2176137edde06fbe$var$leftBottomVertex(e)));t.length>2&&i.push(t),$2176137edde06fbe$var$removeEdge(t[0],t[1]),e=$2176137edde06fbe$var$removeFilamentAt(t[0],e),e=$2176137edde06fbe$var$removeFilamentAt(t[1],e)}return i}function $2176137edde06fbe$var$leftBottomVertex(e){return e.reduce((e,t)=>{let i=t.x-e.x;return i<0?t:i>0?e:t.y-e.y<0?e:t})}function $2176137edde06fbe$var$closedWalkFrom(e){let t=[],i=e,r;do t.push(i),[i,r]=$2176137edde06fbe$var$getNext(i,r);while(i!==e)return t}function $2176137edde06fbe$var$reduceWalk(e){for(let t=1;t<e.length;t++){let i=e.lastIndexOf(e[t]);i>t&&e.splice(t+1,i-t)}return e}function $2176137edde06fbe$var$withoutVertex(e,t){return t.filter(t=>t!==e)}function $2176137edde06fbe$var$removeEdge(e,t){e.adj=$2176137edde06fbe$var$withoutVertex(t,e.adj),t.adj=$2176137edde06fbe$var$withoutVertex(e,t.adj)}function $2176137edde06fbe$var$removeFilamentAt(e,t){let i=e,r;for(;i&&i.adj.length<2;)t=$2176137edde06fbe$var$withoutVertex(i,t),(r=i.adj[0])&&$2176137edde06fbe$var$removeEdge(i,r),i=r;return t}function $2176137edde06fbe$var$getNext(e,t){return[1==e.adj.length?e.adj[0]:$2176137edde06fbe$var$best_by_kind(t,e,t?"ccw":"cw"),e]}function $2176137edde06fbe$var$best_by_kind(e,t,i){let r,o=t.adj;return e?(r=$2176137edde06fbe$var$vsub(t,e),o=$2176137edde06fbe$var$withoutVertex(e,o)):r={x:0,y:-1},o.reduce((e,o)=>$2176137edde06fbe$var$better_by_kind(o,e,t,r,i))}function $2176137edde06fbe$var$better_by_kind(e,t,i,r,o){let a=$2176137edde06fbe$var$vsub(e,i),n=$2176137edde06fbe$var$vsub(t,i),s=$2176137edde06fbe$var$dot_perp(n,r)>0,l=$2176137edde06fbe$var$dot_perp(r,a),h=$2176137edde06fbe$var$dot_perp(n,a),c;return(c="cw"==o?s&&(l>=0||h>=0)||!s&&l>=0&&h>=0:!s&&(l<0||h<0)||s&&l<0&&h<0)?e:t}function $2176137edde06fbe$var$vsub(e,t){return{x:e.x-t.x,y:e.y-t.y}}function $2176137edde06fbe$var$dot_perp(e,t){return e.x*t.y-t.x*e.y}var $4xklQ=parcelRequire("4xklQ"),$5XTH3=parcelRequire("5XTH3"),$9QhXH=parcelRequire("9QhXH");function $9725c2b30524cf65$export$f89346e4832a4893(e,t,i,r){var o=e[0],a=e[1],n=!1;void 0===i&&(i=0),void 0===r&&(r=t.length);for(var s=(r-i)/2,l=0,h=s-1;l<s;h=l++){var c=t[i+2*l+0],d=t[i+2*l+1],p=t[i+2*h+0],u=t[i+2*h+1];d>a!=u>a&&o<(p-c)*(a-d)/(u-d)+c&&(n=!n)}return n}function $c356862cd9aed4c4$export$7370663eeb73660e(e,t,i,r){var o=e[0],a=e[1],n=!1;void 0===i&&(i=0),void 0===r&&(r=t.length);for(var s=r-i,l=0,h=s-1;l<s;h=l++){var c=t[l+i][0],d=t[l+i][1],p=t[h+i][0],u=t[h+i][1];d>a!=u>a&&o<(p-c)*(a-d)/(u-d)+c&&(n=!n)}return n}function $a59c92c620a56c0f$export$7f6bc8d3d7d61b11(e,t,i,r){return t.length>0&&Array.isArray(t[0])?$c356862cd9aed4c4$export$7370663eeb73660e(e,t,i,r):$9725c2b30524cf65$export$f89346e4832a4893(e,t,i,r)}var $hrM0U=parcelRequire("hrM0U"),$4xklQ=parcelRequire("4xklQ"),$hrM0U=parcelRequire("hrM0U");class $d5e8224393d3fc4b$export$d78f121d8d1152c5{constructor(e=[],t=$d5e8224393d3fc4b$var$defaultCompare){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;let e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:t,compare:i}=this,r=t[e];for(;e>0;){let o=e-1>>1,a=t[o];if(i(r,a)>=0)break;t[e]=a,e=o}t[e]=r}_down(e){let{data:t,compare:i}=this,r=this.length>>1,o=t[e];for(;e<r;){let r=(e<<1)+1,a=t[r],n=r+1;if(n<this.length&&0>i(t[n],a)&&(r=n,a=t[n]),i(a,o)>=0)break;t[e]=a,e=r}t[e]=o}}function $d5e8224393d3fc4b$var$defaultCompare(e,t){return e<t?-1:e>t?1:0}"use strict";var $b6efaaece0bcc309$var$Queue=$d5e8224393d3fc4b$export$d78f121d8d1152c5;function $b6efaaece0bcc309$export$a1687b1810059e02(e,t,i){t=t||1;for(var r,o,a,n,s=0;s<e[0].length;s++){var l=e[0][s];(!s||l[0]<r)&&(r=l[0]),(!s||l[1]<o)&&(o=l[1]),(!s||l[0]>a)&&(a=l[0]),(!s||l[1]>n)&&(n=l[1])}var h=a-r,c=n-o,d=Math.min(h,c),p=d/2;if(0===d){var u=[r,o];return u.distance=0,u}for(var m=new $b6efaaece0bcc309$var$Queue(void 0,$b6efaaece0bcc309$var$compareMax),g=r;g<a;g+=d)for(var f=o;f<n;f+=d)m.push(new $b6efaaece0bcc309$var$Cell(g+p,f+p,p,e));var w=$b6efaaece0bcc309$var$getCentroidCell(e),y=new $b6efaaece0bcc309$var$Cell(r+h/2,o+c/2,0,e);y.d>w.d&&(w=y);for(var b=m.length;m.length;){var x=m.pop();x.d>w.d&&(w=x,i&&console.log("found best %d after %d probes",Math.round(1e4*x.d)/1e4,b)),x.max-w.d<=t||(p=x.h/2,m.push(new $b6efaaece0bcc309$var$Cell(x.x-p,x.y-p,p,e)),m.push(new $b6efaaece0bcc309$var$Cell(x.x+p,x.y-p,p,e)),m.push(new $b6efaaece0bcc309$var$Cell(x.x-p,x.y+p,p,e)),m.push(new $b6efaaece0bcc309$var$Cell(x.x+p,x.y+p,p,e)),b+=4)}i&&(console.log("num probes: "+b),console.log("best distance: "+w.d));var P=[w.x,w.y];return P.distance=w.d,P}function $b6efaaece0bcc309$var$compareMax(e,t){return t.max-e.max}function $b6efaaece0bcc309$var$Cell(e,t,i,r){this.x=e,this.y=t,this.h=i,this.d=$b6efaaece0bcc309$var$pointToPolygonDist(e,t,r),this.max=this.d+this.h*Math.SQRT2}function $b6efaaece0bcc309$var$pointToPolygonDist(e,t,i){for(var r=!1,o=1/0,a=0;a<i.length;a++)for(var n=i[a],s=0,l=n.length,h=l-1;s<l;h=s++){var c=n[s],d=n[h];c[1]>t!=d[1]>t&&e<(d[0]-c[0])*(t-c[1])/(d[1]-c[1])+c[0]&&(r=!r),o=Math.min(o,$b6efaaece0bcc309$var$getSegDistSq(e,t,c,d))}return 0===o?0:(r?1:-1)*Math.sqrt(o)}function $b6efaaece0bcc309$var$getCentroidCell(e){for(var t=0,i=0,r=0,o=e[0],a=0,n=o.length,s=n-1;a<n;s=a++){var l=o[a],h=o[s],c=l[0]*h[1]-h[0]*l[1];i+=(l[0]+h[0])*c,r+=(l[1]+h[1])*c,t+=3*c}return 0===t?new $b6efaaece0bcc309$var$Cell(o[0][0],o[0][1],0,e):new $b6efaaece0bcc309$var$Cell(i/t,r/t,0,e)}function $b6efaaece0bcc309$var$getSegDistSq(e,t,i,r){var o=i[0],a=i[1],n=r[0]-o,s=r[1]-a;if(0!==n||0!==s){var l=((e-o)*n+(t-a)*s)/(n*n+s*s);l>1?(o=r[0],a=r[1]):l>0&&(o+=n*l,a+=s*l)}return(n=e-o)*n+(s=t-a)*s}$b6efaaece0bcc309$var$Queue.default&&($b6efaaece0bcc309$var$Queue=$b6efaaece0bcc309$var$Queue.default);class $38a97d266629f9dd$export$525628e68e798fb4 extends $4xklQ.Mesh{constructor(e,t){super(e,t),this.useType="room",this.parameter={}}initParams(e=[]){this.computeVertices(),this.computeArea(),this.computeCenter(),this.computeWalls(e)}setName(e){this.parameter.name=e}getName(){return this.parameter.name}computeVertices(){let e=Array.from(this.geometry.attributes.position.array);this.parameter.points=[];for(let t=0;t<e.length;t+=3)this.parameter.points.push(new $4xklQ.Vector2((0,$hrM0U.CommonFunc).keepDecimalRound(e[t],2),(0,$hrM0U.CommonFunc).keepDecimalRound(e[t+1],2)))}computeArea(){this.parameter.area=Math.abs($b590b02110506a77$export$96bdf6d9c66d7ba8.area(this.parameter.points)/1e6),this.parameter.area=(0,$hrM0U.CommonFunc).keepDecimalRound(this.parameter.area,2)}computeCenter(){let e=[];this.parameter.points.forEach(t=>{e.push((0,$hrM0U.CommonFunc).vectorTransformToArray(t,2))}),this.parameter.center=$b6efaaece0bcc309$export$a1687b1810059e02([e],1)}computeWalls(e){this.parameter.walls=[];for(let t=0;t<this.parameter.points.length;t++){let i=t==this.parameter.points.length-1?0:t+1;e.forEach(e=>{this.vecIsIn(this.parameter.points[t],this.parameter.points[i],e.parameter.points)&&this.parameter.walls.push(e)})}}vecIsIn(e,t,i){let r=!1,o=!1;for(let a=0;a<i.length;a++)e.equals(i[a])&&(r=!0),t.equals(i[a])&&(o=!0);return r&&o}updateVertex(){}}parcelRequire("jDRRp");var $4xklQ=parcelRequire("4xklQ"),$hrM0U=parcelRequire("hrM0U");class $b918a4521263ae88$export$d9d93634284e4ef0 extends $4xklQ.Mesh{constructor(e,t){super(e,t),this.type="FlueMesh"}hollow(){let e=this.geometry.clone();e.scale(.618,.618,1);let t=new $4xklQ.Mesh(e,this.material),i=(0,$hrM0U.CommonFunc).boolean(this,t);this.geometry=i.geometry}}class $5c31b6cd7f4237f1$export$4880b0ae5643c62b{constructor(e,t){this.wallList=e,this.editor=t,this.texture=this.editor.config.floorTexture,this.texture.wrapS=$4xklQ.RepeatWrapping,this.texture.wrapT=$4xklQ.RepeatWrapping,this.beamMaterial=new $4xklQ.MeshStandardMaterial({color:10394523,side:$4xklQ.DoubleSide}),this.pillarsMaterial=new $4xklQ.MeshStandardMaterial({color:10394523,side:$4xklQ.DoubleSide})}getFloorOld(){let e=this.getAllVertex(),t=this.getIndexArr(e),i=this.transformVertex(e);if(this.transformAdj(t,i),i.length<3)return[];$2176137edde06fbe$export$fee71b7b1f0877fa(i);let r=[];return this.getAllLines(e,r),r}getFloor2D(e="2D"){let t=[],i=this.preLoad();var r=MiniCycles.getResult(i.newVertices,i.allIndex);0==r.length&&console.log("is planar cycle",MiniCycles.is_planar(i.newVertices,i.allIndex));let o=this.getWallIndexes(i.wallPoints,i.allVertices,i.change);return this.removeWallCycle(r,o).forEach(r=>{let o=[];r.forEach(e=>{o.push(new $4xklQ.Vector3(i.allVertices[e][0],i.allVertices[e][1],20))});let a="2D"==e?this.createMesh(o):this.createFloor3D(o);a.useType="floor",t.push(a)}),t}createFloor3D(e){return(0,$hrM0U.CommonFunc).createFloor3D(e,this.texture)}preLoad(){let e=[],t=this.getAllPoints(e),i=this.getAllIndex(t),r=0,o=0;t.forEach(e=>{e[0]<r&&(r=e[0]),e[1]<o&&(o=e[1])});let a=[];t.forEach(e=>{a.push([e[0]+Math.abs(r),e[1]+Math.abs(o)])});let n=[];for(let e=0;e<a.length;e++){let t=[];i.forEach(i=>{i.includes(e)&&t.push(i)});for(let e=0;e<t.length-1;e++){let i=(0,$hrM0U.CommonFunc).getLineEquation(a[t[e][0]],a[t[e][1]]);for(let r=e+1;r<t.length;r++){let o=(0,$hrM0U.CommonFunc).getLineEquation(a[t[r][0]],a[t[r][1]]),s=(0,$hrM0U.CommonFunc).getIntersectPoint(i,o),l=[...t[e],...t[r]],h=!0;n.forEach(e=>{if((0,$hrM0U.CommonFunc).isEqualArray(e,l)){h=!1;return}}),"whole"==s&&h&&n.push(l)}}}let s=[];return n.forEach(e=>{let t,i,r,o,n,l,h,c;e.forEach(o=>{e.indexOf(o)!=e.lastIndexOf(o)?t=o:i||0==i?r=o:i=o}),c=a[i][0]==a[r][0]?1:0,o=Math.min(a[i][c],a[t][c],a[r][c]),n=Math.max(a[i][c],a[t][c],a[r][c]),a[i][c]<n&&a[i][c]>o&&(l=i,h=r),a[r][c]<n&&a[r][c]>o&&(l=r,h=i),(o==a[t][c]||n==a[t][c])&&s.push([[t,h],l])}),s.forEach(e=>{i.forEach((t,r)=>{if((0,$hrM0U.CommonFunc).isEqualArray(t,e[0])){i[r][i[r].indexOf(e[0][0])]=e[1];return}})}),{allVertices:t,newVertices:a,allIndex:i,change:s,wallPoints:e}}getWallIndexes(e,t,i){let r=[];return e.forEach(e=>{let o=this.transToIndex(e,t);for(let e=0;e<o.length;e++){let t=e==o.length-1?0:e+1;i.forEach(i=>{(i[0][0]==o[e]&&i[0][1]==o[t]||i[0][0]==o[t]&&i[0][1]==o[e])&&o.push(i[1])})}r.push(o)}),r}removeWallCycle(e,t){let i=[];return e.forEach(e=>{if(e.pop(),0==e.length)return;let r=!0;t.forEach(t=>{(0,$hrM0U.CommonFunc).isEqualArray(e,t)&&(r=!1)}),r&&i.push(e)}),i}getFloor(e=!1,t=!1,i="2D"){window.performance.now();let r=[];if(this.editor,e&&t)this.getVertexAdjByEdges(e,t,r);else{let e=this.getFloor2D(i);return window.performance.now(),e}return r}getMiniCycleTree(e,t){e.forEach(e=>{0==e.children.length?t.push(e.cycle):this.getMiniCycleTree(e.children,t)})}getAllPoints(e){let t=[];return this.wallList.forEach(i=>{let r=Array.from(i.geometry.attributes.position.array),o=[];for(let e=0;e<r.length/3;e++)e%3==1?(1==e||e==r.length/3-2)&&o.push([r[3*e],r[3*e+1]]):o.push([r[3*e],r[3*e+1]]),t.push([r[3*e],r[3*e+1]]);e.push(o)}),this.filterArray(t)}getAllIndex(e){let t=[],i=[];return this.wallList.forEach(e=>{let t=Array.from(e.geometry.attributes.position.array),r=[];for(let e=0;e<t.length/3/3;e++)0==r.length||e==t.length/3/3-1?(e==t.length/3/3-1&&i.push([r[0],[t[9*e],t[9*e+1]]],[r[2],[t[(3*e+2)*3],t[(3*e+2)*3+1]]]),i.push([[t[9*e],t[9*e+1]],[t[(3*e+1)*3],t[(3*e+1)*3+1]]],[[t[(3*e+1)*3],t[(3*e+1)*3+1]],[t[(3*e+2)*3],t[(3*e+2)*3+1]]])):i.push([r[0],[t[9*e],t[9*e+1]]],[r[2],[t[(3*e+2)*3],t[(3*e+2)*3+1]]]),r=[[t[9*e],t[9*e+1]],[t[(3*e+1)*3],t[(3*e+1)*3+1]],[t[(3*e+2)*3],t[(3*e+2)*3+1]]]}),i.forEach(i=>{t.push([this.getIndex(e,i[0]),this.getIndex(e,i[1])])}),this.filterArray(t)}createCircle(e){let t=new $4xklQ.SphereGeometry(50),i=new $4xklQ.Mesh(t,new $4xklQ.MeshBasicMaterial({color:16711680}));return i.position.copy(e),i}transToIndex(e,t){let i=[];return e.forEach(e=>{i.push(this.getIndex(t,e))}),i}transformVertex(e){let t=[];return e.forEach(function(e){t.push({x:e[0],y:e[1],adj:[]})}),t}transformAdj(e,t){e.forEach(function(e){let i=t[e[0]],r=t[e[1]];i.adj.push(r),r.adj.push(i)})}getAllLines(e,t){let i=Array(e.length).fill(0);this.wallList.forEach(t=>{let r=[t.startPoint.x,t.startPoint.y],o=[t.endPoint.x,t.endPoint.y];i[this.getIndex(e,r)]++,i[this.getIndex(e,o)]++});let r=[],o=this.getAllVertices(r),a=[];this.wallList.forEach(t=>{let r=Array.from(t.geometry.attributes.position.array);if(18==r.length){let n=[r[0],r[1]],s=[r[9],r[10]],l=[r[6],r[7]],h=[r[15],r[16]];a.push([this.getIndex(o,n),this.getIndex(o,s)],[this.getIndex(o,l),this.getIndex(o,h)]),1==i[this.getIndex(e,[t.startPoint.x,t.startPoint.y])]&&a.push([this.getIndex(o,n),this.getIndex(o,l)]),1==i[this.getIndex(e,[t.endPoint.x,t.endPoint.y])]&&a.push([this.getIndex(o,s),this.getIndex(o,h)])}else{for(let e=0;e<r.length/9-1;e++){let t=[r[9*e],r[9*e+1]],i=[r[(e+1)*9],r[(e+1)*9+1]],n=[r[(3*e+2)*3],r[(3*e+2)*3+1]],s=[r[((e+1)*3+2)*3],r[((e+1)*3+2)*3+1]];a.push([this.getIndex(o,t),this.getIndex(o,i)],[this.getIndex(o,n),this.getIndex(o,s)])}if(1==i[this.getIndex(e,[t.startPoint.x,t.startPoint.y])]){let e=[r[0],r[1]],t=[r[6],r[7]];a.push([this.getIndex(o,e),this.getIndex(o,t)])}if(1==i[this.getIndex(e,[t.endPoint.x,t.endPoint.y])]){let e=[r[r.length-3],r[r.length-2]],t=[r[r.length-9],r[r.length-8]];a.push([this.getIndex(o,e),this.getIndex(o,t)])}}});let n=this.transformVertex(o);this.transformAdj(a,n);let s=$2176137edde06fbe$export$fee71b7b1f0877fa(n),l=[];s.forEach(e=>{let t=[];e.forEach(e=>{t.push(e.x,e.y)}),l.push(t)});let h=this.getRoom(l,t);(h=this.deleteWallCircle(h,r)).forEach(e=>{let i=[];for(let t=0;t<e.length/2;t++)i.push(new $4xklQ.Vector2(e[2*t],e[2*t+1]));let r=this.createMesh(i);r.useType="floor",t.push(r)})}getVertexAdjByEdges(e,t,i){let r=[];e.forEach(e=>{let t=[e[0],e[1]],i=[e[2],e[3]];r.push(t,i)}),r=this.filterArray(r);let o=[];e.forEach(e=>{let t=[e[0],e[1]],i=[e[2],e[3]];new $4xklQ.Vector2(e[0],e[1]),new $4xklQ.Vector2(e[2],e[3]),o.push([this.getIndex(r,t),this.getIndex(r,i)])});let a=this.transformVertex(r);this.transformAdj(o,a);let n=$2176137edde06fbe$export$fee71b7b1f0877fa(a),s=[];n.forEach(e=>{let t=[];e.forEach(e=>{t.push(e.x,e.y)}),s.push(t)});let l=this.getRoom(s,i);(l=this.deleteWallCircle(l,t)).forEach(e=>{let t=[];for(let i=0;i<e.length/2;i++)t.push(new $4xklQ.Vector2(e[2*i],e[2*i+1]));let r=this.createMesh(t);r.useType="floor",i.push(r)})}getAllVertices(e){let t=[];return this.wallList.forEach(i=>{let r=[],o=Array.from(i.geometry.attributes.position.array);for(let e=0;e<o.length/9-1;e++)r.push([o[9*e],o[9*e+1]],[o[(e+1)*9],o[(e+1)*9+1]],[o[(3*e+2)*3],o[(3*e+2)*3+1]],[o[((e+1)*3+2)*3],o[((e+1)*3+2)*3+1]]),t.push([o[9*e],o[9*e+1]],[o[(e+1)*9],o[(e+1)*9+1]],[o[(3*e+2)*3],o[(3*e+2)*3+1]],[o[((e+1)*3+2)*3],o[((e+1)*3+2)*3+1]]);let a=[];this.filterArray(r).forEach(e=>{a.push({x:e[0],y:e[1]})}),e.push(a)}),this.filterArray(t)}handleIndex(e,t,i=0){console.log(t[e[i][0]],t[e[i][1]])}getRoom(e,t){let i=Array(e.length);for(let e=0;e<i.length;e++)i[e]=[,,].fill(0);for(let t=0;t<e.length-1;t++)for(let r=t+1;r<e.length;r++){let o=e[r].length/2,a=0,n=0;for(let i=0;i<o;i++)$a59c92c620a56c0f$export$7f6bc8d3d7d61b11([e[r][2*i],e[r][2*i+1]],e[t])?a++:n++;if(a===o)i[t][0]++,i[r][1]++;else{let o=0;for(let i=0;i<e[t].length/2;i++)$a59c92c620a56c0f$export$7f6bc8d3d7d61b11([e[t][2*i],e[t][2*i+1]],e[r])?a++:n++;o==e[t].length/2&&(i[t][1]++,i[r][0]++)}}return i.reverse().forEach((t,r)=>{0==t[1]&&0!=t[0]&&e.splice(i.length-1-r,1)}),e}deleteWallCircle(e,t){let i=[];for(let r=0;r<e.length;r++){let o=e[r],a=this.findWallByVertex(t,o),n=[];a.forEach(e=>{n.push(...t[e])});let s=[];n.forEach(e=>{s.push([e.x,e.y])}),s=this.filterArray(s);let l=[];for(let e=0;e<o.length/2;e++)l.push([o[2*e],o[2*e+1]]);l=this.filterArray(l),this.isEqual(s,l)&&i.push(r)}return i.reverse().forEach(t=>{e.splice(t,1)}),e}findWallByVertex(e,t){let i=Array(t.length/2);for(let e=0;e<i.length;e++)i[e]=[];for(let r=0;r<e.length;r++)for(let o=0;o<e[r].length;o++)for(let a=0;a<t.length/2;a++)e[r][o].x==t[2*a]&&e[r][o].y==t[2*a+1]&&i[a].push(r);let r=[];return i.forEach(e=>{r.push(...e)}),Array.from(new Set(r))}isEqual(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++){let r=!1;for(let o=0;o<t.length;o++)if(!r){if(e[i][0]==t[o][0]&&e[i][1]==t[o][1]){r=!0;continue}if(o==t.length-1)return!1}}for(let i=0;i<t.length;i++){let r=!1;for(let o=0;o<e.length;o++)if(!r){if(t[i][0]==e[o][0]&&t[i][1]==e[o][1]){r=!0;continue}if(o==e.length-1)return!1}}return!0}isInPoly(e,t){for(let i=0;i<e.length/2;i++)if(!PolyK.ContainsPoint(t,e[2*i],e[2*i+1]))return!1;return!0}getCeiling(){let e=this.getFloor(),t=[];this.wallList.forEach(e=>{t.push(e.height)});let i=Math.max(...t),r=[];for(let t=0;t<e.length;t++){let o=e[t].geometry.clone(),a=Array.from(o.attributes.position.array);for(let e=0;e<a.length/3;e++)a[3*e+2]=i;o.attributes.position=new $4xklQ.BufferAttribute(new Float32Array(a),3);let n=Array.from(o.index.array);for(let e=0;e<n.length/3;e++){let t=n[3*e];n[3*e]=n[3*e+2],n[3*e+2]=t}o.index=new $4xklQ.BufferAttribute(new Uint16Array(n),1),o.computeVertexNormals();let s=new $4xklQ.Mesh(o,new $4xklQ.MeshStandardMaterial({color:10394523}));r.push(s)}return r}getBeam(e,t){let i=[],r=new $5XTH3.DrawWallTool;for(let o=0;o<e.length;o++){if("beam"==e[o].type){let a=this.getShape(e[o],t,r),n={steps:2,depth:e[o].depth,bevelEnabled:!1,bevelThickness:1,bevelSize:1,bevelSegments:1},s=new $4xklQ.ExtrudeGeometry(a,n);s.computeBoundingBox();let l=s.boundingBox.min.clone().add(s.boundingBox.max).divideScalar(2);s.center();let h=new $4xklQ.Mesh(s,this.beamMaterial);h.name="beam",h.position.set(l.x,l.y,e[o].location.z),i.push(h)}if("pillars"==e[o].type||"flue"==e[o].type){let t=this.createPillars(e[o]),r={steps:2,depth:e[o].depth,bevelEnabled:!1,bevelThickness:1,bevelSize:1,bevelSegments:1},a=new $4xklQ.ExtrudeGeometry(t,r);a.computeBoundingBox();let n=a.boundingBox.min.clone().add(a.boundingBox.max).divideScalar(2);a.center();let s=new $4xklQ.Mesh(a,this.pillarsMaterial);s.name=e[o].type,s.position.set(n.x,n.y,e[o].location.z),i.push(s)}}return console.log(i),i}getBeamNew(e,t){let i=[];for(let r=0;r<e.length;r++){let o={steps:2,depth:e[r].depth,bevelEnabled:!1,bevelThickness:1,bevelSize:1,bevelSegments:1},a=new $4xklQ.Shape,n;t[r].children.forEach(e=>{"Mesh"==e.type&&(n=e.geometry)});let s=Array.from(n.attributes.position.array),l=[];for(let e=0;e<s.length/3;e++)l.push(new $4xklQ.Vector2(s[3*e]*t[r].scale.x,s[3*e+1]*t[r].scale.y));a.moveTo(l[0].x,l[0].y);for(let e=1;e<l.length;e++)a.lineTo(l[e].x,l[e].y);a.lineTo(l[0].x,l[0].y);let h=new $4xklQ.ExtrudeGeometry(a,o);h.computeBoundingBox(),h.center();let c=t[r].position;if("beam"==e[r].type){let o=new $4xklQ.Mesh(h,this.beamMaterial);o.name="beam",o.modeType=e[r].type,o.rotation.z=t[r].rotation.z,o.position.set(c.x,c.y,e[r].location.z),o.model2DId=e[r].id,t[r].threeD=o,o.twoD=t[r],i.push(o)}if("pillars"==e[r].type||"flue"==e[r].type){let o="flue"==e[r].type?new $b918a4521263ae88$export$d9d93634284e4ef0(h,this.pillarsMaterial):new $4xklQ.Mesh(h,this.pillarsMaterial);"flue"==e[r].type&&o.hollow(),o.name=e[r].type,o.modeType=e[r].type,o.position.set(c.x,c.y,e[r].location.z),o.rotation.z=t[r].rotation.z,o.model2DId=e[r].id,t[r].threeD=o,o.twoD=t[r],i.push(o)}}return i}getShape(e,t,i){let r,o;let a=new $4xklQ.Vector2(e.location.x,e.location.y),n=a.clone(),s=a.clone();e.rotation%Math.PI==0?(r="Y",o=a.y):e.rotation%(Math.PI/2)==0?(r="X",o=a.x):(r=Math.round(1e3*Math.tan(e.rotation))/1e3,o=a.y-r*a.x);let l="X"==r||"Y"==r?e.height/2:e.height/2/Math.cos(e.rotation);"X"==r?(n.x+=l,s.x-=l):(n.y+=l,s.y-=l);let h=(0,$9QhXH.DM).getIntersect(n,r,o+l,t,i),c=(0,$9QhXH.DM).getIntersect(a,r,o,t,i),d=(0,$9QhXH.DM).getIntersect(s,r,o-l,t,i),p=new $4xklQ.Shape;return p.moveTo(h[0].x,h[0].y),p.lineTo(c[0].x,c[0].y),p.lineTo(d[0].x,d[0].y),p.lineTo(d[1].x,d[1].y),p.lineTo(c[1].x,c[1].y),p.lineTo(h[1].x,h[1].y),p.lineTo(h[0].x,h[0].y),p}createPillars(e){let t=new $4xklQ.Vector2(e.location.x,e.location.y),i=t.clone().add(new $4xklQ.Vector2(-e.width/2,0)).add(new $4xklQ.Vector2(0,e.height/2)),r=t.clone().add(new $4xklQ.Vector2(e.width/2,0)).add(new $4xklQ.Vector2(0,e.height/2)),o=t.clone().add(new $4xklQ.Vector2(e.width/2,0)).add(new $4xklQ.Vector2(0,-e.height/2)),a=t.clone().add(new $4xklQ.Vector2(-e.width/2,0)).add(new $4xklQ.Vector2(0,-e.height/2)),n=new $4xklQ.Shape;return n.moveTo(i.x,i.y),n.lineTo(r.x,r.y),n.lineTo(o.x,o.y),n.lineTo(a.x,a.y),n.lineTo(i.x,i.y),n}getAllVertex(){let e=[];return this.wallList.forEach(function(t){let i=[t.startPoint.x,t.startPoint.y],r=[t.endPoint.x,t.endPoint.y];e.push(i,r)}),this.filterArray(e)}checkNum(e,t){let i=0;for(let r=0;r<e.length;r++){let o=e[r].startPoint,a=e[r].endPoint;if(o.x==t.x&&o.y==t.y&&i++,a.x==t.x&&a.y==t.y&&i++,i>1)return!0}return!1}filterArray(e){let t=[];return e.forEach(e=>{let i=!0;t.forEach(r=>{r?(e[0]===r[0]&&e[1]===r[1]&&(i=!1),e[0]===r[1]&&e[1]===r[0]&&(i=!1)):t.push(e)}),i&&t.push(e)}),t}getIndexArr(e){let t=[];for(let i=0;i<this.wallList.length;i++){let r=this.wallList[i],o=[r.startPoint.x,r.startPoint.y],a=[r.endPoint.x,r.endPoint.y];t.push([this.getIndex(e,o),this.getIndex(e,a)])}return t}getIndexArr2(e,t){let i=[];for(let r=0;r<t.length;r++){let o=t[r],a=Array.from(o.geometry.attributes.position.array);for(let t=0;t<a.length/9-1;t++){let r=[a[9*t],a[9*t+1]],o=[a[(t+1)*9],a[(t+1)*9+1]],n=[a[(3*t+2)*3],a[(3*t+2)*3+1]],s=[a[((t+1)*3+2)*3],a[((t+1)*3+2)*3+1]];i.push([this.getIndex(e,r),this.getIndex(e,o)],[this.getIndex(e,n),this.getIndex(e,s)])}if(this.checkNum(t,o.startPoint)){if(!this.checkNum(t,o.endPoint)){let t=[a[(a.length/3-1)*3],a[(a.length/3-1)*3+1]],r=[a[(a.length/3-3)*3],a[(a.length/3-3)*3+1]];i.push([this.getIndex(e,t),this.getIndex(e,r)])}}else{let t=[a[0],a[1]],r=[a[6],a[7]];i.push([this.getIndex(e,t),this.getIndex(e,r)])}}return i}getIndex(e,t){for(let i=0;i<e.length;i++)if(t[0]==e[i][0]&&t[1]==e[i][1])return i;return!1}createFloor(e){let t=[];for(let i=0;i<e.length;i++){let r=[],o=[],a=e[i],n=[];for(let e=0;e<a.length;e++){let t=a[e],i=e,o=i==a.length-1?a[0]:a[i+1],s=this.getWall(t,o);n.push(s);let l=this.getLineData(t,o,s.thickness/2);s.isRoomInnerWall=l,r.push(l)}let s=[],l=[],h=!1;for(let e=0;e<n.length;e++)if(n[e].isArc){let t=Array.from(n[e].geometry.attributes.position.array);for(let e=0;e<t.length/9;e++){let i=[t[9*e],t[9*e+1]],r=[t[9*e+6],t[9*e+7]],o=[t[9*e+9],t[9*e+10]],a=[t[9*e+15],t[9*e+16]];l.push([i,o],[r,a])}h=!0}else{let t=Array.from(n[e].geometry.attributes.position.array),i=[t[0],t[1]],r=[t[6],t[7]],o=[t[9],t[10]],a=[t[15],t[16]];s.push(i,r,o,a),l.push([i,o],[r,a])}if(h){for(let e=0;e<n.length;e++)if(!n[e].isArc){let i=Array.from(n[e].geometry.attributes.position.array),r=[i[0],i[1]],o=[i[6],i[7]],a=[i[9],i[10]],s=[i[15],i[16]],h=this.getCycle([r,a],l),c=this.getCycle([o,s],l),d=[],p=[];h&&(d.push(...h[0]),h.shift(),d=this.getPoints(d[1],h,d)),c&&(p.push(...c[0]),c.shift(),p=this.getPoints(p[1],c,p));let u=[],m=[];if(d.forEach(function(e){u.push(new $4xklQ.Vector2(e[0],e[1]))}),p.forEach(function(e){m.push(new $4xklQ.Vector2(e[0],e[1]))}),d.length>0&&p.length>0){let e=Math.abs($b590b02110506a77$export$96bdf6d9c66d7ba8.area(u))>Math.abs($b590b02110506a77$export$96bdf6d9c66d7ba8.area(m))?this.createMesh(m):this.createMesh(u);t.push(e)}if(d.length>0&&0==p.length){let e=this.createMesh(u);t.push(e)}if(0==d.length&&p.length>0){let e=this.createMesh(m);t.push(e)}break}continue}for(let e=0;e<r.length;e++){let t=r[e],i=e,s=i==r.length-1?r[0]:r[i+1],l=i==r.length-1?a[0]:a[i+1];0==i?a[i+1]:a[i-1];let h=n[i],c=i==r.length-1?n[0]:n[i+1];if(h.isArc)console.log("当前墙是弧线墙");else if(c.isArc);else{let e=this.getIntersectPoint(t,s,l);o.push(e)}}let c=this.createMesh(o);t.push(c)}return t}createFloorNew(e){let t=[];return e.forEach(e=>{let i=[],r=[],o=[];for(let t=0;t<e.length;t++)for(let i=0;i<this.wallList.length;i++){let a=this.wallList[i],n=a.startPoint,s=a.endPoint;if(n.x==e[t].x&&n.y==e[t].y||s.x==e[t].x&&s.y==e[t].y){-1==o.indexOf(a)&&o.push(a);let e=Array.from(a.geometry.attributes.position.array);for(let t=0;t<e.length/9-1;t++)r.push([e[9*t],e[9*t+1]],[e[(t+1)*9],e[(t+1)*9+1]],[e[(3*t+2)*3],e[(3*t+2)*3+1]],[e[((t+1)*3+2)*3],e[((t+1)*3+2)*3+1]])}}r=this.filterArray(r);let a=this.getIndexArr2(r,o),n=this.transformVertex(r);this.transformAdj(a,n);let s=$2176137edde06fbe$export$fee71b7b1f0877fa(n),l=0,h;s.forEach(e=>{let t=[];e.forEach(e=>{t.push(new $4xklQ.Vector2(e.x,e.y))});let r=this.createMesh(t);r.useType="floor";let o=Math.round(100*Math.abs($b590b02110506a77$export$96bdf6d9c66d7ba8.area(t)/1e6))/100;o>l&&(l=o,h=r),i.push(r)}),i.splice(i.indexOf(h),1),1==i.length&&t.push(...i)}),t}createMesh(e){let t=new $4xklQ.Shape;t.moveTo(e[0].x,e[0].y);for(let i=1;i<e.length;i++)t.lineTo(e[i].x,e[i].y);t.lineTo(e[0].x,e[0].y);let i=new $4xklQ.ShapeGeometry(t),r=i.attributes.position.array;i.computeBoundingBox();let o=i.boundingBox.min,a=i.boundingBox.max,n=a.x-o.x,s=a.y-o.y,l=[o.x,o.y],h=[];for(let e=0;e<r.length/3;e++){let t=[r[3*e],r[3*e+1]];h.push(...[(t[0]-l[0])/n,(t[1]-l[1])/s])}let c=new $4xklQ.Matrix3().setUvTransform(0,0,n/1920,s/1920,0,0,0),d=new $4xklQ.BufferAttribute(new Float32Array(h),2);d.applyMatrix3(c),h=Array.from(d.array),i.attributes.uv=new $4xklQ.BufferAttribute(new Float32Array(h),2);let p=new $38a97d266629f9dd$export$525628e68e798fb4(i,new $4xklQ.MeshStandardMaterial({map:this.texture}));return p.initParams(this.wallList),p.allPoints=e,p}getPoints(e,t,i){let r=i[0],o=i[1];for(let a=0;a<t.length;a++){let n=t[a][0],s=t[a][1],l=r[0]==n[0]&&r[1]==n[1],h=r[0]==s[0]&&r[1]==s[1],c=o[0]==n[0]&&o[1]==n[1],d=o[0]==s[0]&&o[1]==s[1];if((!l||!d)&&(!h||!c)){if(n[0]==e[0]&&n[1]==e[1])return i.push(s),t.splice(a,1),this.getPoints(s,t,i);if(s[0]==e[0]&&s[1]==e[1])return i.push(n),t.splice(a,1),this.getPoints(n,t,i)}}return i}getWall(e,t){let i=[];for(let r=0;r<this.wallList.length;r++){let o=this.wallList[r],a=e.x==o.startPoint.x&&e.y==o.startPoint.y,n=e.x==o.endPoint.x&&e.y==o.endPoint.y,s=t.x==o.startPoint.x&&t.y==o.startPoint.y,l=t.x==o.endPoint.x&&t.y==o.endPoint.y;if(a){if(l)i.push(o);else{let e=!0;for(let t=0;t<this.wallList.length;t++)if(r!=t){let i=this.wallList[t].startPoint.x==o.endPoint.x&&this.wallList[t].startPoint.y==o.endPoint.y,r=this.wallList[t].endPoint.x==o.endPoint.x&&this.wallList[t].endPoint.y==o.endPoint.y;(i||r)&&(e=!1)}e&&i.push(o)}}else if(n){if(s)i.push(o);else{let e=!0;for(let t=0;t<this.wallList.length;t++)if(r!=t){let i=this.wallList[t].startPoint.x==o.startPoint.x&&this.wallList[t].startPoint.y==o.startPoint.y,r=this.wallList[t].endPoint.x==o.startPoint.x&&this.wallList[t].endPoint.y==o.startPoint.y;(i||r)&&(e=!1)}e&&i.push(o)}}}return i}getLineData(e,t,i){let r,o;e.x==t.x?(r="X",o=e.x):e.y==t.y?(r="Y",o=e.y):(r=(e.y-t.y)/(e.x-t.x),o=e.y-r*e.x);let a=new $4xklQ.Vector2(t.x,t.y).sub(new $4xklQ.Vector2(e.x,e.y));return 0!=Math.abs(Number(Math.cos(a.angle())).toFixed(11))&&1!=Math.abs(Number(Math.cos(a.angle())).toFixed(11))?o-=i/Number(Math.cos(a.angle())).toFixed(11):(180*a.angle()/Math.PI==0&&(o-=i),180*a.angle()/Math.PI==90&&(o+=i),180*a.angle()/Math.PI==180&&(o+=i),180*a.angle()/Math.PI==270&&(o-=i)),[r,o]}getIntersectPoint(e,t,i){if("X"==e[0]){if("X"==t[0])return e[1]==t[1]&&new $4xklQ.Vector2(e[1],i.y);if("Y"==t[0])return new $4xklQ.Vector2(e[1],t[1]);var r=t[0]*e[1]+t[1];return new $4xklQ.Vector2(e[1],r)}if("Y"==e[0]){if("X"==t[0])return new $4xklQ.Vector2(t[1],e[1]);if("Y"==t[0])return e[1]==t[1]&&new $4xklQ.Vector2(i.x,e[1]);var o=(e[1]-t[1])/t[0];return new $4xklQ.Vector2(o,e[1])}if("X"==t[0]){var r=e[0]*t[1]+e[1];return new $4xklQ.Vector2(t[1],r)}if("Y"==t[0]){var o=(t[1]-e[1])/e[0];return new $4xklQ.Vector2(o,t[1])}if(e[0]==t[0]){let t=-1/e[0],r=i.y-t*i.x,o=(r-e[1])/(e[0]-t),a=t*o+r;return new $4xklQ.Vector2(o,a)}var o=(t[1]-e[1])/(e[0]-t[0]),r=e[0]*o+e[1];return new $4xklQ.Vector2(o,r)}}var $5sV3G=parcelRequire("5sV3G"),$9HO6e=parcelRequire("9HO6e"),$9QhXH=parcelRequire("9QhXH");parcelRequire("3BPdS");var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ");const $a69b488eccbcfd7b$var$_changeEvent={type:"change"},$a69b488eccbcfd7b$var$_startEvent={type:"start"},$a69b488eccbcfd7b$var$_endEvent={type:"end"};class $a69b488eccbcfd7b$export$8ff7788029dfdf52 extends $4xklQ.EventDispatcher{constructor(e,t,i){super(),void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new $4xklQ.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:$4xklQ.MOUSE.ROTATE,MIDDLE:$4xklQ.MOUSE.DOLLY,RIGHT:$4xklQ.MOUSE.PAN},this.touches={ONE:$4xklQ.TOUCH.ROTATE,TWO:$4xklQ.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return s.phi},this.getAzimuthalAngle=function(){return s.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",eo),this._domElementKeyEvents=e},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent($a69b488eccbcfd7b$var$_changeEvent),r.update(),a=o.NONE},this.update=function(){let t=new $4xklQ.Vector3,i=new(0,$4xklQ.Quaternion)().setFromUnitVectors(e.up,new $4xklQ.Vector3(0,1,0)),p=i.clone().invert(),u=new $4xklQ.Vector3,m=new $4xklQ.Quaternion,g=2*Math.PI;return function(){let e=r.object.position;t.copy(e).sub(r.target),t.applyQuaternion(i),s.setFromVector3(t),r.autoRotate&&a===o.NONE&&D(M()),r.enableDamping?(s.theta+=l.theta*r.dampingFactor,s.phi+=l.phi*r.dampingFactor):(s.theta+=l.theta,s.phi+=l.phi);let f=r.minAzimuthAngle,w=r.maxAzimuthAngle;return isFinite(f)&&isFinite(w)&&(f<-Math.PI?f+=g:f>Math.PI&&(f-=g),w<-Math.PI?w+=g:w>Math.PI&&(w-=g),f<=w?s.theta=Math.max(f,Math.min(w,s.theta)):s.theta=s.theta>(f+w)/2?Math.max(f,s.theta):Math.min(w,s.theta)),s.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,s.phi)),s.makeSafe(),s.radius*=h,s.radius=Math.max(r.minDistance,Math.min(r.maxDistance,s.radius)),!0===r.enableDamping?r.target.addScaledVector(c,r.dampingFactor):r.target.add(c),t.setFromSpherical(s),t.applyQuaternion(p),e.copy(r.target).add(t),r.object.lookAt(r.target),!0===r.enableDamping?(l.theta*=1-r.dampingFactor,l.phi*=1-r.dampingFactor,c.multiplyScalar(1-r.dampingFactor)):(l.set(0,0,0),c.set(0,0,0)),h=1,!!(d||u.distanceToSquared(r.object.position)>n||8*(1-m.dot(r.object.quaternion))>n)&&(r.dispatchEvent($a69b488eccbcfd7b$var$_changeEvent),u.copy(r.object.position),m.copy(r.object.quaternion),d=!1,!0)}}(),this.dispose=function(){r.domElement.removeEventListener("contextmenu",es),r.domElement.removeEventListener("pointerdown",Q),r.domElement.removeEventListener("pointercancel",ee),r.domElement.removeEventListener("wheel",er),r.domElement.removeEventListener("pointermove",Z),r.domElement.removeEventListener("pointerup",K),null!==r._domElementKeyEvents&&r._domElementKeyEvents.removeEventListener("keydown",eo)};let r=this,o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},a=o.NONE,n=1e-6,s=new $4xklQ.Spherical,l=new $4xklQ.Spherical,h=1,c=new $4xklQ.Vector3,d=!1,p=new $4xklQ.Vector2,u=new $4xklQ.Vector2,m=new $4xklQ.Vector2,g=new $4xklQ.Vector2,f=new $4xklQ.Vector2,w=new $4xklQ.Vector2,y=new $4xklQ.Vector2,b=new $4xklQ.Vector2,x=new $4xklQ.Vector2,P=[],v={};function M(){return 2*Math.PI/60/60*r.autoRotateSpeed}function C(){return Math.pow(.95,r.zoomSpeed)}function D(e){l.theta-=e}function T(e){l.phi-=e}let S=function(){let e=new $4xklQ.Vector3;return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),c.add(e)}}(),k=function(){let e=new $4xklQ.Vector3;return function(t,i){!0===r.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(r.object.up,e)),e.multiplyScalar(t),c.add(e)}}(),V=function(){let e=new $4xklQ.Vector3;return function(t,i){let o=r.domElement;if(r.object.isPerspectiveCamera){let a=r.object.position;e.copy(a).sub(r.target);let n=e.length();S(2*t*(n*=Math.tan(r.object.fov/2*Math.PI/180))/o.clientHeight,r.object.matrix),k(2*i*n/o.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(S(t*(r.object.right-r.object.left)/r.object.zoom/o.clientWidth,r.object.matrix),k(i*(r.object.top-r.object.bottom)/r.object.zoom/o.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}}();function A(e){if(r.object.isPerspectiveCamera){let t=1500/s.radius/100;t<.11&&(t=.1,s.radius=150),r.object.zoomNum=t,i.list.changeCameraSlider.dispatch("2d",t),t>.11&&(h/=e)}else if(r.object.isOrthographicCamera){let t=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*e));t<.11&&(t=.1),r.object.zoom=t,i.autoShowHidden(t),i.list.changeCameraSlider.dispatch("2d",t),r.object.updateProjectionMatrix(),d=!0}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1}function L(e){if(r.object.isPerspectiveCamera){h*=e;let t=1500/s.radius/100;r.object.zoomNum=t,i.list.changeCameraSlider.dispatch("2d",t)}else if(r.object.isOrthographicCamera){r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/e));let t=r.object.zoom;i.autoShowHidden(t),i.list.changeCameraSlider.dispatch("2d",r.object.zoom),r.object.updateProjectionMatrix(),d=!0}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1}function W(e){p.set(e.clientX,e.clientY)}function I(e){y.set(e.clientX,e.clientY)}function R(e){g.set(e.clientX,e.clientY)}function B(e){u.set(e.clientX,e.clientY),m.subVectors(u,p).multiplyScalar(r.rotateSpeed);let t=r.domElement;D(2*Math.PI*m.x/t.clientHeight),T(2*Math.PI*m.y/t.clientHeight),p.copy(u),r.update()}function E(e){b.set(e.clientX,e.clientY),x.subVectors(b,y),x.y>0?A(C()):x.y<0&&L(C()),y.copy(b),r.update()}function O(e){f.set(e.clientX,e.clientY),w.subVectors(f,g).multiplyScalar(r.panSpeed),V(w.x,w.y),g.copy(f),r.update()}function F(e){e.deltaY<0?L(C()):e.deltaY>0&&A(C()),r.update(),i.updateDom()}function z(e){let t=!1;switch(e.code){case r.keys.UP:V(0,r.keyPanSpeed),t=!0;break;case r.keys.BOTTOM:V(0,-r.keyPanSpeed),t=!0;break;case r.keys.LEFT:V(r.keyPanSpeed,0),t=!0;break;case r.keys.RIGHT:V(-r.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),r.update())}function G(){if(1===P.length)p.set(P[0].pageX,P[0].pageY);else{let e=.5*(P[0].pageX+P[1].pageX),t=.5*(P[0].pageY+P[1].pageY);p.set(e,t)}}function H(){if(1===P.length)g.set(P[0].pageX,P[0].pageY);else{let e=.5*(P[0].pageX+P[1].pageX),t=.5*(P[0].pageY+P[1].pageY);g.set(e,t)}}function j(){let e=P[0].pageX-P[1].pageX,t=P[0].pageY-P[1].pageY,i=Math.sqrt(e*e+t*t);y.set(0,i)}function _(){r.enableZoom&&j(),r.enablePan&&H()}function U(){r.enableZoom&&j(),r.enableRotate&&G()}function N(e){if(1==P.length)u.set(e.pageX,e.pageY);else{let t=ed(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);u.set(i,r)}m.subVectors(u,p).multiplyScalar(r.rotateSpeed);let t=r.domElement;D(2*Math.PI*m.x/t.clientHeight),T(2*Math.PI*m.y/t.clientHeight),p.copy(u)}function q(e){if(1===P.length)f.set(e.pageX,e.pageY);else{let t=ed(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);f.set(i,r)}w.subVectors(f,g).multiplyScalar(r.panSpeed),V(w.x,w.y),g.copy(f)}function Y(e){let t=ed(e),i=e.pageX-t.x,o=e.pageY-t.y,a=Math.sqrt(i*i+o*o);b.set(0,a),x.set(0,Math.pow(b.y/y.y,r.zoomSpeed)),A(x.y),y.copy(b)}function X(e){r.enableZoom&&Y(e),r.enablePan&&q(e)}function J(e){r.enableZoom&&Y(e),r.enableRotate&&N(e)}function Q(e){!1!==r.enabled&&(0===P.length&&(r.domElement.setPointerCapture(e.pointerId),r.domElement.addEventListener("pointermove",Z),r.domElement.addEventListener("pointerup",K)),el(e),"touch"===e.pointerType?ea(e):et(e))}function Z(e){!1!==r.enabled&&("touch"===e.pointerType?en(e):ei(e))}function K(e){eh(e),0===P.length&&(r.domElement.releasePointerCapture(e.pointerId),r.domElement.removeEventListener("pointermove",Z),r.domElement.removeEventListener("pointerup",K)),r.dispatchEvent($a69b488eccbcfd7b$var$_endEvent),a=o.NONE}function ee(e){eh(e)}function et(e){let t;switch(e.button){case 0:t=r.mouseButtons.LEFT;break;case 1:t=r.mouseButtons.MIDDLE;break;case 2:t=r.mouseButtons.RIGHT;break;default:t=-1}switch(t){case $4xklQ.MOUSE.DOLLY:if(!1===r.enableZoom)return;I(e),a=o.DOLLY;break;case $4xklQ.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enablePan)return;R(e),a=o.PAN}else{if(!1===r.enableRotate)return;W(e),a=o.ROTATE}break;case $4xklQ.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enableRotate)return;W(e),a=o.ROTATE}else{if(!1===r.enablePan)return;R(e),a=o.PAN}break;default:a=o.NONE}a!==o.NONE&&r.dispatchEvent($a69b488eccbcfd7b$var$_startEvent)}function ei(e){if(!1!==r.enabled)switch(a){case o.ROTATE:if(!1===r.enableRotate)return;B(e);break;case o.DOLLY:if(!1===r.enableZoom)return;E(e);break;case o.PAN:if(!1===r.enablePan)return;O(e),i.updateDom()}}function er(e){!1!==r.enabled&&!1!==r.enableZoom&&a===o.NONE&&(e.preventDefault(),r.dispatchEvent($a69b488eccbcfd7b$var$_startEvent),F(e),r.dispatchEvent($a69b488eccbcfd7b$var$_endEvent))}function eo(e){!1!==r.enabled&&!1!==r.enablePan&&z(e)}function ea(e){switch(ec(e),P.length){case 1:switch(r.touches.ONE){case $4xklQ.TOUCH.ROTATE:if(!1===r.enableRotate)return;G(),a=o.TOUCH_ROTATE;break;case $4xklQ.TOUCH.PAN:if(!1===r.enablePan)return;H(),a=o.TOUCH_PAN;break;default:a=o.NONE}break;case 2:switch(r.touches.TWO){case $4xklQ.TOUCH.DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;_(),a=o.TOUCH_DOLLY_PAN;break;case $4xklQ.TOUCH.DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;U(),a=o.TOUCH_DOLLY_ROTATE;break;default:a=o.NONE}break;default:a=o.NONE}a!==o.NONE&&r.dispatchEvent($a69b488eccbcfd7b$var$_startEvent)}function en(e){switch(ec(e),a){case o.TOUCH_ROTATE:if(!1===r.enableRotate)return;N(e),r.update();break;case o.TOUCH_PAN:if(!1===r.enablePan)return;q(e),r.update(),i.updateDom();break;case o.TOUCH_DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;X(e),r.update();break;case o.TOUCH_DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;J(e),r.update();break;default:a=o.NONE}}function es(e){!1!==r.enabled&&e.preventDefault()}function el(e){P.push(e)}function eh(e){delete v[e.pointerId];for(let t=0;t<P.length;t++)if(P[t].pointerId==e.pointerId){P.splice(t,1);return}}function ec(e){let t=v[e.pointerId];void 0===t&&(t=new $4xklQ.Vector2,v[e.pointerId]=t),t.set(e.pageX,e.pageY)}function ed(e){let t=e.pointerId===P[0].pointerId?P[1]:P[0];return v[t.pointerId]}r.domElement.addEventListener("contextmenu",es),r.domElement.addEventListener("pointerdown",Q),r.domElement.addEventListener("pointercancel",ee),r.domElement.addEventListener("wheel",er,{passive:!1}),this.update()}}class $3c82f100e7ba0388$export$bc845c5c4f62a4a1{constructor(e,t,i,r,o,a,n){this.editor=e,this.newCamera=t,this.scene=i,this.newRenderer=r,this.box=o,this.miniMapWidth=a,this.miniMapHeight=n}main(){let e=document.getElementsByClassName("miniBox")[0];for(var t=e.firstElementChild;t;)t.remove(),t=e.firstElementChild;if(this.newCamera.isOrthographicCamera&&this.newCamera.position.set(0,0,1e3),e.appendChild(this.newRenderer.domElement),this.newCamera.isOrthographicCamera){let e=this.miniMapWidth/this.miniMapHeight,t=-5e3;this.newCamera.left=t*e,this.newCamera.right=-t*e,this.newCamera.top=-t,this.newCamera.bottom=t}else this.newCamera.aspect=this.miniMapWidth/this.miniMapHeight;this.newCamera.updateProjectionMatrix(),this.newRenderer.setSize(this.miniMapWidth,this.miniMapHeight),this.newCamera.updateProjectionMatrix(),""!=this.editor.miniControls2d&&(this.editor.miniControls2d.enabled=!1),""!=this.editor.miniControls3d&&(this.editor.miniControls3d.enabled=!1),this.newCamera.isOrthographicCamera?(this.editor.miniControls2d=new $a69b488eccbcfd7b$export$8ff7788029dfdf52(this.newCamera,e,this.editor),this.editor.miniControls2d.enableRotate=!1):this.editor.miniControls3d=new $a69b488eccbcfd7b$export$8ff7788029dfdf52(this.newCamera,e,this.editor),this.updateMapMan()}updateMapMan(){var e=document.querySelector(".miniMapMan"),t=this.computeDeg();if(e.style.transform="rotateZ(".concat(t,"deg)"),this.editor.miniMapCamera.isOrthographicCamera){let t=this.getScreenPosition();e.style.left=t.x+"px",e.style.top=t.y+"px"}}getScreenPosition(){var e=document.querySelector(".miniMapDom");let t=this.editor.viewportCamera.position.clone(),i=300;"3dRomaCamera"==this.editor.viewportCamera.name&&(t=this.editor.viewportCamera.realPosition.clone(),i=1e3);let r=new $4xklQ.Vector3(t.x*i,t.z*i,t.y*i);r=r.project(this.editor.miniMapCamera);let o=e.offsetWidth/2,a=e.offsetHeight/2;return{x:Math.round(r.x*o+o),y:Math.round(r.y*a+a)}}computeDeg=function(){var e=new $4xklQ.Vector3(0,0,-1),t=new $4xklQ.Vector3(-1,0,0),i=this.editor.camera.getWorldDirection(new $4xklQ.Vector3).normalize();i.setY(0);var r=i.angleTo(e),o=i.angleTo(t),a=$4xklQ.MathUtils.radToDeg(r),n=$4xklQ.MathUtils.radToDeg(o),s=0;return(s=n>=90?a:180+(180-a))+180}}class $523a84362d27c3e8$export$b680ca477a72be07{constructor(e="",t=""){this.stroke=$0f7bfe5028a81ceb$export$18d19c7a3aa33064({thickness:240,cap:"butt"}),this.editor=e,this.object=t}createLineWall(e,t,i=240){if(2==this.editor.innerDraw&&"wall"==this.editor.toolType){let r=t.clone().sub(e.clone()),o=new(0,$4xklQ.Vector2)(-r.y,r.x).setLength(i/2);e=e.clone().add(o),t=t.clone().add(o)}let r=e.clone(),o=t.clone(),a={start:{x:r.x,y:r.y,z:0},end:{x:o.x,y:o.y,z:0},style:2,line:0,isArc:!1,thickness:i,height:window.storeyHei,direction:"",offsetXY:100};return this.makeLineWallByJson(a)}makeLineWallByJson(e){let t=new $4xklQ.Vector2(e.start.x,e.start.y),i=new $4xklQ.Vector2(e.end.x,e.end.y),r=this.editor.wallTool.createBottomFace(t,i,e.line,e.thickness);return r.startPoint=t,r.endPoint=i,r.useType="wall",this.editor.wallTool.recordInfo(r,e),r}wallToJson(e="2D",t=[],i="hole"){let r=(0,$9QhXH.DM).getWallJson(this.editor.allWalls),o=(0,$9QhXH.DM).getHoleJson(this.editor.otherMeshs,this.editor),a=(0,$9QhXH.DM).memberJson(this.editor.otherMember);0!=t.length&&(r=t,this.editor.cleanWallHelper());let n=new $5XTH3.DrawWallTool,s=n.create2DWall(r),l=s.pop(),h=this.editor.floorGroup2d.children;this.editor.floorGroup.children,this.editor.wallGroup.children=[],this.editor.wallGroup3D.children=[],this.editor.floorGroup.children=[],this.editor.memberGroup3D.children=[],this.editor.lineGroup3D.children=[],this.editor.floorGroup2d.children=[],l.length>0&&this.editor.wallGroup.add(...l),this.editor.allWalls=s;let c=this.editor.splitRoomByLine(),d=new $5c31b6cd7f4237f1$export$4880b0ae5643c62b(s,this.editor),p=d.getFloor(c[0],c[1],"3D");if(this.editor.allWalls.forEach(e=>{e.material.color=this.editor.getWallColor(e),e.roomCenter=[]}),p.length>0){let e=this.editor.cacheJson,t=[];e?(e=JSON.parse(e),this.editor.addFloor(d,p,"2D",c,e.roomJson),t=e.roomJson):(this.editor.addFloor(d,p,"2D",c),h.forEach(e=>{let i=Number(e.roomCenter[0]).toFixed(2)+"/"+Number(e.roomCenter[1]).toFixed(2);t.push([i,1,1==e.material.color.r])})),this.editor.floorGroup2d.children.forEach(e=>{let i=e.roomCenter,r=i[0]+"/"+i[1];t.forEach(t=>{r!=t[0]||t[2]||(e.material=new $4xklQ.MeshBasicMaterial({color:15264748,side:$4xklQ.DoubleSide,transparent:e.material.transparent,opacity:e.material.opacity}))})})}else this.editor.removeInputByClassName(this.editor.uiPanelBox.dom,"roomName");if(s.length>0&&"hole"==i){this.editor.wallGroup.add(...s);let e=n.switchTo3D(s);this.editor.wallGroup3D.add(...e),this.editor.createDoorCamera(o),o.length>0&&new(0,$5sV3G.DigHole)(this.editor).work(e,o)}let u=[];this.editor.wallGroup3D.children.forEach(e=>{e.height&&u.push(e.height),this.editor.addBoxForMesh(e,[])});let m=Math.max.apply(null,u);0==u.length&&(m=window.storeyHei),this.editor.wallGroup3D.roomHeight=m;let g=d.getBeamNew(a,this.editor.otherMember);g.forEach(e=>{this.editor.addBoxForMesh(e,[])}),g.length>0&&this.editor.memberGroup3D.add(...g);let f=d.getCeiling();f.length>0&&this.editor.floorGroup.add(...f);let w=new(0,$4xklQ.Matrix4)().makeScale(.001,.001,.001);1==this.editor.wallGroup3D.scale.x&&(this.editor.wallGroup3D.applyMatrix4(w),this.editor.lineGroup3D.applyMatrix4(w),this.editor.memberGroup3D.applyMatrix4(w),this.editor.floorGroup.applyMatrix4(w)),this.editor.list.showHiddenHelper.dispatch("","only",this.editor.config.settingJson),"3D"==e?(this.editor.toolType="free",this.editor.switchHelperGroup("hidden"),this.editor.hiddenDomsByClassName(this.editor.uiPanelBox.dom,"roomName")):(this.editor.addIntersectPointHelper(),this.editor.switchHelperGroup("show"),(0,$9HO6e.UtilCore).updateLineDimensionsLine(this.editor)),this.editor.allGroup3d.forEach(e=>{e.traverse(function(e){e.layers.set(1)})}),this.editor.scene.children.slice(0).forEach(e=>{e.startPoint&&"wall"==e.useType&&this.editor.scene.remove(e)}),this.editor.splitRoomLineGroup.children.slice(0).forEach(e=>{"splitOuterLine"==e.useType&&this.editor.splitRoomLineGroup.remove(e)}),this.editor.miniDom=document.getElementById("scrollviewcontent");let y=document.getElementsByClassName("view_box")[0].clientWidth,b=document.getElementsByClassName("view_box")[0].clientHeight;this.editor.miniMapObj=new $3c82f100e7ba0388$export$bc845c5c4f62a4a1(this.editor,this.editor.miniMapCamera,this.editor.scene,this.editor.newRenderer,this.editor.miniDom,y,b-28),this.editor.miniMapObj.main()}createCurveWall(e,t,i="",r=!1,o=240){this.stroke.thickness=o,""==i&&(i=$523a84362d27c3e8$export$b680ca477a72be07.initControlPoint(e,t)),r&&(i=autoHandlePoint(e,t,i));var a=new $4xklQ.QuadraticBezierCurve3(e,i,t).getPoints(50),n=[];a.forEach(function(e){n.push([e.x,e.y])});var s=this.stroke.build(n);s=$523a84362d27c3e8$export$b680ca477a72be07.process(n,s);var l=[];s.positions.forEach(function(e){l.push(e[0],e[1],0)});var h=[];s.cells.forEach(function(e){h.push(e[0],e[1],e[2])});var c=new $4xklQ.BufferGeometry;c.attributes.position=new $4xklQ.BufferAttribute(new Float32Array(l),3),c.index=new $4xklQ.BufferAttribute(new Uint16Array(h),1);var d=new $4xklQ.MeshBasicMaterial({color:"#4169E1",side:$4xklQ.DoubleSide}),s=new $4xklQ.Mesh(c,d);return s.controlPoint=i,s.startPoint=e,s.endPoint=t,s.useType="wall",s.wallType="rectangleWall",s}createCircleWall(e,t,i,r,o=240){let a={start:{x:1*e.x.toFixed(2),y:1*e.y.toFixed(2),z:0},end:{x:1*t.x.toFixed(2),y:1*t.y.toFixed(2),z:0},style:2,line:0,cp:{x:1*i.x.toFixed(2),y:1*i.y.toFixed(2),z:0},isArc:r,thickness:o,height:window.storeyHei,direction:"",offsetXY:100};var n=this.editor.wallTool.create2DWall([a]);return n.pop(),n[0]}splitWall(e,t){let i=e.startPoint,r=e.endPoint,o=.1>Math.abs(i.x-t.x)&&.1>Math.abs(i.y-t.y),a=.1>Math.abs(r.x-t.x)&&.1>Math.abs(r.y-t.y);if(o||a)return o&&(e.startPoint=t),a&&(e.endPoint=t),0>this.editor.allWalls.indexOf(e)&&this.editor.allWalls.push(e),[e];this.editor.removeWall(e);let n=this.editor.addWall(i,t),s=this.editor.addWall(t,r);return n.wallID=e.wallID,n.style=e.style,s.style=e.style,n.height=e.height,s.height=e.height,n.thickness=e.thickness,s.thickness=e.thickness,n.material.color=this.editor.getWallColor(n),s.material.color=this.editor.getWallColor(s),this.editor.getAllWindowInWall(e).forEach(o=>{(0,$9HO6e.UtilCore).pointIsInLine(o.center,i,t)?o.wallId=e.wallID:(o.wallId="",o.wallPoint=[t,r])}),[n,s]}static makeControlPoint(e){var t=new $4xklQ.BufferGeometry;let i=80;var r=new Float32Array([e.x-i,e.y-i,0,e.x+i,e.y-i,0,e.x+i,e.y+i,0,e.x-i,e.y+i,0]);t.attributes.position=new $4xklQ.BufferAttribute(r,3);var o=new Uint16Array([0,1,2,0,2,3]);t.index=new $4xklQ.BufferAttribute(o,1);var a=new $4xklQ.MeshBasicMaterial({color:"#4169E1",side:$4xklQ.DoubleSide,transparent:!0}),n=new $4xklQ.Mesh(t,a);return n.useType="controlPoint",n}static process(e,t,i=[]){return t.innner=[],t.outter=[],e.forEach(function(e){i.push(new $4xklQ.Vector2(e[0],e[1]))}),t.clock=$b590b02110506a77$export$96bdf6d9c66d7ba8.isClockWise(i),t.positions.forEach(function(e,i){i%2==0?t.clock?t.innner.push(e):t.outter.push(e):t.clock?t.outter.push(e):t.innner.push(e)}),t}static initControlPoint(e,t,i=2e3){let r=(e.x+t.x)/2,o=(e.y+t.y)/2,a=new $4xklQ.Vector3(r,o,0);var n=new(0,$4xklQ.Vector3)().subVectors(t,e),s=new $4xklQ.Vector3(-n.y,n.x,0);return s.setLength(i),new(0,$4xklQ.Vector3)().addVectors(a,s)}}class $523a84362d27c3e8$export$43cb61aa07eebcbc{constructor(e="",t=""){this.editor=e,this.object=t}createRoom(e,t,i=240){let r=new $4xklQ.Vector3(t.x,e.y,0),o=new $4xklQ.Vector3(e.x,t.y,0),a=t.x>e.x?t.x+i/2:t.x-i/2,n=t.y>r.y?t.y+i/2:t.y-i/2,s=o.x<t.x?o.x-i/2:o.x+i/2,l=e.y>o.y?e.y+i/2:e.y-i/2,h=new $4xklQ.Vector3(a,e.y,0),c=new $4xklQ.Vector3(t.x,n,0),d=new $4xklQ.Vector3(s,t.y,0),p=new $4xklQ.Vector3(e.x,l,0),u=new $523a84362d27c3e8$export$b680ca477a72be07(this.editor),m=u.createLineWall(e,h,i),g=u.createLineWall(r,c,i),f=u.createLineWall(t,d,i),w=u.createLineWall(o,p,i);return m.startPoint=e,m.endPoint=r,g.startPoint=r,g.endPoint=t,f.startPoint=t,f.endPoint=o,w.startPoint=o,w.endPoint=e,[m,g,f,w]}createRectangle(e,t,i){let r=new $4xklQ.Vector3((e[0].x+e[1].x)/2,(e[0].y+e[1].y)/2,0),o=new $4xklQ.PlaneGeometry(t,i),a=new $4xklQ.MeshLambertMaterial({color:16776960,side:$4xklQ.DoubleSide}),n=new $4xklQ.Mesh(o,a);return n.position.x=r.x,n.position.y=r.y,n}}var $5XTH3=parcelRequire("5XTH3"),$9HO6e=parcelRequire("9HO6e"),$3BPdS=parcelRequire("3BPdS"),$4xklQ=parcelRequire("4xklQ");class $cda9fa5069073a5c$export$c32c7942a3d4b7c1{constructor(){this.pluginCallbacks=[],this.register(function(e){return new $cda9fa5069073a5c$var$GLTFLightExtension(e)}),this.register(function(e){return new $cda9fa5069073a5c$var$GLTFMaterialsUnlitExtension(e)}),this.register(function(e){return new $cda9fa5069073a5c$var$GLTFMaterialsPBRSpecularGlossiness(e)}),this.register(function(e){return new $cda9fa5069073a5c$var$GLTFMaterialsTransmissionExtension(e)}),this.register(function(e){return new $cda9fa5069073a5c$var$GLTFMaterialsVolumeExtension(e)}),this.register(function(e){return new $cda9fa5069073a5c$var$GLTFMaterialsClearcoatExtension(e)}),this.register(function(e){return new $cda9fa5069073a5c$var$GLTFMaterialsIridescenceExtension(e)})}register(e){return -1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return -1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,r){let o=new $cda9fa5069073a5c$var$GLTFWriter,a=[];for(let e=0,t=this.pluginCallbacks.length;e<t;e++)a.push(this.pluginCallbacks[e](o));o.setPlugins(a),o.write(e,t,r).catch(i)}parseAsync(e,t){let i=this;return new Promise(function(r,o){i.parse(e,r,o,t)})}}const $cda9fa5069073a5c$var$WEBGL_CONSTANTS={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},$cda9fa5069073a5c$var$THREE_TO_WEBGL={};$cda9fa5069073a5c$var$THREE_TO_WEBGL[$4xklQ.NearestFilter]=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.NEAREST,$cda9fa5069073a5c$var$THREE_TO_WEBGL[$4xklQ.NearestMipmapNearestFilter]=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.NEAREST_MIPMAP_NEAREST,$cda9fa5069073a5c$var$THREE_TO_WEBGL[$4xklQ.NearestMipmapLinearFilter]=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.NEAREST_MIPMAP_LINEAR,$cda9fa5069073a5c$var$THREE_TO_WEBGL[$4xklQ.LinearFilter]=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.LINEAR,$cda9fa5069073a5c$var$THREE_TO_WEBGL[$4xklQ.LinearMipmapNearestFilter]=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.LINEAR_MIPMAP_NEAREST,$cda9fa5069073a5c$var$THREE_TO_WEBGL[$4xklQ.LinearMipmapLinearFilter]=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.LINEAR_MIPMAP_LINEAR,$cda9fa5069073a5c$var$THREE_TO_WEBGL[$4xklQ.ClampToEdgeWrapping]=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.CLAMP_TO_EDGE,$cda9fa5069073a5c$var$THREE_TO_WEBGL[$4xklQ.RepeatWrapping]=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.REPEAT,$cda9fa5069073a5c$var$THREE_TO_WEBGL[$4xklQ.MirroredRepeatWrapping]=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.MIRRORED_REPEAT;const $cda9fa5069073a5c$var$PATH_PROPERTIES={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},$cda9fa5069073a5c$var$GLB_HEADER_BYTES=12,$cda9fa5069073a5c$var$GLB_HEADER_MAGIC=1179937895,$cda9fa5069073a5c$var$GLB_VERSION=2,$cda9fa5069073a5c$var$GLB_CHUNK_PREFIX_BYTES=8,$cda9fa5069073a5c$var$GLB_CHUNK_TYPE_JSON=1313821514,$cda9fa5069073a5c$var$GLB_CHUNK_TYPE_BIN=5130562;function $cda9fa5069073a5c$var$equalArray(e,t){return e.length===t.length&&e.every(function(e,i){return e===t[i]})}function $cda9fa5069073a5c$var$stringToArrayBuffer(e){return new TextEncoder().encode(e).buffer}function $cda9fa5069073a5c$var$isIdentityMatrix(e){return $cda9fa5069073a5c$var$equalArray(e.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function $cda9fa5069073a5c$var$getMinMax(e,t,i){let r={min:Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let o=t;o<t+i;o++)for(let t=0;t<e.itemSize;t++){let i;e.itemSize>4?i=e.array[o*e.itemSize+t]:0===t?i=e.getX(o):1===t?i=e.getY(o):2===t?i=e.getZ(o):3===t&&(i=e.getW(o)),r.min[t]=Math.min(r.min[t],i),r.max[t]=Math.max(r.max[t],i)}return r}function $cda9fa5069073a5c$var$getPaddedBufferSize(e){return 4*Math.ceil(e/4)}function $cda9fa5069073a5c$var$getPaddedArrayBuffer(e,t=0){let i=$cda9fa5069073a5c$var$getPaddedBufferSize(e.byteLength);if(i!==e.byteLength){let r=new Uint8Array(i);if(r.set(new Uint8Array(e)),0!==t)for(let o=e.byteLength;o<i;o++)r[o]=t;return r.buffer}return e}function $cda9fa5069073a5c$var$getCanvas(){return"undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function $cda9fa5069073a5c$var$getToBlobPromise(e,t){let i;return void 0!==e.toBlob?new Promise(i=>e.toBlob(i,t)):("image/jpeg"===t?i=.92:"image/webp"===t&&(i=.8),e.convertToBlob({type:t,quality:i}))}class $cda9fa5069073a5c$var$GLTFWriter{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,i){this.options=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);let r=this,o=r.buffers,a=r.json;i=r.options;let n=r.extensionsUsed,s=new Blob(o,{type:"application/octet-stream"}),l=Object.keys(n);if(l.length>0&&(a.extensionsUsed=l),a.buffers&&a.buffers.length>0&&(a.buffers[0].byteLength=s.size),!0===i.binary){let e=new FileReader;e.readAsArrayBuffer(s),e.onloadend=function(){let i=$cda9fa5069073a5c$var$getPaddedArrayBuffer(e.result),r=new DataView(new ArrayBuffer($cda9fa5069073a5c$var$GLB_CHUNK_PREFIX_BYTES));r.setUint32(0,i.byteLength,!0),r.setUint32(4,$cda9fa5069073a5c$var$GLB_CHUNK_TYPE_BIN,!0);let o=$cda9fa5069073a5c$var$getPaddedArrayBuffer($cda9fa5069073a5c$var$stringToArrayBuffer(JSON.stringify(a)),32),n=new DataView(new ArrayBuffer($cda9fa5069073a5c$var$GLB_CHUNK_PREFIX_BYTES));n.setUint32(0,o.byteLength,!0),n.setUint32(4,$cda9fa5069073a5c$var$GLB_CHUNK_TYPE_JSON,!0);let s=new ArrayBuffer($cda9fa5069073a5c$var$GLB_HEADER_BYTES),l=new DataView(s);l.setUint32(0,$cda9fa5069073a5c$var$GLB_HEADER_MAGIC,!0),l.setUint32(4,$cda9fa5069073a5c$var$GLB_VERSION,!0);let h=$cda9fa5069073a5c$var$GLB_HEADER_BYTES+n.byteLength+o.byteLength+r.byteLength+i.byteLength;l.setUint32(8,h,!0);let c=new Blob([s,n,o,r,i],{type:"application/octet-stream"}),d=new FileReader;d.readAsArrayBuffer(c),d.onloadend=function(){t(d.result)}}}else if(a.buffers&&a.buffers.length>0){let e=new FileReader;e.readAsDataURL(s),e.onloadend=function(){let i=e.result;a.buffers[0].uri=i,t(a)}}else t(a)}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;let i=this.options,r=this.extensionsUsed;try{let o=JSON.parse(JSON.stringify(e.userData));if(i.includeCustomExtensions&&o.gltfExtensions){for(let e in void 0===t.extensions&&(t.extensions={}),o.gltfExtensions)t.extensions[e]=o.gltfExtensions[e],r[e]=!0;delete o.gltfExtensions}Object.keys(o).length>0&&(t.extras=o)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}getUID(e,t=!1){if(!1===this.uids.has(e)){let t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}let i=this.uids.get(e);return i.get(t)}isNormalizedNormalAttribute(e){let t=this.cache;if(t.attributesNormalized.has(e))return!1;let i=new $4xklQ.Vector3;for(let t=0,r=e.count;t<r;t++)if(Math.abs(i.fromBufferAttribute(e,t).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){let t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);let i=e.clone(),r=new $4xklQ.Vector3;for(let e=0,t=i.count;e<t;e++)r.fromBufferAttribute(i,e),0===r.x&&0===r.y&&0===r.z?r.setX(1):r.normalize(),i.setXYZ(e,r.x,r.y,r.z);return t.attributesNormalized.set(e,i),i}applyTextureTransform(e,t){let i=!1,r={};(0!==t.offset.x||0!==t.offset.y)&&(r.offset=t.offset.toArray(),i=!0),0!==t.rotation&&(r.rotation=t.rotation,i=!0),(1!==t.repeat.x||1!==t.repeat.y)&&(r.scale=t.repeat.toArray(),i=!0),i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=r,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function i(e){return e.encoding===$4xklQ.sRGBEncoding?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");let r=e?.image,o=t?.image,a=Math.max(r?.width||0,o?.width||0),n=Math.max(r?.height||0,o?.height||0),s=$cda9fa5069073a5c$var$getCanvas();s.width=a,s.height=n;let l=s.getContext("2d");l.fillStyle="#00ffff",l.fillRect(0,0,a,n);let h=l.getImageData(0,0,a,n);if(r){l.drawImage(r,0,0,a,n);let t=i(e),o=l.getImageData(0,0,a,n).data;for(let e=2;e<o.length;e+=4)h.data[e]=256*t(o[e]/256)}if(o){l.drawImage(o,0,0,a,n);let e=i(t),r=l.getImageData(0,0,a,n).data;for(let t=1;t<r.length;t+=4)h.data[t]=256*e(r[t]/256)}l.putImageData(h,0,0);let c=e||t,d=c.clone();return d.source=new $4xklQ.Source(s),d.encoding=$4xklQ.LinearEncoding,d}processBuffer(e){let t=this.json,i=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),i.push(e),0}processBufferView(e,t,i,r,o){let a;let n=this.json;n.bufferViews||(n.bufferViews=[]),a=t===$cda9fa5069073a5c$var$WEBGL_CONSTANTS.UNSIGNED_BYTE?1:t===$cda9fa5069073a5c$var$WEBGL_CONSTANTS.UNSIGNED_SHORT?2:4;let s=$cda9fa5069073a5c$var$getPaddedBufferSize(r*e.itemSize*a),l=new DataView(new ArrayBuffer(s)),h=0;for(let o=i;o<i+r;o++)for(let i=0;i<e.itemSize;i++){let r;e.itemSize>4?r=e.array[o*e.itemSize+i]:0===i?r=e.getX(o):1===i?r=e.getY(o):2===i?r=e.getZ(o):3===i&&(r=e.getW(o)),t===$cda9fa5069073a5c$var$WEBGL_CONSTANTS.FLOAT?l.setFloat32(h,r,!0):t===$cda9fa5069073a5c$var$WEBGL_CONSTANTS.UNSIGNED_INT?l.setUint32(h,r,!0):t===$cda9fa5069073a5c$var$WEBGL_CONSTANTS.UNSIGNED_SHORT?l.setUint16(h,r,!0):t===$cda9fa5069073a5c$var$WEBGL_CONSTANTS.UNSIGNED_BYTE&&l.setUint8(h,r),h+=a}let c={buffer:this.processBuffer(l.buffer),byteOffset:this.byteOffset,byteLength:s};void 0!==o&&(c.target=o),o===$cda9fa5069073a5c$var$WEBGL_CONSTANTS.ARRAY_BUFFER&&(c.byteStride=e.itemSize*a),this.byteOffset+=s,n.bufferViews.push(c);let d={id:n.bufferViews.length-1,byteLength:0};return d}processBufferViewImage(e){let t=this,i=t.json;return i.bufferViews||(i.bufferViews=[]),new Promise(function(r){let o=new FileReader;o.readAsArrayBuffer(e),o.onloadend=function(){let e=$cda9fa5069073a5c$var$getPaddedArrayBuffer(o.result),a={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,r(i.bufferViews.push(a)-1)}})}processAccessor(e,t,i,r){let o,a;let n=this.options,s=this.json,l={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"};if(e.array.constructor===Float32Array)o=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.FLOAT;else if(e.array.constructor===Uint32Array)o=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.UNSIGNED_INT;else if(e.array.constructor===Uint16Array)o=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.UNSIGNED_SHORT;else if(e.array.constructor===Uint8Array)o=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.UNSIGNED_BYTE;else throw Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");if(void 0===i&&(i=0),void 0===r&&(r=e.count),n.truncateDrawRange&&void 0!==t&&null===t.index){let o=i+r,a=t.drawRange.count===1/0?e.count:t.drawRange.start+t.drawRange.count;(r=Math.min(o,a)-(i=Math.max(i,t.drawRange.start)))<0&&(r=0)}if(0===r)return null;let h=$cda9fa5069073a5c$var$getMinMax(e,i,r);void 0!==t&&(a=e===t.index?$cda9fa5069073a5c$var$WEBGL_CONSTANTS.ELEMENT_ARRAY_BUFFER:$cda9fa5069073a5c$var$WEBGL_CONSTANTS.ARRAY_BUFFER);let c=this.processBufferView(e,o,i,r,a),d={bufferView:c.id,byteOffset:c.byteOffset,componentType:o,count:r,max:h.max,min:h.min,type:l[e.itemSize]};return!0===e.normalized&&(d.normalized=!0),s.accessors||(s.accessors=[]),s.accessors.push(d)-1}processImage(e,t,i,r="image/png"){let o=this,a=o.cache,n=o.json,s=o.options,l=o.pending;a.images.has(e)||a.images.set(e,{});let h=a.images.get(e),c=r+":flipY/"+i.toString();if(void 0!==h[c])return h[c];n.images||(n.images=[]);let d={mimeType:r},p=$cda9fa5069073a5c$var$getCanvas();p.width=Math.min(e.width,s.maxTextureSize),p.height=Math.min(e.height,s.maxTextureSize);let u=p.getContext("2d");if(!0===i&&(u.translate(0,p.height),u.scale(1,-1)),void 0!==e.data){t!==$4xklQ.RGBAFormat&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>s.maxTextureSize||e.height>s.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);let i=new Uint8ClampedArray(e.height*e.width*4);for(let t=0;t<i.length;t+=4)i[t+0]=e.data[t+0],i[t+1]=e.data[t+1],i[t+2]=e.data[t+2],i[t+3]=e.data[t+3];u.putImageData(new ImageData(i,e.width,e.height),0,0)}else u.drawImage(e,0,0,p.width,p.height);!0===s.binary?l.push($cda9fa5069073a5c$var$getToBlobPromise(p,r).then(e=>o.processBufferViewImage(e)).then(e=>{d.bufferView=e})):void 0!==p.toDataURL?d.uri=p.toDataURL(r):l.push($cda9fa5069073a5c$var$getToBlobPromise(p,r).then(e=>new FileReader().readAsDataURL(e)).then(e=>{d.uri=e}));let m=n.images.push(d)-1;return h[c]=m,m}processSampler(e){let t=this.json;t.samplers||(t.samplers=[]);let i={magFilter:$cda9fa5069073a5c$var$THREE_TO_WEBGL[e.magFilter],minFilter:$cda9fa5069073a5c$var$THREE_TO_WEBGL[e.minFilter],wrapS:$cda9fa5069073a5c$var$THREE_TO_WEBGL[e.wrapS],wrapT:$cda9fa5069073a5c$var$THREE_TO_WEBGL[e.wrapT]};return t.samplers.push(i)-1}processTexture(e){let t=this.cache,i=this.json;if(t.textures.has(e))return t.textures.get(e);i.textures||(i.textures=[]);let r=e.userData.mimeType;"image/webp"===r&&(r="image/png");let o={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,r)};e.name&&(o.name=e.name),this._invokeAll(function(t){t.writeTexture&&t.writeTexture(e,o)});let a=i.textures.push(o)-1;return t.textures.set(e,a),a}processMaterial(e){let t=this.cache,i=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;i.materials||(i.materials=[]);let r={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");let o=e.color.toArray().concat([e.opacity]);if($cda9fa5069073a5c$var$equalArray(o,[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=o),e.isMeshStandardMaterial?(r.pbrMetallicRoughness.metallicFactor=e.metalness,r.pbrMetallicRoughness.roughnessFactor=e.roughness):(r.pbrMetallicRoughness.metallicFactor=.5,r.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){let t=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),i={index:this.processTexture(t)};this.applyTextureTransform(i,t),r.pbrMetallicRoughness.metallicRoughnessTexture=i}if(e.map){let t={index:this.processTexture(e.map)};this.applyTextureTransform(t,e.map),r.pbrMetallicRoughness.baseColorTexture=t}if(e.emissive){let t=e.emissive.clone().multiplyScalar(e.emissiveIntensity),i=Math.max(t.r,t.g,t.b);if(i>1&&(t.multiplyScalar(1/i),console.warn("THREE.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),i>0&&(r.emissiveFactor=t.toArray()),e.emissiveMap){let t={index:this.processTexture(e.emissiveMap)};this.applyTextureTransform(t,e.emissiveMap),r.emissiveTexture=t}}if(e.normalMap){let t={index:this.processTexture(e.normalMap)};e.normalScale&&1!==e.normalScale.x&&(t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),r.normalTexture=t}if(e.aoMap){let t={index:this.processTexture(e.aoMap),texCoord:1};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),r.occlusionTexture=t}e.transparent?r.alphaMode="BLEND":e.alphaTest>0&&(r.alphaMode="MASK",r.alphaCutoff=e.alphaTest),e.side===$4xklQ.DoubleSide&&(r.doubleSided=!0),""!==e.name&&(r.name=e.name),this.serializeUserData(e,r),this._invokeAll(function(t){t.writeMaterial&&t.writeMaterial(e,r)});let a=i.materials.push(r)-1;return t.materials.set(e,a),a}processMesh(e){let t;let i=this.cache,r=this.json,o=[e.geometry.uuid];if(Array.isArray(e.material))for(let t=0,i=e.material.length;t<i;t++)o.push(e.material[t].uuid);else o.push(e.material.uuid);let a=o.join(":");if(i.meshes.has(a))return i.meshes.get(a);let n=e.geometry;t=e.isLineSegments?$cda9fa5069073a5c$var$WEBGL_CONSTANTS.LINES:e.isLineLoop?$cda9fa5069073a5c$var$WEBGL_CONSTANTS.LINE_LOOP:e.isLine?$cda9fa5069073a5c$var$WEBGL_CONSTANTS.LINE_STRIP:e.isPoints?$cda9fa5069073a5c$var$WEBGL_CONSTANTS.POINTS:e.material.wireframe?$cda9fa5069073a5c$var$WEBGL_CONSTANTS.LINES:$cda9fa5069073a5c$var$WEBGL_CONSTANTS.TRIANGLES;let s={},l={},h=[],c=[],d={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},p=n.getAttribute("normal");void 0===p||this.isNormalizedNormalAttribute(p)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),n.setAttribute("normal",this.createNormalizedNormalAttribute(p)));let u=null;for(let e in n.attributes){if("morph"===e.slice(0,5))continue;let t=n.attributes[e];e=d[e]||e.toUpperCase();let r=/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/;if(r.test(e)||(e="_"+e),i.attributes.has(this.getUID(t))){l[e]=i.attributes.get(this.getUID(t));continue}u=null;let o=t.array;"JOINTS_0"!==e||o instanceof Uint16Array||o instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),u=new $4xklQ.BufferAttribute(new Uint16Array(o),t.itemSize,t.normalized));let a=this.processAccessor(u||t,n);null!==a&&(l[e]=a,i.attributes.set(this.getUID(t),a))}if(void 0!==p&&n.setAttribute("normal",p),0===Object.keys(l).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){let t=[],r=[],o={};if(void 0!==e.morphTargetDictionary)for(let t in e.morphTargetDictionary)o[e.morphTargetDictionary[t]]=t;for(let a=0;a<e.morphTargetInfluences.length;++a){let s={},l=!1;for(let e in n.morphAttributes){if("position"!==e&&"normal"!==e){l||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),l=!0);continue}let t=n.morphAttributes[e][a],r=e.toUpperCase(),o=n.attributes[e];if(i.attributes.has(this.getUID(t,!0))){s[r]=i.attributes.get(this.getUID(t,!0));continue}let h=t.clone();if(!n.morphTargetsRelative)for(let e=0,i=t.count;e<i;e++)h.setXYZ(e,t.getX(e)-o.getX(e),t.getY(e)-o.getY(e),t.getZ(e)-o.getZ(e));s[r]=this.processAccessor(h,n),i.attributes.set(this.getUID(o,!0),s[r])}c.push(s),t.push(e.morphTargetInfluences[a]),void 0!==e.morphTargetDictionary&&r.push(o[a])}s.weights=t,r.length>0&&(s.extras={},s.extras.targetNames=r)}let m=Array.isArray(e.material);if(m&&0===n.groups.length)return null;let g=m?e.material:[e.material],f=m?n.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let e=0,r=f.length;e<r;e++){let r={mode:t,attributes:l};if(this.serializeUserData(n,r),c.length>0&&(r.targets=c),null!==n.index){let t=this.getUID(n.index);(void 0!==f[e].start||void 0!==f[e].count)&&(t+=":"+f[e].start+":"+f[e].count),i.attributes.has(t)?r.indices=i.attributes.get(t):(r.indices=this.processAccessor(n.index,n,f[e].start,f[e].count),i.attributes.set(t,r.indices)),null===r.indices&&delete r.indices}let o=this.processMaterial(g[f[e].materialIndex]);null!==o&&(r.material=o),h.push(r)}s.primitives=h,r.meshes||(r.meshes=[]),this._invokeAll(function(t){t.writeMesh&&t.writeMesh(e,s)});let w=r.meshes.push(s)-1;return i.meshes.set(a,w),w}processCamera(e){let t=this.json;t.cameras||(t.cameras=[]);let i=e.isOrthographicCamera,r={type:i?"orthographic":"perspective"};return i?r.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:(0,$4xklQ.MathUtils).degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(r.name=e.type),t.cameras.push(r)-1}processAnimation(e,t){let i=this.json,r=this.nodeMap;i.animations||(i.animations=[]),e=$cda9fa5069073a5c$export$c32c7942a3d4b7c1.Utils.mergeMorphTargetTracks(e.clone(),t);let o=e.tracks,a=[],n=[];for(let e=0;e<o.length;++e){let i;let s=o[e],l=(0,$4xklQ.PropertyBinding).parseTrackName(s.name),h=(0,$4xklQ.PropertyBinding).findNode(t,l.nodeName),c=$cda9fa5069073a5c$var$PATH_PROPERTIES[l.propertyName];if("bones"===l.objectName&&(h=!0===h.isSkinnedMesh?h.skeleton.getBoneByName(l.objectIndex):void 0),!h||!c)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',s.name),null;let d=1,p=s.values.length/s.times.length;c===$cda9fa5069073a5c$var$PATH_PROPERTIES.morphTargetInfluences&&(p/=h.morphTargetInfluences.length),!0===s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(i="CUBICSPLINE",p/=3):i=s.getInterpolation()===$4xklQ.InterpolateDiscrete?"STEP":"LINEAR",n.push({input:this.processAccessor(new $4xklQ.BufferAttribute(s.times,d)),output:this.processAccessor(new $4xklQ.BufferAttribute(s.values,p)),interpolation:i}),a.push({sampler:n.length-1,target:{node:r.get(h),path:c}})}return i.animations.push({name:e.name||"clip_"+i.animations.length,samplers:n,channels:a}),i.animations.length-1}processSkin(e){let t=this.json,i=this.nodeMap,r=t.nodes[i.get(e)],o=e.skeleton;if(void 0===o)return null;let a=e.skeleton.bones[0];if(void 0===a)return null;let n=[],s=new Float32Array(16*o.bones.length),l=new $4xklQ.Matrix4;for(let t=0;t<o.bones.length;++t)n.push(i.get(o.bones[t])),l.copy(o.boneInverses[t]),l.multiply(e.bindMatrix).toArray(s,16*t);void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new $4xklQ.BufferAttribute(s,16)),joints:n,skeleton:i.get(a)});let h=r.skin=t.skins.length-1;return h}processNode(e){let t=this.json,i=this.options,r=this.nodeMap;t.nodes||(t.nodes=[]);let o={};if(i.trs){let t=e.quaternion.toArray(),i=e.position.toArray(),r=e.scale.toArray();$cda9fa5069073a5c$var$equalArray(t,[0,0,0,1])||(o.rotation=t),$cda9fa5069073a5c$var$equalArray(i,[0,0,0])||(o.translation=i),$cda9fa5069073a5c$var$equalArray(r,[1,1,1])||(o.scale=r)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===$cda9fa5069073a5c$var$isIdentityMatrix(e.matrix)&&(o.matrix=e.matrix.elements);if(""!==e.name&&(o.name=String(e.name)),this.serializeUserData(e,o),e.isMesh||e.isLine||e.isPoints){let t=this.processMesh(e);null!==t&&(o.mesh=t)}else e.isCamera&&(o.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){let t=[];for(let r=0,o=e.children.length;r<o;r++){let o=e.children[r];if(o.visible||!1===i.onlyVisible){let e=this.processNode(o);null!==e&&t.push(e)}}t.length>0&&(o.children=t)}this._invokeAll(function(t){t.writeNode&&t.writeNode(e,o)});let a=t.nodes.push(o)-1;return r.set(e,a),a}processScene(e){let t=this.json,i=this.options;t.scenes||(t.scenes=[],t.scene=0);let r={};""!==e.name&&(r.name=e.name),t.scenes.push(r);let o=[];for(let t=0,r=e.children.length;t<r;t++){let r=e.children[t];if(r.visible||!1===i.onlyVisible){let e=this.processNode(r);null!==e&&o.push(e)}}o.length>0&&(r.nodes=o),this.serializeUserData(e,r)}processObjects(e){let t=new $4xklQ.Scene;t.name="AuxScene";for(let i=0;i<e.length;i++)t.children.push(e[i]);this.processScene(t)}processInput(e){let t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(t){t.beforeParse&&t.beforeParse(e)});let i=[];for(let t=0;t<e.length;t++)e[t]instanceof $4xklQ.Scene?this.processScene(e[t]):i.push(e[t]);i.length>0&&this.processObjects(i);for(let e=0;e<this.skins.length;++e)this.processSkin(this.skins[e]);for(let i=0;i<t.animations.length;++i)this.processAnimation(t.animations[i],e[0]);this._invokeAll(function(t){t.afterParse&&t.afterParse(e)})}_invokeAll(e){for(let t=0,i=this.plugins.length;t<i;t++)e(this.plugins[t])}}class $cda9fa5069073a5c$var$GLTFLightExtension{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}let i=this.writer,r=i.json,o=i.extensionsUsed,a={};e.name&&(a.name=e.name),a.color=e.color.toArray(),a.intensity=e.intensity,e.isDirectionalLight?a.type="directional":e.isPointLight?(a.type="point",e.distance>0&&(a.range=e.distance)):e.isSpotLight&&(a.type="spot",e.distance>0&&(a.range=e.distance),a.spot={},a.spot.innerConeAngle=-((e.penumbra-1)*e.angle*1),a.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||0!==e.target.position.x||0!==e.target.position.y||-1!==e.target.position.z)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),o[this.name]||(r.extensions=r.extensions||{},r.extensions[this.name]={lights:[]},o[this.name]=!0);let n=r.extensions[this.name].lights;n.push(a),t.extensions=t.extensions||{},t.extensions[this.name]={light:n.length-1}}}class $cda9fa5069073a5c$var$GLTFMaterialsUnlitExtension{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;let i=this.writer,r=i.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},r[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class $cda9fa5069073a5c$var$GLTFMaterialsPBRSpecularGlossiness{constructor(e){this.writer=e,this.name="KHR_materials_pbrSpecularGlossiness"}writeMaterial(e,t){if(!e.isGLTFSpecularGlossinessMaterial)return;let i=this.writer,r=i.extensionsUsed,o={};t.pbrMetallicRoughness.baseColorFactor&&(o.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor);let a=[1,1,1];if(e.specular.toArray(a,0),o.specularFactor=a,o.glossinessFactor=e.glossiness,t.pbrMetallicRoughness.baseColorTexture&&(o.diffuseTexture=t.pbrMetallicRoughness.baseColorTexture),e.specularMap){let t={index:i.processTexture(e.specularMap)};i.applyTextureTransform(t,e.specularMap),o.specularGlossinessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class $cda9fa5069073a5c$var$GLTFMaterialsClearcoatExtension{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;let i=this.writer,r=i.extensionsUsed,o={};if(o.clearcoatFactor=e.clearcoat,e.clearcoatMap){let t={index:i.processTexture(e.clearcoatMap)};i.applyTextureTransform(t,e.clearcoatMap),o.clearcoatTexture=t}if(o.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){let t={index:i.processTexture(e.clearcoatRoughnessMap)};i.applyTextureTransform(t,e.clearcoatRoughnessMap),o.clearcoatRoughnessTexture=t}if(e.clearcoatNormalMap){let t={index:i.processTexture(e.clearcoatNormalMap)};i.applyTextureTransform(t,e.clearcoatNormalMap),o.clearcoatNormalTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class $cda9fa5069073a5c$var$GLTFMaterialsIridescenceExtension{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;let i=this.writer,r=i.extensionsUsed,o={};if(o.iridescenceFactor=e.iridescence,e.iridescenceMap){let t={index:i.processTexture(e.iridescenceMap)};i.applyTextureTransform(t,e.iridescenceMap),o.iridescenceTexture=t}if(o.iridescenceIor=e.iridescenceIOR,o.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],o.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){let t={index:i.processTexture(e.iridescenceThicknessMap)};i.applyTextureTransform(t,e.iridescenceThicknessMap),o.iridescenceThicknessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class $cda9fa5069073a5c$var$GLTFMaterialsTransmissionExtension{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;let i=this.writer,r=i.extensionsUsed,o={};if(o.transmissionFactor=e.transmission,e.transmissionMap){let t={index:i.processTexture(e.transmissionMap)};i.applyTextureTransform(t,e.transmissionMap),o.transmissionTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class $cda9fa5069073a5c$var$GLTFMaterialsVolumeExtension{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;let i=this.writer,r=i.extensionsUsed,o={};if(o.thicknessFactor=e.thickness,e.thicknessMap){let t={index:i.processTexture(e.thicknessMap)};i.applyTextureTransform(t,e.thicknessMap),o.thicknessTexture=t}o.attenuationDistance=e.attenuationDistance,o.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}$cda9fa5069073a5c$export$c32c7942a3d4b7c1.Utils={insertKeyframe:function(e,t){let i;let r=.001,o=e.getValueSize(),a=new e.TimeBufferType(e.times.length+1),n=new e.ValueBufferType(e.values.length+o),s=e.createInterpolant(new e.ValueBufferType(o));if(0===e.times.length){a[0]=t;for(let e=0;e<o;e++)n[e]=0;i=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<r)return 0;a[0]=t,a.set(e.times,1),n.set(s.evaluate(t),0),n.set(e.values,o),i=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<r)return e.times.length-1;a[a.length-1]=t,a.set(e.times,0),n.set(e.values,0),n.set(s.evaluate(t),e.values.length),i=a.length-1}else for(let l=0;l<e.times.length;l++){if(Math.abs(e.times[l]-t)<r)return l;if(e.times[l]<t&&e.times[l+1]>t){a.set(e.times.slice(0,l+1),0),a[l+1]=t,a.set(e.times.slice(l+1),l+2),n.set(e.values.slice(0,(l+1)*o),0),n.set(s.evaluate(t),(l+1)*o),n.set(e.values.slice((l+1)*o),(l+2)*o),i=l+1;break}}return e.times=a,e.values=n,i},mergeMorphTargetTracks:function(e,t){let i=[],r={},o=e.tracks;for(let e=0;e<o.length;++e){let a,n=o[e],s=(0,$4xklQ.PropertyBinding).parseTrackName(n.name),l=(0,$4xklQ.PropertyBinding).findNode(t,s.nodeName);if("morphTargetInfluences"!==s.propertyName||void 0===s.propertyIndex){i.push(n);continue}if(n.createInterpolant!==n.InterpolantFactoryMethodDiscrete&&n.createInterpolant!==n.InterpolantFactoryMethodLinear){if(n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),(n=n.clone()).setInterpolation($4xklQ.InterpolateLinear)}let h=l.morphTargetInfluences.length,c=l.morphTargetDictionary[s.propertyIndex];if(void 0===c)throw Error("THREE.GLTFExporter: Morph target name not found: "+s.propertyIndex);if(void 0===r[l.uuid]){a=n.clone();let e=new a.ValueBufferType(h*a.times.length);for(let t=0;t<a.times.length;t++)e[t*h+c]=a.values[t];a.name=(s.nodeName||"")+".morphTargetInfluences",a.values=e,r[l.uuid]=a,i.push(a);continue}let d=n.createInterpolant(new n.ValueBufferType(1));a=r[l.uuid];for(let e=0;e<a.times.length;e++)a.values[e*h+c]=d.evaluate(a.times[e]);for(let e=0;e<n.times.length;e++){let t=this.insertKeyframe(a,n.times[e]);a.values[t*h+c]=n.values[e]}}return e.tracks=i,e}};var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ");class $95d6a1447ab71b35$export$c682e94218fd2425{constructor(){this.id=0,this.object=null,this.z=0,this.renderOrder=0}}class $95d6a1447ab71b35$export$1cd1d524e22c1604{constructor(){this.id=0,this.v1=new $95d6a1447ab71b35$export$b1d83c23148ffa1b,this.v2=new $95d6a1447ab71b35$export$b1d83c23148ffa1b,this.v3=new $95d6a1447ab71b35$export$b1d83c23148ffa1b,this.normalModel=new $4xklQ.Vector3,this.vertexNormalsModel=[new $4xklQ.Vector3,new $4xklQ.Vector3,new $4xklQ.Vector3],this.vertexNormalsLength=0,this.color=new $4xklQ.Color,this.material=null,this.uvs=[new $4xklQ.Vector2,new $4xklQ.Vector2,new $4xklQ.Vector2],this.z=0,this.renderOrder=0}}class $95d6a1447ab71b35$export$b1d83c23148ffa1b{constructor(){this.position=new $4xklQ.Vector3,this.positionWorld=new $4xklQ.Vector3,this.positionScreen=new $4xklQ.Vector4,this.visible=!0}copy(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)}}class $95d6a1447ab71b35$export$a3be0aa4e4a40577{constructor(){this.id=0,this.v1=new $95d6a1447ab71b35$export$b1d83c23148ffa1b,this.v2=new $95d6a1447ab71b35$export$b1d83c23148ffa1b,this.vertexColors=[new $4xklQ.Color,new $4xklQ.Color],this.material=null,this.z=0,this.renderOrder=0}}class $95d6a1447ab71b35$export$2a395e50c8655b14{constructor(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new $4xklQ.Vector2,this.material=null,this.renderOrder=0}}class $95d6a1447ab71b35$export$c1e1cb5f4fbcd06d{constructor(){let e,t,i=0,r,o,a=0,n,s,l=0,h,c,d=0,p,u,m=0,g,f={objects:[],lights:[],elements:[]},w=new $4xklQ.Vector3,y=new $4xklQ.Vector4,b=new $4xklQ.Box3(new $4xklQ.Vector3(-1,-1,-1),new $4xklQ.Vector3(1,1,1)),x=new $4xklQ.Box3,P=[,,,],v=new $4xklQ.Matrix4,M=new $4xklQ.Matrix4,C=new $4xklQ.Matrix4,D=new $4xklQ.Frustum,T=[],S=[],k=[],V=[],A=[];function L(){let e=[],t=[],i=[],o=null,a=new $4xklQ.Matrix3;function s(e){let t=e.position,i=e.positionWorld,r=e.positionScreen;i.copy(t).applyMatrix4(g),r.copy(i).applyMatrix4(M);let o=1/r.w;r.x*=o,r.y*=o,r.z*=o,e.visible=r.x>=-1&&r.x<=1&&r.y>=-1&&r.y<=1&&r.z>=-1&&r.z<=1}function l(e,t,i){(r=O()).position.set(e,t,i),s(r)}function c(e,t,i){return!0===e.visible||!0===t.visible||!0===i.visible||(P[0]=e.positionScreen,P[1]=t.positionScreen,P[2]=i.positionScreen,b.intersectsBox(x.setFromPoints(P)))}function d(e,t,i){return(i.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(i.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0}function p(r,s,l,h){let p=S[r],u=S[s],m=S[l];if(!1!==c(p,u,m)&&(h.side===$4xklQ.DoubleSide||!0===d(p,u,m))){(n=F()).id=o.id,n.v1.copy(p),n.v2.copy(u),n.v3.copy(m),n.z=(p.positionScreen.z+u.positionScreen.z+m.positionScreen.z)/3,n.renderOrder=o.renderOrder,w.subVectors(m.position,u.position),y.subVectors(p.position,u.position),w.cross(y),n.normalModel.copy(w),n.normalModel.applyMatrix3(a).normalize();for(let t=0;t<3;t++){let r=n.vertexNormalsModel[t];r.fromArray(e,3*arguments[t]),r.applyMatrix3(a).normalize();let o=n.uvs[t];o.fromArray(i,2*arguments[t])}n.vertexNormalsLength=3,n.material=h,h.vertexColors&&n.color.fromArray(t,3*r),f.elements.push(n)}}return{setObject:function(r){o=r,a.getNormalMatrix(o.matrixWorld),e.length=0,t.length=0,i.length=0},projectVertex:s,checkTriangleVisibility:c,checkBackfaceCulling:d,pushVertex:l,pushNormal:function(t,i,r){e.push(t,i,r)},pushColor:function(e,i,r){t.push(e,i,r)},pushUv:function(e,t){i.push(e,t)},pushLine:function(e,i){let r=S[e],a=S[i];r.positionScreen.copy(r.position).applyMatrix4(C),a.positionScreen.copy(a.position).applyMatrix4(C),!0===j(r.positionScreen,a.positionScreen)&&(r.positionScreen.multiplyScalar(1/r.positionScreen.w),a.positionScreen.multiplyScalar(1/a.positionScreen.w),(h=z()).id=o.id,h.v1.copy(r),h.v2.copy(a),h.z=Math.max(r.positionScreen.z,a.positionScreen.z),h.renderOrder=o.renderOrder,h.material=o.material,o.material.vertexColors&&(h.vertexColors[0].fromArray(t,3*e),h.vertexColors[1].fromArray(t,3*i)),f.elements.push(h))},pushTriangle:p}}let W=new L;function I(e){if(!1===e.visible)return;if(e.isLight)f.lights.push(e);else if(e.isMesh||e.isLine||e.isPoints){if(!1===e.material.visible||!0===e.frustumCulled&&!1===D.intersectsObject(e))return;R(e)}else if(e.isSprite){if(!1===e.material.visible||!0===e.frustumCulled&&!1===D.intersectsSprite(e))return;R(e)}let t=e.children;for(let e=0,i=t.length;e<i;e++)I(t[e])}function R(t){(e=E()).id=t.id,e.object=t,w.setFromMatrixPosition(t.matrixWorld),w.applyMatrix4(M),e.z=w.z,e.renderOrder=t.renderOrder,f.objects.push(e)}function B(e,t,i){let r=1/e.w;e.z*=r,e.z>=-1&&e.z<=1&&((p=G()).id=t.id,p.x=e.x*r,p.y=e.y*r,p.z=e.z,p.renderOrder=t.renderOrder,p.object=t,p.rotation=t.rotation,p.scale.x=t.scale.x*Math.abs(p.x-(e.x+i.projectionMatrix.elements[0])/(e.w+i.projectionMatrix.elements[12])),p.scale.y=t.scale.y*Math.abs(p.y-(e.y+i.projectionMatrix.elements[5])/(e.w+i.projectionMatrix.elements[13])),p.material=t.material,f.elements.push(p))}function E(){if(t===i){let e=new $95d6a1447ab71b35$export$c682e94218fd2425;return T.push(e),i++,t++,e}return T[t++]}function O(){if(o===a){let e=new $95d6a1447ab71b35$export$b1d83c23148ffa1b;return S.push(e),a++,o++,e}return S[o++]}function F(){if(s===l){let e=new $95d6a1447ab71b35$export$1cd1d524e22c1604;return k.push(e),l++,s++,e}return k[s++]}function z(){if(c===d){let e=new $95d6a1447ab71b35$export$a3be0aa4e4a40577;return V.push(e),d++,c++,e}return V[c++]}function G(){if(u===m){let e=new $95d6a1447ab71b35$export$2a395e50c8655b14;return A.push(e),m++,u++,e}return A[u++]}function H(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function j(e,t){let i=0,r=1,o=e.z+e.w,a=t.z+t.w,n=-e.z+e.w,s=-t.z+t.w;return o>=0&&a>=0&&n>=0&&s>=0||(!(o<0)||!(a<0))&&(!(n<0)||!(s<0))&&(o<0?i=Math.max(i,o/(o-a)):a<0&&(r=Math.min(r,o/(o-a))),n<0?i=Math.max(i,n/(n-s)):s<0&&(r=Math.min(r,n/(n-s))),!(r<i)&&(e.lerp(t,i),t.lerp(e,1-r),!0))}this.projectScene=function(e,i,r,a){s=0,c=0,u=0,f.elements.length=0,!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===i.parent&&!0===i.matrixWorldAutoUpdate&&i.updateMatrixWorld(),v.copy(i.matrixWorldInverse),M.multiplyMatrices(i.projectionMatrix,v),D.setFromProjectionMatrix(M),t=0,f.objects.length=0,f.lights.length=0,I(e),!0===r&&f.objects.sort(H);let n=f.objects;for(let e=0,t=n.length;e<t;e++){let t=n[e].object,r=t.geometry;if(W.setObject(t),g=t.matrixWorld,o=0,t.isMesh){let e=t.material,i=Array.isArray(e),o=r.attributes,a=r.groups;if(void 0===o.position)continue;let n=o.position.array;for(let e=0,i=n.length;e<i;e+=3){let i=n[e],o=n[e+1],a=n[e+2],s=r.morphAttributes.position;if(void 0!==s){let l=r.morphTargetsRelative,h=t.morphTargetInfluences;for(let t=0,r=s.length;t<r;t++){let r=h[t];if(0===r)continue;let c=s[t];l?(i+=c.getX(e/3)*r,o+=c.getY(e/3)*r,a+=c.getZ(e/3)*r):(i+=(c.getX(e/3)-n[e])*r,o+=(c.getY(e/3)-n[e+1])*r,a+=(c.getZ(e/3)-n[e+2])*r)}}W.pushVertex(i,o,a)}if(void 0!==o.normal){let e=o.normal.array;for(let t=0,i=e.length;t<i;t+=3)W.pushNormal(e[t],e[t+1],e[t+2])}if(void 0!==o.color){let e=o.color.array;for(let t=0,i=e.length;t<i;t+=3)W.pushColor(e[t],e[t+1],e[t+2])}if(void 0!==o.uv){let e=o.uv.array;for(let t=0,i=e.length;t<i;t+=2)W.pushUv(e[t],e[t+1])}if(null!==r.index){let o=r.index.array;if(a.length>0)for(let r=0;r<a.length;r++){let n=a[r];if(void 0!==(e=!0===i?t.material[n.materialIndex]:t.material))for(let t=n.start,i=n.start+n.count;t<i;t+=3)W.pushTriangle(o[t],o[t+1],o[t+2],e)}else for(let t=0,i=o.length;t<i;t+=3)W.pushTriangle(o[t],o[t+1],o[t+2],e)}else if(a.length>0)for(let r=0;r<a.length;r++){let o=a[r];if(void 0!==(e=!0===i?t.material[o.materialIndex]:t.material))for(let t=o.start,i=o.start+o.count;t<i;t+=3)W.pushTriangle(t,t+1,t+2,e)}else for(let t=0,i=n.length/3;t<i;t+=3)W.pushTriangle(t,t+1,t+2,e)}else if(t.isLine){C.multiplyMatrices(M,g);let e=r.attributes;if(void 0!==e.position){let i=e.position.array;for(let e=0,t=i.length;e<t;e+=3)W.pushVertex(i[e],i[e+1],i[e+2]);if(void 0!==e.color){let t=e.color.array;for(let e=0,i=t.length;e<i;e+=3)W.pushColor(t[e],t[e+1],t[e+2])}if(null!==r.index){let e=r.index.array;for(let t=0,i=e.length;t<i;t+=2)W.pushLine(e[t],e[t+1])}else{let e=t.isLineSegments?2:1;for(let t=0,r=i.length/3-1;t<r;t+=e)W.pushLine(t,t+1)}}}else if(t.isPoints){C.multiplyMatrices(M,g);let e=r.attributes;if(void 0!==e.position){let r=e.position.array;for(let e=0,o=r.length;e<o;e+=3)y.set(r[e],r[e+1],r[e+2],1),y.applyMatrix4(C),B(y,t,i)}}else t.isSprite&&(t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),y.set(g.elements[12],g.elements[13],g.elements[14],1),y.applyMatrix4(M),B(y,t,i))}return!0===a&&f.elements.sort(H),f}}}class $9aaa1afb37141370$export$42e42f98ac770ce0{constructor(){let e,t,i,r,o,a,n,s,l,h,c,d=0,p=null,u=1,m,g,f=this,w=new $4xklQ.Box2,y=new $4xklQ.Box2,b=new $4xklQ.Color,x=new $4xklQ.Color,P=new $4xklQ.Color,v=new $4xklQ.Color,M=new $4xklQ.Color,C=new $4xklQ.Color,D=new $4xklQ.Vector3,T=new $4xklQ.Vector3,S=new $4xklQ.Vector3,k=new $4xklQ.Matrix3,V=new $4xklQ.Matrix4,A=new $4xklQ.Matrix4,L=[],W=new $95d6a1447ab71b35$export$c1e1cb5f4fbcd06d,I=document.createElementNS("http://www.w3.org/2000/svg","svg");function R(){for(d=0;I.childNodes.length>0;)I.removeChild(I.childNodes[0])}function B(e){return null!==p?e.toFixed(p):e}function E(e){P.setRGB(0,0,0),v.setRGB(0,0,0),M.setRGB(0,0,0);for(let t=0,i=e.length;t<i;t++){let i=e[t],r=i.color;i.isAmbientLight?(P.r+=r.r,P.g+=r.g,P.b+=r.b):i.isDirectionalLight?(v.r+=r.r,v.g+=r.g,v.b+=r.b):i.isPointLight&&(M.r+=r.r,M.g+=r.g,M.b+=r.b)}}function O(e,t,i,r){for(let o=0,a=e.length;o<a;o++){let a=e[o],n=a.color;if(a.isDirectionalLight){let e=D.setFromMatrixPosition(a.matrixWorld).normalize(),t=i.dot(e);if(t<=0)continue;t*=a.intensity,r.r+=n.r*t,r.g+=n.g*t,r.b+=n.b*t}else if(a.isPointLight){let e=D.setFromMatrixPosition(a.matrixWorld),o=i.dot(D.subVectors(e,t).normalize());if(o<=0||0==(o*=0==a.distance?1:1-Math.min(t.distanceTo(e)/a.distance,1)))continue;o*=a.intensity,r.r+=n.r*o,r.g+=n.g*o,r.b+=n.b*o}}}function F(e,t,i){let r=t.scale.x*a,o=t.scale.y*n;i.isPointsMaterial&&(r*=i.size,o*=i.size);let s="M"+B(e.x-.5*r)+","+B(e.y-.5*o)+"h"+B(r)+"v"+B(o)+"h"+B(-r)+"z",l="";(i.isSpriteMaterial||i.isPointsMaterial)&&(l="fill:"+i.color.getStyle()+";fill-opacity:"+i.opacity),j(l,s)}function z(e,t,i){let r="M"+B(e.positionScreen.x)+","+B(e.positionScreen.y)+"L"+B(t.positionScreen.x)+","+B(t.positionScreen.y);if(i.isLineBasicMaterial){let e="fill:none;stroke:"+i.color.getStyle()+";stroke-opacity:"+i.opacity+";stroke-width:"+i.linewidth+";stroke-linecap:"+i.linecap;i.isLineDashedMaterial&&(e=e+";stroke-dasharray:"+i.dashSize+","+i.gapSize),j(e,r)}}function G(e,t,r,o,a){f.info.render.vertices+=3,f.info.render.faces++;let n="M"+B(e.positionScreen.x)+","+B(e.positionScreen.y)+"L"+B(t.positionScreen.x)+","+B(t.positionScreen.y)+"L"+B(r.positionScreen.x)+","+B(r.positionScreen.y)+"z",s="";a.isMeshBasicMaterial?(b.copy(a.color),a.vertexColors&&b.multiply(o.color)):a.isMeshLambertMaterial||a.isMeshPhongMaterial||a.isMeshStandardMaterial?(x.copy(a.color),a.vertexColors&&x.multiply(o.color),b.copy(P),T.copy(e.positionWorld).add(t.positionWorld).add(r.positionWorld).divideScalar(3),O(i,T,o.normalModel,b),b.multiply(x).add(a.emissive)):a.isMeshNormalMaterial&&(S.copy(o.normalModel).applyMatrix3(k).normalize(),b.setRGB(S.x,S.y,S.z).multiplyScalar(.5).addScalar(.5)),j(s=a.wireframe?"fill:none;stroke:"+b.getStyle()+";stroke-opacity:"+a.opacity+";stroke-width:"+a.wireframeLinewidth+";stroke-linecap:"+a.wireframeLinecap+";stroke-linejoin:"+a.wireframeLinejoin:"fill:"+b.getStyle()+";fill-opacity:"+a.opacity,n)}function H(e,t,i){let r=t.x-e.x,o=t.y-e.y,a=r*r+o*o;if(0===a)return;let n=i/Math.sqrt(a);r*=n,o*=n,t.x+=r,t.y+=o,e.x-=r,e.y-=o}function j(e,t){g===e?m+=t:(_(),g=e,m=t)}function _(){m&&((c=U(d++)).setAttribute("d",m),c.setAttribute("style",g),I.appendChild(c)),m="",g=""}function U(e){return null==L[e]&&(L[e]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==u&&L[e].setAttribute("shape-rendering","crispEdges")),L[e]}this.domElement=I,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.overdraw=.5,this.info={render:{vertices:0,faces:0}},this.setQuality=function(e){switch(e){case"high":u=1;break;case"low":u=0}},this.setClearColor=function(e){C.set(e)},this.setPixelRatio=function(){},this.setSize=function(e,t){r=e,o=t,a=r/2,n=o/2,I.setAttribute("viewBox",-a+" "+-n+" "+r+" "+o),I.setAttribute("width",r),I.setAttribute("height",o),w.min.set(-a,-n),w.max.set(a,n)},this.getSize=function(){return{width:r,height:o}},this.setPrecision=function(e){p=e},this.clear=function(){R(),I.style.backgroundColor=C.getStyle()},this.render=function(r,o){if(o instanceof $4xklQ.Camera==!1){console.error("THREE.SVGRenderer.render: camera is not an instance of Camera.");return}let c=r.background;c&&c.isColor?(R(),I.style.backgroundColor=c.getStyle()):!0===this.autoClear&&this.clear(),f.info.render.vertices=0,f.info.render.faces=0,V.copy(o.matrixWorldInverse),A.multiplyMatrices(o.projectionMatrix,V),t=(e=W.projectScene(r,o,this.sortObjects,this.sortElements)).elements,i=e.lights,k.getNormalMatrix(o.matrixWorldInverse),E(i),m="",g="";for(let e=0,i=t.length;e<i;e++){let i=t[e],r=i.material;if(void 0!==r&&0!==r.opacity){if(y.makeEmpty(),i instanceof $95d6a1447ab71b35$export$2a395e50c8655b14)s=i,s.x*=a,s.y*=-n,F(s,i,r);else if(i instanceof $95d6a1447ab71b35$export$a3be0aa4e4a40577)s=i.v1,l=i.v2,s.positionScreen.x*=a,s.positionScreen.y*=-n,l.positionScreen.x*=a,l.positionScreen.y*=-n,y.setFromPoints([s.positionScreen,l.positionScreen]),!0===w.intersectsBox(y)&&z(s,l,r);else if(i instanceof $95d6a1447ab71b35$export$1cd1d524e22c1604){if(s=i.v1,l=i.v2,h=i.v3,s.positionScreen.z<-1||s.positionScreen.z>1||l.positionScreen.z<-1||l.positionScreen.z>1||h.positionScreen.z<-1||h.positionScreen.z>1)continue;s.positionScreen.x*=a,s.positionScreen.y*=-n,l.positionScreen.x*=a,l.positionScreen.y*=-n,h.positionScreen.x*=a,h.positionScreen.y*=-n,this.overdraw>0&&(H(s.positionScreen,l.positionScreen,this.overdraw),H(l.positionScreen,h.positionScreen,this.overdraw),H(h.positionScreen,s.positionScreen,this.overdraw)),y.setFromPoints([s.positionScreen,l.positionScreen,h.positionScreen]),!0===w.intersectsBox(y)&&G(s,l,h,i,r)}}}_(),r.traverseVisible(function(e){if(e.isSVGObject){if(D.setFromMatrixPosition(e.matrixWorld),D.applyMatrix4(A),D.z<-1||D.z>1)return;let t=D.x*a,i=-D.y*n,r=e.node;r.setAttribute("transform","translate("+t+","+i+")"),I.appendChild(r)}})}}}var $9QhXH=parcelRequire("9QhXH"),$5sV3G=parcelRequire("5sV3G"),$4xklQ=parcelRequire("4xklQ"),$3BPdS=parcelRequire("3BPdS"),$4xklQ=parcelRequire("4xklQ"),$9HO6e=parcelRequire("9HO6e"),$9HO6e=parcelRequire("9HO6e");class $46f32ef2047263b6$export$6bf150a1b9f8c161{constructor(e){this.editor=e,this.currenObj={}}splitMain(){this.currenObj.main={startPoint:this.editor.currenDraw.startPoint,endPoint:this.editor.currenDraw.endPoint,mesh:[]},this.currenObj.other=[];let e=this.currenObj.main.startPoint,t=this.currenObj.main.endPoint,i=(0,$9HO6e.UtilCore).handleLineData(e,t);if(this.editor.allWalls.length>0){let o=[],a=[];if(this.editor.allWalls.slice(0).forEach(r=>{if("remove"==r.status)return;let n=r.startPoint,s=r.endPoint,l=(0,$9HO6e.UtilCore).handleLineData(n,s),h=(0,$9HO6e.UtilCore).isSameVector(e,n),c=(0,$9HO6e.UtilCore).isSameVector(e,s),d=(0,$9HO6e.UtilCore).isSameVector(t,n),p=(0,$9HO6e.UtilCore).isSameVector(t,s);if(""==this.editor.currenDraw||(0,$9HO6e.UtilCore).checkSameWall(r,this.editor.currenDraw))return;let u="";(h||c)&&(u=(0,$9HO6e.UtilCore).getMeshOtherPoint(this.editor.currenDraw,e)),(d||p)&&(u=(0,$9HO6e.UtilCore).getMeshOtherPoint(this.editor.currenDraw,t));let m=!1;if(""!=u&&(0,$9HO6e.UtilCore).pointInLine(u,l)&&(0,$9HO6e.UtilCore).pointIsInLine(u,n,s)&&(m=!0),(h||c||d||p)&&!m)return;if(m){let e=new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).splitWall(r,u),t={startPoint:r.startPoint,endPoint:r.endPoint,mesh:e};this.currenObj.other.push(t),this.editor.removeWall(this.editor.currenDraw),this.editor.currenDraw="";return}let g=(0,$9HO6e.UtilCore).lineIsIntersection(i,l);if(g){let i=(0,$9HO6e.UtilCore).pointIsInLine(g,e,t),l=(0,$9HO6e.UtilCore).pointIsInLine(g,n,s);if(!(i&&l))return;o.push(g),a.push(g.clone().distanceTo(e));let h=new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).splitWall(r,g),c={startPoint:r.startPoint,endPoint:r.endPoint,mesh:h};this.currenObj.other.push(c)}}),a.length>0){var r=a.slice(0);r.sort(function(e,t){return e-t});let e=this.editor.currenDraw;r.forEach(t=>{let i=a.indexOf(t),n=new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).splitWall(e,o[i]);this.currenObj.main.mesh.push(n[0]),n.length>1&&(r.indexOf(t)==r.length-1&&this.currenObj.main.mesh.push(n[1]),e=n[1])})}else{if(""==this.editor.currenDraw)return;0>this.editor.allWalls.indexOf(this.editor.currenDraw)&&this.editor.allWalls.push(this.editor.currenDraw),this.currenObj.main.mesh.push(this.editor.currenDraw)}}else this.currenObj.main.mesh.push(this.editor.currenDraw),this.editor.allWalls.push(this.editor.currenDraw)}undoSplit(){let e=[];var t=this.editor.allWalls.slice(0);this.currenObj.main.mesh.forEach(e=>{t.forEach(t=>{if((0,$9HO6e.UtilCore).isSameVector(e.startPoint,t.startPoint)&&(0,$9HO6e.UtilCore).isSameVector(e.endPoint,t.endPoint)){this.editor.wallGroup.remove(t),this.editor.removeHelperByWall(t),this.editor.allWalls.indexOf(t)>=0&&this.editor.allWalls.splice(this.editor.allWalls.indexOf(t),1);return}})}),this.editor.allWalls.slice(0).forEach(t=>{let i=(0,$9HO6e.UtilCore).isSameVector(this.currenObj.main.startPoint,t.startPoint)||(0,$9HO6e.UtilCore).isSameVector(this.currenObj.main.startPoint,t.endPoint),r=(0,$9HO6e.UtilCore).isSameVector(this.currenObj.main.endPoint,t.startPoint)||(0,$9HO6e.UtilCore).isSameVector(this.currenObj.main.endPoint,t.endPoint);(i||r)&&e.push(t)}),e.forEach(e=>{this.editor.addArcPointHelper(e.startPoint,e.endPoint)}),this.currenObj.other.reverse().forEach(e=>{let t="";e.mesh.forEach(e=>{this.editor.allWalls.slice(0).forEach(i=>{if((0,$9HO6e.UtilCore).isSameVector(e.startPoint,i.startPoint)&&(0,$9HO6e.UtilCore).isSameVector(e.endPoint,i.endPoint)){this.editor.wallGroup.remove(i),t=i,this.editor.removeHelperByWall(i),this.editor.allWalls.indexOf(i)>=0&&this.editor.allWalls.splice(this.editor.allWalls.indexOf(i),1);return}})});let i=new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).createLineWall(e.startPoint,e.endPoint);this.editor.addLineWallHelper(e.startPoint,e.endPoint),i.material.color=this.editor.getWallColor(i),""!=t&&(i.style=t.style,i.height=t.height,i.thickness=t.thickness),this.editor.scene.add(i),this.editor.allWalls.push(i)})}}class $fff7b0667b4b396b$export$912fb411e26e3541{constructor(e,t=[]){this.editor=e,this.param=t}drawMain(){if(("Mesh"==this.editor.currenDraw.type||"Group"==this.editor.currenDraw.type)&&(this.editor.currenDraw=""),""!=this.editor.currenDraw&&this.editor.currenDraw.forEach(e=>{this.editor.scene.remove(e),this.editor.removeHelperByWallId(e.id)}),0!=this.param.length){let e=(0,$9HO6e.UtilCore).toVector3(this.editor.startPoint),t=new(0,$4xklQ.Vector3)(this.editor.currentPoint.x,e.y,0).sub(e.clone()),i=new(0,$4xklQ.Vector3)(e.x,this.editor.currentPoint.y,0).sub(e.clone()),r=e.clone().add(t.setLength(this.param[0]+this.editor.wallDep)),o=e.clone().add(i.setLength(this.param[1]+this.editor.wallDep)),a=new $4xklQ.Vector3(r.x,o.y,0);this.editor.currenDraw=new $523a84362d27c3e8$export$43cb61aa07eebcbc(this.editor).createRoom(e,a,this.editor.roomWallDep),this.editor.startPoint=""}else this.editor.currenDraw=new $523a84362d27c3e8$export$43cb61aa07eebcbc(this.editor).createRoom(this.editor.startPoint,this.editor.currentPoint,this.editor.roomWallDep);this.editor.currenDraw.forEach(e=>{this.editor.scene.add(e)});let e=[this.editor.startPoint.x,this.editor.currentPoint.x],t=[this.editor.startPoint.y,this.editor.currentPoint.y],i=Math.min.apply(null,e),r=Math.max.apply(null,e),o=Math.min.apply(null,t),a=Math.max.apply(null,t),n=new $4xklQ.Vector3(i,a,0),s=new $4xklQ.Vector3(r,a,0),l=new $4xklQ.Vector3(i,o,0),h=this.editor.wallHelper.drawingRoomHelper(n,s,l,this.editor.wallDep);h[0].wallId=this.editor.currenDraw[0].id,h[1].wallId=this.editor.currenDraw[3].id,this.editor.helperGroup.add(...h)}execute(){this.drawMain(),this.editor.currenDraw.forEach(e=>{this.editor.removeHelperByWallId(e.id),e.material.color=this.editor.cancelChooseColor,this.editor.allWalls.push(e)}),this.editor.removeInputByClassName(this.editor.uiPanelBox.dom,"moveInput"),this.splitWallCommand=new $46f32ef2047263b6$export$6bf150a1b9f8c161(this.editor),this.editor.currenDraw.forEach(e=>{this.editor.currenDraw=e,this.splitWallCommand.splitMain()}),this.editor.currenDraw="";let e=this.editor.allWalls.slice(0);e.forEach(t=>{let i=(0,$9HO6e.UtilCore).getSamePositionWall(t,e);if(i.length>1){let e=i.pop();(0,$9HO6e.UtilCore).extendParamWall(t,e),i.forEach(e=>{this.editor.removeWall(e)})}}),new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).wallToJson()}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}}var $4xklQ=parcelRequire("4xklQ");class $b11833ee6970dca8$export$5be3661e3be4a62a{constructor(e,t=[]){this.editor=e,this.param=t}drawMain(){this.editor.currenDraw&&(this.editor.scene.remove(this.editor.currenDraw),this.editor.removeHelperByWallId(this.editor.currenDraw.id),this.editor.removeInputByClassName(this.editor.uiPanelBox.dom,"moveInput"));let e=this.editor.startPoint,t=this.editor.endPoint,i=t.clone().sub(e.clone());if(0!=this.param.length){let r=this.param[0],o=this.param[1],a=this.param[2],n=new $4xklQ.Vector3(1,0,0);if(""!=o&&""==a){o=1*o.replace(/°/g,"");let i="";t.x>e.x&&t.y>e.y?i=Math.PI/180*o:t.x<e.x&&t.y>e.y?i=Math.PI-Math.PI/180*o:t.x<e.x&&t.y<e.y?i=Math.PI+Math.PI/180*o:t.x>e.x&&t.y<e.y&&(i=2*Math.PI-Math.PI/180*o),n.applyEuler(new $4xklQ.Euler(0,0,i,"XYZ")),t=e.clone().add(n.setLength(r))}else if(""==o&&""!=a||""!=o&&""!=a){let i=Math.PI/180*a;n.applyEuler(new $4xklQ.Euler(0,0,i,"XYZ")),t=e.clone().add(n.setLength(r))}else t=e.clone().add(i.setLength(r));this.editor.startPoint=t}this.editor.currenDraw=new $4xklQ.Line(new(0,$4xklQ.BufferGeometry)().setFromPoints([e,t]),this.editor.config.drawDotMaterial),this.editor.currenDraw.startPoint=e,this.editor.currenDraw.endPoint=t,this.editor.currenDraw.useType="splitLine",this.editor.currenDraw.computeLineDistances(),this.editor.currenDraw.renderOrder=50,this.editor.scene.add(this.editor.currenDraw),new $002a82be864d68ed$export$a80d7a02e87abd45(this.editor,"sliptRoom").drawingWallHelper(e.clone(),t.clone()).wallId=this.editor.currenDraw.id}execute(){this.drawMain(),this.editor.currenDraw.material=this.editor.config.dotMaterial,this.editor.currenDraw.useType=this.editor.splitType,this.editor.splitRoomLine.add(this.editor.currenDraw),this.editor.removeHelperByWallId(this.editor.currenDraw.id),this.editor.removeInputByClassName(this.editor.uiPanelBox.dom,"moveInput"),this.editor.currenDraw="",new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).wallToJson()}undo(){}}var $9HO6e=parcelRequire("9HO6e"),$4xklQ=parcelRequire("4xklQ"),$3BPdS=parcelRequire("3BPdS");class $4e6d6bcbeea35653$export$e5e2c7c57f7de029{constructor(e,t=[]){this.editor=e,this.splitWallCommand="",this.param=t}drawMain(e="",t=""){""!=this.editor.currenDraw&&(this.editor.scene.remove(this.editor.currenDraw),this.editor.removeHelperByWallId(this.editor.currenDraw.id));let i=this.editor.startPoint,r=this.editor.endPoint;""!=this.splitWallCommand&&"{}"!=JSON.stringify(this.splitWallCommand.currenObj)&&(i=this.splitWallCommand.currenObj.main.startPoint,r=this.splitWallCommand.currenObj.main.endPoint);let o=new $4xklQ.Vector2(r.x,r.y);if(r=this.handleEndPoint(i,r),(0,$9HO6e.UtilCore).isSameVector(i,r))return;let a=r.clone().sub(i.clone());if(0!=this.param.length){let e=this.param[0],t=this.param[1],o=this.param[2],n=new $4xklQ.Vector3(1,0,0);if(""!=t&&""==o){t=1*t.replace(/°/g,"");let o="";r.x>i.x&&r.y>i.y?o=Math.PI/180*t:r.x<i.x&&r.y>i.y?o=Math.PI-Math.PI/180*t:r.x<i.x&&r.y<i.y?o=Math.PI+Math.PI/180*t:r.x>i.x&&r.y<i.y&&(o=2*Math.PI-Math.PI/180*t),n.applyEuler(new $4xklQ.Euler(0,0,o,"XYZ")),r=i.clone().add(n.setLength(e))}else if(""==t&&""!=o||""!=t&&""!=o){let t=Math.PI/180*o;n.applyEuler(new $4xklQ.Euler(0,0,t,"XYZ")),r=i.clone().add(n.setLength(e))}else r=i.clone().add(a.setLength(e));i=new $4xklQ.Vector2(1*i.x.toFixed(2),1*i.y.toFixed(2)),r=new $4xklQ.Vector2(1*r.x.toFixed(2),1*r.y.toFixed(2)),this.editor.startPoint=r}this.editor.currenDraw=new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).createLineWall(i,r,this.editor.wallDep),2==this.editor.innerDraw&&(this.editor.currenDraw.realStart=i.clone(),this.editor.currenDraw.realEnd=r.clone()),this.editor.scene.add(this.editor.currenDraw);let n=this.editor.wallHelper.drawingWallHelper(i.clone(),r.clone()),s=(0,$9HO6e.UtilCore).havePointWall(i,this.editor.allWalls),l=[];s.forEach(e=>{let t=(0,$9HO6e.UtilCore).getMeshOtherPoint(e,i).clone().sub(i.clone()),r=(0,$9HO6e.UtilCore).toVector3(t).angleTo((0,$9HO6e.UtilCore).toVector3(a));r=Math.round(180/Math.PI*r),l.push(r)});let h=Math.min.apply(null,l),c=l.indexOf(h);if(c>=0){let e=s[c],t=(0,$9HO6e.UtilCore).getMeshOtherPoint(e,i),o=Math.round(180/Math.PI*(0,$9HO6e.UtilCore).toVector2(t.clone().sub(i.clone())).angle()),a=this.editor.wallHelp.createCircleLine(i,e,this.editor.currenDraw),l=(0,$9HO6e.UtilCore).getClockWise(t,i,r);l=l>0?-1:1,n.wallRealAngle=a.realAngle,n.add(a);let h=this.editor.getScreenPosition(a.center.clone());if(this.editor.checkHasCurrentInput(this.editor.uiPanelBox.dom,"realAngleInput")>=0){let e=document.getElementById("realAngleInput");e.style.marginLeft=h.x+"px",e.style.marginTop=h.y+"px",e.value=a.realAngle}else{let e=new(0,$3BPdS.UIInput)(a.realAngle).setClass("moveInput").setId("realAngleInput").setFontSize("15px").setWidth("40px").setMarginTop(h.y+"px").setMarginLeft(h.x+"px").setFocus().onKeyDown((function(e){if("Tab"==e.key&&(document.getElementById("lengthInput").focus(),document.getElementById("lengthInput").select(),e.preventDefault()),"Escape"==e.key&&this.editor.exitTool(),"13"==e.keyCode){let e="";document.getElementById("angleInput")&&(e=document.getElementById("angleInput").value).replace(/°/g,"")==n.realAngle.replace(/°/g,"")&&(e="");let t=[document.getElementById("lengthInput").value,e,o+1*document.getElementById("realAngleInput").value*l];this.editor.list.startPlayer.dispatch(),this.editor.execute(new $4e6d6bcbeea35653$export$e5e2c7c57f7de029(this.editor,t),"画墙")}}).bind(this));e.dom.addEventListener("mousedown",(function(e){2==e.button&&this.editor.camera.isOrthographicCamera&&this.editor.exitTool()}).bind(this)),e.setAttribute("wallAngle",o),e.setAttribute("clockWise",l),e.setAttribute("tabInput",0),this.editor.uiPanelBox.add(e)}}n.wallId=this.editor.currenDraw.id;let d=!0;this.editor.allLinkWallByStartPoint.forEach(e=>{let t=(0,$9HO6e.UtilCore).handleLineData(e.startPoint,e.endPoint);(0,$9HO6e.UtilCore).pointInLine(o,t)&&(d=!1)}),d&&""==this.splitWallCommand&&this.editor.wallTool.handleIntersectNew3(this.editor.currenDraw,this.editor.allLinkWallByStartPoint)}execute(e="",t=""){if(this.drawMain(e,t),!this.editor.currenDraw)return;if(2==this.editor.innerDraw&&"wall"==this.editor.toolType){let e=this.editor.currenDraw.geometry.attributes.position.array,t=new $4xklQ.Vector2(e[6],e[7]),i=new $4xklQ.Vector2(e[15],e[16]),r=new $4xklQ.Vector2(e[0],e[1]),o=new $4xklQ.Vector2(e[9],e[10]),a=this.editor.allWalls.slice(0),n=(0,$9HO6e.UtilCore).handleLineData(this.editor.currenDraw.startPoint,this.editor.currenDraw.endPoint),s=[[],[]];a.forEach(e=>{if(!e.wallID)return;let a=e.geometry.attributes.position.array,l=[new $4xklQ.Vector2(a[9],a[10]),new $4xklQ.Vector2(a[12],a[13]),new $4xklQ.Vector2(a[15],a[16]),new $4xklQ.Vector2(a[0],a[1]),new $4xklQ.Vector2(a[3],a[4]),new $4xklQ.Vector2(a[6],a[7])],h=-1,c=-1,d=0;if(l.forEach(e=>{d++,((0,$9HO6e.UtilCore).isSameVector(t,e)||(0,$9HO6e.UtilCore).isSameVector(r,e))&&(h=d),((0,$9HO6e.UtilCore).isSameVector(i,e)||(0,$9HO6e.UtilCore).isSameVector(o,e))&&(c=d)}),-1==h&&-1==c)return;let p=(0,$9HO6e.UtilCore).handleLineData(e.startPoint,e.endPoint),u=(0,$9HO6e.UtilCore).lineIsIntersection(n,p),m=1==h||2==h||3==h||1==c||2==c||3==c,g=4==h||5==h||6==h||4==c||5==c||6==c;!u&&(m&&(u=e.endPoint.clone()),g&&(u=e.startPoint.clone()));let f=[e,u,"",""];m&&(f[2]="end",f[3]=e.endPoint.clone()),g&&(f[2]="start",f[3]=e.startPoint.clone()),-1!=h&&s[0].push(f),-1!=c&&s[1].push(f)});let l=s[0],h=s[1];if(1==l.length){let e=l[0][0];this.editor.removeHelperByWall(e),"end"==l[0][2]?e.endPoint=l[0][1]:e.startPoint=l[0][1],this.editor.currenDraw.startPoint=l[0][1]}else l.length>1&&(this.editor.currenDraw.startPoint=l[0][3],0==h.length&&(this.editor.currenDraw.endPoint=this.editor.currenDraw.realEnd.clone()));if(1==h.length){let e=h[0][0];this.editor.removeHelperByWall(e),"end"==h[0][2]?e.endPoint=h[0][1]:e.startPoint=h[0][1],this.editor.currenDraw.endPoint=h[0][1]}else h.length>1&&(this.editor.currenDraw.endPoint=h[0][3],0==l.length&&(this.editor.currenDraw.startPoint=this.editor.currenDraw.realStart.clone()))}this.editor.removeHelperByWallId(this.editor.currenDraw.id),this.editor.removeInputByClassName(this.editor.uiPanelBox.dom,"moveInput"),this.editor.addLineWallHelper(this.editor.currenDraw.startPoint,this.editor.currenDraw.endPoint),this.editor.currenDraw.material.color=this.editor.cancelChooseColor,this.splitWallCommand=new $46f32ef2047263b6$export$6bf150a1b9f8c161(this.editor),this.splitWallCommand.splitMain(),this.editor.currenDraw="";let i=this.editor.floorGroup2d.children.length;new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).wallToJson(),i!=this.editor.floorGroup2d.children.length&&this.editor.exitTool(),0!=this.param.length&&(this.editor.allLinkWallByStartPoint=[],this.editor.allLinkWallByStartPoint=(0,$9HO6e.UtilCore).havePointWall(this.editor.startPoint,this.editor.allWalls)),this.editor.otherMeshs.forEach(e=>{if(""==e.wallId&&e.wallPoint){let t=(0,$9HO6e.UtilCore).getRealWallByPosition(e.wallPoint[0],e.wallPoint[1],this.editor.allWalls);t&&(e.wallId=t.wallID)}})}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}handleEndPoint(e,t){return 150>Math.abs(e.x-t.x)&&(t.x=e.x),150>Math.abs(e.y-t.y)&&(t.y=e.y),t}toJson(){let e=[];this.editor.allWalls.forEach(t=>{let i={start:{x:1*t.startPoint.x.toFixed(2),y:1*t.startPoint.y.toFixed(2),z:0},end:{x:1*t.endPoint.x.toFixed(2),y:1*t.endPoint.y.toFixed(2),z:0},style:0,line:0,isArc:!1,thickness:240,height:280,direction:"",offsetXY:100};e.push(i)})}}class $002a82be864d68ed$export$a80d7a02e87abd45{constructor(e,t="wall"){this.editor=e,this.tool=t}drawingWallHelper(e,t,i=280){let r=this.editor.wallHelp.drawWallHelp(e.clone(),t.clone(),i);if(""!=r.realAngle){let e=this.editor.checkHasCurrentInput(this.editor.uiPanelBox.dom,"angleInput"),t=this.editor.getScreenPosition(r.arcCenter.clone());if(e>=0){let e=document.getElementById("angleInput");e.style.marginLeft=t.x+"px",e.style.marginTop=t.y+"px",e.value=r.realAngle}else{let e=new(0,$3BPdS.UIInput)(r.realAngle).setClass("moveInput").setId("angleInput").setFocus().setFontSize("15px").setWidth("40px").setMarginTop(t.y+"px").setMarginLeft(t.x+"px").onKeyDown((function(e){if("Tab"==e.key&&(document.getElementById("realAngleInput")?(document.getElementById("realAngleInput").focus(),document.getElementById("realAngleInput").select()):(document.getElementById("lengthInput").focus(),document.getElementById("lengthInput").select()),e.preventDefault()),"Escape"==e.key&&this.editor.exitTool(),"13"==e.keyCode){let e=document.getElementById("angleInput").value,t=document.getElementById("lengthInput").value,i="";if(document.getElementById("realAngleInput")&&((i=document.getElementById("realAngleInput").value).replace(/°/g,"")==r.wallRealAngle.replace(/°/g,"")&&(i=""),""!=i)){i=i.replace(/°/g,"");let e=this.editor.getDomById(this.editor.uiPanelBox.dom,"realAngleInput");e&&(i=1*e.getAttribute("wallAngle")+i*e.getAttribute("clockWise")*1)}let o=[t,e,i];this.editor.list.startPlayer.dispatch(),"wall"==this.tool?this.editor.execute(new $4e6d6bcbeea35653$export$e5e2c7c57f7de029(this.editor,o),"画墙"):this.editor.execute(new $b11833ee6970dca8$export$5be3661e3be4a62a(this.editor,o),"分割墙")}}).bind(this));e.dom.addEventListener("mousedown",(function(e){2==e.button&&this.editor.camera.isOrthographicCamera&&this.editor.exitTool()}).bind(this)),e.setAttribute("tabInput",0),this.editor.uiPanelBox.add(e)}}else document.getElementById("angleInput")&&this.editor.uiPanelBox.dom.removeChild(document.getElementById("angleInput"));let o=this.editor.checkHasCurrentInput(this.editor.uiPanelBox.dom,"lengthInput"),a=this.editor.getScreenPosition(r.lineCenter.clone());if(o>=0){let e=document.getElementById("lengthInput");e.style.marginLeft=a.x+"px",e.style.marginTop=a.y+"px",e.value=r.lineLength,e.focus(),e.select()}else{let e=new(0,$3BPdS.UIInput)(r.lineLength).setClass("moveInput").setId("lengthInput").setFontSize("15px").setWidth("40px").setMarginTop(a.y+"px").setMarginLeft(a.x+"px").setFocus().onKeyDown((function(e){if("Tab"==e.key&&document.getElementById("angleInput")&&(document.getElementById("angleInput").focus(),document.getElementById("angleInput").select(),e.preventDefault()),"Escape"==e.key&&this.editor.exitTool(),"13"==e.keyCode){let e="";document.getElementById("angleInput")&&(e=document.getElementById("angleInput").value).replace(/°/g,"")==r.realAngle.replace(/°/g,"")&&(e="");let t=document.getElementById("lengthInput").value,i="";if(document.getElementById("realAngleInput")&&((i=document.getElementById("realAngleInput").value).replace(/°/g,"")==r.wallRealAngle.replace(/°/g,"")&&(i=""),""!=i)){i=i.replace(/°/g,"");let e=this.editor.getDomById(this.editor.uiPanelBox.dom,"realAngleInput");e&&(i=1*e.getAttribute("wallAngle")+i*e.getAttribute("clockWise")*1)}let o=[t,e,i];this.editor.list.startPlayer.dispatch(),"wall"==this.tool?this.editor.execute(new $4e6d6bcbeea35653$export$e5e2c7c57f7de029(this.editor,o),"画墙"):this.editor.execute(new $b11833ee6970dca8$export$5be3661e3be4a62a(this.editor,o),"分割墙")}}).bind(this));e.dom.addEventListener("mousedown",(function(e){2==e.button&&this.editor.camera.isOrthographicCamera&&this.editor.exitTool()}).bind(this)),e.setAttribute("tabInput",0),this.editor.uiPanelBox.add(e),document.getElementById("lengthInput").focus()}return this.editor.helperGroup.add(r),r}addLineWallHelper(e,t,i=""){let r="";r=""==i?this.editor.wallHelp.createLineDimensionsLine(e,t,!1):this.editor.wallHelp.createLineDimensionsLine(e,t,!1,i);let o=new(0,$4xklQ.Vector2)(t.x,t.y).sub(new $4xklQ.Vector2(e.x,e.y)).angle();(o=180/Math.PI*o)>180&&o<270?o=360-o+180:o>90&&o<=180?(o*=-1,o+=180):o=360-o;let a=this.editor.getScreenPosition(r.center.clone()),n=new(0,$3BPdS.UIText)(r.lineLength).setClass("showWallLength"+r.uuid).setFontSize("15px").setWidth("40px").setMarginTop(a.y+"px").setMarginLeft(a.x+"px").setStyle(["transform"],["rotate("+o+"deg)"]),s=r.center.x+"/"+r.center.y+"/"+r.center.z;return n.setAttribute("worldPosition",s),n.setAttribute("angle",o),0!=r.lineLength&&this.editor.uiPanelBox.add(n),this.editor.helperGroup.add(r),r}addArcWallHelper(){}addBSRWallHelper(e){let t=e.cp,i=e.startPoint,r=e.endPoint,o=$523a84362d27c3e8$export$b680ca477a72be07.makeControlPoint(t);o.useType="bseControl",o.wall=e;var a=new(0,$4xklQ.BufferGeometry)().setFromPoints([i,t,r]),n=new $4xklQ.Line(a,new $4xklQ.MeshBasicMaterial({color:"#1E90FF",side:$4xklQ.DoubleSide,transparent:!0}));n.startPoint=e.startPoint,n.endPoint=e.endPoint,this.editor.pointHelperGroup.add(o),n.lineType="bseLine",this.editor.helperGroup.add(n)}drawingRoomHelper(e,t,i,r=240){let o=new $4xklQ.Vector3(e.x+r/2,e.y-r/2,0),a=new $4xklQ.Vector3(t.x-r/2,t.y-r/2,0),n=new $4xklQ.Vector3(i.x+r/2,i.y+r/2,0),s=this.editor.wallHelp.createLineDimensionsLine(a,o,!1),l=this.editor.wallHelp.createLineDimensionsLine(o,n,!1),h=this.editor.getScreenPosition(s.center.clone()),c=this.editor.getScreenPosition(l.center.clone()),d=this.editor.checkHasCurrentInput(this.editor.uiPanelBox.dom,"topInput"),p=this.editor.checkHasCurrentInput(this.editor.uiPanelBox.dom,"leftInput");if(d>=0){let e=document.getElementById("topInput");e.style.marginLeft=h.x+"px",e.style.marginTop=h.y+"px",e.value=s.lineLength,e.focus(),e.select()}else{let e=new(0,$3BPdS.UIInput)(s.lineLength).setClass("moveInput").setId("topInput").setFontSize("15px").setWidth("40px").setMarginTop(h.y+"px").setMarginLeft(h.x+"px").setFocus().onKeyDown((function(t){let i=document.getElementById("leftInput");if("Tab"==t.key&&i&&(i.focus(),i.select(),t.preventDefault()),"Escape"==t.key&&this.editor.exitTool(),"13"==t.keyCode){let t=1*e.dom.value,r=1*i.value;new $fff7b0667b4b396b$export$912fb411e26e3541(this.editor,[t,r]).execute()}}).bind(this));this.editor.uiPanelBox.add(e)}if(p>=0){let e=document.getElementById("leftInput");e.style.marginLeft=c.x+"px",e.style.marginTop=c.y+"px",e.value=l.lineLength}else{let e=new(0,$3BPdS.UIInput)(l.lineLength).setClass("moveInput").setId("leftInput").setFontSize("15px").setWidth("40px").setMarginTop(c.y+"px").setMarginLeft(c.x+"px").setFocus().onKeyDown((function(t){let i=document.getElementById("topInput");if("Tab"==t.key&&i&&(i.focus(),i.select(),t.preventDefault()),"Escape"==t.key&&this.editor.exitTool(),"13"==t.keyCode){let t=1*i.value,r=1*e.dom.value;new $fff7b0667b4b396b$export$912fb411e26e3541(this.editor,[t,r]).execute()}}).bind(this));this.editor.uiPanelBox.add(e)}return[s,l]}}var $4xklQ=parcelRequire("4xklQ"),$3BPdS=parcelRequire("3BPdS"),$9HO6e=parcelRequire("9HO6e"),$4xklQ=parcelRequire("4xklQ"),$9QhXH=parcelRequire("9QhXH");class $a9d7f9904bb6112a$export$6803bcffe5c71ec4{constructor(e,t="",i="",r=[],o=!0,a=""){this.editor=e,this.redrew=o,this.type=t,this.changeWall=i,this.doorWid=this.editor.config.doorWidth;let n=["doubledoor","slidingdoor","baywindow","frenchwindows","singleDoubleDoor"];this.toolType=this.editor.toolType,this.wallDepth=240,n.indexOf(this.editor.toolType)>=0&&(this.doorWid=2*this.editor.config.doorWidth),""!=t&&this.editor.currentDoor&&(this.doorWid=this.editor.currentDoor.doorWid),this.res=[],this.param=r,"straightWindow"==this.toolType&&(this.doorWid=1200),"straightBayWindow"==this.toolType&&(this.doorWid=3e3),("UWindow"==this.toolType||"UBayWindow"==this.toolType)&&(this.doorWid=2e3),this.LWidth=1200,this.RWidth=1200,this.leftWall="",this.rightWall="",this.centerWall="",this.arcWindowAngle=Math.PI/4,this.arcCenter=!1,this.extendClick=a,this.editor.copyDoor&&(this.doorWid=this.editor.copyDoor.doorWid)}drawMain(){this.editor.cleanWallHelper();let e=this.toolType;this.editor.blackbox&&this.editor.blackbox.removeDom(),this.editor.blackbox="",""!=this.type&&(e=this.editor.currentDoor.modelType),this.toolType=e;let t="outside";this.editor.copyDoor&&this.editor.copyDoor.doorDir&&(t=this.editor.copyDoor.doorDir);let i=this.editor.currentPoint.clone(),r="";if(""==this.changeWall)"LWindow"==e||"UWindow"==e?("LWindow"==e&&(r=this.getNearWallForLWindow(this.editor.currentPoint,2),this.leftWall=r[3],this.rightWall=r[4]),"UWindow"==e&&(r=this.getNearWallForUWindow(this.editor.currentPoint,2),this.leftWall=r[4],this.rightWall=r[5],this.centerWall=r[3]),this.editor.currentDoor.leftWindow&&(this.LWidth=this.editor.currentDoor.leftWindow[1],this.RWidth=this.editor.currentDoor.rightWindow[1]),this.editor.currentDoor.leftWindow&&0==r.length&&(this.leftWall=this.editor.currentDoor.leftWindow[0],this.rightWall=this.editor.currentDoor.rightWindow[0])):"arcWindow"==e?r=this.getNearWallForArcWindow(this.editor.currentPoint,2):(r=this.getNearWallByPoint(this.editor.currentPoint),this.editor.currentDoor&&"arcWindow"==this.editor.currentDoor.modelType&&(r=this.getNearWallForArcWindow(this.editor.currentPoint,2)),this.editor.currentDownSelect.length>0&&this.editor.currentDoor&&!this.editor.currentDownSelect[0].object.useType&&("LWindow"==this.editor.currentDoor.modelType&&(r=this.getNearWallForLWindow(this.editor.currentPoint,2)),"UWindow"==this.editor.currentDoor.modelType&&(r=this.getNearWallForUWindow(this.editor.currentPoint,2))));else{if(!this.editor.currentDoor.wallId)return;let t=this.editor.currentDoor.wallId;("LWindow"==e||"UWindow"==e)&&(t=this.editor.currentDoor.leftWindow[0].wallID,"right"==this.changeWall&&(t=this.editor.currentDoor.rightWindow[0].wallID)),r="arcWindow"==e?this.getNearWallForArcWindowForChange(this.editor.currentPoint,t):this.getNearWallByPointForChange(this.editor.currentPoint,t)}this.res=r;let o=new $4xklQ.Vector2(1,0),a=new $4xklQ.Vector2(2,0);if(1==r.length)return;let n=0,s="",l="";if(""!=this.type){if(!this.editor.currentDoor)return;if(n=this.editor.currentDoor.angle,s=this.editor.currentDoor.height,l=this.editor.currentDoor.floorHei,this.editor.currentDoor){let e=this.editor.currentDoor;this.editor.scene.remove(e),this.editor.otherMeshs.indexOf(e)>=0&&this.editor.otherMeshs.splice(this.editor.otherMeshs.indexOf(e),1)}}if(""!=this.editor.currenDraw&&(this.editor.scene.remove(this.editor.currenDraw),this.editor.otherMeshs.indexOf(this.editor.currenDraw)>=0&&this.editor.otherMeshs.splice(this.editor.otherMeshs.indexOf(this.editor.currenDraw),1)),this.editor.pointHelpGroup.children=[],r.length>=3){i=r[0],o=r[1],a=r[2],i=new $4xklQ.Vector3(i.x,i.y,0),this.wallDepth=1*r[3].thickness;let t=(0,$9HO6e.UtilCore).getMinEdge(r[3]);t<=this.doorWid&&(this.doorWid=t),n=new(0,$4xklQ.Vector2)(a.x,a.y).sub(new $4xklQ.Vector2(o.x,o.y)).angle();let s=(0,$9HO6e.UtilCore).createCenterLine(r[3].startPoint,r[3].endPoint);if(this.editor.pointHelpGroup.add(s),r[3].arcCenter&&(this.arcCenter=r[3].arcCenter.clone()),"arcWindow"==e&&this.editor.currentDoor){let e=this.editor.currentDoor;this.arcCenter=e.arcCenter,this.wallDepth=e.wallDep,this.arcWindowAngle=e.angle}}else n=0;if(""!=this.changeWall){let o=this.editor.currentDoor;this.editor.scene.remove(o),this.editor.otherMeshs.indexOf(o)>=0&&this.editor.otherMeshs.splice(this.editor.otherMeshs.indexOf(o),1);let a="start"==this.changeWall?o.endPoint:o.startPoint,n=new $4xklQ.Vector3((a.x+i.x)/2,(a.y+i.y)/2,0);if(this.doorWid=1*a.clone().distanceTo(i.clone()),i=n,("LWindow"==e||"UWindow"==e)&&r.length>0){let t=new $4xklQ.Vector3(o.center.x,o.center.y,0),a=1*t.clone().distanceTo(new $4xklQ.Vector3(r[0].x,r[0].y,0));if(this.leftWall=o.leftWindow[0],this.rightWall=o.rightWindow[0],this.LWidth=o.leftWindow[1],this.RWidth=o.rightWindow[1],i=t,"UWindow"==e){this.centerWall=this.editor.getWallByWallId(o.wallId);let e="";if(e="left"==this.changeWall?(0,$9HO6e.UtilCore).getSamePointTwoWall(this.leftWall,this.centerWall):(0,$9HO6e.UtilCore).getSamePointTwoWall(this.rightWall,this.centerWall)){a=1*e.clone().distanceTo(new $4xklQ.Vector3(r[0].x,r[0].y,0));let t=this.centerWall.startPoint,o=this.centerWall.endPoint;i=new $4xklQ.Vector3((t.x+o.x)/2,(t.y+o.y)/2,0)}}"left"==this.changeWall?this.LWidth=a:this.RWidth=a}if("arcWindow"==e){this.arcCenter=o.arcCenter,this.wallDepth=o.wallDep;let e=this.arcCenter.clone().distanceTo(o.center.clone()),t=0==r.length?o.endPoint.clone():r[0].clone(),a=o.startPoint.clone();"arcStart"==this.changeWall&&(a=o.endPoint.clone());let n=new $4xklQ.Vector2((t.x+a.x)/2,(t.y+a.y)/2);i=this.arcCenter.clone().add(n.clone().sub(this.arcCenter.clone()).setLength(e)),this.arcWindowAngle=(0,$9HO6e.UtilCore).toVector3(i.clone().sub(this.arcCenter.clone())).angleTo((0,$9HO6e.UtilCore).toVector3(a.clone().sub(this.arcCenter.clone())))}""!=o.doorDir&&(t=o.doorDir)}if(this.editor.doorHelperGroupClean(),o=new $4xklQ.Vector3(o.x,o.y,0),a=new $4xklQ.Vector3(a.x,a.y,0),0!=this.param.length){let r=this.editor.currentDoor,s=this.editor.currentDoor.center;if(this.doorWid=1*this.editor.currentDoor.doorWid,"width"==this.param[2]&&(this.doorWid=1*this.param[0],i=s),"depth"==this.param[2]&&(this.wallDepth=1*this.param[0],i=s,("LWindow"==r.modelType||"UWindow"==r.modelType)&&(this.LWidth=r.leftWindow[1],this.RWidth=r.rightWindow[1],this.leftWall=this.editor.getWallByWallId(r.leftWindow[0].wallID),this.rightWall=this.editor.getWallByWallId(r.rightWindow[0].wallID),"UWindow"==r.modelType&&(this.centerWall=this.editor.getWallByWallId(r.wallId)))),"start"==this.param[2]){let e=r.endPoint.clone().sub(r.startPoint.clone()).setLength(this.param[1]);i=s.add(e)}if("end"==this.param[2]){let e=r.startPoint.clone().sub(r.endPoint.clone()).setLength(this.param[1]);i=s.add(e)}if("angle"==this.param[2]){n=r.angle;let o=["outside","leftSide","rightSide","inside"],a=o.indexOf(t);a==o.length-1&&(a=-1),t=o[a+1],i=s,(e.indexOf("Window")>=0||e.indexOf("window")>=0)&&(n+=Math.PI)}if("left"==this.param[2]||"right"==this.param[2]){let t=1*this.param[0];this.leftWall=r.leftWindow[0],this.rightWall=r.rightWindow[0],this.LWidth=r.leftWindow[1],this.RWidth=r.rightWindow[1],"UWindow"==e&&(this.centerWall=this.editor.getWallByWallId(r.wallId)),"left"==this.param[2]?this.LWidth=t:this.RWidth=t}if("center"==this.param[2]){if(i=this.param[1][0],n=this.param[0].angle,this.doorWid=this.param[0].doorWid,this.wallDepth=this.param[0].wallDep,o=this.param[1][1],a=this.param[1][2],"LWindow"==this.param[0].modelType||"UWindow"==this.param[0].modelType){let e=this.param[0];if(this.leftWall=this.editor.getWallByWallId(e.leftWindow[0].wallID),this.rightWall=this.editor.getWallByWallId(e.rightWindow[0].wallID),this.LWidth=e.leftWindow[1],this.RWidth=e.rightWindow[1],i=(0,$9HO6e.UtilCore).getSamePointTwoWall(this.leftWall,this.rightWall),"UWindow"==this.param[0].modelType){this.centerWall=this.editor.getWallByWallId(e.wallId);let t=this.centerWall.startPoint,r=this.centerWall.endPoint;i=new $4xklQ.Vector3((t.x+r.x)/2,(t.y+r.y)/2,0)}}if("arcWindow"==this.param[0].modelType){let e=this.param[0];this.arcCenter=this.param[1][3].clone(),this.wallDepth=e.wallDep,this.arcWindowAngle=e.angle}}if("wall"==this.param[2]){let e=this.param[1][1];if(i=this.param[1][0],o=e.startPoint,a=e.endPoint,i=new $4xklQ.Vector3(i.x,i.y,0),this.wallDepth=1*e.thickness,n=new(0,$4xklQ.Vector2)(a.x,a.y,0).sub(new $4xklQ.Vector2(o.x,o.y,0)).angle(),"LWindow"==this.param[0].modelType){let e=this.param[0];this.leftWall=this.editor.getWallByWallId(e.leftWindow[0].wallID),this.rightWall=this.editor.getWallByWallId(e.rightWindow[0].wallID),this.LWidth=e.leftWindow[1],this.RWidth=e.rightWindow[1],i=(0,$9HO6e.UtilCore).getSamePointTwoWall(this.leftWall,this.rightWall)}if("arcWindow"==this.param[0].modelType){let e=this.param[0],t=this.param[1][2];this.arcCenter=t.arcCenter,this.wallDepth=t.wallDep,this.arcWindowAngle=e.angle;let r=e.center.clone().sub(e.arcCenter.clone()),o=t.cp.distanceTo(t.arcCenter);i=t.arcCenter.clone().add(r.setLength(o))}}if("arcAngle"==this.param[2]){let e=this.param[1];this.arcCenter=e.arcCenter,this.wallDepth=e.wallDep,this.arcWindowAngle=Math.PI/180*(this.param[0]/2),i=e.center}}if("doubledoor"==e)this.editor.currenDraw=(0,$9QhXH.DM).createDODoor(i,this.doorWid,n,this.wallDepth,o,a,t);else if("door"==e)this.editor.currenDraw=(0,$9QhXH.DM).createBaseDoor(i,this.doorWid,t,n,this.wallDepth,o,a);else if("slidingdoor"==e)this.editor.currenDraw=(0,$9QhXH.DM).createSlidingDoor(i,this.doorWid,n,this.wallDepth,o,a,t);else if("window"==e)this.editor.currenDraw=(0,$9QhXH.DM).createBaseWindow(i,this.doorWid,n,this.wallDepth,o,a);else if("baywindow"==e){let e=this.wallDepth;e>=500&&(e=this.wallDepth-500),this.editor.currenDraw=(0,$9QhXH.DM).createPanoramicWindow(i,this.doorWid,n,e,o,a)}else if("frenchwindows"==e)this.editor.currenDraw=(0,$9QhXH.DM).createFrenchWindow(i,this.doorWid,n,this.wallDepth,o,a);else if("singledoor"==e)this.editor.currenDraw=(0,$9QhXH.DM).createBaseDoor(i,this.doorWid,t,n,this.wallDepth,o,a);else if("singleDoubleDoor"==e)this.editor.currenDraw=(0,$9QhXH.DM).createDODoor(i,this.doorWid,n,this.wallDepth,o,a,t);else if("childMotherDoor"==e)this.editor.currenDraw=(0,$9QhXH.DM).createLashDoor(i,this.doorWid,n,this.wallDepth,o,a,t);else if("moveDoor"==e)this.editor.currenDraw=(0,$9QhXH.DM).createSlidingDoor(i,this.doorWid,n,this.wallDepth,o,a,t);else if("pass"==e||"passDoor"==e)this.editor.currenDraw=(0,$9QhXH.DM).createPass(i,this.doorWid,n,this.wallDepth,o,a,t);else if("straightWindow"==e)this.editor.currenDraw=(0,$9QhXH.DM).createBaseWindow(i,this.doorWid,n,this.wallDepth,o,a);else if("straightBayWindow"==e){let e=this.wallDepth;e>=500&&(e=this.wallDepth-500),this.editor.currenDraw=(0,$9QhXH.DM).createPanoramicWindow(i,this.doorWid,n,e,o,a)}else"LWindow"==e?this.editor.currenDraw=(0,$9QhXH.DM).createLWindowNew(i,this.leftWall,this.rightWall,this.LWidth,this.RWidth):"LBayWindow"==e||("UWindow"==e?this.editor.currenDraw=(0,$9QhXH.DM).createUWindow(i,this.leftWall,this.centerWall,this.rightWall,this.LWidth,this.RWidth):"UBayWindow"==e||("dooropen"==e?this.editor.currenDraw=(0,$9QhXH.DM).createDoorHole(i,this.doorWid,n,this.wallDepth,o,a):"archDoor"==e?this.editor.currenDraw=(0,$9QhXH.DM).createSectorDoor(i,this.doorWid,n,this.wallDepth,o,a):"archWindow"==e?(this.doorWid==this.editor.config.doorWidth&&(this.doorWid+=583),this.editor.currenDraw=(0,$9QhXH.DM).createSectorWindow(i,this.doorWid,n,this.wallDepth,o,a)):"arcDoor"==e||"arcWindow"==e&&(this.editor.currenDraw=(0,$9QhXH.DM).createArcBaseWindow(i,this.arcCenter,this.wallDepth,this.arcWindowAngle))));""!=this.editor.currenDraw&&(""!=s&&(this.editor.currenDraw.height=s),""!=l&&(this.editor.currenDraw.floorHei=l),this.editor.scene.add(this.editor.currenDraw),r.length>=3&&"free"!=e&&(this.editor.currenDraw.wallId=r[3].wallID),0!=this.param.length&&"center"==this.param[2]&&(this.editor.currenDraw.wallId=this.param[0].wallId),"UWindow"==e&&this.centerWall&&(this.editor.currenDraw.wallId=this.centerWall.wallID),this.editor.addLineHelperForDoor(this.editor.currenDraw),0!=this.param.length&&(this.editor.currentDoor=this.editor.currenDraw,"number"!=typeof this.param[0]&&(this.editor.currentDoor.isLock=this.param[0].isLock),this.editor.clickSelect.length>0&&(this.editor.clickSelect[0].object.parent=this.editor.currenDraw)),this.editor.copyDoor&&(this.editor.currenDraw.height=this.editor.copyDoor.height,this.editor.currenDraw.floorHei=this.editor.copyDoor.floorHei))}execute(){if(this.drawMain(),0==this.res.length&&""!=this.editor.currenDraw&&!this.editor.currentDoor){this.editor.scene.remove(this.editor.currenDraw);return}0==this.res.length&&""!=this.editor.currenDraw&&this.editor.currentDoor&&(this.editor.scene.remove(this.editor.currenDraw),this.editor.currentPoint=this.editor.currentDoor.center.clone(),new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor,"door").drawMain(),this.editor.currenDraw.wallId=this.editor.currentDoor.wallId,this.editor.clickSelect.length>0&&(this.editor.clickSelect[0].object.parent=this.editor.currenDraw),this.editor.currentDownSelect.length>0&&(this.editor.currentDownSelect[0].object.parent=this.editor.currenDraw),this.editor.currentDoor=this.editor.currenDraw),this.editor.doorHelperGroupClean(),this.editor.pointHelpGroup.children=[],""!=this.editor.currenDraw&&this.editor.otherMeshs.push(this.editor.currenDraw),""!=this.extendClick&&(this.editor.clickSelect[0].object.parent=this.editor.currenDraw),this.editor.currentDoor=this.editor.currenDraw,this.redrew&&new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).wallToJson(),this.editor.cleanWallHelper(),(""!=this.type||""!=this.changeWall||this.editor.currentDoor)&&this.editor.addLineHelperForDoor(this.editor.currenDraw,!0);let e=this.editor.currenDraw.modelType,t=this.param.length>0&&"noUpdate"==this.param[3];if(e&&!t){let t=this.editor.config.modelTypeJson[e],i=this.editor.currenDraw,r=this.editor.getWallByWallId(i.wallId),o=Math.abs(Math.round(i.doorWid*i.scale.x));e.includes("Door")||e.includes("door")?this.editor.list.showDialog.dispatch(2,t,[],[o,i.height,Math.round(i.wallDep),i.floorHei,r.height,{isLock:i.isLock}]):(e.includes("Window")||e.includes("window"))&&this.editor.list.showDialog.dispatch(1,t,[],[o,i.height,Math.round(i.wallDep),i.floorHei,r.height,{isLock:i.isLock}])}this.editor.currenDraw=""}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}getNearWallForArcWindowForChange(e,t){let i=[];return e=(0,$9HO6e.UtilCore).toVector2(e),this.editor.allWalls.forEach(r=>{if(r.wallID!=t)return;let o=(0,$9HO6e.UtilCore).toVector2(r.arcCenter),a=(0,$9HO6e.UtilCore).toVector2(r.startPoint),n=(0,$9HO6e.UtilCore).toVector2(r.endPoint),s=o.distanceTo(a),l=o.clone().add(e.clone().sub(o.clone()).setLength(s)),h=e.distanceTo(o)-s,c=(0,$9HO6e.UtilCore).getClockWise(a,r.cp,n),d=(0,$9HO6e.UtilCore).getClockWise(a,l,n);this.editor.config.drawDoorArea>=Math.abs(h)&&c*d>0&&(i=[l,r.startPoint,r.endPoint,r])}),i}getNearWallForArcWindow(e){let t=[];e=(0,$9HO6e.UtilCore).toVector2(e);let i="";if(this.editor.allWalls.forEach(r=>{if("circle"==r.isArc){let i=(0,$9HO6e.UtilCore).toVector2(r.arcCenter),o=(0,$9HO6e.UtilCore).toVector2(r.startPoint),a=(0,$9HO6e.UtilCore).toVector2(r.endPoint),n=i.distanceTo(o),s=i.clone().add(e.clone().sub(i.clone()).setLength(n)),l=e.distanceTo(i)-n,h=(0,$9HO6e.UtilCore).getClockWise(o,r.cp,a),c=(0,$9HO6e.UtilCore).getClockWise(o,s,a);this.editor.config.drawDoorArea>=Math.abs(l)&&h*c>0&&(t=[s,r.startPoint,r.endPoint,r])}else{let t=(0,$9HO6e.UtilCore).handleLineData(r.startPoint,r.endPoint),o=(0,$9HO6e.UtilCore).smallDistanceByPointOnLine(t,e.clone());if(!(0,$9HO6e.UtilCore).pointIsInLine(o,r.startPoint,r.endPoint))return;let a=o.clone().distanceTo(e.clone());this.editor.config.drawDoorArea>=a&&(i=r)}}),i){let e=this.editor.getScreenPosition(this.editor.currentPoint.clone());this.editor.list.blackBox.dispatch(e.x,e.y,"弧形窗只支持在弧形墙上面放置")}return t}getNearWallByPoint(e){let t=[],i="",r="";return this.editor.allWalls.forEach(o=>{let a=(0,$9HO6e.UtilCore).handleLineData(o.startPoint,o.endPoint),n=(0,$9HO6e.UtilCore).smallDistanceByPointOnLine(a,e.clone()),s=n.clone().distanceTo(e.clone());if(this.editor.config.drawDoorArea>=s){if(""!=i&&s>=i)return;let e=(0,$9HO6e.UtilCore).getNewPoint(o),a=(0,$9HO6e.UtilCore).getNewPoint(o,"end"),l=Math.round(n.clone().distanceTo(e.clone())),h=Math.round(n.clone().distanceTo(a.clone())),c=o.endPoint.clone().sub(o.startPoint.clone()),d=(0,$9HO6e.UtilCore).getMinEdge(o);if(d>=this.doorWid&&(d=this.doorWid),(0,$9HO6e.UtilCore).pointIsInLine(n,o.startPoint,o.endPoint)){r=!0;let i=30;if(l-d/2<30){t=[n=e.clone().add(c.clone().setLength(d/2)),o.startPoint,o.endPoint,o];return}if(h-d/2<i){t=[n=a.clone().add(c.clone().negate().setLength(d/2)),o.startPoint,o.endPoint,o];return}if(l<=d/2||h<=d/2){t=["notAllowMove1"];return}}else{if(r)return;if(l<=this.editor.config.drawDoorArea){t=[n=e.clone().add(c.clone().setLength(d/2)),o.startPoint,o.endPoint,o];return}if(h<=this.editor.config.drawDoorArea){t=[n=a.clone().add(c.clone().negate().setLength(d/2)),o.startPoint,o.endPoint,o];return}if(l>this.editor.config.drawDoorArea&&h>this.editor.config.drawDoorArea)return;if(l<=d/2||h<=d/2){t=["notAllowMove"];return}}0==t.length&&(t=[n,o.startPoint,o.endPoint,o]);return}}),t}getNearWallByPointForChange(e,t){let i=[];return this.editor.allWalls.forEach(r=>{if(r.wallID!=t)return;let o=(0,$9HO6e.UtilCore).handleLineData(r.startPoint,r.endPoint),a=(0,$9HO6e.UtilCore).smallDistanceByPointOnLine(o,e.clone());i=(0,$9HO6e.UtilCore).pointIsInLine(a,r.startPoint,r.endPoint)?[a,r.startPoint,r.endPoint,r]:a.clone().distanceTo(r.startPoint.clone())<a.clone().distanceTo(r.endPoint.clone())?[r.startPoint,r.startPoint,r.endPoint,r]:[r.endPoint,r.startPoint,r.endPoint,r]}),i}getNearWallByPointForLWindow(e){let t=this.editor.currentDoor.leftWindow[0].wallID;"right"==this.changeWall&&(t=this.editor.currentDoor.rightWindow[0].wallID);let i=[];return this.editor.allWalls.forEach(r=>{if(r.wallID!=t)return;let o=(0,$9HO6e.UtilCore).handleLineData(r.startPoint,r.endPoint),a=(0,$9HO6e.UtilCore).smallDistanceByPointOnLine(o,e.clone());i=(0,$9HO6e.UtilCore).pointIsInLine(a,r.startPoint,r.endPoint)?[a,r.startPoint,r.endPoint,r]:a.clone().distanceTo(r.startPoint.clone())<a.clone().distanceTo(r.endPoint.clone())?[r.startPoint,r.startPoint,r.endPoint,r]:[r.endPoint,r.startPoint,r.endPoint,r]}),i}getNearWallForLWindow(e,t){let i=[];return this.editor.allWalls.forEach(r=>{let o=r.startPoint,a=r.endPoint,n="";if((0,$9HO6e.UtilCore).toVector3(o).distanceTo(e)<=this.editor.config.drawDoorArea&&(n=o),(0,$9HO6e.UtilCore).toVector3(a).distanceTo(e)<=this.editor.config.drawDoorArea&&(n=a),""==n)return;let s=(0,$9HO6e.UtilCore).havePointWall(n,this.editor.allWalls);if(s.length!=t||1!=r.roomCenter.length)return;let l=r.roomCenter[0];(l=new $4xklQ.Vector3(l[0],l[1],0)).clone().sub(n.clone()).setLength(1e5);let h=(0,$9HO6e.UtilCore).getMeshOtherPoint(s[0],n),c=(0,$9HO6e.UtilCore).getMeshOtherPoint(s[1],n);h.clone().sub(n.clone()).setLength(100),c.clone().sub(n.clone()).setLength(100);let d=(0,$9HO6e.UtilCore).getClockWise(h,n,c);d<0&&(i=[n,s[0].startPoint,s[0].endPoint,s[0],s[1],r.roomCenter]),d>0&&(i=[n,s[1].startPoint,s[1].endPoint,s[1],s[0],r.roomCenter])}),i}getNearWallForUWindow(e){let t=[];return this.editor.allWalls.forEach(i=>{let r=(0,$9HO6e.UtilCore).handleLineData(i.startPoint,i.endPoint),o=(0,$9HO6e.UtilCore).smallDistanceByPointOnLine(r,e.clone()),a=o.clone().distanceTo(e.clone()),n=(0,$9HO6e.UtilCore).pointIsInLine(o,i.startPoint,i.endPoint);if(this.editor.config.drawDoorArea>=a&&n){let e=i.startPoint,r=i.endPoint,a=(0,$9HO6e.UtilCore).havePointWall(e,this.editor.allWalls),n=(0,$9HO6e.UtilCore).havePointWall(r,this.editor.allWalls);if(2!=a.length||2!=n.length||1!=i.roomCenter.length)return;let s="";a.forEach(e=>{e.wallID!=i.wallID&&(s=e)});let l="";n.forEach(e=>{e.wallID!=i.wallID&&(l=e)});let h=(0,$9HO6e.UtilCore).getMeshOtherPoint(s,e),c=(0,$9HO6e.UtilCore).getMeshOtherPoint(l,r),d=(0,$9HO6e.UtilCore).handleLineData(e,r),p=!1;if("X"==d[0])(h.y>d[2]&&c.y>d[2]||h.y<d[2]&&c.y<d[2])&&(p=!0);else if("Y"==d[0])(h.x>d[2]&&c.x>d[2]||h.x<d[2]&&c.x<d[2])&&(p=!0);else{let e=d[1],t=d[2];(h.y-e*h.x-t)*(c.y-e*c.x-t)>0&&(p=!0)}if(!p)return;let u=r.clone().sub(e.clone()),m=h.clone().sub(e.clone()),g=c.clone().sub(r.clone());if(!(0==u.dot(m)&&0==u.dot(g)))return;let f=i.roomCenter[0];f=new $4xklQ.Vector3(f[0],f[1],0);let w=new $4xklQ.Vector3((e.x+r.x)/2,(e.y+r.y)/2,0),y=f.clone().sub(w.clone()).setLength(1e5),b=h.clone().sub(o.clone()).setLength(100),x=c.clone().sub(o.clone()).setLength(100),P=(0,$9HO6e.UtilCore).getClockWise(b,y,x);P<0&&(t=[w,e,r,i,l,s,i.roomCenter]),P>0&&(t=[w,e,r,i,s,l,i.roomCenter])}}),t}}var $9HO6e=parcelRequire("9HO6e");class $aa3f6685526d27fa$export$d9f78ae40723f6c8{constructor(e){this.editor=e}addLineDoorHelper(e,t,i,r,o=!0,a=280){let n=new $d0f874000594cf7a$export$a955f3d6a39ce4b2().createDimensionsLineForDoor(e,t,i,a);this.editor.doorHelperGroup.add(n);let s=this.editor.getScreenPosition(n.center.clone()),l=new(0,$3BPdS.UIInput)(n.lineLength).setClass("showDoorLength"+n.uuid).setId("showDoorLength_"+r).setFontSize("15px").setWidth("40px").setMarginTop(s.y+"px").setFocus().setMarginLeft(s.x+"px").onKeyDown((function(e){if("Tab"==e.key){let t="";(t="start"==r?document.getElementById("showDoorLength_width"):"width"==r?document.getElementById("showDoorLength_end"):document.getElementById("showDoorLength_start")).focus(),t.select(),e.preventDefault()}if("13"==e.keyCode){let e=document.getElementsByClassName("showDoorLength"+n.uuid)[0].value;this.editor.list.startPlayer.dispatch(),this.editor.currenDraw&&(this.editor.currentDoor=this.editor.currenDraw),this.editor.execute(new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor,"door","end",[e,1*e-n.lineLength,r]),"改变门尺寸")}}).bind(this)),h=n.center.x+"/"+n.center.y+"/"+n.center.z;return o||l.setDisabled(!0),l.setAttribute("worldPosition",h),this.editor.uiPanelBox.add(l),n}addDoorHelper(e,t,i){let r=(0,$9HO6e.UtilCore).getNewPoint(e),o=(0,$9HO6e.UtilCore).getNewPoint(e,"end"),a=t.startPoint.clone(),n=t.endPoint.clone(),s=this.editor.getDisByScreen();this.addLineDoorHelper(a,n,t.wallDep,"width",!t.isLock,240/s);let l=(0,$9HO6e.UtilCore).pointIsInLine(a,n,r),h=this.editor.getAllWindowInWall(e),c=[];h.forEach(i=>{i.uuid!=t.uuid&&("LWindow"==i.modelType?(i.leftWindow[0].wallID==e.wallID&&c.push(i.leftWindow[5]),i.rightWindow[0].wallID==e.wallID&&c.push(i.rightWindow[5])):"UWindow"==i.modelType?(i.leftWindow[0].wallID==e.wallID&&c.push(i.leftWindow[2]),i.rightWindow[0].wallID==e.wallID&&c.push(i.rightWindow[2])):c.push(i.startPoint.clone(),i.endPoint.clone()))}),c.push(t.startPoint.clone(),t.endPoint.clone());let d=(0,$9HO6e.UtilCore).sortPoint(c,r,o);l||d.reverse();let p=[a.x,a.y],u=[n.x,n.y],m=(0,$9HO6e.UtilCore).getArrayIndex(d,p,u),g=new $4xklQ.Vector3(m[0][0],m[0][1]),f=new $4xklQ.Vector3(m[1][0],m[1][1]);if(this.addLineDoorHelper(g,a,t.wallDep,"start",!t.isLock,240/s),this.addLineDoorHelper(n,f,t.wallDep,"end",!t.isLock,240/s),i&&!t.isLock){let e=new $d0f874000594cf7a$export$a955f3d6a39ce4b2;this.editor.pointHelperGroup.add(e.createDoorPoint(a,"start")),this.editor.pointHelperGroup.add(e.createDoorPoint(n,"end"))}}addUWindowHelper(e,t,i){let r=(0,$9HO6e.UtilCore).getNewPoint(e),o=(0,$9HO6e.UtilCore).getNewPoint(e,"end");if(this.addLineDoorHelper(r,o,t.wallDep,"width",!1),t.leftWindow){let r=t.leftWindow[0],o=t.leftWindow[1],a=t.rightWindow[0],n=t.rightWindow[1],s=(0,$9HO6e.UtilCore).getSamePointTwoWall(e,r).clone(),l=(0,$9HO6e.UtilCore).getSamePointTwoWall(e,a).clone(),h=(0,$9HO6e.UtilCore).getMeshOtherPoint(r,s),c=(0,$9HO6e.UtilCore).getMeshOtherPoint(a,l);s.add(h.clone().sub(s.clone()).setLength(e.thickness/2)),l.add(c.clone().sub(l.clone()).setLength(e.thickness/2));let d=s.clone().add(h.clone().sub(s.clone()).setLength(o)),p=l.clone().add(c.clone().sub(l.clone()).setLength(n));if(this.addLineDoorHelper(d,s,t.wallDep,"left",!t.isLock),this.addLineDoorHelper(l,p,t.wallDep,"right",!t.isLock),i){let e=new $d0f874000594cf7a$export$a955f3d6a39ce4b2;this.editor.pointHelperGroup.add(e.createDoorPoint(d,"left")),this.editor.pointHelperGroup.add(e.createDoorPoint(p,"right"))}}}addLWindowHelper(e,t){if(e.leftWindow){let i=e.leftWindow[0],r=e.leftWindow[1],o=e.rightWindow[0],a=e.rightWindow[1],n=e.center.clone(),s=e.center.clone(),l=(0,$9HO6e.UtilCore).getMeshOtherPoint(i,n),h=(0,$9HO6e.UtilCore).getMeshOtherPoint(o,s);n.add(l.clone().sub(n.clone()).setLength(e.leftWindow[4])),s.add(h.clone().sub(s.clone()).setLength(e.rightWindow[4]));let c=n.clone().add(l.clone().sub(n.clone()).setLength(r)),d=s.clone().add(h.clone().sub(s.clone()).setLength(a));if(this.addLineDoorHelper(n,c,e.wallDep,"left",!e.isLock),this.addLineDoorHelper(d,s,e.wallDep,"right",!e.isLock),t){let e=new $d0f874000594cf7a$export$a955f3d6a39ce4b2;this.editor.pointHelperGroup.add(e.createDoorPoint(c,"left")),this.editor.pointHelperGroup.add(e.createDoorPoint(d,"right"))}}}addArcWindowHelper(e){let t=new $d0f874000594cf7a$export$a955f3d6a39ce4b2;this.addLineDoorHelper(e.arcCenter,e.wallStartPoint,e.wallDep,"start",!1,0),this.addLineDoorHelper(e.wallEndPoint,e.arcCenter,e.wallDep,"end",!1,0),this.addArcLineHelper(e);let i=(0,$9HO6e.UtilCore).getClockWise(e.wallStartPoint,e.center,e.wallEndPoint),r="arcStart",o="arcEnd";i<0&&(r="arcEnd",o="arcStart"),this.editor.pointHelperGroup.add(t.createDoorPoint(e.wallStartPoint,r)),this.editor.pointHelperGroup.add(t.createDoorPoint(e.wallEndPoint,o))}addArcLineHelper(e){let t=new $d0f874000594cf7a$export$a955f3d6a39ce4b2,i=e.center.clone().sub(e.arcCenter.clone()).angle(),r=i-e.angle,o=i+e.angle,a=e.arcCenter.distanceTo(e.startPoint),n=t.createCircleAngleLine(e.arcCenter,a,r,o,!1);this.editor.doorHelperGroup.add(n);let s=this.editor.getScreenPosition(n.center.clone()),l=Math.round(180/Math.PI*(2*e.angle))+"\xb0",h=new(0,$3BPdS.UIInput)(l).setClass("showDoorLength"+n.uuid).setFontSize("15px").setWidth("40px").setMarginTop(s.y+"px").setFocus().setMarginLeft(s.x+"px").onKeyDown((function(t){if("13"==t.keyCode){let t=document.getElementsByClassName("showDoorLength"+n.uuid)[0].value;t=t.replace(/°/g,""),this.editor.execute(new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor,"door","end",[1*t,e,"arcAngle"]),"改变圆弧门角度尺寸")}}).bind(this)),c=n.center.x+"/"+n.center.y+"/"+n.center.z;return h.setAttribute("worldPosition",c),this.editor.uiPanelBox.add(h),n}}class $d1f58c4378eaed8a$export$79a920aedf5098c2{constructor(e){this.editor=e}addMemberHelper(e){let t="";e.children.forEach(e=>{if("Mesh"==e.type){t=e;return}}),e.modelType&&e.modelType.indexOf("Model")>=0&&(t=e);let i=this.editor.wallHelp.addScaleTool(t),r=e.rotation.z-Math.PI/2,o=this.editor.wallHelp.addAngleTool(t,1500,r-Math.PI/8,r+Math.PI/8);return this.editor.addPositionHelper(e,!0),[i,o]}}var $g4HAh=parcelRequire("g4HAh"),$7WCxl=parcelRequire("7WCxl"),$ia4Lh=parcelRequire("ia4Lh"),$4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ");function $7105639920ca2782$export$6c88edee752dd9eb(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function $7105639920ca2782$export$2109ac0eb198e8e1(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function $7105639920ca2782$export$4502ca4ab902332b(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function $7105639920ca2782$export$12777782e1f2ebd6(e,t,i){let r=t[0],o=t[1],a=t[2],n=i[0],s=i[1],l=i[2];return e[0]=o*l-a*s,e[1]=a*n-r*l,e[2]=r*s-o*n,e}function $7105639920ca2782$export$61e064fa4319657e(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function $7105639920ca2782$export$161c7d8fe92cc5b8(e,t,i,r){return e[0]=i[0]*r+t[0],e[1]=i[1]*r+t[1],e[2]=i[2]*r+t[2],e}function $7105639920ca2782$export$e1cd8e8a2c5628e8(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function $7105639920ca2782$export$e58585affaf72c80(e,t){let i=Math.sqrt(t[0]**2+t[1]**2+t[2]**2);return 0!=i&&(i=1/i,e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i),e}function $7105639920ca2782$export$dd965c5947d39cd9(e,t,i){let r=i[0],o=i[1],a=i[2],n=i[3],s=t[0],l=t[1],h=t[2],c=o*h-a*l,d=a*s-r*h,p=r*l-o*s,u=n*c+o*p-a*d,m=n*d+a*c-r*p,g=n*p+r*d-o*c;return e[0]=s+2*u,e[1]=l+2*m,e[2]=h+2*g,e}function $7105639920ca2782$export$b5fac42edf93a2c4(e,t){return void 0===t?e[0]**2+e[1]**2+e[2]**2:(e[0]-t[0])**2+(e[1]-t[1])**2+(e[2]-t[2])**2}function $7105639920ca2782$export$248e13d25bcf0477(e,t){return void 0===t?Math.sqrt(e[0]**2+e[1]**2+e[2]**2):Math.sqrt((e[0]-t[0])**2+(e[1]-t[1])**2+(e[2]-t[2])**2)}function $7105639920ca2782$export$73f2472758f1a945(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function $7105639920ca2782$export$22396e39055416da(e,t,i,r){let o=1-r;return e[0]=t[0]*o+i[0]*r,e[1]=t[1]*o+i[1]*r,e[2]=t[2]*o+i[2]*r,e}function $7105639920ca2782$export$4965da4a2b45c55c(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function $7105639920ca2782$export$751d2f71684a1803(e,t,i){let r=t[0],o=t[1],a=t[2],n=t[3],s=i[0],l=i[1],h=i[2],c=i[3];return e[0]=r*c+n*s+o*h-a*l,e[1]=o*c+n*l+a*s-r*h,e[2]=a*c+n*h+r*l-o*s,e[3]=n*c-r*s-o*l-a*h,e}function $7105639920ca2782$export$f6df5bcafeec890a(e,t){let i=t[0]**2+t[1]**2+t[2]**2+t[3]**2;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i),e}function $7105639920ca2782$export$a37b936e06864608(e,t,i){let r=.5*i,o=Math.sin(r);return e[0]=o*t[0],e[1]=o*t[1],e[2]=o*t[2],e[3]=Math.cos(r),e}function $7105639920ca2782$export$4cd473ec64bcb9d1(e,t){return void 0===t?e[0]**2+e[1]**2+e[2]**2+e[3]**2:(e[0]-t[0])**2+(e[1]-t[1])**2+(e[2]-t[2])**2+(e[3]-t[3])**2}class $ca835aece37b4faf$export$a186db52eed6d40e{posStart=[0,0,0];posEnd=[0,0,0];direction=[0,0,0];vecLength=[0,0,0];posAt(e,t){return(t=t||[0,0,0])[0]=this.vecLength[0]*e+this.posStart[0],t[1]=this.vecLength[1]*e+this.posStart[1],t[2]=this.vecLength[2]*e+this.posStart[2],t}directionAt(e,t){return(t=t||[0,0,0])[0]=this.direction[0]*e+this.posStart[0],t[1]=this.direction[1]*e+this.posStart[1],t[2]=this.direction[2]*e+this.posStart[2],t}fromCaster(e){$7105639920ca2782$export$6c88edee752dd9eb(this.posStart,e.ray.origin.toArray()),$7105639920ca2782$export$6c88edee752dd9eb(this.direction,e.ray.direction.toArray());let t=e.far==1/0?1e3:e.far;$7105639920ca2782$export$e1cd8e8a2c5628e8(this.vecLength,this.direction,t),$7105639920ca2782$export$2109ac0eb198e8e1(this.posEnd,this.posStart,this.vecLength)}}function $ca835aece37b4faf$export$9c807428cab3165a(e,t,i){let r=i*i,o=$7105639920ca2782$export$4502ca4ab902332b([0,0,0],t,e.posStart),a=$7105639920ca2782$export$61e064fa4319657e(o,e.direction),n=$7105639920ca2782$export$b5fac42edf93a2c4(o)-a*a;return!(n>r)}function $ca835aece37b4faf$export$982e9c0e8681b1ba(e,t,i){let r=$7105639920ca2782$export$61e064fa4319657e(e.vecLength,i);if(r<=1e-6&&r>=-.000001)return null;let o=$7105639920ca2782$export$61e064fa4319657e($7105639920ca2782$export$4502ca4ab902332b([0,0,0],t,e.posStart),i)/r;return o>=0?o:null}function $ca835aece37b4faf$export$1a557053019a130b(e,t,i,r,o,a=!0){let n=$7105639920ca2782$export$4502ca4ab902332b([0,0,0],i,t),s=$7105639920ca2782$export$4502ca4ab902332b([0,0,0],r,t),l=$7105639920ca2782$export$12777782e1f2ebd6([0,0,0],e.direction,s),h=$7105639920ca2782$export$61e064fa4319657e(n,l);if(a&&h<1e-6)return!1;let c=1/h,d=$7105639920ca2782$export$4502ca4ab902332b([0,0,0],e.posStart,t),p=$7105639920ca2782$export$61e064fa4319657e(d,l)*c;if(p<0||p>1)return!1;let u=$7105639920ca2782$export$12777782e1f2ebd6([0,0,0],d,n),m=$7105639920ca2782$export$61e064fa4319657e(e.direction,u)*c;if(m<0||p+m>1)return!1;if(o){let t=$7105639920ca2782$export$61e064fa4319657e(s,u)*c;e.directionAt(t,o)}return!0}function $ca835aece37b4faf$export$fcb4e708533b5535(e,t,i=.1){let r=$7105639920ca2782$export$4502ca4ab902332b([0,0,0],t,e.posStart);$7105639920ca2782$export$73f2472758f1a945(r,r,e.vecLength);let o=(r[0]+r[1]+r[2])/$7105639920ca2782$export$b5fac42edf93a2c4(e.vecLength);if(o<0||o>1)return null;let a=$7105639920ca2782$export$b5fac42edf93a2c4(e.posAt(o,r),t);return a<=i*i?o:null}class $ca835aece37b4faf$export$54b042963a16d37f{segPosition=[0,0,0];rayPosition=[0,0,0];distanceSq=0;distance=0}function $ca835aece37b4faf$export$afc7f583ff059022(e,t,i,r=null){let o=$7105639920ca2782$export$4502ca4ab902332b([0,0,0],i,t),a=e.vecLength,n=$7105639920ca2782$export$4502ca4ab902332b([0,0,0],t,e.posStart),s=$7105639920ca2782$export$61e064fa4319657e(o,o),l=$7105639920ca2782$export$61e064fa4319657e(o,a),h=$7105639920ca2782$export$61e064fa4319657e(a,a),c=$7105639920ca2782$export$61e064fa4319657e(o,n),d=$7105639920ca2782$export$61e064fa4319657e(a,n),p=s*h-l*l,u=0,m=0;return p<1e-6?(u=0,m=l>h?c/l:d/h):(u=(l*d-h*c)/p,m=(s*d-l*c)/p),!(u<0)&&!(u>1)&&!(m<0)&&!(m>1)&&(r&&($7105639920ca2782$export$22396e39055416da(r.rayPosition,e.posStart,e.posEnd,m),$7105639920ca2782$export$22396e39055416da(r.segPosition,t,i,u),r.distance=$7105639920ca2782$export$248e13d25bcf0477(r.segPosition,r.rayPosition)),!0)}const $8aa2c62b7a798ac5$export$85791ce3793386a5=Object.freeze({Translate:0,Rotate:1,Scale:2});class $8aa2c62b7a798ac5$export$78a53f609f65f689{scaleFactor=10;minFlipAdjust=-.02;minHitDistance=.1;minPntDistance=.1;minArcDistance=.1;lastCamPos=[0,0,0];lastCamRot=[0,0,0,1];hasHit=!1;hasUpdated=!0;isDragging=!1;isActive=!1;intersectPos=[0,0,0];position=[0,0,0];scale=[1,1,1];infoScale=1;arcRadius=1;axisLen=1;midPointLen=.55;sclPointLen=1.1;useTranslate=!0;useScale=!0;useRotate=!0;axes=[{dir:[1,0,0],endPos:[1,0,0],midPos:[0,0,0],sclPos:[0,0,0]},{dir:[0,1,0],endPos:[0,1,0],midPos:[0,0,0],sclPos:[0,0,0]},{dir:[0,0,1],endPos:[0,0,1],midPos:[0,0,0],sclPos:[0,0,0]}];traceStep=.5;traceLine={isActive:!1,hitPos:[0,0,0],origin:[0,0,0],a:[0,0,0],b:[0,0,0],dir:[0,0,0]};activeMode=$8aa2c62b7a798ac5$export$85791ce3793386a5.Translate;activeAxis=-1;activePlane=-1;onDragStart=null;onDragEnd=null;onTranslate=null;onRotate=null;onScale=null;setPosition(e,t,i){return 3===e.length?(this.position[0]=e[0],this.position[1]=e[1],this.position[2]=e[2]):(this.position[0]=e,this.position[1]=t,this.position[2]=i),this.hasUpdated=!0,this}updateFromCamera(e,t,i=!1){return(this.isDragging||1e-6>=Math.abs($7105639920ca2782$export$b5fac42edf93a2c4(e,this.lastCamPos))&&1e-6>=Math.abs($7105639920ca2782$export$4cd473ec64bcb9d1(t,this.lastCamRot)))&&!i||($7105639920ca2782$export$6c88edee752dd9eb(this.lastCamPos,e),$7105639920ca2782$export$4965da4a2b45c55c(this.lastCamRot,t),this._calcCameraScale()),this}resetState(){this.traceLine.isActive=!1,this.activeMode=$8aa2c62b7a798ac5$export$85791ce3793386a5.Translate,this.activeAxis=-1,this.activePlane=-1}startDrag(){this.isDragging=!0,this.onDragStart&&this.onDragStart()}stopDrag(){this.isDragging=!1,this.onDragEnd&&this.onDragEnd()}_movePlane(e,t){let i=this.axes[t].dir,r=$ca835aece37b4faf$export$982e9c0e8681b1ba(e,this.position,i);return null!=r&&(e.posAt(r,this.position),this.calcAxesPosition(),this.onTranslate&&this.onTranslate(this.position.slice(0)),!0)}_moveTrace(e){let t=new $ca835aece37b4faf$export$54b042963a16d37f;if($ca835aece37b4faf$export$afc7f583ff059022(e,this.traceLine.a,this.traceLine.b,t)){switch($7105639920ca2782$export$6c88edee752dd9eb(this.traceLine.hitPos,t.segPosition),this.activeMode){case $8aa2c62b7a798ac5$export$85791ce3793386a5.Translate:$7105639920ca2782$export$6c88edee752dd9eb(this.position,t.segPosition),this.calcAxesPosition(),this.onTranslate&&this.onTranslate(t.segPosition.slice(0));break;case $8aa2c62b7a798ac5$export$85791ce3793386a5.Rotate:case $8aa2c62b7a798ac5$export$85791ce3793386a5.Scale:let e=$7105639920ca2782$export$4502ca4ab902332b([0,0,0],t.segPosition,this.traceLine.origin),i=$7105639920ca2782$export$248e13d25bcf0477(e),r=Math.sign($7105639920ca2782$export$61e064fa4319657e(e,this.traceLine.dir)),o=i/this.traceStep*r;this.onRotate&&this.activeMode===$8aa2c62b7a798ac5$export$85791ce3793386a5.Rotate&&this.onRotate(o,this.activeAxis),this.onScale&&this.activeMode===$8aa2c62b7a798ac5$export$85791ce3793386a5.Scale&&this.onScale(o,this.activeAxis>=0?this.activeAxis:null)}return!0}return!1}onRayDown(e){return!!(this.isActive&&this._rayIntersect(e))&&(this.startDrag(),!0)}onRayHover(e){return!!this.isActive&&!this.isDragging&&this._rayIntersect(e)}onRayMove(e){if(this.isActive&&!this.isDragging)return!1;if(-1!=this.activeAxis)this._moveTrace(e);else if(-1!=this.activePlane)return this._movePlane(e,this.activePlane);return!1}_setTraceLine(e,t=-1){this.traceLine.isActive=!0,$7105639920ca2782$export$6c88edee752dd9eb(this.traceLine.origin,e),$7105639920ca2782$export$6c88edee752dd9eb(this.traceLine.hitPos,e),-1==t?$7105639920ca2782$export$dd965c5947d39cd9(this.traceLine.dir,[1,0,0],this.lastCamRot):$7105639920ca2782$export$6c88edee752dd9eb(this.traceLine.dir,this.axes[t].dir),$7105639920ca2782$export$161c7d8fe92cc5b8(this.traceLine.a,e,this.traceLine.dir,-1e3),$7105639920ca2782$export$161c7d8fe92cc5b8(this.traceLine.b,e,this.traceLine.dir,1e3)}_calcCameraScale(){let e=$7105639920ca2782$export$4502ca4ab902332b([0,0,0],this.lastCamPos,this.position),t=$7105639920ca2782$export$248e13d25bcf0477(e);this.infoScale=t/this.scaleFactor,$7105639920ca2782$export$e58585affaf72c80(e,e),$7105639920ca2782$export$e1cd8e8a2c5628e8(this.scale,[1,1,1],this.infoScale),$7105639920ca2782$export$61e064fa4319657e(e,[1,0,0])<this.minFlipAdjust&&(this.scale[0]=-this.scale[0]),$7105639920ca2782$export$61e064fa4319657e(e,[0,1,0])<this.minFlipAdjust&&(this.scale[1]=-this.scale[1]),$7105639920ca2782$export$61e064fa4319657e(e,[0,0,1])<this.minFlipAdjust&&(this.scale[2]=-this.scale[2]),this.calcAxesPosition()}calcAxesPosition(){let e=this.axes;for(let t=0;t<3;t++)$7105639920ca2782$export$161c7d8fe92cc5b8(e[t].endPos,this.position,e[t].dir,this.scale[t]*this.axisLen),$7105639920ca2782$export$161c7d8fe92cc5b8(e[t].midPos,this.position,e[t].dir,this.scale[t]*this.midPointLen),$7105639920ca2782$export$161c7d8fe92cc5b8(e[t].sclPos,this.position,e[t].dir,this.scale[t]*this.sclPointLen);this.hasUpdated=!0}_rayIntersect(e){if(!this._testSphere(e))return!1;let t=this.activeAxis;this.resetState();let i=this.useScale&&this._testPoints(e);return i=(i=i||this.useTranslate&&this._testAxis(e))||this.useRotate&&this._testArc(e),t!==this.activeAxis&&(this.hasUpdated=!0),this.hasHit=i,i}_testSphere(e){return $ca835aece37b4faf$export$9c807428cab3165a(e,this.position,(this.sclPointLen+this.minPntDistance)*this.infoScale)}_testPlanes(e){let t,i;let r=this.axes;for(t=0;t<3;t++)if(i=(t+1)%3,$ca835aece37b4faf$export$1a557053019a130b(e,r[t].midPos,r[i].midPos,this.position,this.intersectPos,!1))return this.activePlane=(t+2)%3,!0;return!1}_testArc(e){let t,i,r,o;let a=this.infoScale*this.minArcDistance,n=this.axes,s=[0,0,0],l=[0,0,0],h=[0,0,0],c=this.arcRadius*this.infoScale;for(i=0;i<3;i++)if(null!==(t=$ca835aece37b4faf$export$982e9c0e8681b1ba(e,this.position,n[i].dir))&&(e.posAt(t,s),Math.abs($7105639920ca2782$export$248e13d25bcf0477(this.position,s)-c)<=a&&(r=(i+1)%3,$7105639920ca2782$export$4502ca4ab902332b(l,s,this.position),$7105639920ca2782$export$e1cd8e8a2c5628e8(h,n[r].dir,Math.sign(this.scale[r])),$7105639920ca2782$export$61e064fa4319657e(l,h)>=0&&($7105639920ca2782$export$e1cd8e8a2c5628e8(h,n[o=(i+2)%3].dir,Math.sign(this.scale[o])),$7105639920ca2782$export$61e064fa4319657e(l,h)>=0))))return this.activeAxis=i,this.activeMode=$8aa2c62b7a798ac5$export$85791ce3793386a5.Rotate,this._setTraceLine(s),$7105639920ca2782$export$6c88edee752dd9eb(this.intersectPos,s),!0;return!1}_testAxis(e){let t;let i=this.infoScale*this.minHitDistance,r=new $ca835aece37b4faf$export$54b042963a16d37f,o=[0,0,0],a=1/0,n=-1;for(let s=0;s<3;s++)t=this.axes[s],$ca835aece37b4faf$export$afc7f583ff059022(e,this.position,t.endPos,r)&&r.distance<=i&&r.distance<a&&(a=r.distance,n=s,$7105639920ca2782$export$6c88edee752dd9eb(o,r.segPosition));return -1!==n&&(this.activeAxis=n,this._setTraceLine(o,n),$7105639920ca2782$export$6c88edee752dd9eb(this.intersectPos,o),!0)}_testPoints(e){let t=this.infoScale*this.minPntDistance,i=$ca835aece37b4faf$export$fcb4e708533b5535(e,this.position,t);if(null!==i)return this._setTraceLine(this.position),this.activeMode=$8aa2c62b7a798ac5$export$85791ce3793386a5.Scale,this.activeAxis=-2,!0;for(let r=0;r<3;r++)if(null!==(i=$ca835aece37b4faf$export$fcb4e708533b5535(e,this.axes[r].sclPos,t)))return this._setTraceLine(this.axes[r].sclPos,r),this.activeAxis=r,this.activeMode=$8aa2c62b7a798ac5$export$85791ce3793386a5.Scale,$7105639920ca2782$export$6c88edee752dd9eb(this.intersectPos,this.axes[r].sclPos),!0;return!1}}var $4xklQ=parcelRequire("4xklQ");class $ec81fbac4de7de11$export$49da1b7bd1faada1 extends $4xklQ.Group{axisColors=[16216426,7186922,8509299];axisLines=[];axisArcs=[];axisPoints=[];axisTris=[];grpCtrl=new $4xklQ.Group;meshTracePnt=null;meshTraceLine=null;colSelect=16777215;colOrigin=16776960;constructor(e){super();let t=.5*Math.PI,i=.03,r=e.arcRadius,o=.03,a=e.sclPointLen;this.visible=!1;let n=new $4xklQ.MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0,side:$4xklQ.DoubleSide,opacity:1,color:16777215}),s=new $4xklQ.LineBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0,color:9474192}),l=new $4xklQ.BufferGeometry;l.setAttribute("position",new $4xklQ.Float32BufferAttribute([0,0,0,0,100,0],3));let h=new $4xklQ.BufferGeometry;h.setAttribute("position",new $4xklQ.Float32BufferAttribute([0,0,0,e.midPointLen,0,0,0,e.midPointLen,0],3));let c=new $4xklQ.SphereGeometry(.1,8,8),d=new $4xklQ.TorusGeometry(r,o,3,10,t),p=new $4xklQ.CylinderGeometry(i,i,e.axisLen,3);p.translate(0,.5*e.axisLen,0);let u=new $4xklQ.Mesh(p,n.clone());this.grpCtrl.add(u);let m=new $4xklQ.Mesh(p,n.clone());m.rotation.x=t,this.grpCtrl.add(m);let g=new $4xklQ.Mesh(p,n.clone());g.rotation.z=-t,this.grpCtrl.add(g),this.axisLines.push(g,u,m);let f=new $4xklQ.Mesh(d,n.clone());f.name="ZAXIS",this.grpCtrl.add(f);let w=new $4xklQ.Mesh(d,n.clone());w.name="XAXIS",w.rotation.y=-t,this.grpCtrl.add(w);let y=new $4xklQ.Mesh(d,n.clone());y.rotation.x=t,this.grpCtrl.add(y),this.axisArcs.push(w,y,f);let b=new $4xklQ.Mesh(c,n.clone());b.position.z=a,this.grpCtrl.add(b);let x=new $4xklQ.Mesh(c,n.clone());x.position.x=a,this.grpCtrl.add(x);let P=new $4xklQ.Mesh(c,n.clone());P.position.y=a,this.grpCtrl.add(P),this.axisPoints.push(x,P,b);let v=new $4xklQ.Mesh(h,n.clone()),M=new $4xklQ.Mesh(h,n.clone());M.rotation.x=t;let C=new $4xklQ.Mesh(h,n.clone());C.rotation.y=-t,this.axisTris.push(C,M,v),this.meshTraceLine=new $4xklQ.Line(l,s),this.meshTraceLine.visible=!1,this.meshTraceLine.layers.set(2),this.add(this.meshTraceLine),this.meshTracePnt=new $4xklQ.Mesh(c,n.clone()),this.meshTracePnt.visible=!1,this.meshTraceLine.layers.set(2),this.add(this.meshTracePnt),this.origin=new $4xklQ.Mesh(c,n.clone()),this.grpCtrl.add(this.origin),this.grpCtrl.traverse(function(e){e.layers.set(2)}),this.add(this.grpCtrl)}showGizmo(){this.grpCtrl.visible=!0}hideGizmo(){this.grpCtrl.visible=!1}updateLook(e){let t;for(t of this.axisArcs)t.visible=e.useRotate;for(t of(this.origin.visible=e.useScale,this.axisPoints))t.visible=e.useScale;for(t of this.axisTris)t.visible=e.useTranslate}update(e){if(e.hasUpdated||e.hasHit){this.grpCtrl.scale.fromArray(e.scale),this.grpCtrl.position.fromArray(e.position),-2===e.activeAxis&&e.activeMode===$8aa2c62b7a798ac5$export$85791ce3793386a5.Scale?this.origin.material.color.setHex(this.colSelect):this.origin.material.color.setHex(this.colOrigin);for(let t=0;t<3;t++){if(this.axisLines[t].material.color.setHex(this.axisColors[t]),this.axisArcs[t].material.color.setHex(this.axisColors[t]),this.axisPoints[t].material.color.setHex(this.axisColors[t]),this.axisTris[t].material.color.setHex(this.axisColors[t]),t===e.activeAxis)switch(e.activeMode){case $8aa2c62b7a798ac5$export$85791ce3793386a5.Translate:this.axisLines[t].material.color.setHex(this.colSelect);break;case $8aa2c62b7a798ac5$export$85791ce3793386a5.Rotate:this.axisArcs[t].material.color.setHex(this.colSelect);break;case $8aa2c62b7a798ac5$export$85791ce3793386a5.Scale:this.axisPoints[t].material.color.setHex(this.colSelect)}t===e.activePlane&&this.axisTris[t].material.color.setHex(16777215)}if(e.traceLine.isActive){let t=Math.abs(e.scale[2]);this.meshTracePnt.visible=!0,this.meshTracePnt.scale.set(t,t,t),this.meshTracePnt.position.fromArray(e.traceLine.origin),this.meshTraceLine.visible=!0,this.meshTraceLine.geometry.attributes.position.needsUpdate=!0;let i=this.meshTraceLine.geometry.attributes.position.array;i[0]=e.traceLine.a[0],i[1]=e.traceLine.a[1],i[2]=e.traceLine.a[2],i[3]=e.traceLine.b[0],i[4]=e.traceLine.b[1],i[5]=e.traceLine.b[2]}else this.meshTraceLine.visible=!1,this.meshTracePnt.visible=!1}}}class $07cd6c79b5fb98d9$export$a4d73611b6b02716{mesh=null;data=null;attachedObject=null;_camera=null;_renderer=null;_caster=new $4xklQ.Raycaster;_ray=new $ca835aece37b4faf$export$a186db52eed6d40e;_scaleStep=.1;_rotateStep=10*Math.PI/180;_intersectOffset=[0,0,0];_initDragPosition=[0,0,0];_initDragQuaternion=[0,0,0,1];_initDragScale=[0,0,0];_3jsVec=new $4xklQ.Vector3;_3jsQuat=new $4xklQ.Quaternion;constructor(e,t,i,r=null,o=!1){this.data=new $8aa2c62b7a798ac5$export$78a53f609f65f689,this._camera=t,this.editor=i,o||(this.mesh=new $ec81fbac4de7de11$export$49da1b7bd1faada1(this.data),this.mesh.layers.set(2),this.mesh.name="modelAxisHelper",this.editor.modelHelperGroup.add(this.mesh)),this.clickEventHandler=this.clickEvent.bind(this),this.pointerMoveHandler=this.pointermove.bind(this),this.pointerDownHandler=this.pointerdown.bind(this),this.pointerUpHandler=this.pointerup.bind(this),this.dragstartHandler=this.dragstart.bind(this),this.dragendHandler=this.dragend.bind(this),this.boxColor=this.editor.config.boxColor,this.data.onDragStart=()=>this._onDragStart(),this.data.onDragEnd=()=>this._onDragEnd(),this.data.onTranslate=e=>this._onTranslate(e),this.data.onRotate=(e,t)=>this._onRotate(e,t),this.data.onScale=(e,t)=>this._onScale(e,t),this.stopClick=!1,r&&this.setRenderer(r),this.update(!0)}clickEvent(e){this.stopClick&&(e.stopImmediatePropagation(),this.stopClick=!1)}pointermove(e){if(!this.editor.camera.isOrthographicCamera){if(this.update(),this._updateRaycaster(e),this.data.isDragging){if(this.data.onRayMove(this._ray),this.editor.dom.setPointerCapture(e.pointerId),e.preventDefault(),e.stopPropagation(),2==this.data.activeMode){let e=this.attachedObject,t=e.modelPosition;e.updateMatrixWorld(!0,!0);let i=this.editor.getRealSize(e);e.updateMatrixWorld(!0,!0);let r=new(0,$4xklQ.Vector3)().setFromMatrixScale(e.matrixWorld).clone().divide(e.scale),o=(i[1]-e.oldFloor)/2/r.y;"top"==t?e.position.y-=o:e.position.y+=o,this.attachedObject.oldFloor=i[1]}if(this.editor.synchroModel(this.attachedObject),this.editor.clickDepthMsg.uuid){this.editor.modelDotGroup.children=[];let e=this.editor.getOuterParent(this.attachedObject,this.attachedObject,"outer");this.editor.addDashBoxForGroup(e),this.editor.addDashBoxFor2dGroup(e.param[0])}this.editor.modelHelperGroup.children.slice(0).forEach(e=>{"modelBox"==e.name&&this.editor.modelHelperGroup.remove(e)}),this.editor.addBoxForGroup(this.attachedObject),this.editor.doorHelperGroupClean(),this.editor.addLineHelperForMember(this.attachedObject.param[0]),this.editor.updateModelProto(this.attachedObject)}else this.data.onRayHover(this._ray)}}pointerdown(e){if(this.editor.downPoint=this.editor.getWorldPosition(e),this._updateRaycaster(e),this.data.onRayDown(this._ray)){this.startPoint=[e.offsetX,e.offsetY],this.startJson=this.editor.getSceneAllJson(),e.preventDefault(),e.stopPropagation(),this.stopClick=!0,this.attachedObject.updateMatrixWorld(!0,!0);let t=this.editor.getRealSize(this.attachedObject);this.attachedObject.oldFloor=t[1]}}pointerup(e){if(this.editor.currentPoint=this.editor.getWorldPosition(e),this.data.isDragging){if("CodeModel"==this.attachedObject.modelType&&this.attachedObject.parent){let e=this.editor.getWallByMesh(this.attachedObject);this.editor.partRefreshWall(e,this.attachedObject)}e.offsetX==this.startPoint[0]&&e.offsetY==this.startPoint[1]||this.editor.execute("","",this.startJson),this.data.stopDrag(),this.editor.dom.releasePointerCapture(e.pointerId)}this.attachedObject.oldFloor&&delete this.attachedObject.oldFloor}dragstart(e){""!=this.editor.globalControl&&(this.editor.globalControl.enabled=!1)}dragend(e){""!=this.editor.globalControl&&(this.editor.globalControl.enabled=!0)}setRenderer(e){let t=this.editor.dom;if(this._renderer=e,this.editor.transform3DTool){let e=this.editor.transform3DTool;t.removeEventListener("pointermove",e.pointerMoveHandler),t.removeEventListener("pointerdown",e.pointerDownHandler),t.removeEventListener("pointerup",e.pointerUpHandler),t.removeEventListener("dragstart",e.dragstartHandler),t.removeEventListener("dragend",e.dragendHandler)}this.editor.camera.isOrthographicCamera||(t.addEventListener("click",this.clickEventHandler),t.addEventListener("pointermove",this.pointerMoveHandler),t.addEventListener("pointerdown",this.pointerDownHandler),t.addEventListener("pointerup",this.pointerUpHandler),t.addEventListener("dragstart",this.dragstartHandler),t.addEventListener("dragend",this.dragendHandler))}rayHover(e){return this.update(),this._ray.fromCaster(e),this.data.onRayHover(this._ray)}rayMove(e){return this.update(),this._ray.fromCaster(e),this.data.onRayMove(this._ray)}rayDown(e){return this._ray.fromCaster(e),this.data.onRayDown(this._ray)}rayUp(){this.data.isDragging&&this.data.stopDrag()}isDragging(){return this.data.isDragging}isActive(){return this.data.isActive}setActive(e){return this.data.isActive=e,this.mesh&&(this.mesh.visible=e),e&&this.updateStateFromCamera(),this}useTranslate(e){return this.data.useTranslate=e,this.mesh.updateLook(this.data),this}useRotate(e){return this.data.useRotate=e,this.mesh.updateLook(this.data),this}useScale(e){return this.data.useScale=e,this.mesh.updateLook(this.data),this}setTraceLineStepDistance(e){return this.data.traceStep=e,this}setScaleStep(e){return this._scaleStep=e,this}setRotationStep(e){return this._rotateStep=e*Math.PI/180,this}setScaleFactor(e){return this.data.scaleFactor=e,this}attach(e){if(!this.data.isActive)return;this.attachedObject=e;var t=new $4xklQ.Vector3;e.getWorldPosition(t),this.data.setPosition(t.toArray()),this.data.calcAxesPosition(),this.update(!0);let i=this.editor.wallHelp.addOBBbox(e,this.boxColor);i.name="modelBox",i.layers.set(2),this.editor.modelHelperGroup.add(i)}switchRot(e){return this.mesh.axisArcs.forEach(t=>{""!=t.name&&(t.visible=e)}),this}switchMove(e){return this.mesh.axisLines.forEach(t=>{t.visible=e}),this}detach(){this.attachedObject=null}update(e=!1){return(!!this.data.isActive||!!e)&&(this.updateStateFromCamera(e),(!!this.data.hasUpdated||!!this.data.hasHit)&&!!this.mesh&&(this.mesh.update(this.data),this.data.hasUpdated=!1,this.data.hasHit=!1,!0))}updateStateFromCamera(e=!1){this._camera.getWorldPosition(this._3jsVec),this._camera.getWorldQuaternion(this._3jsQuat),this.data.updateFromCamera(this._3jsVec.toArray(),this._3jsQuat.toArray(),e)}isDragging(){return this.data.isDragging}_screenToNDCCoord(e){let t=this.editor.dom,i=t.getBoundingClientRect(),r=e.clientX-i.x,o=e.clientY-i.y;return{x:r/i.width*2-1,y:-(2*(o/i.height))+1}}_updateRaycaster(e){this._caster.setFromCamera(this._screenToNDCCoord(e),this._camera),this._ray.fromCaster(this._caster)}_onDragStart(){$7105639920ca2782$export$6c88edee752dd9eb(this._initDragPosition,this.attachedObject.position.toArray()),$7105639920ca2782$export$6c88edee752dd9eb(this._initDragScale,this.attachedObject.scale.toArray()),$7105639920ca2782$export$4965da4a2b45c55c(this._initDragQuaternion,this.attachedObject.quaternion.toArray()),$7105639920ca2782$export$4502ca4ab902332b(this._intersectOffset,this.data.position,this.data.intersectPos),this.data.activeMode,$8aa2c62b7a798ac5$export$85791ce3793386a5.Translate,this.data.hasUpdated=!0,this._emit("dragstart")}_onDragEnd(){this.data.calcAxesPosition(),this.data.resetState(),this.mesh.showGizmo();let e=this.editor.getOuterParent(this.attachedObject,this.attachedObject,"outer");if(this.editor.refreshRealSizeByBox(e,this.attachedObject),this.editor.updateModelPosition(this.attachedObject.parent,e),this.editor.clickDepthMsg.uuid){this.editor.modelDotGroup.children=[];let e=this.editor.getOuterParent(this.attachedObject,this.attachedObject,"outer");this.editor.addDashBoxForGroup(e),this.editor.addDashBoxFor2dGroup(e.param[0])}this._emit("dragend")}_onTranslate(e){let t=$7105639920ca2782$export$2109ac0eb198e8e1([0,0,0],e,this._intersectOffset);if(this.data.setPosition(t),this.attachedObject.parent){if("Scene"!=this.attachedObject.parent.type){this.attachedObject.parent.updateWorldMatrix(!0,!1);let e=new $4xklQ.Vector3(t[0],t[1],t[2]),i=this.attachedObject.parent.worldToLocal(e);t=[i.x,i.y,i.z]}this.attachedObject.position.fromArray(t),this._emit("translate",t)}}_onRotate(e,t){if(!this.mesh.axisArcs[0].visible&&1!=t)return;let i=1===t?1:-Math.sign(this.data.scale[t]);2==t&&(e*=-1);let r=Math.round(180/Math.PI*e);r>0&&(r-=360*parseInt(r/360)),r<0&&(r+=360*Math.abs(parseInt(r/360))),r<0&&(r+=360);let o=8;r>=-8&&r<=o&&(r=0),r>=37&&r<=45+o&&(r=45),r>=82&&r<=90+o&&(r=90),r>=127&&r<=135+o&&(r=135),r>=172&&r<=180+o&&(r=180),r>=217&&r<=225+o&&(r=225),r>=262&&r<=270+o&&(r=270),r>=307&&r<=315+o&&(r=315),r>=352&&r<=360+o&&(r=360),e=Math.PI/180*r;let a=$7105639920ca2782$export$a37b936e06864608([0,0,0,1],this.data.axes[t].dir,this._rotateStep*e*i);$7105639920ca2782$export$751d2f71684a1803(a,a,this._initDragQuaternion),$7105639920ca2782$export$f6df5bcafeec890a(a,a),0==t&&(this.attachedObject.rotation.x=e),1==t&&(this.attachedObject.rotation.y=e),2==t&&(this.attachedObject.rotation.z=e),this._emit("rotate",a)}_onScale(e,t){let i=this._initDragScale.slice(0),r=e*this._scaleStep;null===t?(i[0]+=r,i[1]+=r,i[2]+=r):i[t]+=r*Math.sign(this.data.scale[t]),this.attachedObject.scale.fromArray(i),this._emit("scale",i)}on(e,t){this.editor.dom.addEventListener(e,t)}_emit(e,t=null){this.editor.dom.dispatchEvent(new CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0,composed:!1}))}}class $102b3df9ca2da060$export$aead3d23b4737909{constructor(e){this.editor=e,this.boxColor=this.editor.config.boxColor}selectObj(e){if(this.editor.modelHelperGroup.children=[],this.editor.doorHelperGroupClean(),e.length>1){let t=!1;e.forEach(e=>{let i=this.editor.getOuterParent(e),r=this.editor.wallHelp.addOBBbox(i,this.editor.config.boxColor);r.name="modelBox",r.layers.set(2),this.editor.modelHelperGroup.add(r),t=i.isLock,this.editor.addBoxFor2dGroup(i.param[0])});let i=this.editor.get3DModelDialogPosition(this.editor.getOuterParent(e[e.length-1]));this.editor.list.modelGroup3D.dispatch(9,"3D多选模型",i,[{isLock:t}])}else{let t=e[0],i=this.editor.getOuterParent(t);if(""==i&&"Mesh"!=t.type||"3DWall"==t.modelType||"3dwall"==i.parent.name||"Line2"==i.type)return;let r=this.editor.get3DModelDialogPosition(i),o=this.editor.getRealSize(i),a=Math.round(1e3*o[0].toFixed(3)),n=Math.round(1e3*o[1].toFixed(3)),s=Math.round(1e3*o[2].toFixed(3)),l=1e3*Math.round(i.width).toFixed(3),h=1e3*Math.round(i.height).toFixed(3),c=1e3*Math.round(i.depth).toFixed(3),d=new $4xklQ.Vector3(0,i.position.y,0);i.parent.localToWorld(d);let p=Math.round(1e3*(d.y-o[1]/2).toFixed(3)),u=0;if("top"==i.modelPosition){let e=window.storeyHei;this.editor.wallGroup3D.roomHeight,(u=Math.round(1e3*(e/1e3-i.height).toFixed(3)))<10&&(u=0)}p<10&&(p=0);let m=360-Math.abs(parseInt(180/Math.PI*i.rotation.x)),g=parseInt(180/Math.PI*i.rotation.y),f=360-Math.abs(parseInt(180/Math.PI*i.rotation.z));360==m&&(m=0),360==g&&(g=0),360==f&&(f=0);let w={isLock:i.isLock,width:a,height:n,depth:s,oldWidth:l,oldHeight:h,oldDepth:c,floorHei:p,rotation:[m,f,g],oldFloorHei:u};"modelGroup"==i.modelType?(i.children.slice(0).forEach(e=>{let t=this.editor.wallHelp.addOBBbox(e,this.editor.config.boxColor);t.name="modelBox",t.layers.set(2),this.editor.modelHelperGroup.add(t);let i=this.editor.wallHelp.addOBB2DBox(t,this.editor.config.boxColor);this.editor.modelHelperGroup.add(i)}),this.editor.camera.isOrthographicCamera?this.editor.list.showDialog.dispatch(14,"组合模型",r,[w]):this.editor.list.showDialog.dispatch(10,"组合模型",r,[w])):this.editor.camera.isOrthographicCamera?this.editor.list.showDialog.dispatch(8,"单品模型",r,[w]):this.editor.list.showDialog.dispatch(11,"单品模型",r,[w]),this.main(i)}}main(e){if(e.isLock){let t=this.editor.wallHelp.addOBBbox(e,this.editor.config.boxColor);if(t.name="modelBox",t.layers.set(2),this.editor.modelHelperGroup.add(t),this.editor.transform3DTool&&"ThreeDimensionMoveHelper"!=this.editor.transform3DTool.name){let e=this.editor.transform3DTool;this.editor.dom.removeEventListener("pointermove",e.pointerMoveHandler),this.editor.dom.removeEventListener("pointerdown",e.pointerDownHandler),this.editor.dom.removeEventListener("pointerup",e.pointerUpHandler),this.editor.dom.removeEventListener("dragstart",e.dragstartHandler),this.editor.dom.removeEventListener("dragend",e.dragendHandler),this.editor.transform3DTool.detach()}this.editor.addPositionHelper(e.param[0],!0),this.editor.addBoxFor2dGroup(e.param[0]);return}this.editor.addLineHelperForMember(e.param[0]),this.editor.camera.isOrthographicCamera?this.editor.transform3DTool=new $07cd6c79b5fb98d9$export$a4d73611b6b02716(this.editor.scene,this.editor.miniMapCamera,this.editor,this.editor.newRenderer):this.editor.transform3DTool=new $07cd6c79b5fb98d9$export$a4d73611b6b02716(this.editor.scene,this.editor.camera,this.editor,this.editor.renderer),this.editor.transform3DTool.setActive(!0),this.editor.transform3DTool.attach(e),this.editor.transform3DTool.useRotate(!0).useScale(!1).useTranslate(!0)}}var $4xklQ=parcelRequire("4xklQ");parcelRequire("5XTH3");var $hrM0U=parcelRequire("hrM0U"),$3BPdS=parcelRequire("3BPdS"),$5sV3G=parcelRequire("5sV3G"),$9HO6e=parcelRequire("9HO6e");class $f708759ef0d3ebee$export$cbb426a6cd1f3789{constructor(e,t=""){this.name="ThreeDimensionMoveHelper",this.editor=e,this.camera=e.camera,this.dom=e.dom,this._caster=new $4xklQ.Raycaster,this._caster.layers.mask=6,this.ray=new $4xklQ.Ray,this.mouse=new $4xklQ.Vector2,this.selected=void 0,this.isDragging=!1,this.hiddenLabel=!1,this.currentObj=t,this.labelTextArr=[],this.pointerMoveHandler=this.pointermove.bind(this),this.pointerDownHandler=this.pointerdown.bind(this),this.pointerUpHandler=this.pointerup.bind(this),this.addEventListener(),this.digHole=new $5sV3G.DigHole(e),this.tmpBox=new $4xklQ.Mesh(new $4xklQ.BoxGeometry(1,1,1),new $4xklQ.MeshBasicMaterial({color:16711680}))}addEventListener(){let e=this.editor.dom;e.addEventListener("pointermove",this.pointerMoveHandler),e.addEventListener("pointerdown",this.pointerDownHandler),e.addEventListener("pointerup",this.pointerUpHandler)}removeEventListener(){let e=this.editor.dom;e.removeEventListener("pointermove",this.pointerMoveHandler),e.removeEventListener("pointerdown",this.pointerDownHandler),e.removeEventListener("pointerup",this.pointerUpHandler),this.removeBox()}selectObj(e){this.editor.modelHelperGroup.children=[],this.editor.clickSelect[0].object=e;let t=this.editor.getOuterParent(e);if(""!=this.currentObj&&(t=this.currentObj),""==t&&"Mesh"!=e.type||"3DWall"==e.modelType||"ArcBaseWindowMesh"==t.type)return;this.selected=t,this.addBox(t),this.editor.doorHelperGroupClean();let i=this.editor.getWallByMesh(this.selected),r;this.editor.wallGroup3D.children.forEach(e=>{e.wallID==i.wallID&&(r=e)});let o=r.endPoint.clone().sub(r.startPoint).angle(),a=this.selected.parameter.tdm;this.editor.addLineHelperForDoor(a,!0);let n="archDoor"==a.modelType||"archWindow"==a.modelType,s=this.digHole.createBooleanMesh(a.doorWid,a.height,a.wallDep+2,n,o);s.position.add(new $4xklQ.Vector3(a.center.x,a.center.y,a.height/2+a.floorHei)),s.updateMatrix(),this.selectedBM=s,this._lastWall=t.parameter.tdm.wallId,this._currentWallHole=this.getHoleByWallID(this._lastWall),this._currentWall=r,""!=this.currentObj&&(this.isDragging=!0,this._lastWall=this.selected.parameter.tdm.wallId),this._lastPosition=t.position.clone(),this._lastRotation=t.rotation.z,this.editor.wallGroup3D.children.forEach(e=>{if(e.wallID==t.parameter.tdm.wallId){this._lastRotation=this.getRotation(e);return}}),this.originPosition=this.selected.position.clone()}pointermove(e){if(this.mouse.x=e.clientX/window.innerWidth*2-1,this.mouse.y=-(2*(e.clientY/window.innerHeight))+1,this.hiddenLabel&&this.removeLabel(),this.isDragging){if(this.selected.isLock){let e=this.editor.getScreenPosition(this.editor.currentPoint.clone());this.editor.list.blackBox.dispatch(e.x,e.y,"该模型已锁定,请先解锁");return}if(this.removeBox(),this.syncPosition1(),"CodeModel"==this.selected.modelType&&this.selected.parent){let e,t=this.editor.getWallByMesh(this.selected);this.editor.wallGroup3D.children.forEach(i=>{i.wallID==t.wallID&&(e=i)});let i=this._currentWallHole?this.digHole.boolean(this.selectedBM,this._currentWallHole,"union"):this.digHole.boolean(this.selectedBM,this.tmpBox,"union");this.partRefresh(e,i)}this.dragstart(),this.editor.dom.setPointerCapture(e.pointerId),e.preventDefault(),e.stopPropagation()}}syncPosition1(){let e=this.getObject(!0),t=this.getPosition(),i,r=0,o;t?"3DWall"==(o=t[0].object).modelType?(r=this.getRotation(o),i=this.getProjectPoint(o,t[0].point.clone())):i=new $4xklQ.Vector2(1e3*e.point.x,-(1e3*e.point.z)):e?i=new $4xklQ.Vector2(1e3*e.point.x,-(1e3*e.point.z)):(i=this._lastPosition,r=this._lastRotation),this.selected.position.x=i.x,this.selected.position.y=i.y,this.selected.rotation.y=r,this._lastPosition=this.selected.position.clone(),this._lastRotation=this.selected.rotation.y,this.selectedBM.position.x=i.x,this.selectedBM.position.y=i.y,this.selectedBM.rotation.z=r,this.editor.modelHelperGroup.remove(this.selected.parameter.box),this.disposeGeom(this.selected.parameter.box),this.addBox(this.selected),this.syncPosition2(o)}syncPosition2(e){let t=this.selected.parameter.tdm;if(t.position.x=this.selected.position.x,t.position.y=this.selected.position.y,t.center.x=this.selected.position.x,t.center.y=this.selected.position.y,t.updateWorldMatrix(!0,!1),t.startPoint=t.localToWorld(new $4xklQ.Vector3(-t.doorWid/2,0,0)),t.endPoint=t.localToWorld(new $4xklQ.Vector3(t.doorWid/2,0,0)),e){let i=this.getRotation(e);if(t.rotation.z=i,t.wallId!=e.wallID){let i;this.editor.wallGroup3D.children.forEach(e=>{e.wallID==t.wallId&&(i=e)}),this.partRefresh(i,this._currentWallHole),t.wallId=e.wallID,this._lastWall=e.wallID,this._lastPosition=this.selected.position.clone(),this._lastRotation=this.selected.rotation.y,this._currentWallHole=this.getHoleByWallID(t.wallId)}}else t.wallId=this._lastWall}partRefresh(e,t){if(void 0==t){e.geometry.dispose(),e.geometry=e.origin3DWall.geometry,e.material=e.origin3DWall.material,e.updateMatrix();return}let i=this.digHole.boolean(e.origin3DWall,t);e.geometry.dispose(),e.geometry=i.geometry,e.material=i.material,e.updateMatrix()}pointerdown(e){""==this.currentObj&&(this.editor.downEvent=e,e.preventDefault(),e.stopPropagation(),this.mouse.x=e.clientX/window.innerWidth*2-1,this.mouse.y=-(2*(e.clientY/window.innerHeight))+1,this.hiddenLabel=!0,this.getObject()==this.selected&&(this.isDragging=!0,this._lastWall=this.selected.parameter.tdm.wallId,this.editor.execute()))}pointerup(e){this.editor.blackbox&&this.editor.blackbox.removeDom(),this.editor.blackbox="",this.mouse.x=e.clientX/window.innerWidth*2-1,this.mouse.y=-(2*(e.clientY/window.innerHeight))+1,this.selected&&this.editor.modelHelperGroup.remove(this.selected.parameter.box),this.isDragging=!1,this.hiddenLabel=!1,this.dragend()}getObject(e=!1){this._caster.setFromCamera(this.mouse,this.camera);let t=this.editor.pointHelperGroup.children.concat(this.editor.otherMeshs);t=(t=t.concat(this.editor.wallGroup3D.children)).concat(this.editor.floor),e&&t.splice(t.indexOf(this.selected),1);let i=this._caster.intersectObjects(t,!0);if(i.length>0)return e?i[0]:this.editor.getOuterParent(i[0].object)}getPosition(){this._caster.setFromCamera(this.mouse,this.camera),this.intersects=Array.from(this.editor.wallGroup3D.children);let e=this.createTmpBox(this.intersects);this.editor.scene.add(e),this.intersects.push(e),this.intersects=[e];let t=this._caster.intersectObjects(this.intersects,!1);if(this.editor.scene.remove(e),e.geometry.dispose(),e.material.dispose(),t.length>0)return t;let i=this._caster.intersectObjects(this.editor.wallGroup3D.children,!1);if(i.length>0)return i}dragstart(e){""!=this.editor.globalControl&&(this.editor.globalControl.enabled=!1)}dragend(e){""!=this.editor.globalControl&&(this.editor.globalControl.enabled=!0),this.removeBox()}addBox(e){let t=new $4xklQ.Group;e.children.forEach(e=>{t.add(e.clone())}),t.applyMatrix4(new $4xklQ.Matrix4().makeScale(.001,.001,.001)),t.position.set(e.position.x/1e3,e.position.z/1e3,-e.position.y/1e3);let i=new $4xklQ.Box3().setFromObject(t);this.disposeGeom(t);let r=this.editor.wallHelp.addOBBbox(e,1735416);if(r.name="modelBox",r.layers.set(2),"UWindowMesh"==e.type&&(r.position.y+=(i.max.y-i.min.y)/2),"LWindowMesh"==e.type){let e=new $4xklQ.Vector3;i.getCenter(e),r.position.copy(e.clone())}this.editor.modelHelperGroup.add(r),r.material.depthTest=!1,e.parameter.box=r;let o=this.editor.get3DWallByMesh(e);o&&this.addMarkLabel(o)}disposeGeom(e){if(e.isMesh&&e.geometry.dispose(),e.isGroup||e.isObject3D)for(;e.children.length>0;){let t=e.children.shift();"Group"==t.type?this.disposeGeom(t):t.isObject3D&&t.children.length>0?this.disposeGeom(t):t.geometry.dispose()}}removeBox(){this.editor.modelHelperGroup.children.slice(0).forEach(e=>{"modelBox"==e.name&&this.editor.modelHelperGroup.remove(e),"label"==e.name&&this.editor.modelHelperGroup.remove(e)}),this.labelTextArr.forEach(e=>{e.dom.remove()})}getBox(){let e=this.editor.modelHelperGroup.children.slice(0);for(let t=0;t<e.length;t++)if("modelBox"==e[t].name)return e[t]}addMarkLabel(e){let t=this.getBox();t.geometry.computeBoundingBox();let i=t.geometry.boundingBox,r=new $4xklQ.Vector3(i.min.x,0,0).applyEuler(t.rotation).add(t.position),o=new $4xklQ.Vector3(i.max.x,0,0).applyEuler(t.rotation).add(t.position);this.rayCasterFunc(r,r.clone().sub(o),e,"leftInput"),this.rayCasterFunc(o,o.clone().sub(r),e,"rightInput");let a=new $4xklQ.Vector3(0,i.max.y,0).applyEuler(t.rotation).add(t.position),n=new $4xklQ.Vector3(0,i.min.y,0).applyEuler(t.rotation).add(t.position);this.rayCasterFunc(a,a.clone().sub(n),e,"frontInput"),this.rayCasterFunc(n,n.clone().sub(a),e,"backInput")}removeLabel(){this.editor.modelHelperGroup.children.slice(0).forEach(e=>{"label"==e.name&&this.editor.modelHelperGroup.remove(e)}),this.labelTextArr.forEach(e=>{e.dom.remove()})}rayCasterFunc(e,t,i,r){this.ray.set(e,t.normalize());let o=Array.from(i.geometry.attributes.position.array),a=new $4xklQ.Vector3,n=new $4xklQ.Vector2(1e3*i.startPoint.x,1e3*i.startPoint.y),s=new $4xklQ.Vector2(1e3*i.endPoint.x,1e3*i.endPoint.y),l=n.distanceTo(s),h=s.clone().sub(n).angle();for(let n=0;n<o.length/9;n++){let s=i.localToWorld(new $4xklQ.Vector3(o[9*n],o[9*n+1],o[9*n+2])),c=i.localToWorld(new $4xklQ.Vector3(o[9*n+3],o[9*n+4],o[9*n+5])),d=i.localToWorld(new $4xklQ.Vector3(o[9*n+6],o[9*n+7],o[9*n+8]));if(this.ray.intersectTriangle(s,c,d,!1,a),!a.equals(new $4xklQ.Vector3)){let o=(0,$hrM0U.CommonFunc).createThreeDimensionLabel(e,a);o.layers.set(2),this.editor.modelHelperGroup.add(o);let n=this.editor.getScreenPosition(new $4xklQ.Vector3(o.center.x,o.center.y,o.center.z)),s=new(0,$3BPdS.UIInput)(Math.round(1e3*o.labelLength)).setClass("showDistance").setId(r).setFontSize("15px").setWidth("40px").setStyle(["transform"],["rotate("+h+"deg)"]).setMarginTop(n.y+"px").setMarginLeft(n.x+"px").onKeyDown((function(e){if("Tab"==e.key&&(e.preventDefault(),document.getElementsById(r)[0].focus()),"13"==e.keyCode){this.editor.execute();let e=document.getElementById(r).value,a=e-Math.round(1e3*o.labelLength);if("frontInput"==r&&(t=new $4xklQ.Vector3(0,0,1),a=-a),"backInput"==r&&(t=new $4xklQ.Vector3(0,0,-1)),e>l)return;"frontInput"==r||"backInput"==r?this.selected.parameter.tdm.floorHei+=a:this.selected.position.add(t.clone().negate().setLength(a)),this.addBox(this.selected),this.addMarkLabel(i),this.syncPosition2(i);let n=this.editor.getWallByMesh(this.selected);this.editor.wallGroup3D.remove(this.selected),this.editor.partRefreshWall(n),this.removeBox();let s="";this.editor.wallGroup3D.children.forEach(e=>{"CodeModel"==e.modelType&&(0,$9HO6e.UtilCore).isSameVector(e.position,this.selected.position)&&(s=e)}),this.editor.clickSelect[0].object=s,this.editor.add3DDoorDialog(s),this.editor.doorHelperGroupClean()}}).bind(this));s.setAttribute("worldPosition",o.center.x+"/"+o.center.y+"/"+o.center.z),this.labelTextArr.push(s),this.editor.uiPanelBox.add(s);return}}}getHoleByWallID(e){let t,i=[],r;this.editor.wallGroup3D.children.forEach(t=>{-1==["LWindowMesh","UWindowMesh"].indexOf(t.type)&&"ArcBaseWindowMesh"!=t.type&&("CodeModel"==t.modelType&&t.parameter.tdm.wallId==e&&i.push(t),"3DWall"==t.modelType&&t.wallID==e&&(r=t))}),(0,$hrM0U.CommonFunc).removeItemFromArr(i,this.selected);let o=r.endPoint.clone().sub(r.startPoint).angle(),a=[];for(let e=0;e<i.length;e++){let t=i[e].parameter.tdm,r="archDoor"==t.modelType||"archWindow"==t.modelType,n=this.digHole.createBooleanMesh(t.doorWid,t.height,t.wallDep+2,r,o);n.position.add(new $4xklQ.Vector3(t.center.x,t.center.y,t.height/2+t.floorHei)),n.updateMatrix(),a.push(n)}if(a.length>0){t=a[0];for(let e=1;e<a.length;e++)t=this.digHole.boolean(t,a[e],"union")}return t}getRotation(e){let t=new $4xklQ.Vector2(1e3*e.startPoint.x,1e3*e.startPoint.y);return new $4xklQ.Vector2(1e3*e.endPoint.x,1e3*e.endPoint.y).sub(t).angle()}getProjectPoint(e,t){let i;let r=new $4xklQ.Vector2(1e3*e.startPoint.x,1e3*e.startPoint.y),o=new $4xklQ.Vector2(1e3*e.endPoint.x,1e3*e.endPoint.y);if(t.x=Math.round(1e5*t.x)/100,t.y=-Math.round(1e5*t.z)/100,e.arcCenter){let t=e.arcCenter.distanceTo(o);i=(0,$hrM0U.CommonFunc).getCircleEquation(e.arcCenter,t)}else i=(0,$hrM0U.CommonFunc).getLineEquation(r,o);return(0,$hrM0U.CommonFunc).getProjectPoint(i,t)}createTmpBox(e){let t;this.editor.wallGroup3D.children.forEach(i=>{if(i.wallID==this.selected.parameter.tdm.wallId){t=i,(0,$hrM0U.CommonFunc).removeItemFromArr(e,i);return}});let i=new $4xklQ.Mesh(t.origin3DWall.geometry,new $4xklQ.MeshBasicMaterial({color:65280}));i.layers.mask=t.layers.mask,i.rotation.x=-Math.PI/2,i.position.set(t.position.x,t.position.z,-t.position.y),i.startPoint=t.startPoint.clone(),i.endPoint=t.endPoint.clone(),i.wallID=t.wallID,t.isArc&&(i.arcCenter=t.arcCenter),i.modelType="3DWall";let r=new $4xklQ.Matrix4().makeScale(.001,.001,.001);return i.applyMatrix4(r),i.updateMatrixWorld(),i}}var $71ecd547b7457eca$exports={},$71ecd547b7457eca$var$process=$71ecd547b7457eca$exports={};function $71ecd547b7457eca$var$defaultSetTimout(){throw Error("setTimeout has not been defined")}function $71ecd547b7457eca$var$defaultClearTimeout(){throw Error("clearTimeout has not been defined")}function $71ecd547b7457eca$var$runTimeout(e){if($71ecd547b7457eca$var$cachedSetTimeout===setTimeout)return setTimeout(e,0);if(($71ecd547b7457eca$var$cachedSetTimeout===$71ecd547b7457eca$var$defaultSetTimout||!$71ecd547b7457eca$var$cachedSetTimeout)&&setTimeout)return $71ecd547b7457eca$var$cachedSetTimeout=setTimeout,setTimeout(e,0);try{return $71ecd547b7457eca$var$cachedSetTimeout(e,0)}catch(t){try{return $71ecd547b7457eca$var$cachedSetTimeout.call(null,e,0)}catch(t){return $71ecd547b7457eca$var$cachedSetTimeout.call(this,e,0)}}}function $71ecd547b7457eca$var$runClearTimeout(e){if($71ecd547b7457eca$var$cachedClearTimeout===clearTimeout)return clearTimeout(e);if(($71ecd547b7457eca$var$cachedClearTimeout===$71ecd547b7457eca$var$defaultClearTimeout||!$71ecd547b7457eca$var$cachedClearTimeout)&&clearTimeout)return $71ecd547b7457eca$var$cachedClearTimeout=clearTimeout,clearTimeout(e);try{return $71ecd547b7457eca$var$cachedClearTimeout(e)}catch(t){try{return $71ecd547b7457eca$var$cachedClearTimeout.call(null,e)}catch(t){return $71ecd547b7457eca$var$cachedClearTimeout.call(this,e)}}}!function(){try{$71ecd547b7457eca$var$cachedSetTimeout="function"==typeof setTimeout?setTimeout:$71ecd547b7457eca$var$defaultSetTimout}catch(e){$71ecd547b7457eca$var$cachedSetTimeout=$71ecd547b7457eca$var$defaultSetTimout}try{$71ecd547b7457eca$var$cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:$71ecd547b7457eca$var$defaultClearTimeout}catch(e){$71ecd547b7457eca$var$cachedClearTimeout=$71ecd547b7457eca$var$defaultClearTimeout}}();var $71ecd547b7457eca$var$queue=[],$71ecd547b7457eca$var$draining=!1,$71ecd547b7457eca$var$queueIndex=-1;function $71ecd547b7457eca$var$cleanUpNextTick(){$71ecd547b7457eca$var$draining&&$71ecd547b7457eca$var$currentQueue&&($71ecd547b7457eca$var$draining=!1,$71ecd547b7457eca$var$currentQueue.length?$71ecd547b7457eca$var$queue=$71ecd547b7457eca$var$currentQueue.concat($71ecd547b7457eca$var$queue):$71ecd547b7457eca$var$queueIndex=-1,$71ecd547b7457eca$var$queue.length&&$71ecd547b7457eca$var$drainQueue())}function $71ecd547b7457eca$var$drainQueue(){if(!$71ecd547b7457eca$var$draining){var e=$71ecd547b7457eca$var$runTimeout($71ecd547b7457eca$var$cleanUpNextTick);$71ecd547b7457eca$var$draining=!0;for(var t=$71ecd547b7457eca$var$queue.length;t;){for($71ecd547b7457eca$var$currentQueue=$71ecd547b7457eca$var$queue,$71ecd547b7457eca$var$queue=[];++$71ecd547b7457eca$var$queueIndex<t;)$71ecd547b7457eca$var$currentQueue&&$71ecd547b7457eca$var$currentQueue[$71ecd547b7457eca$var$queueIndex].run();$71ecd547b7457eca$var$queueIndex=-1,t=$71ecd547b7457eca$var$queue.length}$71ecd547b7457eca$var$currentQueue=null,$71ecd547b7457eca$var$draining=!1,$71ecd547b7457eca$var$runClearTimeout(e)}}function $71ecd547b7457eca$var$Item(e,t){this.fun=e,this.array=t}function $71ecd547b7457eca$var$noop(){}$71ecd547b7457eca$var$process.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];$71ecd547b7457eca$var$queue.push(new $71ecd547b7457eca$var$Item(e,t)),1!==$71ecd547b7457eca$var$queue.length||$71ecd547b7457eca$var$draining||$71ecd547b7457eca$var$runTimeout($71ecd547b7457eca$var$drainQueue)},$71ecd547b7457eca$var$Item.prototype.run=function(){this.fun.apply(null,this.array)},$71ecd547b7457eca$var$process.title="browser",$71ecd547b7457eca$var$process.browser=!0,$71ecd547b7457eca$var$process.env={},$71ecd547b7457eca$var$process.argv=[],$71ecd547b7457eca$var$process.version="",$71ecd547b7457eca$var$process.versions={},$71ecd547b7457eca$var$process.on=$71ecd547b7457eca$var$noop,$71ecd547b7457eca$var$process.addListener=$71ecd547b7457eca$var$noop,$71ecd547b7457eca$var$process.once=$71ecd547b7457eca$var$noop,$71ecd547b7457eca$var$process.off=$71ecd547b7457eca$var$noop,$71ecd547b7457eca$var$process.removeListener=$71ecd547b7457eca$var$noop,$71ecd547b7457eca$var$process.removeAllListeners=$71ecd547b7457eca$var$noop,$71ecd547b7457eca$var$process.emit=$71ecd547b7457eca$var$noop,$71ecd547b7457eca$var$process.prependListener=$71ecd547b7457eca$var$noop,$71ecd547b7457eca$var$process.prependOnceListener=$71ecd547b7457eca$var$noop,$71ecd547b7457eca$var$process.listeners=function(e){return[]},$71ecd547b7457eca$var$process.binding=function(e){throw Error("process.binding is not supported")},$71ecd547b7457eca$var$process.cwd=function(){return"/"},$71ecd547b7457eca$var$process.chdir=function(e){throw Error("process.chdir is not supported")},$71ecd547b7457eca$var$process.umask=function(){return 0};var $0a029741d8f7787c$export$cea96571ebbff9dd={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.sin((1-e)*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return .5*(1-Math.sin(Math.PI*(.5-e)))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((e-.1)*5*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin((e-1.1)*5*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return 1===e?1:e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return 0===e?0:--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?.5*(e*e*((t+1)*e-t)):.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-$0a029741d8f7787c$export$cea96571ebbff9dd.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*$0a029741d8f7787c$export$cea96571ebbff9dd.Bounce.In(2*e):.5*$0a029741d8f7787c$export$cea96571ebbff9dd.Bounce.Out(2*e-1)+.5}},generatePow:function(e){return void 0===e&&(e=4),e=(e=e<Number.EPSILON?Number.EPSILON:e)>1e4?1e4:e,{In:function(t){return Math.pow(t,e)},Out:function(t){return 1-Math.pow(1-t,e)},InOut:function(t){return t<.5?Math.pow(2*t,e)/2:(1-Math.pow(2-2*t,e))/2+.5}}}};$0a029741d8f7787c$var$now="undefined"==typeof self&&void 0!==$71ecd547b7457eca$exports&&$71ecd547b7457eca$exports.hrtime?function(){var e=$71ecd547b7457eca$exports.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return new Date().getTime()};var $0a029741d8f7787c$export$461939dd4422153=$0a029741d8f7787c$var$now,$0a029741d8f7787c$export$eb2fcfdbd7ba97d4=function(){function e(){this._tweens={},this._tweensAddedDuringUpdate={}}return e.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},e.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},e.prototype.update=function(e,t){void 0===e&&(e=$0a029741d8f7787c$export$461939dd4422153()),void 0===t&&(t=!1);var i=Object.keys(this._tweens);if(0===i.length)return!1;for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<i.length;r++){var o=this._tweens[i[r]],a=!t;o&&!1===o.update(e,a)&&!t&&delete this._tweens[i[r]]}i=Object.keys(this._tweensAddedDuringUpdate)}return!0},e}(),$0a029741d8f7787c$export$b0cc4f9860136880={Linear:function(e,t){var i=e.length-1,r=i*t,o=Math.floor(r),a=$0a029741d8f7787c$export$b0cc4f9860136880.Utils.Linear;return t<0?a(e[0],e[1],r):t>1?a(e[i],e[i-1],i-r):a(e[o],e[o+1>i?i:o+1],r-o)},Bezier:function(e,t){for(var i=0,r=e.length-1,o=Math.pow,a=$0a029741d8f7787c$export$b0cc4f9860136880.Utils.Bernstein,n=0;n<=r;n++)i+=o(1-t,r-n)*o(t,n)*e[n]*a(r,n);return i},CatmullRom:function(e,t){var i=e.length-1,r=i*t,o=Math.floor(r),a=$0a029741d8f7787c$export$b0cc4f9860136880.Utils.CatmullRom;return e[0]===e[i]?(t<0&&(o=Math.floor(r=i*(1+t))),a(e[(o-1+i)%i],e[o],e[(o+1)%i],e[(o+2)%i],r-o)):t<0?e[0]-(a(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[i]-(a(e[i],e[i],e[i-1],e[i-1],r-i)-e[i]):a(e[o?o-1:0],e[o],e[i<o+1?i:o+1],e[i<o+2?i:o+2],r-o)},Utils:{Linear:function(e,t,i){return(t-e)*i+e},Bernstein:function(e,t){var i=$0a029741d8f7787c$export$b0cc4f9860136880.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:function(){var e=[1];return function(t){var i=1;if(e[t])return e[t];for(var r=t;r>1;r--)i*=r;return e[t]=i,i}}(),CatmullRom:function(e,t,i,r,o){var a=(i-e)*.5,n=(r-t)*.5,s=o*o;return(2*t-2*i+a+n)*(o*s)+(-3*t+3*i-2*a-n)*s+a*o+t}}},$0a029741d8f7787c$export$edde1bcb1b2b310e=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),$0a029741d8f7787c$var$mainGroup=new $0a029741d8f7787c$export$eb2fcfdbd7ba97d4,$0a029741d8f7787c$export$208a41d6b4e37b97=function(){function e(e,t){void 0===t&&(t=$0a029741d8f7787c$var$mainGroup),this._object=e,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=$0a029741d8f7787c$export$cea96571ebbff9dd.Linear.None,this._interpolationFunction=$0a029741d8f7787c$export$b0cc4f9860136880.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=$0a029741d8f7787c$export$edde1bcb1b2b310e.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.to=function(e,t){return this._valuesEnd=Object.create(e),void 0!==t&&(this._duration=t),this},e.prototype.duration=function(e){return void 0===e&&(e=1e3),this._duration=e,this},e.prototype.start=function(e){if(void 0===e&&(e=$0a029741d8f7787c$export$461939dd4422153()),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var t in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(t),this._valuesStart[t]=this._valuesStartRepeat[t];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},e.prototype._setupProperties=function(e,t,i,r){for(var o in i){var a=e[o],n=Array.isArray(a),s=n?"array":typeof a,l=!n&&Array.isArray(i[o]);if("undefined"!==s&&"function"!==s){if(l){var h=i[o];if(0===h.length)continue;h=h.map(this._handleRelativeValue.bind(this,a)),i[o]=[a].concat(h)}if(("object"===s||n)&&a&&!l){for(var c in t[o]=n?[]:{},a)t[o][c]=a[c];r[o]=n?[]:{},this._setupProperties(a,t[o],i[o],r[o])}else void 0===t[o]&&(t[o]=a),n||(t[o]*=1),l?r[o]=i[o].slice().reverse():r[o]=t[o]||0}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying&&(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object)),this},e.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},e.prototype.pause=function(e){return void 0===e&&(e=$0a029741d8f7787c$export$461939dd4422153()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this)),this},e.prototype.resume=function(e){return void 0===e&&(e=$0a029741d8f7787c$export$461939dd4422153()),this._isPaused&&this._isPlaying&&(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this)),this},e.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},e.prototype.group=function(e){return void 0===e&&(e=$0a029741d8f7787c$var$mainGroup),this._group=e,this},e.prototype.delay=function(e){return void 0===e&&(e=0),this._delayTime=e,this},e.prototype.repeat=function(e){return void 0===e&&(e=0),this._initialRepeat=e,this._repeat=e,this},e.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},e.prototype.yoyo=function(e){return void 0===e&&(e=!1),this._yoyo=e,this},e.prototype.easing=function(e){return void 0===e&&(e=$0a029741d8f7787c$export$cea96571ebbff9dd.Linear.None),this._easingFunction=e,this},e.prototype.interpolation=function(e){return void 0===e&&(e=$0a029741d8f7787c$export$b0cc4f9860136880.Linear),this._interpolationFunction=e,this},e.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},e.prototype.onStart=function(e){return this._onStartCallback=e,this},e.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},e.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},e.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},e.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},e.prototype.onStop=function(e){return this._onStopCallback=e,this},e.prototype.update=function(e,t){if(void 0===e&&(e=$0a029741d8f7787c$export$461939dd4422153()),void 0===t&&(t=!0),this._isPaused)return!0;var i,r,o=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>o)return!1;t&&this.start(e)}if(this._goToEnd=!1,e<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),!1===this._onEveryStartCallbackFired&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0),r=(e-this._startTime)/this._duration,r=0===this._duration||r>1?1:r;var a=this._easingFunction(r);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,a),this._onUpdateCallback&&this._onUpdateCallback(this._object,r),1===r){if(this._repeat>0){for(i in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[i]||(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo&&this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i];this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var n=0,s=this._chainedTweens.length;n<s;n++)this._chainedTweens[n].start(this._startTime+this._duration);return this._isPlaying=!1,!1}}return!0},e.prototype._updateProperties=function(e,t,i,r){for(var o in i)if(void 0!==t[o]){var a=t[o]||0,n=i[o],s=Array.isArray(e[o]),l=Array.isArray(n),h=!s&&l;h?e[o]=this._interpolationFunction(n,r):"object"==typeof n&&n?this._updateProperties(e[o],a,n,r):"number"==typeof(n=this._handleRelativeValue(a,n))&&(e[o]=a+(n-a)*r)}},e.prototype._handleRelativeValue=function(e,t){return"string"!=typeof t?t:"+"===t.charAt(0)||"-"===t.charAt(0)?e+parseFloat(t):parseFloat(t)},e.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],i=this._valuesEnd[e];"string"==typeof i?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(i):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},e}();$0a029741d8f7787c$export$edde1bcb1b2b310e.nextId;var $0a029741d8f7787c$var$TWEEN=$0a029741d8f7787c$var$mainGroup;$0a029741d8f7787c$var$TWEEN.getAll.bind($0a029741d8f7787c$var$TWEEN),$0a029741d8f7787c$var$TWEEN.removeAll.bind($0a029741d8f7787c$var$TWEEN),$0a029741d8f7787c$var$TWEEN.add.bind($0a029741d8f7787c$var$TWEEN),$0a029741d8f7787c$var$TWEEN.remove.bind($0a029741d8f7787c$var$TWEEN);var $0a029741d8f7787c$export$722fbec263ad908a=$0a029741d8f7787c$var$TWEEN.update.bind($0a029741d8f7787c$var$TWEEN),$hrM0U=parcelRequire("hrM0U"),$2C75G=parcelRequire("2C75G"),$4xklQ=parcelRequire("4xklQ");class $7312f6e931728810$export$8c08921df1bef753{parse(e){let t="",i=0,r=0,o=0,a=new $4xklQ.Vector3,n=new $4xklQ.Color,s=new $4xklQ.Vector3,l=new $4xklQ.Vector2,h=[];function c(e){let n=0,c=0,d=0,p=e.geometry,u=new $4xklQ.Matrix3,m=p.getAttribute("position"),g=p.getAttribute("normal"),f=p.getAttribute("uv"),w=p.getIndex();if(t+="o "+e.name+"\n",e.material&&e.material.name&&(t+="usemtl "+e.material.name+"\n"),void 0!==m)for(let i=0,r=m.count;i<r;i++,n++)a.fromBufferAttribute(m,i),a.applyMatrix4(e.matrixWorld),t+="v "+a.x+" "+a.y+" "+a.z+"\n";if(void 0!==f)for(let e=0,i=f.count;e<i;e++,d++)l.fromBufferAttribute(f,e),t+="vt "+l.x+" "+l.y+"\n";if(void 0!==g){u.getNormalMatrix(e.matrixWorld);for(let e=0,i=g.count;e<i;e++,c++)s.fromBufferAttribute(g,e),s.applyMatrix3(u).normalize(),t+="vn "+s.x+" "+s.y+" "+s.z+"\n"}if(null!==w)for(let e=0,a=w.count;e<a;e+=3){for(let t=0;t<3;t++){let a=w.getX(e+t)+1;h[t]=i+a+(g||f?"/"+(f?r+a:"")+(g?"/"+(o+a):""):"")}t+="f "+h.join(" ")+"\n"}else for(let e=0,a=m.count;e<a;e+=3){for(let t=0;t<3;t++){let a=e+t+1;h[t]=i+a+(g||f?"/"+(f?r+a:"")+(g?"/"+(o+a):""):"")}t+="f "+h.join(" ")+"\n"}i+=n,r+=d,o+=c}function d(e){let r=0,o=e.geometry,n=e.type,s=o.getAttribute("position");if(t+="o "+e.name+"\n",void 0!==s)for(let i=0,o=s.count;i<o;i++,r++)a.fromBufferAttribute(s,i),a.applyMatrix4(e.matrixWorld),t+="v "+a.x+" "+a.y+" "+a.z+"\n";if("Line"===n){t+="l ";for(let e=1,r=s.count;e<=r;e++)t+=i+e+" ";t+="\n"}if("LineSegments"===n)for(let e=1,r=e+1,o=s.count;e<o;e+=2,r=e+1)t+="l "+(i+e)+" "+(i+r)+"\n";i+=r}function p(e){let r=0,o=e.geometry,s=o.getAttribute("position"),l=o.getAttribute("color");if(t+="o "+e.name+"\n",void 0!==s){for(let i=0,o=s.count;i<o;i++,r++)a.fromBufferAttribute(s,i),a.applyMatrix4(e.matrixWorld),t+="v "+a.x+" "+a.y+" "+a.z,void 0!==l&&(n.fromBufferAttribute(l,i).convertLinearToSRGB(),t+=" "+n.r+" "+n.g+" "+n.b),t+="\n";t+="p ";for(let e=1,r=s.count;e<=r;e++)t+=i+e+" ";t+="\n"}i+=r}return e.traverse(function(e){!0===e.isMesh&&c(e),!0===e.isLine&&d(e),!0===e.isPoints&&p(e)}),t}}var $47Y2g=parcelRequire("47Y2g"),$kLdsz=parcelRequire("kLdsz");class $d7301d69748e22e3$export$dea64c44705995a5{updateModelProto(e){let t=this.getRealSize(e),i=1e3*t[0].toFixed(3),r=1e3*t[1].toFixed(3),o=1e3*t[2].toFixed(3),a=1e3*e.width.toFixed(3),n=1e3*e.height.toFixed(3),s=1e3*e.depth.toFixed(3),l=new $4xklQ.Vector3(0,e.position.y,0);e.parent.localToWorld(l);let h=1e3*(l.y-t[1]/2).toFixed(3),c=0;if("top"==e.modelPosition){let t=window.storeyHei;this.wallGroup3D.roomHeight,(c=1e3*(t/1e3-e.height).toFixed(3))<10&&(c=0)}h<10&&(h=0);let d=360-Math.abs(parseInt(180/Math.PI*e.rotation.x)),p=parseInt(180/Math.PI*e.rotation.y),u=360-Math.abs(parseInt(180/Math.PI*e.rotation.z));p<0&&(p+=360),360==d&&(d=0),360==p&&(p=0),360==u&&(u=0);let m={isLock:e.isLock,width:i,height:r,depth:o,oldWidth:a,oldHeight:n,oldDepth:s,floorHei:h,rotation:[d,u,p],oldFloorHei:c};"2dModelGroup"==e.modelType?this.list.showDialog.dispatch(14,"组合模型",[],[m]):("{}"!=JSON.stringify(this.clickDepthMsg)&&(m.isGroupChild=!0),this.list.showDialog.dispatch(8,"单品模型",[],[m]))}checkModelIsInGroupModel(e){return!!e.parent&&"3dModel"!=e.name&&"2dModel"!=e.name&&!!this.clickDepthMsg.uuid&&(e.parent.uuid==this.clickDepthMsg.uuid||this.checkModelIsInGroupModel(e.parent))}createFileChunk(e,t=2097152){let i=[],r=0;for(;r<e.size;)i.push({file:e.slice(r,r+t)}),r+=t;return i}async handleUpload(e,t){let i=this.createFileChunk(e);console.log("切片数量"+i.length),this.list.alert.dispatch("正在同步模型到云端,请稍等"),this.list.uploadModelBar.dispatch();let r=i.map((t,i)=>({chunk:t,hash:e.name+"**"+i}));await this.uploadChunks(r,t,i.length)}async uploadChunks(e,t,i){let r=0,o=this;e.map((e,a)=>{setTimeout(()=>{let a=new FormData,n=new Date,s=n.getFullYear()+""+(n.getMonth()+1)+n.getDate()+Math.round(1e4*Math.random()+1)+".json";var l=new File([e.chunk.file],s,{type:"application/json"}),h=new FileReader;h.onload=()=>{let e=JSON.stringify({fileName:s,value:h.result}),t=new File([e],s,{type:"application/json"});a.append("file",t);let n=new XMLHttpRequest;n.open("POST",this.config.remoteCacheUrl,!0),n.onreadystatechange=()=>{if(4===n.readyState&&200===n.status){let e=parseInt(100*(++r/i).toFixed(2));o.list.changeBar.dispatch(e),r==i&&(o.list.alert.dispatch("模型云端同步完成"),o.list.closeBar.dispatch()),console.log("上传成功")}},n.send(a)},h.readAsDataURL(l);let c=e.hash.split("**");t.sliceArr?t.sliceArr.push(s+"**"+c[1]):t.sliceArr=[s+"**"+c[1]]},100)})}mergeFile(e,t){let i=Array(e.length),r=0,o=this;e.map(a=>{setTimeout(()=>{r++;let n=a.split("**"),s=new XMLHttpRequest;s.open("GET",o.config.remoteUrl+n[0],!1),s.onreadystatechange=()=>{if(4===s.readyState&&200===s.status){for(var a=JSON.parse(s.responseText).value.split(","),l=a[0].match(/:(.*?);/)[1],h=atob(a[1]),c=h.length,d=new Uint8Array(c);c--;)d[c]=h.charCodeAt(c);var p=new Blob([d],{type:l});i[1*n[1]]=p;let m=parseInt(100*(r/e.length).toFixed(2));if(o.list.progressChange.dispatch(m),r==e.length){let e=new Blob(i,{type:"application/octet-stream"});var u=new File([e],"aa.glb",{type:"application/octet-stream"});o.list.uploadFile.dispatch("",u,t),o.list.alert.dispatch("云端模型加载完成"),console.log("合并完成")}}},s.send(),r==e.length&&o.list.progressClose.dispatch()},100)});let a=new Blob(i,{type:"application/octet-stream"});return new File([a],"aa.glb",{type:"application/octet-stream"})}saveJsonToSever(e,t,i=!1){let r=JSON.stringify(e),o=new File([r],t,{type:"application/json"}),a=new XMLHttpRequest;a.open("POST",this.config.remoteCacheUrl,!0),a.onreadystatechange=()=>{4===a.readyState&&200===a.status&&i&&(this.currentCacheJson=e.sceneJson,this.list.alert.dispatch("方案保存成功"))};let n=new FormData;n.append("file",o),a.send(n)}delCommonPoint(e){let t=(0,$9HO6e.UtilCore).havePointWall(e,this.allWalls);if(2!=t.length||!(0,$9HO6e.UtilCore).wallIsInLine(t[0],t[1])){this.list.alert.dispatch("只允许删除共线墙的公共端点","error");return}this.pointHelperGroup.children.slice(0).forEach(e=>{("clickPoint"==e.useType||"moveOuterPoint"==e.useType)&&e.parent.remove(e)}),this.execute(),this.margeWall(t[0],t[1]),new $523a84362d27c3e8$export$b680ca477a72be07(this).wallToJson()}moveCurrentCamera(e){var t=new $4xklQ.Vector3;let i=this.camera,r=this.controlsArr[1];i.isOrthographicCamera&&(r=this.controlsArr[0]),this.openRenderScene&&(i=this.renderViewCamera,r=this.renderViewControl),i.getWorldDirection(t);let o=100,a=new $4xklQ.Vector3(t.z,t.y,-t.x),n=i.position.clone(),s=new $4xklQ.Vector3(0,1,0);if("3dRomaCamera"!=i.name){if(i.isOrthographicCamera)"w"==e&&i.position.add(new(0,$4xklQ.Vector3)(0,1,0).multiplyScalar(o)),"a"==e&&i.position.add(new(0,$4xklQ.Vector3)(-1,0,0).multiplyScalar(o)),"s"==e&&i.position.add(new(0,$4xklQ.Vector3)(0,-1,0).multiplyScalar(o)),"d"==e&&i.position.add(new(0,$4xklQ.Vector3)(1,0,0).multiplyScalar(o)),i.position.z=n.z,r.target.copy(i.position);else{o=.1,"w"==e&&i.position.add(t.multiplyScalar(o)),"a"==e&&i.position.add(a.multiplyScalar(o)),"s"==e&&i.position.add(t.multiplyScalar(-o)),"d"==e&&i.position.add(a.multiplyScalar(-o)),"q"==e&&i.position.add(s.multiplyScalar(o)),"e"==e&&i.position.add(s.multiplyScalar(-o)),"q"!=e&&"e"!=e&&(i.position.y=n.y);let l=i.position.clone().sub(n),h=r.target.clone().add(l);r.target.copy(h)}i.updateProjectionMatrix()}}margeWall(e,t){if(!(0,$9HO6e.UtilCore).wallIsInLine(e,t))return;this.removeHelperByWall(t),this.removeHelperByWall(e);let i=(0,$9HO6e.UtilCore).getSamePointTwoWall(e,t),r=(0,$9HO6e.UtilCore).getMeshOtherPoint(t,i);(0,$9HO6e.UtilCore).isSameVector(i,e.startPoint)?e.startPoint=r:e.endPoint=r,this.getAllWindowInWall(t).forEach(t=>{t.wallId=e.wallID,t.wallStartPoint=e.startPoint,t.wallEndPoint=e.endPoint,t.wallDep=e.thickness}),this.removeWall(t)}addModelBox(e){let t=this.getOuterParent(e,e,"outer");console.log(t);let i=e,r=e.param[0];"2dModel"==t.parent.name&&(i=e.param[0],r=e),this.modelHelperGroup.children=[],this.doorHelperGroupClean(),this.addBoxForGroup(i),this.addBoxFor2dGroup(r),e.isLock||(this.addLineHelperForMember(r),new $102b3df9ca2da060$export$aead3d23b4737909(this).selectObj([i]))}getWallCenterLen(e,t){let i=e.geometry.attributes.position.array,r=new $4xklQ.Vector3(i[3],i[4],0),o=new(0,$4xklQ.Vector3)(i[12],i[13],0).sub(r),a=new(0,$4xklQ.Vector3)(i[6],i[7],0).sub(r),n=o.angleTo(a);n>Math.PI/2&&(n=Math.PI-n);let s=e.thickness/2/Math.tan(n);return Math.round(t=o.angleTo(a)>Math.PI/2?t-s:t+s)}refreshRealSizeByBox(e,t){let i=t.parent;if(!e.parent||("2dModel"==e.parent.name&&(i=i.param[0],e=e.param[0]),!i))return;let r=i.rotation.x,o=i.rotation.y,a=i.rotation.z;i.rotation.set(0,0,0);let n=new(0,$4xklQ.Box3)().setFromObject(i);i.rotation.set(r,o,a);let s=new $44a90fc8a2825c34$export$f7a1f6dc3f8b082f().fromBox3(n),l=new(0,$4xklQ.Vector3)().setFromMatrixScale(i.matrixWorld),h=2*s.halfSize.x/l.x,c=2*s.halfSize.y/l.y,d=2*s.halfSize.z/l.z;i.width=h,i.height=c,i.depth=d,i.param&&(i.param[0].width=1e3*h,i.param[0].height=1e3*d,i.param[0].depth=1e3*c),i.uuid!=e.uuid&&this.refreshRealSizeByBox(e,i)}getRealSize(e){let t=e;("2dModelGroup"==e.modelType||"2DModel"==e.modelType)&&(t=e.param[0]),t.param[0],t.updateMatrixWorld();let i=new(0,$4xklQ.Vector3)().setFromMatrixScale(t.matrixWorld);return[t.width*i.x,t.height*i.y,t.depth*i.z]}addBoxForGroup(e,t=2){let i=this.wallHelp.addOBBbox(e,this.config.boxColor);i.name="modelBox",i.layers.set(t),this.modelHelperGroup.add(i)}addDashBoxForGroup(e,t=2){let i=this.wallHelp.addOBBDotBox(e);i.name="modelBox",i.layers.set(t),this.modelDotGroup.add(i)}addDashBoxFor2dGroup(e){let t=this.wallHelp.getModelVertex(e,1.2),i=this.wallHelp.addBoxFor2dModel(t,this.config.boxLineColor,"dot");i.name="modelBox",this.modelDotGroup.add(i)}addBoxFor2dGroup(e,t=window.editor.config.boxLineColor){let i=this.wallHelp.getModelVertex(e),r=this.wallHelp.addBoxFor2dModel(i,t);this.doorHelperGroup.add(r)}getWallByMesh(e){let t=e.parameter.tdm.wallId;return this.getWallById(t)}getWallById(e){for(let t=0;t<this.allWalls.length;t++)if(this.allWalls[t].wallID==e)return this.allWalls[t];return!1}get3DWallByMesh(e){let t=e.parameter.tdm.wallId;return this.get3DWallById(t)}get3DWallById(e){for(let t=0;t<this.wallGroup3D.children.length;t++){let i=this.wallGroup3D.children[t];if("3DWall"==i.modelType&&i.wallID==e)return i}return!1}get3DWindowBy2dWindow(e){let t="";return this.wallGroup3D.children.forEach(i=>{i.parameter&&i.parameter.tdm.uuid==e.uuid&&(t=i)}),t}partRefreshWall(e){let t=[];this.otherMeshs.forEach(i=>{i.wallId==e.wallID&&t.push(i)});let i=[];this.wallGroup3D.children.forEach(t=>{"CodeModel"!=t.modelType||t.parameter&&t.parameter.tdm.wallId!=e.wallID||i.push(t)}),this.wallGroup3D.remove(...i),this.wallGroup3D.children.forEach(t=>{"3DWall"==t.modelType&&t.wallID==e.wallID&&this.wallGroup3D.remove(t)});let r=new(0,$5XTH3.DrawWallTool)().switchTo3D([e]);this.wallGroup3D.add(...r);let o=(0,$9QhXH.DM).getHoleJson(t,this);new(0,$5sV3G.DigHole)(this).work(r,o),this.wallGroup3D.traverse(function(e){e.layers.set(1)})}btnSVGExportClick(){var e=new $9aaa1afb37141370$export$42e42f98ac770ce0;e.setSize(window.innerWidth,window.innerHeight),e.render(this.scene,this.camera),this.ExportToSVG(e,"test.svg")}ExportToSVG(e,t){var i=new XMLSerializer().serializeToString(e.domElement),r='<?xml version="1.0" standalone="no"?>\r\n',o=new Blob([r,i],{type:"image/svg+xml;charset=utf-8"}),a=URL.createObjectURL(o),n=document.createElement("a");n.href=a,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)}exportModelGlb(e){this.camera.isOrthographicCamera&&(e=this.get3DModelBy2DModel(e));let t=e.clone();t.position.set(0,0,0);let i=new $cda9fa5069073a5c$export$c32c7942a3d4b7c1,r={trs:!1,onlyVisible:!0,truncateDrawRange:!0,binary:!0,maxTextureSize:4096};i.parse([t],function(e){var t=JSON.stringify(e),i=new Blob([t],{type:"text/plain"});e instanceof ArrayBuffer&&(i=new Blob([e],{type:"application/octet-stream"}));var r=document.createElement("a");r.style.display="none",r.href=URL.createObjectURL(i),r.download="rjh_test_"+Date.parse(new Date)+".glb",r.click()},function(e){console.log("error",e)},r)}getScreen(e,t){let i=e.project(t),r=window.innerWidth/2,o=window.innerHeight/2;return[Math.round(i.x*r+r),Math.round(-i.y*o+o)]}exportAllScenePng(){this.list.setViewportCamera.dispatch("3D",this),this.grid3d.visible=!1;let e=this;setTimeout(function(){var t=document.createElement("a");let i=e.renderer.domElement.toDataURL("image/jpeg");t.href=i,t.download="rjh_test_"+Date.parse(new Date)+".jpg",t.click(),e.grid3d.visible=!0},100)}autoMakeRenderPng(){let e=document.getElementsByClassName("shot_box")[0].getBoundingClientRect(),t=editor.renderViewCamera.aspect;editor.RenderRend.setSize(e.width,e.height),editor.renderViewCamera.aspect=e.width/e.height,editor.renderViewCamera.updateProjectionMatrix(),setTimeout(function(){var e=document.createElement("a");let i=editor.RenderRend.domElement.toDataURL("image/jpeg"),r="testPng.json",o={pngBase64:i},a=editor.renderFloorGroup.children.concat(editor.renderModel3dGroup.children).concat(editor.renderWall3dGroup.children).concat(editor.renderMember3dGroup.children);editor.setRandomColor(a),setTimeout(()=>{let e=editor.RenderRend.domElement.toDataURL("image/jpeg");var i=document.createElement("a");i.href=e,i.download="rjh_test_"+Date.parse(new Date)+".jpg",o.randomBase64,editor.saveJsonToSever(o,r),editor.setRandomColor(a,!1),editor.renderViewCamera.aspect=t,editor.renderViewCamera.updateProjectionMatrix(),editor.RenderRend.setSize(window.innerWidth,window.innerHeight),editor.RenderRend.render(editor.renderScene,editor.renderViewCamera)},100),e.href=i,e.download="rjh_test_"+Date.parse(new Date)+".jpg"},100)}setRandomColor(e,t=!0){if(e.forEach(e=>{e.traverse(function(e){e.isMesh&&e.oldColor&&(e.material=e.oldColor.clone())})}),!t)return;let i={};e.forEach(e=>{e.traverse(function(e){if(e.isMesh&&"outlineMesh"!=e.name){e.oldColor||(e.oldColor=e.material.clone());let r=e.material.color.toArray(),o=r[0]+"-"+r[1]+"-"+r[2];if(e.modelType,i.hasOwnProperty(o))e.material=i[o].clone();else{let r=new $4xklQ.MeshBasicMaterial;var t=new Float32Array([Math.random(),Math.random(),Math.random()]);r.color.fromArray(t),e.material=r,i[o]=e.material.clone()}}})})}initCameraPngScene(e,t="auto"){this.cameraScene.children=[];let i=new $4xklQ.PointLight(10394523,6,1e4);i.position.set(0,600,0),i.layers.enableAll(),this.cameraScene.add(i);let r=new $4xklQ.AmbientLight(10394523,2,1e4);r.layers.enableAll(),this.cameraScene.add(r);let o=e.clone();if(e.parent&&(this.pngCamera="2dModel"==e.parent.name?this._DEFAULT_CAMERA1.clone():this._DEFAULT_CAMERA.clone()),"top"==t){this.pngCamera=this._DEFAULT_CAMERA1.clone();let e=new(0,$4xklQ.Matrix4)().makeScale(1e3,1e3,1e3);o.applyMatrix4(e),o.traverse(function(e){e.layers.set(0)}),o.rotation.x=Math.PI/2}"2D"==t&&(this.pngCamera=this._DEFAULT_CAMERA1.clone()),o.position.set(0,0,0);let a=new(0,$4xklQ.Box3)().setFromObject(o),n=new $4xklQ.Vector3;a.getCenter(n);let s=a.max.x-a.min.x,l=a.max.y-a.min.y;this.pngCamera.isOrthographicCamera||(l=a.max.z-a.min.z),("top"==t||"2D"==t)&&(l=a.max.y-a.min.y);let h=this.getScreen(new $4xklQ.Vector3(a.max.x,0,0),this.pngCamera),c=this.getScreen(new $4xklQ.Vector3(a.min.x,0,0),this.pngCamera),d=Math.round(h[0]-c[0]),p=Math.round(l*d/s);if(this.pngCamera.isOrthographicCamera)o.position.set(-n.x,-n.y,0),this.pngCamera.left=-(s/2),this.pngCamera.right=s/2,this.pngCamera.top=l/2,this.pngCamera.bottom=-(l/2),this.pngCamera.far=1e5,r.position.set(0,0,2*l),i.position.set(0,0,2*l),this.pngCamera.position.set(0,0,l/2);else{i.intensity=3,r.intensity=1,this.pngCamera.aspect=s/l;let e=new $4xklQ.Box3;e.expandByObject(o);let n=new $4xklQ.Vector3;e.getSize(n);let h=this.maxSize(n),c=a.max.y-a.min.y;if("right"==t){let e=this.getScreen(new $4xklQ.Vector3(a.max.x,0,a.max.z),this.pngCamera),t=this.getScreen(new $4xklQ.Vector3(a.min.x,0,a.min.z),this.pngCamera);p=Math.round(l*(d=new(0,$4xklQ.Vector2)(e[0],e[1]).distanceTo(new $4xklQ.Vector2(t[0],t[1])))/s),this.pngCamera.position.copy(new(0,$4xklQ.Vector3)(0,0,0).addScalar(h)),this.pngCamera.position.y=c}else{let e=this.getScreen(new $4xklQ.Vector3(a.max.x,0,a.max.z),this.pngCamera),t=this.getScreen(new $4xklQ.Vector3(a.min.x,0,a.min.z),this.pngCamera);p=Math.round(l*(d=new(0,$4xklQ.Vector2)(e[0],e[1]).distanceTo(new $4xklQ.Vector2(t[0],t[1])))/s),this.pngCamera.position.copy(new(0,$4xklQ.Vector3)(0,0,0).add(new $4xklQ.Vector3(0,c/2,1.5*h)))}this.pngCamera.near=.1*h,this.pngCamera.far=300*h,this.pngCamera.lookAt(0,0,0)}this.pngCamera.updateProjectionMatrix(),this.cameraRenderer.setSize(d,p),this.cameraScene.add(o),this.pngCamera.zoom=1,"2D"==t&&(this.pngCamera.zoom=.4),this.pngCamera.updateProjectionMatrix()}maxSize(e){let t;return(t=e.x>e.y?e.x:e.y)>e.z||(t=e.z),t}exportModelImg(){if(""==editor.clickSelect||""==editor.clickSelect[0].object)return;let e=editor.clickSelect[0].object;e=this.getOuterParent(e),this.initCameraPngScene(e);let t=this;setTimeout(function(){var i=document.createElement("a");i.href=t.cameraRenderer.domElement.toDataURL("image/png"),i.download="rjh_test_"+Date.parse(new Date)+".png",i.click(),t.exportModelGlb(e)},100)}getPositionByScreen(e,t){let i=new $4xklQ.Vector3(e,t,.5),r=this.camera;return this.camera.isOrthographicCamera||(r=this.getOtherCamera(this.camera)),i.unproject(r)}getTextCanvas2(e=""){let t=document.createElement("canvas"),i=t.getContext("2d"),r=this.getPositionByScreen(-1,1),o=this.getPositionByScreen(1,1),a=this.getPositionByScreen(-1,-1),n=this.getPositionByScreen(window.innerWidth/2/window.innerWidth*2-1,-(2*(window.innerHeight/2/window.innerHeight))+1),s=r.distanceTo(o),l=r.distanceTo(a);t.width=window.innerWidth,t.height=window.innerHeight,i.fillStyle="black",i.font='normal 20px "楷体"';let h=document.getElementsByClassName("Panel")[0].children;for(let t=0;t<h.length;t++)if(!(""!=e&&0>h[t].className.indexOf(e))&&h[t].getAttribute("worldPosition")){h[t].getAttribute("worldPosition").split("/");let e=getComputedStyle(h[t],null),r=1*e.marginTop.replace("px","")+20,o=1*e.marginLeft.replace("px",""),a=h[t].innerHTML.split("<br>"),n=0;a.forEach(e=>{i.fillText(e,o,r+20*n),n++})}let c=t.toDataURL("image/png"),d=new $4xklQ.TextureLoader().load(c),p=new $4xklQ.PlaneGeometry(s,l),u=new $4xklQ.MeshBasicMaterial({map:d,transparent:!0,opacity:1,depthTest:!1}),m=new $4xklQ.Mesh(p,u);return m.renderOrder=5,m.position.set(n.x,n.y,1),m}exportPDF(){this.camera.isOrthographicCamera||this.list.setViewportCamera.dispatch("2D",this);var e=window.innerWidth,t=window.innerHeight,i=595.28,r=592.28/e*t;let o=this.getTextCanvas2();this.scene.add(o),setTimeout(()=>{var e=this.renderer.domElement.toDataURL("image/jpeg",1);o.parent.remove(o);var t=new jsPDF("p","pt","a4");t.addImage(e,"JPEG",0,0,i,r),t.save("download.pdf")},500)}delMap(){this.scene.children.forEach(e=>{"mapImage"==e.useType&&this.scene.remove(e)}),this.list.baseMap.dispatch(1)}createMapMesh(e,t="",i="",r=!0){let o=new $4xklQ.TextureLoader;o.setCrossOrigin("");let a=URL.createObjectURL(e);o.load(a,o=>{let a=10*o.image.width,n=10*o.image.height;""!=t&&(a=t,n=i);let s=new $4xklQ.Mesh(new $4xklQ.PlaneBufferGeometry(a,n),new $4xklQ.MeshBasicMaterial({map:o,transparent:!0}));s.position.set(0,0,0),s.useType="mapImage",s.width=a,s.height=n,s.visible=r;var l=new FileReader;l.onload=()=>{s.imgUrl=l.result},l.readAsDataURL(e),this.scene.add(s),""==t&&this.allHelperForScaleTool(new $4xklQ.Vector3(-1e3,0,0),new $4xklQ.Vector3(1e3,0,0)),this.toolType="free",this.list.baseMap.dispatch(0)})}importMapMain(){this.scene.children.forEach(e=>{"mapImage"==e.useType&&this.scene.remove(e)}),this.list.removeAll.dispatch("save",!1);let e=document.createElement("form");e.style.display="none",document.body.appendChild(e);let t=document.createElement("input");t.type="file",t.accept="image/png, image/jpeg, image/jpg, image/gif",t.onchange=e=>{if(0===t.files.length)return;let i=e.target.files[0];this.createMapMesh(i)},e.appendChild(t),t.click()}getModelOuterParent(e){return e.param?e:this.getModelOuterParent(e.parent)}getOuterParent(e,t=e,i="auto"){return e&&e.parent?["3dwall","3dModel","2dModel"].indexOf(e.parent.name)>-1&&"Group"==e.parent.type?("auto"!=i||(this.clickDepthMsg.uuid==e.uuid||e.param&&this.clickDepthMsg.uuid==e.param[0].uuid)&&1==this.clickDepthMsg.depth&&(e=this.getModelOuterParent(t)),e):this.getOuterParent(e.parent,t,i):""}getTopModePosition(e,t,i){if("Mesh"!=e.type)e.children.slice(0).forEach(e=>{this.getTopModePosition(e,t,i)});else{let r=new $4xklQ.Vector3;e.updateMatrixWorld(),e.getWorldPosition(r),t.updateMatrixWorld();let o=t.worldToLocal(r);o.z>i[0]&&(i[0]=o.z),o.z<i[1]&&(i[1]=o.z)}}getTopModePositionOld(e){let t=e.children.slice(0),i=0,r=0;return t.forEach(e=>{e.position.z>i&&(i=e.position.z),e.position.z<r&&(r=e.position.z)}),[i,r]}synchroModel(e){let t="",i=e.scale;if("3DModel"==e.modelType||"CodeModel"==e.modelType||"modelGroup"==e.modelType){if("CodeModel"==e.modelType){(t=e.parameter.tdm).position.x=e.position.x,t.position.y=e.position.y,t.center.x=e.position.x,t.center.y=e.position.y;return}if((t=this.get2DModelBy3DModel(e))||(t=this.get2DMemberBy3DMember(e)),!t)return;t.rotation.z=e.rotation.y;let r=new $4xklQ.Vector3(1e3*e.position.x,-(1e3*e.position.z),0);t.position.x=r.x,t.position.y=r.y,t.scale.set(i.x,i.z,i.y),t.isLock=e.isLock}else{if((t=this.get3DModelBy2DModel(e))||(t=this.get3DMemberBy2DMember(e)),!t)return;let r=t.height,o=new $4xklQ.Vector3(e.position.x/1e3,0,-e.position.y/1e3);if(t.modelPosition)t.rotation.y=e.rotation.z;else{if(1==this._scaleStart.x&&1==this._scaleStart.y&&1==this._scaleStart.z)t.scale.set(i.x,i.y,1);else{let e=i.x/this._scaleStart.x,r=i.y/this._scaleStart.y,o=i.z/this._scaleStart.z;t.scale.set(e,r,o)}t.rotation.z=e.rotation.z;let r=t.position;t.position.set(e.position.x,e.position.y,r.z),this.modelHelperGroup.children=[];return}if(t.position.set(o.x,t.position.y,o.z),e.groundHei){let o=t.position.y-r*i.z/2;t.position.y+=e.groundHei-o}t.scale.set(i.x,i.z,i.y),t.isLock=e.isLock,this.modelHelperGroup.children=[]}}get2DModelBy3DModel(e){return e.param?e.param[0]:""}get2DMemberBy3DMember(e){return e.twoD}get3DMemberBy2DMember(e){return e.threeD}get3DModelBy2DModel(e){return e.param?e.param[0]:""}createLine(e,t=0,i=1.5){var r=new(0,$g4HAh.LineGeometry)().setPositions(e),o=new $7WCxl.LineMaterial({color:t,linewidth:i});o.resolution.set(window.innerWidth,window.innerHeight);var a=new $ia4Lh.Line2(r,o);return a.renderOrder=1,a.computeLineDistances(),a}createGrid(e=14152177,t=16777215){let i=15e4,r=300;this.gridProportion=i/r;let o=new $4xklQ.GridHelper(i,r,4473924,e);o.name="2dGrid1";let a=new $4xklQ.GridHelper(i,r/5,4473924,t);a.name="2dGrid2";let n=new $4xklQ.GridHelper(i/1e3,r,4473924,e);n.name="3dGrid1";let s=new $4xklQ.GridHelper(i/1e3,r/5,4473924,t);s.name="3dGrid2";let l=new $4xklQ.MeshBasicMaterial({color:"#ff0000"}),h=new $4xklQ.MeshBasicMaterial({color:"#00ff00"});r=8e4;let c=new $4xklQ.Line(new(0,$4xklQ.BufferGeometry)().setFromPoints([new $4xklQ.Vector3(-r,0,0),new $4xklQ.Vector3(r,0,0)]),l),d=new $4xklQ.Line(new(0,$4xklQ.BufferGeometry)().setFromPoints([new $4xklQ.Vector3(0,0,-r),new $4xklQ.Vector3(0,0,r)]),h),p=0,u=this.createLine([-r,p,0,r,p,0],"#ff0000"),m=this.createLine([0,p,-r,0,p,r],"#00ff00");u.layers.set(1),m.layers.set(1),n.layers.set(1),s.layers.set(1),this.grid.add(o),this.grid.add(a),this.grid.add(c),this.grid.add(d),this.grid3d.add(n),this.grid3d.add(s),this.grid3d.add(u),this.grid3d.add(m),this.floorGroup2d.children.length>0&&(this.floorGroup2d.children.forEach(e=>{e.position.z=.1}),this.floorGroup.children.forEach(e=>{e.position.y=.1}))}removeScene(e,t="all"){if(this.specialPointArr=[],"all"==t){this.scene.children.slice(0).forEach(e=>{"Group"==e.type&&"3dGrid"!=e.name&&"2dGrid"!=e.name&&(e.children=[])});let e=this.uiPanelBox.dom;for(;e.hasChildNodes();)e.removeChild(e.firstChild);this.allWalls=[],this.otherMeshs=[],this.otherMember=[],this.doorHoleArr=[],this.splitRoomLine.children=[]}else"lable"==t&&this.removeAllHelper();"save"==e&&this.saveSceneJson()}removeAllHelper(){this.helperGroup.children=[],this.removeInputByClassName(this.uiPanelBox.dom)}testSmartRoom(){setInterval(()=>{let e=parseInt(3*Math.random()+1),t=parseInt(2*Math.random()+1),i=1;this.list.smartRoom.dispatch([e,t,i])},1e3)}addFloor(e,t,i,r,o=[]){this.floorGroup2d.add(...e.getFloor(r[0],r[1])),this.floorGroup2d.children.forEach(e=>{e.material.transparent=!0,e.material.opacity=roomOpacity}),this.floorGroup.add(...t),this.roomList=[[],[]],this.allRoomCenterCamera.children=[];let a=this.getDomsByClassName(this.uiPanelBox.dom,"roomName");this.removeInputByClassName(this.uiPanelBox.dom,"roomName");let n={};a.forEach(e=>{let t=e.getAttribute("center"),i=e.innerHTML.replace(/<br>/g,"\n");i=i.replace(/undefined/g,""),n[t]=i}),o.forEach(e=>{let t=e[1].replace(/<br>/g,"\n");t=t.replace(/undefined/g,""),n[e[0]]=t});let s=new $4xklQ.MeshBasicMaterial({color:16711680,side:$4xklQ.DoubleSide,transparent:!0,opacity:.2});for(let e=0;e<t.length;e++){this.debug&&(t[e].material.color=new $4xklQ.Color(16777215*Math.random())),t[e].position.z=3;let r=Array.from(t[e].geometry.attributes.position.array),o=[],a=[];for(let e=0;e<r.length/3;e++)o.push(new $4xklQ.Vector2(r[3*e],r[3*e+1])),a.push([r[3*e],r[3*e+1]]);let l=[],h=this.floorGroup2d.children[e],c=h.parameter.center;this.roomList[0].push(c);let d=new $4xklQ.SphereGeometry(.05,32,16),p=new $4xklQ.Mesh(d,s);p.position.set(c[0]/1e3,this.wallGroup3D.roomHeight/2e3,-c[1]/1e3),p.layers.set(2),p.name="camera_room"+e+"1",this.allRoomCenterCamera.add(p);for(let e=0;e<this.allWalls.length;e++){let t=this.allWalls[e];t.roomCenter||(t.roomCenter=[]);let i=Array.from(t.geometry.attributes.position.array),r=[];for(let e=0;e<i.length/3;e++)r.push(new $4xklQ.Vector2(i[3*e],i[3*e+1]));for(let e=0,i=!1;e<r.length;e++){for(let a=0;a<o.length;a++)if(r[e].equals(o[a])){l.push(t),t.roomCenter.push(c),i=!0;break}if(i)break}}let u=h.parameter.area;this.roomList[1].push(u);let m="房间"+(e+1),g=c[0].toFixed(2)+"/"+c[1].toFixed(2);n.hasOwnProperty(g)&&(m=n[g].split("\n")[0]),this.floorGroup2d.children[e].roomName=m,this.floorGroup2d.children[e].roomCenter=[c[0].toFixed(2),c[1].toFixed(2)],t[e].roomName=m,t[e].roomCenter=c;let f=this.getScreenPosition(new $4xklQ.Vector3(c[0],c[1],0)),w=new(0,$3BPdS.UIText)(m+"\n"+u+"m\xb2").setId("roomName"+this.floorGroup2d.children[e].uuid).setClass("roomName").setStyle(["white-space"],["pre"]).setMarginTop(f.y+"px").setMarginLeft(f.x+"px");w.setAttribute("worldPosition",c[0]+"/"+c[1]+"/1"),w.setAttribute("roomName",m),w.setAttribute("roomArea",u+"m\xb2"),"2D"==i&&(this.uiPanelBox.add(w),w.setAttribute("center",c[0].toFixed(2)+"/"+c[1].toFixed(2)))}}autoShowHidden(e){"PC"==this.deviceType&&this.floorGroup2d.children.forEach(t=>{let i=document.getElementById("roomName"+t.uuid);if(!i)return;let r=parseFloat(i.innerHTML.split("<br>")["1"]),o=!0;r||(o=!1,r=i.getAttribute("roomArea"));let a=[];t.allPoints.forEach(e=>{a.push(e.x,e.y)}),parseInt(100*e)<=66-parseInt(10*r)?(i.style.display="none",this.helperGroup.children.forEach(e=>{if(!e.newStart)return;let t=this.PolyK.ContainsPoint(a,(e.newStart.x+e.newEnd.x)/2,(e.newStart.y+e.newEnd.y)/2),i=document.getElementsByClassName("showWallLength"+e.uuid)[0];t&&i&&(e.visible=!1,i.style.display="none")})):(o&&(i.style.display="block"),this.helperGroup.children.forEach(e=>{if(!e.newStart)return;let t=this.PolyK.ContainsPoint(a,(e.newStart.x+e.newEnd.x)/2,(e.newStart.y+e.newEnd.y)/2),i=document.getElementsByClassName("showWallLength"+e.uuid)[0];t&&i&&(e.visible=!0,this.config.settingJson.dimension&&(i.style.display="block"))}))})}eachShowHiddenModel(e,t,i){e.modelPosition&&(e.modelPosition==t&&(e.visible=i,e.param[0].visible=i),e.children.forEach(e=>{this.eachShowHiddenModel(e,t,i)}))}showHiddenHelperMain(e,t){switch(e){case"roomName":case"roomArea":if(!this.camera.isOrthographicCamera)return;let i=this.uiPanelBox.dom.children;for(let r=0;r<i.length;r++){let o=i[r];if("roomName"==o.className){let i=o.innerText.split("\n");t?("roomName"==e&&(i[0]=o.getAttribute("roomName")),"roomArea"==e&&(i[1]=o.getAttribute("roomArea"))):("roomName"==e&&(i[0]=""),"roomArea"==e&&(i[1]="")),i[0]=i[0].replace(/undefined/g,""),o.innerText=i[0]+"\n"+i[1]}}break;case"dimension":if(!this.camera.isOrthographicCamera)return;if(t)this.helperGroup.visible=!0,(0,$9HO6e.UtilCore).updateLineDimensionsLine(this);else{this.helperGroup.visible=!1;let e=this.uiPanelBox.dom.children;if(0==e.length)return;for(let t=0;t<e.length;t++)e[t].className.indexOf("showWallLength")>=0&&(e[t].style.display="none")}break;case"showCeilFurniture":this.model3D.children.forEach(e=>{this.eachShowHiddenModel(e,"top",t)});break;case"showFloorFurniture":this.model3D.children.forEach(e=>{this.eachShowHiddenModel(e,"bottom",t)});break;case"showKitchen":case"showAllHouseFurniture":break;case"showWallFurniture":this.model3D.children.forEach(e=>{this.eachShowHiddenModel(e,"free",t)});break;case"showMember":this.otherMember.forEach(e=>{"beam"==e.modelType&&(e.visible=t,e.threeD.visible=t)})}}refreshDoorCamera(){this.allRoomCenterCamera.children.slice(0).forEach(e=>{e.name.indexOf("openDoorCtrl_")>=0&&e.parent&&e.parent.remove(e)});let e=(0,$9QhXH.DM).getHoleJson(this.otherMeshs,this);this.createDoorCamera(e)}createDoorCamera(e){let t=new $4xklQ.MeshBasicMaterial({color:65280,side:$4xklQ.DoubleSide,transparent:!0,opacity:.2}),i=1;e.forEach(e=>{if(e.path&&e.path.indexOf("door")>=0){let l=this.getWallByWallId(e.wallID);if(!l)return;let h=l.endPoint.clone().sub(l.startPoint.clone()),c=new(0,$4xklQ.Vector3)(-h.y,0,h.x).setLength(400);var r=new $4xklQ.Vector3(e.location.x,e.location.z,-e.location.y);let d=r.clone().add(c),p=r.clone().add(c.negate()),u=.1;var o=new $4xklQ.BoxGeometry(u,u,u),a=new $4xklQ.BoxGeometry(u,u,u),n=new $4xklQ.Mesh(o,t),s=new $4xklQ.Mesh(a,t);n.position.set(d.x/1e3,u,d.z/1e3),s.position.set(p.x/1e3,u,p.z/1e3),n.layers.set(2),s.layers.set(2),n.name="openDoorCtrl_"+i,s.name="openDoorCtrl_"+(i+1),i+=2,this.allRoomCenterCamera.add(n),this.allRoomCenterCamera.add(s)}})}destroy3DModelHelper(){if(this.transform3DTool){let e=this.transform3DTool;this.dom.removeEventListener("pointermove",e.pointerMoveHandler),this.dom.removeEventListener("pointerdown",e.pointerDownHandler),this.dom.removeEventListener("pointerup",e.pointerUpHandler),this.dom.removeEventListener("dragstart",e.dragstartHandler),this.dom.removeEventListener("dragend",e.dragendHandler),this.transform3DTool.boxColor&&this.transform3DTool.detach()}}splitRoomByLine(){if(this.splitRoomLine.children.length>0){let e=[],t=[],i={};for(let r in this.allWalls.slice(0).forEach(r=>{let o=(0,$9HO6e.UtilCore).getAllWallLine(r),a=new $4xklQ.Vector3(o[0][0],o[0][1],0),n=new $4xklQ.Vector3(o[1][0],o[1][1],0),s=new $4xklQ.Vector3(o[2][0],o[2][1],0),l=new $4xklQ.Vector3(o[3][0],o[3][1],0),h=(0,$9HO6e.UtilCore).handleLineData(a,n),c=(0,$9HO6e.UtilCore).handleLineData(s,l),d=[],p=[];this.splitRoomLine.children.forEach(e=>{let t=e.startPoint,r=e.endPoint,o=(0,$9HO6e.UtilCore).handleLineData(t,r),u=(0,$9HO6e.UtilCore).lineIsIntersection(h,o),m=(0,$9HO6e.UtilCore).lineIsIntersection(c,o);if(u){let o=(0,$9HO6e.UtilCore).pointIsInLine(u,t,r),s=(0,$9HO6e.UtilCore).pointIsInLine(u,a,n);o&&s&&(d.push(u),i.hasOwnProperty(e.uuid)?(0,$9HO6e.UtilCore).checkHasSameVec(i[e.uuid],u)||i[e.uuid].push(u):i[e.uuid]=[u])}if(m){let o=(0,$9HO6e.UtilCore).pointIsInLine(m,t,r),a=(0,$9HO6e.UtilCore).pointIsInLine(m,s,l);o&&a&&(p.push(m),i.hasOwnProperty(e.uuid)?(0,$9HO6e.UtilCore).checkHasSameVec(i[e.uuid],m)||i[e.uuid].push(m):i[e.uuid]=[m])}});let u=[{x:a.x,y:a.y},{x:s.x,y:s.y},{x:n.x,y:n.y},{x:l.x,y:l.y}];if(d.length>0){let t=(0,$9HO6e.UtilCore).sortPoint(d,a,n);for(let i=0;i<t.length-1;i++){0!=i&&u.push({x:t[i][0],y:t[i][1]});let r=t[i].concat(t[i+1]);e.push(r)}}else e.push([a.x,a.y,n.x,n.y]);if(p.length>0){let t=(0,$9HO6e.UtilCore).sortPoint(p,s,l);for(let i=0;i<t.length-1;i++){let r=t[i].concat(t[i+1]);0!=i&&u.push({x:t[i][0],y:t[i][1]}),e.push(r)}}else e.push([s.x,s.y,l.x,l.y]);t.push(u)}),i){let t=(0,$9HO6e.UtilCore).getSplitLineByUuid(this.splitRoomLine.children,r);if(""!=t){let o=(0,$9HO6e.UtilCore).sortPoint(i[r],t.startPoint,t.endPoint);for(let t=0;t<o.length-1;t++){let i=o[t].concat(o[t+1]);e.push(i)}}}return[e,t]}return[!1,!1]}recoveModel(e,t=this.model3D,i=this.model2D){e.forEach(e=>{if(e.imgPath){if("localPath"==e.imgPath){if(e.sliceArr){console.log("开始合并"),this.list.alert.dispatch("正在加载云端模型,请稍等"),this.list.progressOpen.dispatch(1);let t=this;setTimeout(()=>{t.mergeFile(e.sliceArr,e)},100)}}else this.list.loadGltf.dispatch([],e,t,i)}else{let r=new $4xklQ.Group,o=e.location;r.position.set(o.x,o.y,o.z),r.rotation.y=e.rotation,r.layers.set(2),e.rotate&&r.rotation.set(e.rotate.x,e.rotate.y,e.rotate.z),r.modelType=e.modelType,t.add(r);let a=new $4xklQ.Group;e.scale&&(r.scale.copy(e.scale),a.scale.set(e.scale.x,e.scale.z,e.scale.y)),a.rotation.z=e.rotation,a.position.set(1e3*o.x,-(1e3*o.z),0),i.add(a),"modelGroup"==r.modelType&&(a.modelType="2dModelGroup"),r.modelId=a.uuid,r.param=[a],a.modelId=r.uuid,a.param=[r],r.isLock=e.isLock,a.isLock=e.isLock;let n="bottom";e.modelPosition&&(n=e.modelPosition),r.modelPosition=n,a.modelPosition=n,r&&(r.width=e.width,r.height=e.height,r.depth=e.depth,a.width=1e3*r.width,a.height=1e3*r.depth,a.depth=1e3*r.height),this.recoveModel(e.child,r,a)}})}loadRoom(e){let t=new $kLdsz.Room(JSON.parse(e).roomArr),i=[t.floor].concat(t.baseWalls);this.moveRoomArr=i}readCache(e){if(this.list.removeAll.dispatch("noSave",!1),!e||(e=JSON.parse(e)).version!=this.dataVersion){document.getElementsByClassName("Panel")[0].style.display="block";return}e.roomOpacity&&(window.roomOpacity=e.roomOpacity),e.storeyHei&&(window.storeyHei=e.storeyHei),e.floorDep&&(window.floorDep=e.floorDep),e.wall.forEach(e=>{e.start.x/=100,e.start.y/=100,e.end.x/=100,e.end.y/=100});let t=new $5XTH3.DrawWallTool().create2DWall(e.wall),i=t.pop();this.wallGroup.children=[],this.wallGroup3D.children=[],this.floorGroup.children=[],this.memberGroup3D.children=[],this.lineGroup3D.children=[],t.length>0&&this.wallGroup.add(...i,...t),this.allWalls=t,e.splitLine.forEach(e=>{this.addSplitLine(e.start,e.end,e.useType)}),e.member.forEach(e=>{let t,i=new $4xklQ.Vector3(e.location.x,e.location.y,e.location.z);"beam"==e.type&&((t=(0,$9QhXH.DM).createBeam(i,"beam",e.angle,e.height,e.depth,this.allWalls,e.width,"L")).rotation.z=e.rotation),"flue"==e.type&&(t=(0,$9QhXH.DM).createFlue(i,e.width,e.height,e.rotation)),"pillars"==e.type&&(t=(0,$9QhXH.DM).createBeam(i,"pillars",e.rotation,e.height,e.depth,this.allWalls,e.width)),t.isLock=e.isLock,this.otherMember.push(t)}),this.otherMember.length>0&&this.scene.add(...this.otherMember);let r=[],o=[];e.hole.forEach(e=>{let t,i,a=new $4xklQ.Vector3(e.location.x,e.location.y,e.location.z);if(this.allWalls.forEach(i=>{if(i.wallID==e.wallID){t=i;return}}),!t)return;let n=t.startPoint,s=t.endPoint,l=new(0,$4xklQ.Vector2)(s.x,s.y).sub(new $4xklQ.Vector2(n.x,n.y)).angle();if(e.path){let h="outside";if(e.doorDir&&(h=e.doorDir),e.path.includes("baseDoor")&&(i=(0,$9QhXH.DM).createBaseDoor(a,e.width,h,l,t.thickness,n,s)),e.path.includes("panoramicWindow")&&(i=(0,$9QhXH.DM).createPanoramicWindow(a,e.width,l,t.thickness,n,s)),e.path.includes("frenchWindow")&&(i=(0,$9QhXH.DM).createFrenchWindow(a,e.width,l,t.thickness,n,s)),e.path.includes("doubleOpenDoor")&&(i=(0,$9QhXH.DM).createDODoor(a,e.width,l,t.thickness,n,s,h)),e.path.includes("slidingDoor")&&(i=(0,$9QhXH.DM).createSlidingDoor(a,e.width,l,t.thickness,n,s,h)),e.path.includes("baseWindow")&&(i=(0,$9QhXH.DM).createBaseWindow(a,e.width,l,t.thickness,n,s)),e.path.includes("sectorWindow")&&(i=(0,$9QhXH.DM).createSectorWindow(a,e.width,l,t.thickness,n,s)),e.path.includes("lashDoor")&&(i=(0,$9QhXH.DM).createLashDoor(a,e.width,l,t.thickness,n,s,h)),e.path.includes("pass")&&(i=(0,$9QhXH.DM).createPass(a,e.width,l,t.thickness,n,s,h)),e.path.includes("sectorDoor")&&(i=(0,$9QhXH.DM).createSectorDoor(a,e.width,l,t.thickness,n,s)),e.path.includes("arcWindow")&&(i=(0,$9QhXH.DM).createArcBaseWindow(a,t.arcCenter,t.thickness,(e.endRadian-e.startRadian)/2)),e.path.includes("rightLWindow")&&(r[0]&&r[2]||(r[2]=t,r[3]=e.width),r[0]&&r[2]&&(a=(0,$9QhXH.DM).getCommonPoint(r[0],r[2]),(i=(0,$9QhXH.DM).createLWindowNew(a,r[0],r[2],r[1],r[3])).wallId=r[0].wallID,r=[])),e.path.includes("leftLWindow")&&(r[0]&&r[2]||(r[0]=t,r[1]=e.width),r[0]&&r[2]&&(a=(0,$9QhXH.DM).getCommonPoint(r[0],r[2]),(i=(0,$9QhXH.DM).createLWindowNew(a,r[0],r[2],r[1],r[3])).wallId=r[0].wallID,r=[])),e.path.includes("uWindow")&&(o.unshift(new $4xklQ.Vector3(e.location.x,e.location.y,e.location.z)),o.unshift(t),o[0]&&o[2]&&o[4])){let r,n,s,l,h,c,d=(0,$9QhXH.DM).getCommonPoint(o[0],o[2]);r=d.equals(o[0].startPoint)?o[0].endPoint:o[0].startPoint,n=d.equals(o[2].startPoint)?o[2].endPoint:o[2].startPoint,(0,$9HO6e.UtilCore).getClockWise(r,d,n)>0?(s=o[2],l=o[3],h=o[4],c=o[5]):(h=o[2],c=o[3],s=o[4],l=o[5]),l=e.windowThickL,c=e.windowThickR;let p=(0,$9HO6e.UtilCore).getSamePointWall(t,this.allWalls),u=t.startPoint,m=(0,$9HO6e.UtilCore).getMeshOtherPoint(p[1],u);((0,$9HO6e.UtilCore).isSameVector(p[0].startPoint,u)||(0,$9HO6e.UtilCore).isSameVector(p[0].endPoint,u))&&(m=(0,$9HO6e.UtilCore).getMeshOtherPoint(p[0],u));let g=m.clone().sub(u.clone()).setLength(480);a=new $4xklQ.Vector2(o[1].x-g.x,o[1].y-g.y),i=(0,$9QhXH.DM).createUWindow(a,s,t,h,l,c),o=[]}}else if("dooropen"==e.dir&&(i=(0,$9QhXH.DM).createDoorHole(a,e.width,l,t.thickness,n,s)),"UWindow"==e.dir&&(o.push(t,e.windowThick),o[0]&&o[2]&&o[4])){let r,n,s,l,h,c,d=(0,$9QhXH.DM).getCommonPoint(o[0],o[2]);r=d.equals(o[0].startPoint)?o[0].endPoint:o[0].startPoint,n=d.equals(o[2].startPoint)?o[2].endPoint:o[2].startPoint,(0,$9HO6e.UtilCore).getClockWise(r,d,n)>0?(s=o[2],l=o[3],h=o[4],c=o[5]):(h=o[2],c=o[3],s=o[4],l=o[5]),l=e.windowThickL,c=e.windowThickR;let p=(0,$9HO6e.UtilCore).getSamePointWall(t,this.allWalls),u=t.startPoint,m=(0,$9HO6e.UtilCore).getMeshOtherPoint(p[1],u);((0,$9HO6e.UtilCore).isSameVector(p[0].startPoint,u)||(0,$9HO6e.UtilCore).isSameVector(p[0].endPoint,u))&&(m=(0,$9HO6e.UtilCore).getMeshOtherPoint(p[0],u));let g=m.clone().sub(u.clone()).setLength(480);a=new $4xklQ.Vector2(o[1].x-g.x,o[1].y-g.y),i=(0,$9QhXH.DM).createUWindow(a,s,t,h,l,c),o=[]}i&&(e.height&&(i.height=e.height),e.floorHei&&(i.floorHei=e.floorHei),e.wallID&&(i.wallId=e.wallID),e.isLock&&(i.isLock=e.isLock),this.otherMeshs.push(i))}),this.otherMeshs.length>0&&this.scene.add(...this.otherMeshs),this.recoveModel(e.model);let a=e.mapJson,n=!0;if(a.width){a.hasOwnProperty("visible")&&(n=a.visible);let e=a.imgUrl;if(e){for(var s=e.split(","),l=s[0].match(/:(.*?);/)[1],h=atob(s[1]),c=h.length,d=new Uint8Array(c);c--;)d[c]=h.charCodeAt(c);var p=new Blob([d],{type:l});let t=new File([p],"upload.jpg",{type:"image/jpeg",lastModified:Date.now()});this.createMapMesh(t,a.width,a.height,n)}}this.list.setDefaultParams.dispatch({roomOpacity:100*window.roomOpacity,storeyHei:window.storeyHei,floorDep:window.floorDep,mapVisible:n});let u=e.cameraJson;if(new $523a84362d27c3e8$export$b680ca477a72be07(this).wallToJson(),"{}"==JSON.stringify(e.cameraJson)){this.list.setViewportCamera.dispatch("2D",editor),document.getElementsByClassName("Panel")[0].style.display="block";return}this.setViewportCamera(u.sceneModel,this,!1),this.miniMapObj=new $3c82f100e7ba0388$export$bc845c5c4f62a4a1(this,this.miniMapCamera,this.scene,this.newRenderer,this.miniDom,240,202),this.miniMapObj.main(),this.list.changeTheme.dispatch(e.themeColor);let m=e.themeColor;""==m&&(m="1"),e.settingJson&&(this.config.settingJson=e.settingJson),this.config.settingJson.hasOwnProperty("showMember")||(this.config.settingJson.showMember=!0),this.config.settingJson.hasOwnProperty("showFloorFurniture")||(this.config.settingJson.showFloorFurniture=!0),this.config.settingJson.hasOwnProperty("showWallFurniture")||(this.config.settingJson.showWallFurniture=!0),this.config.settingJson.hasOwnProperty("showCeilFurniture")||(this.config.settingJson.showCeilFurniture=!0),this.config.settingJson.hasOwnProperty("showKitchen")||(this.config.settingJson.showKitchen=!0),this.config.settingJson.hasOwnProperty("showAllHouseFurniture")||(this.config.settingJson.showAllHouseFurniture=!0),setTimeout(()=>{this.list.getShowHiddenFlag.dispatch(JSON.stringify(this.config.settingJson)),this.list.themeSwitch.dispatch(m),this.list.threeDimensions.dispatch(u.sceneModel);let e=u.zoom;if(this.camera.isOrthographicCamera){let e=this.getOtherCamera(this.camera);e.zoomNum=u["3dVal"],e.position.copy(new $4xklQ.Vector3(u["3dPosition"].x,u["3dPosition"].y,u["3dPosition"].z)),e.rotation.copy(new $4xklQ.Vector3(u["3dRotation"].x,u["3dRotation"].y,u["3dRotation"].z)),e.lookAt(new $4xklQ.Vector3(0,0,0)),this.camera.zoom=u.zoom,this.camera.position.copy(new $4xklQ.Vector3(u.position.x,u.position.y,u.position.z)),this.camera.rotation.copy(new $4xklQ.Vector3(u.rotation.x,u.rotation.y,u.rotation.z)),e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix()}else{"3dRomaCamera"==this.camera.name?this.roamTool.restore(u["3dPosition"],u["3dRotation"]):(this.camera.zoomNum=u["3dVal"],e=u["3dVal"],this.camera.position.copy(new $4xklQ.Vector3(u["3dPosition"].x,u["3dPosition"].y,u["3dPosition"].z)),this.camera.rotation.copy(new $4xklQ.Vector3(u["3dRotation"].x,u["3dRotation"].y,u["3dRotation"].z)),this.camera.lookAt(new $4xklQ.Vector3(0,0,0))),this.camera.aspect=window.innerWidth/window.innerHeight;let t=this.getOtherCamera(this.camera);t.zoom=u.zoom,t.position.copy(new $4xklQ.Vector3(u.position.x,u.position.y,u.position.z)),t.rotation.copy(new $4xklQ.Vector3(u.rotation.x,u.rotation.y,u.rotation.z)),t.updateProjectionMatrix(),this.switchHelperGroup("hidden"),this.hiddenDomsByClassName(this.uiPanelBox.dom,"roomName")}this.controlsArr[0].target.copy(new $4xklQ.Vector3(u.target.x,u.target.y,u.target.z)),this.controlsArr[1].target.copy(new $4xklQ.Vector3(u["3dTarget"].x,u["3dTarget"].y,u["3dTarget"].z)),this.camera.updateProjectionMatrix(),this.controlsArr[0].update(),this.controlsArr[1].update(),this.list.executeTool.dispatch("moveFree"),this.list.changeCameraSlider.dispatch("2d",e),this.updateDom(),this.camera.updateProjectionMatrix(),this.specialPointArr=(0,$9HO6e.UtilCore).getAllSpecialPoint(this),this.camera.isOrthographicCamera&&this.autoShowHidden(this.camera.zoom),document.getElementsByClassName("Panel")[0].style.display="block"},100)}readCacheOld(e){if(this.list.removeAll.dispatch("noSave",!1),!e||(e=JSON.parse(e)).version!=this.dataVersion)return;e.wall.forEach(e=>{e.start.x/=100,e.start.y/=100,e.end.x/=100,e.end.y/=100});let t=new $5XTH3.DrawWallTool().create2DWall(e.wall),i=t.pop();this.wallGroup.children=[],this.wallGroup3D.children=[],this.floorGroup.children=[],this.memberGroup3D.children=[],this.lineGroup3D.children=[],t.length>0&&this.wallGroup.add(...i,...t),this.allWalls=t,e.splitLine.forEach(e=>{this.addSplitLine(e.start,e.end,e.useType)}),e.member.forEach(e=>{let t,i=new $4xklQ.Vector3(e.location.x,e.location.y,e.location.z);"beam"==e.type&&((t=(0,$9QhXH.DM).createBeam(i,"beam",e.angle,e.height,e.depth,this.allWalls)).rotation.z=e.rotation),"flue"==e.type&&(t=(0,$9QhXH.DM).createFlue(i,e.width,e.height,e.rotation)),"pillars"==e.type&&(t=(0,$9QhXH.DM).createBeam(i,"pillars",e.rotation,e.height,e.depth,this.allWalls,e.width)),this.otherMember.push(t)}),this.otherMember.length>0&&this.scene.add(...this.otherMember);let r=[],o=[];e.hole.forEach(e=>{let t,i,a=new $4xklQ.Vector3(e.location.x,e.location.y,e.location.z);this.allWalls.forEach(i=>{if(i.wallID==e.wallID){t=i;return}});let n=t.startPoint,s=t.endPoint,l=new(0,$4xklQ.Vector2)(s.x,s.y).sub(new $4xklQ.Vector2(n.x,n.y)).angle();if(e.path){if(e.path.includes("baseDoor")&&(i=(0,$9QhXH.DM).createBaseDoor(a,e.width,"outside",l,t.thickness,n,s)),e.path.includes("panoramicWindow")&&(i=(0,$9QhXH.DM).createPanoramicWindow(a,e.width,l,t.thickness,n,s)),e.path.includes("frenchWindow")&&(i=(0,$9QhXH.DM).createFrenchWindow(a,e.width,l,t.thickness,n,s)),e.path.includes("doubleOpenDoor")&&(i=(0,$9QhXH.DM).createDODoor(a,e.width,l,t.thickness,n,s)),e.path.includes("slidingDoor")&&(i=(0,$9QhXH.DM).createSlidingDoor(a,e.width,l,t.thickness,n,s)),e.path.includes("baseWindow")&&(i=(0,$9QhXH.DM).createBaseWindow(a,e.width,l,t.thickness,n,s)),e.path.includes("sectorWindow")&&(i=(0,$9QhXH.DM).createSectorWindow(a,e.width,l,t.thickness,n,s)),e.path.includes("lashDoor")&&(i=(0,$9QhXH.DM).createLashDoor(a,e.width,l,t.thickness,n,s)),e.path.includes("pass")&&(i=(0,$9QhXH.DM).createPass(a,e.width,l,t.thickness,n,s)),e.path.includes("sectorDoor")&&(i=(0,$9QhXH.DM).createSectorDoor(a,e.width,l,t.thickness,n,s)),e.path.includes("arcWindow")&&(i=(0,$9QhXH.DM).createArcBaseWindow(a,t.arcCenter,t.thickness,(e.endRadian-e.startRadian)/2)),e.path.includes("rightLWindow")&&(r[0]&&r[2]||(r[2]=t,r[3]=e.width-240),r[0]&&r[2]&&(a=(0,$9QhXH.DM).getCommonPoint(r[0],r[2]),(i=(0,$9QhXH.DM).createLWindowNew(a,r[0],r[2],r[1],r[3])).wallId=r[0].wallID,r=[])),e.path.includes("leftLWindow")&&(r[0]&&r[2]||(r[0]=t,r[1]=e.width-240),r[0]&&r[2]&&(a=(0,$9QhXH.DM).getCommonPoint(r[0],r[2]),(i=(0,$9QhXH.DM).createLWindowNew(a,r[0],r[2],r[1],r[3])).wallId=r[0].wallID,r=[])),e.path.includes("uWindow")&&(o.unshift(new $4xklQ.Vector3(e.location.x,e.location.y,e.location.z)),o.unshift(t),o[0]&&o[2]&&o[4])){let e,r,n,s,l,h,c=(0,$9QhXH.DM).getCommonPoint(o[0],o[2]);e=c.equals(o[0].startPoint)?o[0].endPoint:o[0].startPoint,r=c.equals(o[2].startPoint)?o[2].endPoint:o[2].startPoint,(0,$9HO6e.UtilCore).getClockWise(e,c,r)>0?(n=o[2],s=o[3],l=o[4],h=o[5]):(l=o[2],h=o[3],n=o[4],s=o[5]);let d=(0,$9HO6e.UtilCore).getSamePointWall(t,this.allWalls),p=t.startPoint,u=(0,$9HO6e.UtilCore).getMeshOtherPoint(d[1],p);((0,$9HO6e.UtilCore).isSameVector(d[0].startPoint,p)||(0,$9HO6e.UtilCore).isSameVector(d[0].endPoint,p))&&(u=(0,$9HO6e.UtilCore).getMeshOtherPoint(d[0],p));let m=u.clone().sub(p.clone()).setLength(480);a=new $4xklQ.Vector2(o[1].x-m.x,o[1].y-m.y),i=(0,$9QhXH.DM).createUWindow(a,n,t,l,s,h),o=[]}}else if("dooropen"==e.dir&&(i=(0,$9QhXH.DM).createDoorHole(a,e.width,l,t.thickness,n,s)),"UWindow"==e.dir&&(o.push(t,e.height),o[0]&&o[2]&&o[4])){let e,r,n,s,l,h,c=(0,$9QhXH.DM).getCommonPoint(o[0],o[2]);e=c.equals(o[0].startPoint)?o[0].endPoint:o[0].startPoint,r=c.equals(o[2].startPoint)?o[2].endPoint:o[2].startPoint,(0,$9HO6e.UtilCore).getClockWise(e,c,r)>0?(n=o[2],s=o[3],l=o[4],h=o[5]):(l=o[2],h=o[3],n=o[4],s=o[5]);let d=(0,$9HO6e.UtilCore).getSamePointWall(t,this.allWalls),p=t.startPoint,u=(0,$9HO6e.UtilCore).getMeshOtherPoint(d[1],p);((0,$9HO6e.UtilCore).isSameVector(d[0].startPoint,p)||(0,$9HO6e.UtilCore).isSameVector(d[0].endPoint,p))&&(u=(0,$9HO6e.UtilCore).getMeshOtherPoint(d[0],p));let m=u.clone().sub(p.clone()).setLength(480);a=new $4xklQ.Vector2(o[1].x-m.x,o[1].y-m.y),i=(0,$9QhXH.DM).createUWindow(a,n,t,l,s,h),o=[]}i&&(e.height&&(i.height=e.height),e.floorHei&&(i.floorHei=e.floorHei),e.wallID&&(i.wallId=e.wallID),this.otherMeshs.push(i))}),this.otherMeshs.length>0&&this.scene.add(...this.otherMeshs);let a=e.cameraJson;this.setViewportCamera(a.sceneModel,this),this.camera.zoom=a.zoom,this.camera.position.x=a.position.x,this.camera.position.y=a.position.y,this.camera.position.z=a.position.z,this.camera.rotation.x=a.rotation.x,this.camera.rotation.y=a.rotation.y,this.camera.rotation.z=a.rotation.z,this.globalControl.target.x=a.target.x,this.globalControl.target.y=a.target.y,this.globalControl.target.z=a.target.z,this.camera.updateProjectionMatrix(),this.list.executeTool.dispatch("moveFree"),setTimeout(()=>{this.list.threeDimensions.dispatch(a.sceneModel),this.updateDom()},100)}addSplitLine(e,t,i){let r=new $4xklQ.Vector3(e.x,e.y,0),o=new $4xklQ.Vector3(t.x,t.y,0),a=new $4xklQ.Line(new(0,$4xklQ.BufferGeometry)().setFromPoints([r,o]),this.config.drawDotMaterial);a.startPoint=r,a.endPoint=o,a.useType=i,a.computeLineDistances(),a.renderOrder=50,this.splitRoomLine.add(a)}execute(e="",t="",i=""){this.history.execute(e,t,i)}exportModelGlb(e){let t=e.clone();t.position.set(0,0,0);let i=new $cda9fa5069073a5c$export$c32c7942a3d4b7c1,r={trs:!1,onlyVisible:!0,truncateDrawRange:!0,binary:!0,maxTextureSize:4096};i.parse([t],t=>{let i=new Blob([t],{type:"application/octet-stream"});var r=document.createElement("a");r.style.display="none",r.href=URL.createObjectURL(i);let o="模型";e.name&&(o=e.name),r.download=o+".glb",r.click()},e=>{console.log("error",e)},r)}codeModelCopy(e){let t=new $4xklQ.Group;return e.children.slice(0).forEach(e=>{t.add(e.clone())}),t.position.copy(e.position),t.rotation.copy(e.rotation),t}exportGLTF(e="gltf"){this.saveSceneJson();let t=new $cda9fa5069073a5c$export$c32c7942a3d4b7c1,i=!1;"glb"==e&&(i=!0);let r={trs:!1,onlyVisible:!0,truncateDrawRange:!0,binary:i,maxTextureSize:4096},o=new $4xklQ.Group;o.name="roomCamera";let a=new $4xklQ.Group;a.name="openDoorCtrl",this.allRoomCenterCamera.children.slice(0).forEach(e=>{if(e.name.indexOf("camera")>=0){var t=new $4xklQ.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.01,1e3);t.name=e.name;let i=e.position;t.position.set(i.x,i.y,i.z),t.lookAt(new $4xklQ.Vector3(i.x,i.y,i.z)),o.add(t)}else a.add(e)});let n=this.camera.clone();this.camera.isOrthographicCamera&&(n=this.getOtherCamera(n).clone());let s=new $4xklQ.Group;s.name="3dFloor";let l=new $4xklQ.Group;l.name="3dCeiling";let h=new(0,$4xklQ.Matrix4)().makeScale(.001,.001,.001),c=new $4xklQ.Group;c.name="3dWall";let d=new $4xklQ.Group;d.name="3dDoor";let p=new $4xklQ.Group;p.name="3dWindow",[c,d,p,s,l].forEach(e=>{e.rotation.x=-Math.PI/2,e.applyMatrix4(h)}),this.floorGroup.children.slice(0).forEach(t=>{if(t.roomName)s.add(t.clone());else{let i=t.clone();i.material=t.material.clone(),"gltf"==e&&(i.material.side=$4xklQ.DoubleSide),l.add(i)}}),this.wallGroup3D.children.slice(0).forEach((e,t)=>{if("3DWall"==e.modelType&&c.add(e.clone()),e.type.indexOf("Door")>-1||e.type.indexOf("door")>-1||e.type.indexOf("PassMesh")>-1){let t=this.codeModelCopy(e);function i(){for(let i in t.children){let r=t.children[i];"DoorStone"==r.name&&(t.remove(r),r.applyMatrix4(e.matrix),s.add(r))}}d.add(t),"ue"==editor.urlParam.plat&&i(t)}if(e.type.indexOf("Window")>-1||e.type.indexOf("window")>-1){let i=this.codeModelCopy(e);function r(e){"Mesh"==e.type&&"glass"==e.name&&(e.material.opacity=.55),"Group"==e.type&&e.children.forEach(e=>{r(e)})}"ue"==editor.urlParam.plat&&r(i),i.name="window_"+t,p.add(i)}});let u=[c,d,p,this.memberGroup3D,s,l,this.model3D];if(console.log("同步su"),"obj"==e){let e=new $4xklQ.Scene;u.forEach(t=>{e.add(t)});let t=new $7312f6e931728810$export$8c08921df1bef753,i=t.parse(e);var m=document.createElement("a");m.style.display="none",m.href=URL.createObjectURL(new Blob([i],{type:"text/plain"})),m.download="scene.obj",m.click();return}t.parse(u,e=>{try{console.log("SU connect with JS, gltf is exporting..."+e);let t=JSON.stringify(e);sketchup.import_window("window",t)}catch(a){console.log("Not Su");var t=JSON.stringify(e),i=new Blob([t],{type:"text/plain"});e instanceof ArrayBuffer&&(i=new Blob([e],{type:"application/octet-stream"}));var o=document.createElement("a");o.style.display="none",o.href=URL.createObjectURL(i),r.binary?o.download="rjh_test_"+Date.parse(new Date)+".glb":(editor.saveSceneJsonToFile(),o.download="rjh_test_"+Date.parse(new Date)+".gltf"),o.click()}},e=>{console.log("error",e)},r)}undo(){this.history.undo()}redo(){this.history.redo()}initMiniMap(){if(this.miniDom){var e=document.createElement("div");e.className="miniMapDom",e.style.width=this.miniMapWidth+"px",e.style.height=this.miniMapHeight+"px",e.style.pointerEvents="none";var t=document.createElement("div");t.style.pointerEvents="all",t.className="miniBox";var i=document.createElement("div");i.className="miniMapMan",e.appendChild(i),e.appendChild(t);var r=document.createElement("span");r.className="miniMapIcom miniMapNorth",e.appendChild(r),this.miniDom.appendChild(e),e.classList.add("show")}}setViewportCamera(e,t,i=!0){let r=1;for(let o in t.cameras){if("2D"==e&&"2dCamera"==t.cameras[o].name)t.list.default2D.dispatch(),t.viewportCamera=t.cameras[o],r=t.viewportCamera.zoom;else if("3D"==e&&"3dCamera"==t.cameras[o].name){t.lastCamera="3dCamera";let e=t.viewportCamera.position.clone();e.x/=1e3,e.y/=1e3,e.z/=1e3,t.viewportCamera=t.cameras[o];let a=t.viewportCamera.position.clone();if(t.viewportCamera.position.copy(e),i){let i=new $0a029741d8f7787c$export$208a41d6b4e37b97({x:e.x,y:e.y,z:e.z});i.onUpdate(e=>{t.viewportCamera.position.set(e.x,e.y,e.z)});let r=e.distanceTo(a)/.2/3;i.to({x:a.x,y:a.y,z:a.z},10*r).start()}r=t.viewportCamera.zoomNum}else"3DRoam"==e&&"3dRomaCamera"==t.cameras[o].name&&(t.lastCamera="3dRomaCamera",t.viewportCamera=t.cameras[o],t.roamTool&&t.roamTool.active());t.viewportCamera.sceneModel=e}t.list.threeDimensions.dispatch(e),t.list.changeCameraSlider.dispatch("2d",r),t.miniMapCamera=t.getOtherCamera(t.viewportCamera).clone(),t.list.viewportCameraChanged.dispatch(t,i)}getOtherCamera(e){let t=this,i=e.name,r="";for(let e in t.cameras)"2dCamera"==i?"3dCamera"==t.cameras[e].name&&(r=t.cameras[e]):"2dCamera"==t.cameras[e].name&&(r=t.cameras[e]);return r}focus(e){void 0!==e&&this.signals.objectFocused.dispatch(e)}focusById(e){this.focus(this.scene.getObjectById(e))}select(e){if(this.selected!==e){var t=null;null!==e&&(t=e.uuid),this.selected=e,this.config.setKey("selected",t),this.signals.objectSelected.dispatch(e)}}selectById(e){if(e===this.camera.id){this.select(this.camera);return}this.select(this.scene.getObjectById(e))}getWorldPosition(e){let t=new $4xklQ.Vector3(0,0,0);e.clientX||0==e.clientX?(t.x=e.clientX/window.innerWidth*2-1,t.y=-(2*(e.clientY/window.innerHeight))+1):(t.x=e.changedTouches[0].pageX/window.innerWidth*2-1,t.y=-(2*(e.changedTouches[0].pageY/window.innerHeight))+1);let i=[this.floor];i=(i=i.concat(this.wallGroup3D.children)).concat(this.floorGroup.children),this.raycaster.setFromCamera(t,this.camera);var r=this.raycaster.intersectObjects(i,!0);let o=new $4xklQ.Vector3(0,0,0);return r.length>0&&(o=r[0].point),o}getWallColor(e){return 0==e.style?this.cancelChooseHeavyColor:1==e.style?this.cancelChooseShortColor:this.cancelChooseColor}getScreenPosition(e){e=e.project(this.camera);let t=window.innerWidth/2,i=window.innerHeight/2;return{x:Math.round(e.x*t+t)-22,y:Math.round(-e.y*i+i)-10}}getDomById(e,t){let i=e.children,r="";for(let e=0;e<i.length;e++)i[e].id==t&&(r=i[e]);return r}getDomsByClassName(e,t){let i=e.children,r=[];for(let e=0;e<i.length;e++)i[e].className==t&&r.push(i[e]);return r}hiddenDomsByClassName(e,t){let i=e.children,r=[];for(let e=0;e<i.length;e++)i[e].className==t&&(i[e].display="none");return r}checkHasCurrentInput(e,t){let i=e.children,r=-1;for(let e=0;e<i.length;e++)i[e].id==t&&(r=e);return r}removeInputByClassName(e,t=""){let i=e.children,r="",o=[];for(let e=0;e<i.length;e++)(i[e].className==t||""==t)&&o.push(r=i[e]);return o.forEach(t=>{e.removeChild(t)}),r}removeInputById(e,t){let i=e.children,r="",o=[];for(let e=0;e<i.length;e++)i[e].id==t&&o.push(r=i[e]);return o.forEach(t=>{e.removeChild(t)}),r}removeHelperByWallId(e){let t=this.helperGroup.children;for(let i=0;i<t.length;i++)t[i].wallId&&t[i].wallId==e&&this.helperGroup.remove(t[i])}removeHelperByModelId(e){let t=this.helperGroup.children;this.removeInputByClassName(this.uiPanelBox.dom,"showModelDis");for(let i=0;i<t.length;i++)t[i].modelId&&t[i].modelId==e&&this.helperGroup.remove(t[i])}cleanWallHelper(){this.helperGroup.children=[];let e=this.uiPanelBox.dom,t=e.children,i=[];for(let e=0;e<t.length;e++)"roomName"==t[e].className&&i.push(t[e]);for(;e.hasChildNodes();)e.removeChild(e.firstChild);for(let t=0;t<i.length;t++)e.appendChild(i[t])}cleanModelHelper(){this.helperGroup.children=[],this.removeInputByClassName(this.uiPanelBox.dom,"showModelDis")}removeCircleHelper(e){let t=e.startPoint,i=e.endPoint,r=this.helperGroup.children;for(let e=0;e<r.length;e++){let o=r[e].startPoint,a=r[e].endPoint,n=(0,$9HO6e.UtilCore).isSameVector(t,o)||(0,$9HO6e.UtilCore).isSameVector(t,a),s=(0,$9HO6e.UtilCore).isSameVector(i,o)||(0,$9HO6e.UtilCore).isSameVector(i,a);n&&s&&(this.removeInputByClassName(this.uiPanelBox.dom,"showAngle"),this.helperGroup.remove(r[e]))}}removeHelperByWall(e,t=!0){let i=this.helperGroup.children,r=e.startPoint,o=e.endPoint;for(let e=0;e<i.length;e++){let t=i[e].startPoint,a=i[e].endPoint;if(!t||!a)continue;let n=(0,$9HO6e.UtilCore).isSameVector(r,t)||(0,$9HO6e.UtilCore).isSameVector(r,a),s=(0,$9HO6e.UtilCore).isSameVector(o,t)||(0,$9HO6e.UtilCore).isSameVector(o,a);n&&s&&(this.removeInputByClassName(this.uiPanelBox.dom,"showWallLength"+i[e].uuid),this.helperGroup.remove(i[e])),i[e]&&"miniCircle"==i[e].name&&(this.removeInputByClassName(this.uiPanelBox.dom,"showAngle"),this.helperGroup.remove(i[e]))}this.removeInputByClassName(this.uiPanelBox.dom,"showAngle"),t&&this.pointHelperGroup.children.slice(0).forEach(e=>{"bseControl"==e.useType&&this.pointHelperGroup.remove(e),"Mesh"!=e.type&&e.center&&((0,$9HO6e.UtilCore).isSameVector(r,e.center)&&this.pointHelperGroup.remove(e),(0,$9HO6e.UtilCore).isSameVector(o,e.center)&&this.pointHelperGroup.remove(e))})}changeWallLength(e,t,i,r=""){let o=new $4xklQ.Vector2(e.startPoint.x,e.startPoint.y),a=new $4xklQ.Vector2(e.endPoint.x,e.endPoint.y);if("start"==i){let i=a.clone().sub(o.clone());a=o.clone().add(i.setLength(t)),""!=r?e.startPoint=r:e.endPoint=a}else{let i=o.clone().sub(a.clone());o=a.clone().add(i.setLength(t)),""!=r?e.endPoint=r:e.startPoint=o}}getWallHelperByWall(e){let t="",i=this.helperGroup.children,r=e.startPoint,o=e.endPoint;for(let e=0;e<i.length;e++){if(!i[e].startPoint)continue;let a=i[e].startPoint,n=i[e].endPoint,s=(0,$9HO6e.UtilCore).isSameVector(r,a)||(0,$9HO6e.UtilCore).isSameVector(r,n),l=(0,$9HO6e.UtilCore).isSameVector(o,a)||(0,$9HO6e.UtilCore).isSameVector(o,n);s&&l&&(t=i[e])}return t}removeBSRHelper(){this.pointHelperGroup.children.slice(0).forEach(e=>{"bseControl"==e.useType&&this.pointHelperGroup.remove(e)}),this.helperGroup.children.slice(0).forEach(e=>{"bseLine"==e.lineType&&this.helperGroup.remove(e)})}removeDoor(e){this.scene.remove(e),this.otherMeshs.indexOf(e)>=0&&this.otherMeshs.splice(this.otherMeshs.indexOf(e),1)}removeMember(e){this.scene.remove(e),this.otherMember.indexOf(e)>=0&&this.otherMember.splice(this.otherMember.indexOf(e),1),e.threeD.parent.remove(e.threeD)}removeWall(e){e.parent&&e.parent.remove(e),this.allWalls.indexOf(e)>=0&&this.allWalls.splice(this.allWalls.indexOf(e),1),this.removeHelperByWall(e)}addWall(e,t,i=240,r=!0){let o=new $523a84362d27c3e8$export$b680ca477a72be07(this).createLineWall(e,t,i);return this.scene.add(o),this.allWalls.push(o),o.material.color=this.cancelChooseColor,this.addLineWallHelper(e,t,r),o}addArcWall(e,t,i,r){let o=new $523a84362d27c3e8$export$b680ca477a72be07(this).createCircleWall(e,t,i,r);return this.scene.add(o),this.allWalls.push(o),o.material.color=this.cancelChooseColor,o}getAllWindowInWall(e){let t=[];return this.otherMeshs.forEach(i=>{i.wallId==e.wallID?t.push(i):i.leftWindow&&(i.leftWindow[0].wallID==e.wallID||i.rightWindow[0].wallID==e.wallID)&&t.push(i)}),t}cleanScaleTool(){this.helperGroup.children.slice(0).forEach(e=>{e.useType&&"scaleHelpTool"==e.useType&&(this.helperGroup.remove(e),this.removeInputByClassName(this.uiPanelBox.dom,"showScaleLength"+e.uuid))}),this.pointHelperGroup.children=[]}getMap(){let e="";return this.scene.children.forEach(t=>{"mapImage"==t.useType&&(e=t)}),e}allHelperForScaleTool(e,t){let i=new $d0f874000594cf7a$export$a955f3d6a39ce4b2,r=this.getMap(),o=(0,$9QhXH.DM).createScaleTool(e,t);o.useType="scaleHelpTool",o.startPoint=e,o.endPoint=t;let a=i.createLineDimensionsLine(t,e,!1);a.useType="scaleHelpTool";let n=this.getScreenPosition(a.center.clone()),s=new(0,$3BPdS.UIInput)("").setFontSize("15px").setWidth("70px").onKeyDown((function(e){if("Tab"==e.key&&e.preventDefault(),"13"==e.keyCode){let e=s.dom.value;if(!e)return;let t=e/a.lineLength;this.camera.zoom=t,this.camera.updateProjectionMatrix(),this.globalControl.update(),this.cleanScaleTool(),r.scale.set(t,t,1)}}).bind(this)).onBlur((function(e){let t=s.dom.value;if(!t||t==a.lineLength)return;let i=t/a.lineLength;this.camera.zoom=i,this.camera.updateProjectionMatrix(),this.globalControl.update(),this.cleanScaleTool(),r.scale.set(i,i,1)}).bind(this));s.setNumber();let l=new(0,$3BPdS.UIText)("mm").setMarginLeft("80px").setStyle(["z-index"],[10]);l.dom.style.fontSize="14px",l.dom.style.color="#000",n.y+=20;let h=new(0,$3BPdS.UIDiv)().setClass("showScaleLength"+a.uuid).setMarginTop(n.y+"px").setMarginLeft(n.x+"px"),c=a.center.x+"/"+a.center.y+"/"+a.center.z;h.setAttribute("worldPosition",c),h.add(l,s),this.uiPanelBox.add(h),this.helperGroup.add(a),this.pointHelperGroup.add(o);let d=i.createScaleToolPoint(e,"start"),p=i.createScaleToolPoint(t,"end");return d.useType="scaleRuleTool",d.otherPosition=t,p.useType="scaleRuleTool",p.otherPosition=e,this.pointHelperGroup.add(d),this.pointHelperGroup.add(p),o}addLineWallHelper(e,t,i=!0,r="",o="",a=160){let n="";return""==r?n=new $002a82be864d68ed$export$a80d7a02e87abd45(this).addLineWallHelper(e,t):((n=new $002a82be864d68ed$export$a80d7a02e87abd45(this).addLineWallHelper(r,o,a)).startPoint=e,n.endPoint=t,n.newStart=r,n.newEnd=o),i&&this.addArcPointHelper(e,t),n}addBSRWallHelper(e){new $002a82be864d68ed$export$a80d7a02e87abd45(this).addBSRWallHelper(e)}getNWalls(e,t,i){let r=(0,$2C75G.WallCreator).findCrossWall(e.startPoint,e.endPoint,t);if(r[0].length>0||r[1].length>1){let e=[...r[0],...r[1]];i.push(...e),e.forEach(e=>{t.splice(t.indexOf(e),1)}),e.forEach(e=>{this.getNWalls(e,t,i)})}}getOuterMidPoints(e){let t=Array.from(this.allWalls);t.splice(t.indexOf(e),1);let i=[e];this.getNWalls(e,t,i);let r=[],o=[],a=[],n=[];i.forEach(e=>{let t=[e.parameter.points[0].x,e.parameter.points[0].y],i=[e.parameter.points[3].x,e.parameter.points[3].y],a=[e.parameter.points[2].x,e.parameter.points[2].y],s=[e.parameter.points[5].x,e.parameter.points[5].y];r.push(t,i,a,s),o.push([t,i],[a,s]),n.push(e.startPoint,e.endPoint)}),n=(0,$hrM0U.CommonFunc).filterArray3(n);let s=new $4xklQ.Box2().setFromPoints(n),l=[s.min.clone(),new $4xklQ.Vector2(s.min.x,s.max.y),s.max.clone(),new $4xklQ.Vector2(s.max.x,s.min.y)];r=(0,$hrM0U.CommonFunc).filterArray2(r);let h=[];r.forEach(e=>{h.push({x:e[0],y:e[1],adj:[]})}),o.forEach(e=>{a.push([(0,$hrM0U.CommonFunc).getIndex(r,e[0]),(0,$hrM0U.CommonFunc).getIndex(r,e[1])])}),a.forEach(e=>{let t=h[e[0]],i=h[e[1]];t.adj.push(i),i.adj.push(t)});let c=$2176137edde06fbe$export$fee71b7b1f0877fa(h),d=[];if(c.length>0){let e=c[0];for(let t=1;t<c.length;t++)c[t].length>e.length&&(e=c[t]);let t=[];e.forEach(e=>{t.push(new $4xklQ.Vector2(e.x,e.y))});for(let e=0;e<t.length;e++){let r=e==t.length-1?0:e+1;i.forEach(i=>{if((0,$hrM0U.CommonFunc).isInclude(i.parameter.points,t[e])&&(0,$hrM0U.CommonFunc).isInclude(i.parameter.points,t[r])){d.push(i.startPoint,i.endPoint);return}})}}else i.forEach(e=>{d.push(e.startPoint,e.endPoint)});return[d=(0,$hrM0U.CommonFunc).filterArray3(d),l,i]}getOrderPoints(e,t,i){let r=e.distanceTo(i[0])+t.distanceTo(i[0]),o=e.distanceTo(i[1])+t.distanceTo(i[1]),a=e.distanceTo(i[2])+t.distanceTo(i[2]),n=e.distanceTo(i[3])+t.distanceTo(i[3]),s=Math.min(r,o,a,n);return r==s?e.distanceTo(i[0])>t.distanceTo(i[0])?[e,t]:[t,e]:o==s?e.distanceTo(i[1])>t.distanceTo(i[1])?[e,t]:[t,e]:a==s?e.distanceTo(i[2])>t.distanceTo(i[2])?[e,t]:[t,e]:n==s?e.distanceTo(i[3])>t.distanceTo(i[3])?[e,t]:[t,e]:void 0}getCross(e,t){let i=[];return t.forEach(t=>{(t.startPoint.equals(e)||t.endPoint.equals(e))&&i.push(t)}),i}getFinalEquation(e,t,i,r){let o=e.distanceTo(t),a=t.clone().sub(e).normalize(),n=Math.asin(i/o),s=Math.tan("MORE"==r?a.angle()-n:a.angle()+n);return{slope:s,constant:t.y-s*t.x}}getRightWall(e,t,i){if(1==e.length){let i=e[0],r=i.startPoint.equals(t)?i.endPoint:i.startPoint;return[i,r,i,r]}let r=[],o=[];return 0==i||i==2*Math.PI?e.forEach(e=>{let i=e.startPoint.equals(t)?e.endPoint:e.startPoint,a=i.clone().sub(t).angle();0==r.length?r=[a,e,i]:a<r[0]&&(r=[a,e,i]),0==o.length?o=[a,e,i]:a>o[0]&&(o=[a,e,i])}):e.forEach(e=>{let a=e.startPoint.equals(t)?e.endPoint:e.startPoint,n=a.clone().sub(t).angle();n=0==n?2*Math.PI:n,0==r.length?r.push(n,e,a):n>i?(n<r[0]||r[0]<i)&&(r=[n,e,a]):r[0]<i&&n<r[0]&&(r=[n,e,a]),n=n==2*Math.PI?0:n,0==o.length?o.push(n,e,a):n<i?(n>o[0]||o[0]>i)&&(o=[n,e,a]):o[0]>i&&n>o[0]&&(o=[n,e,a])}),[r[1],r[2],o[1],o[2]]}inputChangeWall(e,t,i,r){let o=t.newStart||t.startPoint,a=t.newEnd||t.endPoint,n=e.getIndex(o),s=e.getIndex(a),[l,h,c]=this.getOuterMidPoints(e);(0,$hrM0U.CommonFunc).isInclude(l,e.startPoint),(0,$hrM0U.CommonFunc).isInclude(l,e.endPoint);let d=Math.round(o.distanceTo(a)),p=e.startPoint,u=e.endPoint,m=[[(0,$9HO6e.UtilCore).getNewPoint(e),(0,$9HO6e.UtilCore).getNewPoint(e,"end"),e]];if("start"==r||"center"==r){let t,l=u.clone().sub(p),h=Math.abs(i-d);"center"==r&&(h/=2),d<i&&l.negate();let g=(n>s?a:o).clone().add(l.setLength(h)),f=d<i?l.clone().negate().angle():l.angle(),w=this.getCross(p,c);if(w.splice(w.indexOf(e),1),w.forEach(e=>{m.push([(0,$9HO6e.UtilCore).getNewPoint(e),(0,$9HO6e.UtilCore).getNewPoint(e,"end"),e])}),w.length>0){let i,r,o;let a=this.getRightWall(w,p,f);[0,3].includes(n)?(i=a[0],r=a[1],o="MORE"):[2,5].includes(n)&&(i=a[2],r=a[3],o="LESS");let s=this.getFinalEquation(g,r,i.thickness/2,o);t=(0,$hrM0U.CommonFunc).getIntersectPoint(e.parameter.middleLineEquation,s)}else t=p.clone().add(l.setLength(h));[...w,e].forEach(e=>{let i=this.getWallHelperByWall(e);i&&this.removeHelperByWall(i),e.startPoint.equals(p)?e.startPoint=t:e.endPoint=t})}if("end"==r||"center"==r){let t,l=p.clone().sub(u),h=Math.abs(i-d);"center"==r&&(h/=2),d<i&&l.negate();let g=(n>s?o:a).clone().add(l.setLength(h)),f=i>d?l.clone().negate().angle():l.angle(),w=this.getCross(u,c);if(w.splice(w.indexOf(e),1),w.forEach(e=>{m.push([(0,$9HO6e.UtilCore).getNewPoint(e),(0,$9HO6e.UtilCore).getNewPoint(e,"end"),e])}),w.length>0){let i,r,o;let a=this.getRightWall(w,u,f);[0,3].includes(n)?(i=a[2],r=a[3],o="LESS"):[2,5].includes(n)&&(i=a[0],r=a[1],o="MORE");let s=this.getFinalEquation(g,r,i.thickness/2,o);t=(0,$hrM0U.CommonFunc).getIntersectPoint(e.parameter.middleLineEquation,s)}else t=u.clone().add(l.setLength(h));[...w,e].forEach(e=>{let i=this.getWallHelperByWall(e);i&&this.removeHelperByWall(i),e.startPoint.equals(u)?e.startPoint=t:e.endPoint=t})}let g=(0,$9QhXH.DM).getWallJson(this.allWalls);this.allWalls=new(0,$5XTH3.DrawWallTool)().create2DWall(g),this.allWalls.pop(),m.forEach(e=>{let t=this.getAllWindowInWall(e[2]),i=e[0].clone(),r=e[1].clone();if(0==t.length)return;let o=this.getWallByWallId(e[2].wallID),a=(0,$9HO6e.UtilCore).getNewPoint(o),n=(0,$9HO6e.UtilCore).getNewPoint(o,"end");t.forEach(t=>{let s=1*(0,$9HO6e.UtilCore).toVector3(t.center).distanceTo((0,$9HO6e.UtilCore).toVector3(i)),l=1*(0,$9HO6e.UtilCore).toVector3(t.center).distanceTo((0,$9HO6e.UtilCore).toVector3(r));""==this.doorDistance&&(this.doorDistance=s<l?[s,i,r,"start"]:[l,r,i,"end"]);let h=e[2].endPoint.clone().sub(e[2].startPoint.clone()),c=a.clone().add(h.setLength(this.doorDistance[0]));"end"==this.doorDistance[3]&&(h=e[2].startPoint.clone().sub(e[2].endPoint.clone()),c=n.clone().add(h.setLength(this.doorDistance[0]))),this.currentDoor=t,new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this,"door","end",[t,[c,o,o],"wall"]).execute(),this.doorHelperGroupClean(),this.currentDoor="",this.doorDistance=""})}),new $523a84362d27c3e8$export$b680ca477a72be07(this).wallToJson()}inputChangeLinkWall(e,t,i,r,o,a,n){let s=a.clone(),l=(0,$9HO6e.UtilCore).getRealWallByIntersection(e,t,i,a,r),h=a.clone().add(o),c=[];if(l){let i=(0,$9HO6e.UtilCore).handleLineData(e.startPoint,e.endPoint),r=(0,$9HO6e.UtilCore).moveLineToPoint(t,i.slice(0)),o=(0,$9HO6e.UtilCore).handleLineData(l.startPoint,l.endPoint),a=(0,$9HO6e.UtilCore).lineIsIntersection(r,o);a&&(h=a)}if(2==n.length)this.removeHelperByWall(i[0],!0),c.push([(0,$9HO6e.UtilCore).getNewPoint(i[0]),(0,$9HO6e.UtilCore).getNewPoint(i[0],"end"),i[0]]),(0,$9HO6e.UtilCore).isSameVector(i[0].startPoint,s)?i[0].startPoint=h:i[0].endPoint=h;else if(n.length>2&&l&&!(0,$9HO6e.UtilCore).pointIsInLine(h,l.startPoint,l.endPoint)){let t=!1;if(n.forEach(i=>{i.uuid!=e.uuid&&(0,$9HO6e.UtilCore).checkWallContainPointNew(i.startPoint,i.endPoint,h)&&(t=!0)}),!t){let e=this.addWall(s,h,l.thickness,!1);e.style=l.style,e.height=l.height,e.thickness=l.thickness}}let d=[];return n.forEach(t=>{t.uuid!=e.uuid&&d.push(t)}),2==d.length&&(0,$9HO6e.UtilCore).wallIsInLine(d[0],d[1])&&this.margeWall(d[0],d[1]),"end"==r?(e.startPoint=t,e.endPoint=h):(e.startPoint=h,e.endPoint=t),c}getNextWallInput(e){let t=this.uiPanelBox.dom.children,i=[],r=0,o=0;for(let a=0;a<t.length;a++)"INPUT"==t[a].tagName&&(t[a].className.indexOf("showWallLength")>=0||t[a].className.indexOf("showAngle")>=0)&&(i.push(t[a]),t[a].className==e.className&&(o=r),r++);return o==i.length-1?i[0]:i[o+1]}changTextToInput(e,t="",i="",r="",o="",a=""){let n=this.getWallHelperByWall(e),s=this.removeInputByClassName(this.uiPanelBox.dom,"showWallLength"+n.uuid);if(!s||""!=s&&"none"==s.style.display)return;let l=e.startPoint.clone().distanceTo(e.endPoint),h=(0,$9HO6e.UtilCore).handleLineData(e.startPoint,e.endPoint),c=(0,$9HO6e.UtilCore).smallDistanceByPointOnLine(h,this.currentPoint.clone()).clone().distanceTo(e.startPoint),d=l/this.config.wallNum,p="";c>=0&&c<=d&&(p="start"),c>d&&c<=d*(this.config.wallNum-1)&&(p="center"),c>d*(this.config.wallNum-1)&&c<=l&&(p="end");let u=new(0,$3BPdS.UIInput)(s.textContent).setClass(s.className).setFontSize("15px").setWidth("40px").setId(s.className).setMarginTop(s.style.marginTop).setMarginLeft(s.style.marginLeft).onKeyDown((function(l){if("Tab"==l.key){let e=editor.getNextWallInput(u.dom);e.focus(),e.select(),l.preventDefault()}if("13"==l.keyCode){let l=u.dom.value;if(l<0)return;if(n&&this.removeHelperByWall(n),this.execute(),t){let n=[];t=t.clone();let h=(0,$9HO6e.UtilCore).getMeshOtherPoint(e,t),c=this.clickSelect[0].object,d=(0,$9HO6e.UtilCore).getNewPoint(c),p=(0,$9HO6e.UtilCore).getNewPoint(c,"end"),u=h.clone().sub(t).setLength(1*s.textContent-1*l),m=t.clone().add(u),g=(0,$9HO6e.UtilCore).isSameVector(t,c.startPoint)?"end":"start",f="start"==g?c.startPoint.clone():c.endPoint.clone();if(this.removeHelperByWall(c,!0),2==o.length)this.removeHelperByWall(i[0],!0),n.push([(0,$9HO6e.UtilCore).getNewPoint(i[0]),(0,$9HO6e.UtilCore).getNewPoint(i[0],"end"),i[0]]),(0,$9HO6e.UtilCore).isSameVector(i[0].startPoint,t)?i[0].startPoint=m:i[0].endPoint=m;else if(o.length>2){if(!(0,$9HO6e.UtilCore).pointIsInLine(m,e.startPoint,e.endPoint)){let i=!1;if(o.forEach(t=>{t.uuid!=e.uuid&&(0,$9HO6e.UtilCore).checkWallContainPointNew(t.startPoint,t.endPoint,m)&&(i=!0)}),!i){let i=this.addWall(t,m,e.thickness,!1);i.style=e.style,i.height=e.height,i.thickness=e.thickness}}let i=[];o.forEach(e=>{e.uuid!=c.uuid&&i.push(e)}),2==i.length&&(0,$9HO6e.UtilCore).wallIsInLine(i[0],i[1])&&this.margeWall(i[0],i[1])}let w=this.inputChangeLinkWall(c,m,r,g,u,f,a);n=n.concat(w);let y=new $46f32ef2047263b6$export$6bf150a1b9f8c161(this);this.currenDraw=c,y.splitMain();let b=(0,$9QhXH.DM).getWallJson(this.allWalls),x=new $5XTH3.DrawWallTool;this.allWalls=x.create2DWall(b),this.allWalls.pop(),n.forEach(e=>{let t=this.getAllWindowInWall(e[2]),i=e[0].clone(),r=e[1].clone();if(0==t.length)return;let o=this.getWallByWallId(e[2].wallID),a=(0,$9HO6e.UtilCore).getNewPoint(o),n=(0,$9HO6e.UtilCore).getNewPoint(o,"end");t.forEach(t=>{let s=1*(0,$9HO6e.UtilCore).toVector3(t.center).distanceTo((0,$9HO6e.UtilCore).toVector3(i)),l=1*(0,$9HO6e.UtilCore).toVector3(t.center).distanceTo((0,$9HO6e.UtilCore).toVector3(r));""==this.doorDistance&&(this.doorDistance=s<l?[s,i,r,"start"]:[l,r,i,"end"]);let h=e[2].endPoint.clone().sub(e[2].startPoint.clone()),c=a.clone().add(h.setLength(this.doorDistance[0]));"end"==this.doorDistance[3]&&(h=e[2].startPoint.clone().sub(e[2].endPoint.clone()),c=n.clone().add(h.setLength(this.doorDistance[0]))),this.currentDoor=t,new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this,"door","end",[t,[c,o,o],"wall"]).execute(),this.doorHelperGroupClean(),this.currentDoor="",this.doorDistance=""})});let P=this.getAllWindowInWall(c);if(P.length>0){let e=this.getWallByWallId(c.wallID),t=(0,$9HO6e.UtilCore).getNewPoint(e),i=(0,$9HO6e.UtilCore).getNewPoint(e,"end");P.forEach(r=>{if(!r.center)return;let o=1*(0,$9HO6e.UtilCore).toVector3(r.center).distanceTo((0,$9HO6e.UtilCore).toVector3(d)),a=1*(0,$9HO6e.UtilCore).toVector3(r.center).distanceTo((0,$9HO6e.UtilCore).toVector3(p));""==this.doorDistance&&(this.doorDistance=o<a?[o,d,p,"start"]:[a,p,d,"end"]);let n=e.endPoint.clone().sub(e.startPoint.clone()),s=t.clone().add(n.setLength(this.doorDistance[0]));"end"==this.doorDistance[3]&&(n=e.startPoint.clone().sub(e.endPoint.clone()),s=i.clone().add(n.setLength(this.doorDistance[0]))),this.currentDoor=r,new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this,"door","end",[r,[s,e,e],"wall"]).execute(),this.doorHelperGroupClean(),this.currentDoor="",this.doorDistance=""})}new $523a84362d27c3e8$export$b680ca477a72be07(this).wallToJson();return}this.inputChangeWall(e,n,l,p)}}).bind(this));u.setAttribute("worldPosition",s.getAttribute("worldPosition")),u.setAttribute("angle",s.getAttribute("angle"));let m=(0,$9HO6e.UtilCore).havePointWall(e.startPoint,this.allWalls),g=(0,$9HO6e.UtilCore).havePointWall(e.endPoint,this.allWalls);if(!(m.length>1&&g.length>1)){let i=e.startPoint,r=m;1==m.length&&(i=e.endPoint,r=g);let o=[],a=(0,$9HO6e.UtilCore).getMeshOtherPoint(e,i).clone().sub(i.clone());r.forEach(t=>{if(t.wallID==e.wallID)return;let r=(0,$9HO6e.UtilCore).getMeshOtherPoint(t,i).clone().sub(i.clone()),n=(0,$9HO6e.UtilCore).toVector3(r).angleTo((0,$9HO6e.UtilCore).toVector3(a));n=Math.round(180/Math.PI*n),o.push(n)});let n=Math.min.apply(null,o),s=o.indexOf(n),l=[];if(r.forEach(t=>{t.wallID!=e.wallID&&l.push(t)}),s>=0&&!t){let t=l[s],r=this.wallHelp.createCircleLine(i,t,e);r.wallId=e.wallID,r.startPoint=e.startPoint,r.endPoint=e.endPoint,r.name="miniCircle",this.helperGroup.add(r);let o=this.getScreenPosition(r.center.clone()),a=new(0,$3BPdS.UIInput)(r.realAngle).setClass("showAngle").setId("realAngleInput").setFontSize("15px").setWidth("40px").setMarginTop(o.y+"px").setMarginLeft(o.x+"px").setFocus().onKeyDown((function(o){if("Tab"==o.key){let e=editor.getNextWallInput(a.dom);e.focus(),e.select(),o.preventDefault()}if("Escape"==o.key&&this.exitTool(),"13"==o.keyCode){let o=(0,$9HO6e.UtilCore).getMeshOtherPoint(t,i),n=(0,$9HO6e.UtilCore).getMeshOtherPoint(e,i),s=(0,$9HO6e.UtilCore).getClockWise(o,i,n);s=s>0?-1:1;let l=u.dom.value,h=a.dom.value;h=1*h.replace(/°/g,""),h=Math.PI/180*(Math.round(180/Math.PI*(0,$9HO6e.UtilCore).toVector2(o.clone().sub(i.clone())).angle())+h*s);let c=new $4xklQ.Vector3(1,0,0);c.applyEuler(new $4xklQ.Euler(0,0,h,"XYZ")),this.removeHelperByWall(r),(0,$9HO6e.UtilCore).isSameVector(i,e.startPoint)?(i=e.startPoint.clone().add(c.setLength(l)),e.endPoint=i):(i=e.endPoint.clone().add(c.setLength(l)),e.startPoint=i),new $523a84362d27c3e8$export$b680ca477a72be07(this).wallToJson()}}).bind(this));a.dom.addEventListener("mousedown",(function(e){2==e.button&&this.camera.isOrthographicCamera&&this.editor.exitTool()}).bind(this)),this.uiPanelBox.add(a)}}this.uiPanelBox.add(u)}changInputToText(e){this.removeInputByClassName(this.uiPanelBox.dom,e.className);let t=new(0,$3BPdS.UIText)(e.value).setClass(e.className).setFontSize("15px").setWidth("40px").setMarginTop(e.style.marginTop).setMarginLeft(e.style.marginLeft).setStyle(["transform"],["rotate("+e.getAttribute("angle")+"deg)"]);t.setAttribute("worldPosition",e.getAttribute("worldPosition")),t.setAttribute("angle",e.getAttribute("angle")),this.uiPanelBox.add(t)}changAllInputToText(){let e=this.uiPanelBox.dom.children;for(let t=0;t<e.length;t++)"INPUT"==e[t].tagName&&e[t].className.indexOf("showWallLength")>=0&&this.changInputToText(e[t])}getWallByWallId(e){let t="";return this.allWalls.forEach(i=>{i.wallID==e&&(t=i)}),t}get3dWallByWallId(e){let t="";return this.wallGroup3D.children.slice(0).forEach(i=>{i.wallID==e&&(t=i)}),t}changeClickColor(e){e&&e.children.forEach(e=>{("Line"==e.type||"Line2"==e.type||"DWHelper"==e.type)&&(e.material.color=this.clickColor)})}addLineHelperForDoor(e,t=!1){if(!e.wallId||!e.startPoint)return;let i=this.getWallByWallId(e.wallId);if(""==i)return;let r=new $4xklQ.Vector3(i.startPoint.x,i.startPoint.y,0),o=new $4xklQ.Vector3(i.endPoint.x,i.endPoint.y,0);if(10>r.clone().distanceTo(o.clone()))return;let a=new $aa3f6685526d27fa$export$d9f78ae40723f6c8(this);"UWindow"==e.modelType?a.addUWindowHelper(i,e,t):"LWindow"==e.modelType?a.addLWindowHelper(e,t):"arcWindow"==e.modelType?a.addArcWindowHelper(e):a.addDoorHelper(i,e,t),this.changeClickColor(e)}addLineHelperForMember(e){this.cleanWallHelper(),this.doorHelperGroupClean(),this.changeClickColor(e);let t=new $d1f58c4378eaed8a$export$79a920aedf5098c2(this).addMemberHelper(e);this.pointHelperGroup.add(...t)}doorHelperGroupClean(){let e=this.pointHelperGroup.children.slice(0);e.forEach(e=>{e.useType&&("scaleTool"==e.useType||"rotateTool"==e.useType)&&this.pointHelperGroup.remove(e)}),e=this.helperGroup.children.slice(0),this.removeInputByClassName(this.uiPanelBox.dom,"showModelDis"),e.forEach(e=>{e.modelId&&this.helperGroup.remove(e)}),this.doorHelperGroup.children.forEach(e=>{this.removeInputByClassName(this.uiPanelBox.dom,"showDoorLength"+e.uuid)}),(e=this.pointHelperGroup.children.slice(0)).forEach(e=>{"Mesh"==e.type&&this.pointHelperGroup.remove(e)}),this.doorHelperGroup.children=[],this.otherMeshs.concat(this.otherMember).forEach(e=>{e.children.forEach(e=>{("Line"==e.type||"Line2"==e.type||"DWHelper"==e.type)&&(e.material.color=this.moveDoorOutColor)})})}addArcPointHelper(e,t){let i=new $d0f874000594cf7a$export$a955f3d6a39ce4b2,r=this.pointHelperGroup.children.slice(0),o=!0,a=!0;this.allWalls.forEach(i=>{let r=i.startPoint,n=i.endPoint,s=(0,$9HO6e.UtilCore).isSameVector(e,r)||(0,$9HO6e.UtilCore).isSameVector(e,n),l=(0,$9HO6e.UtilCore).isSameVector(t,r)||(0,$9HO6e.UtilCore).isSameVector(t,n);s&&l||(s&&(o=!1),l&&(a=!1))});let n=!1,s=!1;r.forEach(i=>{"Mesh"!=i.type&&i.center&&((0,$9HO6e.UtilCore).isSameVector(e,i.center)&&(n=!0),(0,$9HO6e.UtilCore).isSameVector(t,i.center)&&(s=!0),(0,$9HO6e.UtilCore).isSameVector(e,i.center)&&!o&&this.pointHelperGroup.remove(i),(0,$9HO6e.UtilCore).isSameVector(t,i.center)&&!a&&this.pointHelperGroup.remove(i))}),this.innerDraw,o&&!n&&this.pointHelperGroup.add(i.createPoint(e)),a&&!s&&this.pointHelperGroup.add(i.createPoint(t))}addIntersectPointHelper(){let e=new $d0f874000594cf7a$export$a955f3d6a39ce4b2,t=[];this.allWalls.forEach(e=>{let i=e.startPoint.clone(),r=e.endPoint.clone(),o=!1,a=!1;t.forEach(e=>{(0,$9HO6e.UtilCore).isSameVector(e,i)&&(o=!0),(0,$9HO6e.UtilCore).isSameVector(e,r)&&(a=!0)}),o||t.push(i),a||t.push(r)});let i=this.pointHelperGroup.children.slice(0);t.forEach(t=>{let r=0,o=[];this.allWalls.forEach(e=>{let i=e.startPoint.clone(),a=e.endPoint.clone();(0,$9HO6e.UtilCore).isSameVector(t,i)&&r++,(0,$9HO6e.UtilCore).isSameVector(t,a)&&r++,((0,$9HO6e.UtilCore).isSameVector(t,i)||(0,$9HO6e.UtilCore).isSameVector(t,a))&&o.push(1*e.thickness)});let a=Math.min.apply(null,o);if(r>1){let r=!1;i.forEach(e=>{if("Mesh"!=e.type&&e.center&&(0,$9HO6e.UtilCore).isSameVector(t,e.center)){r=!0;return}}),r||this.pointHelperGroup.add(e.createDragPoint(t,"",a/3))}else if(1==r){let r=!1;i.forEach(e=>{if("Mesh"!=e.type&&e.center&&(0,$9HO6e.UtilCore).isSameVector(t,e.center)){r=!0;return}}),r||this.pointHelperGroup.add(e.createPoint(t,"",a/3))}})}switchHelperGroup(e="show",t=!0){let i=this.uiPanelBox.dom.children;if(0!=i.length)for(let t=0;t<i.length;t++)"show"==e&&(i[t].className.indexOf("showWallLength")>=0?this.config.settingJson.dimension&&(i[t].style.display="block"):i[t].style.display="inline-block"),"hidden"==e&&(i[t].style.display="none")}updateDom(){let e=this.uiPanelBox.dom.children;if(0!=e.length)for(let t=0;t<e.length;t++){if(!e[t].getAttribute("worldPosition"))continue;let i=e[t].getAttribute("worldPosition").split("/"),r=new $4xklQ.Vector3(i[0],i[1],i[2]),o=this.getScreenPosition(r);e[t].className.indexOf("showScaleLength")>=0&&(o.y+=20),e[t].style.marginTop=o.y+"px",e[t].style.marginLeft=o.x+"px"}}getDisByScreen(){let e=this.getScreen(new $4xklQ.Vector3(100,0,0),this.camera),t=this.getScreen(new $4xklQ.Vector3(0,0,0),this.camera);return Math.round(e[0]-t[0])/20}getDialogPosition(e,t,i=""){let r=30,o="";o=""!=i?(0,$9HO6e.UtilCore).toVector3(i).project(this.camera):e.x<t.x?t.clone().project(this.camera):e.clone().project(this.camera);let a=window.innerWidth/2,n=window.innerHeight/2,s=[Math.round(o.x*a+a),Math.round(-o.y*n+n)];return s[0]+=r,s[1]-=2*r,s}get3DModelDialogPosition(e,t=50){let i=new(0,$4xklQ.Box3)().setFromObject(e),r=1*(i.max.y-i.min.y).toFixed(2)/2;e.height&&(r=1*e.height/2),e.updateMatrixWorld(!0);var o=new $4xklQ.Vector3;e.getWorldPosition(o),o.y+=r;let a=o.project(this.camera),n=window.innerWidth/2,s=window.innerHeight/2,l=[Math.round(a.x*n+n),Math.round(-a.y*s+s)];return l[0]+=2*t,l[1]-=t,l}updateDialogPosition(e){if(!e.useType||!e.startPoint)return;let t=this.getDialogPosition(new $4xklQ.Vector3(e.startPoint.x,e.startPoint.y,0),new $4xklQ.Vector3(e.endPoint.x,e.endPoint.y,0));this.list.showDialog.dispatch(0,"wall",t,[])}addBoxForMesh(e,t){if(e.geometry){let t=new $4xklQ.EdgesGeometry(e.geometry,4),i=new $4xklQ.LineSegments(t,this.boxLineMaterial);e.updateWorldMatrix(!0);let r=e.position.clone();e.parent&&e.parent.localToWorld(r),this.lineGroup3D.updateWorldMatrix(!0),this.lineGroup3D.worldToLocal(r);let o=this.getOuterParent(e),a=o.rotation;"CodeModel"==o.modelType&&i.rotation.set(a.x,a.y,a.z),i.position.copy(r),this.lineGroup3D.add(i)}else e.children.forEach(e=>{this.addBoxForMesh(e,t)})}addPositionHelper(e,t=!1){let i,r,o,a,n=0,s=parseInt(180/Math.PI*(n=e.rotation.z));s<0&&(s+=360);let l=(0,$9HO6e.UtilCore).getModelVertex(e);if(s>355||s<=5||s>85&&s<=95||s>175&&s<=185||s>265&&s<=275){let e=[l[4].x,l[5].x,l[6].x,l[7].x].sort(function(e,t){return e-t}),t=[l[4].y,l[5].y,l[6].y,l[7].y].sort(function(e,t){return e-t});for(let n=4;n<l.length;n++).01>Math.abs(l[n].y-t[t.length-1])&&(.01>Math.abs(l[n].x-e[1])||.01>Math.abs(l[n].x-e[2]))&&(i=l[n]),.01>Math.abs(l[n].y-t[0])&&(.01>Math.abs(l[n].x-e[1])||.01>Math.abs(l[n].x-e[2]))&&(r=l[n]),(.01>Math.abs(l[n].y-t[1])||.01>Math.abs(l[n].y-t[2]))&&.01>Math.abs(l[n].x-e[0])&&(o=l[n]),(.01>Math.abs(l[n].y-t[1])||.01>Math.abs(l[n].y-t[2]))&&.01>Math.abs(l[n].x-e[e.length-1])&&(a=l[n])}else{let e=[l[0].x,l[1].x,l[2].x,l[3].x],t=[l[0].y,l[1].y,l[2].y,l[3].y],n=e.indexOf(Math.min(...e)),s=e.indexOf(Math.max(...e)),h=t.indexOf(Math.min(...t));i=l[t.indexOf(Math.max(...t))],r=l[h],o=l[n],a=l[s]}let h=[[0,1],[0,-1],[-1,0],[1,0]];if(!(l=[i,r,o,a])[0])return;i=["Y","",l[0].x],r=["Y","",l[1].x],o=["X","",l[2].y],a=["X","",l[3].y];let c=[[],[],[],[]],d=[[],[],[],[]],p=this.allWalls.slice(0);(p=(p=p.concat(this.model2D.children)).concat(this.otherMember)).forEach(t=>{if(t.id==e.id)return;let i=[];if(t.geometry&&"2DModel"!=t.modelType){let e=t.geometry.attributes.position.array;i=[e[0],e[1],e[9],e[10],e[15],e[16],e[6],e[7]]}else{let e=(0,$9HO6e.UtilCore).getModelVertex(t);i=[e[0].x,e[0].y,e[3].x,e[3].y,e[2].x,e[2].y,e[1].x,e[1].y]}for(let e=0;e<=3;e++){let t=h[e],r=PolyK.Raycast(i,l[e].x,l[e].y,t[0],t[1]);if(r){let i=l[e].clone().add(new(0,$4xklQ.Vector3)(t[0],t[1],0).setLength(r.dist));c[e].push(i),d[e].push(r.dist)}}});let u=Math.min.apply(null,d[0]),m=Math.min.apply(null,d[1]),g=Math.min.apply(null,d[2]),f=Math.min.apply(null,d[3]);this.addMinDisInput(c[0],l[0],u,"top",e,t),this.addMinDisInput(c[1],l[1],m,"bot",e,t),this.addMinDisInput(c[2],l[2],g,"lef",e,t),this.addMinDisInput(c[3],l[3],f,"rig",e,t)}addMinDisInput(e,t,i,r,o,a){e.forEach(e=>{if(.01>Math.abs((0,$9HO6e.UtilCore).toVector3(e).distanceTo((0,$9HO6e.UtilCore).toVector3(t))-i)){let i=this.wallHelp.createLineDimensionsLine(t,e,!1,10);i.modelId=o.id;let n=new(0,$4xklQ.Vector2)(e.x,e.y).sub(new $4xklQ.Vector2(t.x,t.y)).angle();(n=180/Math.PI*n)>180&&n<270?n=360-n+180:n>90&&n<=180?(n*=-1,n+=180):n=360-n;let s=this.getScreenPosition(i.center.clone()),l=new(0,$3BPdS.UIText)(i.lineLength).setClass("showModelDis").setFontSize("15px").setWidth("40px").setMarginTop(s.y+"px").setMarginLeft(s.x+"px").setStyle(["transform"],["rotate("+n+"deg)"]);if(a){let e=["top","rig","bot","lef"],t=e.indexOf(r),a="showModelDis"+(t==e.length-1?"top":e[t+1]),n="showModelDis"+r;l=new(0,$3BPdS.UIInput)(i.lineLength).setClass("showModelDis").setFontSize("15px").setWidth("40px").setId(n).setMarginTop(s.y+"px").setMarginLeft(s.x+"px").onKeyDown((function(e){if("Tab"==e.key&&document.getElementById(a)&&(document.getElementById(a).focus(),document.getElementById(a).select(),e.preventDefault()),"13"==e.keyCode){this.pointHelperGroup.children.slice(0).forEach(e=>{("rotateTool"==e.useType||"scaleTool"==e.useType)&&this.pointHelperGroup.remove(e)}),this.cleanModelHelper();let e=l.dom.value,t=l.getAttribute("moveDir"),r=1*e-1*i.lineLength;"rig"==t&&(o.position.x-=r),"lef"==t&&(o.position.x+=r),"top"==t&&(o.position.y-=r),"bot"==t&&(o.position.y+=r),this.addLineHelperForMember(o),this.synchroModel(o),this.addPositionHelper(o,!0);let a=(0,$9HO6e.UtilCore).toVector3(o.position.clone()).project(this.camera),n=window.innerWidth/2,s=window.innerHeight/2,h=[1*Math.round(a.x*n+n),1*Math.round(-a.y*s+s)];h[0]+=40,h[1]-=80,this.list.showDialog.dispatch("","",h)}}).bind(this))}let h=i.center.x+"/"+i.center.y+"/"+i.center.z;l.setAttribute("worldPosition",h),l.setAttribute("angle",n),l.setAttribute("moveDir",r),this.camera.isOrthographicCamera&&i.lineLength>10&&this.uiPanelBox.add(l),this.helperGroup.add(i);return}})}getWallNearModelSide(e,t,i,r,o,a,n,s){let l=(0,$9HO6e.UtilCore).lineIsIntersection(t,i);if(!l)return;let h=(0,$9HO6e.UtilCore).lineIsIntersection(r,i),c=(0,$9HO6e.UtilCore).pointIsInLine(h,l,a);if(c||(h=(0,$9HO6e.UtilCore).lineIsIntersection(o,i)),c){if(!(0,$9HO6e.UtilCore).pointIsInLine(h,n[0],n[1]))return}else if(!(0,$9HO6e.UtilCore).pointIsInLine(h,s[0],s[1]))return;if("top"==e&&h.y<=a.y||"bot"==e&&h.y>=a.y||"lef"==e&&h.x>=a.x||"rig"==e&&h.x<=a.x)return;let d=(0,$9HO6e.UtilCore).toVector3(a).distanceTo((0,$9HO6e.UtilCore).toVector3(h));return[(0,$9HO6e.UtilCore).toVector3(h),d]}exitTool(e=!0,t=!0){if(this.startPoint="",this.copyDoor="",this.copyFloorMaterial="",this.splitRoomLineGroup.children=[],this.list.startPlayer.dispatch(),this.selectObjArr=[],this.doorHelperGroupClean(),this.clickSelect.length>0&&""!=this.clickSelect[0].object&&"wall"==this.clickSelect[0].object.useType&&(this.clickSelect[0].object.material.color=this.getWallColor(this.clickSelect[0].object)),this.list.resetproperty.dispatch({roomOpacity:100*window.roomOpacity,storeyHei:window.storeyHei,floorDep:window.floorDep}),this.list.hiddenDialog.dispatch(),this.modelHelperGroup.children=[],this.clickSelect=[],this.destroy3DModelHelper(),this.currenDraw&&""!=this.currenDraw?"Mesh"==this.currenDraw.type||"Group"==this.currenDraw.type||"Line"==this.currenDraw.type?("Group"==this.currenDraw.type&&(this.dom.style.cursor="default",this.toolType="free",this.doorHelperGroupClean()),this.scene.remove(this.currenDraw),this.removeHelperByWallId(this.currenDraw.id)):this.currenDraw.forEach(e=>{this.scene.remove(e),this.removeHelperByWallId(e.id)}):(this.dom.style.cursor="default",this.toolType="free",this.list.switchBounced.dispatch("")),this.removeInputByClassName(this.uiPanelBox.dom,"moveInput"),this.removeInputByClassName(this.uiPanelBox.dom,"moveInput"),""!=this.mouseCoverObj){if(this.viewportCamera.isOrthographicCamera){this.model2D.remove(this.mouseCoverObj);let e=this.get3DModelBy2DModel(this.mouseCoverObj);this.model3D.remove(e)}else{this.model3D.remove(this.mouseCoverObj);let e=editor.get2DModelBy3DModel(this.mouseCoverObj);this.model2D.remove(e)}this.mouseCoverObj=""}this.currenDraw="",""!=this.currentPoint&&(0,$9HO6e.UtilCore).handleSpecialPoint(this.currentPoint.clone(),this.specialPointArr,this),this.pointHelpGroup.children=[],t&&e&&(this.viewportCamera.isOrthographicCamera?new $523a84362d27c3e8$export$b680ca477a72be07(this).wallToJson():new $523a84362d27c3e8$export$b680ca477a72be07(this).wallToJson("3D"))}getArcOtherPoint(e,t,i,r){let o=e.clone().distanceTo(i.arcCenter.clone()),a=new $4xklQ.Vector2((e.x+r.x)/2,(e.y+r.y)/2),n=new $4xklQ.Vector2((e.x+t.x)/2,(e.y+t.y)/2),s=e.clone().distanceTo(r.clone()),l=s/2/o,h=o*(e.clone().distanceTo(t.clone())/2)/(s/2),c=h*Math.sqrt(1-l*l),d=n.clone().add(i.arcCenter.clone().sub(a.clone()).setLength(c));return 1e-4>Math.abs(l-1)&&(d=n.clone()),d.clone().add(i.cp.clone().sub(i.arcCenter.clone()).setLength(h))}getSceneAllJson(e=!1){let t=(0,$9QhXH.DM).getHoleJson(this.otherMeshs,this),i=(0,$9QhXH.DM).memberJson(this.otherMember),r=(0,$9QhXH.DM).getWallJson(this.allWalls),o=(0,$9QhXH.DM).getModelJson(this.model3D.children,[],e),a=(0,$9QhXH.DM).getSplitLineJson(this.splitRoomLine.children);r.forEach(e=>{e.start.x*=100,e.start.y*=100,e.end.x*=100,e.end.y*=100});let n=this.camera,s=this.camera.isOrthographicCamera?"2D":"3D";this.camera.isOrthographicCamera&&(n=this.getOtherCamera(n));let l=this.camera;this.camera.isOrthographicCamera||(l=this.getOtherCamera(l));let h=1;n.zoomNum&&(h=n.zoomNum);let c=[this.controlsArr[0].target.x,this.controlsArr[0].target.y,this.controlsArr[0].target.z],d=[0,0,0];2==this.controlsArr.length&&(d=[this.controlsArr[1].target.x,this.controlsArr[1].target.y,this.controlsArr[1].target.z]);let p={sceneModel:s,zoom:l.zoom,position:{x:l.position.x,y:l.position.y,z:l.position.z},rotation:{x:l.rotation.x,y:l.rotation.y,z:l.rotation.z},"3dPosition":{x:n.position.x,y:n.position.y,z:n.position.z},"3dRotation":{x:n.rotation.x,y:n.rotation.y,z:n.rotation.z},target:{x:c[0],y:c[1],z:c[2]},"3dTarget":{x:d[0],y:d[1],z:d[2]},"3dVal":h};"3dRomaCamera"==n.name&&(p["3dPosition"]={x:n.realPosition.x,y:n.realPosition.y,z:n.realPosition.z},p["3dRotation"]={x:"",y:n.realRotation[0].y,z:n.realRotation[1].z});let u=this.getDomsByClassName(this.uiPanelBox.dom,"roomName"),m=[],g=this.floorGroup2d.children;u.forEach(e=>{let t=e.getAttribute("center"),i=e.getAttribute("roomName")+"\n"+e.getAttribute("roomArea"),r=[t,i=(i=i.replace(/<br>/g,"\n")).replace(/undefined/g,"")];g.forEach(e=>{let i=e.roomCenter;if(!e.parameter)return;let o=e.parameter.points,a=[];o.forEach(e=>{a.push([e.x,e.y])}),t==i[0]+"/"+i[1]&&(r.push(1==e.material.color.r),r.push(a))}),m.push(r)});let f=[];this.allRoomCenterCamera.children.slice(0).forEach(e=>{if(e.name.indexOf("camera")>=0){let t=e.position,i={position:{x:1e3*t.x,y:window.storeyHei,z:1e3*t.z}};f.push(i)}});let w="";this.scene.children.forEach(e=>{"mapImage"==e.useType&&(w=e)});let y={};return""!=w&&(y={width:w.width*w.scale.x,height:w.height*w.scale.y,imgUrl:w.imgUrl,visible:w.visible}),{version:this.dataVersion,themeColor:this.themeColor,wall:r,hole:t,member:i,model:o,splitLine:a,cameraJson:p,roomJson:m,mapJson:y,settingJson:this.config.settingJson,roomOpacity:window.roomOpacity,storeyHei:window.storeyHei,floorDep:window.floorDep,allLightMsg:f}}saveSceneJsonToFile(){var e=JSON.stringify(this.getSceneAllJson(!0)),t=new Blob([e],{type:"text/json"}),i=document.createElement("a");i.style.display="none",i.href=URL.createObjectURL(t),i.download="rjh_scene.json",i.click()}saveSceneJson(){let e=this.getSceneAllJson();"PC"!=this.deviceType&&(e=(0,$47Y2g.MobileMain).getAllJson()),this.cacheJson=JSON.stringify(e);let t={sceneJson:e},i="";if(localStorage.getItem("sceneData")){let r=new Date;if((i=localStorage.getItem("sceneData")).indexOf("version")>=0){if(JSON.stringify(e)==i)return;i=r.getFullYear()+""+(r.getMonth()+1)+r.getDate()+Math.round(1e4*Math.random()+1)+".json",localStorage.setItem("sceneData",i),this.saveJsonToSever(t,i,!0)}else if(this.currentCacheJson){let r=this.currentCacheJson;if(JSON.stringify(e)==JSON.stringify(r))return;console.log("保存:"+i),localStorage.setItem("sceneData",i),this.saveJsonToSever(t,i,!0)}}else{let e=new Date;i||(i=e.getFullYear()+""+(e.getMonth()+1)+e.getDate()+Math.round(1e4*Math.random()+1)+".json"),localStorage.setItem("sceneData",i),this.saveJsonToSever(t,i,!0)}}isObj(e){return e&&"object"==typeof e&&"[object object]"==Object.prototype.toString.call(e).toLowerCase()}isArray(e){return e&&"object"==typeof e&&e.constructor==Array}getLength(e){var t=0;for(var i in e)t++;return t}CompareJsonObj(e,t){return!!(this.isObj(e)&&this.isObj(t))&&this.getLength(e)==this.getLength(t)&&this.CompareObj(e,t,!0)}CompareObj(e,t,i,r=["uuid"]){if(this.getLength(e)!=this.getLength(t))return!1;for(var o in e){if(!i)break;if(!t.hasOwnProperty(o)){i=!1;break}if("cameraJson"!=o){if(this.isArray(e[o])){if(!this.isArray(t[o])){i=!1;break}var a=e[o],n=t[o];if(a.length!=n.length){i=!1;break}for(var s in a){if(!i)break;i=this.CompareObj(a[s],n[s],i)}}else if(this.isObj(e[o])){if(this.isObj(t[o])){if(!i)break;i=this.CompareObj(e[o],t[o],i)}else{i=!1;break}}else{if(r.indexOf(o)>=0)continue;if(String(t[o])!=String(e[o])){i=!1;break}}}}return i}updateModel(e){if(this.clickDepthMsg.uuid){this.modelDotGroup.children=[];let t=this.getOuterParent(e,e,"outer"),i=t.param[0];this.refreshRealSizeByBox(t,e),this.updateModelPosition(e.parent,t),this.addDashBoxFor2dGroup(i),this.addDashBoxForGroup(t)}}updateModelPosition(e,t){if(!e||"3dModel"==e.name||"2dModel"==e.name)return;let i=e;"2dModel"==t.parent.name&&(i=e.param[0],t=t.param[0]),e.updateWorldMatrix(!0,!0);let r=[];e.children.forEach(t=>{let i=t.position.clone();i=e.localToWorld(i),r.push(i)});let o=new $4xklQ.Vector3;this.getRealCenter(e).getCenter(o),e.parent.worldToLocal(o),e.position.set(o.x,o.y,o.z),this.synchroModel(e);let a=0;e.updateWorldMatrix(!0,!0),e.children.forEach(t=>{let i=r[a];e.worldToLocal(i),t.position.set(i.x,i.y,i.z),this.synchroModel(t),a++});let n=this.getRealCenter(i),s=new $44a90fc8a2825c34$export$f7a1f6dc3f8b082f().fromBox3(n);i.width=2*s.halfSize.x/i.scale.x,i.height=2*s.halfSize.y/i.scale.y,i.depth=2*s.halfSize.z/i.scale.z,i.param[0].width=1e3*i.width,i.param[0].height=1e3*i.depth,i.param[0].depth=1e3*i.height,this.updateModelPosition(e.parent,t)}getWorldRotation(e){let t=(e,t)=>new $4xklQ.Vector3(e.x+t.x,e.y+t.y,e.z+t.z);return null===e?new $4xklQ.Vector3:t(e.rotation,this.getWorldRotation(e.parent))}getRealCenter(e){let t=this.getWorldRotation(e);t.x=-t.x+e.rotation.x,t.y=-t.y+e.rotation.y,t.z=-t.z+e.rotation.z;let i=e.rotation.x,r=e.rotation.y,o=e.rotation.z;e.rotation.set(t.x,t.y,t.z);let a=new(0,$4xklQ.Box3)().setFromObject(e);return e.rotation.set(i,r,o),a}makeGroup(e="3d"){this.execute(),this.doorHelperGroupClean();let t=new $4xklQ.Group,i=this.selectObjArr.slice(0),r=new $4xklQ.Group,o="",a="",n=[];i.forEach(i=>{let s=this.getOuterParent(i);if("3d"==e){let e=this.get2DModelBy3DModel(s);o=(a=s.parent).param?a.param[0]:this.model2D,r.add(e),t.add(s)}else{let e=this.get3DModelBy2DModel(s);a=(o=s.parent).param?o.param[0]:this.model3D,r.add(s),t.add(e)}s.modelPosition&&n.push(s.modelPosition),s.param[0].modelPosition&&n.push(s.param[0].modelPosition)}),0>n.indexOf("bottom")&&0>n.indexOf("free")?(t.modelPosition="top",r.modelPosition="top"):0>n.indexOf("bottom")&&0>n.indexOf("top")?(t.modelPosition="free",r.modelPosition="free"):(t.modelPosition="bottom",r.modelPosition="bottom"),a.add(t),o.add(r),t.updateWorldMatrix(!0,!1);let s=new(0,$4xklQ.Box3)().setFromObject(t),l=new $44a90fc8a2825c34$export$f7a1f6dc3f8b082f().fromBox3(s);t.width=1*Math.abs(s.max.x-s.min.x).toFixed(2),t.height=1*Math.abs(s.max.y-s.min.y).toFixed(2),t.depth=1*Math.abs(s.max.z-s.min.z).toFixed(2),r.updateWorldMatrix();let h=new(0,$4xklQ.Box3)().setFromObject(r),c=new $44a90fc8a2825c34$export$f7a1f6dc3f8b082f().fromBox3(h).center.clone();o.updateMatrixWorld(),o.worldToLocal(c),r.position.copy(c);let d=l.center.clone();a.updateMatrixWorld(),a.worldToLocal(d),t.position.copy(d),t.children.forEach(e=>{e.position.sub(d)}),r.children.forEach(e=>{e.position.sub(c)}),t.modelType="modelGroup",t.modelId=r.uuid,t.param=[r],r.modelId=t.uuid,r.param=[t],r.modelType="2dModelGroup",this.selectObjArr=this.camera.isOrthographicCamera?[r]:[t],this.modelHelperGroup.children=[],this.addBoxForGroup(t),this.addBoxFor2dGroup(r)}explodeGroup(e="3d",t=!0){if(1!=this.selectObjArr.length)return;t&&this.execute(),this.doorHelperGroupClean(),this.modelHelperGroup.children=[];let i=this.getOuterParent(this.selectObjArr[0]),r=i.parent,o=i.children.slice(0);o.forEach(t=>{t.matrixWorld.decompose(t.position,t.quaternion,t.scale),r.add(t),"3d"==e?this.addBoxForGroup(t):this.addBoxFor2dGroup(t)}),i.parent.remove(i);let a="3d"==e?this.get2DModelBy3DModel(i):this.get3DModelBy2DModel(i),n=a.parent;(o=a.children.slice(0)).forEach(t=>{t.matrixWorld.decompose(t.position,t.quaternion,t.scale),n.add(t),"3d"==e?this.addBoxForGroup(t):this.addBoxFor2dGroup(t)}),a.parent.remove(a),this.selectObjArr=[]}setLayers(e,t){e.layers.set(t),e.children&&e.children.slice(0).forEach(e=>{this.setLayers(e,t)})}extendParam(e,t,i=""){for(let i in e)t.hasOwnProperty(i)||(t[i]=e[i]&&e[i].isVector3?e[i].clone():e[i]);if(e.rotation.x!=t.rotation.x&&(t.rotation.x=e.rotation.x,t.rotation.y=e.rotation.y,t.rotation.z=e.rotation.z),""!=i&&(t.param=[i],i.param=[t]),!e.imgPath){let r=0,o=t.children;e.children.slice(0).forEach(e=>{let t="";""!=i&&i.children.forEach(i=>{i.param[0].uuid==e.uuid&&(t=i)}),this.extendParam(e,o[r],t),r++})}}modelCopy(){let e=this.camera.isOrthographicCamera?"2d":"3d";if(""==this.clickSelect||""==this.clickSelect[0].object)return;let t=this.getOuterParent(this.clickSelect[0].object),i=t.clone();if(this.extendParam(t,i),"2d"==e){let e=this.get3DModelBy2DModel(t),r=e.clone();this.extendParam(e,r,i),t.parent.add(i),e.parent.add(r)}else{let e=this.get2DModelBy3DModel(t),r=e.clone();this.extendParam(e,r,i),t.parent.add(i),e.parent.add(r)}this.mouseCoverObj=i}modelReverse(e){let t=this.camera.isOrthographicCamera?"2d":"3d";if(""==this.clickSelect||""==this.clickSelect[0].object)return;let i=this.getOuterParent(this.clickSelect[0].object);"2d"==t?"frontBackTurn"==e?i.scale.y*=-1:i.scale.x*=-1:"frontBackTurn"==e?i.scale.z*=-1:i.scale.x*=-1,this.getRealCenter(i),this.synchroModel(i)}doorSetLock(){if(""!=this.clickSelect&&""!=this.clickSelect[0].object){if("2d"==(this.camera.isOrthographicCamera?"2d":"3d")){let e=this.clickSelect[0].object.parent;e.isLock=!e.isLock,this.doorHelperGroupClean(),this.addLineHelperForDoor(e,!0);let t=this.getWallById(e.wallId);this.partRefreshWall(t)}else{let e=this.clickSelect[0].object,t=this.getOuterParent(e);t.isLock=!t.isLock,t.parameter.tdm.isLock=t.isLock}}}memberSetLock(){if(""!=this.clickSelect&&""!=this.clickSelect[0].object){if("2d"==(this.camera.isOrthographicCamera?"2d":"3d")){let e=this.clickSelect[0].object.parent;e.isLock=!e.isLock,this.doorHelperGroupClean(),e.isLock?this.addPositionHelper(e,!0):this.addLineHelperForMember(e),this.get3DMemberBy2DMember(e).isLock=e.isLock}else{let e=this.clickSelect[0].object;e.isLock=!e.isLock,this.get2DMemberBy3DMember(e).isLock=e.isLock}}}modelHidden(){if(""==this.clickSelect||""==this.clickSelect[0].object)return;this.doorHelperGroupClean(),this.list.hiddenDialog.dispatch(),this.modelHelperGroup.children=[];let e=[];e=1==this.selectObjArr.length?[this.clickSelect[0].object]:this.selectObjArr,this.execute(),e.forEach(e=>{let t=this.getOuterParent(e);if(t.isLock){1==this.selectObjArr.length&&this.list.alert.dispatch("模型已锁定,请先解锁","warning");return}t.visible=!1,t.param[0].visible=!1;let i=t.modelPosition;t.modelPosition||(i=t.param[0].modelPosition),"bottom"==i?this.config.settingJson.showFloorFurniture=!1:"top"==i?this.config.settingJson.showCeilFurniture=!1:this.config.settingJson.showWallFurniture=!1}),this.list.getShowHiddenFlag.dispatch(JSON.stringify(this.config.settingJson),!1)}modelSetLock(){if(""==this.selectObjArr||0==this.selectObjArr.length)return;let e=this.camera.isOrthographicCamera?"2d":"3d",t=!0;this.selectObjArr.forEach(e=>{this.getOuterParent(e).isLock||(t=!1)}),this.selectObjArr.forEach(i=>{let r=this.getOuterParent(i);r.isLock=!t,"2d"==e?(this.get3DModelBy2DModel(r).isLock=r.isLock,this.doorHelperGroupClean(),this.addPositionHelper(r,!0)):(this.get2DModelBy3DModel(r).isLock=r.isLock,new $102b3df9ca2da060$export$aead3d23b4737909(this).selectObj([r]))})}door3DCopy(){if(""==this.clickSelect||""==this.clickSelect[0].object)return;let e=this.getOuterParent(this.clickSelect[0].object),t=this.codeModelCopy(e),i=e.parameter.tdm,r=i.clone();for(let i in e)t.hasOwnProperty(i)||(t[i]=e[i]&&e[i].isVector3?e[i].clone():e[i]);for(let e in i)r.hasOwnProperty(e)||(r[e]=i[e]&&i[e].isVector3?i[e].clone():i[e]);r.name="copy",t.parameter.tdm=r,this.wallGroup3D.add(t),this.scene.add(r),this.otherMeshs.push(r),new $f708759ef0d3ebee$export$cbb426a6cd1f3789(this,t).selectObj(this.clickSelect[0].object)}modelReplace(){if(""==this.clickSelect||""==this.clickSelect[0].object)return;let e=this.getOuterParent(this.clickSelect[0].object);if(e.modelRealType){let t=e.modelRealType;this.list.modelReplace.dispatch(t)}}modelFloat(e){if(""==this.clickSelect||""==this.clickSelect[0].object)return;let t=this.getOuterParent(this.clickSelect[0].object),i=[0,0];this.getTopModePosition(t.parent,t.parent,i);let r=.002;"topFloat"==e?t.position.z=i[0]+r:(t.position.z=i[1]-r,t.position.z<=-.1&&(t.position.z=-.1))}modelReplaceMain(e){if(""==this.clickSelect||""==this.clickSelect[0].object)return;let t=this.getOuterParent(this.clickSelect[0].object);this.modelReplaceCore(t,e);let i="",r="";this.camera.isOrthographicCamera?(i=this.get3DModelBy2DModel(t),r=this.get3DModelBy2DModel(e)):(i=this.get2DModelBy3DModel(t),r=this.get2DModelBy3DModel(e)),i&&r&&this.modelReplaceCore(i,r),this.clickSelect[0].object=e,this.camera.isOrthographicCamera?this.addLineHelperForMember(e):new $102b3df9ca2da060$export$aead3d23b4737909(this).selectObj([e]),this.updateModelPosition(e.parent,e)}modelReplaceCore(e,t,i="position"){for(let i in e.parent.add(t),e)t.hasOwnProperty(i)||(t[i]=e[i]&&e[i].isVector3?e[i].clone():e[i]);t.position.copy(e.position);var r=new $4xklQ.Box3;r.setFromObject(t);let o=1*(r.max.x-r.min.x).toFixed(2),a=1*(r.max.y-r.min.y).toFixed(2),n=1*(r.max.z-r.min.z).toFixed(2);if("position"==i){if(0!=n){let i=t.modelPosition,r=a-e.height*e.scale.y;"top"==i?t.position.y-=r/2:t.position.y+=r/2}}else t.scale.set(e.width*e.scale.x/o,e.height*e.scale.y/a,e.depth*e.scale.z/n),0==n&&(t.scale.z=1);t.rotation.copy(e.rotation),e.parent.remove(e)}cleanInterval(e){let t="";if(editor.model3D.children.forEach(e=>{let i=e.position;9999==i.x&&9999==i.z&&(t=e)}),!t||!t.param&&"localPath"==t.imgPath||"Line2"==t.type)return;let i="";i=editor.camera.isOrthographicCamera?editor.get2DModelBy3DModel(t):t,"load"==e?editor.mouseCoverObj=i:this.camera.isOrthographicCamera?this.modelReplaceMain(this.get2DModelBy3DModel(t)):this.modelReplaceMain(t),clearInterval(window.intervalClear)}loadGLTFJsonCore(e,t){let i=e.Products;i[0].location={x:9999,y:9999,z:9999},editor.recoveModel(i),window.intervalClear=setInterval(()=>{this.cleanInterval(t)},100)}get3DModelPoint(e){let t=[new $4xklQ.Vector3(0,0,e.depth/2),new $4xklQ.Vector3(0,0,-e.depth/2),new $4xklQ.Vector3(-e.width/2,0,0),new $4xklQ.Vector3(e.width/2,0,0),new $4xklQ.Vector3(0,e.height/2,0),new $4xklQ.Vector3(0,-e.height/2,0)];e.updateWorldMatrix(!0,!1);for(let i=0;i<t.length;i++){let r=e.localToWorld(t[i]);t[i]=r}return t}getFinalPoint(e,t){let i=t[0];return t.forEach(t=>{"X"==e&&t.x>i.x&&(i=t),"-X"==e&&t.x<i.x&&(i=t),"Y"==e&&t.z>i.z&&(i=t),"-Y"==e&&t.z<i.z&&(i=t),"Z"==e&&t.y>i.y&&(i=t),"-Z"==e&&t.y<i.y&&(i=t)}),i}modelAlign(e,t){let i=t[0],r=new $4xklQ.Vector3(0,0,i.depth/2),o=new $4xklQ.Vector3(0,0,-i.depth/2),a=new $4xklQ.Vector3(-i.width/2,0,0),n=new $4xklQ.Vector3(i.width/2,0,0),s=new $4xklQ.Vector3(0,i.height/2,0),l=new $4xklQ.Vector3(0,-i.height/2,0);[r,o,a,n,s,l].forEach(e=>{i.localToWorld(e)});let h=new(0,$4xklQ.Vector2)(r.x,r.z).sub(new $4xklQ.Vector2(o.x,o.z)).angle(),c="";h>=0&&h<=Math.PI/4||h>7/4*Math.PI&&h<=2*Math.PI?c="X":h>Math.PI/4&&h<=3*Math.PI/4?c="Y":h>3*Math.PI/4&&h<=5*Math.PI/4?c="-X":h>5*Math.PI/4&&h<=7/4*Math.PI&&(c="-Y"),t.shift(),t.forEach(t=>{let h=t,d=this.get3DModelPoint(h),p="",u="",m="",g="";if("frontAligning"==e){p="X"==c||"-X"==c?"X":"Y",m=r;let e={X:"X","-X":"-X",Y:"Y","-Y":"-Y"};g=this.getFinalPoint(e[c],d)}else if("rearAligning"==e){p="X"==c||"-X"==c?"X":"Y",m=o;let e={X:"-X","-X":"X",Y:"-Y","-Y":"Y"};g=this.getFinalPoint(e[c],d)}else if("leftAligning"==e){m=a,p="X"==c||"-X"==c?"Y":"X";let e={X:"-Y","-X":"Y",Y:"-X","-Y":"X"};g=this.getFinalPoint(e[c],d)}else if("rightAligning"==e){m=n,p="X"==c||"-X"==c?"Y":"X";let e={X:"Y","-X":"-Y",Y:"X","-Y":"-X"};g=this.getFinalPoint(e[c],d)}else"topAligning"==e?(p="Z",g=this.getFinalPoint("Z",d),m=s):"bottomAligning"==e?(p="Z",g=this.getFinalPoint("-Z",d),m=l):"frontAndBackAligning"==e?(p="X"==c||"-X"==c?"X":"Y",m=i.position.clone(),g=h.position.clone()):"leftRightAligning"==e?(p="X"==c||"-X"==c?"Y":"X",m=i.position.clone(),g=h.position.clone()):"topBottomAligning"==e&&(p="Z",m=i.position.clone(),g=h.position.clone());h.updateMatrixWorld(!0);let f=new $4xklQ.Vector3;h.getWorldPosition(f),"X"==p?(u=m.x-g.x,f.x+=u):"Y"==p?(u=m.z-g.z,f.z+=u):(u=m.y-g.y,f.y+=u),h.parent.worldToLocal(f),h.position.copy(f),this.synchroModel(h),this.updateModelPosition(h.param[0].parent,h.param[0])}),this.modelHelperGroup.children=[],this.doorHelperGroupClean(),t.push(i),t.forEach(e=>{let t=e,i=this.get2DModelBy3DModel(t);this.addBoxFor2dGroup(i);let r=this.wallHelp.addOBBbox(t,this.config.boxColor);r.name="modelBox",r.layers.set(2),this.modelHelperGroup.add(r)})}exportModelJson(e){return{meta:{version:"0.1",origin:"",magic:"",unit:"mm"},boundingBox:{xLen:1e3*(e.width*e.scale.x).toFixed(2),yLen:1e3*(e.height*e.scale.y).toFixed(2),zLen:1e3*(e.depth*e.scale.z).toFixed(2)},Products:(0,$9QhXH.DM).getModelJson([e])}}getSceneCenter(){this.cameraScene.children=[];let e=new $4xklQ.Group,t=new(0,$4xklQ.Matrix4)().makeScale(.001,.001,.001),i=new $4xklQ.Group;i.applyMatrix4(t);let r=new $4xklQ.Group,o=new $4xklQ.Group;o.applyMatrix4(t),e.add(i,r,o),this.wallGroup3D.children.slice(0).forEach(e=>{"3DWall"==e.modelType&&i.add(e.clone())}),i.rotation.x=-Math.PI/2,o.rotation.x=-Math.PI/2,this.model3D.children.slice(0).forEach(e=>{r.add(e.clone())}),this.memberGroup3D.children.slice(0).forEach(e=>{o.add(e.clone())});let a=new(0,$4xklQ.Box3)().setFromObject(e);e.position.set(0,0,0);let n=new $4xklQ.Vector3;a.getCenter(n);let s=a.max.x-a.min.x,l=a.max.y-a.min.y,h=a.max.z-a.min.z;return[n=new $4xklQ.Vector3(1*n.x.toFixed(3),1*n.y.toFixed(3),1*n.z.toFixed(3)),s,l,h,a]}rotatePoint(e,t,i){var r=t.x,o=t.y,a=e.x,n=e.y;return{x:r+(a-r)*Math.cos(i*Math.PI/180)-(n-o)*Math.sin(i*Math.PI/180),y:o+(a-r)*Math.sin(i*Math.PI/180)+(n-o)*Math.cos(i*Math.PI/180)}}setCurrentCamera(e){"+"!=e&&"-"!=e&&"*"!=e&&"/"!=e&&(e*=1);let t=900,i=600,r=this.getSceneCenter(),o=r[0],a=this.camera.position.clone();a=new $4xklQ.Vector3(1*a.x.toFixed(3),1*a.y.toFixed(3),1*a.z.toFixed(3));let n=this.camera.zoom;var s=new $4xklQ.Vector3;this.camera.getWorldDirection(s);let l=10,h=Math.PI/180*15;switch(e){case 1:this.camera.position.set(o.x,o.y,l);break;case 2:case 8:l=a.distanceTo(o);let c=a.clone().sub(o),d=c.clone();d.y=0;let p=c.angleTo(d);o.y>a.y&&(p*=-1),this.camera.oldRotDir&&(p=this.camera.oldRotDir)<-(2*Math.PI)&&(p+=2*Math.PI),this.camera.oldRotDir=p-h;let u=l*Math.sin(p-h);u+=o.y;let m=l*Math.cos(p-h),g=new $4xklQ.Vector2(o.x,o.z),f=new $4xklQ.Vector2(a.x,a.z),w=f.clone().sub(g);0!=w.x||0!=w.y||this.camera.cameraRotDir||(w=f.clone().sub(new $4xklQ.Vector2(o.x,o.z-10))),this.camera.cameraRotDir?w=this.camera.cameraRotDir.clone():this.camera.cameraRotDir=w.clone();let y=w.setLength(m);y.x+=o.x,y.y+=o.z,this.camera.position.set(y.x,u,y.y);break;case 3:let b=new(0,$4xklQ.Vector2)(a.x,a.z).sub(new $4xklQ.Vector2(o.x,o.z)).angle(),x=this.rotatePoint(new $4xklQ.Vector2(a.x,a.z),new $4xklQ.Vector2(o.x,o.z),-(180*b)/Math.PI);this.camera.position.set(x.x,a.y,x.y);break;case 4:let P=this.rotatePoint(new $4xklQ.Vector2(a.x,a.z),new $4xklQ.Vector2(o.x,o.z),10);this.camera.position.set(P.x,a.y,P.y);break;case 5:break;case 6:let v=this.rotatePoint(new $4xklQ.Vector2(a.x,a.z),new $4xklQ.Vector2(o.x,o.z),-10);this.camera.position.set(v.x,a.y,v.y);break;case 7:this.camera.position.set(o.x,l,o.z);break;case 9:let M=this.rotatePoint(new $4xklQ.Vector2(a.x,a.z),new $4xklQ.Vector2(o.x,o.z),180);this.camera.position.set(M.x,a.y,M.y);break;case 0:let C=new(0,$4xklQ.Vector2)(o.x,o.z).add(new(0,$4xklQ.Vector2)(1,1).setLength(15));document.querySelector("#cameraShot_box")?(this.camera.position.copy(this.camera.oldPos),this.grid3d.visible=!0):(this.camera.oldPos=this.camera.position.clone(),this.camera.position.set(C.x,o.y+15,C.y),this.grid3d.visible=!1);break;case"+":case"-":let D=.855,T=this.controlsArr[1];"+"==e?T.object.zoom=Math.max(T.minZoom,Math.min(T.maxZoom,T.object.zoom/D)):T.object.zoom=Math.max(T.minZoom,Math.min(T.maxZoom,T.object.zoom*D))}if(this.camera.lookAt(o),this.camera.aspect=window.innerWidth/window.innerHeight,"+"!=e&&"-"!=e&&(this.camera.zoom=n),1==e||3==e||7==e||9==e||0==e){let e=new $0a029741d8f7787c$export$208a41d6b4e37b97({x:a.x,y:a.y,z:a.z});e.onUpdate(e=>{this.camera.position.set(e.x,e.y,e.z)});let t=this.camera.position.clone(),i=a.distanceTo(t)/.2/3;e.to({x:t.x,y:t.y,z:t.z},10*i).start()}if(this.camera.updateProjectionMatrix(),this.controlsArr[1].target.copy(o),this.controlsArr[1].update(),0==e){if(document.querySelector("#cameraShot_box"))this.list.cameraShot.dispatch(t,i);else{let e=r[4],o=[new $4xklQ.Vector3(e.min.x,0,e.max.z),new $4xklQ.Vector3(e.max.x,0,e.max.z),new $4xklQ.Vector3(e.max.x,0,e.min.z),new $4xklQ.Vector3(e.min.x,0,e.min.z),new $4xklQ.Vector3(e.min.x,r[2],e.max.z),new $4xklQ.Vector3(e.max.x,r[2],e.max.z),new $4xklQ.Vector3(e.max.x,r[2],e.min.z),new $4xklQ.Vector3(e.min.x,r[2],e.min.z)],a=[],n=[];o.forEach(e=>{let t=this.getScreen(e,this.camera);a.push(t[0]),n.push(t[1])});let s=Math.min(...n),l=Math.max(...n),h=Math.min(...a),c=20,d=20;t=Math.max(...a)-h+20,i=l-s+d,this.list.cameraShot.dispatch(t,i,h-c/2,s-d/2)}}this.updateDom()}getRenderCameraAngle(){let e=editor.renderViewControl.target.clone().sub(editor.renderViewCamera.position),t=(0,$9HO6e.UtilCore).calculateAngleWithHorizontalPlane(e);if(!isNaN(t))return this.renderViewCamera.position.y<editor.renderViewControl.target.y&&(t*=-1),t>=-5*Math.PI/180&&t<=5*Math.PI/180&&(t=0),Math.round(180*t/Math.PI)}add3DDoorDialog(e){let t=this.getOuterParent(e);this.transform3DTool&&"ThreeDimensionMoveHelper"==this.transform3DTool.name&&this.transform3DTool.removeEventListener(),this.transform3DTool=new $f708759ef0d3ebee$export$cbb426a6cd1f3789(this),this.transform3DTool.selectObj(e);let i=t.parameter.tdm,r=this.get3DModelDialogPosition(t,30),o=[Math.abs(Math.round(i.doorWid*i.scale.x)),Math.round(i.height),Math.round(i.wallDep),i.floorHei,{isLock:i.isLock}],a=12;i.modelType.toLowerCase().indexOf("window")>=0&&(a=15);let n=this.config.modelTypeJson[i.modelType];this.list.showDialog.dispatch(a,n,r,o)}}var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ");const $50d9c80e72e6b8f4$var$_changeEvent={type:"change"},$50d9c80e72e6b8f4$var$_startEvent={type:"start"},$50d9c80e72e6b8f4$var$_endEvent={type:"end"};class $50d9c80e72e6b8f4$export$8ff7788029dfdf52 extends $4xklQ.EventDispatcher{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new $4xklQ.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:$4xklQ.MOUSE.ROTATE,MIDDLE:$4xklQ.MOUSE.DOLLY,RIGHT:$4xklQ.MOUSE.PAN},this.touches={ONE:$4xklQ.TOUCH.ROTATE,TWO:$4xklQ.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return n.phi},this.getAzimuthalAngle=function(){return n.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",er),this._domElementKeyEvents=e},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent($50d9c80e72e6b8f4$var$_changeEvent),i.update(),o=r.NONE},this.update=function(){let t=new $4xklQ.Vector3,d=new(0,$4xklQ.Quaternion)().setFromUnitVectors(e.up,new $4xklQ.Vector3(0,1,0)),p=d.clone().invert(),u=new $4xklQ.Vector3,m=new $4xklQ.Quaternion,g=2*Math.PI;return function(){let e=i.object.position;t.copy(e).sub(i.target),t.applyQuaternion(d),n.setFromVector3(t),i.autoRotate&&o===r.NONE&&C(v()),i.enableDamping?(n.theta+=s.theta*i.dampingFactor,n.phi+=s.phi*i.dampingFactor):(n.theta+=s.theta,n.phi+=s.phi);let f=i.minAzimuthAngle,w=i.maxAzimuthAngle;return isFinite(f)&&isFinite(w)&&(f<-Math.PI?f+=g:f>Math.PI&&(f-=g),w<-Math.PI?w+=g:w>Math.PI&&(w-=g),f<=w?n.theta=Math.max(f,Math.min(w,n.theta)):n.theta=n.theta>(f+w)/2?Math.max(f,n.theta):Math.min(w,n.theta)),n.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,n.phi)),n.makeSafe(),n.radius*=l,n.radius=Math.max(i.minDistance,Math.min(i.maxDistance,n.radius)),!0===i.enableDamping?i.target.addScaledVector(h,i.dampingFactor):i.target.add(h),t.setFromSpherical(n),t.applyQuaternion(p),e.copy(i.target).add(t),i.object.lookAt(i.target),!0===i.enableDamping?(s.theta*=1-i.dampingFactor,s.phi*=1-i.dampingFactor,h.multiplyScalar(1-i.dampingFactor)):(s.set(0,0,0),h.set(0,0,0)),l=1,!!(c||u.distanceToSquared(i.object.position)>a||8*(1-m.dot(i.object.quaternion))>a)&&(i.dispatchEvent($50d9c80e72e6b8f4$var$_changeEvent),u.copy(i.object.position),m.copy(i.object.quaternion),c=!1,!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",en),i.domElement.removeEventListener("pointerdown",J),i.domElement.removeEventListener("pointercancel",K),i.domElement.removeEventListener("wheel",ei),i.domElement.removeEventListener("pointermove",Q),i.domElement.removeEventListener("pointerup",Z),null!==i._domElementKeyEvents&&i._domElementKeyEvents.removeEventListener("keydown",er)};let i=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},o=r.NONE,a=1e-6,n=new $4xklQ.Spherical,s=new $4xklQ.Spherical,l=1,h=new $4xklQ.Vector3,c=!1,d=new $4xklQ.Vector2,p=new $4xklQ.Vector2,u=new $4xklQ.Vector2,m=new $4xklQ.Vector2,g=new $4xklQ.Vector2,f=new $4xklQ.Vector2,w=new $4xklQ.Vector2,y=new $4xklQ.Vector2,b=new $4xklQ.Vector2,x=[],P={};function v(){return 2*Math.PI/60/60*i.autoRotateSpeed}function M(){return Math.pow(.95,i.zoomSpeed)}function C(e){s.theta-=e}function D(e){s.phi-=e}let T=function(){let e=new $4xklQ.Vector3;return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),h.add(e)}}(),S=function(){let e=new $4xklQ.Vector3;return function(t,r){!0===i.screenSpacePanning?e.setFromMatrixColumn(r,1):(e.setFromMatrixColumn(r,0),e.crossVectors(i.object.up,e)),e.multiplyScalar(t),h.add(e)}}(),k=function(){let e=new $4xklQ.Vector3;return function(t,r){let o=i.domElement;if(i.object.isPerspectiveCamera){let a=i.object.position;e.copy(a).sub(i.target);let n=e.length();T(2*t*(n*=Math.tan(i.object.fov/2*Math.PI/180))/o.clientHeight,i.object.matrix),S(2*r*n/o.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(T(t*(i.object.right-i.object.left)/i.object.zoom/o.clientWidth,i.object.matrix),S(r*(i.object.top-i.object.bottom)/i.object.zoom/o.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function V(e){i.object.isPerspectiveCamera?l/=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*e)),i.object.updateProjectionMatrix(),c=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function A(e){i.object.isPerspectiveCamera?l*=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/e)),i.object.updateProjectionMatrix(),c=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function L(e){d.set(e.clientX,e.clientY)}function W(e){w.set(e.clientX,e.clientY)}function I(e){m.set(e.clientX,e.clientY)}function R(e){p.set(e.clientX,e.clientY),u.subVectors(p,d).multiplyScalar(i.rotateSpeed);let t=i.domElement;C(2*Math.PI*u.x/t.clientHeight),D(2*Math.PI*u.y/t.clientHeight),d.copy(p),i.update()}function B(e){y.set(e.clientX,e.clientY),b.subVectors(y,w),b.y>0?V(M()):b.y<0&&A(M()),w.copy(y),i.update()}function E(e){g.set(e.clientX,e.clientY),f.subVectors(g,m).multiplyScalar(i.panSpeed),k(f.x,f.y),m.copy(g),i.update()}function O(e){e.deltaY<0?A(M()):e.deltaY>0&&V(M()),i.update()}function F(e){let t=!1;switch(e.code){case i.keys.UP:k(0,i.keyPanSpeed),t=!0;break;case i.keys.BOTTOM:k(0,-i.keyPanSpeed),t=!0;break;case i.keys.LEFT:k(i.keyPanSpeed,0),t=!0;break;case i.keys.RIGHT:k(-i.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),i.update())}function z(){if(1===x.length)d.set(x[0].pageX,x[0].pageY);else{let e=.5*(x[0].pageX+x[1].pageX),t=.5*(x[0].pageY+x[1].pageY);d.set(e,t)}}function G(){if(1===x.length)m.set(x[0].pageX,x[0].pageY);else{let e=.5*(x[0].pageX+x[1].pageX),t=.5*(x[0].pageY+x[1].pageY);m.set(e,t)}}function H(){let e=x[0].pageX-x[1].pageX,t=x[0].pageY-x[1].pageY,i=Math.sqrt(e*e+t*t);w.set(0,i)}function j(){i.enableZoom&&H(),i.enablePan&&G()}function _(){i.enableZoom&&H(),i.enableRotate&&z()}function U(e){if(1==x.length)p.set(e.pageX,e.pageY);else{let t=ec(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);p.set(i,r)}u.subVectors(p,d).multiplyScalar(i.rotateSpeed);let t=i.domElement;C(2*Math.PI*u.x/t.clientHeight),D(2*Math.PI*u.y/t.clientHeight),d.copy(p)}function N(e){if(1===x.length)g.set(e.pageX,e.pageY);else{let t=ec(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);g.set(i,r)}f.subVectors(g,m).multiplyScalar(i.panSpeed),k(f.x,f.y),m.copy(g)}function q(e){let t=ec(e),r=e.pageX-t.x,o=e.pageY-t.y,a=Math.sqrt(r*r+o*o);y.set(0,a),b.set(0,Math.pow(y.y/w.y,i.zoomSpeed)),V(b.y),w.copy(y)}function Y(e){i.enableZoom&&q(e),i.enablePan&&N(e)}function X(e){i.enableZoom&&q(e),i.enableRotate&&U(e)}function J(e){!1!==i.enabled&&(0===x.length&&(i.domElement.setPointerCapture(e.pointerId),i.domElement.addEventListener("pointermove",Q),i.domElement.addEventListener("pointerup",Z)),es(e),"touch"===e.pointerType?eo(e):ee(e))}function Q(e){!1!==i.enabled&&("touch"===e.pointerType?ea(e):et(e))}function Z(e){el(e),0===x.length&&(i.domElement.releasePointerCapture(e.pointerId),i.domElement.removeEventListener("pointermove",Q),i.domElement.removeEventListener("pointerup",Z)),i.dispatchEvent($50d9c80e72e6b8f4$var$_endEvent),o=r.NONE}function K(e){el(e)}function ee(e){let t;switch(e.button){case 0:t=i.mouseButtons.LEFT;break;case 1:t=i.mouseButtons.MIDDLE;break;case 2:t=i.mouseButtons.RIGHT;break;default:t=-1}switch(t){case $4xklQ.MOUSE.DOLLY:if(!1===i.enableZoom)return;W(e),o=r.DOLLY;break;case $4xklQ.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enablePan)return;I(e),o=r.PAN}else{if(!1===i.enableRotate)return;L(e),o=r.ROTATE}break;case $4xklQ.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enableRotate)return;L(e),o=r.ROTATE}else{if(!1===i.enablePan)return;I(e),o=r.PAN}break;default:o=r.NONE}o!==r.NONE&&i.dispatchEvent($50d9c80e72e6b8f4$var$_startEvent)}function et(e){switch(o){case r.ROTATE:if(!1===i.enableRotate)return;R(e);break;case r.DOLLY:if(!1===i.enableZoom)return;B(e);break;case r.PAN:if(!1===i.enablePan)return;E(e)}}function ei(e){!1!==i.enabled&&!1!==i.enableZoom&&o===r.NONE&&(e.preventDefault(),i.dispatchEvent($50d9c80e72e6b8f4$var$_startEvent),O(e),i.dispatchEvent($50d9c80e72e6b8f4$var$_endEvent))}function er(e){!1!==i.enabled&&!1!==i.enablePan&&F(e)}function eo(e){switch(eh(e),x.length){case 1:switch(i.touches.ONE){case $4xklQ.TOUCH.ROTATE:if(!1===i.enableRotate)return;z(),o=r.TOUCH_ROTATE;break;case $4xklQ.TOUCH.PAN:if(!1===i.enablePan)return;G(),o=r.TOUCH_PAN;break;default:o=r.NONE}break;case 2:switch(i.touches.TWO){case $4xklQ.TOUCH.DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;j(),o=r.TOUCH_DOLLY_PAN;break;case $4xklQ.TOUCH.DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;_(),o=r.TOUCH_DOLLY_ROTATE;break;default:o=r.NONE}break;default:o=r.NONE}o!==r.NONE&&i.dispatchEvent($50d9c80e72e6b8f4$var$_startEvent)}function ea(e){switch(eh(e),o){case r.TOUCH_ROTATE:if(!1===i.enableRotate)return;U(e),i.update();break;case r.TOUCH_PAN:if(!1===i.enablePan)return;N(e),i.update();break;case r.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;Y(e),i.update();break;case r.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;X(e),i.update();break;default:o=r.NONE}}function en(e){!1!==i.enabled&&e.preventDefault()}function es(e){x.push(e)}function el(e){delete P[e.pointerId];for(let t=0;t<x.length;t++)if(x[t].pointerId==e.pointerId){x.splice(t,1);return}}function eh(e){let t=P[e.pointerId];void 0===t&&(t=new $4xklQ.Vector2,P[e.pointerId]=t),t.set(e.pageX,e.pageY)}function ec(e){let t=e.pointerId===x[0].pointerId?x[1]:x[0];return P[t.pointerId]}i.domElement.addEventListener("contextmenu",en),i.domElement.addEventListener("pointerdown",J),i.domElement.addEventListener("pointercancel",K),i.domElement.addEventListener("wheel",ei,{passive:!1}),this.update()}}var $4xklQ=parcelRequire("4xklQ");const $8d1fbad8232a9667$var$_plane=new $4xklQ.Plane,$8d1fbad8232a9667$var$_raycaster=new $4xklQ.Raycaster,$8d1fbad8232a9667$var$_pointer=new $4xklQ.Vector2,$8d1fbad8232a9667$var$_offset=new $4xklQ.Vector3,$8d1fbad8232a9667$var$_intersection=new $4xklQ.Vector3,$8d1fbad8232a9667$var$_worldPosition=new $4xklQ.Vector3,$8d1fbad8232a9667$var$_inverseMatrix=new $4xklQ.Matrix4;class $8d1fbad8232a9667$export$350d0cf1f91b53f4 extends $4xklQ.EventDispatcher{constructor(e,t,i){super(),i.style.touchAction="none";let r=null,o=null,a=[],n=this;function s(){i.addEventListener("pointermove",p),i.addEventListener("pointerdown",u),i.addEventListener("pointerup",m),i.addEventListener("pointerleave",m)}function l(){i.removeEventListener("pointermove",p),i.removeEventListener("pointerdown",u),i.removeEventListener("pointerup",m),i.removeEventListener("pointerleave",m),i.style.cursor=""}function h(){l()}function c(){return e}function d(){return $8d1fbad8232a9667$var$_raycaster}function p(s){if(!1!==n.enabled){if(g(s),$8d1fbad8232a9667$var$_raycaster.setFromCamera($8d1fbad8232a9667$var$_pointer,t),r){$8d1fbad8232a9667$var$_raycaster.ray.intersectPlane($8d1fbad8232a9667$var$_plane,$8d1fbad8232a9667$var$_intersection)&&r.position.copy($8d1fbad8232a9667$var$_intersection.sub($8d1fbad8232a9667$var$_offset).applyMatrix4($8d1fbad8232a9667$var$_inverseMatrix)),n.dispatchEvent({type:"drag",object:r});return}if("mouse"===s.pointerType||"pen"===s.pointerType){if(a.length=0,$8d1fbad8232a9667$var$_raycaster.setFromCamera($8d1fbad8232a9667$var$_pointer,t),$8d1fbad8232a9667$var$_raycaster.intersectObjects(e,!0,a),a.length>0){let e=a[0].object;$8d1fbad8232a9667$var$_plane.setFromNormalAndCoplanarPoint(t.getWorldDirection($8d1fbad8232a9667$var$_plane.normal),$8d1fbad8232a9667$var$_worldPosition.setFromMatrixPosition(e.matrixWorld)),o!==e&&null!==o&&(n.dispatchEvent({type:"hoveroff",object:o}),i.style.cursor="auto",o=null),o!==e&&(n.dispatchEvent({type:"hoveron",object:e}),i.style.cursor="pointer",o=e)}else null!==o&&(n.dispatchEvent({type:"hoveroff",object:o}),i.style.cursor="auto",o=null)}}}function u(o){!1!==n.enabled&&(g(o),a.length=0,$8d1fbad8232a9667$var$_raycaster.setFromCamera($8d1fbad8232a9667$var$_pointer,t),$8d1fbad8232a9667$var$_raycaster.intersectObjects(e,!0,a),a.length>0&&(r=!0===n.transformGroup?e[0]:a[0].object,$8d1fbad8232a9667$var$_plane.setFromNormalAndCoplanarPoint(t.getWorldDirection($8d1fbad8232a9667$var$_plane.normal),$8d1fbad8232a9667$var$_worldPosition.setFromMatrixPosition(r.matrixWorld)),$8d1fbad8232a9667$var$_raycaster.ray.intersectPlane($8d1fbad8232a9667$var$_plane,$8d1fbad8232a9667$var$_intersection)&&($8d1fbad8232a9667$var$_inverseMatrix.copy(r.parent.matrixWorld).invert(),$8d1fbad8232a9667$var$_offset.copy($8d1fbad8232a9667$var$_intersection).sub($8d1fbad8232a9667$var$_worldPosition.setFromMatrixPosition(r.matrixWorld))),i.style.cursor="move",n.dispatchEvent({type:"dragstart",object:r})))}function m(){!1!==n.enabled&&(r&&(n.dispatchEvent({type:"dragend",object:r}),r=null),i.style.cursor=o?"pointer":"auto")}function g(e){let t=i.getBoundingClientRect();$8d1fbad8232a9667$var$_pointer.x=(e.clientX-t.left)/t.width*2-1,$8d1fbad8232a9667$var$_pointer.y=-(e.clientY-t.top)/t.height*2+1}s(),this.enabled=!0,this.transformGroup=!1,this.activate=s,this.deactivate=l,this.dispose=h,this.getObjects=c,this.getRaycaster=d}}var $3BPdS=parcelRequire("3BPdS");parcelRequire("9HO6e");class $9b1db6660d92c803$export$fd171b37577d7494{static toolType="free";static dom="";constructor(e){this.editor=e,this.uiPanelBox="",this.scene="",this.camera="",this.renderer="",this.raycaster="",this.floor="",this.startPoint="",this.endPoint="",this.currenDraw="",this.helperGroup=new $4xklQ.Group,this.labelRenderer="",this.chooseColor=new $4xklQ.Color("#4169E1"),this.cancelChooseColor=new $4xklQ.Color("#363636"),this.allMesh=[],this.allDrapMesh=[],this.curentChoose="",this.currentPoint="",this.downPoint=""}sceneInit(e){$9b1db6660d92c803$export$fd171b37577d7494.dom=e,this.uiPanelBox=new $3BPdS.UIPanel,this.uiPanelBox.setWidth(window.innerWidth+"px"),this.uiPanelBox.setHeight(window.innerHeight+"px"),this.scene=new $4xklQ.Scene,this.scene.background=new $4xklQ.Color("#FFFFFF"),this.raycaster=new $4xklQ.Raycaster,this.camera=new $4xklQ.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,1e4),this.camera.position.set(0,0,1e4),this.camera.lookAt(this.scene.position);let t=new $4xklQ.PlaneGeometry(2e5,2e5),i=new $4xklQ.MeshStandardMaterial({color:16777215,roughness:1,metalness:0});this.floor=new $4xklQ.Mesh(t,i),this.floor.material.opacity=0,this.floor.material.transparent=!0,this.scene.add(this.floor);let r=2e5,o=400,a=new $4xklQ.GridHelper(r,o,255,1118481);a.material.opacity=.5,a.material.transparent=!0,a.rotation.x=-Math.PI/2,this.scene.add(a),this.scene.add(new $4xklQ.HemisphereLight(8947831,7829384));let n=new $4xklQ.DirectionalLight(16777215);n.position.set(0,6,0),this.scene.add(n);let s=new $50d9c80e72e6b8f4$export$8ff7788029dfdf52(this.camera,e);s.target.set(0,0,0),s.enableRotate=!1,s.minDistance=100,s.maxDistance=1e4,s.update(),this.renderer=new $4xklQ.WebGLRenderer({antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.xr.enabled=!0,this.renderer.outputEncoding=$4xklQ.sRGBEncoding,e.appendChild(this.renderer.domElement),e.parentNode.appendChild(this.uiPanelBox.dom),this.scene.add(this.helperGroup);let l=new $8d1fbad8232a9667$export$350d0cf1f91b53f4(this.allDrapMesh,this.camera,e);return l.transformGroup=!0,l.addEventListener("drag",this.dragging.bind(this)),window.addEventListener("resize",this.onWindowResize),e.addEventListener("mousemove",this.mouseMove.bind(this)),e.addEventListener("mousedown",this.mouseDown.bind(this)),e.addEventListener("click",this.mouseClick.bind(this)),e.addEventListener("touchstart",this.onTouchStart.bind(this)),e.addEventListener("touchend",this.onTouchEnd.bind(this)),document.onkeydown=(function(e){switch(27==window.event.keyCode&&($9b1db6660d92c803$export$fd171b37577d7494.toolType="free",this.editor.list.startPlayer.dispatch(),this.startPoint="",""!=this.currenDraw&&this.removeMesh(this.currenDraw),this.removeInputByClassName(this.uiPanelBox.dom,"moveInput"),this.removeInputByClassName(this.uiPanelBox.dom,"moveInput"),this.currenDraw),e.key.toLowerCase()){case"backspace":e.preventDefault();case"delete":let t=this.editor.selected;if(null===t)return;let i=t.parent;null!==i&&this.editor.execute(new RemoveObjectCommand(this.editor,t));break;case this.editor.config.getKey("settings/shortcuts/translate"):signals.transformModeChanged.dispatch("translate");break;case this.editor.config.getKey("settings/shortcuts/rotate"):signals.transformModeChanged.dispatch("rotate");break;case this.editor.config.getKey("settings/shortcuts/scale"):signals.transformModeChanged.dispatch("scale");break;case this.editor.config.getKey("settings/shortcuts/undo"):(this.editor.config.IS_MAC?e.metaKey:e.ctrlKey)&&(e.preventDefault(),this.editor.undo());break;case this.editor.config.getKey("settings/shortcuts/redo"):(this.editor.config.IS_MAC?e.metaKey:e.ctrlKey)&&(e.preventDefault(),this.editor.redo());break;case this.editor.config.getKey("settings/shortcuts/focus"):null!==this.editor.selected&&this.editor.focus(this.editor.selected)}}).bind(this),this}clearScene(e){for(var t=e.lastElementChild;t;)e.removeChild(t),t=e.lastElementChild}onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}dragging(e){if("controlPoint"==e.object.useType){let e=this.curentChoose.startPoint,t=this.curentChoose.endPoint,i=this.currentPoint;this.removeMesh(this.curentChoose);let r=new $523a84362d27c3e8$export$b680ca477a72be07().createCurveWall(e,t,i),o=new $d0f874000594cf7a$export$a955f3d6a39ce4b2().createCurveHelp(e,t,r.controlPoint);this.allDrapMesh[0]=o.controlMesh,this.addMesh(r),o.wallId=r.id,this.helperGroup.add(o),this.curentChoose=r}}mouseDown(e){this.downPoint=this.getWorldPosition(e)}mouseMove(e){let t=new $4xklQ.Vector3(0,0,0);t.x=e.clientX/window.innerWidth*2-1,t.y=-(2*(e.clientY/window.innerHeight))+1;let i=this.getWorldPosition(e);if(this.currentPoint=i,"free"!=$9b1db6660d92c803$export$fd171b37577d7494.toolType){if(!this.startPoint)return;if(""!=this.currenDraw&&this.removeMesh(this.currenDraw),this.editor.list.stopPlayer.dispatch(),"wall"==$9b1db6660d92c803$export$fd171b37577d7494.toolType){this.currenDraw=new $523a84362d27c3e8$export$b680ca477a72be07().createLineWall(this.startPoint,i);let e=new $d0f874000594cf7a$export$a955f3d6a39ce4b2().drawWallHelp(this.startPoint,i);e.wallId=this.currenDraw.id,this.removeInputByClassName(this.uiPanelBox.dom,"moveInput");let t=this.getScreenPosition(e.arcCenter.clone()),r=new(0,$3BPdS.UIInput)(e.realAngle).setClass("moveInput").setFontSize("15px").setWidth("40px").setMarginTop(t.y+"px").setMarginLeft(t.x+"px"),o=this.getScreenPosition(e.lineCenter.clone()),a=new(0,$3BPdS.UIInput)(e.lineLength).setClass("moveInput").setFontSize("15px").setWidth("40px").setMarginTop(o.y+"px").setMarginLeft(o.x+"px");this.uiPanelBox.add(r),this.uiPanelBox.add(a),this.scene.add(this.currenDraw),this.helperGroup.add(e)}else"room"==$9b1db6660d92c803$export$fd171b37577d7494.toolType&&(this.currenDraw=new $523a84362d27c3e8$export$43cb61aa07eebcbc().createRoom(this.startPoint,i),this.scene.add(this.currenDraw))}else{this.raycaster.setFromCamera(t,this.camera);for(let e=0;e<this.allMesh.length;e++)"wall"==this.allMesh[e].useType&&this.allMesh[e]!=this.curentChoose&&(this.allMesh[e].material.color=this.cancelChooseColor);$9b1db6660d92c803$export$fd171b37577d7494.dom.style.cursor="default";var r=this.raycaster.intersectObjects(this.allMesh);r.length>0&&"wall"==r[0].object.useType&&(r[0].object.material.color=this.chooseColor,$9b1db6660d92c803$export$fd171b37577d7494.dom.style.cursor="move")}}mouseClick(e){let t=this.getWorldPosition(e);if("free"!=$9b1db6660d92c803$export$fd171b37577d7494.toolType)this.startPoint?(this.endPoint=t,this.editor.list.startPlayer.dispatch(),"wall"==$9b1db6660d92c803$export$fd171b37577d7494.toolType?(this.currenDraw.material.color=this.cancelChooseColor,this.allMesh.push(this.currenDraw),this.removeInputByClassName(this.uiPanelBox.dom,"moveInput"),this.removeInputByClassName(this.uiPanelBox.dom,"moveInput"),this.removeMesh(this.currenDraw),this.editor.execute(new $523a84362d27c3e8$export$b680ca477a72be07(this.editor,this.currenDraw),"画墙"),this.startPoint=t):"room"==$9b1db6660d92c803$export$fd171b37577d7494.toolType&&(this.removeMesh(this.currenDraw),this.editor.execute(new $523a84362d27c3e8$export$43cb61aa07eebcbc(this.editor,this.currenDraw),"画房间"),this.startPoint=""),this.currenDraw=""):this.startPoint=t;else{let r=new $4xklQ.Vector3(0,0,0);r.x=e.clientX/window.innerWidth*2-1,r.y=-(2*(e.clientY/window.innerHeight))+1,this.raycaster.setFromCamera(r,this.camera),$9b1db6660d92c803$export$fd171b37577d7494.dom.style.cursor="default";var i=this.raycaster.intersectObjects(this.allMesh);if(i.length>0){if("wall"==i[0].object.useType){i[0].object.material.color=this.chooseColor;let e=i[0].object.startPoint,t=i[0].object.endPoint;this.removeMesh(i[0].object),this.removeInputByClassName(this.uiPanelBox.dom,"showWallLength"+i[0].object.uuid);let r="";if(this.curentChoose){this.curentChoose.material.color=this.cancelChooseColor;for(let e=0;e<this.curentChoose.children.length;e++)"arcHelper"==this.curentChoose.children[e].useType&&this.curentChoose.remove(this.curentChoose.children[e])}if("lineWall"==i[0].object.wallType){r=new $523a84362d27c3e8$export$b680ca477a72be07().createCurveWall(e,t);let i=new $d0f874000594cf7a$export$a955f3d6a39ce4b2().createCurveHelp(e,t,r.controlPoint);this.allDrapMesh[0]=i.controlMesh,this.addMesh(r),i.wallId=r.id,this.helperGroup.add(i)}else{r=new $523a84362d27c3e8$export$b680ca477a72be07().createLineWall(e,t,!1);let i=new $d0f874000594cf7a$export$a955f3d6a39ce4b2().createLineDimensionsLine(e,t,!1),o=this.getScreenPosition(i.center.clone()),a=new(0,$3BPdS.UIText)(i.lineLength).setClass("showWallLength"+r.uuid).setFontSize("15px").setWidth("20px").setMarginTop(o.y+"px").setMarginLeft(o.x+"px");this.uiPanelBox.add(a),i.wallId=r.id,this.helperGroup.add(i),this.addMesh(r)}r.material.color=this.chooseColor,this.curentChoose=r}}else{let e=this.downPoint.clone().distanceTo(t.clone());this.curentChoose&&"wall"==this.curentChoose.useType&&e<5&&(this.curentChoose.material.color=this.cancelChooseColor,this.removeHelperByWallId(this.curentChoose.id),this.curentChoose="")}}}onTouchStart(e){}onTouchEnd(e){}removeHelperByWallId(e){let t=this.helperGroup.children;for(let i=0;i<t.length;i++)t[i].wallId&&t[i].wallId==e&&this.helperGroup.remove(t[i])}createLastWall(e){let t=new $d0f874000594cf7a$export$a955f3d6a39ce4b2().createLineDimensionsLine(e.startPoint,e.endPoint,!1),i=this.getScreenPosition(t.center.clone()),r=new(0,$3BPdS.UIText)(t.lineLength).setClass("showWallLength"+e.uuid).setFontSize("15px").setWidth("20px").setMarginTop(i.y+"px").setMarginLeft(i.x+"px");this.uiPanelBox.add(r),t.wallId=e.id,this.helperGroup.add(t),this.scene.add(e)}createRoom(e){this.scene.add(e)}removeMesh(e){this.allMesh.indexOf(e)>=0&&this.allMesh.splice(this.allMesh.indexOf(e),1),this.removeHelperByWallId(e.id),this.scene.remove(e),this.removeInputByClassName(this.uiPanelBox.dom,"showWallLength"+e.uuid)}addMesh(e){this.allMesh.push(e),this.scene.add(e)}removeInputByClassName(e,t){let i=e.children;for(let r=0;r<i.length;r++)i[r].className==t&&e.removeChild(i[r])}getWorldPosition(e){let t=new $4xklQ.Vector3(0,0,0);t.x=e.clientX/window.innerWidth*2-1,t.y=-(2*(e.clientY/window.innerHeight))+1,this.raycaster.setFromCamera(t,this.camera);var i=this.raycaster.intersectObjects([this.floor]);let r=new $4xklQ.Vector3(0,0,0);return i.length>0&&(r=i[0].point),r}getScreenPosition(e){e=e.project(this.camera);let t=window.innerWidth/2,i=window.innerHeight/2;return{x:Math.round(e.x*t+t)-22,y:Math.round(-e.y*i+i)-10}}getModelVertex(e){e.updateWorldMatrix(!0,!1);let t=e.geometry.attributes.position.array,i=new $4xklQ.Vector3(t[0],t[1],0),r=new $4xklQ.Vector3(t[6],t[7],0),o=new $4xklQ.Vector3(t[9],t[10],0),a=new $4xklQ.Vector3(t[3],t[4],0),n=new $4xklQ.Vector3((i.x+r.x)/2,(i.y+r.y)/2,0),s=new $4xklQ.Vector3((r.x+o.x)/2,(r.y+o.y)/2,0),l=new $4xklQ.Vector3((i.x+a.x)/2,(i.y+a.y)/2,0),h=new $4xklQ.Vector3((a.x+o.x)/2,(a.y+o.y)/2,0),c=[i,r,o,a,n,s,l,h];for(let t=0;t<c.length;t++)c[t]=e.localToWorld(c[t]);return c}animate(){this.renderer.setAnimationLoop(this.render.bind(this))}render(){this.renderer.render(this.scene,this.camera)}}var $47Y2g=parcelRequire("47Y2g");class $3fdc31d914635d41$export$84202caead5689ba{constructor(e,t){this.editor=e,this.undos=[],this.undosJson=[],this.redos=[],this.redosJson=[],this.lastCmdTime=new Date,this.idCounter=0,this.deviceType=t,this.historyDisabled=!1,this.config=e.config;let i=this;this.editor.list.startPlayer.add(function(){i.historyDisabled=!1}),this.editor.list.stopPlayer.add(function(){i.historyDisabled=!0})}execute(e,t,i=""){let r=this.undos[this.undos.length-1],o=new Date().getTime()-this.lastCmdTime.getTime(),a=r&&r.updatable&&e.updatable&&r.object===e.object&&r.type===e.type&&r.script===e.script&&r.attributeName===e.attributeName;a&&"SetScriptValueCommand"===e.type?(r.update(e),e=r):a&&o<500?(r.update(e),e=r):(this.undos.push(e),0!=this.editor.statusJson.length?this.undosJson.push(JSON.stringify(this.editor.statusJson)):""!=i?this.undosJson.push(JSON.stringify(i)):"PC"==this.deviceType?this.undosJson.push(JSON.stringify(this.editor.getSceneAllJson())):this.undosJson.push(JSON.stringify((0,$47Y2g.MobileMain).getAllJson())),""!=e&&(e.id=++this.idCounter)),""!=e&&(e.name=void 0!==t?t:e.name,e.execute(),e.inMemory=!0,this.config.getKey("settings/history")&&(e.json=e.toJSON())),this.lastCmdTime=new Date,this.redos=[],this.redosJson=[]}undo(){let e;if(this.historyDisabled)return;let t="";return this.undos.length>0&&(e=this.undos.pop(),t=this.undosJson.pop(),!1===e.inMemory&&e.fromJSON(e.json)),(void 0!==e||""==e)&&("PC"==this.deviceType?this.redosJson.push(JSON.stringify(this.editor.getSceneAllJson())):this.redosJson.push(JSON.stringify((0,$47Y2g.MobileMain).getAllJson())),""==e?(this.editor.cacheJson=t,"PC"==this.deviceType?this.editor.readCache(t):(0,$47Y2g.MobileMain).readCache(t)):e.undo(t),this.redos.push(e)),e}redo(){let e;if(this.historyDisabled)return;let t="";return this.redos.length>0&&(e=this.redos.pop(),t=this.redosJson.pop(),!1===e.inMemory&&e.fromJSON(e.json)),(void 0!==e||""==e)&&("PC"==this.deviceType?this.undosJson.push(JSON.stringify(this.editor.getSceneAllJson())):this.undosJson.push(JSON.stringify((0,$47Y2g.MobileMain).getAllJson())),""==e?(this.editor.cacheJson=t,"PC"==this.deviceType?this.editor.readCache(t):(0,$47Y2g.MobileMain).readCache(t)):e.redo(t),this.undos.push(e)),e}}var $4xklQ=parcelRequire("4xklQ");class $8b391c7d7cfc95c8$export$29cd7b75162a9425{constructor(){if(this.name="threejs-editor",this.centerArea=240,this.pointArea=240,this.drawDoorArea=500,this.doorWidth=750,this.angleToolChooseColor=new $4xklQ.Color("rgb(26,122,248)"),this.angleToolUnChooseColor=new $4xklQ.Color("rgb(153,193,244)"),this.drawDotMaterial=new $4xklQ.LineDashedMaterial({color:0,depthTest:!1,dashSize:3,gapSize:3}),this.dotMaterial=new $4xklQ.LineDashedMaterial({color:0,depthTest:!1,dashSize:30,gapSize:10}),this.boxColor="#396EFE",this.circleRadio=1500,this.boxLineWidth=3,this.boxLineColor=this.boxColor,this.wallNum=4,this.wallFirstMaterial=new $4xklQ.MeshBasicMaterial({color:"#2D61A4",side:$4xklQ.DoubleSide,transparent:!0,opacity:.8}),window.roomOpacity=.8,window.storeyHei=2800,window.floorDep=0,this.screenMoveArea=3,this.maxWidth=10,this.remoteUrl="https://rjhcdn.bsphpro.com/ocean/upload_data/uploads/",this.remoteCacheUrl="https://dev.rjhapi.bsphpro.com/ocean/upload",this.storage={language:"en",autosave:!0,"project/title":"","project/editable":!1,"project/vr":!1,"project/renderer/antialias":!0,"project/renderer/shadows":!0,"project/renderer/shadowType":1,"project/renderer/physicallyCorrectLights":!1,"project/renderer/toneMapping":0,"project/renderer/toneMappingExposure":1,"settings/history":!1,"settings/shortcuts/translate":"w","settings/shortcuts/rotate":"e","settings/shortcuts/scale":"r","settings/shortcuts/undo":"z","settings/shortcuts/redo":"y","settings/shortcuts/focus":"f"},this.IS_MAC=navigator.platform.toUpperCase().indexOf("MAC")>=0,void 0===window.localStorage[this.name])window.localStorage[this.name]=JSON.stringify(this.storage);else{let e=JSON.parse(window.localStorage[this.name]);for(let t in e)this.storage[t]=e[t]}this.toolTypeConfig={doubledoor:"doubledoor",door:"door",slidingdoor:"slidingdoor",window:"window",straightBayWindow:"baywindow",frenchwindows:"frenchwindows",doubledoor:"singleDoubleDoor",childMotherDoor:"childMotherDoor",passDoor:"pass",straightBayWindow:"straightBayWindow",LWindow:"LWindow",LBayWindow:"",UWindow:"UWindow",UBayWindow:"",dooropen:"dooropen",archDoor:"archDoor",archWindow:"archWindow",arcDoor:"",arcWindow:"arcWindow",beam:"bridge",pillars:"post",flue:"flue"},this.settingJson={roomName:!0,roomArea:!0,dimension:!0,showMember:!0,showFloorFurniture:!0,showWallFurniture:!0,showCeilFurniture:!0,showKitchen:!0,showAllHouseFurniture:!0},this.modelTypeJson={doubledoor:"双开门",door:"单开门",slidingdoor:"移门",window:"窗",straightBayWindow:"飘窗",frenchwindows:"落地窗",childMotherDoor:"字母门",passDoor:"垭口",LWindow:"L型窗",UWindow:"U型窗",dooropen:"门洞",archDoor:"拱形门",archWindow:"拱形窗",arcWindow:"弧形窗"};let e=Date.now();this.settingJsonCopy=JSON.parse(JSON.stringify(this.settingJson)),this.baseDoorFrame=new(0,$4xklQ.TextureLoader)().load(window.url+"/assets/images/material/frame.jpg?"+e),this.baseDoorFace=new(0,$4xklQ.TextureLoader)().load(window.url+"/assets/images/material/doorFace.jpg?"+e),this.slidingDoorframe=new(0,$4xklQ.TextureLoader)().load(window.url+"/assets/images/material/sliddoorframe.jpg?"+e),this.slidingDoorFace=new(0,$4xklQ.TextureLoader)().load(window.url+"/assets/images/material/sliddoorFace.jpg?"+e),this.lashDoorPartition=new(0,$4xklQ.TextureLoader)().load(window.url+"/assets/images/material/zimudoorcrack.jpg?"+e),this.baseWindowFrame=new(0,$4xklQ.TextureLoader)().load(window.url+"/assets/images/material/windowframe.jpg?"+e),this.baseWindowFace=new(0,$4xklQ.TextureLoader)().load(window.url+"/assets/images/material/windowFace.jpg?"+e),this.passMeshTexture=new(0,$4xklQ.TextureLoader)().load(window.url+"/assets/images/material/material01.jpg?"+e),this.sectorDoorTexture=new(0,$4xklQ.TextureLoader)().load(window.url+"/assets/images/material/material02.jpg?"+e),this.marbleTexture=new(0,$4xklQ.TextureLoader)().load(window.url+"/assets/images/material/marble.jpg?"+e),this.uvGridTexture=new(0,$4xklQ.TextureLoader)().load(window.url+"/assets/images/banner/uvGrid.jpg?"+e),this.floorTexture=new(0,$4xklQ.TextureLoader)().load(window.url+"/assets/images/banner/floor.jpg?"+e)}getKey(e){return this.storage[e]}setKey(){for(let e=0,t=arguments.length;e<t;e+=2)storage[arguments[e]]=arguments[e+1];window.localStorage[name]=JSON.stringify(storage)}clear(){delete window.localStorage[name]}}var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ"),$ba6ad40603587d6b$export$a33e02b86664bfb2={inTouch:!1,rd:!1,md:!1,inZoom:!1,firstPosition:new $4xklQ.Vector2(0,0),disVec2:0,disVec2_first:0,XcountOffset:0,YcountOffset:0,ZcountOffset:0,ctrlCamera:"",Init:function(e){e.removeEventListener("mousedown",$ba6ad40603587d6b$export$a33e02b86664bfb2.OnForbidden,!1),e.removeEventListener("mouseup",$ba6ad40603587d6b$export$a33e02b86664bfb2.OnForbidden,!1),e.removeEventListener("mousemove",$ba6ad40603587d6b$export$a33e02b86664bfb2.OnForbidden,!1),e.removeEventListener("mouseout",$ba6ad40603587d6b$export$a33e02b86664bfb2.OnForbidden,!1),e.removeEventListener("mousewheel",$ba6ad40603587d6b$export$a33e02b86664bfb2.OnForbidden,!1),e.removeEventListener("touchstart",$ba6ad40603587d6b$export$a33e02b86664bfb2.OnForbidden,!1),e.removeEventListener("touchmove",$ba6ad40603587d6b$export$a33e02b86664bfb2.OnForbidden,!1),e.removeEventListener("touchend",$ba6ad40603587d6b$export$a33e02b86664bfb2.OnForbidden,!1),e.addEventListener("mousedown",$ba6ad40603587d6b$export$a33e02b86664bfb2.onCanvasMouseDown,!1),e.addEventListener("mouseup",$ba6ad40603587d6b$export$a33e02b86664bfb2.onCanvasMouseUp,!1),e.addEventListener("mousemove",$ba6ad40603587d6b$export$a33e02b86664bfb2.onCanvasMouseMove,!1),e.addEventListener("mouseout",$ba6ad40603587d6b$export$a33e02b86664bfb2.onCanvasMouseOut,!1),e.addEventListener("mousewheel",$ba6ad40603587d6b$export$a33e02b86664bfb2.OnMousewheel,!1),e.addEventListener("touchstart",$ba6ad40603587d6b$export$a33e02b86664bfb2.OnTouchStart,!1),e.addEventListener("touchmove",$ba6ad40603587d6b$export$a33e02b86664bfb2.OnTouchMove,!1),e.addEventListener("touchend",$ba6ad40603587d6b$export$a33e02b86664bfb2.OnTouchEnd,!1),e.addEventListener("contextmenu",$ba6ad40603587d6b$export$a33e02b86664bfb2.oncontextmenu.bind(this),!0)},oncontextmenu:function(e){e.preventDefault(),$ba6ad40603587d6b$export$a33e02b86664bfb2.rd=!1},SetCtrlCamera:function(e){$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera=e},OnMousewheel:function(e){e.preventDefault(),$ba6ad40603587d6b$export$a33e02b86664bfb2.ZcountOffset+=-(.1*e.wheelDelta),$ba6ad40603587d6b$export$a33e02b86664bfb2.UpdateCamera()},OnForbidden:function(e){e.preventDefault()},onCanvasMouseDown:function(e){e.preventDefault(),$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera&&(2==e.button&&($ba6ad40603587d6b$export$a33e02b86664bfb2.rd=!0),1==e.button&&($ba6ad40603587d6b$export$a33e02b86664bfb2.md=!0),$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.countXBegin=57.3*$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.cameraRotX.rotation.x,$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.countYBegin=57.3*$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.cameraRotY.rotation.y,$ba6ad40603587d6b$export$a33e02b86664bfb2.XcountOffset=0,$ba6ad40603587d6b$export$a33e02b86664bfb2.YcountOffset=0,$ba6ad40603587d6b$export$a33e02b86664bfb2.firstPosition=new $4xklQ.Vector2(e.clientX,e.clientY),$ba6ad40603587d6b$export$a33e02b86664bfb2.inTouch=!0,$ba6ad40603587d6b$export$a33e02b86664bfb2.UpdateCamera())},onCanvasMouseUp:function(e){e.preventDefault(),$ba6ad40603587d6b$export$a33e02b86664bfb2.inTouch=!1,$ba6ad40603587d6b$export$a33e02b86664bfb2.md=!1,$ba6ad40603587d6b$export$a33e02b86664bfb2.UpdateCamera()},onCanvasMouseMove:function(e){e.preventDefault(),$ba6ad40603587d6b$export$a33e02b86664bfb2.inTouch&&($ba6ad40603587d6b$export$a33e02b86664bfb2.XcountOffset=$ba6ad40603587d6b$export$a33e02b86664bfb2.firstPosition.x-e.clientX,$ba6ad40603587d6b$export$a33e02b86664bfb2.YcountOffset=$ba6ad40603587d6b$export$a33e02b86664bfb2.firstPosition.y-e.clientY),$ba6ad40603587d6b$export$a33e02b86664bfb2.UpdateCamera()},onCanvasMouseOut:function(e){$ba6ad40603587d6b$export$a33e02b86664bfb2.UpdateCamera()},OnTouchStart:function(e){e.preventDefault(),$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera&&($ba6ad40603587d6b$export$a33e02b86664bfb2.inTouch=!0,$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.countXBegin=57.3*$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.cameraRotX.rotation.x,$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.countYBegin=57.3*$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.cameraRotY.rotation.y,2==e.targetTouches.length?($ba6ad40603587d6b$export$a33e02b86664bfb2.ZcountOffset=0,$ba6ad40603587d6b$export$a33e02b86664bfb2.disVec2=new $4xklQ.Vector2(e.targetTouches[0].clientX-e.targetTouches[1].clientX,e.targetTouches[0].clientY-e.targetTouches[1].clientY),$ba6ad40603587d6b$export$a33e02b86664bfb2.disVec2_first=$ba6ad40603587d6b$export$a33e02b86664bfb2.disVec2.length(),$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.countZBegin=$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.Zcount):$ba6ad40603587d6b$export$a33e02b86664bfb2.inZoom=!1,$ba6ad40603587d6b$export$a33e02b86664bfb2.XcountOffset=0,$ba6ad40603587d6b$export$a33e02b86664bfb2.YcountOffset=0,$ba6ad40603587d6b$export$a33e02b86664bfb2.firstPosition.x=e.targetTouches[0].clientX,$ba6ad40603587d6b$export$a33e02b86664bfb2.firstPosition.y=e.targetTouches[0].clientY,$ba6ad40603587d6b$export$a33e02b86664bfb2.UpdateCamera())},OnTouchMove:function(e){if(e.preventDefault(),$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera){if($ba6ad40603587d6b$export$a33e02b86664bfb2.inTouch=!0,1!=e.targetTouches.length||$ba6ad40603587d6b$export$a33e02b86664bfb2.inZoom){if(2==e.targetTouches.length){$ba6ad40603587d6b$export$a33e02b86664bfb2.inZoom=!0,$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.countXBegin=57.3*$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.cameraRotX.rotation.x,$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.countYBegin=57.3*$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.cameraRotY.rotation.y;var t=new $4xklQ.Vector2(e.targetTouches[0].clientX-e.targetTouches[1].clientX,e.targetTouches[0].clientY-e.targetTouches[1].clientY);$ba6ad40603587d6b$export$a33e02b86664bfb2.ZcountOffset=($ba6ad40603587d6b$export$a33e02b86664bfb2.disVec2_first-t.length())*5}}else $ba6ad40603587d6b$export$a33e02b86664bfb2.XcountOffset=$ba6ad40603587d6b$export$a33e02b86664bfb2.firstPosition.x-e.targetTouches[0].clientX,$ba6ad40603587d6b$export$a33e02b86664bfb2.YcountOffset=$ba6ad40603587d6b$export$a33e02b86664bfb2.firstPosition.y-e.targetTouches[0].clientY;$ba6ad40603587d6b$export$a33e02b86664bfb2.UpdateCamera()}},OnTouchEnd:function(e){e.preventDefault(),$ba6ad40603587d6b$export$a33e02b86664bfb2.inTouch=!1,$ba6ad40603587d6b$export$a33e02b86664bfb2.UpdateCamera(),$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.maximumZ<.01&&($ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.Xcount=0)},UpdateCamera:function(){$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera&&$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.setUpdateState($ba6ad40603587d6b$export$a33e02b86664bfb2.XcountOffset,$ba6ad40603587d6b$export$a33e02b86664bfb2.YcountOffset,$ba6ad40603587d6b$export$a33e02b86664bfb2.ZcountOffset)}},$ba6ad40603587d6b$export$c7dab90f68cf5e8d={walkingSpeed:.25,cameraName:"",compass:"",zhiBeiZhenCorrect:0,sommthFactor:.08,countXBegin:0,countYBegin:0,countZBegin:0,Xcount:0,Ycount:0,Zcount:0,Xsmooth:0,Ysmooth:0,Zsmooth:0,minimumX:0,maximumX:0,minimumZ:0,maximumZ:1e3,camera:"",camBase:"",cameraRotX:"",cameraRotY:"",defaultXcount:0,defaultYcount:0,defaultZcount:0,defaultPosX:0,defaultPosY:0,defaultPosZ:0,posX:0,posY:0,posZ:0,smoothPosX:0,smoothPosY:0,smoothPosZ:0,Init:function(e){$ba6ad40603587d6b$export$c7dab90f68cf5e8d.viewport=e,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camera=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.viewport.editor.camera,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camBase=new $4xklQ.Object3D,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.cameraRotX=new $4xklQ.Object3D,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.cameraRotY=new $4xklQ.Object3D,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camBase.name="camBase",$ba6ad40603587d6b$export$c7dab90f68cf5e8d.cameraRotX.name="cameraRotX",$ba6ad40603587d6b$export$c7dab90f68cf5e8d.cameraRotY.name="cameraRotY",$ba6ad40603587d6b$export$c7dab90f68cf5e8d.cameraRotX.add($ba6ad40603587d6b$export$c7dab90f68cf5e8d.camera),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.cameraRotY.add($ba6ad40603587d6b$export$c7dab90f68cf5e8d.cameraRotX),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camBase.add($ba6ad40603587d6b$export$c7dab90f68cf5e8d.cameraRotY);var t=new $4xklQ.BufferGeometry,i=new Float32Array([-1,-1,1,1,-1,1,1,1,1,1,1,1,-1,1,1,-1,-1,1]),r=new Float32Array([0,0,1,0,1,1,1,1,0,1,0,0]);t.setAttribute("position",new $4xklQ.BufferAttribute(i,3)),t.setAttribute("uv",new $4xklQ.BufferAttribute(r,2));var o=new $4xklQ.MeshBasicMaterial({color:16777215});o.depthWrite=!1,o.depthFunc=$4xklQ.AlwaysDepth,o.transparent=!0;var a=new $4xklQ.Mesh(t,o);$ba6ad40603587d6b$export$c7dab90f68cf5e8d.compass=a,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.compass.scale.x=.15,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.compass.scale.y=.15,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.compass.scale.z=.15,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.compass.position.x=-1,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.compass.position.y=.9,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.compass.position.z=-2,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.compass.renderOrder=1e4,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camera.add($ba6ad40603587d6b$export$c7dab90f68cf5e8d.compass),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.compass.visible=!1},SetInitStates:function(e,t,i,r){$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camera.aspect=e,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camera.fov=t,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camera.near=i,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camera.far=r,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camera.updateProjectionMatrix()},SetupCameraCtrl:function(e,t){$ba6ad40603587d6b$export$c7dab90f68cf5e8d.RecordDefaultState(e[0],e[1],e[2],-e[3],-e[4],e[5]),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.SetCameraPos(e[0],e[1],e[2]),console.log(),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.minimumX=e[9],$ba6ad40603587d6b$export$c7dab90f68cf5e8d.maximumX=e[10],$ba6ad40603587d6b$export$c7dab90f68cf5e8d.minimumZ=e[11],$ba6ad40603587d6b$export$c7dab90f68cf5e8d.maximumZ=e[12],$ba6ad40603587d6b$export$c7dab90f68cf5e8d.zhiBeiZhenCorrect=e[13],$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camBase.updateMatrix(),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.ResetCameraState(t),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zcount+=.01,$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera&&$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.NeedUpdate()&&console.log("aaa")},RecordDefaultState:function(e,t,i,r,o,a){$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultPosX=e,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultPosY=t,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultPosZ=i,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultXcount=r,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultYcount=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.ModiferYCount($ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ycount,o),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultZcount=a},SetCameraPos:function(e,t,i){""!==e&&($ba6ad40603587d6b$export$c7dab90f68cf5e8d.posX=Number(e)),""!==t&&($ba6ad40603587d6b$export$c7dab90f68cf5e8d.posY=Number(t),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camBase.position.y=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.posY),""!==i&&($ba6ad40603587d6b$export$c7dab90f68cf5e8d.posZ=Number(i))},ModiferYCount:function(e,t){var i,r=e%360,o=t%360;return o<0&&(o+=360),r<0&&(r+=360),r>o?(r-o>180&&(o+=360),i=e+o-r):(r-o<-180&&(r+=360),i=e-(r-o)),i},SetCameraXYZcount:function(e,t,i){""!=e&&($ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xcount=-Number(e),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.countXBegin=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xcount),""!=t&&($ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ycount=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.ModiferYCount($ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ycount,-Number(t)),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.countYBegin=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ycount),""!=i&&($ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zcount=Number(i),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.countZBegin=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zcount),$ba6ad40603587d6b$export$a33e02b86664bfb2.XcountOffset=0,$ba6ad40603587d6b$export$a33e02b86664bfb2.YcountOffset=0,$ba6ad40603587d6b$export$a33e02b86664bfb2.ZcountOffset=0},SetCameraStates:function(e){$ba6ad40603587d6b$export$c7dab90f68cf5e8d.SetCameraPos(e[0],e[1],e[2]),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.SetCameraXYZcount(e[3],e[4],e[5])},ResetCameraState:function(e){$ba6ad40603587d6b$export$c7dab90f68cf5e8d.countXBegin=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultXcount,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.countYBegin=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultYcount,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.countZBegin=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultZcount,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xcount=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultXcount,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ycount=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultYcount,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zcount=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultZcount,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.posX=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultPosX,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.posY=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultPosY,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.posZ=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultPosZ,$ba6ad40603587d6b$export$a33e02b86664bfb2.XcountOffset=0,$ba6ad40603587d6b$export$a33e02b86664bfb2.YcountOffset=0,$ba6ad40603587d6b$export$a33e02b86664bfb2.ZcountOffset=0,e&&($ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xsmooth=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xcount,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ysmooth=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ycount,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zsmooth=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zcount,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.smoothPosX=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultPosX,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.smoothPosY=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultPosY,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.smoothPosZ=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultPosZ)},setUpdateState:function(e,t,i){$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xcount=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.countXBegin+.5*t*.1,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ycount=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.countYBegin+.5*e*.1,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zcount=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.countZBegin+.1*i*.1},NeedUpdate:function(){if($ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xcount=$4xklQ.MathUtils.clamp($ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xcount,-$ba6ad40603587d6b$export$c7dab90f68cf5e8d.maximumX,-$ba6ad40603587d6b$export$c7dab90f68cf5e8d.minimumX),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zcount=$4xklQ.MathUtils.clamp($ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zcount,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.minimumZ,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.maximumZ),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xsmooth=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xsmooth*(1-$ba6ad40603587d6b$export$c7dab90f68cf5e8d.sommthFactor)+$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xcount*$ba6ad40603587d6b$export$c7dab90f68cf5e8d.sommthFactor,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ysmooth=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ysmooth*(1-$ba6ad40603587d6b$export$c7dab90f68cf5e8d.sommthFactor)+$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ycount*$ba6ad40603587d6b$export$c7dab90f68cf5e8d.sommthFactor,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zsmooth=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zsmooth*(1-$ba6ad40603587d6b$export$c7dab90f68cf5e8d.sommthFactor)+$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zcount*$ba6ad40603587d6b$export$c7dab90f68cf5e8d.sommthFactor,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.smoothPosX=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.smoothPosX*(1-$ba6ad40603587d6b$export$c7dab90f68cf5e8d.sommthFactor)+$ba6ad40603587d6b$export$c7dab90f68cf5e8d.posX*$ba6ad40603587d6b$export$c7dab90f68cf5e8d.sommthFactor,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.smoothPosZ=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.smoothPosZ*(1-$ba6ad40603587d6b$export$c7dab90f68cf5e8d.sommthFactor)+$ba6ad40603587d6b$export$c7dab90f68cf5e8d.posZ*$ba6ad40603587d6b$export$c7dab90f68cf5e8d.sommthFactor,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camBase.position.x=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.smoothPosX,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camBase.position.z=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.smoothPosZ,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.cameraRotX.rotation.x=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xsmooth/57.3,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.cameraRotY.rotation.y=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ysmooth/57.3,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camera.position.z=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zsmooth,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.compass.rotation.z=-$ba6ad40603587d6b$export$c7dab90f68cf5e8d.cameraRotY.rotation.y+$ba6ad40603587d6b$export$c7dab90f68cf5e8d.zhiBeiZhenCorrect,$ba6ad40603587d6b$export$a33e02b86664bfb2.inTouch&&$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zcount<1){let r=new $4xklQ.Vector3;$ba6ad40603587d6b$export$c7dab90f68cf5e8d.cameraRotY.getWorldDirection(r);let o=new $4xklQ.Vector3(r.x,r.y,r.z);$ba6ad40603587d6b$export$a33e02b86664bfb2.rd?(r.x=-r.x,r.y=-r.y,r.z=-r.z):r=o,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camBase.forward=r;var e=!0,t=new $4xklQ.Ray($ba6ad40603587d6b$export$c7dab90f68cf5e8d.camBase.position,r);let a=[];i($ba6ad40603587d6b$export$c7dab90f68cf5e8d.camBase.parent);for(let i=0;i<a.length;i++){a[i].updateMatrix(),a[i].updateMatrixWorld(!0);let r=Array.from(a[i].geometry.attributes.position.array);if(a[i].geometry.index){let o=Array.from(a[i].geometry.index.array);for(let n=0;n<o.length/3;n++){let s=new $4xklQ.Vector3(r[3*o[3*n]],r[3*o[3*n]+1],r[3*o[3*n]+2]),l=new $4xklQ.Vector3(r[3*o[3*n+1]],r[3*o[3*n+1]+1],r[3*o[3*n+1]+2]),h=new $4xklQ.Vector3(r[3*o[3*n+2]],r[3*o[3*n+2]+1],r[3*o[3*n+2]+2]);a[i].localToWorld(s),a[i].localToWorld(l),a[i].localToWorld(h);let c=new $4xklQ.Vector3;if(t.intersectTriangle(s,l,h,!1,c),!c.equals(new $4xklQ.Vector3)){if(1>$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camBase.position.distanceTo(c))return e=!1,!1;e=!0}}}else for(let i=0;i<r.length/9;i++){let o=new $4xklQ.Vector3(r[9*i],r[9*i+1],r[9*i+2]),a=new $4xklQ.Vector3(r[9*i+3],r[9*i+4],r[9*i+5]),n=new $4xklQ.Vector3(r[9*i+6],r[9*i+7],r[9*i+8]),s=new $4xklQ.Vector3;if(new $4xklQ.Vector3,t.intersectTriangle(o,a,n,!1,s),!s.equals(new $4xklQ.Vector3)){if(1>$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camBase.position.distanceTo(s))return e=!1,!1;e=!0}}}function i(e){e.children.length>0&&e.children.forEach(function(e){"Mesh"==e.type&&2==e.layers.mask&&a.push(e),"Group"==e.type&&i(e)})}e&&!$ba6ad40603587d6b$export$a33e02b86664bfb2.md&&($ba6ad40603587d6b$export$c7dab90f68cf5e8d.posX=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.posX+.02*r.x*$ba6ad40603587d6b$export$c7dab90f68cf5e8d.walkingSpeed,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.posZ=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.posZ+.02*r.z*$ba6ad40603587d6b$export$c7dab90f68cf5e8d.walkingSpeed)}return!!($ba6ad40603587d6b$export$a33e02b86664bfb2.inTouch||Math.abs($ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xsmooth-$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xcount)>.001||Math.abs($ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ysmooth-$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ycount)>.001||Math.abs($ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zsmooth-$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zcount)>.001)}},$9HO6e=parcelRequire("9HO6e"),$9QhXH=parcelRequire("9QhXH"),$4xklQ=parcelRequire("4xklQ"),$9HO6e=parcelRequire("9HO6e");class $c338f49977b1ce90$export$4eacab61b79af859{constructor(e){this.editor=e}main(){if(""==this.editor.mouseCoverObj)return;this.editor.doorHelperGroupClean(),this.editor.switchHelperGroup("hidden");let e=this.editor.currentPoint.clone();if(0==e.x&&0==e.y&&0==e.z)return;let t="";if(this.editor.camera.isOrthographicCamera){"model2dBox"==this.editor.mouseCoverObj.name&&(this.editor.mouseCoverObj.parent&&this.editor.mouseCoverObj.parent.remove(this.editor.mouseCoverObj),this.editor.model2D.children.slice(0).forEach(e=>{e.uuid==this.editor.mouseCoverObj.modelUUID&&(this.editor.mouseCoverObj=e)}));let i="";this.editor.floorGroup2d.children.forEach(t=>{if("floor"==t.useType){let r=[];t.allPoints.forEach(e=>{r.push(e.x,e.y)}),this.editor.PolyK.ContainsPoint(r,e.x,e.y)&&(i=t.roomCenter)}}),this.editor.allWalls.forEach(t=>{let r=(0,$9HO6e.UtilCore).smallDistanceByPointOnLine((0,$9HO6e.UtilCore).handleLineData(t.startPoint,t.endPoint),e);if(!(0,$9HO6e.UtilCore).pointIsInLine(r,t.startPoint,t.endPoint))return;let o=r.clone().distanceTo((0,$9HO6e.UtilCore).toVector3(e)),a=Math.min(this.editor.mouseCoverObj.width,this.editor.mouseCoverObj.height),n=t.thickness/2+a/2;if(o<=n){let o=t.endPoint.clone().sub(t.startPoint.clone()).angle();i&&(0,$9HO6e.UtilCore).getClockWise(t.startPoint,t.endPoint,new $4xklQ.Vector2(i[0],i[1]))>0&&(o+=Math.PI),this.editor.mouseCoverObj.rotation.z=o,this.editor.mouseCoverObj.coverWallId=t.wallID,e=r.clone().add((0,$9HO6e.UtilCore).toVector2(e).sub(r.clone()).setLength(n));let a=r.distanceTo(t.startPoint),s=r.distanceTo(t.endPoint);if(a<this.editor.mouseCoverObj.width/2+t.thickness/2){let i=this.editor.mouseCoverObj.width/2-a+t.thickness/2,r=t.endPoint.clone().sub(t.startPoint).setLength(i);r=new $4xklQ.Vector3(r.x,r.y,e.z),e.add(r)}if(s<this.editor.mouseCoverObj.width/2+t.thickness/2){let i=this.editor.mouseCoverObj.width/2-s+t.thickness/2,r=t.startPoint.clone().sub(t.endPoint).setLength(i);r=new $4xklQ.Vector3(r.x,r.y,e.z),e.add(r)}}}),this.editor.mouseCoverObj.position.set(e.x,e.y,0),this.editor.cleanModelHelper(),this.editor.addPositionHelper(this.editor.mouseCoverObj),t=this.editor.get3DModelBy2DModel(this.editor.mouseCoverObj),e=new $4xklQ.Vector3(e.x/1e3,0,-e.y/1e3)}else{if("model3dBox"==this.editor.mouseCoverObj.name&&(this.editor.mouseCoverObj.parent&&this.editor.mouseCoverObj.parent.remove(this.editor.mouseCoverObj),this.editor.model3D.children.slice(0).forEach(e=>{e.uuid==this.editor.mouseCoverObj.modelUUID&&(this.editor.mouseCoverObj=e)})),"top"==(t=this.editor.mouseCoverObj).modelPosition);else{let t="";this.editor.floorGroup.children.forEach(i=>{if("Floor3D"==i.type){let r=[];i.allPoints.forEach(e=>{r.push(e.x,e.y)}),this.editor.PolyK.ContainsPoint(r,1e3*e.x,-(1e3*e.z))&&(t=i.roomCenter)}}),this.editor.wallGroup3D.children.forEach(i=>{if(!i.startPoint)return;let r=(0,$9HO6e.UtilCore).get3dWallDistance(e,i);if(0==r.length)return;let o=r[0],a=i.thickness/2+this.editor.mouseCoverObj.depth/2;if(o<=a){let o=i.endPoint.clone().sub(i.startPoint.clone()).angle();t&&(0,$9HO6e.UtilCore).getClockWise(i.startPoint,i.endPoint,new $4xklQ.Vector2(t[0]/1e3,t[1]/1e3))>0&&(o+=Math.PI),this.editor.mouseCoverObj.rotation.y=o,this.editor.mouseCoverObj.coverWallId=i.wallID;let n=r[1];e=n.clone().add(e.clone().sub(n.clone()).setLength(a));let s=new $4xklQ.Vector2(n.x,-n.z),l=s.distanceTo(i.startPoint),h=s.distanceTo(i.endPoint);if(l<this.editor.mouseCoverObj.width/2+i.thickness/2){let t=this.editor.mouseCoverObj.width/2-l+i.thickness/2,r=i.endPoint.clone().sub(i.startPoint).setLength(t);r=new $4xklQ.Vector3(r.x,e.y,-r.y),e.add(r)}if(h<this.editor.mouseCoverObj.width/2+i.thickness/2){let t=this.editor.mouseCoverObj.width/2-h+i.thickness/2,r=i.startPoint.clone().sub(i.endPoint).setLength(t);r=new $4xklQ.Vector3(r.x,e.y,-r.y),e.add(r)}}})}e.y=this.editor.currentPoint.y;let i=this.editor.get2DModelBy3DModel(this.editor.mouseCoverObj);""!=i&&i.position.set(1e3*e.x,-(1e3*e.z),0)}if(""==t||!t.parent)return;let i=this.editor.getRealSize(t);"top"==t.modelPosition?(t.position.set(e.x,this.editor.wallGroup3D.roomHeight/1e3-i[1]/2,e.z),t.floorHei=this.editor.wallGroup3D.roomHeight/1e3-i[1]):"bottom"==t.modelPosition?(t.position.set(e.x,i[1]/2,e.z),t.floorHei=0):(t.position.set(e.x,e.y+i[1]/2,e.z),t.floorHei=e.y);let r=t.position.clone();if(t.parent.worldToLocal(r),t.position.copy(r),this.editor.clickDepthMsg.uuid&&this.editor.checkModelIsInGroupModel(this.editor.mouseCoverObj)){var o=e.clone();let t=this.editor.mouseCoverObj;t.parent.uuid!=this.editor.clickDepthMsg.uuid&&("3dModel"==t.parent.name||"2dModel"==t.parent.name)&&(this.editor.clickDepthMsg.model.add(t),this.editor.clickDepthMsg.model.param[0].add(t.param[0])),this.editor.camera.isOrthographicCamera&&(o=this.editor.mouseCoverObj.position.clone(),t.parent.worldToLocal(o),t.position.x=o.x,t.position.y=o.y);let i=this.editor.getOuterParent(t,t,"outer");this.editor.refreshRealSizeByBox(i,t),this.editor.updateModelPosition(t.parent,i),this.editor.modelDotGroup.children=[],this.editor.camera.isOrthographicCamera?(this.editor.addDashBoxFor2dGroup(i),this.editor.addDashBoxForGroup(i.param[0]),this.editor.cleanModelHelper()):(this.editor.addDashBoxForGroup(i),this.editor.addDashBoxFor2dGroup(i.param[0]))}this.editor.synchroModel(this.editor.mouseCoverObj)}execute(){let e=this.editor.model2D.children,t="model2dBox";this.editor.camera.isOrthographicCamera&&(e=this.editor.model3D.children,t="model3dBox");let i=e.slice(0);this.editor.mouseCoverObj.parent.param&&(e=this.editor.mouseCoverObj.parent.param[0].children);let r="";if(e.forEach(e=>{e.name==t&&(r=e)}),""!=r){let e="";i.forEach(t=>{t.uuid==r.modelUUID&&(e=t)}),e.position.copy(r.position),e.rotation.copy(r.rotation),r.parent.add(e),r.parent.remove(r),this.editor.mouseCoverObj.modelId=e.uuid,this.editor.mouseCoverObj.param=[e],e.param=[this.editor.mouseCoverObj]}if(this.editor.cleanWallHelper(),this.editor.doorHelperGroupClean(),this.editor.camera.isOrthographicCamera?this.editor.mouseCoverObj.isLock?this.editor.addPositionHelper(this.editor.mouseCoverObj,!0):this.editor.addLineHelperForMember(this.editor.mouseCoverObj):new $102b3df9ca2da060$export$aead3d23b4737909(this.editor).selectObj([this.editor.mouseCoverObj]),"casualModel"==this.editor.mouseCoverObj.modelType){this.editor.selectObjArr=[this.editor.mouseCoverObj];let e=this.editor.camera.isOrthographicCamera?"2d":"3d";this.editor.explodeGroup(e,!1)}this.editor.mouseCoverObj=""}undo(){}redo(){}}var $4xklQ=parcelRequire("4xklQ");const $887b34e694533b37$var$_raycaster=new $4xklQ.Raycaster,$887b34e694533b37$var$_tempVector=new $4xklQ.Vector3,$887b34e694533b37$var$_tempVector2=new $4xklQ.Vector3,$887b34e694533b37$var$_tempQuaternion=new $4xklQ.Quaternion,$887b34e694533b37$var$_unit={X:new $4xklQ.Vector3(1,0,0),Y:new $4xklQ.Vector3(0,1,0),Z:new $4xklQ.Vector3(0,0,1)},$887b34e694533b37$var$_changeEvent={type:"change"},$887b34e694533b37$var$_mouseDownEvent={type:"mouseDown"},$887b34e694533b37$var$_mouseUpEvent={type:"mouseUp",mode:null},$887b34e694533b37$var$_objectChangeEvent={type:"objectChange"};class $887b34e694533b37$export$198e80c116632110 extends $4xklQ.Object3D{constructor(e,t){super(),void 0===t&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";let i=new $887b34e694533b37$export$c2ae06a69fb9d31f;this._gizmo=i,this.add(i);let r=new $887b34e694533b37$export$c0ab73045548e2ca;this._plane=r,this.add(r);let o=this;function a(e,t){let a=t;Object.defineProperty(o,e,{get:function(){return void 0!==a?a:t},set:function(t){a!==t&&(a=t,r[e]=t,i[e]=t,o.dispatchEvent({type:e+"-changed",value:t}),o.dispatchEvent($887b34e694533b37$var$_changeEvent))}}),o[e]=t,r[e]=t,i[e]=t}a("camera",e),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0);let n=new $4xklQ.Vector3,s=new $4xklQ.Vector3,l=new $4xklQ.Quaternion,h=new $4xklQ.Quaternion,c=new $4xklQ.Vector3,d=new $4xklQ.Quaternion,p=new $4xklQ.Vector3,u=new $4xklQ.Vector3,m=new $4xklQ.Vector3,g=0,f=new $4xklQ.Vector3;a("worldPosition",n),a("worldPositionStart",s),a("worldQuaternion",l),a("worldQuaternionStart",h),a("cameraPosition",c),a("cameraQuaternion",d),a("pointStart",p),a("pointEnd",u),a("rotationAxis",m),a("rotationAngle",g),a("eye",f),this._offset=new $4xklQ.Vector3,this._startNorm=new $4xklQ.Vector3,this._endNorm=new $4xklQ.Vector3,this._cameraScale=new $4xklQ.Vector3,this._parentPosition=new $4xklQ.Vector3,this._parentQuaternion=new $4xklQ.Quaternion,this._parentQuaternionInv=new $4xklQ.Quaternion,this._parentScale=new $4xklQ.Vector3,this._worldScaleStart=new $4xklQ.Vector3,this._worldQuaternionInv=new $4xklQ.Quaternion,this._worldScale=new $4xklQ.Vector3,this._positionStart=new $4xklQ.Vector3,this._quaternionStart=new $4xklQ.Quaternion,this._scaleStart=new $4xklQ.Vector3,this._getPointer=$887b34e694533b37$var$getPointer.bind(this),this._onPointerDown=$887b34e694533b37$var$onPointerDown.bind(this),this._onPointerHover=$887b34e694533b37$var$onPointerHover.bind(this),this._onPointerMove=$887b34e694533b37$var$onPointerMove.bind(this),this._onPointerUp=$887b34e694533b37$var$onPointerUp.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye):this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(void 0===this.object||!0===this.dragging)return;$887b34e694533b37$var$_raycaster.setFromCamera(e,this.camera);let t=$887b34e694533b37$var$intersectObjectWithRay(this._gizmo.picker[this.mode],$887b34e694533b37$var$_raycaster);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){$887b34e694533b37$var$_raycaster.setFromCamera(e,this.camera);let t=$887b34e694533b37$var$intersectObjectWithRay(this._plane,$887b34e694533b37$var$_raycaster,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,$887b34e694533b37$var$_mouseDownEvent.mode=this.mode,this.dispatchEvent($887b34e694533b37$var$_mouseDownEvent)}}pointerMove(e){let t=this.axis,i=this.mode,r=this.object,o=this.space;if("scale"===i?o="local":("E"===t||"XYZE"===t||"XYZ"===t)&&(o="world"),void 0===r||null===t||!1===this.dragging||-1!==e.button)return;$887b34e694533b37$var$_raycaster.setFromCamera(e,this.camera);let a=$887b34e694533b37$var$intersectObjectWithRay(this._plane,$887b34e694533b37$var$_raycaster,!0);if(a){if(this.pointEnd.copy(a.point).sub(this.worldPositionStart),"translate"===i)this._offset.copy(this.pointEnd).sub(this.pointStart),"local"===o&&"XYZ"!==t&&this._offset.applyQuaternion(this._worldQuaternionInv),-1===t.indexOf("X")&&(this._offset.x=0),-1===t.indexOf("Y")&&(this._offset.y=0),-1===t.indexOf("Z")&&(this._offset.z=0),"local"===o&&"XYZ"!==t?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),r.position.copy(this._offset).add(this._positionStart),this.translationSnap&&("local"===o&&(r.position.applyQuaternion($887b34e694533b37$var$_tempQuaternion.copy(this._quaternionStart).invert()),-1!==t.search("X")&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.position.applyQuaternion(this._quaternionStart)),"world"===o&&(r.parent&&r.position.add($887b34e694533b37$var$_tempVector.setFromMatrixPosition(r.parent.matrixWorld)),-1!==t.search("X")&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.parent&&r.position.sub($887b34e694533b37$var$_tempVector.setFromMatrixPosition(r.parent.matrixWorld))));else if("scale"===i){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();0>this.pointEnd.dot(this.pointStart)&&(e*=-1),$887b34e694533b37$var$_tempVector2.set(e,e,e)}else $887b34e694533b37$var$_tempVector.copy(this.pointStart),$887b34e694533b37$var$_tempVector2.copy(this.pointEnd),$887b34e694533b37$var$_tempVector.applyQuaternion(this._worldQuaternionInv),$887b34e694533b37$var$_tempVector2.applyQuaternion(this._worldQuaternionInv),$887b34e694533b37$var$_tempVector2.divide($887b34e694533b37$var$_tempVector),-1===t.search("X")&&($887b34e694533b37$var$_tempVector2.x=1),-1===t.search("Y")&&($887b34e694533b37$var$_tempVector2.y=1),-1===t.search("Z")&&($887b34e694533b37$var$_tempVector2.z=1);r.scale.copy(this._scaleStart).multiply($887b34e694533b37$var$_tempVector2),this.scaleSnap&&(-1!==t.search("X")&&(r.scale.x=Math.round(r.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(r.scale.y=Math.round(r.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(r.scale.z=Math.round(r.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===i){this._offset.copy(this.pointEnd).sub(this.pointStart);let e=20/this.worldPosition.distanceTo($887b34e694533b37$var$_tempVector.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=0>this._endNorm.cross(this._startNorm).dot(this.eye)?1:-1):"XYZE"===t?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot($887b34e694533b37$var$_tempVector.copy(this.rotationAxis).cross(this.eye))*e):("X"===t||"Y"===t||"Z"===t)&&(this.rotationAxis.copy($887b34e694533b37$var$_unit[t]),$887b34e694533b37$var$_tempVector.copy($887b34e694533b37$var$_unit[t]),"local"===o&&$887b34e694533b37$var$_tempVector.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot($887b34e694533b37$var$_tempVector.cross(this.eye).normalize())*e),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===o&&"E"!==t&&"XYZE"!==t?(r.quaternion.copy(this._quaternionStart),r.quaternion.multiply($887b34e694533b37$var$_tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),r.quaternion.copy($887b34e694533b37$var$_tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),r.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent($887b34e694533b37$var$_changeEvent),this.dispatchEvent($887b34e694533b37$var$_objectChangeEvent)}}pointerUp(e){0===e.button&&(this.dragging&&null!==this.axis&&($887b34e694533b37$var$_mouseUpEvent.mode=this.mode,this.dispatchEvent($887b34e694533b37$var$_mouseUpEvent)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent($887b34e694533b37$var$_changeEvent),this.dispatchEvent($887b34e694533b37$var$_objectChangeEvent),this.pointStart.copy(this.pointEnd))}getRaycaster(){return $887b34e694533b37$var$_raycaster}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function $887b34e694533b37$var$getPointer(e){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:e.button};{let t=this.domElement.getBoundingClientRect();return{x:(e.clientX-t.left)/t.width*2-1,y:-(e.clientY-t.top)/t.height*2+1,button:e.button}}}function $887b34e694533b37$var$onPointerHover(e){if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(e))}}function $887b34e694533b37$var$onPointerDown(e){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(e)),this.pointerDown(this._getPointer(e)))}function $887b34e694533b37$var$onPointerMove(e){this.enabled&&this.pointerMove(this._getPointer(e))}function $887b34e694533b37$var$onPointerUp(e){this.enabled&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(e)))}function $887b34e694533b37$var$intersectObjectWithRay(e,t,i){let r=t.intersectObject(e,!0);for(let e=0;e<r.length;e++)if(r[e].object.visible||i)return r[e];return!1}const $887b34e694533b37$var$_tempEuler=new $4xklQ.Euler,$887b34e694533b37$var$_alignVector=new $4xklQ.Vector3(0,1,0),$887b34e694533b37$var$_zeroVector=new $4xklQ.Vector3(0,0,0),$887b34e694533b37$var$_lookAtMatrix=new $4xklQ.Matrix4,$887b34e694533b37$var$_tempQuaternion2=new $4xklQ.Quaternion,$887b34e694533b37$var$_identityQuaternion=new $4xklQ.Quaternion,$887b34e694533b37$var$_dirVector=new $4xklQ.Vector3,$887b34e694533b37$var$_tempMatrix=new $4xklQ.Matrix4,$887b34e694533b37$var$_unitX=new $4xklQ.Vector3(1,0,0),$887b34e694533b37$var$_unitY=new $4xklQ.Vector3(0,1,0),$887b34e694533b37$var$_unitZ=new $4xklQ.Vector3(0,0,1),$887b34e694533b37$var$_v1=new $4xklQ.Vector3,$887b34e694533b37$var$_v2=new $4xklQ.Vector3,$887b34e694533b37$var$_v3=new $4xklQ.Vector3;class $887b34e694533b37$export$c2ae06a69fb9d31f extends $4xklQ.Object3D{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";let e=new $4xklQ.MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new $4xklQ.LineBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=e.clone();i.opacity=.15;let r=t.clone();r.opacity=.5;let o=e.clone();o.color.setHex(16711680);let a=e.clone();a.color.setHex(65280);let n=e.clone();n.color.setHex(255);let s=e.clone();s.color.setHex(16711680),s.opacity=.5;let l=e.clone();l.color.setHex(65280),l.opacity=.5;let h=e.clone();h.color.setHex(255),h.opacity=.5;let c=e.clone();c.opacity=.25;let d=e.clone();d.color.setHex(16776960),d.opacity=.25;let p=e.clone();p.color.setHex(16776960);let u=e.clone();u.color.setHex(7895160);let m=new $4xklQ.CylinderGeometry(0,.04,.1,12);m.translate(0,.05,0);let g=new $4xklQ.BoxGeometry(.08,.08,.08);g.translate(0,.04,0);let f=new $4xklQ.BufferGeometry;f.setAttribute("position",new $4xklQ.Float32BufferAttribute([0,0,0,1,0,0],3));let w=new $4xklQ.CylinderGeometry(.0075,.0075,.5,3);function y(e,t){let i=new $4xklQ.TorusGeometry(e,.0075,3,64,t*Math.PI*2);return i.rotateY(Math.PI/2),i.rotateX(Math.PI/2),i}function b(){let e=new $4xklQ.BufferGeometry;return e.setAttribute("position",new $4xklQ.Float32BufferAttribute([0,0,0,1,1,1],3)),e}w.translate(0,.25,0);let x={X:[[new $4xklQ.Mesh(m,o),[.5,0,0],[0,0,-Math.PI/2]],[new $4xklQ.Mesh(m,o),[-.5,0,0],[0,0,Math.PI/2]],[new $4xklQ.Mesh(w,o),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new $4xklQ.Mesh(m,a),[0,.5,0]],[new $4xklQ.Mesh(m,a),[0,-.5,0],[Math.PI,0,0]],[new $4xklQ.Mesh(w,a)]],Z:[[new $4xklQ.Mesh(m,n),[0,0,.5],[Math.PI/2,0,0]],[new $4xklQ.Mesh(m,n),[0,0,-.5],[-Math.PI/2,0,0]],[new $4xklQ.Mesh(w,n),null,[Math.PI/2,0,0]]],XYZ:[[new $4xklQ.Mesh(new $4xklQ.OctahedronGeometry(.1,0),c.clone()),[0,0,0]]],XY:[[new $4xklQ.Mesh(new $4xklQ.BoxGeometry(.15,.15,.01),h.clone()),[.15,.15,0]]],YZ:[[new $4xklQ.Mesh(new $4xklQ.BoxGeometry(.15,.15,.01),s.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new $4xklQ.Mesh(new $4xklQ.BoxGeometry(.15,.15,.01),l.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},P={X:[[new $4xklQ.Mesh(new $4xklQ.CylinderGeometry(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new $4xklQ.Mesh(new $4xklQ.CylinderGeometry(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new $4xklQ.Mesh(new $4xklQ.CylinderGeometry(.2,0,.6,4),i),[0,.3,0]],[new $4xklQ.Mesh(new $4xklQ.CylinderGeometry(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new $4xklQ.Mesh(new $4xklQ.CylinderGeometry(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new $4xklQ.Mesh(new $4xklQ.CylinderGeometry(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new $4xklQ.Mesh(new $4xklQ.OctahedronGeometry(.2,0),i)]],XY:[[new $4xklQ.Mesh(new $4xklQ.BoxGeometry(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new $4xklQ.Mesh(new $4xklQ.BoxGeometry(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new $4xklQ.Mesh(new $4xklQ.BoxGeometry(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},v={START:[[new $4xklQ.Mesh(new $4xklQ.OctahedronGeometry(.01,2),r),null,null,null,"helper"]],END:[[new $4xklQ.Mesh(new $4xklQ.OctahedronGeometry(.01,2),r),null,null,null,"helper"]],DELTA:[[new $4xklQ.Line(b(),r),null,null,null,"helper"]],X:[[new $4xklQ.Line(f,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new $4xklQ.Line(f,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new $4xklQ.Line(f,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},M={XYZE:[[new $4xklQ.Mesh(y(.5,1),u),null,[0,Math.PI/2,0]]],X:[[new $4xklQ.Mesh(y(.5,.5),o)]],Y:[[new $4xklQ.Mesh(y(.5,.5),a),null,[0,0,-Math.PI/2]]],Z:[[new $4xklQ.Mesh(y(.5,.5),n),null,[0,Math.PI/2,0]]],E:[[new $4xklQ.Mesh(y(.75,1),d),null,[0,Math.PI/2,0]]]},C={AXIS:[[new $4xklQ.Line(f,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},D={XYZE:[[new $4xklQ.Mesh(new $4xklQ.SphereGeometry(.25,10,8),i)]],X:[[new $4xklQ.Mesh(new $4xklQ.TorusGeometry(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new $4xklQ.Mesh(new $4xklQ.TorusGeometry(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new $4xklQ.Mesh(new $4xklQ.TorusGeometry(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new $4xklQ.Mesh(new $4xklQ.TorusGeometry(.75,.1,2,24),i)]]},T={X:[[new $4xklQ.Mesh(g,o),[.5,0,0],[0,0,-Math.PI/2]],[new $4xklQ.Mesh(w,o),[0,0,0],[0,0,-Math.PI/2]],[new $4xklQ.Mesh(g,o),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new $4xklQ.Mesh(g,a),[0,.5,0]],[new $4xklQ.Mesh(w,a)],[new $4xklQ.Mesh(g,a),[0,-.5,0],[0,0,Math.PI]]],Z:[[new $4xklQ.Mesh(g,n),[0,0,.5],[Math.PI/2,0,0]],[new $4xklQ.Mesh(w,n),[0,0,0],[Math.PI/2,0,0]],[new $4xklQ.Mesh(g,n),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new $4xklQ.Mesh(new $4xklQ.BoxGeometry(.15,.15,.01),h),[.15,.15,0]]],YZ:[[new $4xklQ.Mesh(new $4xklQ.BoxGeometry(.15,.15,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new $4xklQ.Mesh(new $4xklQ.BoxGeometry(.15,.15,.01),l),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new $4xklQ.Mesh(new $4xklQ.BoxGeometry(.1,.1,.1),c.clone())]]},S={X:[[new $4xklQ.Mesh(new $4xklQ.CylinderGeometry(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new $4xklQ.Mesh(new $4xklQ.CylinderGeometry(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new $4xklQ.Mesh(new $4xklQ.CylinderGeometry(.2,0,.6,4),i),[0,.3,0]],[new $4xklQ.Mesh(new $4xklQ.CylinderGeometry(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new $4xklQ.Mesh(new $4xklQ.CylinderGeometry(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new $4xklQ.Mesh(new $4xklQ.CylinderGeometry(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new $4xklQ.Mesh(new $4xklQ.BoxGeometry(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new $4xklQ.Mesh(new $4xklQ.BoxGeometry(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new $4xklQ.Mesh(new $4xklQ.BoxGeometry(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new $4xklQ.Mesh(new $4xklQ.BoxGeometry(.2,.2,.2),i),[0,0,0]]]},k={X:[[new $4xklQ.Line(f,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new $4xklQ.Line(f,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new $4xklQ.Line(f,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function V(e){let t=new $4xklQ.Object3D;for(let i in e)for(let r=e[i].length;r--;){let o=e[i][r][0].clone(),a=e[i][r][1],n=e[i][r][2],s=e[i][r][3],l=e[i][r][4];o.name=i,o.tag=l,a&&o.position.set(a[0],a[1],a[2]),n&&o.rotation.set(n[0],n[1],n[2]),s&&o.scale.set(s[0],s[1],s[2]),o.updateMatrix();let h=o.geometry.clone();h.applyMatrix4(o.matrix),o.geometry=h,o.renderOrder=1/0,o.position.set(0,0,0),o.rotation.set(0,0,0),o.scale.set(1,1,1),t.add(o)}return t}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=V(x)),this.add(this.gizmo.rotate=V(M)),this.add(this.gizmo.scale=V(T)),this.add(this.picker.translate=V(P)),this.add(this.picker.rotate=V(D)),this.add(this.picker.scale=V(S)),this.add(this.helper.translate=V(v)),this.add(this.helper.rotate=V(C)),this.add(this.helper.scale=V(k)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){let t="scale"===this.mode?"local":this.space,i="local"===t?this.worldQuaternion:$887b34e694533b37$var$_identityQuaternion;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let r=[];r=(r=(r=r.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(let e=0;e<r.length;e++){let t;let o=r[e];if(o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition),t=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(t*this.size/4),"helper"===o.tag){o.visible=!1,"AXIS"===o.name?(o.position.copy(this.worldPositionStart),o.visible=!!this.axis,"X"===this.axis&&($887b34e694533b37$var$_tempQuaternion.setFromEuler($887b34e694533b37$var$_tempEuler.set(0,0,0)),o.quaternion.copy(i).multiply($887b34e694533b37$var$_tempQuaternion),Math.abs($887b34e694533b37$var$_alignVector.copy($887b34e694533b37$var$_unitX).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),"Y"===this.axis&&($887b34e694533b37$var$_tempQuaternion.setFromEuler($887b34e694533b37$var$_tempEuler.set(0,0,Math.PI/2)),o.quaternion.copy(i).multiply($887b34e694533b37$var$_tempQuaternion),Math.abs($887b34e694533b37$var$_alignVector.copy($887b34e694533b37$var$_unitY).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),"Z"===this.axis&&($887b34e694533b37$var$_tempQuaternion.setFromEuler($887b34e694533b37$var$_tempEuler.set(0,Math.PI/2,0)),o.quaternion.copy(i).multiply($887b34e694533b37$var$_tempQuaternion),Math.abs($887b34e694533b37$var$_alignVector.copy($887b34e694533b37$var$_unitZ).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),"XYZE"===this.axis&&($887b34e694533b37$var$_tempQuaternion.setFromEuler($887b34e694533b37$var$_tempEuler.set(0,Math.PI/2,0)),$887b34e694533b37$var$_alignVector.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix($887b34e694533b37$var$_lookAtMatrix.lookAt($887b34e694533b37$var$_zeroVector,$887b34e694533b37$var$_alignVector,$887b34e694533b37$var$_unitY)),o.quaternion.multiply($887b34e694533b37$var$_tempQuaternion),o.visible=this.dragging),"E"===this.axis&&(o.visible=!1)):"START"===o.name?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):"END"===o.name?(o.position.copy(this.worldPosition),o.visible=this.dragging):"DELTA"===o.name?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),$887b34e694533b37$var$_tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),$887b34e694533b37$var$_tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy($887b34e694533b37$var$_tempVector),o.visible=this.dragging):(o.quaternion.copy(i),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=-1!==this.axis.search(o.name)));continue}if(o.quaternion.copy(i),"translate"===this.mode||"scale"===this.mode){let e=.99,t=.2;"X"===o.name&&Math.abs($887b34e694533b37$var$_alignVector.copy($887b34e694533b37$var$_unitX).applyQuaternion(i).dot(this.eye))>e&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"Y"===o.name&&Math.abs($887b34e694533b37$var$_alignVector.copy($887b34e694533b37$var$_unitY).applyQuaternion(i).dot(this.eye))>e&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"Z"===o.name&&Math.abs($887b34e694533b37$var$_alignVector.copy($887b34e694533b37$var$_unitZ).applyQuaternion(i).dot(this.eye))>e&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"XY"===o.name&&Math.abs($887b34e694533b37$var$_alignVector.copy($887b34e694533b37$var$_unitZ).applyQuaternion(i).dot(this.eye))<t&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"YZ"===o.name&&Math.abs($887b34e694533b37$var$_alignVector.copy($887b34e694533b37$var$_unitX).applyQuaternion(i).dot(this.eye))<t&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"XZ"===o.name&&Math.abs($887b34e694533b37$var$_alignVector.copy($887b34e694533b37$var$_unitY).applyQuaternion(i).dot(this.eye))<t&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)}else"rotate"===this.mode&&($887b34e694533b37$var$_tempQuaternion2.copy(i),$887b34e694533b37$var$_alignVector.copy(this.eye).applyQuaternion($887b34e694533b37$var$_tempQuaternion.copy(i).invert()),-1!==o.name.search("E")&&o.quaternion.setFromRotationMatrix($887b34e694533b37$var$_lookAtMatrix.lookAt(this.eye,$887b34e694533b37$var$_zeroVector,$887b34e694533b37$var$_unitY)),"X"===o.name&&($887b34e694533b37$var$_tempQuaternion.setFromAxisAngle($887b34e694533b37$var$_unitX,Math.atan2(-$887b34e694533b37$var$_alignVector.y,$887b34e694533b37$var$_alignVector.z)),$887b34e694533b37$var$_tempQuaternion.multiplyQuaternions($887b34e694533b37$var$_tempQuaternion2,$887b34e694533b37$var$_tempQuaternion),o.quaternion.copy($887b34e694533b37$var$_tempQuaternion)),"Y"===o.name&&($887b34e694533b37$var$_tempQuaternion.setFromAxisAngle($887b34e694533b37$var$_unitY,Math.atan2($887b34e694533b37$var$_alignVector.x,$887b34e694533b37$var$_alignVector.z)),$887b34e694533b37$var$_tempQuaternion.multiplyQuaternions($887b34e694533b37$var$_tempQuaternion2,$887b34e694533b37$var$_tempQuaternion),o.quaternion.copy($887b34e694533b37$var$_tempQuaternion)),"Z"===o.name&&($887b34e694533b37$var$_tempQuaternion.setFromAxisAngle($887b34e694533b37$var$_unitZ,Math.atan2($887b34e694533b37$var$_alignVector.y,$887b34e694533b37$var$_alignVector.x)),$887b34e694533b37$var$_tempQuaternion.multiplyQuaternions($887b34e694533b37$var$_tempQuaternion2,$887b34e694533b37$var$_tempQuaternion),o.quaternion.copy($887b34e694533b37$var$_tempQuaternion)));o.visible=o.visible&&(-1===o.name.indexOf("X")||this.showX),o.visible=o.visible&&(-1===o.name.indexOf("Y")||this.showY),o.visible=o.visible&&(-1===o.name.indexOf("Z")||this.showZ),o.visible=o.visible&&(-1===o.name.indexOf("E")||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis?(o.material.color.setHex(16776960),o.material.opacity=1):this.axis.split("").some(function(e){return o.name===e})&&(o.material.color.setHex(16776960),o.material.opacity=1))}super.updateMatrixWorld(e)}}class $887b34e694533b37$export$c0ab73045548e2ca extends $4xklQ.Mesh{constructor(){super(new $4xklQ.PlaneGeometry(1e5,1e5,2,2),new $4xklQ.MeshBasicMaterial({visible:!1,wireframe:!0,side:$4xklQ.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(t="local"),$887b34e694533b37$var$_v1.copy($887b34e694533b37$var$_unitX).applyQuaternion("local"===t?this.worldQuaternion:$887b34e694533b37$var$_identityQuaternion),$887b34e694533b37$var$_v2.copy($887b34e694533b37$var$_unitY).applyQuaternion("local"===t?this.worldQuaternion:$887b34e694533b37$var$_identityQuaternion),$887b34e694533b37$var$_v3.copy($887b34e694533b37$var$_unitZ).applyQuaternion("local"===t?this.worldQuaternion:$887b34e694533b37$var$_identityQuaternion),$887b34e694533b37$var$_alignVector.copy($887b34e694533b37$var$_v2),this.mode){case"translate":case"scale":switch(this.axis){case"X":$887b34e694533b37$var$_alignVector.copy(this.eye).cross($887b34e694533b37$var$_v1),$887b34e694533b37$var$_dirVector.copy($887b34e694533b37$var$_v1).cross($887b34e694533b37$var$_alignVector);break;case"Y":$887b34e694533b37$var$_alignVector.copy(this.eye).cross($887b34e694533b37$var$_v2),$887b34e694533b37$var$_dirVector.copy($887b34e694533b37$var$_v2).cross($887b34e694533b37$var$_alignVector);break;case"Z":$887b34e694533b37$var$_alignVector.copy(this.eye).cross($887b34e694533b37$var$_v3),$887b34e694533b37$var$_dirVector.copy($887b34e694533b37$var$_v3).cross($887b34e694533b37$var$_alignVector);break;case"XY":$887b34e694533b37$var$_dirVector.copy($887b34e694533b37$var$_v3);break;case"YZ":$887b34e694533b37$var$_dirVector.copy($887b34e694533b37$var$_v1);break;case"XZ":$887b34e694533b37$var$_alignVector.copy($887b34e694533b37$var$_v3),$887b34e694533b37$var$_dirVector.copy($887b34e694533b37$var$_v2);break;case"XYZ":case"E":$887b34e694533b37$var$_dirVector.set(0,0,0)}break;default:$887b34e694533b37$var$_dirVector.set(0,0,0)}0===$887b34e694533b37$var$_dirVector.length()?this.quaternion.copy(this.cameraQuaternion):($887b34e694533b37$var$_tempMatrix.lookAt($887b34e694533b37$var$_tempVector.set(0,0,0),$887b34e694533b37$var$_dirVector,$887b34e694533b37$var$_alignVector),this.quaternion.setFromRotationMatrix($887b34e694533b37$var$_tempMatrix)),super.updateMatrixWorld(e)}}var $f31f472336ab70f0$var$Stats=function(){var e=0,t=document.createElement("div");function i(e){return t.appendChild(e.dom),e}function r(i){for(var r=0;r<t.children.length;r++)t.children[r].style.display=r===i?"block":"none";e=i}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",function(i){i.preventDefault(),r(++e%t.children.length)},!1);var o=(performance||Date).now(),a=o,n=0,s=i(new $f31f472336ab70f0$var$Stats.Panel("FPS","#0ff","#002")),l=i(new $f31f472336ab70f0$var$Stats.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=i(new $f31f472336ab70f0$var$Stats.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:t,addPanel:i,showPanel:r,begin:function(){o=(performance||Date).now()},end:function(){n++;var e=(performance||Date).now();if(l.update(e-o,200),e>=a+1e3&&(s.update(1e3*n/(e-a),100),a=e,n=0,h)){var t=performance.memory;h.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){o=this.end()},domElement:t,setMode:r}};$f31f472336ab70f0$var$Stats.Panel=function(e,t,i){var r=1/0,o=0,a=Math.round,n=a(window.devicePixelRatio||1),s=80*n,l=48*n,h=3*n,c=2*n,d=3*n,p=15*n,u=74*n,m=30*n,g=document.createElement("canvas");g.width=s,g.height=l,g.style.cssText="width:80px;height:48px";var f=g.getContext("2d");return f.font="bold "+9*n+"px Helvetica,Arial,sans-serif",f.textBaseline="top",f.fillStyle=i,f.fillRect(0,0,s,l),f.fillStyle=t,f.fillText(e,h,c),f.fillRect(d,p,u,m),f.fillStyle=i,f.globalAlpha=.9,f.fillRect(d,p,u,m),{dom:g,update:function(l,w){r=Math.min(r,l),o=Math.max(o,l),f.fillStyle=i,f.globalAlpha=1,f.fillRect(0,0,s,p),f.fillStyle=t,f.fillText(a(l)+" "+e+" ("+a(r)+"-"+a(o)+")",h,c),f.drawImage(g,d+n,p,u-n,m,d,p,u-n,m),f.fillRect(d+u-n,p,n,m),f.fillStyle=i,f.globalAlpha=.9,f.fillRect(d+u-n,p,n,a((1-l/w)*m))}}};var $f31f472336ab70f0$export$2e2bcd8739ae039=$f31f472336ab70f0$var$Stats,$4xklQ=parcelRequire("4xklQ");const $038a164d1bff2da5$var$_frustum=new $4xklQ.Frustum,$038a164d1bff2da5$var$_center=new $4xklQ.Vector3,$038a164d1bff2da5$var$_tmpPoint=new $4xklQ.Vector3,$038a164d1bff2da5$var$_vecNear=new $4xklQ.Vector3,$038a164d1bff2da5$var$_vecTopLeft=new $4xklQ.Vector3,$038a164d1bff2da5$var$_vecTopRight=new $4xklQ.Vector3,$038a164d1bff2da5$var$_vecDownRight=new $4xklQ.Vector3,$038a164d1bff2da5$var$_vecDownLeft=new $4xklQ.Vector3,$038a164d1bff2da5$var$_vecFarTopLeft=new $4xklQ.Vector3,$038a164d1bff2da5$var$_vecFarTopRight=new $4xklQ.Vector3,$038a164d1bff2da5$var$_vecFarDownRight=new $4xklQ.Vector3,$038a164d1bff2da5$var$_vecFarDownLeft=new $4xklQ.Vector3,$038a164d1bff2da5$var$_vectemp1=new $4xklQ.Vector3,$038a164d1bff2da5$var$_vectemp2=new $4xklQ.Vector3,$038a164d1bff2da5$var$_vectemp3=new $4xklQ.Vector3,$038a164d1bff2da5$var$_matrix=new $4xklQ.Matrix4,$038a164d1bff2da5$var$_quaternion=new $4xklQ.Quaternion,$038a164d1bff2da5$var$_scale=new $4xklQ.Vector3;class $038a164d1bff2da5$export$b053248d05663070{constructor(e,t,i=Number.MAX_VALUE){this.camera=e,this.scene=t,this.startPoint=new $4xklQ.Vector3,this.endPoint=new $4xklQ.Vector3,this.collection=[],this.instances={},this.deep=i}select(e,t){return this.startPoint=e||this.startPoint,this.endPoint=t||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum($038a164d1bff2da5$var$_frustum,this.scene),this.collection}updateFrustum(e,t){if(e=e||this.startPoint,t=t||this.endPoint,e.x===t.x&&(t.x+=Number.EPSILON),e.y===t.y&&(t.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera){$038a164d1bff2da5$var$_tmpPoint.copy(e),$038a164d1bff2da5$var$_tmpPoint.x=Math.min(e.x,t.x),$038a164d1bff2da5$var$_tmpPoint.y=Math.max(e.y,t.y),t.x=Math.max(e.x,t.x),t.y=Math.min(e.y,t.y),$038a164d1bff2da5$var$_vecNear.setFromMatrixPosition(this.camera.matrixWorld),$038a164d1bff2da5$var$_vecTopLeft.copy($038a164d1bff2da5$var$_tmpPoint),$038a164d1bff2da5$var$_vecTopRight.set(t.x,$038a164d1bff2da5$var$_tmpPoint.y,0),$038a164d1bff2da5$var$_vecDownRight.copy(t),$038a164d1bff2da5$var$_vecDownLeft.set($038a164d1bff2da5$var$_tmpPoint.x,t.y,0),$038a164d1bff2da5$var$_vecTopLeft.unproject(this.camera),$038a164d1bff2da5$var$_vecTopRight.unproject(this.camera),$038a164d1bff2da5$var$_vecDownRight.unproject(this.camera),$038a164d1bff2da5$var$_vecDownLeft.unproject(this.camera),$038a164d1bff2da5$var$_vectemp1.copy($038a164d1bff2da5$var$_vecTopLeft).sub($038a164d1bff2da5$var$_vecNear),$038a164d1bff2da5$var$_vectemp2.copy($038a164d1bff2da5$var$_vecTopRight).sub($038a164d1bff2da5$var$_vecNear),$038a164d1bff2da5$var$_vectemp3.copy($038a164d1bff2da5$var$_vecDownRight).sub($038a164d1bff2da5$var$_vecNear),$038a164d1bff2da5$var$_vectemp1.normalize(),$038a164d1bff2da5$var$_vectemp2.normalize(),$038a164d1bff2da5$var$_vectemp3.normalize(),$038a164d1bff2da5$var$_vectemp1.multiplyScalar(this.deep),$038a164d1bff2da5$var$_vectemp2.multiplyScalar(this.deep),$038a164d1bff2da5$var$_vectemp3.multiplyScalar(this.deep),$038a164d1bff2da5$var$_vectemp1.add($038a164d1bff2da5$var$_vecNear),$038a164d1bff2da5$var$_vectemp2.add($038a164d1bff2da5$var$_vecNear),$038a164d1bff2da5$var$_vectemp3.add($038a164d1bff2da5$var$_vecNear);let i=$038a164d1bff2da5$var$_frustum.planes;i[0].setFromCoplanarPoints($038a164d1bff2da5$var$_vecNear,$038a164d1bff2da5$var$_vecTopLeft,$038a164d1bff2da5$var$_vecTopRight),i[1].setFromCoplanarPoints($038a164d1bff2da5$var$_vecNear,$038a164d1bff2da5$var$_vecTopRight,$038a164d1bff2da5$var$_vecDownRight),i[2].setFromCoplanarPoints($038a164d1bff2da5$var$_vecDownRight,$038a164d1bff2da5$var$_vecDownLeft,$038a164d1bff2da5$var$_vecNear),i[3].setFromCoplanarPoints($038a164d1bff2da5$var$_vecDownLeft,$038a164d1bff2da5$var$_vecTopLeft,$038a164d1bff2da5$var$_vecNear),i[4].setFromCoplanarPoints($038a164d1bff2da5$var$_vecTopRight,$038a164d1bff2da5$var$_vecDownRight,$038a164d1bff2da5$var$_vecDownLeft),i[5].setFromCoplanarPoints($038a164d1bff2da5$var$_vectemp3,$038a164d1bff2da5$var$_vectemp2,$038a164d1bff2da5$var$_vectemp1),i[5].normal.multiplyScalar(-1)}else if(this.camera.isOrthographicCamera){let i=Math.min(e.x,t.x),r=Math.max(e.y,t.y),o=Math.max(e.x,t.x),a=Math.min(e.y,t.y);$038a164d1bff2da5$var$_vecTopLeft.set(i,r,-1),$038a164d1bff2da5$var$_vecTopRight.set(o,r,-1),$038a164d1bff2da5$var$_vecDownRight.set(o,a,-1),$038a164d1bff2da5$var$_vecDownLeft.set(i,a,-1),$038a164d1bff2da5$var$_vecFarTopLeft.set(i,r,1),$038a164d1bff2da5$var$_vecFarTopRight.set(o,r,1),$038a164d1bff2da5$var$_vecFarDownRight.set(o,a,1),$038a164d1bff2da5$var$_vecFarDownLeft.set(i,a,1),$038a164d1bff2da5$var$_vecTopLeft.unproject(this.camera),$038a164d1bff2da5$var$_vecTopRight.unproject(this.camera),$038a164d1bff2da5$var$_vecDownRight.unproject(this.camera),$038a164d1bff2da5$var$_vecDownLeft.unproject(this.camera),$038a164d1bff2da5$var$_vecFarTopLeft.unproject(this.camera),$038a164d1bff2da5$var$_vecFarTopRight.unproject(this.camera),$038a164d1bff2da5$var$_vecFarDownRight.unproject(this.camera),$038a164d1bff2da5$var$_vecFarDownLeft.unproject(this.camera);let n=$038a164d1bff2da5$var$_frustum.planes;n[0].setFromCoplanarPoints($038a164d1bff2da5$var$_vecTopLeft,$038a164d1bff2da5$var$_vecFarTopLeft,$038a164d1bff2da5$var$_vecFarTopRight),n[1].setFromCoplanarPoints($038a164d1bff2da5$var$_vecTopRight,$038a164d1bff2da5$var$_vecFarTopRight,$038a164d1bff2da5$var$_vecFarDownRight),n[2].setFromCoplanarPoints($038a164d1bff2da5$var$_vecFarDownRight,$038a164d1bff2da5$var$_vecFarDownLeft,$038a164d1bff2da5$var$_vecDownLeft),n[3].setFromCoplanarPoints($038a164d1bff2da5$var$_vecFarDownLeft,$038a164d1bff2da5$var$_vecFarTopLeft,$038a164d1bff2da5$var$_vecTopLeft),n[4].setFromCoplanarPoints($038a164d1bff2da5$var$_vecTopRight,$038a164d1bff2da5$var$_vecDownRight,$038a164d1bff2da5$var$_vecDownLeft),n[5].setFromCoplanarPoints($038a164d1bff2da5$var$_vecFarDownRight,$038a164d1bff2da5$var$_vecFarTopRight,$038a164d1bff2da5$var$_vecFarTopLeft),n[5].normal.multiplyScalar(-1)}else console.error("THREE.SelectionBox: Unsupported camera type.")}searchChildInFrustum(e,t){if(t.isMesh||t.isLine||t.isPoints){if(t.isInstancedMesh){this.instances[t.uuid]=[];for(let i=0;i<t.count;i++)t.getMatrixAt(i,$038a164d1bff2da5$var$_matrix),$038a164d1bff2da5$var$_matrix.decompose($038a164d1bff2da5$var$_center,$038a164d1bff2da5$var$_quaternion,$038a164d1bff2da5$var$_scale),$038a164d1bff2da5$var$_center.applyMatrix4(t.matrixWorld),e.containsPoint($038a164d1bff2da5$var$_center)&&this.instances[t.uuid].push(i)}else if(null===t.geometry.boundingSphere&&t.geometry.computeBoundingSphere(),$038a164d1bff2da5$var$_center.copy(t.geometry.boundingSphere.center),$038a164d1bff2da5$var$_center.applyMatrix4(t.matrixWorld),e.containsPoint($038a164d1bff2da5$var$_center)){let e="GridHelper"==t.type||"helperGroup"==t.parent.name||"auxiliaryFloor"==t.name;t.layers.mask!=this.camera.layers.mask||e||this.collection.push(t)}}if(t.children.length>0)for(let i=0;i<t.children.length;i++)t.children[i].layers.mask==this.camera.layers.mask&&this.searchChildInFrustum(e,t.children[i])}}var $4xklQ=parcelRequire("4xklQ");class $00b7d4114b4a9b05$export$8ce2ff721d2b9fe1{constructor(e,t,i){this.element=document.createElement("div"),this.element.classList.add(t),this.element.style.pointerEvents="none",this.renderer=e,this.startPoint=new $4xklQ.Vector2,this.pointTopLeft=new $4xklQ.Vector2,this.pointBottomRight=new $4xklQ.Vector2,this.isDown=!1,this.onPointerDown=(function(e){e.shiftKey&&(this.isDown=!0,this.onSelectStart(e))}).bind(this),this.onPointerMove=(function(e){this.onSelectMove(e)}).bind(this),this.onPointerUp=(function(e){this.isDown=!1,this.onSelectOver()}).bind(this),i.addEventListener("pointerdown",this.onPointerDown),i.addEventListener("pointermove",this.onPointerMove),i.addEventListener("pointerup",this.onPointerUp)}dispose(){dom.removeEventListener("pointerdown",this.onPointerDown),dom.removeEventListener("pointermove",this.onPointerMove),dom.removeEventListener("pointerup",this.onPointerUp)}onSelectStart(e){this.element.style.display="none",this.renderer.domElement.parentElement.appendChild(this.element),this.element.style.left=e.clientX+"px",this.element.style.top=e.clientY+"px",this.element.style.width="0px",this.element.style.height="0px",this.startPoint.x=e.clientX,this.startPoint.y=e.clientY}onSelectMove(e){this.element.style.display="block",this.pointBottomRight.x=Math.max(this.startPoint.x,e.clientX),this.pointBottomRight.y=Math.max(this.startPoint.y,e.clientY),this.pointTopLeft.x=Math.min(this.startPoint.x,e.clientX),this.pointTopLeft.y=Math.min(this.startPoint.y,e.clientY),this.element.style.left=this.pointTopLeft.x+"px",this.element.style.top=this.pointTopLeft.y+"px",this.element.style.width=this.pointBottomRight.x-this.pointTopLeft.x+"px",this.element.style.height=this.pointBottomRight.y-this.pointTopLeft.y+"px"}onSelectOver(){this.element.parentElement&&this.element.parentElement.removeChild(this.element)}}var $4xklQ=parcelRequire("4xklQ"),$hrM0U=parcelRequire("hrM0U"),$4xklQ=parcelRequire("4xklQ");class $22831dcc74231be4$export$959ae9097e74a233 extends $4xklQ.Loader{constructor(e){super(e),this.defaultDPI=90,this.defaultUnit="px"}load(e,t,i,r){let o=this,a=new $4xklQ.FileLoader(o.manager);a.setPath(o.path),a.setRequestHeader(o.requestHeader),a.setWithCredentials(o.withCredentials),a.load(e,function(i){try{t(o.parse(i))}catch(t){r?r(t):console.error(t),o.manager.itemError(e)}},i,r)}parse(e){let t=this;function i(e,t){if(1!==e.nodeType)return;let a=b(e),n=!1,m=null;switch(e.nodeName){case"svg":case"g":t=u(e,t);break;case"style":o(e);break;case"path":t=u(e,t),e.hasAttribute("d")&&(m=r(e));break;case"rect":t=u(e,t),m=s(e);break;case"polygon":t=u(e,t),m=l(e);break;case"polyline":t=u(e,t),m=h(e);break;case"circle":t=u(e,t),m=c(e);break;case"ellipse":t=u(e,t),m=d(e);break;case"line":t=u(e,t),m=p(e);break;case"defs":n=!0;break;case"use":t=u(e,t);let g=e.getAttributeNS("http://www.w3.org/1999/xlink","href")||"",f=g.substring(1),w=e.viewportElement.getElementById(f);w?i(w,t):console.warn("SVGLoader: 'use node' references non-existent node id: "+f)}m&&(void 0!==t.fill&&"none"!==t.fill&&m.color.setStyle(t.fill),P(m,R),D.push(m),m.userData={node:e,style:t});let y=e.childNodes;for(let e=0;e<y.length;e++){let r=y[e];n&&"style"!==r.nodeName&&"defs"!==r.nodeName||i(r,t)}a&&(S.pop(),S.length>0?R.copy(S[S.length-1]):R.identity())}function r(e){let t=new $4xklQ.ShapePath,i=new $4xklQ.Vector2,r=new $4xklQ.Vector2,o=new $4xklQ.Vector2,n=!0,s=!1,l=e.getAttribute("d"),h=l.match(/[a-df-z][^a-df-z]*/ig);for(let e=0,l=h.length;e<l;e++){let l;let c=h[e],d=c.charAt(0),p=c.slice(1).trim();switch(!0===n&&(s=!0,n=!1),d){case"M":l=g(p);for(let e=0,a=l.length;e<a;e+=2)i.x=l[e+0],i.y=l[e+1],r.x=i.x,r.y=i.y,0===e?t.moveTo(i.x,i.y):t.lineTo(i.x,i.y),0===e&&o.copy(i);break;case"H":l=g(p);for(let e=0,a=l.length;e<a;e++)i.x=l[e],r.x=i.x,r.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===s&&o.copy(i);break;case"V":l=g(p);for(let e=0,a=l.length;e<a;e++)i.y=l[e],r.x=i.x,r.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===s&&o.copy(i);break;case"L":l=g(p);for(let e=0,a=l.length;e<a;e+=2)i.x=l[e+0],i.y=l[e+1],r.x=i.x,r.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===s&&o.copy(i);break;case"C":l=g(p);for(let e=0,a=l.length;e<a;e+=6)t.bezierCurveTo(l[e+0],l[e+1],l[e+2],l[e+3],l[e+4],l[e+5]),r.x=l[e+2],r.y=l[e+3],i.x=l[e+4],i.y=l[e+5],0===e&&!0===s&&o.copy(i);break;case"S":l=g(p);for(let e=0,a=l.length;e<a;e+=4)t.bezierCurveTo(m(i.x,r.x),m(i.y,r.y),l[e+0],l[e+1],l[e+2],l[e+3]),r.x=l[e+0],r.y=l[e+1],i.x=l[e+2],i.y=l[e+3],0===e&&!0===s&&o.copy(i);break;case"Q":l=g(p);for(let e=0,a=l.length;e<a;e+=4)t.quadraticCurveTo(l[e+0],l[e+1],l[e+2],l[e+3]),r.x=l[e+0],r.y=l[e+1],i.x=l[e+2],i.y=l[e+3],0===e&&!0===s&&o.copy(i);break;case"T":l=g(p);for(let e=0,a=l.length;e<a;e+=2){let a=m(i.x,r.x),n=m(i.y,r.y);t.quadraticCurveTo(a,n,l[e+0],l[e+1]),r.x=a,r.y=n,i.x=l[e+0],i.y=l[e+1],0===e&&!0===s&&o.copy(i)}break;case"A":l=g(p,[3,4],7);for(let e=0,n=l.length;e<n;e+=7){if(l[e+5]==i.x&&l[e+6]==i.y)continue;let n=i.clone();i.x=l[e+5],i.y=l[e+6],r.x=i.x,r.y=i.y,a(t,l[e],l[e+1],l[e+2],l[e+3],l[e+4],n,i),0===e&&!0===s&&o.copy(i)}break;case"m":l=g(p);for(let e=0,a=l.length;e<a;e+=2)i.x+=l[e+0],i.y+=l[e+1],r.x=i.x,r.y=i.y,0===e?t.moveTo(i.x,i.y):t.lineTo(i.x,i.y),0===e&&o.copy(i);break;case"h":l=g(p);for(let e=0,a=l.length;e<a;e++)i.x+=l[e],r.x=i.x,r.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===s&&o.copy(i);break;case"v":l=g(p);for(let e=0,a=l.length;e<a;e++)i.y+=l[e],r.x=i.x,r.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===s&&o.copy(i);break;case"l":l=g(p);for(let e=0,a=l.length;e<a;e+=2)i.x+=l[e+0],i.y+=l[e+1],r.x=i.x,r.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===s&&o.copy(i);break;case"c":l=g(p);for(let e=0,a=l.length;e<a;e+=6)t.bezierCurveTo(i.x+l[e+0],i.y+l[e+1],i.x+l[e+2],i.y+l[e+3],i.x+l[e+4],i.y+l[e+5]),r.x=i.x+l[e+2],r.y=i.y+l[e+3],i.x+=l[e+4],i.y+=l[e+5],0===e&&!0===s&&o.copy(i);break;case"s":l=g(p);for(let e=0,a=l.length;e<a;e+=4)t.bezierCurveTo(m(i.x,r.x),m(i.y,r.y),i.x+l[e+0],i.y+l[e+1],i.x+l[e+2],i.y+l[e+3]),r.x=i.x+l[e+0],r.y=i.y+l[e+1],i.x+=l[e+2],i.y+=l[e+3],0===e&&!0===s&&o.copy(i);break;case"q":l=g(p);for(let e=0,a=l.length;e<a;e+=4)t.quadraticCurveTo(i.x+l[e+0],i.y+l[e+1],i.x+l[e+2],i.y+l[e+3]),r.x=i.x+l[e+0],r.y=i.y+l[e+1],i.x+=l[e+2],i.y+=l[e+3],0===e&&!0===s&&o.copy(i);break;case"t":l=g(p);for(let e=0,a=l.length;e<a;e+=2){let a=m(i.x,r.x),n=m(i.y,r.y);t.quadraticCurveTo(a,n,i.x+l[e+0],i.y+l[e+1]),r.x=a,r.y=n,i.x=i.x+l[e+0],i.y=i.y+l[e+1],0===e&&!0===s&&o.copy(i)}break;case"a":l=g(p,[3,4],7);for(let e=0,n=l.length;e<n;e+=7){if(0==l[e+5]&&0==l[e+6])continue;let n=i.clone();i.x+=l[e+5],i.y+=l[e+6],r.x=i.x,r.y=i.y,a(t,l[e],l[e+1],l[e+2],l[e+3],l[e+4],n,i),0===e&&!0===s&&o.copy(i)}break;case"Z":case"z":t.currentPath.autoClose=!0,t.currentPath.curves.length>0&&(i.copy(o),t.currentPath.currentPoint.copy(i),n=!0);break;default:console.warn(c)}s=!1}return t}function o(e){if(e.sheet&&e.sheet.cssRules&&e.sheet.cssRules.length)for(let t=0;t<e.sheet.cssRules.length;t++){let i=e.sheet.cssRules[t];if(1!==i.type)continue;let r=i.selectorText.split(/,/gm).filter(Boolean).map(e=>e.trim());for(let e=0;e<r.length;e++){let t=Object.fromEntries(Object.entries(i.style).filter(([,e])=>""!==e));T[r[e]]=Object.assign(T[r[e]]||{},t)}}}function a(e,t,i,r,o,a,s,l){if(0==t||0==i){e.lineTo(l.x,l.y);return}r=r*Math.PI/180,t=Math.abs(t),i=Math.abs(i);let h=(s.x-l.x)/2,c=(s.y-l.y)/2,d=Math.cos(r)*h+Math.sin(r)*c,p=-Math.sin(r)*h+Math.cos(r)*c,u=t*t,m=i*i,g=d*d,f=p*p,w=g/u+f/m;if(w>1){let e=Math.sqrt(w);t*=e,i*=e,u=t*t,m=i*i}let y=u*f+m*g,b=(u*m-y)/y,x=Math.sqrt(Math.max(0,b));o===a&&(x=-x);let P=x*t*p/i,v=-x*i*d/t,M=Math.cos(r)*P-Math.sin(r)*v+(s.x+l.x)/2,C=Math.sin(r)*P+Math.cos(r)*v+(s.y+l.y)/2,D=n(1,0,(d-P)/t,(p-v)/i),T=n((d-P)/t,(p-v)/i,(-d-P)/t,(-p-v)/i)%(2*Math.PI);e.currentPath.absellipse(M,C,t,i,D,D+T,0===a,r)}function n(e,t,i,r){let o=e*i+t*r,a=Math.sqrt(e*e+t*t)*Math.sqrt(i*i+r*r),n=Math.acos(Math.max(-1,Math.min(1,o/a)));return e*r-t*i<0&&(n=-n),n}function s(e){let t=y(e.getAttribute("x")||0),i=y(e.getAttribute("y")||0),r=y(e.getAttribute("rx")||e.getAttribute("ry")||0),o=y(e.getAttribute("ry")||e.getAttribute("rx")||0),a=y(e.getAttribute("width")),n=y(e.getAttribute("height")),s=.448084975506,l=new $4xklQ.ShapePath;return l.moveTo(t+r,i),l.lineTo(t+a-r,i),(0!==r||0!==o)&&l.bezierCurveTo(t+a-r*s,i,t+a,i+o*s,t+a,i+o),l.lineTo(t+a,i+n-o),(0!==r||0!==o)&&l.bezierCurveTo(t+a,i+n-o*s,t+a-r*s,i+n,t+a-r,i+n),l.lineTo(t+r,i+n),(0!==r||0!==o)&&l.bezierCurveTo(t+r*s,i+n,t,i+n-o*s,t,i+n-o),l.lineTo(t,i+o),(0!==r||0!==o)&&l.bezierCurveTo(t,i+o*s,t+r*s,i,t+r,i),l}function l(e){function t(e,t,i){let a=y(t),n=y(i);0===o?r.moveTo(a,n):r.lineTo(a,n),o++}let i=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,r=new $4xklQ.ShapePath,o=0;return e.getAttribute("points").replace(i,t),r.currentPath.autoClose=!0,r}function h(e){function t(e,t,i){let a=y(t),n=y(i);0===o?r.moveTo(a,n):r.lineTo(a,n),o++}let i=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,r=new $4xklQ.ShapePath,o=0;return e.getAttribute("points").replace(i,t),r.currentPath.autoClose=!1,r}function c(e){let t=y(e.getAttribute("cx")||0),i=y(e.getAttribute("cy")||0),r=y(e.getAttribute("r")||0),o=new $4xklQ.Path;o.absarc(t,i,r,0,2*Math.PI);let a=new $4xklQ.ShapePath;return a.subPaths.push(o),a}function d(e){let t=y(e.getAttribute("cx")||0),i=y(e.getAttribute("cy")||0),r=y(e.getAttribute("rx")||0),o=y(e.getAttribute("ry")||0),a=new $4xklQ.Path;a.absellipse(t,i,r,o,0,2*Math.PI);let n=new $4xklQ.ShapePath;return n.subPaths.push(a),n}function p(e){let t=y(e.getAttribute("x1")||0),i=y(e.getAttribute("y1")||0),r=y(e.getAttribute("x2")||0),o=y(e.getAttribute("y2")||0),a=new $4xklQ.ShapePath;return a.moveTo(t,i),a.lineTo(r,o),a.currentPath.autoClose=!1,a}function u(e,t){t=Object.assign({},t);let i={};if(e.hasAttribute("class")){let t=e.getAttribute("class").split(/\s/).filter(Boolean).map(e=>e.trim());for(let e=0;e<t.length;e++)i=Object.assign(i,T["."+t[e]])}function r(r,o,a){void 0===a&&(a=function(e){return e.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),e}),e.hasAttribute(r)&&(t[o]=a(e.getAttribute(r))),i[r]&&(t[o]=a(i[r])),e.style&&""!==e.style[r]&&(t[o]=a(e.style[r]))}function o(e){return Math.max(0,Math.min(1,y(e)))}function a(e){return Math.max(0,y(e))}return e.hasAttribute("id")&&(i=Object.assign(i,T["#"+e.getAttribute("id")])),r("fill","fill"),r("fill-opacity","fillOpacity",o),r("fill-rule","fillRule"),r("opacity","opacity",o),r("stroke","stroke"),r("stroke-opacity","strokeOpacity",o),r("stroke-width","strokeWidth",a),r("stroke-linejoin","strokeLineJoin"),r("stroke-linecap","strokeLineCap"),r("stroke-miterlimit","strokeMiterLimit",a),r("visibility","visibility"),t}function m(e,t){return e-(t-e)}function g(e,t,i){let r;if("string"!=typeof e)throw TypeError("Invalid input: "+typeof e);let o={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},a=0,n=1,s=2,l=3,h=a,c=!0,d="",p="",u=[];function m(e,t,i){let r=SyntaxError('Unexpected character "'+e+'" at index '+t+".");throw r.partial=i,r}function g(){""!==d&&(""===p?u.push(Number(d)):u.push(Number(d)*Math.pow(10,Number(p)))),d="",p=""}let f=e.length;for(let w=0;w<f;w++){if(r=e[w],Array.isArray(t)&&t.includes(u.length%i)&&o.FLAGS.test(r)){h=n,d=r,g();continue}if(h===a){if(o.WHITESPACE.test(r))continue;if(o.DIGIT.test(r)||o.SIGN.test(r)){h=n,d=r;continue}if(o.POINT.test(r)){h=s,d=r;continue}o.COMMA.test(r)&&(c&&m(r,w,u),c=!0)}if(h===n){if(o.DIGIT.test(r)){d+=r;continue}if(o.POINT.test(r)){d+=r,h=s;continue}if(o.EXP.test(r)){h=l;continue}o.SIGN.test(r)&&1===d.length&&o.SIGN.test(d[0])&&m(r,w,u)}if(h===s){if(o.DIGIT.test(r)){d+=r;continue}if(o.EXP.test(r)){h=l;continue}o.POINT.test(r)&&"."===d[d.length-1]&&m(r,w,u)}if(h===l){if(o.DIGIT.test(r)){p+=r;continue}if(o.SIGN.test(r)){if(""===p){p+=r;continue}1===p.length&&o.SIGN.test(p)&&m(r,w,u)}}o.WHITESPACE.test(r)?(g(),h=a,c=!1):o.COMMA.test(r)?(g(),h=a,c=!0):o.SIGN.test(r)?(g(),h=n,d=r):o.POINT.test(r)?(g(),h=s,d=r):m(r,w,u)}return g(),u}let f=["mm","cm","in","pt","pc","px"],w={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function y(e){let i,r="px";if("string"==typeof e||e instanceof String)for(let t=0,i=f.length;t<i;t++){let i=f[t];if(e.endsWith(i)){r=i,e=e.substring(0,e.length-i.length);break}}return"px"===r&&"px"!==t.defaultUnit?i=w.in[t.defaultUnit]/t.defaultDPI:(i=w[r][t.defaultUnit])<0&&(i=w[r].in*t.defaultDPI),i*parseFloat(e)}function b(e){if(!(e.hasAttribute("transform")||"use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))))return null;let t=x(e);return S.length>0&&t.premultiply(S[S.length-1]),R.copy(t),S.push(t),t}function x(e){let t=new $4xklQ.Matrix3,i=k;if("use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))){let i=y(e.getAttribute("x")),r=y(e.getAttribute("y"));t.translate(i,r)}if(e.hasAttribute("transform")){let r=e.getAttribute("transform").split(")");for(let e=r.length-1;e>=0;e--){let o=r[e].trim();if(""===o)continue;let a=o.indexOf("("),n=o.length;if(a>0&&a<n){let e=o.slice(0,a),t=g(o.slice(a+1));switch(i.identity(),e){case"translate":if(t.length>=1){let e=t[0],r=0;t.length>=2&&(r=t[1]),i.translate(e,r)}break;case"rotate":if(t.length>=1){let e=0,r=0,o=0;e=-t[0]*Math.PI/180,t.length>=3&&(r=t[1],o=t[2]),V.identity().translate(-r,-o),A.identity().rotate(e),L.multiplyMatrices(A,V),V.identity().translate(r,o),i.multiplyMatrices(V,L)}break;case"scale":if(t.length>=1){let e=t[0],r=e;t.length>=2&&(r=t[1]),i.scale(e,r)}break;case"skewX":1===t.length&&i.set(1,Math.tan(t[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===t.length&&i.set(1,0,0,Math.tan(t[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===t.length&&i.set(t[0],t[2],t[4],t[1],t[3],t[5],0,0,1)}}t.premultiply(i)}}return t}function P(e,t){function i(e){I.set(e.x,e.y,1).applyMatrix3(t),e.set(I.x,I.y)}let r=v(t),o=e.subPaths;for(let e=0,a=o.length;e<a;e++){let a=o[e],n=a.curves;for(let e=0;e<n.length;e++){let o=n[e];o.isLineCurve?(i(o.v1),i(o.v2)):o.isCubicBezierCurve?(i(o.v0),i(o.v1),i(o.v2),i(o.v3)):o.isQuadraticBezierCurve?(i(o.v0),i(o.v1),i(o.v2)):o.isEllipseCurve&&(r&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),W.set(o.aX,o.aY),i(W),o.aX=W.x,o.aY=W.y,o.xRadius*=M(t),o.yRadius*=C(t))}}}function v(e){return 0!==e.elements[1]||0!==e.elements[3]}function M(e){let t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function C(e){let t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}let D=[],T={},S=[],k=new $4xklQ.Matrix3,V=new $4xklQ.Matrix3,A=new $4xklQ.Matrix3,L=new $4xklQ.Matrix3,W=new $4xklQ.Vector2,I=new $4xklQ.Vector3,R=new $4xklQ.Matrix3,B=new DOMParser().parseFromString(e,"image/svg+xml");i(B.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4});let E={paths:D,xml:B.documentElement};return E}static createShapes(e){let t=999999999,i={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},r={loc:i.ORIGIN,t:0};function o(e,t,o,n){let s=e.x,l=t.x,h=o.x,c=n.x,d=e.y,p=t.y,u=o.y,m=n.y,g=(c-h)*(d-u)-(m-u)*(s-h),f=(l-s)*(d-u)-(p-d)*(s-h),w=(m-u)*(l-s)-(c-h)*(p-d),y=g/w,b=f/w;if(0===w&&0!==g||y<=0||y>=1||b<0||b>1)return null;if(0===g&&0===w){for(let h=0;h<2;h++){if(a(0===h?o:n,e,t),r.loc==i.ORIGIN){let e=0===h?o:n;return{x:e.x,y:e.y,t:r.t}}if(r.loc==i.BETWEEN){let e=+(s+r.t*(l-s)).toPrecision(10),t=+(d+r.t*(p-d)).toPrecision(10);return{x:e,y:t,t:r.t}}}return null}{for(let s=0;s<2;s++)if(a(0===s?o:n,e,t),r.loc==i.ORIGIN){let e=0===s?o:n;return{x:e.x,y:e.y,t:r.t}}let h=+(s+y*(l-s)).toPrecision(10),c=+(d+y*(p-d)).toPrecision(10);return{x:h,y:c,t:y}}}function a(e,t,o){let a;let n=o.x-t.x,s=o.y-t.y,l=e.x-t.x,h=e.y-t.y,c=n*h-l*s;if(e.x===t.x&&e.y===t.y){r.loc=i.ORIGIN,r.t=0;return}if(e.x===o.x&&e.y===o.y){r.loc=i.DESTINATION,r.t=1;return}if(c<-Number.EPSILON){r.loc=i.LEFT;return}if(c>Number.EPSILON){r.loc=i.RIGHT;return}if(n*l<0||s*h<0){r.loc=i.BEHIND;return}if(Math.sqrt(n*n+s*s)<Math.sqrt(l*l+h*h)){r.loc=i.BEYOND;return}a=0!==n?l/n:h/s,r.loc=i.BETWEEN,r.t=a}function n(e,t){let i=[],r=[];for(let a=1;a<e.length;a++){let n=e[a-1],s=e[a];for(let e=1;e<t.length;e++){let a=t[e-1],l=t[e],h=o(n,s,a,l);null!==h&&void 0===i.find(e=>e.t<=h.t+Number.EPSILON&&e.t>=h.t-Number.EPSILON)&&(i.push(h),r.push(new $4xklQ.Vector2(h.x,h.y)))}}return r}function s(e,t,i){let r=new $4xklQ.Vector2;t.getCenter(r);let o=[];return i.forEach(t=>{if(t.boundingBox.containsPoint(r)){let i=n(e,t.points);i.forEach(e=>{o.push({identifier:t.identifier,isCW:t.isCW,point:e})})}}),o.sort((e,t)=>e.point.x-t.point.x),o}function l(e,t,i,r,o){(null==o||""===o)&&(o="nonzero");let a=new $4xklQ.Vector2;e.boundingBox.getCenter(a);let n=[new $4xklQ.Vector2(i,a.y),new $4xklQ.Vector2(r,a.y)],l=s(n,e.boundingBox,t);l.sort((e,t)=>e.point.x-t.point.x);let h=[],c=[];l.forEach(t=>{t.identifier===e.identifier?h.push(t):c.push(t)});let d=h[0].point.x,p=[],u=0;for(;u<c.length&&c[u].point.x<d;)p.length>0&&p[p.length-1]===c[u].identifier?p.pop():p.push(c[u].identifier),u++;if(p.push(e.identifier),"evenodd"===o){let t=p.length%2==0,i=p[p.length-2];return{identifier:e.identifier,isHole:t,for:i}}if("nonzero"===o){let i=!0,r=null,o=null;for(let e=0;e<p.length;e++){let a=p[e];i?(o=t[a].isCW,i=!1,r=a):o!==t[a].isCW&&(o=t[a].isCW,i=!0)}return{identifier:e.identifier,isHole:i,for:r}}console.warn('fill-rule: "'+o+'" is currently not implemented.')}let h=0,c=t,d=-t,p=e.subPaths.map(e=>{let i=e.getPoints(),r=-t,o=t,a=-t,n=t;for(let e=0;e<i.length;e++){let t=i[e];t.y>r&&(r=t.y),t.y<o&&(o=t.y),t.x>a&&(a=t.x),t.x<n&&(n=t.x)}return d<=a&&(d=a+1),c>=n&&(c=n-1),{curves:e.curves,points:i,isCW:(0,$4xklQ.ShapeUtils).isClockWise(i),identifier:h++,boundingBox:new $4xklQ.Box2(new $4xklQ.Vector2(n,o),new $4xklQ.Vector2(a,r))}});p=p.filter(e=>e.points.length>1);let u=p.map(t=>l(t,p,c,d,e.userData?.style.fillRule)),m=[];return p.forEach(e=>{let t=u[e.identifier];if(!t.isHole){let t=new $4xklQ.Shape;t.curves=e.curves;let i=u.filter(t=>t.isHole&&t.for===e.identifier);i.forEach(e=>{let i=p[e.identifier],r=new $4xklQ.Path;r.curves=i.curves,t.holes.push(r)}),m.push(t)}}),m}static getStrokeStyle(e,t,i,r,o){return{strokeColor:t=void 0!==t?t:"#000",strokeWidth:e=void 0!==e?e:1,strokeLineJoin:i=void 0!==i?i:"miter",strokeLineCap:r=void 0!==r?r:"butt",strokeMiterLimit:o=void 0!==o?o:4}}static pointsToStroke(e,t,i,r){let o=[],a=[],n=[];if(0===$22831dcc74231be4$export$959ae9097e74a233.pointsToStrokeWithBuffers(e,t,i,r,o,a,n))return null;let s=new $4xklQ.BufferGeometry;return s.setAttribute("position",new $4xklQ.Float32BufferAttribute(o,3)),s.setAttribute("normal",new $4xklQ.Float32BufferAttribute(a,3)),s.setAttribute("uv",new $4xklQ.Float32BufferAttribute(n,2)),s}static pointsToStrokeWithBuffers(e,t,i,r,o,a,n,s){let l,h,c,d,p;let u=new $4xklQ.Vector2,m=new $4xklQ.Vector2,g=new $4xklQ.Vector2,f=new $4xklQ.Vector2,w=new $4xklQ.Vector2,y=new $4xklQ.Vector2,b=new $4xklQ.Vector2,x=new $4xklQ.Vector2,P=new $4xklQ.Vector2,v=new $4xklQ.Vector2,M=new $4xklQ.Vector2,C=new $4xklQ.Vector2,D=new $4xklQ.Vector2,T=new $4xklQ.Vector2,S=new $4xklQ.Vector2,k=new $4xklQ.Vector2,V=new $4xklQ.Vector2;i=void 0!==i?i:12,r=void 0!==r?r:.001,s=void 0!==s?s:0,e=X(e);let A=e.length;if(A<2)return 0;let L=e[0].equals(e[A-1]),W=e[0],I=t.strokeWidth/2,R=1/(A-1),B=0,E,O=!1,F=0,z=3*s,G=2*s;H(e[0],e[1],u).multiplyScalar(I),x.copy(e[0]).sub(u),P.copy(e[0]).add(u),v.copy(x),M.copy(P);for(let i=1;i<A;i++){l=e[i],h=i===A-1?L?e[1]:void 0:e[i+1];let r=u;if(H(W,l,r),g.copy(r).multiplyScalar(I),C.copy(l).sub(g),D.copy(l).add(g),E=B+R,c=!1,void 0!==h){H(l,h,m),g.copy(m).multiplyScalar(I),T.copy(l).sub(g),S.copy(l).add(g),d=!0,g.subVectors(h,W),0>r.dot(g)&&(d=!1),1===i&&(O=d),g.subVectors(h,l),g.normalize();let e=Math.abs(r.dot(g));if(e>Number.EPSILON){let i=I/e;g.multiplyScalar(-i),f.subVectors(l,W),w.copy(f).setLength(i).add(g),k.copy(w).negate();let r=w.length(),o=f.length();f.divideScalar(o),y.subVectors(h,l);let a=y.length();switch(y.divideScalar(a),f.dot(k)<o&&y.dot(k)<a&&(c=!0),V.copy(w).add(l),k.add(l),p=!1,c?d?(S.copy(k),D.copy(k)):(T.copy(k),C.copy(k)):U(),t.strokeLineJoin){case"bevel":N(d,c,E);break;case"round":q(d,c),d?_(l,C,T,E,0):_(l,S,D,E,1);break;default:let n=I*t.strokeMiterLimit/r;n<1?"miter-clip"!==t.strokeLineJoin?N(d,c,E):(q(d,c),d?(y.subVectors(V,C).multiplyScalar(n).add(C),b.subVectors(V,T).multiplyScalar(n).add(T),j(C,E,0),j(y,E,0),j(l,E,.5),j(l,E,.5),j(y,E,0),j(b,E,0),j(l,E,.5),j(b,E,0),j(T,E,0)):(y.subVectors(V,D).multiplyScalar(n).add(D),b.subVectors(V,S).multiplyScalar(n).add(S),j(D,E,1),j(y,E,1),j(l,E,.5),j(l,E,.5),j(y,E,1),j(b,E,1),j(l,E,.5),j(b,E,1),j(S,E,1))):(c?(d?(j(P,B,1),j(x,B,0),j(V,E,0),j(P,B,1),j(V,E,0),j(k,E,1)):(j(P,B,1),j(x,B,0),j(V,E,1),j(x,B,0),j(k,E,0),j(V,E,1)),d?T.copy(V):S.copy(V)):d?(j(C,E,0),j(V,E,0),j(l,E,.5),j(l,E,.5),j(V,E,0),j(T,E,0)):(j(D,E,1),j(V,E,1),j(l,E,.5),j(l,E,.5),j(V,E,1),j(S,E,1)),p=!0)}}else U()}else U();L||i!==A-1||Y(e[0],v,M,d,!0,B),B=E,W=l,x.copy(T),P.copy(S)}if(L){if(c&&o){let e=V,t=k;O!==d&&(e=k,t=V),d?(p||O)&&(t.toArray(o,0),t.toArray(o,9),p&&e.toArray(o,3)):(p||!O)&&(t.toArray(o,3),t.toArray(o,9),p&&e.toArray(o,0))}}else Y(l,C,D,d,!1,E);return F;function H(e,t,i){return i.subVectors(t,e),i.set(-i.y,i.x).normalize()}function j(e,t,i){o&&(o[z]=e.x,o[z+1]=e.y,o[z+2]=0,a&&(a[z]=0,a[z+1]=0,a[z+2]=1),z+=3,n&&(n[G]=t,n[G+1]=i,G+=2)),F+=3}function _(e,t,r,o,a){u.copy(t).sub(e).normalize(),m.copy(r).sub(e).normalize();let n=Math.PI,s=u.dot(m);1>Math.abs(s)&&(n=Math.abs(Math.acos(s))),n/=i,g.copy(t);for(let t=0,r=i-1;t<r;t++)f.copy(g).rotateAround(e,n),j(g,o,a),j(f,o,a),j(e,o,.5),g.copy(f);j(f,o,a),j(r,o,a),j(e,o,.5)}function U(){j(P,B,1),j(x,B,0),j(C,E,0),j(P,B,1),j(C,E,1),j(D,E,0)}function N(e,t,i){t?e?(j(P,B,1),j(x,B,0),j(C,E,0),j(P,B,1),j(C,E,0),j(k,E,1),j(C,i,0),j(T,i,0),j(k,i,.5)):(j(P,B,1),j(x,B,0),j(D,E,1),j(x,B,0),j(k,E,0),j(D,E,1),j(D,i,1),j(S,i,0),j(k,i,.5)):e?(j(C,i,0),j(T,i,0),j(l,i,.5)):(j(D,i,1),j(S,i,0),j(l,i,.5))}function q(e,t){t&&(e?(j(P,B,1),j(x,B,0),j(C,E,0),j(P,B,1),j(C,E,0),j(k,E,1),j(C,B,0),j(l,E,.5),j(k,E,1),j(l,E,.5),j(T,B,0),j(k,E,1)):(j(P,B,1),j(x,B,0),j(D,E,1),j(x,B,0),j(k,E,0),j(D,E,1),j(D,B,1),j(k,E,0),j(l,E,.5),j(l,E,.5),j(k,E,0),j(S,B,1)))}function Y(e,i,r,a,n,s){switch(t.strokeLineCap){case"round":n?_(e,r,i,s,.5):_(e,i,r,s,.5);break;case"square":if(n)u.subVectors(i,e),m.set(u.y,-u.x),g.addVectors(u,m).add(e),f.subVectors(m,u).add(e),a?(g.toArray(o,3),f.toArray(o,0),f.toArray(o,9)):(g.toArray(o,3),g.toArray(o,9),f.toArray(o,0));else{u.subVectors(r,e),m.set(u.y,-u.x),g.addVectors(u,m).add(e),f.subVectors(m,u).add(e);let t=o.length;a?(g.toArray(o,t-3),f.toArray(o,t-6),f.toArray(o,t-12)):(g.toArray(o,t-6),f.toArray(o,t-3),f.toArray(o,t-12))}}}function X(e){let t=!1;for(let i=1,o=e.length-1;i<o;i++)if(e[i].distanceTo(e[i+1])<r){t=!0;break}if(!t)return e;let i=[];i.push(e[0]);for(let t=1,o=e.length-1;t<o;t++)e[t].distanceTo(e[t+1])>=r&&i.push(e[t]);return i.push(e[e.length-1]),i}}}class $b47acdbb1ebb3974$export$72fae0e7761deb0c{constructor(e){this.Tween=new $0a029741d8f7787c$export$208a41d6b4e37b97,this.Tween.onUpdate(e=>{console.log(e.x,e.y,e.z),this.camBase.position.set(e.x,e.y,e.z),this.editor.miniCamera.position.x=1e3*this.camBase.position.x,this.editor.miniCamera.position.y=-(1e3*this.camBase.position.z),this.tmpCone&&e.x==this.tmpCone.position.x&&e.z==this.tmpCone.position.z&&(this.editor.scene.remove(this.tmpCone),this.tmpCone.geometry.dispose(),this.tmpCone=null)}),this.rotate=!1,this.viewport=e,this.editor=e.editor,this.camera=this.editor.camera,this.cameraRotX=new $4xklQ.Object3D,this.cameraRotX.name="cameraRotX",this.cameraRotY=new $4xklQ.Object3D,this.cameraRotY.name="cameraRotY",this.camBase=new $4xklQ.Object3D,this.camBase.name="camBase",this.originPosition=this.camera.position.clone(),this.originPosition.y=1.7,this.camera.position.set(0,0,0),this.cameraRotX.add(this.camera),this.cameraRotY.add(this.cameraRotX),this.camBase.add(this.cameraRotY),this.setPosition(this.originPosition),this.camera.lookAt(new $4xklQ.Vector3(1,1.7,0)),this.camera.realPosition=this.camBase.position,this.camera.realRotation=[this.cameraRotY.rotation,this.cameraRotX.rotation],this.tmpVec=new $4xklQ.Vector3,this.moveSpeed=.02,this.keyPress={},this.ray=new $4xklQ.Ray,this.canMove=!1,this.rayCaster=new $4xklQ.Raycaster,this.handleListener(e.container),this.firstPosition=new $4xklQ.Vector2,this.XcountOffset=0,this.YcountOffset=0,this.countXBegin=0,this.countYBegin=0,this.countZBegin=0,this.Xcount=0,this.Ycount=0,this.Zcount=0,this.createMinMap(),this.activeFlag=!0}active(){this.activeFlag=!0,this.editor.miniCamera.visible=!0}deactive(){this.activeFlag=!1,this.editor.miniCamera.visible=!1}handleListener(e){if(this.mouseDownHandler=this.onCanvasMouseDown.bind(this),this.mouseUpHandler=this.onCanvasMouseUp.bind(this),this.mouseMoveHandler=this.onCanvasMouseMove.bind(this),this.mouseWheelHandler=this.OnMousewheel.bind(this),this.editor.roamTool){let t=this.editor.roamTool;e.removeEventListener("mousedown",t.mouseDownHandler),e.removeEventListener("mouseup",t.mouseUpHandler),e.removeEventListener("mousemove",t.mouseMoveHandler),e.removeEventListener("wheel",t.mouseWheelHandler)}e.addEventListener("mousedown",this.mouseDownHandler,!1),e.addEventListener("mouseup",this.mouseUpHandler,!1),e.addEventListener("mousemove",this.mouseMoveHandler,!1),e.addEventListener("wheel",this.mouseWheelHandler,!1),e.addEventListener("contextmenu",this.OnForbidden.bind(this),!0)}OnForbidden(e){e.preventDefault()}onCanvasMouseDown(e){e.preventDefault();let t=new $4xklQ.Vector2;t.x=e.clientX/window.innerWidth*2-1,t.y=-(2*(e.clientY/window.innerHeight))+1,this.getIntersect3(t),console.log("---------------------------------------------------------------------"),console.log(this.cameraRotX.rotation.x,this.cameraRotX.rotation.y,this.cameraRotX.rotation.z),console.log(this.cameraRotY.rotation.x,this.cameraRotY.rotation.y,this.cameraRotY.rotation.z),console.log(this.camera.rotation.x,this.camera.rotation.y,this.camera.rotation.z),console.log("---------------------------------------------------------------------"),this.camera&&(this.rotate=!0,this.countXBegin=this.cameraRotX.rotation.z,this.countYBegin=this.cameraRotY.rotation.y,this.XcountOffset=0,this.YcountOffset=0,this.firstPosition=new $4xklQ.Vector2(e.clientX,e.clientY),this.updateCamera())}createCone(){this.tmpCone&&(this.editor.scene.remove(this.tmpCone),this.tmpCone.geometry.dispose(),this.tmpCone=null,console.log("A tween stop"),this.Tween.stop());let e=new $4xklQ.ConeGeometry(.05,.15,32),t=new $4xklQ.Mesh(e,new $4xklQ.MeshBasicMaterial({color:16711680}));t.layers.mask=6,this.editor.scene.add(t),t.rotation.x=Math.PI,t.position.y=.075,this.tmpCone=t}onCanvasMouseUp(e){e.preventDefault(),this.rotate=!1,this.updateCamera()}onCanvasMouseMove(e){e.preventDefault(),this.rotate&&(this.XcountOffset=this.firstPosition.y-e.clientY,this.YcountOffset=this.firstPosition.x-e.clientX),this.updateCamera()}OnMousewheel(e){e.preventDefault();let t=this.getRadian(),i=Math.sin(t)*e.wheelDelta/1e3,r=Math.cos(t)*e.wheelDelta/1e3,o=new $4xklQ.Vector3(i,0,r);this.canMove=!0,this.getIntersect2(o),this.canMove&&(this.camBase.position.add(o),this.editor.miniCamera.position.x=1e3*this.camBase.position.x,this.editor.miniCamera.position.y=1e3*this.camBase.position.z)}getIntersect(e){let t=this.getRadian();e||=new(0,$4xklQ.Vector3)(Math.sin(t),0,Math.cos(t)).normalize(),this.ray.set(this.camBase.position,e);let i=1/0,r,o;return this.editor.wallGroup3D.children.forEach((e,t)=>{let a=new $4xklQ.Vector3,n=new $4xklQ.Vector3;this.ray.distanceSqToSegment(new $4xklQ.Vector3(e.startPoint.x,0,e.startPoint.y),new $4xklQ.Vector3(e.endPoint.x,0,e.endPoint.y),a,n);let s=n.distanceTo(a);s<i&&(i=s,r=t,o=a)}),{rayVec:e,minDist:i,minIndex:r,minPoint:o}}getIntersect2(e,t=!1){this.ray.set(this.camBase.localToWorld(this.camera.position.clone()),e);let i=Array.from(this.editor.wallGroup3D.children);i=i.concat(this.editor.floorGroup2d.children);for(let e=0;e<i.length;e++){let r=i[e];if("3DWall"==r.modelType||"floor"==r.useType){let e=Array.from(r.geometry.attributes.position.array);if(r.geometry.index){let i=Array.from(r.geometry.index.array);for(let o=0;o<i.length/3;o++){let a=new $4xklQ.Vector3,n=new $4xklQ.Vector3(e[3*i[3*o]],e[3*i[3*o]+1],e[3*i[3*o]+2]),s=new $4xklQ.Vector3(e[3*i[3*o+1]],e[3*i[3*o+1]+1],e[3*i[3*o+1]+2]),l=new $4xklQ.Vector3(e[3*i[3*o+2]],e[3*i[3*o+2]+1],e[3*i[3*o+2]+2]);if(n=r.localToWorld(n),s=r.localToWorld(s),l=r.localToWorld(l),"floor"==r.useType&&(n=new $4xklQ.Vector3(n.x/1e3,n.z/1e3,-n.y/1e3),s=new $4xklQ.Vector3(s.x/1e3,s.z/1e3,-s.y/1e3),l=new $4xklQ.Vector3(l.x/1e3,l.z/1e3,-l.y/1e3)),this.ray.intersectTriangle(n,s,l,!0,a),!a.equals(new $4xklQ.Vector3)){let e=this.camBase.position.distanceTo(a);if(t)return{point:a,obj:r};e<.3&&(this.canMove=!1)}}}else for(let i=0;i<e.length/9;i++){let o=new $4xklQ.Vector3,a=new $4xklQ.Vector3(e[9*i],e[9*i+1],e[9*i+2]),n=new $4xklQ.Vector3(e[9*i+3],e[9*i+4],e[9*i+5]),s=new $4xklQ.Vector3(e[9*i+6],e[9*i+7],e[9*i+8]);if(a=r.localToWorld(a),n=r.localToWorld(n),s=r.localToWorld(s),this.ray.intersectTriangle(a,n,s,!0,o),!o.equals(new $4xklQ.Vector3)){let e=this.camBase.position.distanceTo(o);if(t)return{point:o,obj:r};e<.3&&(this.canMove=!1)}}}}}getIntersect3(e){this.rayCaster.setFromCamera(e,this.camera);let t=this.getIntersect2(this.rayCaster.ray.direction,!0);t&&0==t.point.y&&(this.createCone(),this.tmpCone.position.x=t.point.x,this.tmpCone.position.z=t.point.z,this.tween(this.camBase.position,new $4xklQ.Vector3(t.point.x,this.camBase.position.y,t.point.z)))}tween(e,t){this.Tween._object={x:e.x,y:e.y,z:e.z},this.Tween._valuesStart={x:e.x,y:e.y,z:e.z};let i=this.cameraRot(e,t);this.Tween.to({x:t.x,y:t.y,z:t.z},i).start()}cameraRot(e,t){let i=t.distanceTo(e)/this.moveSpeed/3*10,r=new(0,$4xklQ.Vector2)(t.z,t.x).sub(new $4xklQ.Vector2(e.z,e.x)).angle(),o=(r-=Math.PI/2)-(this.cameraRotY.rotation.y<0?2*Math.PI+this.cameraRotY.rotation.y%(2*Math.PI):this.cameraRotY.rotation.y%(2*Math.PI));Math.abs(o)>Math.PI&&(o<0?o=2*Math.PI+o:o-=2*Math.PI);let a=10*Math.round(i/50);for(let e=0;e<a;e++)setTimeout(()=>{this.cameraRotY.rotation.y+=o/a,this.editor.miniCamera.rotation.z=this.cameraRotY.rotation.y},5*e);return i}getRadian(){return this.camera.getWorldDirection(this.tmpVec),Math.atan2(this.tmpVec.x,this.tmpVec.z)}updateCamera(){this.camera&&this.setUpdateState()}setUpdateState(){this.Xcount=this.countXBegin+10*Math.asin(this.XcountOffset/window.innerHeight/2),this.Ycount=this.countYBegin+10*Math.asin(this.YcountOffset/window.innerWidth/2),this.Zcount=this.countZBegin}onKeyDown(e){if(console.log("A---------------------------------------------------------------------"),console.log(this.cameraRotX.rotation.x,this.cameraRotX.rotation.y,this.cameraRotX.rotation.z),console.log(this.cameraRotY.rotation.x,this.cameraRotY.rotation.y,this.cameraRotY.rotation.z),console.log(this.camera.rotation.x,this.camera.rotation.y,this.camera.rotation.z),console.log("---------------------------------------------------------------------"),-1!=["w","a","s","d","q","e","W","A","S","D","Q","E","Shift"].indexOf(e.key)&&(e.preventDefault(),this.keyPress[e.key.toLowerCase()]=!0),32==e.keyCode&&(this.camBase.position.set(this.originPosition.x,17,this.originPosition.z),this.cameraRotX.rotation.z=-Math.PI/2,this.camera.rotation.y=-Math.PI/2,console.log(this.camera.rotation)),e.keyCode>48&&e.keyCode<=48+this.editor.floorGroup2d.children.length){let t=this.editor.floorGroup2d.children[e.keyCode-49].roomCenter,i=new $4xklQ.Vector3(Number(t[0])/1e3,1.7,-Number(t[1])/1e3),r=this.camBase.position.distanceTo(i)/this.moveSpeed/3*10,o=-this.cameraRotX.rotation.z,a=10*Math.round(r/50);for(let e=0;e<a;e++)setTimeout(()=>{this.cameraRotX.rotation.z+=o/a,this.editor.miniCamera.rotation.z=this.cameraRotY.rotation.y},5*e);this.cameraRot(new(0,$4xklQ.Vector3)().copy(this.camBase.position),i.clone()),this.Tween&&this.Tween.stop(),console.log(this.camBase.position.x,this.camBase.position.y,this.camBase.position.z),console.log(i.x,i.y,i.z),this.Tween._object={x:this.camBase.position.x,y:this.camBase.position.y,z:this.camBase.position.z},this.Tween._valuesStart={x:this.camBase.position.x,y:this.camBase.position.y,z:this.camBase.position.z},this.Tween.to({x:i.x,y:i.y,z:i.z},r).start(),this.camBase.position.copy(i)}this.canMove=!0,console.log("B---------------------------------------------------------------------"),console.log(this.cameraRotX.rotation.x,this.cameraRotX.rotation.y,this.cameraRotX.rotation.z),console.log(this.cameraRotY.rotation.x,this.cameraRotY.rotation.y,this.cameraRotY.rotation.z),console.log(this.camera.rotation.x,this.camera.rotation.y,this.camera.rotation.z),console.log("---------------------------------------------------------------------")}onKeyUp(e){-1!=["w","a","s","d","q","e","W","A","S","D","Q","E","Shift"].indexOf(e.key)&&(e.preventDefault(),this.keyPress[e.key.toLowerCase()]=!1),this.canMove=this.keyPress.w||this.keyPress.a||this.keyPress.s||this.keyPress.d||this.keyPress.q||this.keyPress.e}needUpdate(){if(this.activeFlag&&(this.rotate&&(this.camBase.position.y<=2.8&&(this.camera.rotation.y=-Math.PI/2),this.Xcount=(0,$4xklQ.MathUtils).clamp(this.Xcount,-.7,.7),this.cameraRotX.rotation.z=this.Xcount,this.cameraRotY.rotation.y=this.Ycount,this.editor.miniCamera.rotation.z=this.cameraRotY.rotation.y),this.canMove)){this.tmpCone&&(this.editor.scene.remove(this.tmpCone),this.tmpCone.geometry.dispose(),this.tmpCone=null,console.log("C tween stop"),this.Tween.stop());let e=this.getRadian(),t=this.keyPress.shift?2:1,i=Math.sin(e)*this.moveSpeed*t,r=Math.cos(e)*this.moveSpeed*t,o=new $4xklQ.Vector3;this.keyPress.w&&o.add(new $4xklQ.Vector3(i,0,r)),this.keyPress.a&&o.add(new $4xklQ.Vector3(r,0,-i)),this.keyPress.s&&o.add(new $4xklQ.Vector3(-i,0,-r)),this.keyPress.d&&o.add(new $4xklQ.Vector3(-r,0,i)),this.keyPress.q&&this.camBase.position.y<2.55&&o.add(new $4xklQ.Vector3(0,this.moveSpeed,0)),this.keyPress.e&&this.camBase.position.y>.05&&o.add(new $4xklQ.Vector3(0,-this.moveSpeed,0)),this.getIntersect2(o),this.canMove&&(this.camBase.position.add(o),this.editor.miniCamera.position.x=1e3*this.camBase.position.x,this.editor.miniCamera.position.y=-(1e3*this.camBase.position.z))}}restore(e,t){this.setPosition(e),this.cameraRotY.rotation.y=t.y,this.cameraRotX.rotation.z=t.z,this.editor.miniCamera.rotation.z=this.cameraRotY.rotation.y,this.editor.miniCamera.position.x=1e3*this.camBase.position.x,this.editor.miniCamera.position.y=-(1e3*this.camBase.position.z),this.camera.rotation.y=e.y>2.8?-Math.PI/2:0,console.log(this.camera.rotation.x,this.camera.rotation.y,this.camera.rotation.z),console.log(this.cameraRotX.rotation.x,this.cameraRotX.rotation.y,this.cameraRotX.rotation.z),console.log(this.cameraRotY.rotation.x,this.cameraRotY.rotation.y,this.cameraRotY.rotation.z)}setPosition(e){this.camBase.position.set(e.x,e.y,e.z)}createMinMap(){let e=document.getElementsByClassName("roaming_box")[0];for(let e in this.mmRenderer=new $4xklQ.WebGLRenderer({antialias:!0}),this.mmRenderer.setClearColor(15264748),this.mmRenderer.setPixelRatio(window.devicePixelRatio),this.mmRenderer.shadowMap.enabled=!0,this.mmRenderer.xr.enabled=!0,this.editor.cameras)"2dCamera"==this.editor.cameras[e].name&&(this.mmCamera=this.editor.cameras[e].clone());let t=240,i=258,r=240/258,o=-5e3;this.mmCamera.left=o*r,this.mmCamera.right=-o*r,this.mmCamera.top=-o,this.mmCamera.bottom=o,this.mmRenderer.setSize(t,i),this.mmCamera.updateProjectionMatrix(),this.mmRenderer.render(this.editor.scene,this.mmCamera),this.mmRenderer.domElement.style.cssText="position: absolute;left: 0;top: 0;width: 100%;height: 100%;",e.appendChild(this.mmRenderer.domElement),this.addListener(e),this.createCamera(),this.editor.miniCamera.roamControls=new $50d9c80e72e6b8f4$export$8ff7788029dfdf52(this.mmCamera,e),this.editor.miniCamera.roamControls.enableRotate=!1,this.editor.miniCamera.roamControls.target.copy(this.mmCamera.position),this.editor.miniCamera.roamControls.update(),this.editor.miniCamera.camera=this.mmCamera,this.editor.miniCamera.renderer=this.mmRenderer}addListener(e){let t=this.rayCaster,i=this.editor,r=this.mmCamera,o=this.camBase,a=this.cameraRotY,n=i.floor.clone();n.rotation.x=0,n.material=n.material.clone(),n.material.color=new $4xklQ.Color(16711680),n.layers.set(0),i.scene.add(n),e.addEventListener("pointermove",function(s){let l=new $4xklQ.Vector2;l.x=(s.clientX+e.clientWidth-window.innerWidth)/e.clientWidth*2-1,l.y=-(2*(s.clientY/e.clientHeight))+1,t.setFromCamera(l,r);let h=t.intersectObjects(i.miniCamera.children,!0),c=t.intersectObjects([n],!0);if(i.miniCamera.canRot&&"ready"!=i.miniCamera.canRot){let e=c[0].point.clone().sub(i.miniCamera.position);i.miniCamera.rotation.z=new $4xklQ.Vector2(e.x,e.y).angle(),a.rotation.y=i.miniCamera.rotation.z}if(h.length>0){if(1==h.length)i.miniCamera.nosc.visible=!0,i.miniCamera.selc.visible=!1,"ready"==i.miniCamera.canRot&&(i.miniCamera.nosr.visible=!0,i.miniCamera.selr.visible=!1,i.miniCamera.canRot=!1);else{let e=h[0].object.parent.name;if(i.miniCamera.canMove&&"ready"!=i.miniCamera.canMove){let e=c[0].point.clone().sub(i.miniCamera.originPosition);i.miniCamera.originPosition=c[0].point.clone(),i.miniCamera.position.add(e),o.position.x=i.miniCamera.position.x/1e3,o.position.z=-i.miniCamera.position.y/1e3}else"nosc"==e&&(i.miniCamera.nosc.visible=!1,i.miniCamera.selc.visible=!0,i.miniCamera.canMove="ready");i.miniCamera.canRot&&"ready"!=i.miniCamera.canRot?console.log(i.miniCamera.canRot,"旋转"):"nosr"==e&&(i.miniCamera.nosr.visible=!1,i.miniCamera.selr.visible=!0,i.miniCamera.canRot="ready")}}else i.miniCamera.nosc.visible=!0,i.miniCamera.selc.visible=!1,i.miniCamera.canMove=!1,"ready"==i.miniCamera.canRot?(i.miniCamera.nosr.visible=!0,i.miniCamera.selr.visible=!1,i.miniCamera.canRot=!1):i.miniCamera.canRot}),e.addEventListener("wheel",function(e){let t=i.miniCamera.position.clone(),o=i.miniCamera.scale;i.miniCamera.scale.set(1,1,1),i.miniCamera.applyMatrix4(new $4xklQ.Matrix4().makeScale(1/r.zoom*o.x,1/r.zoom*o.y,1)),i.miniCamera.position.set(t.x,t.y,t.z)}),e.addEventListener("pointerdown",function(o){let a=new $4xklQ.Vector2;a.x=(o.clientX+e.clientWidth-window.innerWidth)/e.clientWidth*2-1,a.y=-(2*(o.clientY/e.clientHeight))+1,t.setFromCamera(a,r);let s=t.intersectObjects([n],!1);"ready"==i.miniCamera.canMove&&(i.miniCamera.canMove=!0),"ready"==i.miniCamera.canRot&&(i.miniCamera.canRot=!0),(i.miniCamera.canMove||i.miniCamera.canRot&&"ready"!=i.miniCamera.canRot)&&(i.miniCamera.originPosition=s[0].point)}),e.addEventListener("pointerup",function(e){i.miniCamera.canMove&&(i.miniCamera.canMove="ready"),i.miniCamera.canRot&&(i.miniCamera.nosr.visible=!0,i.miniCamera.selr.visible=!1,i.miniCamera.canRot=!1)})}createCamera(){let e=1200,t=20,i=new $4xklQ.Vector3(-e/2,-e/2,t),r=new $4xklQ.Vector3(-e/2,e/6,t),o=new $4xklQ.Vector3(-e/6,e/6,t),a=new $4xklQ.Vector3(-e/3,e/2,t),n=new $4xklQ.Vector3(e/3,e/2,t),s=new $4xklQ.Vector3(e/6,e/6,t),l=new $4xklQ.Vector3(e/2,e/6,t),h=new $4xklQ.Vector3(e/2,-e/2,t);(0,$hrM0U.CommonFunc).createShapeByPoints([i,r,o,a,n,s,l,h],new $4xklQ.MeshBasicMaterial({color:16711680,side:2}));let c=new $4xklQ.Group,d='<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 28 28" id="camera-hover" width="28" height="28"><g fill="#675D50" fill-rule="evenodd" stroke="#FFF"><path d="M17.5 7A2.5 2.5 0 0015 4.5H7A2.5 2.5 0 004.5 7v14A2.5 2.5 0 007 23.5h8a2.5 2.5 0 002.5-2.5V7zM23.5 7.717a.5.5 0 00-.741-.438l-4.482 2.468a1.5 1.5 0 00-.777 1.314v5.888a1.5 1.5 0 00.777 1.314l4.482 2.468a.5.5 0 00.741-.438V7.717z"></path></g></svg>';var{object:p,update:u}=this.renderSVG(d);let m=new $4xklQ.Box3().setFromObject(p).getSize(new $4xklQ.Vector3);p.position.x-=m.x/2,c.add(p),p.name="nosc",c.nosc=p;let g='<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 28 28" id="camera-hover" width="28" height="28"><g fill="#1A7AFB" fill-rule="evenodd" stroke="#FFF"><path d="M17.5 7A2.5 2.5 0 0015 4.5H7A2.5 2.5 0 004.5 7v14A2.5 2.5 0 007 23.5h8a2.5 2.5 0 002.5-2.5V7zM23.5 7.717a.5.5 0 00-.741-.438l-4.482 2.468a1.5 1.5 0 00-.777 1.314v5.888a1.5 1.5 0 00.777 1.314l4.482 2.468a.5.5 0 00.741-.438V7.717z"></path></g></svg>';var{object:p,update:u}=this.renderSVG(g);p.position.x-=m.x/2,c.add(p),p.name="selc",c.selc=p,p.visible=!1;let f=3e3,w=105/180*Math.PI,y=new $4xklQ.Mesh(new $4xklQ.CircleGeometry(f,32,-w/2,w),new $4xklQ.MeshBasicMaterial({color:6774096,side:2,transparent:!0,opacity:.7}));y.name="circle";let b='<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 60 132" id="rotate" width="60" height="132"><g fill="#1E2329" fill-opacity=".5" fill-rule="evenodd" stroke="#FFF" stroke-width="3" transform="rotate(90 28.5 28.5)"><path d="M129.384 26.898L103.5 45.11V8.872l25.884 18.026zM2.616 26.898L28.5 45.11V8.873L2.616 26.898z"></path><circle cx="66" cy="27" r="25.5"></circle></g></svg>';var{object:p,update:u}=this.renderSVG(b);p.scale.x=10,p.scale.y=10,p.position.x=f,p.name="nosr",c.add(p),c.nosr=p;let x='<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 60 132" id="rotate" width="60" height="132"><g fill="#1A7AFB" fill-opacity=".5" fill-rule="evenodd" stroke="#FFF" stroke-width="3" transform="rotate(90 28.5 28.5)"><path d="M129.384 26.898L103.5 45.11V8.872l25.884 18.026zM2.616 26.898L28.5 45.11V8.873L2.616 26.898z"></path><circle cx="66" cy="27" r="25.5"></circle></g></svg>';var{object:p,update:u}=this.renderSVG(x);p.scale.x=10,p.scale.y=10,p.position.x=f,p.name="selr",p.visible=!1,c.selr=p,c.add(p,y),this.editor.miniCamera=c,this.editor.scene.add(c),c.rotation.z=this.cameraRotY.rotation.y,c.position.x=1e3*this.camBase.position.x,c.position.y=1e3*this.camBase.position.z,c.canMove=!1,c.canRot=!1}renderSVG(e){let t=new $22831dcc74231be4$export$959ae9097e74a233,i=t.parse(e),r=new $4xklQ.Group,o=[],a=new $4xklQ.LineBasicMaterial({color:"#FF0000",transparent:!0,opacity:.7});i.paths.forEach(e=>{let t=$22831dcc74231be4$export$959ae9097e74a233.createShapes(e),i=new $4xklQ.MeshBasicMaterial({color:e.color,transparent:!0,opacity:.7});t.forEach(e=>{let t=new $4xklQ.ExtrudeBufferGeometry(e,{depth:1,bevelEnabled:!1}),n=new $4xklQ.EdgesGeometry(t),s=new $4xklQ.Mesh(t,i),l=new $4xklQ.LineSegments(n,a);o.push({shape:e,mesh:s,lines:l}),r.add(s,l)})});let n=new $4xklQ.Box3().setFromObject(r),s=n.getSize(new $4xklQ.Vector3),l=-(s.y/2),h=-(s.x/2);return r.children.forEach(e=>{e.position.x=h-n.min.x,e.position.y=l-n.min.y}),r.position.z=100,r.applyMatrix4(new $4xklQ.Matrix4().makeScale(30,30,1)),{object:r,update(e){o.forEach(t=>{let i=new $4xklQ.ExtrudeBufferGeometry(t.shape,{depth:e,bevelEnabled:!1}),r=new $4xklQ.EdgesGeometry(i);t.mesh.geometry.dispose(),t.lines.geometry.dispose(),t.mesh.geometry=i,t.lines.geometry=r})}}}}var $0cbb1835efb7ffd9$exports={};$0cbb1835efb7ffd9$exports=JSON.parse('{"version":"2.8.0"}');var $dVRrd=parcelRequire("dVRrd"),$47Y2g=parcelRequire("47Y2g");class $19e26f6affaac76b$export$15d36fc1a69ab4a0{static toolType="free";constructor(e,t,i){this.stats=new $f31f472336ab70f0$export$2e2bcd8739ae039,this.stats.dom.setAttribute("class","stats"),this.stats.dom.style.top=window.innerHeight-48+"px",e.deviceType=i,this.container=t,this.renderer=null,this.editor=e,this.transformControls=new $887b34e694533b37$export$198e80c116632110(this.editor.camera,this.container),this.controls=new $a69b488eccbcfd7b$export$8ff7788029dfdf52(this.editor.camera,this.container,e),this.editor.globalControl=this.controls,this.controls.target.set(0,0,0),this.controls.enableRotate=!1;let r=this.editor.getOtherCamera(this.editor.camera);this.controls3D=new $a69b488eccbcfd7b$export$8ff7788029dfdf52(r,this.container,this.editor),this.controls3DRoam="",this.editor.controlsArr=[this.controls,this.controls3D],this.grid=new $4xklQ.Group,this.editor.grid=this.grid,this.grid.name="2dGrid",this.grid3D=new $4xklQ.Group,this.grid3D.name="3dGrid",this.editor.grid3d=this.grid3D,this.grid.rotation.x=-Math.PI/2,this.editor.createGrid(),this.editor.scene.add(this.grid),this.editor.scene.add(this.grid3D);let o=new $4xklQ.PlaneGeometry(2e5,2e5),a=new $4xklQ.MeshStandardMaterial({color:16777215,roughness:1,metalness:0,transparent:!0,opacity:0});this.editor.floor=new $4xklQ.Mesh(o,a),this.editor.floor.name="auxiliaryFloor",this.editor.scene.add(this.editor.floor),new $4xklQ.AxesHelper(500).layers.set(1),this.createRenderer();var n=new $4xklQ.SphereGeometry(.1,8,8);let s=new $4xklQ.PointLight(10394523,1,100);s.add(new $4xklQ.Mesh(n,new $4xklQ.MeshBasicMaterial({color:16711680}))),s.position.set(0,70,0),s.layers.enableAll(),this.editor.scene.add(s);let l=new $4xklQ.AmbientLight(10394523);l.intensity=1,l.layers.enableAll(),l.position.set(0,0,800),this.editor.scene.add(l),e.list.viewportCameraChanged.add(this.viewportCameraChanged.bind(this)),window.addEventListener("resize",this.onWindowResize.bind(this)),window.addEventListener("beforeunload",(function(e){this.editor.uiPanelBox.dom.remove()}).bind(this)),"PC"==i?(e.list.removeAll.dispatch("noSave",!1),this.editor.camera.updateProjectionMatrix(),window.addEventListener("mousewheel",this.onMousewheel.bind(this),!0),document.onkeydown=this.onkeydown.bind(this),document.onkeyup=this.onkeyup.bind(this),t.addEventListener("mousedown",this.onMouseDown.bind(this)),t.addEventListener("mouseup",this.onMouseUp.bind(this)),t.addEventListener("mousemove",this.mouseMove.bind(this)),t.addEventListener("touchstart",this.onTouchStart.bind(this)),t.addEventListener("touchmove",this.onTouchMove.bind(this)),t.addEventListener("touchend",this.onTouchEnd.bind(this)),t.addEventListener("dblclick",this.onDoubleClick.bind(this)),t.addEventListener("click",this.mouseClick.bind(this)),t.addEventListener("contextmenu",this.oncontextmenu.bind(this),!0)):(e.list.removeAll.dispatch("noSave",!1),this.editor.camera.position.set(0,0,1e3),this.editor.camera.lookAt(new $4xklQ.Vector3(0,0,0)),this.editor.camera.updateProjectionMatrix(),t.addEventListener("touchstart",(0,$dVRrd.MobileListener).onTouchStart.bind(this)),t.addEventListener("touchmove",(0,$dVRrd.MobileListener).onTouchMove.bind(this)),t.addEventListener("touchend",(0,$dVRrd.MobileListener).onTouchEnd.bind(this)),t.addEventListener("wheel",(0,$dVRrd.MobileListener).onMouseWheel.bind(this)),this.controls.enablePan=!0,this.controls.touches.ONE=1),document.getElementsByClassName("Panel")[0].style.display="none",this.editor.miniDom=document.getElementById("scrollviewcontent"),this.editor.initMiniMap(),this.selectionBox2D=new $038a164d1bff2da5$export$b053248d05663070(this.editor.camera,this.editor.scene),this.currentSelectionBoxHelper=new $00b7d4114b4a9b05$export$8ce2ff721d2b9fe1(this.editor.renderer,"selectBox_choose",t),this.selectionBox3D=new $038a164d1bff2da5$export$b053248d05663070(r,this.editor.scene),this.currentSelectionBox=this.selectionBox2D,setInterval(()=>{this.editor.saveSceneJson()},3e4),this.editor.list.setDefaultParams.dispatch({roomOpacity:100*window.roomOpacity,storeyHei:window.storeyHei,floorDep:window.floorDep}),this.editor.list.getVersionNumber.dispatch($0cbb1835efb7ffd9$exports.version);let h=localStorage.getItem("sceneData");h?h.indexOf("version")>=0?(this.editor.cacheJson=h,this.editor.readCache(h)):$.ajax({type:"GET",url:this.editor.config.remoteUrl+h,async:!0,cache:!0,dataType:"text",success:function(t,r){let o=(t=JSON.parse(t)).sceneJson;e.currentCacheJson=t.sceneJson,e.cacheJson=JSON.stringify(o),"PC"==i?o.version&&e.readCache(JSON.stringify(o)):(o.version||(0,$47Y2g.MobileMain).readCache(JSON.stringify(o)),document.getElementsByClassName("Panel")[0].style.display="block")},error:function(e){404==e.status&&localStorage.removeItem("sceneData"),document.getElementsByClassName("Panel")[0].style.display="block"}}):document.getElementsByClassName("Panel")[0].style.display="block"}createRenderer(){let e=new $4xklQ.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});e.shadowMap.enabled=!0,e.shadowMap.type=$4xklQ.PCFSoftShadowMap,e.setPixelRatio(window.devicePixelRatio),e.setSize(window.innerWidth,window.innerHeight),e.xr.enabled=!0,e.outputEncoding=$4xklQ.sRGBEncoding,e.setClearColor(15264748),this.renderer=e,this.editor.renderer=e,this.container.appendChild(this.renderer.domElement),this.container.parentNode.appendChild(this.editor.uiPanelBox.dom),this.animate()}cameraChanged(){this.render()}animate(){this.renderer.setAnimationLoop(this.render.bind(this))}render(){$0a029741d8f7787c$export$722fbec263ad908a(),this.renderer.render(this.editor.scene,this.editor.viewportCamera),this.editor.newRenderer.render(this.editor.scene,this.editor.miniMapCamera),this.editor.cameraRenderer.render(this.editor.cameraScene,this.editor.pngCamera),this.editor.miniMapObj&&this.editor.miniMapObj.updateMapMan(),""!=this.controls3DRoam&&"3DRoam"==this.editor.viewportCamera.sceneModel&&this.controls3DRoam.animate(),this.stats.update(),this.editor.roamTool&&(this.editor.roamTool.needUpdate(),this.editor.roamTool.mmRenderer.render(this.editor.scene,this.editor.roamTool.mmCamera))}viewportCameraChanged(e,t=!0){this.editor.transform3DTool&&"ThreeDimensionMoveHelper"==this.editor.transform3DTool.name&&this.editor.transform3DTool.removeEventListener();let i=e.viewportCamera;this.editor.camera=i;let r=new $523a84362d27c3e8$export$b680ca477a72be07(e);if(this.editor.baseRender&&($("#loading").remove(),$(".lil-gui.autoPlace").hide(),$(this.editor.dom).empty(),this.editor.dom.appendChild(this.renderer.domElement),this.editor.baseRender=!1,$("#sampele").remove(),this.render()),i.isOrthographicCamera){this.currentSelectionBox=this.selectionBox2D;let e=window.innerWidth/window.innerHeight,i=-5e3;this.editor.camera.left=i*e,this.editor.camera.right=-i*e,this.editor.camera.top=-i,this.editor.camera.bottom=i,this.controls.enabled=!0,""!=this.controls3D&&(this.controls3D.enabled=!1),this.editor.floor.rotation.x==-Math.PI/2&&(this.editor.floor.rotation.x=0),this.editor.globalControl=this.controls,this.editor.raycaster.layers.set(0),this.editor.floor.layers.set(0),this.editor.raycaster.layers.enable(0),t&&r.wallToJson()}else{if(this.currentSelectionBox=this.selectionBox3D,this.controls.enabled=!1,this.editor.raycaster.layers.set(1),this.editor.floor.layers.set(1),this.editor.raycaster.layers.enable(2),""!=this.controls3D&&(this.controls3D.enabled=!1),""!=this.controls3DRoam&&(this.controls3DRoam.enabled=!1),this.editor.camera.aspect=window.innerWidth/window.innerHeight,"3DRoam"==i.sceneModel){if(this.editor.roamTool);else{if(this.editor.roomList[0].length>0){let e=this.editor.roomList[0],t=this.editor.roomList[1],i=Math.max.apply(null,t),r=e[t.indexOf(i)];this.editor.camera.position.set(r[0]/1e3,.15,-r[1]/1e3),this.editor.camera.lookAt(new $4xklQ.Vector3(0,.15,1))}this.editor.roamTool=new $b47acdbb1ebb3974$export$72fae0e7761deb0c(this)}this.editor.globalControl=""}else""!=this.controls3D?this.controls3D.enabled=!0:this.controls3D=new $a69b488eccbcfd7b$export$8ff7788029dfdf52(i,this.container,this.editor),this.editor.globalControl=this.controls3D;0==this.editor.floor.rotation.x&&(this.editor.floor.rotation.x=-Math.PI/2),t&&r.wallToJson("3D")}this.editor.list.hiddenDialog.dispatch(),this.editor.camera.updateProjectionMatrix(),this.render()}onMousewheel(e){this.editor.camera.isOrthographicCamera&&this.editor.updateDom()}onkeydown(e){if(!this.editor.sceneActive)return;if(this.editor.baseRender){this.editor.baseRender.onkeydown(e);return}let t=window.event.keyCode;if(74==e.keyCode||"j"==e.key.toLowerCase()||83==e.keyCode&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)){if(e.preventDefault(),this.editor.saveSceneJson(),"j"==e.key.toLowerCase()){var i=JSON.stringify(this.editor.getSceneAllJson()),r=new Blob([i],{type:"text/plain"}),o=document.createElement("a");o.style.display="none",o.href=URL.createObjectURL(r),o.download="rjh_test_"+Date.parse(new Date)+".json",o.click()}return}if(this.editor.roamTool&&this.editor.roamTool.onKeyDown(e),1*e.key.toLowerCase()!=2&&(this.editor.camera.oldRotDir="",this.editor.camera.cameraRotDir=""),32==t){if(e.preventDefault(),this.editor.clickSelect.length>0){let e=this.editor.getOuterParent(this.editor.clickSelect[0].object);if(e&&("3DModel"==e.modelType||"2DModel"==e.modelType||"2dModelGroup"==e.modelType||"modelGroup"==e.modelType)&&!this.editor.mouseCoverObj){if(("2DModel"==e.modelType||"2dModelGroup"==e.modelType)&&(e=e.param[0]),e.isLock)return;e.rotation.y<=0&&(e.rotation.y+=2*Math.PI),e.rotation.y-=Math.PI/180*45,this.editor.synchroModel(e),this.editor.updateModel(e),new $102b3df9ca2da060$export$aead3d23b4737909(this.editor).selectObj([e]);return}}this.editor.list.resetCamera.dispatch();return}switch(e.key.toLowerCase()){case"backspace":break;case"delete":if(""==this.editor.clickSelect||""==this.editor.clickSelect[0].object)return;let a=this.editor.clickSelect[0].object;if(!a)return;if(this.editor.list.resetproperty.dispatch({roomOpacity:100*window.roomOpacity,storeyHei:window.storeyHei,floorDep:window.floorDep}),"wall"==a.useType)this.editor.list.delWall.dispatch();else if("splitRoom"==a.useType||"splitFloor"==a.useType||"splitCeil"==a.useType)this.editor.list.delSplitLine.dispatch();else if("dragPoint"==a.useType)this.editor.delCommonPoint(a.parent.center);else{let e=a.parent,t=["beam","flue","pillars"];if(e&&t.indexOf(e.modelType)>=0)this.editor.list.delMember.dispatch();else if("2DModel"==a.modelType)this.editor.list.delModel.dispatch();else{let e=this.editor.getOuterParent(a);"3DModel"==e.modelType||"modelGroup"==e.modelType?this.editor.list.delModel.dispatch():"CodeModel"==e.modelType?(this.editor.list.change3DDoor.dispatch(["del"]),this.editor.list.hiddenDialog.dispatch()):this.editor.list.delDoor.dispatch()}}break;case this.editor.config.getKey("settings/shortcuts/undo"):(this.editor.config.IS_MAC?e.metaKey:e.ctrlKey)&&(e.preventDefault(),this.editor.undo());break;case this.editor.config.getKey("settings/shortcuts/redo"):(this.editor.config.IS_MAC?e.metaKey:e.ctrlKey)&&(e.preventDefault(),this.editor.redo());break;case this.editor.config.getKey("settings/shortcuts/focus"):null!==this.editor.selected&&this.editor.focus(this.editor.selected);break;case"escape":"3dRomaCamera"==this.editor.camera.name&&this.editor.list.exitRomaScene.dispatch(),this.editor.exitTool();break;case"w":case"a":case"s":case"d":case"q":case"e":this.editor.moveCurrentCamera(e.key.toLowerCase());break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"0":case"+":case"-":case"*":case"/":if(this.editor.camera.isOrthographicCamera||"body"!=e.target.localName)return;this.editor.setCurrentCamera(e.key.toLowerCase())}}onkeyup(e){this.editor.roamTool&&this.editor.roamTool.onKeyUp(e)}mouseMove(e){if(this.editor.baseRender)return;if(e.shiftKey&&(this.currentSelectionBox.endPoint.set(e.clientX/window.innerWidth*2-1,-(2*(e.clientY/window.innerHeight))+1,.5),this.currentSelectionBox.select()),this.editor.sceneActive=!0,this.editor.currentPoint=this.editor.getWorldPosition(e),this.editor.currentMoveSelect=[],this.editor.menuSwitch||(this.editor.currentMoveSelect=this.getObject(e)),"grab"!=this.editor.dom.style.cursor&&(this.editor.dom.style.cursor="default"),("wall"==this.editor.toolType||"room"==this.editor.toolType||"splitTool"==this.editor.toolType)&&(this.editor.dom.style.cursor="crosshair"),this.editor.copyFloorMaterial){let e=this.editor.getScreenPosition(this.editor.currentPoint.clone());this.editor.list.blackBox.dispatch(e.x,e.y,"点击应用到该房间")}if("free"!=this.editor.toolType)"wall"==this.editor.toolType||"room"==this.editor.toolType||"splitTool"==this.editor.toolType?(this.editor.orthogonalModel&&""!=this.editor.startPoint&&(this.editor.currentPoint=(0,$9HO6e.UtilCore).handleOrthogonalPoint(this.editor.startPoint,this.editor.currentPoint)),this.editor.currentPoint=(0,$9HO6e.UtilCore).handleSpecialPoint(this.editor.currentPoint.clone(),this.editor.specialPointArr,this.editor),""!=this.editor.startPoint&&(this.editor.endPoint=this.editor.currentPoint,this.editor.list.executeTool.dispatch("moveDraw"))):this.editor.list.executeTool.dispatch("moveDraw");else{if(this.controls3D.enablePan=!0,this.controls3D.enableRotate=!0,!this.editor.camera.isOrthographicCamera&&this.editor.currentDownSelect.length>0){let e=this.editor.getOuterParent(this.editor.currentDownSelect[0].object);e.modelType&&(e.modelType.indexOf("Model")>=0||e.modelType.indexOf("model")>=0)&&this.editor.clickSelect.length>0&&this.editor.currentDownSelect.length>0&&this.editor.getOuterParent(this.editor.currentDownSelect[0].object).uuid==this.editor.getOuterParent(this.editor.clickSelect[0].object).uuid&&(this.controls3D.enableRotate=!1)}!this.editor.camera.isOrthographicCamera&&0==this.editor.currentDownSelect.length&&this.editor.mouseCoverObj&&(this.controls3D.enableRotate=!1),this.editor.otherMeshs.concat(this.editor.otherMember).forEach(e=>{e.children.forEach(e=>{("Line"==e.type||"Line2"==e.type||"DWHelper"==e.type)&&e.material.color.equals(this.editor.moveDoorColor)&&!e.material.color.equals(this.editor.clickColor)&&(e.material.color=this.editor.moveDoorOutColor)})}),this.editor.splitRoomLineGroup.children.slice(0).forEach(e=>{"splitOuterLine"==e.useType&&this.editor.splitRoomLineGroup.remove(e)});let e="";if(this.editor.splitRoomLine.children.slice(0).forEach(t=>{let i=(0,$9HO6e.UtilCore).smallDistanceByPointOnLine((0,$9HO6e.UtilCore).handleLineData(t.startPoint,t.endPoint),this.editor.currentPoint.clone());(0,$9HO6e.UtilCore).pointIsInLine(i,t.startPoint,t.endPoint)&&100>(0,$9HO6e.UtilCore).toVector2(this.editor.currentPoint).distanceTo(i.clone())&&(e=t)}),""!=e){let t=(0,$9QhXH.DM).createLine([e.startPoint,e.endPoint],"#00EEFF",!1,3);t.useType="splitOuterLine",this.editor.splitRoomLineGroup.add(t),this.editor.currentMoveSelect=[{object:e}]}if(""!=this.editor.downPoint){let e=this.editor.currentPoint.clone().distanceTo(this.editor.downPoint.clone()),t=40;if(this.editor.camera.isOrthographicCamera||(t/=1e3),e<t)return}this.editor.list.executeTool.dispatch("moveFree")}let t=!0,i=!1;if(this.editor.currentMoveSelect.length>0){let e=this.editor.currentMoveSelect[0].object,r=e.parent,o=["beam","flue","pillars"],a=r&&r.modelType&&(r.modelType.includes("Door")||r.modelType.includes("door")||r.modelType.includes("window")||r.modelType.includes("Window")||o.indexOf(r.modelType)>=0),n="2DModel"==this.editor.getOuterParent(e).modelType||"2dModelGroup"==this.editor.getOuterParent(e).modelType;t=n||a,a&&r.children.forEach(e=>{("Line"==e.type||"Line2"==e.type||"DWHelper"==e.type)&&e.material.color.equals(this.editor.clickColor)&&(i=!0)}),n&&this.editor.clickSelect.length>0&&e.uuid==this.editor.clickSelect[0].object.uuid&&(i=!0)}this.editor.currentMoveSelect.length>0&&"floor"==this.editor.currentMoveSelect[0].object.useType&&(t=!0),!t||i&&t?(this.controls.mouseButtons={LEFT:$4xklQ.MOUSE.LEFT,RIGHT:$4xklQ.MOUSE.PAN,MIDDLE:$4xklQ.MOUSE.PAN},this.controls.touches={ONE:-1}):(e.shiftKey&&(this.controls3D.enableRotate=!1,this.controls3D.enablePan=!1),this.controls.mouseButtons={LEFT:$4xklQ.MOUSE.PAN,RIGHT:$4xklQ.MOUSE.PAN,MIDDLE:$4xklQ.MOUSE.PAN},this.controls3D.mouseButtons.MIDDLE=$4xklQ.MOUSE.PAN,this.controls.touches={ONE:$4xklQ.TOUCH.PAN})}mouseClick(e){if(this.editor.baseRender)return;this.editor.splitRoomLineGroup.children=[];let t=!0,i=this.editor.downEvent,r=e,o=Math.abs(i.screenX-r.screenX)<this.editor.config.screenMoveArea&&Math.abs(i.screenY-r.screenY)<this.editor.config.screenMoveArea;if(!o&&"free"==this.editor.toolType&&this.controls.mouseButtons.LEFT==$4xklQ.MOUSE.PAN){let e=this.editor.clickSelect;e&&e.length>0&&"CodeModel"==this.editor.getOuterParent(e[0].object).modelType&&this.editor.add3DDoorDialog(e[0].object),this.editor.currentDownSelect=[];return}if(o||"wall"!=this.editor.toolType&&"splitTool"!=this.editor.toolType&&"room"!=this.editor.toolType||""==this.editor.startPoint){if(o&&(this.editor.list.hiddenDialog.dispatch(),this.editor.list.closeReplaceView.dispatch(),this.editor.camera.isOrthographicCamera&&this.editor.changAllInputToText()),this.editor.pointHelperGroup.children.slice(0).forEach(e=>{"clickPoint"==e.useType&&e.parent.remove(e)}),""!=this.editor.mouseCoverObj&&this.editor.execute(new $c338f49977b1ce90$export$4eacab61b79af859(this.editor),"放置模型"),"free"!=this.editor.toolType){let t=this.editor.currentPoint.clone();(e.clientX||0!=e.changedTouches.length)&&(t=this.editor.getWorldPosition(e)),"wall"==this.editor.toolType||"splitTool"==this.editor.toolType?(t=(0,$9HO6e.UtilCore).handleSpecialPoint(this.editor.currentPoint.clone(),this.editor.specialPointArr,this.editor),this.editor.allLinkWallByStartPoint=[],""==this.editor.startPoint?(this.editor.startPoint=t,this.editor.allLinkWallByStartPoint=(0,$9HO6e.UtilCore).havePointWall(t,this.editor.allWalls)):(this.editor.endPoint=t,this.editor.statusJson=this.editor.getSceneAllJson(),this.editor.list.executeTool.dispatch("sureDraw"),this.editor.allLinkWallByStartPoint=(0,$9HO6e.UtilCore).havePointWall(t,this.editor.allWalls),this.editor.startPoint=t,this.editor.currenDraw="",this.editor.specialPointArr=(0,$9HO6e.UtilCore).getAllSpecialPoint(this.editor),"free"==this.editor.toolType&&(this.editor.startPoint=""))):"room"==this.editor.toolType?(t=(0,$9HO6e.UtilCore).handleSpecialPoint(this.editor.currentPoint.clone(),this.editor.specialPointArr,this.editor),""==this.editor.startPoint?this.editor.startPoint=t:(this.editor.endPoint=t,this.editor.statusJson=this.editor.getSceneAllJson(),(0,$9HO6e.UtilCore).toVector3(this.editor.startPoint.clone()).distanceTo((0,$9HO6e.UtilCore).toVector3(t.clone()))>40&&this.editor.list.executeTool.dispatch("sureDraw"),this.editor.startPoint="",this.editor.currenDraw="",this.editor.specialPointArr=(0,$9HO6e.UtilCore).getAllSpecialPoint(this.editor))):this.editor.list.executeTool.dispatch("sureDraw")}else{let i=this.getObject(e);if(i.length>0){if(this.editor.transform3DTool&&"ThreeDimensionMoveHelper"==this.editor.transform3DTool.name&&this.editor.transform3DTool.removeEventListener(),e.shiftKey||e.ctrlKey){let e=i[0].object;this.editor.selectObjArr.indexOf(e)>=0?this.editor.selectObjArr.splice(this.editor.selectObjArr.indexOf(e),1):this.editor.selectObjArr.push(i[0].object)}else this.editor.selectObjArr=[i[0].object];if(this.editor.camera.isOrthographicCamera){this.editor.clickSelect.length>0&&""!=this.editor.clickSelect[0].object&&"wall"==this.editor.clickSelect[0].object.useType&&(this.editor.clickSelect[0].object.material.color=this.editor.getWallColor(this.editor.clickSelect[0].object));let e=this.editor.clickSelect;this.editor.clickSelect=i;let r="";this.editor.currentDownSelect[0].object.parent&&(r=this.editor.currentDownSelect[0].object.parent.currentModel),r&&(this.editor.clickSelect[0].object=r);let o="";if(this.editor.splitRoomLine.children.slice(0).forEach(e=>{let t=(0,$9HO6e.UtilCore).smallDistanceByPointOnLine((0,$9HO6e.UtilCore).handleLineData(e.startPoint,e.endPoint),this.editor.currentPoint.clone());(0,$9HO6e.UtilCore).pointIsInLine(t,e.startPoint,e.endPoint)&&100>(0,$9HO6e.UtilCore).toVector2(this.editor.currentPoint).distanceTo(t.clone())&&(o=e)}),""!=o){let e=(0,$9QhXH.DM).createLine([o.startPoint,o.endPoint],"#00EEFF",!1,3);e.useType="splitCheckLine",this.editor.splitRoomLineGroup.add(e),this.editor.clickSelect=[{object:o}]}let a=this.editor.clickSelect[0].object.useType;if((0,$9HO6e.UtilCore).updateLineDimensionsLine(this.editor),"wall"==a){if(this.editor.currentDownSelect[0].object.parent&&this.editor.currentDownSelect[0].object.parent.uuid==this.editor.clickSelect[0].object.parent.uuid){this.editor.doorHelperGroupClean(),this.editor.clickSelect[0].object.material.color=this.editor.clickColor;let e=this.editor.clickSelect[0].object;e.children=[];let t=this.editor.getDialogPosition("","",this.editor.currentPoint.clone()),i=Math.round(e.startPoint.clone().distanceTo(e.endPoint.clone())),r=(0,$9HO6e.UtilCore).havePointWall(e.startPoint,this.editor.allWalls),o=(0,$9HO6e.UtilCore).havePointWall(e.endPoint,this.editor.allWalls),a=r.length>1,n=o.length>1;this.editor.changTextToInput(e);let s=(0,$9HO6e.UtilCore).getLinkRealWall(r,e.startPoint,e.endPoint),l=(0,$9HO6e.UtilCore).getLinkRealWall(o,e.endPoint,e.startPoint);s.forEach(t=>{this.editor.changTextToInput(t,e.startPoint,s,l,r,o)}),l.forEach(t=>{this.editor.changTextToInput(t,e.endPoint,l,s,o,r)}),this.editor.list.showDialog.dispatch(0,"wall",t,[i,e.thickness,a,n,e.style,e.height]),"bezier"==e.isArc&&this.editor.addBSRWallHelper(e)}else this.editor.clickSelect=e}else if("scaleRuleTool"==a||"scaleHelpTool"==a);else if("rotateTool"==a||"scalePoint"==a);else if("bseControl"==a);else if("splitRoom"==a||"splitFloor"==a||"splitCeil"==a);else if("floor"==a){if(this.editor.currentDownSelect[0].object.uuid==this.editor.clickSelect[0].object.uuid){this.editor.doorHelperGroupClean();let e=this.editor.clickSelect[0].object;editor.copyFloorMaterial&&(this.editor.execute(),e.material=editor.copyFloorMaterial);for(let t=0;t<e.allPoints.length;t++){let i=e.allPoints[t],r=e.allPoints[0];t!=e.allPoints.length-1&&(r=e.allPoints[t+1]);let o=(0,$9QhXH.DM).createLine([i,r],"#00EEFF",!1,2.5);o.useType="splitCheckLine",this.editor.splitRoomLineGroup.add(o)}let t=this.editor.getDialogPosition("","",this.editor.currentPoint.clone());this.editor.list.showDialog.dispatch(3,"地面",t,[this.editor.clickSelect[0].object.roomName])}else this.editor.clickSelect=e}else if("dragPoint"==a){let e=this.editor.clickSelect[0].object,t=new $d0f874000594cf7a$export$a955f3d6a39ce4b2().createDoorOuterPoint(e.parent.center,2*e.parent.radio,"rgb(26, 122, 251)");t.useType="clickPoint",this.editor.pointHelperGroup.add(t)}else if("2DModel"==this.editor.clickSelect[0].object.modelType){this.editor.doorHelperGroupClean();let e=this.editor.getOuterParent(this.editor.clickSelect[0].object);if(!e.visible)return;let i=this.editor.getDialogPosition("","",this.editor.currentPoint.clone()),r=this.editor.clickSelect[0].object,o=this.editor.getOuterParent(r,r,"outer");if(this.editor.clickDepthMsg.uuid&&this.editor.clickDepthMsg.uuid==o.uuid&&(t=!1),this.editor.modelHelperGroup.children=[],this.editor.selectObjArr.length>1){let e=!1;this.editor.selectObjArr.forEach(t=>{let i=this.editor.getOuterParent(t);this.editor.addBoxFor2dGroup(i);let r=this.editor.get3DModelBy2DModel(i);this.editor.addBoxForGroup(r),e=i.isLock}),this.editor.list.showDialog.dispatch(9,"2d软装多选",i,[{isLock:e}])}else{let t=this.editor.get3DModelBy2DModel(e);if("Line2"==t.type&&this.editor.model3D.children.forEach(e=>{e.uuid==t.modelUUID&&(t=e)}),"Line2"==t.type)return;if(e.isLock){this.editor.addPositionHelper(e,!0),this.editor.addBoxFor2dGroup(e);let i=this.editor.wallHelp.addOBBbox(t,this.editor.config.boxColor);i.name="modelBox",i.layers.set(2),this.editor.modelHelperGroup.add(i)}else{let e={};this.editor.clickDepthMsg.uuid&&(e=this.editor.clickDepthMsg,this.editor.clickDepthMsg={uuid:o.param[0].uuid,depth:1,model:o.param[0]}),new $102b3df9ca2da060$export$aead3d23b4737909(this.editor).selectObj([t]),this.editor.clickDepthMsg=e}let i=this.editor.getDialogPosition("","",this.editor.currentPoint.clone()),r=t,a=this.editor.getRealSize(r),n=1e3*a[0].toFixed(3),s=1e3*a[1].toFixed(3),l=1e3*a[2].toFixed(3),h=1e3*r.width.toFixed(3),c=1e3*r.height.toFixed(3),d=1e3*r.depth.toFixed(3),p=new $4xklQ.Vector3(0,r.position.y,0);r.parent.localToWorld(p);let u=1e3*(p.y-a[1]/2).toFixed(3),m=0;if("top"==r.modelPosition){let e=window.storeyHei;this.editor.wallGroup3D.roomHeight,(m=1e3*(e/1e3-r.height).toFixed(3))<10&&(m=0)}u<10&&(u=0);let g=360-Math.abs(parseInt(180/Math.PI*r.rotation.x)),f=parseInt(180/Math.PI*r.rotation.y),w=360-Math.abs(parseInt(180/Math.PI*r.rotation.z));f<0&&(f+=360),360==g&&(g=0),360==f&&(f=0),360==w&&(w=0);let y={isLock:e.isLock,width:n,height:s,depth:l,oldWidth:h,oldHeight:c,oldDepth:d,floorHei:u,rotation:[g,w,f],oldFloorHei:m};"2dModelGroup"==e.modelType?this.editor.list.showDialog.dispatch(14,"组合模型",i,[y]):("{}"!=JSON.stringify(this.editor.clickDepthMsg)&&(y.isGroupChild=!0),this.editor.list.showDialog.dispatch(8,"单品模型",i,[y]))}}else{let e=this.editor.clickSelect[0].object.parent,t=e;this.editor.cleanWallHelper(),this.editor.doorHelperGroupClean();let i=["beam","flue","pillars"];if(t&&this.editor.changeClickColor(t),i.indexOf(t.modelType)>=0){t.isLock?this.editor.addPositionHelper(e,!0):this.editor.addLineHelperForMember(e);let i=40,r=(0,$9HO6e.UtilCore).toVector3(t.position.clone()).project(this.editor.camera),o=window.innerWidth/2,a=window.innerHeight/2,n=[Math.round(r.x*o+o),Math.round(-r.y*a+a)];n[0]+=i,n[1]-=2*i;let s=Math.round(180/Math.PI*t.rotation.z);s<0&&(s=360+s);let l=[Math.round(t.width*t.scale.x),Math.round(t.height*t.scale.y),Math.round(t.depth*t.scale.z),s,{isLock:t.isLock}],h=4;"flue"==t.modelType&&(h=5),"pillars"==t.modelType&&(h=6),this.editor.list.showDialog.dispatch(h,t.modelType,n,l)}else if(t.startPoint){this.editor.addLineHelperForDoor(e,!0);let i=Math.abs(Math.round(t.doorWid*t.scale.x)),r=this.editor.getDialogPosition("","",this.editor.currentPoint.clone()),o=t.modelType,a=this.editor.getWallByWallId(t.wallId),n=this.editor.config.modelTypeJson[t.modelType];o&&(o.includes("Door")||o.includes("door")?this.editor.list.showDialog.dispatch(2,n,r,[i,t.height,Math.round(t.wallDep),t.floorHei,a.height,{isLock:t.isLock}]):(o.includes("Window")||o.includes("window"))&&this.editor.list.showDialog.dispatch(1,n,r,[i,t.height,Math.round(t.wallDep),t.floorHei,a.height,{isLock:t.isLock}]),e.wallId&&(this.editor.currentDoor=e))}}}else if(this.editor.clickSelect=i,"CodeModel"==this.editor.getOuterParent(i[0].object).modelType)this.editor.add3DDoorDialog(i[0].object);else if("3dMember"==i[0].object.parent.name){let e=this.editor.get3DModelDialogPosition(i[0].object,30),t=4;this.editor.modelHelperGroup.children=[],this.editor.addBoxForGroup(i[0].object);let r=i[0].object.twoD;"flue"==r.modelType&&(t=5),"pillars"==r.modelType&&(t=6);let o=Math.round(180/Math.PI*r.rotation.z);o<0&&(o=360+o);let a=[Math.round(r.width*r.scale.x),Math.round(r.height*r.scale.y),Math.round(r.depth*r.scale.z),o,{isLock:r.isLock}];this.editor.list.showDialog.dispatch(t,i[0].object.modelType,e,a)}else if("3dwall"==i[0].object.parent.name)this.editor.modelHelperGroup.children=[];else{let e=this.editor.getOuterParent(i[0].object,i[0].object,"outer");if(!e.visible)return;this.editor.clickDepthMsg.uuid&&this.editor.clickDepthMsg.uuid==e.uuid&&(t=!1),o&&new $102b3df9ca2da060$export$aead3d23b4737909(this.editor).selectObj(this.editor.selectObjArr)}}else if(o){this.editor.otherMeshs.concat(this.editor.otherMember).forEach(e=>{e.children.forEach(e=>{("Line"==e.type||"Line2"==e.type||"DWHelper"==e.type)&&(e.material.color=this.editor.moveDoorOutColor)})}),this.editor.camera.isOrthographicCamera&&(this.editor.switchHelperGroup("show"),this.editor.clickSelect.length>0&&""!=this.editor.clickSelect[0].object&&"wall"==this.editor.clickSelect[0].object.useType&&(this.editor.clickSelect[0].object.material.color=this.editor.getWallColor(this.editor.clickSelect[0].object)),(0,$9HO6e.UtilCore).updateLineDimensionsLine(this.editor)),this.editor.removeBSRHelper(),this.editor.selectObjArr=[],this.editor.list.hiddenDialog.dispatch(),this.editor.list.resetproperty.dispatch({roomOpacity:100*window.roomOpacity,storeyHei:window.storeyHei,floorDep:window.floorDep}),this.editor.currentDoor="",0==this.editor.currentDownSelect.length&&this.editor.doorHelperGroupClean(),this.editor.modelHelperGroup.children=[],this.editor.clickSelect=[],this.editor.destroy3DModelHelper();let e="";if(this.editor.splitRoomLine.children.slice(0).forEach(t=>{let i=(0,$9HO6e.UtilCore).smallDistanceByPointOnLine((0,$9HO6e.UtilCore).handleLineData(t.startPoint,t.endPoint),this.editor.currentPoint.clone());(0,$9HO6e.UtilCore).pointIsInLine(i,t.startPoint,t.endPoint)&&100>(0,$9HO6e.UtilCore).toVector2(this.editor.currentPoint).distanceTo(i.clone())&&(e=t)}),""!=e){let t=(0,$9QhXH.DM).createLine([e.startPoint,e.endPoint],"#00EEFF",!1,3);t.useType="splitCheckLine",this.editor.splitRoomLineGroup.add(t),this.editor.clickSelect=[{object:e}]}this.editor.copyFloorMaterial=""}}t&&this.editor.clickDepthMsg.uuid&&o&&this.exitModelHierarchy(),this.editor.downPoint="",this.editor.currentDownSelect="",this.editor.statusJson=[]}}exitModelHierarchy(){this.editor.modelDotGroup.children=[],this.editor.clickDepthMsg={}}oncontextmenu(e){this.editor.clickSelect.length>0&&""!=this.editor.clickSelect[0].object&&"floor"!=this.editor.clickSelect[0].object.useType&&this.editor.updateDialogPosition(this.editor.clickSelect[0].object);let t=this.editor.downEvent,i=e;Math.abs(t.screenX-i.screenX)<this.editor.config.screenMoveArea&&Math.abs(t.screenY-i.screenY)<this.editor.config.screenMoveArea&&this.editor.exitTool(!0,!1)}onMouseDown(e){if(!this.editor.baseRender){if(this.editor.downEvent=e,2==e.button||1==e.button){this.editor.menuSwitch=!0;return}if(e.shiftKey&&this.currentSelectionBox.startPoint.set(e.clientX/window.innerWidth*2-1,-(2*(e.clientY/window.innerHeight))+1,.5),this.editor.statusJson=this.editor.getSceneAllJson(),this.editor.currentDownSelect=this.getObject(e),0==this.editor.currentDownSelect.length&&("default"==this.editor.dom.style.cursor||""==this.editor.dom.style.cursor)&&(this.editor.dom.style.cursor="grab"),this.editor.startChooseWall=this.getObject(e),this.editor.specialPointArr=(0,$9HO6e.UtilCore).getAllSpecialPoint(this.editor),this.editor.currentDownSelect.length>0){let e=this.editor.currentDownSelect[0].object;if("wall"==e.useType)this.editor.moveStartPosition=e.position.clone();else{let e=this.editor.currentDownSelect[0].object;"Line2"==e.type&&e.parent.currentModel&&(this.editor.currentDownSelect[0].object=e.parent.currentModel);let t=this.editor.currentDownSelect[0].object.parent,i=this.editor.currentDownSelect[0].object;(i=this.editor.getOuterParent(i)).modelType&&i.modelType.indexOf("Model")>=0&&(t=i),this.editor._scaleStart=new $4xklQ.Vector3().copy(t.scale),this.editor._offsetStart=new $4xklQ.Vector3().copy(t.position),t.currentModel&&(this.editor._scaleStart=new $4xklQ.Vector3().copy(t.currentModel.parent.scale),this.editor._offsetStart=new $4xklQ.Vector3().copy(t.currentModel.parent.position)),t.wallId&&(this.editor.currentDoor=t)}}else this.editor.menuSwitch=!0;this.editor.downPoint=this.editor.getWorldPosition(e)}}onMouseUp(e){if(this.editor.baseRender)return;e.shiftKey&&(this.currentSelectionBox.endPoint.set(e.clientX/window.innerWidth*2-1,-(2*(e.clientY/window.innerHeight))+1,.5),this.currentSelectionBox.select()),e.preventDefault();let t=this.editor.downEvent,i=e;this.controls3D.enableRotate&&!this.editor.camera.isOrthographicCamera&&(this.editor.mouseCoverObj=""),this.editor.mouseCoverObj&&this.editor.execute(new $c338f49977b1ce90$export$4eacab61b79af859(this.editor),"放置模型");let r=this.editor.getWorldPosition(e);"free"==this.editor.toolType&&this.editor.downPoint&&r.clone().distanceTo(this.editor.downPoint.clone())>40&&this.editor.list.executeTool.dispatch("moveMesh"),this.editor.blackbox&&this.editor.blackbox.removeDom(),this.editor.blackbox="",this.editor.statusJson=[],this.editor.startChooseWall="",this.editor.menuSwitch=!1,"wall"!=this.editor.toolType&&"room"!=this.editor.toolType&&(this.editor.dom.style.cursor="default");let o=i.screenX-t.screenX,a=i.screenY-t.screenY;this.editor.list.updateDialog.dispatch(o,a)}onTouchStart(e){e.preventDefault(),this.editor.currentPoint=this.editor.getWorldPosition(e),""!=this.editor.touchStart&&(0,$9HO6e.UtilCore).isSameVector(this.editor.touchStart,this.editor.currentPoint)?(this.editor.touchStart="",this.editor.exitTool()):this.editor.touchStart=this.editor.currentPoint,this.onMouseDown(e)}onTouchMove(e){this.mouseMove(e)}onTouchEnd(e){e.preventDefault(),this.onMouseUp(e),this.mouseClick(e)}onDoubleClick(e){if(!this.editor.baseRender&&this.editor.selectObjArr.length>0){let e=this.editor.selectObjArr[0],t=this.editor.getOuterParent(e);if("modelGroup"==t.modelType)this.editor.modelHelperGroup.children=[],this.editor.addDashBoxForGroup(t),this.editor.doorHelperGroupClean(),this.editor.clickDepthMsg={uuid:t.uuid,depth:1,model:t},this.editor.clickSelect[0].object=e,new $102b3df9ca2da060$export$aead3d23b4737909(this.editor).selectObj([e]),this.editor.addDashBoxFor2dGroup(t.param[0]);else if("2dModelGroup"==t.modelType){if(this.editor.modelHelperGroup.children=[],this.editor.addDashBoxForGroup(t.param[0]),this.editor.doorHelperGroupClean(),e.isLock){this.editor.addPositionHelper(e,!0),this.editor.addBoxFor2dGroup(e);let t=this.editor.wallHelp.addOBBbox(e.param[0],this.editor.config.boxColor);t.name="modelBox",t.layers.set(2),this.editor.modelHelperGroup.add(t)}else this.editor.clickDepthMsg={uuid:t.param[0].uuid,depth:1,model:t},new $102b3df9ca2da060$export$aead3d23b4737909(this.editor).selectObj([e.param[0].children[0]]),this.editor.addLineHelperForMember(e);this.editor.addDashBoxFor2dGroup(t),this.editor.clickDepthMsg={uuid:t.uuid,depth:1,model:t},this.editor.clickSelect[0].object=e;let i=this.editor.getDialogPosition("","",this.editor.currentPoint.clone());t=e;let r=this.editor.getRealSize(t),o=t.param[0],a=1e3*r[0].toFixed(3),n=1e3*r[1].toFixed(3),s=1e3*r[2].toFixed(3),l=1e3*o.width.toFixed(3),h=1e3*o.height.toFixed(3),c=1e3*o.depth.toFixed(3),d=new $4xklQ.Vector3(0,o.position.y,0);o.parent.localToWorld(d);let p=1e3*(d.y-r[1]/2).toFixed(3),u=0;if("top"==o.modelPosition){let e=window.storeyHei;this.editor.wallGroup3D.roomHeight,(u=1e3*(e/1e3-o.height).toFixed(3))<10&&(u=0)}p<10&&(p=0);let m=360-Math.abs(parseInt(180/Math.PI*t.rotation.x)),g=360-Math.abs(parseInt(180/Math.PI*t.rotation.y)),f=360-Math.abs(parseInt(180/Math.PI*t.rotation.z));360==m&&(m=0),360==g&&(g=0),360==f&&(f=0);let w={isLock:t.isLock,width:a,height:n,depth:s,oldWidth:l,oldHeight:h,oldDepth:c,floorHei:p,rotation:[m,g,f],oldFloorHei:u};"2dModelGroup"==e.modelType?this.editor.list.showDialog.dispatch(10,"2d软装",i,[w]):(w.isGroupChild=!0,this.editor.list.showDialog.dispatch(8,"2d软装",i,[w]))}}}getObject(e){e.clientX||0==e.clientX?(this.editor.mouse.x=e.clientX/window.innerWidth*2-1,this.editor.mouse.y=-(2*(e.clientY/window.innerHeight))+1):(this.editor.mouse.x=e.changedTouches[0].pageX/window.innerWidth*2-1,this.editor.mouse.y=-(2*(e.changedTouches[0].pageY/window.innerHeight))+1),this.editor.raycaster.setFromCamera(this.editor.mouse,this.editor.camera);let t=this.editor.pointHelperGroup.children.concat(this.editor.otherMeshs);return t=(t=(t=(t=(t=(t=(t=t.concat(this.editor.allWalls)).concat(this.editor.otherMember)).concat(this.editor.wallGroup3D.children)).concat(this.editor.model3D.children)).concat(this.editor.model2D.children)).concat(this.editor.floorGroup2d.children)).concat(this.editor.memberGroup3D.children),this.editor.raycaster.intersectObjects(t,!0)}onWindowResize(){if(this.editor.camera.isOrthographicCamera){let e=window.innerWidth/window.innerHeight,t=-5e3;this.editor.camera.left=t*e,this.editor.camera.right=-t*e,this.editor.camera.top=-t,this.editor.camera.bottom=t}else this.editor.camera.aspect=window.innerWidth/window.innerHeight;this.editor.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}}var $5XTH3=parcelRequire("5XTH3"),$9HO6e=parcelRequire("9HO6e"),$9HO6e=parcelRequire("9HO6e"),$9HO6e=parcelRequire("9HO6e"),$4xklQ=parcelRequire("4xklQ"),$9QhXH=parcelRequire("9QhXH"),$5XTH3=parcelRequire("5XTH3");class $671a9ada1efb021a$export$ad57cb3fe2de1d52{constructor(e){this.editor=e,this.moveCommandObj={},this.repairCommandObj=[],this.splitWallCommand="",this.sureMove=!1,this.wallCore=new $523a84362d27c3e8$export$b680ca477a72be07(this.editor),this.wallHelper=new $d0f874000594cf7a$export$a955f3d6a39ce4b2(this.editor),this.spiltWall=[],this.spiltOldWall=[],this.linkWall=[]}moveWallMain(){if(!this.editor.startChooseWall[0]||this.editor.currentDownSelect.length>0&&"bezier"==this.editor.currentDownSelect[0].object.isArc)return;let e="",t="",i="",r=this.editor.currentDownSelect[0].object;i=r;let o=this.editor.allWalls.slice(0),a=[];this.editor.moveRule||(this.editor.moveRule=(0,$9HO6e.UtilCore).getWallMoveRule(r,o,this.editor),o.forEach(e=>{let t=e.clone();t.startPoint=e.startPoint.clone(),t.endPoint=e.endPoint.clone(),a.push(t)}),this.editor.moveRule.push(a));let n=this.moveCoreMain(r,this.editor.moveRule);if(!n||!n[0]||!n[1])return;this.editor.scene.remove(r),this.editor.removeHelperByWall(r);let s=this.editor.allWalls.indexOf(r);if(s>=0&&this.editor.allWalls.splice(s,1),""!=this.editor.currenDraw){let e=this.editor.allWalls.indexOf(this.editor.currenDraw);e>=0&&this.editor.allWalls.splice(e,1),this.editor.scene.remove(this.editor.currenDraw),this.editor.removeHelperByWall(this.editor.currenDraw)}if(e=n[0],t=n[1],this.moveCommandObj.oldMesh=this.editor.startChooseWall[0].object,i.isArc){let e=i.startPoint,t=i.endPoint;""!=this.editor.circlePoint&&this.editor.scene.remove(this.editor.circlePoint),this.editor.circlePoint=this.wallHelper.createNormalPoint(this.editor.currentPoint),this.editor.scene.add(this.editor.circlePoint),this.editor.currenDraw=this.wallCore.createCircleWall(e,t,this.editor.currentPoint,i.isArc,this.moveCommandObj.oldMesh.thickness)}else this.editor.currenDraw=this.wallCore.createLineWall(e,t,this.moveCommandObj.oldMesh.thickness);this.editor.currenDraw.cover=n[2],this.editor.currenDraw.isArc=i.isArc,this.editor.currenDraw.style=i.style,this.editor.currenDraw.height=i.height,this.editor.currenDraw.thickness=i.thickness,this.moveCommandObj.currentMesh=this.editor.currenDraw;let l=(0,$9HO6e.UtilCore).getAllWallLine(this.editor.currentDownSelect[0].object);this.editor.currentDownSelect&&(this.editor.currentDownSelect[0].object=this.editor.currenDraw),this.editor.scene.add(this.editor.currenDraw),this.editor.allWalls.push(this.editor.currenDraw);let h=l[0].concat(l[1]);h=(h=h.concat(l[3])).concat(l[2]);let c=this.editor.splitRoomLine.children.slice(0),d=(0,$9HO6e.UtilCore).handleLineData(e,t);c.forEach(e=>{let t=e.startPoint,i=e.endPoint,r=this.editor.PolyK.ContainsPoint(h,t.x,t.y),o=this.editor.PolyK.ContainsPoint(h,i.x,i.y),a=(0,$9HO6e.UtilCore).handleLineData(t,i),n=(0,$9HO6e.UtilCore).lineIsIntersection(a,d);r&&n&&(this.editor.splitRoomLine.remove(e),this.editor.addSplitLine(n,i,e.useType)),o&&n&&(this.editor.splitRoomLine.remove(e),this.editor.addSplitLine(t,n,e.useType))}),this.editor.currenDraw.wallID=this.editor.startChooseWall[0].object.wallID,this.editor.otherMember.forEach(e=>{if(!e.parameter)return;let t=this.editor.startChooseWall[0].object;if(e.parameter.leftWall.includes(t.wallID)||e.parameter.rightWall.includes(t.wallID)){let t=(0,$9QhXH.DM).memberJson([e]);this.editor.otherMember.splice(this.editor.otherMember.indexOf(e),1),this.editor.scene.remove(e),t.forEach(e=>{let t,i=new $4xklQ.Vector3(e.location.x,e.location.y,e.location.z);"beam"==e.type&&((t=(0,$9QhXH.DM).createBeam(i,"beam",e.angle,e.height,e.depth,this.editor.allWalls)).rotation.z=e.rotation,this.editor.otherMember.push(t),this.editor.scene.add(t))})}})}execute(){if(""!=this.editor.currenDraw&&(this.editor.currentDownSelect.length>0||"{}"!=JSON.stringify(this.moveCommandObj))){this.sureMove=!0,this.moveWallMain(),this.editor.moveRule="",""!=this.editor.circlePoint&&this.editor.scene.remove(this.editor.circlePoint),this.editor.circlePoint="";let e=this.editor.currenDraw;if(this.editor.currenDraw){this.editor.addLineWallHelper(this.editor.currenDraw.startPoint,this.editor.currenDraw.endPoint),this.splitWallCommand=new $46f32ef2047263b6$export$6bf150a1b9f8c161(this.editor),this.spiltWall.push(this.editor.currenDraw);let e=this.spiltWall.slice(0),t=[];e.forEach(e=>{t.push(e.wallID)}),this.linkWall.forEach(i=>{0>t.indexOf(i.wallID)&&e.push(i)}),e.forEach(e=>{this.editor.currenDraw=e,this.splitWallCommand.splitMain()})}this.editor.currenDraw=e;let t="";this.editor.startChooseWall?(t=this.editor.startChooseWall[0].object,this.editor.currenDraw.wallID=t.wallID):t=this.moveCommandObj.oldMesh;let i=this.editor.currenDraw,r=0,o=(0,$9QhXH.DM).getWallJson(this.editor.allWalls),a=new $5XTH3.DrawWallTool;this.editor.allWalls=a.create2DWall(o),this.editor.allWalls.pop(),this.spiltOldWall.forEach(e=>{let t=this.editor.getWallByWallId(this.spiltWall[r].wallID),i=(0,$9HO6e.UtilCore).getNewPoint(t),o=(0,$9HO6e.UtilCore).getNewPoint(t,"end");this.editor.getAllWindowInWall(t).forEach(r=>{if(!r.center)return;let a=(0,$9HO6e.UtilCore).getNewPoint(e[0]),n=(0,$9HO6e.UtilCore).getNewPoint(e[0],"end"),s=1*(0,$9HO6e.UtilCore).toVector3(r.center).distanceTo((0,$9HO6e.UtilCore).toVector3(a)),l=1*(0,$9HO6e.UtilCore).toVector3(r.center).distanceTo((0,$9HO6e.UtilCore).toVector3(n)),h=s,c="start";s>l&&(h=l,c="end");let d=i.clone().add(t.endPoint.clone().sub(t.startPoint.clone()).setLength(h));if("end"==c&&(d=o.clone().add(t.startPoint.clone().sub(t.endPoint.clone()).setLength(h))),this.editor.currentDoor=r,this.editor.currenDraw=r,"circle"==t.isArc){let a=t.cp.distanceTo(t.arcCenter),n=r.center.clone().sub(e[0].arcCenter.clone()),s=t.arcCenter.clone().add(n.setLength(a));new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor,"door","end",[r,[s,i,o,t.arcCenter],"center"]).execute()}else new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor,"door","end",[r,[d,i,o],"center"]).execute();this.editor.doorHelperGroupClean(),this.editor.currentDoor=""}),r+=1}),this.editor.currenDraw=i,this.editor.currenDraw.wallID=t.wallID;let n=new $4xklQ.Vector3((t.startPoint.x+t.endPoint.x)/2,(t.startPoint.y+t.endPoint.y)/2),s=this.editor.getAllWindowInWall(t),l=0,h=0;if("circle"==t.isArc&&(l=this.editor.currenDraw.cp.distanceTo(this.editor.currenDraw.arcCenter),h=this.editor.currenDraw.arcCenter),s.length>0){let e=(0,$9HO6e.UtilCore).getNewPoint(this.editor.currenDraw),i=(0,$9HO6e.UtilCore).getNewPoint(this.editor.currenDraw,"end"),r=new $4xklQ.Vector3((e.x+i.x)/2,(e.y+i.y)/2,0).clone().sub(n.clone());s.forEach(o=>{if(!o.center)return;this.editor.currentDoor=o;let a=o.center.clone().add(r.clone());if(this.editor.currenDraw=o,"circle"==t.isArc){let r=o.center.clone().sub(t.arcCenter.clone()),a=h.clone().add(r.setLength(l));new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor,"door","end",[o,[a,e,i,h],"center"]).execute()}else new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor,"door","end",[o,[a,e,i],"center"]).execute();this.editor.doorHelperGroupClean(),this.editor.currentDoor=""})}this.editor.currenDraw&&(this.delCommonPoint(this.editor.currenDraw.startPoint.clone()),this.delCommonPoint(this.editor.currenDraw.endPoint.clone())),this.editor.currenDraw="";let c=this.editor.allWalls.slice(0);c.forEach(e=>{let t=(0,$9HO6e.UtilCore).getSamePositionWall(e,c);if(t.length>1){let i=t.pop();(0,$9HO6e.UtilCore).extendParamWall(e,i),t.forEach(e=>{this.editor.removeWall(e)})}(0,$9HO6e.UtilCore).isSameVector(e.startPoint,e.endPoint)&&this.editor.removeWall(e)}),new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).wallToJson();let d=[];this.editor.otherMeshs.forEach(e=>{let t=this.editor.getWallByWallId(e.wallId),i=!1;""==t&&(i=!0,this.editor.allWalls.forEach(t=>{(0,$9HO6e.UtilCore).pointInLine(e.center,(0,$9HO6e.UtilCore).handleLineData(t.startPoint,t.endPoint))&&(0,$9HO6e.UtilCore).pointIsInLine(e.center,t.startPoint,t.endPoint)&&(e.wallId=t.wallID,e.wallDep=t.thickness,e.wallStartPoint=t.startPoint,e.wallEndPoint=t.startPoint,i=!1)})),i&&d.push(e)}),d.forEach(e=>{this.editor.scene.remove(e),this.editor.otherMeshs.indexOf(e)>=0&&this.editor.otherMeshs.splice(this.editor.otherMeshs.indexOf(e),1)})}}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}delCommonPoint(e){let t=(0,$9HO6e.UtilCore).havePointWall(e,this.editor.allWalls);2==t.length&&(0,$9HO6e.UtilCore).wallIsInLine(t[0],t[1])&&(this.editor.pointHelperGroup.children.slice(0).forEach(e=>{("clickPoint"==e.useType||"moveOuterPoint"==e.useType)&&e.parent.remove(e)}),this.editor.margeWall(t[0],t[1]))}getNearPoint(e,t,i){let r=!!t&&(0,$9HO6e.UtilCore).handleLineData(t.startPoint,t.endPoint),o=!!i&&(0,$9HO6e.UtilCore).handleLineData(i.startPoint,i.endPoint),a="",n=0,s="",l=0;return this.editor.moveRule[7].forEach(t=>{if(t.uuid==e.uuid)return;let i=!!r&&(0,$9HO6e.UtilCore).pointInLine(t.startPoint,r),h=!!r&&(0,$9HO6e.UtilCore).pointInLine(t.endPoint,r),c=!!o&&(0,$9HO6e.UtilCore).pointInLine(t.startPoint,o),d=!!o&&(0,$9HO6e.UtilCore).pointInLine(t.endPoint,o);if(i||h||c||d){if(i||h){let i=t.startPoint;h&&(i=t.endPoint);let r=e.startPoint.clone().distanceTo(i);0==n?(a=i,n=r):r<n&&(a=i,n=r)}if(c||d){let i=t.startPoint;h&&(i=t.endPoint);let r=e.endPoint.clone().distanceTo(i);0==l?(s=i,l=r):r<l&&(s=i,l=r)}}}),[a,s,n,l]}moveCoreMain(e,t){let i=!1,r=t[0],o=t[1],a=t[2],n=t[3],s="",l="",h=(0,$9HO6e.UtilCore).handleLineData(e.startPoint,e.endPoint),c=(0,$9HO6e.UtilCore).moveLineToPoint(this.editor.currentPoint,h.slice(0)),d=this.getNearPoint(e,r,o),p="",u="";d[0]&&d[1]?d[2]>d[3]?(p=d[3],u=d[1]):(p=d[2],u=d[0]):(d[0]&&(p=d[2],u=d[0]),d[1]&&(p=d[3],u=d[1]));let m=this.editor.startChooseWall[0].object;if(m.uuid==e.uuid){let t=(0,$9HO6e.UtilCore).handleLineData(m.startPoint,m.endPoint);if((0,$9HO6e.UtilCore).getDistanceLine(t,c)<e.thickness)return}else if(e.cover){let t=e.cover.clone();if((0,$9HO6e.UtilCore).smallDistanceByPointOnLine(c,t).clone().distanceTo((0,$9HO6e.UtilCore).toVector3(t))<e.thickness)return}else""!=p&&p<e.thickness/2&&(c=(0,$9HO6e.UtilCore).moveLineToPoint(u,h.slice(0)),i=u);if(0==a.length){let t=this.handleLineData(h,e.startPoint),i=(0,$9HO6e.UtilCore).lineIsIntersection(c,t);i&&(s=i)}else if(1==a.length){let t=(0,$9HO6e.UtilCore).handleLineData(r.startPoint,r.endPoint),i=(0,$9HO6e.UtilCore).lineIsIntersection(c,t);if(i)s=i;else{let t=this.handleLineData(h,e.startPoint),i=(0,$9HO6e.UtilCore).lineIsIntersection(c,t);i&&(s=i)}}else{let e=(0,$9HO6e.UtilCore).handleLineData(r.startPoint,r.endPoint),t=(0,$9HO6e.UtilCore).lineIsIntersection(c,e);t&&(s=t)}if(0==n.length){let t=this.handleLineData(h,e.endPoint),i=(0,$9HO6e.UtilCore).lineIsIntersection(c,t);i&&(l=i)}else if(1==n.length){let t=(0,$9HO6e.UtilCore).handleLineData(o.startPoint,o.endPoint),i=(0,$9HO6e.UtilCore).lineIsIntersection(c,t);if(i)l=i;else{let t=this.handleLineData(h,e.endPoint),i=(0,$9HO6e.UtilCore).lineIsIntersection(c,t);i&&(l=i)}}else{let e=(0,$9HO6e.UtilCore).handleLineData(o.startPoint,o.endPoint),t=(0,$9HO6e.UtilCore).lineIsIntersection(c,e);t&&(l=t)}return s&&l&&!e.isArc&&(this.editor.allWalls.slice(0).forEach(e=>{"move"==e.status&&this.editor.removeWall(e)}),r&&this.repairWallNew(s,this.editor.moveRule[4],e,r,a,"start",this.editor.moveRule[6]),o&&this.repairWallNew(l,this.editor.moveRule[5],e,o,n,"end",this.editor.moveRule[6])),[s,l,i]}repairWallNew(e,t,i,r,o,a,n){let s="",l="",h=0;if(this.editor.moveRule[7].forEach(o=>{if((0,$9HO6e.UtilCore).checkSameWall(o,n))return;let a=(0,$9HO6e.UtilCore).checkWallContainPoint(e.x,e.y,o.startPoint.x,o.startPoint.y,o.endPoint.x,o.endPoint.y),c=(0,$9HO6e.UtilCore).checkWallContainPoint(o.startPoint.x,o.startPoint.y,e.x,e.y,t.x,t.y),d=(0,$9HO6e.UtilCore).checkWallContainPoint(o.endPoint.x,o.endPoint.y,e.x,e.y,t.x,t.y),p=(0,$9HO6e.UtilCore).handleLineData(r.startPoint,r.endPoint),u=(0,$9HO6e.UtilCore).handleLineData(o.startPoint,o.endPoint),m=(0,$9HO6e.UtilCore).lineIsIntersection(p,u);a&&!m&&(s=o);let g="";if(c&&(g=o.startPoint),d&&(g=o.endPoint),!g||(0,$9HO6e.UtilCore).isSameVector(g,e)||(0,$9HO6e.UtilCore).isSameVector(t,g)||o.uuid==i.uuid)return;let f=g.clone().distanceTo(e);0==h?(l=g,h=f):f<h&&(l=g)}),s)1==o.length?l?this.editor.removeWall(o[0]):this.repairWall(o[0],e,t):2==o.length&&this.mergeWall(o);else if(l){let t=(0,$9HO6e.UtilCore).havePointWall(l,this.editor.moveRule[7],i);if(2==o.length&&this.mergeWall(o),t.length>1)this.repairWall(i,e,l,"newWall");else{let t=(0,$9HO6e.UtilCore).havePointWall(l,this.editor.allWalls,i);this.repairWall(t[0],e,l)}}else 1!=o.length||(0,$9HO6e.UtilCore).wallIsInLine(n,r)?(2==o.length&&this.mergeWall(o),(0,$9HO6e.UtilCore).checkSameWallByPoint(r.startPoint,r.endPoint,e,t)||this.repairWall(i,e,t,"newWall")):this.repairWall(r,e,t)}getWallIntersection(e,t){if(e.isArc)return[1,1];let i=!1,r=e.startPoint,o=e.endPoint,a=(0,$9HO6e.UtilCore).handleLineData(r,o),n="",s="",l=(0,$9HO6e.UtilCore).moveLineToPoint(this.editor.currentPoint,a.slice(0));if(t[4]||t[5]){0!=t[0].length&&this.linkWall.push(...t[0]),0!=t[1].length&&this.linkWall.push(...t[1]);let n=t[0],s=t[2],h="start";if(t[5]&&(n=t[1],s=t[3],h="end"),t[4]&&t[5]){let i=(0,$9HO6e.UtilCore).isSameVector(e.startPoint,t[2]),r=(0,$9HO6e.UtilCore).isSameVector(e.endPoint,t[3]);r||i?r&&(n=t[0],s=t[2],h="start"):e.startPoint.clone().distanceTo(t[2].clone())<e.endPoint.clone().distanceTo(t[3].clone())?(n=t[0],s=t[2],h="start"):(n=t[1],s=t[3],h="end")}let c=s.clone().distanceTo((0,$9HO6e.UtilCore).toVector3(r));"end"==h&&(c=s.clone().distanceTo((0,$9HO6e.UtilCore).toVector3(o)));let d=this.editor.startChooseWall[0].object;if(d.wallID==e.wallID){let t=(0,$9HO6e.UtilCore).handleLineData(d.startPoint,d.endPoint);if((0,$9HO6e.UtilCore).getDistanceLine(t,l)<e.thickness)return}else if(e.cover){let t=e.cover.clone();if((0,$9HO6e.UtilCore).smallDistanceByPointOnLine(l,t).clone().distanceTo((0,$9HO6e.UtilCore).toVector3(t))<e.thickness)return}else 0!=c&&(l=(0,$9HO6e.UtilCore).moveLineToPoint(s,a.slice(0)),i=s)}if(0==t[0].length){let e=this.handleLineData(a,r),t=(0,$9HO6e.UtilCore).lineIsIntersection(l,e);t&&(n=t)}else if(1==t[0].length){let i=(0,$9HO6e.UtilCore).handleLineData(t[0][0].startPoint,t[0][0].endPoint),o=(0,$9HO6e.UtilCore).lineIsIntersection(l,i);if(o)n=o,(0,$9HO6e.UtilCore).checkHaveSameVertex(e,t[0][0])&&this.repairWall(t[0][0],n,t[2]);else{let i=this.handleLineData(a,r),o=(0,$9HO6e.UtilCore).lineIsIntersection(l,i);o&&(n=o,this.repairWall(e,t[2],n,"newWall"))}}else if(t[0].length>1){let i=(0,$9HO6e.UtilCore).getRealWallByIntersection(e,this.editor.currentPoint.clone(),t[0],t[2],"start");i=this.editor.moveRule[0];let o=(0,$9HO6e.UtilCore).handleLineData(i.startPoint,i.endPoint),s=(0,$9HO6e.UtilCore).lineIsIntersection(l,o);if(2==t[0].length&&this.mergeWall(t[0]),s&&(n=s),s)(0,$9HO6e.UtilCore).pointIsInLine(n,i.startPoint,i.endPoint)||this.repairWall(i,n,t[2],"noMarge");else{let i=this.handleLineData(a,r),o=(0,$9HO6e.UtilCore).lineIsIntersection(l,i);o&&(n=o,this.repairWall(e,t[2],n,"newWall"))}}if(0==t[1].length){let e=this.handleLineData(a,o),t=(0,$9HO6e.UtilCore).lineIsIntersection(l,e);t&&(s=t)}else if(1==t[1].length){let i=(0,$9HO6e.UtilCore).handleLineData(t[1][0].startPoint,t[1][0].endPoint),r=(0,$9HO6e.UtilCore).lineIsIntersection(l,i);if(r)s=r,(0,$9HO6e.UtilCore).checkHaveSameVertex(e,t[1][0])&&this.repairWall(t[1][0],s,t[3]);else{let i=this.handleLineData(a,o),r=(0,$9HO6e.UtilCore).lineIsIntersection(l,i);r&&(s=r,this.repairWall(e,t[3],s,"newWall"))}}else if(t[1].length>1){let i=(0,$9HO6e.UtilCore).getRealWallByIntersection(e,this.editor.currentPoint.clone(),t[1],t[3],"end");i=this.editor.moveRule[1];let r=(0,$9HO6e.UtilCore).handleLineData(i.startPoint,i.endPoint),n=(0,$9HO6e.UtilCore).lineIsIntersection(l,r);if(2==t[1].length&&this.mergeWall(t[1]),n&&(s=n),n)(0,$9HO6e.UtilCore).pointIsInLine(s,i.startPoint,i.endPoint)||this.repairWall(i,s,t[3],"noMarge");else{let i=this.handleLineData(a,o),r=(0,$9HO6e.UtilCore).lineIsIntersection(l,i);r&&(s=r,this.repairWall(e,t[3],s,"newWall"))}}return[n,s,i]}handleLineData(e,t){let i=e.slice(0);return"X"==e[0]?(i[0]="Y",i[2]=t.x):"Y"==e[0]?(i[0]="X",i[2]=t.y):(i[0]="XY",i[1]=-1/e[1],i[2]=t.y-i[1]*t.x),i}mergeWall(e){if(2!=e.length)return"";let t=(0,$9HO6e.UtilCore).handleLineData(e[0].startPoint,e[0].endPoint),i=(0,$9HO6e.UtilCore).handleLineData(e[1].startPoint,e[1].endPoint);if(Math.abs(t[1]-i[1])>.1||t[0]!=i[0])return;let r=e[0],o=e[1];if(""!=r&&""!=o){let e=(0,$9HO6e.UtilCore).isSameVector(r.startPoint,o.startPoint),t=(0,$9HO6e.UtilCore).isSameVector(r.startPoint,o.endPoint),i=(0,$9HO6e.UtilCore).isSameVector(r.endPoint,o.startPoint),a=(0,$9HO6e.UtilCore).isSameVector(r.endPoint,o.endPoint),n="",s="";e?(n=r.endPoint,s=o.endPoint):t?(n=r.endPoint,s=o.startPoint):i?(n=r.startPoint,s=o.endPoint):a&&(n=r.startPoint,s=o.startPoint),this.editor.removeWall(r),this.editor.removeWall(o),this.editor.allWalls.forEach(e=>{if("mergeWall"!=e.statusWall)return;let t=n,i=s,r=e.startPoint,o=e.endPoint,a=(0,$9HO6e.UtilCore).isSameVector(t,r)||(0,$9HO6e.UtilCore).isSameVector(t,o),l=(0,$9HO6e.UtilCore).isSameVector(i,r)||(0,$9HO6e.UtilCore).isSameVector(i,o);a&&l&&this.editor.removeWall(e)});let l=this.editor.addWall(n,s);return l.statusWall="mergeWall",l.status="move",l.style=r.style,l.height=r.height,l.thickness=r.thickness,l}return""}repairWall(e,t,i,r=""){let o=(0,$9HO6e.UtilCore).getMeshOtherPoint(e,i),a={oldMesh:this.editor.startChooseWall[0].object,currentMesh:"",center:t},n="";if("noMarge"==r){let e=240,r=i.clone().distanceTo(t.clone());if(i==t||r<=this.editor.centerArea)return;this.editor.allWalls.slice(0).forEach(r=>{let o=r.startPoint,a=r.endPoint;(0,$9HO6e.UtilCore).checkContainWall(i,t,o,a)&&(this.editor.removeWall(r),e=1*r.thickness)}),n=this.editor.addWall(i,t,e)}else if("newWall"==r)n=this.editor.addWall(i,t);else{if((0,$9HO6e.UtilCore).isSameVector(o,t))return;if(e.status="remove",this.editor.removeHelperByWall(e),e.isArc){let r=this.getArcOtherPoint(o,t,e,i);"bezier"==e.isArc&&(r=e.cp),(n=(0,$9HO6e.UtilCore).isSameVector(e.startPoint,i)?this.editor.addArcWall(t,o,r,e.isArc):this.editor.addArcWall(o,t,r,e.isArc)).wallID=e.wallID}else n=(0,$9HO6e.UtilCore).isSameVector(e.startPoint,i)?this.editor.addWall(t,o,1*e.thickness):this.editor.addWall(o,t,1*e.thickness);n.wallID=e.wallID}return""!=n&&(n.status="move",n.style=e.style,n.height=e.height,n.thickness=e.thickness,"newWall"!=r&&(this.spiltWall.push(n),this.spiltOldWall.push([e,e.startPoint,e.endPoint,o]))),a.currentMesh=n,this.sureMove&&this.repairCommandObj.push(a),n}getArcOtherPoint(e,t,i,r){let o=e.clone().distanceTo(i.arcCenter.clone()),a=new $4xklQ.Vector2((e.x+r.x)/2,(e.y+r.y)/2),n=new $4xklQ.Vector2((e.x+t.x)/2,(e.y+t.y)/2),s=e.clone().distanceTo(r.clone()),l=s/2/o,h=o*(e.clone().distanceTo(t.clone())/2)/(s/2),c=h*Math.sqrt(1-l*l),d=n.clone().add(i.arcCenter.clone().sub(a.clone()).setLength(c));return 1e-4>Math.abs(l-1)&&(d=n.clone()),d.clone().add(i.cp.clone().sub(i.arcCenter.clone()).setLength(h))}}var $9HO6e=parcelRequire("9HO6e");class $8b583e2b755b0fc3$export$12c0e9563e080ba5{constructor(e){this.editor=e,this.dis="",this.arr=[],this.oldWallArr=[]}moveVertexMain(e=!1){if("Mesh"==this.editor.currenDraw.type)return;let t=this.editor.currentDownSelect[0].object.parent.center,i=!1;if(this.editor.otherMeshs.forEach(e=>{if("UWindow"==e.modelType){let r=this.editor.getWallByWallId(e.wallId),o=e.leftWindow[0],a=e.rightWindow[0],n=(0,$9HO6e.UtilCore).isSameVector(r.startPoint,t)||(0,$9HO6e.UtilCore).isSameVector(r.endPoint,t),s=(0,$9HO6e.UtilCore).isSameVector(o.startPoint,t)||(0,$9HO6e.UtilCore).isSameVector(o.endPoint,t),l=(0,$9HO6e.UtilCore).isSameVector(a.startPoint,t)||(0,$9HO6e.UtilCore).isSameVector(a.endPoint,t);(n||s||l)&&(i=!0)}}),i)return;""!=this.editor.currenDraw&&this.editor.scene.remove(...this.editor.currenDraw),this.editor.currenDraw=[],0==this.editor.samePointWall.length&&(this.editor.samePointByDrag=t.clone(),this.editor.samePointWall=(0,$9HO6e.UtilCore).havePointWall(t,this.editor.allWalls));let r=this.editor.samePointByDrag.clone();this.editor.samePointWall.forEach(i=>{this.editor.removeHelperByWall(i);let o=(0,$9HO6e.UtilCore).isSameVector(r,i.endPoint),a=t,n=i.endPoint;o?(a=i.startPoint,n=t,e&&(i.endPoint=t)):e&&(i.startPoint=t);let s=new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).createLineWall(a,n,1*i.thickness);s.material.color=this.editor.getWallColor(s),s.wallID=i.wallID,this.editor.currenDraw.push(s),this.arr.push(s)}),this.editor.scene.add(...this.editor.currenDraw),this.editor.currentPoint=(0,$9HO6e.UtilCore).handleSpecialPoint(this.editor.currentPoint.clone(),this.editor.specialPointArr,this.editor),this.editor.currentDownSelect[0].object.parent.center.x=this.editor.currentPoint.x,this.editor.currentDownSelect[0].object.parent.center.y=this.editor.currentPoint.y}execute(){this.splitWallCommand=new $46f32ef2047263b6$export$6bf150a1b9f8c161(this.editor);let e=[];this.editor.samePointWall.forEach(t=>{let i=(0,$9HO6e.UtilCore).getNewPoint(t),r=(0,$9HO6e.UtilCore).getNewPoint(t,"end");e.push([t.wallID,i,r])}),this.moveVertexMain(!0),this.arr.forEach(e=>{let t=this.editor.getWallByWallId(e.wallID);this.editor.currenDraw=t,this.splitWallCommand.splitMain()}),new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).wallToJson("2D",[],"noHole"),this.arr.forEach(t=>{let i=this.editor.getWallByWallId(t.wallID),r=this.editor.getAllWindowInWall(i);r.length>0&&r.forEach(t=>{if(!t.center)return;this.editor.currentDoor=t;let r=this.getOldWall(t.wallId,e);if(!r){this.editor.currenDraw=t,new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor,"door","end",[t,[t.center,i,i],"wall"]).execute(),this.editor.doorHelperGroupClean(),this.editor.currentDoor="",this.editor.doorDistance="";return}let o=r[1],a=r[2],n=1*(0,$9HO6e.UtilCore).toVector3(t.center).distanceTo((0,$9HO6e.UtilCore).toVector3(o)),s=1*(0,$9HO6e.UtilCore).toVector3(t.center).distanceTo((0,$9HO6e.UtilCore).toVector3(a));""==this.editor.doorDistance&&(this.editor.doorDistance=n<s?[n,o,a,"start"]:[s,a,o,"end"]);let l=(0,$9HO6e.UtilCore).getNewPoint(i),h=(0,$9HO6e.UtilCore).getNewPoint(i,"end"),c=i.endPoint.clone().sub(i.startPoint.clone()),d=l.clone().add(c.setLength(this.editor.doorDistance[0]));"end"==this.editor.doorDistance[3]&&(c=i.startPoint.clone().sub(i.endPoint.clone()),d=h.clone().add(c.setLength(this.editor.doorDistance[0]))),this.editor.currenDraw=t,new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor,"door","end",[t,[d,i,i],"wall"]).execute(),this.editor.doorHelperGroupClean(),this.editor.currentDoor="",this.editor.doorDistance=""})}),new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).wallToJson(),this.editor.addIntersectPointHelper(),this.editor.currenDraw="",this.editor.doorDistance="",this.editor.samePointWall=[],this.editor.samePoint=""}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}getOldWall(e,t){let i="";return t.forEach(t=>{t[0]==e&&(i=t)}),i}}var $4xklQ=parcelRequire("4xklQ"),$9HO6e=parcelRequire("9HO6e");class $e25392babd100f13$export$203d609e8f23eda2{constructor(e,t){this.editor=e,this.tool=t,this.wallHelp=new $d0f874000594cf7a$export$a955f3d6a39ce4b2}drawMain(){let e=this.editor.currentDownSelect[0].object.parent.currentModel;this.editor.doorHelperGroupClean(),this.editor.cleanModelHelper(),""!=this.editor.currenDraw&&this.editor.scene.remove(this.editor.currenDraw),this.editor.scene.children.slice(0).forEach(e=>{"rotateTool"==e.useType&&this.editor.scene.remove(e)});let t="";if(e)t=e.parent,e.modelType&&e.modelType.indexOf("Model")>=0&&(t=e);else{t=this.editor.currentDownSelect[0].object.parent;let e=this.editor.currentDownSelect[0].object;(e=this.editor.getOuterParent(e)).modelType&&e.modelType.indexOf("Model")>=0&&(t=e)}if("rotateTool"==this.tool){let i=!1;this.editor.doorHelperGroup.children.forEach(e=>{if("rotateClock"==e.useType){i=!0;return}}),i||this.editor.doorHelperGroup.add(this.wallHelp.addRotateTool(e));let r=this.editor.currentDownSelect[0].object.parent;this.editor.currentDownSelect.length>0&&this.editor.pointHelperGroup.remove(r);let o=r.arcCenter,a=r.arcRadio,n=this.editor.currentPoint.clone().sub(o.clone());n.setLength(a);let s=o.clone().add(n),l=new $4xklQ.Vector3(o.x,o.y-a,0),h=l.clone().sub(o.clone()).angleTo(s.clone().sub(o.clone()));s.x<l.x&&(h=2*Math.PI-h);for(let e=0;e<9;e++)10>=Math.abs(45*e-180/Math.PI*h)&&(h=e*(Math.PI/4));let c=parseInt(180/Math.PI*h);this.editor.currenDraw=this.wallHelp.makeRotateToolGem(o,h-Math.PI/2-Math.PI/4,h-Math.PI/2+Math.PI/4,a,this.editor.config.angleToolChooseColor,100),this.editor.currenDraw.currentModel=e,this.editor.scene.add(this.editor.currenDraw),t.currentAngle=h,t.quaternion.copy(new(0,$4xklQ.Quaternion)().setFromAxisAngle(new $4xklQ.Vector3(0,0,1),h));let d=new $d0f874000594cf7a$export$a955f3d6a39ce4b2().createHelperForMumber(t);this.editor.pointHelperGroup.add(d[0]),c<0&&(c+=360),360==c&&(c=0);let p=this.editor.getScreenPosition(this.editor.currentPoint.clone());this.editor.list.blackBox.dispatch(p.x,p.y,c)}else if("moveTool"==this.tool){let e=this.editor.currentPoint.clone();if((0,$9HO6e.UtilCore).isSameVector(e,new $4xklQ.Vector3(0,0,0)))return;let i=this.editor.downPoint,r=new $4xklQ.Vector3;r.copy(e).sub(i),t.position.copy(r).add(this.editor._offsetStart);let o=new $d0f874000594cf7a$export$a955f3d6a39ce4b2().createHelperForMumber(t);this.editor.pointHelperGroup.add(...o)}else if("scaleTool"==this.tool){let i=["-XY","-X","-X-Y","Y","-Y","XY","X","X-Y"];e.updateMatrix();let r=new $d0f874000594cf7a$export$a955f3d6a39ce4b2().createHelperForMumber(t);this.editor.pointHelperGroup.add(r[0]);let o=this.scaleTool(t,i.indexOf(this.editor.currentDownSelect[0].object.scaleDir)+1,this.editor.currentPoint.clone());o.x>0&&o.y>0&&o.z>0&&this.applyScale(t,i.indexOf(this.editor.currentDownSelect[0].object.scaleDir)+1,o)}if(this.editor.synchroModel(t),this.editor.list.hiddenDialog.dispatch(),this.editor.clickDepthMsg.uuid){this.editor.modelDotGroup.children=[];let e=this.editor.getOuterParent(t,t,"outer"),i=e.param[0];this.editor.refreshRealSizeByBox(e,t),this.editor.updateModelPosition(t.parent,e),this.editor.addDashBoxFor2dGroup(e),this.editor.addDashBoxForGroup(i)}}execute(){""!=this.editor.currenDraw&&this.editor.scene.remove(this.editor.currenDraw);let e=this.editor.currentDownSelect[0].object.parent.currentModel;this.editor.currenDraw="";let t="";if(e)t=e.parent,e.modelType&&e.modelType.indexOf("Model")>=0&&(t=e);else{t=this.editor.currentDownSelect[0].object.parent;let e=this.editor.currentDownSelect[0].object;e.modelType&&e.modelType.indexOf("Model")>=0&&(t=e)}let i=this.editor.getOuterParent(t,t,"outer");"{}"==JSON.stringify(this.editor.clickDepthMsg)&&i&&i.uuid!=t.uuid&&(t=i),this.editor.addLineHelperForMember(t),this.editor.doorHelperGroup.children.forEach(e=>{if("rotateClock"==e.useType){this.editor.doorHelperGroup.remove(e);return}});let r=t;if(["beam","flue","pillars"].indexOf(r.modelType)>=0){let e=Math.round(180/Math.PI*r.rotation.z);e<0&&(e=360+e);let t=[Math.round(r.width*r.scale.x),Math.round(r.height*r.scale.y),Math.round(r.depth*r.scale.z),e,{isLock:r.isLock}],i=4;"flue"==r.modelType&&(i=5),"pillars"==r.modelType&&(i=6),this.editor.list.showDialog.dispatch(i,r.modelType,[],t)}else{if(!(e.modelType&&e.modelType.indexOf("Model")>=0))return;let i=this.editor.get3DModelBy2DModel(t);this.editor.updateModelProto(i)}}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}scaleTool(e,t,i){let r=new $4xklQ.Vector3(1,1,1);var o=e.matrix.clone();e.position.set(0,0,0),e.rotation.set(0,0,0);var a=new(0,$4xklQ.Box3)().setFromObject(e),n=(a.max.x-a.min.x)/2,s=(a.max.y-a.min.y)/2,l=(n**2+s**2)**.5;e.scale.set(1,1,1),e.updateMatrixWorld(!0),e.applyMatrix4(o);let h=i.clone();e.parent.worldToLocal(h);var c=h.clone().sub(e.position).length();if(-1!=[1,3,6,8].indexOf(t)){var d=(c+l)/(2*l);r.x=d,r.y=d}else -1!=[2,7].indexOf(t)?r.x=(c+n)/(2*n):r.y=(c+s)/(2*s);return r}applyScale(e,t,i){e.updateMatrix();var r=e.matrix.clone();e.position.set(0,0,0),e.rotation.set(0,0,0),e.scale.set(1,1,1),e.updateMatrixWorld(!0);var o=new(0,$4xklQ.Box3)().setFromObject(e),a=(o.max.x-o.min.x)/2,n=(o.max.y-o.min.y)/2;o.max.z,o.min.z;var s=0,l=0,h=0;switch(t){case 1:s=-a,l=n;break;case 2:s=-a;break;case 3:s=-a,l=-n;break;case 4:l=n;break;case 5:l=-n;break;case 6:s=a,l=n;break;case 7:s=a;break;case 8:s=a,l=-n}var c=new(0,$4xklQ.Matrix4)().makeTranslation(s,l,h),d=new(0,$4xklQ.Matrix4)().makeScale(i.x,i.y,1),p=new(0,$4xklQ.Matrix4)().makeTranslation(-s,-l,-h);d.multiply(c),p.multiply(d),r.multiply(p),e.applyMatrix4(r)}}class $41d8560ca8780b9e$export$95a0b96ed37a9fe3{constructor(e,t="scale"){this.editor=e,this.type=t}drawMain(){""!=this.editor.currenDraw&&this.editor.cleanScaleTool();let e=this.editor.currentPoint,t="";if("scale"==this.type){let i=this.editor.currentDownSelect[0].object.otherPosition,r=this.editor.currentDownSelect[0].object.positionType;t=i,"start"!=r?(e=i,t=this.editor.currentPoint,t=this.handlePoint(i,t)):e=this.handlePoint(i,e)}else{let i=this.editor.currentDownSelect[0].object.parent,r=this.editor.downPoint.clone(),o=this.editor.currentPoint,a=o.clone().sub(r.clone()).setLength(1*o.clone().distanceTo(r.clone()));e=i.startPoint.clone().add(a.clone()),t=i.endPoint.clone().add(a.clone())}this.editor.currenDraw=this.editor.allHelperForScaleTool(e,t)}execute(){this.drawMain(),this.editor.currenDraw=""}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}handlePoint(e,t){let i=80;return Math.abs(e.x-t.x)<=i&&(t.x=e.x),Math.abs(e.y-t.y)<=i&&(t.y=e.y),t}}class $349f250ecfb48a4c$export$c072eb4abd42caf{constructor(e){this.editor=e,this.wallCore=new $523a84362d27c3e8$export$b680ca477a72be07(e)}drawMain(){let e=this.editor.currentDownSelect[0].object.wall;this.editor.removeHelperByWall(e),e.cp=this.editor.currentPoint.clone();let t=e.startPoint,i=e.endPoint;""!=this.editor.currenDraw&&this.editor.scene.remove(this.editor.currenDraw),this.editor.currenDraw=this.wallCore.createCircleWall(t,i,this.editor.currentPoint,e.isArc),this.editor.scene.add(this.editor.currenDraw),this.editor.addBSRWallHelper(this.editor.currenDraw),this.editor.currenDraw.wallID=e.wallID}execute(){this.drawMain();let e=this.editor.allWalls.slice(0);e.forEach(e=>{e.wallID==this.editor.currenDraw.wallID&&(e.cp=this.editor.currentPoint)}),new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).wallToJson(),this.editor.addBSRWallHelper(this.editor.currenDraw);let t=this.editor.currentDownSelect[0].object.wall.wallID;(e=this.editor.allWalls.slice(0)).forEach(e=>{e.wallID==t&&(e.material.color=this.editor.chooseColor)}),this.editor.currenDraw=""}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}}var $9QhXH=parcelRequire("9QhXH"),$4xklQ=parcelRequire("4xklQ"),$9QhXH=parcelRequire("9QhXH"),$9HO6e=parcelRequire("9HO6e");class $cc13264a46e73685$export$c9cf1b7a5c1d69dd{constructor(e){this.editor=e}main(){""==this.editor.currenDraw&&(this.editor.doorHelperGroupClean(),this.editor.currenDraw=this.editor.currentDownSelect[0].object.parent);let e=this.editor.currenDraw.name,t=Math.round(this.editor.currenDraw.width*this.editor.currenDraw.scale.x),i=Math.round(this.editor.currenDraw.height*this.editor.currenDraw.scale.y),r=Math.round(this.editor.currenDraw.depth*this.editor.currenDraw.scale.z),o=this.editor.currentPoint.clone(),a=this.editor.allWalls.slice(0),n="",s=this.editor.currenDraw.rotation.z;this.editor.allWalls.forEach(e=>{let r=(0,$9HO6e.UtilCore).smallDistanceByPointOnLine((0,$9HO6e.UtilCore).handleLineData(e.startPoint,e.endPoint),o);if(!(0,$9HO6e.UtilCore).pointIsInLine(r,e.startPoint,e.endPoint))return;let a=r.clone().distanceTo((0,$9HO6e.UtilCore).toVector3(o));a<=e.thickness/2&&(n=e);let s=Math.min(t,i),l=e.thickness/2+s/2;a<=l&&(o=r.add((0,$9HO6e.UtilCore).toVector2(o).sub(r.clone()).setLength(l)))}),n||(this.editor.scene.remove(this.editor.currenDraw),this.editor.otherMember.indexOf(this.editor.currenDraw)>=0&&this.editor.otherMember.splice(this.editor.otherMember.indexOf(this.editor.currenDraw),1),"bridge"==e?this.editor.currenDraw=(0,$9QhXH.DM).createBeam(o,"beam",s,i,r,a,t):"flue"==e?(this.editor.currenDraw=(0,$9QhXH.DM).createFlue(o,t,i,0),this.editor.currenDraw.rotation.z=s):"post"==e&&(this.editor.currenDraw=(0,$9QhXH.DM).createBeam(o,"pillars",0,i,r,a,t),this.editor.currenDraw.rotation.z=s),this.editor.cleanModelHelper(),this.editor.switchHelperGroup("hidden"),this.editor.addLineHelperForMember(this.editor.currenDraw),this.editor.currenDraw.name=e,this.editor.scene.add(this.editor.currenDraw))}execute(){this.main(),this.editor.otherMember.push(this.editor.currenDraw),this.editor.addLineHelperForMember(this.editor.currenDraw),this.editor.currenDraw="",new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).wallToJson()}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}}class $a43a7063b14aae40$export$57f28e97ee2333c7{constructor(e){this.editor=e}main(){for(let e=0;e<this.editor.allWalls.length;e++){let t=this.editor.allWalls[e];if(t.children=[],!(this.editor.clickSelect.length>0)||this.editor.clickSelect[0].object!=t){if(t.isArc&&"bezier"==t.isArc){let e=this.editor.pointHelperGroup.children.slice(0),i=!1;e.some(e=>{if("bseControl"==e.useType)return i=!0,!0}),i||(t.material.color=this.editor.getWallColor(t))}else t.material.color=this.editor.getWallColor(t)}}let e=this.editor.pointHelperGroup.children.slice(0);for(let t=0;t<e.length;t++){let i=e[t];"moveOuterPoint"==i.useType&&this.editor.pointHelperGroup.remove(i),"rotateTool"==i.useType&&i.children.forEach(e=>{"Mesh"==e.type?e.material.color=this.editor.config.angleToolUnChooseColor:e.children[1].material.color=this.editor.config.angleToolUnChooseColor})}this.editor.modelHelperGroup.children.slice(0).forEach(e=>{"moveModelBox"==e.name&&e.parent.remove(e)});let t="";if(this.editor.currentMoveSelect.length>0){let e=this.editor.currentMoveSelect[0].object;if(t=e,e.parent&&e.parent.type&&"Group"==e.parent.type&&e.parent.children.forEach(e=>{("Line"==e.type||"Line2"==e.type||"DWHelper"==e.type)&&e.material.color.equals(this.editor.moveDoorOutColor)&&!e.material.color.equals(this.editor.clickColor)&&(e.material.color=this.editor.moveDoorColor)}),"CodeModel"==this.editor.getOuterParent(e).modelType){let t=this.editor.getOuterParent(e),i=new(0,$4xklQ.Box3)().setFromObject(t),r=this.editor.wallHelp.addOBBbox(t,"#00EEFF");if(r.name="moveModelBox",r.layers.set(2),"UWindowMesh"==t.type&&(r.position.y+=(i.max.y-i.min.y)/2),"LWindowMesh"==t.type){let e=new $4xklQ.Vector3;i.getCenter(e),r.position.copy(e.clone())}r.material.depthTest=!1,this.editor.modelHelperGroup.add(r);return}if("3dMember"==e.parent.name){let t=this.editor.wallHelp.addOBBbox(e,"#00EEFF");t.name="moveModelBox",t.layers.set(2),this.editor.modelHelperGroup.add(t);return}if("wall"==e.useType){if(this.editor.dom.style.cursor=(0,$9HO6e.UtilCore).getCursorByWall(e),!(this.editor.clickSelect.length>0&&this.editor.clickSelect[0].object==e)&&0==this.editor.currentDownSelect.length&&(e.material.color=this.editor.chooseColor,!e.isArc)){let t=e.startPoint.clone().distanceTo(e.endPoint)/this.editor.config.wallNum,i=e.geometry.attributes.position.array,r=new $4xklQ.Vector3(i[0],i[1],i[2]);new $4xklQ.Vector3(i[3],i[4],i[5]);let o=new $4xklQ.Vector3(i[6],i[7],i[8]),a=new $4xklQ.Vector3(i[9],i[10],i[11]);new $4xklQ.Vector3(i[12],i[13],i[14]);let n=new $4xklQ.Vector3(i[15],i[16],i[17]),s=(0,$9HO6e.UtilCore).toVector3(e.endPoint).sub((0,$9HO6e.UtilCore).toVector3(e.startPoint)),l=(0,$9HO6e.UtilCore).toVector3(e.startPoint).add(s.setLength(t)),h=(0,$9HO6e.UtilCore).toVector3(e.startPoint).add(s.setLength(t*(this.editor.config.wallNum-1))),c=new $4xklQ.Vector3(-s.y,s.x,0),d=l.clone().add(c.setLength(e.thickness/2)),p=l.clone().add(c.setLength(e.thickness/2).negate()),u=h.clone().add(c.setLength(e.thickness/2)),m=h.clone().add(c.setLength(e.thickness/2).negate()),g=this.editor.wallHelp.createSplitWallMesh([r,o,d,p],this.editor.config.wallFirstMaterial),f=this.editor.wallHelp.createSplitWallMesh([u,m,n,a],this.editor.config.wallFirstMaterial);e.add(g,f)}}else if("movePoint"==e.useType){let t=e.positionCenter;this.editor.pointHelperGroup.add(new $d0f874000594cf7a$export$a955f3d6a39ce4b2().createDoorOuterPoint(t))}else if("dragPoint"==e.useType){let t=e.parent.center;this.editor.pointHelperGroup.add(new $d0f874000594cf7a$export$a955f3d6a39ce4b2().createDoorOuterPoint(t,2*e.parent.radio,"rgb(26, 122, 251)")),this.editor.dom.style.cursor="move"}else if("rotateTool"==e.useType)e.parent.children.forEach(e=>{"Mesh"==e.type?e.material.color=this.editor.config.angleToolChooseColor:e.children[1].material.color=this.editor.config.angleToolChooseColor});else if("scalePoint"==e.useType)this.editor.dom.style.cursor=(0,$9HO6e.UtilCore).getCursorByScaleTool(e.linePoint[0],e.linePoint[1]);else if("scaleRuleTool"==e.useType){let t=e.positionCenter;this.editor.pointHelperGroup.add(new $d0f874000594cf7a$export$a955f3d6a39ce4b2().createDoorOuterPoint(t,100,"rgb(26, 122, 251)"))}else if("bseControl"==e.useType)this.editor.dom.style.cursor="move";else if("floor"==e.useType)for(let t=0;t<e.allPoints.length;t++){let i=e.allPoints[t],r=e.allPoints[0];t!=e.allPoints.length-1&&(r=e.allPoints[t+1]);let o=(0,$9QhXH.DM).createLine([i,r],"#00EEFF",!1,2.5);o.useType="splitOuterLine",this.editor.splitRoomLineGroup.add(o)}}if(this.editor.mouseCoverObj&&(t=this.editor.mouseCoverObj),t){let e=this.editor.getOuterParent(t);if(this.editor.mouseCoverObj&&(e=this.editor.mouseCoverObj),e&&!e.visible)return;let i=[];this.editor.selectObjArr.forEach(e=>{let t=this.editor.getOuterParent(e);i.push(t.uuid)});let r=0>i.indexOf(e.uuid);if(("3DModel"==e.modelType||"modelGroup"==e.modelType)&&r){let t=[e];"modelGroup"==e.modelType&&(t=t.concat(e.children.slice(0))),t.forEach(e=>{let t=this.editor.wallHelp.addOBBbox(e,"#00EEFF");t.name="moveModelBox",t.layers.set(2),this.editor.modelHelperGroup.add(t);let i=this.editor.wallHelp.addOBB2DBox(t,"#00EEFF");i.name="moveModelBox",this.editor.modelHelperGroup.add(i)})}else if(("2DModel"==e.modelType||"2dModelGroup"==e.modelType)&&r){let t=[e];"2dModelGroup"==e.modelType&&(t=t.concat(e.children.slice(0))),t.forEach(e=>{let t=this.editor.wallHelp.addOBBbox(e.param[0],"#00EEFF");t.name="moveModelBox",t.layers.set(2),this.editor.modelHelperGroup.add(t);let i=this.editor.wallHelp.addOBB2DBox(t,"#00EEFF");i.name="moveModelBox",this.editor.modelHelperGroup.add(i)})}}if(this.editor.currentDownSelect.length>0){if(this.editor.currentDownSelect[0].object.parent&&"CodeModel"==this.editor.currentDownSelect[0].object.parent.modelType)return;let e=this.editor.currentDownSelect[0].object.useType;if("wall"==e)new $671a9ada1efb021a$export$ad57cb3fe2de1d52(this.editor).moveWallMain();else if("dragPoint"==e)new $8b583e2b755b0fc3$export$12c0e9563e080ba5(this.editor).moveVertexMain();else if("rotateTool"==e)new $e25392babd100f13$export$203d609e8f23eda2(this.editor,"rotateTool").drawMain();else if("scalePoint"==e)new $e25392babd100f13$export$203d609e8f23eda2(this.editor,"scaleTool").drawMain();else if("scaleRuleTool"==e)new $41d8560ca8780b9e$export$95a0b96ed37a9fe3(this.editor).drawMain();else if("scaleHelpTool"==e)new $41d8560ca8780b9e$export$95a0b96ed37a9fe3(this.editor,"move").drawMain();else if("bseControl"==e)new $349f250ecfb48a4c$export$c072eb4abd42caf(this.editor).drawMain(this.editor.currentDownSelect[0].object.wall);else if(this.editor.dom.style.cursor="move","movePoint"==this.editor.currentDownSelect[0].object.useType)new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor,"door",this.editor.currentDownSelect[0].object.positionType).drawMain();else{let e=["beam","flue","pillars"],t=this.editor.currentDownSelect[0].object;if(e.indexOf(this.editor.currentDownSelect[0].object.parent.modelType)>=0||t.modelType&&t.modelType.indexOf("Model")>=0){let i=!1;if(i=e.indexOf(this.editor.currentDownSelect[0].object.parent.modelType)>=0?this.editor.currentDownSelect[0].object.parent.isLock:this.editor.getOuterParent(t).isLock){let e=this.editor.getScreenPosition(this.editor.currentPoint.clone());this.editor.list.blackBox.dispatch(e.x,e.y,"该模型已锁定,请先解锁")}else{let i=!1;if(this.editor.pointHelperGroup.children.forEach(e=>{("rotateTool"==e.useType||"scaleTool"==e.useType)&&(i=!0)}),i){let i=this.editor.getOuterParent(t);i&&i.modelType&&(i.modelType.indexOf("Model")>=0||i.modelType.indexOf("model")>=0)?this.editor.mouseCoverObj=i:e.indexOf(this.editor.currentDownSelect[0].object.parent.modelType)>=0?new $cc13264a46e73685$export$c9cf1b7a5c1d69dd(this.editor).main():new $e25392babd100f13$export$203d609e8f23eda2(this.editor,"moveTool").drawMain()}}}else{let e=this.editor.getOuterParent(t);if(e&&e.modelType&&(e.modelType.indexOf("Model")>=0||e.modelType.indexOf("model")>=0)){let t=e.isLock;if(!e.visible)return;if(t){let e=this.editor.getScreenPosition(this.editor.currentPoint.clone());this.editor.list.blackBox.dispatch(e.x,e.y,"该模型已锁定,请先解锁")}else if(this.editor.mouseCoverObj=e,!this.editor.controlsArr[1].enableRotate){this.editor.modelHelperGroup.children=[],this.editor.list.hiddenDialog.dispatch();let t=this.editor.wallHelp.addOBBbox(e,"#00EEFF");t.name="moveModelBox",t.layers.set(2),this.editor.modelHelperGroup.add(t),this.editor.doorHelperGroupClean(),this.editor.addLineHelperForMember(e.param[0])}}else if(this.editor.currentDownSelect[0].object.parent.isLock){let e=this.editor.getScreenPosition(this.editor.currentPoint.clone());this.editor.list.blackBox.dispatch(e.x,e.y,"该模型已锁定,请先解锁")}else new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor,"door").drawMain()}}}""==this.editor.mouseCoverObj||(this.editor.controlsArr[1].enableRotate||this.editor.camera.isOrthographicCamera)&&!this.editor.camera.isOrthographicCamera||new $c338f49977b1ce90$export$4eacab61b79af859(this.editor).main()}}parcelRequire("9HO6e");var $9HO6e=parcelRequire("9HO6e"),$4xklQ=parcelRequire("4xklQ"),$9QhXH=parcelRequire("9QhXH");class $6f108bd13133889a$export$66788100995c7b02{constructor(e,t=[],i=!0){this.editor=e,this.type=this.editor.toolType,this.param=t,this.redrew=i}drawMain(){let e=0,t=800;""!=this.editor.currenDraw&&(t=this.editor.currenDraw.width?this.editor.currenDraw.width:this.editor.currenDraw.realWidth,e=this.editor.currenDraw.angle,this.editor.scene.remove(this.editor.currenDraw),this.editor.otherMember.indexOf(this.editor.currenDraw)>=0&&this.editor.otherMember.splice(this.editor.otherMember.indexOf(this.editor.currenDraw),1)),this.editor.currentMoveSelect.forEach(t=>{let i=t.object;if(i.useType&&"wall"==i.useType){e=new(0,$4xklQ.Vector2)(i.endPoint.x,i.endPoint.y).sub(new $4xklQ.Vector2(i.startPoint.x,i.startPoint.y)).angle();return}});let i=this.type,r=this.editor.currentPoint,o=400,a=this.editor.allWalls.slice(0);if(("post"==i||"flue"==i)&&(o=650,t=650),this.editor.copyDoor&&(t=Math.round(this.editor.copyDoor.width*this.editor.copyDoor.scale.x),o=Math.round(this.editor.copyDoor.height*this.editor.copyDoor.scale.y),e=this.editor.copyDoor.rotation.z),0!=this.param.length){let n=this.editor.clickSelect[0].object.parent;t=n.width,o=n.height,r=n.center,i=this.param[2],e=n.angle,a=!1,"width"==this.param[0]&&(t=this.param[1]),"height"==this.param[0]&&(o=this.param[1])}else"bridge"!=i&&this.editor.allWalls.forEach(i=>{let a=(0,$9HO6e.UtilCore).smallDistanceByPointOnLine((0,$9HO6e.UtilCore).handleLineData(i.startPoint,i.endPoint),r);if(!(0,$9HO6e.UtilCore).pointIsInLine(a,i.startPoint,i.endPoint))return;let n=a.clone().distanceTo((0,$9HO6e.UtilCore).toVector3(r)),s=Math.min(t,o),l=i.thickness/2+s/2;n<=l&&(e=i.endPoint.clone().sub(i.startPoint.clone()).angle(),r=a.add((0,$9HO6e.UtilCore).toVector2(r).sub(a.clone()).setLength(l)))});"bridge"==i?this.editor.currenDraw=(0,$9QhXH.DM).createBeam(r,"beam",e,o,400,a,t):"flue"==i?(this.editor.currenDraw=(0,$9QhXH.DM).createFlue(r,t,o,0),this.editor.currenDraw.rotation.z=e):"post"==i&&(this.editor.currenDraw=(0,$9QhXH.DM).createBeam(r,"pillars",0,o,window.storeyHei,a,t),this.editor.currenDraw.rotation.z=e),this.editor.currenDraw.name=i,this.editor.scene.add(this.editor.currenDraw),this.editor.cleanModelHelper(),this.editor.switchHelperGroup("hidden"),this.editor.addPositionHelper(this.editor.currenDraw),this.param.length>0&&(this.editor.clickSelect[0].object.parent=this.editor.currenDraw,this.editor.currenDraw.position.copy(this.param[3]),this.editor.currenDraw.rotation.copy(this.param[4]),"rotation"==this.param[0]&&(this.editor.currenDraw.rotation.z=Math.PI/180*this.param[1]))}execute(){this.drawMain(),this.editor.otherMember.push(this.editor.currenDraw),this.editor.currenDraw="",this.redrew&&new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).wallToJson(),this.param.length>0&&(this.editor.doorHelperGroupClean(),this.editor.addLineHelperForMember(this.editor.clickSelect[0].object.parent))}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}}class $5002053a529f5520$export$e0cf849ef0f13f5d{constructor(e,t){this.editor=e,this.useType=t}main(){switch(this.editor.toolType){case"wall":"moveDraw"==this.useType?(this.editor.list.stopPlayer.dispatch(),new $4e6d6bcbeea35653$export$e5e2c7c57f7de029(this.editor).drawMain()):(this.editor.list.startPlayer.dispatch(),this.editor.execute(new $4e6d6bcbeea35653$export$e5e2c7c57f7de029(this.editor),"画墙"));break;case"room":"moveDraw"==this.useType?(this.editor.list.stopPlayer.dispatch(),new $fff7b0667b4b396b$export$912fb411e26e3541(this.editor).drawMain()):(this.editor.list.startPlayer.dispatch(),this.editor.execute(new $fff7b0667b4b396b$export$912fb411e26e3541(this.editor),"画墙"));break;case"splitTool":"moveDraw"==this.useType?(this.editor.list.stopPlayer.dispatch(),new $b11833ee6970dca8$export$5be3661e3be4a62a(this.editor).drawMain()):(this.editor.list.startPlayer.dispatch(),this.editor.execute(new $b11833ee6970dca8$export$5be3661e3be4a62a(this.editor),"分割"));break;case"slidingdoor":case"doubledoor":case"window":case"baywindow":case"pass":case"frenchwindows":case"singledoor":case"singleDoubleDoor":case"childMotherDoor":case"moveDoor":case"straightWindow":case"straightBayWindow":case"UWindow":case"UBayWindow":case"UBayWindow":case"dooropen":case"archDoor":case"archWindow":case"arcDoor":case"arcWindow":case"LWindow":case"LBayWindow":case"UWindow":case"UBayWindow":case"door":"moveDraw"==this.useType?(this.editor.list.stopPlayer.dispatch(),new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor).drawMain()):(this.editor.list.startPlayer.dispatch(),this.editor.execute(new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor),"画门"));break;case"bridge":case"flue":case"post":"moveDraw"==this.useType?(this.editor.list.stopPlayer.dispatch(),new $6f108bd13133889a$export$66788100995c7b02(this.editor).drawMain()):(this.editor.list.startPlayer.dispatch(),this.editor.execute(new $6f108bd13133889a$export$66788100995c7b02(this.editor),"画梁"));break;case"free":if(""!=this.editor.currentDownSelect&&"moveMesh"==this.useType){if(10>this.editor.currentPoint.clone().distanceTo(this.editor.downPoint.clone()))return;let e=this.editor.currentDownSelect[0].object.useType;if("wall"==e)this.editor.execute(new $671a9ada1efb021a$export$ad57cb3fe2de1d52(this.editor),"移动墙");else if("rotateTool"==e||"scaleTool"==e)this.editor.execute(new $e25392babd100f13$export$203d609e8f23eda2(this.editor),"旋转工具");else if("dragPoint"==e)this.editor.execute(new $8b583e2b755b0fc3$export$12c0e9563e080ba5(this.editor),"拖拽点");else if("scaleRuleTool"==e)this.editor.execute(new $41d8560ca8780b9e$export$95a0b96ed37a9fe3(this.editor),"比例尺");else if("scaleHelpTool"==e)this.editor.execute(new $41d8560ca8780b9e$export$95a0b96ed37a9fe3(this.editor,"move"),"比例尺");else if("bseControl"==e)this.editor.execute(new $349f250ecfb48a4c$export$c072eb4abd42caf(this.editor),"贝塞尔移动");else if("movePoint"==this.editor.currentDownSelect[0].object.useType)this.editor.execute(new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor),"移动窗");else{let e=["beam","flue","pillars"],t=this.editor.currentDownSelect[0].object,i=e.indexOf(this.editor.currentDownSelect[0].object.parent.modelType)>=0||t.modelType&&t.modelType.indexOf("Model")>=0;if(this.editor.currentDownSelect[0].object.parent&&this.editor.currentDownSelect[0].object.parent.isLock)this.editor.doorHelperGroupClean();else if(i){let i=!1;(i=e.indexOf(this.editor.currentDownSelect[0].object.parent.modelType)>=0?this.editor.currentDownSelect[0].object.parent.isLock:this.editor.getOuterParent(t).isLock)||(e.indexOf(this.editor.currentDownSelect[0].object.parent.modelType)>=0?this.editor.execute(new $cc13264a46e73685$export$c9cf1b7a5c1d69dd(this.editor),"移动"):0!=this.editor.clickSelect.length&&this.editor.execute(new $e25392babd100f13$export$203d609e8f23eda2(this.editor),"移动"))}else this.editor.execute(new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor),"移动窗")}}else new $a43a7063b14aae40$export$57f28e97ee2333c7(this.editor).main()}}}var $3BPdS=parcelRequire("3BPdS"),$4xklQ=parcelRequire("4xklQ"),$9QhXH=parcelRequire("9QhXH"),$hrM0U=parcelRequire("hrM0U");class $ca3cc62cb04c2488$export$9a58ef0d7ad3278c{constructor(){this.thickness=240,this.height=window.storeyHei,this.bufferMeter=10,this.flat=!1,this.doorWidth=800,this.balconyWidth=1300,this.cornerWindowWidth=500,this.sitRoomWidthMin=4e3+this.thickness,this.sitRoomWidthMax=6e3+this.thickness,this.sitRoomHeightMin=3600+this.thickness,this.sitRoomHeightMax=4200+this.thickness,this.history=[],this.reset()}reset(){this.jsonArr=[],this.shape=[],this.doorArr=[],this.holeArr=[]}getHome(e=0,t=0,i=1){let r=0;0==e&&(t=(e=this.getRandom(1,3))>2?this.getRandom(1,2):1,i=e>2?this.getRandom(1,2):1,2==e&&(r=this.getRandom(0,1)),3==e&&(r=1)),this.room=e,this.hall=t,this.toilet=i,console.log(e+" 室 "+t+" 厅 1 厨 "+i+" 卫 "+r+" 过道"),this.createSittingRoom(),t>1&&this.createDiningRoom(),this.createKitchen(t),this.createToilet(t),this.flat=!0,e>1&&this.createSecondBedroom(),this.createMasterBedroom(e),e>2&&this.createStudy(),this.createBalcony("A");let o=this.handleSegment();o=this.getHoleData(o);let a=[this.masterC,this.sitRoomCenter,this.kitchenCenter,this.toiletC];return e>1&&a.push(this.secondBC),t>1&&a.push(this.diningRoomCenter),[o,this.doorArr,this.holeArr,a]}getHoleData(e){let t=1e3;console.log("获取门窗开洞数据");for(let i=0;i<e.length;i++){e[i].id=t++;let r=new $4xklQ.Vector2(e[i].start.x,e[i].start.y),o=new $4xklQ.Vector2(e[i].end.x,e[i].end.y),a=r.distanceTo(o),n=r.clone().add(o).divideScalar(2);if(Math.abs(n.x)<=this.sitRoomW/2&&Math.abs(n.y)<=this.sitRoomH/2)-1!=[0,1,4,5].indexOf(this.masterP)?(0==this.masterP&&n.y==this.masterC.y-this.masterH/2&&n.x-this.masterC.x==a/2+this.masterW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("entry door",t-1)),5==this.masterP&&n.y==this.masterC.y+this.masterH/2&&n.x-this.masterC.x==a/2+this.masterW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("entry door",t-1)),1==this.masterP&&n.y==this.masterC.y-this.masterH/2&&this.masterC.x-n.x==a/2+this.masterW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("entry door",t-1)),4==this.masterP&&n.y==this.masterC.y+this.masterH/2&&n.x-this.masterC.x==a/2+this.masterW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("entry door",t-1))):(2==this.masterP&&n.x==this.masterC.x-this.masterW/2&&this.masterC.y-n.y==a/2+this.masterH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("entry door",t-1)),7==this.masterP&&n.x==this.masterC.x+this.masterW/2&&this.masterC.y-n.y==a/2+this.masterH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("entry door",t-1)),3==this.masterP&&n.x==this.masterC.x-this.masterW/2&&n.y-this.masterC.y==a/2+this.masterH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("entry door",t-1)),6==this.masterP&&n.x==this.masterC.x+this.masterW/2&&n.y-this.masterC.y==a/2+this.masterH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("entry door",t-1))),-1!=[0,1,4,5].indexOf(this.balconyAP)?n.x==this.balconyAC.x&&Math.abs(n.y-this.balconyAC.y)==this.balconyAH/2&&(this.fillHoleData("slidingDoor",e[i],this.balconyAW-800,2e3),this.setDWId("slidingDoor",t-1)):n.y==this.balconyAC.y&&Math.abs(n.x-this.balconyAC.x)==this.balconyAW/2&&(this.fillHoleData("slidingDoor",e[i],this.balconyAH-800,2e3),this.setDWId("slidingDoor",t-1)),-1!=[0,1,4,5].indexOf(this.kitchenP)?(n.x==this.kitchenCenter.x&&((0==this.kitchenP||1==this.kitchenP)&&this.kitchenCenter.y-n.y==this.kitchenH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("kitchen door",t-1)),(4==this.kitchenP||5==this.kitchenP)&&n.y-this.kitchenCenter.y==this.kitchenH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("kitchen door",t-1))),Math.abs(n.x-this.toiletC.x)<this.toiletW/2&&Math.abs(n.y-this.toiletC.y)==this.toiletH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("toilet door",t-1))):(n.y==this.kitchenCenter.y&&((2==this.kitchenP||3==this.kitchenP)&&this.kitchenCenter.x-n.x==this.kitchenW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("kitchen door",t-1)),(6==this.kitchenP||7==this.kitchenP)&&n.x-this.kitchenCenter.x==this.kitchenW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("kitchen door",t-1))),Math.abs(n.y-this.toiletC.y)<this.toiletH/2&&Math.abs(n.x-this.toiletC.x)==this.toiletW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("toilet door",t-1))),(this.secondBP||0==this.secondBP)&&(-1!=[0,1,4,5].indexOf(this.secondBP)?(n.x==this.secondBC.x&&Math.abs(n.y-this.secondBC.y)==this.secondBH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("secondBD door",t-1)),3==this.room&&Math.abs(n.x-this.secondBC.x)>this.secondBW/2&&Math.abs(n.y-this.secondBC.y)==this.secondBH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("study door",t-1))):(n.y==this.secondBC.y&&Math.abs(n.x-this.secondBC.x)==this.secondBW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("secondBD door",t-1)),3==this.room&&Math.abs(n.y-this.secondBC.y)>this.secondBH/2&&Math.abs(n.x-this.secondBC.x)==this.secondBW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("study door",t-1)))),-1!=[0,1,4,5].indexOf(this.masterP)?n.x==this.masterC.x&&Math.abs(n.y-this.masterC.y)==this.masterH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("masterBD door",t-1)):n.y==this.masterC.y&&Math.abs(n.x-this.masterC.x)==this.masterW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("masterBD door",t-1));else{this.diningRoomP&&((0==this.kitchenP||1==this.kitchenP)&&n.x==this.toiletC.x&&this.toiletC.y-n.y==this.toiletH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("toilet door",t-1)),(2==this.kitchenP||3==this.kitchenP)&&n.y==this.toiletC.y&&this.toiletC.x-n.x==this.toiletW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("toilet door",t-1)),(4==this.kitchenP||5==this.kitchenP)&&n.x==this.toiletC.x&&n.y-this.toiletC.y==this.toiletH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("toilet door",t-1)),(6==this.kitchenP||7==this.kitchenP)&&n.y==this.toiletC.y&&n.x-this.toiletC.x==this.toiletW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("toilet door",t-1))),500==Math.abs(Math.abs(n.y-this.masterC.y)-this.masterH/2)&&(this.fillHoleData("baseWindow",e[i],a-240,2100),-1!=[1,2,5,6].indexOf(this.masterP)?this.setDWId("CW1",t-1):this.setDWId("CW2",t-1)),500==Math.abs(Math.abs(n.x-this.masterC.x)-this.masterW/2)&&(this.fillHoleData("baseWindow",e[i],a-240,2100),-1!=[3,4,7,0].indexOf(this.masterP)?this.setDWId("CW1",t-1):this.setDWId("CW2",t-1)),-1!=[0,1,4,5].indexOf(this.secondBP)?((0==this.secondBP||1==this.secondBP)&&n.y-this.secondBC.y==this.secondBH/2&&(n.x==this.secondBC.x?(this.fillHoleData("baseWindow",e[i],a-600,2100),this.setDWId("secondBD window",t-1)):3==this.room&&this.fillHoleData("panoramicWindow",e[i],a-230,2100,new $4xklQ.Vector2(n.x,n.y+250))),(4==this.secondBP||5==this.secondBP)&&this.secondBC.y-n.y==this.secondBH/2&&(n.x==this.secondBC.x?(this.fillHoleData("baseWindow",e[i],a-600,2100),this.setDWId("secondBD window",t-1)):3==this.room&&this.fillHoleData("panoramicWindow",e[i],a-230,2100,new $4xklQ.Vector2(n.x,n.y-250)))):((2==this.secondBP||3==this.secondBP)&&n.x-this.secondBC.x==this.secondBW/2&&(n.y==this.secondBC.y?(this.fillHoleData("baseWindow",e[i],a-600,2100),this.setDWId("secondBD window",t-1)):3==this.room&&(this.fillHoleData("panoramicWindow",e[i],a-230,2100,new $4xklQ.Vector2(n.x+250,n.y)),this.setDWId("study pw",t-1))),(6==this.secondBP||7==this.secondBP)&&this.secondBC.x-n.x==this.secondBW/2&&(n.y==this.secondBC.y?(this.fillHoleData("baseWindow",e[i],a-600,2100),this.setDWId("secondBD window",t-1)):3==this.room&&(this.fillHoleData("panoramicWindow",e[i],a-230,2100,new $4xklQ.Vector2(n.x-250,n.y)),this.setDWId("study pw",t-1)))),-1!=[0,1,4,5].indexOf(this.kitchenP)?(n.x==this.kitchenCenter.x&&((0==this.kitchenP||1==this.kitchenP)&&n.y-this.kitchenCenter.y==this.kitchenH/2&&(this.fillHoleData("baseWindow",e[i],a-600,2100),this.setDWId("kitchen window",t-1)),(4==this.kitchenP||5==this.kitchenP)&&this.kitchenCenter.y-n.y==this.kitchenH/2&&(this.fillHoleData("baseWindow",e[i],a-600,2100),this.setDWId("kitchen window",t-1))),n.x==this.toiletC.x&&((0==this.kitchenP||1==this.kitchenP)&&n.y-this.toiletC.y==this.toiletH/2&&(this.fillHoleData("baseWindow",e[i],a-600,2100),this.setDWId("toilet window",t-1)),(4==this.kitchenP||5==this.kitchenP)&&this.toiletC.y-n.y==this.toiletH/2&&(this.fillHoleData("baseWindow",e[i],a-600,2100),this.setDWId("toilet window",t-1)))):(n.y==this.kitchenCenter.y&&((2==this.kitchenP||3==this.kitchenP)&&n.x-this.kitchenCenter.x==this.kitchenW/2&&(this.fillHoleData("baseWindow",e[i],a-600,2100),this.setDWId("kitchen window",t-1)),(6==this.kitchenP||7==this.kitchenP)&&this.kitchenCenter.x-n.x==this.kitchenW/2&&(this.fillHoleData("baseWindow",e[i],a-600,2100),this.setDWId("kitchen window",t-1))),n.y==this.toiletC.y&&((2==this.kitchenP||3==this.kitchenP)&&n.x-this.toiletC.x==this.toiletW/2&&(this.fillHoleData("baseWindow",e[i],a-600,2100),this.setDWId("toilet window",t-1)),(6==this.kitchenP||7==this.kitchenP)&&this.toiletC.x-n.x==this.toiletW/2&&(this.fillHoleData("baseWindow",e[i],a-600,2100),this.setDWId("toilet window",t-1))));let r=a>1200?1200:a;-1!=[0,1,4,5].indexOf(this.balconyAP)?((0==this.balconyAP||1==this.balconyAP)&&(n.y>=this.balconyAC.y&&n.y-this.balconyAC.y<this.balconyAH/2&&Math.abs(this.balconyAC.x-n.x)==this.balconyAW/2&&(r<1200?this.fillHoleData("uwl",e[i],r,2100):this.fillHoleData("uwl",e[i],r,2100,new $4xklQ.Vector2(n.x,n.y+a/2-480))),n.x==this.balconyAC.x&&n.y-this.balconyAC.y==this.balconyAH/2&&(this.fillHoleData("uWindow",e[i],a+240,2100,new $4xklQ.Vector2(n.x,n.y-480)),this.setDWId("uw",t-1))),(4==this.balconyAP||5==this.balconyAP)&&(n.y<=this.balconyAC.y&&this.balconyAC.y-n.y<this.balconyAH/2&&Math.abs(this.balconyAC.x-n.x)==this.balconyAW/2&&(r<1200?this.fillHoleData("uwl",e[i],r,2100):this.fillHoleData("uwl",e[i],r,2100,new $4xklQ.Vector2(n.x,n.y-a/2+480))),n.x==this.balconyAC.x&&this.balconyAC.y-n.y==this.balconyAH/2&&(this.fillHoleData("uWindow",e[i],a+240,2100,new $4xklQ.Vector2(n.x,n.y+480)),this.setDWId("uw",t-1)))):((2==this.balconyAP||3==this.balconyAP)&&(n.x>=this.balconyAC.x&&n.x-this.balconyAC.x<this.balconyAW/2&&Math.abs(n.y-this.balconyAC.y)==this.balconyAH/2&&(r<1200?this.fillHoleData("uwl",e[i],r,2100):this.fillHoleData("uwl",e[i],r,2100,new $4xklQ.Vector2(n.x+a/2-480,n.y))),n.y==this.balconyAC.y&&n.x-this.balconyAC.x==this.balconyAW/2&&(this.fillHoleData("uWindow",e[i],a+240,2100,new $4xklQ.Vector2(n.x-480,n.y)),this.setDWId("uw",t-1))),(6==this.balconyAP||7==this.balconyAP)&&(n.x<=this.balconyAC.x&&this.balconyAC.x-n.x<this.balconyAW/2&&Math.abs(n.y-this.balconyAC.y)==this.balconyAH/2&&(r<1200?this.fillHoleData("uwl",e[i],r,2100):this.fillHoleData("uwl",e[i],r,2100,new $4xklQ.Vector2(n.x-a/2+480,n.y))),n.y==this.balconyAC.y&&this.balconyAC.x-n.x==this.balconyAW/2&&(this.fillHoleData("uWindow",e[i],a+240,2100,new $4xklQ.Vector2(n.x+480,n.y)),this.setDWId("uw",t-1))))}}return e}fillHoleData(e,t,i,r,o=!1){let a,n=t.thickness,s=t.id;o=o||new $4xklQ.Vector2(t.start.x+t.end.x,t.start.y+t.end.y).divideScalar(2),e.includes("Door")?(a={location:{x:o.x,y:o.y,z:r/2},width:i,height:r,withSector:!1,offsetXY:0,wallID:s,windowThick:n},"sectorDoor"==e&&(a.height=r-i/2),"sectorDoor"==e&&(a.path="static/model/door/01/doorWithThresholdStone.glb"),"baseDoor"==e&&(a.path="static/model/door/baseDoor/baseDoor.glb"),"doubleOpenDoor"==e&&(a.path="static/model/door/doubleOpenDoor/doubleOpenDoor.glb"),"lashDoor"==e&&(a.path="static/model/door/lashDoor/lashDoor.glb"),"slidingDoor"==e&&(a.path="static/model/door/slidingDoor/slidingDoor.glb")):e.includes("Window")?(a={location:{x:o.x,y:o.y,z:r/2+500},width:i,height:r,withSector:!1,offsetXY:0,wallID:s,windowThick:n},"baseWindow"==e&&(a.path="static/model/window/baseWindow/baseWindow.glb"),"uWindow"==e&&(a.path="static/model/window/uWindow/uWindow.glb",a.windowThick+=960),"waveWindow"==e&&(a.path="static/model/window/waveWindow/waveWindow.glb",a.windowThick+=500),"panoramicWindow"==e&&(this.doorArr.forEach(e=>{"study pw"==e.name&&(e.wallId=s)}),a.path="static/model/window/panoramicWindow/panoramicWindow.glb",a.windowThick+=500)):a={location:{x:o.x,y:o.y,z:r/2+500},width:i,height:r,withSector:!1,offsetXY:0,wallID:s,windowThick:n},this.holeArr.push(a)}setDWId(e,t){for(let i=0;i<this.doorArr.length;i++)if(this.doorArr[i].name==e){this.doorArr[i].wallId=t;return}}createPanoramicWindow(e,t,i){let r=new $4xklQ.Group,o=t-this.thickness,a=new $4xklQ.Vector2(-o/2,-this.thickness/2),n=new $4xklQ.Vector2(a.x,a.y+this.cornerWindowWidth),s=new $4xklQ.Vector2(n.x+o,n.y),l=new $4xklQ.Vector2(o/2,-this.thickness/2),h=this.createShapeByPointArr([n,s,l,a],13421772);r.add(h);let c=this.createLine([a,n,s,l,a]);r.add(c);let d=new $4xklQ.Vector2(-o/2,this.thickness/2),p=new $4xklQ.Vector2(d.x-this.thickness,d.y),u=new $4xklQ.Vector2(p.x,p.y+this.cornerWindowWidth),m=new $4xklQ.Vector2(u.x+t+this.thickness,u.y),g=new $4xklQ.Vector2(m.x,m.y-this.cornerWindowWidth),f=new $4xklQ.Vector2(g.x-this.thickness,g.y),w=new $4xklQ.Vector2(d.x-this.thickness/2,d.y),y=new $4xklQ.Vector2(w.x,w.y+this.cornerWindowWidth-this.thickness/2),b=new $4xklQ.Vector2(y.x+o+this.thickness,y.y),x=new $4xklQ.Vector2(b.x,b.y-this.cornerWindowWidth+this.thickness/2),P=this.createShapeByPointArr([p,u,m,g,f,s,n,d]);r.add(P);let v=this.createLine([d,p,u,m,g,f]);r.add(v);let M=this.createLine([w,y,b,x]);return r.add(M),r.rotation.z=i,r.position.set(e.x,e.y,10),r}createFrenchWindow(e,t,i){let r=new $4xklQ.Group,o=new $4xklQ.Vector2(-t/2,-this.thickness/2),a=new $4xklQ.Vector2(-t/2,this.thickness/2),n=new $4xklQ.Vector2(t/2,this.thickness/2),s=new $4xklQ.Vector2(t/2,-this.thickness/2),l=this.createShapeByPointArr([a,n,s,o]),h=this.createLine([o,a,n,s,o]),c=new $4xklQ.Vector2(-t/2,-this.thickness/6),d=new $4xklQ.Vector2(t/2,-this.thickness/6),p=new $4xklQ.Vector2(-t/2,0),u=new $4xklQ.Vector2(t/2,0),m=new $4xklQ.Vector2(-t/2,this.thickness/6),g=new $4xklQ.Vector2(t/2,this.thickness/6),f=new $4xklQ.Vector2(0,this.thickness/6),w=new $4xklQ.Vector2(0,-this.thickness/6),y=this.createLine([c,d]),b=this.createLine([p,u]),x=this.createLine([m,g]),P=this.createLine([f,w]);return r.add(l,h,y,b,x,P),r.rotation.z=i,r.position.set(e.x,e.y,100),r}createLine(e,t=0){let i=new $4xklQ.BufferGeometry().setFromPoints(e),r=new $4xklQ.Line(i,new $4xklQ.LineBasicMaterial({color:t}));return r.renderOrder=100,r}createShapeByPointArr(e,t=16777215){let i=new $4xklQ.Shape;i.moveTo(e[e.length-1].x,e[e.length-1].y),e.forEach(e=>{i.lineTo(e.x,e.y)});let r=new $4xklQ.ShapeGeometry(i),o=new $4xklQ.Mesh(r,new $4xklQ.MeshBasicMaterial({color:t}));return o.renderOrder=90,o}createBalcony(e){let t,i,r,o,a,n;if("A"==e){let e,s=[this.masterP,this.secondBP,this.kitchenP],l=[];(s.includes(0)||s.includes(1))&&l.push(0,1),(s.includes(2)||s.includes(3))&&l.push(2,3),(s.includes(4)||s.includes(5))&&l.push(4,5),(s.includes(6)||s.includes(7))&&l.push(6,7),console.log("Balcony position",t=this.getPosition(l));let h,c=0,d;0==parseInt(t/2)&&(h=this.sitRoomCenter.clone().add(new $4xklQ.Vector2(0,this.sitRoomH/2))),1==parseInt(t/2)&&(h=this.sitRoomCenter.clone().add(new $4xklQ.Vector2(this.sitRoomW/2,0)),c=-Math.PI/2),2==parseInt(t/2)&&(h=this.sitRoomCenter.clone().add(new $4xklQ.Vector2(0,-this.sitRoomH/2))),3==parseInt(t/2)&&(h=this.sitRoomCenter.clone().add(new $4xklQ.Vector2(-this.sitRoomW/2,0)),c=Math.PI/2),d=-1!=[0,1,4,5].indexOf(t)?this.sitRoomW-1e3:this.sitRoomH-1e3;let p=(0,$9QhXH.DM).createSlidingDoor(h,d,c);p.name="slidingDoor",this.doorArr.push(p),-1!=[0,1,4,5].indexOf(t)?(a=this.sitRoomW,n=this.balconyWidth,r=this.sitRoomCenter.x,(0==t||1==t)&&(o=this.sitRoomCenter.y+this.sitRoomH/2+this.balconyWidth/2),(4==t||5==t)&&(o=this.sitRoomCenter.y-this.sitRoomH/2-this.balconyWidth/2)):(a=this.balconyWidth,n=this.sitRoomH,o=this.sitRoomCenter.y,(2==t||3==t)&&(r=this.sitRoomCenter.x+this.sitRoomW/2+this.balconyWidth/2),(6==t||7==t)&&(r=this.sitRoomCenter.x-this.sitRoomW/2-this.balconyWidth/2)),i=new $4xklQ.Vector2(r,o),0==parseInt(t/2)&&(e=new $4xklQ.Vector2(i.x,i.y+n/2)),1==parseInt(t/2)&&(e=new $4xklQ.Vector2(i.x+a/2,i.y)),2==parseInt(t/2)&&(e=new $4xklQ.Vector2(i.x,i.y-n/2)),3==parseInt(t/2)&&(e=new $4xklQ.Vector2(i.x-a/2,i.y)),this.balconyAC=i,this.balconyAP=t,this.balconyAW=a,this.balconyAH=n}let s=new $4xklQ.Vector2(i.x-a/2,i.y-n/2),l=new $4xklQ.Vector2(i.x+a/2,i.y+n/2),h=this.createShape(s,l);this.shape.push(h)}createBaseDoor(e,t,i){let r,o,a,n,s,l,h,c,d=this.doorWidth,p=this.thickness,u=new $4xklQ.Group,m=new $4xklQ.Vector2().add(new $4xklQ.Vector2(-d/2,0)).add(new $4xklQ.Vector2(0,-p/2)),g=new $4xklQ.Vector2().add(new $4xklQ.Vector2(d/2,0)).add(new $4xklQ.Vector2(0,p/2)),f=new $4xklQ.Shape;f.moveTo(m.x,m.y),f.lineTo(m.x,g.y),f.lineTo(g.x,g.y),f.lineTo(g.x,m.y),f.lineTo(m.x,m.y);let w=new $4xklQ.ShapeGeometry(f),y=new $4xklQ.Mesh(w,new $4xklQ.MeshBasicMaterial({color:16711680,side:$4xklQ.DoubleSide}));y.name="DOOR AS",y.renderOrder=1,t?(s=(n=(a=(o=(r=new $4xklQ.Vector2(g.x,m.y)).clone().add(new $4xklQ.Vector2(0,p/2+d))).clone().add(new $4xklQ.Vector2(-p/2,0))).clone().add(new $4xklQ.Vector2(0,-d))).clone().add(new $4xklQ.Vector2(p/2,0)),l=r.clone().add(new $4xklQ.Vector2(-p/2,p)),h=-Math.PI,c=Math.PI/2):(s=(n=(a=(o=(r=m).clone().add(new $4xklQ.Vector2(0,p/2+d))).clone().add(new $4xklQ.Vector2(p/2,0))).clone().add(new $4xklQ.Vector2(0,-d))).clone().add(new $4xklQ.Vector2(-p/2,0)),l=r.clone().add(new $4xklQ.Vector2(p/2,p)),h=0,c=Math.PI/2);let b=new $4xklQ.BufferGeometry().setFromPoints([r,o,a,n,s]),x=new $4xklQ.Line(b,new $4xklQ.LineBasicMaterial({color:0}));x.name="DOOR AL",x.renderOrder=10;let P=new $4xklQ.Path().arc(l.x,l.y,d-p/2,h,c,t).getPoints(),v=new $4xklQ.BufferGeometry().setFromPoints(P),M=new $4xklQ.Line(v,new $4xklQ.LineBasicMaterial({color:0}));M.name="DOOR BL",M.renderOrder=10;let C=new $4xklQ.Shape;C.moveTo(o.x,o.y),[a,n,s,o].forEach(e=>{C.lineTo(e.x,e.y)});let D=new $4xklQ.ShapeGeometry(C),T=new $4xklQ.Mesh(D,new $4xklQ.MeshBasicMaterial({color:65280,side:$4xklQ.DoubleSide}));T.name="DOOR BS",T.renderOrder=5,u.add(y,x,M,T);let S=0;return(0==i||1==i)&&(S=Math.PI),(2==i||3==i)&&(S=Math.PI/2),(6==i||7==i)&&(S=-Math.PI/2),u.rotation.z=S,u.position.set(e.x,e.y),u}createBaseWindow(e,t,i){let r=new $4xklQ.Group,o=new $4xklQ.Vector2().add(new $4xklQ.Vector2(-t/2,this.thickness/2)),a=new $4xklQ.Vector2().add(new $4xklQ.Vector2(-t/2,0)),n=new $4xklQ.Vector2().add(new $4xklQ.Vector2(-t/2,-this.thickness/2)),s=new $4xklQ.Vector2().add(new $4xklQ.Vector2(t/2,this.thickness/2)),l=new $4xklQ.Vector2().add(new $4xklQ.Vector2(t/2,0)),h=new $4xklQ.Vector2().add(new $4xklQ.Vector2(t/2,-this.thickness/2)),c=new $4xklQ.Shape;c.moveTo(o.x,o.y),[n,h,s,o].forEach(e=>{c.lineTo(e.x,e.y)});let d=new $4xklQ.ShapeGeometry(c),p=new $4xklQ.Mesh(d,new $4xklQ.MeshBasicMaterial({color:16777215,side:$4xklQ.DoubleSide}));p.name="WINDOW AS",p.renderOrder=10,r.add(p);let u=new $4xklQ.BufferGeometry().setFromPoints([a,n,h,s,o,a,l]),m=new $4xklQ.Line(u,new $4xklQ.LineBasicMaterial({color:0}));return m.name="WINDOW AL",m.renderOrder=10,r.add(m),r.rotation.z=i,r.position.set(e.x,e.y,10),r}createSlidingDoor(e,t,i,r="Double"){let o=new $4xklQ.Group,a=new $4xklQ.Vector2().add(new $4xklQ.Vector2(-t/2,this.thickness/2)),n=new $4xklQ.Vector2().add(new $4xklQ.Vector2(-t/2,-this.thickness/2)),s=new $4xklQ.Vector2().add(new $4xklQ.Vector2(t/2,-this.thickness/2)),l=new $4xklQ.Vector2().add(new $4xklQ.Vector2(t/2,this.thickness/2)),h=new $4xklQ.Shape;h.moveTo(a.x,a.y),[n,s,l,a].forEach(e=>{h.lineTo(e.x,e.y)});let c=new $4xklQ.ShapeGeometry(h),d=new $4xklQ.Mesh(c,new $4xklQ.MeshBasicMaterial({color:16777215,side:$4xklQ.DoubleSide}));d.name="Sliding Door Base Shape",d.renderOrder=10,o.add(d);let p=new $4xklQ.BufferGeometry().setFromPoints([a,n,s,l,a]),u=new $4xklQ.Line(p,new $4xklQ.LineBasicMaterial({color:0}));if(u.name="Sliding Door Border",u.renderOrder=10,o.add(u),"Single"==r&&(new $4xklQ.Vector2(-t/16,this.thickness/4),new $4xklQ.Vector2(-t/16,0)),"Double"==r){let e=new $4xklQ.Vector2(-t/2+t/4/4*3+100,0),i=new $4xklQ.Vector2(-t/2+100,0),r=i.clone().add(new $4xklQ.Vector2(0,-this.thickness/4)),a=r.clone().add(new $4xklQ.Vector2(t/4,0)),n=a.clone().add(new $4xklQ.Vector2(0,this.thickness/4)),s=n.clone().add(new $4xklQ.Vector2(t/16*3,0)),l=s.clone().add(new $4xklQ.Vector2(0,this.thickness/4)),h=l.clone().add(new $4xklQ.Vector2(-t/4,0)),c=new $4xklQ.BufferGeometry().setFromPoints([e,i,r,a,n,s,l,h,e,n]),d=new $4xklQ.Line(c,new $4xklQ.LineBasicMaterial({color:0}));d.name="Left Sliding Door",d.renderOrder=10,o.add(d);let p=new $4xklQ.Vector2(-e.x,e.y),u=new $4xklQ.Vector2(-i.x,i.y),m=new $4xklQ.Vector2(-r.x,r.y),g=new $4xklQ.Vector2(-a.x,a.y),f=new $4xklQ.Vector2(-n.x,n.y),w=new $4xklQ.Vector2(-s.x,s.y),y=new $4xklQ.Vector2(-l.x,l.y),b=new $4xklQ.Vector2(-h.x,h.y),x=new $4xklQ.BufferGeometry().setFromPoints([p,u,m,g,f,w,y,b,p,f]),P=new $4xklQ.Line(x,new $4xklQ.LineBasicMaterial({color:0}));P.name="Right Sliding Door",P.renderOrder=10,o.add(P)}return o.rotation.z=i,o.position.set(e.x,e.y,10),o}generateWindow(){console.log("主",this.masterP,"次",this.secondBP,"厨",this.kitchenP);let e=[this.masterP,this.secondBP,this.kitchenP],t=[];(e.includes(0)||e.includes(1))&&t.push(0,1),(e.includes(2)||e.includes(3))&&t.push(2,3),(e.includes(4)||e.includes(5))&&t.push(4,5),(e.includes(6)||e.includes(7))&&t.push(6,7);let i=this.getPosition(t),r,o=0,a;0==parseInt(i/2)&&(r=this.sitRoomCenter.clone().add(new $4xklQ.Vector2(0,this.sitRoomH/2))),1==parseInt(i/2)&&(r=this.sitRoomCenter.clone().add(new $4xklQ.Vector2(this.sitRoomW/2,0)),o=-Math.PI/2),2==parseInt(i/2)&&(r=this.sitRoomCenter.clone().add(new $4xklQ.Vector2(0,-this.sitRoomH/2))),3==parseInt(i/2)&&(r=this.sitRoomCenter.clone().add(new $4xklQ.Vector2(-this.sitRoomW/2,0)),o=Math.PI/2),a=-1!=[0,1,4,5].indexOf(i)?this.sitRoomW-1e3:this.sitRoomH-1e3;let n=(0,$9QhXH.DM).createSlidingDoor(r,a,o);this.doorArr.push(n)}getHome2(){let e,t,i=0,r,o;return o=this.getRandom(0,1),t=(e=this.getRandom(1,3))>1?this.getRandom(1,2):1,r=e>2?this.getRandom(1,2):1,2==e&&(i=this.getRandom(0,1)),3==e&&(i=1),console.log(e+" 室 "+t+" 厅 1 厨 "+r+" 卫 "+i+" 过道 "+(o=1)+"玄关"),this.createSittingRoom(),this.createDiningRoom2(),this.createKitchen2(),1==o&&this.createPorch(),[this.shape,[]]}createDiningRoom2(){let e,t,i,r;let o=this.getRandom(0,3);if(this.sitRoomW>this.sitRoomH&&(e=[2,3,6,7][o]),this.sitRoomW<this.sitRoomH&&(e=[0,1,4,5][o]),this.sitRoomW==this.sitRoomH&&(e=this.getRandom(0,7)),i=this.getRandom(1600,3e3),r=this.getRandom(1600,2500),1==this.getRandom(0,1)){let e=i;i=r,r=e}-1!=[0,1,4,5].indexOf(e)&&1200>=Math.abs(this.sitRoomW-i)&&(i=this.sitRoomW,this.gmt=!0),-1!=[2,3,6,7].indexOf(e)&&1200>=Math.abs(this.sitRoomH-r)&&(r=this.sitRoomH,this.gmt=!0),t=this.computeXY(this.sitRoomCenter,this.sitRoomW,this.sitRoomH,i,r,e),this.diningRoomCenter=t,this.diningRoomW=i,this.diningRoomH=r,this.diningRoomP=e;let a=new $4xklQ.Vector2(t.x-i/2,t.y-r/2),n=new $4xklQ.Vector2(t.x+i/2,t.y+r/2),s=this.createShape(a,n);this.shape.push(s)}createKitchen2(){let e,t,i,r,o;console.log("餐厅位置",this.diningRoomP),-1!=[0,1,4,5].indexOf(this.diningRoomP)?(o=this.diningRoomH,r=this.getRandom(2500,3500),i=this.diningRoomCenter.y,-1!=[0,5].indexOf(this.diningRoomP)&&(t=this.diningRoomCenter.x+this.diningRoomW/2+r/2),-1!=[1,4].indexOf(this.diningRoomP)&&(t=this.diningRoomCenter.x-this.diningRoomW/2-r/2)):(r=this.diningRoomW,o=this.getRandom(2500,3500),t=this.diningRoomCenter.x,-1!=[2,7].indexOf(this.diningRoomP)&&(i=this.diningRoomCenter.y-this.diningRoomH/2-o/2),-1!=[3,6].indexOf(this.diningRoomP)&&(i=this.diningRoomCenter.y+this.diningRoomH/2+o/2)),e=new $4xklQ.Vector2(t,i),this.kitchenCenter=e,this.kitchenW=r,this.kitchenH=o;let a=new $4xklQ.Vector2(e.x-r/2,e.y-o/2),n=new $4xklQ.Vector2(e.x+r/2,e.y+o/2),s=this.createShape(a,n);this.shape.push(s)}createToilet2(){let e,t,i,r,o;console.log("餐客一体",this.gmt),this.gmt?(console.log("A"),-1!=[0,1,4,5].indexOf(this.diningRoomP)&&(r=this.kitchenW,o=this.getRandom(1600,2e3),t=this.kitchenCenter.x,-1!=[0,1].indexOf(this.diningRoomP)&&(i=this.kitchenCenter.y-this.kitchenH/2-o/2),-1!=[4,5].indexOf(this.diningRoomP)&&(i=this.kitchenCenter.y+this.kitchenH/2+o/2)),-1!=[2,3,6,7].indexOf(this.diningRoomP)&&(o=this.kitchenH,r=this.getRandom(1600,2e3),i=this.kitchenCenter.y,-1!=[2,3].indexOf(this.diningRoomP)&&(t=this.kitchenCenter.x-this.kitchenW/2-r/2),-1!=[6,7].indexOf(this.diningRoomP)&&(t=this.kitchenCenter.x+this.kitchenW/2+r/2))):-1!=[0,1,4,5].indexOf(this.diningRoomP)?(o=this.diningRoomH,r=this.getRandom(1800,2500),i=this.diningRoomCenter.y,-1!=[0,5].indexOf(this.diningRoomP)&&(t=this.kitchenCenter.x+this.kitchenW/2+r/2),-1!=[1,4].indexOf(this.diningRoomP)&&(t=this.kitchenCenter.x-this.kitchenW/2-r/2)):(r=this.diningRoomW,o=this.getRandom(1800,2500),t=this.diningRoomCenter.x,-1!=[2,7].indexOf(this.diningRoomP)&&(i=this.kitchenCenter.y-this.kitchenH/2-o/2),-1!=[3,6].indexOf(this.diningRoomP)&&(i=this.kitchenCenter.y+this.kitchenH/2+o/2)),e=new $4xklQ.Vector2(t,i);let a=new $4xklQ.Vector2(e.x-r/2,e.y-o/2),n=new $4xklQ.Vector2(e.x+r/2,e.y+o/2),s=this.createShape(a,n);this.shape.push(s)}computeXY(e,t,i,r,o,a){let n,s;return(0==a||5==a)&&(n=e.x-t/2+r/2),(1==a||4==a)&&(n=e.x+t/2-r/2),(0==a||1==a)&&(s=e.y+i/2+o/2),(4==a||5==a)&&(s=e.y-i/2-o/2),(2==a||7==a)&&(s=e.y+i/2-o/2),(3==a||6==a)&&(s=e.y-i/2+o/2),(2==a||3==a)&&(n=e.x+t/2+r/2),(6==a||7==a)&&(n=e.x-t/2-r/2),new $4xklQ.Vector2(n,s)}createPorch(){this.getRandom(1300,3300),this.getRandom(1300,1500),this.getRandom(0,1)}createSittingRoom(){let e=this.getRandom(this.sitRoomWidthMin,this.sitRoomWidthMax),t=this.getRandom(this.sitRoomHeightMin,this.sitRoomHeightMax);if(this.getRandom(0,1)){let i=e;e=t,t=i}this.sitRoomCenter=new $4xklQ.Vector2,this.sitRoomW=e,this.sitRoomH=t;let i=new $4xklQ.Vector2(e/2,t/2),r=new $4xklQ.Vector2(-e/2,-t/2);this.createShape(r,i)}createDiningRoom(){let e,t=this.getRandom(0,7),i=this.getRandom(1600,2500),r=this.getRandom(1600,2e3);if(-1==[0,1,4,5].indexOf(t)){let e=i;i=r,r=e}let o=this.getCenter(this.sitRoomCenter,this.sitRoomW,this.sitRoomH,i,r,t);0==t&&(e=o.clone().add(new $4xklQ.Vector2(-i/2,-r/2-200-this.doorWidth/2))),1==t&&(e=o.clone().add(new $4xklQ.Vector2(i/2,-r/2-200-this.doorWidth/2))),2==t&&(e=o.clone().add(new $4xklQ.Vector2(-i/2-200-this.doorWidth/2,r/2))),3==t&&(e=o.clone().add(new $4xklQ.Vector2(-i/2-200-this.doorWidth/2,-r/2))),4==t&&(e=o.clone().add(new $4xklQ.Vector2(i/2,r/2+200+this.doorWidth/2))),5==t&&(e=o.clone().add(new $4xklQ.Vector2(-i/2,r/2+200+this.doorWidth/2))),6==t&&(e=o.clone().add(new $4xklQ.Vector2(i/2+200+this.doorWidth/2,-r/2))),7==t&&(e=o.clone().add(new $4xklQ.Vector2(i/2+200+this.doorWidth/2,r/2))),this.diningRoomCenter=o,this.diningRoomW=i,this.diningRoomH=r,this.diningRoomP=t;let a=new $4xklQ.Vector2(o.x-i/2,o.y-r/2),n=new $4xklQ.Vector2(o.x+i/2,o.y+r/2),s=this.createShape(a,n);this.shape.push(s)}createKitchen(e){let t,i,r,o,a,n;e>1?(0==this.diningRoomP&&(t=1),1==this.diningRoomP&&(t=0),2==this.diningRoomP&&(t=3),3==this.diningRoomP&&(t=2),4==this.diningRoomP&&(t=5),5==this.diningRoomP&&(t=4),6==this.diningRoomP&&(t=7),7==this.diningRoomP&&(t=6)):t=this.getRandom(0,7),-1!=[0,1,4,5].indexOf(t)?(this.diningRoomW?(i=this.sitRoomW-this.diningRoomW,r=this.getRandom(2500,3500)):(i=this.getRandom(1600,2e3),r=this.getRandom(2500,3500)),o=this.getCenter(this.sitRoomCenter,this.sitRoomW,this.sitRoomH,i,r,t)):(this.diningRoomW?(r=this.sitRoomH-this.diningRoomH,i=this.getRandom(2500,3500)):(r=this.getRandom(1600,2e3),i=this.getRandom(2500,3500)),o=this.getCenter(this.sitRoomCenter,this.sitRoomW,this.sitRoomH,i,r,t)),-1!=[0,1,4,5].indexOf(t)?(a=o.x,(0==t||1==t)&&(n=o.y-r/2),(4==t||5==t)&&(n=o.y+r/2)):(n=o.y,(2==t||3==t)&&(a=o.x-i/2),(6==t||7==t)&&(a=o.x+i/2));let s=0;(4==t||5==t)&&(s=Math.PI),(2==t||3==t)&&(s=-Math.PI/2),(6==t||7==t)&&(s=Math.PI/2);let l=(0,$9QhXH.DM).createBaseDoor(new $4xklQ.Vector2(a,n),800,"inside",s);l.name="kitchen door",this.doorArr.push(l);let h,c,d,p=0;-1!=[0,1,4,5].indexOf(t)?(h=a,d=i-600,(0==t||1==t)&&(c=n+r),(4==t||5==t)&&(c=n-r)):(c=n,d=r-600,p=Math.PI/2,(2==t||3==t)&&(h=a+i),(6==t||7==t)&&(h=a-i));let u=(0,$9QhXH.DM).createBaseWindow(new $4xklQ.Vector2(h,c),d,p);u.name="kitchen window",this.doorArr.push(u),this.kitchenCenter=o,this.kitchenW=i,this.kitchenH=r,this.kitchenP=t;let m=new $4xklQ.Vector2(o.x-i/2,o.y-r/2),g=new $4xklQ.Vector2(o.x+i/2,o.y+r/2),f=this.createShape(m,g);this.shape.push(f)}createToilet(e){let t,i,r,o,a,n,s;e>1?-1!=[0,1,4,5].indexOf(this.diningRoomP)?(n=this.diningRoomCenter.x,t=this.diningRoomW,i=this.kitchenH-this.diningRoomH>=1800?this.kitchenH-this.diningRoomH:this.getRandom(1800,2500),(0==this.diningRoomP||1==this.diningRoomP)&&(a=this.diningRoomCenter.y+this.diningRoomH/2+i/2,s=this.diningRoomCenter.y+this.diningRoomH/2),(4==this.diningRoomP||5==this.diningRoomP)&&(a=this.diningRoomCenter.y-this.diningRoomH/2-i/2,s=this.diningRoomCenter.y-this.diningRoomH/2),o=this.diningRoomCenter.x):(s=this.diningRoomCenter.y,i=this.diningRoomH,t=this.kitchenW-this.diningRoomW>=1800?this.kitchenW-this.diningRoomW:this.getRandom(1800,2500),(2==this.diningRoomP||3==this.diningRoomP)&&(o=this.diningRoomCenter.x+this.diningRoomW/2+t/2,n=this.diningRoomCenter.x+this.diningRoomW/2),(6==this.diningRoomP||7==this.diningRoomP)&&(o=this.diningRoomCenter.x-this.diningRoomW/2-t/2,n=this.diningRoomCenter.x-this.diningRoomW/2),a=this.diningRoomCenter.y):-1!=[0,1,4,5].indexOf(this.kitchenP)?(t=this.sitRoomW-this.kitchenW>=1600?this.sitRoomW-this.kitchenW:this.getRandom(this.sitRoomW-this.kitchenW+this.thickness+this.bufferMeter,2e3),i=this.getRandom(1800,2500),(0==this.kitchenP||5==this.kitchenP)&&(o=this.kitchenCenter.x+this.kitchenW/2+t/2),(1==this.kitchenP||4==this.kitchenP)&&(o=this.kitchenCenter.x-this.kitchenW/2-t/2),n=o,(0==this.kitchenP||1==this.kitchenP)&&(s=(a=this.kitchenCenter.y-this.kitchenH/2+i/2)-i/2),(4==this.kitchenP||5==this.kitchenP)&&(s=(a=this.kitchenCenter.y+this.kitchenH/2-i/2)+i/2)):(i=this.sitRoomH-this.kitchenH>=1600?this.sitRoomH-this.kitchenH:this.getRandom(this.sitRoomH-this.kitchenH+this.thickness+this.bufferMeter,2e3),t=this.getRandom(1800,2500),(2==this.kitchenP||7==this.kitchenP)&&(a=this.kitchenCenter.y-this.kitchenH/2-i/2),(3==this.kitchenP||6==this.kitchenP)&&(a=this.kitchenCenter.y+this.kitchenH/2+i/2),s=a,(2==this.kitchenP||3==this.kitchenP)&&(n=(o=this.kitchenCenter.x-this.kitchenW/2+t/2)-t/2),(6==this.kitchenP||7==this.kitchenP)&&(n=(o=this.kitchenCenter.x+this.kitchenW/2-t/2)+t/2)),r=new $4xklQ.Vector2(o,a);let l=0;(4==this.kitchenP||5==this.kitchenP)&&(l=Math.PI),(2==this.kitchenP||3==this.kitchenP)&&(l=-Math.PI/2),(6==this.kitchenP||7==this.kitchenP)&&(l=Math.PI/2);let h=(0,$9QhXH.DM).createBaseDoor(new $4xklQ.Vector2(n,s),800,"inside",l);h.name="toilet door",this.doorArr.push(h);let c,d,p,u=0;-1!=[0,1,4,5].indexOf(this.kitchenP)?(c=n,p=t-600,(0==this.kitchenP||1==this.kitchenP)&&(d=s+i),(4==this.kitchenP||5==this.kitchenP)&&(d=s-i)):(d=s,p=i-600,u=Math.PI/2,(2==this.kitchenP||3==this.kitchenP)&&(c=n+t),(6==this.kitchenP||7==this.kitchenP)&&(c=n-t));let m=(0,$9QhXH.DM).createBaseWindow(new $4xklQ.Vector2(c,d),p,u);m.name="toilet window",this.doorArr.push(m),this.toiletC=r,this.toiletW=t,this.toiletH=i;let g=new $4xklQ.Vector2(r.x-t/2,r.y-i/2),f=new $4xklQ.Vector2(r.x+t/2,r.y+i/2),w=this.createShape(g,f);this.shape.push(w)}createSecondBedroom(){let e,t,i,r,o=[];(0==this.kitchenP||1==this.kitchenP)&&(o=[0,1]),(2==this.kitchenP||3==this.kitchenP)&&(o=[2,3]),(4==this.kitchenP||5==this.kitchenP)&&(o=[4,5]),(6==this.kitchenP||7==this.kitchenP)&&(o=[6,7]);let a=this.getPosition(o);this.secondBedroomP=a;let n=this.getRandom(2500,3200),s=this.getRandom(2500,3e3);-1!=[0,1,4,5].indexOf(a)?(i=e=this.getCenterXY(this.sitRoomCenter.x,this.sitRoomW/2,n/2,a),(0==a||1==a)&&(r=(t=this.sitRoomCenter.y+this.sitRoomH/2+s/2)-s/2),(4==a||5==a)&&(r=(t=this.sitRoomCenter.y-this.sitRoomH/2-s/2)+s/2)):(r=t=this.getCenterXY(this.sitRoomCenter.y,this.sitRoomH/2,s/2,a),(2==a||3==a)&&(i=(e=this.sitRoomCenter.x+this.sitRoomW/2+n/2)-n/2),(6==a||7==a)&&(i=(e=this.sitRoomCenter.x-this.sitRoomW/2-n/2)+n/2));let l=new $4xklQ.Vector2(e,t),h=0;(4==a||5==a)&&(h=Math.PI),(2==a||3==a)&&(h=-Math.PI/2),(6==a||7==a)&&(h=Math.PI/2);let c=(0,$9QhXH.DM).createBaseDoor(new $4xklQ.Vector2(i,r),800,"inside",h);c.name="secondBD door",this.doorArr.push(c);let d,p,u,m=0;-1!=[0,1,4,5].indexOf(a)?(d=i,u=n-600,(0==a||1==a)&&(p=r+s),(4==a||5==a)&&(p=r-s)):(p=r,u=s-600,m=Math.PI/2,(2==a||3==a)&&(d=i+n),(6==a||7==a)&&(d=i-n));let g=(0,$9QhXH.DM).createBaseWindow(new $4xklQ.Vector2(d,p),u,m);g.name="secondBD window",this.doorArr.push(g),this.secondBP=a,this.secondBC=l,this.secondBW=n,this.secondBH=s;let f=new $4xklQ.Vector2(l.x-n/2,l.y-s/2),w=new $4xklQ.Vector2(l.x+n/2,l.y+s/2),y=this.createShape(f,w);this.shape.push(y)}getCenterXY(e,t,i,r=0){let o;if(this.flat)o=-1!=[0,3,5,6].indexOf(r)?e-t+i:e+t-i;else{let r=e-t+this.thickness+this.bufferMeter-i,o=e+t-this.thickness-this.bufferMeter+i,a=e-t-this.thickness-this.bufferMeter+i,n=e-t+this.thickness+this.bufferMeter+i,s=e+t-this.thickness-this.bufferMeter-i,l=e+t+this.thickness+this.bufferMeter-i,h=e-t+i,c=e+t-i,d=this.getRandom(r,o);if(d>a&&d<n)return d==h?d:this.getCenterXY(e,t,i);if(d>s&&d<l)return d==c?d:this.getCenterXY(e,t,i)}return o}createMasterBedroom(e){let t,i,r,o,a=[];(0==this.kitchenP||1==this.kitchenP)&&(a=[0,1]),(2==this.kitchenP||3==this.kitchenP)&&(a=[2,3]),(4==this.kitchenP||5==this.kitchenP)&&(a=[4,5]),(6==this.kitchenP||7==this.kitchenP)&&(a=[6,7]),e>1&&((0==this.secondBedroomP||1==this.secondBedroomP)&&a.push(0,1),(2==this.secondBedroomP||3==this.secondBedroomP)&&a.push(2,3),(4==this.secondBedroomP||5==this.secondBedroomP)&&a.push(4,5),(6==this.secondBedroomP||7==this.secondBedroomP)&&a.push(6,7));let n=this.getPosition(a),s=this.getRandom(4e3,4500),l=this.getRandom(2800,3500),h=0;if(console.log(this.sitRoomW-s,this.sitRoomW-l),-1!=[0,1,4,5].indexOf(n)){if(this.sitRoomW-s<1e3){let e=s;s=l,l=e,this.sitRoomW-s>=1e3?h=(this.sitRoomW-s)/2:(s=this.sitRoomW-1e3,h=500)}else h=(this.sitRoomW-s)/2}else if(this.sitRoomH-l<1e3){let e=s;s=l,l=e,this.sitRoomH-l>=1e3?h=(this.sitRoomH-l)/2:(l=this.sitRoomH-1e3,h=500)}else h=(this.sitRoomH-l)/2;e>1?((0==this.secondBedroomP||1==this.secondBedroomP)&&(-1!=[2,3,6,7].indexOf(n)&&(i=this.getCenterXY(this.sitRoomCenter.y,this.sitRoomH/2,l/2,n),-1!=[2,3].indexOf(n)&&(t=this.sitRoomCenter.x+this.sitRoomW/2+s/2),-1!=[6,7].indexOf(n)&&(t=this.sitRoomCenter.x-this.sitRoomW/2-s/2)),(4==n||5==n)&&(i=this.sitRoomCenter.y-this.sitRoomH/2-l/2,t=this.getCenterXY(this.sitRoomCenter.x,this.sitRoomW/2,s/2,n))),(2==this.secondBedroomP||3==this.secondBedroomP)&&(-1!=[0,1,4,5].indexOf(n)&&(t=this.getCenterXY(this.sitRoomCenter.x,this.sitRoomW/2,s/2,n),-1!=[0,1].indexOf(n)&&(i=this.sitRoomCenter.y+this.sitRoomH/2+l/2),-1!=[4,5].indexOf(n)&&(i=this.sitRoomCenter.y-this.sitRoomH/2-l/2)),(6==n||7==n)&&(t=this.sitRoomCenter.x-this.sitRoomW/2-s/2,i=this.getCenterXY(this.sitRoomCenter.y,this.sitRoomH/2,l/2,n))),(4==this.secondBedroomP||5==this.secondBedroomP)&&(-1!=[2,3,6,7].indexOf(n)&&(i=this.getCenterXY(this.sitRoomCenter.y,this.sitRoomH/2,l/2,n),-1!=[2,3].indexOf(n)&&(t=this.sitRoomCenter.x+this.sitRoomW/2+s/2),-1!=[6,7].indexOf(n)&&(t=this.sitRoomCenter.x-this.sitRoomW/2-s/2)),(0==n||1==n)&&(i=this.sitRoomCenter.y+this.sitRoomH/2+l/2,t=this.getCenterXY(this.sitRoomCenter.x,this.sitRoomW/2,s/2,n))),(6==this.secondBedroomP||7==this.secondBedroomP)&&(-1!=[0,1,4,5].indexOf(n)&&(t=this.getCenterXY(this.sitRoomCenter.x,this.sitRoomW/2,s/2,n),-1!=[0,1].indexOf(n)&&(i=this.sitRoomCenter.y+this.sitRoomH/2+l/2),-1!=[4,5].indexOf(n)&&(i=this.sitRoomCenter.y-this.sitRoomH/2-l/2)),(2==n||3==n)&&(t=this.sitRoomCenter.x+this.sitRoomW/2+s/2,i=this.getCenterXY(this.sitRoomCenter.y,this.sitRoomH/2,l/2,n)))):(-1!=[0,1,4,5].indexOf(n)&&(t=this.getCenterXY(this.sitRoomCenter.x,this.sitRoomW/2,s/2,n),-1!=[0,1].indexOf(n)&&(i=this.sitRoomCenter.y+this.sitRoomH/2+l/2),-1!=[4,5].indexOf(n)&&(i=this.sitRoomCenter.y-this.sitRoomH/2-l/2)),-1!=[2,3,6,7].indexOf(n)&&(i=this.getCenterXY(this.sitRoomCenter.y,this.sitRoomH/2,l/2,n),-1!=[2,3].indexOf(n)&&(t=this.sitRoomCenter.x+this.sitRoomW/2+s/2),-1!=[6,7].indexOf(n)&&(t=this.sitRoomCenter.x-this.sitRoomW/2-s/2)));let c=new $4xklQ.Vector2(t,i);-1!=[0,1,4,5].indexOf(n)?(r=c.x,(0==n||1==n)&&(o=c.y-l/2),(4==n||5==n)&&(o=c.y+l/2)):(o=c.y,(2==n||3==n)&&(r=c.x-s/2),(6==n||7==n)&&(r=c.x+s/2));let d=0;(4==n||5==n)&&(d=Math.PI),(2==n||3==n)&&(d=-Math.PI/2),(6==n||7==n)&&(d=Math.PI/2);let p=(0,$9QhXH.DM).createBaseDoor(new $4xklQ.Vector2(r,o),800,"inside",d);p.name="masterBD door",this.doorArr.push(p);let u=0,m=0;(0==n||5==n)&&(u=c.x+s/2+h),(1==n||4==n)&&(u=c.x-s/2-h),(0==n||1==n)&&(m=c.y-l/2),(4==n||5==n)&&(m=c.y+l/2),(2==n||3==n)&&(u=c.x-s/2),(6==n||7==n)&&(u=c.x+s/2),(2==n||7==n)&&(m=c.y-l/2-h),(3==n||6==n)&&(m=c.y+l/2+h);let g=0;(0==n||1==n)&&(g=Math.PI),(2==n||3==n)&&(g=Math.PI/2),(6==n||7==n)&&(g=-Math.PI/2);let f=(0,$9QhXH.DM).createLashDoor(new $4xklQ.Vector2(u,m),800,g);f.name="entry door",this.doorArr.push(f),this.masterP=n,this.masterC=c,this.masterW=s,this.masterH=l;let w=new $4xklQ.Vector2(c.x-s/2,c.y-l/2),y=new $4xklQ.Vector2(c.x+s/2,c.y+l/2),b=this.createShape(w,y,"CW");this.shape.push(b)}createStudy(){let e,t,i,r,o,a,n;if(0==this.secondBP&&(e=1),1==this.secondBP&&(e=0),2==this.secondBP&&(e=3),3==this.secondBP&&(e=2),4==this.secondBP&&(e=5),5==this.secondBP&&(e=4),6==this.secondBP&&(e=7),7==this.secondBP&&(e=6),-1!=[0,1,4,5].indexOf(e)){t=this.getRandom(2500,3200),i=this.secondBH,o=this.secondBC.y;let r=this.sitRoomW-this.secondBW;(0==e||1==e)&&(n=this.secondBC.y-this.secondBH/2),(4==e||5==e)&&(n=this.secondBC.y+this.secondBH/2),(0==e||5==e)&&(a=this.secondBC.x-this.secondBW/2-r/2),(1==e||4==e)&&(a=this.secondBC.x+this.secondBW/2+r/2)}else{t=this.secondBW,i=this.getRandom(2500,3e3),r=this.secondBC.x;let o=this.sitRoomH-this.secondBH;(2==e||3==e)&&(a=this.secondBC.x-this.secondBW/2),(6==e||7==e)&&(a=this.secondBC.x+this.secondBW/2),(2==e||7==e)&&(n=this.secondBC.y+this.secondBH/2+o/2),(3==e||6==e)&&(n=this.secondBC.y-this.secondBH/2-o/2)}(0==this.secondBP||5==this.secondBP)&&(r=this.secondBC.x+this.secondBW/2+t/2),(1==this.secondBP||4==this.secondBP)&&(r=this.secondBC.x-this.secondBW/2-t/2),(2==this.secondBP||7==this.secondBP)&&(o=this.secondBC.y-this.secondBH/2-i/2),(3==this.secondBP||6==this.secondBP)&&(o=this.secondBC.y+this.secondBH/2+i/2);let s=new $4xklQ.Vector2(r,o),l=0;(4==this.secondBP||5==this.secondBP)&&(l=Math.PI),(2==this.secondBP||3==this.secondBP)&&(l=-Math.PI/2),(6==this.secondBP||7==this.secondBP)&&(l=Math.PI/2);let h=(0,$9QhXH.DM).createBaseDoor(new $4xklQ.Vector2(a,n),800,"inside",l);h.name="study door",this.doorArr.push(h);let c,d,p=0,u,m;-1!=[0,1,4,5].indexOf(e)?(u=s.x,(0==e||1==e)&&(m=s.y+i/2),(4==e||5==e)&&(m=s.y-i/2,p=Math.PI),d=t):(m=s.y,(2==e||3==e)&&(u=s.x+t/2,p=-Math.PI/2),(6==e||7==e)&&(u=s.x-t/2,p=Math.PI/2),d=i),c=new $4xklQ.Vector2(u,m);let g=(0,$9QhXH.DM).createPanoramicWindow(c,d,p);g.name="study pw",this.doorArr.push(g);let f=new $4xklQ.Vector2(s.x-t/2,s.y-i/2),w=new $4xklQ.Vector2(s.x+t/2,s.y+i/2),y=this.createShape(f,w);this.shape.push(y)}getCenter(e,t,i,r,o,a){let n,s;switch(a){case 0:n=e.x-t/2+r/2,s=e.y+i/2+o/2;break;case 1:n=e.x+t/2-r/2,s=e.y+i/2+o/2;break;case 2:n=e.x+t/2+r/2,s=e.y+i/2-o/2;break;case 3:n=e.x+t/2+r/2,s=e.y-i/2+o/2;break;case 4:n=e.x+t/2-r/2,s=e.y-i/2-o/2;break;case 5:n=e.x-t/2+r/2,s=e.y-i/2-o/2;break;case 6:n=e.x-t/2-r/2,s=e.y-i/2+o/2;break;case 7:n=e.x-t/2-r/2,s=e.y+i/2-o/2}return new $4xklQ.Vector2(n,s)}createShape(e,t,i=""){let r=new $4xklQ.Shape,o;if(""==i){r.moveTo(e.x,t.y),r.lineTo(t.x,t.y),r.lineTo(t.x,e.y),r.lineTo(e.x,e.y),r.lineTo(e.x,t.y);let i=new $4xklQ.ShapeGeometry(r);o=new $4xklQ.Mesh(i,new $4xklQ.MeshBasicMaterial({color:16777215*Math.random(),side:$4xklQ.DoubleSide})),this.jsonArr.push(this.createJsonBy2Point(new $4xklQ.Vector2(e.x,t.y),new $4xklQ.Vector2(t.x,t.y))),this.jsonArr.push(this.createJsonBy2Point(new $4xklQ.Vector2(t.x,t.y),new $4xklQ.Vector2(t.x,e.y))),this.jsonArr.push(this.createJsonBy2Point(new $4xklQ.Vector2(t.x,e.y),new $4xklQ.Vector2(e.x,e.y))),this.jsonArr.push(this.createJsonBy2Point(new $4xklQ.Vector2(e.x,e.y),new $4xklQ.Vector2(e.x,t.y)))}return"CW"==i&&(o=this.addCornerWindow(e,t,r)),o}addCornerWindow(e,t,i){let r,o,a,n,s,l,h,c,d=2500,p=1400;if(this.masterH>this.masterW){let e=d;d=p,p=e}(0==this.masterP||7==this.masterP)&&(r=e.clone(),o=new $4xklQ.Vector2(e.x,t.y-p+this.cornerWindowWidth),a=new $4xklQ.Vector2(e.x-this.cornerWindowWidth,o.y),n=new $4xklQ.Vector2(a.x,a.y+p),s=new $4xklQ.Vector2(n.x+d,n.y),l=new $4xklQ.Vector2(s.x,s.y-this.cornerWindowWidth),h=t.clone(),c=new $4xklQ.Vector2(t.x,e.y)),(1==this.masterP||2==this.masterP)&&(c=e.clone(),r=new $4xklQ.Vector2(e.x,t.y),o=new $4xklQ.Vector2(t.x-d+this.cornerWindowWidth,t.y),a=new $4xklQ.Vector2(o.x,o.y+this.cornerWindowWidth),n=new $4xklQ.Vector2(a.x+d,a.y),s=new $4xklQ.Vector2(n.x,n.y-p),l=new $4xklQ.Vector2(s.x-this.cornerWindowWidth,s.y),h=new $4xklQ.Vector2(t.x,e.y)),(3==this.masterP||4==this.masterP)&&(h=e.clone(),c=new $4xklQ.Vector2(e.x,t.y),r=t.clone(),o=new $4xklQ.Vector2(t.x,e.y+p-this.cornerWindowWidth),a=new $4xklQ.Vector2(o.x+this.cornerWindowWidth,o.y),n=new $4xklQ.Vector2(a.x,a.y-p),s=new $4xklQ.Vector2(n.x-d,n.y),l=new $4xklQ.Vector2(s.x,s.y+this.cornerWindowWidth)),(5==this.masterP||6==this.masterP)&&(h=new $4xklQ.Vector2(e.x,t.y),c=t.clone(),r=new $4xklQ.Vector2(t.x,e.y),o=new $4xklQ.Vector2(e.x+d-this.cornerWindowWidth,e.y),a=new $4xklQ.Vector2(o.x,o.y-this.cornerWindowWidth),n=new $4xklQ.Vector2(a.x-d,a.y),s=new $4xklQ.Vector2(n.x,n.y+p),l=new $4xklQ.Vector2(s.x+this.cornerWindowWidth,s.y)),i.moveTo(r.x,r.y);let u=[o,a,n,s,l,h,c,r];u.forEach(e=>{i.lineTo(e.x,e.y)});for(let e=0;e<u.length;e++)e==u.length-1?this.jsonArr.push(this.createJsonBy2Point(u[e],u[0])):this.jsonArr.push(this.createJsonBy2Point(u[e],u[e+1]));let m,g=0,f,w=0,y=a.clone().add(n).divideScalar(2),b=n.clone().add(s).divideScalar(2);[0,7,3,4].includes(this.masterP)?(m=p-this.thickness,g=Math.PI/2,f=d-this.thickness):(m=d-this.thickness,f=p-this.thickness,w=Math.PI/2);let x=(0,$9QhXH.DM).createBaseWindow(y,m,g),P=(0,$9QhXH.DM).createBaseWindow(b,f,w);return x.name="CW1",P.name="CW2",this.doorArr.push(x,P),i}handleSegment(){let e=[];for(;this.jsonArr.length>0;){let t=this.jsonArr.shift();if(0==e.length)e.push(t);else{let i=e.length,r=[],o=!0;for(let a=0;a<i;a++){let i=this.handleIntersect(t,e.shift());i.length>1&&(o=!1),r.push(...i)}o&&r.push(t),e=this.mergeArr(r)}}return e=this.handleInclude(e),this.doorArr.forEach(t=>{for(let i=0;i<e.length;i++){let r=e[i],o=new $4xklQ.Vector3(r.start.x,r.start.y,0),a=new $4xklQ.Vector3(r.end.x,r.end.y,0),n=o.clone().add(a).divideScalar(2);if(t.position.x==n.x&&t.position.y==n.y){t.wallStartPoint=o,t.wallEndPoint=a;break}}}),console.log("finalArr",e),e}handleInclude(e){let t=[];for(let i=0;i<e.length;i++){let r=[],o=[],a=new $4xklQ.Vector2(e[i].start.x,e[i].start.y),n=new $4xklQ.Vector2(e[i].end.x,e[i].end.y);for(let t=0;t<e.length;t++)if(i!=t){let i=new $4xklQ.Vector2(e[t].start.x,e[t].start.y),s=new $4xklQ.Vector2(e[t].end.x,e[t].end.y);i.distanceTo(s)<a.distanceTo(n)&&((i.equals(a)||s.equals(a))&&r.push(e[t]),(i.equals(n)||s.equals(n))&&o.push(e[t]))}for(let a=0;a<r.length;a++){let n=new $4xklQ.Vector2(r[a].start.x,r[a].start.y),s=new $4xklQ.Vector2(r[a].end.x,r[a].end.y);for(let r=0;r<o.length;r++){let a=new $4xklQ.Vector2(o[r].start.x,o[r].start.y),l=new $4xklQ.Vector2(o[r].end.x,o[r].end.y);(n.equals(a)||n.equals(l)||s.equals(a)||s.equals(l))&&t.push(e[i])}}}return t.forEach(t=>{e.splice(e.indexOf(t),1)}),e}handleIntersect(e,t){let i=e.equation,r=t.equation,o=new $4xklQ.Vector2(e.start.x,e.start.y),a=new $4xklQ.Vector2(e.end.x,e.end.y),n=new $4xklQ.Vector2(t.start.x,t.start.y),s=new $4xklQ.Vector2(t.end.x,t.end.y);if("Y"==i[0]){if("Y"==r[0]){if(i[1]!=r[1])return[t];{let i=Math.min(n.x,s.x),r=Math.max(n.x,s.x),l=n.x==i?n:s,h=n.x==r?n:s;if(o.x<i){if(a.x<i||a.x==i)return[t];if(a.x>i&&a.x<r)return[this.createJsonBy2Point(o,l),this.createJsonBy2Point(l,a),this.createJsonBy2Point(a,h)];if(a.x==r)return[this.createJsonBy2Point(o,l),t];if(a.x>r)return[this.createJsonBy2Point(o,l),t,this.createJsonBy2Point(h,a)]}if(o.x==i){if(a.x<i)return[t];if(a.x>i&&a.x<r)return[e,this.createJsonBy2Point(a,h)];if(a.x==r)return[t];if(a.x>r)return[t,this.createJsonBy2Point(h,a)]}if(o.x>i&&o.x<r){if(a.x<i)return[this.createJsonBy2Point(a,l),this.createJsonBy2Point(l,o),this.createJsonBy2Point(o,h)];if(a.x==i)return[e,this.createJsonBy2Point(o,h)];if(a.x>i&&a.x<o.x)return[this.createJsonBy2Point(l,a),e,this.createJsonBy2Point(o,h)];if(a.x>o.x&&a.x<r)return[this.createJsonBy2Point(l,o),e,this.createJsonBy2Point(a,h)];if(a.x==r)return[this.createJsonBy2Point(l,o),e];if(a.x>r)return[this.createJsonBy2Point(l,o),this.createJsonBy2Point(o,h),this.createJsonBy2Point(h,a)]}if(o.x==r){if(a.x<i)return[this.createJsonBy2Point(a,l),t];if(a.x==i)return[t];if(a.x>i&&a.x<r)return[this.createJsonBy2Point(l,a),e];if(a.x>r)return[t]}if(o.x>r){if(a.x<i)return[this.createJsonBy2Point(a,l),t,this.createJsonBy2Point(h,o)];if(a.x==i)return[t,this.createJsonBy2Point(h,o)];if(a.x>i&&a.x<r)return[this.createJsonBy2Point(l,a),this.createJsonBy2Point(a,h),this.createJsonBy2Point(h,o)];if(a.x==r||a.x>r)return[t]}}}if("X"==r[0]){let e=Math.min(o.x,a.x),l=Math.max(o.x,a.x),h=o.x==e?o:a,c=o.x==l?o:a,d=Math.min(n.y,s.y),p=Math.max(n.y,s.y),u=n.y==d?n:s,m=n.y==p?n:s,g=i[1]>d&&i[1]<p,f=r[1]>e&&r[1]<l;if(!g||!f)return[t];{let e=new $4xklQ.Vector2(r[1],i[1]);return[this.createJsonBy2Point(h,e),this.createJsonBy2Point(e,c),this.createJsonBy2Point(u,e),this.createJsonBy2Point(e,m)]}}}else if("X"==i[0]){if("X"==r[0]){if(i[1]!=r[1])return[t];{let i=Math.min(n.y,s.y),r=Math.max(n.y,s.y),l=n.y==i?n:s,h=n.y==r?n:s;if(o.y<i){if(a.y<i||a.y==i)return[t];if(a.y>i&&a.y<r)return[this.createJsonBy2Point(o,l),this.createJsonBy2Point(l,a),this.createJsonBy2Point(a,h)];if(a.y==r)return[this.createJsonBy2Point(o,l),t];if(a.y>r)return[this.createJsonBy2Point(o,l),t,this.createJsonBy2Point(h,a)]}if(o.y==i){if(a.y<i)return[t];if(a.y>i&&a.y<r)return[e,this.createJsonBy2Point(a,h)];if(a.y==r)return[t];if(a.y>r)return[t,this.createJsonBy2Point(h,a)]}if(o.y>i&&o.y<r){if(a.y<i)return[this.createJsonBy2Point(a,l),this.createJsonBy2Point(l,o),this.createJsonBy2Point(o,h)];if(a.y==i)return[e,this.createJsonBy2Point(o,h)];if(a.y>i&&a.y<o.y)return[this.createJsonBy2Point(l,a),e,this.createJsonBy2Point(o,h)];if(a.y>o.y&&a.y<r)return[this.createJsonBy2Point(l,o),e,this.createJsonBy2Point(a,h)];if(a.y==r)return[this.createJsonBy2Point(l,o),e];if(a.y>r)return[this.createJsonBy2Point(l,o),this.createJsonBy2Point(o,h),this.createJsonBy2Point(h,a)]}if(o.y==r){if(a.y<i)return[this.createJsonBy2Point(a,l),t];if(a.y==i)return[t];if(a.y>i&&a.y<r)return[this.createJsonBy2Point(l,a),e];if(a.y>r)return[t]}if(o.y>r){if(a.y<i)return[this.createJsonBy2Point(a,l),t,this.createJsonBy2Point(h,o)];if(a.y==i)return[t,this.createJsonBy2Point(h,o)];if(a.y>i&&a.y<r)return[this.createJsonBy2Point(l,a),this.createJsonBy2Point(a,h),this.createJsonBy2Point(h,o)];if(a.y==r||a.y>r)return[t]}}}if("Y"==r[0]){let e=Math.min(n.x,s.x),l=Math.max(n.x,s.x),h=n.x==e?n:s,c=n.x==l?n:s,d=Math.min(o.y,a.y),p=Math.max(o.y,a.y),u=o.y==d?o:a,m=o.y==p?o:a,g=i[1]>e&&i[1]<l,f=r[1]>d&&r[1]<p;if(!g||!f)return[t];{let e=new $4xklQ.Vector2(i[1],r[1]);return[this.createJsonBy2Point(h,e),this.createJsonBy2Point(e,c),this.createJsonBy2Point(u,e),this.createJsonBy2Point(e,m)]}}}return[]}mergeArr(e){let t=[];return e.forEach(e=>{t.length>0&&this.isInclude(t,e)||t.push(e)}),t}isInclude(e,t){let i=new $4xklQ.Vector2(t.start.x,t.start.y),r=new $4xklQ.Vector2(t.end.x,t.end.y);for(let t=0;t<e.length;t++){let o=new $4xklQ.Vector2(e[t].start.x,e[t].start.y),a=new $4xklQ.Vector2(e[t].end.x,e[t].end.y),n=o.equals(i)&&a.equals(r),s=o.equals(r)&&a.equals(i);if(n||s)return!0}return!1}handleCollinear(){}createJsonBy2Point(e,t){let i=this.getLineData(e,t);return{start:{x:e.x,y:e.y,z:0},end:{x:t.x,y:t.y,z:0},style:2,line:0,isArc:!1,thickness:this.thickness,height:this.height,direction:"",offsetXY:100,equation:i}}getLineData(e,t){if(e.x==t.x)var i="X",r=e.x;else if(e.y==t.y)var i="Y",r=e.y;else{var i=(e.y-t.y)/(e.x-t.x);i=Math.round(1e4*i)/1e4;var r=e.y-i*e.x}return[i,r=Math.round(1e3*r)/1e3]}getRandom(e,t){return Math.floor(Math.random()*(t-e+1))+e}getPosition(e=[]){let t=this.getRandom(0,7);return -1!=e.indexOf(t)&&(t=this.getPosition(e)),t}filterArray(e){let t=[];return e.forEach(e=>{let i=!0;t.forEach(r=>{r?e[0]===r[0]&&e[1]===r[1]&&(i=!1):t.push(e)}),i&&t.push(e)}),t}}var $hu0fb=parcelRequire("hu0fb"),$4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ");const $0684d9623c4c8e37$var$_camera=new $4xklQ.OrthographicCamera(-1,1,1,-1,0,1),$0684d9623c4c8e37$var$_geometry=new $4xklQ.BufferGeometry;$0684d9623c4c8e37$var$_geometry.setAttribute("position",new $4xklQ.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),$0684d9623c4c8e37$var$_geometry.setAttribute("uv",new $4xklQ.Float32BufferAttribute([0,2,0,0,2,0],2));class $0684d9623c4c8e37$export$3983474c8e6e978b{constructor(e){this._mesh=new $4xklQ.Mesh($0684d9623c4c8e37$var$_geometry,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,$0684d9623c4c8e37$var$_camera)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ");class $282727f340fc2a87$export$f1ac3a587b6cbb5d extends $4xklQ.ShaderMaterial{constructor(e){for(let t in super(e),this.uniforms)Object.defineProperty(this,t,{get(){return this.uniforms[t].value},set(e){this.uniforms[t].value=e}})}setDefine(e,t){null==t?e in this.defines&&(delete this.defines[e],this.needsUpdate=!0):this.defines[e]!==t&&(this.defines[e]=t,this.needsUpdate=!0)}}const $62e02ca5c2ecb453$export$207a3935c1ec5d77=`

	// https://github.com/KhronosGroup/glTF/blob/main/extensions/2.0/Khronos/KHR_materials_volume/README.md#attenuation
	vec3 transmissionAttenuation( float dist, vec3 attColor, float attDist ) {

		vec3 ot = - log( attColor ) / attDist;
		return exp( - ot * dist );

	}

	// https://google.github.io/filament/Filament.md.html#materialsystem/diffusebrdf
	float schlickFresnel( float cosine, float f0 ) {

		return f0 + ( 1.0 - f0 ) * pow( 1.0 - cosine, 5.0 );

	}

	vec3 schlickFresnel( float cosine, vec3 f0 ) {

		return f0 + ( 1.0 - f0 ) * pow( 1.0 - cosine, 5.0 );

	}

	// https://raytracing.github.io/books/RayTracingInOneWeekend.html#dielectrics/schlickapproximation
	float iorRatioToF0( float iorRatio ) {

		return pow( ( 1.0 - iorRatio ) / ( 1.0 + iorRatio ), 2.0 );

	}

	float schlickFresnelFromIor( float cosine, float iorRatio ) {

		// Schlick approximation
		float r_0 = iorRatioToF0( iorRatio );
		return schlickFresnel( cosine, r_0 );

	}

	// forms a basis with the normal vector as Z
	mat3 getBasisFromNormal( vec3 normal ) {

		vec3 other;
		if ( abs( normal.x ) > 0.5 ) {

			other = vec3( 0.0, 1.0, 0.0 );

		} else {

			other = vec3( 1.0, 0.0, 0.0 );

		}

		vec3 ortho = normalize( cross( normal, other ) );
		vec3 ortho2 = normalize( cross( normal, ortho ) );
		return mat3( ortho2, ortho, normal );

	}

	vec3 getHalfVector( vec3 a, vec3 b ) {

		return normalize( a + b );

	}

	// The discrepancy between interpolated surface normal and geometry normal can cause issues when a ray
	// is cast that is on the top side of the geometry normal plane but below the surface normal plane. If
	// we find a ray like that we ignore it to avoid artifacts.
	// This function returns if the direction is on the same side of both planes.
	bool isDirectionValid( vec3 direction, vec3 surfaceNormal, vec3 geometryNormal ) {

		bool aboveSurfaceNormal = dot( direction, surfaceNormal ) > 0.0;
		bool aboveGeometryNormal = dot( direction, geometryNormal ) > 0.0;
		return aboveSurfaceNormal == aboveGeometryNormal;

	}

	vec3 getHemisphereSample( vec3 n, vec2 uv ) {

		// https://www.rorydriscoll.com/2009/01/07/better-sampling/
		// https://graphics.pixar.com/library/OrthonormalB/paper.pdf
		float sign = n.z == 0.0 ? 1.0 : sign( n.z );
		float a = - 1.0 / ( sign + n.z );
		float b = n.x * n.y * a;
		vec3 b1 = vec3( 1.0 + sign * n.x * n.x * a, sign * b, - sign * n.x );
		vec3 b2 = vec3( b, sign + n.y * n.y * a, - n.y );

		float r = sqrt( uv.x );
		float theta = 2.0 * PI * uv.y;
		float x = r * cos( theta );
		float y = r * sin( theta );
		return x * b1 + y * b2 + sqrt( 1.0 - uv.x ) * n;

	}

	// https://www.shadertoy.com/view/wltcRS
	uvec4 s0;

	void rng_initialize(vec2 p, int frame) {

		// white noise seed
		s0 = uvec4( p, uint( frame ), uint( p.x ) + uint( p.y ) );

	}

	// https://www.pcg-random.org/
	void pcg4d( inout uvec4 v ) {

		v = v * 1664525u + 1013904223u;
		v.x += v.y * v.w;
		v.y += v.z * v.x;
		v.z += v.x * v.y;
		v.w += v.y * v.z;
		v = v ^ ( v >> 16u );
		v.x += v.y*v.w;
		v.y += v.z*v.x;
		v.z += v.x*v.y;
		v.w += v.y*v.z;

	}

	// returns [ 0, 1 ]
	float rand() {

		pcg4d(s0);
		return float( s0.x ) / float( 0xffffffffu );

	}

	vec2 rand2() {

		pcg4d( s0 );
		return vec2( s0.xy ) / float(0xffffffffu);

	}

	vec3 rand3() {

		pcg4d(s0);
		return vec3( s0.xyz ) / float( 0xffffffffu );

	}

	vec4 rand4() {

		pcg4d(s0);
		return vec4(s0)/float(0xffffffffu);

	}

	// https://github.com/mrdoob/three.js/blob/dev/src/math/Vector3.js#L724
	vec3 randDirection() {

		vec2 r = rand2();
		float u = ( r.x - 0.5 ) * 2.0;
		float t = r.y * PI * 2.0;
		float f = sqrt( 1.0 - u * u );

		return vec3( f * cos( t ), f * sin( t ), u );

	}

	vec2 triangleSample( vec2 a, vec2 b, vec2 c ) {

		// get the edges of the triangle and the diagonal across the
		// center of the parallelogram
		vec2 e1 = a - b;
		vec2 e2 = c - b;
		vec2 diag = normalize( e1 + e2 );

		// pick a random point in the parallelogram
		vec2 r = rand2();
		if ( r.x + r.y > 1.0 ) {

			r = vec2( 1.0 ) - r;

		}

		return e1 * r.x + e2 * r.y;

	}

	// samples an aperture shape with the given number of sides. 0 means circle
	vec2 sampleAperture( int blades ) {

		if ( blades == 0 ) {

			vec2 r = rand2();
			float angle = 2.0 * PI * r.x;
			float radius = sqrt( rand() );
			return vec2( cos( angle ), sin( angle ) ) * radius;

		} else {

			blades = max( blades, 3 );

			vec3 r = rand3();
			float anglePerSegment = 2.0 * PI / float( blades );
			float segment = floor( float( blades ) * r.x );

			float angle1 = anglePerSegment * segment;
			float angle2 = angle1 + anglePerSegment;
			vec2 a = vec2( sin( angle1 ), cos( angle1 ) );
			vec2 b = vec2( 0.0, 0.0 );
			vec2 c = vec2( sin( angle2 ), cos( angle2 ) );

			return triangleSample( a, b, c );

		}

	}

	float colorToLuminance( vec3 color ) {

		// https://en.wikipedia.org/wiki/Relative_luminance
		return 0.2126 * color.r + 0.7152 * color.g + 0.0722 * color.b;

	}

	// ray sampling x and z are swapped to align with expected background view
	vec2 equirectDirectionToUv( vec3 direction ) {

		// from Spherical.setFromCartesianCoords
		vec2 uv = vec2( atan( direction.z, direction.x ), acos( direction.y ) );
		uv /= vec2( 2.0 * PI, PI );

		// apply adjustments to get values in range [0, 1] and y right side up
		uv.x += 0.5;
		uv.y = 1.0 - uv.y;
		return uv;

	}

	vec3 equirectUvToDirection( vec2 uv ) {

		// undo above adjustments
		uv.x -= 0.5;
		uv.y = 1.0 - uv.y;

		// from Vector3.setFromSphericalCoords
		float theta = uv.x * 2.0 * PI;
		float phi = uv.y * PI;

		float sinPhi = sin( phi );

		return vec3( sinPhi * cos( theta ), cos( phi ), sinPhi * sin( theta ) );

	}

	// Fast arccos approximation used to remove banding artifacts caused by numerical errors in acos.
	// This is a cubic Lagrange interpolating polynomial for x = [-1, -1/2, 0, 1/2, 1].
	// For more information see: https://github.com/gkjohnson/three-gpu-pathtracer/pull/171#issuecomment-1152275248
	float acosApprox( float x ) {

		x = clamp( x, -1.0, 1.0 );
		return ( - 0.69813170079773212 * x * x - 0.87266462599716477 ) * x + 1.5707963267948966;

	}

	// An acos with input values bound to the range [-1, 1].
	float acosSafe( float x ) {

		return acos( clamp( x, -1.0, 1.0 ) );

	}

	float saturateCos( float val ) {

		return clamp( val, 0.001, 1.0 );

	}

	float square( float t ) {

		return t * t;

	}

	vec2 square( vec2 t ) {

		return t * t;

	}

	vec3 square( vec3 t ) {

		return t * t;

	}

	vec4 square( vec4 t ) {

		return t * t;

	}

	// Finds the point where the ray intersects the plane defined by u and v and checks if this point
	// falls in the bounds of the rectangle on that same plane.
	// Plane intersection: https://lousodrome.net/blog/light/2020/07/03/intersection-of-a-ray-and-a-plane/
	bool intersectsRectangle( vec3 center, vec3 normal, vec3 u, vec3 v, vec3 rayOrigin, vec3 rayDirection, out float dist ) {

		float t = dot( center - rayOrigin, normal ) / dot( rayDirection, normal );

		if ( t > EPSILON ) {

			vec3 p = rayOrigin + rayDirection * t;
			vec3 vi = p - center;

			// check if p falls inside the rectangle
			float a1 = dot( u, vi );
			if ( abs( a1 ) <= 0.5 ) {

				float a2 = dot( v, vi );
				if ( abs( a2 ) <= 0.5 ) {

					dist = t;
					return true;

				}

			}

		}

		return false;

	}

	// Finds the point where the ray intersects the plane defined by u and v and checks if this point
	// falls in the bounds of the circle on that same plane. See above URL for a description of the plane intersection algorithm.
	bool intersectsCircle( vec3 position, vec3 normal, vec3 u, vec3 v, vec3 rayOrigin, vec3 rayDirection, out float dist ) {

		float t = dot( position - rayOrigin, normal ) / dot( rayDirection, normal );

		if ( t > EPSILON ) {

			vec3 hit = rayOrigin + rayDirection * t;
			vec3 vi = hit - position;

			float a1 = dot( u, vi );
			float a2 = dot( v, vi );

			if( length( vec2( a1, a2 ) ) <= 0.5 ) {

				dist = t;
				return true;

			}

		}

		return false;

	}

	// power heuristic for multiple importance sampling
	float misHeuristic( float a, float b ) {

		float aa = a * a;
		float bb = b * b;
		return aa / ( aa + bb );

	}

`;class $510c5bcb198fe0d5$var$PMREMCopyMaterial extends $282727f340fc2a87$export$f1ac3a587b6cbb5d{constructor(){super({uniforms:{envMap:{value:null},blur:{value:0}},vertexShader:`

				varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}

			`,fragmentShader:`

				#include <common>
				#include <cube_uv_reflection_fragment>

				${$62e02ca5c2ecb453$export$207a3935c1ec5d77}

				uniform sampler2D envMap;
				uniform float blur;
				varying vec2 vUv;
				void main() {

					vec3 rayDirection = equirectUvToDirection( vUv );
					gl_FragColor = textureCubeUV( envMap, rayDirection, blur );

				}

			`})}}class $510c5bcb198fe0d5$export$13ef63fd7e562136{constructor(e){this.renderer=e,this.pmremGenerator=new $4xklQ.PMREMGenerator(e),this.copyQuad=new $0684d9623c4c8e37$export$3983474c8e6e978b(new $510c5bcb198fe0d5$var$PMREMCopyMaterial),this.renderTarget=new $4xklQ.WebGLRenderTarget(1,1,{type:$4xklQ.FloatType,format:$4xklQ.RGBAFormat})}dispose(){this.pmremGenerator.dispose(),this.copyQuad.dispose(),this.renderTarget.dispose()}generate(e,t){let{pmremGenerator:i,renderTarget:r,copyQuad:o,renderer:a}=this,n=i.fromEquirectangular(e),{width:s,height:l}=e.image;r.setSize(s,l),o.material.envMap=n.texture,o.material.blur=t;let h=a.getRenderTarget(),c=a.autoClear;a.setRenderTarget(r),a.autoClear=!0,o.render(a),a.setRenderTarget(h),a.autoClear=c;let d=new Float32Array(s*l*4);a.readRenderTargetPixels(r,0,0,s,l,d);let p=new $4xklQ.DataTexture(d,s,l,$4xklQ.RGBAFormat,$4xklQ.FloatType);return p.minFilter=e.minFilter,p.magFilter=e.magFilter,p.wrapS=e.wrapS,p.wrapT=e.wrapT,p.mapping=$4xklQ.EquirectangularReflectionMapping,p.needsUpdate=!0,p}}var $4xklQ=parcelRequire("4xklQ");class $2d12cfdcbb70f909$export$e6c92f54dc85f279 extends $282727f340fc2a87$export$f1ac3a587b6cbb5d{constructor(e){super({blending:$4xklQ.NoBlending,transparent:!1,depthWrite:!1,depthTest:!1,defines:{USE_SLIDER:0},uniforms:{sigma:{value:5},threshold:{value:.03},kSigma:{value:1},map:{value:null}},vertexShader:`

				varying vec2 vUv;

				void main() {

					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

				}

			`,fragmentShader:`

				//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
				//  Copyright (c) 2018-2019 Michele Morrone
				//  All rights reserved.
				//
				//  https://michelemorrone.eu - https://BrutPitt.com
				//
				//  me@michelemorrone.eu - brutpitt@gmail.com
				//  twitter: @BrutPitt - github: BrutPitt
				//
				//  https://github.com/BrutPitt/glslSmartDeNoise/
				//
				//  This software is distributed under the terms of the BSD 2-Clause license
				//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

				uniform sampler2D map;

				uniform float sigma;
				uniform float threshold;
				uniform float kSigma;

				varying vec2 vUv;

				#define INV_SQRT_OF_2PI 0.39894228040143267793994605993439
				#define INV_PI 0.31830988618379067153776752674503

				// Parameters:
				//	 sampler2D tex	 - sampler image / texture
				//	 vec2 uv		   - actual fragment coord
				//	 float sigma  >  0 - sigma Standard Deviation
				//	 float kSigma >= 0 - sigma coefficient
				//		 kSigma * sigma  -->  radius of the circular kernel
				//	 float threshold   - edge sharpening threshold
				vec4 smartDeNoise( sampler2D tex, vec2 uv, float sigma, float kSigma, float threshold ) {

					float radius = round( kSigma * sigma );
					float radQ = radius * radius;

					float invSigmaQx2 = 0.5 / ( sigma * sigma );
					float invSigmaQx2PI = INV_PI * invSigmaQx2;

					float invThresholdSqx2 = 0.5 / ( threshold * threshold );
					float invThresholdSqrt2PI = INV_SQRT_OF_2PI / threshold;

					vec4 centrPx = texture2D( tex, uv );
					centrPx.rgb *= centrPx.a;

					float zBuff = 0.0;
					vec4 aBuff = vec4( 0.0 );
					vec2 size = vec2( textureSize( tex, 0 ) );

					vec2 d;
					for ( d.x = - radius; d.x <= radius; d.x ++ ) {

						float pt = sqrt( radQ - d.x * d.x );

						for ( d.y = - pt; d.y <= pt; d.y ++ ) {

							float blurFactor = exp( - dot( d, d ) * invSigmaQx2 ) * invSigmaQx2PI;

							vec4 walkPx = texture2D( tex, uv + d / size );
							walkPx.rgb *= walkPx.a;

							vec4 dC = walkPx - centrPx;
							float deltaFactor = exp( - dot( dC.rgba, dC.rgba ) * invThresholdSqx2 ) * invThresholdSqrt2PI * blurFactor;

							zBuff += deltaFactor;
							aBuff += deltaFactor * walkPx;

						}

					}

					return aBuff / zBuff;

				}

				void main() {

					gl_FragColor = smartDeNoise( map, vec2( vUv.x, vUv.y ), sigma, kSigma, threshold );
					#include <tonemapping_fragment>
					#include <encodings_fragment>
					#include <premultiplied_alpha_fragment>

				}

			`}),this.setValues(e)}}var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ");class $537940c5fc961741$export$70ee8b3cbd6f21d8 extends $282727f340fc2a87$export$f1ac3a587b6cbb5d{constructor(e){super({blending:$4xklQ.NoBlending,uniforms:{target1:{value:null},target2:{value:null},opacity:{value:1}},vertexShader:`

				varying vec2 vUv;

				void main() {

					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

				}`,fragmentShader:`

				uniform float opacity;

				uniform sampler2D target1;
				uniform sampler2D target2;

				varying vec2 vUv;

				void main() {

					vec4 color1 = texture2D( target1, vUv );
					vec4 color2 = texture2D( target2, vUv );

					float invOpacity = 1.0 - opacity;
					float totalAlpha = color1.a * invOpacity + color2.a * opacity;

					if ( color1.a != 0.0 || color2.a != 0.0 ) {

						gl_FragColor.rgb = color1.rgb * ( invOpacity * color1.a / totalAlpha ) + color2.rgb * ( opacity * color2.a / totalAlpha );
						gl_FragColor.a = totalAlpha;

					} else {

						gl_FragColor = vec4( 0.0 );

					}

				}`}),this.setValues(e)}}function*$2b66122c32049261$var$renderTask(){let{_renderer:e,_fsQuad:t,_blendQuad:i,_primaryTarget:r,_blendTargets:o,alpha:a,camera:n,material:s}=this,l=i.material,[h,c]=o;for(;;){a?(l.opacity=1/(this.samples+1),s.blending=$4xklQ.NoBlending,s.opacity=1):(s.opacity=1/(this.samples+1),s.blending=$4xklQ.NormalBlending);let o=r.width,d=r.height;s.resolution.set(o,d),s.seed++;let p=this.tiles.x||1,u=this.tiles.y||1,m=p*u,g=1/e.getPixelRatio();for(let f=0;f<u;f++)for(let w=0;w<p;w++){s.cameraWorldMatrix.copy(n.matrixWorld),s.invProjectionMatrix.copy(n.projectionMatrixInverse);let y=0;n.projectionMatrix.elements[15]>0&&(y=1),n.isEquirectCamera&&(y=2),s.setDefine("CAMERA_TYPE",y);let b=e.getRenderTarget(),x=e.autoClear,P=w,v=f;if(!this.stableTiles){let e=this._currentTile%(p*u);P=e%p,v=~~(e/p),this._currentTile=e+1}e.setRenderTarget(r),e.setScissorTest(!0),e.setScissor(g*Math.ceil(P*o/p),g*Math.ceil((u-v-1)*d/u),g*Math.ceil(o/p),g*Math.ceil(d/u)),e.autoClear=!1,t.render(e),e.setScissorTest(!1),e.setRenderTarget(b),e.autoClear=x,a&&(l.target1=h.texture,l.target2=r.texture,e.setRenderTarget(c),i.render(e),e.setRenderTarget(b)),this.samples+=1/m,yield}[h,c]=[c,h],this.samples=Math.round(this.samples)}}const $2b66122c32049261$var$ogClearColor=new $4xklQ.Color;class $2b66122c32049261$export$196da6cc71a4331{get material(){return this._fsQuad.material}set material(e){this._fsQuad.material=e}get target(){return this._alpha?this._blendTargets[1]:this._primaryTarget}set alpha(e){e||(this._blendTargets[0].dispose(),this._blendTargets[1].dispose()),this._alpha=e,this.reset()}get alpha(){return this._alpha}constructor(e){this.camera=null,this.tiles=new $4xklQ.Vector2(1,1),this.samples=0,this.stableNoise=!1,this.stableTiles=!0,this._renderer=e,this._alpha=!1,this._fsQuad=new $0684d9623c4c8e37$export$3983474c8e6e978b(null),this._blendQuad=new $0684d9623c4c8e37$export$3983474c8e6e978b(new $537940c5fc961741$export$70ee8b3cbd6f21d8),this._task=null,this._currentTile=0,this._primaryTarget=new $4xklQ.WebGLRenderTarget(1,1,{format:$4xklQ.RGBAFormat,type:$4xklQ.FloatType}),this._blendTargets=[new $4xklQ.WebGLRenderTarget(1,1,{format:$4xklQ.RGBAFormat,type:$4xklQ.FloatType}),new $4xklQ.WebGLRenderTarget(1,1,{format:$4xklQ.RGBAFormat,type:$4xklQ.FloatType})]}setSize(e,t){this._primaryTarget.setSize(e,t),this._blendTargets[0].setSize(e,t),this._blendTargets[1].setSize(e,t),this.reset()}dispose(){this._primaryTarget.dispose(),this._blendTargets[0].dispose(),this._blendTargets[1].dispose(),this._fsQuad.dispose(),this._blendQuad.dispose(),this._task=null}reset(){let{_renderer:e,_primaryTarget:t,_blendTargets:i}=this,r=e.getRenderTarget(),o=e.getClearAlpha();e.getClearColor($2b66122c32049261$var$ogClearColor),e.setRenderTarget(t),e.setClearColor(0,0),e.clearColor(),e.setRenderTarget(i[0]),e.setClearColor(0,0),e.clearColor(),e.setRenderTarget(i[1]),e.setClearColor(0,0),e.clearColor(),e.setClearColor($2b66122c32049261$var$ogClearColor,o),e.setRenderTarget(r),this.samples=0,this._task=null,this.stableNoise&&(this.material.seed=0)}update(){this._task||(this._task=$2b66122c32049261$var$renderTask.call(this)),this._task.next()}}var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ");function $e3f9574644e4828d$var$countToStringFormat(e){switch(e){case 1:return"R";case 2:return"RG";case 3:case 4:return"RGBA"}throw Error()}function $e3f9574644e4828d$var$countToFormat(e){switch(e){case 1:return $4xklQ.RedFormat;case 2:return $4xklQ.RGFormat;case 3:case 4:return $4xklQ.RGBAFormat}}function $e3f9574644e4828d$var$countToIntFormat(e){switch(e){case 1:return $4xklQ.RedIntegerFormat;case 2:return $4xklQ.RGIntegerFormat;case 3:case 4:return $4xklQ.RGBAIntegerFormat}}class $e3f9574644e4828d$export$2ba8de89bc26b001 extends $4xklQ.DataTexture{constructor(){super(),this.minFilter=$4xklQ.NearestFilter,this.magFilter=$4xklQ.NearestFilter,this.generateMipmaps=!1,this.overrideItemSize=null,this._forcedType=null}updateFrom(e){let t,i,r,o;let a=this.overrideItemSize,n=e.itemSize,s=e.count;if(null!==a){if(n*s%a!=0)throw Error("VertexAttributeTexture: overrideItemSize must divide evenly into buffer length.");e.itemSize=a,e.count=s*n/a}let l=e.itemSize,h=e.count,c=e.normalized,d=e.array.constructor,p=d.BYTES_PER_ELEMENT,u=this._forcedType,m=l;if(null===u)switch(d){case Float32Array:u=$4xklQ.FloatType;break;case Uint8Array:case Uint16Array:case Uint32Array:u=$4xklQ.UnsignedIntType;break;case Int8Array:case Int16Array:case Int32Array:u=$4xklQ.IntType}let g=$e3f9574644e4828d$var$countToStringFormat(l);switch(u){case $4xklQ.FloatType:r=1,i=$e3f9574644e4828d$var$countToFormat(l),c&&1===p?(o=d,g+="8",d===Uint8Array?t=$4xklQ.UnsignedByteType:(t=$4xklQ.ByteType,g+="_SNORM")):(o=Float32Array,g+="32F",t=$4xklQ.FloatType);break;case $4xklQ.IntType:g+=8*p+"I",r=c?Math.pow(2,8*d.BYTES_PER_ELEMENT-1):1,i=$e3f9574644e4828d$var$countToIntFormat(l),1===p?(o=Int8Array,t=$4xklQ.ByteType):2===p?(o=Int16Array,t=$4xklQ.ShortType):(o=Int32Array,t=$4xklQ.IntType);break;case $4xklQ.UnsignedIntType:g+=8*p+"UI",r=c?Math.pow(2,8*d.BYTES_PER_ELEMENT-1):1,i=$e3f9574644e4828d$var$countToIntFormat(l),1===p?(o=Uint8Array,t=$4xklQ.UnsignedByteType):2===p?(o=Uint16Array,t=$4xklQ.UnsignedShortType):(o=Uint32Array,t=$4xklQ.UnsignedIntType)}3===m&&(i===$4xklQ.RGBAFormat||i===$4xklQ.RGBAIntegerFormat)&&(m=4);let f=Math.ceil(Math.sqrt(h)),w=m*f*f,y=new o(w);for(let t=0;t<h;t++){let i=m*t;y[i]=e.getX(t)/r,l>=2&&(y[i+1]=e.getY(t)/r),l>=3&&(y[i+2]=e.getZ(t)/r,4===m&&(y[i+3]=1)),l>=4&&(y[i+3]=e.getW(t)/r)}this.internalFormat=g,this.format=i,this.type=t,this.image.width=f,this.image.height=f,this.image.data=y,this.needsUpdate=!0,this.dispose(),e.itemSize=n,e.count=s}}class $e3f9574644e4828d$export$de036370a093ef extends $e3f9574644e4828d$export$2ba8de89bc26b001{constructor(){super(),this._forcedType=$4xklQ.UnsignedIntType}}class $e3f9574644e4828d$export$5444fd0f1815741f extends $e3f9574644e4828d$export$2ba8de89bc26b001{constructor(){super(),this._forcedType=$4xklQ.FloatType}}var $4xklQ=parcelRequire("4xklQ"),$ckwVR=parcelRequire("ckwVR"),$kBHG0=parcelRequire("kBHG0");function $f0895efafb08d2de$var$bvhToTextures(e,t,i){let r=e._roots;if(1!==r.length)throw Error("MeshBVHUniformStruct: Multi-root BVHs not supported.");let o=r[0],a=new Uint16Array(o),n=new Uint32Array(o),s=new Float32Array(o),l=o.byteLength/$ckwVR.BYTES_PER_NODE,h=2*Math.ceil(Math.sqrt(l/2)),c=new Float32Array(4*h*h),d=Math.ceil(Math.sqrt(l)),p=new Uint32Array(2*d*d);for(let e=0;e<l;e++){let t=e*$ckwVR.BYTES_PER_NODE/4,i=2*t,r=(0,$kBHG0.BOUNDING_DATA_INDEX)(t);for(let t=0;t<3;t++)c[8*e+0+t]=s[r+0+t],c[8*e+4+t]=s[r+3+t];if((0,$kBHG0.IS_LEAF)(i,a)){let r=(0,$kBHG0.COUNT)(i,a),o=(0,$kBHG0.OFFSET)(t,n),s=4294901760|r;p[2*e+0]=s,p[2*e+1]=o}else{let i=4*(0,$kBHG0.RIGHT_NODE)(t,n)/$ckwVR.BYTES_PER_NODE,r=(0,$kBHG0.SPLIT_AXIS)(t,n);p[2*e+0]=r,p[2*e+1]=i}}t.image.data=c,t.image.width=h,t.image.height=h,t.format=$4xklQ.RGBAFormat,t.type=$4xklQ.FloatType,t.internalFormat="RGBA32F",t.minFilter=$4xklQ.NearestFilter,t.magFilter=$4xklQ.NearestFilter,t.generateMipmaps=!1,t.needsUpdate=!0,t.dispose(),i.image.data=p,i.image.width=d,i.image.height=d,i.format=$4xklQ.RGIntegerFormat,i.type=$4xklQ.UnsignedIntType,i.internalFormat="RG32UI",i.minFilter=$4xklQ.NearestFilter,i.magFilter=$4xklQ.NearestFilter,i.generateMipmaps=!1,i.needsUpdate=!0,i.dispose()}class $f0895efafb08d2de$export$4dc20da53fccce35{constructor(){this.autoDispose=!0,this.index=new $e3f9574644e4828d$export$de036370a093ef,this.position=new $e3f9574644e4828d$export$5444fd0f1815741f,this.bvhBounds=new $4xklQ.DataTexture,this.bvhContents=new $4xklQ.DataTexture,this.index.overrideItemSize=3}updateFrom(e){let{geometry:t}=e;$f0895efafb08d2de$var$bvhToTextures(e,this.bvhBounds,this.bvhContents),this.index.updateFrom(t.index),this.position.updateFrom(t.attributes.position)}dispose(){let{index:e,position:t,bvhBounds:i,bvhContents:r}=this;e&&e.dispose(),t&&t.dispose(),i&&i.dispose(),r&&r.dispose()}}const $3dd70ff3f09b62fc$export$1b1b39b9861ca334=`
#ifndef TRI_INTERSECT_EPSILON
#define TRI_INTERSECT_EPSILON 1e-5
#endif

#ifndef INFINITY
#define INFINITY 1e20
#endif

struct BVH {

	usampler2D index;
	sampler2D position;

	sampler2D bvhBounds;
	usampler2D bvhContents;

};

// Note that a struct cannot be used for the hit record including faceIndices, faceNormal, barycoord,
// side, and dist because on some mobile GPUS (such as Adreno) numbers are afforded less precision specifically
// when in a struct leading to inaccurate hit results. See KhronosGroup/WebGL#3351 for more details.
`,$3dd70ff3f09b62fc$export$69755dc6a3b03474=`

uvec4 uTexelFetch1D( usampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

ivec4 iTexelFetch1D( isampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 texelFetch1D( sampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {

	return
		barycoord.x * texelFetch1D( tex, faceIndices.x ) +
		barycoord.y * texelFetch1D( tex, faceIndices.y ) +
		barycoord.z * texelFetch1D( tex, faceIndices.z );

}

void ndcToCameraRay(
	vec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,
	out vec3 rayOrigin, out vec3 rayDirection
) {

	// get camera look direction and near plane for camera clipping
	vec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );
	vec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );
	float near = abs( nearVector.z / nearVector.w );

	// get the camera direction and position from camera matrices
	vec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );
	direction /= direction.w;
	direction = cameraWorld * direction - origin;

	// slide the origin along the ray until it sits at the near clip plane position
	origin.xyz += direction.xyz * near / dot( direction, lookDirection );

	rayOrigin = origin.xyz;
	rayDirection = direction.xyz;

}

float intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax ) {

	// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/
	// https://tavianator.com/2011/ray_box.html
	vec3 invDir = 1.0 / rayDirection;

	// find intersection distances for each plane
	vec3 tMinPlane = invDir * ( boundsMin - rayOrigin );
	vec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );

	// get the min and max distances from each intersection
	vec3 tMinHit = min( tMaxPlane, tMinPlane );
	vec3 tMaxHit = max( tMaxPlane, tMinPlane );

	// get the furthest hit distance
	vec2 t = max( tMinHit.xx, tMinHit.yz );
	float t0 = max( t.x, t.y );

	// get the minimum hit distance
	t = min( tMaxHit.xx, tMaxHit.yz );
	float t1 = min( t.x, t.y );

	// set distance to 0.0 if the ray starts inside the box
	float dist = max( t0, 0.0 );

	return t1 >= dist ? dist : INFINITY;

}

bool intersectsTriangle(
	vec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,
	out vec3 barycoord, out vec3 norm, out float dist, out float side
) {

	// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d
	vec3 edge1 = b - a;
	vec3 edge2 = c - a;
	norm = cross( edge1, edge2 );

	float det = - dot( rayDirection, norm );
	float invdet = 1.0 / det;

	vec3 AO = rayOrigin - a;
	vec3 DAO = cross( AO, rayDirection );

	vec4 uvt;
	uvt.x = dot( edge2, DAO ) * invdet;
	uvt.y = - dot( edge1, DAO ) * invdet;
	uvt.z = dot( AO, norm ) * invdet;
	uvt.w = 1.0 - uvt.x - uvt.y;

	// set the hit information
	barycoord = uvt.wxy; // arranged in A, B, C order
	dist = uvt.z;
	side = sign( det );
	norm = side * normalize( norm );

	// add an epsilon to avoid misses between triangles
	uvt += vec4( TRI_INTERSECT_EPSILON );

	return all( greaterThanEqual( uvt, vec4( 0.0 ) ) );

}

bool intersectTriangles(
	BVH bvh, vec3 rayOrigin, vec3 rayDirection, uint offset, uint count,
	inout float minDistance,

	// output variables
	out uvec4 faceIndices, out vec3 faceNormal, out vec3 barycoord,
	out float side, out float dist
) {

	bool found = false;
	vec3 localBarycoord, localNormal;
	float localDist, localSide;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( bvh.index, i ).xyz;
		vec3 a = texelFetch1D( bvh.position, indices.x ).rgb;
		vec3 b = texelFetch1D( bvh.position, indices.y ).rgb;
		vec3 c = texelFetch1D( bvh.position, indices.z ).rgb;

		if (
			intersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )
			&& localDist < minDistance
		) {

			found = true;
			minDistance = localDist;

			faceIndices = uvec4( indices.xyz, i );
			faceNormal = localNormal;

			side = localSide;
			barycoord = localBarycoord;
			dist = localDist;

		}

	}

	return found;

}

float intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, BVH bvh, uint currNodeIndex ) {

	vec3 boundsMin = texelFetch1D( bvh.bvhBounds, currNodeIndex * 2u + 0u ).xyz;
	vec3 boundsMax = texelFetch1D( bvh.bvhBounds, currNodeIndex * 2u + 1u ).xyz;
	return intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax );

}

bool bvhIntersectFirstHit(
	BVH bvh, vec3 rayOrigin, vec3 rayDirection,

	// output variables
	out uvec4 faceIndices, out vec3 faceNormal, out vec3 barycoord,
	out float side, out float dist
) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ 60 ];
	stack[ 0 ] = 0u;

	float triangleDistance = 1e20;
	bool found = false;
	while ( ptr > - 1 && ptr < 60 ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance = intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh, currNodeIndex );
		if ( boundsHitDistance == INFINITY || boundsHitDistance > triangleDistance ) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh.bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );

		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;

			found = intersectTriangles(
				bvh, rayOrigin, rayDirection, offset, count, triangleDistance,
				faceIndices, faceNormal, barycoord, side, dist
			) || found;

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;

			bool leftToRight = rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;

			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return found;

}

`,$de1654de00d21b4e$export$570ab67b705632a4=`

	struct PhysicalCamera {

		float focusDistance;
		float anamorphicRatio;
		float bokehSize;
		int apertureBlades;
		float apertureRotation;

	};

	struct EquirectHdrInfo {

		sampler2D marginalWeights;
		sampler2D conditionalWeights;
		sampler2D map;

		float totalSumWhole;
		float totalSumDecimal;

	};

	struct Material {

		vec3 color;
		int map;

		float metalness;
		int metalnessMap;

		float roughness;
		int roughnessMap;

		float ior;
		float transmission;
		int transmissionMap;

		float emissiveIntensity;
		vec3 emissive;
		int emissiveMap;

		int normalMap;
		vec2 normalScale;

		float clearcoat;
		int clearcoatMap;
		int clearcoatNormalMap;
		vec2 clearcoatNormalScale;
		float clearcoatRoughness;
		int clearcoatRoughnessMap;

		int iridescenceMap;
		int iridescenceThicknessMap;
		float iridescence;
		float iridescenceIor;
		float iridescenceThicknessMinimum;
		float iridescenceThicknessMaximum;

		vec3 specularColor;
		int specularColorMap;

		float specularIntensity;
		int specularIntensityMap;
		bool thinFilm;

		vec3 attenuationColor;
		float attenuationDistance;

		int alphaMap;

		bool castShadow;
		float opacity;
		float alphaTest;

		float side;
		bool matte;

		vec3 sheenColor;
		int sheenColorMap;
		float sheenRoughness;
		int sheenRoughnessMap;

		bool vertexColors;
		bool transparent;

		mat3 mapTransform;
		mat3 metalnessMapTransform;
		mat3 roughnessMapTransform;
		mat3 transmissionMapTransform;
		mat3 emissiveMapTransform;
		mat3 normalMapTransform;
		mat3 clearcoatMapTransform;
		mat3 clearcoatNormalMapTransform;
		mat3 clearcoatRoughnessMapTransform;
		mat3 sheenColorMapTransform;
		mat3 sheenRoughnessMapTransform;
		mat3 iridescenceMapTransform;
		mat3 iridescenceThicknessMapTransform;
		mat3 specularColorMapTransform;
		mat3 specularIntensityMapTransform;

	};

	mat3 readTextureTransform( sampler2D tex, uint index ) {

		mat3 textureTransform;

		vec4 row1 = texelFetch1D( tex, index );
		vec4 row2 = texelFetch1D( tex, index + 1u );

		textureTransform[0] = vec3(row1.r, row2.r, 0.0);
		textureTransform[1] = vec3(row1.g, row2.g, 0.0);
		textureTransform[2] = vec3(row1.b, row2.b, 1.0);

		return textureTransform;

	}

	Material readMaterialInfo( sampler2D tex, uint index ) {

		uint i = index * 45u;

		vec4 s0 = texelFetch1D( tex, i + 0u );
		vec4 s1 = texelFetch1D( tex, i + 1u );
		vec4 s2 = texelFetch1D( tex, i + 2u );
		vec4 s3 = texelFetch1D( tex, i + 3u );
		vec4 s4 = texelFetch1D( tex, i + 4u );
		vec4 s5 = texelFetch1D( tex, i + 5u );
		vec4 s6 = texelFetch1D( tex, i + 6u );
		vec4 s7 = texelFetch1D( tex, i + 7u );
		vec4 s8 = texelFetch1D( tex, i + 8u );
		vec4 s9 = texelFetch1D( tex, i + 9u );
		vec4 s10 = texelFetch1D( tex, i + 10u );
		vec4 s11 = texelFetch1D( tex, i + 11u );
		vec4 s12 = texelFetch1D( tex, i + 12u );
		vec4 s13 = texelFetch1D( tex, i + 13u );
		vec4 s14 = texelFetch1D( tex, i + 14u );

		Material m;
		m.color = s0.rgb;
		m.map = int( round( s0.a ) );

		m.metalness = s1.r;
		m.metalnessMap = int( round( s1.g ) );
		m.roughness = s1.b;
		m.roughnessMap = int( round( s1.a ) );

		m.ior = s2.r;
		m.transmission = s2.g;
		m.transmissionMap = int( round( s2.b ) );
		m.emissiveIntensity = s2.a;

		m.emissive = s3.rgb;
		m.emissiveMap = int( round( s3.a ) );

		m.normalMap = int( round( s4.r ) );
		m.normalScale = s4.gb;

		m.clearcoat = s4.a;
		m.clearcoatMap = int( round( s5.r ) );
		m.clearcoatRoughness = s5.g;
		m.clearcoatRoughnessMap = int( round( s5.b ) );
		m.clearcoatNormalMap = int( round( s5.a ) );
		m.clearcoatNormalScale = s6.rg;

		m.sheenColor = s7.rgb;
		m.sheenColorMap = int( round( s7.a ) );
		m.sheenRoughness = s8.r;
		m.sheenRoughnessMap = int( round( s8.g ) );

		m.iridescenceMap = int( round( s8.b ) );
		m.iridescenceThicknessMap = int( round( s8.a ) );
		m.iridescence = s9.r;
		m.iridescenceIor = s9.g;
		m.iridescenceThicknessMinimum = s9.b;
		m.iridescenceThicknessMaximum = s9.a;

		m.specularColor = s10.rgb;
		m.specularColorMap = int( round( s10.a ) );

		m.specularIntensity = s11.r;
		m.specularIntensityMap = int( round( s11.g ) );
		m.thinFilm = bool( s11.b );

		m.attenuationColor = s12.rgb;
		m.attenuationDistance = s12.a;

		m.alphaMap = int( round( s13.r ) );

		m.opacity = s13.g;
		m.alphaTest = s13.b;
		m.side = s13.a;

		m.matte = bool( s14.r );
		m.castShadow = ! bool( s14.g );
		m.vertexColors = bool( s14.b );
		m.transparent = bool( s14.a );

		uint firstTextureTransformIdx = i + 15u;

		m.mapTransform = m.map == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx );
		m.metalnessMapTransform = m.metalnessMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 2u );
		m.roughnessMapTransform = m.roughnessMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 4u );
		m.transmissionMapTransform = m.transmissionMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 6u );
		m.emissiveMapTransform = m.emissiveMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 8u );
		m.normalMapTransform = m.normalMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 10u );
		m.clearcoatMapTransform = m.clearcoatMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 12u );
		m.clearcoatNormalMapTransform = m.clearcoatNormalMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 14u );
		m.clearcoatRoughnessMapTransform = m.clearcoatRoughnessMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 16u );
		m.sheenColorMapTransform = m.sheenColorMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 18u );
		m.sheenRoughnessMapTransform = m.sheenRoughnessMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 20u );
		m.iridescenceMapTransform = m.iridescenceMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 22u );
		m.iridescenceThicknessMapTransform = m.iridescenceThicknessMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 24u );
		m.specularColorMapTransform = m.specularColorMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 26u );
		m.specularIntensityMapTransform = m.specularIntensityMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 28u );

		return m;

	}

`,$de1654de00d21b4e$export$2861714a2bd5835b=`

	#define RECT_AREA_LIGHT_TYPE 0
	#define CIRC_AREA_LIGHT_TYPE 1
	#define SPOT_LIGHT_TYPE 2

	struct LightsInfo {

		sampler2D tex;
		uint count;

	};

	struct Light {

		vec3 position;
		int type;

		vec3 color;
		float intensity;

		vec3 u;
		vec3 v;
		float area;

		// spot light fields
		float radius;
		float near;
		float decay;
		float distance;
		float coneCos;
		float penumbraCos;
		int iesProfile;

	};

	Light readLightInfo( sampler2D tex, uint index ) {

		uint i = index * 6u;

		vec4 s0 = texelFetch1D( tex, i + 0u );
		vec4 s1 = texelFetch1D( tex, i + 1u );
		vec4 s2 = texelFetch1D( tex, i + 2u );
		vec4 s3 = texelFetch1D( tex, i + 3u );

		Light l;
		l.position = s0.rgb;
		l.type = int( round( s0.a ) );

		l.color = s1.rgb;
		l.intensity = s1.a;

		l.u = s2.rgb;
		l.v = s3.rgb;
		l.area = s3.a;

		if ( l.type == SPOT_LIGHT_TYPE ) {

			vec4 s4 = texelFetch1D( tex, i + 4u );
			vec4 s5 = texelFetch1D( tex, i + 5u );
			l.radius = s4.r;
			l.near = s4.g;
			l.decay = s4.b;
			l.distance = s4.a;

			l.coneCos = s5.r;
			l.penumbraCos = s5.g;
			l.iesProfile = int( round ( s5.b ) );

		}

		return l;

	}

	struct SpotLight {

		vec3 position;
		int type;

		vec3 color;
		float intensity;

		vec3 u;
		vec3 v;
		float area;

		float radius;
		float near;
		float decay;
		float distance;
		float coneCos;
		float penumbraCos;
		int iesProfile;

	};

`;var $4xklQ=parcelRequire("4xklQ");const $dd32143970950b7f$var$MATERIAL_PIXELS=45,$dd32143970950b7f$var$MATERIAL_STRIDE=4*$dd32143970950b7f$var$MATERIAL_PIXELS,$dd32143970950b7f$var$SIDE_OFFSET=55,$dd32143970950b7f$var$MATTE_OFFSET=56,$dd32143970950b7f$var$SHADOW_OFFSET=57;class $dd32143970950b7f$export$ae96f3619813ce17 extends $4xklQ.DataTexture{constructor(){super(new Float32Array(4),1,1),this.format=$4xklQ.RGBAFormat,this.type=$4xklQ.FloatType,this.wrapS=$4xklQ.ClampToEdgeWrapping,this.wrapT=$4xklQ.ClampToEdgeWrapping,this.generateMipmaps=!1,this.threeCompatibilityTransforms=!1}setCastShadow(e,t){let i=this.image.data,r=e*$dd32143970950b7f$var$MATERIAL_STRIDE+$dd32143970950b7f$var$SHADOW_OFFSET;i[r]=t?0:1}getCastShadow(e){let t=this.image.data,i=e*$dd32143970950b7f$var$MATERIAL_STRIDE+$dd32143970950b7f$var$SHADOW_OFFSET;return!t[i]}setSide(e,t){let i=this.image.data,r=e*$dd32143970950b7f$var$MATERIAL_STRIDE+$dd32143970950b7f$var$SIDE_OFFSET;switch(t){case $4xklQ.FrontSide:i[r]=1;break;case $4xklQ.BackSide:i[r]=-1;break;case $4xklQ.DoubleSide:i[r]=0}}getSide(e){let t=this.image.data,i=e*$dd32143970950b7f$var$MATERIAL_STRIDE+$dd32143970950b7f$var$SIDE_OFFSET;switch(t[i]){case 0:return $4xklQ.DoubleSide;case 1:return $4xklQ.FrontSide;case -1:return $4xklQ.BackSide}return 0}setMatte(e,t){let i=this.image.data,r=e*$dd32143970950b7f$var$MATERIAL_STRIDE+$dd32143970950b7f$var$MATTE_OFFSET;i[r]=t?1:0}getMatte(e){let t=this.image.data,i=e*$dd32143970950b7f$var$MATERIAL_STRIDE+$dd32143970950b7f$var$MATTE_OFFSET;return!!t[i]}updateFrom(e,t){function i(e,i,r=-1){return i in e?t.indexOf(e[i]):r}function r(e,t,i){return t in e?e[t]:i}function o(e){return e.map||e.specularMap||e.displacementMap||e.normalMap||e.bumpMap||e.roughnessMap||e.metalnessMap||e.alphaMap||e.emissiveMap||e.clearcoatMap||e.clearcoatNormalMap||e.clearcoatRoughnessMap||e.iridescenceMap||e.iridescenceThicknessMap||e.specularIntensityMap||e.specularColorMap||e.transmissionMap||e.thicknessMap||e.sheenColorMap||e.sheenRoughnessMap||null}function a(e,t,i,r){let a;if(a=h?o(e):e[t]&&e[t].isTexture?e[t]:null){let e=a.matrix.elements,t=0;i[r+t++]=e[0],i[r+t++]=e[3],i[r+t++]=e[6],t++,i[r+t++]=e[1],i[r+t++]=e[4],i[r+t++]=e[7],t++}return 8}let n=0,s=e.length*$dd32143970950b7f$var$MATERIAL_PIXELS,l=Math.ceil(Math.sqrt(s)),{threeCompatibilityTransforms:h,image:c}=this;c.width!==l&&(this.dispose(),c.data=new Float32Array(l*l*4),c.width=l,c.height=l);let d=c.data;for(let o=0,s=e.length;o<s;o++){let s=e[o];d[n++]=s.color.r,d[n++]=s.color.g,d[n++]=s.color.b,d[n++]=i(s,"map"),d[n++]=r(s,"metalness",0),d[n++]=t.indexOf(s.metalnessMap),d[n++]=r(s,"roughness",0),d[n++]=t.indexOf(s.roughnessMap),d[n++]=r(s,"ior",1.5),d[n++]=r(s,"transmission",0),d[n++]=i(s,"transmissionMap"),d[n++]=r(s,"emissiveIntensity",0),"emissive"in s?(d[n++]=s.emissive.r,d[n++]=s.emissive.g,d[n++]=s.emissive.b):(d[n++]=0,d[n++]=0,d[n++]=0),d[n++]=i(s,"emissiveMap"),d[n++]=i(s,"normalMap"),"normalScale"in s?(d[n++]=s.normalScale.x,d[n++]=s.normalScale.y):(d[n++]=1,d[n++]=1),d[n++]=r(s,"clearcoat",0),d[n++]=i(s,"clearcoatMap"),d[n++]=r(s,"clearcoatRoughness",0),d[n++]=i(s,"clearcoatRoughnessMap"),d[n++]=i(s,"clearcoatNormalMap"),"clearcoatNormalScale"in s?(d[n++]=s.clearcoatNormalScale.x,d[n++]=s.clearcoatNormalScale.y):(d[n++]=1,d[n++]=1),n++,n++,"sheenColor"in s?(d[n++]=s.sheenColor.r,d[n++]=s.sheenColor.g,d[n++]=s.sheenColor.b):(d[n++]=0,d[n++]=0,d[n++]=0),d[n++]=i(s,"sheenColorMap"),d[n++]=r(s,"sheenRoughness",0),d[n++]=i(s,"sheenRoughnessMap"),d[n++]=i(s,"iridescenceMap"),d[n++]=i(s,"iridescenceThicknessMap"),d[n++]=r(s,"iridescence",0),d[n++]=r(s,"iridescenceIOR",1.3);let l=r(s,"iridescenceThicknessRange",[100,400]);d[n++]=l[0],d[n++]=l[1],"specularColor"in s?(d[n++]=s.specularColor.r,d[n++]=s.specularColor.g,d[n++]=s.specularColor.b):(d[n++]=1,d[n++]=1,d[n++]=1),d[n++]=i(s,"specularColorMap"),d[n++]=r(s,"specularIntensity",1),d[n++]=i(s,"specularIntensityMap"),d[n++]=0===r(s,"thickness",0)&&r(s,"attenuationDistance",1/0)===1/0,n++,"attenuationColor"in s?(d[n++]=s.attenuationColor.r,d[n++]=s.attenuationColor.g,d[n++]=s.attenuationColor.b):(d[n++]=1,d[n++]=1,d[n++]=1),d[n++]=r(s,"attenuationDistance",1/0),d[n++]=i(s,"alphaMap"),d[n++]=s.opacity,d[n++]=s.alphaTest,n++,n++,n++,d[n++]=Number(s.vertexColors),d[n++]=Number(s.transparent),n+=a(s,"map",d,n),n+=a(s,"metalnessMap",d,n),n+=a(s,"roughnessMap",d,n),n+=a(s,"transmissionMap",d,n),n+=a(s,"emissiveMap",d,n),n+=a(s,"normalMap",d,n),n+=a(s,"clearcoatMap",d,n),n+=a(s,"clearcoatNormalMap",d,n),n+=a(s,"clearcoatRoughnessMap",d,n),n+=a(s,"sheenColorMap",d,n),n+=a(s,"sheenRoughnessMap",d,n),n+=a(s,"iridescenceMap",d,n),n+=a(s,"iridescenceThicknessMap",d,n),n+=a(s,"specularColorMap",d,n),n+=a(s,"specularIntensityMap",d,n)}this.needsUpdate=!0}}var $4xklQ=parcelRequire("4xklQ");const $e28b7d03d182ad46$var$prevColor=new $4xklQ.Color;class $e28b7d03d182ad46$export$dbbaa51cb2d0b2f7 extends $4xklQ.WebGLArrayRenderTarget{constructor(...e){super(...e);let t=this.texture;t.format=$4xklQ.RGBAFormat,t.type=$4xklQ.UnsignedByteType,t.minFilter=$4xklQ.LinearFilter,t.magFilter=$4xklQ.LinearFilter,t.wrapS=$4xklQ.RepeatWrapping,t.wrapT=$4xklQ.RepeatWrapping,t.setTextures=(...e)=>{this.setTextures(...e)};let i=new $0684d9623c4c8e37$export$3983474c8e6e978b(new $4xklQ.MeshBasicMaterial);this.fsQuad=i}setTextures(e,t,i,r){let o=e.getRenderTarget(),a=e.toneMapping,n=e.getClearAlpha();e.getClearColor($e28b7d03d182ad46$var$prevColor);let s=r.length||1;this.setSize(t,i,s),e.setClearColor(0,0),e.toneMapping=$4xklQ.NoToneMapping;let l=this.fsQuad;for(let t=0,i=s;t<i;t++){let i=r[t];i&&(i.matrixAutoUpdate=!1,i.matrix.identity(),l.material.map=i,l.material.transparent=!0,e.setRenderTarget(this,t),l.render(e),i.updateMatrix(),i.matrixAutoUpdate=!0)}l.material.map=null,e.setClearColor($e28b7d03d182ad46$var$prevColor,n),e.setRenderTarget(o),e.toneMapping=a}dispose(){super.dispose(),this.fsQuad.dispose()}}const $2a5f3cf340e7c2d3$export$75d2a701aae03ef9=`
// The GGX functions provide sampling and distribution information for normals as output so
// in order to get probability of scatter direction the half vector must be computed and provided.
// [0] https://www.cs.cornell.edu/~srm/publications/EGSR07-btdf.pdf
// [1] https://hal.archives-ouvertes.fr/hal-01509746/document
// [2] http://jcgt.org/published/0007/04/01/
// [4] http://jcgt.org/published/0003/02/03/

// trowbridge-reitz === GGX === GTR

vec3 ggxDirection( vec3 incidentDir, float roughnessX, float roughnessY, float random1, float random2 ) {

	// TODO: try GGXVNDF implementation from reference [2], here. Needs to update ggxDistribution
	// function below, as well

	// Implementation from reference [1]
	// stretch view
	vec3 V = normalize( vec3( roughnessX * incidentDir.x, roughnessY * incidentDir.y, incidentDir.z ) );

	// orthonormal basis
	vec3 T1 = ( V.z < 0.9999 ) ? normalize( cross( V, vec3( 0.0, 0.0, 1.0 ) ) ) : vec3( 1.0, 0.0, 0.0 );
	vec3 T2 = cross( T1, V );

	// sample point with polar coordinates (r, phi)
	float a = 1.0 / ( 1.0 + V.z );
	float r = sqrt( random1 );
	float phi = ( random2 < a ) ? random2 / a * PI : PI + ( random2 - a ) / ( 1.0 - a ) * PI;
	float P1 = r * cos( phi );
	float P2 = r * sin( phi ) * ( ( random2 < a ) ? 1.0 : V.z );

	// compute normal
	vec3 N = P1 * T1 + P2 * T2 + V * sqrt( max( 0.0, 1.0 - P1 * P1 - P2 * P2 ) );

	// unstretch
	N = normalize( vec3( roughnessX * N.x, roughnessY * N.y, max( 0.0, N.z ) ) );

	return N;

}

// Below are PDF and related functions for use in a Monte Carlo path tracer
// as specified in Appendix B of the following paper
// See equation (34) from reference [0]
float ggxLamda( float theta, float roughness ) {

	float tanTheta = tan( theta );
	float tanTheta2 = tanTheta * tanTheta;
	float alpha2 = roughness * roughness;

	float numerator = - 1.0 + sqrt( 1.0 + alpha2 * tanTheta2 );
	return numerator / 2.0;

}

// See equation (34) from reference [0]
float ggxShadowMaskG1( float theta, float roughness ) {

	return 1.0 / ( 1.0 + ggxLamda( theta, roughness ) );

}

// See equation (125) from reference [4]
float ggxShadowMaskG2( vec3 wi, vec3 wo, float roughness ) {

	float incidentTheta = acos( wi.z );
	float scatterTheta = acos( wo.z );
	return 1.0 / ( 1.0 + ggxLamda( incidentTheta, roughness ) + ggxLamda( scatterTheta, roughness ) );

}

// See equation (33) from reference [0]
float ggxDistribution( vec3 halfVector, float roughness ) {

	float a2 = roughness * roughness;
	a2 = max( EPSILON, a2 );
	float cosTheta = halfVector.z;
	float cosTheta4 = pow( cosTheta, 4.0 );

	if ( cosTheta == 0.0 ) return 0.0;

	float theta = acosSafe( halfVector.z );
	float tanTheta = tan( theta );
	float tanTheta2 = pow( tanTheta, 2.0 );

	float denom = PI * cosTheta4 * pow( a2 + tanTheta2, 2.0 );
	return ( a2 / denom );

}

// See equation (3) from reference [2]
float ggxPDF( vec3 wi, vec3 halfVector, float roughness ) {

	float incidentTheta = acos( wi.z );
	float D = ggxDistribution( halfVector, roughness );
	float G1 = ggxShadowMaskG1( incidentTheta, roughness );

	return D * G1 * max( 0.0, dot( wi, halfVector ) ) / wi.z;

}
`,$3072b6fdbbd19c0b$export$300995c3bffdc4dd=`

// See equation (2) in http://www.aconty.com/pdf/s2017_pbs_imageworks_sheen.pdf
float velvetD( float cosThetaH, float roughness ) {

	float alpha = max( roughness, 0.07 );
	alpha = alpha * alpha;

	float invAlpha = 1.0 / alpha;

	float sqrCosThetaH = cosThetaH * cosThetaH;
	float sinThetaH = max( 1.0 - sqrCosThetaH, 0.001 );

	return ( 2.0 + invAlpha ) * pow( sinThetaH, 0.5 * invAlpha ) / ( 2.0 * PI );

}

float velvetParamsInterpolate( int i, float oneMinusAlphaSquared ) {

	const float p0[5] = float[5]( 25.3245, 3.32435, 0.16801, -1.27393, -4.85967 );
	const float p1[5] = float[5]( 21.5473, 3.82987, 0.19823, -1.97760, -4.32054 );

	return mix( p1[i], p0[i], oneMinusAlphaSquared );

}

float velvetL( float x, float alpha ) {

	float oneMinusAlpha = 1.0 - alpha;
	float oneMinusAlphaSquared = oneMinusAlpha * oneMinusAlpha;

	float a = velvetParamsInterpolate( 0, oneMinusAlphaSquared );
	float b = velvetParamsInterpolate( 1, oneMinusAlphaSquared );
	float c = velvetParamsInterpolate( 2, oneMinusAlphaSquared );
	float d = velvetParamsInterpolate( 3, oneMinusAlphaSquared );
	float e = velvetParamsInterpolate( 4, oneMinusAlphaSquared );

	return a / ( 1.0 + b * pow( abs( x ), c ) ) + d * x + e;

}

// See equation (3) in http://www.aconty.com/pdf/s2017_pbs_imageworks_sheen.pdf
float velvetLambda( float cosTheta, float alpha ) {

	return abs( cosTheta ) < 0.5 ? exp( velvetL( cosTheta, alpha ) ) : exp( 2.0 * velvetL( 0.5, alpha ) - velvetL( 1.0 - cosTheta, alpha ) );

}

// See Section 3, Shadowing Term, in http://www.aconty.com/pdf/s2017_pbs_imageworks_sheen.pdf
float velvetG( float cosThetaO, float cosThetaI, float roughness ) {

	float alpha = max( roughness, 0.07 );
	alpha = alpha * alpha;

	return 1.0 / ( 1.0 + velvetLambda( cosThetaO, alpha ) + velvetLambda( cosThetaI, alpha ) );

}

float directionalAlbedoSheen( float cosTheta, float alpha ) {

	cosTheta = saturate( cosTheta );

	float c = 1.0 - cosTheta;
	float c3 = c * c * c;

	return 0.65584461 * c3 + 1.0 / ( 4.16526551 + exp( -7.97291361 * sqrt( alpha ) + 6.33516894 ) );

}

float sheenAlbedoScaling( vec3 wo, vec3 wi, SurfaceRec surf ) {

	float alpha = max( surf.sheenRoughness, 0.07 );
	alpha = alpha * alpha;

	float maxSheenColor = max( max( surf.sheenColor.r, surf.sheenColor.g ), surf.sheenColor.b );

	float eWo = directionalAlbedoSheen( saturateCos( wo.z ), alpha );
	float eWi = directionalAlbedoSheen( saturateCos( wi.z ), alpha );

	return min( 1.0 - maxSheenColor * eWo, 1.0 - maxSheenColor * eWi );

}

// See Section 5, Layering, in http://www.aconty.com/pdf/s2017_pbs_imageworks_sheen.pdf
float sheenAlbedoScaling( vec3 wo, SurfaceRec surf ) {

	float alpha = max( surf.sheenRoughness, 0.07 );
	alpha = alpha * alpha;

	float maxSheenColor = max( max( surf.sheenColor.r, surf.sheenColor.g ), surf.sheenColor.b );

	float eWo = directionalAlbedoSheen( saturateCos( wo.z ), alpha );

	return 1.0 - maxSheenColor * eWo;

}

`,$54cd8bd7b32bfb02$export$edc525d01b11600f=`

// XYZ to sRGB color space
const mat3 XYZ_TO_REC709 = mat3(
	 3.2404542, -0.9692660,  0.0556434,
	-1.5371385,  1.8760108, -0.2040259,
	-0.4985314,  0.0415560,  1.0572252
);

vec3 fresnel0ToIor( vec3 fresnel0 ) {

	vec3 sqrtF0 = sqrt( fresnel0 );
	return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );

}

// Conversion FO/IOR
vec3 iorToFresnel0( vec3 transmittedIor, float incidentIor ) {

	return square( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );

}

// ior is a value between 1.0 and 3.0. 1.0 is air interface
float iorToFresnel0( float transmittedIor, float incidentIor ) {

	return square( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ) );

}

// Fresnel equations for dielectric/dielectric interfaces. See https://belcour.github.io/blog/research/2017/05/01/brdf-thin-film.html
vec3 evalSensitivity( float OPD, vec3 shift ) {

	float phase = 2.0 * PI * OPD * 1.0e-9;

	vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
	vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
	vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );

	vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - square( phase ) * var );
	xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * square( phase ) );
	xyz /= 1.0685e-7;

	vec3 srgb = XYZ_TO_REC709 * xyz;
	return srgb;

}

// See Section 4. Analytic Spectral Integration, A Practical Extension to Microfacet Theory for the Modeling of Varying Iridescence, https://hal.archives-ouvertes.fr/hal-01518344/document
vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {

	vec3 I;

	// Force iridescenceIor -> outsideIOR when thinFilmThickness -> 0.0
	float iridescenceIor = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );

	// Evaluate the cosTheta on the base layer (Snell law)
	float sinTheta2Sq = square( outsideIOR / iridescenceIor ) * ( 1.0 - square( cosTheta1 ) );

	// Handle TIR:
	float cosTheta2Sq = 1.0 - sinTheta2Sq;
	if ( cosTheta2Sq < 0.0 ) {

		return vec3( 1.0 );

	}

	float cosTheta2 = sqrt( cosTheta2Sq );

	// First interface
	float R0 = iorToFresnel0( iridescenceIor, outsideIOR );
	float R12 = schlickFresnel( cosTheta1, R0 );
	float R21 = R12;
	float T121 = 1.0 - R12;
	float phi12 = 0.0;
	if ( iridescenceIor < outsideIOR ) {

		phi12 = PI;

	}
	float phi21 = PI - phi12;

	// Second interface
	vec3 baseIOR = fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) ); // guard against 1.0
	vec3 R1 = iorToFresnel0( baseIOR, iridescenceIor );
	vec3 R23 = schlickFresnel( cosTheta2, R1 );
	vec3 phi23 = vec3( 0.0 );
	if ( baseIOR[0] < iridescenceIor ) {

		phi23[ 0 ] = PI;

	}
	if ( baseIOR[1] < iridescenceIor ) {

		phi23[ 1 ] = PI;

	}
	if ( baseIOR[2] < iridescenceIor ) {

		phi23[ 2 ] = PI;

	}

	// Phase shift
	float OPD = 2.0 * iridescenceIor * thinFilmThickness * cosTheta2;
	vec3 phi = vec3( phi21 ) + phi23;

	// Compound terms
	vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
	vec3 r123 = sqrt( R123 );
	vec3 Rs = square( T121 ) * R23 / ( vec3( 1.0 ) - R123 );

	// Reflectance term for m = 0 (DC term amplitude)
	vec3 C0 = R12 + Rs;
	I = C0;

	// Reflectance term for m > 0 (pairs of diracs)
	vec3 Cm = Rs - T121;
	for ( int m = 1; m <= 2; ++ m )
	{
		Cm *= r123;
		vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
		I += Cm * Sm;
	}

	// Since out of gamut colors might be produced, negative color values are clamped to 0.
	return max( I, vec3( 0.0 ) );
}

`,$cf7c94388ac486fb$export$aba3482f45fc2e55=`

struct SurfaceRec {
	vec3 normal;
	vec3 faceNormal;
	bool frontFace;
	float roughness;
	float filteredRoughness;
	float metalness;
	vec3 color;
	vec3 emission;
	float transmission;
	bool thinFilm;
	float ior;
	float iorRatio;
	float clearcoat;
	float clearcoatRoughness;
	float filteredClearcoatRoughness;
	vec3 sheenColor;
	float sheenRoughness;
	float iridescence;
	float iridescenceIor;
	float iridescenceThickness;
	vec3 specularColor;
	float specularIntensity;
	vec3 attenuationColor;
	float attenuationDistance;
};

struct SampleRec {
	float specularPdf;
	float pdf;
	vec3 direction;
	vec3 clearcoatDirection;
	vec3 color;
};

${$2a5f3cf340e7c2d3$export$75d2a701aae03ef9}
${$3072b6fdbbd19c0b$export$300995c3bffdc4dd}
${$54cd8bd7b32bfb02$export$edc525d01b11600f}

// diffuse
float diffusePDF( vec3 wo, vec3 wi, SurfaceRec surf ) {

	// https://raytracing.github.io/books/RayTracingTheRestOfYourLife.html#lightscattering/thescatteringpdf
	float cosValue = wi.z;
	return cosValue / PI;

}

vec3 diffuseDirection( vec3 wo, SurfaceRec surf ) {

	vec3 lightDirection = randDirection();
	lightDirection.z += 1.0;
	lightDirection = normalize( lightDirection );

	return lightDirection;

}

vec3 diffuseColor( vec3 wo, vec3 wi, SurfaceRec surf ) {

	// TODO: scale by 1 - F here
	// note on division by PI
	// https://seblagarde.wordpress.com/2012/01/08/pi-or-not-to-pi-in-game-lighting-equation/
	float metalFactor = ( 1.0 - surf.metalness );
	return surf.color * metalFactor * wi.z / PI;

}

// specular
float specularPDF( vec3 wo, vec3 wi, SurfaceRec surf ) {

	// See 14.1.1 Microfacet BxDFs in https://www.pbr-book.org/
	float filteredRoughness = surf.filteredRoughness;
	vec3 halfVector = getHalfVector( wi, wo );

	float incidentTheta = acos( wo.z );
	float D = ggxDistribution( halfVector, filteredRoughness );
	float G1 = ggxShadowMaskG1( incidentTheta, filteredRoughness );
	float ggxPdf = D * G1 * max( 0.0, abs( dot( wo, halfVector ) ) ) / abs ( wo.z );
	return ggxPdf / ( 4.0 * dot( wo, halfVector ) );

}

vec3 specularDirection( vec3 wo, SurfaceRec surf ) {

	// sample ggx vndf distribution which gives a new normal
	float filteredRoughness = surf.filteredRoughness;
	vec3 halfVector = ggxDirection(
		wo,
		filteredRoughness,
		filteredRoughness,
		rand(),
		rand()
	);

	// apply to new ray by reflecting off the new normal
	return - reflect( wo, halfVector );

}

vec3 specularColor( vec3 wo, vec3 wi, SurfaceRec surf ) {

	// if roughness is set to 0 then D === NaN which results in black pixels
	float metalness = surf.metalness;
	float filteredRoughness = surf.filteredRoughness;

	vec3 halfVector = getHalfVector( wo, wi );
	float iorRatio = surf.iorRatio;
	float G = ggxShadowMaskG2( wi, wo, filteredRoughness );
	float D = ggxDistribution( halfVector, filteredRoughness );

	float f0 = iorRatioToF0( iorRatio );
	vec3 F = vec3( schlickFresnel( dot( wi, halfVector ), f0 ) );

	float cosTheta = min( wo.z, 1.0 );
	float sinTheta = sqrt( 1.0 - cosTheta * cosTheta );
	bool cannotRefract = iorRatio * sinTheta > 1.0;
	if ( cannotRefract ) {

		F = vec3( 1.0 );

	}

	vec3 iridescenceFresnel = evalIridescence( 1.0, surf.iridescenceIor, dot( wi, halfVector ), surf.iridescenceThickness, vec3( f0 ) );
	vec3 metalF = mix( F, iridescenceFresnel, surf.iridescence );
	vec3 dialectricF = F * surf.specularIntensity;
	F = mix( dialectricF, metalF, metalness );

	vec3 color = mix( surf.specularColor, surf.color, metalness );
	color = mix( color, vec3( 1.0 ), F );
	color *= G * D / ( 4.0 * abs( wi.z * wo.z ) );
	color *= mix( F, vec3( 1.0 ), metalness );
	color *= wi.z; // scale the light by the direction the light is coming in from

	return color;

}

/*
// transmission
function transmissionPDF( wo, wi, material, surf ) {

	// See section 4.2 in https://www.cs.cornell.edu/~srm/publications/EGSR07-btdf.pdf

	const { roughness, ior } = material;
	const { frontFace } = hit;
	const ratio = frontFace ? ior : 1 / ior;
	const minRoughness = Math.max( roughness, MIN_ROUGHNESS );

	halfVector.set( 0, 0, 0 ).addScaledVector( wi, ratio ).addScaledVector( wo, 1.0 ).normalize().multiplyScalar( - 1 );

	const denom = Math.pow( ratio * halfVector.dot( wi ) + 1.0 * halfVector.dot( wo ), 2.0 );
	return ggxPDF( wo, halfVector, minRoughness ) / denom;

}

function transmissionDirection( wo, hit, material, lightDirection ) {

	const { roughness, ior } = material;
	const { frontFace } = hit;
	const ratio = frontFace ? 1 / ior : ior;
	const minRoughness = Math.max( roughness, MIN_ROUGHNESS );

	// sample ggx vndf distribution which gives a new normal
	ggxDirection(
		wo,
		minRoughness,
		minRoughness,
		Math.random(),
		Math.random(),
		halfVector,
	);

	// apply to new ray by reflecting off the new normal
	tempDir.copy( wo ).multiplyScalar( - 1 );
	refract( tempDir, halfVector, ratio, lightDirection );

}

function transmissionColor( wo, wi, material, hit, colorTarget ) {

	const { metalness, transmission } = material;
	colorTarget
		.copy( material.color )
		.multiplyScalar( ( 1.0 - metalness ) * wo.z )
		.multiplyScalar( transmission );

}
*/

// TODO: This is just using a basic cosine-weighted specular distribution with an
// incorrect PDF value at the moment. Update it to correctly use a GGX distribution
float transmissionPDF( vec3 wo, vec3 wi, SurfaceRec surf ) {

	float iorRatio = surf.iorRatio;
	float cosTheta = min( wo.z, 1.0 );
	float sinTheta = sqrt( 1.0 - cosTheta * cosTheta );
	float reflectance = schlickFresnelFromIor( cosTheta, iorRatio );
	bool cannotRefract = iorRatio * sinTheta > 1.0;
	if ( cannotRefract ) {

		return 0.0;

	}

	return 1.0 / ( 1.0 - reflectance );

}

vec3 transmissionDirection( vec3 wo, SurfaceRec surf ) {

	float roughness = surf.roughness;
	float iorRatio = surf.iorRatio;

	vec3 halfVector = normalize( vec3( 0.0, 0.0, 1.0 ) + randDirection() * roughness );
	vec3 lightDirection = refract( normalize( - wo ), halfVector, iorRatio );

	if ( surf.thinFilm ) {

		lightDirection = - refract( normalize( - lightDirection ), - vec3( 0.0, 0.0, 1.0 ), 1.0 / iorRatio );

	}
	return normalize( lightDirection );

}

vec3 transmissionColor( vec3 wo, vec3 wi, SurfaceRec surf ) {

	// only attenuate the color if it's on the way in
	vec3 col = surf.thinFilm || surf.frontFace ? surf.color : vec3( 1.0 );
	return surf.transmission * col;

}

// clearcoat
float clearcoatPDF( vec3 wo, vec3 wi, SurfaceRec surf ) {

	// See equation (27) in http://jcgt.org/published/0003/02/03/
	float filteredClearcoatRoughness = surf.filteredClearcoatRoughness;
	vec3 halfVector = getHalfVector( wi, wo );
	return ggxPDF( wo, halfVector, filteredClearcoatRoughness ) / ( 4.0 * dot( wi, halfVector ) );

}

vec3 clearcoatDirection( vec3 wo, SurfaceRec surf ) {

	// sample ggx vndf distribution which gives a new normal
	float filteredClearcoatRoughness = surf.filteredClearcoatRoughness;
	vec3 halfVector = ggxDirection(
		wo,
		filteredClearcoatRoughness,
		filteredClearcoatRoughness,
		rand(),
		rand()
	);

	// apply to new ray by reflecting off the new normal
	return - reflect( wo, halfVector );

}

void clearcoatColor( inout vec3 color, vec3 wo, vec3 wi, SurfaceRec surf ) {

	float ior = 1.5;
	bool frontFace = surf.frontFace;
	float filteredClearcoatRoughness = surf.filteredClearcoatRoughness;

	vec3 halfVector = getHalfVector( wo, wi );
	float iorRatio = frontFace ? 1.0 / ior : ior;
	float G = ggxShadowMaskG2( wi, wo, filteredClearcoatRoughness );
	float D = ggxDistribution( halfVector, filteredClearcoatRoughness );

	float F = schlickFresnelFromIor( dot( wi, halfVector ), ior );
	float cosTheta = min( wo.z, 1.0 );
	float sinTheta = sqrt( 1.0 - cosTheta * cosTheta );
	bool cannotRefract = iorRatio * sinTheta > 1.0;
	if ( cannotRefract ) {

		F = 1.0;

	}

	float fClearcoat = F * D * G / ( 4.0 * abs( wi.z * wo.z ) );

	color = color * ( 1.0 - surf.clearcoat * F ) + fClearcoat * surf.clearcoat * wi.z;

}

// sheen
vec3 sheenColor( vec3 wo, vec3 wi, SurfaceRec surf ) {

	vec3 halfVector = getHalfVector( wo, wi );

	float cosThetaO = saturateCos( wo.z );
	float cosThetaI = saturateCos( wi.z );
	float cosThetaH = halfVector.z;

	float D = velvetD( cosThetaH, surf.sheenRoughness );
	float G = velvetG( cosThetaO, cosThetaI, surf.sheenRoughness );

	// See equation (1) in http://www.aconty.com/pdf/s2017_pbs_imageworks_sheen.pdf
	vec3 color = surf.sheenColor;
	color *= D * G / ( 4.0 * abs( cosThetaO * cosThetaI ) );
	color *= wi.z;

	return color;

}

// bsdf
void getLobeWeights( vec3 wo, vec3 clearcoatWo, SurfaceRec surf, out float diffuseWeight, out float specularWeight, out float transmissionWeight, out float clearcoatWeight ) {

	float metalness = surf.metalness;
	float transmission = surf.transmission;

	// TODO: we should compute a half vector ahead of time and pass it into the sampling functions
	// so all functions will use the same half vector
	float iorRatio = surf.iorRatio;
	float cosTheta = min( wo.z, 1.0 );
	float sinTheta = sqrt( 1.0 - cosTheta * cosTheta );
	float reflectance = schlickFresnelFromIor( cosTheta, iorRatio );
	bool cannotRefract = iorRatio * sinTheta > 1.0;
	if ( cannotRefract ) {

		reflectance = 1.0;

	}

	float transSpecularProb = mix( reflectance, 1.0, metalness );
	float diffSpecularProb = 0.5 + 0.5 * metalness;

	clearcoatWeight = surf.clearcoat * schlickFresnel( clearcoatWo.z, 0.04 );
	diffuseWeight = ( 1.0 - transmission ) * ( 1.0 - diffSpecularProb ) * ( 1.0 - clearcoatWeight );
	specularWeight = transmission * transSpecularProb + ( 1.0 - transmission ) * diffSpecularProb * ( 1.0 - clearcoatWeight );
	transmissionWeight = transmission * ( 1.0 - transSpecularProb ) * ( 1.0 - clearcoatWeight );

	float totalWeight = diffuseWeight + specularWeight + transmissionWeight + clearcoatWeight;
	diffuseWeight /= totalWeight;
	specularWeight /= totalWeight;
	transmissionWeight /= totalWeight;
	clearcoatWeight /= totalWeight;

}

float bsdfPdf( vec3 wo, vec3 clearcoatWo, vec3 wi, vec3 clearcoatWi, SurfaceRec surf, out float specularPdf, float diffuseWeight, float specularWeight, float transmissionWeight, float clearcoatWeight ) {

	float metalness = surf.metalness;
	float transmission = surf.transmission;

	float iorRatio = surf.iorRatio;
	float cosTheta = min( wo.z, 1.0 );
	float sinTheta = sqrt( 1.0 - cosTheta * cosTheta );
	float reflectance = schlickFresnelFromIor( cosTheta, iorRatio );
	bool cannotRefract = iorRatio * sinTheta > 1.0;
	if ( cannotRefract ) {

		reflectance = 1.0;

	}

	float spdf = 0.0;
	float dpdf = 0.0;
	float tpdf = 0.0;
	float cpdf = 0.0;

	if ( wi.z < 0.0 ) {

		if( transmissionWeight > 0.0 ) {

			tpdf = transmissionPDF( wo, wi, surf );

		}

	} else {

		if( diffuseWeight > 0.0 ) {

			dpdf = diffusePDF( wo, wi, surf );

		}

		if( specularWeight > 0.0 ) {

			spdf = specularPDF( wo, wi, surf );

		}

	}

	if( clearcoatWi.z >= 0.0 && clearcoatWeight > 0.0 ) {

		cpdf = clearcoatPDF( clearcoatWo, clearcoatWi, surf );

	}

	float pdf =
		  dpdf * diffuseWeight
		+ spdf * specularWeight
		+ tpdf * transmissionWeight
		+ cpdf * clearcoatWeight;

	// retrieve specular rays for the shadows flag
	specularPdf = spdf * specularWeight + cpdf * clearcoatWeight;

	return pdf;

}

vec3 bsdfColor( vec3 wo, vec3 clearcoatWo, vec3 wi, vec3 clearcoatWi, SurfaceRec surf, float diffuseWeight, float specularWeight, float transmissionWeight, float clearcoatWeight ) {

	vec3 color = vec3( 0.0 );
	if ( wi.z < 0.0 ) {

		if( transmissionWeight > 0.0 ) {

			color = transmissionColor( wo, wi, surf );

		}

	} else {

		if( diffuseWeight > 0.0 ) {

			color = diffuseColor( wo, wi, surf );
			color *= 1.0 - surf.transmission;

		}

		if( specularWeight > 0.0 ) {

			color += specularColor( wo, wi, surf );

		}

		color *= sheenAlbedoScaling( wo, wi, surf );
		color += sheenColor( wo, wi, surf );

	}

	if( clearcoatWi.z >= 0.0 && clearcoatWeight > 0.0 ) {

		clearcoatColor( color, clearcoatWo, clearcoatWi, surf );

	}

	return color;

}

float bsdfResult( vec3 wo, vec3 clearcoatWo, vec3 wi, vec3 clearcoatWi, SurfaceRec surf, out vec3 color ) {

	float diffuseWeight;
	float specularWeight;
	float transmissionWeight;
	float clearcoatWeight;
	getLobeWeights( wo, clearcoatWo, surf, diffuseWeight, specularWeight, transmissionWeight, clearcoatWeight );

	float specularPdf;
	color = bsdfColor( wo, clearcoatWo, wi, clearcoatWi, surf, diffuseWeight, specularWeight, transmissionWeight, clearcoatWeight );
	return bsdfPdf( wo, clearcoatWo, wi, clearcoatWi, surf, specularPdf, diffuseWeight, specularWeight, transmissionWeight, clearcoatWeight );

}

SampleRec bsdfSample( vec3 wo, vec3 clearcoatWo, mat3 normalBasis, mat3 invBasis, mat3 clearcoatNormalBasis, mat3 clearcoatInvBasis, SurfaceRec surf ) {

	float diffuseWeight;
	float specularWeight;
	float transmissionWeight;
	float clearcoatWeight;
	getLobeWeights( wo, clearcoatWo, surf, diffuseWeight, specularWeight, transmissionWeight, clearcoatWeight );

	float pdf[4];
	pdf[0] = diffuseWeight;
	pdf[1] = specularWeight;
	pdf[2] = transmissionWeight;
	pdf[3] = clearcoatWeight;

	float cdf[4];
	cdf[0] = pdf[0];
	cdf[1] = pdf[1] + cdf[0];
	cdf[2] = pdf[2] + cdf[1];
	cdf[3] = pdf[3] + cdf[2];

	if( cdf[3] != 0.0 ) {

		float invMaxCdf = 1.0 / cdf[3];
		cdf[0] *= invMaxCdf;
		cdf[1] *= invMaxCdf;
		cdf[2] *= invMaxCdf;
		cdf[3] *= invMaxCdf;

	} else {

		cdf[0] = 1.0;
		cdf[1] = 0.0;
		cdf[2] = 0.0;
		cdf[3] = 0.0;

	}

	vec3 wi;
	vec3 clearcoatWi;

	float r = rand();
	if ( r <= cdf[0] ) { // diffuse

		wi = diffuseDirection( wo, surf );
		clearcoatWi = normalize( clearcoatInvBasis * normalize( normalBasis * wi ) );

	} else if ( r <= cdf[1] ) { // specular

		wi = specularDirection( wo, surf );
		clearcoatWi = normalize( clearcoatInvBasis * normalize( normalBasis * wi ) );

	} else if ( r <= cdf[2] ) { // transmission / refraction

		wi = transmissionDirection( wo, surf );
		clearcoatWi = normalize( clearcoatInvBasis * normalize( normalBasis * wi ) );

	} else if ( r <= cdf[3] ) { // clearcoat

		clearcoatWi = clearcoatDirection( clearcoatWo, surf );
		wi = normalize( invBasis * normalize( clearcoatNormalBasis * clearcoatWi ) );

	}

	SampleRec result;
	result.pdf = bsdfPdf( wo, clearcoatWo, wi, clearcoatWi, surf, result.specularPdf, diffuseWeight, specularWeight, transmissionWeight, clearcoatWeight );
	result.color = bsdfColor( wo, clearcoatWo, wi, clearcoatWi, surf, diffuseWeight, specularWeight, transmissionWeight, clearcoatWeight );
	result.direction = wi;
	result.clearcoatDirection = clearcoatWi;

	return result;

}
`,$99a046e0a34b3c61$export$c4e96847515c3dca=`

vec3 sampleEquirectEnvMapColor( vec3 direction, sampler2D map ) {

	return texture2D( map, equirectDirectionToUv( direction ) ).rgb;

}

float envMapDirectionPdf( vec3 direction ) {

	vec2 uv = equirectDirectionToUv( direction );
	float theta = uv.y * PI;
	float sinTheta = sin( theta );
	if ( sinTheta == 0.0 ) {

		return 0.0;

	}

	return 1.0 / ( 2.0 * PI * PI * sinTheta );

}

float envMapSample( vec3 direction, EquirectHdrInfo info, out vec3 color ) {

	vec2 uv = equirectDirectionToUv( direction );
	color = texture2D( info.map, uv ).rgb;

	float totalSum = info.totalSumWhole + info.totalSumDecimal;
	float lum = colorToLuminance( color );
	ivec2 resolution = textureSize( info.map, 0 );
	float pdf = lum / totalSum;

	return float( resolution.x * resolution.y ) * pdf * envMapDirectionPdf( direction );

}

float randomEnvMapSample( EquirectHdrInfo info, out vec3 color, out vec3 direction ) {

	// sample env map cdf
	vec2 r = rand2();
	float v = texture2D( info.marginalWeights, vec2( r.x, 0.0 ) ).x;
	float u = texture2D( info.conditionalWeights, vec2( r.y, v ) ).x;
	vec2 uv = vec2( u, v );

	vec3 derivedDirection = equirectUvToDirection( uv );
	direction = derivedDirection;
	color = texture2D( info.map, uv ).rgb;

	float totalSum = info.totalSumWhole + info.totalSumDecimal;
	float lum = colorToLuminance( color );
	ivec2 resolution = textureSize( info.map, 0 );
	float pdf = lum / totalSum;

	return float( resolution.x * resolution.y ) * pdf * envMapDirectionPdf( direction );

}

`,$c25bfd093d099434$export$72ea2c7ee2a3cb14=`

float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {

	return smoothstep( coneCosine, penumbraCosine, angleCosine );

}

float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {

	// based upon Frostbite 3 Moving to Physically-based Rendering
	// page 32, equation 26: E[window1]
	// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), EPSILON );

	if ( cutoffDistance > 0.0 ) {

		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );

	}

	return distanceFalloff;

}

float getPhotometricAttenuation( sampler2DArray iesProfiles, int iesProfile, vec3 posToLight, vec3 lightDir, vec3 u, vec3 v ) {

    float cosTheta = dot( posToLight, lightDir );
    float angle = acos( cosTheta ) * ( 1.0 / PI );

    return texture2D( iesProfiles, vec3( 0.0, angle, iesProfile ) ).r;

}

struct LightSampleRec {

	bool hit;
	float dist;
	vec3 direction;
	float pdf;
	vec3 emission;
	int type;

};

LightSampleRec lightsClosestHit( sampler2D lights, uint lightCount, vec3 rayOrigin, vec3 rayDirection ) {

	LightSampleRec lightSampleRec;
	lightSampleRec.hit = false;

	uint l;
	for ( l = 0u; l < lightCount; l ++ ) {

		Light light = readLightInfo( lights, l );

		vec3 u = light.u;
		vec3 v = light.v;

		// check for backface
		vec3 normal = normalize( cross( u, v ) );
		if ( dot( normal, rayDirection ) < 0.0 ) {
			continue;
		}

		u *= 1.0 / dot( u, u );
		v *= 1.0 / dot( v, v );

		float dist;

		if(
			( light.type == RECT_AREA_LIGHT_TYPE && intersectsRectangle( light.position, normal, u, v, rayOrigin, rayDirection, dist ) ) ||
			( light.type == CIRC_AREA_LIGHT_TYPE && intersectsCircle( light.position, normal, u, v, rayOrigin, rayDirection, dist ) )
		) {

			if ( dist < lightSampleRec.dist || ! lightSampleRec.hit ) {

				float cosTheta = dot( rayDirection, normal );

				lightSampleRec.hit = true;
				lightSampleRec.dist = dist;
				lightSampleRec.pdf = ( dist * dist ) / ( light.area * cosTheta );
				lightSampleRec.emission = light.color * light.intensity;
				lightSampleRec.direction = rayDirection;
				lightSampleRec.type = light.type;

			}

		} else if ( light.type == SPOT_LIGHT_TYPE ) {

			// TODO: forward path tracing sampling needs to be made consistent with direct light sampling logic
			// float radius = light.radius;
			// vec3 lightNormal = normalize( cross( light.u, light.v ) );
			// float angle = acos( light.coneCos );
			// float angleTan = tan( angle );
			// float startDistance = radius / max( angleTan, EPSILON );

			// u = light.u / radius;
			// v = light.v / radius;

			// if (
			// 	intersectsCircle( light.position - normal * startDistance, normal, u, v, rayOrigin, rayDirection, dist ) &&
			// 	( dist < lightSampleRec.dist || ! lightSampleRec.hit )
			// ) {

			// 	float cosTheta = dot( rayDirection, normal );
			// 	float spotAttenuation = light.iesProfile != - 1 ?
			// 		getPhotometricAttenuation( iesProfiles, light.iesProfile, rayDirection, normal, u, v )
			// 		: getSpotAttenuation( light.coneCos, light.penumbraCos, cosTheta );

			// 	float distanceAttenuation = getDistanceAttenuation( dist, light.distance, light.decay );

			// 	lightSampleRec.hit = true;
			// 	lightSampleRec.dist = dist;
			// 	lightSampleRec.direction = rayDirection;
			// 	lightSampleRec.emission = light.color * light.intensity * distanceAttenuation * spotAttenuation;
			// 	lightSampleRec.pdf = ( dist * dist ) / ( light.area * cosTheta );

			// }

		}

	}

	return lightSampleRec;

}

LightSampleRec randomAreaLightSample( Light light, vec3 rayOrigin ) {

	LightSampleRec lightSampleRec;
	lightSampleRec.hit = true;
	lightSampleRec.type = light.type;

	lightSampleRec.emission = light.color * light.intensity;

	vec3 randomPos;
	if( light.type == RECT_AREA_LIGHT_TYPE ) {

		// rectangular area light
		randomPos = light.position + light.u * ( rand() - 0.5 ) + light.v * ( rand() - 0.5 );

	} else if( light.type == 1 ) {

		// circular area light
		float r = 0.5 * sqrt( rand() );
		float theta = rand() * 2.0 * PI;
		float x = r * cos( theta );
		float y = r * sin( theta );

		randomPos = light.position + light.u * x + light.v * y;

	}

	vec3 toLight = randomPos - rayOrigin;
	float lightDistSq = dot( toLight, toLight );
	lightSampleRec.dist = sqrt( lightDistSq );

	vec3 direction = toLight / lightSampleRec.dist;
	lightSampleRec.direction = direction;

	vec3 lightNormal = normalize( cross( light.u, light.v ) );
	lightSampleRec.pdf = lightDistSq / ( light.area * dot( direction, lightNormal ) );

	return lightSampleRec;

}

LightSampleRec randomSpotLightSample( Light light, sampler2DArray iesProfiles, vec3 rayOrigin ) {

	float radius = light.radius * sqrt( rand() );
	float theta = rand() * 2.0 * PI;
	float x = radius * cos( theta );
	float y = radius * sin( theta );

	vec3 u = light.u;
	vec3 v = light.v;
	vec3 normal = normalize( cross( u, v ) );

	float angle = acos( light.coneCos );
	float angleTan = tan( angle );
	float startDistance = light.radius / max( angleTan, EPSILON );

	vec3 randomPos = light.position - normal * startDistance + u * x + v * y;
	vec3 toLight = randomPos - rayOrigin;
	float lightDistSq = dot( toLight, toLight );
	float dist = sqrt( lightDistSq );

	vec3 direction = toLight / max( dist, EPSILON );
	float cosTheta = dot( direction, normal );

	float spotAttenuation = light.iesProfile != - 1 ?
		  getPhotometricAttenuation( iesProfiles, light.iesProfile, direction, normal, u, v )
		: getSpotAttenuation( light.coneCos, light.penumbraCos, cosTheta );

	float distanceAttenuation = getDistanceAttenuation( dist, light.distance, light.decay );
	LightSampleRec lightSampleRec;
	lightSampleRec.hit = true;
	lightSampleRec.type = light.type;
	lightSampleRec.dist = dist;
	lightSampleRec.direction = direction;
	lightSampleRec.emission = light.color * light.intensity * distanceAttenuation * spotAttenuation;

	// TODO: this makes the result consistent between MIS and non MIS paths but at radius 0 the pdf is infinite
	// and the intensity of the light is not correct
	lightSampleRec.pdf = 1.0;
	// lightSampleRec.pdf = lightDistSq / ( light.area * cosTheta );

	return lightSampleRec;

}

LightSampleRec randomLightSample( sampler2D lights, sampler2DArray iesProfiles, uint lightCount, vec3 rayOrigin ) {

	// pick a random light
	uint l = uint( rand() * float( lightCount ) );
	Light light = readLightInfo( lights, l );

	if ( light.type == SPOT_LIGHT_TYPE ) {

		return randomSpotLightSample( light, iesProfiles, rayOrigin );

	} else {

		// sample the light
		return randomAreaLightSample( light, rayOrigin );

	}

}

`;var $4xklQ=parcelRequire("4xklQ");class $a5d14f85bceb1a69$export$baf85f88dacad6d5 extends $4xklQ.PerspectiveCamera{set bokehSize(e){this.fStop=this.getFocalLength()/e}get bokehSize(){return this.getFocalLength()/this.fStop}constructor(...e){super(...e),this.fStop=1.4,this.apertureBlades=0,this.apertureRotation=0,this.focusDistance=25,this.anamorphicRatio=1}}class $bbc0a4ca684807d3$export$2e27c77dea3c9d73{constructor(){this.bokehSize=0,this.apertureBlades=0,this.apertureRotation=0,this.focusDistance=10,this.anamorphicRatio=1}updateFrom(e){e instanceof $a5d14f85bceb1a69$export$baf85f88dacad6d5?(this.bokehSize=e.bokehSize,this.apertureBlades=e.apertureBlades,this.apertureRotation=e.apertureRotation,this.focusDistance=e.focusDistance,this.anamorphicRatio=e.anamorphicRatio):(this.bokehSize=0,this.apertureRotation=0,this.apertureBlades=0,this.focusDistance=10,this.anamorphicRatio=1)}}var $4xklQ=parcelRequire("4xklQ");function $57d502cd87eced98$var$binarySearchFindClosestIndexOf(e,t,i=0,r=e.length){let o=0,a=r;for(;o<a;){let r=~~(.5*a+.5*o);e[i+r]<t?o=r+1:a=r}return o}function $57d502cd87eced98$var$colorToLuminance(e,t,i){return .2126*e+.7152*t+.0722*i}function $57d502cd87eced98$var$preprocessEnvMap(e){let t=e.clone();t.source=new $4xklQ.Source({...t.image});let{width:i,height:r,data:o}=t.image,a=o;if(t.type===$4xklQ.HalfFloatType){for(let e in a=new Float32Array(o.length),o)a[e]=(0,$4xklQ.DataUtils).fromHalfFloat(o[e]);t.image.data=a,t.type=$4xklQ.FloatType}if(t.flipY){let e=a;a=a.slice();for(let t=0;t<r;t++)for(let o=0;o<i;o++){let n=r-t-1,s=4*(t*i+o),l=4*(n*i+o);a[l+0]=e[s+0],a[l+1]=e[s+1],a[l+2]=e[s+2],a[l+3]=e[s+3]}t.flipY=!1,t.image.data=a}return t}class $57d502cd87eced98$export$e5a77e5d6a85a862{constructor(){let e=new $4xklQ.DataTexture;e.type=$4xklQ.FloatType,e.format=$4xklQ.RedFormat,e.minFilter=$4xklQ.LinearFilter,e.magFilter=$4xklQ.LinearFilter,e.generateMipmaps=!1;let t=new $4xklQ.DataTexture;t.type=$4xklQ.FloatType,t.format=$4xklQ.RedFormat,t.minFilter=$4xklQ.LinearFilter,t.magFilter=$4xklQ.LinearFilter,t.generateMipmaps=!1,this.marginalWeights=e,this.conditionalWeights=t,this.map=null,this.totalSumWhole=0,this.totalSumDecimal=0}dispose(){this.marginalWeights.dispose(),this.conditionalWeights.dispose(),this.map&&this.map.dispose()}updateFrom(e){let t=$57d502cd87eced98$var$preprocessEnvMap(e);t.wrapS=$4xklQ.RepeatWrapping,t.wrapT=$4xklQ.RepeatWrapping;let{width:i,height:r,data:o}=t.image,a=new Float32Array(i*r),n=new Float32Array(i*r),s=new Float32Array(r),l=new Float32Array(r),h=0,c=0;for(let e=0;e<r;e++){let t=0;for(let r=0;r<i;r++){let s=e*i+r,l=o[4*s+0],c=o[4*s+1],d=o[4*s+2],p=$57d502cd87eced98$var$colorToLuminance(l,c,d);t+=p,h+=p,a[s]=p,n[s]=t}if(0!==t)for(let r=e*i,o=e*i+i;r<o;r++)a[r]/=t,n[r]/=t;c+=t,s[e]=t,l[e]=c}if(0!==c)for(let e=0,t=s.length;e<t;e++)s[e]/=c,l[e]/=c;let d=new Float32Array(r),p=new Float32Array(i*r);for(let e=0;e<r;e++){let t=(e+1)/r,i=$57d502cd87eced98$var$binarySearchFindClosestIndexOf(l,t);d[e]=i/r}for(let e=0;e<r;e++)for(let t=0;t<i;t++){let r=e*i+t,o=(t+1)/i,a=$57d502cd87eced98$var$binarySearchFindClosestIndexOf(n,o,e*i,i);p[r]=a/i}this.dispose();let{marginalWeights:u,conditionalWeights:m}=this;u.image={width:r,height:1,data:d},u.needsUpdate=!0,m.image={width:i,height:r,data:p},m.needsUpdate=!0;let g=~~h,f=h-g;this.totalSumWhole=g,this.totalSumDecimal=f,this.map=t}}var $4xklQ=parcelRequire("4xklQ");const $2cf074fec953e79b$var$LIGHT_PIXELS=6,$2cf074fec953e79b$var$RECT_AREA_LIGHT=0,$2cf074fec953e79b$var$CIRC_AREA_LIGHT=1,$2cf074fec953e79b$var$SPOT_LIGHT=2;class $2cf074fec953e79b$export$bb02c0eb15767758{constructor(){let e=new $4xklQ.DataTexture(new Float32Array(4),1,1);e.format=$4xklQ.RGBAFormat,e.type=$4xklQ.FloatType,e.wrapS=$4xklQ.ClampToEdgeWrapping,e.wrapT=$4xklQ.ClampToEdgeWrapping,e.generateMipmaps=!1,this.tex=e,this.count=0}updateFrom(e,t=[]){let i=this.tex,r=Math.max(e.length*$2cf074fec953e79b$var$LIGHT_PIXELS,1),o=Math.ceil(Math.sqrt(r));i.image.width!==o&&(i.dispose(),i.image.data=new Float32Array(o*o*4),i.image.width=o,i.image.height=o);let a=i.image.data,n=new $4xklQ.Vector3,s=new $4xklQ.Vector3,l=new $4xklQ.Matrix4,h=new $4xklQ.Quaternion,c=new $4xklQ.Vector3,d=new $4xklQ.Vector3,p=new $4xklQ.Vector3;for(let i=0,r=e.length;i<r;i++){let r=e[i],o=i*$2cf074fec953e79b$var$LIGHT_PIXELS*4,u=0;r.getWorldPosition(s),a[o+u++]=s.x,a[o+u++]=s.y,a[o+u++]=s.z;let m=$2cf074fec953e79b$var$RECT_AREA_LIGHT;if(r.isRectAreaLight&&r.isCircular?m=$2cf074fec953e79b$var$CIRC_AREA_LIGHT:r.isSpotLight&&(m=$2cf074fec953e79b$var$SPOT_LIGHT),a[o+u++]=m,a[o+u++]=r.color.r,a[o+u++]=r.color.g,a[o+u++]=r.color.b,a[o+u++]=r.intensity,r.getWorldQuaternion(h),r.isRectAreaLight)n.set(r.width,0,0).applyQuaternion(h),a[o+u++]=n.x,a[o+u++]=n.y,a[o+u++]=n.z,u++,s.set(0,r.height,0).applyQuaternion(h),a[o+u++]=s.x,a[o+u++]=s.y,a[o+u++]=s.z,a[o+u++]=n.cross(s).length()*(r.isCircular?Math.PI/4:1);else if(r.isSpotLight){let e=r.radius;c.setFromMatrixPosition(r.matrixWorld),d.setFromMatrixPosition(r.target.matrixWorld),l.lookAt(c,d,p),h.setFromRotationMatrix(l),n.set(1,0,0).applyQuaternion(h),a[o+u++]=n.x,a[o+u++]=n.y,a[o+u++]=n.z,u++,s.set(0,1,0).applyQuaternion(h),a[o+u++]=s.x,a[o+u++]=s.y,a[o+u++]=s.z,a[o+u++]=Math.PI*e*e,a[o+u++]=e,a[o+u++]=r.shadow.camera.near,a[o+u++]=r.decay,a[o+u++]=r.distance,a[o+u++]=Math.cos(r.angle),a[o+u++]=Math.cos(r.angle*(1-r.penumbra)),a[o+u++]=t.indexOf(r.iesTexture)}}i.needsUpdate=!0,this.count=e.length}}var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ");function $afe8e8564a06cada$var$IESLamp(e){let t;let i=this,r=e.split("\n"),o=0;function a(e){e=(e=(e=e.replace(/^\s+|\s+$/g,"")).replace(/,/g," ")).replace(/\s\s+/g," ");let t=e.split(" ");return t}function n(e,t){for(;;){let i=r[o++],n=a(i);for(let e=0;e<n.length;++e)t.push(Number(n[e]));if(t.length===e)break}}function s(){let e=r[o++],t=a(e);i.tiltData.lampToLumGeometry=Number(t[0]),t=a(e=r[o++]),i.tiltData.numAngles=Number(t[0]),n(i.tiltData.numAngles,i.tiltData.angles),n(i.tiltData.numAngles,i.tiltData.mulFactors)}function l(){let e=[];n(10,e),i.count=Number(e[0]),i.lumens=Number(e[1]),i.multiplier=Number(e[2]),i.numVerAngles=Number(e[3]),i.numHorAngles=Number(e[4]),i.gonioType=Number(e[5]),i.units=Number(e[6]),i.width=Number(e[7]),i.length=Number(e[8]),i.height=Number(e[9])}function h(){let e=[];n(3,e),i.ballFactor=Number(e[0]),i.blpFactor=Number(e[1]),i.inputWatts=Number(e[2])}for(i.verAngles=[],i.horAngles=[],i.candelaValues=[],i.tiltData={},i.tiltData.angles=[],i.tiltData.mulFactors=[];!(t=r[o++]).includes("TILT"););!t.includes("NONE")&&t.includes("INCLUDE")&&s(),l(),h();for(let e=0;e<i.numHorAngles;++e)i.candelaValues.push([]);n(i.numVerAngles,i.verAngles),n(i.numHorAngles,i.horAngles);for(let e=0;e<i.numHorAngles;++e)n(i.numVerAngles,i.candelaValues[e]);for(let e=0;e<i.numHorAngles;++e)for(let t=0;t<i.numVerAngles;++t)i.candelaValues[e][t]*=i.candelaValues[e][t]*i.multiplier*i.ballFactor*i.blpFactor;let c=-1;for(let e=0;e<i.numHorAngles;++e)for(let t=0;t<i.numVerAngles;++t){let r=i.candelaValues[e][t];c=c<r?r:c}let d=!0;if(d&&c>0)for(let e=0;e<i.numHorAngles;++e)for(let t=0;t<i.numVerAngles;++t)i.candelaValues[e][t]/=c}class $afe8e8564a06cada$export$f1ffec369846389b extends $4xklQ.Loader{_getIESValues(e){let t=360,i=180,r=t*i,o=new Float32Array(r);function a(t,i){let r=0,o=0,a=0,n=0,s=0,l=0;for(let t=0;t<e.numHorAngles-1;++t)if(i<e.horAngles[t+1]||t==e.numHorAngles-2){o=t,a=e.horAngles[t],n=e.horAngles[t+1];break}for(let i=0;i<e.numVerAngles-1;++i)if(t<e.verAngles[i+1]||i==e.numVerAngles-2){r=i,s=e.verAngles[i],l=e.verAngles[i+1];break}let h=n-a,c=l-s;if(0===c)return 0;let d=0===h?0:(i-a)/h,p=(t-s)/c,u=0===h?o:o+1,m=(0,$4xklQ.MathUtils).lerp(e.candelaValues[o][r],e.candelaValues[u][r],d),g=(0,$4xklQ.MathUtils).lerp(e.candelaValues[o][r+1],e.candelaValues[u][r+1],d),f=(0,$4xklQ.MathUtils).lerp(m,g,p);return f}let n=e.horAngles[0],s=e.horAngles[e.numHorAngles-1];for(let e=0;e<r;++e){let i=e%t,r=Math.floor(e/t);s-n!=0&&(i<n||i>=s)&&(i%=2*s)>s&&(i=2*s-i),o[e]=a(r,i)}return o}load(e,t,i,r){let o=new $4xklQ.FileLoader(this.manager);o.setResponseType("text"),o.setCrossOrigin(this.crossOrigin),o.setWithCredentials(this.withCredentials),o.setPath(this.path),o.setRequestHeader(this.requestHeader);let a=new $4xklQ.DataTexture(null,360,180,$4xklQ.RedFormat,$4xklQ.FloatType);return a.minFilter=$4xklQ.LinearFilter,a.magFilter=$4xklQ.LinearFilter,o.load(e,e=>{let i=new $afe8e8564a06cada$var$IESLamp(e);a.image.data=this._getIESValues(i),a.needsUpdate=!0,void 0!==t&&t(a)},i,r),a}parse(e){let t=new $afe8e8564a06cada$var$IESLamp(e),i=new $4xklQ.DataTexture(null,360,180,$4xklQ.RedFormat,$4xklQ.FloatType);return i.minFilter=$4xklQ.LinearFilter,i.magFilter=$4xklQ.LinearFilter,i.image.data=this._getIESValues(t),i.needsUpdate=!0,i}}const $e59089c295a08e20$var$prevColor=new $4xklQ.Color;class $e59089c295a08e20$export$cc46c2e928f0cae0 extends $4xklQ.WebGLArrayRenderTarget{constructor(...e){super(...e);let t=this.texture;t.format=$4xklQ.RGBAFormat,t.type=$4xklQ.FloatType,t.minFilter=$4xklQ.LinearFilter,t.magFilter=$4xklQ.LinearFilter,t.wrapS=$4xklQ.ClampToEdgeWrapping,t.wrapT=$4xklQ.ClampToEdgeWrapping,t.generateMipmaps=!1,t.updateFrom=(...e)=>{this.updateFrom(...e)};let i=new $0684d9623c4c8e37$export$3983474c8e6e978b(new $4xklQ.MeshBasicMaterial);this.fsQuad=i,this.iesLoader=new $afe8e8564a06cada$export$f1ffec369846389b}async updateFrom(e,t){let i=e.getRenderTarget(),r=e.toneMapping,o=e.getClearAlpha();e.getClearColor($e59089c295a08e20$var$prevColor);let a=t.length||1;this.setSize(360,180,a),e.setClearColor(0,0),e.toneMapping=$4xklQ.NoToneMapping;let n=this.fsQuad;for(let i=0,r=a;i<r;i++){let r=t[i];r&&(r.matrixAutoUpdate=!1,r.matrix.identity(),n.material.map=r,n.material.transparent=!0,e.setRenderTarget(this,i),n.render(e),r.updateMatrix(),r.matrixAutoUpdate=!0)}n.material.map=null,e.setClearColor($e59089c295a08e20$var$prevColor,o),e.setRenderTarget(i),e.toneMapping=r,n.dispose()}dispose(){super.dispose(),this.fsQuad.dispose()}}class $134dfafd06cc9b8a$export$746cbc9e65f5bcb8 extends $282727f340fc2a87$export$f1ac3a587b6cbb5d{onBeforeRender(){this.setDefine("FEATURE_DOF",0===this.physicalCamera.bokehSize?0:1)}constructor(e){super({transparent:!0,depthWrite:!1,defines:{FEATURE_MIS:1,FEATURE_DOF:1,FEATURE_GRADIENT_BG:0,TRANSPARENT_TRAVERSALS:5,CAMERA_TYPE:0},uniforms:{resolution:{value:new $4xklQ.Vector2},bounces:{value:3},physicalCamera:{value:new $bbc0a4ca684807d3$export$2e27c77dea3c9d73},bvh:{value:new $f0895efafb08d2de$export$4dc20da53fccce35},normalAttribute:{value:new $e3f9574644e4828d$export$5444fd0f1815741f},tangentAttribute:{value:new $e3f9574644e4828d$export$5444fd0f1815741f},uvAttribute:{value:new $e3f9574644e4828d$export$5444fd0f1815741f},colorAttribute:{value:new $e3f9574644e4828d$export$5444fd0f1815741f},materialIndexAttribute:{value:new $e3f9574644e4828d$export$de036370a093ef},materials:{value:new $dd32143970950b7f$export$ae96f3619813ce17},textures:{value:new $e28b7d03d182ad46$export$dbbaa51cb2d0b2f7().texture},lights:{value:new $2cf074fec953e79b$export$bb02c0eb15767758},iesProfiles:{value:new $e59089c295a08e20$export$cc46c2e928f0cae0().texture},cameraWorldMatrix:{value:new $4xklQ.Matrix4},invProjectionMatrix:{value:new $4xklQ.Matrix4},backgroundBlur:{value:0},environmentIntensity:{value:1},environmentRotation:{value:new $4xklQ.Matrix3},envMapInfo:{value:new $57d502cd87eced98$export$e5a77e5d6a85a862},seed:{value:0},opacity:{value:1},filterGlossyFactor:{value:0},bgGradientTop:{value:new $4xklQ.Color(1118481)},bgGradientBottom:{value:new $4xklQ.Color(0)},backgroundAlpha:{value:1}},vertexShader:`

				varying vec2 vUv;
				void main() {

					vec4 mvPosition = vec4( position, 1.0 );
					mvPosition = modelViewMatrix * mvPosition;
					gl_Position = projectionMatrix * mvPosition;

					vUv = uv;

				}

			`,fragmentShader:`
				#define RAY_OFFSET 1e-4

				precision highp isampler2D;
				precision highp usampler2D;
				precision highp sampler2DArray;
				vec4 envMapTexelToLinear( vec4 a ) { return a; }
				#include <common>

				${$3dd70ff3f09b62fc$export$1b1b39b9861ca334}
				${$3dd70ff3f09b62fc$export$69755dc6a3b03474}
				${$de1654de00d21b4e$export$570ab67b705632a4}
				${$de1654de00d21b4e$export$2861714a2bd5835b}

				${$62e02ca5c2ecb453$export$207a3935c1ec5d77}
				${$cf7c94388ac486fb$export$aba3482f45fc2e55}
				${$99a046e0a34b3c61$export$c4e96847515c3dca}

				uniform mat3 environmentRotation;
				uniform float backgroundBlur;
				uniform float backgroundAlpha;

				#if FEATURE_GRADIENT_BG

				uniform vec3 bgGradientTop;
				uniform vec3 bgGradientBottom;

				#endif

				#if FEATURE_DOF

				uniform PhysicalCamera physicalCamera;

				#endif

				uniform vec2 resolution;
				uniform int bounces;
				uniform mat4 cameraWorldMatrix;
				uniform mat4 invProjectionMatrix;
				uniform sampler2D normalAttribute;
				uniform sampler2D tangentAttribute;
				uniform sampler2D uvAttribute;
				uniform sampler2D colorAttribute;
				uniform usampler2D materialIndexAttribute;
				uniform BVH bvh;
				uniform float environmentIntensity;
				uniform float filterGlossyFactor;
				uniform int seed;
				uniform float opacity;
				uniform sampler2D materials;
				uniform LightsInfo lights;
				uniform sampler2DArray iesProfiles;

				${$c25bfd093d099434$export$72ea2c7ee2a3cb14}

				uniform EquirectHdrInfo envMapInfo;

				uniform sampler2DArray textures;
				varying vec2 vUv;

				float applyFilteredGlossy( float roughness, float accumulatedRoughness ) {

					return clamp(
						max(
							roughness,
							accumulatedRoughness * filterGlossyFactor * 5.0 ),
						0.0,
						1.0
					);

				}

				vec3 sampleBackground( vec3 direction ) {

					#if FEATURE_GRADIENT_BG

					direction = normalize( direction + randDirection() * 0.05 );

					float value = ( direction.y + 1.0 ) / 2.0;
					value = pow( value, 2.0 );

					return mix( bgGradientBottom, bgGradientTop, value );

					#else

					vec3 sampleDir = normalize( direction + getHemisphereSample( direction, rand2() ) * 0.5 * backgroundBlur );
					return environmentIntensity * sampleEquirectEnvMapColor( sampleDir, envMapInfo.map );

					#endif

				}

				// step through multiple surface hits and accumulate color attenuation based on transmissive surfaces
				bool attenuateHit( BVH bvh, vec3 rayOrigin, vec3 rayDirection, int traversals, bool isShadowRay, out vec3 color ) {

					// hit results
					uvec4 faceIndices = uvec4( 0u );
					vec3 faceNormal = vec3( 0.0, 0.0, 1.0 );
					vec3 barycoord = vec3( 0.0 );
					float side = 1.0;
					float dist = 0.0;

					color = vec3( 1.0 );

					for ( int i = 0; i < traversals; i ++ ) {

						if ( bvhIntersectFirstHit( bvh, rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist ) ) {

							// TODO: attenuate the contribution based on the PDF of the resulting ray including refraction values
							// Should be able to work using the material BSDF functions which will take into account specularity, etc.
							// TODO: should we account for emissive surfaces here?

							vec2 uv = textureSampleBarycoord( uvAttribute, barycoord, faceIndices.xyz ).xy;
							vec4 vertexColor = textureSampleBarycoord( colorAttribute, barycoord, faceIndices.xyz );
							uint materialIndex = uTexelFetch1D( materialIndexAttribute, faceIndices.x ).r;
							Material material = readMaterialInfo( materials, materialIndex );

							// adjust the ray to the new surface
							bool isBelowSurface = dot( rayDirection, faceNormal ) < 0.0;
							vec3 point = rayOrigin + rayDirection * dist;
							vec3 absPoint = abs( point );
							float maxPoint = max( absPoint.x, max( absPoint.y, absPoint.z ) );
							rayOrigin = point + faceNormal * ( maxPoint + 1.0 ) * ( isBelowSurface ? - RAY_OFFSET : RAY_OFFSET );

							if ( ! material.castShadow && isShadowRay ) {

								continue;

							}

							// Opacity Test

							// albedo
							vec4 albedo = vec4( material.color, material.opacity );
							if ( material.map != - 1 ) {

								vec3 uvPrime = material.mapTransform * vec3( uv, 1 );
								albedo *= texture2D( textures, vec3( uvPrime.xy, material.map ) );

							}

							if ( material.vertexColors ) {

								albedo *= vertexColor;

							}

							// alphaMap
							if ( material.alphaMap != - 1 ) {

								albedo.a *= texture2D( textures, vec3( uv, material.alphaMap ) ).x;

							}

							// transmission
							float transmission = material.transmission;
							if ( material.transmissionMap != - 1 ) {

								vec3 uvPrime = material.transmissionMapTransform * vec3( uv, 1 );
								transmission *= texture2D( textures, vec3( uvPrime.xy, material.transmissionMap ) ).r;

							}

							// metalness
							float metalness = material.metalness;
							if ( material.metalnessMap != - 1 ) {

								vec3 uvPrime = material.metalnessMapTransform * vec3( uv, 1 );
								metalness *= texture2D( textures, vec3( uvPrime.xy, material.metalnessMap ) ).b;

							}

							float alphaTest = material.alphaTest;
							bool useAlphaTest = alphaTest != 0.0;
							float transmissionFactor = ( 1.0 - metalness ) * transmission;
							if (
								transmissionFactor < rand() && ! (
									// material sidedness
									material.side != 0.0 && side == material.side

									// alpha test
									|| useAlphaTest && albedo.a < alphaTest

									// opacity
									|| material.transparent && ! useAlphaTest && albedo.a < rand()
								)
							) {

								return true;

							}

							if ( side == 1.0 && isBelowSurface ) {

								// only attenuate by surface color on the way in
								color *= mix( vec3( 1.0 ), albedo.rgb, transmissionFactor );

							} else if ( side == - 1.0 ) {

								// attenuate by medium once we hit the opposite side of the model
								color *= transmissionAttenuation( dist, material.attenuationColor, material.attenuationDistance );

							}

						} else {

							return false;

						}

					}

					return true;

				}

				// returns whether the ray hit anything before a certain distance, not just the first surface. Could be optimized to not check the full hierarchy.
				bool anyCloserHit( BVH bvh, vec3 rayOrigin, vec3 rayDirection, float maxDist ) {

					uvec4 faceIndices = uvec4( 0u );
					vec3 faceNormal = vec3( 0.0, 0.0, 1.0 );
					vec3 barycoord = vec3( 0.0 );
					float side = 1.0;
					float dist = 0.0;
					bool hit = bvhIntersectFirstHit( bvh, rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist );
					return hit && dist < maxDist;

				}

				// tentFilter from Peter Shirley's 'Realistic Ray Tracing (2nd Edition)' book, pg. 60
				// erichlof/THREE.js-PathTracing-Renderer/
				float tentFilter( float x ) {

					return x < 0.5 ? sqrt( 2.0 * x ) - 1.0 : 1.0 - sqrt( 2.0 - ( 2.0 * x ) );

				}

				vec3 ndcToRayOrigin( vec2 coord ) {

					vec4 rayOrigin4 = cameraWorldMatrix * invProjectionMatrix * vec4( coord, - 1.0, 1.0 );
					return rayOrigin4.xyz / rayOrigin4.w;
				}

				void getCameraRay( out vec3 rayDirection, out vec3 rayOrigin ) {

					vec2 ssd = vec2( 1.0 ) / resolution;

					// Jitter the camera ray by finding a uv coordinate at a random sample
					// around this pixel's UV coordinate
					vec2 jitteredUv = vUv + vec2( tentFilter( rand() ) * ssd.x, tentFilter( rand() ) * ssd.y );

					#if CAMERA_TYPE == 2

						// Equirectangular projection

						vec4 rayDirection4 = vec4( equirectUvToDirection( jitteredUv ), 0.0 );
						vec4 rayOrigin4 = vec4( 0.0, 0.0, 0.0, 1.0 );

						rayDirection4 = cameraWorldMatrix * rayDirection4;
						rayOrigin4 = cameraWorldMatrix * rayOrigin4;

						rayDirection = normalize( rayDirection4.xyz );
						rayOrigin = rayOrigin4.xyz / rayOrigin4.w;

					#else

						// get [- 1, 1] normalized device coordinates
						vec2 ndc = 2.0 * jitteredUv - vec2( 1.0 );

						rayOrigin = ndcToRayOrigin( ndc );

						#if CAMERA_TYPE == 1

							// Orthographic projection

							rayDirection = ( cameraWorldMatrix * vec4( 0.0, 0.0, - 1.0, 0.0 ) ).xyz;
							rayDirection = normalize( rayDirection );

						#else

							// Perspective projection

							rayDirection = normalize( mat3(cameraWorldMatrix) * ( invProjectionMatrix * vec4( ndc, 0.0, 1.0 ) ).xyz );

						#endif

					#endif

					#if FEATURE_DOF
					{

						// depth of field
						vec3 focalPoint = rayOrigin + normalize( rayDirection ) * physicalCamera.focusDistance;

						// get the aperture sample
						vec2 apertureSample = sampleAperture( physicalCamera.apertureBlades ) * physicalCamera.bokehSize * 0.5 * 1e-3;

						// rotate the aperture shape
						float ac = cos( physicalCamera.apertureRotation );
						float as = sin( physicalCamera.apertureRotation );
						apertureSample = vec2(
							apertureSample.x * ac - apertureSample.y * as,
							apertureSample.x * as + apertureSample.y * ac
						);
						apertureSample.x *= saturate( physicalCamera.anamorphicRatio );
						apertureSample.y *= saturate( 1.0 / physicalCamera.anamorphicRatio );

						// create the new ray
						rayOrigin += ( cameraWorldMatrix * vec4( apertureSample, 0.0, 0.0 ) ).xyz;
						rayDirection = focalPoint - rayOrigin;

					}
					#endif

					rayDirection = normalize( rayDirection );

				}

				void main() {

					rng_initialize( gl_FragCoord.xy, seed );

					vec3 rayDirection;
					vec3 rayOrigin;

					getCameraRay( rayDirection, rayOrigin );

					// inverse environment rotation
					mat3 invEnvironmentRotation = inverse( environmentRotation );

					// final color
					gl_FragColor = vec4( 0.0 );
					gl_FragColor.a = 1.0;

					// hit results
					uvec4 faceIndices = uvec4( 0u );
					vec3 faceNormal = vec3( 0.0, 0.0, 1.0 );
					vec3 barycoord = vec3( 0.0 );
					float side = 1.0;
					float dist = 0.0;

					// path tracing state
					float accumulatedRoughness = 0.0;
					float accumulatedClearcoatRoughness = 0.0;
					bool transmissiveRay = true;
					int transparentTraversals = TRANSPARENT_TRAVERSALS;
					vec3 throughputColor = vec3( 1.0 );
					SampleRec sampleRec;
					int i;
					bool isShadowRay = false;

					for ( i = 0; i < bounces; i ++ ) {

						bool hit = bvhIntersectFirstHit( bvh, rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist );

						LightSampleRec lightHit = lightsClosestHit( lights.tex, lights.count, rayOrigin, rayDirection );

						if ( lightHit.hit && ( lightHit.dist < dist || !hit ) ) {

							if ( i == 0 || transmissiveRay ) {

								gl_FragColor.rgb += lightHit.emission * throughputColor;

							} else {

								#if FEATURE_MIS

								// NOTE: we skip MIS for spotlights since we haven't fixed the forward
								// path tracing code path, yet
								if ( lightHit.type == SPOT_LIGHT_TYPE ) {

									gl_FragColor.rgb += lightHit.emission * throughputColor;

								} else {

									// weight the contribution
									float misWeight = misHeuristic( sampleRec.pdf, lightHit.pdf / float( lights.count + 1u ) );
									gl_FragColor.rgb += lightHit.emission * throughputColor * misWeight;

								}

								#else

								gl_FragColor.rgb += lightHit.emission * throughputColor;

								#endif

							}
							break;

						}

						if ( ! hit ) {

							if ( i == 0 || transmissiveRay ) {

								gl_FragColor.rgb += sampleBackground( environmentRotation * rayDirection ) * throughputColor;
								gl_FragColor.a = backgroundAlpha;

							} else {

								#if FEATURE_MIS

								// get the PDF of the hit envmap point
								vec3 envColor;
								float envPdf = envMapSample( environmentRotation * rayDirection, envMapInfo, envColor );
								envPdf /= float( lights.count + 1u );

								// and weight the contribution
								float misWeight = misHeuristic( sampleRec.pdf, envPdf );
								gl_FragColor.rgb += environmentIntensity * envColor * throughputColor * misWeight;

								#else

								gl_FragColor.rgb +=
									environmentIntensity *
									sampleEquirectEnvMapColor( environmentRotation * rayDirection, envMapInfo.map ) *
									throughputColor;

								#endif

							}
							break;

						}

						uint materialIndex = uTexelFetch1D( materialIndexAttribute, faceIndices.x ).r;
						Material material = readMaterialInfo( materials, materialIndex );

						if ( material.matte && i == 0 ) {

							gl_FragColor = vec4( 0.0 );
							break;

						}

						// if we've determined that this is a shadow ray and we've hit an item with no shadow casting
						// then skip it
						if ( ! material.castShadow && isShadowRay ) {

							vec3 point = rayOrigin + rayDirection * dist;
							vec3 absPoint = abs( point );
							float maxPoint = max( absPoint.x, max( absPoint.y, absPoint.z ) );
							rayOrigin = point - ( maxPoint + 1.0 ) * faceNormal * RAY_OFFSET;

							continue;

						}

						// uv coord for textures
						vec2 uv = textureSampleBarycoord( uvAttribute, barycoord, faceIndices.xyz ).xy;
						vec4 vertexColor = textureSampleBarycoord( colorAttribute, barycoord, faceIndices.xyz );

						// albedo
						vec4 albedo = vec4( material.color, material.opacity );
						if ( material.map != - 1 ) {

							vec3 uvPrime = material.mapTransform * vec3( uv, 1 );
							albedo *= texture2D( textures, vec3( uvPrime.xy, material.map ) );
						}

						if ( material.vertexColors ) {

							albedo *= vertexColor;

						}

						// alphaMap
						if ( material.alphaMap != - 1 ) {

							albedo.a *= texture2D( textures, vec3( uv, material.alphaMap ) ).x;

						}

						// possibly skip this sample if it's transparent, alpha test is enabled, or we hit the wrong material side
						// and it's single sided.
						// - alpha test is disabled when it === 0
						// - the material sidedness test is complicated because we want light to pass through the back side but still
						// be able to see the front side. This boolean checks if the side we hit is the front side on the first ray
						// and we're rendering the other then we skip it. Do the opposite on subsequent bounces to get incoming light.
						float alphaTest = material.alphaTest;
						bool useAlphaTest = alphaTest != 0.0;
						if (
							// material sidedness
							material.side != 0.0 && side != material.side

							// alpha test
							|| useAlphaTest && albedo.a < alphaTest

							// opacity
							|| material.transparent && ! useAlphaTest && albedo.a < rand()
						) {

							vec3 point = rayOrigin + rayDirection * dist;
							vec3 absPoint = abs( point );
							float maxPoint = max( absPoint.x, max( absPoint.y, absPoint.z ) );
							rayOrigin = point - ( maxPoint + 1.0 ) * faceNormal * RAY_OFFSET;

							// only allow a limited number of transparency discards otherwise we could
							// crash the context with too long a loop.
							i -= sign( transparentTraversals );
							transparentTraversals -= sign( transparentTraversals );
							continue;

						}

						// fetch the interpolated smooth normal
						vec3 normal = normalize( textureSampleBarycoord(
							normalAttribute,
							barycoord,
							faceIndices.xyz
						).xyz );

						// roughness
						float roughness = material.roughness;
						if ( material.roughnessMap != - 1 ) {

							vec3 uvPrime = material.roughnessMapTransform * vec3( uv, 1 );
							roughness *= texture2D( textures, vec3( uvPrime.xy, material.roughnessMap ) ).g;

						}

						// metalness
						float metalness = material.metalness;
						if ( material.metalnessMap != - 1 ) {

							vec3 uvPrime = material.metalnessMapTransform * vec3( uv, 1 );
							metalness *= texture2D( textures, vec3( uvPrime.xy, material.metalnessMap ) ).b;

						}

						// emission
						vec3 emission = material.emissiveIntensity * material.emissive;
						if ( material.emissiveMap != - 1 ) {

							vec3 uvPrime = material.emissiveMapTransform * vec3( uv, 1 );
							emission *= texture2D( textures, vec3( uvPrime.xy, material.emissiveMap ) ).xyz;

						}

						// transmission
						float transmission = material.transmission;
						if ( material.transmissionMap != - 1 ) {

							vec3 uvPrime = material.transmissionMapTransform * vec3( uv, 1 );
							transmission *= texture2D( textures, vec3( uvPrime.xy, material.transmissionMap ) ).r;

						}

						// normal
						vec3 baseNormal = normal;
						if ( material.normalMap != - 1 ) {

							vec4 tangentSample = textureSampleBarycoord(
								tangentAttribute,
								barycoord,
								faceIndices.xyz
							);

							// some provided tangents can be malformed (0, 0, 0) causing the normal to be degenerate
							// resulting in NaNs and slow path tracing.
							if ( length( tangentSample.xyz ) > 0.0 ) {

								vec3 tangent = normalize( tangentSample.xyz );
								vec3 bitangent = normalize( cross( normal, tangent ) * tangentSample.w );
								mat3 vTBN = mat3( tangent, bitangent, normal );

								vec3 uvPrime = material.normalMapTransform * vec3( uv, 1 );
								vec3 texNormal = texture2D( textures, vec3( uvPrime.xy, material.normalMap ) ).xyz * 2.0 - 1.0;
								texNormal.xy *= material.normalScale;
								normal = vTBN * texNormal;

							}

						}

						normal *= side;

						// clearcoat
						float clearcoat = material.clearcoat;
						if ( material.clearcoatMap != - 1 ) {

							vec3 uvPrime = material.clearcoatMapTransform * vec3( uv, 1 );
							clearcoat *= texture2D( textures, vec3( uvPrime.xy, material.clearcoatMap ) ).r;

						}

						// clearcoatRoughness
						float clearcoatRoughness = material.clearcoatRoughness;
						if ( material.clearcoatRoughnessMap != - 1 ) {

							vec3 uvPrime = material.clearcoatRoughnessMapTransform * vec3( uv, 1 );
							clearcoat *= texture2D( textures, vec3( uvPrime.xy, material.clearcoatRoughnessMap ) ).g;

						}

						// clearcoatNormal
						vec3 clearcoatNormal = baseNormal;
						if ( material.clearcoatNormalMap != - 1 ) {

							vec4 tangentSample = textureSampleBarycoord(
								tangentAttribute,
								barycoord,
								faceIndices.xyz
							);

							// some provided tangents can be malformed (0, 0, 0) causing the normal to be degenerate
							// resulting in NaNs and slow path tracing.
							if ( length( tangentSample.xyz ) > 0.0 ) {

								vec3 tangent = normalize( tangentSample.xyz );
								vec3 bitangent = normalize( cross( clearcoatNormal, tangent ) * tangentSample.w );
								mat3 vTBN = mat3( tangent, bitangent, clearcoatNormal );

								vec3 uvPrime = material.clearcoatNormalMapTransform * vec3( uv, 1 );
								vec3 texNormal = texture2D( textures, vec3( uvPrime.xy, material.clearcoatNormalMap ) ).xyz * 2.0 - 1.0;
								texNormal.xy *= material.clearcoatNormalScale;
								clearcoatNormal = vTBN * texNormal;

							}

						}

						clearcoatNormal *= side;

						// sheenColor
						vec3 sheenColor = material.sheenColor;
						if ( material.sheenColorMap != - 1 ) {

							vec3 uvPrime = material.sheenColorMapTransform * vec3( uv, 1 );
							sheenColor *= texture2D( textures, vec3( uvPrime.xy, material.sheenColorMap ) ).rgb;

						}

						// sheenRoughness
						float sheenRoughness = material.sheenRoughness;
						if ( material.sheenRoughnessMap != - 1 ) {

							vec3 uvPrime = material.sheenRoughnessMapTransform * vec3( uv, 1 );
							sheenRoughness *= texture2D( textures, vec3( uvPrime.xy, material.sheenRoughnessMap ) ).a;

						}

						// iridescence
						float iridescence = material.iridescence;
						if ( material.iridescenceMap != - 1 ) {

							vec3 uvPrime = material.iridescenceMapTransform * vec3( uv, 1 );
							iridescence *= texture2D( textures, vec3( uvPrime.xy, material.iridescenceMap ) ).r;

						}

						// iridescence thickness
						float iridescenceThickness = material.iridescenceThicknessMaximum;
						if ( material.iridescenceThicknessMap != - 1 ) {

							vec3 uvPrime = material.iridescenceThicknessMapTransform * vec3( uv, 1 );
							float iridescenceThicknessSampled = texture2D( textures, vec3( uvPrime.xy, material.iridescenceThicknessMap ) ).g;
							iridescenceThickness = mix( material.iridescenceThicknessMinimum, material.iridescenceThicknessMaximum, iridescenceThicknessSampled );

						}

						iridescence = iridescenceThickness == 0.0 ? 0.0 : iridescence;

						// specular color
						vec3 specularColor = material.specularColor;
						if ( material.specularColorMap != - 1 ) {

							vec3 uvPrime = material.specularColorMapTransform * vec3( uv, 1 );
							specularColor *= texture2D( textures, vec3( uvPrime.xy, material.specularColorMap ) ).rgb;

						}

						// specular intensity
						float specularIntensity = material.specularIntensity;
						if ( material.specularIntensityMap != - 1 ) {

							vec3 uvPrime = material.specularIntensityMapTransform * vec3( uv, 1 );
							specularIntensity *= texture2D( textures, vec3( uvPrime.xy, material.specularIntensityMap ) ).a;

						}

						SurfaceRec surfaceRec;
						surfaceRec.normal = normal;
						surfaceRec.faceNormal = faceNormal;
						surfaceRec.transmission = transmission;
						surfaceRec.ior = material.ior;
						surfaceRec.emission = emission;
						surfaceRec.metalness = metalness;
						surfaceRec.color = albedo.rgb;
						surfaceRec.clearcoat = clearcoat;
						surfaceRec.sheenColor = sheenColor;
						surfaceRec.iridescence = iridescence;
						surfaceRec.iridescenceIor = material.iridescenceIor;
						surfaceRec.iridescenceThickness = iridescenceThickness;
						surfaceRec.specularColor = specularColor;
						surfaceRec.specularIntensity = specularIntensity;
						surfaceRec.attenuationColor = material.attenuationColor;
						surfaceRec.attenuationDistance = material.attenuationDistance;

						// apply perceptual roughness factor from gltf
						// https://registry.khronos.org/glTF/specs/2.0/glTF-2.0.html#microfacet-surfaces
						surfaceRec.roughness = roughness * roughness;
						surfaceRec.clearcoatRoughness = clearcoatRoughness * clearcoatRoughness;
						surfaceRec.sheenRoughness = sheenRoughness * sheenRoughness;

						// frontFace is used to determine transmissive properties and PDF. If no transmission is used
						// then we can just always assume this is a front face.
						surfaceRec.frontFace = side == 1.0 || transmission == 0.0;
						surfaceRec.iorRatio = material.thinFilm || surfaceRec.frontFace ? 1.0 / material.ior : material.ior;
						surfaceRec.thinFilm = material.thinFilm;

						// Compute the filtered roughness value to use during specular reflection computations.
						// The accumulated roughness value is scaled by a user setting and a "magic value" of 5.0.
						// If we're exiting something transmissive then scale the factor down significantly so we can retain
						// sharp internal reflections
						surfaceRec.filteredRoughness = applyFilteredGlossy( surfaceRec.roughness, accumulatedRoughness );
						surfaceRec.filteredClearcoatRoughness = applyFilteredGlossy( surfaceRec.clearcoatRoughness, accumulatedClearcoatRoughness );

						mat3 normalBasis = getBasisFromNormal( surfaceRec.normal );
						mat3 invBasis = inverse( normalBasis );

						mat3 clearcoatNormalBasis = getBasisFromNormal( clearcoatNormal );
						mat3 clearcoatInvBasis = inverse( clearcoatNormalBasis );

						vec3 outgoing = - normalize( invBasis * rayDirection );
						vec3 clearcoatOutgoing = - normalize( clearcoatInvBasis * rayDirection );
						sampleRec = bsdfSample( outgoing, clearcoatOutgoing, normalBasis, invBasis, clearcoatNormalBasis, clearcoatInvBasis, surfaceRec );

						isShadowRay = sampleRec.specularPdf < rand();

						// adjust the hit point by the surface normal by a factor of some offset and the
						// maximum component-wise value of the current point to accommodate floating point
						// error as values increase.
						vec3 point = rayOrigin + rayDirection * dist;
						vec3 absPoint = abs( point );
						float maxPoint = max( absPoint.x, max( absPoint.y, absPoint.z ) );
						rayDirection = normalize( normalBasis * sampleRec.direction );

						bool isBelowSurface = dot( rayDirection, faceNormal ) < 0.0;
						rayOrigin = point + faceNormal * ( maxPoint + 1.0 ) * ( isBelowSurface ? - RAY_OFFSET : RAY_OFFSET );

						// direct env map sampling
						#if FEATURE_MIS

						// uniformly pick a light or environment map
						if( rand() > 1.0 / float( lights.count + 1u ) ) {

							// sample a light or environment
							LightSampleRec lightSampleRec = randomLightSample( lights.tex, iesProfiles, lights.count, rayOrigin );

							bool isSampleBelowSurface = dot( faceNormal, lightSampleRec.direction ) < 0.0;
							if ( isSampleBelowSurface ) {

								lightSampleRec.pdf = 0.0;

							}

							// check if a ray could even reach the light area
							if (
								lightSampleRec.pdf > 0.0 &&
								isDirectionValid( lightSampleRec.direction, normal, faceNormal ) &&
								! anyCloserHit( bvh, rayOrigin, lightSampleRec.direction, lightSampleRec.dist )
							) {

								// get the material pdf
								vec3 sampleColor;
								float lightMaterialPdf = bsdfResult( outgoing, clearcoatOutgoing, normalize( invBasis * lightSampleRec.direction ), normalize( clearcoatInvBasis * lightSampleRec.direction ), surfaceRec, sampleColor );
								bool isValidSampleColor = all( greaterThanEqual( sampleColor, vec3( 0.0 ) ) );
								if ( lightMaterialPdf > 0.0 && isValidSampleColor ) {

									// weight the direct light contribution
									float lightPdf = lightSampleRec.pdf / float( lights.count + 1u );
									float misWeight = misHeuristic( lightPdf, lightMaterialPdf );
									gl_FragColor.rgb += lightSampleRec.emission * throughputColor * sampleColor * misWeight / lightPdf;

								}

							}

						} else {

							// find a sample in the environment map to include in the contribution
							vec3 envColor, envDirection;
							float envPdf = randomEnvMapSample( envMapInfo, envColor, envDirection );
							envDirection = invEnvironmentRotation * envDirection;

							// this env sampling is not set up for transmissive sampling and yields overly bright
							// results so we ignore the sample in this case.
							// TODO: this should be improved but how? The env samples could traverse a few layers?
							bool isSampleBelowSurface = dot( faceNormal, envDirection ) < 0.0;
							if ( isSampleBelowSurface ) {

								envPdf = 0.0;

							}

							// check if a ray could even reach the surface
							vec3 attenuatedColor;
							if (
								envPdf > 0.0 &&
								isDirectionValid( envDirection, normal, faceNormal ) &&
								! attenuateHit( bvh, rayOrigin, envDirection, bounces - i, isShadowRay, attenuatedColor )
							) {

								// get the material pdf
								vec3 sampleColor;
								float envMaterialPdf = bsdfResult( outgoing, clearcoatOutgoing, normalize( invBasis * envDirection ), normalize( clearcoatInvBasis * envDirection ), surfaceRec, sampleColor );
								bool isValidSampleColor = all( greaterThanEqual( sampleColor, vec3( 0.0 ) ) );
								if ( envMaterialPdf > 0.0 && isValidSampleColor ) {

									// weight the direct light contribution
									envPdf /= float( lights.count + 1u );
									float misWeight = misHeuristic( envPdf, envMaterialPdf );
									gl_FragColor.rgb += attenuatedColor * environmentIntensity * envColor * throughputColor * sampleColor * misWeight / envPdf;

								}

							}

						}
						#endif

						// accumulate a roughness value to offset diffuse, specular, diffuse rays that have high contribution
						// to a single pixel resulting in fireflies
						if ( ! isBelowSurface ) {

							// determine if this is a rough normal or not by checking how far off straight up it is
							vec3 halfVector = normalize( outgoing + sampleRec.direction );
							accumulatedRoughness += sin( acosApprox( halfVector.z ) );

							vec3 clearcoatHalfVector = normalize( clearcoatOutgoing + sampleRec.clearcoatDirection );
							accumulatedClearcoatRoughness += sin( acosApprox( clearcoatHalfVector.z ) );

							transmissiveRay = false;

						}

						// accumulate color
						gl_FragColor.rgb += ( emission * throughputColor );

						// skip the sample if our PDF or ray is impossible
						if ( sampleRec.pdf <= 0.0 || ! isDirectionValid( rayDirection, normal, faceNormal) ) {

							break;

						}

						throughputColor *= sampleRec.color / sampleRec.pdf;

						// attenuate the throughput color by the medium color
						if ( side == - 1.0 ) {

							throughputColor *= transmissionAttenuation( dist, surfaceRec.attenuationColor, surfaceRec.attenuationDistance );

						}

						// discard the sample if there are any NaNs
						if ( any( isnan( throughputColor ) ) || any( isinf( throughputColor ) ) ) {

							break;

						}

					}

					gl_FragColor.a *= opacity;

				}

			`}),this.setValues(e)}}var $awRkS=parcelRequire("awRkS"),$hu0fb=parcelRequire("hu0fb"),$02720af05ebc5d11$export$1111800106ba519a=function(){"use strict";var e,t="b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",i="b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb",r=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),o=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if("object"!=typeof WebAssembly)return{supported:!1};var a=WebAssembly.validate(r)?i:t,n=WebAssembly.instantiate(s(a),{}).then(function(t){(e=t.instance).exports.__wasm_call_ctors()});function s(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;++i){var r=e.charCodeAt(i);t[i]=r>96?r-97:r>64?r-39:r+4}for(var a=0,i=0;i<e.length;++i)t[a++]=t[i]<60?o[t[i]]:(t[i]-60)*64+t[++i];return t.buffer.slice(0,a)}function l(t,i,r,o,a,n){var s=e.exports.sbrk,l=r+3&-4,h=s(l*o),c=s(a.length),d=new Uint8Array(e.exports.memory.buffer);d.set(a,c);var p=t(h,r,o,c,a.length);if(0==p&&n&&n(h,l,o),i.set(d.subarray(h,h+r*o)),s(h-s(0)),0!=p)throw Error("Malformed buffer data: "+p)}var h={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},c={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},d=[],p=0;function u(e){var t={object:new Worker(e),pending:0,requests:{}};return t.object.onmessage=function(e){var i=e.data;t.pending-=i.count,t.requests[i.id][i.action](i.value),delete t.requests[i.id]},t}function m(e){for(var t="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(s(a))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+l.toString()+f.toString(),i=new Blob([t],{type:"text/javascript"}),r=URL.createObjectURL(i),o=0;o<e;++o)d[o]=u(r);URL.revokeObjectURL(r)}function g(e,t,i,r,o){for(var a=d[0],n=1;n<d.length;++n)d[n].pending<a.pending&&(a=d[n]);return new Promise(function(n,s){var l=new Uint8Array(i),h=p++;a.pending+=e,a.requests[h]={resolve:n,reject:s},a.object.postMessage({id:h,count:e,size:t,source:l,mode:r,filter:o},[l.buffer])})}function f(t){n.then(function(){var i=t.data;try{var r=new Uint8Array(i.count*i.size);l(e.exports[i.mode],r,i.count,i.size,i.source,e.exports[i.filter]),self.postMessage({id:i.id,count:i.count,action:"resolve",value:r},[r.buffer])}catch(e){self.postMessage({id:i.id,count:i.count,action:"reject",value:e})}})}return{ready:n,supported:!0,useWorkers:function(e){m(e)},decodeVertexBuffer:function(t,i,r,o,a){l(e.exports.meshopt_decodeVertexBuffer,t,i,r,o,e.exports[h[a]])},decodeIndexBuffer:function(t,i,r,o){l(e.exports.meshopt_decodeIndexBuffer,t,i,r,o)},decodeIndexSequence:function(t,i,r,o){l(e.exports.meshopt_decodeIndexSequence,t,i,r,o)},decodeGltfBuffer:function(t,i,r,o,a,n){l(e.exports[c[a]],t,i,r,o,e.exports[h[n]])},decodeGltfBufferAsync:function(t,i,r,o,a){return d.length>0?g(t,i,r,c[o],h[a]):n.then(function(){var n=new Uint8Array(t*i);return l(e.exports[c[o]],n,t,i,r,e.exports[h[a]]),n})}}}(),$4xklQ=parcelRequire("4xklQ"),$1DCdP=parcelRequire("1DCdP"),$ckwVR=parcelRequire("ckwVR"),$4xklQ=parcelRequire("4xklQ");const $6679aaec31e4afef$var$_positionVector=new $4xklQ.Vector3,$6679aaec31e4afef$var$_normalVector=new $4xklQ.Vector3,$6679aaec31e4afef$var$_tangentVector=new $4xklQ.Vector3,$6679aaec31e4afef$var$_tangentVector4=new $4xklQ.Vector4,$6679aaec31e4afef$var$_morphVector=new $4xklQ.Vector3,$6679aaec31e4afef$var$_temp=new $4xklQ.Vector3,$6679aaec31e4afef$var$_skinIndex=new $4xklQ.Vector4,$6679aaec31e4afef$var$_skinWeight=new $4xklQ.Vector4,$6679aaec31e4afef$var$_matrix=new $4xklQ.Matrix4,$6679aaec31e4afef$var$_boneMatrix=new $4xklQ.Matrix4;function $6679aaec31e4afef$var$validateAttributes(e,t){if(!e&&!t)return;let i=e.count===t.count,r=e.normalized===t.normalized,o=e.array.constructor===t.array.constructor,a=e.itemSize===t.itemSize;if(!i||!r||!o||!a)throw Error()}function $6679aaec31e4afef$var$createAttributeClone(e,t=null){let i=e.array.constructor,r=e.normalized,o=e.itemSize,a=null===t?e.count:t;return new $4xklQ.BufferAttribute(new i(o*a),o,r)}function $6679aaec31e4afef$var$copyAttributeContents(e,t,i=0){if(e.isInterleavedBufferAttribute){let r=e.itemSize;for(let o=0,a=e.count;o<a;o++){let a=o+i;t.setX(a,e.getX(o)),r>=2&&t.setY(a,e.getY(o)),r>=3&&t.setZ(a,e.getZ(o)),r>=4&&t.setW(a,e.getW(o))}}else{let r=t.array,o=r.constructor,a=r.BYTES_PER_ELEMENT*e.itemSize*i,n=new o(r.buffer,a,e.array.length);n.set(e.array)}}function $6679aaec31e4afef$var$addScaledMatrix(e,t,i){let r=e.elements,o=t.elements;for(let e=0,t=o.length;e<t;e++)r[e]+=o[e]*i}function $6679aaec31e4afef$var$boneNormalTransform(e,t,i){let r=e.skeleton,o=e.geometry,a=r.bones,n=r.boneInverses;$6679aaec31e4afef$var$_skinIndex.fromBufferAttribute(o.attributes.skinIndex,t),$6679aaec31e4afef$var$_skinWeight.fromBufferAttribute(o.attributes.skinWeight,t),$6679aaec31e4afef$var$_matrix.elements.fill(0);for(let e=0;e<4;e++){let t=$6679aaec31e4afef$var$_skinWeight.getComponent(e);if(0!==t){let i=$6679aaec31e4afef$var$_skinIndex.getComponent(e);$6679aaec31e4afef$var$_boneMatrix.multiplyMatrices(a[i].matrixWorld,n[i]),$6679aaec31e4afef$var$addScaledMatrix($6679aaec31e4afef$var$_matrix,$6679aaec31e4afef$var$_boneMatrix,t)}}return $6679aaec31e4afef$var$_matrix.multiply(e.bindMatrix).premultiply(e.bindMatrixInverse),i.transformDirection($6679aaec31e4afef$var$_matrix),i}function $6679aaec31e4afef$var$applyMorphTarget(e,t,i,r,o){$6679aaec31e4afef$var$_morphVector.set(0,0,0);for(let a=0,n=e.length;a<n;a++){let n=t[a],s=e[a];0!==n&&($6679aaec31e4afef$var$_temp.fromBufferAttribute(s,r),i?$6679aaec31e4afef$var$_morphVector.addScaledVector($6679aaec31e4afef$var$_temp,n):$6679aaec31e4afef$var$_morphVector.addScaledVector($6679aaec31e4afef$var$_temp.sub(o),n))}o.add($6679aaec31e4afef$var$_morphVector)}function $6679aaec31e4afef$var$mergeBufferGeometries(e,t={useGroups:!1,updateIndex:!1},i=new $4xklQ.BufferGeometry){let r=null!==e[0].index,{useGroups:o,updateIndex:a}=t,n=new Set(Object.keys(e[0].attributes)),s={},l=0;for(let t=0;t<e.length;++t){let a=e[t],h=0;if(r!==(null!==a.index))throw Error("StaticGeometryGenerator: All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them.");for(let e in a.attributes){if(!n.has(e))throw Error('StaticGeometryGenerator: All geometries must have compatible attributes; make sure "'+e+'" attribute exists among all geometries, or in none of them.');void 0===s[e]&&(s[e]=[]),s[e].push(a.attributes[e]),h++}if(h!==n.size)throw Error("StaticGeometryGenerator: Make sure all geometries have the same number of attributes.");if(o){let e;if(r)e=a.index.count;else if(void 0!==a.attributes.position)e=a.attributes.position.count;else throw Error("StaticGeometryGenerator: The geometry must have either an index or a position attribute");i.addGroup(l,e,t),l+=e}}if(r){let t=!1;if(!i.index){let r=0;for(let t=0;t<e.length;++t)r+=e[t].index.count;i.setIndex(new $4xklQ.BufferAttribute(new Uint32Array(r),1,!1)),t=!0}if(a||t){let t=i.index,r=0,o=0;for(let i=0;i<e.length;++i){let a=e[i],n=a.index;for(let e=0;e<n.count;++e)t.setX(r,n.getX(e)+o),r++;o+=a.attributes.position.count}}}for(let e in s){let t=s[e];if(!(e in i.attributes)){let r=0;for(let e in t)r+=t[e].count;i.setAttribute(e,$6679aaec31e4afef$var$createAttributeClone(s[e][0],r))}let r=i.attributes[e],o=0;for(let e in t){let i=t[e];$6679aaec31e4afef$var$copyAttributeContents(i,r,o),o+=i.count}}return i}class $6679aaec31e4afef$export$3516980c1ea07296{constructor(e){Array.isArray(e)||(e=[e]);let t=[];e.forEach(e=>{e.traverse(e=>{e.isMesh&&t.push(e)})}),this.meshes=t,this.useGroups=!0,this.applyWorldTransforms=!0,this.attributes=["position","normal","tangent","uv","uv2"],this._intermediateGeometry=Array(t.length).fill().map(()=>new $4xklQ.BufferGeometry)}getMaterials(){let e=[];return this.meshes.forEach(t=>{Array.isArray(t.material)?e.push(...t.material):e.push(t.material)}),e}generate(e=new $4xklQ.BufferGeometry){let{meshes:t,useGroups:i,_intermediateGeometry:r}=this;for(let e=0,i=t.length;e<i;e++){let i=t[e],o=r[e];this._convertToStaticGeometry(i,o)}for(let t in $6679aaec31e4afef$var$mergeBufferGeometries(r,{useGroups:i},e),e.attributes)e.attributes[t].needsUpdate=!0;return e}_convertToStaticGeometry(e,t=new $4xklQ.BufferGeometry){let i=e.geometry,r=this.applyWorldTransforms,o=this.attributes.includes("normal"),a=this.attributes.includes("tangent"),n=i.attributes,s=t.attributes;t.index||(t.index=i.index),s.position||t.setAttribute("position",$6679aaec31e4afef$var$createAttributeClone(n.position)),o&&!s.normal&&n.normal&&t.setAttribute("normal",$6679aaec31e4afef$var$createAttributeClone(n.normal)),a&&!s.tangent&&n.tangent&&t.setAttribute("tangent",$6679aaec31e4afef$var$createAttributeClone(n.tangent)),$6679aaec31e4afef$var$validateAttributes(i.index,t.index),$6679aaec31e4afef$var$validateAttributes(n.position,s.position),o&&$6679aaec31e4afef$var$validateAttributes(n.normal,s.normal),a&&$6679aaec31e4afef$var$validateAttributes(n.tangent,s.tangent);let l=n.position,h=o?n.normal:null,c=a?n.tangent:null,d=i.morphAttributes.position,p=i.morphAttributes.normal,u=i.morphAttributes.tangent,m=i.morphTargetsRelative,g=e.morphTargetInfluences,f=new $4xklQ.Matrix3;f.getNormalMatrix(e.matrixWorld);for(let t=0,i=n.position.count;t<i;t++)$6679aaec31e4afef$var$_positionVector.fromBufferAttribute(l,t),h&&$6679aaec31e4afef$var$_normalVector.fromBufferAttribute(h,t),c&&($6679aaec31e4afef$var$_tangentVector4.fromBufferAttribute(c,t),$6679aaec31e4afef$var$_tangentVector.fromBufferAttribute(c,t)),g&&(d&&$6679aaec31e4afef$var$applyMorphTarget(d,g,m,t,$6679aaec31e4afef$var$_positionVector),p&&$6679aaec31e4afef$var$applyMorphTarget(p,g,m,t,$6679aaec31e4afef$var$_normalVector),u&&$6679aaec31e4afef$var$applyMorphTarget(u,g,m,t,$6679aaec31e4afef$var$_tangentVector)),e.isSkinnedMesh&&(e.boneTransform(t,$6679aaec31e4afef$var$_positionVector),h&&$6679aaec31e4afef$var$boneNormalTransform(e,t,$6679aaec31e4afef$var$_normalVector),c&&$6679aaec31e4afef$var$boneNormalTransform(e,t,$6679aaec31e4afef$var$_tangentVector)),r&&$6679aaec31e4afef$var$_positionVector.applyMatrix4(e.matrixWorld),s.position.setXYZ(t,$6679aaec31e4afef$var$_positionVector.x,$6679aaec31e4afef$var$_positionVector.y,$6679aaec31e4afef$var$_positionVector.z),h&&(r&&$6679aaec31e4afef$var$_normalVector.applyNormalMatrix(f),s.normal.setXYZ(t,$6679aaec31e4afef$var$_normalVector.x,$6679aaec31e4afef$var$_normalVector.y,$6679aaec31e4afef$var$_normalVector.z)),c&&(r&&$6679aaec31e4afef$var$_tangentVector.transformDirection(e.matrixWorld),s.tangent.setXYZW(t,$6679aaec31e4afef$var$_tangentVector.x,$6679aaec31e4afef$var$_tangentVector.y,$6679aaec31e4afef$var$_tangentVector.z,$6679aaec31e4afef$var$_tangentVector4.w));for(let e in this.attributes){let i=this.attributes[e];"position"!==i&&"tangent"!==i&&"normal"!==i&&i in n&&(s[i]||t.setAttribute(i,$6679aaec31e4afef$var$createAttributeClone(n[i])),$6679aaec31e4afef$var$validateAttributes(n[i],s[i]),$6679aaec31e4afef$var$copyAttributeContents(n[i],s[i]))}return t}}var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ");function $480f14906ebb9e14$export$728c051ccdf8a702(e,t=!1){let i=null!==e[0].index,r=new Set(Object.keys(e[0].attributes)),o=new Set(Object.keys(e[0].morphAttributes)),a={},n={},s=e[0].morphTargetsRelative,l=new $4xklQ.BufferGeometry,h=0;for(let c=0;c<e.length;++c){let d=e[c],p=0;if(i!==(null!==d.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let e in d.attributes){if(!r.has(e))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+'. All geometries must have compatible attributes; make sure "'+e+'" attribute exists among all geometries, or in none of them.'),null;void 0===a[e]&&(a[e]=[]),a[e].push(d.attributes[e]),p++}if(p!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". Make sure all geometries have the same number of attributes."),null;if(s!==d.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let e in d.morphAttributes){if(!o.has(e))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===n[e]&&(n[e]=[]),n[e].push(d.morphAttributes[e])}if(l.userData.mergedUserData=l.userData.mergedUserData||[],l.userData.mergedUserData.push(d.userData),t){let e;if(i)e=d.index.count;else{if(void 0===d.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". The geometry must have either an index or a position attribute"),null;e=d.attributes.position.count}l.addGroup(h,e,c),h+=e}}if(i){let t=0,i=[];for(let r=0;r<e.length;++r){let o=e[r].index;for(let e=0;e<o.count;++e)i.push(o.getX(e)+t);t+=e[r].attributes.position.count}l.setIndex(i)}for(let e in a){let t=$480f14906ebb9e14$export$c4eef4c1c9d34ea9(a[e]);if(!t)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+e+" attribute."),null;l.setAttribute(e,t)}for(let e in n){let t=n[e][0].length;if(0===t)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[e]=[];for(let i=0;i<t;++i){let t=[];for(let r=0;r<n[e].length;++r)t.push(n[e][r][i]);let r=$480f14906ebb9e14$export$c4eef4c1c9d34ea9(t);if(!r)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+e+" morphAttribute."),null;l.morphAttributes[e].push(r)}}return l}function $480f14906ebb9e14$export$c4eef4c1c9d34ea9(e){let t,i,r;let o=0;for(let a=0;a<e.length;++a){let n=e[a];if(n.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===t&&(t=n.array.constructor),t!==n.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===i&&(i=n.itemSize),i!==n.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===r&&(r=n.normalized),r!==n.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;o+=n.array.length}let a=new t(o),n=0;for(let t=0;t<e.length;++t)a.set(e[t].array,n),n+=e[t].array.length;return new $4xklQ.BufferAttribute(a,i,r)}function $480f14906ebb9e14$export$e36bb98c4c944f9(e,t=1e-4){t=Math.max(t,Number.EPSILON);let i={},r=e.getIndex(),o=e.getAttribute("position"),a=r?r.count:o.count,n=0,s=Object.keys(e.attributes),l={},h={},c=[],d=["getX","getY","getZ","getW"];for(let t=0,i=s.length;t<i;t++){let i=s[t];l[i]=[];let r=e.morphAttributes[i];r&&(h[i]=Array(r.length).fill().map(()=>[]))}let p=Math.log10(1/t),u=Math.pow(10,p);for(let t=0;t<a;t++){let o=r?r.getX(t):t,a="";for(let t=0,i=s.length;t<i;t++){let i=s[t],r=e.getAttribute(i),n=r.itemSize;for(let e=0;e<n;e++)a+=`${~~(r[d[e]](o)*u)},`}if(a in i)c.push(i[a]);else{for(let t=0,i=s.length;t<i;t++){let i=s[t],r=e.getAttribute(i),a=e.morphAttributes[i],n=r.itemSize,c=l[i],p=h[i];for(let e=0;e<n;e++){let t=d[e];if(c.push(r[t](o)),a)for(let e=0,i=a.length;e<i;e++)p[e].push(a[e][t](o))}}i[a]=n,c.push(n),n++}}let m=e.clone();for(let t=0,i=s.length;t<i;t++){let i=s[t],r=e.getAttribute(i),o=new r.array.constructor(l[i]),a=new $4xklQ.BufferAttribute(o,r.itemSize,r.normalized);if(m.setAttribute(i,a),i in h)for(let t=0;t<h[i].length;t++){let r=e.morphAttributes[i][t],o=new r.array.constructor(h[i][t]),a=new $4xklQ.BufferAttribute(o,r.itemSize,r.normalized);m.morphAttributes[i][t]=a}}return m.setIndex(c),m}function $84baa8ef6849c5a0$export$e1fb14b1a1f43331(e,t,i){let r;let o=e.index,a=e.attributes.position,n=a.count,s=o?o.count:n,l=e.groups;0===l.length&&(l=[{count:s,start:0,materialIndex:0}]),r=i.length<=255?new Uint8Array(n):new Uint16Array(n);for(let e=0;e<l.length;e++){let a=l[e],n=a.start,h=a.count,c=Math.min(h,s-n),d=Array.isArray(t)?t[a.materialIndex]:t,p=i.indexOf(d);for(let e=0;e<c;e++){let t=n+e;o&&(t=o.getX(t)),r[t]=p}}return new $4xklQ.BufferAttribute(r,1,!1)}function $84baa8ef6849c5a0$export$92ddca84bb382733(e,t){if(t)for(let i in e.attributes)t.includes(i)||e.deleteAttribute(i)}function $84baa8ef6849c5a0$export$f5a01205d395aca(e,t){let{attributes:i=[],normalMapRequired:r=!1}=t;if(!e.attributes.normal&&i&&i.includes("normal")&&e.computeVertexNormals(),!e.attributes.uv&&i&&i.includes("uv")){let t=e.attributes.position.count;e.setAttribute("uv",new $4xklQ.BufferAttribute(new Float32Array(2*t),2,!1))}if(!e.attributes.tangent&&i&&i.includes("tangent")){if(r)null===e.index&&(e=$480f14906ebb9e14$export$e36bb98c4c944f9(e)),e.computeTangents();else{let t=e.attributes.position.count;e.setAttribute("tangent",new $4xklQ.BufferAttribute(new Float32Array(4*t),4,!1))}}if(!e.attributes.color&&i&&i.includes("color")){let t=e.attributes.position.count,i=new Float32Array(4*t);i.fill(1),e.setAttribute("color",new $4xklQ.BufferAttribute(i,4))}if(!e.index){let t=e.attributes.position.count,i=Array(t);for(let e=0;e<t;e++)i[e]=e;e.setIndex(i)}}function $84baa8ef6849c5a0$export$a76c5b0332cb1f05(e,t={}){t={attributes:null,cloneGeometry:!0,...t};let i=[],r=new Set;for(let t=0,i=e.length;t<i;t++){let i=e[t];!1!==i.visible&&(Array.isArray(i.material)?i.material.forEach(e=>r.add(e)):r.add(i.material))}let o=Array.from(r);for(let r=0,a=e.length;r<a;r++){let a=e[r];if(!1===a.visible)continue;a.updateMatrixWorld();let n=e[r].geometry,s=t.cloneGeometry?n.clone():n;s.applyMatrix4(a.matrixWorld),$84baa8ef6849c5a0$export$f5a01205d395aca(s,{attributes:t.attributes,normalMapRequired:!!a.material.normalMap}),$84baa8ef6849c5a0$export$92ddca84bb382733(s,t.attributes);let l=$84baa8ef6849c5a0$export$e1fb14b1a1f43331(s,a.material,o);s.setAttribute("materialIndex",l),i.push(s)}let a=new Set;o.forEach(e=>{for(let t in e){let i=e[t];i&&i.isTexture&&a.add(i)}});let n=$480f14906ebb9e14$export$728c051ccdf8a702(i,!1),s=Array.from(a);return{geometry:n,materials:o,textures:s}}class $ee4d6a6d20403ee8$export$245b5237bb7038ea{prepScene(e){e=Array.isArray(e)?e:[e];let t=[],i=[];for(let r=0,o=e.length;r<o;r++)e[r].traverse(e=>{if(e.isSkinnedMesh||e.isMesh&&e.morphTargetInfluences){let i=new $6679aaec31e4afef$export$3516980c1ea07296(e);i.attributes=["position","color","normal","tangent","uv","uv2"],i.applyWorldTransforms=!1;let r=new $4xklQ.Mesh(i.generate(),e.material);r.matrixWorld.copy(e.matrixWorld),r.matrix.copy(e.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale),t.push(r)}else e.isMesh?t.push(e):(e.isRectAreaLight||e.isSpotLight)&&i.push(e)});return{...$84baa8ef6849c5a0$export$a76c5b0332cb1f05(t,{attributes:["position","normal","tangent","uv","color"]}),lights:i}}generate(e,t={}){let{materials:i,textures:r,geometry:o,lights:a}=this.prepScene(e),n={strategy:$ckwVR.SAH,...t,maxLeafTris:1};return{scene:e,materials:i,textures:r,lights:a,bvh:new $1DCdP.MeshBVH(o,n)}}}"use strict";var $ckwVR=parcelRequire("ckwVR"),$4xklQ=parcelRequire("4xklQ"),$1DCdP=parcelRequire("1DCdP"),$56aa41d9f63b1df2$exports={},$aeadd62233fa5a57$exports={};$aeadd62233fa5a57$exports=function(e,t,i){if(t===self.location.origin)return e;var r=i?"import "+JSON.stringify(e)+";":"importScripts("+JSON.stringify(e)+");";return URL.createObjectURL(new Blob([r],{type:"application/javascript"}))};let $56aa41d9f63b1df2$var$url=new URL(parcelRequire("dRo73").resolve("6lZac"),import.meta.url);$56aa41d9f63b1df2$exports=$aeadd62233fa5a57$exports($56aa41d9f63b1df2$var$url.toString(),$56aa41d9f63b1df2$var$url.origin,!0);class $c34d76d3d378ee14$export$426cc6213ad628cf{constructor(){this.running=!1,this.worker=new Worker($56aa41d9f63b1df2$exports),this.worker.onerror=e=>{if(e.message)throw Error(`GenerateMeshBVHWorker: Could not create Web Worker with error "${e.message}"`);throw Error("GenerateMeshBVHWorker: Could not create Web Worker.")}}generate(e,t={}){if(this.running)throw Error("GenerateMeshBVHWorker: Already running job.");if(null===this.worker)throw Error("GenerateMeshBVHWorker: Worker has been disposed.");let{worker:i}=this;return this.running=!0,new Promise((r,o)=>{i.onerror=e=>{o(Error(`GenerateMeshBVHWorker: ${e.message}`)),this.running=!1},i.onmessage=a=>{this.running=!1;let{data:n}=a;if(n.error)o(Error(n.error)),i.onmessage=null;else if(n.serialized){let{serialized:o,position:a}=n,s=(0,$1DCdP.MeshBVH).deserialize(o,e,{setIndex:!1}),l=Object.assign({setBoundingBox:!0},t);if(e.attributes.position.array=a,e.index)e.index.array=o.index;else{let t=new $4xklQ.BufferAttribute(o.index,1,!1);e.setIndex(t)}l.setBoundingBox&&(e.boundingBox=s.getBoundingBox(new $4xklQ.Box3)),r(s),i.onmessage=null}else t.onProgress&&t.onProgress(n.progress)};let a=e.index?e.index.array:null,n=e.attributes.position.array;if(n.isInterleavedBufferAttribute||a&&a.isInterleavedBufferAttribute)throw Error("GenerateMeshBVHWorker: InterleavedBufferAttribute are not supported for the geometry attributes.");let s=[n];a&&s.push(a),i.postMessage({index:a,position:n,options:{...t,onProgress:null,includedProgressCallback:!!t.onProgress,groups:[...e.groups]}},s.map(e=>e.buffer))})}dispose(){this.worker.terminate(),this.worker=null}terminate(){console.warn('GenerateMeshBVHWorker: "terminate" is deprecated. Use "dispose" instead.'),this.dispose()}}class $675ad4be3c3f8bcc$export$5499aeafc5a5667b extends $ee4d6a6d20403ee8$export$245b5237bb7038ea{constructor(){super(),this.bvhGenerator=new $c34d76d3d378ee14$export$426cc6213ad628cf}generate(e,t={}){let{bvhGenerator:i}=this,{geometry:r,materials:o,textures:a,lights:n,spotLights:s}=this.prepScene(e),l={strategy:$ckwVR.SAH,...t,maxLeafTris:1},h=i.generate(r,l);return h.then(t=>({scene:e,materials:o,textures:a,lights:n,spotLights:s,bvh:t}))}dispose(){this.bvhGenerator.dispose()}}var $cc4Nq=parcelRequire("cc4Nq");class $50588171089be068$export$6a37e807469f37da{constructor(e){this.editor=e,this.editor.baseRender=this,this.maxSamples=300,this.material="Aluminum",this.denoiseEnabled=!0,this.denoiseSigma=1,this.denoiseThreshold=.1,this.denoiseKSigma=1,this.updateFlag=!1,$("#loading").length>0&&$("#loading").remove(),$("#samples").length>0&&$("#samples").remove();let t="<div id= loading>正在加载</div>";$("body").append(t),$("#loading").css({color:"#000",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)","font-weight":"bold","font-size":"32px"}),this.newMain()}generateRadialFloorTexture(e){let t=new Uint8Array(e*e*4);for(let i=0;i<e;i++)for(let r=0;r<e;r++){let o=i/(e-1),a=r/(e-1),n=2*(o-.5),s=2*(a-.5),l=Math.max(Math.min(1-Math.sqrt(n**2+s**2),1),0);l=Math.min(l=l**2*1.5,1);let h=r*e+i;t[4*h+0]=255,t[4*h+1]=255,t[4*h+2]=255,t[4*h+3]=255*l}let i=new $4xklQ.DataTexture(t,e,e);return i.format=$4xklQ.RGBAFormat,i.type=$4xklQ.UnsignedByteType,i.minFilter=$4xklQ.LinearFilter,i.magFilter=$4xklQ.LinearFilter,i.wrapS=$4xklQ.RepeatWrapping,i.wrapT=$4xklQ.RepeatWrapping,i.needsUpdate=!0,i}async newMain(){$(this.editor.dom).empty();let e=new $4xklQ.WebGLRenderer({antialias:!0});e.setSize(window.innerWidth,window.innerHeight),e.setClearColor(16777215,0),e.toneMapping=$4xklQ.ACESFilmicToneMapping,e.outputEncoding=$4xklQ.sRGBEncoding,e.setClearColor(0,0),this.editor.dom.appendChild(e.domElement),this.scene=new $4xklQ.Scene;let t=new $2b66122c32049261$export$196da6cc71a4331(e),i=new $134dfafd06cc9b8a$export$746cbc9e65f5bcb8;t.setSize(window.innerWidth,window.innerHeight);let r="";for(let e in this.editor.cameras)"3dCamera"==this.editor.cameras[e].name&&(r=this.editor.cameras[e]);t.camera=r,t.material=i,t.alpha=!0,this.ptRenderer=t,this.fsQuad=new $0684d9623c4c8e37$export$3983474c8e6e978b(new $4xklQ.MeshBasicMaterial({map:t.target.texture,blending:$4xklQ.CustomBlending,premultipliedAlpha:e.getContextAttributes().premultipliedAlpha})),this.denoiseQuad=new $0684d9623c4c8e37$export$3983474c8e6e978b(new $2d12cfdcbb70f909$export$e6c92f54dc85f279({map:t.target.texture,blending:$4xklQ.CustomBlending,premultipliedAlpha:e.getContextAttributes().premultipliedAlpha})),this.editor.controlsArr[1].object=r,this.editor.controlsArr[1].update(),this.editor.controlsArr[1].addEventListener("change",()=>{t.reset()}),this.editor.controlsArr[0].enabled=!1,this.editor.controlsArr[1].enabled=!0,this.envMapGenerator=new $510c5bcb198fe0d5$export$13ef63fd7e562136(e),this.renderer=e,this.camera=r;let o=new $4xklQ.Scene;this.scene=o,this.envMapGenerator=new $510c5bcb198fe0d5$export$13ef63fd7e562136(e);let a=new $4xklQ.Group,n=new $4xklQ.Group;this.editor.wallGroup3D.children.slice(0).forEach(e=>{"3DWall"==e.modelType&&n.add(e.clone()),"CodeModel"==e.modelType&&n.add(this.editor.codeModelCopy(e))});let s=this.editor.floorGroup.clone();s.children.slice(0).forEach(e=>{0==e.position.z&&e.parent.remove(e)}),a.add(n,this.editor.memberGroup3D.clone(),s,this.editor.model3D.clone()),this.materials=[];let l=new $675ad4be3c3f8bcc$export$5499aeafc5a5667b,h=await l.generate(a,{onProgress:e=>{let t=Math.floor(100*e);$("#loading").html("加载中 : "+t+"%"),100==t&&$("#loading").html("解析中...")}});h.scene.traverse(e=>{e.layers.set(2)}),this.scene.add(h.scene),this.result=h;let{bvh:c,textures:d,materials:p}=h,u=c.geometry,m=t.material;m.bvh.updateFrom(c),m.normalAttribute.updateFrom(u.attributes.normal),m.tangentAttribute.updateFrom(u.attributes.tangent),m.uvAttribute.updateFrom(u.attributes.uv),m.materialIndexAttribute.updateFrom(u.attributes.materialIndex),m.textures.setTextures(e,2048,2048,d),m.materials.updateFrom(p,d),l.dispose();let g=this,f=new Promise(e=>{new(0,$awRkS.RGBELoader)().load("https://rjhcdn.bsphpro.com/ocean/static/3d-demo-data/hdri/hilly_terrain_01_1k.hdr",t=>{g.updateEnvBlur(t),g.ptRenderer.reset(),e()})}),w=fetch("https://rjhcdn.bsphpro.com/ocean/static/3d-demo-data/materials/material.json").then(e=>e.json()).then(e=>{this.database={},e.forEach(e=>{this.database[e.name]=e})});await Promise.all([w,f]),$("#loading").html("解析中..."),$("#loading").html("Loading : 解析完成"),document.getElementById("loading").remove();let y=new $cc4Nq.GUI,b=Object.keys(this.database);this.material=b[0];let x={材质:this.material,降噪:this.denoiseEnabled,去噪Sigma:this.denoiseSigma,去噪Threshold:this.denoiseThreshold,去噪KSigma:this.denoiseKSigma,samples:this.maxSamples};y.add(x,"材质",b).onChange(e=>{this.material=e,g.ptRenderer.reset()}),y.add(x,"samples",50,2e3).step(1).onChange(e=>{this.maxSamples=e,this.updateFlag=!0});let P=y.addFolder("Denoising");P.add(x,"降噪").onChange(e=>{this.denoiseEnabled=e,this.updateFlag=!0}),P.add(x,"去噪Sigma",.01,5).onChange(e=>{this.denoiseSigma=e,this.updateFlag=!0}),P.add(x,"去噪Threshold",.01,1).onChange(e=>{this.denoiseThreshold=e,this.updateFlag=!0}),P.add(x,"去噪KSigma",0,12).onChange(e=>{this.denoiseKSigma=e,this.updateFlag=!0}),$(".lil-gui.autoPlace").css({width:"13%",position:"fixed",right:"240px",top:"55px","z-index":"1001"}),$(".lil-gui .controller .widget").css({width:"48%","margin-left":"40px"}),y.open(),this.animate()}async main(){$(this.editor.dom).empty();let e=new $4xklQ.WebGLRenderer({antialias:!0});e.setSize(window.innerWidth,window.innerHeight),e.setClearColor(16777215,0),e.toneMapping=$4xklQ.ACESFilmicToneMapping,e.outputEncoding=$4xklQ.sRGBEncoding,e.setClearColor(0,0),this.editor.dom.appendChild(e.domElement),this.scene=new $4xklQ.Scene;let t=new $2b66122c32049261$export$196da6cc71a4331(e),i=new $134dfafd06cc9b8a$export$746cbc9e65f5bcb8;t.setSize(window.innerWidth,window.innerHeight);let r=this.editor.camera;t.camera=r,t.material=i,t.alpha=!0,this.ptRenderer=t,this.fsQuad=new $0684d9623c4c8e37$export$3983474c8e6e978b(new $4xklQ.MeshBasicMaterial({map:t.target.texture,blending:$4xklQ.CustomBlending,premultipliedAlpha:e.getContextAttributes().premultipliedAlpha})),this.denoiseQuad=new $0684d9623c4c8e37$export$3983474c8e6e978b(new $2d12cfdcbb70f909$export$e6c92f54dc85f279({map:t.target.texture,blending:$4xklQ.CustomBlending,premultipliedAlpha:e.getContextAttributes().premultipliedAlpha})),this.editor.controlsArr[1].object=r,this.editor.controlsArr[1].update(),this.editor.controlsArr[1].addEventListener("change",()=>{t.reset()}),this.envMapGenerator=new $510c5bcb198fe0d5$export$13ef63fd7e562136(e),this.renderer=e,this.camera=r;let o=new $4xklQ.Scene;this.scene=o,this.envMapGenerator=new $510c5bcb198fe0d5$export$13ef63fd7e562136(e);let a=this,n=new Promise(e=>{new(0,$awRkS.RGBELoader)().load("https://rjhcdn.bsphpro.com/ocean/static/3d-demo-data/hdri/hilly_terrain_01_1k.hdr",t=>{a.updateEnvBlur(t),a.ptRenderer.reset(),e()})}),s=new $675ad4be3c3f8bcc$export$5499aeafc5a5667b,l=new(0,$hu0fb.GLTFLoader)().setMeshoptDecoder($02720af05ebc5d11$export$1111800106ba519a).loadAsync("https://rjhcdn.bsphpro.com/ocean/static/3d-demo-data/models/material-balls/glass.glb").then(e=>{let t=new $4xklQ.Group;e.scene.scale.setScalar(.01),e.scene.updateMatrixWorld();let i=new $4xklQ.Box3;i.setFromObject(e.scene);let r=new $4xklQ.Mesh(new $4xklQ.CylinderBufferGeometry(3,3,.05,200),new $4xklQ.MeshPhysicalMaterial({color:16777215,roughness:0,metalness:.25}));r.geometry=r.geometry.toNonIndexed(),r.geometry.clearGroups(),r.position.y=i.min.y-.03;let o=this.editor.wallGroup3D.clone(),a=this.editor.wallGroup3D.children.slice(0),n=o.children,l=0;n.forEach(e=>{let t=a[l];if("CodeModel"==t.modelType){let i=e.children.slice(0),r=t.children.slice(0).length;e.children.splice(0,i.length-r)}l++});let h=this.editor.floorGroup.clone();h.children.slice(0).forEach(e=>{0==e.position.z&&e.parent.remove(e)}),t.add(o,this.editor.memberGroup3D.clone(),h,this.editor.model3D.clone());let c=new $4xklQ.MeshPhysicalMaterial,d=new $4xklQ.MeshPhysicalMaterial;return e.scene.traverse(e=>{e.geometry&&e.geometry.computeVertexNormals(),"Sphere_1"===e.name?e.material=d:e.material=c,"subsphere_1"===e.name&&(e.material=d)}),this.materials=[c,d,r.material],s.generate(t,{onProgress:e=>{let t=Math.floor(100*e);$("#loading").html("加载中 : "+t+"%"),100==t&&$("#loading").html("解析中...")}})}).then(i=>{i.scene.traverse(e=>{e.layers.set(2)}),this.scene.add(i.scene),this.result=i;let{bvh:r,textures:o,materials:a}=i,n=r.geometry,l=t.material;l.bvh.updateFrom(r),l.normalAttribute.updateFrom(n.attributes.normal),l.tangentAttribute.updateFrom(n.attributes.tangent),l.uvAttribute.updateFrom(n.attributes.uv),l.materialIndexAttribute.updateFrom(n.attributes.materialIndex),l.textures.setTextures(e,2048,2048,o),l.materials.updateFrom(a,o),s.dispose()}),h=fetch("https://rjhcdn.bsphpro.com/ocean/static/3d-demo-data/materials/material.json").then(e=>e.json()).then(e=>{this.database={},e.forEach(e=>{this.database[e.name]=e})});await Promise.all([h,l,n]),$("#loading").html("解析中..."),$("#loading").html("Loading : 解析完成"),document.getElementById("loading").remove();let c=new $cc4Nq.GUI,d=Object.keys(this.database);this.material=d[0];let p={材质:this.material,降噪:this.denoiseEnabled,去噪Sigma:this.denoiseSigma,去噪Threshold:this.denoiseThreshold,去噪KSigma:this.denoiseKSigma,samples:this.maxSamples};c.add(p,"材质",d).onChange(e=>{this.material=e,a.ptRenderer.reset()}),c.add(p,"samples",50,2e3).step(1).onChange(e=>{this.maxSamples=e,this.updateFlag=!0});let u=c.addFolder("Denoising");u.add(p,"降噪").onChange(e=>{this.denoiseEnabled=e,this.updateFlag=!0}),u.add(p,"去噪Sigma",.01,5).onChange(e=>{this.denoiseSigma=e,this.updateFlag=!0}),u.add(p,"去噪Threshold",.01,1).onChange(e=>{this.denoiseThreshold=e,this.updateFlag=!0}),u.add(p,"去噪KSigma",0,12).onChange(e=>{this.denoiseKSigma=e,this.updateFlag=!0}),$(".lil-gui.autoPlace").css({width:"13%",position:"fixed",right:"240px",top:"55px","z-index":"1001"}),$(".lil-gui .controller .widget").css({width:"48%","margin-left":"40px"}),c.open(),this.animate()}onkeydown(e){if(0>[87,83,65,68,69,81].indexOf(1*e.keyCode))return;var t=new $4xklQ.Vector3;this.camera.getWorldDirection(t);let i=.1,r=new $4xklQ.Vector3(t.z,t.y,-t.x),o=new $4xklQ.Vector3(0,1,0),a=this.camera.position.clone();"87"==e.keyCode?(this.camera.position.add(t.multiplyScalar(i)),this.camera.position.y=a.y):"83"==e.keyCode?(this.camera.position.add(t.multiplyScalar(-i)),this.camera.position.y=a.y):"65"==e.keyCode?(this.camera.position.add(r.multiplyScalar(i)),this.camera.position.y=a.y):"68"==e.keyCode?(this.camera.position.add(r.multiplyScalar(-i)),this.camera.position.y=a.y):"69"==e.keyCode?this.camera.position.add(o.multiplyScalar(i)):"81"==e.keyCode&&this.camera.position.add(o.multiplyScalar(-i)),this.camera.updateProjectionMatrix(),this.ptRenderer.reset()}updateEnvBlur(e){let t=this.envMapGenerator.generate(e,0);this.ptRenderer.material.envMapInfo.updateFrom(t),this.scene.environment=t,this.scene.background=t}applyMaterialInfo(e,t){t.color.set(16777215),t.transmission=0,t.attenuationDistance=1/0,t.attenuationColor.set(16777215),t.specularColor.set(16777215),t.metalness=0,t.roughness=1,t.ior=1.5,t.thickness=1,e.specularColor&&t.specularColor.setRGB(...e.specularColor),"metalness"in e&&(t.metalness=e.metalness),"roughness"in e&&(t.roughness=e.roughness),"ior"in e&&(t.ior=e.ior),"transmission"in e&&(t.transmission=e.transmission),t.transmission?(e.color&&t.attenuationColor.setRGB(...e.color),t.attenuationDistance=200/e.density):e.color&&t.color.setRGB(...e.color)}animate(){if(!this.editor.baseRender||(requestAnimationFrame(this.animate.bind(this)),this.ptRenderer.samples>this.maxSamples&&!this.updateFlag))return;if(0==$("#sampele").length){let e="<div id= sampele>sampeles:0</div>";$("body").append(e),$("#sampele").css({color:"#000",position:"absolute",top:"90%",left:"82%",transform:"translate(-50%, -50%)","font-size":"20px"})}$("#sampele").text("samples:"+this.ptRenderer.samples),this.updateFlag=!1,this.renderer.render(this.scene,this.camera);let e=this.database[this.material];if(this.materials.length>0){let[t,i]=this.materials;this.applyMaterialInfo(e,t),i.color.setRGB(.5,.5,.5).convertSRGBToLinear(),i.roughness=1,i.metalness=0}this.ptRenderer.material.materials.updateFrom(this.result.materials,this.result.textures),this.ptRenderer.material.filterGlossyFactor=.5,this.ptRenderer.material.environmentIntensity=1,this.ptRenderer.material.backgroundBlur=.1,this.ptRenderer.material.bounces=15,this.ptRenderer.material.physicalCamera.updateFrom(this.camera),this.camera.updateMatrixWorld(),this.scene.background=this.scene.environment,this.ptRenderer.update(),this.ptRenderer.samples<1&&this.renderer.render(this.scene,this.camera),this.denoiseQuad.material.sigma=this.denoiseSigma,this.denoiseQuad.material.threshold=this.denoiseThreshold,this.denoiseQuad.material.kSigma=this.denoiseKSigma;let t=this.denoiseEnabled?this.denoiseQuad:this.fsQuad;this.renderer.autoClear=!1,t.material.map=this.ptRenderer.target.texture,t.render(this.renderer),this.renderer.autoClear=!0}}var $4xklQ=parcelRequire("4xklQ"),$90poP=parcelRequire("90poP"),$1cnge=parcelRequire("1cnge"),$9HO6e=parcelRequire("9HO6e"),$3BPdS=parcelRequire("3BPdS"),$4xklQ=parcelRequire("4xklQ");parcelRequire("9QhXH");class $e3212e52653b49d1$export$919db86739867624{static createCamera(e=!1){let t=new $4xklQ.Group,i='<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 28 28" id="camera-hover" width="28" height="28"><g fill="#675D50" fill-rule="evenodd" stroke="#FFF"><path d="M17.5 7A2.5 2.5 0 0015 4.5H7A2.5 2.5 0 004.5 7v14A2.5 2.5 0 007 23.5h8a2.5 2.5 0 002.5-2.5V7zM23.5 7.717a.5.5 0 00-.741-.438l-4.482 2.468a1.5 1.5 0 00-.777 1.314v5.888a1.5 1.5 0 00.777 1.314l4.482 2.468a.5.5 0 00.741-.438V7.717z"></path></g></svg>';var{object:r,update:o}=$e3212e52653b49d1$export$919db86739867624.renderSVG(i);r.scale.set(60,60,1);let a=new $4xklQ.Box3().setFromObject(r).getSize(new $4xklQ.Vector3);r.position.x=a.x/2,r.position.y+=a.y/2+250,r.rotateZ(Math.PI),r.renderOrder=5,t.add(r),r.name="nosc",t.nosc=r;let n='<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 28 28" id="camera-hover" width="28" height="28"><g fill="#338BFF" fill-rule="evenodd" stroke="#FFF"><path d="M17.5 7A2.5 2.5 0 0015 4.5H7A2.5 2.5 0 004.5 7v14A2.5 2.5 0 007 23.5h8a2.5 2.5 0 002.5-2.5V7zM23.5 7.717a.5.5 0 00-.741-.438l-4.482 2.468a1.5 1.5 0 00-.777 1.314v5.888a1.5 1.5 0 00.777 1.314l4.482 2.468a.5.5 0 00.741-.438V7.717z"></path></g></svg>';var{object:r,update:o}=$e3212e52653b49d1$export$919db86739867624.renderSVG(n);r.scale.set(60,60,1),r.position.x=a.x/2,r.position.y+=a.y/2+250,r.rotateZ(Math.PI),t.add(r),r.name="nosc_move",t.nosc_move=r,r.visible=!1,r.renderOrder=5;let s=4e3,l=150/180*Math.PI;e&&(l=.75*Math.PI);let h=new $4xklQ.Mesh(new $4xklQ.CircleGeometry(s,32,l,(Math.PI-l)*2),new $4xklQ.MeshBasicMaterial({color:"#305086",side:2,transparent:!0}));h.position.set(-a.x/2-200,0,0),t.add(h);let c=new $4xklQ.Mesh(new $4xklQ.CircleGeometry(s,32,l,(Math.PI-l)*2),new $4xklQ.MeshBasicMaterial({color:"#15171A",side:2,transparent:!0,opacity:.8}));c.name="circle",c.position.set(-a.x/2-200,0,0),t.add(c),t.circleMesh=c,c.visible=!1,e&&(h.visible=!1,h.name="circle_move",t.circle_move=h,c.visible=!0,h.material.opacity=.8);let d='<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 60 132" id="rotate" width="100" height="150"><g fill="#1E2329" fill-opacity=".5" fill-rule="evenodd" stroke="#FFF" stroke-width="30" transform="rotate(90 28.5 28.5)"><path d="M129.384 26.898L103.5 45.11V8.872l25.884 18.026zM2.616 26.898L28.5 45.11V8.873L2.616 26.898z"></path><circle cx="66" cy="27" r="25.5"></circle></g></svg>';var{object:r,update:o}=$e3212e52653b49d1$export$919db86739867624.renderSVG(d);r.scale.x=15,r.scale.y=15,r.position.x=-s-1600,r.position.y-=900,r.name="nosr",t.add(r),t.nosr=r;let p='<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 60 132" id="rotate" width="100" height="150"><g fill="#338BFF" fill-opacity=".5" fill-rule="evenodd" stroke="#FFF" stroke-width="30" transform="rotate(90 28.5 28.5)"><path d="M129.384 26.898L103.5 45.11V8.872l25.884 18.026zM2.616 26.898L28.5 45.11V8.873L2.616 26.898z"></path><circle cx="66" cy="27" r="25.5"></circle></g></svg>';var{object:r,update:o}=$e3212e52653b49d1$export$919db86739867624.renderSVG(p);return r.scale.x=15,r.scale.y=15,r.position.x=-s-1600,r.position.y-=900,r.name="nosr_move",r.visible=!1,t.nosr_move=r,t.add(r),t}static renderSVG(e){let t=new $22831dcc74231be4$export$959ae9097e74a233,i=t.parse(e),r=new $4xklQ.Group,o=[],a=new $4xklQ.LineBasicMaterial({color:"#FFF",transparent:!0});return i.paths.forEach(e=>{let t=$22831dcc74231be4$export$959ae9097e74a233.createShapes(e),i=new $4xklQ.MeshBasicMaterial({color:e.color,transparent:!0,side:$4xklQ.DoubleSide});t.forEach(e=>{let t=new $4xklQ.ExtrudeBufferGeometry(e,{depth:1}),n=new $4xklQ.EdgesGeometry(t),s=new $4xklQ.Mesh(t,i),l=new $4xklQ.LineSegments(n,a);l.renderOrder=100,o.push({shape:e,mesh:s,lines:l}),r.add(s,l)})}),r.applyMatrix4(new $4xklQ.Matrix4().makeScale(50,50,1)),{object:r,update(e){o.forEach(t=>{let i=new $4xklQ.ExtrudeBufferGeometry(t.shape,{depth:e,bevelEnabled:!1}),r=new $4xklQ.EdgesGeometry(i);t.mesh.geometry.dispose(),t.lines.geometry.dispose(),t.mesh.geometry=i,t.lines.geometry=r})}}}}class $93515037b4aa0d1f$export$7da8f54b9c0f630c{constructor(e){this.container=e,this.floorHei=2800,this.width=240,this.height=216,this.uiPanelBox=new $3BPdS.UIPanel,this.uiPanelBox.setWidth(this.width+"px"),this.uiPanelBox.setHeight(this.height+"px"),this.container.appendChild(this.uiPanelBox.dom),this.camera=new $4xklQ.OrthographicCamera(-1e4,1e4,5e3,-5e3,0,1e3);let t=this.width/this.height,i=-5e3;this.camera.left=i*t,this.camera.right=-i*t,this.camera.top=-i,this.camera.bottom=i,this.camera.position.set(0,0,1e3),this.camera.lookAt(new $1cnge.Vector3(0,0,0)),this.raycaster=new $4xklQ.Raycaster,this.scene=new $4xklQ.Scene,this.renderer="";let r=new $4xklQ.PlaneGeometry(2e5,2e5),o=new $4xklQ.MeshBasicMaterial({color:16777215,roughness:1,metalness:0,transparent:!0,opacity:0});this.floor=new $4xklQ.Mesh(r,o),this.scene.add(this.floor),this.createRenderer();let a=$e3212e52653b49d1$export$919db86739867624.createCamera();a.name="cameraGroup",a.position.x=4800,this.cameraGroup=a,editor.renderCameraGroup=a,this.scene.add(a);let n=new $1cnge.Vector3(0,4500,0),s=new $1cnge.Vector3(0,-4500,0),l=new $d0f874000594cf7a$export$a955f3d6a39ce4b2().createLineDimensionsLine(n,s,!0,100,"#fff");l.position.x=4800,this.scene.add(l),$("#cemeraHeight").val(Math.round(1e3*editor.renderViewCamera.position.y)+"mm");let h=editor.getRenderCameraAngle();isNaN(h)||$("#cemeraAngle").val(h+"\xb0");let c=new(0,$3BPdS.UIText)("0mm",!1).setMarginTop(this.height-20+"px").setMarginLeft(this.width-60+"px").setFontSize("10px").setWidth("10px").setFontWeight("1"),d=new(0,$3BPdS.UIText)(this.floorHei+"mm",!1).setMarginTop("5px").setMarginLeft(this.width-80+"px").setFontSize("10px").setWidth("10px").setFontWeight("1");this.uiPanelBox.add(c,d),this.camera.updateProjectionMatrix(),e.addEventListener("mousedown",this.onMouseDown.bind(this)),document.body.addEventListener("mouseup",this.onMouseUp.bind(this)),e.addEventListener("mousemove",this.mouseMove.bind(this))}onMouseDown(){let e=this.getObject(event);e.length>0&&(this.downSel=e[0].object.parent)}onMouseUp(){this.downSel=""}mouseMove(e){let t=this.getObject(e);if(t.length>0){let e=t[0].object.parent,r=this.cameraGroup[e.name+"_move"];if(r?r.visible=!0:this.cameraGroup.children.forEach(e=>{e.name.indexOf("_move")>=0&&(e.visible=!1)}),this.downSel){let e=t[0].point.clone();if("nosc"==this.downSel.name){e.y>4e3&&(e.y=4e3),e.y<-4e3&&(e.y=-4e3),this.cameraGroup.position.y=e.y;let t=Math.round(this.floorHei*(e.y+4e3)/8e3);editor.renderViewCamera.position.y=t/1e3,editor.renderViewControl.target.y=t/1e3;let i=Math.round(1e3*editor.renderViewCamera.position.y);$("#cemeraHeight").val()!=i+"mm"&&$("#cemeraHeight").val(i+"mm")}else if("nosr"==this.downSel.name){let t=this.cameraGroup.position.clone(),r=new $90poP.Vector2(e.x,e.y),o=new $90poP.Vector2(t.x,t.y),a=r.sub(o).angle();(a-=Math.PI)>Math.PI/2&&(a=Math.PI/2),a<-Math.PI/2&&(a=-Math.PI/2);var i=new $4xklQ.Vector3;editor.renderViewCamera.getWorldDirection(i);let n=-editor.renderViewCamera.position.clone().distanceTo(i)*Math.sin(a);editor.renderViewControl.target.set(i.x,i.y+n,i.z);let s=editor.getRenderCameraAngle();!isNaN(s)&&($("#cemeraAngle").val(s+"\xb0"),s>=-5&&s<=5&&(editor.renderViewControl.target.y=editor.renderViewCamera.position.y))}editor.renderViewCamera.updateProjectionMatrix(),editor.renderViewControl.update()}}}createRenderer(){let e=new $4xklQ.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});e.shadowMap.enabled=!0,e.shadowMap.type=$4xklQ.PCFSoftShadowMap,e.setPixelRatio(window.devicePixelRatio),e.setSize(this.width,this.height),e.setClearColor("#2A2E34"),e.xr.enabled=!0,e.outputEncoding=$4xklQ.sRGBEncoding,this.renderer=e,this.container.appendChild(this.renderer.domElement),this.animate()}animate(){this.renderer.setAnimationLoop(this.render.bind(this))}render(){if(this.renderer.render(this.scene,this.camera),!editor.renderViewCamera.isOrthographicCamera){let e=editor.renderViewControl.target.clone().sub(editor.renderViewCamera.position),t=(0,$9HO6e.UtilCore).calculateAngleWithHorizontalPlane(e);isNaN(t)||(editor.renderViewCamera.position.y<editor.renderViewControl.target.y&&(t*=-1),t>=-5*Math.PI/180&&t<=5*Math.PI/180&&(t=0),this.cameraGroup.rotation.z=t,this.cameraGroup.position.y=8e6*editor.renderViewCamera.position.y/this.floorHei-4e3)}}getScreen(e,t){let i=e.project(t),r=window.innerWidth/2,o=(window.innerHeight-52)/2;return[Math.round(i.x*r+r),Math.round(-i.y*o+o)]}getObject(e){let t=new $1cnge.Vector3;this.domRect=this.container.getBoundingClientRect(),t.x=(e.clientX+17+this.width-window.innerWidth)/this.width*2-1,t.y=-(2*((e.clientY-120-this.height)/this.height))+1,t.z=0,this.raycaster.setFromCamera(t,this.camera);let i=[this.floor];return this.cameraGroup.children.forEach(e=>{"Group"==e.type&&e.visible&&i.push(e)}),this.raycaster.intersectObjects(i,!0)}}var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ"),$9HO6e=parcelRequire("9HO6e");const $dc94d71b7cc06198$var$_changeEvent={type:"change"},$dc94d71b7cc06198$var$_startEvent={type:"start"},$dc94d71b7cc06198$var$_endEvent={type:"end"};class $dc94d71b7cc06198$export$8ff7788029dfdf52 extends $4xklQ.EventDispatcher{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new $4xklQ.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:$4xklQ.MOUSE.ROTATE,MIDDLE:$4xklQ.MOUSE.DOLLY,RIGHT:$4xklQ.MOUSE.PAN},this.touches={ONE:$4xklQ.TOUCH.ROTATE,TWO:$4xklQ.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return n.phi},this.getAzimuthalAngle=function(){return n.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",er),this._domElementKeyEvents=e},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent($dc94d71b7cc06198$var$_changeEvent),i.update(),o=r.NONE},this.update=function(){let t=new $4xklQ.Vector3,d=new(0,$4xklQ.Quaternion)().setFromUnitVectors(e.up,new $4xklQ.Vector3(0,1,0)),p=d.clone().invert(),u=new $4xklQ.Vector3,m=new $4xklQ.Quaternion,g=2*Math.PI;return function(){let e=i.object.position;t.copy(e).sub(i.target),t.applyQuaternion(d),n.setFromVector3(t),i.autoRotate&&o===r.NONE&&C(v()),i.enableDamping?(n.theta+=s.theta*i.dampingFactor,n.phi+=s.phi*i.dampingFactor):(n.theta+=s.theta,n.phi+=s.phi);let f=i.minAzimuthAngle,w=i.maxAzimuthAngle;return isFinite(f)&&isFinite(w)&&(f<-Math.PI?f+=g:f>Math.PI&&(f-=g),w<-Math.PI?w+=g:w>Math.PI&&(w-=g),f<=w?n.theta=Math.max(f,Math.min(w,n.theta)):n.theta=n.theta>(f+w)/2?Math.max(f,n.theta):Math.min(w,n.theta)),n.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,n.phi)),n.makeSafe(),n.radius*=l,n.radius=Math.max(i.minDistance,Math.min(i.maxDistance,n.radius)),!0===i.enableDamping?i.target.addScaledVector(h,i.dampingFactor):i.target.add(h),t.setFromSpherical(n),t.applyQuaternion(p),e.copy(i.target).add(t),i.object.lookAt(i.target),!0===i.enableDamping?(s.theta*=1-i.dampingFactor,s.phi*=1-i.dampingFactor,h.multiplyScalar(1-i.dampingFactor)):(s.set(0,0,0),h.set(0,0,0)),l=1,!!(c||u.distanceToSquared(i.object.position)>a||8*(1-m.dot(i.object.quaternion))>a)&&(i.dispatchEvent($dc94d71b7cc06198$var$_changeEvent),u.copy(i.object.position),m.copy(i.object.quaternion),c=!1,!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",en),i.domElement.removeEventListener("pointerdown",J),i.domElement.removeEventListener("pointercancel",K),i.domElement.removeEventListener("wheel",ei),i.domElement.removeEventListener("pointermove",Q),i.domElement.removeEventListener("pointerup",Z),null!==i._domElementKeyEvents&&i._domElementKeyEvents.removeEventListener("keydown",er)};let i=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},o=r.NONE,a=1e-6,n=new $4xklQ.Spherical,s=new $4xklQ.Spherical,l=1,h=new $4xklQ.Vector3,c=!1,d=new $4xklQ.Vector2,p=new $4xklQ.Vector2,u=new $4xklQ.Vector2,m=new $4xklQ.Vector2,g=new $4xklQ.Vector2,f=new $4xklQ.Vector2,w=new $4xklQ.Vector2,y=new $4xklQ.Vector2,b=new $4xklQ.Vector2,x=[],P={};function v(){return 2*Math.PI/60/60*i.autoRotateSpeed}function M(){return Math.pow(.95,i.zoomSpeed)}function C(e){s.theta-=e}function D(e){s.phi-=e}let T=function(){let e=new $4xklQ.Vector3;return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),h.add(e)}}(),S=function(){let e=new $4xklQ.Vector3;return function(t,r){!0===i.screenSpacePanning?e.setFromMatrixColumn(r,1):(e.setFromMatrixColumn(r,0),e.crossVectors(i.object.up,e)),e.multiplyScalar(t),h.add(e)}}(),k=function(){let e=new $4xklQ.Vector3;return function(t,r){let o=i.domElement;if(i.object.isPerspectiveCamera){let a=i.object.position;e.copy(a).sub(i.target);let n=e.length();T(2*t*(n*=Math.tan(i.object.fov/2*Math.PI/180))/o.clientHeight,i.object.matrix),S(2*r*n/o.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(T(t*(i.object.right-i.object.left)/i.object.zoom/o.clientWidth,i.object.matrix),S(r*(i.object.top-i.object.bottom)/i.object.zoom/o.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function V(e){i.object.isPerspectiveCamera?l/=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*e)),i.object.updateProjectionMatrix(),c=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function A(e){i.object.isPerspectiveCamera?l*=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/e)),i.object.updateProjectionMatrix(),c=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function L(e){d.set(e.clientX,e.clientY)}function W(e){w.set(e.clientX,e.clientY)}function I(e){m.set(e.clientX,e.clientY)}function R(e){if(editor.list.horizontalLine.dispatch("#ff0000","red"),p.set(e.clientX,e.clientY),p.x==d.x&&p.y==d.y)return;u.subVectors(p,d).multiplyScalar(i.rotateSpeed),i.domElement;let t=!0,r=new $4xklQ.Vector2(editor.renderViewCamera.position.x,editor.renderViewCamera.position.z),o=new $4xklQ.Vector2(editor.renderViewControl.target.x,editor.renderViewControl.target.z),a=r.distanceTo(o);editor.renderViewCamera.oldDis&&(a=editor.renderViewCamera.oldDis);let n=1*Math.PI/180,s=a*Math.tan(n);p.y>d.y&&(s*=-1);let l=r.clone().add(o.clone().sub(r).setLength(a));if(p.x<d.x&&(n*=-1),l.rotateAround(r,n),Math.abs(d.x-p.x)>Math.abs(d.y-p.y))editor.renderViewControl.target.x=l.x,editor.renderViewControl.target.z=l.y;else{let e=editor.renderViewControl.target.clone().sub(editor.renderViewCamera.position),i=(0,$9HO6e.UtilCore).calculateAngleWithHorizontalPlane(e);editor.renderViewCamera.position.y<editor.renderViewControl.target.y&&(i*=-1);let r=Math.round(180*i/Math.PI),o=4,n=r>=-4&&r<=o;editor.renderViewControl.target.y+=s;let l=editor.renderViewControl.target.clone().sub(editor.renderViewCamera.position),h=(0,$9HO6e.UtilCore).calculateAngleWithHorizontalPlane(l);if(isNaN(h))return;editor.renderViewCamera.position.y<editor.renderViewControl.target.y&&(h*=-1);let c=Math.round(180*h/Math.PI),u=c>=-o&&c<=o,m=document.getElementById("white"),g=document.querySelector(".shot_box").clientHeight,f=m?m.offsetTop:g/2+7*c,w=5;s>0&&(w*=-1);let y=f+w;if(n){if(Math.abs(p.y-d.y)<o)editor.renderViewControl.target.y=editor.renderViewCamera.position.y,t=!1,y=g/2;else{let e=a*Math.tan(o*Math.PI/180);p.y>d.y&&(e*=-1),editor.renderViewControl.target.y+=e;let t=25;e>0&&(t*=-1),y+=t}}!n&&u&&(editor.renderViewControl.target.y=editor.renderViewCamera.position.y,y=g/2);let b="#fff";y==g/2&&(b="#00ff00"),y>=0&&y<=g&&editor.list.horizontalLine.dispatch(b,"white",y);let x=editor.getRenderCameraAngle();isNaN(x)||$("#cemeraAngle").val(x+"\xb0")}editor.renderViewCamera.lookAt(editor.renderViewControl.target),editor.renderViewCamera.updateProjectionMatrix(),editor.renderViewControl.update(),t&&d.copy(p)}function B(e){y.set(e.clientX,e.clientY),b.subVectors(y,w),b.y>0?V(M()):b.y<0&&A(M()),w.copy(y),i.update()}function E(e){g.set(e.clientX,e.clientY),f.subVectors(g,m).multiplyScalar(i.panSpeed),k(f.x,0),m.copy(g),i.update()}function O(e){e.deltaY<0?A(M()):e.deltaY>0&&V(M()),i.update()}function F(e){let t=!1;switch(e.code){case i.keys.UP:k(0,i.keyPanSpeed),t=!0;break;case i.keys.BOTTOM:k(0,-i.keyPanSpeed),t=!0;break;case i.keys.LEFT:k(i.keyPanSpeed,0),t=!0;break;case i.keys.RIGHT:k(-i.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),i.update())}function z(){if(1===x.length)d.set(x[0].pageX,x[0].pageY);else{let e=.5*(x[0].pageX+x[1].pageX),t=.5*(x[0].pageY+x[1].pageY);d.set(e,t)}}function G(){if(1===x.length)m.set(x[0].pageX,x[0].pageY);else{let e=.5*(x[0].pageX+x[1].pageX),t=.5*(x[0].pageY+x[1].pageY);m.set(e,t)}}function H(){let e=x[0].pageX-x[1].pageX,t=x[0].pageY-x[1].pageY,i=Math.sqrt(e*e+t*t);w.set(0,i)}function j(){i.enableZoom&&H(),i.enablePan&&G()}function _(){i.enableZoom&&H(),i.enableRotate&&z()}function U(e){if(1==x.length)p.set(e.pageX,e.pageY);else{let t=ec(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);p.set(i,r)}u.subVectors(p,d).multiplyScalar(i.rotateSpeed);let t=i.domElement;C(2*Math.PI*u.x/t.clientHeight),D(2*Math.PI*u.y/t.clientHeight),d.copy(p)}function N(e){if(1===x.length)g.set(e.pageX,e.pageY);else{let t=ec(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);g.set(i,r)}f.subVectors(g,m).multiplyScalar(i.panSpeed),k(f.x,f.y),m.copy(g)}function q(e){let t=ec(e),r=e.pageX-t.x,o=e.pageY-t.y,a=Math.sqrt(r*r+o*o);y.set(0,a),b.set(0,Math.pow(y.y/w.y,i.zoomSpeed)),V(b.y),w.copy(y)}function Y(e){i.enableZoom&&q(e),i.enablePan&&N(e)}function X(e){i.enableZoom&&q(e),i.enableRotate&&U(e)}function J(e){!1!==i.enabled&&(0===x.length&&(i.domElement.setPointerCapture(e.pointerId),i.domElement.addEventListener("pointermove",Q),i.domElement.addEventListener("pointerup",Z)),es(e),"touch"===e.pointerType?eo(e):ee(e))}function Q(e){!1!==i.enabled&&("touch"===e.pointerType?ea(e):et(e))}function Z(e){editor.renderViewCamera.oldDis="",el(e),0===x.length&&(i.domElement.releasePointerCapture(e.pointerId),i.domElement.removeEventListener("pointermove",Q),i.domElement.removeEventListener("pointerup",Z)),i.dispatchEvent($dc94d71b7cc06198$var$_endEvent),o=r.NONE,setTimeout(()=>{editor.list.deleteLine.dispatch()},500)}function K(e){el(e)}function ee(e){let t;let a=new $4xklQ.Vector2(editor.renderViewCamera.position.x,editor.renderViewCamera.position.z),n=new $4xklQ.Vector2(editor.renderViewControl.target.x,editor.renderViewControl.target.z),s=a.distanceTo(n);switch(editor.renderViewCamera.oldDis=s,e.button){case 0:t=i.mouseButtons.LEFT;break;case 1:t=i.mouseButtons.MIDDLE;break;case 2:t=i.mouseButtons.RIGHT;break;default:t=-1}switch(t){case $4xklQ.MOUSE.DOLLY:if(!1===i.enableZoom)return;W(e),o=r.DOLLY;break;case $4xklQ.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enablePan)return;I(e),o=r.PAN}else{if(!1===i.enableRotate)return;L(e),o=r.ROTATE}break;case $4xklQ.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enableRotate)return;L(e),o=r.ROTATE}else{if(!1===i.enablePan)return;I(e),o=r.PAN}break;default:o=r.NONE}o!==r.NONE&&i.dispatchEvent($dc94d71b7cc06198$var$_startEvent)}function et(e){switch(o){case r.ROTATE:if(!1===i.enableRotate)return;R(e);break;case r.DOLLY:if(!1===i.enableZoom)return;B(e);break;case r.PAN:if(!1===i.enablePan)return;E(e)}}function ei(e){!1!==i.enabled&&!1!==i.enableZoom&&o===r.NONE&&(e.preventDefault(),i.dispatchEvent($dc94d71b7cc06198$var$_startEvent),O(e),i.dispatchEvent($dc94d71b7cc06198$var$_endEvent))}function er(e){!1!==i.enabled&&!1!==i.enablePan&&F(e)}function eo(e){switch(eh(e),x.length){case 1:switch(i.touches.ONE){case $4xklQ.TOUCH.ROTATE:if(!1===i.enableRotate)return;z(),o=r.TOUCH_ROTATE;break;case $4xklQ.TOUCH.PAN:if(!1===i.enablePan)return;G(),o=r.TOUCH_PAN;break;default:o=r.NONE}break;case 2:switch(i.touches.TWO){case $4xklQ.TOUCH.DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;j(),o=r.TOUCH_DOLLY_PAN;break;case $4xklQ.TOUCH.DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;_(),o=r.TOUCH_DOLLY_ROTATE;break;default:o=r.NONE}break;default:o=r.NONE}o!==r.NONE&&i.dispatchEvent($dc94d71b7cc06198$var$_startEvent)}function ea(e){switch(eh(e),o){case r.TOUCH_ROTATE:if(!1===i.enableRotate)return;U(e),i.update();break;case r.TOUCH_PAN:if(!1===i.enablePan)return;N(e),i.update();break;case r.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;Y(e),i.update();break;case r.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;X(e),i.update();break;default:o=r.NONE}}function en(e){!1!==i.enabled&&e.preventDefault()}function es(e){x.push(e)}function el(e){delete P[e.pointerId];for(let t=0;t<x.length;t++)if(x[t].pointerId==e.pointerId){x.splice(t,1);return}}function eh(e){let t=P[e.pointerId];void 0===t&&(t=new $4xklQ.Vector2,P[e.pointerId]=t),t.set(e.pageX,e.pageY)}function ec(e){let t=e.pointerId===x[0].pointerId?x[1]:x[0];return P[t.pointerId]}i.domElement.addEventListener("contextmenu",en),i.domElement.addEventListener("pointerdown",J),i.domElement.addEventListener("pointercancel",K),i.domElement.addEventListener("wheel",ei,{passive:!1}),this.update()}}class $7ed6d163147eea6e$export$267a13440f7c79db{constructor(e){editor.list.hiddenDialog.dispatch(),this.container=e,this.width=window.innerWidth,this.height=window.innerHeight,this.camera=new $4xklQ.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.01,8e4),this.camera.lookAt(new $4xklQ.Vector3(0,0,0)),this.camera.layers.set(1),this.camera.layers.enable(2),editor.renderViewCamera=this.camera;let t=new $4xklQ.OrthographicCamera(-100,100,50,-50,0,10),i=this.width/this.height,r=-50;t.left=r*i,t.right=-r*i,t.top=-r,t.bottom=r,t.position.set(0,0,10),t.lookAt(new $4xklQ.Vector3(0,0,0)),editor.renderMiniMapCamera=t;let o="static/assets/images/",a=".png",n=[o+"px"+a,o+"nx"+a,o+"py"+a,o+"ny"+a,o+"pz"+a,o+"nz"+a],s=new $4xklQ.CubeTextureLoader().load(n);this.scene=new $4xklQ.Scene,editor.renderScene=this.scene,this.scene.background=s;let l=new $4xklQ.PlaneGeometry(2e5,2e5),h=new $4xklQ.MeshBasicMaterial({color:16777215,roughness:1,metalness:0,transparent:!0,opacity:0});this.floor=new $4xklQ.Mesh(l,h),editor.renderFloor2d=this.floor,this.scene.add(this.floor),new $4xklQ.AxesHelper(5e4).layers.set(2),this.createRenderer(),this.controls=new $dc94d71b7cc06198$export$8ff7788029dfdf52(this.camera,this.container),this.controls.target.set(0,0,0),editor.renderViewControl=this.controls;let c=new $4xklQ.Group,d=new $4xklQ.Group,p=new $4xklQ.Group,u=new $4xklQ.Group,m=new $4xklQ.Group,g=new $4xklQ.Group,f=new $4xklQ.Group;editor.renderFloorGroup=m,editor.renderModel3dGroup=c,editor.renderWall3dGroup=u,editor.renderMember3dGroup=f;let w=new $4xklQ.Group;editor.wallGroup3D.children.slice(0).forEach(e=>{if("3DWall"==e.modelType){let t=e.clone();t.modelType="3dWall",u.add(t)}if((e.type.indexOf("Door")>-1||e.type.indexOf("door")>-1)&&u.add(editor.codeModelCopy(e)),e.type.indexOf("Window")>-1||e.type.indexOf("window")>-1){let t=editor.codeModelCopy(e);t.name="window",u.add(t)}}),editor.scene.children.forEach(e=>{e.modelType&&w.add(e.clone())}),editor.floorGroup.children.forEach(e=>{m.add(e.clone())}),editor.floorGroup2d.children.forEach(e=>{g.add(e.clone())}),editor.memberGroup3D.children.forEach(e=>{f.add(e.clone())}),editor.model3D.children.forEach(e=>{c.add(e.clone())}),editor.model2D.children.forEach(e=>{d.add(e.clone())}),editor.wallGroup.children.forEach(e=>{p.add(e.clone())});let y=[u,m,f],b=new(0,$4xklQ.Matrix4)().makeScale(.001,.001,.001);y.forEach(e=>{e.rotation.x=-Math.PI/2,e.applyMatrix4(b),this.scene.add(e)}),this.scene.add(c);let x=[g,d,p,w],P=new(0,$4xklQ.Matrix4)().makeScale(.01,.01,.01);x.forEach(e=>{e.applyMatrix4(P),this.scene.add(e)});let v=new $4xklQ.Box3().setFromObject(u).getCenter(new $4xklQ.Vector3),M=new $4xklQ.Box3().setFromObject(u).getSize(new $4xklQ.Vector3);editor.renderSceneCenter=M.z,this.camera.position.x=v.x,this.camera.position.z=v.z+M.z,this.camera.position.y=v.y,this.controls.target.set(v.x,v.y,v.z),this.camera.updateProjectionMatrix(),this.controls.update();let C=new $4xklQ.PointLight(10394523);C.position.set(0,700,0),C.layers.enableAll();let D=new $4xklQ.AmbientLight(10394523);D.intensity=1,D.layers.enableAll(),D.position.set(0,700,0),this.scene.add(C),this.scene.add(D)}createRenderer(){let e=new $4xklQ.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});e.shadowMap.enabled=!0,e.shadowMap.type=$4xklQ.PCFSoftShadowMap,e.setPixelRatio(window.devicePixelRatio),e.setSize(window.innerWidth,window.innerHeight),e.xr.enabled=!0,e.outputEncoding=$4xklQ.sRGBEncoding,this.renderer=e,editor.RenderRend=this.renderer,this.container.appendChild(this.renderer.domElement),this.animate()}animate(){this.renderer.setAnimationLoop(this.render.bind(this))}render(){this.renderer.render(this.scene,this.camera)}}var $4xklQ=parcelRequire("4xklQ");class $ad8bf51027a12264$export$10707adaaf0119d6{constructor(e){if(this.container=e,this.width=272,this.height=183,this.scene=editor.renderScene,this.camera=editor.renderMiniMapCamera,this.renderer="",this.createRenderer(),this.raycaster=new $4xklQ.Raycaster,this.controls=new $dc94d71b7cc06198$export$8ff7788029dfdf52(this.camera,this.container),this.controls.target.set(0,0,0),this.camera.isOrthographicCamera){this.controls.enableRotate=!1,this.controls.mouseButtons={LEFT:$4xklQ.MOUSE.PAN,RIGHT:$4xklQ.MOUSE.PAN,MIDDLE:$4xklQ.MOUSE.PAN};let e=this.width/this.height,t=-50;this.camera.left=t*e,this.camera.right=-t*e,this.camera.top=-t,this.camera.bottom=t}else this.controls.enableRotate=!0,this.camera.aspect=this.width/this.height,this.controls.mouseButtons={LEFT:$4xklQ.MOUSE.LEFT,RIGHT:$4xklQ.MOUSE.PAN};this.camera.updateProjectionMatrix();let t=$e3212e52653b49d1$export$919db86739867624.createCamera(!0);t.name="cameraGroup",t.position.z=10,t.rotation.z=this.camera.rotation.z-Math.PI/2,this.cameraGroup=t;let i=new(0,$4xklQ.Matrix4)().makeScale(.01,.01,.01);this.cameraGroup.applyMatrix4(i),this.scene.add(t),e.addEventListener("mousedown",this.onMouseDown.bind(this)),e.addEventListener("mouseup",this.onMouseUp.bind(this)),e.addEventListener("mousemove",this.mouseMove.bind(this)),this.needUpdate=!0}onMouseDown(){let e=this.getObject(event);this.needUpdate=!1,e.length>0&&(this.downSel=e[0].object.parent,this.downPoint=e[0].point.clone(),this.oldPos=this.cameraGroup.position.clone(),"nosc"==this.downSel.name||"cameraGroup"==this.downSel.name||"nosr"==this.downSel.name?this.camera.isOrthographicCamera?this.controls.enablePan=!1:(this.controls.enablePan=!1,this.controls.enableRotate=!1):this.camera.isOrthographicCamera?this.controls.enablePan=!0:(this.controls.enablePan=!0,this.controls.enableRotate=!0))}onMouseUp(){this.downSel="",this.downPoint="",this.oldPos="",this.needUpdate=!0}mouseMove(e){let t=this.getObject(e);if(t.length>0){let e=t[0].object.parent,i=this.cameraGroup[e.name+"_move"];if(t[0].object.name.indexOf("circle")>=0&&(i=this.cameraGroup.circle_move),i?i.visible=!0:this.cameraGroup.children.forEach(e=>{e.name.indexOf("_move")>=0&&(e.visible=!1)}),this.downSel){let e=t[0].point.clone();if("nosc"==this.downSel.name||"cameraGroup"==this.downSel.name){let t=e.clone().sub(this.downPoint),i=this.oldPos.clone().add(t);this.cameraGroup.position.x=i.x,this.cameraGroup.position.y=i.y;let r=editor.renderViewCamera.position.clone();editor.renderViewCamera.position.x=this.cameraGroup.position.x/10,editor.renderViewCamera.position.z=-this.cameraGroup.position.y/10;let o=editor.renderViewCamera.position.clone().sub(r);editor.renderViewControl.target.add(o)}else if("nosr"==this.downSel.name){let t=this.cameraGroup.position.clone(),i=new $4xklQ.Vector2(e.x,e.y),r=new $4xklQ.Vector2(t.x,t.y),o=i.sub(r).angle();o-=Math.PI,this.cameraGroup.rotation.z=o;let a=editor.renderSceneCenter,n=-a*Math.cos(o),s=a*Math.sin(o);editor.renderViewControl.target.x=n,editor.renderViewControl.target.z=s}editor.renderViewCamera.updateProjectionMatrix(),editor.renderViewControl.update()}}}createRenderer(){let e=new $4xklQ.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});e.shadowMap.enabled=!0,e.shadowMap.type=$4xklQ.PCFSoftShadowMap,e.setPixelRatio(window.devicePixelRatio),e.setSize(this.width,this.height),e.setClearColor("#2A2E34"),e.xr.enabled=!0,e.outputEncoding=$4xklQ.sRGBEncoding,this.renderer=e,this.container.appendChild(this.renderer.domElement),this.animate()}animate(){this.renderer.setAnimationLoop(this.render.bind(this))}render(){if(this.renderer.render(this.scene,this.camera),!editor.renderViewCamera.isOrthographicCamera&&this.needUpdate){this.cameraGroup.position.x=10*editor.renderViewCamera.position.x,this.cameraGroup.position.y=-(10*editor.renderViewCamera.position.z);let e=new $4xklQ.Vector2(editor.renderViewCamera.position.x,editor.renderViewCamera.position.z),t=new $4xklQ.Vector2(editor.renderViewControl.target.x,editor.renderViewControl.target.z).clone().sub(e).angle();t-=Math.PI,this.cameraGroup.rotation.z=-t}}getObject(e){let t=new $4xklQ.Vector3;this.domRect=this.container.getBoundingClientRect(),t.x=(e.clientX+this.width-window.innerWidth)/this.width*2-1,t.y=-(2*((e.clientY+108-this.height)/this.height))+1,t.z=0,this.raycaster.setFromCamera(t,this.camera);let i=[editor.renderFloor2d];return this.cameraGroup.children.forEach(e=>{e.visible&&i.push(e)}),this.raycaster.intersectObjects(i,!0)}}var $47Y2g=parcelRequire("47Y2g"),$9decf90ebae5e35e$var$_DEFAULT_CAMERA=new $4xklQ.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.01,1e3);$9decf90ebae5e35e$var$_DEFAULT_CAMERA.name="3dCamera",$9decf90ebae5e35e$var$_DEFAULT_CAMERA.sceneModel="3D",$9decf90ebae5e35e$var$_DEFAULT_CAMERA.position.set(-5,10,10),$9decf90ebae5e35e$var$_DEFAULT_CAMERA.lookAt(new $4xklQ.Vector3(0,0,0)),$9decf90ebae5e35e$var$_DEFAULT_CAMERA.layers.set(1),$9decf90ebae5e35e$var$_DEFAULT_CAMERA.layers.enable(2);var $9decf90ebae5e35e$var$_DEFAULT_ROMA_CAMERA=new $4xklQ.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.01,1e3);$9decf90ebae5e35e$var$_DEFAULT_ROMA_CAMERA.name="3dRomaCamera",$9decf90ebae5e35e$var$_DEFAULT_ROMA_CAMERA.sceneModel="3D",$9decf90ebae5e35e$var$_DEFAULT_ROMA_CAMERA.position.set(0,0,0),$9decf90ebae5e35e$var$_DEFAULT_ROMA_CAMERA.lookAt(new $4xklQ.Vector3(0,0,-1.65)),$9decf90ebae5e35e$var$_DEFAULT_ROMA_CAMERA.layers.set(1),$9decf90ebae5e35e$var$_DEFAULT_ROMA_CAMERA.layers.enable(2);var $9decf90ebae5e35e$var$_DEFAULT_CAMERA1=new $4xklQ.OrthographicCamera(-1e4,1e4,5e3,-5e3,0,1e3);$9decf90ebae5e35e$var$_DEFAULT_CAMERA1.name="2dCamera",$9decf90ebae5e35e$var$_DEFAULT_CAMERA1.sceneModel="2D",$9decf90ebae5e35e$var$_DEFAULT_CAMERA1.position.set(0,0,1e3),$9decf90ebae5e35e$var$_DEFAULT_CAMERA1.lookAt(new $4xklQ.Vector3(0,0,0));let $9decf90ebae5e35e$var$k=window.innerWidth/window.innerHeight,$9decf90ebae5e35e$var$s=-5e3;$9decf90ebae5e35e$var$_DEFAULT_CAMERA1.left=$9decf90ebae5e35e$var$s*$9decf90ebae5e35e$var$k,$9decf90ebae5e35e$var$_DEFAULT_CAMERA1.right=-$9decf90ebae5e35e$var$s*$9decf90ebae5e35e$var$k,$9decf90ebae5e35e$var$_DEFAULT_CAMERA1.top=-$9decf90ebae5e35e$var$s,$9decf90ebae5e35e$var$_DEFAULT_CAMERA1.bottom=$9decf90ebae5e35e$var$s;class $9decf90ebae5e35e$export$8642042a8635463d{constructor(e){e.dataVersion="0.0.1",e.cacheJson="",e.currentCacheJson="",e.config=new $8b391c7d7cfc95c8$export$29cd7b75162a9425,e.progress=1,e.PolyK=PolyK,e.centerArea=e.config.centerArea,e.adsorbentModel=!0,e.orthogonalModel=!1,e.innerDraw=1,e.touchStart="",e.sceneActive=!1,e.copyFloorMaterial="",e.specialPointArr=[],e._DEFAULT_CAMERA=$9decf90ebae5e35e$var$_DEFAULT_CAMERA.clone(),e._DEFAULT_CAMERA1=$9decf90ebae5e35e$var$_DEFAULT_CAMERA1.clone(),e.camera=$9decf90ebae5e35e$var$_DEFAULT_CAMERA1.clone(),e.miniMapCamera=$9decf90ebae5e35e$var$_DEFAULT_CAMERA.clone(),e.wallDep=240,e.roomWallDep=240,e.scene=new $4xklQ.Scene,e.cameraScene=new $4xklQ.Scene,e.scene.name="Scene",e.floor="",e.themeColor="",e.gridProportion="",e.raycaster=new $4xklQ.Raycaster,e.startPoint="",e.endPoint="",e.currentPoint="",e.currenDraw="",e.mouse=new $4xklQ.Vector3(0,0,0),e.helperGroup=new $4xklQ.Group,e.helperGroup.name="helperGroup",e.doorHelperGroup=new $4xklQ.Group,e.doorHelperGroup.name="doorHelperGroup",e.circlePoint="",e.pointHelperGroup=new $4xklQ.Group,e.pointHelperGroup.name="pointHelper",e.pointHelpGroup=new $4xklQ.Group,e.pointHelpGroup.name="pointHelp",e.uiPanelBox=new $3BPdS.UIPanel,e.uiPanelBox.setWidth(window.innerWidth+"px"),e.uiPanelBox.setHeight(window.innerHeight+"px"),e.statusJson=[],e.allWalls=[],e.otherMeshs=[],e.otherMember=[],e.wallGroup=new $4xklQ.Group,e.wallGroup.name="2dwall",e.wallGroup3D=new $4xklQ.Group,e.wallGroup3D.name="3dwall",e.memberGroup3D=new $4xklQ.Group,e.memberGroup3D.name="3dMember",e.model3D=new $4xklQ.Group,e.model3D.name="3dModel",e.model2D=new $4xklQ.Group,e.model2D.position.z=.1,e.model2D.name="2dModel",e.modelHelperGroup=new $4xklQ.Group,e.modelHelperGroup.name="3dModelSelectHelper",e.clickDepthMsg={},e.modelDotGroup=new $4xklQ.Group,e.modelDotGroup.name="3dModelDotHelper",e.floorGroup=new $4xklQ.Group,e.floorGroup.rotation.x=-Math.PI/2,e.floorGroup.name="floorGroup",e.doorHoleArr=[],e.wallGroup3D.rotation.x=-Math.PI/2,e.memberGroup3D.rotation.x=-Math.PI/2,e.cameras={},e.cameras[e.camera.uuid]=e.camera,e.cameras[$9decf90ebae5e35e$var$_DEFAULT_CAMERA.uuid]=$9decf90ebae5e35e$var$_DEFAULT_CAMERA,e.cameras[$9decf90ebae5e35e$var$_DEFAULT_ROMA_CAMERA.uuid]=$9decf90ebae5e35e$var$_DEFAULT_ROMA_CAMERA,e.lastCamera="3dCamera",e.toolType="free",e.chooseColor=new $4xklQ.Color("#4169BB"),e.cancelChooseColor=new $4xklQ.Color("rgb(144, 146, 146)"),e.cancelChooseShortColor=new $4xklQ.Color("rgb(255, 255, 255)"),e.cancelChooseHeavyColor=new $4xklQ.Color("rgb(0, 0, 0)"),e.boxLineMaterial=new $4xklQ.LineBasicMaterial({color:"#000000",transparent:!0,opacity:.4,depthWrite:!1,side:$4xklQ.DoubleSide}),e.selectObjArr=[],e.miniMapObj="",e.clickColor=new $4xklQ.Color("#3A5FFF"),e.moveDoorColor=new $4xklQ.Color("#00FFFF"),e.moveDoorOutColor=new $4xklQ.Color("#000000"),e.downPoint="",e.currentDownSelect="",e.currentMoveSelect="",e.mouseCoverObj="",e.startChooseWall="",e.clickSelect=[],e.currentDoor="",e.moveStartPosition=new $4xklQ.Vector3(0,0,0),e.allLinkWallByStartPoint=[],e.samePointWall=[],e.samePointByDrag="",e.menuSwitch=!1,e.viewportCamera=e.camera,e.globalControl="",e._scaleStart=new $4xklQ.Vector3(1,1,1),e._offsetStart="",e.doorDistance="",e.miniControls2d="",e.miniControls3d="",e.floorGroup2d=new $4xklQ.Group,e.floorGroup2d.name="floorGroup2d",e.lineGroup3D=new $4xklQ.Group,e.lineGroup3D.name="3dBoxLine",e.lineGroup3D.rotation.x=-Math.PI/2,e.lineGroup3D.visible=!1,e.cameraRenderer=new $4xklQ.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}),e.cameraRenderer.shadowMap.enabled=!0,e.cameraRenderer.setPixelRatio(window.devicePixelRatio),e.cameraRenderer.xr.enabled=!0,e.cameraRenderer.outputEncoding=$4xklQ.sRGBEncoding,e.cameraRenderer.setSize(window.innerWidth,window.innerHeight),e.cameraRenderer.setClearColor(16777215,0),e.pngCamera=$9decf90ebae5e35e$var$_DEFAULT_CAMERA1.clone(),e.openRenderScene=!1,e.newRenderer=new $4xklQ.WebGLRenderer({antialias:!0}),e.newRenderer.setClearColor(15264748),e.newRenderer.setPixelRatio(window.devicePixelRatio),e.newRenderer.shadowMap.enabled=!0,e.newRenderer.xr.enabled=!0,e.allRoomCenterCamera=new $4xklQ.Group,e.splitRoomLineGroup=new $4xklQ.Group,e.splitRoomLineGroup.name="splitRoomHelperGroup",e.splitRoomLine=new $4xklQ.Group,[e.splitRoomLineGroup,e.splitRoomLine,e.model3D,e.model2D,e.lineGroup3D,e.wallGroup,e.floorGroup,e.wallGroup3D,e.memberGroup3D,e.pointHelpGroup,e.helperGroup,e.pointHelperGroup,e.doorHelperGroup,e.floorGroup2d,e.modelHelperGroup,e.allRoomCenterCamera,e.modelDotGroup].forEach(t=>{e.scene.add(t)}),e.roomList=[[],[]],e.allGroup3d=[e.lineGroup3D,e.floorGroup,e.wallGroup3D,e.memberGroup3D];var t=new $4xklQ.MeshBasicMaterial({color:"#4169E1",side:$4xklQ.DoubleSide});e.wallTool=new $5XTH3.DrawWallTool(t);let i=new $9b1db6660d92c803$export$fd171b37577d7494(e);e.wallHelp=new $d0f874000594cf7a$export$a955f3d6a39ce4b2,e.wallHelper=new $002a82be864d68ed$export$a80d7a02e87abd45(e);let r=e;e.debug=!1,e.list.sceneInit.add(function(e,t="PC"){r.dom=e,r.history=new $3fdc31d914635d41$export$84202caead5689ba(r,t),new $19e26f6affaac76b$export$15d36fc1a69ab4a0(r,e,t)}),e.list.resetCamera.add(function(){r.globalControl&&(r.globalControl.reset(),r.globalControl.object.isPerspectiveCamera&&(r.globalControl.object.zoomNum=1),r.updateDom(),r.list.changeCameraSlider.dispatch("2d",1),(0,$9HO6e.UtilCore).updateLineDimensionsLine(r),r.autoShowHidden(1),r.globalControl.object.isPerspectiveCamera&&r.switchHelperGroup("hidden"))}),e.list.splitTool.add(function(e){r.toolType="splitTool",r.splitType=e,r.list.setViewportCamera.dispatch("2D",r)}),e.list.changeTheme.add(function(e){""!=e?(r.renderer.setClearColor(e),r.grid.children.concat(r.grid3d.children).forEach(e=>{("2dGrid1"==e.name||"3dGrid1"==e.name)&&(e.material.color=new $4xklQ.Color(5263440)),("2dGrid2"==e.name||"3dGrid2"==e.name)&&(e.material.color=new $4xklQ.Color(7894390))}),r.themeColor=e):(r.renderer.setClearColor(15264748),r.grid.children.concat(r.grid3d.children).forEach(e=>{("2dGrid1"==e.name||"3dGrid1"==e.name)&&(e.material.color=new $4xklQ.Color(16777215)),("2dGrid2"==e.name||"3dGrid2"==e.name)&&(e.material.color=new $4xklQ.Color(16777215))}),r.themeColor="")}),e.list.saveScene.add(function(e="cache"){"cache"==e?r.saveSceneJson():r.saveSceneJsonToFile()}),e.list.createMap.add(function(e,t){if(r.miniMapCamera.isOrthographicCamera){let i=e/t,o=-5e3;r.miniMapCamera.left=o*i,r.miniMapCamera.right=-o*i,r.miniMapCamera.top=-o,r.miniMapCamera.bottom=o}else r.miniMapCamera.aspect=e/t;if(r.newRenderer.setSize(e,t),r.miniMapCamera.updateProjectionMatrix(),r.roamTool){let i=e/(t+28),o=-5e3;r.miniCamera.camera.left=o*i,r.miniCamera.camera.right=-o*i,r.miniCamera.camera.top=-o,r.miniCamera.camera.bottom=o,r.miniCamera.renderer.setSize(e,t+28),r.miniCamera.camera.updateProjectionMatrix()}}),e.list.makeGroup.add(function(){let e=r.camera.isOrthographicCamera?"2d":"3d";r.makeGroup(e)}),e.list.explodeGroup.add(function(){let e=r.camera.isOrthographicCamera?"2d":"3d";r.explodeGroup(e)}),e.list.changeModel.add(function(e){r.grid3d.visible=!1,r.floorGroup.visible=!0;let t=r.model3D.children,i=!1,o=r.wallGroup3D.children;switch((o=(o=o.concat(r.model3D.children)).concat(r.floorGroup.children)).forEach(e=>{e.traverse(function(e){e.isMesh&&e.oldColor&&(e.material=e.oldColor.clone())})}),e){case"transparentModel":r.wallGroup3D.visible=!1,r.memberGroup3D.visible=!1,r.lineGroup3D.visible=!0,r.floorGroup.visible=!1,i=!0;break;case"materialModel":r.wallGroup3D.visible=!0,r.grid3d.visible=!0,r.memberGroup3D.visible=!0,r.lineGroup3D.visible=!1,i=!1;break;case"lineModel":r.wallGroup3D.visible=!1,r.memberGroup3D.visible=!1,r.lineGroup3D.visible=!0,i=!1;break;case"MLModel":r.wallGroup3D.visible=!0,r.memberGroup3D.visible=!0,r.lineGroup3D.visible=!0,i=!1;break;case"randomMaterialModel":let a={};o.forEach(e=>{e.traverse(function(e){e.isMesh&&(e.oldColor||(e.oldColor=e.material.clone()),setTimeout(()=>{let t=e.material.color.toArray(),i=t[0]+"-"+t[1]+"-"+t[2];if(a.hasOwnProperty(i))e.material=a[i].clone();else{let t=new $4xklQ.MeshBasicMaterial;var r=new Float32Array([Math.random(),Math.random(),Math.random()]);t.color.fromArray(r),e.material=t,a[i]=e.material.clone()}},100))})}),i=!1}t.forEach(e=>{e.traverse(function(e){e.isMesh&&(e.material.emissive=new $4xklQ.Color(0),e.material.wireframe=i)})})}),e.list.removeAll.add(function(e="save",t=!0,i="all"){let o="清空画布",a="清空画布会清除当前全部设计";"lable"==i&&(o="清空标注",a="清空标注会清除当前全部标注"),t?r.list.dialog.dispatch(o,a,["remove",e,i]):r.removeScene(e,i)}),e.list.activeTool.add(function(e,t=!0){if("close"==e){r.exitTool(t);return}r.camera.isOrthographicCamera||r.list.setViewportCamera.dispatch("2D",r),r.exitTool(!0,!1),("wall"==e||"room"==e)&&(r.dom.style.cursor="crosshair"),"figure"==e&&r.list.importMap.dispatch(),r.toolType=e}),e.list.importMap.add(function(){let e="清空提示",t="识别图片生成户型，将清空当前方案中所有设内容没确定继续？";r.execute(),r.list.dialog.dispatch(e,t,["importMap"])}),e.list.doCallback.add(function(e){switch(e[0]){case"remove":r.removeScene(e[1],e[2]);break;case"importMap":r.removeScene(""),r.importMapMain();break;case"delMap":r.execute(),r.delMap()}}),e.list.setScaleTool.add(function(){r.cleanScaleTool(),r.allHelperForScaleTool(new $4xklQ.Vector3(-1e3,0,0),new $4xklQ.Vector3(1e3,0,0))}),e.list.hiddenMap.add(function(){r.scene.children.forEach(e=>{"mapImage"==e.useType&&(e.visible=!e.visible)})}),e.list.delMap.add(function(){r.list.dialog.dispatch("删除底图","",["delMap"])}),e.list.showHiddenHelper.add(function(e,t,i=""){""==i&&(r.config.settingJsonCopy.hasOwnProperty(e)&&(r.config.settingJson[e]=t),i=r.config.settingJson),r.config.settingJson=i;let o=["roomName","roomArea","dimension"];for(let e in i)"only"==t&&0>o.indexOf(e)||r.showHiddenHelperMain(e,i[e])}),e.list.useModel.add(function(e,t,i,o=""){r.adsorbentModel=e,r.orthogonalModel=t,r.innerDraw=i,""!=o&&(r.wallDep=o)}),e.list.drawRoomChangeth.add(function(e){r.roomWallDep=1*e}),e.list.changeWallType.add(function(e){if(""==r.clickSelect||""==r.clickSelect[0].object)return;r.execute(),r.removeBSRHelper();let t=r.clickSelect[0].object;t.isArc==e?t.isArc=!1:t.isArc=e;let i=[];r.otherMeshs.forEach(e=>{e.wallId==t.wallID&&i.push(e)}),i.forEach(e=>{r.otherMeshs.splice(r.otherMeshs.indexOf(e),1),r.scene.remove(e)}),new $523a84362d27c3e8$export$b680ca477a72be07(r).wallToJson();let o=(0,$9HO6e.UtilCore).getRealWallByPosition(t.startPoint,t.endPoint,r.allWalls);r.clickSelect[0].object=o,o.material.color=r.clickColor}),e.list.splitWall.add(function(){if(""==r.clickSelect||""==r.clickSelect[0].object)return;r.execute();let e=r.clickSelect[0].object,t=new $523a84362d27c3e8$export$b680ca477a72be07(r),i="",o=[];if(e.isArc){let t=new $4xklQ.Vector2(e.startPoint.x,e.startPoint.y),i=new $4xklQ.Vector2(e.endPoint.x,e.endPoint.y),a=i.clone().sub(t.clone()),n=new $4xklQ.Vector2(-a.y,a.x),s=new $4xklQ.Vector2(a.y,-a.x),l=t.clone().distanceTo(e.arcCenter.clone()),h=e.arcCenter.clone().add(n.setLength(l)),c=e.arcCenter.clone().add(s.setLength(l)),d=(0,$9HO6e.UtilCore).getClockWise(t,e.cp,i),p=(0,$9HO6e.UtilCore).getClockWise(t,h,i),u="";u=d*p>0?h:c,e.endPoint=u.clone();let m=e.geometry.attributes.position.array,g=(0,$9HO6e.UtilCore).getPointInArc(t,u,d,e.arcCenter.clone(),l);e.cp=g;let f=r.addArcWall(t,i,e.cp,e.isArc);m=f.geometry.attributes.position.array,f.startPoint=u.clone();let w=(0,$9HO6e.UtilCore).getPointInArc(u,i,d,e.arcCenter.clone(),l);f.cp=w,o=[e,f]}else i=new $4xklQ.Vector2((e.startPoint.x+e.endPoint.x)/2,(e.startPoint.y+e.endPoint.y)/2),o=t.splitWall(e,i);t.wallToJson();let a=r.getDialogPosition(new $4xklQ.Vector3(o[0].startPoint.x,o[0].startPoint.y,0),new $4xklQ.Vector3(o[0].endPoint.x,o[0].endPoint.y,0)),n=Math.round(o[0].startPoint.clone().distanceTo(o[0].endPoint.clone())),s=(0,$9HO6e.UtilCore).havePointWall(o[0].startPoint,r.allWalls).length>1,l=(0,$9HO6e.UtilCore).havePointWall(o[0].endPoint,r.allWalls).length>1;r.list.showDialog.dispatch(0,"wall",a,[n,o[0].thickness,s,l]);let h=(0,$9HO6e.UtilCore).getRealWallByPosition(o[0].startPoint,o[0].endPoint,r.allWalls);r.clickSelect[0].object=h,h.material.color=r.clickColor}),e.list.delWall.add(function(){if(r.execute(),""==r.clickSelect||""==r.clickSelect[0].object)return;let e=r.clickSelect[0].object,t=(0,$9HO6e.UtilCore).havePointWall(e.startPoint,r.allWalls,e),i=(0,$9HO6e.UtilCore).havePointWall(e.endPoint,r.allWalls,e);r.wallGroup.remove(e),r.allWalls.indexOf(e)>=0&&r.allWalls.splice(r.allWalls.indexOf(e),1),r.removeHelperByWall(e),2==t.length&&r.margeWall(t[0],t[1]),2==i.length&&r.margeWall(i[0],i[1]),new $523a84362d27c3e8$export$b680ca477a72be07(r).wallToJson();let o=r.getAllWindowInWall(e);o.length>0&&o.forEach(e=>{r.scene.remove(e),r.otherMeshs.indexOf(e)>=0&&r.otherMeshs.splice(r.otherMeshs.indexOf(e),1)}),r.list.hiddenDialog.dispatch()}),e.list.delSplitLine.add(function(){if(""==r.clickSelect||""==r.clickSelect[0].object)return;r.execute();let e=r.clickSelect[0].object;r.splitRoomLine.remove(e),r.splitRoomLineGroup.children=[],r.list.hiddenDialog.dispatch(),r.clickSelect="",new $523a84362d27c3e8$export$b680ca477a72be07(r).wallToJson()}),e.list.delDoor.add(function(){if(""==r.clickSelect||""==r.clickSelect[0].object)return;let e=r.clickSelect[0].object.parent;if(e.isLock){r.list.alert.dispatch("模型已锁定,请先解锁","warning");return}r.execute();let t=e.wallId?e.wallId:e.parameter.tdm.wallId,i=r.getWallById(t);r.removeDoor(e),r.doorHelperGroupClean(),r.list.hiddenDialog.dispatch(),r.clickSelect="",r.partRefreshWall(i)}),e.list.delMember.add(function(){if(""==r.clickSelect||""==r.clickSelect[0].object)return;let e=r.clickSelect[0].object.parent;if(r.camera.isOrthographicCamera||(e=r.clickSelect[0].object.twoD),e.isLock){r.list.alert.dispatch("模型已锁定,请先解锁","warning");return}r.execute(),r.removeMember(e),r.doorHelperGroupClean(),r.modelHelperGroup.children=[],r.list.hiddenDialog.dispatch(),r.clickSelect=""}),e.list.delModel.add(function(){if(""==r.clickSelect||""==r.clickSelect[0].object)return;let e=[];(e=1==r.selectObjArr.length?[r.clickSelect[0].object]:r.selectObjArr).forEach(e=>{let t=r.getOuterParent(e);if(t.isLock){1==r.selectObjArr.length&&r.list.alert.dispatch("模型已锁定,请先解锁","warning");return}r.execute();let i=r.getOuterParent(t,t,"outer"),o=t.parent;if("2DModel"==t.modelType||"2dModelGroup"==t.modelType){t.parent.remove(t);let e=r.get3DModelBy2DModel(t);e.parent.remove(e)}else{let e=r.get2DModelBy3DModel(t);i=r.getOuterParent(e,e,"outer"),o=e.parent,t.parent.remove(t),e.parent.remove(e)}if(r.doorHelperGroupClean(),r.modelHelperGroup.children=[],r.list.hiddenDialog.dispatch(),r.clickSelect="",r.clickDepthMsg.uuid){r.modelDotGroup.children=[];let e=i.param[0];r.refreshRealSizeByBox(i,o),r.updateModelPosition(o,i),r.addDashBoxFor2dGroup(i),r.addDashBoxForGroup(e)}})}),e.list.reverseDoor.add(function(){if(""==r.clickSelect||""==r.clickSelect[0].object)return;r.execute();let e=r.clickSelect[0].object.parent;if("LWindow"!=e.modelType&&"UWindow"!=e.modelType){if("door"==e.modelType||"childMotherDoor"==e.modelType)r.execute(new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(r,"door","end",[0,0,"angle"],!0,"click"),"翻转");else{let t=e.parameter[0];e.rotation.z+=Math.PI,t.rotation.y+=Math.PI}}}),e.list.replaceDoor.add(function(){if(""==r.clickSelect||""==r.clickSelect[0].object)return;r.execute();let e=r.clickSelect[0].object.parent;if(!e.modelPath)return;let t=e.modelPath,i="";if(t.indexOf("_replace")>=0)i=t.replace(/_replace/g,"");else{let e=t.split("."),r=e.pop();i=e.join()+"_replace."+r}e.modelPath=i}),e.list.copyDoor.add(function(){if(""==r.clickSelect||""==r.clickSelect[0].object)return;let e=r.clickSelect[0].object.parent;"3dMember"==e.name&&(e=r.clickSelect[0].object.twoD),r.list.setViewportCamera.dispatch("2D",r),r.copyDoor=e,r.toolType=r.config.toolTypeConfig[e.modelType]}),e.list.GPURender.add(function(){r.list.hiddenDialog.dispatch(),r.switchHelperGroup("hidden"),new $50588171089be068$export$6a37e807469f37da(r)}),e.list.createRoom.add(function(e){i.createRoom(e)}),e.list.setRoomType.add(function(e){if(""==r.clickSelect||""==r.clickSelect[0].object)return;let t=r.clickSelect[0].object;t.roomName=e;let i=($("#roomName"+t.uuid).attr("roomName")+"\n"+$("#roomName"+t.uuid).attr("roomArea")).split("\n");i[0]=e,$("#roomName"+t.uuid).attr("roomName",e),$("#roomName"+t.uuid).text(i.join("\n")),r.saveSceneJson()}),e.list.setViewportCamera.add(e.setViewportCamera),e.list.executeTool.add(function(e){new $5002053a529f5520$export$e0cf849ef0f13f5d(r,e).main()}),e.list.dragRoomForMobile.add(e=>{(0,$47Y2g.MobileMain).autoSetCamera(r.wallGroup),r.loadRoom(e)}),e.list.dragWallForMobile.add(e=>{r.toolType=e}),e.list.recoveryScene.add(function(e){r.list.alert.dispatch("正在加载户型"),r.removeScene(""),localStorage.setItem("sceneData",e),(e=JSON.parse(e)).cameraJson.sceneModel="2D",r.cacheJson=JSON.stringify(e),r.readCache(JSON.stringify(e)),r.miniMapObj=new $3c82f100e7ba0388$export$bc845c5c4f62a4a1(r,r.miniMapCamera,r.scene,r.newRenderer,r.miniDom,240,202),r.miniMapObj.main()}),e.list.saveWallModel.add(function(){r.camera.isOrthographicCamera||r.list.setViewportCamera.dispatch("2D",r);let e=new $4xklQ.Group,t=["2dwall","floorGroup2d","flue","post","bridge"];r.scene.children.forEach(i=>{t.indexOf(i.name)>-1&&e.add(i.clone()),i.modelPath&&(i.modelPath.indexOf("door")>-1||i.modelPath.indexOf("window")>-1)&&e.add(i.clone())});let i=r.getSceneAllJson();i.mapJson={},i=JSON.stringify(i);let o=r.getTextCanvas2("roomName");r.initCameraPngScene(e,"2D"),r.cameraScene.add(o),setTimeout(function(){let e=r.cameraRenderer.domElement.toDataURL("image/png");o.parent.remove(o),r.list.alert.dispatch("户型保存成功"),r.list.saveWallJson.dispatch(e,i)},100)}),e.list.saveModel.add(function(){0!=r.selectObjArr.length&&(r.list.hiddenDialog.dispatch(),r.selectObjArr.forEach(e=>{let t="";t=r.camera.isOrthographicCamera?r.get3DModelBy2DModel(r.getOuterParent(e)):r.getOuterParent(e);let i="组合模型";if(t.imgPath){let e=t.imgPath.split("/");(i=e[e.length-1].split(".")).pop(),i=i.join("")}let o=t,a=t.clone();r.extendParam(o,a);var n=JSON.stringify(r.exportModelJson(a));r.initCameraPngScene(t),r.exportModelGlb(t),i||(i="默认模型"),setTimeout(function(){let e=r.cameraRenderer.domElement.toDataURL("image/png");r.list.popupSaveRecord.dispatch(e,n);var o=new Blob([n],{type:"text/plain"}),a=document.createElement("a");a.style.display="none",a.href=URL.createObjectURL(o),a.download=i+".json",a.click();var s=document.createElement("a");s.href=e,s.download=i+"iso.png",s.click(),r.initCameraPngScene(t,"top"),setTimeout(function(){let e=r.cameraRenderer.domElement.toDataURL("image/png");var o=document.createElement("a");o.href=e,o.download=i+".png",o.click(),r.initCameraPngScene(t,"right"),setTimeout(function(){let e=r.cameraRenderer.domElement.toDataURL("image/png");var t=document.createElement("a");t.href=e,t.download=i+"right.png",t.click()})},100)},100)}))}),e.list.exportGLTF.add(function(e){"pdf"==e?r.exportPDF():r.exportGLTF(e)}),e.list.smartRoom.add(function(e){if(1e4==e[0]){r.testSmartRoom();return}setTimeout(()=>{r.otherMeshs.length>0&&r.scene.remove(...r.otherMeshs),r.removeScene(""),r.camera.isOrthographicCamera||r.list.setViewportCamera.dispatch("2D",r);let t=new $ca3cc62cb04c2488$export$9a58ef0d7ad3278c().getHome(e[0],e[1],e[2]);new $523a84362d27c3e8$export$b680ca477a72be07(r).wallToJson("2D",t[0]),r.scene.add(...t[1]),r.otherMeshs=t[1],r.doorHoleArr=t[2],r.doorHelperGroupClean(),r.pointHelperGroup.children=[],r.model2D.children=[],r.model3D.children=[],r.exitTool(!0),r.list.executeTool.dispatch("moveFree")},100)}),e.list.changeCamera.add(function(e,t="",i=1){let o=.95*i,a=r.globalControl;a.object.isPerspectiveCamera?"max"==t?a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom/o)):a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom*o)):a.object.isOrthographicCamera&&("max"==t?a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom/o)):a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom*o))),a.object.updateProjectionMatrix(),r.globalControl.update(),r.updateDom()}),e.list.undo.add(function(){r.history.undo()}),e.list.redo.add(function(){r.history.redo()}),e.list.uploadFile.add(function(e,t,i=""){if(!(0>e.indexOf(".glb")||0>e.indexOf(".gltf")||0>e.indexOf(".json")))return;if(e&&r.list.progressOpen.dispatch(),e.indexOf(".json")>=0){var o=new FileReader;o.onload=()=>{localStorage.setItem("sceneData",o.result),r.cacheJson=o.result,r.readCache(o.result),r.list.progressClose.dispatch()},o.readAsText(t),r.list.progressChange.dispatch(100);return}let a=r.config.maxWidth,n=URL.createObjectURL(t);new $hu0fb.GLTFLoader().load(n,function(o){let n=o.scene;var s=new $4xklQ.Box3;s.setFromObject(n);let l=1*(s.max.x-s.min.x).toFixed(2),h=1*(s.max.y-s.min.y).toFixed(2),c=1*(s.max.z-s.min.z).toFixed(2);if(Math.abs(s.min.y)>=0){let e=new $4xklQ.Vector3;s.getCenter(e);let t=new $4xklQ.Group;n.position.set(-e.x,-e.y,-e.z),t.add(n),n=t}l>a&&n.scale.set(a/l,a/l,a/l),n.position.set(0,h/2,0),n.traverse(function(e){e.layers.set(2)});let d=e.split(".");d.pop();let p=d.join(".");n.name=p,n.modelType="3DModel",n.modelPosition="bottom",""!=i&&(n.position.set(i.location.x,i.location.y,i.location.z),n.rotation.y=i.rotation,i.rotate&&n.rotation.set(i.rotate.x,i.rotate.y,i.rotate.z),n.scale.set(i.width/l,i.height/h,i.depth/c),n.isLock=i.isLock,n.modelPosition=i.modelPosition,i.scale&&n.scale.copy(i.scale)),n.width=l,n.height=h,n.depth=c,n.imgPath="localPath",i?i.sliceArr&&(n.sliceArr=i.sliceArr):r.handleUpload(t,n),r.model3D.add(n),r.initCameraPngScene(n,"top"),setTimeout(function(){for(var e=r.cameraRenderer.domElement.toDataURL("image/png").split(","),t=e[0].match(/:(.*?);/)[1],o=atob(e[1]),a=o.length,s=new Uint8Array(a);a--;)s[a]=o.charCodeAt(a);var h=new Blob([s],{type:t});let d=new File([h],"upload.jpg",{type:"image/jpeg",lastModified:Date.now()}),p=new $4xklQ.TextureLoader;p.setCrossOrigin("");let u=URL.createObjectURL(d);p.load(u,e=>{let t=new $4xklQ.Mesh(new $4xklQ.PlaneBufferGeometry(1e3*l,1e3*c),new $4xklQ.MeshBasicMaterial({map:e,transparent:!0}));t.position.set(0,0,0),i.scale&&t.scale.set(i.scale.x,i.scale.z,i.scale.y),t.modelType="2DModel",r.model2D.add(t),t.modelId=n.uuid,t.param=[n],n.modelId=t.uuid,n.param=[t],t.name=n.name,t.modelPosition=n.modelPosition,""!=i||r.camera.isOrthographicCamera||(r.mouseCoverObj=n),""==i&&r.camera.isOrthographicCamera&&(r.mouseCoverObj=t),i&&("bottom"==n.modelPosition?n.visible=r.config.settingJson.showFloorFurniture:"top"==n.modelPosition?n.visible=r.config.settingJson.showCeilFurniture:n.visible=r.config.settingJson.showWallFurniture,t.visible=n.visible),r.synchroModel(n),r.list.progressClose.dispatch()})},100)},function(e){r.list.progressChange.dispatch(parseInt(e.loaded/e.total*100))},function(e){console.log(e)})}),e.list.loadGLTFJson.add(function(e,t="load"){if(0>e.indexOf("modelPosition")){var i=new XMLHttpRequest;i.open("GET",e,!0),i.send(null),i.onreadystatechange=function(){if(4==i.readyState&&(200==i.status||0==i.status)){let e=JSON.parse(i.responseText);r.loadGLTFJsonCore(e,t)}}}else{let i=JSON.parse(e);r.loadGLTFJsonCore(i,t)}}),e.list.replaceGltf.add(function(e){let t=e[0];t.indexOf("modelPosition")>=0?r.list.loadGLTFJson.dispatch(e[0],"replace"):t.indexOf(".json")>=0?r.list.loadGLTFJson.dispatch(e[0],"replace"):(r.list.loadGltf.dispatch(e,"",r.model3D,r.model2D,"replace"),window.intervalClear=setInterval(()=>{r.cleanInterval("replace")},100))}),e.list.loadGltf.add(function(e,t="",i=r.model3D,o=r.model2D,a="load"){r.doorHelperGroupClean();let n="",s="",l="",h="",c="",d="",p="",u="";if(""!=t?(s=t.imgPath,n=t.modelPath,d=t.location,p=t.rotation,l=t.modelPosition,t.scale&&(u=t.scale)):(n=e[0],s=e[1],l=e[2]),!n)return;let m=r.config.maxWidth,g=s.split("/"),f=g[g.length-1].split(".");f.pop(),f=f.join(""),g.pop();let w=g.join("/");w+="/"+f+".json";var y=new XMLHttpRequest;y.open("GET",w,!0),y.send(null),y.onreadystatechange=function(){if(4==y.readyState){if(200==y.status||0==y.status){let e=JSON.parse(y.responseText),u=e.boundingBox.xLen/1e3,g=e.boundingBox.yLen/1e3,w=e.boundingBox.zLen/1e3;""!=t&&(u=t.width,g=t.height,w=t.depth);let b=r.wallHelp.obbBoxMain(1e3*u,1e3*w,0),x=r.wallHelp.obbBoxMain(u,g,w);x.name="model3dBox",b.name="model2dBox",t.scale&&b.scale.set(t.scale.x,t.scale.z,t.scale.y),x.layers.set(2),u>m&&(x.scale.set(m/u,m/u,m/u),b.scale.set(m/u,m/u,m/u)),i.add(x),o.add(b),x.modelId=b.uuid,x.param=[b],x.modelPosition=l,x.height=g,b.modelId=x.uuid,b.param=[x],r.camera.isOrthographicCamera&&""==t&&(r.mouseCoverObj=b),r.camera.isOrthographicCamera||""!=t||(r.mouseCoverObj=x),""!=t?(b.position.set(1e3*d.x,-(1e3*d.z),0),t.imgLayer&&(b.position.z=t.imgLayer),b.rotation.z=p,x.position.set(d.x,d.y,d.z),x.rotation.y=p,t.rotate&&x.rotation.set(t.rotate.x,t.rotate.y,t.rotate.z),t.scale&&x.scale.copy(t.scale)):("top"==l?x.position.set(0,r.wallGroup3D.roomHeight/1e3-g/2,0):"bottom"==l?x.position.set(0,g/2,0):x.position.set(0,0,0),b.position.set(0,0,0),"load"!=a&&(b.position.set(9999,9999,9999),x.position.set(9999,9999,9999))),new(0,$4xklQ.TextureLoader)().load(s,e=>{(h=new $4xklQ.Mesh(new $4xklQ.PlaneBufferGeometry(1e3*u,1e3*w),new $4xklQ.MeshBasicMaterial({map:e,depthWrite:!1,transparent:!0,opacity:1}))).position.set(0,0,0),h.renderOrder=10,h.modelType="2DModel",""!=t&&(h.isLock=t.isLock,h.rotation.z=p,h.position.set(1e3*d.x,-(1e3*d.z),0),t.imgLayer&&(h.position.z=t.imgLayer),t.scale&&h.scale.set(t.scale.x,t.scale.z,t.scale.y)),o.add(h),h.modelId=x.uuid,h.param=[x],"load"!=a&&h.position.set(9999,9999,9999),r.camera.isOrthographicCamera||""!=t||h.position.set(1e4,1e4,1e4),b.modelUUID=h.uuid,new(0,$hu0fb.GLTFLoader)().load(n,function(e){(c=e.scene).traverse(function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)}),c.position.set(1e4,1e4,1e4),c.modelType="3DModel",c.modelPosition=l,c.floorHei=0;var o=new $4xklQ.Box3;o.setFromObject(c);var o=new $4xklQ.Box3;o.setFromObject(c);let y=1*(o.max.x-o.min.x).toFixed(2),P=1*(o.max.y-o.min.y).toFixed(2),v=1*(o.max.z-o.min.z).toFixed(2);c.width=y,c.height=P,c.depth=v,c.name=f,h.name=f,c.modelId=h.uuid,c.param=[h],c.imgPath=s,c.modelPath=n,h.width=1e3*y,h.height=1e3*v,h.depth=1e3*P,h.imgPath=s,h.modelPath=n,x.modelUUID=c.uuid,c.visible=x.visible,h.visible=x.visible,i.add(c);let M=s.split("/"),C=M[M.length-2];if(h.modelRealType=C,c.modelRealType=C,r.camera.isOrthographicCamera||""!=t||(c.modelId=b.uuid,c.param=[b]),y>m&&(c.scale.set(m/y,m/y,m/y),h.scale.set(m/y,m/y,m/y)),""!=t){c.position.set(d.x,d.y,d.z),c.isLock=t.isLock,c.rotation.y=p,t.rotate&&c.rotation.set(t.rotate.x,t.rotate.y,t.rotate.z),h.modelId=c.uuid,h.param=[c];let e={x:u/y,y:w/v,z:g/P};h.geometry=new $4xklQ.PlaneBufferGeometry(u/e.x*1e3,w/e.y*1e3),h.scale.set(e.x,e.y,e.z),c.scale.set(e.x,e.z,e.y),t.scale&&(c.scale.copy(t.scale),h.scale.set(t.scale.x,t.scale.z,t.scale.y));let i=r.getOuterParent(h);r.synchroModel(i),x.parent.remove(x),b.parent.remove(b)}"load"!=a&&(r.mouseCoverObj="",c.position.set(9999,9999,9999),c.param=[h],h.param=[c],x.parent.remove(x),b.parent.remove(b))})})}else new(0,$hu0fb.GLTFLoader)().load(n,function(e){(c=e.scene).traverse(function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)}),c.position.set(1e5,1e4,0),r.camera.isOrthographicCamera||""!=t||(r.mouseCoverObj=c),c.modelType="3DModel",c.modelPosition=l;var u=new $4xklQ.Box3;u.setFromObject(c);let g=1*(u.max.x-u.min.x).toFixed(2),w=1*(u.max.y-u.min.y).toFixed(2),y=1*(u.max.z-u.min.z).toFixed(2);c.scale.set(1,1,1),g>m&&c.scale.set(m/g,m/g,m/g),c.width=g,c.height=w,c.depth=y,c.floorHei=0,""!=d&&(c.position.set(d.x,d.y,d.z),c.rotation.y=p,t.rotate&&c.rotation.set(t.rotate.x,t.rotate.y,t.rotate.z),c.scale.set(t.width/g,t.height/w,t.depth/y)),c.modelPath=n,""!=t&&(c.isLock=t.isLock,t.scale&&c.scale.copy(t.scale)),i.add(c),new(0,$4xklQ.TextureLoader)().load(s,e=>{if(g*=1e3,y=1e3*(w=1e3*y),(h=new $4xklQ.Mesh(new $4xklQ.PlaneBufferGeometry(g,w),new $4xklQ.MeshBasicMaterial({map:e,depthWrite:!1,transparent:!0,opacity:1}))).position.set(1e5,1e4,0),h.renderOrder=10,r.camera.isOrthographicCamera&&""==t&&(r.mouseCoverObj=h),h.modelType="2DModel",h.width=1*g.toFixed(2),h.height=1*w.toFixed(2),h.depth=c.height,h.imgPath=s,h.modelPath=n,h.modelId=c.uuid,h.param=[c],c.modelId=h.uuid,c.param=[h],c.imgPath=s,c.name=f,h.name=f,o.add(h),""!=t){let e=new $4xklQ.Vector3(1e3*d.x,-(1e3*d.z),0);h.position.set(e.x,e.y,e.z),t.imgLayer&&(h.position.z=t.imgLayer),h.isLock=t.isLock,t.scale&&h.scale.set(t.scale.x,t.scale.z,t.scale.y),"bottom"==c.modelPosition?c.visible=r.config.settingJson.showFloorFurniture:"top"==c.modelPosition?c.visible=r.config.settingJson.showCeilFurniture:c.visible=r.config.settingJson.showWallFurniture,h.visible=c.visible}let i=r.getOuterParent(c);r.synchroModel(i),"load"!=a&&(r.mouseCoverObj="",c.position.set(9999,9999,9999))})})}}}),e.list.change2DWall.add(function(e){switch(e[0]){case"circle":case"bezier":r.list.changeWallType.dispatch(e[0]);break;case"split":r.list.splitWall.dispatch();break;case"del":r.list.delWall.dispatch()}}),e.list.changeWallParam.add(function(e,t,i=!1){if(""==r.clickSelect||""==r.clickSelect[0].object)return;let o=r.clickSelect[0].object;if(o.material.color=r.clickColor,"len"==e){if(1>Math.abs(Math.round(o.startPoint.clone().distanceTo(o.endPoint.clone()))-t)&&!i)return;let e=(0,$9HO6e.UtilCore).havePointWall(o.endPoint,r.allWalls).length>1,a=r.getWallHelperByWall(o);a&&r.removeHelperByWall(a),e?r.changeWallLength(o,t,"end"):r.changeWallLength(o,t,"start")}else"depth"==e?o.thickness=1*t:"wallType"==e?(r.execute(),o.style=t,1==o.style?o.height=1200:o.height=window.storeyHei,o.material.color=r.getWallColor(o),i=!0):(r.execute(),o.height=1*t);if(!i)return;if(new $523a84362d27c3e8$export$b680ca477a72be07(r).wallToJson(),"depth"==e){let e=r.getAllWindowInWall(o);e.length>0&&e.forEach(e=>{r.currentDoor=e,r.currenDraw=e,new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(r,"door","end",[1*t,0,"depth"]).execute(),r.doorHelperGroupClean(),r.currentDoor=""})}let a=(0,$9HO6e.UtilCore).getRealWallByPosition(o.startPoint,o.endPoint,r.allWalls);r.clickSelect[0].object=a,r.currentDownSelect&&0!=r.currentDownSelect.length&&(r.currentDownSelect[0].object=a),r.allWalls.forEach(e=>{e.material.color=r.getWallColor(e)}),r.clickSelect[0].object.material.color=r.clickColor}),e.list.change2DFloor.add(function(e){switch(e){case"copy":let t=r.clickSelect[0].object;r.copyFloorMaterial=t.material;break;case"replaceOneself":r.execute(),r.list.replaceSelfMat.dispatch();break;case"replaceAll":r.execute(),r.list.replaceAllMat.dispatch()}}),e.list.replaceSelfMat.add(function(){e.selectObjArr.forEach(e=>{if(1==e.material.color.r)e.material=new $4xklQ.MeshBasicMaterial({color:15264748,side:$4xklQ.DoubleSide,transparent:e.material.transparent,opacity:e.material.opacity});else{let t=new $4xklQ.TextureLoader().load("./static/assets/images/banner/floor.jpg");t.wrapS=$4xklQ.RepeatWrapping,t.wrapT=$4xklQ.RepeatWrapping,e.material=new $4xklQ.MeshBasicMaterial({map:t,transparent:e.material.transparent,opacity:e.material.opacity})}})}),e.list.replaceAllMat.add(function(){e.floorGroup2d.children.forEach(e=>{if(1==e.material.color.r)e.material=new $4xklQ.MeshBasicMaterial({color:15264748,side:$4xklQ.DoubleSide,transparent:e.material.transparent,opacity:e.material.opacity});else{let t=new $4xklQ.TextureLoader().load("./static/assets/images/banner/floor.jpg");t.wrapS=$4xklQ.RepeatWrapping,t.wrapT=$4xklQ.RepeatWrapping,e.material=new $4xklQ.MeshBasicMaterial({map:t,transparent:e.material.transparent,opacity:e.material.opacity})}})}),e.list.change2DDoor.add(function(e){switch(e[0]){case"reverse":r.list.reverseDoor.dispatch();break;case"replace":r.list.replaceDoor.dispatch();break;case"copy":r.list.copyDoor.dispatch();break;case"lock":r.doorSetLock();break;case"del":r.list.delDoor.dispatch()}}),e.list.changeDoorParam.add(function(e,t,i=!1){if(""==r.clickSelect||""==r.clickSelect[0].object||"depth"==e)return;r.removeInputByClassName(r.uiPanelBox.dom,"showDistance");let o="";if(r.camera.isOrthographicCamera)"CodeModel"==(o=r.clickSelect[0].object.parent).modelType&&(o=o.parameter.tdm);else{let e=r.getOuterParent(r.clickSelect[0].object);e&&e.parameter?(o=e.parameter.tdm,r.clickSelect[0].object.parent=o):o=r.clickSelect[0].object.parent}if(r.currentDoor=o,"height"==e||"floorHei"==e?o[e]=1*t:r.execute(new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(r,"door","end",[t,0,e,"noUpdate"],!1,"click"),"改变门尺寸"),r.camera.isOrthographicCamera||r.cleanWallHelper(),i){r.partRefreshWall(r.getWallById(o.wallId)),new $523a84362d27c3e8$export$b680ca477a72be07(r).wallToJson("3D"),r.cleanWallHelper(),r.camera.isOrthographicCamera&&r.addLineHelperForDoor(r.currentDoor,!0);let e=r.get3DWindowBy2dWindow(o);if(e||(e=r.get3DWindowBy2dWindow(r.clickSelect[0].object.parent)),e){r.modelHelperGroup.children=[];let t=new(0,$4xklQ.Box3)().setFromObject(e),i=r.wallHelp.addOBBbox(e,1735416);if(i.name="modelBox",i.layers.set(2),r.modelHelperGroup.add(i),i.material.depthTest=!1,e.parameter.box=i,"UWindowMesh"==e.type&&(i.position.y+=(t.max.y-t.min.y)/2),"LWindowMesh"==e.type){let e=new $4xklQ.Vector3;t.getCenter(e),i.position.copy(e.clone())}r.camera.isOrthographicCamera||(r.clickSelect[0].object.parent=e)}}if(r.camera.isOrthographicCamera){let e=document.getElementById("showDoorLength_start");e&&e.select()}}),e.list.change2DMember.add(function(e){switch(e[0]){case"copy":r.list.copyDoor.dispatch();break;case"lock":r.memberSetLock();break;case"del":r.list.delMember.dispatch()}}),e.list.changeMemberParam.add(function(e,t,i=!1){if(""==r.clickSelect||""==r.clickSelect[0].object)return;let o=r.clickSelect[0].object.parent,a="";r.camera.isOrthographicCamera?(o=r.clickSelect[0].object.parent,a=r.clickSelect[0].object.parent.threeD):(o=r.clickSelect[0].object.twoD,a=r.clickSelect[0].object),r.doorHelperGroupClean();let n=0;if("depth"==e){if(n=o.depth/a.scale.z,o[e]=1*t,i&&r.camera.isOrthographicCamera){new $523a84362d27c3e8$export$b680ca477a72be07(r).wallToJson();return}}else if("width"==e){let e=t/(1*o.width);o.scale.x=e}else if("height"==e){let e=t/(1*o.height);o.scale.y=e}else"rotation"==e&&(o.rotation.z=Math.PI/180*t);if(r.addLineHelperForMember(o),r.camera.isOrthographicCamera)r.synchroModel(o);else{let i=1,s=0;r.wallGroup3D.roomHeight&&(s=r.wallGroup3D.roomHeight),"depth"==e&&(i=t/n,"beam"==o.modelType?a.position.z=s-n/2-(t-n)/2:a.position.z=n/2+(t-n)/2),a.scale.set(o.scale.x,o.scale.y,i),a.rotation.z=o.rotation.z,r.modelHelperGroup.children=[],r.addBoxForGroup(a)}document.getElementById("showModelDistop")&&document.getElementById("showModelDistop").select()}),e.list.change2DModel.add(function(e){if(""!=r.clickSelect&&""!=r.clickSelect[0].object)switch(e[0]){case"topFloat":case"bottomFloat":r.modelFloat(e[0]);break;case"frontBackTurn":case"aroundTurn":r.modelReverse(e[0]);break;case"replace":r.modelReplace();break;case"copy":r.modelCopy();break;case"hidden":r.modelHidden();break;case"lock":r.modelSetLock();break;case"collect":case"del":r.list.delModel.dispatch();break;case"upload":r.exportModelImg();break;case"save":r.list.saveModel.dispatch()}}),e.list.change2DModelParam.add(function(e,t,i=!1){if(""==r.clickSelect||""==r.clickSelect[0].object)return;let o=r.getOuterParent(r.clickSelect[0].object),a=r.getOuterParent(r.clickSelect[0].object,r.clickSelect[0].object,"outer"),n=a,s=o;"2dModel"==a.parent.name?(o=o.param[0],n=a.param[0]):s=o.param[0],o.updateMatrixWorld(!0,!0);let l=r.getRealSize(o);if("size"==e){let e=o.height*o.scale.y;e=l[1],o.updateMatrixWorld(!0,!0);let i=new(0,$4xklQ.Vector3)().setFromMatrixScale(o.matrixWorld).clone().divide(o.scale),a=t[0]/o.width/1e3,n=t[2]/o.height/1e3,s=t[1]/o.depth/1e3;if(i=new(0,$4xklQ.Vector3)(a,n,s).divide(i),o.scale.copy(i),r.clickDepthMsg.uuid){let e=r.getOuterParent(o,o,"outer");r.refreshRealSizeByBox(e,o)}if(1!=n){let e=o.modelPosition;o.updateMatrixWorld(!0,!0);let t=r.getRealSize(o);o.updateMatrixWorld(!0,!0);let i=new(0,$4xklQ.Vector3)().setFromMatrixScale(o.matrixWorld).clone().divide(o.scale),a=(t[1]-l[1])/2/i.y;"top"==e?o.position.y-=a:o.position.y+=a}r.synchroModel(o)}else if("floorHei"==e){let e=new $4xklQ.Vector3(0,l[1]/2+t/1e3,0);o.parent.worldToLocal(e),o.position.y=e.y,s.groundHei=t/1e3}else"rotation"==e&&(t[0]=Math.PI/180*(360-t[0]),t[1]=Math.PI/180*t[1],t[2]=Math.PI/180*t[2],o.rotation.set(t[0],t[2],t[1]),r.synchroModel(o));r.doorHelperGroupClean(),r.modelHelperGroup.children.forEach(e=>{"Line2"==e.type&&e.parent.remove(e)}),r.addBoxForGroup(o),r.addLineHelperForMember(s),r.refreshRealSizeByBox(n,o),r.updateModelPosition(o.parent,n),document.getElementById("showModelDistop")&&document.getElementById("showModelDistop").select()}),e.list.change3DDoor.add(function(e){if(""==r.clickSelect||""==r.clickSelect[0].object)return;let t=r.getOuterParent(r.clickSelect[0].object),i=t.parameter.tdm;switch(e[0]){case"reverse":if("LWindow"==i.modelType||"UWindow"==i.modelType)return;t.parameter.box.parent&&t.parameter.box.parent.remove(t.parameter.box),"door"==i.modelType||"childMotherDoor"==i.modelType?(r.currentDoor=i,r.execute(new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(r,"door","end",[0,0,"angle"],!0,"click"),"翻转"),r.doorHelperGroupClean(),r.clickSelect[0].object=r.currentDoor.parameter[0],t=r.clickSelect[0].object):(t.rotation.y+=Math.PI,i.rotation.z+=Math.PI),r.transform3DTool.selectObj(t);break;case"lock":r.doorSetLock();break;case"replace":case"collect":break;case"copy":r.door3DCopy();break;case"del":if(t.isLock){r.list.alert.dispatch("模型已锁定,请先解锁","warning");return}r.execute(),t.parent.remove(t),r.removeDoor(i);let o=r.getWallById(i.wallId);r.partRefreshWall(o),r.removeInputByClassName(r.uiPanelBox.dom,"showDistance"),t.parameter.box&&t.parameter.box.parent.remove(t.parameter.box),r.transform3DTool&&"ThreeDimensionMoveHelper"==r.transform3DTool.name&&r.transform3DTool.removeBox(),r.list.hiddenDialog.dispatch()}}),e.list.change3DModel.add(function(e){switch(e[0]){case"scale":r.transform3DTool.useTranslate(!1).useScale(!0).useRotate(!1).switchMove(!1);break;case"moveAndRotation":r.transform3DTool.useScale(!1).useRotate(!0).useTranslate(!0).switchMove(!0);break;case"rotation":r.transform3DTool.useTranslate(!1).useScale(!1).switchRot(!0).switchMove(!1);break;case"move":case"replaceMaterial":case"array":case"collection":break;case"replace":r.modelReplace();break;case"frontBackTurn":case"aroundTurn":r.modelReverse(e[0]);break;case"copy":r.modelCopy();break;case"lock":r.modelSetLock();break;case"hidden":r.modelHidden();break;case"del":r.list.delModel.dispatch();break;case"makeGroup":r.list.makeGroup.dispatch();break;case"explodeGroup":r.list.explodeGroup.dispatch();break;case"upload":r.exportModelImg();break;case"save":r.list.saveModel.dispatch();break;case"frontAligning":case"rearAligning":case"leftAligning":case"rightAligning":case"topAligning":case"bottomAligning":case"frontAndBackAligning":case"leftRightAligning":case"topBottomAligning":r.execute();let t=[],i=r.selectObjArr.slice(0);r.camera.isOrthographicCamera?i.forEach(e=>{t.push(r.get3DModelBy2DModel(r.getOuterParent(e)))}):i.forEach(e=>{t.push(r.getOuterParent(e))}),r.modelAlign(e[0],t)}}),r.list.setRoomOpacity.add(e=>{"opacity"==e[0]?(window.roomOpacity=e[1]/100,r.floorGroup2d.children.forEach(e=>{e.material.transparent=!0,e.material.opacity=roomOpacity}),r.floorGroup.children.forEach(e=>{e.roomName&&(e.material.transparent=!0,e.material.opacity=roomOpacity)}),r.allWalls.forEach(e=>{e.material.transparent=!0,e.material.opacity=roomOpacity}),r.wallGroup3D.children.forEach(e=>{"3DWall"==e.modelType&&(e.material.transparent=!0,e.material.opacity=roomOpacity)})):"floorHeight"==e[0]?(window.storeyHei=1*e[1],r.allWalls.forEach(e=>{e.height=window.storeyHei}),new $523a84362d27c3e8$export$b680ca477a72be07(r).wallToJson()):"levelPly"==e[0]&&(window.floorDep=1*e[1],r.floorGroup.children.forEach(e=>{e.roomName&&e.refresh()}))}),r.list.showRenderView.add(()=>{if(0==r.floorGroup.children.length){let e="温馨提示",t="请先绘制一个封闭户型";r.list.dialog.dispatch(e,t,[""])}else r.list.renderURL.dispatch()}),r.list.initRenderMain.add(e=>{r.openRenderScene=!0,new $7ed6d163147eea6e$export$267a13440f7c79db(e[0][0]),new $ad8bf51027a12264$export$10707adaaf0119d6(e[1][0]),new $93515037b4aa0d1f$export$7da8f54b9c0f630c(e[2])}),r.list.renderCameraSize.add(e=>{let t=window.innerHeight-110,i=t*e[0]/e[1],o=window.innerWidth/2-i/2,a=window.innerHeight/2-t/2;i>window.innerWidth-650&&(t=(i=window.innerWidth-650)*e[1]/e[0],o=window.innerWidth/2-i/2+30,a=window.innerHeight/2-t/2),r.list.cameraShot.dispatch(i,t,o,a,!0)}),r.list.changRenderCameraInput.add((e,t)=>{if("height"==e)t=t.toString().replace("mm",""),r.renderViewCamera.position.y=t/1e3,r.renderViewControl.target.y=t/1e3;else{1*(t=t.toString().replace("\xb0",""))>=-5&&1*t<=5&&(t=0);let e=t*Math.PI/180;e>Math.PI/2&&(e=Math.PI/2),e<-Math.PI/2&&(e=-Math.PI/2);let o=r.getRenderCameraAngle();if(isNaN(o))return;o*=Math.PI/180,e-=o;var i=new $4xklQ.Vector3;r.renderViewCamera.getWorldDirection(i);let a=-r.renderViewCamera.position.clone().distanceTo(i)*Math.sin(e);r.renderViewControl.target.y+=a}r.renderViewCamera.updateProjectionMatrix(),r.renderViewControl.update()}),r.list.deleteForMobile.add(e=>{r.execute(),(0,$47Y2g.MobileMain).delMain(e)})}}const $17e0b9c8fbcffc37$var$Signal=signals.Signal;class $17e0b9c8fbcffc37$export$40d7e39b924588a0{constructor(){this.list={pluginList:new $17e0b9c8fbcffc37$var$Signal,activeTool:new $17e0b9c8fbcffc37$var$Signal,sceneInit:new $17e0b9c8fbcffc37$var$Signal,showDialog:new $17e0b9c8fbcffc37$var$Signal,hiddenDialog:new $17e0b9c8fbcffc37$var$Signal,importMap:new $17e0b9c8fbcffc37$var$Signal,changeWallType:new $17e0b9c8fbcffc37$var$Signal,splitWall:new $17e0b9c8fbcffc37$var$Signal,delWall:new $17e0b9c8fbcffc37$var$Signal,changeCameraSlider:new $17e0b9c8fbcffc37$var$Signal,changeWallParam:new $17e0b9c8fbcffc37$var$Signal,changeDoorParam:new $17e0b9c8fbcffc37$var$Signal,changeMemberParam:new $17e0b9c8fbcffc37$var$Signal,delDoor:new $17e0b9c8fbcffc37$var$Signal,delMember:new $17e0b9c8fbcffc37$var$Signal,delModel:new $17e0b9c8fbcffc37$var$Signal,reverseDoor:new $17e0b9c8fbcffc37$var$Signal,replaceDoor:new $17e0b9c8fbcffc37$var$Signal,copyDoor:new $17e0b9c8fbcffc37$var$Signal,changeCamera:new $17e0b9c8fbcffc37$var$Signal,createRoom:new $17e0b9c8fbcffc37$var$Signal,startPlayer:new $17e0b9c8fbcffc37$var$Signal,stopPlayer:new $17e0b9c8fbcffc37$var$Signal,setViewportCamera:new $17e0b9c8fbcffc37$var$Signal,viewportCameraChanged:new $17e0b9c8fbcffc37$var$Signal,executeTool:new $17e0b9c8fbcffc37$var$Signal,useModel:new $17e0b9c8fbcffc37$var$Signal,drawRoomChangeth:new $17e0b9c8fbcffc37$var$Signal,smartRoom:new $17e0b9c8fbcffc37$var$Signal,undo:new $17e0b9c8fbcffc37$var$Signal,redo:new $17e0b9c8fbcffc37$var$Signal,saveScene:new $17e0b9c8fbcffc37$var$Signal,saveEvent:new $17e0b9c8fbcffc37$var$Signal,removeAll:new $17e0b9c8fbcffc37$var$Signal,changeTheme:new $17e0b9c8fbcffc37$var$Signal,changeModel:new $17e0b9c8fbcffc37$var$Signal,createMap:new $17e0b9c8fbcffc37$var$Signal,exportGLTF:new $17e0b9c8fbcffc37$var$Signal,exitRomaScene:new $17e0b9c8fbcffc37$var$Signal,alert:new $17e0b9c8fbcffc37$var$Signal,loadGltf:new $17e0b9c8fbcffc37$var$Signal,default2D:new $17e0b9c8fbcffc37$var$Signal,resetCamera:new $17e0b9c8fbcffc37$var$Signal,splitTool:new $17e0b9c8fbcffc37$var$Signal,delSplitLine:new $17e0b9c8fbcffc37$var$Signal,dialog:new $17e0b9c8fbcffc37$var$Signal,blackBox:new $17e0b9c8fbcffc37$var$Signal,threeDimensions:new $17e0b9c8fbcffc37$var$Signal,setRoomType:new $17e0b9c8fbcffc37$var$Signal,switchBounced:new $17e0b9c8fbcffc37$var$Signal,footerView:new $17e0b9c8fbcffc37$var$Signal,makeGroup:new $17e0b9c8fbcffc37$var$Signal,explodeGroup:new $17e0b9c8fbcffc37$var$Signal,modelGroup3D:new $17e0b9c8fbcffc37$var$Signal,setScaleTool:new $17e0b9c8fbcffc37$var$Signal,hiddenMap:new $17e0b9c8fbcffc37$var$Signal,delMap:new $17e0b9c8fbcffc37$var$Signal,baseMap:new $17e0b9c8fbcffc37$var$Signal,doCallback:new $17e0b9c8fbcffc37$var$Signal,change2DWall:new $17e0b9c8fbcffc37$var$Signal,change2DModel:new $17e0b9c8fbcffc37$var$Signal,change3DModel:new $17e0b9c8fbcffc37$var$Signal,change2DMember:new $17e0b9c8fbcffc37$var$Signal,change2DModelParam:new $17e0b9c8fbcffc37$var$Signal,change2DDoor:new $17e0b9c8fbcffc37$var$Signal,change3DDoor:new $17e0b9c8fbcffc37$var$Signal,themeSwitch:new $17e0b9c8fbcffc37$var$Signal,exitTool:new $17e0b9c8fbcffc37$var$Signal,resetproperty:new $17e0b9c8fbcffc37$var$Signal,showHiddenHelper:new $17e0b9c8fbcffc37$var$Signal,getShowHiddenFlag:new $17e0b9c8fbcffc37$var$Signal,change2DFloor:new $17e0b9c8fbcffc37$var$Signal,replaceSelfMat:new $17e0b9c8fbcffc37$var$Signal,replaceAllMat:new $17e0b9c8fbcffc37$var$Signal,saveModel:new $17e0b9c8fbcffc37$var$Signal,uploadFile:new $17e0b9c8fbcffc37$var$Signal,saveModelRecord:new $17e0b9c8fbcffc37$var$Signal,loadGLTFJson:new $17e0b9c8fbcffc37$var$Signal,popupSaveRecord:new $17e0b9c8fbcffc37$var$Signal,modelReplace:new $17e0b9c8fbcffc37$var$Signal,replaceGltf:new $17e0b9c8fbcffc37$var$Signal,closeReplaceView:new $17e0b9c8fbcffc37$var$Signal,progressOpen:new $17e0b9c8fbcffc37$var$Signal,progressChange:new $17e0b9c8fbcffc37$var$Signal,progressClose:new $17e0b9c8fbcffc37$var$Signal,GPURender:new $17e0b9c8fbcffc37$var$Signal,saveWallModel:new $17e0b9c8fbcffc37$var$Signal,recoveryScene:new $17e0b9c8fbcffc37$var$Signal,saveWallJson:new $17e0b9c8fbcffc37$var$Signal,setRoomOpacity:new $17e0b9c8fbcffc37$var$Signal,viewRoomOpacity:new $17e0b9c8fbcffc37$var$Signal,setDefaultParams:new $17e0b9c8fbcffc37$var$Signal,uploadModelBar:new $17e0b9c8fbcffc37$var$Signal,changeBar:new $17e0b9c8fbcffc37$var$Signal,closeBar:new $17e0b9c8fbcffc37$var$Signal,cameraShot:new $17e0b9c8fbcffc37$var$Signal,closeCameraShot:new $17e0b9c8fbcffc37$var$Signal,initRenderMain:new $17e0b9c8fbcffc37$var$Signal,renderCameraSize:new $17e0b9c8fbcffc37$var$Signal,horizontalLine:new $17e0b9c8fbcffc37$var$Signal,deleteLine:new $17e0b9c8fbcffc37$var$Signal,renderURL:new $17e0b9c8fbcffc37$var$Signal,showRenderView:new $17e0b9c8fbcffc37$var$Signal,changRenderCameraInput:new $17e0b9c8fbcffc37$var$Signal,updateDialog:new $17e0b9c8fbcffc37$var$Signal,getVersionNumber:new $17e0b9c8fbcffc37$var$Signal,dragRoomForMobile:new $17e0b9c8fbcffc37$var$Signal,dragWallForMobile:new $17e0b9c8fbcffc37$var$Signal,deleteForMobile:new $17e0b9c8fbcffc37$var$Signal}}}class $b4910821f3d67218$var$Main{constructor(){var e=new $17e0b9c8fbcffc37$export$40d7e39b924588a0;window.editor=e;var t=navigator.userAgent,i=/mobile/i.test(t);e.list.pluginList.add(function(){let t=Object.getPrototypeOf(new $d7301d69748e22e3$export$dea64c44705995a5);for(let i of Object.getOwnPropertyNames(t).filter(e=>"constructor"!==e))e[i]=t[i];i?(window.url="https://rjhcdn.bsphpro.com/ocean/static",new $9decf90ebae5e35e$export$8642042a8635463d(e),e.list.sceneInit.dispatch(document.getElementsByClassName("canvas_box")[0],"mobile")):parcelRequire("ajbOv").then(({Editor:t})=>{new t,new $9decf90ebae5e35e$export$8642042a8635463d(e),e.list.sceneInit.dispatch(document.getElementById("box"))})})}}new $b4910821f3d67218$var$Main;