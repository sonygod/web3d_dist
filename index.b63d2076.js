function $parcel$export(e,t,i,r){Object.defineProperty(e,t,{get:i,set:r,enumerable:!0,configurable:!0})}var $parcel$global="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},$parcel$modules={},$parcel$inits={},parcelRequire=$parcel$global.parcelRequire94c2;null==parcelRequire&&(parcelRequire=function(e){if(e in $parcel$modules)return $parcel$modules[e].exports;if(e in $parcel$inits){var t=$parcel$inits[e];delete $parcel$inits[e];var i={id:e,exports:{}};return $parcel$modules[e]=i,t.call(i.exports,i,i.exports),i.exports}var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r},parcelRequire.register=function(e,t){$parcel$inits[e]=t},$parcel$global.parcelRequire94c2=parcelRequire),parcelRequire.register("dRo73",(function(e,t){var i,r;$parcel$export(e.exports,"register",(()=>i),(e=>i=e)),$parcel$export(e.exports,"resolve",(()=>r),(e=>r=e));var n={};i=function(e){for(var t=Object.keys(e),i=0;i<t.length;i++)n[t[i]]=e[t[i]]},r=function(e){var t=n[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),parcelRequire.register("5XTH3",(function(module,exports){$parcel$export(module.exports,"DrawWallTool",(()=>DrawWallTool));var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ"),$9HO6e=parcelRequire("9HO6e"),$ia4Lh=parcelRequire("ia4Lh"),$7WCxl=parcelRequire("7WCxl"),$g4HAh=parcelRequire("g4HAh"),$6Hryq=parcelRequire("6Hryq"),$2C75G=parcelRequire("2C75G");parcelRequire("hrM0U");class DrawWallTool{constructor(e=""){this.btmFaceList=[],this.imagePath="./assets/img/banner/uvGrid.jpg",this.imagePath="../../../../static/assets/images/banner/uvGrid.jpg",this.material=""==e?new $4xklQ.MeshBasicMaterial({color:"#363636",side:$4xklQ.DoubleSide,transparent:!0,opacity:.8}):e,this.reset()}create2DWallAAA(e,t=[]){this.btmFaceList=t;let i=[];for(let t=0;t<e.length;t++){let r,n=e[t],o=new $4xklQ.Vector2(n.start.x,n.start.y),a=new $4xklQ.Vector2(n.end.x,n.end.y);if(n.isArc){let e,t,r=o.clone().add(a).divideScalar(2),s=o.distanceTo(r),l=(this.findCrossFace2(o,a),new $4xklQ.Vector2(o.x,o.y)),c=new $4xklQ.Vector2(a.x,a.y),h=l.clone().sub(r).angle(),d=c.clone().sub(r).angle();"down"==n.direction?l.x>=c.x?(e=d,t=h):(e=h,t=d):l.x<=c.x?(e=d,t=h):(e=h,t=d);let u=new $4xklQ.Path;u.arc(r.x,r.y,s,e,t,!1);let p=Math.round(Math.PI/Math.asin(n.thickness/2/(s+n.thickness/2))/2),m=u.getPoints(p),f=[];for(let e=0;e<m.length-1;e++){let t=new $4xklQ.Vector2(parseFloat(Number(m[e].x).toFixed(10)),parseFloat(Number(m[e].y).toFixed(10))),i=new $4xklQ.Vector2(parseFloat(Number(m[e+1].x).toFixed(10)),parseFloat(Number(m[e+1].y).toFixed(10))),r=this.createBottomFace(t,i,n.line,n.thickness);r.startPoint=t,r.endPoint=i,r.direction=n.direction,r.useType="wall",this.recordInfo(r,n),f.push(r),this.btmFaceList.push(r),this.handleIntersect2(r)}i.push(f)}else r=this.createBottomFace(o.clone(),a.clone(),n.line,n.thickness),r.startPoint=o,r.endPoint=a,r.useType="wall",this.recordInfo(r,n),this.handleIntersectNew(r),this.btmFaceList.push(r)}for(let e=0;e<i.length;e++){let t=i[e],r=this.mergeArcFace(t);this.btmFaceList.splice(this.btmFaceList.indexOf(t[0]),t.length),this.btmFaceList.push(r)}return this.btmFaceList}createCircle(e){let t=new $4xklQ.SphereGeometry(50),i=new $4xklQ.Mesh(t,new $4xklQ.MeshBasicMaterial({color:16711680}));return i.position.copy(e),i}create2DWall(e,t=[],i=!1){window.performance.now();this.btmFaceList=t;return this.btmFaceList=$2C75G.WallCreator.create2DWall(e),this.stroke(),this.btmFaceList}stroke(){let e=[];for(let t=0;t<this.btmFaceList.length;t++){this.btmFaceList[t].origin2DWall=this.btmFaceList[t].clone();let i=new $4xklQ.Group,r=Array.from(this.btmFaceList[t].geometry.attributes.position.array),n=[],o=[];for(let e=0;e<r.length/9;e++)n.push(new $4xklQ.Vector2(r[9*e],r[9*e+1])),o.push(new $4xklQ.Vector2(r[3*(3*e+2)],r[3*(3*e+2)+1]));let a=this.createLine(n,0),s=this.createLine(o,0);i.add(a,s),i.wallID=this.btmFaceList[t].wallID,e.push(i)}this.btmFaceList.push(e)}createLine(e,t=0,i=!1){let r=[];e.forEach((e=>{r.push(e.x,e.y,0)}));var n=(new(0,$g4HAh.LineGeometry)).setPositions(r),o=new(0,$7WCxl.LineMaterial)({color:t,linewidth:1,dashed:i,transparent:!0});o.resolution.set(window.innerWidth,window.innerHeight);var a=new(0,$ia4Lh.Line2)(n,o);return a.renderOrder=100,a.computeLineDistances(),a}itemInArr(e,t){let i=new $4xklQ.Vector2(e.start.x,e.start.y),r=new $4xklQ.Vector2(e.end.x,e.end.y);for(let e=0;e<t.length;e++)if(i.equals(t[e])||r.equals(t[e]))return!0}removeSingleLine(e){let t=[];for(let i=0;i<e.length;i++){let r=0,n=0,o=new $4xklQ.Vector2(e[i].start.x,e[i].start.y),a=new $4xklQ.Vector2(e[i].end.x,e[i].end.y);for(let t=0;t<e.length;t++)if(i!==t){let i=new $4xklQ.Vector2(e[t].start.x,e[t].start.y),s=new $4xklQ.Vector2(e[t].end.x,e[t].end.y);(o.equals(i)||o.equals(s))&&r++,(a.equals(i)||a.equals(s))&&n++}0!=r&&0!=n||t.push(e[i])}for(let i=0;i<t.length;i++)this.delete(e,t[i])}detectClosedGraph(e){for(let t=0;t<e.length;t++){e[t].startPoint;let i=e[t].endPoint,r=[e[t]];this.getNextLine(i,r,e)}}getIntersectLine(e,t){let i=[],r=[];for(let n=0;n<t.length;n++){let o=t[n];if(o.startPoint.equals(e)){i.push(o);let t=o.endPoint.clone().sub(e).angle();r.push(t)}if(o.endPoint.equals(e)){i.push(o);let t=o.startPoint.clone().sub(e).angle();r.push(t)}}return[i,r]}getNextLine(e,t,i){let r=t[t.length-1],n=this.getIntersectLine(e,i),o=n[0],a=n[1],s=this.getLineAngle(e,r)[0];this.delete(o,r),this.delete(a,s);for(let e=0;e<a.length;e++)s>a[e]&&(a[e]+=2*Math.PI);for(let i=0;i<o.length;i++){let r=o[i],n=this.getLineAngle(e,r),l=n[0],c=n[1];l<s&&(l+=2*Math.PI);let h=this.checkBetweenAngle(a,s,l,"inner");if(Math.abd(l-s)>=Math.PI){this.checkBetweenAngle(a,s,l,"outer")}else h||(t.push(r),t.length>2&&c.equals(t[0].startPoint)&&this.graphArr.push(t))}}getLineAngle(e,t){let i=e.equals(t.startPoint)?t.endPoint:t.startPoint;return[i.clone().sub(e).angle(),i]}getNextLine2(e,t,i,r){let n,o=t[t.length-1],a=t[0].startPoint;i.equals(o.startPoint)?n=o.endPoint.clone().sub(i).angle():i.equals(o.endPoint)&&(n=o.startPoint.clone().sub(i).angle());let s,l=!1,c=[];for(let t=0;t<e.length;t++){let r,o=e[t];i.equals(o.startPoint)?(r=o.endPoint.clone().sub(i).angle(),r<n&&(r+=2*Math.PI),this.checkBetweenAngle(c,n,r,"inner")||(s=o,l=o.endPoint)):i.equals(o.endPoint)&&(r=o.startPoint.clone().sub(i).angle(),r<n&&(r+=2*Math.PI),this.checkBetweenAngle(c,n,r,"inner")||(s=o,l=o.startPoint)),c.push(r)}return!!l&&(l.equals(a)?t:(t.push(s),[t,l]))}mergeArcFace(e){let t=[],i=[];for(let r=0;r<e.length;r++){let n=Array.from(e[r].geometry.attributes.position.array);for(let e=0;e<9;e++)t.push(n[e]);if(r==e.length-1)for(let e=9;e<18;e++)t.push(n[e]);i.push(3*r,3*r+3,3*r+4,3*r+1,3*r,3*r+4,3*r+1,3*r+4,3*r+5,3*r+2,3*r+1,3*r+5)}let r=this.createMesh(t,i,e[0].material);return this.recordInfo(r,e[0]),r.wallID=e[0].wallID,r.arcCenter=e[0].arcCenter,r.cp=e[0].cp,r}getFacePoints(e){e.updateWorldMatrix(!0,!1);let t=e.geometry.attributes.position.array,i=[];for(let r=0;r<t.length/3;r++)i.push(e.localToWorld(new $4xklQ.Vector3(t[3*r],t[3*r+1],t[3*r+2])));return i}handleIntersect(e){let t=e.startPoint,i=e.endPoint,r=this.findCrossFaceByPoint(t,i),n=r[0],o=r[1];console.log("cross - start - end",n,o);let a=this.getLineData(this.facePoints[0],this.facePoints[3]),s=this.getLineData(this.facePoints[2],this.facePoints[5]);if(n.length>0){let r=[];if(n.length>1)for(let e=0;e<n.length;e++){let i,o=n[e].startPoint,a=n[e].endPoint;o.equals(t)?i=a.clone().sub(t):a.equals(t)&&(i=o.clone().sub(t)),r.push(i.angle())}if(r.length>1){let o=i.clone().sub(t).angle();for(let i=0;i<n.length;i++){let l,c,h,d,u,p,m,f,g,x,b,y=n[i],w=y.startPoint,v=y.endPoint,$=this.getAllPoints(y),M=this.getLineData($[0],$[3]),S=this.getLineData($[2],$[5]);if(w.equals(t)?(l=v.clone().sub(t).angle(),d=a,u=S,f=0,g=2,p=s,m=M,x=2,b=0):v.equals(t)&&(l=w.clone().sub(t).angle(),c=this.checkBetweenAngle(r,o,l,"inner"),h=this.checkBetweenAngle(r,o,l,"outer"),d=a,u=M,f=0,g=3,p=s,m=S,x=2,b=5),c=this.checkBetweenAngle(r,o,l,"inner"),h=this.checkBetweenAngle(r,o,l,"outer"),o<l)if(c){if(!h){let i=this.computeIntersectPoint(p,m,t);i&&i.distanceTo(t)<2e3&&this.updateVertex(e,x,i),i&&i.distanceTo(t)<2e3&&this.updateVertex(y,b,i)}}else{let i=this.computeIntersectPoint(d,u,t);i&&i.distanceTo(t)<2e3&&this.updateVertex(e,f,i),i&&i.distanceTo(t)<2e3&&this.updateVertex(y,g,i)}else if(c){if(!h){let i=this.computeIntersectPoint(d,u,t);i&&i.distanceTo(t)<2e3&&this.updateVertex(e,f,i),i&&i.distanceTo(t)<2e3&&this.updateVertex(y,g,i)}}else{let i=this.computeIntersectPoint(p,m,t);i&&i.distanceTo(t)<2e3&&this.updateVertex(e,x,i),i&&i.distanceTo(t)<2e3&&this.updateVertex(y,b,i)}}}else{let r=n[0],o=r.startPoint,l=r.endPoint,c=this.getAllPoints(r);if(e.isArc&&!r.isArc){let r,n=i.clone().sub(t).angle();if(o.equals(t)){if(r=l.clone().sub(t).angle(),Math.abs(n-r)<Math.PI/2)return this.updateVertex(e,0,c[0]),void this.updateVertex(e,2,c[2])}else if(l.equals(t)&&(r=o.clone().sub(t).angle(),Math.abs(n-r)<Math.PI/2))return this.updateVertex(e,0,c[5]),void this.updateVertex(e,2,c[3])}let h,d,u=this.getLineData(c[0],c[3]),p=this.getLineData(c[2],c[5]);o.equals(t)?(h=this.computeIntersectPoint(a,p,t),d=this.computeIntersectPoint(s,u,t),h&&h.distanceTo(t)<2e3&&this.updateVertex(r,2,h),d&&d.distanceTo(t)<2e3&&this.updateVertex(r,0,d)):l.equals(t)&&(h=this.computeIntersectPoint(a,u,t),d=this.computeIntersectPoint(s,p,t),h&&h.distanceTo(t)<2e3&&this.updateVertex(r,3,h),d&&d.distanceTo(t)<2e3&&this.updateVertex(r,5,d)),h&&h.distanceTo(t)<2e3&&this.updateVertex(e,0,h),d&&d.distanceTo(t)<2e3&&this.updateVertex(e,2,d)}}if(o.length>0){let r=[];if(o.length>1)for(let e=0;e<o.length;e++){let t,n=o[e].startPoint,a=o[e].endPoint;n.equals(i)?t=a.clone().sub(i):a.equals(i)&&(t=n.clone().sub(i)),r.push(t.angle())}if(r.length>1){let n=t.clone().sub(i).angle();for(let t=0;t<o.length;t++){let l,c,h,d,u,p,m,f,g,x,b,y=o[t],w=y.startPoint,v=y.endPoint,$=this.getAllPoints(y),M=this.getLineData($[0],$[3]),S=this.getLineData($[2],$[5]);if(w.equals(i)?(l=v.clone().sub(i).angle(),d=s,u=S,f=5,g=2,p=a,m=M,x=3,b=0):v.equals(i)&&(l=w.clone().sub(i).angle(),d=s,u=M,f=5,g=3,p=a,m=S,x=3,b=5),c=this.checkBetweenAngle(r,n,l,"inner"),h=this.checkBetweenAngle(r,n,l,"outer"),n<l)if(c){if(!h){let t=this.computeIntersectPoint(p,m,i);t&&t.distanceTo(i)<2e3&&this.updateVertex(e,x,t),t&&t.distanceTo(i)<2e3&&this.updateVertex(y,b,t)}}else{let t=this.computeIntersectPoint(d,u,i);t&&t.distanceTo(i)<2e3&&this.updateVertex(e,f,t),t&&t.distanceTo(i)<2e3&&this.updateVertex(y,g,t)}else if(c){if(!h){let t=this.computeIntersectPoint(d,u,i);t&&t.distanceTo(i)<2e3&&this.updateVertex(e,f,t),t&&t.distanceTo(i)<2e3&&this.updateVertex(y,g,t)}}else{let t=this.computeIntersectPoint(p,m,i);t&&t.distanceTo(i)<2e3&&this.updateVertex(e,x,t),t&&t.distanceTo(i)<2e3&&this.updateVertex(y,b,t)}}}else{let r=o[0],n=r.startPoint,l=r.endPoint,c=this.getAllPoints(r);if(e.isArc&&!r.isArc){console.log("endCross - btm arc");let r,o=t.clone().sub(i).angle();if(n.equals(i)){if(r=l.clone().sub(i).angle(),Math.abs(o-r)<Math.PI/2)return this.updateVertex(e,5,c[0]),void this.updateVertex(e,3,c[2])}else if(l.equals(i)&&(r=n.clone().sub(i).angle(),Math.abs(o-r)<Math.PI/2))return this.updateVertex(e,5,c[5]),void this.updateVertex(e,3,c[3])}let h,d,u=this.getLineData(c[0],c[3]),p=this.getLineData(c[2],c[5]);n.equals(i)?(h=this.computeIntersectPoint(a,u,i),d=this.computeIntersectPoint(s,p,i),h&&h.distanceTo(i)<2e3&&this.updateVertex(r,0,h),d&&d.distanceTo(i)<2e3&&this.updateVertex(r,2,d)):l.equals(i)&&(h=this.computeIntersectPoint(a,p,i),d=this.computeIntersectPoint(s,u,i),h&&h.distanceTo(i)<2e3&&this.updateVertex(r,5,h),d&&d.distanceTo(i)<2e3&&this.updateVertex(r,3,d)),h&&h.distanceTo(i)<2e3&&this.updateVertex(e,3,h),d&&d.distanceTo(i)<2e3&&this.updateVertex(e,5,d)}}}handleIntersectNew(e){let t=this.findCrossFace(e);if(t.length>0){let i=e.startPoint,r=e.endPoint,n=this.getLineData(this.facePoints[0],this.facePoints[3]),o=(this.getLineData(this.facePoints[1],this.facePoints[4]),this.getLineData(this.facePoints[2],this.facePoints[5]));for(let a=0;a<t.length;a++){let s=t[a],l=s.startPoint,c=s.endPoint,h=!1,d=[];for(let e=0;e<t.length;e++)if(s!==t[e]&&this.whetherCross(l,c,t[e])){let n=this.whetherCross2(l,c,t[e]),o=this.whetherCross2(i,r,t[e]);if(n.equals(o)){let i;h=!0,n.equals(t[e].startPoint)?i=t[e].endPoint.clone().sub(n):n.equals(t[e].endPoint)&&(i=t[e].startPoint.clone().sub(n)),d.push(i.angle())}}let u,p,m,f,g,x,b,y,w,v,$,M=this.getFacePoints(s),S=this.getLineData(M[0],M[3]),P=(this.getLineData(M[1],M[4]),this.getLineData(M[2],M[5]));i.equals(c)?(v=r.clone().sub(i),$=l.clone().sub(c),u=i,p=n,m=S,f=0,g=3,x=o,b=P,y=2,w=5):i.equals(l)?(v=r.clone().sub(i),$=c.clone().sub(l),u=i,p=n,m=P,f=0,g=2,x=o,b=S,y=2,w=0):r.equals(c)?(v=i.clone().sub(r),$=l.clone().sub(c),u=r,p=o,m=S,f=5,g=3,x=n,b=P,y=3,w=5):r.equals(l)&&(v=i.clone().sub(r),$=c.clone().sub(l),u=r,p=o,m=P,f=5,g=2,x=n,b=S,y=3,w=0);let k=v.angle(),_=$.angle();if(h){let t=this.checkBetweenAngle(d,k,_,"inner"),i=this.checkBetweenAngle(d,k,_,"outer");if(k<_)if(t){if(!i){let t=this.computeIntersectPoint(x,b,u);this.updateVertex(e,y,t),this.updateVertex(s,w,t)}}else{let t=this.computeIntersectPoint(p,m,u);this.updateVertex(e,f,t),this.updateVertex(s,g,t)}else if(t){if(!i){let t=this.computeIntersectPoint(p,m,u);this.updateVertex(e,f,t),this.updateVertex(s,g,t)}}else{let t=this.computeIntersectPoint(x,b,u);this.updateVertex(e,y,t),this.updateVertex(s,w,t)}}else{let t=this.computeIntersectPoint(p,m,u);this.updateVertex(e,f,t),this.updateVertex(s,g,t);let i=this.computeIntersectPoint(x,b,u);this.updateVertex(e,y,i),this.updateVertex(s,w,i)}}}}checkBetweenAngle(e,t,i,r){let n=Math.min(t,i),o=Math.max(t,i);for(let t=0;t<e.length;t++){if("inner"==r&&e[t]>n&&e[t]<o)return!0;if("outer"==r&&(e[t]<n||e[t]>o))return!0}return!1}checkAndUpdate(e,t,i,r,n,o,a){let s=this.getFacePoints(a);e?this.checkLegitimacy(t,s[i],s[i+3])&&(this.updateVertex(a,r,t),this.updateVertex(o,n,t)):(this.updateVertex(a,r,t),this.updateVertex(o,n,t))}checkAndUpdate2(e,t,i,r,n,o,a,s=!1){let l=this.getFacePoints(a);if(s){let s=this.checkLegitimacy(e,l[t],l[t+3]),c=this.checkLegitimacy(e,this.facePoints[i],this.facePoints[i+3]);s&&c&&(this.updateVertex(a,r,e),this.updateVertex(o,n,e))}else this.updateVertex(a,r,e),this.updateVertex(o,n,e)}handleIntersect2(e){let t=e.startPoint,i=e.endPoint,r=this.findCrossFace2(t,i);if(r.splice(r.indexOf(e),1),r.length>0)for(let n=0;n<r.length;n++){let o,a,s,l=r[n],c=l.startPoint,h=l.endPoint,d=this.getFacePoints(l),u=!1;for(let e=0;e<r.length;e++)if(l!==r[e]&&this.whetherCross(c,h,r[e])){u=!0;break}if(t.equals(h)){o=c,a=t,s=i;let r=this.computeMiter(o,a,s,l.thickness/2,e.thickness/2),n=a.clone().add(r),h=a.clone().add(r.clone().negate());if(u){let t=this.checkLegitimacy(n,d[0],d[3]),i=this.checkLegitimacy(n,d[2],d[5]),r=this.checkLegitimacy(h,d[0],d[3]),o=this.checkLegitimacy(h,d[2],d[5]);(t||i)&&(this.updateVertex(l,3,n),this.updateVertex(e,0,n)),(r||o)&&(this.updateVertex(l,5,h),this.updateVertex(e,2,h))}else this.updateVertex(l,3,n),this.updateVertex(e,0,n),this.updateVertex(l,5,h),this.updateVertex(e,2,h)}else if(i.equals(c)){o=t,a=i,s=h;let r=this.computeMiter(o,a,s,l.thickness/2,e.thickness/2),n=a.clone().add(r),c=a.clone().add(r.clone().negate());if(u){let t=this.checkLegitimacy(n,d[0],d[3]),i=this.checkLegitimacy(n,d[2],d[5]),r=this.checkLegitimacy(c,d[0],d[3]),o=this.checkLegitimacy(c,d[2],d[5]);(t||i)&&(this.updateVertex(l,0,n),this.updateVertex(e,3,n)),(r||o)&&(this.updateVertex(l,2,c),this.updateVertex(e,5,c))}else this.updateVertex(l,0,n),this.updateVertex(e,3,n),this.updateVertex(l,2,c),this.updateVertex(e,5,c)}else if(t.equals(c)){o=h,a=t,s=i;let r=this.computeMiter(o,a,s,l.thickness/2,e.thickness/2),n=a.clone().add(r),c=a.clone().add(r.clone().negate());if(u){let t=this.checkLegitimacy(n,d[0],d[3]),i=this.checkLegitimacy(n,d[2],d[5]),r=this.checkLegitimacy(c,d[0],d[3]),o=this.checkLegitimacy(c,d[2],d[5]);(t||i)&&(this.updateVertex(l,2,n),this.updateVertex(e,0,n)),(r||o)&&(this.updateVertex(l,0,c),this.updateVertex(e,2,c))}else this.updateVertex(l,2,n),this.updateVertex(e,0,n),this.updateVertex(l,0,c),this.updateVertex(e,2,c)}else if(i.equals(h)){o=t,a=i,s=c;let r=this.computeMiter(o,a,s,l.thickness/2,e.thickness/2),n=a.clone().add(r),h=a.clone().add(r.clone().negate());if(u){let t=this.checkLegitimacy(n,d[0],d[3]),i=this.checkLegitimacy(n,d[2],d[5]),r=this.checkLegitimacy(h,d[0],d[3]),o=this.checkLegitimacy(h,d[2],d[5]);(t||i)&&(this.updateVertex(l,5,n),this.updateVertex(e,3,n)),(r||o)&&(this.updateVertex(l,3,h),this.updateVertex(e,5,h))}else this.updateVertex(l,5,n),this.updateVertex(e,3,n),this.updateVertex(l,3,h),this.updateVertex(e,5,h)}}}findCrossFace(e){let t=[];for(let i=0;i<this.btmFaceList.length;i++)this.whetherCross(e.startPoint,e.endPoint,this.btmFaceList[i])&&t.push(this.btmFaceList[i]);return t}findCrossFace2(e,t){let i=[];for(let r=0;r<this.btmFaceList.length;r++)this.whetherCross(e,t,this.btmFaceList[r])&&i.push(this.btmFaceList[r]);return i}whetherCross(e,t,i){let r=i.startPoint,n=i.endPoint;return e.equals(r)||e.equals(n)||t.equals(r)||t.equals(n)}whetherCross2(e,t,i){let r=i.startPoint,n=i.endPoint;return $9HO6e.UtilCore.isSameVector(e,r)||$9HO6e.UtilCore.isSameVector(e,n)?e:!(!$9HO6e.UtilCore.isSameVector(t,r)&&!$9HO6e.UtilCore.isSameVector(t,n))&&t}checkLegitimacy(e,t,i){let r=Math.min(t.x,i.x),n=Math.min(t.y,i.y),o=Math.max(t.x,i.x),a=Math.max(t.y,i.y),s=e.x>=r,l=e.x<=o,c=e.y>=n,h=e.y<=a;return s&&l&&c&&h}createBottomFace(e,t,i,r){let n=this.getLineData(e,t,r/2);switch(i){case 0:var o=e.clone().add(n[2].clone().negate()),a=e,s=e.clone().add(n[2]),l=t.clone().add(n[2].clone().negate()),c=t,h=t.clone().add(n[2]);break;case 1:var d=n[2].negate();o=(a=(s=e).clone().add(d)).clone().add(d),l=(c=(h=t).clone().add(d)).clone().add(d);break;case 2:s=(a=(o=e).clone().add(n[2])).clone().add(n[2]),h=(c=(l=t).clone().add(n[2])).clone().add(n[2])}this.facePoints=[o,a,s,l,c,h];var u=[];this.facePoints.forEach((function(e){u.push(e.x,e.y,0)}));let p=this.material.clone();return p.transparent=!0,p.opacity=roomOpacity,this.createMesh(u,[0,3,4,1,0,4,1,4,5,2,1,5],p)}createMesh(e,t,i,r=[]){var n=new $4xklQ.BufferGeometry;n.attributes.position=new $4xklQ.BufferAttribute(new Float32Array(e),3),r.length>1&&(n.attributes.normal=new $4xklQ.BufferAttribute(new Float32Array(r),3)),n.index=new $4xklQ.BufferAttribute(new Uint16Array(t),1);var o=new $4xklQ.Mesh(n,i);return o.renderOrder=2,o}getLineData(e,t,i=1){if(e.x==t.x)var r="X",n=e.x;else if(e.y==t.y)r="Y",n=e.y;else{r=(e.y-t.y)/(e.x-t.x);r=Math.round(100*r)/100;n=e.y-r*e.x}n=Math.round(100*n)/100;var o=(new $4xklQ.Vector2).subVectors(e,t);return o=new $4xklQ.Vector2(-o.y,o.x).normalize(),1!=i&&o.setLength(i),[r,n,o]}computeIntersectPoint(e,t,i){if("X"==e[0]){if("X"==t[0])return e[1]==t[1]&&new $4xklQ.Vector2(e[1],i.y);if("Y"==t[0])return new $4xklQ.Vector2(e[1],t[1]);var r=t[0]*e[1]+t[1];return new $4xklQ.Vector2(e[1],r)}if("Y"==e[0]){if("X"==t[0])return new $4xklQ.Vector2(t[1],e[1]);if("Y"==t[0])return e[1]==t[1]&&new $4xklQ.Vector2(i.x,e[1]);var n=(e[1]-t[1])/t[0];return new $4xklQ.Vector2(n,e[1])}if("X"==t[0]){r=Math.round(100*(e[0]*t[1]+e[1]))/100;return new $4xklQ.Vector2(t[1],r)}if("Y"==t[0]){n=Math.round((t[1]-e[1])/e[0]*100)/100;return new $4xklQ.Vector2(n,t[1])}if(e[0]==t[0])return!1;n=Math.round((t[1]-e[1])/(e[0]-t[0])*100)/100,r=Math.round(100*(e[0]*n+e[1]))/100;return new $4xklQ.Vector2(n,r)}updateVertex(e,t,i){let r=e.geometry.attributes.position.array;r[3*t]=i.x,r[3*t+1]=i.y,e.geometry.attributes.position=new $4xklQ.BufferAttribute(new Float32Array(r),3),e.updateMatrix()}checkWhetherLegitimacy(e,t,i,r,n,o){return"X"==e[0]?i.y>t.y?o.y>t.y&&(faceVertices[1]=o.y):o.y<t.y&&(faceVertices[1]=o.y):"Y"==e[0]?i.x>t.x?o.x>t.x&&(faceVertices[0]=o.x):o.x<t.x&&(faceVertices[0]=o.x):i.x>t.x?o.x>t.x&&(r[3*n]=o.x,r[3*n+1]=o.y):o.x<t.x&&(r[3*n]=o.x,r[3*n+1]=o.y),r}recordInfo(e,t){e.line=t.line,e.style=t.style,e.thickness=t.thickness,e.height=t.height,e.wallID=t.id,e.name=t.id,e.offsetXY=t.offsetXY,e.isArc=t.isArc,e.useType="wall"}computeMiter(e,t,i,r,n){let o=(new $4xklQ.Vector2).subVectors(t,e).normalize(),a=(new $4xklQ.Vector2).subVectors(i,t).normalize(),s=new $4xklQ.Vector2(-a.y,a.x).normalize(),l=n/o.dot(s),c=o.clone().setLength(l),h=new $4xklQ.Vector2(-o.y,o.x).normalize(),d=r/a.clone().negate().dot(h),u=a.clone().negate().setLength(d);return c.add(u)}unique(e){for(var t=[],i=0;i<e.length-1;i++){for(var r=!1,n=0;n<t.length;n++)if(e[i].equals(t[n])){r=!0;break}r||t.push(e[i])}return t}delete(e,t){let i=e.indexOf(t);-1!=t&&e.splice(i,1)}reset(){this._lastPoint=!1,this._currentPoint=!1,this._nextPoint=!1,this._lastWall=!1,this.firstPoint=!1,this.firstWall=!1,this.facePoints=!1,this.arcFace=[],this.N=1e5,this.graph=Array.from(Array(this.N),(()=>Array())),this.cycles=Array.from(Array(this.N),(()=>Array()))}switchTo3D(e){window.performance.now();let t=[];const i={steps:2,depth:2800,bevelEnabled:!0,bevelThickness:0,bevelSize:0,bevelSegments:1};for(let a=0;a<e.length;a++){let s=e[a];i.depth=s.height;let l=Array.from(s.geometry.attributes.position.array),c=[];if(s.isArc){let e=[],t=[];for(let i=0;i<l.length/9;i++)e.push(new $4xklQ.Vector2(l[9*i],l[9*i+1])),t.push(new $4xklQ.Vector2(l[3*(3*i+2)],l[3*(3*i+2)+1]));e.unshift(new $4xklQ.Vector2(l[3],l[4])),e.push(new $4xklQ.Vector2(l[3*(3*(l.length/9-1)+1)],l[3*(3*(l.length/9-1)+1)+1])),c=e.concat(t.reverse())}else[0,1,2,5,4,3].forEach((e=>{c.push(new $4xklQ.Vector2(l[3*e],l[3*e+1]))}));c.push(c[0]);let h=new $4xklQ.Shape;h.moveTo(c[0].x,c[0].y);for(let e=1;e<c.length;e++)h.lineTo(c[e].x,c[e].y);new $4xklQ.ExtrudeGeometry(h,i);let d=new(0,$2C75G.Wall3DGeometry)(s),u=new $4xklQ.Mesh(d,new $4xklQ.MeshStandardMaterial({color:16777215}));u.geometry.computeBoundingBox();var r=u.geometry.boundingBox.min,n=u.geometry.boundingBox.max,o=r.clone().add(n).divideScalar(2);u.geometry.center(),u.position.set(o.x,o.y,o.z),u.arcCenter=s.arcCenter,this.paramInherit(u,s),u.geometry.computeVertexNormals(),u.updateMatrix(),u.modelType="3DWall",u.startPoint=new $4xklQ.Vector2(u.startPoint.x/1e3,u.startPoint.y/1e3),u.endPoint=new $4xklQ.Vector2(u.endPoint.x/1e3,u.endPoint.y/1e3),u.thickness=u.thickness/1e3,t.push(u)}return t.forEach((e=>{let t=new(0,$6Hryq.Brush)(e.geometry,e.material);e.geometry=t.geometry,e.material=t.material,e.origin3DWall=e.clone()})),t}computeFaceUVs(e,t,i){e.geometry.computeBoundingBox();let r=e.geometry.boundingBox.min,n=e.geometry.boundingBox.max,o=[],a=Array.from(e.geometry.attributes.position.array);var s=(new $4xklQ.TextureLoader).load(this.imagePath);if(s.wrapS=$4xklQ.RepeatWrapping,s.wrapT=$4xklQ.RepeatWrapping,r.z==n.z){let e=new $4xklQ.Vector2(a[3],a[4]),i=new $4xklQ.Vector2(a[a.length-6],a[a.length-5]),s=i.clone().sub(e).angle(),h=e.distanceTo(i),d=n.y-r.y,u=new $4xklQ.MeshStandardMaterial({color:"#9e9b9b",side:$4xklQ.DoubleSide});t.push(u);let p=[r.x,r.y];for(var l=0;l<a.length/3;l++){var c=[a[3*l],a[3*l+1]];o.push((c[0]-p[0])/h,(c[1]-p[1])/d)}let m=(new $4xklQ.Matrix3).setUvTransform(0,0,h/1024,d/1024,s,0,0),f=new $4xklQ.BufferAttribute(new Float32Array(o),2);f.applyMatrix3(m),o=Array.from(f.array)}else{let e,s,c=n.z-r.z;if(i){let t=new $4xklQ.Vector2(a[0],a[1]),i=new $4xklQ.Vector2(a[a.length-3],a[a.length-2]),r=t.distanceTo(i)/2;e=Math.PI*r}else{e=((n.x-r.x)**2+(n.y-r.y)**2)**.5}let h=new $4xklQ.MeshStandardMaterial({color:"#9e9b9b",side:$4xklQ.DoubleSide});t.push(h);let d=2;5!=t.length&&6!=t.length||(d=3);for(let t=0;t<a.length/3;t+=d)if(0==t){s=[a[0],a[1],a[2]];for(let i=0;i<d;i++){let r=[a[3*(t+i)],a[3*(t+i)+1],a[3*(t+i)+2]],n=((r[0]-s[0])**2+(r[1]-s[1])**2)**.5;o.push(n/e,(r[2]-s[2])/c)}}else{s=[a[3*(t-d)],a[3*(t-d)+1],a[3*(t-d)+2]];for(let i=0;i<d;i++){let r=[a[3*(t+i)],a[3*(t+i)+1],a[3*(t+i)+2]],n=((r[0]-s[0])**2+(r[1]-s[1])**2)**.5;o.push(n/e+o[2*(t-d)],(r[2]-s[2])/c+o[2*(t-d)+1])}}if(-1!=[3].indexOf(t.length))for(l=0;l<o.length;l+=2)o[l]=-o[l]}return o}createTopFace(e,t){let i=[];for(let r=0,n=0;r<e.length/3;r++)i.push(e[n],e[n+1],t),n+=3;let r=[];for(let e=0,t=0;e<i.length/9-1;e++)r.push(t,t+1,t+3,t+1,t+4,t+3,t+1,t+2,t+4,t+2,t+5,t+4),t+=3;return[i,r]}createInnerOuterFace(e,t){let i=[],r=[];for(let n=0,o=0;n<e.length/3-1;n++)i=i.concat(e[o]),i=i.concat(t[o]),i=i.concat(e[o+3]),i=i.concat(t[o+3]),r=r.concat(e[o+2]),r=r.concat(t[o+2]),r=r.concat(e[o+5]),r=r.concat(t[o+5]),o+=3;let n=[],o=[];for(let e=0,t=0;e<i.length/12;e++)n.push(t,t+1,t+2,t+1,t+3,t+2),o.push(t+1,t,t+3,t,t+2,t+3),t+=4;return[[i,n],[r,o]]}createLeftRightFace(e,t){var i=e.slice(0,3).concat(t.slice(0,3)),r=[];i.forEach((function(e){r.push(e[0],e[1],e[2])}));var n=e.length,o=e.slice(n-3,n).concat(t.slice(n-3,n)),a=[];o.forEach((function(e){a.push(e[0],e[1],e[2])}));return[[r,[3,0,1,1,4,3,4,1,2,2,5,4]],[a,[0,3,4,4,1,0,1,4,5,5,2,1]]]}createFullWall(e,t,i){let r=[],n=[];for(let t=0;t<e.length;t++){let i=r.length/3;r=r.concat(e[t][0]),e[t][1].forEach((function(e){n.push(e+i)}))}let o=this.createMesh(r,n,t);return this.paramInherit(o,i),o}paramInherit(target,origin){["line","name","style","isArc","height","wallID","offsetXY","thickness","startPoint","endPoint"].forEach((function(item){eval("target."+item+"= origin."+item)}))}handleIntersectNew3(e,t){let i=[e,[]],r=this.getFacePoints(e);if(t.length>0){let n=e.startPoint,o=e.endPoint,a=this.getLineData(r[0],r[3]),s=this.getLineData(r[2],r[5]);for(let r=0;r<t.length;r++){let l=t[r].clone();l.line=t[r].line,l.style=t[r].style,l.thickness=t[r].thickness,l.height=t[r].height,l.offsetXY=t[r].offsetXY,l.isArc=t[r].isArc,l.startPoint=t[r].startPoint,l.endPoint=t[r].endPoint,l.useType=t[r].useType;let c=l.startPoint,h=l.endPoint,d=!1,u=[];for(let e=0;e<t.length;e++)if(l!==t[e]&&this.whetherCross(c,h,t[e])){let i=this.whetherCross2(c,h,t[e]),r=this.whetherCross2(n,o,t[e]);if(i.equals(r)){let r;d=!0,i.equals(t[e].startPoint)?r=t[e].endPoint.clone().sub(i):i.equals(t[e].endPoint)&&(r=t[e].startPoint.clone().sub(i)),u.push(r.angle())}}let p,m,f,g,x,b,y,w,v,$,M,S=this.getFacePoints(l),P=this.getLineData(S[0],S[3]),k=(this.getLineData(S[1],S[4]),this.getLineData(S[2],S[5]));$9HO6e.UtilCore.isSameVector(n,h)?($=o.clone().sub(n),M=c.clone().sub(h),p=n,m=a,f=P,g=0,x=3,b=s,y=k,w=2,v=5):$9HO6e.UtilCore.isSameVector(n,c)?($=o.clone().sub(n),M=h.clone().sub(c),p=n,m=a,f=k,g=0,x=2,b=s,y=P,w=2,v=0):$9HO6e.UtilCore.isSameVector(o,h)?($=n.clone().sub(o),M=c.clone().sub(h),p=o,m=s,f=P,g=5,x=3,b=a,y=k,w=3,v=5):$9HO6e.UtilCore.isSameVector(o,c)&&($=n.clone().sub(o),M=h.clone().sub(c),p=o,m=s,f=k,g=5,x=2,b=a,y=P,w=3,v=0);let _=$.angle(),T=M.angle();if(d){let t=this.checkBetweenAngle(u,_,T,"inner"),i=this.checkBetweenAngle(u,_,T,"outer");if(_<T)if(t){if(!i){let t=this.computeIntersectPoint(b,y,p);this.updateVertex(e,w,t),this.updateVertex(l,v,t)}}else{let t=this.computeIntersectPoint(m,f,p);this.updateVertex(e,g,t),this.updateVertex(l,x,t)}else if(t){if(!i){let t=this.computeIntersectPoint(m,f,p);this.updateVertex(e,g,t),this.updateVertex(l,x,t)}}else{let t=this.computeIntersectPoint(b,y,p);this.updateVertex(e,w,t),this.updateVertex(l,v,t)}}else{let t=this.computeIntersectPoint(m,f,p);this.updateVertex(e,g,t),this.updateVertex(l,x,t);let i=this.computeIntersectPoint(b,y,p);this.updateVertex(e,w,i),this.updateVertex(l,v,i)}i[1].push(l)}}return i}findCrossFaceByPoint(e,t){let i=[],r=[];for(let n=0;n<this.btmFaceList.length;n++)this.whetherCross3(e,this.btmFaceList[n])&&i.push(this.btmFaceList[n]),this.whetherCross3(t,this.btmFaceList[n])&&r.push(this.btmFaceList[n]);return[i,r]}whetherCross3(e,t){let i=t.startPoint,r=t.endPoint;return e.equals(i)||e.equals(r)}getAllPoints(e){let t=Array.from(e.geometry.attributes.position.array),i=[];for(let e=0;e<t.length/3;e++)i.push(new $4xklQ.Vector2(t[3*e],t[3*e+1]));return i}}})),parcelRequire.register("4xklQ",(function(e,t){$parcel$export(e.exports,"REVISION",(()=>i)),$parcel$export(e.exports,"MOUSE",(()=>r)),$parcel$export(e.exports,"TOUCH",(()=>n)),$parcel$export(e.exports,"CullFaceNone",(()=>o)),$parcel$export(e.exports,"CullFaceBack",(()=>a)),$parcel$export(e.exports,"CullFaceFront",(()=>s)),$parcel$export(e.exports,"CullFaceFrontBack",(()=>l)),$parcel$export(e.exports,"BasicShadowMap",(()=>c)),$parcel$export(e.exports,"PCFShadowMap",(()=>h)),$parcel$export(e.exports,"PCFSoftShadowMap",(()=>d)),$parcel$export(e.exports,"VSMShadowMap",(()=>u)),$parcel$export(e.exports,"FrontSide",(()=>p)),$parcel$export(e.exports,"BackSide",(()=>m)),$parcel$export(e.exports,"DoubleSide",(()=>f)),$parcel$export(e.exports,"NoBlending",(()=>g)),$parcel$export(e.exports,"NormalBlending",(()=>x)),$parcel$export(e.exports,"AdditiveBlending",(()=>b)),$parcel$export(e.exports,"SubtractiveBlending",(()=>y)),$parcel$export(e.exports,"MultiplyBlending",(()=>w)),$parcel$export(e.exports,"CustomBlending",(()=>v)),$parcel$export(e.exports,"AddEquation",(()=>$)),$parcel$export(e.exports,"SubtractEquation",(()=>M)),$parcel$export(e.exports,"ReverseSubtractEquation",(()=>S)),$parcel$export(e.exports,"MinEquation",(()=>P)),$parcel$export(e.exports,"MaxEquation",(()=>k)),$parcel$export(e.exports,"ZeroFactor",(()=>_)),$parcel$export(e.exports,"OneFactor",(()=>T)),$parcel$export(e.exports,"SrcColorFactor",(()=>C)),$parcel$export(e.exports,"OneMinusSrcColorFactor",(()=>A)),$parcel$export(e.exports,"SrcAlphaFactor",(()=>D)),$parcel$export(e.exports,"OneMinusSrcAlphaFactor",(()=>R)),$parcel$export(e.exports,"DstAlphaFactor",(()=>E)),$parcel$export(e.exports,"OneMinusDstAlphaFactor",(()=>L)),$parcel$export(e.exports,"DstColorFactor",(()=>I)),$parcel$export(e.exports,"OneMinusDstColorFactor",(()=>B)),$parcel$export(e.exports,"SrcAlphaSaturateFactor",(()=>V)),$parcel$export(e.exports,"NeverDepth",(()=>O)),$parcel$export(e.exports,"AlwaysDepth",(()=>W)),$parcel$export(e.exports,"LessDepth",(()=>H)),$parcel$export(e.exports,"LessEqualDepth",(()=>F)),$parcel$export(e.exports,"EqualDepth",(()=>Q)),$parcel$export(e.exports,"GreaterEqualDepth",(()=>z)),$parcel$export(e.exports,"GreaterDepth",(()=>G)),$parcel$export(e.exports,"NotEqualDepth",(()=>N)),$parcel$export(e.exports,"MultiplyOperation",(()=>U)),$parcel$export(e.exports,"MixOperation",(()=>j)),$parcel$export(e.exports,"AddOperation",(()=>q)),$parcel$export(e.exports,"NoToneMapping",(()=>X)),$parcel$export(e.exports,"LinearToneMapping",(()=>Y)),$parcel$export(e.exports,"ReinhardToneMapping",(()=>J)),$parcel$export(e.exports,"CineonToneMapping",(()=>Z)),$parcel$export(e.exports,"ACESFilmicToneMapping",(()=>K)),$parcel$export(e.exports,"CustomToneMapping",(()=>ee)),$parcel$export(e.exports,"UVMapping",(()=>te)),$parcel$export(e.exports,"CubeReflectionMapping",(()=>ie)),$parcel$export(e.exports,"CubeRefractionMapping",(()=>re)),$parcel$export(e.exports,"EquirectangularReflectionMapping",(()=>ne)),$parcel$export(e.exports,"EquirectangularRefractionMapping",(()=>oe)),$parcel$export(e.exports,"CubeUVReflectionMapping",(()=>ae)),$parcel$export(e.exports,"RepeatWrapping",(()=>se)),$parcel$export(e.exports,"ClampToEdgeWrapping",(()=>le)),$parcel$export(e.exports,"MirroredRepeatWrapping",(()=>ce)),$parcel$export(e.exports,"NearestFilter",(()=>he)),$parcel$export(e.exports,"NearestMipmapNearestFilter",(()=>de)),$parcel$export(e.exports,"NearestMipMapNearestFilter",(()=>ue)),$parcel$export(e.exports,"NearestMipmapLinearFilter",(()=>pe)),$parcel$export(e.exports,"NearestMipMapLinearFilter",(()=>me)),$parcel$export(e.exports,"LinearFilter",(()=>fe)),$parcel$export(e.exports,"LinearMipmapNearestFilter",(()=>ge)),$parcel$export(e.exports,"LinearMipMapNearestFilter",(()=>xe)),$parcel$export(e.exports,"LinearMipmapLinearFilter",(()=>be)),$parcel$export(e.exports,"LinearMipMapLinearFilter",(()=>ye)),$parcel$export(e.exports,"UnsignedByteType",(()=>we)),$parcel$export(e.exports,"ByteType",(()=>ve)),$parcel$export(e.exports,"ShortType",(()=>$e)),$parcel$export(e.exports,"UnsignedShortType",(()=>Me)),$parcel$export(e.exports,"IntType",(()=>Se)),$parcel$export(e.exports,"UnsignedIntType",(()=>Pe)),$parcel$export(e.exports,"FloatType",(()=>ke)),$parcel$export(e.exports,"HalfFloatType",(()=>_e)),$parcel$export(e.exports,"UnsignedShort4444Type",(()=>Te)),$parcel$export(e.exports,"UnsignedShort5551Type",(()=>Ce)),$parcel$export(e.exports,"UnsignedInt248Type",(()=>Ae)),$parcel$export(e.exports,"AlphaFormat",(()=>De)),$parcel$export(e.exports,"RGBFormat",(()=>Re)),$parcel$export(e.exports,"RGBAFormat",(()=>Ee)),$parcel$export(e.exports,"LuminanceFormat",(()=>Le)),$parcel$export(e.exports,"LuminanceAlphaFormat",(()=>Ie)),$parcel$export(e.exports,"DepthFormat",(()=>Be)),$parcel$export(e.exports,"DepthStencilFormat",(()=>Ve)),$parcel$export(e.exports,"RedFormat",(()=>Oe)),$parcel$export(e.exports,"RedIntegerFormat",(()=>We)),$parcel$export(e.exports,"RGFormat",(()=>He)),$parcel$export(e.exports,"RGIntegerFormat",(()=>Fe)),$parcel$export(e.exports,"RGBAIntegerFormat",(()=>Qe)),$parcel$export(e.exports,"RGB_S3TC_DXT1_Format",(()=>ze)),$parcel$export(e.exports,"RGBA_S3TC_DXT1_Format",(()=>Ge)),$parcel$export(e.exports,"RGBA_S3TC_DXT3_Format",(()=>Ne)),$parcel$export(e.exports,"RGBA_S3TC_DXT5_Format",(()=>Ue)),$parcel$export(e.exports,"RGB_PVRTC_4BPPV1_Format",(()=>je)),$parcel$export(e.exports,"RGB_PVRTC_2BPPV1_Format",(()=>qe)),$parcel$export(e.exports,"RGBA_PVRTC_4BPPV1_Format",(()=>Xe)),$parcel$export(e.exports,"RGBA_PVRTC_2BPPV1_Format",(()=>Ye)),$parcel$export(e.exports,"RGB_ETC1_Format",(()=>Je)),$parcel$export(e.exports,"RGB_ETC2_Format",(()=>Ze)),$parcel$export(e.exports,"RGBA_ETC2_EAC_Format",(()=>Ke)),$parcel$export(e.exports,"RGBA_ASTC_4x4_Format",(()=>et)),$parcel$export(e.exports,"RGBA_ASTC_5x4_Format",(()=>tt)),$parcel$export(e.exports,"RGBA_ASTC_5x5_Format",(()=>it)),$parcel$export(e.exports,"RGBA_ASTC_6x5_Format",(()=>rt)),$parcel$export(e.exports,"RGBA_ASTC_6x6_Format",(()=>nt)),$parcel$export(e.exports,"RGBA_ASTC_8x5_Format",(()=>ot)),$parcel$export(e.exports,"RGBA_ASTC_8x6_Format",(()=>at)),$parcel$export(e.exports,"RGBA_ASTC_8x8_Format",(()=>st)),$parcel$export(e.exports,"RGBA_ASTC_10x5_Format",(()=>lt)),$parcel$export(e.exports,"RGBA_ASTC_10x6_Format",(()=>ct)),$parcel$export(e.exports,"RGBA_ASTC_10x8_Format",(()=>ht)),$parcel$export(e.exports,"RGBA_ASTC_10x10_Format",(()=>dt)),$parcel$export(e.exports,"RGBA_ASTC_12x10_Format",(()=>ut)),$parcel$export(e.exports,"RGBA_ASTC_12x12_Format",(()=>pt)),$parcel$export(e.exports,"RGBA_BPTC_Format",(()=>mt)),$parcel$export(e.exports,"LoopOnce",(()=>ft)),$parcel$export(e.exports,"LoopRepeat",(()=>gt)),$parcel$export(e.exports,"LoopPingPong",(()=>xt)),$parcel$export(e.exports,"InterpolateDiscrete",(()=>bt)),$parcel$export(e.exports,"InterpolateLinear",(()=>yt)),$parcel$export(e.exports,"InterpolateSmooth",(()=>wt)),$parcel$export(e.exports,"ZeroCurvatureEnding",(()=>vt)),$parcel$export(e.exports,"ZeroSlopeEnding",(()=>$t)),$parcel$export(e.exports,"WrapAroundEnding",(()=>Mt)),$parcel$export(e.exports,"NormalAnimationBlendMode",(()=>St)),$parcel$export(e.exports,"AdditiveAnimationBlendMode",(()=>Pt)),$parcel$export(e.exports,"TrianglesDrawMode",(()=>kt)),$parcel$export(e.exports,"TriangleStripDrawMode",(()=>_t)),$parcel$export(e.exports,"TriangleFanDrawMode",(()=>Tt)),$parcel$export(e.exports,"LinearEncoding",(()=>Ct)),$parcel$export(e.exports,"sRGBEncoding",(()=>At)),$parcel$export(e.exports,"BasicDepthPacking",(()=>Dt)),$parcel$export(e.exports,"RGBADepthPacking",(()=>Rt)),$parcel$export(e.exports,"TangentSpaceNormalMap",(()=>Et)),$parcel$export(e.exports,"ObjectSpaceNormalMap",(()=>Lt)),$parcel$export(e.exports,"NoColorSpace",(()=>It)),$parcel$export(e.exports,"SRGBColorSpace",(()=>Bt)),$parcel$export(e.exports,"LinearSRGBColorSpace",(()=>Vt)),$parcel$export(e.exports,"ZeroStencilOp",(()=>Ot)),$parcel$export(e.exports,"KeepStencilOp",(()=>Wt)),$parcel$export(e.exports,"ReplaceStencilOp",(()=>Ht)),$parcel$export(e.exports,"IncrementStencilOp",(()=>Ft)),$parcel$export(e.exports,"DecrementStencilOp",(()=>Qt)),$parcel$export(e.exports,"IncrementWrapStencilOp",(()=>zt)),$parcel$export(e.exports,"DecrementWrapStencilOp",(()=>Gt)),$parcel$export(e.exports,"InvertStencilOp",(()=>Nt)),$parcel$export(e.exports,"NeverStencilFunc",(()=>Ut)),$parcel$export(e.exports,"LessStencilFunc",(()=>jt)),$parcel$export(e.exports,"EqualStencilFunc",(()=>qt)),$parcel$export(e.exports,"LessEqualStencilFunc",(()=>Xt)),$parcel$export(e.exports,"GreaterStencilFunc",(()=>Yt)),$parcel$export(e.exports,"NotEqualStencilFunc",(()=>Jt)),$parcel$export(e.exports,"GreaterEqualStencilFunc",(()=>Zt)),$parcel$export(e.exports,"AlwaysStencilFunc",(()=>Kt)),$parcel$export(e.exports,"StaticDrawUsage",(()=>ei)),$parcel$export(e.exports,"DynamicDrawUsage",(()=>ti)),$parcel$export(e.exports,"StreamDrawUsage",(()=>ii)),$parcel$export(e.exports,"StaticReadUsage",(()=>ri)),$parcel$export(e.exports,"DynamicReadUsage",(()=>ni)),$parcel$export(e.exports,"StreamReadUsage",(()=>oi)),$parcel$export(e.exports,"StaticCopyUsage",(()=>ai)),$parcel$export(e.exports,"DynamicCopyUsage",(()=>si)),$parcel$export(e.exports,"StreamCopyUsage",(()=>li)),$parcel$export(e.exports,"GLSL1",(()=>ci)),$parcel$export(e.exports,"GLSL3",(()=>hi)),$parcel$export(e.exports,"_SRGBAFormat",(()=>di)),$parcel$export(e.exports,"EventDispatcher",(()=>ui)),$parcel$export(e.exports,"MathUtils",(()=>ki)),$parcel$export(e.exports,"Vector2",(()=>_i)),$parcel$export(e.exports,"Matrix3",(()=>Ti)),$parcel$export(e.exports,"ColorManagement",(()=>Bi)),$parcel$export(e.exports,"Color",(()=>zi)),$parcel$export(e.exports,"ImageUtils",(()=>Ni)),$parcel$export(e.exports,"Source",(()=>Ui)),$parcel$export(e.exports,"Texture",(()=>Xi)),$parcel$export(e.exports,"Vector4",(()=>Yi)),$parcel$export(e.exports,"WebGLRenderTarget",(()=>Ji)),$parcel$export(e.exports,"DataArrayTexture",(()=>Zi)),$parcel$export(e.exports,"WebGLArrayRenderTarget",(()=>Ki)),$parcel$export(e.exports,"Data3DTexture",(()=>er)),$parcel$export(e.exports,"WebGL3DRenderTarget",(()=>tr)),$parcel$export(e.exports,"WebGLMultipleRenderTargets",(()=>ir)),$parcel$export(e.exports,"Quaternion",(()=>rr)),$parcel$export(e.exports,"Vector3",(()=>nr)),$parcel$export(e.exports,"Box3",(()=>sr)),$parcel$export(e.exports,"Sphere",(()=>kr)),$parcel$export(e.exports,"Ray",(()=>Lr)),$parcel$export(e.exports,"Matrix4",(()=>Ir)),$parcel$export(e.exports,"Euler",(()=>Nr)),$parcel$export(e.exports,"Layers",(()=>Ur)),$parcel$export(e.exports,"Object3D",(()=>sn)),$parcel$export(e.exports,"Triangle",(()=>bn)),$parcel$export(e.exports,"Material",(()=>wn)),$parcel$export(e.exports,"MeshBasicMaterial",(()=>vn)),$parcel$export(e.exports,"BufferAttribute",(()=>Sn)),$parcel$export(e.exports,"Int8BufferAttribute",(()=>Pn)),$parcel$export(e.exports,"Uint8BufferAttribute",(()=>kn)),$parcel$export(e.exports,"Uint8ClampedBufferAttribute",(()=>_n)),$parcel$export(e.exports,"Int16BufferAttribute",(()=>Tn)),$parcel$export(e.exports,"Uint16BufferAttribute",(()=>Cn)),$parcel$export(e.exports,"Int32BufferAttribute",(()=>An)),$parcel$export(e.exports,"Uint32BufferAttribute",(()=>Dn)),$parcel$export(e.exports,"Float16BufferAttribute",(()=>Rn)),$parcel$export(e.exports,"Float32BufferAttribute",(()=>En)),$parcel$export(e.exports,"Float64BufferAttribute",(()=>Ln)),$parcel$export(e.exports,"BufferGeometry",(()=>Qn)),$parcel$export(e.exports,"Mesh",(()=>ao)),$parcel$export(e.exports,"BoxGeometry",(()=>lo)),$parcel$export(e.exports,"UniformsUtils",(()=>uo)),$parcel$export(e.exports,"ShaderMaterial",(()=>po)),$parcel$export(e.exports,"Camera",(()=>mo)),$parcel$export(e.exports,"PerspectiveCamera",(()=>fo)),$parcel$export(e.exports,"CubeCamera",(()=>xo)),$parcel$export(e.exports,"CubeTexture",(()=>bo)),$parcel$export(e.exports,"WebGLCubeRenderTarget",(()=>yo)),$parcel$export(e.exports,"Plane",(()=>Mo)),$parcel$export(e.exports,"Frustum",(()=>ko)),$parcel$export(e.exports,"PlaneGeometry",(()=>Co)),$parcel$export(e.exports,"ShaderChunk",(()=>Ao)),$parcel$export(e.exports,"UniformsLib",(()=>Do)),$parcel$export(e.exports,"ShaderLib",(()=>Ro)),$parcel$export(e.exports,"OrthographicCamera",(()=>Wo)),$parcel$export(e.exports,"PMREMGenerator",(()=>qo)),$parcel$export(e.exports,"MeshDepthMaterial",(()=>Gs)),$parcel$export(e.exports,"MeshDistanceMaterial",(()=>Ns)),$parcel$export(e.exports,"WebGLUtils",(()=>Xs)),$parcel$export(e.exports,"ArrayCamera",(()=>Ys)),$parcel$export(e.exports,"Group",(()=>Js)),$parcel$export(e.exports,"DepthTexture",(()=>el)),$parcel$export(e.exports,"WebGLRenderer",(()=>nl)),$parcel$export(e.exports,"WebGL1Renderer",(()=>ol)),$parcel$export(e.exports,"FogExp2",(()=>al)),$parcel$export(e.exports,"Fog",(()=>sl)),$parcel$export(e.exports,"Scene",(()=>ll)),$parcel$export(e.exports,"InterleavedBuffer",(()=>cl)),$parcel$export(e.exports,"InterleavedBufferAttribute",(()=>dl)),$parcel$export(e.exports,"SpriteMaterial",(()=>ul)),$parcel$export(e.exports,"Sprite",(()=>kl)),$parcel$export(e.exports,"LOD",(()=>Al)),$parcel$export(e.exports,"SkinnedMesh",(()=>Bl)),$parcel$export(e.exports,"Bone",(()=>Vl)),$parcel$export(e.exports,"DataTexture",(()=>Ol)),$parcel$export(e.exports,"Skeleton",(()=>Fl)),$parcel$export(e.exports,"InstancedBufferAttribute",(()=>Ql)),$parcel$export(e.exports,"InstancedMesh",(()=>jl)),$parcel$export(e.exports,"LineBasicMaterial",(()=>ql)),$parcel$export(e.exports,"Line",(()=>ec)),$parcel$export(e.exports,"LineSegments",(()=>rc)),$parcel$export(e.exports,"LineLoop",(()=>nc)),$parcel$export(e.exports,"PointsMaterial",(()=>oc)),$parcel$export(e.exports,"Points",(()=>hc)),$parcel$export(e.exports,"VideoTexture",(()=>uc)),$parcel$export(e.exports,"FramebufferTexture",(()=>pc)),$parcel$export(e.exports,"CompressedTexture",(()=>mc)),$parcel$export(e.exports,"CanvasTexture",(()=>fc)),$parcel$export(e.exports,"Curve",(()=>gc)),$parcel$export(e.exports,"EllipseCurve",(()=>xc)),$parcel$export(e.exports,"ArcCurve",(()=>bc)),$parcel$export(e.exports,"CatmullRomCurve3",(()=>Sc)),$parcel$export(e.exports,"CubicBezierCurve",(()=>Tc)),$parcel$export(e.exports,"CubicBezierCurve3",(()=>Cc)),$parcel$export(e.exports,"LineCurve",(()=>Ac)),$parcel$export(e.exports,"LineCurve3",(()=>Dc)),$parcel$export(e.exports,"QuadraticBezierCurve",(()=>Rc)),$parcel$export(e.exports,"QuadraticBezierCurve3",(()=>Ec)),$parcel$export(e.exports,"SplineCurve",(()=>Lc)),$parcel$export(e.exports,"CurvePath",(()=>Bc)),$parcel$export(e.exports,"Path",(()=>Vc)),$parcel$export(e.exports,"LatheGeometry",(()=>Oc)),$parcel$export(e.exports,"CapsuleGeometry",(()=>Wc)),$parcel$export(e.exports,"CircleGeometry",(()=>Hc)),$parcel$export(e.exports,"CylinderGeometry",(()=>Fc)),$parcel$export(e.exports,"ConeGeometry",(()=>Qc)),$parcel$export(e.exports,"PolyhedronGeometry",(()=>zc)),$parcel$export(e.exports,"DodecahedronGeometry",(()=>Gc)),$parcel$export(e.exports,"EdgesGeometry",(()=>Xc)),$parcel$export(e.exports,"Shape",(()=>Yc)),$parcel$export(e.exports,"ShapeUtils",(()=>$h)),$parcel$export(e.exports,"ExtrudeGeometry",(()=>Ph)),$parcel$export(e.exports,"IcosahedronGeometry",(()=>_h)),$parcel$export(e.exports,"OctahedronGeometry",(()=>Th)),$parcel$export(e.exports,"RingGeometry",(()=>Ch)),$parcel$export(e.exports,"ShapeGeometry",(()=>Ah)),$parcel$export(e.exports,"SphereGeometry",(()=>Dh)),$parcel$export(e.exports,"TetrahedronGeometry",(()=>Rh)),$parcel$export(e.exports,"TorusGeometry",(()=>Eh)),$parcel$export(e.exports,"TorusKnotGeometry",(()=>Lh)),$parcel$export(e.exports,"TubeGeometry",(()=>Ih)),$parcel$export(e.exports,"WireframeGeometry",(()=>Bh)),$parcel$export(e.exports,"ShadowMaterial",(()=>Wh)),$parcel$export(e.exports,"RawShaderMaterial",(()=>Hh)),$parcel$export(e.exports,"MeshStandardMaterial",(()=>Fh)),$parcel$export(e.exports,"MeshPhysicalMaterial",(()=>Qh)),$parcel$export(e.exports,"MeshPhongMaterial",(()=>zh)),$parcel$export(e.exports,"MeshToonMaterial",(()=>Gh)),$parcel$export(e.exports,"MeshNormalMaterial",(()=>Nh)),$parcel$export(e.exports,"MeshLambertMaterial",(()=>Uh)),$parcel$export(e.exports,"MeshMatcapMaterial",(()=>jh)),$parcel$export(e.exports,"LineDashedMaterial",(()=>qh)),$parcel$export(e.exports,"AnimationUtils",(()=>td)),$parcel$export(e.exports,"Interpolant",(()=>id)),$parcel$export(e.exports,"CubicInterpolant",(()=>rd)),$parcel$export(e.exports,"LinearInterpolant",(()=>nd)),$parcel$export(e.exports,"DiscreteInterpolant",(()=>od)),$parcel$export(e.exports,"KeyframeTrack",(()=>ad)),$parcel$export(e.exports,"BooleanKeyframeTrack",(()=>sd)),$parcel$export(e.exports,"ColorKeyframeTrack",(()=>ld)),$parcel$export(e.exports,"NumberKeyframeTrack",(()=>cd)),$parcel$export(e.exports,"QuaternionLinearInterpolant",(()=>hd)),$parcel$export(e.exports,"QuaternionKeyframeTrack",(()=>dd)),$parcel$export(e.exports,"StringKeyframeTrack",(()=>ud)),$parcel$export(e.exports,"VectorKeyframeTrack",(()=>pd)),$parcel$export(e.exports,"AnimationClip",(()=>md)),$parcel$export(e.exports,"Cache",(()=>gd)),$parcel$export(e.exports,"LoadingManager",(()=>xd)),$parcel$export(e.exports,"DefaultLoadingManager",(()=>bd)),$parcel$export(e.exports,"Loader",(()=>yd)),$parcel$export(e.exports,"FileLoader",(()=>$d)),$parcel$export(e.exports,"AnimationLoader",(()=>Md)),$parcel$export(e.exports,"CompressedTextureLoader",(()=>Sd)),$parcel$export(e.exports,"ImageLoader",(()=>Pd)),$parcel$export(e.exports,"CubeTextureLoader",(()=>kd)),$parcel$export(e.exports,"DataTextureLoader",(()=>_d)),$parcel$export(e.exports,"TextureLoader",(()=>Td)),$parcel$export(e.exports,"Light",(()=>Cd)),$parcel$export(e.exports,"HemisphereLight",(()=>Ad)),$parcel$export(e.exports,"SpotLight",(()=>Bd)),$parcel$export(e.exports,"PointLight",(()=>Fd)),$parcel$export(e.exports,"DirectionalLight",(()=>zd)),$parcel$export(e.exports,"AmbientLight",(()=>Gd)),$parcel$export(e.exports,"RectAreaLight",(()=>Nd)),$parcel$export(e.exports,"SphericalHarmonics3",(()=>Ud)),$parcel$export(e.exports,"LightProbe",(()=>jd)),$parcel$export(e.exports,"MaterialLoader",(()=>qd)),$parcel$export(e.exports,"LoaderUtils",(()=>Xd)),$parcel$export(e.exports,"InstancedBufferGeometry",(()=>Yd)),$parcel$export(e.exports,"BufferGeometryLoader",(()=>Jd)),$parcel$export(e.exports,"ObjectLoader",(()=>Zd)),$parcel$export(e.exports,"ImageBitmapLoader",(()=>iu)),$parcel$export(e.exports,"AudioContext",(()=>nu)),$parcel$export(e.exports,"AudioLoader",(()=>ou)),$parcel$export(e.exports,"HemisphereLightProbe",(()=>au)),$parcel$export(e.exports,"AmbientLightProbe",(()=>su)),$parcel$export(e.exports,"StereoCamera",(()=>du)),$parcel$export(e.exports,"Clock",(()=>uu)),$parcel$export(e.exports,"AudioListener",(()=>bu)),$parcel$export(e.exports,"Audio",(()=>yu)),$parcel$export(e.exports,"PositionalAudio",(()=>Su)),$parcel$export(e.exports,"AudioAnalyser",(()=>Pu)),$parcel$export(e.exports,"PropertyMixer",(()=>ku)),$parcel$export(e.exports,"PropertyBinding",(()=>Eu)),$parcel$export(e.exports,"AnimationObjectGroup",(()=>Lu)),$parcel$export(e.exports,"AnimationMixer",(()=>Vu)),$parcel$export(e.exports,"Uniform",(()=>Ou)),$parcel$export(e.exports,"UniformsGroup",(()=>Hu)),$parcel$export(e.exports,"InstancedInterleavedBuffer",(()=>Fu)),$parcel$export(e.exports,"GLBufferAttribute",(()=>Qu)),$parcel$export(e.exports,"Raycaster",(()=>zu)),$parcel$export(e.exports,"Spherical",(()=>Uu)),$parcel$export(e.exports,"Cylindrical",(()=>ju)),$parcel$export(e.exports,"Box2",(()=>Xu)),$parcel$export(e.exports,"Line3",(()=>Zu)),$parcel$export(e.exports,"SpotLightHelper",(()=>ep)),$parcel$export(e.exports,"SkeletonHelper",(()=>np)),$parcel$export(e.exports,"PointLightHelper",(()=>ap)),$parcel$export(e.exports,"HemisphereLightHelper",(()=>hp)),$parcel$export(e.exports,"GridHelper",(()=>dp)),$parcel$export(e.exports,"PolarGridHelper",(()=>up)),$parcel$export(e.exports,"DirectionalLightHelper",(()=>gp)),$parcel$export(e.exports,"CameraHelper",(()=>yp)),$parcel$export(e.exports,"BoxHelper",(()=>$p)),$parcel$export(e.exports,"Box3Helper",(()=>Mp)),$parcel$export(e.exports,"PlaneHelper",(()=>Sp)),$parcel$export(e.exports,"ArrowHelper",(()=>Tp)),$parcel$export(e.exports,"AxesHelper",(()=>Cp)),$parcel$export(e.exports,"ShapePath",(()=>Ap)),$parcel$export(e.exports,"DataUtils",(()=>Ep)),$parcel$export(e.exports,"ImmediateRenderObject",(()=>Lp)),$parcel$export(e.exports,"WebGLMultisampleRenderTarget",(()=>Ip)),$parcel$export(e.exports,"DataTexture2DArray",(()=>Bp)),$parcel$export(e.exports,"DataTexture3D",(()=>Vp)),$parcel$export(e.exports,"BoxBufferGeometry",(()=>Op)),$parcel$export(e.exports,"CapsuleBufferGeometry",(()=>Wp)),$parcel$export(e.exports,"CircleBufferGeometry",(()=>Hp)),$parcel$export(e.exports,"ConeBufferGeometry",(()=>Fp)),$parcel$export(e.exports,"CylinderBufferGeometry",(()=>Qp)),$parcel$export(e.exports,"DodecahedronBufferGeometry",(()=>zp)),$parcel$export(e.exports,"ExtrudeBufferGeometry",(()=>Gp)),$parcel$export(e.exports,"IcosahedronBufferGeometry",(()=>Np)),$parcel$export(e.exports,"LatheBufferGeometry",(()=>Up)),$parcel$export(e.exports,"OctahedronBufferGeometry",(()=>jp)),$parcel$export(e.exports,"PlaneBufferGeometry",(()=>qp)),$parcel$export(e.exports,"PolyhedronBufferGeometry",(()=>Xp)),$parcel$export(e.exports,"RingBufferGeometry",(()=>Yp)),$parcel$export(e.exports,"ShapeBufferGeometry",(()=>Jp)),$parcel$export(e.exports,"SphereBufferGeometry",(()=>Zp)),$parcel$export(e.exports,"TetrahedronBufferGeometry",(()=>Kp)),$parcel$export(e.exports,"TorusBufferGeometry",(()=>em)),$parcel$export(e.exports,"TorusKnotBufferGeometry",(()=>tm)),$parcel$export(e.exports,"TubeBufferGeometry",(()=>im));
/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
const i="144",r={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},n={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},o=0,a=1,s=2,l=3,c=0,h=1,d=2,u=3,p=0,m=1,f=2,g=0,x=1,b=2,y=3,w=4,v=5,$=100,M=101,S=102,P=103,k=104,_=200,T=201,C=202,A=203,D=204,R=205,E=206,L=207,I=208,B=209,V=210,O=0,W=1,H=2,F=3,Q=4,z=5,G=6,N=7,U=0,j=1,q=2,X=0,Y=1,J=2,Z=3,K=4,ee=5,te=300,ie=301,re=302,ne=303,oe=304,ae=306,se=1e3,le=1001,ce=1002,he=1003,de=1004,ue=1004,pe=1005,me=1005,fe=1006,ge=1007,xe=1007,be=1008,ye=1008,we=1009,ve=1010,$e=1011,Me=1012,Se=1013,Pe=1014,ke=1015,_e=1016,Te=1017,Ce=1018,Ae=1020,De=1021,Re=1022,Ee=1023,Le=1024,Ie=1025,Be=1026,Ve=1027,Oe=1028,We=1029,He=1030,Fe=1031,Qe=1033,ze=33776,Ge=33777,Ne=33778,Ue=33779,je=35840,qe=35841,Xe=35842,Ye=35843,Je=36196,Ze=37492,Ke=37496,et=37808,tt=37809,it=37810,rt=37811,nt=37812,ot=37813,at=37814,st=37815,lt=37816,ct=37817,ht=37818,dt=37819,ut=37820,pt=37821,mt=36492,ft=2200,gt=2201,xt=2202,bt=2300,yt=2301,wt=2302,vt=2400,$t=2401,Mt=2402,St=2500,Pt=2501,kt=0,_t=1,Tt=2,Ct=3e3,At=3001,Dt=3200,Rt=3201,Et=0,Lt=1,It="",Bt="srgb",Vt="srgb-linear",Ot=0,Wt=7680,Ht=7681,Ft=7682,Qt=7683,zt=34055,Gt=34056,Nt=5386,Ut=512,jt=513,qt=514,Xt=515,Yt=516,Jt=517,Zt=518,Kt=519,ei=35044,ti=35048,ii=35040,ri=35045,ni=35049,oi=35041,ai=35046,si=35050,li=35042,ci="100",hi="300 es",di=1035;class ui{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const i=this._listeners[e];if(void 0!==i){const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const i=t.slice(0);for(let t=0,r=i.length;t<r;t++)i[t].call(this,e);e.target=null}}}const pi=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let mi=1234567;const fi=Math.PI/180,gi=180/Math.PI;function xi(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(pi[255&e]+pi[e>>8&255]+pi[e>>16&255]+pi[e>>24&255]+"-"+pi[255&t]+pi[t>>8&255]+"-"+pi[t>>16&15|64]+pi[t>>24&255]+"-"+pi[63&i|128]+pi[i>>8&255]+"-"+pi[i>>16&255]+pi[i>>24&255]+pi[255&r]+pi[r>>8&255]+pi[r>>16&255]+pi[r>>24&255]).toLowerCase()}function bi(e,t,i){return Math.max(t,Math.min(i,e))}function yi(e,t){return(e%t+t)%t}function wi(e,t,i){return(1-i)*e+i*t}function vi(e){return 0==(e&e-1)&&0!==e}function $i(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Mi(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function Si(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Pi(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}var ki=Object.freeze({__proto__:null,DEG2RAD:fi,RAD2DEG:gi,generateUUID:xi,clamp:bi,euclideanModulo:yi,mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},inverseLerp:function(e,t,i){return e!==t?(i-e)/(t-e):0},lerp:wi,damp:function(e,t,i,r){return wi(e,t,1-Math.exp(-i*r))},pingpong:function(e,t=1){return t-Math.abs(yi(e,2*t)-t)},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(mi=e);let t=mi+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*fi},radToDeg:function(e){return e*gi},isPowerOfTwo:vi,ceilPowerOfTwo:$i,floorPowerOfTwo:Mi,setQuaternionFromProperEuler:function(e,t,i,r,n){const o=Math.cos,a=Math.sin,s=o(i/2),l=a(i/2),c=o((t+r)/2),h=a((t+r)/2),d=o((t-r)/2),u=a((t-r)/2),p=o((r-t)/2),m=a((r-t)/2);switch(n){case"XYX":e.set(s*h,l*d,l*u,s*c);break;case"YZY":e.set(l*u,s*h,l*d,s*c);break;case"ZXZ":e.set(l*d,l*u,s*h,s*c);break;case"XZX":e.set(s*h,l*m,l*p,s*c);break;case"YXY":e.set(l*p,s*h,l*m,s*c);break;case"ZYZ":e.set(l*m,l*p,s*h,s*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}},normalize:Pi,denormalize:Si});class _i{constructor(e=0,t=0){_i.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*i-o*r+e.x,this.y=n*r+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ti{constructor(){Ti.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,r,n,o,a,s,l){const c=this.elements;return c[0]=e,c[1]=r,c[2]=a,c[3]=t,c[4]=n,c[5]=s,c[6]=i,c[7]=o,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,n=this.elements,o=i[0],a=i[3],s=i[6],l=i[1],c=i[4],h=i[7],d=i[2],u=i[5],p=i[8],m=r[0],f=r[3],g=r[6],x=r[1],b=r[4],y=r[7],w=r[2],v=r[5],$=r[8];return n[0]=o*m+a*x+s*w,n[3]=o*f+a*b+s*v,n[6]=o*g+a*y+s*$,n[1]=l*m+c*x+h*w,n[4]=l*f+c*b+h*v,n[7]=l*g+c*y+h*$,n[2]=d*m+u*x+p*w,n[5]=d*f+u*b+p*v,n[8]=d*g+u*y+p*$,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8];return t*o*c-t*a*l-i*n*c+i*a*s+r*n*l-r*o*s}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8],h=c*o-a*l,d=a*s-c*n,u=l*n-o*s,p=t*h+i*d+r*u;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=h*m,e[1]=(r*l-c*i)*m,e[2]=(a*i-r*o)*m,e[3]=d*m,e[4]=(c*t-r*s)*m,e[5]=(r*n-a*t)*m,e[6]=u*m,e[7]=(i*s-l*t)*m,e[8]=(o*t-i*n)*m,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,n,o,a){const s=Math.cos(n),l=Math.sin(n);return this.set(i*s,i*l,-i*(s*o+l*a)+o+e,-r*l,r*s,-r*(-l*o+s*a)+a+t,0,0,1),this}scale(e,t){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),r=this.elements,n=r[0],o=r[3],a=r[6],s=r[1],l=r[4],c=r[7];return r[0]=t*n+i*s,r[3]=t*o+i*l,r[6]=t*a+i*c,r[1]=-i*n+t*s,r[4]=-i*o+t*l,r[7]=-i*a+t*c,this}translate(e,t){const i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){const t=this.elements,i=e.elements;for(let e=0;e<9;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}function Ci(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const Ai={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Di(e,t){return new Ai[e](t)}function Ri(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Ei(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Li(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}const Ii={[Bt]:{[Vt]:Ei},[Vt]:{[Bt]:Li}},Bi={legacyMode:!0,get workingColorSpace(){return Vt},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,i){if(this.legacyMode||t===i||!t||!i)return e;if(Ii[t]&&void 0!==Ii[t][i]){const r=Ii[t][i];return e.r=r(e.r),e.g=r(e.g),e.b=r(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},Vi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Oi={r:0,g:0,b:0},Wi={h:0,s:0,l:0},Hi={h:0,s:0,l:0};function Fi(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}function Qi(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}class zi{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Bt){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Bi.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=Vt){return this.r=e,this.g=t,this.b=i,Bi.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=Vt){if(e=yi(e,1),t=bi(t,0,1),i=bi(i,0,1),0===t)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+t):i+t-i*t,n=2*i-r;this.r=Fi(n,r,e+1/3),this.g=Fi(n,r,e),this.b=Fi(n,r,e-1/3)}return Bi.toWorkingColorSpace(this,r),this}setStyle(e,t=Bt){function i(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const n=r[1],o=r[2];switch(n){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,Bi.toWorkingColorSpace(this,t),i(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,Bi.toWorkingColorSpace(this,t),i(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){const r=parseFloat(e[1])/360,n=parseFloat(e[2])/100,o=parseFloat(e[3])/100;return i(e[4]),this.setHSL(r,n,o,t)}}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=r[1],i=e.length;if(3===i)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,Bi.toWorkingColorSpace(this,t),this;if(6===i)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,Bi.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=Bt){const i=Vi[e.toLowerCase()];return void 0!==i?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ei(e.r),this.g=Ei(e.g),this.b=Ei(e.b),this}copyLinearToSRGB(e){return this.r=Li(e.r),this.g=Li(e.g),this.b=Li(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Bt){return Bi.fromWorkingColorSpace(Qi(this,Oi),e),bi(255*Oi.r,0,255)<<16^bi(255*Oi.g,0,255)<<8^bi(255*Oi.b,0,255)<<0}getHexString(e=Bt){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Vt){Bi.fromWorkingColorSpace(Qi(this,Oi),t);const i=Oi.r,r=Oi.g,n=Oi.b,o=Math.max(i,r,n),a=Math.min(i,r,n);let s,l;const c=(a+o)/2;if(a===o)s=0,l=0;else{const e=o-a;switch(l=c<=.5?e/(o+a):e/(2-o-a),o){case i:s=(r-n)/e+(r<n?6:0);break;case r:s=(n-i)/e+2;break;case n:s=(i-r)/e+4}s/=6}return e.h=s,e.s=l,e.l=c,e}getRGB(e,t=Vt){return Bi.fromWorkingColorSpace(Qi(this,Oi),t),e.r=Oi.r,e.g=Oi.g,e.b=Oi.b,e}getStyle(e=Bt){return Bi.fromWorkingColorSpace(Qi(this,Oi),e),e!==Bt?`color(${e} ${Oi.r} ${Oi.g} ${Oi.b})`:`rgb(${255*Oi.r|0},${255*Oi.g|0},${255*Oi.b|0})`}offsetHSL(e,t,i){return this.getHSL(Wi),Wi.h+=e,Wi.s+=t,Wi.l+=i,this.setHSL(Wi.h,Wi.s,Wi.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Wi),e.getHSL(Hi);const i=wi(Wi.h,Hi.h,t),r=wi(Wi.s,Hi.s,t),n=wi(Wi.l,Hi.l,t);return this.setHSL(i,r,n),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let Gi;zi.NAMES=Vi;class Ni{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Gi&&(Gi=Ri("canvas")),Gi.width=e.width,Gi.height=e.height;const i=Gi.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Gi}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=Ri("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),n=r.data;for(let e=0;e<n.length;e++)n[e]=255*Ei(n[e]/255);return i.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*Ei(t[e]/255)):t[e]=Ei(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class Ui{constructor(e=null){this.isSource=!0,this.uuid=xi(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(null!==r){let e;if(Array.isArray(r)){e=[];for(let t=0,i=r.length;t<i;t++)r[t].isDataTexture?e.push(ji(r[t].image)):e.push(ji(r[t]))}else e=ji(r);i.url=e}return t||(e.images[this.uuid]=i),i}}function ji(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?Ni.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let qi=0;class Xi extends ui{constructor(e=Xi.DEFAULT_IMAGE,t=Xi.DEFAULT_MAPPING,i=le,r=le,n=fe,o=be,a=Ee,s=we,l=1,c=Ct){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:qi++}),this.uuid=xi(),this.name="",this.source=new Ui(e),this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=r,this.magFilter=n,this.minFilter=o,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=s,this.offset=new _i(0,0),this.repeat=new _i(1,1),this.center=new _i(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ti,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==te)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case se:e.x=e.x-Math.floor(e.x);break;case le:e.x=e.x<0?0:1;break;case ce:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case se:e.y=e.y-Math.floor(e.y);break;case le:e.y=e.y<0?0:1;break;case ce:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}Xi.DEFAULT_IMAGE=null,Xi.DEFAULT_MAPPING=te;class Yi{constructor(e=0,t=0,i=0,r=1){Yi.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,n=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*n,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*n,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*n,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*n,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,n;const o=.01,a=.1,s=e.elements,l=s[0],c=s[4],h=s[8],d=s[1],u=s[5],p=s[9],m=s[2],f=s[6],g=s[10];if(Math.abs(c-d)<o&&Math.abs(h-m)<o&&Math.abs(p-f)<o){if(Math.abs(c+d)<a&&Math.abs(h+m)<a&&Math.abs(p+f)<a&&Math.abs(l+u+g-3)<a)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,s=(u+1)/2,x=(g+1)/2,b=(c+d)/4,y=(h+m)/4,w=(p+f)/4;return e>s&&e>x?e<o?(i=0,r=.707106781,n=.707106781):(i=Math.sqrt(e),r=b/i,n=y/i):s>x?s<o?(i=.707106781,r=0,n=.707106781):(r=Math.sqrt(s),i=b/r,n=w/r):x<o?(i=.707106781,r=.707106781,n=0):(n=Math.sqrt(x),i=y/n,r=w/n),this.set(i,r,n,t),this}let x=Math.sqrt((f-p)*(f-p)+(h-m)*(h-m)+(d-c)*(d-c));return Math.abs(x)<.001&&(x=1),this.x=(f-p)/x,this.y=(h-m)/x,this.z=(d-c)/x,this.w=Math.acos((l+u+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Ji extends ui{constructor(e,t,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Yi(0,0,e,t),this.scissorTest=!1,this.viewport=new Yi(0,0,e,t);const r={width:e,height:t,depth:1};this.texture=new Xi(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:fe,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(e,t,i=1){this.width===e&&this.height===t&&this.depth===i||(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Ui(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Zi extends Xi{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=he,this.minFilter=he,this.wrapR=le,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ki extends Ji{constructor(e,t,i){super(e,t),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new Zi(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class er extends Xi{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=he,this.minFilter=he,this.wrapR=le,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class tr extends Ji{constructor(e,t,i){super(e,t),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new er(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class ir extends Ji{constructor(e,t,i,r={}){super(e,t,r),this.isWebGLMultipleRenderTargets=!0;const n=this.texture;this.texture=[];for(let e=0;e<i;e++)this.texture[e]=n.clone(),this.texture[e].isRenderTargetTexture=!0}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,n=this.texture.length;r<n;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}class rr{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,n,o,a){let s=i[r+0],l=i[r+1],c=i[r+2],h=i[r+3];const d=n[o+0],u=n[o+1],p=n[o+2],m=n[o+3];if(0===a)return e[t+0]=s,e[t+1]=l,e[t+2]=c,void(e[t+3]=h);if(1===a)return e[t+0]=d,e[t+1]=u,e[t+2]=p,void(e[t+3]=m);if(h!==m||s!==d||l!==u||c!==p){let e=1-a;const t=s*d+l*u+c*p+h*m,i=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const n=Math.sqrt(r),o=Math.atan2(n,t*i);e=Math.sin(e*o)/n,a=Math.sin(a*o)/n}const n=a*i;if(s=s*e+d*n,l=l*e+u*n,c=c*e+p*n,h=h*e+m*n,e===1-a){const e=1/Math.sqrt(s*s+l*l+c*c+h*h);s*=e,l*=e,c*=e,h*=e}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,i,r,n,o){const a=i[r],s=i[r+1],l=i[r+2],c=i[r+3],h=n[o],d=n[o+1],u=n[o+2],p=n[o+3];return e[t]=a*p+c*h+s*u-l*d,e[t+1]=s*p+c*d+l*h-a*u,e[t+2]=l*p+c*u+a*d-s*h,e[t+3]=c*p-a*h-s*d-l*u,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const i=e._x,r=e._y,n=e._z,o=e._order,a=Math.cos,s=Math.sin,l=a(i/2),c=a(r/2),h=a(n/2),d=s(i/2),u=s(r/2),p=s(n/2);switch(o){case"XYZ":this._x=d*c*h+l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h-d*u*p;break;case"YXZ":this._x=d*c*h+l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h+d*u*p;break;case"ZXY":this._x=d*c*h-l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h-d*u*p;break;case"ZYX":this._x=d*c*h-l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h+d*u*p;break;case"YZX":this._x=d*c*h+l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h-d*u*p;break;case"XZY":this._x=d*c*h-l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h+d*u*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],n=t[8],o=t[1],a=t[5],s=t[9],l=t[2],c=t[6],h=t[10],d=i+a+h;if(d>0){const e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(c-s)*e,this._y=(n-l)*e,this._z=(o-r)*e}else if(i>a&&i>h){const e=2*Math.sqrt(1+i-a-h);this._w=(c-s)/e,this._x=.25*e,this._y=(r+o)/e,this._z=(n+l)/e}else if(a>h){const e=2*Math.sqrt(1+a-i-h);this._w=(n-l)/e,this._x=(r+o)/e,this._y=.25*e,this._z=(s+c)/e}else{const e=2*Math.sqrt(1+h-i-a);this._w=(o-r)/e,this._x=(n+l)/e,this._y=(s+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(bi(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,n=e._z,o=e._w,a=t._x,s=t._y,l=t._z,c=t._w;return this._x=i*c+o*a+r*l-n*s,this._y=r*c+o*s+n*a-i*l,this._z=n*c+o*l+i*s-r*a,this._w=o*c-i*a-r*s-n*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,r=this._y,n=this._z,o=this._w;let a=o*e._w+i*e._x+r*e._y+n*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=n,this;const s=1-a*a;if(s<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*i+t*this._x,this._y=e*r+t*this._y,this._z=e*n+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(s),c=Math.atan2(l,a),h=Math.sin((1-t)*c)/l,d=Math.sin(t*c)/l;return this._w=o*h+this._w*d,this._x=i*h+this._x*d,this._y=r*h+this._y*d,this._z=n*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(n),i*Math.cos(n),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class nr{constructor(e=0,t=0,i=0){nr.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(ar.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(ar.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,n=e.elements,o=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*o,this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*o,this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,n=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*r-a*i,c=s*i+a*t-n*r,h=s*r+n*i-o*t,d=-n*t-o*i-a*r;return this.x=l*s+d*-n+c*-a-h*-o,this.y=c*s+d*-o+h*-n-l*-a,this.z=h*s+d*-a+l*-o-c*-n,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,n=e.z,o=t.x,a=t.y,s=t.z;return this.x=r*s-n*a,this.y=n*o-i*s,this.z=i*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return or.copy(this).projectOnVector(e),this.sub(or)}reflect(e){return this.sub(or.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(bi(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const or=new nr,ar=new rr;class sr{constructor(e=new nr(1/0,1/0,1/0),t=new nr(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,a=-1/0;for(let s=0,l=e.length;s<l;s+=3){const l=e[s],c=e[s+1],h=e[s+2];l<t&&(t=l),c<i&&(i=c),h<r&&(r=h),l>n&&(n=l),c>o&&(o=c),h>a&&(a=h)}return this.min.set(t,i,r),this.max.set(n,o,a),this}setFromBufferAttribute(e){let t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,a=-1/0;for(let s=0,l=e.count;s<l;s++){const l=e.getX(s),c=e.getY(s),h=e.getZ(s);l<t&&(t=l),c<i&&(i=c),h<r&&(r=h),l>n&&(n=l),c>o&&(o=c),h>a&&(a=h)}return this.min.set(t,i,r),this.max.set(n,o,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=cr.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(void 0!==i)if(t&&null!=i.attributes&&void 0!==i.attributes.position){const t=i.attributes.position;for(let i=0,r=t.count;i<r;i++)cr.fromBufferAttribute(t,i).applyMatrix4(e.matrixWorld),this.expandByPoint(cr)}else null===i.boundingBox&&i.computeBoundingBox(),hr.copy(i.boundingBox),hr.applyMatrix4(e.matrixWorld),this.union(hr);const r=e.children;for(let e=0,i=r.length;e<i;e++)this.expandByObject(r[e],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,cr),cr.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(xr),br.subVectors(this.max,xr),dr.subVectors(e.a,xr),ur.subVectors(e.b,xr),pr.subVectors(e.c,xr),mr.subVectors(ur,dr),fr.subVectors(pr,ur),gr.subVectors(dr,pr);let t=[0,-mr.z,mr.y,0,-fr.z,fr.y,0,-gr.z,gr.y,mr.z,0,-mr.x,fr.z,0,-fr.x,gr.z,0,-gr.x,-mr.y,mr.x,0,-fr.y,fr.x,0,-gr.y,gr.x,0];return!!vr(t,dr,ur,pr,br)&&(t=[1,0,0,0,1,0,0,0,1],!!vr(t,dr,ur,pr,br)&&(yr.crossVectors(mr,fr),t=[yr.x,yr.y,yr.z],vr(t,dr,ur,pr,br)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return cr.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(cr).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(lr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),lr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),lr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),lr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),lr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),lr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),lr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),lr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(lr)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const lr=[new nr,new nr,new nr,new nr,new nr,new nr,new nr,new nr],cr=new nr,hr=new sr,dr=new nr,ur=new nr,pr=new nr,mr=new nr,fr=new nr,gr=new nr,xr=new nr,br=new nr,yr=new nr,wr=new nr;function vr(e,t,i,r,n){for(let o=0,a=e.length-3;o<=a;o+=3){wr.fromArray(e,o);const a=n.x*Math.abs(wr.x)+n.y*Math.abs(wr.y)+n.z*Math.abs(wr.z),s=t.dot(wr),l=i.dot(wr),c=r.dot(wr);if(Math.max(-Math.max(s,l,c),Math.min(s,l,c))>a)return!1}return!0}const $r=new sr,Mr=new nr,Sr=new nr,Pr=new nr;class kr{constructor(e=new nr,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;void 0!==t?i.copy(t):$r.setFromPoints(e).getCenter(i);let r=0;for(let t=0,n=e.length;t<n;t++)r=Math.max(r,i.distanceToSquared(e[t]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Pr.subVectors(e,this.center);const t=Pr.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),i=.5*(e-this.radius);this.center.add(Pr.multiplyScalar(i/e)),this.radius+=i}return this}union(e){return!0===this.center.equals(e.center)?Sr.set(0,0,1).multiplyScalar(e.radius):Sr.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(Mr.copy(e.center).add(Sr)),this.expandByPoint(Mr.copy(e.center).sub(Sr)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const _r=new nr,Tr=new nr,Cr=new nr,Ar=new nr,Dr=new nr,Rr=new nr,Er=new nr;class Lr{constructor(e=new nr,t=new nr(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,_r)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=_r.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(_r.copy(this.direction).multiplyScalar(t).add(this.origin),_r.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){Tr.copy(e).add(t).multiplyScalar(.5),Cr.copy(t).sub(e).normalize(),Ar.copy(this.origin).sub(Tr);const n=.5*e.distanceTo(t),o=-this.direction.dot(Cr),a=Ar.dot(this.direction),s=-Ar.dot(Cr),l=Ar.lengthSq(),c=Math.abs(1-o*o);let h,d,u,p;if(c>0)if(h=o*s-a,d=o*a-s,p=n*c,h>=0)if(d>=-p)if(d<=p){const e=1/c;h*=e,d*=e,u=h*(h+o*d+2*a)+d*(o*h+d+2*s)+l}else d=n,h=Math.max(0,-(o*d+a)),u=-h*h+d*(d+2*s)+l;else d=-n,h=Math.max(0,-(o*d+a)),u=-h*h+d*(d+2*s)+l;else d<=-p?(h=Math.max(0,-(-o*n+a)),d=h>0?-n:Math.min(Math.max(-n,-s),n),u=-h*h+d*(d+2*s)+l):d<=p?(h=0,d=Math.min(Math.max(-n,-s),n),u=d*(d+2*s)+l):(h=Math.max(0,-(o*n+a)),d=h>0?n:Math.min(Math.max(-n,-s),n),u=-h*h+d*(d+2*s)+l);else d=o>0?-n:n,h=Math.max(0,-(o*d+a)),u=-h*h+d*(d+2*s)+l;return i&&i.copy(this.direction).multiplyScalar(h).add(this.origin),r&&r.copy(Cr).multiplyScalar(d).add(Tr),u}intersectSphere(e,t){_r.subVectors(e.center,this.origin);const i=_r.dot(this.direction),r=_r.dot(_r)-i*i,n=e.radius*e.radius;if(r>n)return null;const o=Math.sqrt(n-r),a=i-o,s=i+o;return a<0&&s<0?null:a<0?this.at(s,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,n,o,a,s;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,d=this.origin;return l>=0?(i=(e.min.x-d.x)*l,r=(e.max.x-d.x)*l):(i=(e.max.x-d.x)*l,r=(e.min.x-d.x)*l),c>=0?(n=(e.min.y-d.y)*c,o=(e.max.y-d.y)*c):(n=(e.max.y-d.y)*c,o=(e.min.y-d.y)*c),i>o||n>r?null:((n>i||i!=i)&&(i=n),(o<r||r!=r)&&(r=o),h>=0?(a=(e.min.z-d.z)*h,s=(e.max.z-d.z)*h):(a=(e.max.z-d.z)*h,s=(e.min.z-d.z)*h),i>s||a>r?null:((a>i||i!=i)&&(i=a),(s<r||r!=r)&&(r=s),r<0?null:this.at(i>=0?i:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,_r)}intersectTriangle(e,t,i,r,n){Dr.subVectors(t,e),Rr.subVectors(i,e),Er.crossVectors(Dr,Rr);let o,a=this.direction.dot(Er);if(a>0){if(r)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}Ar.subVectors(this.origin,e);const s=o*this.direction.dot(Rr.crossVectors(Ar,Rr));if(s<0)return null;const l=o*this.direction.dot(Dr.cross(Ar));if(l<0)return null;if(s+l>a)return null;const c=-o*Ar.dot(Er);return c<0?null:this.at(c/a,n)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Ir{constructor(){Ir.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,r,n,o,a,s,l,c,h,d,u,p,m,f){const g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=n,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=c,g[10]=h,g[14]=d,g[3]=u,g[7]=p,g[11]=m,g[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Ir).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/Br.setFromMatrixColumn(e,0).length(),n=1/Br.setFromMatrixColumn(e,1).length(),o=1/Br.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*n,t[5]=i[5]*n,t[6]=i[6]*n,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,n=e.z,o=Math.cos(i),a=Math.sin(i),s=Math.cos(r),l=Math.sin(r),c=Math.cos(n),h=Math.sin(n);if("XYZ"===e.order){const e=o*c,i=o*h,r=a*c,n=a*h;t[0]=s*c,t[4]=-s*h,t[8]=l,t[1]=i+r*l,t[5]=e-n*l,t[9]=-a*s,t[2]=n-e*l,t[6]=r+i*l,t[10]=o*s}else if("YXZ"===e.order){const e=s*c,i=s*h,r=l*c,n=l*h;t[0]=e+n*a,t[4]=r*a-i,t[8]=o*l,t[1]=o*h,t[5]=o*c,t[9]=-a,t[2]=i*a-r,t[6]=n+e*a,t[10]=o*s}else if("ZXY"===e.order){const e=s*c,i=s*h,r=l*c,n=l*h;t[0]=e-n*a,t[4]=-o*h,t[8]=r+i*a,t[1]=i+r*a,t[5]=o*c,t[9]=n-e*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){const e=o*c,i=o*h,r=a*c,n=a*h;t[0]=s*c,t[4]=r*l-i,t[8]=e*l+n,t[1]=s*h,t[5]=n*l+e,t[9]=i*l-r,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){const e=o*s,i=o*l,r=a*s,n=a*l;t[0]=s*c,t[4]=n-e*h,t[8]=r*h+i,t[1]=h,t[5]=o*c,t[9]=-a*c,t[2]=-l*c,t[6]=i*h+r,t[10]=e-n*h}else if("XZY"===e.order){const e=o*s,i=o*l,r=a*s,n=a*l;t[0]=s*c,t[4]=-h,t[8]=l*c,t[1]=e*h+n,t[5]=o*c,t[9]=i*h-r,t[2]=r*h-i,t[6]=a*c,t[10]=n*h+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Or,e,Wr)}lookAt(e,t,i){const r=this.elements;return Qr.subVectors(e,t),0===Qr.lengthSq()&&(Qr.z=1),Qr.normalize(),Hr.crossVectors(i,Qr),0===Hr.lengthSq()&&(1===Math.abs(i.z)?Qr.x+=1e-4:Qr.z+=1e-4,Qr.normalize(),Hr.crossVectors(i,Qr)),Hr.normalize(),Fr.crossVectors(Qr,Hr),r[0]=Hr.x,r[4]=Fr.x,r[8]=Qr.x,r[1]=Hr.y,r[5]=Fr.y,r[9]=Qr.y,r[2]=Hr.z,r[6]=Fr.z,r[10]=Qr.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,n=this.elements,o=i[0],a=i[4],s=i[8],l=i[12],c=i[1],h=i[5],d=i[9],u=i[13],p=i[2],m=i[6],f=i[10],g=i[14],x=i[3],b=i[7],y=i[11],w=i[15],v=r[0],$=r[4],M=r[8],S=r[12],P=r[1],k=r[5],_=r[9],T=r[13],C=r[2],A=r[6],D=r[10],R=r[14],E=r[3],L=r[7],I=r[11],B=r[15];return n[0]=o*v+a*P+s*C+l*E,n[4]=o*$+a*k+s*A+l*L,n[8]=o*M+a*_+s*D+l*I,n[12]=o*S+a*T+s*R+l*B,n[1]=c*v+h*P+d*C+u*E,n[5]=c*$+h*k+d*A+u*L,n[9]=c*M+h*_+d*D+u*I,n[13]=c*S+h*T+d*R+u*B,n[2]=p*v+m*P+f*C+g*E,n[6]=p*$+m*k+f*A+g*L,n[10]=p*M+m*_+f*D+g*I,n[14]=p*S+m*T+f*R+g*B,n[3]=x*v+b*P+y*C+w*E,n[7]=x*$+b*k+y*A+w*L,n[11]=x*M+b*_+y*D+w*I,n[15]=x*S+b*T+y*R+w*B,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],o=e[1],a=e[5],s=e[9],l=e[13],c=e[2],h=e[6],d=e[10],u=e[14];return e[3]*(+n*s*h-r*l*h-n*a*d+i*l*d+r*a*u-i*s*u)+e[7]*(+t*s*u-t*l*d+n*o*d-r*o*u+r*l*c-n*s*c)+e[11]*(+t*l*h-t*a*u-n*o*h+i*o*u+n*a*c-i*l*c)+e[15]*(-r*a*c-t*s*h+t*a*d+r*o*h-i*o*d+i*s*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8],h=e[9],d=e[10],u=e[11],p=e[12],m=e[13],f=e[14],g=e[15],x=h*f*l-m*d*l+m*s*u-a*f*u-h*s*g+a*d*g,b=p*d*l-c*f*l-p*s*u+o*f*u+c*s*g-o*d*g,y=c*m*l-p*h*l+p*a*u-o*m*u-c*a*g+o*h*g,w=p*h*s-c*m*s-p*a*d+o*m*d+c*a*f-o*h*f,v=t*x+i*b+r*y+n*w;if(0===v)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const $=1/v;return e[0]=x*$,e[1]=(m*d*n-h*f*n-m*r*u+i*f*u+h*r*g-i*d*g)*$,e[2]=(a*f*n-m*s*n+m*r*l-i*f*l-a*r*g+i*s*g)*$,e[3]=(h*s*n-a*d*n-h*r*l+i*d*l+a*r*u-i*s*u)*$,e[4]=b*$,e[5]=(c*f*n-p*d*n+p*r*u-t*f*u-c*r*g+t*d*g)*$,e[6]=(p*s*n-o*f*n-p*r*l+t*f*l+o*r*g-t*s*g)*$,e[7]=(o*d*n-c*s*n+c*r*l-t*d*l-o*r*u+t*s*u)*$,e[8]=y*$,e[9]=(p*h*n-c*m*n-p*i*u+t*m*u+c*i*g-t*h*g)*$,e[10]=(o*m*n-p*a*n+p*i*l-t*m*l-o*i*g+t*a*g)*$,e[11]=(c*a*n-o*h*n-c*i*l+t*h*l+o*i*u-t*a*u)*$,e[12]=w*$,e[13]=(c*m*r-p*h*r+p*i*d-t*m*d-c*i*f+t*h*f)*$,e[14]=(p*a*r-o*m*r-p*i*s+t*m*s+o*i*f-t*a*f)*$,e[15]=(o*h*r-c*a*r+c*i*s-t*h*s-o*i*d+t*a*d)*$,this}scale(e){const t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),n=1-i,o=e.x,a=e.y,s=e.z,l=n*o,c=n*a;return this.set(l*o+i,l*a-r*s,l*s+r*a,0,l*a+r*s,c*a+i,c*s-r*o,0,l*s-r*a,c*s+r*o,n*s*s+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,n,o){return this.set(1,i,n,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,n=t._x,o=t._y,a=t._z,s=t._w,l=n+n,c=o+o,h=a+a,d=n*l,u=n*c,p=n*h,m=o*c,f=o*h,g=a*h,x=s*l,b=s*c,y=s*h,w=i.x,v=i.y,$=i.z;return r[0]=(1-(m+g))*w,r[1]=(u+y)*w,r[2]=(p-b)*w,r[3]=0,r[4]=(u-y)*v,r[5]=(1-(d+g))*v,r[6]=(f+x)*v,r[7]=0,r[8]=(p+b)*$,r[9]=(f-x)*$,r[10]=(1-(d+m))*$,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let n=Br.set(r[0],r[1],r[2]).length();const o=Br.set(r[4],r[5],r[6]).length(),a=Br.set(r[8],r[9],r[10]).length();this.determinant()<0&&(n=-n),e.x=r[12],e.y=r[13],e.z=r[14],Vr.copy(this);const s=1/n,l=1/o,c=1/a;return Vr.elements[0]*=s,Vr.elements[1]*=s,Vr.elements[2]*=s,Vr.elements[4]*=l,Vr.elements[5]*=l,Vr.elements[6]*=l,Vr.elements[8]*=c,Vr.elements[9]*=c,Vr.elements[10]*=c,t.setFromRotationMatrix(Vr),i.x=n,i.y=o,i.z=a,this}makePerspective(e,t,i,r,n,o){const a=this.elements,s=2*n/(t-e),l=2*n/(i-r),c=(t+e)/(t-e),h=(i+r)/(i-r),d=-(o+n)/(o-n),u=-2*o*n/(o-n);return a[0]=s,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=u,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,i,r,n,o){const a=this.elements,s=1/(t-e),l=1/(i-r),c=1/(o-n),h=(t+e)*s,d=(i+r)*l,u=(o+n)*c;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-u,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let e=0;e<16;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const Br=new nr,Vr=new Ir,Or=new nr(0,0,0),Wr=new nr(1,1,1),Hr=new nr,Fr=new nr,Qr=new nr,zr=new Ir,Gr=new rr;class Nr{constructor(e=0,t=0,i=0,r=Nr.DefaultOrder){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const r=e.elements,n=r[0],o=r[4],a=r[8],s=r[1],l=r[5],c=r[9],h=r[2],d=r[6],u=r[10];switch(t){case"XYZ":this._y=Math.asin(bi(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,u),this._z=Math.atan2(-o,n)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-bi(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,u),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-h,n),this._z=0);break;case"ZXY":this._x=Math.asin(bi(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,u),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(s,n));break;case"ZYX":this._y=Math.asin(-bi(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,u),this._z=Math.atan2(s,n)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(bi(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,n)):(this._x=0,this._y=Math.atan2(a,u));break;case"XZY":this._z=Math.asin(-bi(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-c,u),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===i&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return zr.makeRotationFromQuaternion(e),this.setFromRotationMatrix(zr,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Gr.setFromEuler(this),this.setFromQuaternion(Gr,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}Nr.DefaultOrder="XYZ",Nr.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Ur{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let jr=0;const qr=new nr,Xr=new rr,Yr=new Ir,Jr=new nr,Zr=new nr,Kr=new nr,en=new rr,tn=new nr(1,0,0),rn=new nr(0,1,0),nn=new nr(0,0,1),on={type:"added"},an={type:"removed"};class sn extends ui{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:jr++}),this.uuid=xi(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=sn.DefaultUp.clone();const e=new nr,t=new Nr,i=new rr,r=new nr(1,1,1);t._onChange((function(){i.setFromEuler(t,!1)})),i._onChange((function(){t.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Ir},normalMatrix:{value:new Ti}}),this.matrix=new Ir,this.matrixWorld=new Ir,this.matrixAutoUpdate=sn.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=sn.DefaultMatrixWorldAutoUpdate,this.layers=new Ur,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Xr.setFromAxisAngle(e,t),this.quaternion.multiply(Xr),this}rotateOnWorldAxis(e,t){return Xr.setFromAxisAngle(e,t),this.quaternion.premultiply(Xr),this}rotateX(e){return this.rotateOnAxis(tn,e)}rotateY(e){return this.rotateOnAxis(rn,e)}rotateZ(e){return this.rotateOnAxis(nn,e)}translateOnAxis(e,t){return qr.copy(e).applyQuaternion(this.quaternion),this.position.add(qr.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(tn,e)}translateY(e){return this.translateOnAxis(rn,e)}translateZ(e){return this.translateOnAxis(nn,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Yr.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Jr.copy(e):Jr.set(e,t,i);const r=this.parent;this.updateWorldMatrix(!0,!1),Zr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Yr.lookAt(Zr,Jr,this.up):Yr.lookAt(Jr,Zr,this.up),this.quaternion.setFromRotationMatrix(Yr),r&&(Yr.extractRotation(r.matrixWorld),Xr.setFromRotationMatrix(Yr),this.quaternion.premultiply(Xr.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(on)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(an)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(an)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Yr.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Yr.multiply(e.parent.matrixWorld)),e.applyMatrix4(Yr),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){const r=this.children[i].getObjectByProperty(e,t);if(void 0!==r)return r}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Zr,e,Kr),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Zr,en,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,r=t.length;i<r;i++){const r=t[i];!0!==r.matrixWorldAutoUpdate&&!0!==e||r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const i=this.parent;if(!0===e&&null!==i&&!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,i=e.length;t<i;t++){const i=e[t];!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};function n(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=n(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const i=t.shapes;if(Array.isArray(i))for(let t=0,r=i.length;t<r;t++){const r=i[t];n(e.shapes,r)}else n(e.shapes,i)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(n(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let i=0,r=this.material.length;i<r;i++)t.push(n(e.materials,this.material[i]));r.material=t}else r.material=n(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const i=this.animations[t];r.animations.push(n(e.animations,i))}}if(t){const t=o(e.geometries),r=o(e.materials),n=o(e.textures),a=o(e.images),s=o(e.shapes),l=o(e.skeletons),c=o(e.animations),h=o(e.nodes);t.length>0&&(i.geometries=t),r.length>0&&(i.materials=r),n.length>0&&(i.textures=n),a.length>0&&(i.images=a),s.length>0&&(i.shapes=s),l.length>0&&(i.skeletons=l),c.length>0&&(i.animations=c),h.length>0&&(i.nodes=h)}return i.object=r,i;function o(e){const t=[];for(const i in e){const r=e[i];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const i=e.children[t];this.add(i.clone())}return this}}sn.DefaultUp=new nr(0,1,0),sn.DefaultMatrixAutoUpdate=!0,sn.DefaultMatrixWorldAutoUpdate=!0;const ln=new nr,cn=new nr,hn=new nr,dn=new nr,un=new nr,pn=new nr,mn=new nr,fn=new nr,gn=new nr,xn=new nr;class bn{constructor(e=new nr,t=new nr,i=new nr){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),ln.subVectors(e,t),r.cross(ln);const n=r.lengthSq();return n>0?r.multiplyScalar(1/Math.sqrt(n)):r.set(0,0,0)}static getBarycoord(e,t,i,r,n){ln.subVectors(r,t),cn.subVectors(i,t),hn.subVectors(e,t);const o=ln.dot(ln),a=ln.dot(cn),s=ln.dot(hn),l=cn.dot(cn),c=cn.dot(hn),h=o*l-a*a;if(0===h)return n.set(-2,-1,-1);const d=1/h,u=(l*s-a*c)*d,p=(o*c-a*s)*d;return n.set(1-u-p,p,u)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,dn),dn.x>=0&&dn.y>=0&&dn.x+dn.y<=1}static getUV(e,t,i,r,n,o,a,s){return this.getBarycoord(e,t,i,r,dn),s.set(0,0),s.addScaledVector(n,dn.x),s.addScaledVector(o,dn.y),s.addScaledVector(a,dn.z),s}static isFrontFacing(e,t,i,r){return ln.subVectors(i,t),cn.subVectors(e,t),ln.cross(cn).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ln.subVectors(this.c,this.b),cn.subVectors(this.a,this.b),.5*ln.cross(cn).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return bn.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return bn.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,n){return bn.getUV(e,this.a,this.b,this.c,t,i,r,n)}containsPoint(e){return bn.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return bn.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,n=this.c;let o,a;un.subVectors(r,i),pn.subVectors(n,i),fn.subVectors(e,i);const s=un.dot(fn),l=pn.dot(fn);if(s<=0&&l<=0)return t.copy(i);gn.subVectors(e,r);const c=un.dot(gn),h=pn.dot(gn);if(c>=0&&h<=c)return t.copy(r);const d=s*h-c*l;if(d<=0&&s>=0&&c<=0)return o=s/(s-c),t.copy(i).addScaledVector(un,o);xn.subVectors(e,n);const u=un.dot(xn),p=pn.dot(xn);if(p>=0&&u<=p)return t.copy(n);const m=u*l-s*p;if(m<=0&&l>=0&&p<=0)return a=l/(l-p),t.copy(i).addScaledVector(pn,a);const f=c*p-u*h;if(f<=0&&h-c>=0&&u-p>=0)return mn.subVectors(n,r),a=(h-c)/(h-c+(u-p)),t.copy(r).addScaledVector(mn,a);const g=1/(f+m+d);return o=m*g,a=d*g,t.copy(i).addScaledVector(un,o).addScaledVector(pn,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let yn=0;class wn extends ui{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:yn++}),this.uuid=xi(),this.name="",this.type="Material",this.blending=x,this.side=p,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=D,this.blendDst=R,this.blendEquation=$,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=F,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Kt,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Wt,this.stencilZFail=Wt,this.stencilZPass=Wt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const i=e[t];if(void 0===i){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const i in e){const r=e[i];delete r.metadata,t.push(r)}return t}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==x&&(i.blending=this.blending),this.side!==p&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t){const t=r(e.textures),n=r(e.images);t.length>0&&(i.textures=t),n.length>0&&(i.images=n)}return i}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(null!==t){const e=t.length;i=new Array(e);for(let r=0;r!==e;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class vn extends wn{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new zi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=U,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const $n=new nr,Mn=new _i;class Sn{constructor(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.usage=ei,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,n=this.itemSize;r<n;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)Mn.fromBufferAttribute(this,t),Mn.applyMatrix3(e),this.setXY(t,Mn.x,Mn.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)$n.fromBufferAttribute(this,t),$n.applyMatrix3(e),this.setXYZ(t,$n.x,$n.y,$n.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)$n.fromBufferAttribute(this,t),$n.applyMatrix4(e),this.setXYZ(t,$n.x,$n.y,$n.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)$n.fromBufferAttribute(this,t),$n.applyNormalMatrix(e),this.setXYZ(t,$n.x,$n.y,$n.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)$n.fromBufferAttribute(this,t),$n.transformDirection(e),this.setXYZ(t,$n.x,$n.y,$n.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Si(t,this.array)),t}setX(e,t){return this.normalized&&(t=Pi(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Si(t,this.array)),t}setY(e,t){return this.normalized&&(t=Pi(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Si(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Pi(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Si(t,this.array)),t}setW(e,t){return this.normalized&&(t=Pi(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Pi(t,this.array),i=Pi(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=Pi(t,this.array),i=Pi(i,this.array),r=Pi(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,n){return e*=this.itemSize,this.normalized&&(t=Pi(t,this.array),i=Pi(i,this.array),r=Pi(r,this.array),n=Pi(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=n,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==ei&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class Pn extends Sn{constructor(e,t,i){super(new Int8Array(e),t,i)}}class kn extends Sn{constructor(e,t,i){super(new Uint8Array(e),t,i)}}class _n extends Sn{constructor(e,t,i){super(new Uint8ClampedArray(e),t,i)}}class Tn extends Sn{constructor(e,t,i){super(new Int16Array(e),t,i)}}class Cn extends Sn{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class An extends Sn{constructor(e,t,i){super(new Int32Array(e),t,i)}}class Dn extends Sn{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class Rn extends Sn{constructor(e,t,i){super(new Uint16Array(e),t,i),this.isFloat16BufferAttribute=!0}}class En extends Sn{constructor(e,t,i){super(new Float32Array(e),t,i)}}class Ln extends Sn{constructor(e,t,i){super(new Float64Array(e),t,i)}}let In=0;const Bn=new Ir,Vn=new sn,On=new nr,Wn=new sr,Hn=new sr,Fn=new nr;class Qn extends ui{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:In++}),this.uuid=xi(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Ci(e)?Dn:Cn)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const t=(new Ti).getNormalMatrix(e);i.applyNormalMatrix(t),i.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Bn.makeRotationFromQuaternion(e),this.applyMatrix4(Bn),this}rotateX(e){return Bn.makeRotationX(e),this.applyMatrix4(Bn),this}rotateY(e){return Bn.makeRotationY(e),this.applyMatrix4(Bn),this}rotateZ(e){return Bn.makeRotationZ(e),this.applyMatrix4(Bn),this}translate(e,t,i){return Bn.makeTranslation(e,t,i),this.applyMatrix4(Bn),this}scale(e,t,i){return Bn.makeScale(e,t,i),this.applyMatrix4(Bn),this}lookAt(e){return Vn.lookAt(e),Vn.updateMatrix(),this.applyMatrix4(Vn.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(On).negate(),this.translate(On.x,On.y,On.z),this}setFromPoints(e){const t=[];for(let i=0,r=e.length;i<r;i++){const r=e[i];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new En(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new sr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new nr(-1/0,-1/0,-1/0),new nr(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const i=t[e];Wn.setFromBufferAttribute(i),this.morphTargetsRelative?(Fn.addVectors(this.boundingBox.min,Wn.min),this.boundingBox.expandByPoint(Fn),Fn.addVectors(this.boundingBox.max,Wn.max),this.boundingBox.expandByPoint(Fn)):(this.boundingBox.expandByPoint(Wn.min),this.boundingBox.expandByPoint(Wn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new kr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new nr,1/0);if(e){const i=this.boundingSphere.center;if(Wn.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const i=t[e];Hn.setFromBufferAttribute(i),this.morphTargetsRelative?(Fn.addVectors(Wn.min,Hn.min),Wn.expandByPoint(Fn),Fn.addVectors(Wn.max,Hn.max),Wn.expandByPoint(Fn)):(Wn.expandByPoint(Hn.min),Wn.expandByPoint(Hn.max))}Wn.getCenter(i);let r=0;for(let t=0,n=e.count;t<n;t++)Fn.fromBufferAttribute(e,t),r=Math.max(r,i.distanceToSquared(Fn));if(t)for(let n=0,o=t.length;n<o;n++){const o=t[n],a=this.morphTargetsRelative;for(let t=0,n=o.count;t<n;t++)Fn.fromBufferAttribute(o,t),a&&(On.fromBufferAttribute(e,t),Fn.add(On)),r=Math.max(r,i.distanceToSquared(Fn))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=e.array,r=t.position.array,n=t.normal.array,o=t.uv.array,a=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Sn(new Float32Array(4*a),4));const s=this.getAttribute("tangent").array,l=[],c=[];for(let e=0;e<a;e++)l[e]=new nr,c[e]=new nr;const h=new nr,d=new nr,u=new nr,p=new _i,m=new _i,f=new _i,g=new nr,x=new nr;function b(e,t,i){h.fromArray(r,3*e),d.fromArray(r,3*t),u.fromArray(r,3*i),p.fromArray(o,2*e),m.fromArray(o,2*t),f.fromArray(o,2*i),d.sub(h),u.sub(h),m.sub(p),f.sub(p);const n=1/(m.x*f.y-f.x*m.y);isFinite(n)&&(g.copy(d).multiplyScalar(f.y).addScaledVector(u,-m.y).multiplyScalar(n),x.copy(u).multiplyScalar(m.x).addScaledVector(d,-f.x).multiplyScalar(n),l[e].add(g),l[t].add(g),l[i].add(g),c[e].add(x),c[t].add(x),c[i].add(x))}let y=this.groups;0===y.length&&(y=[{start:0,count:i.length}]);for(let e=0,t=y.length;e<t;++e){const t=y[e],r=t.start;for(let e=r,n=r+t.count;e<n;e+=3)b(i[e+0],i[e+1],i[e+2])}const w=new nr,v=new nr,$=new nr,M=new nr;function S(e){$.fromArray(n,3*e),M.copy($);const t=l[e];w.copy(t),w.sub($.multiplyScalar($.dot(t))).normalize(),v.crossVectors(M,t);const i=v.dot(c[e])<0?-1:1;s[4*e]=w.x,s[4*e+1]=w.y,s[4*e+2]=w.z,s[4*e+3]=i}for(let e=0,t=y.length;e<t;++e){const t=y[e],r=t.start;for(let e=r,n=r+t.count;e<n;e+=3)S(i[e+0]),S(i[e+1]),S(i[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new Sn(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let e=0,t=i.count;e<t;e++)i.setXYZ(e,0,0,0);const r=new nr,n=new nr,o=new nr,a=new nr,s=new nr,l=new nr,c=new nr,h=new nr;if(e)for(let d=0,u=e.count;d<u;d+=3){const u=e.getX(d+0),p=e.getX(d+1),m=e.getX(d+2);r.fromBufferAttribute(t,u),n.fromBufferAttribute(t,p),o.fromBufferAttribute(t,m),c.subVectors(o,n),h.subVectors(r,n),c.cross(h),a.fromBufferAttribute(i,u),s.fromBufferAttribute(i,p),l.fromBufferAttribute(i,m),a.add(c),s.add(c),l.add(c),i.setXYZ(u,a.x,a.y,a.z),i.setXYZ(p,s.x,s.y,s.z),i.setXYZ(m,l.x,l.y,l.z)}else for(let e=0,a=t.count;e<a;e+=3)r.fromBufferAttribute(t,e+0),n.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),c.subVectors(o,n),h.subVectors(r,n),c.cross(h),i.setXYZ(e+0,c.x,c.y,c.z),i.setXYZ(e+1,c.x,c.y,c.z),i.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Fn.fromBufferAttribute(e,t),Fn.normalize(),e.setXYZ(t,Fn.x,Fn.y,Fn.z)}toNonIndexed(){function e(e,t){const i=e.array,r=e.itemSize,n=e.normalized,o=new i.constructor(t.length*r);let a=0,s=0;for(let n=0,l=t.length;n<l;n++){a=e.isInterleavedBufferAttribute?t[n]*e.data.stride+e.offset:t[n]*r;for(let e=0;e<r;e++)o[s++]=i[a++]}return new Sn(o,r,n)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Qn,i=this.index.array,r=this.attributes;for(const n in r){const o=e(r[n],i);t.setAttribute(n,o)}const n=this.morphAttributes;for(const r in n){const o=[],a=n[r];for(let t=0,r=a.length;t<r;t++){const r=e(a[t],i);o.push(r)}t.morphAttributes[r]=o}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let e=0,i=o.length;e<i;e++){const i=o[e];t.addGroup(i.start,i.count,i.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const t in i){const r=i[t];e.data.attributes[t]=r.toJSON(e.data)}const r={};let n=!1;for(const t in this.morphAttributes){const i=this.morphAttributes[t],o=[];for(let t=0,r=i.length;t<r;t++){const r=i[t];o.push(r.toJSON(e.data))}o.length>0&&(r[t]=o,n=!0)}n&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;null!==i&&this.setIndex(i.clone(t));const r=e.attributes;for(const e in r){const i=r[e];this.setAttribute(e,i.clone(t))}const n=e.morphAttributes;for(const e in n){const i=[],r=n[e];for(let e=0,n=r.length;e<n;e++)i.push(r[e].clone(t));this.morphAttributes[e]=i}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let e=0,t=o.length;e<t;e++){const t=o[e];this.addGroup(t.start,t.count,t.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const s=e.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const zn=new Ir,Gn=new Lr,Nn=new kr,Un=new nr,jn=new nr,qn=new nr,Xn=new nr,Yn=new nr,Jn=new nr,Zn=new nr,Kn=new nr,eo=new nr,to=new _i,io=new _i,ro=new _i,no=new nr,oo=new nr;class ao extends sn{constructor(e=new Qn,t=new vn){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++){const t=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}raycast(e,t){const i=this.geometry,r=this.material,n=this.matrixWorld;if(void 0===r)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),Nn.copy(i.boundingSphere),Nn.applyMatrix4(n),!1===e.ray.intersectsSphere(Nn))return;if(zn.copy(n).invert(),Gn.copy(e.ray).applyMatrix4(zn),null!==i.boundingBox&&!1===Gn.intersectsBox(i.boundingBox))return;let o;const a=i.index,s=i.attributes.position,l=i.morphAttributes.position,c=i.morphTargetsRelative,h=i.attributes.uv,d=i.attributes.uv2,u=i.groups,p=i.drawRange;if(null!==a)if(Array.isArray(r))for(let i=0,n=u.length;i<n;i++){const n=u[i],m=r[n.materialIndex];for(let i=Math.max(n.start,p.start),r=Math.min(a.count,Math.min(n.start+n.count,p.start+p.count));i<r;i+=3){const r=a.getX(i),u=a.getX(i+1),p=a.getX(i+2);o=so(this,m,e,Gn,s,l,c,h,d,r,u,p),o&&(o.faceIndex=Math.floor(i/3),o.face.materialIndex=n.materialIndex,t.push(o))}}else{for(let i=Math.max(0,p.start),n=Math.min(a.count,p.start+p.count);i<n;i+=3){const n=a.getX(i),u=a.getX(i+1),p=a.getX(i+2);o=so(this,r,e,Gn,s,l,c,h,d,n,u,p),o&&(o.faceIndex=Math.floor(i/3),t.push(o))}}else if(void 0!==s)if(Array.isArray(r))for(let i=0,n=u.length;i<n;i++){const n=u[i],a=r[n.materialIndex];for(let i=Math.max(n.start,p.start),r=Math.min(s.count,Math.min(n.start+n.count,p.start+p.count));i<r;i+=3){o=so(this,a,e,Gn,s,l,c,h,d,i,i+1,i+2),o&&(o.faceIndex=Math.floor(i/3),o.face.materialIndex=n.materialIndex,t.push(o))}}else{for(let i=Math.max(0,p.start),n=Math.min(s.count,p.start+p.count);i<n;i+=3){o=so(this,r,e,Gn,s,l,c,h,d,i,i+1,i+2),o&&(o.faceIndex=Math.floor(i/3),t.push(o))}}}}function so(e,t,i,r,n,o,a,s,l,c,h,d){Un.fromBufferAttribute(n,c),jn.fromBufferAttribute(n,h),qn.fromBufferAttribute(n,d);const u=e.morphTargetInfluences;if(o&&u){Zn.set(0,0,0),Kn.set(0,0,0),eo.set(0,0,0);for(let e=0,t=o.length;e<t;e++){const t=u[e],i=o[e];0!==t&&(Xn.fromBufferAttribute(i,c),Yn.fromBufferAttribute(i,h),Jn.fromBufferAttribute(i,d),a?(Zn.addScaledVector(Xn,t),Kn.addScaledVector(Yn,t),eo.addScaledVector(Jn,t)):(Zn.addScaledVector(Xn.sub(Un),t),Kn.addScaledVector(Yn.sub(jn),t),eo.addScaledVector(Jn.sub(qn),t)))}Un.add(Zn),jn.add(Kn),qn.add(eo)}e.isSkinnedMesh&&(e.boneTransform(c,Un),e.boneTransform(h,jn),e.boneTransform(d,qn));const p=function(e,t,i,r,n,o,a,s){let l;if(l=t.side===m?r.intersectTriangle(a,o,n,!0,s):r.intersectTriangle(n,o,a,t.side!==f,s),null===l)return null;oo.copy(s),oo.applyMatrix4(e.matrixWorld);const c=i.ray.origin.distanceTo(oo);return c<i.near||c>i.far?null:{distance:c,point:oo.clone(),object:e}}(e,t,i,r,Un,jn,qn,no);if(p){s&&(to.fromBufferAttribute(s,c),io.fromBufferAttribute(s,h),ro.fromBufferAttribute(s,d),p.uv=bn.getUV(no,Un,jn,qn,to,io,ro,new _i)),l&&(to.fromBufferAttribute(l,c),io.fromBufferAttribute(l,h),ro.fromBufferAttribute(l,d),p.uv2=bn.getUV(no,Un,jn,qn,to,io,ro,new _i));const e={a:c,b:h,c:d,normal:new nr,materialIndex:0};bn.getNormal(Un,jn,qn,e.normal),p.face=e}return p}class lo extends Qn{constructor(e=1,t=1,i=1,r=1,n=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:o};const a=this;r=Math.floor(r),n=Math.floor(n),o=Math.floor(o);const s=[],l=[],c=[],h=[];let d=0,u=0;function p(e,t,i,r,n,o,p,m,f,g,x){const b=o/f,y=p/g,w=o/2,v=p/2,$=m/2,M=f+1,S=g+1;let P=0,k=0;const _=new nr;for(let o=0;o<S;o++){const a=o*y-v;for(let s=0;s<M;s++){const d=s*b-w;_[e]=d*r,_[t]=a*n,_[i]=$,l.push(_.x,_.y,_.z),_[e]=0,_[t]=0,_[i]=m>0?1:-1,c.push(_.x,_.y,_.z),h.push(s/f),h.push(1-o/g),P+=1}}for(let e=0;e<g;e++)for(let t=0;t<f;t++){const i=d+t+M*e,r=d+t+M*(e+1),n=d+(t+1)+M*(e+1),o=d+(t+1)+M*e;s.push(i,r,o),s.push(r,n,o),k+=6}a.addGroup(u,k,x),u+=k,d+=P}p("z","y","x",-1,-1,i,t,e,o,n,0),p("z","y","x",1,-1,i,t,-e,o,n,1),p("x","z","y",1,1,e,i,t,r,o,2),p("x","z","y",1,-1,e,i,-t,r,o,3),p("x","y","z",1,-1,e,t,i,r,n,4),p("x","y","z",-1,-1,e,t,-i,r,n,5),this.setIndex(s),this.setAttribute("position",new En(l,3)),this.setAttribute("normal",new En(c,3)),this.setAttribute("uv",new En(h,2))}static fromJSON(e){return new lo(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function co(e){const t={};for(const i in e){t[i]={};for(const r in e[i]){const n=e[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}}return t}function ho(e){const t={};for(let i=0;i<e.length;i++){const r=co(e[i]);for(const e in r)t[e]=r[e]}return t}const uo={clone:co,merge:ho};class po extends wn{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=co(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const r=this.uniforms[i].value;r&&r.isTexture?t.uniforms[i]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[i]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[i]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[i]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[i]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[i]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[i]={type:"m4",value:r.toArray()}:t.uniforms[i]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const e in this.extensions)!0===this.extensions[e]&&(i[e]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class mo extends sn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ir,this.projectionMatrix=new Ir,this.projectionMatrixInverse=new Ir}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class fo extends mo{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*gi*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*fi*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*gi*Math.atan(Math.tan(.5*fi*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,n,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*fi*this.fov)/this.zoom,i=2*t,r=this.aspect*i,n=-.5*r;const o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,a=o.fullHeight;n+=o.offsetX*r/e,t-=o.offsetY*i/a,r*=o.width/e,i*=o.height/a}const a=this.filmOffset;0!==a&&(n+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const go=90;class xo extends sn{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;const r=new fo(go,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new nr(1,0,0)),this.add(r);const n=new fo(go,1,e,t);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new nr(-1,0,0)),this.add(n);const o=new fo(go,1,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new nr(0,1,0)),this.add(o);const a=new fo(go,1,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new nr(0,-1,0)),this.add(a);const s=new fo(go,1,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new nr(0,0,1)),this.add(s);const l=new fo(go,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new nr(0,0,-1)),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[r,n,o,a,s,l]=this.children,c=e.getRenderTarget(),h=e.toneMapping,d=e.xr.enabled;e.toneMapping=X,e.xr.enabled=!1;const u=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,n),e.setRenderTarget(i,2),e.render(t,o),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,s),i.texture.generateMipmaps=u,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(c),e.toneMapping=h,e.xr.enabled=d,i.texture.needsPMREMUpdate=!0}}class bo extends Xi{constructor(e,t,i,r,n,o,a,s,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:ie,i,r,n,o,a,s,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class yo extends Ji{constructor(e,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new bo(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:fe}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},r=new lo(5,5,5),n=new po({name:"CubemapFromEquirect",uniforms:co(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:m,blending:g});n.uniforms.tEquirect.value=t;const o=new ao(r,n),a=t.minFilter;t.minFilter===be&&(t.minFilter=fe);return new xo(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,r){const n=e.getRenderTarget();for(let n=0;n<6;n++)e.setRenderTarget(this,n),e.clear(t,i,r);e.setRenderTarget(n)}}const wo=new nr,vo=new nr,$o=new Ti;class Mo{constructor(e=new nr(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=wo.subVectors(i,t).cross(vo.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const i=e.delta(wo),r=this.normal.dot(i);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const n=-(e.start.dot(this.normal)+this.constant)/r;return n<0||n>1?null:t.copy(i).multiplyScalar(n).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||$o.getNormalMatrix(e),r=this.coplanarPoint(wo).applyMatrix4(e),n=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(n),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const So=new kr,Po=new nr;class ko{constructor(e=new Mo,t=new Mo,i=new Mo,r=new Mo,n=new Mo,o=new Mo){this.planes=[e,t,i,r,n,o]}set(e,t,i,r,n,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(n),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,r=i[0],n=i[1],o=i[2],a=i[3],s=i[4],l=i[5],c=i[6],h=i[7],d=i[8],u=i[9],p=i[10],m=i[11],f=i[12],g=i[13],x=i[14],b=i[15];return t[0].setComponents(a-r,h-s,m-d,b-f).normalize(),t[1].setComponents(a+r,h+s,m+d,b+f).normalize(),t[2].setComponents(a+n,h+l,m+u,b+g).normalize(),t[3].setComponents(a-n,h-l,m-u,b-g).normalize(),t[4].setComponents(a-o,h-c,m-p,b-x).normalize(),t[5].setComponents(a+o,h+c,m+p,b+x).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),So.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(So)}intersectsSprite(e){return So.center.set(0,0,0),So.radius=.7071067811865476,So.applyMatrix4(e.matrixWorld),this.intersectsSphere(So)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let e=0;e<6;e++){if(t[e].distanceToPoint(i)<r)return!1}return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(Po.x=r.normal.x>0?e.max.x:e.min.x,Po.y=r.normal.y>0?e.max.y:e.min.y,Po.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Po)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function _o(){let e=null,t=!1,i=null,r=null;function n(t,o){i(t,o),r=e.requestAnimationFrame(n)}return{start:function(){!0!==t&&null!==i&&(r=e.requestAnimationFrame(n),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){i=e},setContext:function(t){e=t}}}function To(e,t){const i=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const i=r.get(t);i&&(e.deleteBuffer(i.buffer),r.delete(t))},update:function(t,n){if(t.isGLBufferAttribute){const e=r.get(t);return void((!e||e.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const o=r.get(t);void 0===o?r.set(t,function(t,r){const n=t.array,o=t.usage,a=e.createBuffer();let s;if(e.bindBuffer(r,a),e.bufferData(r,n,o),t.onUploadCallback(),n instanceof Float32Array)s=5126;else if(n instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!i)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");s=5131}else s=5123;else if(n instanceof Int16Array)s=5122;else if(n instanceof Uint32Array)s=5125;else if(n instanceof Int32Array)s=5124;else if(n instanceof Int8Array)s=5120;else if(n instanceof Uint8Array)s=5121;else{if(!(n instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+n);s=5121}return{buffer:a,type:s,bytesPerElement:n.BYTES_PER_ELEMENT,version:t.version}}(t,n)):o.version<t.version&&(!function(t,r,n){const o=r.array,a=r.updateRange;e.bindBuffer(n,t),-1===a.count?e.bufferSubData(n,0,o):(i?e.bufferSubData(n,a.offset*o.BYTES_PER_ELEMENT,o,a.offset,a.count):e.bufferSubData(n,a.offset*o.BYTES_PER_ELEMENT,o.subarray(a.offset,a.offset+a.count)),a.count=-1)}(o.buffer,t,n),o.version=t.version)}}}class Co extends Qn{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const n=e/2,o=t/2,a=Math.floor(i),s=Math.floor(r),l=a+1,c=s+1,h=e/a,d=t/s,u=[],p=[],m=[],f=[];for(let e=0;e<c;e++){const t=e*d-o;for(let i=0;i<l;i++){const r=i*h-n;p.push(r,-t,0),m.push(0,0,1),f.push(i/a),f.push(1-e/s)}}for(let e=0;e<s;e++)for(let t=0;t<a;t++){const i=t+l*e,r=t+l*(e+1),n=t+1+l*(e+1),o=t+1+l*e;u.push(i,r,o),u.push(r,n,o)}this.setIndex(u),this.setAttribute("position",new En(p,3)),this.setAttribute("normal",new En(m,3)),this.setAttribute("uv",new En(f,2))}static fromJSON(e){return new Co(e.width,e.height,e.widthSegments,e.heightSegments)}}const Ao={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n\tvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert\n#define Material_LightProbeLOD( material )\t(0)",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n\t#endif\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Do={common:{diffuse:{value:new zi(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ti},uv2Transform:{value:new Ti},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new _i(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new zi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new zi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ti}},sprite:{diffuse:{value:new zi(16777215)},opacity:{value:1},center:{value:new _i(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ti}}},Ro={basic:{uniforms:ho([Do.common,Do.specularmap,Do.envmap,Do.aomap,Do.lightmap,Do.fog]),vertexShader:Ao.meshbasic_vert,fragmentShader:Ao.meshbasic_frag},lambert:{uniforms:ho([Do.common,Do.specularmap,Do.envmap,Do.aomap,Do.lightmap,Do.emissivemap,Do.bumpmap,Do.normalmap,Do.displacementmap,Do.fog,Do.lights,{emissive:{value:new zi(0)}}]),vertexShader:Ao.meshlambert_vert,fragmentShader:Ao.meshlambert_frag},phong:{uniforms:ho([Do.common,Do.specularmap,Do.envmap,Do.aomap,Do.lightmap,Do.emissivemap,Do.bumpmap,Do.normalmap,Do.displacementmap,Do.fog,Do.lights,{emissive:{value:new zi(0)},specular:{value:new zi(1118481)},shininess:{value:30}}]),vertexShader:Ao.meshphong_vert,fragmentShader:Ao.meshphong_frag},standard:{uniforms:ho([Do.common,Do.envmap,Do.aomap,Do.lightmap,Do.emissivemap,Do.bumpmap,Do.normalmap,Do.displacementmap,Do.roughnessmap,Do.metalnessmap,Do.fog,Do.lights,{emissive:{value:new zi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ao.meshphysical_vert,fragmentShader:Ao.meshphysical_frag},toon:{uniforms:ho([Do.common,Do.aomap,Do.lightmap,Do.emissivemap,Do.bumpmap,Do.normalmap,Do.displacementmap,Do.gradientmap,Do.fog,Do.lights,{emissive:{value:new zi(0)}}]),vertexShader:Ao.meshtoon_vert,fragmentShader:Ao.meshtoon_frag},matcap:{uniforms:ho([Do.common,Do.bumpmap,Do.normalmap,Do.displacementmap,Do.fog,{matcap:{value:null}}]),vertexShader:Ao.meshmatcap_vert,fragmentShader:Ao.meshmatcap_frag},points:{uniforms:ho([Do.points,Do.fog]),vertexShader:Ao.points_vert,fragmentShader:Ao.points_frag},dashed:{uniforms:ho([Do.common,Do.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ao.linedashed_vert,fragmentShader:Ao.linedashed_frag},depth:{uniforms:ho([Do.common,Do.displacementmap]),vertexShader:Ao.depth_vert,fragmentShader:Ao.depth_frag},normal:{uniforms:ho([Do.common,Do.bumpmap,Do.normalmap,Do.displacementmap,{opacity:{value:1}}]),vertexShader:Ao.meshnormal_vert,fragmentShader:Ao.meshnormal_frag},sprite:{uniforms:ho([Do.sprite,Do.fog]),vertexShader:Ao.sprite_vert,fragmentShader:Ao.sprite_frag},background:{uniforms:{uvTransform:{value:new Ti},t2D:{value:null}},vertexShader:Ao.background_vert,fragmentShader:Ao.background_frag},cube:{uniforms:ho([Do.envmap,{opacity:{value:1}}]),vertexShader:Ao.cube_vert,fragmentShader:Ao.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ao.equirect_vert,fragmentShader:Ao.equirect_frag},distanceRGBA:{uniforms:ho([Do.common,Do.displacementmap,{referencePosition:{value:new nr},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ao.distanceRGBA_vert,fragmentShader:Ao.distanceRGBA_frag},shadow:{uniforms:ho([Do.lights,Do.fog,{color:{value:new zi(0)},opacity:{value:1}}]),vertexShader:Ao.shadow_vert,fragmentShader:Ao.shadow_frag}};function Eo(e,t,i,r,n,o){const a=new zi(0);let s,l,c=!0===n?0:1,h=null,d=0,u=null;function f(e,t){i.buffers.color.setClear(e.r,e.g,e.b,t,o)}return{getClearColor:function(){return a},setClearColor:function(e,t=1){a.set(e),c=t,f(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(e){c=e,f(a,c)},render:function(i,n){let o=!1,g=!0===n.isScene?n.background:null;g&&g.isTexture&&(g=t.get(g));const x=e.xr,b=x.getSession&&x.getSession();b&&"additive"===b.environmentBlendMode&&(g=null),null===g?f(a,c):g&&g.isColor&&(f(g,1),o=!0),(e.autoClear||o)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),g&&(g.isCubeTexture||g.mapping===ae)?(void 0===l&&(l=new ao(new lo(1,1,1),new po({name:"BackgroundCubeMaterial",uniforms:co(Ro.cube.uniforms),vertexShader:Ro.cube.vertexShader,fragmentShader:Ro.cube.fragmentShader,side:m,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(l)),l.material.uniforms.envMap.value=g,l.material.uniforms.flipEnvMap.value=g.isCubeTexture&&!1===g.isRenderTargetTexture?-1:1,h===g&&d===g.version&&u===e.toneMapping||(l.material.needsUpdate=!0,h=g,d=g.version,u=e.toneMapping),l.layers.enableAll(),i.unshift(l,l.geometry,l.material,0,0,null)):g&&g.isTexture&&(void 0===s&&(s=new ao(new Co(2,2),new po({name:"BackgroundMaterial",uniforms:co(Ro.background.uniforms),vertexShader:Ro.background.vertexShader,fragmentShader:Ro.background.fragmentShader,side:p,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(s)),s.material.uniforms.t2D.value=g,!0===g.matrixAutoUpdate&&g.updateMatrix(),s.material.uniforms.uvTransform.value.copy(g.matrix),h===g&&d===g.version&&u===e.toneMapping||(s.material.needsUpdate=!0,h=g,d=g.version,u=e.toneMapping),s.layers.enableAll(),i.unshift(s,s.geometry,s.material,0,0,null))}}}function Lo(e,t,i,r){const n=e.getParameter(34921),o=r.isWebGL2?null:t.get("OES_vertex_array_object"),a=r.isWebGL2||null!==o,s={},l=p(null);let c=l,h=!1;function d(t){return r.isWebGL2?e.bindVertexArray(t):o.bindVertexArrayOES(t)}function u(t){return r.isWebGL2?e.deleteVertexArray(t):o.deleteVertexArrayOES(t)}function p(e){const t=[],i=[],r=[];for(let e=0;e<n;e++)t[e]=0,i[e]=0,r[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:r,object:e,attributes:{},index:null}}function m(){const e=c.newAttributes;for(let t=0,i=e.length;t<i;t++)e[t]=0}function f(e){g(e,0)}function g(i,n){const o=c.newAttributes,a=c.enabledAttributes,s=c.attributeDivisors;if(o[i]=1,0===a[i]&&(e.enableVertexAttribArray(i),a[i]=1),s[i]!==n){(r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,n),s[i]=n}}function x(){const t=c.newAttributes,i=c.enabledAttributes;for(let r=0,n=i.length;r<n;r++)i[r]!==t[r]&&(e.disableVertexAttribArray(r),i[r]=0)}function b(t,i,n,o,a,s){!0!==r.isWebGL2||5124!==n&&5125!==n?e.vertexAttribPointer(t,i,n,o,a,s):e.vertexAttribIPointer(t,i,n,a,s)}function y(){w(),h=!0,c!==l&&(c=l,d(c.object))}function w(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(n,l,u,y,w){let v=!1;if(a){const t=function(t,i,n){const a=!0===n.wireframe;let l=s[t.id];void 0===l&&(l={},s[t.id]=l);let c=l[i.id];void 0===c&&(c={},l[i.id]=c);let h=c[a];void 0===h&&(h=p(r.isWebGL2?e.createVertexArray():o.createVertexArrayOES()),c[a]=h);return h}(y,u,l);c!==t&&(c=t,d(c.object)),v=function(e,t,i,r){const n=c.attributes,o=t.attributes;let a=0;const s=i.getAttributes();for(const t in s){if(s[t].location>=0){const i=n[t];let r=o[t];if(void 0===r&&("instanceMatrix"===t&&e.instanceMatrix&&(r=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(r=e.instanceColor)),void 0===i)return!0;if(i.attribute!==r)return!0;if(r&&i.data!==r.data)return!0;a++}}return c.attributesNum!==a||c.index!==r}(n,y,u,w),v&&function(e,t,i,r){const n={},o=t.attributes;let a=0;const s=i.getAttributes();for(const t in s){if(s[t].location>=0){let i=o[t];void 0===i&&("instanceMatrix"===t&&e.instanceMatrix&&(i=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(i=e.instanceColor));const r={};r.attribute=i,i&&i.data&&(r.data=i.data),n[t]=r,a++}}c.attributes=n,c.attributesNum=a,c.index=r}(n,y,u,w)}else{const e=!0===l.wireframe;c.geometry===y.id&&c.program===u.id&&c.wireframe===e||(c.geometry=y.id,c.program=u.id,c.wireframe=e,v=!0)}null!==w&&i.update(w,34963),(v||h)&&(h=!1,function(n,o,a,s){if(!1===r.isWebGL2&&(n.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;m();const l=s.attributes,c=a.getAttributes(),h=o.defaultAttributeValues;for(const t in c){const r=c[t];if(r.location>=0){let o=l[t];if(void 0===o&&("instanceMatrix"===t&&n.instanceMatrix&&(o=n.instanceMatrix),"instanceColor"===t&&n.instanceColor&&(o=n.instanceColor)),void 0!==o){const t=o.normalized,a=o.itemSize,l=i.get(o);if(void 0===l)continue;const c=l.buffer,h=l.type,d=l.bytesPerElement;if(o.isInterleavedBufferAttribute){const i=o.data,l=i.stride,u=o.offset;if(i.isInstancedInterleavedBuffer){for(let e=0;e<r.locationSize;e++)g(r.location+e,i.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let e=0;e<r.locationSize;e++)f(r.location+e);e.bindBuffer(34962,c);for(let e=0;e<r.locationSize;e++)b(r.location+e,a/r.locationSize,h,t,l*d,(u+a/r.locationSize*e)*d)}else{if(o.isInstancedBufferAttribute){for(let e=0;e<r.locationSize;e++)g(r.location+e,o.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=o.meshPerAttribute*o.count)}else for(let e=0;e<r.locationSize;e++)f(r.location+e);e.bindBuffer(34962,c);for(let e=0;e<r.locationSize;e++)b(r.location+e,a/r.locationSize,h,t,a*d,a/r.locationSize*e*d)}}else if(void 0!==h){const i=h[t];if(void 0!==i)switch(i.length){case 2:e.vertexAttrib2fv(r.location,i);break;case 3:e.vertexAttrib3fv(r.location,i);break;case 4:e.vertexAttrib4fv(r.location,i);break;default:e.vertexAttrib1fv(r.location,i)}}}}x()}(n,l,u,y),null!==w&&e.bindBuffer(34963,i.get(w).buffer))},reset:y,resetDefaultState:w,dispose:function(){y();for(const e in s){const t=s[e];for(const e in t){const i=t[e];for(const e in i)u(i[e].object),delete i[e];delete t[e]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0===s[e.id])return;const t=s[e.id];for(const e in t){const i=t[e];for(const e in i)u(i[e].object),delete i[e];delete t[e]}delete s[e.id]},releaseStatesOfProgram:function(e){for(const t in s){const i=s[t];if(void 0===i[e.id])continue;const r=i[e.id];for(const e in r)u(r[e].object),delete r[e];delete i[e.id]}},initAttributes:m,enableAttribute:f,disableUnusedAttributes:x}}function Io(e,t,i,r){const n=r.isWebGL2;let o;this.setMode=function(e){o=e},this.render=function(t,r){e.drawArrays(o,t,r),i.update(r,o,1)},this.renderInstances=function(r,a,s){if(0===s)return;let l,c;if(n)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](o,r,a,s),i.update(a,o,s)}}function Bo(e,t,i){let r;function n(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let a=void 0!==i.precision?i.precision:"highp";const s=n(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);const l=o||t.has("WEBGL_draw_buffers"),c=!0===i.logarithmicDepthBuffer,h=e.getParameter(34930),d=e.getParameter(35660),u=e.getParameter(3379),p=e.getParameter(34076),m=e.getParameter(34921),f=e.getParameter(36347),g=e.getParameter(36348),x=e.getParameter(36349),b=d>0,y=o||t.has("OES_texture_float");return{isWebGL2:o,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){const i=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:n,precision:a,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:d,maxTextureSize:u,maxCubemapSize:p,maxAttributes:m,maxVertexUniforms:f,maxVaryings:g,maxFragmentUniforms:x,vertexTextures:b,floatFragmentTextures:y,floatVertexTextures:b&&y,maxSamples:o?e.getParameter(36183):0}}function Vo(e){const t=this;let i=null,r=0,n=!1,o=!1;const a=new Mo,s=new Ti,l={value:null,needsUpdate:!1};function c(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function h(e,i,r,n){const o=null!==e?e.length:0;let c=null;if(0!==o){if(c=l.value,!0!==n||null===c){const t=r+4*o,n=i.matrixWorldInverse;s.getNormalMatrix(n),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,i=r;t!==o;++t,i+=4)a.copy(e[t]).applyMatrix4(n,s),a.normal.toArray(c,i),c[i+3]=a.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=o,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,o){const a=0!==e.length||t||0!==r||n;return n=t,i=h(e,o,0),r=e.length,a},this.beginShadows=function(){o=!0,h(null)},this.endShadows=function(){o=!1,c()},this.setState=function(t,a,s){const d=t.clippingPlanes,u=t.clipIntersection,p=t.clipShadows,m=e.get(t);if(!n||null===d||0===d.length||o&&!p)o?h(null):c();else{const e=o?0:r,t=4*e;let n=m.clippingState||null;l.value=n,n=h(d,a,t,s);for(let e=0;e!==t;++e)n[e]=i[e];m.clippingState=n,this.numIntersection=u?this.numPlanes:0,this.numPlanes+=e}}}function Oo(e){let t=new WeakMap;function i(e,t){return t===ne?e.mapping=ie:t===oe&&(e.mapping=re),e}function r(e){const i=e.target;i.removeEventListener("dispose",r);const n=t.get(i);void 0!==n&&(t.delete(i),n.dispose())}return{get:function(n){if(n&&n.isTexture&&!1===n.isRenderTargetTexture){const o=n.mapping;if(o===ne||o===oe){if(t.has(n)){return i(t.get(n).texture,n.mapping)}{const o=n.image;if(o&&o.height>0){const a=new yo(o.height/2);return a.fromEquirectangularTexture(e,n),t.set(n,a),n.addEventListener("dispose",r),i(a.texture,n.mapping)}return null}}}return n},dispose:function(){t=new WeakMap}}}Ro.physical={uniforms:ho([Ro.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new _i(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new zi(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new _i},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new zi(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new zi(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Ao.meshphysical_vert,fragmentShader:Ao.meshphysical_frag};class Wo extends mo{constructor(e=-1,t=1,i=1,r=-1,n=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=n,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,n,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let n=i-e,o=i+e,a=r+t,s=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=e*this.view.offsetX,o=n+e*this.view.width,a-=t*this.view.offsetY,s=a-t*this.view.height}this.projectionMatrix.makeOrthographic(n,o,a,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const Ho=[.125,.215,.35,.446,.526,.582],Fo=20,Qo=new Wo,zo=new zi;let Go=null;const No=(1+Math.sqrt(5))/2,Uo=1/No,jo=[new nr(1,1,1),new nr(-1,1,1),new nr(1,1,-1),new nr(-1,1,-1),new nr(0,No,Uo),new nr(0,No,-Uo),new nr(Uo,0,No),new nr(-Uo,0,No),new nr(No,Uo,0),new nr(-No,Uo,0)];class qo{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){Go=this._renderer.getRenderTarget(),this._setSize(256);const n=this._allocateTargets();return n.depthBuffer=!0,this._sceneToCubeUV(e,i,r,n),t>0&&this._blur(n,0,0,t),this._applyPMREM(n),this._cleanup(n),n}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Zo(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Jo(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Go),e.scissorTest=!1,Yo(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===ie||e.mapping===re?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Go=this._renderer.getRenderTarget();const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:fe,minFilter:fe,generateMipmaps:!1,type:_e,format:Ee,encoding:Ct,depthBuffer:!1},r=Xo(e,t,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Xo(e,t,i);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],i=[],r=[];let n=e;const o=e-4+1+Ho.length;for(let a=0;a<o;a++){const o=Math.pow(2,n);i.push(o);let s=1/o;a>e-4?s=Ho[a-e+4-1]:0===a&&(s=0),r.push(s);const l=1/(o-2),c=-l,h=1+l,d=[c,c,h,c,h,h,c,c,h,h,c,h],u=6,p=6,m=3,f=2,g=1,x=new Float32Array(m*p*u),b=new Float32Array(f*p*u),y=new Float32Array(g*p*u);for(let e=0;e<u;e++){const t=e%3*2/3-1,i=e>2?0:-1,r=[t,i,0,t+2/3,i,0,t+2/3,i+1,0,t,i,0,t+2/3,i+1,0,t,i+1,0];x.set(r,m*p*e),b.set(d,f*p*e);const n=[e,e,e,e,e,e];y.set(n,g*p*e)}const w=new Qn;w.setAttribute("position",new Sn(x,m)),w.setAttribute("uv",new Sn(b,f)),w.setAttribute("faceIndex",new Sn(y,g)),t.push(w),n>4&&n--}return{lodPlanes:t,sizeLods:i,sigmas:r}}(r)),this._blurMaterial=function(e,t,i){const r=new Float32Array(Fo),n=new nr(0,1,0);return new po({name:"SphericalGaussianBlur",defines:{n:Fo,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:Ko(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:g,depthTest:!1,depthWrite:!1})}(r,e,t)}return r}_compileMaterial(e){const t=new ao(this._lodPlanes[0],e);this._renderer.compile(t,Qo)}_sceneToCubeUV(e,t,i,r){const n=new fo(90,1,t,i),o=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],s=this._renderer,l=s.autoClear,c=s.toneMapping;s.getClearColor(zo),s.toneMapping=X,s.autoClear=!1;const h=new vn({name:"PMREM.Background",side:m,depthWrite:!1,depthTest:!1}),d=new ao(new lo,h);let u=!1;const p=e.background;p?p.isColor&&(h.color.copy(p),e.background=null,u=!0):(h.color.copy(zo),u=!0);for(let t=0;t<6;t++){const i=t%3;0===i?(n.up.set(0,o[t],0),n.lookAt(a[t],0,0)):1===i?(n.up.set(0,0,o[t]),n.lookAt(0,a[t],0)):(n.up.set(0,o[t],0),n.lookAt(0,0,a[t]));const l=this._cubeSize;Yo(r,i*l,t>2?l:0,l,l),s.setRenderTarget(r),u&&s.render(d,n),s.render(e,n)}d.geometry.dispose(),d.material.dispose(),s.toneMapping=c,s.autoClear=l,e.background=p}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===ie||e.mapping===re;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=Zo()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Jo());const n=r?this._cubemapMaterial:this._equirectMaterial,o=new ao(this._lodPlanes[0],n);n.uniforms.envMap.value=e;const a=this._cubeSize;Yo(t,0,0,3*a,2*a),i.setRenderTarget(t),i.render(o,Qo)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let t=1;t<this._lodPlanes.length;t++){const i=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),r=jo[(t-1)%jo.length];this._blur(e,t-1,t,i,r)}t.autoClear=i}_blur(e,t,i,r,n){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,r,"latitudinal",n),this._halfBlur(o,e,i,i,r,"longitudinal",n)}_halfBlur(e,t,i,r,n,o,a){const s=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new ao(this._lodPlanes[r],l),h=l.uniforms,d=this._sizeLods[i]-1,u=isFinite(n)?Math.PI/(2*d):2*Math.PI/39,p=n/u,m=isFinite(n)?1+Math.floor(3*p):Fo;m>Fo&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${m} samples when the maximum is set to 20`);const f=[];let g=0;for(let e=0;e<Fo;++e){const t=e/p,i=Math.exp(-t*t/2);f.push(i),0===e?g+=i:e<m&&(g+=2*i)}for(let e=0;e<f.length;e++)f[e]=f[e]/g;h.envMap.value=e.texture,h.samples.value=m,h.weights.value=f,h.latitudinal.value="latitudinal"===o,a&&(h.poleAxis.value=a);const{_lodMax:x}=this;h.dTheta.value=u,h.mipInt.value=x-i;const b=this._sizeLods[r];Yo(t,3*b*(r>x-4?r-x+4:0),4*(this._cubeSize-b),3*b,2*b),s.setRenderTarget(t),s.render(c,Qo)}}function Xo(e,t,i){const r=new Ji(e,t,i);return r.texture.mapping=ae,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Yo(e,t,i,r,n){e.viewport.set(t,i,r,n),e.scissor.set(t,i,r,n)}function Jo(){return new po({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Ko(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:g,depthTest:!1,depthWrite:!1})}function Zo(){return new po({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Ko(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:g,depthTest:!1,depthWrite:!1})}function Ko(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function ea(e){let t=new WeakMap,i=null;function r(e){const i=e.target;i.removeEventListener("dispose",r);const n=t.get(i);void 0!==n&&(t.delete(i),n.dispose())}return{get:function(n){if(n&&n.isTexture){const o=n.mapping,a=o===ne||o===oe,s=o===ie||o===re;if(a||s){if(n.isRenderTargetTexture&&!0===n.needsPMREMUpdate){n.needsPMREMUpdate=!1;let r=t.get(n);return null===i&&(i=new qo(e)),r=a?i.fromEquirectangular(n,r):i.fromCubemap(n,r),t.set(n,r),r.texture}if(t.has(n))return t.get(n).texture;{const o=n.image;if(a&&o&&o.height>0||s&&o&&function(e){let t=0;const i=6;for(let r=0;r<i;r++)void 0!==e[r]&&t++;return t===i}(o)){null===i&&(i=new qo(e));const o=a?i.fromEquirectangular(n):i.fromCubemap(n);return t.set(n,o),n.addEventListener("dispose",r),o.texture}return null}}}return n},dispose:function(){t=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function ta(e){const t={};function i(i){if(void 0!==t[i])return t[i];let r;switch(i){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(i)}return t[i]=r,r}return{has:function(e){return null!==i(e)},init:function(e){e.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(e){const t=i(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function ia(e,t,i,r){const n={},o=new WeakMap;function a(e){const s=e.target;null!==s.index&&t.remove(s.index);for(const e in s.attributes)t.remove(s.attributes[e]);s.removeEventListener("dispose",a),delete n[s.id];const l=o.get(s);l&&(t.remove(l),o.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,i.memory.geometries--}function s(e){const i=[],r=e.index,n=e.attributes.position;let a=0;if(null!==r){const e=r.array;a=r.version;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],n=e[t+1],o=e[t+2];i.push(r,n,n,o,o,r)}}else{const e=n.array;a=n.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,n=t+2;i.push(e,r,r,n,n,e)}}const s=new(Ci(i)?Dn:Cn)(i,1);s.version=a;const l=o.get(e);l&&t.remove(l),o.set(e,s)}return{get:function(e,t){return!0===n[t.id]||(t.addEventListener("dispose",a),n[t.id]=!0,i.memory.geometries++),t},update:function(e){const i=e.attributes;for(const e in i)t.update(i[e],34962);const r=e.morphAttributes;for(const e in r){const i=r[e];for(let e=0,r=i.length;e<r;e++)t.update(i[e],34962)}},getWireframeAttribute:function(e){const t=o.get(e);if(t){const i=e.index;null!==i&&t.version<i.version&&s(e)}else s(e);return o.get(e)}}}function ra(e,t,i,r){const n=r.isWebGL2;let o,a,s;this.setMode=function(e){o=e},this.setIndex=function(e){a=e.type,s=e.bytesPerElement},this.render=function(t,r){e.drawElements(o,r,a,t*s),i.update(r,o,1)},this.renderInstances=function(r,l,c){if(0===c)return;let h,d;if(n)h=e,d="drawElementsInstanced";else if(h=t.get("ANGLE_instanced_arrays"),d="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[d](o,l,a,r*s,c),i.update(l,o,c)}}function na(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,i,r){switch(t.calls++,i){case 4:t.triangles+=r*(e/3);break;case 1:t.lines+=r*(e/2);break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function oa(e,t){return e[0]-t[0]}function aa(e,t){return Math.abs(t[1])-Math.abs(e[1])}function sa(e,t,i){const r={},n=new Float32Array(8),o=new WeakMap,a=new Yi,s=[];for(let e=0;e<8;e++)s[e]=[e,0];return{update:function(l,c,h,d){const u=l.morphTargetInfluences;if(!0===t.isWebGL2){const r=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,n=void 0!==r?r.length:0;let s=o.get(c);if(void 0===s||s.count!==n){void 0!==s&&s.texture.dispose();const e=void 0!==c.morphAttributes.position,i=void 0!==c.morphAttributes.normal,r=void 0!==c.morphAttributes.color,l=c.morphAttributes.position||[],h=c.morphAttributes.normal||[],d=c.morphAttributes.color||[];let u=0;!0===e&&(u=1),!0===i&&(u=2),!0===r&&(u=3);let p=c.attributes.position.count*u,m=1;p>t.maxTextureSize&&(m=Math.ceil(p/t.maxTextureSize),p=t.maxTextureSize);const f=new Float32Array(p*m*4*n),g=new Zi(f,p,m,n);g.type=ke,g.needsUpdate=!0;const x=4*u;for(let t=0;t<n;t++){const n=l[t],o=h[t],s=d[t],c=p*m*4*t;for(let t=0;t<n.count;t++){const l=t*x;!0===e&&(a.fromBufferAttribute(n,t),f[c+l+0]=a.x,f[c+l+1]=a.y,f[c+l+2]=a.z,f[c+l+3]=0),!0===i&&(a.fromBufferAttribute(o,t),f[c+l+4]=a.x,f[c+l+5]=a.y,f[c+l+6]=a.z,f[c+l+7]=0),!0===r&&(a.fromBufferAttribute(s,t),f[c+l+8]=a.x,f[c+l+9]=a.y,f[c+l+10]=a.z,f[c+l+11]=4===s.itemSize?a.w:1)}}s={count:n,texture:g,size:new _i(p,m)},o.set(c,s),c.addEventListener("dispose",(function e(){g.dispose(),o.delete(c),c.removeEventListener("dispose",e)}))}let l=0;for(let e=0;e<u.length;e++)l+=u[e];const h=c.morphTargetsRelative?1:1-l;d.getUniforms().setValue(e,"morphTargetBaseInfluence",h),d.getUniforms().setValue(e,"morphTargetInfluences",u),d.getUniforms().setValue(e,"morphTargetsTexture",s.texture,i),d.getUniforms().setValue(e,"morphTargetsTextureSize",s.size)}else{const t=void 0===u?0:u.length;let i=r[c.id];if(void 0===i||i.length!==t){i=[];for(let e=0;e<t;e++)i[e]=[e,0];r[c.id]=i}for(let e=0;e<t;e++){const t=i[e];t[0]=e,t[1]=u[e]}i.sort(aa);for(let e=0;e<8;e++)e<t&&i[e][1]?(s[e][0]=i[e][0],s[e][1]=i[e][1]):(s[e][0]=Number.MAX_SAFE_INTEGER,s[e][1]=0);s.sort(oa);const o=c.morphAttributes.position,a=c.morphAttributes.normal;let l=0;for(let e=0;e<8;e++){const t=s[e],i=t[0],r=t[1];i!==Number.MAX_SAFE_INTEGER&&r?(o&&c.getAttribute("morphTarget"+e)!==o[i]&&c.setAttribute("morphTarget"+e,o[i]),a&&c.getAttribute("morphNormal"+e)!==a[i]&&c.setAttribute("morphNormal"+e,a[i]),n[e]=r,l+=r):(o&&!0===c.hasAttribute("morphTarget"+e)&&c.deleteAttribute("morphTarget"+e),a&&!0===c.hasAttribute("morphNormal"+e)&&c.deleteAttribute("morphNormal"+e),n[e]=0)}const h=c.morphTargetsRelative?1:1-l;d.getUniforms().setValue(e,"morphTargetBaseInfluence",h),d.getUniforms().setValue(e,"morphTargetInfluences",n)}}}}function la(e,t,i,r){let n=new WeakMap;function o(e){const t=e.target;t.removeEventListener("dispose",o),i.remove(t.instanceMatrix),null!==t.instanceColor&&i.remove(t.instanceColor)}return{update:function(e){const a=r.render.frame,s=e.geometry,l=t.get(e,s);return n.get(l)!==a&&(t.update(l),n.set(l,a)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",o)&&e.addEventListener("dispose",o),i.update(e.instanceMatrix,34962),null!==e.instanceColor&&i.update(e.instanceColor,34962)),l},dispose:function(){n=new WeakMap}}}const ca=new Xi,ha=new Zi,da=new er,ua=new bo,pa=[],ma=[],fa=new Float32Array(16),ga=new Float32Array(9),xa=new Float32Array(4);function ba(e,t,i){const r=e[0];if(r<=0||r>0)return e;const n=t*i;let o=pa[n];if(void 0===o&&(o=new Float32Array(n),pa[n]=o),0!==t){r.toArray(o,0);for(let r=1,n=0;r!==t;++r)n+=i,e[r].toArray(o,n)}return o}function ya(e,t){if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function wa(e,t){for(let i=0,r=t.length;i<r;i++)e[i]=t[i]}function va(e,t){let i=ma[t];void 0===i&&(i=new Int32Array(t),ma[t]=i);for(let r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function $a(e,t){const i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function Ma(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(ya(i,t))return;e.uniform2fv(this.addr,t),wa(i,t)}}function Sa(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)i[0]===t.r&&i[1]===t.g&&i[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(ya(i,t))return;e.uniform3fv(this.addr,t),wa(i,t)}}function Pa(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(ya(i,t))return;e.uniform4fv(this.addr,t),wa(i,t)}}function ka(e,t){const i=this.cache,r=t.elements;if(void 0===r){if(ya(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),wa(i,t)}else{if(ya(i,r))return;xa.set(r),e.uniformMatrix2fv(this.addr,!1,xa),wa(i,r)}}function _a(e,t){const i=this.cache,r=t.elements;if(void 0===r){if(ya(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),wa(i,t)}else{if(ya(i,r))return;ga.set(r),e.uniformMatrix3fv(this.addr,!1,ga),wa(i,r)}}function Ta(e,t){const i=this.cache,r=t.elements;if(void 0===r){if(ya(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),wa(i,t)}else{if(ya(i,r))return;fa.set(r),e.uniformMatrix4fv(this.addr,!1,fa),wa(i,r)}}function Ca(e,t){const i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function Aa(e,t){const i=this.cache;ya(i,t)||(e.uniform2iv(this.addr,t),wa(i,t))}function Da(e,t){const i=this.cache;ya(i,t)||(e.uniform3iv(this.addr,t),wa(i,t))}function Ra(e,t){const i=this.cache;ya(i,t)||(e.uniform4iv(this.addr,t),wa(i,t))}function Ea(e,t){const i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function La(e,t){const i=this.cache;ya(i,t)||(e.uniform2uiv(this.addr,t),wa(i,t))}function Ia(e,t){const i=this.cache;ya(i,t)||(e.uniform3uiv(this.addr,t),wa(i,t))}function Ba(e,t){const i=this.cache;ya(i,t)||(e.uniform4uiv(this.addr,t),wa(i,t))}function Va(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2D(t||ca,n)}function Oa(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(t||da,n)}function Wa(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(t||ua,n)}function Ha(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(t||ha,n)}function Fa(e,t){e.uniform1fv(this.addr,t)}function Qa(e,t){const i=ba(t,this.size,2);e.uniform2fv(this.addr,i)}function za(e,t){const i=ba(t,this.size,3);e.uniform3fv(this.addr,i)}function Ga(e,t){const i=ba(t,this.size,4);e.uniform4fv(this.addr,i)}function Na(e,t){const i=ba(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function Ua(e,t){const i=ba(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function ja(e,t){const i=ba(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function qa(e,t){e.uniform1iv(this.addr,t)}function Xa(e,t){e.uniform2iv(this.addr,t)}function Ya(e,t){e.uniform3iv(this.addr,t)}function Ja(e,t){e.uniform4iv(this.addr,t)}function Za(e,t){e.uniform1uiv(this.addr,t)}function Ka(e,t){e.uniform2uiv(this.addr,t)}function es(e,t){e.uniform3uiv(this.addr,t)}function ts(e,t){e.uniform4uiv(this.addr,t)}function is(e,t,i){const r=t.length,n=va(i,r);e.uniform1iv(this.addr,n);for(let e=0;e!==r;++e)i.setTexture2D(t[e]||ca,n[e])}function rs(e,t,i){const r=t.length,n=va(i,r);e.uniform1iv(this.addr,n);for(let e=0;e!==r;++e)i.setTexture3D(t[e]||da,n[e])}function ns(e,t,i){const r=t.length,n=va(i,r);e.uniform1iv(this.addr,n);for(let e=0;e!==r;++e)i.setTextureCube(t[e]||ua,n[e])}function os(e,t,i){const r=t.length,n=va(i,r);e.uniform1iv(this.addr,n);for(let e=0;e!==r;++e)i.setTexture2DArray(t[e]||ha,n[e])}class as{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function(e){switch(e){case 5126:return $a;case 35664:return Ma;case 35665:return Sa;case 35666:return Pa;case 35674:return ka;case 35675:return _a;case 35676:return Ta;case 5124:case 35670:return Ca;case 35667:case 35671:return Aa;case 35668:case 35672:return Da;case 35669:case 35673:return Ra;case 5125:return Ea;case 36294:return La;case 36295:return Ia;case 36296:return Ba;case 35678:case 36198:case 36298:case 36306:case 35682:return Va;case 35679:case 36299:case 36307:return Oa;case 35680:case 36300:case 36308:case 36293:return Wa;case 36289:case 36303:case 36311:case 36292:return Ha}}(t.type)}}class ss{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Fa;case 35664:return Qa;case 35665:return za;case 35666:return Ga;case 35674:return Na;case 35675:return Ua;case 35676:return ja;case 5124:case 35670:return qa;case 35667:case 35671:return Xa;case 35668:case 35672:return Ya;case 35669:case 35673:return Ja;case 5125:return Za;case 36294:return Ka;case 36295:return es;case 36296:return ts;case 35678:case 36198:case 36298:case 36306:case 35682:return is;case 35679:case 36299:case 36307:return rs;case 35680:case 36300:case 36308:case 36293:return ns;case 36289:case 36303:case 36311:case 36292:return os}}(t.type)}}class ls{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const r=this.seq;for(let n=0,o=r.length;n!==o;++n){const o=r[n];o.setValue(e,t[o.id],i)}}}const cs=/(\w+)(\])?(\[|\.)?/g;function hs(e,t){e.seq.push(t),e.map[t.id]=t}function ds(e,t,i){const r=e.name,n=r.length;for(cs.lastIndex=0;;){const o=cs.exec(r),a=cs.lastIndex;let s=o[1];const l="]"===o[2],c=o[3];if(l&&(s|=0),void 0===c||"["===c&&a+2===n){hs(i,void 0===c?new as(s,e,t):new ss(s,e,t));break}{let e=i.map[s];void 0===e&&(e=new ls(s),hs(i,e)),i=e}}}class us{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,35718);for(let r=0;r<i;++r){const i=e.getActiveUniform(t,r);ds(i,e.getUniformLocation(t,i.name),this)}}setValue(e,t,i,r){const n=this.map[t];void 0!==n&&n.setValue(e,i,r)}setOptional(e,t,i){const r=t[i];void 0!==r&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let n=0,o=t.length;n!==o;++n){const o=t[n],a=i[o.id];!1!==a.needsUpdate&&o.setValue(e,a.value,r)}}static seqWithValue(e,t){const i=[];for(let r=0,n=e.length;r!==n;++r){const n=e[r];n.id in t&&i.push(n)}return i}}function ps(e,t,i){const r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}let ms=0;function fs(e,t,i){const r=e.getShaderParameter(t,35713),n=e.getShaderInfoLog(t).trim();if(r&&""===n)return"";const o=/ERROR: 0:(\d+)/.exec(n);if(o){const r=parseInt(o[1]);return i.toUpperCase()+"\n\n"+n+"\n\n"+function(e,t){const i=e.split("\n"),r=[],n=Math.max(t-6,0),o=Math.min(t+6,i.length);for(let e=n;e<o;e++){const n=e+1;r.push(`${n===t?">":" "} ${n}: ${i[e]}`)}return r.join("\n")}(e.getShaderSource(t),r)}return n}function gs(e,t){const i=function(e){switch(e){case Ct:return["Linear","( value )"];case At:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function xs(e,t){let i;switch(t){case Y:i="Linear";break;case J:i="Reinhard";break;case Z:i="OptimizedCineon";break;case K:i="ACESFilmic";break;case ee:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function bs(e){return""!==e}function ys(e,t){const i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function ws(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const vs=/^[ \t]*#include +<([\w\d./]+)>/gm;function $s(e){return e.replace(vs,Ms)}function Ms(e,t){const i=Ao[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return $s(i)}const Ss=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Ps(e){return e.replace(Ss,ks)}function ks(e,t,i,r){let n="";for(let e=parseInt(t);e<parseInt(i);e++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return n}function _s(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Ts(e,t,i,r){const n=e.getContext(),o=i.defines;let a=i.vertexShader,s=i.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===h?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===d?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===u&&(t="SHADOWMAP_TYPE_VSM"),t}(i),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case ie:case re:t="ENVMAP_TYPE_CUBE";break;case ae:t="ENVMAP_TYPE_CUBE_UV"}return t}(i),p=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===re&&(t="ENVMAP_MODE_REFRACTION");return t}(i),m=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case U:t="ENVMAP_BLENDING_MULTIPLY";break;case j:t="ENVMAP_BLENDING_MIX";break;case q:t="ENVMAP_BLENDING_ADD"}return t}(i),f=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const i=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:r,maxMip:i}}(i),g=i.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(bs).join("\n")}(i),x=function(e){const t=[];for(const i in e){const r=e[i];!1!==r&&t.push("#define "+i+" "+r)}return t.join("\n")}(o),b=n.createProgram();let y,w,v=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(y=[x].filter(bs).join("\n"),y.length>0&&(y+="\n"),w=[g,x].filter(bs).join("\n"),w.length>0&&(w+="\n")):(y=[_s(i),"#define SHADER_NAME "+i.shaderName,x,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+p:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(bs).join("\n"),w=[g,_s(i),"#define SHADER_NAME "+i.shaderName,x,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+p:"",i.envMap?"#define "+m:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==X?"#define TONE_MAPPING":"",i.toneMapping!==X?Ao.tonemapping_pars_fragment:"",i.toneMapping!==X?xs("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Ao.encodings_pars_fragment,gs("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(bs).join("\n")),a=$s(a),a=ys(a,i),a=ws(a,i),s=$s(s),s=ys(s,i),s=ws(s,i),a=Ps(a),s=Ps(s),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(v="#version 300 es\n",y=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+y,w=["#define varying in",i.glslVersion===hi?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===hi?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+w);const $=v+w+s,M=ps(n,35633,v+y+a),S=ps(n,35632,$);if(n.attachShader(b,M),n.attachShader(b,S),void 0!==i.index0AttributeName?n.bindAttribLocation(b,0,i.index0AttributeName):!0===i.morphTargets&&n.bindAttribLocation(b,0,"position"),n.linkProgram(b),e.debug.checkShaderErrors){const e=n.getProgramInfoLog(b).trim(),t=n.getShaderInfoLog(M).trim(),i=n.getShaderInfoLog(S).trim();let r=!0,o=!0;if(!1===n.getProgramParameter(b,35714)){r=!1;const t=fs(n,M,"vertex"),i=fs(n,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(b,35715)+"\n\nProgram Info Log: "+e+"\n"+t+"\n"+i)}else""!==e?console.warn("THREE.WebGLProgram: Program Info Log:",e):""!==t&&""!==i||(o=!1);o&&(this.diagnostics={runnable:r,programLog:e,vertexShader:{log:t,prefix:y},fragmentShader:{log:i,prefix:w}})}let P,k;return n.deleteShader(M),n.deleteShader(S),this.getUniforms=function(){return void 0===P&&(P=new us(n,b)),P},this.getAttributes=function(){return void 0===k&&(k=function(e,t){const i={},r=e.getProgramParameter(t,35721);for(let n=0;n<r;n++){const r=e.getActiveAttrib(t,n),o=r.name;let a=1;35674===r.type&&(a=2),35675===r.type&&(a=3),35676===r.type&&(a=4),i[o]={type:r.type,location:e.getAttribLocation(t,o),locationSize:a}}return i}(n,b)),k},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(b),this.program=void 0},this.name=i.shaderName,this.id=ms++,this.cacheKey=t,this.usedTimes=1,this.program=b,this.vertexShader=M,this.fragmentShader=S,this}let Cs=0;class As{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),n=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return!1===o.has(r)&&(o.add(r),r.usedTimes++),!1===o.has(n)&&(o.add(n),n.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return void 0===i&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return void 0===i&&(i=new Ds(e),t.set(e,i)),i}}class Ds{constructor(e){this.id=Cs++,this.code=e,this.usedTimes=0}}function Rs(e,t,i,r,n,o,a){const s=new Ur,l=new As,c=[],h=n.isWebGL2,d=n.logarithmicDepthBuffer,u=n.vertexTextures;let p=n.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(o,s,c,b,y){const w=b.fog,v=y.geometry,$=o.isMeshStandardMaterial?b.environment:null,M=(o.isMeshStandardMaterial?i:t).get(o.envMap||$),S=M&&M.mapping===ae?M.image.height:null,P=g[o.type];null!==o.precision&&(p=n.getMaxPrecision(o.precision),p!==o.precision&&console.warn("THREE.WebGLProgram.getParameters:",o.precision,"not supported, using",p,"instead."));const k=v.morphAttributes.position||v.morphAttributes.normal||v.morphAttributes.color,_=void 0!==k?k.length:0;let T,C,A,D,R=0;if(void 0!==v.morphAttributes.position&&(R=1),void 0!==v.morphAttributes.normal&&(R=2),void 0!==v.morphAttributes.color&&(R=3),P){const e=Ro[P];T=e.vertexShader,C=e.fragmentShader}else T=o.vertexShader,C=o.fragmentShader,l.update(o),A=l.getVertexShaderID(o),D=l.getFragmentShaderID(o);const E=e.getRenderTarget(),L=o.alphaTest>0,I=o.clearcoat>0,B=o.iridescence>0;return{isWebGL2:h,shaderID:P,shaderName:o.type,vertexShader:T,fragmentShader:C,defines:o.defines,customVertexShaderID:A,customFragmentShaderID:D,isRawShaderMaterial:!0===o.isRawShaderMaterial,glslVersion:o.glslVersion,precision:p,instancing:!0===y.isInstancedMesh,instancingColor:!0===y.isInstancedMesh&&null!==y.instanceColor,supportsVertexTextures:u,outputEncoding:null===E?e.outputEncoding:!0===E.isXRRenderTarget?E.texture.encoding:Ct,map:!!o.map,matcap:!!o.matcap,envMap:!!M,envMapMode:M&&M.mapping,envMapCubeUVHeight:S,lightMap:!!o.lightMap,aoMap:!!o.aoMap,emissiveMap:!!o.emissiveMap,bumpMap:!!o.bumpMap,normalMap:!!o.normalMap,objectSpaceNormalMap:o.normalMapType===Lt,tangentSpaceNormalMap:o.normalMapType===Et,decodeVideoTexture:!!o.map&&!0===o.map.isVideoTexture&&o.map.encoding===At,clearcoat:I,clearcoatMap:I&&!!o.clearcoatMap,clearcoatRoughnessMap:I&&!!o.clearcoatRoughnessMap,clearcoatNormalMap:I&&!!o.clearcoatNormalMap,iridescence:B,iridescenceMap:B&&!!o.iridescenceMap,iridescenceThicknessMap:B&&!!o.iridescenceThicknessMap,displacementMap:!!o.displacementMap,roughnessMap:!!o.roughnessMap,metalnessMap:!!o.metalnessMap,specularMap:!!o.specularMap,specularIntensityMap:!!o.specularIntensityMap,specularColorMap:!!o.specularColorMap,opaque:!1===o.transparent&&o.blending===x,alphaMap:!!o.alphaMap,alphaTest:L,gradientMap:!!o.gradientMap,sheen:o.sheen>0,sheenColorMap:!!o.sheenColorMap,sheenRoughnessMap:!!o.sheenRoughnessMap,transmission:o.transmission>0,transmissionMap:!!o.transmissionMap,thicknessMap:!!o.thicknessMap,combine:o.combine,vertexTangents:!!o.normalMap&&!!v.attributes.tangent,vertexColors:o.vertexColors,vertexAlphas:!0===o.vertexColors&&!!v.attributes.color&&4===v.attributes.color.itemSize,vertexUvs:!!(o.map||o.bumpMap||o.normalMap||o.specularMap||o.alphaMap||o.emissiveMap||o.roughnessMap||o.metalnessMap||o.clearcoatMap||o.clearcoatRoughnessMap||o.clearcoatNormalMap||o.iridescenceMap||o.iridescenceThicknessMap||o.displacementMap||o.transmissionMap||o.thicknessMap||o.specularIntensityMap||o.specularColorMap||o.sheenColorMap||o.sheenRoughnessMap),uvsVertexOnly:!(o.map||o.bumpMap||o.normalMap||o.specularMap||o.alphaMap||o.emissiveMap||o.roughnessMap||o.metalnessMap||o.clearcoatNormalMap||o.iridescenceMap||o.iridescenceThicknessMap||o.transmission>0||o.transmissionMap||o.thicknessMap||o.specularIntensityMap||o.specularColorMap||o.sheen>0||o.sheenColorMap||o.sheenRoughnessMap||!o.displacementMap),fog:!!w,useFog:!0===o.fog,fogExp2:w&&w.isFogExp2,flatShading:!!o.flatShading,sizeAttenuation:o.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===y.isSkinnedMesh,morphTargets:void 0!==v.morphAttributes.position,morphNormals:void 0!==v.morphAttributes.normal,morphColors:void 0!==v.morphAttributes.color,morphTargetsCount:_,morphTextureStride:R,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numSpotLightMaps:s.spotLightMap.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numSpotLightShadowsWithMaps:s.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:o.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:o.toneMapped?e.toneMapping:X,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:o.premultipliedAlpha,doubleSided:o.side===f,flipSided:o.side===m,useDepthPacking:!!o.depthPacking,depthPacking:o.depthPacking||0,index0AttributeName:o.index0AttributeName,extensionDerivatives:o.extensions&&o.extensions.derivatives,extensionFragDepth:o.extensions&&o.extensions.fragDepth,extensionDrawBuffers:o.extensions&&o.extensions.drawBuffers,extensionShaderTextureLOD:o.extensions&&o.extensions.shaderTextureLOD,rendererExtensionFragDepth:h||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||r.has("EXT_shader_texture_lod"),customProgramCacheKey:o.customProgramCacheKey()}},getProgramCacheKey:function(t){const i=[];if(t.shaderID?i.push(t.shaderID):(i.push(t.customVertexShaderID),i.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)i.push(e),i.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputEncoding),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.combine),e.push(t.vertexUvs),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(i,t),function(e,t){s.disableAll(),t.isWebGL2&&s.enable(0);t.supportsVertexTextures&&s.enable(1);t.instancing&&s.enable(2);t.instancingColor&&s.enable(3);t.map&&s.enable(4);t.matcap&&s.enable(5);t.envMap&&s.enable(6);t.lightMap&&s.enable(7);t.aoMap&&s.enable(8);t.emissiveMap&&s.enable(9);t.bumpMap&&s.enable(10);t.normalMap&&s.enable(11);t.objectSpaceNormalMap&&s.enable(12);t.tangentSpaceNormalMap&&s.enable(13);t.clearcoat&&s.enable(14);t.clearcoatMap&&s.enable(15);t.clearcoatRoughnessMap&&s.enable(16);t.clearcoatNormalMap&&s.enable(17);t.iridescence&&s.enable(18);t.iridescenceMap&&s.enable(19);t.iridescenceThicknessMap&&s.enable(20);t.displacementMap&&s.enable(21);t.specularMap&&s.enable(22);t.roughnessMap&&s.enable(23);t.metalnessMap&&s.enable(24);t.gradientMap&&s.enable(25);t.alphaMap&&s.enable(26);t.alphaTest&&s.enable(27);t.vertexColors&&s.enable(28);t.vertexAlphas&&s.enable(29);t.vertexUvs&&s.enable(30);t.vertexTangents&&s.enable(31);t.uvsVertexOnly&&s.enable(32);e.push(s.mask),s.disableAll(),t.fog&&s.enable(0);t.useFog&&s.enable(1);t.flatShading&&s.enable(2);t.logarithmicDepthBuffer&&s.enable(3);t.skinning&&s.enable(4);t.morphTargets&&s.enable(5);t.morphNormals&&s.enable(6);t.morphColors&&s.enable(7);t.premultipliedAlpha&&s.enable(8);t.shadowMapEnabled&&s.enable(9);t.physicallyCorrectLights&&s.enable(10);t.doubleSided&&s.enable(11);t.flipSided&&s.enable(12);t.useDepthPacking&&s.enable(13);t.dithering&&s.enable(14);t.specularIntensityMap&&s.enable(15);t.specularColorMap&&s.enable(16);t.transmission&&s.enable(17);t.transmissionMap&&s.enable(18);t.thicknessMap&&s.enable(19);t.sheen&&s.enable(20);t.sheenColorMap&&s.enable(21);t.sheenRoughnessMap&&s.enable(22);t.decodeVideoTexture&&s.enable(23);t.opaque&&s.enable(24);e.push(s.mask)}(i,t),i.push(e.outputEncoding)),i.push(t.customProgramCacheKey),i.join()},getUniforms:function(e){const t=g[e.type];let i;if(t){const e=Ro[t];i=uo.clone(e.uniforms)}else i=e.uniforms;return i},acquireProgram:function(t,i){let r;for(let e=0,t=c.length;e<t;e++){const t=c[e];if(t.cacheKey===i){r=t,++r.usedTimes;break}}return void 0===r&&(r=new Ts(e,i,t,o),c.push(r)),r},releaseProgram:function(e){if(0==--e.usedTimes){const t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:c,dispose:function(){l.dispose()}}}function Es(){let e=new WeakMap;return{get:function(t){let i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i},remove:function(t){e.delete(t)},update:function(t,i,r){e.get(t)[i]=r},dispose:function(){e=new WeakMap}}}function Ls(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Is(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Bs(){const e=[];let t=0;const i=[],r=[],n=[];function o(i,r,n,o,a,s){let l=e[t];return void 0===l?(l={id:i.id,object:i,geometry:r,material:n,groupOrder:o,renderOrder:i.renderOrder,z:a,group:s},e[t]=l):(l.id=i.id,l.object=i,l.geometry=r,l.material=n,l.groupOrder=o,l.renderOrder=i.renderOrder,l.z=a,l.group=s),t++,l}return{opaque:i,transmissive:r,transparent:n,init:function(){t=0,i.length=0,r.length=0,n.length=0},push:function(e,t,a,s,l,c){const h=o(e,t,a,s,l,c);a.transmission>0?r.push(h):!0===a.transparent?n.push(h):i.push(h)},unshift:function(e,t,a,s,l,c){const h=o(e,t,a,s,l,c);a.transmission>0?r.unshift(h):!0===a.transparent?n.unshift(h):i.unshift(h)},finish:function(){for(let i=t,r=e.length;i<r;i++){const t=e[i];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){i.length>1&&i.sort(e||Ls),r.length>1&&r.sort(t||Is),n.length>1&&n.sort(t||Is)}}}function Vs(){let e=new WeakMap;return{get:function(t,i){const r=e.get(t);let n;return void 0===r?(n=new Bs,e.set(t,[n])):i>=r.length?(n=new Bs,r.push(n)):n=r[i],n},dispose:function(){e=new WeakMap}}}function Os(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new nr,color:new zi};break;case"SpotLight":i={position:new nr,direction:new nr,color:new zi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new nr,color:new zi,distance:0,decay:0};break;case"HemisphereLight":i={direction:new nr,skyColor:new zi,groundColor:new zi};break;case"RectAreaLight":i={color:new zi,position:new nr,halfWidth:new nr,halfHeight:new nr}}return e[t.id]=i,i}}}let Ws=0;function Hs(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Fs(e,t){const i=new Os,r=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new _i};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new _i,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=i,i}}}(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let e=0;e<9;e++)n.probe.push(new nr);const o=new nr,a=new Ir,s=new Ir;return{setup:function(o,a){let s=0,l=0,c=0;for(let e=0;e<9;e++)n.probe[e].set(0,0,0);let h=0,d=0,u=0,p=0,m=0,f=0,g=0,x=0,b=0,y=0;o.sort(Hs);const w=!0!==a?Math.PI:1;for(let e=0,t=o.length;e<t;e++){const t=o[e],a=t.color,v=t.intensity,$=t.distance,M=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)s+=a.r*v*w,l+=a.g*v*w,c+=a.b*v*w;else if(t.isLightProbe)for(let e=0;e<9;e++)n.probe[e].addScaledVector(t.sh.coefficients[e],v);else if(t.isDirectionalLight){const e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*w),t.castShadow){const e=t.shadow,i=r.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,n.directionalShadow[h]=i,n.directionalShadowMap[h]=M,n.directionalShadowMatrix[h]=t.shadow.matrix,f++}n.directional[h]=e,h++}else if(t.isSpotLight){const e=i.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(a).multiplyScalar(v*w),e.distance=$,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,n.spot[u]=e;const o=t.shadow;if(t.map&&(n.spotLightMap[b]=t.map,b++,o.updateMatrices(t),t.castShadow&&y++),n.spotLightMatrix[u]=o.matrix,t.castShadow){const e=r.get(t);e.shadowBias=o.bias,e.shadowNormalBias=o.normalBias,e.shadowRadius=o.radius,e.shadowMapSize=o.mapSize,n.spotShadow[u]=e,n.spotShadowMap[u]=M,x++}u++}else if(t.isRectAreaLight){const e=i.get(t);e.color.copy(a).multiplyScalar(v),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),n.rectArea[p]=e,p++}else if(t.isPointLight){const e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*w),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,i=r.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,i.shadowCameraNear=e.camera.near,i.shadowCameraFar=e.camera.far,n.pointShadow[d]=i,n.pointShadowMap[d]=M,n.pointShadowMatrix[d]=t.shadow.matrix,g++}n.point[d]=e,d++}else if(t.isHemisphereLight){const e=i.get(t);e.skyColor.copy(t.color).multiplyScalar(v*w),e.groundColor.copy(t.groundColor).multiplyScalar(v*w),n.hemi[m]=e,m++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(n.rectAreaLTC1=Do.LTC_FLOAT_1,n.rectAreaLTC2=Do.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(n.rectAreaLTC1=Do.LTC_HALF_1,n.rectAreaLTC2=Do.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=s,n.ambient[1]=l,n.ambient[2]=c;const v=n.hash;v.directionalLength===h&&v.pointLength===d&&v.spotLength===u&&v.rectAreaLength===p&&v.hemiLength===m&&v.numDirectionalShadows===f&&v.numPointShadows===g&&v.numSpotShadows===x&&v.numSpotMaps===b||(n.directional.length=h,n.spot.length=u,n.rectArea.length=p,n.point.length=d,n.hemi.length=m,n.directionalShadow.length=f,n.directionalShadowMap.length=f,n.pointShadow.length=g,n.pointShadowMap.length=g,n.spotShadow.length=x,n.spotShadowMap.length=x,n.directionalShadowMatrix.length=f,n.pointShadowMatrix.length=g,n.spotLightMatrix.length=x+b-y,n.spotLightMap.length=b,n.numSpotLightShadowsWithMaps=y,v.directionalLength=h,v.pointLength=d,v.spotLength=u,v.rectAreaLength=p,v.hemiLength=m,v.numDirectionalShadows=f,v.numPointShadows=g,v.numSpotShadows=x,v.numSpotMaps=b,n.version=Ws++)},setupView:function(e,t){let i=0,r=0,l=0,c=0,h=0;const d=t.matrixWorldInverse;for(let t=0,u=e.length;t<u;t++){const u=e[t];if(u.isDirectionalLight){const e=n.directional[i];e.direction.setFromMatrixPosition(u.matrixWorld),o.setFromMatrixPosition(u.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(d),i++}else if(u.isSpotLight){const e=n.spot[l];e.position.setFromMatrixPosition(u.matrixWorld),e.position.applyMatrix4(d),e.direction.setFromMatrixPosition(u.matrixWorld),o.setFromMatrixPosition(u.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(d),l++}else if(u.isRectAreaLight){const e=n.rectArea[c];e.position.setFromMatrixPosition(u.matrixWorld),e.position.applyMatrix4(d),s.identity(),a.copy(u.matrixWorld),a.premultiply(d),s.extractRotation(a),e.halfWidth.set(.5*u.width,0,0),e.halfHeight.set(0,.5*u.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),c++}else if(u.isPointLight){const e=n.point[r];e.position.setFromMatrixPosition(u.matrixWorld),e.position.applyMatrix4(d),r++}else if(u.isHemisphereLight){const e=n.hemi[h];e.direction.setFromMatrixPosition(u.matrixWorld),e.direction.transformDirection(d),h++}}},state:n}}function Qs(e,t){const i=new Fs(e,t),r=[],n=[];return{init:function(){r.length=0,n.length=0},state:{lightsArray:r,shadowsArray:n,lights:i},setupLights:function(e){i.setup(r,e)},setupLightsView:function(e){i.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){n.push(e)}}}function zs(e,t){let i=new WeakMap;return{get:function(r,n=0){const o=i.get(r);let a;return void 0===o?(a=new Qs(e,t),i.set(r,[a])):n>=o.length?(a=new Qs(e,t),o.push(a)):a=o[n],a},dispose:function(){i=new WeakMap}}}class Gs extends wn{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Dt,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Ns extends wn{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new nr,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function Us(e,t,i){let r=new ko;const n=new _i,o=new _i,a=new Yi,s=new Gs({depthPacking:Rt}),l=new Ns,c={},d=i.maxTextureSize,x={0:m,1:p,2:f},b=new po({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new _i},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),y=b.clone();y.defines.HORIZONTAL_PASS=1;const w=new Qn;w.setAttribute("position",new Sn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new ao(w,b),$=this;function M(i,r){const o=t.update(v);b.defines.VSM_SAMPLES!==i.blurSamples&&(b.defines.VSM_SAMPLES=i.blurSamples,y.defines.VSM_SAMPLES=i.blurSamples,b.needsUpdate=!0,y.needsUpdate=!0),null===i.mapPass&&(i.mapPass=new Ji(n.x,n.y)),b.uniforms.shadow_pass.value=i.map.texture,b.uniforms.resolution.value=i.mapSize,b.uniforms.radius.value=i.radius,e.setRenderTarget(i.mapPass),e.clear(),e.renderBufferDirect(r,null,o,b,v,null),y.uniforms.shadow_pass.value=i.mapPass.texture,y.uniforms.resolution.value=i.mapSize,y.uniforms.radius.value=i.radius,e.setRenderTarget(i.map),e.clear(),e.renderBufferDirect(r,null,o,y,v,null)}function S(t,i,r,n,o,a){let h=null;const d=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(h=void 0!==d?d:!0===r.isPointLight?l:s,e.localClippingEnabled&&!0===i.clipShadows&&Array.isArray(i.clippingPlanes)&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0){const e=h.uuid,t=i.uuid;let r=c[e];void 0===r&&(r={},c[e]=r);let n=r[t];void 0===n&&(n=h.clone(),r[t]=n),h=n}return h.visible=i.visible,h.wireframe=i.wireframe,h.side=a===u?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:x[i.side],h.alphaMap=i.alphaMap,h.alphaTest=i.alphaTest,h.clipShadows=i.clipShadows,h.clippingPlanes=i.clippingPlanes,h.clipIntersection=i.clipIntersection,h.displacementMap=i.displacementMap,h.displacementScale=i.displacementScale,h.displacementBias=i.displacementBias,h.wireframeLinewidth=i.wireframeLinewidth,h.linewidth=i.linewidth,!0===r.isPointLight&&!0===h.isMeshDistanceMaterial&&(h.referencePosition.setFromMatrixPosition(r.matrixWorld),h.nearDistance=n,h.farDistance=o),h}function P(i,n,o,a,s){if(!1===i.visible)return;if(i.layers.test(n.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&s===u)&&(!i.frustumCulled||r.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,i.matrixWorld);const r=t.update(i),n=i.material;if(Array.isArray(n)){const t=r.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],h=n[c.materialIndex];if(h&&h.visible){const t=S(i,h,a,o.near,o.far,s);e.renderBufferDirect(o,null,r,t,i,c)}}}else if(n.visible){const t=S(i,n,a,o.near,o.far,s);e.renderBufferDirect(o,null,r,t,i,null)}}const l=i.children;for(let e=0,t=l.length;e<t;e++)P(l[e],n,o,a,s)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=h,this.render=function(t,i,s){if(!1===$.enabled)return;if(!1===$.autoUpdate&&!1===$.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),p=e.state;p.setBlending(g),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(let l=0,c=t.length;l<c;l++){const c=t[l],h=c.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;n.copy(h.mapSize);const m=h.getFrameExtents();if(n.multiply(m),o.copy(h.mapSize),(n.x>d||n.y>d)&&(n.x>d&&(o.x=Math.floor(d/m.x),n.x=o.x*m.x,h.mapSize.x=o.x),n.y>d&&(o.y=Math.floor(d/m.y),n.y=o.y*m.y,h.mapSize.y=o.y)),null===h.map){const e=this.type!==u?{minFilter:he,magFilter:he}:{};h.map=new Ji(n.x,n.y,e),h.map.texture.name=c.name+".shadowMap",h.camera.updateProjectionMatrix()}e.setRenderTarget(h.map),e.clear();const f=h.getViewportCount();for(let e=0;e<f;e++){const t=h.getViewport(e);a.set(o.x*t.x,o.y*t.y,o.x*t.z,o.y*t.w),p.viewport(a),h.updateMatrices(c,e),r=h.getFrustum(),P(i,s,h.camera,c,this.type)}!0!==h.isPointLightShadow&&this.type===u&&M(h,s),h.needsUpdate=!1}$.needsUpdate=!1,e.setRenderTarget(l,c,h)}}function js(e,t,i){const r=i.isWebGL2;const n=new function(){let t=!1;const i=new Yi;let r=null;const n=new Yi(0,0,0,0);return{setMask:function(i){r===i||t||(e.colorMask(i,i,i,i),r=i)},setLocked:function(e){t=e},setClear:function(t,r,o,a,s){!0===s&&(t*=a,r*=a,o*=a),i.set(t,r,o,a),!1===n.equals(i)&&(e.clearColor(t,r,o,a),n.copy(i))},reset:function(){t=!1,r=null,n.set(-1,0,0,0)}}},l=new function(){let t=!1,i=null,r=null,n=null;return{setTest:function(e){e?ve(2929):$e(2929)},setMask:function(r){i===r||t||(e.depthMask(r),i=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case O:e.depthFunc(512);break;case W:e.depthFunc(519);break;case H:e.depthFunc(513);break;case F:e.depthFunc(515);break;case Q:e.depthFunc(514);break;case z:e.depthFunc(518);break;case G:e.depthFunc(516);break;case N:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);r=t}},setLocked:function(e){t=e},setClear:function(t){n!==t&&(e.clearDepth(t),n=t)},reset:function(){t=!1,i=null,r=null,n=null}}},c=new function(){let t=!1,i=null,r=null,n=null,o=null,a=null,s=null,l=null,c=null;return{setTest:function(e){t||(e?ve(2960):$e(2960))},setMask:function(r){i===r||t||(e.stencilMask(r),i=r)},setFunc:function(t,i,a){r===t&&n===i&&o===a||(e.stencilFunc(t,i,a),r=t,n=i,o=a)},setOp:function(t,i,r){a===t&&s===i&&l===r||(e.stencilOp(t,i,r),a=t,s=i,l=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,i=null,r=null,n=null,o=null,a=null,s=null,l=null,c=null}}},h=new WeakMap,d=new WeakMap;let u={},p={},U=new WeakMap,j=[],q=null,X=!1,Y=null,J=null,Z=null,K=null,ee=null,te=null,ie=null,re=!1,ne=null,oe=null,ae=null,se=null,le=null;const ce=e.getParameter(35661);let he=!1,de=0;const ue=e.getParameter(7938);-1!==ue.indexOf("WebGL")?(de=parseFloat(/^WebGL (\d)/.exec(ue)[1]),he=de>=1):-1!==ue.indexOf("OpenGL ES")&&(de=parseFloat(/^OpenGL ES (\d)/.exec(ue)[1]),he=de>=2);let pe=null,me={};const fe=e.getParameter(3088),ge=e.getParameter(2978),xe=(new Yi).fromArray(fe),be=(new Yi).fromArray(ge);function ye(t,i,r){const n=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let t=0;t<r;t++)e.texImage2D(i+t,0,6408,1,1,0,6408,5121,n);return o}const we={};function ve(t){!0!==u[t]&&(e.enable(t),u[t]=!0)}function $e(t){!1!==u[t]&&(e.disable(t),u[t]=!1)}we[3553]=ye(3553,3553,1),we[34067]=ye(34067,34069,6),n.setClear(0,0,0,1),l.setClear(1),c.setClear(0),ve(2929),l.setFunc(F),ke(!1),_e(a),ve(2884),Pe(g);const Me={[$]:32774,[M]:32778,[S]:32779};if(r)Me[P]=32775,Me[k]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(Me[P]=e.MIN_EXT,Me[k]=e.MAX_EXT)}const Se={[_]:0,[T]:1,[C]:768,[D]:770,[V]:776,[I]:774,[E]:772,[A]:769,[R]:771,[B]:775,[L]:773};function Pe(t,i,r,n,o,a,s,l){if(t!==g){if(!1===X&&(ve(3042),X=!0),t===v)o=o||i,a=a||r,s=s||n,i===J&&o===ee||(e.blendEquationSeparate(Me[i],Me[o]),J=i,ee=o),r===Z&&n===K&&a===te&&s===ie||(e.blendFuncSeparate(Se[r],Se[n],Se[a],Se[s]),Z=r,K=n,te=a,ie=s),Y=t,re=null;else if(t!==Y||l!==re){if(J===$&&ee===$||(e.blendEquation(32774),J=$,ee=$),l)switch(t){case x:e.blendFuncSeparate(1,771,1,771);break;case b:e.blendFunc(1,1);break;case y:e.blendFuncSeparate(0,769,0,1);break;case w:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case x:e.blendFuncSeparate(770,771,1,771);break;case b:e.blendFunc(770,1);break;case y:e.blendFuncSeparate(0,769,0,1);break;case w:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}Z=null,K=null,te=null,ie=null,Y=t,re=l}}else!0===X&&($e(3042),X=!1)}function ke(t){ne!==t&&(t?e.frontFace(2304):e.frontFace(2305),ne=t)}function _e(t){t!==o?(ve(2884),t!==oe&&(t===a?e.cullFace(1029):t===s?e.cullFace(1028):e.cullFace(1032))):$e(2884),oe=t}function Te(t,i,r){t?(ve(32823),se===i&&le===r||(e.polygonOffset(i,r),se=i,le=r)):$e(32823)}function Ce(t){void 0===t&&(t=33984+ce-1),pe!==t&&(e.activeTexture(t),pe=t)}return{buffers:{color:n,depth:l,stencil:c},enable:ve,disable:$e,bindFramebuffer:function(t,i){return p[t]!==i&&(e.bindFramebuffer(t,i),p[t]=i,r&&(36009===t&&(p[36160]=i),36160===t&&(p[36009]=i)),!0)},drawBuffers:function(r,n){let o=j,a=!1;if(r)if(o=U.get(n),void 0===o&&(o=[],U.set(n,o)),r.isWebGLMultipleRenderTargets){const e=r.texture;if(o.length!==e.length||36064!==o[0]){for(let t=0,i=e.length;t<i;t++)o[t]=36064+t;o.length=e.length,a=!0}}else 36064!==o[0]&&(o[0]=36064,a=!0);else 1029!==o[0]&&(o[0]=1029,a=!0);a&&(i.isWebGL2?e.drawBuffers(o):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(o))},useProgram:function(t){return q!==t&&(e.useProgram(t),q=t,!0)},setBlending:Pe,setMaterial:function(e,t){e.side===f?$e(2884):ve(2884);let i=e.side===m;t&&(i=!i),ke(i),e.blending===x&&!1===e.transparent?Pe(g):Pe(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),l.setFunc(e.depthFunc),l.setTest(e.depthTest),l.setMask(e.depthWrite),n.setMask(e.colorWrite);const r=e.stencilWrite;c.setTest(r),r&&(c.setMask(e.stencilWriteMask),c.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),c.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Te(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?ve(32926):$e(32926)},setFlipSided:ke,setCullFace:_e,setLineWidth:function(t){t!==ae&&(he&&e.lineWidth(t),ae=t)},setPolygonOffset:Te,setScissorTest:function(e){e?ve(3089):$e(3089)},activeTexture:Ce,bindTexture:function(t,i){null===pe&&Ce();let r=me[pe];void 0===r&&(r={type:void 0,texture:void 0},me[pe]=r),r.type===t&&r.texture===i||(e.bindTexture(t,i||we[t]),r.type=t,r.texture=i)},unbindTexture:function(){const t=me[pe];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,i){let r=d.get(i);void 0===r&&(r=new WeakMap,d.set(i,r));let n=r.get(t);void 0===n&&(n=e.getUniformBlockIndex(i,t.name),r.set(t,n))},uniformBlockBinding:function(t,i){const r=d.get(i).get(t);h.get(t)!==r&&(e.uniformBlockBinding(i,r,t.__bindingPointIndex),h.set(t,r))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===xe.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),xe.copy(t))},viewport:function(t){!1===be.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),be.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===r&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),u={},pe=null,me={},p={},U=new WeakMap,j=[],q=null,X=!1,Y=null,J=null,Z=null,K=null,ee=null,te=null,ie=null,re=!1,ne=null,oe=null,ae=null,se=null,le=null,xe.set(0,0,e.canvas.width,e.canvas.height),be.set(0,0,e.canvas.width,e.canvas.height),n.reset(),l.reset(),c.reset()}}}function qs(e,t,i,r,n,o,a){const s=n.isWebGL2,l=n.maxTextures,c=n.maxCubemapSize,h=n.maxTextureSize,d=n.maxSamples,u=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,p=/OculusBrowser/g.test(navigator.userAgent),m=new WeakMap;let f;const g=new WeakMap;let x=!1;try{x="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function b(e,t){return x?new OffscreenCanvas(e,t):Ri("canvas")}function y(e,t,i,r){let n=1;if((e.width>r||e.height>r)&&(n=r/Math.max(e.width,e.height)),n<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const r=t?Mi:Math.floor,o=r(n*e.width),a=r(n*e.height);void 0===f&&(f=b(o,a));const s=i?b(o,a):f;s.width=o,s.height=a;return s.getContext("2d").drawImage(e,0,0,o,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+a+")."),s}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function w(e){return vi(e.width)&&vi(e.height)}function v(e,t){return e.generateMipmaps&&t&&e.minFilter!==he&&e.minFilter!==fe}function $(t){e.generateMipmap(t)}function M(i,r,n,o,a=!1){if(!1===s)return r;if(null!==i){if(void 0!==e[i])return e[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let l=r;return 6403===r&&(5126===n&&(l=33326),5131===n&&(l=33325),5121===n&&(l=33321)),33319===r&&(5126===n&&(l=33328),5131===n&&(l=33327),5121===n&&(l=33323)),6408===r&&(5126===n&&(l=34836),5131===n&&(l=34842),5121===n&&(l=o===At&&!1===a?35907:32856),32819===n&&(l=32854),32820===n&&(l=32855)),33325!==l&&33326!==l&&33327!==l&&33328!==l&&34842!==l&&34836!==l||t.get("EXT_color_buffer_float"),l}function S(e,t,i){return!0===v(e,i)||e.isFramebufferTexture&&e.minFilter!==he&&e.minFilter!==fe?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function P(e){return e===he||e===de||e===pe?9728:9729}function k(e){const t=e.target;t.removeEventListener("dispose",k),function(e){const t=r.get(e);if(void 0===t.__webglInit)return;const i=e.source,n=g.get(i);if(n){const r=n[t.__cacheKey];r.usedTimes--,0===r.usedTimes&&T(e),0===Object.keys(n).length&&g.delete(i)}r.remove(e)}(t),t.isVideoTexture&&m.delete(t)}function _(t){const i=t.target;i.removeEventListener("dispose",_),function(t){const i=t.texture,n=r.get(t),o=r.get(i);void 0!==o.__webglTexture&&(e.deleteTexture(o.__webglTexture),a.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[t]);else{if(e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let t=0;t<n.__webglColorRenderbuffer.length;t++)n.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[t]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let t=0,n=i.length;t<n;t++){const n=r.get(i[t]);n.__webglTexture&&(e.deleteTexture(n.__webglTexture),a.memory.textures--),r.remove(i[t])}r.remove(i),r.remove(t)}(i)}function T(t){const i=r.get(t);e.deleteTexture(i.__webglTexture);const n=t.source;delete g.get(n)[i.__cacheKey],a.memory.textures--}let C=0;function A(e,t){const n=r.get(e);if(e.isVideoTexture&&function(e){const t=a.render.frame;m.get(e)!==t&&(m.set(e,t),e.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&n.__version!==e.version){const i=e.image;if(null===i)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==i.complete)return void I(n,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+t),i.bindTexture(3553,n.__webglTexture)}const D={[se]:10497,[le]:33071,[ce]:33648},R={[he]:9728,[de]:9984,[pe]:9986,[fe]:9729,[ge]:9985,[be]:9987};function E(i,o,a){if(a?(e.texParameteri(i,10242,D[o.wrapS]),e.texParameteri(i,10243,D[o.wrapT]),32879!==i&&35866!==i||e.texParameteri(i,32882,D[o.wrapR]),e.texParameteri(i,10240,R[o.magFilter]),e.texParameteri(i,10241,R[o.minFilter])):(e.texParameteri(i,10242,33071),e.texParameteri(i,10243,33071),32879!==i&&35866!==i||e.texParameteri(i,32882,33071),o.wrapS===le&&o.wrapT===le||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(i,10240,P(o.magFilter)),e.texParameteri(i,10241,P(o.minFilter)),o.minFilter!==he&&o.minFilter!==fe&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const a=t.get("EXT_texture_filter_anisotropic");if(o.type===ke&&!1===t.has("OES_texture_float_linear"))return;if(!1===s&&o.type===_e&&!1===t.has("OES_texture_half_float_linear"))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(e.texParameterf(i,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,n.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function L(t,i){let r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",k));const n=i.source;let o=g.get(n);void 0===o&&(o={},g.set(n,o));const s=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.encoding),t.join()}(i);if(s!==t.__cacheKey){void 0===o[s]&&(o[s]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,r=!0),o[s].usedTimes++;const n=o[t.__cacheKey];void 0!==n&&(o[t.__cacheKey].usedTimes--,0===n.usedTimes&&T(i)),t.__cacheKey=s,t.__webglTexture=o[s].texture}return r}function I(t,r,n){let a=3553;r.isDataArrayTexture&&(a=35866),r.isData3DTexture&&(a=32879);const l=L(t,r),c=r.source;if(i.activeTexture(33984+n),i.bindTexture(a,t.__webglTexture),c.version!==c.__currentVersion||!0===l){e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);const t=function(e){return!s&&(e.wrapS!==le||e.wrapT!==le||e.minFilter!==he&&e.minFilter!==fe)}(r)&&!1===w(r.image);let n=y(r.image,t,!1,h);n=F(r,n);const d=w(n)||s,u=o.convert(r.format,r.encoding);let p,m=o.convert(r.type),f=M(r.internalFormat,u,m,r.encoding,r.isVideoTexture);E(a,r,d);const g=r.mipmaps,x=s&&!0!==r.isVideoTexture,b=void 0===c.__currentVersion||!0===l,P=S(r,n,d);if(r.isDepthTexture)f=6402,s?f=r.type===ke?36012:r.type===Pe?33190:r.type===Ae?35056:33189:r.type===ke&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===Be&&6402===f&&r.type!==Me&&r.type!==Pe&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=Pe,m=o.convert(r.type)),r.format===Ve&&6402===f&&(f=34041,r.type!==Ae&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=Ae,m=o.convert(r.type))),b&&(x?i.texStorage2D(3553,1,f,n.width,n.height):i.texImage2D(3553,0,f,n.width,n.height,0,u,m,null));else if(r.isDataTexture)if(g.length>0&&d){x&&b&&i.texStorage2D(3553,P,f,g[0].width,g[0].height);for(let e=0,t=g.length;e<t;e++)p=g[e],x?i.texSubImage2D(3553,e,0,0,p.width,p.height,u,m,p.data):i.texImage2D(3553,e,f,p.width,p.height,0,u,m,p.data);r.generateMipmaps=!1}else x?(b&&i.texStorage2D(3553,P,f,n.width,n.height),i.texSubImage2D(3553,0,0,0,n.width,n.height,u,m,n.data)):i.texImage2D(3553,0,f,n.width,n.height,0,u,m,n.data);else if(r.isCompressedTexture){x&&b&&i.texStorage2D(3553,P,f,g[0].width,g[0].height);for(let e=0,t=g.length;e<t;e++)p=g[e],r.format!==Ee?null!==u?x?i.compressedTexSubImage2D(3553,e,0,0,p.width,p.height,u,p.data):i.compressedTexImage2D(3553,e,f,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):x?i.texSubImage2D(3553,e,0,0,p.width,p.height,u,m,p.data):i.texImage2D(3553,e,f,p.width,p.height,0,u,m,p.data)}else if(r.isDataArrayTexture)x?(b&&i.texStorage3D(35866,P,f,n.width,n.height,n.depth),i.texSubImage3D(35866,0,0,0,0,n.width,n.height,n.depth,u,m,n.data)):i.texImage3D(35866,0,f,n.width,n.height,n.depth,0,u,m,n.data);else if(r.isData3DTexture)x?(b&&i.texStorage3D(32879,P,f,n.width,n.height,n.depth),i.texSubImage3D(32879,0,0,0,0,n.width,n.height,n.depth,u,m,n.data)):i.texImage3D(32879,0,f,n.width,n.height,n.depth,0,u,m,n.data);else if(r.isFramebufferTexture){if(b)if(x)i.texStorage2D(3553,P,f,n.width,n.height);else{let e=n.width,t=n.height;for(let r=0;r<P;r++)i.texImage2D(3553,r,f,e,t,0,u,m,null),e>>=1,t>>=1}}else if(g.length>0&&d){x&&b&&i.texStorage2D(3553,P,f,g[0].width,g[0].height);for(let e=0,t=g.length;e<t;e++)p=g[e],x?i.texSubImage2D(3553,e,0,0,u,m,p):i.texImage2D(3553,e,f,u,m,p);r.generateMipmaps=!1}else x?(b&&i.texStorage2D(3553,P,f,n.width,n.height),i.texSubImage2D(3553,0,0,0,u,m,n)):i.texImage2D(3553,0,f,u,m,n);v(r,d)&&$(a),c.__currentVersion=c.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}function B(t,n,a,s,l){const c=o.convert(a.format,a.encoding),h=o.convert(a.type),d=M(a.internalFormat,c,h,a.encoding);r.get(n).__hasExternalTextures||(32879===l||35866===l?i.texImage3D(l,0,d,n.width,n.height,n.depth,0,c,h,null):i.texImage2D(l,0,d,n.width,n.height,0,c,h,null)),i.bindFramebuffer(36160,t),H(n)?u.framebufferTexture2DMultisampleEXT(36160,s,l,r.get(a).__webglTexture,0,W(n)):e.framebufferTexture2D(36160,s,l,r.get(a).__webglTexture,0),i.bindFramebuffer(36160,null)}function V(t,i,r){if(e.bindRenderbuffer(36161,t),i.depthBuffer&&!i.stencilBuffer){let n=33189;if(r||H(i)){const t=i.depthTexture;t&&t.isDepthTexture&&(t.type===ke?n=36012:t.type===Pe&&(n=33190));const r=W(i);H(i)?u.renderbufferStorageMultisampleEXT(36161,r,n,i.width,i.height):e.renderbufferStorageMultisample(36161,r,n,i.width,i.height)}else e.renderbufferStorage(36161,n,i.width,i.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(i.depthBuffer&&i.stencilBuffer){const n=W(i);r&&!1===H(i)?e.renderbufferStorageMultisample(36161,n,35056,i.width,i.height):H(i)?u.renderbufferStorageMultisampleEXT(36161,n,35056,i.width,i.height):e.renderbufferStorage(36161,34041,i.width,i.height),e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=!0===i.isWebGLMultipleRenderTargets?i.texture:[i.texture];for(let n=0;n<t.length;n++){const a=t[n],s=o.convert(a.format,a.encoding),l=o.convert(a.type),c=M(a.internalFormat,s,l,a.encoding),h=W(i);r&&!1===H(i)?e.renderbufferStorageMultisample(36161,h,c,i.width,i.height):H(i)?u.renderbufferStorageMultisampleEXT(36161,h,c,i.width,i.height):e.renderbufferStorage(36161,c,i.width,i.height)}}e.bindRenderbuffer(36161,null)}function O(t){const n=r.get(t),o=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!n.__autoAllocateDepthBuffer){if(o)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),A(n.depthTexture,0);const o=r.get(n.depthTexture).__webglTexture,a=W(n);if(n.depthTexture.format===Be)H(n)?u.framebufferTexture2DMultisampleEXT(36160,36096,3553,o,0,a):e.framebufferTexture2D(36160,36096,3553,o,0);else{if(n.depthTexture.format!==Ve)throw new Error("Unknown depthTexture format");H(n)?u.framebufferTexture2DMultisampleEXT(36160,33306,3553,o,0,a):e.framebufferTexture2D(36160,33306,3553,o,0)}}(n.__webglFramebuffer,t)}else if(o){n.__webglDepthbuffer=[];for(let r=0;r<6;r++)i.bindFramebuffer(36160,n.__webglFramebuffer[r]),n.__webglDepthbuffer[r]=e.createRenderbuffer(),V(n.__webglDepthbuffer[r],t,!1)}else i.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),V(n.__webglDepthbuffer,t,!1);i.bindFramebuffer(36160,null)}function W(e){return Math.min(d,e.samples)}function H(e){const i=r.get(e);return s&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==i.__useRenderToTexture}function F(e,i){const r=e.encoding,n=e.format,o=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===di||r!==Ct&&(r===At?!1===s?!0===t.has("EXT_sRGB")&&n===Ee?(e.format=di,e.minFilter=fe,e.generateMipmaps=!1):i=Ni.sRGBToLinear(i):n===Ee&&o===we||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",r)),i}this.allocateTextureUnit=function(){const e=C;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),C+=1,e},this.resetTextureUnits=function(){C=0},this.setTexture2D=A,this.setTexture2DArray=function(e,t){const n=r.get(e);e.version>0&&n.__version!==e.version?I(n,e,t):(i.activeTexture(33984+t),i.bindTexture(35866,n.__webglTexture))},this.setTexture3D=function(e,t){const n=r.get(e);e.version>0&&n.__version!==e.version?I(n,e,t):(i.activeTexture(33984+t),i.bindTexture(32879,n.__webglTexture))},this.setTextureCube=function(t,n){const a=r.get(t);t.version>0&&a.__version!==t.version?function(t,r,n){if(6!==r.image.length)return;const a=L(t,r),l=r.source;if(i.activeTexture(33984+n),i.bindTexture(34067,t.__webglTexture),l.version!==l.__currentVersion||!0===a){e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);const t=r.isCompressedTexture||r.image[0].isCompressedTexture,n=r.image[0]&&r.image[0].isDataTexture,h=[];for(let e=0;e<6;e++)h[e]=t||n?n?r.image[e].image:r.image[e]:y(r.image[e],!1,!0,c),h[e]=F(r,h[e]);const d=h[0],u=w(d)||s,p=o.convert(r.format,r.encoding),m=o.convert(r.type),f=M(r.internalFormat,p,m,r.encoding),g=s&&!0!==r.isVideoTexture,x=void 0===l.__currentVersion||!0===a;let b,P=S(r,d,u);if(E(34067,r,u),t){g&&x&&i.texStorage2D(34067,P,f,d.width,d.height);for(let e=0;e<6;e++){b=h[e].mipmaps;for(let t=0;t<b.length;t++){const n=b[t];r.format!==Ee?null!==p?g?i.compressedTexSubImage2D(34069+e,t,0,0,n.width,n.height,p,n.data):i.compressedTexImage2D(34069+e,t,f,n.width,n.height,0,n.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):g?i.texSubImage2D(34069+e,t,0,0,n.width,n.height,p,m,n.data):i.texImage2D(34069+e,t,f,n.width,n.height,0,p,m,n.data)}}}else{b=r.mipmaps,g&&x&&(b.length>0&&P++,i.texStorage2D(34067,P,f,h[0].width,h[0].height));for(let e=0;e<6;e++)if(n){g?i.texSubImage2D(34069+e,0,0,0,h[e].width,h[e].height,p,m,h[e].data):i.texImage2D(34069+e,0,f,h[e].width,h[e].height,0,p,m,h[e].data);for(let t=0;t<b.length;t++){const r=b[t].image[e].image;g?i.texSubImage2D(34069+e,t+1,0,0,r.width,r.height,p,m,r.data):i.texImage2D(34069+e,t+1,f,r.width,r.height,0,p,m,r.data)}}else{g?i.texSubImage2D(34069+e,0,0,0,p,m,h[e]):i.texImage2D(34069+e,0,f,p,m,h[e]);for(let t=0;t<b.length;t++){const r=b[t];g?i.texSubImage2D(34069+e,t+1,0,0,p,m,r.image[e]):i.texImage2D(34069+e,t+1,f,p,m,r.image[e])}}}v(r,u)&&$(34067),l.__currentVersion=l.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}(a,t,n):(i.activeTexture(33984+n),i.bindTexture(34067,a.__webglTexture))},this.rebindTextures=function(e,t,i){const n=r.get(e);void 0!==t&&B(n.__webglFramebuffer,e,e.texture,36064,3553),void 0!==i&&O(e)},this.setupRenderTarget=function(t){const l=t.texture,c=r.get(t),h=r.get(l);t.addEventListener("dispose",_),!0!==t.isWebGLMultipleRenderTargets&&(void 0===h.__webglTexture&&(h.__webglTexture=e.createTexture()),h.__version=l.version,a.memory.textures++);const d=!0===t.isWebGLCubeRenderTarget,u=!0===t.isWebGLMultipleRenderTargets,p=w(t)||s;if(d){c.__webglFramebuffer=[];for(let t=0;t<6;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else{if(c.__webglFramebuffer=e.createFramebuffer(),u)if(n.drawBuffers){const i=t.texture;for(let t=0,n=i.length;t<n;t++){const n=r.get(i[t]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(s&&t.samples>0&&!1===H(t)){const r=u?l:[l];c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,c.__webglMultisampledFramebuffer);for(let i=0;i<r.length;i++){const n=r[i];c.__webglColorRenderbuffer[i]=e.createRenderbuffer(),e.bindRenderbuffer(36161,c.__webglColorRenderbuffer[i]);const a=o.convert(n.format,n.encoding),s=o.convert(n.type),l=M(n.internalFormat,a,s,n.encoding),h=W(t);e.renderbufferStorageMultisample(36161,h,l,t.width,t.height),e.framebufferRenderbuffer(36160,36064+i,36161,c.__webglColorRenderbuffer[i])}e.bindRenderbuffer(36161,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),V(c.__webglDepthRenderbuffer,t,!0)),i.bindFramebuffer(36160,null)}}if(d){i.bindTexture(34067,h.__webglTexture),E(34067,l,p);for(let e=0;e<6;e++)B(c.__webglFramebuffer[e],t,l,36064,34069+e);v(l,p)&&$(34067),i.unbindTexture()}else if(u){const e=t.texture;for(let n=0,o=e.length;n<o;n++){const o=e[n],a=r.get(o);i.bindTexture(3553,a.__webglTexture),E(3553,o,p),B(c.__webglFramebuffer,t,o,36064+n,3553),v(o,p)&&$(3553)}i.unbindTexture()}else{let e=3553;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(s?e=t.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(e,h.__webglTexture),E(e,l,p),B(c.__webglFramebuffer,t,l,36064,e),v(l,p)&&$(e),i.unbindTexture()}t.depthBuffer&&O(t)},this.updateRenderTargetMipmap=function(e){const t=w(e)||s,n=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let o=0,a=n.length;o<a;o++){const a=n[o];if(v(a,t)){const t=e.isWebGLCubeRenderTarget?34067:3553,n=r.get(a).__webglTexture;i.bindTexture(t,n),$(t),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(s&&t.samples>0&&!1===H(t)){const n=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],o=t.width,a=t.height;let s=16384;const l=[],c=t.stencilBuffer?33306:36096,h=r.get(t),d=!0===t.isWebGLMultipleRenderTargets;if(d)for(let t=0;t<n.length;t++)i.bindFramebuffer(36160,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+t,36161,null),i.bindFramebuffer(36160,h.__webglFramebuffer),e.framebufferTexture2D(36009,36064+t,3553,null,0);i.bindFramebuffer(36008,h.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,h.__webglFramebuffer);for(let i=0;i<n.length;i++){l.push(36064+i),t.depthBuffer&&l.push(c);const u=void 0!==h.__ignoreDepthValues&&h.__ignoreDepthValues;if(!1===u&&(t.depthBuffer&&(s|=256),t.stencilBuffer&&(s|=1024)),d&&e.framebufferRenderbuffer(36008,36064,36161,h.__webglColorRenderbuffer[i]),!0===u&&(e.invalidateFramebuffer(36008,[c]),e.invalidateFramebuffer(36009,[c])),d){const t=r.get(n[i]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,t,0)}e.blitFramebuffer(0,0,o,a,0,0,o,a,s,9728),p&&e.invalidateFramebuffer(36008,l)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),d)for(let t=0;t<n.length;t++){i.bindFramebuffer(36160,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+t,36161,h.__webglColorRenderbuffer[t]);const o=r.get(n[t]).__webglTexture;i.bindFramebuffer(36160,h.__webglFramebuffer),e.framebufferTexture2D(36009,36064+t,3553,o,0)}i.bindFramebuffer(36009,h.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=O,this.setupFrameBufferTexture=B,this.useMultisampledRTT=H}function Xs(e,t,i){const r=i.isWebGL2;return{convert:function(i,n=null){let o;if(i===we)return 5121;if(i===Te)return 32819;if(i===Ce)return 32820;if(i===ve)return 5120;if(i===$e)return 5122;if(i===Me)return 5123;if(i===Se)return 5124;if(i===Pe)return 5125;if(i===ke)return 5126;if(i===_e)return r?5131:(o=t.get("OES_texture_half_float"),null!==o?o.HALF_FLOAT_OES:null);if(i===De)return 6406;if(i===Ee)return 6408;if(i===Le)return 6409;if(i===Ie)return 6410;if(i===Be)return 6402;if(i===Ve)return 34041;if(i===Oe)return 6403;if(i===Re)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(i===di)return o=t.get("EXT_sRGB"),null!==o?o.SRGB_ALPHA_EXT:null;if(i===We)return 36244;if(i===He)return 33319;if(i===Fe)return 33320;if(i===Qe)return 36249;if(i===ze||i===Ge||i===Ne||i===Ue)if(n===At){if(o=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===o)return null;if(i===ze)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===Ge)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===Ne)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===Ue)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(o=t.get("WEBGL_compressed_texture_s3tc"),null===o)return null;if(i===ze)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===Ge)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===Ne)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===Ue)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(i===je||i===qe||i===Xe||i===Ye){if(o=t.get("WEBGL_compressed_texture_pvrtc"),null===o)return null;if(i===je)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===qe)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===Xe)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===Ye)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(i===Je)return o=t.get("WEBGL_compressed_texture_etc1"),null!==o?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(i===Ze||i===Ke){if(o=t.get("WEBGL_compressed_texture_etc"),null===o)return null;if(i===Ze)return n===At?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(i===Ke)return n===At?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}if(i===et||i===tt||i===it||i===rt||i===nt||i===ot||i===at||i===st||i===lt||i===ct||i===ht||i===dt||i===ut||i===pt){if(o=t.get("WEBGL_compressed_texture_astc"),null===o)return null;if(i===et)return n===At?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===tt)return n===At?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===it)return n===At?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===rt)return n===At?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===nt)return n===At?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===ot)return n===At?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===at)return n===At?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===st)return n===At?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===lt)return n===At?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===ct)return n===At?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===ht)return n===At?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===dt)return n===At?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===ut)return n===At?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===pt)return n===At?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}if(i===mt){if(o=t.get("EXT_texture_compression_bptc"),null===o)return null;if(i===mt)return n===At?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}return i===Ae?r?34042:(o=t.get("WEBGL_depth_texture"),null!==o?o.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[i]?e[i]:null}}}class Ys extends fo{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Js extends sn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Zs={type:"move"};class Ks{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Js,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Js,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new nr,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new nr),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Js,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new nr,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new nr),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let r=null,n=null,o=null;const a=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){o=!0;for(const r of e.hand.values()){const e=t.getJointPose(r,i);if(void 0===l.joints[r.jointName]){const e=new Js;e.matrixAutoUpdate=!1,e.visible=!1,l.joints[r.jointName]=e,l.add(e)}const n=l.joints[r.jointName];null!==e&&(n.matrix.fromArray(e.transform.matrix),n.matrix.decompose(n.position,n.rotation,n.scale),n.jointRadius=e.radius),n.visible=null!==e}const r=l.joints["index-finger-tip"],n=l.joints["thumb-tip"],a=r.position.distanceTo(n.position),s=.02,c=.005;l.inputState.pinching&&a>s+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&a<=s-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&(n=t.getPose(e.gripSpace,i),null!==n&&(s.matrix.fromArray(n.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),n.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(n.linearVelocity)):s.hasLinearVelocity=!1,n.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(n.angularVelocity)):s.hasAngularVelocity=!1));null!==a&&(r=t.getPose(e.targetRaySpace,i),null===r&&null!==n&&(r=n),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Zs)))}return null!==a&&(a.visible=null!==r),null!==s&&(s.visible=null!==n),null!==l&&(l.visible=null!==o),this}}class el extends Xi{constructor(e,t,i,r,n,o,a,s,l,c){if((c=void 0!==c?c:Be)!==Be&&c!==Ve)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===Be&&(i=Pe),void 0===i&&c===Ve&&(i=Ae),super(null,r,n,o,a,s,c,i,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==a?a:he,this.minFilter=void 0!==s?s:he,this.flipY=!1,this.generateMipmaps=!1}}class tl extends ui{constructor(e,t){super();const i=this;let r=null,n=1,o=null,a="local-floor",s=null,l=null,c=null,h=null,d=null,u=null;const p=t.getContextAttributes();let m=null,f=null;const g=[],x=[],b=new fo;b.layers.enable(1),b.viewport=new Yi;const y=new fo;y.layers.enable(2),y.viewport=new Yi;const w=[b,y],v=new Ys;v.layers.enable(1),v.layers.enable(2);let $=null,M=null;function S(e){const t=x.indexOf(e.inputSource);if(-1===t)return;const i=g[t];void 0!==i&&i.dispatchEvent({type:e.type,data:e.inputSource})}function P(){r.removeEventListener("select",S),r.removeEventListener("selectstart",S),r.removeEventListener("selectend",S),r.removeEventListener("squeeze",S),r.removeEventListener("squeezestart",S),r.removeEventListener("squeezeend",S),r.removeEventListener("end",P),r.removeEventListener("inputsourceschange",k);for(let e=0;e<g.length;e++){const t=x[e];null!==t&&(x[e]=null,g[e].disconnect(t))}$=null,M=null,e.setRenderTarget(m),d=null,h=null,c=null,r=null,f=null,D.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function k(e){for(let t=0;t<e.removed.length;t++){const i=e.removed[t],r=x.indexOf(i);r>=0&&(x[r]=null,g[r].dispatchEvent({type:"disconnected",data:i}))}for(let t=0;t<e.added.length;t++){const i=e.added[t];let r=x.indexOf(i);if(-1===r){for(let e=0;e<g.length;e++){if(e>=x.length){x.push(i),r=e;break}if(null===x[e]){x[e]=i,r=e;break}}if(-1===r)break}const n=g[r];n&&n.dispatchEvent({type:"connected",data:i})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=g[e];return void 0===t&&(t=new Ks,g[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=g[e];return void 0===t&&(t=new Ks,g[e]=t),t.getGripSpace()},this.getHand=function(e){let t=g[e];return void 0===t&&(t=new Ks,g[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){n=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){a=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return s||o},this.setReferenceSpace=function(e){s=e},this.getBaseLayer=function(){return null!==h?h:d},this.getBinding=function(){return c},this.getFrame=function(){return u},this.getSession=function(){return r},this.setSession=async function(l){if(r=l,null!==r){if(m=e.getRenderTarget(),r.addEventListener("select",S),r.addEventListener("selectstart",S),r.addEventListener("selectend",S),r.addEventListener("squeeze",S),r.addEventListener("squeezestart",S),r.addEventListener("squeezeend",S),r.addEventListener("end",P),r.addEventListener("inputsourceschange",k),!0!==p.xrCompatible&&await t.makeXRCompatible(),void 0===r.renderState.layers||!1===e.capabilities.isWebGL2){const i={antialias:void 0!==r.renderState.layers||p.antialias,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:n};d=new XRWebGLLayer(r,t,i),r.updateRenderState({baseLayer:d}),f=new Ji(d.framebufferWidth,d.framebufferHeight,{format:Ee,type:we,encoding:e.outputEncoding,stencilBuffer:p.stencil})}else{let i=null,o=null,a=null;p.depth&&(a=p.stencil?35056:33190,i=p.stencil?Ve:Be,o=p.stencil?Ae:Pe);const s={colorFormat:32856,depthFormat:a,scaleFactor:n};c=new XRWebGLBinding(r,t),h=c.createProjectionLayer(s),r.updateRenderState({layers:[h]}),f=new Ji(h.textureWidth,h.textureHeight,{format:Ee,type:we,depthTexture:new el(h.textureWidth,h.textureHeight,o,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:p.stencil,encoding:e.outputEncoding,samples:p.antialias?4:0});e.properties.get(f).__ignoreDepthValues=h.ignoreDepthValues}f.isXRRenderTarget=!0,this.setFoveation(1),s=null,o=await r.requestReferenceSpace(a),D.setContext(r),D.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};const _=new nr,T=new nr;function C(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===r)return;v.near=y.near=b.near=e.near,v.far=y.far=b.far=e.far,$===v.near&&M===v.far||(r.updateRenderState({depthNear:v.near,depthFar:v.far}),$=v.near,M=v.far);const t=e.parent,i=v.cameras;C(v,t);for(let e=0;e<i.length;e++)C(i[e],t);v.matrixWorld.decompose(v.position,v.quaternion,v.scale),e.matrix.copy(v.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);const n=e.children;for(let e=0,t=n.length;e<t;e++)n[e].updateMatrixWorld(!0);2===i.length?function(e,t,i){_.setFromMatrixPosition(t.matrixWorld),T.setFromMatrixPosition(i.matrixWorld);const r=_.distanceTo(T),n=t.projectionMatrix.elements,o=i.projectionMatrix.elements,a=n[14]/(n[10]-1),s=n[14]/(n[10]+1),l=(n[9]+1)/n[5],c=(n[9]-1)/n[5],h=(n[8]-1)/n[0],d=(o[8]+1)/o[0],u=a*h,p=a*d,m=r/(-h+d),f=m*-h;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(f),e.translateZ(m),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=a+m,x=s+m,b=u-f,y=p+(r-f),w=l*s/x*g,v=c*s/x*g;e.projectionMatrix.makePerspective(b,y,w,v,g,x)}(v,b,y):v.projectionMatrix.copy(b.projectionMatrix)},this.getCamera=function(){return v},this.getFoveation=function(){return null!==h?h.fixedFoveation:null!==d?d.fixedFoveation:void 0},this.setFoveation=function(e){null!==h&&(h.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)};let A=null;const D=new _o;D.setAnimationLoop((function(t,i){if(l=i.getViewerPose(s||o),u=i,null!==l){const t=l.views;null!==d&&(e.setRenderTargetFramebuffer(f,d.framebuffer),e.setRenderTarget(f));let i=!1;t.length!==v.cameras.length&&(v.cameras.length=0,i=!0);for(let r=0;r<t.length;r++){const n=t[r];let o=null;if(null!==d)o=d.getViewport(n);else{const t=c.getViewSubImage(h,n);o=t.viewport,0===r&&(e.setRenderTargetTextures(f,t.colorTexture,h.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(f))}let a=w[r];void 0===a&&(a=new fo,a.layers.enable(r),a.viewport=new Yi,w[r]=a),a.matrix.fromArray(n.transform.matrix),a.projectionMatrix.fromArray(n.projectionMatrix),a.viewport.set(o.x,o.y,o.width,o.height),0===r&&v.matrix.copy(a.matrix),!0===i&&v.cameras.push(a)}}for(let e=0;e<g.length;e++){const t=x[e],r=g[e];null!==t&&void 0!==r&&r.update(t,i,s||o)}A&&A(t,i),u=null})),this.setAnimationLoop=function(e){A=e},this.dispose=function(){}}}function il(e,t){function i(i,r){i.opacity.value=r.opacity,r.color&&i.diffuse.value.copy(r.color),r.emissive&&i.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(i.map.value=r.map),r.alphaMap&&(i.alphaMap.value=r.alphaMap),r.bumpMap&&(i.bumpMap.value=r.bumpMap,i.bumpScale.value=r.bumpScale,r.side===m&&(i.bumpScale.value*=-1)),r.displacementMap&&(i.displacementMap.value=r.displacementMap,i.displacementScale.value=r.displacementScale,i.displacementBias.value=r.displacementBias),r.emissiveMap&&(i.emissiveMap.value=r.emissiveMap),r.normalMap&&(i.normalMap.value=r.normalMap,i.normalScale.value.copy(r.normalScale),r.side===m&&i.normalScale.value.negate()),r.specularMap&&(i.specularMap.value=r.specularMap),r.alphaTest>0&&(i.alphaTest.value=r.alphaTest);const n=t.get(r).envMap;if(n&&(i.envMap.value=n,i.flipEnvMap.value=n.isCubeTexture&&!1===n.isRenderTargetTexture?-1:1,i.reflectivity.value=r.reflectivity,i.ior.value=r.ior,i.refractionRatio.value=r.refractionRatio),r.lightMap){i.lightMap.value=r.lightMap;const t=!0!==e.physicallyCorrectLights?Math.PI:1;i.lightMapIntensity.value=r.lightMapIntensity*t}let o,a;r.aoMap&&(i.aoMap.value=r.aoMap,i.aoMapIntensity.value=r.aoMapIntensity),r.map?o=r.map:r.specularMap?o=r.specularMap:r.displacementMap?o=r.displacementMap:r.normalMap?o=r.normalMap:r.bumpMap?o=r.bumpMap:r.roughnessMap?o=r.roughnessMap:r.metalnessMap?o=r.metalnessMap:r.alphaMap?o=r.alphaMap:r.emissiveMap?o=r.emissiveMap:r.clearcoatMap?o=r.clearcoatMap:r.clearcoatNormalMap?o=r.clearcoatNormalMap:r.clearcoatRoughnessMap?o=r.clearcoatRoughnessMap:r.iridescenceMap?o=r.iridescenceMap:r.iridescenceThicknessMap?o=r.iridescenceThicknessMap:r.specularIntensityMap?o=r.specularIntensityMap:r.specularColorMap?o=r.specularColorMap:r.transmissionMap?o=r.transmissionMap:r.thicknessMap?o=r.thicknessMap:r.sheenColorMap?o=r.sheenColorMap:r.sheenRoughnessMap&&(o=r.sheenRoughnessMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),i.uvTransform.value.copy(o.matrix)),r.aoMap?a=r.aoMap:r.lightMap&&(a=r.lightMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),i.uv2Transform.value.copy(a.matrix))}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,r,n,o,a){r.isMeshBasicMaterial||r.isMeshLambertMaterial?i(e,r):r.isMeshToonMaterial?(i(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,r)):r.isMeshPhongMaterial?(i(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,r)):r.isMeshStandardMaterial?(i(e,r),function(e,i){e.roughness.value=i.roughness,e.metalness.value=i.metalness,i.roughnessMap&&(e.roughnessMap.value=i.roughnessMap);i.metalnessMap&&(e.metalnessMap.value=i.metalnessMap);t.get(i).envMap&&(e.envMapIntensity.value=i.envMapIntensity)}(e,r),r.isMeshPhysicalMaterial&&function(e,t,i){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===m&&e.clearcoatNormalScale.value.negate()));t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap);t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,r,a)):r.isMeshMatcapMaterial?(i(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,r)):r.isMeshDepthMaterial?i(e,r):r.isMeshDistanceMaterial?(i(e,r),function(e,t){e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,r)):r.isMeshNormalMaterial?i(e,r):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,i,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*r,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);let n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,r,n,o):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);let i;t.map?i=t.map:t.alphaMap&&(i=t.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function rl(e,t,i,r){let n={},o={},a=[];const s=i.isWebGL2?e.getParameter(35375):0;function l(e,t,i){const r=e.value;if(void 0===i[t])return i[t]="number"==typeof r?r:r.clone(),!0;if("number"==typeof r){if(i[t]!==r)return i[t]=r,!0}else{const e=i[t];if(!1===e.equals(r))return e.copy(r),!0}return!1}function c(e){const t=e.value,i={boundary:0,storage:0};return"number"==typeof t?(i.boundary=4,i.storage=4):t.isVector2?(i.boundary=8,i.storage=8):t.isVector3||t.isColor?(i.boundary=16,i.storage=12):t.isVector4?(i.boundary=16,i.storage=16):t.isMatrix3?(i.boundary=48,i.storage=48):t.isMatrix4?(i.boundary=64,i.storage=64):t.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",t),i}function h(t){const i=t.target;i.removeEventListener("dispose",h);const r=a.indexOf(i.__bindingPointIndex);a.splice(r,1),e.deleteBuffer(n[i.id]),delete n[i.id],delete o[i.id]}return{bind:function(e,t){const i=t.program;r.uniformBlockBinding(e,i)},update:function(i,d){let u=n[i.id];void 0===u&&(!function(e){const t=e.uniforms;let i=0;const r=16;let n=0;for(let e=0,o=t.length;e<o;e++){const o=t[e],a=c(o);if(o.__data=new Float32Array(a.storage/Float32Array.BYTES_PER_ELEMENT),o.__offset=i,e>0){n=i%r;const e=r-n;0!==n&&e-a.boundary<0&&(i+=r-n,o.__offset=i)}i+=a.storage}n=i%r,n>0&&(i+=r-n);e.__size=i,e.__cache={}}(i),u=function(t){const i=function(){for(let e=0;e<s;e++)if(-1===a.indexOf(e))return a.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=i;const r=e.createBuffer(),n=t.__size,o=t.usage;return e.bindBuffer(35345,r),e.bufferData(35345,n,o),e.bindBuffer(35345,null),e.bindBufferBase(35345,i,r),r}(i),n[i.id]=u,i.addEventListener("dispose",h));const p=d.program;r.updateUBOMapping(i,p);const m=t.render.frame;o[i.id]!==m&&(!function(t){const i=n[t.id],r=t.uniforms,o=t.__cache;e.bindBuffer(35345,i);for(let t=0,i=r.length;t<i;t++){const i=r[t];if(!0===l(i,t,o)){const t=i.value,r=i.__offset;"number"==typeof t?(i.__data[0]=t,e.bufferSubData(35345,r,i.__data)):(i.value.isMatrix3?(i.__data[0]=i.value.elements[0],i.__data[1]=i.value.elements[1],i.__data[2]=i.value.elements[2],i.__data[3]=i.value.elements[0],i.__data[4]=i.value.elements[3],i.__data[5]=i.value.elements[4],i.__data[6]=i.value.elements[5],i.__data[7]=i.value.elements[0],i.__data[8]=i.value.elements[6],i.__data[9]=i.value.elements[7],i.__data[10]=i.value.elements[8],i.__data[11]=i.value.elements[0]):t.toArray(i.__data),e.bufferSubData(35345,r,i.__data))}}e.bindBuffer(35345,null)}(i),o[i.id]=m)},dispose:function(){for(const t in n)e.deleteBuffer(n[t]);a=[],n={},o={}}}}function nl(e={}){this.isWebGLRenderer=!0;const t=void 0!==e.canvas?e.canvas:function(){const e=Ri("canvas");return e.style.display="block",e}(),r=void 0!==e.context?e.context:null,n=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",h=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let d;d=null!==r?r.getContextAttributes().alpha:void 0!==e.alpha&&e.alpha;let u=null,g=null;const x=[],b=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Ct,this.physicallyCorrectLights=!1,this.toneMapping=X,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const y=this;let w=!1,v=0,$=0,M=null,S=-1,P=null;const k=new Yi,_=new Yi;let T=null,C=t.width,A=t.height,D=1,R=null,E=null;const L=new Yi(0,0,C,A),I=new Yi(0,0,C,A);let B=!1;const V=new ko;let O=!1,W=!1,H=null;const F=new Ir,Q=new _i,z=new nr,G={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function N(){return null===M?D:1}let U,j,q,Y,J,Z,K,ee,te,ie,re,ne,oe,ae,se,le,ce,he,de,ue,pe,me,fe,ge,xe=r;function ye(e,i){for(let r=0;r<e.length;r++){const n=e[r],o=t.getContext(n,i);if(null!==o)return o}return null}try{const e={alpha:!0,depth:n,stencil:o,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${i}`),t.addEventListener("webglcontextlost",Me,!1),t.addEventListener("webglcontextrestored",Se,!1),t.addEventListener("webglcontextcreationerror",Pe,!1),null===xe){const t=["webgl2","webgl","experimental-webgl"];if(!0===y.isWebGL1Renderer&&t.shift(),xe=ye(t,e),null===xe)throw ye(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===xe.getShaderPrecisionFormat&&(xe.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function ve(){U=new ta(xe),j=new Bo(xe,U,e),U.init(j),me=new Xs(xe,U,j),q=new js(xe,U,j),Y=new na,J=new Es,Z=new qs(xe,U,q,J,j,me,Y),K=new Oo(y),ee=new ea(y),te=new To(xe,j),fe=new Lo(xe,U,te,j),ie=new ia(xe,te,Y,fe),re=new la(xe,ie,te,Y),de=new sa(xe,j,Z),le=new Vo(J),ne=new Rs(y,K,ee,U,j,fe,le),oe=new il(y,J),ae=new Vs,se=new zs(U,j),he=new Eo(y,K,q,re,d,s),ce=new Us(y,re,j),ge=new rl(xe,Y,j,q),ue=new Io(xe,U,Y,j),pe=new ra(xe,U,Y,j),Y.programs=ne.programs,y.capabilities=j,y.extensions=U,y.properties=J,y.renderLists=ae,y.shadowMap=ce,y.state=q,y.info=Y}ve();const $e=new tl(y,xe);function Me(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),w=!0}function Se(){console.log("THREE.WebGLRenderer: Context Restored."),w=!1;const e=Y.autoReset,t=ce.enabled,i=ce.autoUpdate,r=ce.needsUpdate,n=ce.type;ve(),Y.autoReset=e,ce.enabled=t,ce.autoUpdate=i,ce.needsUpdate=r,ce.type=n}function Pe(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Te(e){const t=e.target;t.removeEventListener("dispose",Te),function(e){(function(e){const t=J.get(e).programs;void 0!==t&&(t.forEach((function(e){ne.releaseProgram(e)})),e.isShaderMaterial&&ne.releaseShaderCache(e))})(e),J.remove(e)}(t)}this.xr=$e,this.getContext=function(){return xe},this.getContextAttributes=function(){return xe.getContextAttributes()},this.forceContextLoss=function(){const e=U.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=U.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return D},this.setPixelRatio=function(e){void 0!==e&&(D=e,this.setSize(C,A,!1))},this.getSize=function(e){return e.set(C,A)},this.setSize=function(e,i,r){$e.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(C=e,A=i,t.width=Math.floor(e*D),t.height=Math.floor(i*D),!1!==r&&(t.style.width=e+"px",t.style.height=i+"px"),this.setViewport(0,0,e,i))},this.getDrawingBufferSize=function(e){return e.set(C*D,A*D).floor()},this.setDrawingBufferSize=function(e,i,r){C=e,A=i,D=r,t.width=Math.floor(e*r),t.height=Math.floor(i*r),this.setViewport(0,0,e,i)},this.getCurrentViewport=function(e){return e.copy(k)},this.getViewport=function(e){return e.copy(L)},this.setViewport=function(e,t,i,r){e.isVector4?L.set(e.x,e.y,e.z,e.w):L.set(e,t,i,r),q.viewport(k.copy(L).multiplyScalar(D).floor())},this.getScissor=function(e){return e.copy(I)},this.setScissor=function(e,t,i,r){e.isVector4?I.set(e.x,e.y,e.z,e.w):I.set(e,t,i,r),q.scissor(_.copy(I).multiplyScalar(D).floor())},this.getScissorTest=function(){return B},this.setScissorTest=function(e){q.setScissorTest(B=e)},this.setOpaqueSort=function(e){R=e},this.setTransparentSort=function(e){E=e},this.getClearColor=function(e){return e.copy(he.getClearColor())},this.setClearColor=function(){he.setClearColor.apply(he,arguments)},this.getClearAlpha=function(){return he.getClearAlpha()},this.setClearAlpha=function(){he.setClearAlpha.apply(he,arguments)},this.clear=function(e=!0,t=!0,i=!0){let r=0;e&&(r|=16384),t&&(r|=256),i&&(r|=1024),xe.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Me,!1),t.removeEventListener("webglcontextrestored",Se,!1),t.removeEventListener("webglcontextcreationerror",Pe,!1),ae.dispose(),se.dispose(),J.dispose(),K.dispose(),ee.dispose(),re.dispose(),fe.dispose(),ge.dispose(),ne.dispose(),$e.dispose(),$e.removeEventListener("sessionstart",Ae),$e.removeEventListener("sessionend",De),H&&(H.dispose(),H=null),Re.stop()},this.renderBufferDirect=function(e,t,i,r,n,o){null===t&&(t=G);const a=n.isMesh&&n.matrixWorld.determinant()<0,s=function(e,t,i,r,n){!0!==t.isScene&&(t=G);Z.resetTextureUnits();const o=t.fog,a=r.isMeshStandardMaterial?t.environment:null,s=null===M?y.outputEncoding:!0===M.isXRRenderTarget?M.texture.encoding:Ct,l=(r.isMeshStandardMaterial?ee:K).get(r.envMap||a),c=!0===r.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,h=!!r.normalMap&&!!i.attributes.tangent,d=!!i.morphAttributes.position,u=!!i.morphAttributes.normal,p=!!i.morphAttributes.color,m=r.toneMapped?y.toneMapping:X,f=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,x=void 0!==f?f.length:0,b=J.get(r),w=g.state.lights;if(!0===O&&(!0===W||e!==P)){const t=e===P&&r.id===S;le.setState(r,e,t)}let v=!1;r.version===b.__version?b.needsLights&&b.lightsStateVersion!==w.state.version||b.outputEncoding!==s||n.isInstancedMesh&&!1===b.instancing?v=!0:n.isInstancedMesh||!0!==b.instancing?n.isSkinnedMesh&&!1===b.skinning?v=!0:n.isSkinnedMesh||!0!==b.skinning?b.envMap!==l||!0===r.fog&&b.fog!==o?v=!0:void 0===b.numClippingPlanes||b.numClippingPlanes===le.numPlanes&&b.numIntersection===le.numIntersection?(b.vertexAlphas!==c||b.vertexTangents!==h||b.morphTargets!==d||b.morphNormals!==u||b.morphColors!==p||b.toneMapping!==m||!0===j.isWebGL2&&b.morphTargetsCount!==x)&&(v=!0):v=!0:v=!0:v=!0:(v=!0,b.__version=r.version);let $=b.currentProgram;!0===v&&($=Oe(r,t,n));let k=!1,_=!1,T=!1;const C=$.getUniforms(),R=b.uniforms;q.useProgram($.program)&&(k=!0,_=!0,T=!0);r.id!==S&&(S=r.id,_=!0);if(k||P!==e){if(C.setValue(xe,"projectionMatrix",e.projectionMatrix),j.logarithmicDepthBuffer&&C.setValue(xe,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),P!==e&&(P=e,_=!0,T=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){const t=C.map.cameraPosition;void 0!==t&&t.setValue(xe,z.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&C.setValue(xe,"isOrthographic",!0===e.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.isShadowMaterial||n.isSkinnedMesh)&&C.setValue(xe,"viewMatrix",e.matrixWorldInverse)}if(n.isSkinnedMesh){C.setOptional(xe,n,"bindMatrix"),C.setOptional(xe,n,"bindMatrixInverse");const e=n.skeleton;e&&(j.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),C.setValue(xe,"boneTexture",e.boneTexture,Z),C.setValue(xe,"boneTextureSize",e.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const E=i.morphAttributes;(void 0!==E.position||void 0!==E.normal||void 0!==E.color&&!0===j.isWebGL2)&&de.update(n,i,r,$);(_||b.receiveShadow!==n.receiveShadow)&&(b.receiveShadow=n.receiveShadow,C.setValue(xe,"receiveShadow",n.receiveShadow));r.isMeshGouraudMaterial&&null!==r.envMap&&(R.envMap.value=l,R.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);_&&(C.setValue(xe,"toneMappingExposure",y.toneMappingExposure),b.needsLights&&(I=T,(L=R).ambientLightColor.needsUpdate=I,L.lightProbe.needsUpdate=I,L.directionalLights.needsUpdate=I,L.directionalLightShadows.needsUpdate=I,L.pointLights.needsUpdate=I,L.pointLightShadows.needsUpdate=I,L.spotLights.needsUpdate=I,L.spotLightShadows.needsUpdate=I,L.rectAreaLights.needsUpdate=I,L.hemisphereLights.needsUpdate=I),o&&!0===r.fog&&oe.refreshFogUniforms(R,o),oe.refreshMaterialUniforms(R,r,D,A,H),us.upload(xe,b.uniformsList,R,Z));var L,I;r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(us.upload(xe,b.uniformsList,R,Z),r.uniformsNeedUpdate=!1);r.isSpriteMaterial&&C.setValue(xe,"center",n.center);if(C.setValue(xe,"modelViewMatrix",n.modelViewMatrix),C.setValue(xe,"normalMatrix",n.normalMatrix),C.setValue(xe,"modelMatrix",n.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial){const e=r.uniformsGroups;for(let t=0,i=e.length;t<i;t++)if(j.isWebGL2){const i=e[t];ge.update(i,$),ge.bind(i,$)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return $}(e,t,i,r,n);q.setMaterial(r,a);let l=i.index;const c=i.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let h,d=1;!0===r.wireframe&&(l=ie.getWireframeAttribute(i),d=2),fe.setup(n,r,s,i,l);let u=ue;null!==l&&(h=te.get(l),u=pe,u.setIndex(h));const p=null!==l?l.count:c.count,m=i.drawRange.start*d,f=i.drawRange.count*d,x=null!==o?o.start*d:0,b=null!==o?o.count*d:1/0,w=Math.max(m,x),v=Math.min(p,m+f,x+b)-1,$=Math.max(0,v-w+1);if(0!==$){if(n.isMesh)!0===r.wireframe?(q.setLineWidth(r.wireframeLinewidth*N()),u.setMode(1)):u.setMode(4);else if(n.isLine){let e=r.linewidth;void 0===e&&(e=1),q.setLineWidth(e*N()),n.isLineSegments?u.setMode(1):n.isLineLoop?u.setMode(2):u.setMode(3)}else n.isPoints?u.setMode(0):n.isSprite&&u.setMode(4);if(n.isInstancedMesh)u.renderInstances(w,$,n.count);else if(i.isInstancedBufferGeometry){const e=Math.min(i.instanceCount,i._maxInstanceCount);u.renderInstances(w,$,e)}else u.render(w,$)}},this.compile=function(e,t){function i(e,t,i){!0===e.transparent&&e.side===f?(e.side=m,e.needsUpdate=!0,Oe(e,t,i),e.side=p,e.needsUpdate=!0,Oe(e,t,i),e.side=f):Oe(e,t,i)}g=se.get(e),g.init(),b.push(g),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(g.pushLight(e),e.castShadow&&g.pushShadow(e))})),g.setupLights(y.physicallyCorrectLights),e.traverse((function(t){const r=t.material;if(r)if(Array.isArray(r))for(let n=0;n<r.length;n++){i(r[n],e,t)}else i(r,e,t)})),b.pop(),g=null};let Ce=null;function Ae(){Re.stop()}function De(){Re.start()}const Re=new _o;function Le(e,t,i,r){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)i=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)g.pushLight(e),e.castShadow&&g.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||V.intersectsSprite(e)){r&&z.setFromMatrixPosition(e.matrixWorld).applyMatrix4(F);const t=re.update(e),n=e.material;n.visible&&u.push(e,t,n,i,z.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==Y.render.frame&&(e.skeleton.update(),e.skeleton.frame=Y.render.frame),!e.frustumCulled||V.intersectsObject(e))){r&&z.setFromMatrixPosition(e.matrixWorld).applyMatrix4(F);const t=re.update(e),n=e.material;if(Array.isArray(n)){const r=t.groups;for(let o=0,a=r.length;o<a;o++){const a=r[o],s=n[a.materialIndex];s&&s.visible&&u.push(e,t,s,i,z.z,a)}}else n.visible&&u.push(e,t,n,i,z.z,null)}const n=e.children;for(let e=0,o=n.length;e<o;e++)Le(n[e],t,i,r)}function Ie(e,t,i,r){const n=e.opaque,o=e.transmissive,s=e.transparent;g.setupLightsView(i),o.length>0&&function(e,t,i){const r=j.isWebGL2;null===H&&(H=new Ji(1,1,{generateMipmaps:!0,type:U.has("EXT_color_buffer_half_float")?_e:we,minFilter:be,samples:r&&!0===a?4:0}));y.getDrawingBufferSize(Q),r?H.setSize(Q.x,Q.y):H.setSize(Mi(Q.x),Mi(Q.y));const n=y.getRenderTarget();y.setRenderTarget(H),y.clear();const o=y.toneMapping;y.toneMapping=X,Be(e,t,i),y.toneMapping=o,Z.updateMultisampleRenderTarget(H),Z.updateRenderTargetMipmap(H),y.setRenderTarget(n)}(n,t,i),r&&q.viewport(k.copy(r)),n.length>0&&Be(n,t,i),o.length>0&&Be(o,t,i),s.length>0&&Be(s,t,i),q.buffers.depth.setTest(!0),q.buffers.depth.setMask(!0),q.buffers.color.setMask(!0),q.setPolygonOffset(!1)}function Be(e,t,i){const r=!0===t.isScene?t.overrideMaterial:null;for(let n=0,o=e.length;n<o;n++){const o=e[n],a=o.object,s=o.geometry,l=null===r?o.material:r,c=o.group;a.layers.test(i.layers)&&Ve(a,t,i,s,l,c)}}function Ve(e,t,i,r,n,o){e.onBeforeRender(y,t,i,r,n,o),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),n.onBeforeRender(y,t,i,r,e,o),!0===n.transparent&&n.side===f?(n.side=m,n.needsUpdate=!0,y.renderBufferDirect(i,t,r,n,e,o),n.side=p,n.needsUpdate=!0,y.renderBufferDirect(i,t,r,n,e,o),n.side=f):y.renderBufferDirect(i,t,r,n,e,o),e.onAfterRender(y,t,i,r,n,o)}function Oe(e,t,i){!0!==t.isScene&&(t=G);const r=J.get(e),n=g.state.lights,o=g.state.shadowsArray,a=n.state.version,s=ne.getParameters(e,n.state,o,t,i),l=ne.getProgramCacheKey(s);let c=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?ee:K).get(e.envMap||r.environment),void 0===c&&(e.addEventListener("dispose",Te),c=new Map,r.programs=c);let h=c.get(l);if(void 0!==h){if(r.currentProgram===h&&r.lightsStateVersion===a)return We(e,s),h}else s.uniforms=ne.getUniforms(e),e.onBuild(i,s,y),e.onBeforeCompile(s,y),h=ne.acquireProgram(s,l),c.set(l,h),r.uniforms=s.uniforms;const d=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(d.clippingPlanes=le.uniform),We(e,s),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=a,r.needsLights&&(d.ambientLightColor.value=n.state.ambient,d.lightProbe.value=n.state.probe,d.directionalLights.value=n.state.directional,d.directionalLightShadows.value=n.state.directionalShadow,d.spotLights.value=n.state.spot,d.spotLightShadows.value=n.state.spotShadow,d.rectAreaLights.value=n.state.rectArea,d.ltc_1.value=n.state.rectAreaLTC1,d.ltc_2.value=n.state.rectAreaLTC2,d.pointLights.value=n.state.point,d.pointLightShadows.value=n.state.pointShadow,d.hemisphereLights.value=n.state.hemi,d.directionalShadowMap.value=n.state.directionalShadowMap,d.directionalShadowMatrix.value=n.state.directionalShadowMatrix,d.spotShadowMap.value=n.state.spotShadowMap,d.spotLightMatrix.value=n.state.spotLightMatrix,d.spotLightMap.value=n.state.spotLightMap,d.pointShadowMap.value=n.state.pointShadowMap,d.pointShadowMatrix.value=n.state.pointShadowMatrix);const u=h.getUniforms(),p=us.seqWithValue(u.seq,d);return r.currentProgram=h,r.uniformsList=p,h}function We(e,t){const i=J.get(e);i.outputEncoding=t.outputEncoding,i.instancing=t.instancing,i.skinning=t.skinning,i.morphTargets=t.morphTargets,i.morphNormals=t.morphNormals,i.morphColors=t.morphColors,i.morphTargetsCount=t.morphTargetsCount,i.numClippingPlanes=t.numClippingPlanes,i.numIntersection=t.numClipIntersection,i.vertexAlphas=t.vertexAlphas,i.vertexTangents=t.vertexTangents,i.toneMapping=t.toneMapping}Re.setAnimationLoop((function(e){Ce&&Ce(e)})),"undefined"!=typeof self&&Re.setContext(self),this.setAnimationLoop=function(e){Ce=e,$e.setAnimationLoop(e),null===e?Re.stop():Re.start()},$e.addEventListener("sessionstart",Ae),$e.addEventListener("sessionend",De),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===w)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===$e.enabled&&!0===$e.isPresenting&&(!0===$e.cameraAutoUpdate&&$e.updateCamera(t),t=$e.getCamera()),!0===e.isScene&&e.onBeforeRender(y,e,t,M),g=se.get(e,b.length),g.init(),b.push(g),F.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),V.setFromProjectionMatrix(F),W=this.localClippingEnabled,O=le.init(this.clippingPlanes,W,t),u=ae.get(e,x.length),u.init(),x.push(u),Le(e,t,0,y.sortObjects),u.finish(),!0===y.sortObjects&&u.sort(R,E),!0===O&&le.beginShadows();const i=g.state.shadowsArray;if(ce.render(i,e,t),!0===O&&le.endShadows(),!0===this.info.autoReset&&this.info.reset(),he.render(u,e),g.setupLights(y.physicallyCorrectLights),t.isArrayCamera){const i=t.cameras;for(let t=0,r=i.length;t<r;t++){const r=i[t];Ie(u,e,r,r.viewport)}}else Ie(u,e,t);null!==M&&(Z.updateMultisampleRenderTarget(M),Z.updateRenderTargetMipmap(M)),!0===e.isScene&&e.onAfterRender(y,e,t),fe.resetDefaultState(),S=-1,P=null,b.pop(),g=b.length>0?b[b.length-1]:null,x.pop(),u=x.length>0?x[x.length-1]:null},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return $},this.getRenderTarget=function(){return M},this.setRenderTargetTextures=function(e,t,i){J.get(e.texture).__webglTexture=t,J.get(e.depthTexture).__webglTexture=i;const r=J.get(e);r.__hasExternalTextures=!0,r.__hasExternalTextures&&(r.__autoAllocateDepthBuffer=void 0===i,r.__autoAllocateDepthBuffer||!0===U.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){const i=J.get(e);i.__webglFramebuffer=t,i.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,i=0){M=e,v=t,$=i;let r=!0;if(e){const t=J.get(e);void 0!==t.__useDefaultFramebuffer?(q.bindFramebuffer(36160,null),r=!1):void 0===t.__webglFramebuffer?Z.setupRenderTarget(e):t.__hasExternalTextures&&Z.rebindTextures(e,J.get(e.texture).__webglTexture,J.get(e.depthTexture).__webglTexture)}let n=null,o=!1,a=!1;if(e){const i=e.texture;(i.isData3DTexture||i.isDataArrayTexture)&&(a=!0);const r=J.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(n=r[t],o=!0):n=j.isWebGL2&&e.samples>0&&!1===Z.useMultisampledRTT(e)?J.get(e).__webglMultisampledFramebuffer:r,k.copy(e.viewport),_.copy(e.scissor),T=e.scissorTest}else k.copy(L).multiplyScalar(D).floor(),_.copy(I).multiplyScalar(D).floor(),T=B;if(q.bindFramebuffer(36160,n)&&j.drawBuffers&&r&&q.drawBuffers(e,n),q.viewport(k),q.scissor(_),q.setScissorTest(T),o){const r=J.get(e.texture);xe.framebufferTexture2D(36160,36064,34069+t,r.__webglTexture,i)}else if(a){const r=J.get(e.texture),n=t||0;xe.framebufferTextureLayer(36160,36064,r.__webglTexture,i||0,n)}S=-1},this.readRenderTargetPixels=function(e,t,i,r,n,o,a){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let s=J.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(s=s[a]),s){q.bindFramebuffer(36160,s);try{const a=e.texture,s=a.format,l=a.type;if(s!==Ee&&me.convert(s)!==xe.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===_e&&(U.has("EXT_color_buffer_half_float")||j.isWebGL2&&U.has("EXT_color_buffer_float"));if(!(l===we||me.convert(l)===xe.getParameter(35738)||l===ke&&(j.isWebGL2||U.has("OES_texture_float")||U.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-r&&i>=0&&i<=e.height-n&&xe.readPixels(t,i,r,n,me.convert(s),me.convert(l),o)}finally{const e=null!==M?J.get(M).__webglFramebuffer:null;q.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t,i=0){const r=Math.pow(2,-i),n=Math.floor(t.image.width*r),o=Math.floor(t.image.height*r);Z.setTexture2D(t,0),xe.copyTexSubImage2D(3553,i,0,0,e.x,e.y,n,o),q.unbindTexture()},this.copyTextureToTexture=function(e,t,i,r=0){const n=t.image.width,o=t.image.height,a=me.convert(i.format),s=me.convert(i.type);Z.setTexture2D(i,0),xe.pixelStorei(37440,i.flipY),xe.pixelStorei(37441,i.premultiplyAlpha),xe.pixelStorei(3317,i.unpackAlignment),t.isDataTexture?xe.texSubImage2D(3553,r,e.x,e.y,n,o,a,s,t.image.data):t.isCompressedTexture?xe.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,a,t.mipmaps[0].data):xe.texSubImage2D(3553,r,e.x,e.y,a,s,t.image),0===r&&i.generateMipmaps&&xe.generateMipmap(3553),q.unbindTexture()},this.copyTextureToTexture3D=function(e,t,i,r,n=0){if(y.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const o=e.max.x-e.min.x+1,a=e.max.y-e.min.y+1,s=e.max.z-e.min.z+1,l=me.convert(r.format),c=me.convert(r.type);let h;if(r.isData3DTexture)Z.setTexture3D(r,0),h=32879;else{if(!r.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Z.setTexture2DArray(r,0),h=35866}xe.pixelStorei(37440,r.flipY),xe.pixelStorei(37441,r.premultiplyAlpha),xe.pixelStorei(3317,r.unpackAlignment);const d=xe.getParameter(3314),u=xe.getParameter(32878),p=xe.getParameter(3316),m=xe.getParameter(3315),f=xe.getParameter(32877),g=i.isCompressedTexture?i.mipmaps[0]:i.image;xe.pixelStorei(3314,g.width),xe.pixelStorei(32878,g.height),xe.pixelStorei(3316,e.min.x),xe.pixelStorei(3315,e.min.y),xe.pixelStorei(32877,e.min.z),i.isDataTexture||i.isData3DTexture?xe.texSubImage3D(h,n,t.x,t.y,t.z,o,a,s,l,c,g.data):i.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),xe.compressedTexSubImage3D(h,n,t.x,t.y,t.z,o,a,s,l,g.data)):xe.texSubImage3D(h,n,t.x,t.y,t.z,o,a,s,l,c,g),xe.pixelStorei(3314,d),xe.pixelStorei(32878,u),xe.pixelStorei(3316,p),xe.pixelStorei(3315,m),xe.pixelStorei(32877,f),0===n&&r.generateMipmaps&&xe.generateMipmap(h),q.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?Z.setTextureCube(e,0):e.isData3DTexture?Z.setTexture3D(e,0):e.isDataArrayTexture?Z.setTexture2DArray(e,0):Z.setTexture2D(e,0),q.unbindTexture()},this.resetState=function(){v=0,$=0,M=null,q.reset(),fe.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class ol extends nl{}ol.prototype.isWebGL1Renderer=!0;class al{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new zi(e),this.density=t}clone(){return new al(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class sl{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new zi(e),this.near=t,this.far=i}clone(){return new sl(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class ll extends sn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class cl{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=ei,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=xi()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,n=this.stride;r<n;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=xi()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=xi()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const hl=new nr;class dl{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)hl.fromBufferAttribute(this,t),hl.applyMatrix4(e),this.setXYZ(t,hl.x,hl.y,hl.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)hl.fromBufferAttribute(this,t),hl.applyNormalMatrix(e),this.setXYZ(t,hl.x,hl.y,hl.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)hl.fromBufferAttribute(this,t),hl.transformDirection(e),this.setXYZ(t,hl.x,hl.y,hl.z);return this}setX(e,t){return this.normalized&&(t=Pi(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Pi(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Pi(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Pi(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Si(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Si(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Si(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Si(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Pi(t,this.array),i=Pi(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Pi(t,this.array),i=Pi(i,this.array),r=Pi(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Pi(t,this.array),i=Pi(i,this.array),r=Pi(r,this.array),n=Pi(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=n,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return new Sn(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new dl(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class ul extends wn{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new zi(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let pl;const ml=new nr,fl=new nr,gl=new nr,xl=new _i,bl=new _i,yl=new Ir,wl=new nr,vl=new nr,$l=new nr,Ml=new _i,Sl=new _i,Pl=new _i;class kl extends sn{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",void 0===pl){pl=new Qn;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new cl(e,5);pl.setIndex([0,1,2,0,2,3]),pl.setAttribute("position",new dl(t,3,0,!1)),pl.setAttribute("uv",new dl(t,2,3,!1))}this.geometry=pl,this.material=void 0!==e?e:new ul,this.center=new _i(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),fl.setFromMatrixScale(this.matrixWorld),yl.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),gl.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&fl.multiplyScalar(-gl.z);const i=this.material.rotation;let r,n;0!==i&&(n=Math.cos(i),r=Math.sin(i));const o=this.center;_l(wl.set(-.5,-.5,0),gl,o,fl,r,n),_l(vl.set(.5,-.5,0),gl,o,fl,r,n),_l($l.set(.5,.5,0),gl,o,fl,r,n),Ml.set(0,0),Sl.set(1,0),Pl.set(1,1);let a=e.ray.intersectTriangle(wl,vl,$l,!1,ml);if(null===a&&(_l(vl.set(-.5,.5,0),gl,o,fl,r,n),Sl.set(0,1),a=e.ray.intersectTriangle(wl,$l,vl,!1,ml),null===a))return;const s=e.ray.origin.distanceTo(ml);s<e.near||s>e.far||t.push({distance:s,point:ml.clone(),uv:bn.getUV(ml,wl,vl,$l,Ml,Sl,Pl,new _i),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function _l(e,t,i,r,n,o){xl.subVectors(e,i).addScalar(.5).multiply(r),void 0!==n?(bl.x=o*xl.x-n*xl.y,bl.y=n*xl.x+o*xl.y):bl.copy(xl),e.copy(t),e.x+=bl.x,e.y+=bl.y,e.applyMatrix4(yl)}const Tl=new nr,Cl=new nr;class Al extends sn{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let e=0,i=t.length;e<i;e++){const i=t[e];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const i=this.levels;let r;for(r=0;r<i.length&&!(t<i[r].distance);r++);return i.splice(r,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let i,r;for(i=1,r=t.length;i<r&&!(e<t[i].distance);i++);return t[i-1].object}return null}raycast(e,t){if(this.levels.length>0){Tl.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(Tl);this.getObjectForDistance(i).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Tl.setFromMatrixPosition(e.matrixWorld),Cl.setFromMatrixPosition(this.matrixWorld);const i=Tl.distanceTo(Cl)/e.zoom;let r,n;for(t[0].object.visible=!0,r=1,n=t.length;r<n&&i>=t[r].distance;r++)t[r-1].object.visible=!1,t[r].object.visible=!0;for(this._currentLevel=r-1;r<n;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let e=0,r=i.length;e<r;e++){const r=i[e];t.object.levels.push({object:r.object.uuid,distance:r.distance})}return t}}const Dl=new nr,Rl=new Yi,El=new Yi,Ll=new nr,Il=new Ir;class Bl extends ao{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Ir,this.bindMatrixInverse=new Ir}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Yi,t=this.geometry.attributes.skinWeight;for(let i=0,r=t.count;i<r;i++){e.fromBufferAttribute(t,i);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const i=this.skeleton,r=this.geometry;Rl.fromBufferAttribute(r.attributes.skinIndex,e),El.fromBufferAttribute(r.attributes.skinWeight,e),Dl.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const r=El.getComponent(e);if(0!==r){const n=Rl.getComponent(e);Il.multiplyMatrices(i.bones[n].matrixWorld,i.boneInverses[n]),t.addScaledVector(Ll.copy(Dl).applyMatrix4(Il),r)}}return t.applyMatrix4(this.bindMatrixInverse)}}class Vl extends sn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Ol extends Xi{constructor(e=null,t=1,i=1,r,n,o,a,s,l=he,c=he,h,d){super(null,o,a,s,l,c,r,n,h,d),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Wl=new Ir,Hl=new Ir;class Fl{constructor(e=[],t=[]){this.uuid=xi(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Ir)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new Ir;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let r=0,n=e.length;r<n;r++){const n=e[r]?e[r].matrixWorld:Hl;Wl.multiplyMatrices(n,t[r]),Wl.toArray(i,16*r)}null!==r&&(r.needsUpdate=!0)}clone(){return new Fl(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=$i(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new Ol(t,e,e,Ee,ke);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const i=this.bones[t];if(i.name===e)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){const r=e.bones[i];let n=t[r];void 0===n&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),n=new Vl),this.bones.push(n),this.boneInverses.push((new Ir).fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let r=0,n=t.length;r<n;r++){const n=t[r];e.bones.push(n.uuid);const o=i[r];e.boneInverses.push(o.toArray())}return e}}class Ql extends Sn{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const zl=new Ir,Gl=new Ir,Nl=[],Ul=new ao;class jl extends ao{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Ql(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const i=this.matrixWorld,r=this.count;if(Ul.geometry=this.geometry,Ul.material=this.material,void 0!==Ul.material)for(let n=0;n<r;n++){this.getMatrixAt(n,zl),Gl.multiplyMatrices(i,zl),Ul.matrixWorld=Gl,Ul.raycast(e,Nl);for(let e=0,i=Nl.length;e<i;e++){const i=Nl[e];i.instanceId=n,i.object=this,t.push(i)}Nl.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Ql(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class ql extends wn{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new zi(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Xl=new nr,Yl=new nr,Jl=new Ir,Zl=new Lr,Kl=new kr;class ec extends sn{constructor(e=new Qn,t=new ql){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,i=[0];for(let e=1,r=t.count;e<r;e++)Xl.fromBufferAttribute(t,e-1),Yl.fromBufferAttribute(t,e),i[e]=i[e-1],i[e]+=Xl.distanceTo(Yl);e.setAttribute("lineDistance",new En(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,n=e.params.Line.threshold,o=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Kl.copy(i.boundingSphere),Kl.applyMatrix4(r),Kl.radius+=n,!1===e.ray.intersectsSphere(Kl))return;Jl.copy(r).invert(),Zl.copy(e.ray).applyMatrix4(Jl);const a=n/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a,l=new nr,c=new nr,h=new nr,d=new nr,u=this.isLineSegments?2:1,p=i.index,m=i.attributes.position;if(null!==p){for(let i=Math.max(0,o.start),r=Math.min(p.count,o.start+o.count)-1;i<r;i+=u){const r=p.getX(i),n=p.getX(i+1);l.fromBufferAttribute(m,r),c.fromBufferAttribute(m,n);if(Zl.distanceSqToSegment(l,c,d,h)>s)continue;d.applyMatrix4(this.matrixWorld);const o=e.ray.origin.distanceTo(d);o<e.near||o>e.far||t.push({distance:o,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else{for(let i=Math.max(0,o.start),r=Math.min(m.count,o.start+o.count)-1;i<r;i+=u){l.fromBufferAttribute(m,i),c.fromBufferAttribute(m,i+1);if(Zl.distanceSqToSegment(l,c,d,h)>s)continue;d.applyMatrix4(this.matrixWorld);const r=e.ray.origin.distanceTo(d);r<e.near||r>e.far||t.push({distance:r,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++){const t=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}const tc=new nr,ic=new nr;class rc extends ec{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,i=[];for(let e=0,r=t.count;e<r;e+=2)tc.fromBufferAttribute(t,e),ic.fromBufferAttribute(t,e+1),i[e]=0===e?0:i[e-1],i[e+1]=i[e]+tc.distanceTo(ic);e.setAttribute("lineDistance",new En(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class nc extends ec{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class oc extends wn{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new zi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const ac=new Ir,sc=new Lr,lc=new kr,cc=new nr;class hc extends sn{constructor(e=new Qn,t=new oc){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,n=e.params.Points.threshold,o=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),lc.copy(i.boundingSphere),lc.applyMatrix4(r),lc.radius+=n,!1===e.ray.intersectsSphere(lc))return;ac.copy(r).invert(),sc.copy(e.ray).applyMatrix4(ac);const a=n/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a,l=i.index,c=i.attributes.position;if(null!==l){for(let i=Math.max(0,o.start),n=Math.min(l.count,o.start+o.count);i<n;i++){const n=l.getX(i);cc.fromBufferAttribute(c,n),dc(cc,n,s,r,e,t,this)}}else{for(let i=Math.max(0,o.start),n=Math.min(c.count,o.start+o.count);i<n;i++)cc.fromBufferAttribute(c,i),dc(cc,i,s,r,e,t,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++){const t=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function dc(e,t,i,r,n,o,a){const s=sc.distanceSqToPoint(e);if(s<i){const i=new nr;sc.closestPointToPoint(e,i),i.applyMatrix4(r);const l=n.ray.origin.distanceTo(i);if(l<n.near||l>n.far)return;o.push({distance:l,distanceToRay:Math.sqrt(s),point:i,index:t,face:null,object:a})}}class uc extends Xi{constructor(e,t,i,r,n,o,a,s,l){super(e,t,i,r,n,o,a,s,l),this.isVideoTexture=!0,this.minFilter=void 0!==o?o:fe,this.magFilter=void 0!==n?n:fe,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class pc extends Xi{constructor(e,t,i){super({width:e,height:t}),this.isFramebufferTexture=!0,this.format=i,this.magFilter=he,this.minFilter=he,this.generateMipmaps=!1,this.needsUpdate=!0}}class mc extends Xi{constructor(e,t,i,r,n,o,a,s,l,c,h,d){super(null,o,a,s,l,c,r,n,h,d),this.isCompressedTexture=!0,this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class fc extends Xi{constructor(e,t,i,r,n,o,a,s,l){super(e,t,i,r,n,o,a,s,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class gc{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,r=this.getPoint(0),n=0;t.push(0);for(let o=1;o<=e;o++)i=this.getPoint(o/e),n+=i.distanceTo(r),t.push(n),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let r=0;const n=i.length;let o;o=t||e*i[n-1];let a,s=0,l=n-1;for(;s<=l;)if(r=Math.floor(s+(l-s)/2),a=i[r]-o,a<0)s=r+1;else{if(!(a>0)){l=r;break}l=r-1}if(r=l,i[r]===o)return r/(n-1);const c=i[r];return(r+(o-c)/(i[r+1]-c))/(n-1)}getTangent(e,t){const i=1e-4;let r=e-i,n=e+i;r<0&&(r=0),n>1&&(n=1);const o=this.getPoint(r),a=this.getPoint(n),s=t||(o.isVector2?new _i:new nr);return s.copy(a).sub(o).normalize(),s}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new nr,r=[],n=[],o=[],a=new nr,s=new Ir;for(let t=0;t<=e;t++){const i=t/e;r[t]=this.getTangentAt(i,new nr)}n[0]=new nr,o[0]=new nr;let l=Number.MAX_VALUE;const c=Math.abs(r[0].x),h=Math.abs(r[0].y),d=Math.abs(r[0].z);c<=l&&(l=c,i.set(1,0,0)),h<=l&&(l=h,i.set(0,1,0)),d<=l&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),n[0].crossVectors(r[0],a),o[0].crossVectors(r[0],n[0]);for(let t=1;t<=e;t++){if(n[t]=n[t-1].clone(),o[t]=o[t-1].clone(),a.crossVectors(r[t-1],r[t]),a.length()>Number.EPSILON){a.normalize();const e=Math.acos(bi(r[t-1].dot(r[t]),-1,1));n[t].applyMatrix4(s.makeRotationAxis(a,e))}o[t].crossVectors(r[t],n[t])}if(!0===t){let t=Math.acos(bi(n[0].dot(n[e]),-1,1));t/=e,r[0].dot(a.crossVectors(n[0],n[e]))>0&&(t=-t);for(let i=1;i<=e;i++)n[i].applyMatrix4(s.makeRotationAxis(r[i],t*i)),o[i].crossVectors(r[i],n[i])}return{tangents:r,normals:n,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class xc extends gc{constructor(e=0,t=0,i=1,r=1,n=0,o=2*Math.PI,a=!1,s=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=n,this.aEndAngle=o,this.aClockwise=a,this.aRotation=s}getPoint(e,t){const i=t||new _i,r=2*Math.PI;let n=this.aEndAngle-this.aStartAngle;const o=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(n=o?0:r),!0!==this.aClockwise||o||(n===r?n=-r:n-=r);const a=this.aStartAngle+e*n;let s=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),i=s-this.aX,r=l-this.aY;s=i*e-r*t+this.aX,l=i*t+r*e+this.aY}return i.set(s,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class bc extends xc{constructor(e,t,i,r,n,o){super(e,t,i,i,r,n,o),this.isArcCurve=!0,this.type="ArcCurve"}}function yc(){let e=0,t=0,i=0,r=0;function n(n,o,a,s){e=n,t=a,i=-3*n+3*o-2*a-s,r=2*n-2*o+a+s}return{initCatmullRom:function(e,t,i,r,o){n(t,i,o*(i-e),o*(r-t))},initNonuniformCatmullRom:function(e,t,i,r,o,a,s){let l=(t-e)/o-(i-e)/(o+a)+(i-t)/a,c=(i-t)/a-(r-t)/(a+s)+(r-i)/s;l*=a,c*=a,n(t,i,l,c)},calc:function(n){const o=n*n;return e+t*n+i*o+r*(o*n)}}}const wc=new nr,vc=new yc,$c=new yc,Mc=new yc;class Sc extends gc{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new nr){const i=t,r=this.points,n=r.length,o=(n-(this.closed?0:1))*e;let a,s,l=Math.floor(o),c=o-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/n)+1)*n:0===c&&l===n-1&&(l=n-2,c=1),this.closed||l>0?a=r[(l-1)%n]:(wc.subVectors(r[0],r[1]).add(r[0]),a=wc);const h=r[l%n],d=r[(l+1)%n];if(this.closed||l+2<n?s=r[(l+2)%n]:(wc.subVectors(r[n-1],r[n-2]).add(r[n-1]),s=wc),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(a.distanceToSquared(h),e),i=Math.pow(h.distanceToSquared(d),e),r=Math.pow(d.distanceToSquared(s),e);i<1e-4&&(i=1),t<1e-4&&(t=i),r<1e-4&&(r=i),vc.initNonuniformCatmullRom(a.x,h.x,d.x,s.x,t,i,r),$c.initNonuniformCatmullRom(a.y,h.y,d.y,s.y,t,i,r),Mc.initNonuniformCatmullRom(a.z,h.z,d.z,s.z,t,i,r)}else"catmullrom"===this.curveType&&(vc.initCatmullRom(a.x,h.x,d.x,s.x,this.tension),$c.initCatmullRom(a.y,h.y,d.y,s.y,this.tension),Mc.initCatmullRom(a.z,h.z,d.z,s.z,this.tension));return i.set(vc.calc(c),$c.calc(c),Mc.calc(c)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push((new nr).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function Pc(e,t,i,r,n){const o=.5*(r-t),a=.5*(n-i),s=e*e;return(2*i-2*r+o+a)*(e*s)+(-3*i+3*r-2*o-a)*s+o*e+i}function kc(e,t,i,r){return function(e,t){const i=1-e;return i*i*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,i)+function(e,t){return e*e*t}(e,r)}function _c(e,t,i,r,n){return function(e,t){const i=1-e;return i*i*i*t}(e,t)+function(e,t){const i=1-e;return 3*i*i*e*t}(e,i)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,n)}class Tc extends gc{constructor(e=new _i,t=new _i,i=new _i,r=new _i){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new _i){const i=t,r=this.v0,n=this.v1,o=this.v2,a=this.v3;return i.set(_c(e,r.x,n.x,o.x,a.x),_c(e,r.y,n.y,o.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Cc extends gc{constructor(e=new nr,t=new nr,i=new nr,r=new nr){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new nr){const i=t,r=this.v0,n=this.v1,o=this.v2,a=this.v3;return i.set(_c(e,r.x,n.x,o.x,a.x),_c(e,r.y,n.y,o.y,a.y),_c(e,r.z,n.z,o.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Ac extends gc{constructor(e=new _i,t=new _i){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new _i){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const i=t||new _i;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Dc extends gc{constructor(e=new nr,t=new nr){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new nr){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Rc extends gc{constructor(e=new _i,t=new _i,i=new _i){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new _i){const i=t,r=this.v0,n=this.v1,o=this.v2;return i.set(kc(e,r.x,n.x,o.x),kc(e,r.y,n.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Ec extends gc{constructor(e=new nr,t=new nr,i=new nr){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new nr){const i=t,r=this.v0,n=this.v1,o=this.v2;return i.set(kc(e,r.x,n.x,o.x),kc(e,r.y,n.y,o.y),kc(e,r.z,n.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Lc extends gc{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new _i){const i=t,r=this.points,n=(r.length-1)*e,o=Math.floor(n),a=n-o,s=r[0===o?o:o-1],l=r[o],c=r[o>r.length-2?r.length-1:o+1],h=r[o>r.length-3?r.length-1:o+2];return i.set(Pc(a,s.x,l.x,c.x,h.x),Pc(a,s.y,l.y,c.y,h.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push((new _i).fromArray(i))}return this}}var Ic=Object.freeze({__proto__:null,ArcCurve:bc,CatmullRomCurve3:Sc,CubicBezierCurve:Tc,CubicBezierCurve3:Cc,EllipseCurve:xc,LineCurve:Ac,LineCurve3:Dc,QuadraticBezierCurve:Rc,QuadraticBezierCurve3:Ec,SplineCurve:Lc});class Bc extends gc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Ac(t,e))}getPoint(e,t){const i=e*this.getLength(),r=this.getCurveLengths();let n=0;for(;n<r.length;){if(r[n]>=i){const e=r[n]-i,o=this.curves[n],a=o.getLength(),s=0===a?0:1-e/a;return o.getPointAt(s,t)}n++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let r=0,n=this.curves;r<n.length;r++){const o=n[r],a=o.isEllipseCurve?2*e:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,s=o.getPoints(a);for(let e=0;e<s.length;e++){const r=s[e];i&&i.equals(r)||(t.push(r),i=r)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const i=e.curves[t];this.curves.push((new Ic[i.type]).fromJSON(i))}return this}}class Vc extends Bc{constructor(e){super(),this.type="Path",this.currentPoint=new _i,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new Ac(this.currentPoint.clone(),new _i(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){const n=new Rc(this.currentPoint.clone(),new _i(e,t),new _i(i,r));return this.curves.push(n),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,n,o){const a=new Tc(this.currentPoint.clone(),new _i(e,t),new _i(i,r),new _i(n,o));return this.curves.push(a),this.currentPoint.set(n,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new Lc(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,n,o){const a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+a,t+s,i,r,n,o),this}absarc(e,t,i,r,n,o){return this.absellipse(e,t,i,i,r,n,o),this}ellipse(e,t,i,r,n,o,a,s){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,i,r,n,o,a,s),this}absellipse(e,t,i,r,n,o,a,s){const l=new xc(e,t,i,r,n,o,a,s);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Oc extends Qn{constructor(e=[new _i(0,-.5),new _i(.5,0),new _i(0,.5)],t=12,i=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t),r=bi(r,0,2*Math.PI);const n=[],o=[],a=[],s=[],l=[],c=1/t,h=new nr,d=new _i,u=new nr,p=new nr,m=new nr;let f=0,g=0;for(let t=0;t<=e.length-1;t++)switch(t){case 0:f=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,u.x=1*g,u.y=-f,u.z=0*g,m.copy(u),u.normalize(),s.push(u.x,u.y,u.z);break;case e.length-1:s.push(m.x,m.y,m.z);break;default:f=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,u.x=1*g,u.y=-f,u.z=0*g,p.copy(u),u.x+=m.x,u.y+=m.y,u.z+=m.z,u.normalize(),s.push(u.x,u.y,u.z),m.copy(p)}for(let n=0;n<=t;n++){const u=i+n*c*r,p=Math.sin(u),m=Math.cos(u);for(let i=0;i<=e.length-1;i++){h.x=e[i].x*p,h.y=e[i].y,h.z=e[i].x*m,o.push(h.x,h.y,h.z),d.x=n/t,d.y=i/(e.length-1),a.push(d.x,d.y);const r=s[3*i+0]*p,c=s[3*i+1],u=s[3*i+0]*m;l.push(r,c,u)}}for(let i=0;i<t;i++)for(let t=0;t<e.length-1;t++){const r=t+i*e.length,o=r,a=r+e.length,s=r+e.length+1,l=r+1;n.push(o,a,l),n.push(s,l,a)}this.setIndex(n),this.setAttribute("position",new En(o,3)),this.setAttribute("uv",new En(a,2)),this.setAttribute("normal",new En(l,3))}static fromJSON(e){return new Oc(e.points,e.segments,e.phiStart,e.phiLength)}}class Wc extends Oc{constructor(e=1,t=1,i=4,r=8){const n=new Vc;n.absarc(0,-t/2,e,1.5*Math.PI,0),n.absarc(0,t/2,e,0,.5*Math.PI),super(n.getPoints(i),r),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:i,radialSegments:r}}static fromJSON(e){return new Wc(e.radius,e.length,e.capSegments,e.radialSegments)}}class Hc extends Qn{constructor(e=1,t=8,i=0,r=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},t=Math.max(3,t);const n=[],o=[],a=[],s=[],l=new nr,c=new _i;o.push(0,0,0),a.push(0,0,1),s.push(.5,.5);for(let n=0,h=3;n<=t;n++,h+=3){const d=i+n/t*r;l.x=e*Math.cos(d),l.y=e*Math.sin(d),o.push(l.x,l.y,l.z),a.push(0,0,1),c.x=(o[h]/e+1)/2,c.y=(o[h+1]/e+1)/2,s.push(c.x,c.y)}for(let e=1;e<=t;e++)n.push(e,e+1,0);this.setIndex(n),this.setAttribute("position",new En(o,3)),this.setAttribute("normal",new En(a,3)),this.setAttribute("uv",new En(s,2))}static fromJSON(e){return new Hc(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Fc extends Qn{constructor(e=1,t=1,i=1,r=8,n=1,o=!1,a=0,s=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:o,thetaStart:a,thetaLength:s};const l=this;r=Math.floor(r),n=Math.floor(n);const c=[],h=[],d=[],u=[];let p=0;const m=[],f=i/2;let g=0;function x(i){const n=p,o=new _i,m=new nr;let x=0;const b=!0===i?e:t,y=!0===i?1:-1;for(let e=1;e<=r;e++)h.push(0,f*y,0),d.push(0,y,0),u.push(.5,.5),p++;const w=p;for(let e=0;e<=r;e++){const t=e/r*s+a,i=Math.cos(t),n=Math.sin(t);m.x=b*n,m.y=f*y,m.z=b*i,h.push(m.x,m.y,m.z),d.push(0,y,0),o.x=.5*i+.5,o.y=.5*n*y+.5,u.push(o.x,o.y),p++}for(let e=0;e<r;e++){const t=n+e,r=w+e;!0===i?c.push(r,r+1,t):c.push(r+1,r,t),x+=3}l.addGroup(g,x,!0===i?1:2),g+=x}!function(){const o=new nr,x=new nr;let b=0;const y=(t-e)/i;for(let l=0;l<=n;l++){const c=[],g=l/n,b=g*(t-e)+e;for(let e=0;e<=r;e++){const t=e/r,n=t*s+a,l=Math.sin(n),m=Math.cos(n);x.x=b*l,x.y=-g*i+f,x.z=b*m,h.push(x.x,x.y,x.z),o.set(l,y,m).normalize(),d.push(o.x,o.y,o.z),u.push(t,1-g),c.push(p++)}m.push(c)}for(let e=0;e<r;e++)for(let t=0;t<n;t++){const i=m[t][e],r=m[t+1][e],n=m[t+1][e+1],o=m[t][e+1];c.push(i,r,o),c.push(r,n,o),b+=6}l.addGroup(g,b,0),g+=b}(),!1===o&&(e>0&&x(!0),t>0&&x(!1)),this.setIndex(c),this.setAttribute("position",new En(h,3)),this.setAttribute("normal",new En(d,3)),this.setAttribute("uv",new En(u,2))}static fromJSON(e){return new Fc(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Qc extends Fc{constructor(e=1,t=1,i=8,r=1,n=!1,o=0,a=2*Math.PI){super(0,e,t,i,r,n,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:o,thetaLength:a}}static fromJSON(e){return new Qc(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class zc extends Qn{constructor(e=[],t=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r};const n=[],o=[];function a(e,t,i,r){const n=r+1,o=[];for(let r=0;r<=n;r++){o[r]=[];const a=e.clone().lerp(i,r/n),s=t.clone().lerp(i,r/n),l=n-r;for(let e=0;e<=l;e++)o[r][e]=0===e&&r===n?a:a.clone().lerp(s,e/l)}for(let e=0;e<n;e++)for(let t=0;t<2*(n-e)-1;t++){const i=Math.floor(t/2);t%2==0?(s(o[e][i+1]),s(o[e+1][i]),s(o[e][i])):(s(o[e][i+1]),s(o[e+1][i+1]),s(o[e+1][i]))}}function s(e){n.push(e.x,e.y,e.z)}function l(t,i){const r=3*t;i.x=e[r+0],i.y=e[r+1],i.z=e[r+2]}function c(e,t,i,r){r<0&&1===e.x&&(o[t]=e.x-1),0===i.x&&0===i.z&&(o[t]=r/2/Math.PI+.5)}function h(e){return Math.atan2(e.z,-e.x)}function d(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}!function(e){const i=new nr,r=new nr,n=new nr;for(let o=0;o<t.length;o+=3)l(t[o+0],i),l(t[o+1],r),l(t[o+2],n),a(i,r,n,e)}(r),function(e){const t=new nr;for(let i=0;i<n.length;i+=3)t.x=n[i+0],t.y=n[i+1],t.z=n[i+2],t.normalize().multiplyScalar(e),n[i+0]=t.x,n[i+1]=t.y,n[i+2]=t.z}(i),function(){const e=new nr;for(let t=0;t<n.length;t+=3){e.x=n[t+0],e.y=n[t+1],e.z=n[t+2];const i=h(e)/2/Math.PI+.5,r=d(e)/Math.PI+.5;o.push(i,1-r)}(function(){const e=new nr,t=new nr,i=new nr,r=new nr,a=new _i,s=new _i,l=new _i;for(let d=0,u=0;d<n.length;d+=9,u+=6){e.set(n[d+0],n[d+1],n[d+2]),t.set(n[d+3],n[d+4],n[d+5]),i.set(n[d+6],n[d+7],n[d+8]),a.set(o[u+0],o[u+1]),s.set(o[u+2],o[u+3]),l.set(o[u+4],o[u+5]),r.copy(e).add(t).add(i).divideScalar(3);const p=h(r);c(a,u+0,e,p),c(s,u+2,t,p),c(l,u+4,i,p)}})(),function(){for(let e=0;e<o.length;e+=6){const t=o[e+0],i=o[e+2],r=o[e+4],n=Math.max(t,i,r),a=Math.min(t,i,r);n>.9&&a<.1&&(t<.2&&(o[e+0]+=1),i<.2&&(o[e+2]+=1),r<.2&&(o[e+4]+=1))}}()}(),this.setAttribute("position",new En(n,3)),this.setAttribute("normal",new En(n.slice(),3)),this.setAttribute("uv",new En(o,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new zc(e.vertices,e.indices,e.radius,e.details)}}class Gc extends zc{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,r=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Gc(e.radius,e.detail)}}const Nc=new nr,Uc=new nr,jc=new nr,qc=new bn;class Xc extends Qn{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const i=4,r=Math.pow(10,i),n=Math.cos(fi*t),o=e.getIndex(),a=e.getAttribute("position"),s=o?o.count:a.count,l=[0,0,0],c=["a","b","c"],h=new Array(3),d={},u=[];for(let e=0;e<s;e+=3){o?(l[0]=o.getX(e),l[1]=o.getX(e+1),l[2]=o.getX(e+2)):(l[0]=e,l[1]=e+1,l[2]=e+2);const{a:t,b:i,c:s}=qc;if(t.fromBufferAttribute(a,l[0]),i.fromBufferAttribute(a,l[1]),s.fromBufferAttribute(a,l[2]),qc.getNormal(jc),h[0]=`${Math.round(t.x*r)},${Math.round(t.y*r)},${Math.round(t.z*r)}`,h[1]=`${Math.round(i.x*r)},${Math.round(i.y*r)},${Math.round(i.z*r)}`,h[2]=`${Math.round(s.x*r)},${Math.round(s.y*r)},${Math.round(s.z*r)}`,h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(let e=0;e<3;e++){const t=(e+1)%3,i=h[e],r=h[t],o=qc[c[e]],a=qc[c[t]],s=`${i}_${r}`,p=`${r}_${i}`;p in d&&d[p]?(jc.dot(d[p].normal)<=n&&(u.push(o.x,o.y,o.z),u.push(a.x,a.y,a.z)),d[p]=null):s in d||(d[s]={index0:l[e],index1:l[t],normal:jc.clone()})}}for(const e in d)if(d[e]){const{index0:t,index1:i}=d[e];Nc.fromBufferAttribute(a,t),Uc.fromBufferAttribute(a,i),u.push(Nc.x,Nc.y,Nc.z),u.push(Uc.x,Uc.y,Uc.z)}this.setAttribute("position",new En(u,3))}}}class Yc extends Vc{constructor(e){super(e),this.uuid=xi(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const i=e.holes[t];this.holes.push((new Vc).fromJSON(i))}return this}}const Jc=function(e,t,i=2){const r=t&&t.length,n=r?t[0]*i:e.length;let o=Zc(e,0,n,i,!0);const a=[];if(!o||o.next===o.prev)return a;let s,l,c,h,d,u,p;if(r&&(o=function(e,t,i,r){const n=[];let o,a,s,l,c;for(o=0,a=t.length;o<a;o++)s=t[o]*r,l=o<a-1?t[o+1]*r:e.length,c=Zc(e,s,l,r,!1),c===c.next&&(c.steiner=!0),n.push(ch(c));for(n.sort(oh),o=0;o<n.length;o++)ah(n[o],i),i=Kc(i,i.next);return i}(e,t,o,i)),e.length>80*i){s=c=e[0],l=h=e[1];for(let t=i;t<n;t+=i)d=e[t],u=e[t+1],d<s&&(s=d),u<l&&(l=u),d>c&&(c=d),u>h&&(h=u);p=Math.max(c-s,h-l),p=0!==p?1/p:0}return eh(o,a,i,s,l,p),a};function Zc(e,t,i,r,n){let o,a;if(n===function(e,t,i,r){let n=0;for(let o=t,a=i-r;o<i;o+=r)n+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return n}(e,t,i,r)>0)for(o=t;o<i;o+=r)a=yh(o,e[o],e[o+1],a);else for(o=i-r;o>=t;o-=r)a=yh(o,e[o],e[o+1],a);return a&&ph(a,a.next)&&(wh(a),a=a.next),a}function Kc(e,t){if(!e)return e;t||(t=e);let i,r=e;do{if(i=!1,r.steiner||!ph(r,r.next)&&0!==uh(r.prev,r,r.next))r=r.next;else{if(wh(r),r=t=r.prev,r===r.next)break;i=!0}}while(i||r!==t);return t}function eh(e,t,i,r,n,o,a){if(!e)return;!a&&o&&function(e,t,i,r){let n=e;do{null===n.z&&(n.z=lh(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){let t,i,r,n,o,a,s,l,c=1;do{for(i=e,e=null,o=null,a=0;i;){for(a++,r=i,s=0,t=0;t<c&&(s++,r=r.nextZ,r);t++);for(l=c;s>0||l>0&&r;)0!==s&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,s--):(n=r,r=r.nextZ,l--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=r}o.nextZ=null,c*=2}while(a>1)}(n)}(e,r,n,o);let s,l,c=e;for(;e.prev!==e.next;)if(s=e.prev,l=e.next,o?ih(e,r,n,o):th(e))t.push(s.i/i),t.push(e.i/i),t.push(l.i/i),wh(e),e=l.next,c=l.next;else if((e=l)===c){a?1===a?eh(e=rh(Kc(e),t,i),t,i,r,n,o,2):2===a&&nh(e,t,i,r,n,o):eh(Kc(e),t,i,r,n,o,1);break}}function th(e){const t=e.prev,i=e,r=e.next;if(uh(t,i,r)>=0)return!1;let n=e.next.next;for(;n!==e.prev;){if(hh(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&uh(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function ih(e,t,i,r){const n=e.prev,o=e,a=e.next;if(uh(n,o,a)>=0)return!1;const s=n.x<o.x?n.x<a.x?n.x:a.x:o.x<a.x?o.x:a.x,l=n.y<o.y?n.y<a.y?n.y:a.y:o.y<a.y?o.y:a.y,c=n.x>o.x?n.x>a.x?n.x:a.x:o.x>a.x?o.x:a.x,h=n.y>o.y?n.y>a.y?n.y:a.y:o.y>a.y?o.y:a.y,d=lh(s,l,t,i,r),u=lh(c,h,t,i,r);let p=e.prevZ,m=e.nextZ;for(;p&&p.z>=d&&m&&m.z<=u;){if(p!==e.prev&&p!==e.next&&hh(n.x,n.y,o.x,o.y,a.x,a.y,p.x,p.y)&&uh(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,m!==e.prev&&m!==e.next&&hh(n.x,n.y,o.x,o.y,a.x,a.y,m.x,m.y)&&uh(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;p&&p.z>=d;){if(p!==e.prev&&p!==e.next&&hh(n.x,n.y,o.x,o.y,a.x,a.y,p.x,p.y)&&uh(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=u;){if(m!==e.prev&&m!==e.next&&hh(n.x,n.y,o.x,o.y,a.x,a.y,m.x,m.y)&&uh(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function rh(e,t,i){let r=e;do{const n=r.prev,o=r.next.next;!ph(n,o)&&mh(n,r,r.next,o)&&xh(n,o)&&xh(o,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(o.i/i),wh(r),wh(r.next),r=e=o),r=r.next}while(r!==e);return Kc(r)}function nh(e,t,i,r,n,o){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&dh(a,e)){let s=bh(a,e);return a=Kc(a,a.next),s=Kc(s,s.next),eh(a,t,i,r,n,o),void eh(s,t,i,r,n,o)}e=e.next}a=a.next}while(a!==e)}function oh(e,t){return e.x-t.x}function ah(e,t){if(t=function(e,t){let i=t;const r=e.x,n=e.y;let o,a=-1/0;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){const e=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=r&&e>a){if(a=e,e===r){if(n===i.y)return i;if(n===i.next.y)return i.next}o=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!o)return null;if(r===a)return o;const s=o,l=o.x,c=o.y;let h,d=1/0;i=o;do{r>=i.x&&i.x>=l&&r!==i.x&&hh(n<c?r:a,n,l,c,n<c?a:r,n,i.x,i.y)&&(h=Math.abs(n-i.y)/(r-i.x),xh(i,e)&&(h<d||h===d&&(i.x>o.x||i.x===o.x&&sh(o,i)))&&(o=i,d=h)),i=i.next}while(i!==s);return o}(e,t),t){const i=bh(t,e);Kc(t,t.next),Kc(i,i.next)}}function sh(e,t){return uh(e.prev,e,t.prev)<0&&uh(t.next,e,e.next)<0}function lh(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ch(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function hh(e,t,i,r,n,o,a,s){return(n-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(r-s)-(i-a)*(t-s)>=0&&(i-a)*(o-s)-(n-a)*(r-s)>=0}function dh(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&mh(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(xh(e,t)&&xh(t,e)&&function(e,t){let i=e,r=!1;const n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)&&(uh(e.prev,e,t.prev)||uh(e,t.prev,t))||ph(e,t)&&uh(e.prev,e,e.next)>0&&uh(t.prev,t,t.next)>0)}function uh(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function ph(e,t){return e.x===t.x&&e.y===t.y}function mh(e,t,i,r){const n=gh(uh(e,t,i)),o=gh(uh(e,t,r)),a=gh(uh(i,r,e)),s=gh(uh(i,r,t));return n!==o&&a!==s||(!(0!==n||!fh(e,i,t))||(!(0!==o||!fh(e,r,t))||(!(0!==a||!fh(i,e,r))||!(0!==s||!fh(i,t,r)))))}function fh(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function gh(e){return e>0?1:e<0?-1:0}function xh(e,t){return uh(e.prev,e,e.next)<0?uh(e,t,e.next)>=0&&uh(e,e.prev,t)>=0:uh(e,t,e.prev)<0||uh(e,e.next,t)<0}function bh(e,t){const i=new vh(e.i,e.x,e.y),r=new vh(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function yh(e,t,i,r){const n=new vh(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function wh(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function vh(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class $h{static area(e){const t=e.length;let i=0;for(let r=t-1,n=0;n<t;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return.5*i}static isClockWise(e){return $h.area(e)<0}static triangulateShape(e,t){const i=[],r=[],n=[];Mh(e),Sh(i,e);let o=e.length;t.forEach(Mh);for(let e=0;e<t.length;e++)r.push(o),o+=t[e].length,Sh(i,t[e]);const a=Jc(i,r);for(let e=0;e<a.length;e+=3)n.push(a.slice(e,e+3));return n}}function Mh(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Sh(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}class Ph extends Qn{constructor(e=new Yc([new _i(.5,.5),new _i(-.5,.5),new _i(-.5,-.5),new _i(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,r=[],n=[];for(let t=0,i=e.length;t<i;t++){o(e[t])}function o(e){const o=[],a=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:1;let c=void 0===t.bevelEnabled||t.bevelEnabled,h=void 0!==t.bevelThickness?t.bevelThickness:.2,d=void 0!==t.bevelSize?t.bevelSize:h-.1,u=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const m=t.extrudePath,f=void 0!==t.UVGenerator?t.UVGenerator:kh;let g,x,b,y,w,v=!1;m&&(g=m.getSpacedPoints(s),v=!0,c=!1,x=m.computeFrenetFrames(s,!1),b=new nr,y=new nr,w=new nr),c||(p=0,h=0,d=0,u=0);const $=e.extractPoints(a);let M=$.shape;const S=$.holes;if(!$h.isClockWise(M)){M=M.reverse();for(let e=0,t=S.length;e<t;e++){const t=S[e];$h.isClockWise(t)&&(S[e]=t.reverse())}}const P=$h.triangulateShape(M,S),k=M;for(let e=0,t=S.length;e<t;e++){const t=S[e];M=M.concat(t)}function _(e,t,i){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}const T=M.length,C=P.length;function A(e,t,i){let r,n,o;const a=e.x-t.x,s=e.y-t.y,l=i.x-e.x,c=i.y-e.y,h=a*a+s*s,d=a*c-s*l;if(Math.abs(d)>Number.EPSILON){const d=Math.sqrt(h),u=Math.sqrt(l*l+c*c),p=t.x-s/d,m=t.y+a/d,f=((i.x-c/u-p)*c-(i.y+l/u-m)*l)/(a*c-s*l);r=p+a*f-e.x,n=m+s*f-e.y;const g=r*r+n*n;if(g<=2)return new _i(r,n);o=Math.sqrt(g/2)}else{let e=!1;a>Number.EPSILON?l>Number.EPSILON&&(e=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(s)===Math.sign(c)&&(e=!0),e?(r=-s,n=a,o=Math.sqrt(h)):(r=a,n=s,o=Math.sqrt(h/2))}return new _i(r/o,n/o)}const D=[];for(let e=0,t=k.length,i=t-1,r=e+1;e<t;e++,i++,r++)i===t&&(i=0),r===t&&(r=0),D[e]=A(k[e],k[i],k[r]);const R=[];let E,L=D.concat();for(let e=0,t=S.length;e<t;e++){const t=S[e];E=[];for(let e=0,i=t.length,r=i-1,n=e+1;e<i;e++,r++,n++)r===i&&(r=0),n===i&&(n=0),E[e]=A(t[e],t[r],t[n]);R.push(E),L=L.concat(E)}for(let e=0;e<p;e++){const t=e/p,i=h*Math.cos(t*Math.PI/2),r=d*Math.sin(t*Math.PI/2)+u;for(let e=0,t=k.length;e<t;e++){const t=_(k[e],D[e],r);V(t.x,t.y,-i)}for(let e=0,t=S.length;e<t;e++){const t=S[e];E=R[e];for(let e=0,n=t.length;e<n;e++){const n=_(t[e],E[e],r);V(n.x,n.y,-i)}}}const I=d+u;for(let e=0;e<T;e++){const t=c?_(M[e],L[e],I):M[e];v?(y.copy(x.normals[0]).multiplyScalar(t.x),b.copy(x.binormals[0]).multiplyScalar(t.y),w.copy(g[0]).add(y).add(b),V(w.x,w.y,w.z)):V(t.x,t.y,0)}for(let e=1;e<=s;e++)for(let t=0;t<T;t++){const i=c?_(M[t],L[t],I):M[t];v?(y.copy(x.normals[e]).multiplyScalar(i.x),b.copy(x.binormals[e]).multiplyScalar(i.y),w.copy(g[e]).add(y).add(b),V(w.x,w.y,w.z)):V(i.x,i.y,l/s*e)}for(let e=p-1;e>=0;e--){const t=e/p,i=h*Math.cos(t*Math.PI/2),r=d*Math.sin(t*Math.PI/2)+u;for(let e=0,t=k.length;e<t;e++){const t=_(k[e],D[e],r);V(t.x,t.y,l+i)}for(let e=0,t=S.length;e<t;e++){const t=S[e];E=R[e];for(let e=0,n=t.length;e<n;e++){const n=_(t[e],E[e],r);v?V(n.x,n.y+g[s-1].y,g[s-1].x+i):V(n.x,n.y,l+i)}}}function B(e,t){let i=e.length;for(;--i>=0;){const r=i;let n=i-1;n<0&&(n=e.length-1);for(let e=0,i=s+2*p;e<i;e++){const i=T*e,o=T*(e+1);W(t+r+i,t+n+i,t+n+o,t+r+o)}}}function V(e,t,i){o.push(e),o.push(t),o.push(i)}function O(e,t,n){H(e),H(t),H(n);const o=r.length/3,a=f.generateTopUV(i,r,o-3,o-2,o-1);F(a[0]),F(a[1]),F(a[2])}function W(e,t,n,o){H(e),H(t),H(o),H(t),H(n),H(o);const a=r.length/3,s=f.generateSideWallUV(i,r,a-6,a-3,a-2,a-1);F(s[0]),F(s[1]),F(s[3]),F(s[1]),F(s[2]),F(s[3])}function H(e){r.push(o[3*e+0]),r.push(o[3*e+1]),r.push(o[3*e+2])}function F(e){n.push(e.x),n.push(e.y)}!function(){const e=r.length/3;if(c){let e=0,t=T*e;for(let e=0;e<C;e++){const i=P[e];O(i[2]+t,i[1]+t,i[0]+t)}e=s+2*p,t=T*e;for(let e=0;e<C;e++){const i=P[e];O(i[0]+t,i[1]+t,i[2]+t)}}else{for(let e=0;e<C;e++){const t=P[e];O(t[2],t[1],t[0])}for(let e=0;e<C;e++){const t=P[e];O(t[0]+T*s,t[1]+T*s,t[2]+T*s)}}i.addGroup(e,r.length/3-e,0)}(),function(){const e=r.length/3;let t=0;B(k,t),t+=k.length;for(let e=0,i=S.length;e<i;e++){const i=S[e];B(i,t),t+=i.length}i.addGroup(e,r.length/3-e,1)}()}this.setAttribute("position",new En(r,3)),this.setAttribute("uv",new En(n,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function(e,t,i){if(i.shapes=[],Array.isArray(e))for(let t=0,r=e.length;t<r;t++){const r=e[t];i.shapes.push(r.uuid)}else i.shapes.push(e.uuid);i.options=Object.assign({},t),void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON());return i}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const i=[];for(let r=0,n=e.shapes.length;r<n;r++){const n=t[e.shapes[r]];i.push(n)}const r=e.options.extrudePath;return void 0!==r&&(e.options.extrudePath=(new Ic[r.type]).fromJSON(r)),new Ph(i,e.options)}}const kh={generateTopUV:function(e,t,i,r,n){const o=t[3*i],a=t[3*i+1],s=t[3*r],l=t[3*r+1],c=t[3*n],h=t[3*n+1];return[new _i(o,a),new _i(s,l),new _i(c,h)]},generateSideWallUV:function(e,t,i,r,n,o){const a=t[3*i],s=t[3*i+1],l=t[3*i+2],c=t[3*r],h=t[3*r+1],d=t[3*r+2],u=t[3*n],p=t[3*n+1],m=t[3*n+2],f=t[3*o],g=t[3*o+1],x=t[3*o+2];return Math.abs(s-h)<Math.abs(a-c)?[new _i(a,1-l),new _i(c,1-d),new _i(u,1-m),new _i(f,1-x)]:[new _i(s,1-l),new _i(h,1-d),new _i(p,1-m),new _i(g,1-x)]}};class _h extends zc{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new _h(e.radius,e.detail)}}class Th extends zc{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Th(e.radius,e.detail)}}class Ch extends Qn{constructor(e=.5,t=1,i=8,r=1,n=0,o=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:n,thetaLength:o},i=Math.max(3,i);const a=[],s=[],l=[],c=[];let h=e;const d=(t-e)/(r=Math.max(1,r)),u=new nr,p=new _i;for(let e=0;e<=r;e++){for(let e=0;e<=i;e++){const r=n+e/i*o;u.x=h*Math.cos(r),u.y=h*Math.sin(r),s.push(u.x,u.y,u.z),l.push(0,0,1),p.x=(u.x/t+1)/2,p.y=(u.y/t+1)/2,c.push(p.x,p.y)}h+=d}for(let e=0;e<r;e++){const t=e*(i+1);for(let e=0;e<i;e++){const r=e+t,n=r,o=r+i+1,s=r+i+2,l=r+1;a.push(n,o,l),a.push(o,s,l)}}this.setIndex(a),this.setAttribute("position",new En(s,3)),this.setAttribute("normal",new En(l,3)),this.setAttribute("uv",new En(c,2))}static fromJSON(e){return new Ch(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Ah extends Qn{constructor(e=new Yc([new _i(0,.5),new _i(-.5,-.5),new _i(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],r=[],n=[],o=[];let a=0,s=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(a,s,t),a+=s,s=0;function l(e){const a=r.length/3,l=e.extractPoints(t);let c=l.shape;const h=l.holes;!1===$h.isClockWise(c)&&(c=c.reverse());for(let e=0,t=h.length;e<t;e++){const t=h[e];!0===$h.isClockWise(t)&&(h[e]=t.reverse())}const d=$h.triangulateShape(c,h);for(let e=0,t=h.length;e<t;e++){const t=h[e];c=c.concat(t)}for(let e=0,t=c.length;e<t;e++){const t=c[e];r.push(t.x,t.y,0),n.push(0,0,1),o.push(t.x,t.y)}for(let e=0,t=d.length;e<t;e++){const t=d[e],r=t[0]+a,n=t[1]+a,o=t[2]+a;i.push(r,n,o),s+=3}}this.setIndex(i),this.setAttribute("position",new En(r,3)),this.setAttribute("normal",new En(n,3)),this.setAttribute("uv",new En(o,2))}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){const r=e[i];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const i=[];for(let r=0,n=e.shapes.length;r<n;r++){const n=t[e.shapes[r]];i.push(n)}return new Ah(i,e.curveSegments)}}class Dh extends Qn{constructor(e=1,t=32,i=16,r=0,n=2*Math.PI,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const s=Math.min(o+a,Math.PI);let l=0;const c=[],h=new nr,d=new nr,u=[],p=[],m=[],f=[];for(let u=0;u<=i;u++){const g=[],x=u/i;let b=0;0==u&&0==o?b=.5/t:u==i&&s==Math.PI&&(b=-.5/t);for(let i=0;i<=t;i++){const s=i/t;h.x=-e*Math.cos(r+s*n)*Math.sin(o+x*a),h.y=e*Math.cos(o+x*a),h.z=e*Math.sin(r+s*n)*Math.sin(o+x*a),p.push(h.x,h.y,h.z),d.copy(h).normalize(),m.push(d.x,d.y,d.z),f.push(s+b,1-x),g.push(l++)}c.push(g)}for(let e=0;e<i;e++)for(let r=0;r<t;r++){const t=c[e][r+1],n=c[e][r],a=c[e+1][r],l=c[e+1][r+1];(0!==e||o>0)&&u.push(t,n,l),(e!==i-1||s<Math.PI)&&u.push(n,a,l)}this.setIndex(u),this.setAttribute("position",new En(p,3)),this.setAttribute("normal",new En(m,3)),this.setAttribute("uv",new En(f,2))}static fromJSON(e){return new Dh(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Rh extends zc{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Rh(e.radius,e.detail)}}class Eh extends Qn{constructor(e=1,t=.4,i=8,r=6,n=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n},i=Math.floor(i),r=Math.floor(r);const o=[],a=[],s=[],l=[],c=new nr,h=new nr,d=new nr;for(let o=0;o<=i;o++)for(let u=0;u<=r;u++){const p=u/r*n,m=o/i*Math.PI*2;h.x=(e+t*Math.cos(m))*Math.cos(p),h.y=(e+t*Math.cos(m))*Math.sin(p),h.z=t*Math.sin(m),a.push(h.x,h.y,h.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),d.subVectors(h,c).normalize(),s.push(d.x,d.y,d.z),l.push(u/r),l.push(o/i)}for(let e=1;e<=i;e++)for(let t=1;t<=r;t++){const i=(r+1)*e+t-1,n=(r+1)*(e-1)+t-1,a=(r+1)*(e-1)+t,s=(r+1)*e+t;o.push(i,n,s),o.push(n,a,s)}this.setIndex(o),this.setAttribute("position",new En(a,3)),this.setAttribute("normal",new En(s,3)),this.setAttribute("uv",new En(l,2))}static fromJSON(e){return new Eh(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Lh extends Qn{constructor(e=1,t=.4,i=64,r=8,n=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:o},i=Math.floor(i),r=Math.floor(r);const a=[],s=[],l=[],c=[],h=new nr,d=new nr,u=new nr,p=new nr,m=new nr,f=new nr,g=new nr;for(let a=0;a<=i;++a){const b=a/i*n*Math.PI*2;x(b,n,o,e,u),x(b+.01,n,o,e,p),f.subVectors(p,u),g.addVectors(p,u),m.crossVectors(f,g),g.crossVectors(m,f),m.normalize(),g.normalize();for(let e=0;e<=r;++e){const n=e/r*Math.PI*2,o=-t*Math.cos(n),p=t*Math.sin(n);h.x=u.x+(o*g.x+p*m.x),h.y=u.y+(o*g.y+p*m.y),h.z=u.z+(o*g.z+p*m.z),s.push(h.x,h.y,h.z),d.subVectors(h,u).normalize(),l.push(d.x,d.y,d.z),c.push(a/i),c.push(e/r)}}for(let e=1;e<=i;e++)for(let t=1;t<=r;t++){const i=(r+1)*(e-1)+(t-1),n=(r+1)*e+(t-1),o=(r+1)*e+t,s=(r+1)*(e-1)+t;a.push(i,n,s),a.push(n,o,s)}function x(e,t,i,r,n){const o=Math.cos(e),a=Math.sin(e),s=i/t*e,l=Math.cos(s);n.x=r*(2+l)*.5*o,n.y=r*(2+l)*a*.5,n.z=r*Math.sin(s)*.5}this.setIndex(a),this.setAttribute("position",new En(s,3)),this.setAttribute("normal",new En(l,3)),this.setAttribute("uv",new En(c,2))}static fromJSON(e){return new Lh(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Ih extends Qn{constructor(e=new Ec(new nr(-1,-1,0),new nr(-1,1,0),new nr(1,1,0)),t=64,i=1,r=8,n=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:n};const o=e.computeFrenetFrames(t,n);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new nr,s=new nr,l=new _i;let c=new nr;const h=[],d=[],u=[],p=[];function m(n){c=e.getPointAt(n/t,c);const l=o.normals[n],u=o.binormals[n];for(let e=0;e<=r;e++){const t=e/r*Math.PI*2,n=Math.sin(t),o=-Math.cos(t);s.x=o*l.x+n*u.x,s.y=o*l.y+n*u.y,s.z=o*l.z+n*u.z,s.normalize(),d.push(s.x,s.y,s.z),a.x=c.x+i*s.x,a.y=c.y+i*s.y,a.z=c.z+i*s.z,h.push(a.x,a.y,a.z)}}!function(){for(let e=0;e<t;e++)m(e);m(!1===n?t:0),function(){for(let e=0;e<=t;e++)for(let i=0;i<=r;i++)l.x=e/t,l.y=i/r,u.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=r;t++){const i=(r+1)*(e-1)+(t-1),n=(r+1)*e+(t-1),o=(r+1)*e+t,a=(r+1)*(e-1)+t;p.push(i,n,a),p.push(n,o,a)}}()}(),this.setIndex(p),this.setAttribute("position",new En(h,3)),this.setAttribute("normal",new En(d,3)),this.setAttribute("uv",new En(u,2))}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Ih((new Ic[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class Bh extends Qn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],i=new Set,r=new nr,n=new nr;if(null!==e.index){const o=e.attributes.position,a=e.index;let s=e.groups;0===s.length&&(s=[{start:0,count:a.count,materialIndex:0}]);for(let e=0,l=s.length;e<l;++e){const l=s[e],c=l.start;for(let e=c,s=c+l.count;e<s;e+=3)for(let s=0;s<3;s++){const l=a.getX(e+s),c=a.getX(e+(s+1)%3);r.fromBufferAttribute(o,l),n.fromBufferAttribute(o,c),!0===Vh(r,n,i)&&(t.push(r.x,r.y,r.z),t.push(n.x,n.y,n.z))}}}else{const o=e.attributes.position;for(let e=0,a=o.count/3;e<a;e++)for(let a=0;a<3;a++){const s=3*e+a,l=3*e+(a+1)%3;r.fromBufferAttribute(o,s),n.fromBufferAttribute(o,l),!0===Vh(r,n,i)&&(t.push(r.x,r.y,r.z),t.push(n.x,n.y,n.z))}}this.setAttribute("position",new En(t,3))}}}function Vh(e,t,i){const r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,n=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==i.has(r)&&!0!==i.has(n)&&(i.add(r),i.add(n),!0)}var Oh=Object.freeze({__proto__:null,BoxGeometry:lo,CapsuleGeometry:Wc,CircleGeometry:Hc,ConeGeometry:Qc,CylinderGeometry:Fc,DodecahedronGeometry:Gc,EdgesGeometry:Xc,ExtrudeGeometry:Ph,IcosahedronGeometry:_h,LatheGeometry:Oc,OctahedronGeometry:Th,PlaneGeometry:Co,PolyhedronGeometry:zc,RingGeometry:Ch,ShapeGeometry:Ah,SphereGeometry:Dh,TetrahedronGeometry:Rh,TorusGeometry:Eh,TorusKnotGeometry:Lh,TubeGeometry:Ih,WireframeGeometry:Bh});class Wh extends wn{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new zi(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class Hh extends po{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Fh extends wn{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new zi(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Et,this.normalScale=new _i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Qh extends Fh{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new _i(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return bi(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new zi(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new zi(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new zi(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class zh extends wn{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new zi(16777215),this.specular=new zi(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Et,this.normalScale=new _i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=U,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Gh extends wn{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new zi(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Et,this.normalScale=new _i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class Nh extends wn{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Et,this.normalScale=new _i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class Uh extends wn{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new zi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Et,this.normalScale=new _i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=U,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class jh extends wn{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new zi(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Et,this.normalScale=new _i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class qh extends ql{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Xh(e,t,i){return Jh(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)}function Yh(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function Jh(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Zh(e){const t=e.length,i=new Array(t);for(let e=0;e!==t;++e)i[e]=e;return i.sort((function(t,i){return e[t]-e[i]})),i}function Kh(e,t,i){const r=e.length,n=new e.constructor(r);for(let o=0,a=0;a!==r;++o){const r=i[o]*t;for(let i=0;i!==t;++i)n[a++]=e[r+i]}return n}function ed(e,t,i,r){let n=1,o=e[0];for(;void 0!==o&&void 0===o[r];)o=e[n++];if(void 0===o)return;let a=o[r];if(void 0!==a)if(Array.isArray(a))do{a=o[r],void 0!==a&&(t.push(o.time),i.push.apply(i,a)),o=e[n++]}while(void 0!==o);else if(void 0!==a.toArray)do{a=o[r],void 0!==a&&(t.push(o.time),a.toArray(i,i.length)),o=e[n++]}while(void 0!==o);else do{a=o[r],void 0!==a&&(t.push(o.time),i.push(a)),o=e[n++]}while(void 0!==o)}var td=Object.freeze({__proto__:null,arraySlice:Xh,convertArray:Yh,isTypedArray:Jh,getKeyframeOrder:Zh,sortedArray:Kh,flattenJSON:ed,subclip:function(e,t,i,r,n=30){const o=e.clone();o.name=t;const a=[];for(let e=0;e<o.tracks.length;++e){const t=o.tracks[e],s=t.getValueSize(),l=[],c=[];for(let e=0;e<t.times.length;++e){const o=t.times[e]*n;if(!(o<i||o>=r)){l.push(t.times[e]);for(let i=0;i<s;++i)c.push(t.values[e*s+i])}}0!==l.length&&(t.times=Yh(l,t.times.constructor),t.values=Yh(c,t.values.constructor),a.push(t))}o.tracks=a;let s=1/0;for(let e=0;e<o.tracks.length;++e)s>o.tracks[e].times[0]&&(s=o.tracks[e].times[0]);for(let e=0;e<o.tracks.length;++e)o.tracks[e].shift(-1*s);return o.resetDuration(),o},makeClipAdditive:function(e,t=0,i=e,r=30){r<=0&&(r=30);const n=i.tracks.length,o=t/r;for(let t=0;t<n;++t){const r=i.tracks[t],n=r.ValueTypeName;if("bool"===n||"string"===n)continue;const a=e.tracks.find((function(e){return e.name===r.name&&e.ValueTypeName===n}));if(void 0===a)continue;let s=0;const l=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=l/3);let c=0;const h=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=h/3);const d=r.times.length-1;let u;if(o<=r.times[0]){const e=s,t=l-s;u=Xh(r.values,e,t)}else if(o>=r.times[d]){const e=d*l+s,t=e+l-s;u=Xh(r.values,e,t)}else{const e=r.createInterpolant(),t=s,i=l-s;e.evaluate(o),u=Xh(e.resultBuffer,t,i)}if("quaternion"===n){(new rr).fromArray(u).normalize().conjugate().toArray(u)}const p=a.times.length;for(let e=0;e<p;++e){const t=e*h+c;if("quaternion"===n)rr.multiplyQuaternionsFlat(a.values,t,u,0,a.values,t);else{const e=h-2*c;for(let i=0;i<e;++i)a.values[t+i]-=u[i]}}}return e.blendMode=Pt,e}});class id{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,r=t[i],n=t[i-1];e:{t:{let o;i:{r:if(!(e<r)){for(let o=i+2;;){if(void 0===r){if(e<n)break r;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===o)break;if(n=r,r=t[++i],e<r)break t}o=t.length;break i}if(e>=n)break e;{const a=t[1];e<a&&(i=2,n=a);for(let o=i-2;;){if(void 0===n)return this._cachedIndex=0,this.copySampleValue_(0);if(i===o)break;if(r=n,n=t[--i-1],e>=n)break t}o=i,i=0}}for(;i<o;){const r=i+o>>>1;e<t[r]?o=r:i=r+1}if(r=t[i],n=t[i-1],void 0===n)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r;for(let e=0;e!==r;++e)t[e]=i[n+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class rd extends id{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:vt,endingEnd:vt}}intervalChanged_(e,t,i){const r=this.parameterPositions;let n=e-2,o=e+1,a=r[n],s=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case $t:n=e,a=2*t-i;break;case Mt:n=r.length-2,a=t+r[n]-r[n+1];break;default:n=e,a=i}if(void 0===s)switch(this.getSettings_().endingEnd){case $t:o=e,s=2*i-t;break;case Mt:o=1,s=i+r[1]-r[0];break;default:o=e-1,s=t}const l=.5*(i-t),c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(s-i),this._offsetPrev=n*c,this._offsetNext=o*c}interpolate_(e,t,i,r){const n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,c=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,u=this._weightNext,p=(i-t)/(r-t),m=p*p,f=m*p,g=-d*f+2*d*m-d*p,x=(1+d)*f+(-1.5-2*d)*m+(-.5+d)*p+1,b=(-1-u)*f+(1.5+u)*m+.5*p,y=u*f-u*m;for(let e=0;e!==a;++e)n[e]=g*o[c+e]+x*o[l+e]+b*o[s+e]+y*o[h+e];return n}}class nd extends id{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,c=(i-t)/(r-t),h=1-c;for(let e=0;e!==a;++e)n[e]=o[l+e]*h+o[s+e]*c;return n}}class od extends id{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class ad{constructor(e,t,i,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Yh(t,this.TimeBufferType),this.values=Yh(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:Yh(e.times,Array),values:Yh(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(i.interpolation=t)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new od(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new nd(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new rd(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case bt:t=this.InterpolantFactoryMethodDiscrete;break;case yt:t=this.InterpolantFactoryMethodLinear;break;case wt:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return bt;case this.InterpolantFactoryMethodLinear:return yt;case this.InterpolantFactoryMethodSmooth:return wt}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){const i=this.times,r=i.length;let n=0,o=r-1;for(;n!==r&&i[n]<e;)++n;for(;-1!==o&&i[o]>t;)--o;if(++o,0!==n||o!==r){n>=o&&(o=Math.max(o,1),n=o-1);const e=this.getValueSize();this.times=Xh(i,n,o),this.values=Xh(this.values,n*e,o*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,n=i.length;0===n&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let t=0;t!==n;t++){const r=i[t];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,r),e=!1;break}if(null!==o&&o>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,r,o),e=!1;break}o=r}if(void 0!==r&&Jh(r))for(let t=0,i=r.length;t!==i;++t){const i=r[t];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,i),e=!1;break}}return e}optimize(){const e=Xh(this.times),t=Xh(this.values),i=this.getValueSize(),r=this.getInterpolation()===wt,n=e.length-1;let o=1;for(let a=1;a<n;++a){let n=!1;const s=e[a];if(s!==e[a+1]&&(1!==a||s!==e[0]))if(r)n=!0;else{const e=a*i,r=e-i,o=e+i;for(let a=0;a!==i;++a){const i=t[e+a];if(i!==t[r+a]||i!==t[o+a]){n=!0;break}}}if(n){if(a!==o){e[o]=e[a];const r=a*i,n=o*i;for(let e=0;e!==i;++e)t[n+e]=t[r+e]}++o}}if(n>0){e[o]=e[n];for(let e=n*i,r=o*i,a=0;a!==i;++a)t[r+a]=t[e+a];++o}return o!==e.length?(this.times=Xh(e,0,o),this.values=Xh(t,0,o*i)):(this.times=e,this.values=t),this}clone(){const e=Xh(this.times,0),t=Xh(this.values,0),i=new(0,this.constructor)(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}ad.prototype.TimeBufferType=Float32Array,ad.prototype.ValueBufferType=Float32Array,ad.prototype.DefaultInterpolation=yt;class sd extends ad{}sd.prototype.ValueTypeName="bool",sd.prototype.ValueBufferType=Array,sd.prototype.DefaultInterpolation=bt,sd.prototype.InterpolantFactoryMethodLinear=void 0,sd.prototype.InterpolantFactoryMethodSmooth=void 0;class ld extends ad{}ld.prototype.ValueTypeName="color";class cd extends ad{}cd.prototype.ValueTypeName="number";class hd extends id{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=(i-t)/(r-t);let l=e*a;for(let e=l+a;l!==e;l+=4)rr.slerpFlat(n,0,o,l-a,o,l,s);return n}}class dd extends ad{InterpolantFactoryMethodLinear(e){return new hd(this.times,this.values,this.getValueSize(),e)}}dd.prototype.ValueTypeName="quaternion",dd.prototype.DefaultInterpolation=yt,dd.prototype.InterpolantFactoryMethodSmooth=void 0;class ud extends ad{}ud.prototype.ValueTypeName="string",ud.prototype.ValueBufferType=Array,ud.prototype.DefaultInterpolation=bt,ud.prototype.InterpolantFactoryMethodLinear=void 0,ud.prototype.InterpolantFactoryMethodSmooth=void 0;class pd extends ad{}pd.prototype.ValueTypeName="vector";class md{constructor(e,t=-1,i,r=St){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=xi(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,r=1/(e.fps||1);for(let e=0,n=i.length;e!==n;++e)t.push(fd(i[e]).scale(r));const n=new this(e.name,e.duration,t,e.blendMode);return n.uuid=e.uuid,n}static toJSON(e){const t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,r=i.length;e!==r;++e)t.push(ad.toJSON(i[e]));return r}static CreateFromMorphTargetSequence(e,t,i,r){const n=t.length,o=[];for(let e=0;e<n;e++){let a=[],s=[];a.push((e+n-1)%n,e,(e+1)%n),s.push(0,1,0);const l=Zh(a);a=Kh(a,1,l),s=Kh(s,1,l),r||0!==a[0]||(a.push(n),s.push(s[0])),o.push(new cd(".morphTargetInfluences["+t[e].name+"]",a,s).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const t=e;i=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<i.length;e++)if(i[e].name===t)return i[e];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const r={},n=/^([\w-]*?)([\d]+)$/;for(let t=0,i=e.length;t<i;t++){const i=e[t],o=i.name.match(n);if(o&&o.length>1){const e=o[1];let t=r[e];t||(r[e]=t=[]),t.push(i)}}const o=[];for(const e in r)o.push(this.CreateFromMorphTargetSequence(e,r[e],t,i));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(e,t,i,r,n){if(0!==i.length){const o=[],a=[];ed(i,o,a,r),0!==o.length&&n.push(new e(t,o,a))}},r=[],n=e.name||"default",o=e.fps||30,a=e.blendMode;let s=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const n=l[e].keys;if(n&&0!==n.length)if(n[0].morphTargets){const e={};let t;for(t=0;t<n.length;t++)if(n[t].morphTargets)for(let i=0;i<n[t].morphTargets.length;i++)e[n[t].morphTargets[i]]=-1;for(const i in e){const e=[],o=[];for(let r=0;r!==n[t].morphTargets.length;++r){const r=n[t];e.push(r.time),o.push(r.morphTarget===i?1:0)}r.push(new cd(".morphTargetInfluence["+i+"]",e,o))}s=e.length*o}else{const o=".bones["+t[e].name+"]";i(pd,o+".position",n,"pos",r),i(dd,o+".quaternion",n,"rot",r),i(pd,o+".scale",n,"scl",r)}}if(0===r.length)return null;return new this(n,s,r,a)}resetDuration(){let e=0;for(let t=0,i=this.tracks.length;t!==i;++t){const i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function fd(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return cd;case"vector":case"vector2":case"vector3":case"vector4":return pd;case"color":return ld;case"quaternion":return dd;case"bool":case"boolean":return sd;case"string":return ud}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],i=[];ed(e.keys,t,i,"value"),e.times=t,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const gd={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class xd{constructor(e,t,i){const r=this;let n,o=!1,a=0,s=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){s++,!1===o&&void 0!==r.onStart&&r.onStart(e,a,s),o=!0},this.itemEnd=function(e){a++,void 0!==r.onProgress&&r.onProgress(e,a,s),a===s&&(o=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return n?n(e):e},this.setURLModifier=function(e){return n=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,i=l.length;t<i;t+=2){const i=l[t],r=l[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return r}return null}}}const bd=new xd;class yd{constructor(e){this.manager=void 0!==e?e:bd,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise((function(r,n){i.load(e,r,t,n)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const wd={};class vd extends Error{constructor(e,t){super(e),this.response=t}}class $d extends yd{constructor(e){super(e)}load(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const n=gd.get(e);if(void 0!==n)return this.manager.itemStart(e),setTimeout((()=>{t&&t(n),this.manager.itemEnd(e)}),0),n;if(void 0!==wd[e])return void wd[e].push({onLoad:t,onProgress:i,onError:r});wd[e]=[],wd[e].push({onLoad:t,onProgress:i,onError:r});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,s=this.responseType;fetch(o).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const i=wd[e],r=t.body.getReader(),n=t.headers.get("Content-Length"),o=n?parseInt(n):0,a=0!==o;let s=0;const l=new ReadableStream({start(e){!function t(){r.read().then((({done:r,value:n})=>{if(r)e.close();else{s+=n.byteLength;const r=new ProgressEvent("progress",{lengthComputable:a,loaded:s,total:o});for(let e=0,t=i.length;e<t;e++){const t=i[e];t.onProgress&&t.onProgress(r)}e.enqueue(n),t()}}))}()}});return new Response(l)}throw new vd(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)})).then((e=>{switch(s){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,a)));case"json":return e.json();default:if(void 0===a)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(a),i=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(i);return e.arrayBuffer().then((e=>r.decode(e)))}}})).then((t=>{gd.add(e,t);const i=wd[e];delete wd[e];for(let e=0,r=i.length;e<r;e++){const r=i[e];r.onLoad&&r.onLoad(t)}})).catch((t=>{const i=wd[e];if(void 0===i)throw this.manager.itemError(e),t;delete wd[e];for(let e=0,r=i.length;e<r;e++){const r=i[e];r.onError&&r.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Md extends yd{constructor(e){super(e)}load(e,t,i,r){const n=this,o=new $d(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(i){try{t(n.parse(JSON.parse(i)))}catch(t){r?r(t):console.error(t),n.manager.itemError(e)}}),i,r)}parse(e){const t=[];for(let i=0;i<e.length;i++){const r=md.parse(e[i]);t.push(r)}return t}}class Sd extends yd{constructor(e){super(e)}load(e,t,i,r){const n=this,o=[],a=new mc,s=new $d(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(n.withCredentials);let l=0;function c(c){s.load(e[c],(function(e){const i=n.parse(e,!0);o[c]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},l+=1,6===l&&(1===i.mipmapCount&&(a.minFilter=fe),a.image=o,a.format=i.format,a.needsUpdate=!0,t&&t(a))}),i,r)}if(Array.isArray(e))for(let t=0,i=e.length;t<i;++t)c(t);else s.load(e,(function(e){const i=n.parse(e,!0);if(i.isCubemap){const e=i.mipmaps.length/i.mipmapCount;for(let t=0;t<e;t++){o[t]={mipmaps:[]};for(let e=0;e<i.mipmapCount;e++)o[t].mipmaps.push(i.mipmaps[t*i.mipmapCount+e]),o[t].format=i.format,o[t].width=i.width,o[t].height=i.height}a.image=o}else a.image.width=i.width,a.image.height=i.height,a.mipmaps=i.mipmaps;1===i.mipmapCount&&(a.minFilter=fe),a.format=i.format,a.needsUpdate=!0,t&&t(a)}),i,r);return a}}class Pd extends yd{constructor(e){super(e)}load(e,t,i,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const n=this,o=gd.get(e);if(void 0!==o)return n.manager.itemStart(e),setTimeout((function(){t&&t(o),n.manager.itemEnd(e)}),0),o;const a=Ri("img");function s(){c(),gd.add(e,this),t&&t(this),n.manager.itemEnd(e)}function l(t){c(),r&&r(t),n.manager.itemError(e),n.manager.itemEnd(e)}function c(){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",s,!1),a.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),n.manager.itemStart(e),a.src=e,a}}class kd extends yd{constructor(e){super(e)}load(e,t,i,r){const n=new bo,o=new Pd(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function s(i){o.load(e[i],(function(e){n.images[i]=e,a++,6===a&&(n.needsUpdate=!0,t&&t(n))}),void 0,r)}for(let t=0;t<e.length;++t)s(t);return n}}class _d extends yd{constructor(e){super(e)}load(e,t,i,r){const n=this,o=new Ol,a=new $d(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(n.withCredentials),a.load(e,(function(e){const i=n.parse(e);i&&(void 0!==i.image?o.image=i.image:void 0!==i.data&&(o.image.width=i.width,o.image.height=i.height,o.image.data=i.data),o.wrapS=void 0!==i.wrapS?i.wrapS:le,o.wrapT=void 0!==i.wrapT?i.wrapT:le,o.magFilter=void 0!==i.magFilter?i.magFilter:fe,o.minFilter=void 0!==i.minFilter?i.minFilter:fe,o.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.encoding&&(o.encoding=i.encoding),void 0!==i.flipY&&(o.flipY=i.flipY),void 0!==i.format&&(o.format=i.format),void 0!==i.type&&(o.type=i.type),void 0!==i.mipmaps&&(o.mipmaps=i.mipmaps,o.minFilter=be),1===i.mipmapCount&&(o.minFilter=fe),void 0!==i.generateMipmaps&&(o.generateMipmaps=i.generateMipmaps),o.needsUpdate=!0,t&&t(o,i))}),i,r),o}}class Td extends yd{constructor(e){super(e)}load(e,t,i,r){const n=new Xi,o=new Pd(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(e){n.image=e,n.needsUpdate=!0,void 0!==t&&t(n)}),i,r),n}}class Cd extends sn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new zi(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}class Ad extends Cd{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(sn.DefaultUp),this.updateMatrix(),this.groundColor=new zi(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const Dd=new Ir,Rd=new nr,Ed=new nr;class Ld{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new _i(512,512),this.map=null,this.mapPass=null,this.matrix=new Ir,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ko,this._frameExtents=new _i(1,1),this._viewportCount=1,this._viewports=[new Yi(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;Rd.setFromMatrixPosition(e.matrixWorld),t.position.copy(Rd),Ed.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Ed),t.updateMatrixWorld(),Dd.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Dd),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Id extends Ld{constructor(){super(new fo(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=2*gi*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;i===t.fov&&r===t.aspect&&n===t.far||(t.fov=i,t.aspect=r,t.far=n,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Bd extends Cd{constructor(e,t,i=0,r=Math.PI/3,n=0,o=1){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(sn.DefaultUp),this.updateMatrix(),this.target=new sn,this.distance=i,this.angle=r,this.penumbra=n,this.decay=o,this.map=null,this.shadow=new Id}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Vd=new Ir,Od=new nr,Wd=new nr;class Hd extends Ld{constructor(){super(new fo(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new _i(4,2),this._viewportCount=6,this._viewports=[new Yi(2,1,1,1),new Yi(0,1,1,1),new Yi(3,1,1,1),new Yi(1,1,1,1),new Yi(3,0,1,1),new Yi(1,0,1,1)],this._cubeDirections=[new nr(1,0,0),new nr(-1,0,0),new nr(0,0,1),new nr(0,0,-1),new nr(0,1,0),new nr(0,-1,0)],this._cubeUps=[new nr(0,1,0),new nr(0,1,0),new nr(0,1,0),new nr(0,1,0),new nr(0,0,1),new nr(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,r=this.matrix,n=e.distance||i.far;n!==i.far&&(i.far=n,i.updateProjectionMatrix()),Od.setFromMatrixPosition(e.matrixWorld),i.position.copy(Od),Wd.copy(i.position),Wd.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(Wd),i.updateMatrixWorld(),r.makeTranslation(-Od.x,-Od.y,-Od.z),Vd.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Vd)}}class Fd extends Cd{constructor(e,t,i=0,r=1){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new Hd}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Qd extends Ld{constructor(){super(new Wo(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class zd extends Cd{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(sn.DefaultUp),this.updateMatrix(),this.target=new sn,this.shadow=new Qd}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Gd extends Cd{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class Nd extends Cd{constructor(e,t,i=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class Ud{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new nr)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,r=e.y,n=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*n),t.addScaledVector(o[3],.488603*i),t.addScaledVector(o[4],i*r*1.092548),t.addScaledVector(o[5],r*n*1.092548),t.addScaledVector(o[6],.315392*(3*n*n-1)),t.addScaledVector(o[7],i*n*1.092548),t.addScaledVector(o[8],.546274*(i*i-r*r)),t}getIrradianceAt(e,t){const i=e.x,r=e.y,n=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],1.023328*r),t.addScaledVector(o[2],1.023328*n),t.addScaledVector(o[3],1.023328*i),t.addScaledVector(o[4],.858086*i*r),t.addScaledVector(o[5],.858086*r*n),t.addScaledVector(o[6],.743125*n*n-.247708),t.addScaledVector(o[7],.858086*i*n),t.addScaledVector(o[8],.429043*(i*i-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].fromArray(e,t+3*r);return this}toArray(e=[],t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].toArray(e,t+3*r);return e}static getBasisAt(e,t){const i=e.x,r=e.y,n=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*n,t[3]=.488603*i,t[4]=1.092548*i*r,t[5]=1.092548*r*n,t[6]=.315392*(3*n*n-1),t[7]=1.092548*i*n,t[8]=.546274*(i*i-r*r)}}class jd extends Cd{constructor(e=new Ud,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class qd extends yd{constructor(e){super(e),this.textures={}}load(e,t,i,r){const n=this,o=new $d(n.manager);o.setPath(n.path),o.setRequestHeader(n.requestHeader),o.setWithCredentials(n.withCredentials),o.load(e,(function(i){try{t(n.parse(JSON.parse(i)))}catch(t){r?r(t):console.error(t),n.manager.itemError(e)}}),i,r)}parse(e){const t=this.textures;function i(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const r=qd.createMaterialFromType(e.type);if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=e.sheen),void 0!==e.sheenColor&&(r.sheenColor=(new zi).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(r.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.specularIntensity&&(r.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==r.specularColor&&r.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.iridescence&&(r.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(r.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.thickness&&(r.thickness=e.thickness),void 0!==e.attenuationDistance&&(r.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==r.attenuationColor&&r.attenuationColor.setHex(e.attenuationColor),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.shadowSide&&(r.shadowSide=e.shadowSide),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.alphaToCoverage&&(r.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(r.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const n=e.uniforms[t];switch(r.uniforms[t]={},n.type){case"t":r.uniforms[t].value=i(n.value);break;case"c":r.uniforms[t].value=(new zi).setHex(n.value);break;case"v2":r.uniforms[t].value=(new _i).fromArray(n.value);break;case"v3":r.uniforms[t].value=(new nr).fromArray(n.value);break;case"v4":r.uniforms[t].value=(new Yi).fromArray(n.value);break;case"m3":r.uniforms[t].value=(new Ti).fromArray(n.value);break;case"m4":r.uniforms[t].value=(new Ir).fromArray(n.value);break;default:r.uniforms[t].value=n.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(r.glslVersion=e.glslVersion),void 0!==e.extensions)for(const t in e.extensions)r.extensions[t]=e.extensions[t];if(void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=i(e.map)),void 0!==e.matcap&&(r.matcap=i(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=i(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=i(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=i(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),r.normalScale=(new _i).fromArray(t)}return void 0!==e.displacementMap&&(r.displacementMap=i(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=i(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=i(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=i(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=i(e.specularMap)),void 0!==e.specularIntensityMap&&(r.specularIntensityMap=i(e.specularIntensityMap)),void 0!==e.specularColorMap&&(r.specularColorMap=i(e.specularColorMap)),void 0!==e.envMap&&(r.envMap=i(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=i(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=i(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=i(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=i(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=i(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new _i).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(r.iridescenceMap=i(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(r.iridescenceThicknessMap=i(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(r.transmissionMap=i(e.transmissionMap)),void 0!==e.thicknessMap&&(r.thicknessMap=i(e.thicknessMap)),void 0!==e.sheenColorMap&&(r.sheenColorMap=i(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(r.sheenRoughnessMap=i(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){return new{ShadowMaterial:Wh,SpriteMaterial:ul,RawShaderMaterial:Hh,ShaderMaterial:po,PointsMaterial:oc,MeshPhysicalMaterial:Qh,MeshStandardMaterial:Fh,MeshPhongMaterial:zh,MeshToonMaterial:Gh,MeshNormalMaterial:Nh,MeshLambertMaterial:Uh,MeshDepthMaterial:Gs,MeshDistanceMaterial:Ns,MeshBasicMaterial:vn,MeshMatcapMaterial:jh,LineDashedMaterial:qh,LineBasicMaterial:ql,Material:wn}[e]}}class Xd{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class Yd extends Qn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class Jd extends yd{constructor(e){super(e)}load(e,t,i,r){const n=this,o=new $d(n.manager);o.setPath(n.path),o.setRequestHeader(n.requestHeader),o.setWithCredentials(n.withCredentials),o.load(e,(function(i){try{t(n.parse(JSON.parse(i)))}catch(t){r?r(t):console.error(t),n.manager.itemError(e)}}),i,r)}parse(e){const t={},i={};function r(e,r){if(void 0!==t[r])return t[r];const n=e.interleavedBuffers[r],o=function(e,t){if(void 0!==i[t])return i[t];const r=e.arrayBuffers[t],n=new Uint32Array(r).buffer;return i[t]=n,n}(e,n.buffer),a=Di(n.type,o),s=new cl(a,n.stride);return s.uuid=n.uuid,t[r]=s,s}const n=e.isInstancedBufferGeometry?new Yd:new Qn,o=e.data.index;if(void 0!==o){const e=Di(o.type,o.array);n.setIndex(new Sn(e,1))}const a=e.data.attributes;for(const t in a){const i=a[t];let o;if(i.isInterleavedBufferAttribute){const t=r(e.data,i.data);o=new dl(t,i.itemSize,i.offset,i.normalized)}else{const e=Di(i.type,i.array);o=new(i.isInstancedBufferAttribute?Ql:Sn)(e,i.itemSize,i.normalized)}void 0!==i.name&&(o.name=i.name),void 0!==i.usage&&o.setUsage(i.usage),void 0!==i.updateRange&&(o.updateRange.offset=i.updateRange.offset,o.updateRange.count=i.updateRange.count),n.setAttribute(t,o)}const s=e.data.morphAttributes;if(s)for(const t in s){const i=s[t],o=[];for(let t=0,n=i.length;t<n;t++){const n=i[t];let a;if(n.isInterleavedBufferAttribute){const t=r(e.data,n.data);a=new dl(t,n.itemSize,n.offset,n.normalized)}else{const e=Di(n.type,n.array);a=new Sn(e,n.itemSize,n.normalized)}void 0!==n.name&&(a.name=n.name),o.push(a)}n.morphAttributes[t]=o}e.data.morphTargetsRelative&&(n.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let e=0,t=l.length;e!==t;++e){const t=l[e];n.addGroup(t.start,t.count,t.materialIndex)}const c=e.data.boundingSphere;if(void 0!==c){const e=new nr;void 0!==c.center&&e.fromArray(c.center),n.boundingSphere=new kr(e,c.radius)}return e.name&&(n.name=e.name),e.userData&&(n.userData=e.userData),n}}class Zd extends yd{constructor(e){super(e)}load(e,t,i,r){const n=this,o=""===this.path?Xd.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const a=new $d(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(i){let o=null;try{o=JSON.parse(i)}catch(t){return void 0!==r&&r(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}const a=o.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?n.parse(o,t):console.error("THREE.ObjectLoader: Can't load "+e)}),i,r)}async loadAsync(e,t){const i=""===this.path?Xd.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;const r=new $d(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const n=await r.loadAsync(e,t),o=JSON.parse(n),a=o.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(o)}parse(e,t){const i=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),n=this.parseGeometries(e.geometries,r),o=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),a=this.parseTextures(e.textures,o),s=this.parseMaterials(e.materials,a),l=this.parseObject(e.object,n,s,a,i),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),void 0!==t){let e=!1;for(const t in o)if(o[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),n=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,n),a=this.parseMaterials(e.materials,o),s=this.parseObject(e.object,r,a,o,t),l=this.parseSkeletons(e.skeletons,s);return this.bindSkeletons(s,l),s}parseShapes(e){const t={};if(void 0!==e)for(let i=0,r=e.length;i<r;i++){const r=(new Yc).fromJSON(e[i]);t[r.uuid]=r}return t}parseSkeletons(e,t){const i={},r={};if(t.traverse((function(e){e.isBone&&(r[e.uuid]=e)})),void 0!==e)for(let t=0,n=e.length;t<n;t++){const n=(new Fl).fromJSON(e[t],r);i[n.uuid]=n}return i}parseGeometries(e,t){const i={};if(void 0!==e){const r=new Jd;for(let n=0,o=e.length;n<o;n++){let o;const a=e[n];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":o=r.parse(a);break;default:a.type in Oh?o=Oh[a.type].fromJSON(a,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${a.type}"`)}o.uuid=a.uuid,void 0!==a.name&&(o.name=a.name),!0===o.isBufferGeometry&&void 0!==a.userData&&(o.userData=a.userData),i[a.uuid]=o}}return i}parseMaterials(e,t){const i={},r={};if(void 0!==e){const n=new qd;n.setTextures(t);for(let t=0,o=e.length;t<o;t++){const o=e[t];void 0===i[o.uuid]&&(i[o.uuid]=n.parse(o)),r[o.uuid]=i[o.uuid]}}return r}parseAnimations(e){const t={};if(void 0!==e)for(let i=0;i<e.length;i++){const r=e[i],n=md.parse(r);t[n.uuid]=n}return t}parseImages(e,t){const i=this,r={};let n;function o(e){if("string"==typeof e){const t=e;return function(e){return i.manager.itemStart(e),n.load(e,(function(){i.manager.itemEnd(e)}),void 0,(function(){i.manager.itemError(e),i.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:i.resourcePath+t)}return e.data?{data:Di(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const i=new xd(t);n=new Pd(i),n.setCrossOrigin(this.crossOrigin);for(let t=0,i=e.length;t<i;t++){const i=e[t],n=i.url;if(Array.isArray(n)){const e=[];for(let t=0,i=n.length;t<i;t++){const i=o(n[t]);null!==i&&(i instanceof HTMLImageElement?e.push(i):e.push(new Ol(i.data,i.width,i.height)))}r[i.uuid]=new Ui(e)}else{const e=o(i.url);r[i.uuid]=new Ui(e)}}}return r}async parseImagesAsync(e){const t=this,i={};let r;async function n(e){if("string"==typeof e){const i=e,n=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(i)?i:t.resourcePath+i;return await r.loadAsync(n)}return e.data?{data:Di(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){r=new Pd(this.manager),r.setCrossOrigin(this.crossOrigin);for(let t=0,r=e.length;t<r;t++){const r=e[t],o=r.url;if(Array.isArray(o)){const e=[];for(let t=0,i=o.length;t<i;t++){const i=o[t],r=await n(i);null!==r&&(r instanceof HTMLImageElement?e.push(r):e.push(new Ol(r.data,r.width,r.height)))}i[r.uuid]=new Ui(e)}else{const e=await n(r.url);i[r.uuid]=new Ui(e)}}}return i}parseTextures(e,t){function i(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const r={};if(void 0!==e)for(let n=0,o=e.length;n<o;n++){const o=e[n];void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===t[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const a=t[o.image],s=a.data;let l;Array.isArray(s)?(l=new bo,6===s.length&&(l.needsUpdate=!0)):(l=s&&s.data?new Ol:new Xi,s&&(l.needsUpdate=!0)),l.source=a,l.uuid=o.uuid,void 0!==o.name&&(l.name=o.name),void 0!==o.mapping&&(l.mapping=i(o.mapping,Kd)),void 0!==o.offset&&l.offset.fromArray(o.offset),void 0!==o.repeat&&l.repeat.fromArray(o.repeat),void 0!==o.center&&l.center.fromArray(o.center),void 0!==o.rotation&&(l.rotation=o.rotation),void 0!==o.wrap&&(l.wrapS=i(o.wrap[0],eu),l.wrapT=i(o.wrap[1],eu)),void 0!==o.format&&(l.format=o.format),void 0!==o.type&&(l.type=o.type),void 0!==o.encoding&&(l.encoding=o.encoding),void 0!==o.minFilter&&(l.minFilter=i(o.minFilter,tu)),void 0!==o.magFilter&&(l.magFilter=i(o.magFilter,tu)),void 0!==o.anisotropy&&(l.anisotropy=o.anisotropy),void 0!==o.flipY&&(l.flipY=o.flipY),void 0!==o.premultiplyAlpha&&(l.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(l.unpackAlignment=o.unpackAlignment),void 0!==o.userData&&(l.userData=o.userData),r[o.uuid]=l}return r}parseObject(e,t,i,r,n){let o,a,s;function l(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function c(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let r=0,n=e.length;r<n;r++){const n=e[r];void 0===i[n]&&console.warn("THREE.ObjectLoader: Undefined material",n),t.push(i[n])}return t}return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),i[e]}}function h(e){return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),r[e]}switch(e.type){case"Scene":o=new ll,void 0!==e.background&&(Number.isInteger(e.background)?o.background=new zi(e.background):o.background=h(e.background)),void 0!==e.environment&&(o.environment=h(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?o.fog=new sl(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(o.fog=new al(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":o=new fo(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(o.focus=e.focus),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.filmGauge&&(o.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(o.filmOffset=e.filmOffset),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new Wo(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new Gd(e.color,e.intensity);break;case"DirectionalLight":o=new zd(e.color,e.intensity);break;case"PointLight":o=new Fd(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new Nd(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new Bd(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new Ad(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=(new jd).fromJSON(e);break;case"SkinnedMesh":a=l(e.geometry),s=c(e.material),o=new Bl(a,s),void 0!==e.bindMode&&(o.bindMode=e.bindMode),void 0!==e.bindMatrix&&o.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(o.skeleton=e.skeleton);break;case"Mesh":a=l(e.geometry),s=c(e.material),o=new ao(a,s);break;case"InstancedMesh":a=l(e.geometry),s=c(e.material);const t=e.count,i=e.instanceMatrix,r=e.instanceColor;o=new jl(a,s,t),o.instanceMatrix=new Ql(new Float32Array(i.array),16),void 0!==r&&(o.instanceColor=new Ql(new Float32Array(r.array),r.itemSize));break;case"LOD":o=new Al;break;case"Line":o=new ec(l(e.geometry),c(e.material));break;case"LineLoop":o=new nc(l(e.geometry),c(e.material));break;case"LineSegments":o=new rc(l(e.geometry),c(e.material));break;case"PointCloud":case"Points":o=new hc(l(e.geometry),c(e.material));break;case"Sprite":o=new kl(c(e.material));break;case"Group":o=new Js;break;case"Bone":o=new Vl;break;default:o=new sn}if(o.uuid=e.uuid,void 0!==e.name&&(o.name=e.name),void 0!==e.matrix?(o.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(void 0!==e.position&&o.position.fromArray(e.position),void 0!==e.rotation&&o.rotation.fromArray(e.rotation),void 0!==e.quaternion&&o.quaternion.fromArray(e.quaternion),void 0!==e.scale&&o.scale.fromArray(e.scale)),void 0!==e.castShadow&&(o.castShadow=e.castShadow),void 0!==e.receiveShadow&&(o.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(o.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(o.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(o.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&o.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(o.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(o.visible=e.visible),void 0!==e.frustumCulled&&(o.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(o.renderOrder=e.renderOrder),void 0!==e.userData&&(o.userData=e.userData),void 0!==e.layers&&(o.layers.mask=e.layers),void 0!==e.children){const a=e.children;for(let e=0;e<a.length;e++)o.add(this.parseObject(a[e],t,i,r,n))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const i=t[e];o.animations.push(n[i])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(o.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const i=t[e],r=o.getObjectByProperty("uuid",i.object);void 0!==r&&o.addLevel(r,i.distance)}}return o}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const i=t[e.skeleton];void 0===i?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(i,e.bindMatrix)}}))}}const Kd={UVMapping:te,CubeReflectionMapping:ie,CubeRefractionMapping:re,EquirectangularReflectionMapping:ne,EquirectangularRefractionMapping:oe,CubeUVReflectionMapping:ae},eu={RepeatWrapping:se,ClampToEdgeWrapping:le,MirroredRepeatWrapping:ce},tu={NearestFilter:he,NearestMipmapNearestFilter:de,NearestMipmapLinearFilter:pe,LinearFilter:fe,LinearMipmapNearestFilter:ge,LinearMipmapLinearFilter:be};class iu extends yd{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const n=this,o=gd.get(e);if(void 0!==o)return n.manager.itemStart(e),setTimeout((function(){t&&t(o),n.manager.itemEnd(e)}),0),o;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(n.options,{colorSpaceConversion:"none"}))})).then((function(i){gd.add(e,i),t&&t(i),n.manager.itemEnd(e)})).catch((function(t){r&&r(t),n.manager.itemError(e),n.manager.itemEnd(e)})),n.manager.itemStart(e)}}let ru;const nu={getContext:function(){return void 0===ru&&(ru=new(window.AudioContext||window.webkitAudioContext)),ru},setContext:function(e){ru=e}};class ou extends yd{constructor(e){super(e)}load(e,t,i,r){const n=this,o=new $d(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(i){try{const e=i.slice(0);nu.getContext().decodeAudioData(e,(function(e){t(e)}))}catch(t){r?r(t):console.error(t),n.manager.itemError(e)}}),i,r)}}class au extends jd{constructor(e,t,i=1){super(void 0,i),this.isHemisphereLightProbe=!0;const r=(new zi).set(e),n=(new zi).set(t),o=new nr(r.r,r.g,r.b),a=new nr(n.r,n.g,n.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(s),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(l)}}class su extends jd{constructor(e,t=1){super(void 0,t),this.isAmbientLightProbe=!0;const i=(new zi).set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const lu=new Ir,cu=new Ir,hu=new Ir;class du{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new fo,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new fo,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,hu.copy(e.projectionMatrix);const i=t.eyeSep/2,r=i*t.near/t.focus,n=t.near*Math.tan(fi*t.fov*.5)/t.zoom;let o,a;cu.elements[12]=-i,lu.elements[12]=i,o=-n*t.aspect+r,a=n*t.aspect+r,hu.elements[0]=2*t.near/(a-o),hu.elements[8]=(a+o)/(a-o),this.cameraL.projectionMatrix.copy(hu),o=-n*t.aspect-r,a=n*t.aspect-r,hu.elements[0]=2*t.near/(a-o),hu.elements[8]=(a+o)/(a-o),this.cameraR.projectionMatrix.copy(hu)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(cu),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(lu)}}class uu{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=pu(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=pu();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function pu(){return("undefined"==typeof performance?Date:performance).now()}const mu=new nr,fu=new rr,gu=new nr,xu=new nr;class bu extends sn{constructor(){super(),this.type="AudioListener",this.context=nu.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new uu}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(mu,fu,gu),xu.set(0,0,-1).applyQuaternion(fu),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(mu.x,e),t.positionY.linearRampToValueAtTime(mu.y,e),t.positionZ.linearRampToValueAtTime(mu.z,e),t.forwardX.linearRampToValueAtTime(xu.x,e),t.forwardY.linearRampToValueAtTime(xu.y,e),t.forwardZ.linearRampToValueAtTime(xu.z,e),t.upX.linearRampToValueAtTime(i.x,e),t.upY.linearRampToValueAtTime(i.y,e),t.upZ.linearRampToValueAtTime(i.z,e)}else t.setPosition(mu.x,mu.y,mu.z),t.setOrientation(xu.x,xu.y,xu.z,i.x,i.y,i.z)}}class yu extends sn{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const wu=new nr,vu=new rr,$u=new nr,Mu=new nr;class Su extends yu{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(wu,vu,$u),Mu.set(0,0,1).applyQuaternion(vu);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(wu.x,e),t.positionY.linearRampToValueAtTime(wu.y,e),t.positionZ.linearRampToValueAtTime(wu.z,e),t.orientationX.linearRampToValueAtTime(Mu.x,e),t.orientationY.linearRampToValueAtTime(Mu.y,e),t.orientationZ.linearRampToValueAtTime(Mu.z,e)}else t.setPosition(wu.x,wu.y,wu.z),t.setOrientation(Mu.x,Mu.y,Mu.z)}}class Pu{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}}class ku{constructor(e,t,i){let r,n,o;switch(this.binding=e,this.valueSize=i,t){case"quaternion":r=this._slerp,n=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":r=this._select,n=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:r=this._lerp,n=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=n,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,r=this.valueSize,n=e*r+r;let o=this.cumulativeWeight;if(0===o){for(let e=0;e!==r;++e)i[n+e]=i[e];o=t}else{o+=t;const e=t/o;this._mixBufferRegion(i,n,0,e,r)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,r=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,r=e*t+t,n=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,n<1){const e=t*this._origIndex;this._mixBufferRegion(i,r,e,1-n,t)}o>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(let e=t,n=t+t;e!==n;++e)if(i[e]!==i[e+t]){a.setValue(i,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(t,r);for(let e=i,n=r;e!==n;++e)t[e]=t[r+e%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,r,n){if(r>=.5)for(let r=0;r!==n;++r)e[t+r]=e[i+r]}_slerp(e,t,i,r){rr.slerpFlat(e,t,e,t,e,i,r)}_slerpAdditive(e,t,i,r,n){const o=this._workIndex*n;rr.multiplyQuaternionsFlat(e,o,e,t,e,i),rr.slerpFlat(e,t,e,t,e,o,r)}_lerp(e,t,i,r,n){const o=1-r;for(let a=0;a!==n;++a){const n=t+a;e[n]=e[n]*o+e[i+a]*r}}_lerpAdditive(e,t,i,r,n){for(let o=0;o!==n;++o){const n=t+o;e[n]=e[n]+e[i+o]*r}}}const _u="\\[\\]\\.:\\/",Tu=new RegExp("[\\[\\]\\.:\\/]","g"),Cu="[^\\[\\]\\.:\\/]",Au="[^"+_u.replace("\\.","")+"]",Du=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Cu)+/(WCOD+)?/.source.replace("WCOD",Au)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Cu)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Cu)+"$"),Ru=["material","materials","bones","map"];class Eu{constructor(e,t,i){this.path=t,this.parsedPath=i||Eu.parseTrackName(t),this.node=Eu.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new Eu.Composite(e,t,i):new Eu(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Tu,"")}static parseTrackName(e){const t=Du.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const e=i.nodeName.substring(r+1);-1!==Ru.indexOf(e)&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=e)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){const i=function(e){for(let r=0;r<e.length;r++){const n=e[r];if(n.name===t||n.uuid===t)return n;const o=i(n.children);if(o)return o}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)e[t++]=i[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,r=t.propertyName;let n=t.propertyIndex;if(e||(e=Eu.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let r=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;case"map":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==r){if(void 0===e[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[r]}}const o=e[r];if(void 0===o){const i=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+r+" but it wasn't found.",e)}let a=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==n){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[n]&&(n=e.morphTargetDictionary[n])}s=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=n}else void 0!==o.fromArray&&void 0!==o.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(s=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Eu.Composite=class{constructor(e,t,i){const r=i||Eu.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,r=this._bindings[i];void 0!==r&&r.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},Eu.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Eu.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Eu.prototype.GetterByBindingType=[Eu.prototype._getValue_direct,Eu.prototype._getValue_array,Eu.prototype._getValue_arrayElement,Eu.prototype._getValue_toArray],Eu.prototype.SetterByBindingTypeAndVersioning=[[Eu.prototype._setValue_direct,Eu.prototype._setValue_direct_setNeedsUpdate,Eu.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Eu.prototype._setValue_array,Eu.prototype._setValue_array_setNeedsUpdate,Eu.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Eu.prototype._setValue_arrayElement,Eu.prototype._setValue_arrayElement_setNeedsUpdate,Eu.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Eu.prototype._setValue_fromArray,Eu.prototype._setValue_fromArray_setNeedsUpdate,Eu.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Lu{constructor(){this.isAnimationObjectGroup=!0,this.uuid=xi(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,i=arguments.length;t!==i;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,i=this._paths,r=this._parsedPaths,n=this._bindings,o=n.length;let a,s=e.length,l=this.nCachedObjects_;for(let c=0,h=arguments.length;c!==h;++c){const h=arguments[c],d=h.uuid;let u=t[d];if(void 0===u){u=s++,t[d]=u,e.push(h);for(let e=0,t=o;e!==t;++e)n[e].push(new Eu(h,i[e],r[e]))}else if(u<l){a=e[u];const s=--l,c=e[s];t[c.uuid]=u,e[u]=c,t[d]=s,e[s]=h;for(let e=0,t=o;e!==t;++e){const t=n[e],o=t[s];let a=t[u];t[u]=o,void 0===a&&(a=new Eu(h,i[e],r[e])),t[s]=a}}else e[u]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,r=i.length;let n=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){const a=arguments[o],s=a.uuid,l=t[s];if(void 0!==l&&l>=n){const o=n++,c=e[o];t[c.uuid]=l,e[l]=c,t[s]=o,e[o]=a;for(let e=0,t=r;e!==t;++e){const t=i[e],r=t[o],n=t[l];t[l]=r,t[o]=n}}}this.nCachedObjects_=n}uncache(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,r=i.length;let n=this.nCachedObjects_,o=e.length;for(let a=0,s=arguments.length;a!==s;++a){const s=arguments[a].uuid,l=t[s];if(void 0!==l)if(delete t[s],l<n){const a=--n,s=e[a],c=--o,h=e[c];t[s.uuid]=l,e[l]=s,t[h.uuid]=a,e[a]=h,e.pop();for(let e=0,t=r;e!==t;++e){const t=i[e],r=t[a],n=t[c];t[l]=r,t[a]=n,t.pop()}}else{const n=--o,a=e[n];n>0&&(t[a.uuid]=l),e[l]=a,e.pop();for(let e=0,t=r;e!==t;++e){const t=i[e];t[l]=t[n],t.pop()}}}this.nCachedObjects_=n}subscribe_(e,t){const i=this._bindingsIndicesByPath;let r=i[e];const n=this._bindings;if(void 0!==r)return n[r];const o=this._paths,a=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,h=new Array(l);r=n.length,i[e]=r,o.push(e),a.push(t),n.push(h);for(let i=c,r=s.length;i!==r;++i){const r=s[i];h[i]=new Eu(r,e,t)}return h}unsubscribe_(e){const t=this._bindingsIndicesByPath,i=t[e];if(void 0!==i){const r=this._paths,n=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];t[e[a]]=i,o[i]=s,o.pop(),n[i]=n[a],n.pop(),r[i]=r[a],r.pop()}}}class Iu{constructor(e,t,i=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=r;const n=t.tracks,o=n.length,a=new Array(o),s={endingStart:vt,endingEnd:vt};for(let e=0;e!==o;++e){const t=n[e].createInterpolant(null);a[e]=t,t.settings=s}this._interpolantSettings=s,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=gt,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const i=this._clip.duration,r=e._clip.duration,n=r/i,o=i/r;e.warp(1,n,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const r=this._mixer,n=r.time,o=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);const s=a.parameterPositions,l=a.sampleValues;return s[0]=n,s[1]=n+i,l[0]=e/o,l[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,r){if(!this.enabled)return void this._updateWeight(e);const n=this._startTime;if(null!==n){const r=(e-n)*i;r<0||0===i?t=0:(this._startTime=null,t=i*r)}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===Pt)for(let i=0,r=e.length;i!==r;++i)e[i].evaluate(o),t[i].accumulateAdditive(a);else for(let i=0,n=e.length;i!==n;++i)e[i].evaluate(o),t[i].accumulate(r,a)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(null!==i){const r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(null!==i){t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let r=this.time+e,n=this._loopCount;const o=i===xt;if(0===e)return-1===n?r:o&&1==(1&n)?t-r:r;if(i===ft){-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===n&&(e>=0?(n=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r>=t||r<0){const i=Math.floor(r/t);r-=t*i,n+=Math.abs(i);const a=this.repetitions-n;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){const t=e<0;this._setEndings(t,!t,o)}else this._setEndings(!1,!1,o);this._loopCount=n,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=r;if(o&&1==(1&n))return t-r}return r}_setEndings(e,t,i){const r=this._interpolantSettings;i?(r.endingStart=$t,r.endingEnd=$t):(r.endingStart=e?this.zeroSlopeAtStart?$t:vt:Mt,r.endingEnd=t?this.zeroSlopeAtEnd?$t:vt:Mt)}_scheduleFading(e,t,i){const r=this._mixer,n=r.time;let o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,s=o.sampleValues;return a[0]=n,s[0]=t,a[1]=n+e,s[1]=i,this}}const Bu=new Float32Array(1);class Vu extends ui{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,r=e._clip.tracks,n=r.length,o=e._propertyBindings,a=e._interpolants,s=i.uuid,l=this._bindingsByRootAndName;let c=l[s];void 0===c&&(c={},l[s]=c);for(let e=0;e!==n;++e){const n=r[e],l=n.name;let h=c[l];if(void 0!==h)++h.referenceCount,o[e]=h;else{if(h=o[e],void 0!==h){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,s,l));continue}const r=t&&t._propertyBindings[e].binding.parsedPath;h=new ku(Eu.create(i,l,r),n.ValueTypeName,n.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,s,l),o[e]=h}a[e].resultBuffer=h.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,i=e._clip.uuid,r=this._actionsByClip[i];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,i,t)}const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,i){const r=this._actions,n=this._actionsByClip;let o=n[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=o;else{const t=o.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;const n=e._clip.uuid,o=this._actionsByClip,a=o[n],s=a.knownActions,l=s[s.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),e._byClipCacheIndex=null;delete a.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete o[n],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_addInactiveBinding(e,t,i){const r=this._bindingsByRootAndName,n=this._bindings;let o=r[t];void 0===o&&(o={},r[t]=o),o[i]=e,e._cacheIndex=n.length,n.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,r=i.rootNode.uuid,n=i.path,o=this._bindingsByRootAndName,a=o[r],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete a[n],0===Object.keys(a).length&&delete o[r]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return void 0===i&&(i=new nd(new Float32Array(2),new Float32Array(2),1,Bu),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,n=t[r];e.__cacheIndex=r,t[r]=e,n.__cacheIndex=i,t[i]=n}clipAction(e,t,i){const r=t||this._root,n=r.uuid;let o="string"==typeof e?md.findByName(r,e):e;const a=null!==o?o.uuid:e,s=this._actionsByClip[a];let l=null;if(void 0===i&&(i=null!==o?o.blendMode:St),void 0!==s){const e=s.actionByRoot[n];if(void 0!==e&&e.blendMode===i)return e;l=s.knownActions[0],null===o&&(o=l._clip)}if(null===o)return null;const c=new Iu(this,o,t,i);return this._bindAction(c,l),this._addInactiveAction(c,a,n),c}existingAction(e,t){const i=t||this._root,r=i.uuid,n="string"==typeof e?md.findByName(i,e):e,o=n?n.uuid:e,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[r]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,r=this.time+=e,n=Math.sign(e),o=this._accuIndex^=1;for(let a=0;a!==i;++a){t[a]._update(r,e,n,o)}const a=this._bindings,s=this._nActiveBindings;for(let e=0;e!==s;++e)a[e].apply(o);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,r=this._actionsByClip,n=r[i];if(void 0!==n){const e=n.knownActions;for(let i=0,r=e.length;i!==r;++i){const r=e[i];this._deactivateAction(r);const n=r._cacheIndex,o=t[t.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,o._cacheIndex=n,t[n]=o,t.pop(),this._removeInactiveBindingsForAction(r)}delete r[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const e in i){const r=i[e].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName[t];if(void 0!==r)for(const e in r){const t=r[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class Ou{constructor(e){this.value=e}clone(){return new Ou(void 0===this.value.clone?this.value:this.value.clone())}}let Wu=0;class Hu extends ui{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Wu++}),this.name="",this.usage=ei,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let e=0,i=t.length;e<i;e++)this.uniforms.push(t[e].clone());return this}clone(){return(new this.constructor).copy(this)}}class Fu extends cl{constructor(e,t,i=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class Qu{constructor(e,t,i,r,n){this.isGLBufferAttribute=!0,this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=r,this.count=n,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class zu{constructor(e,t,i=0,r=1/0){this.ray=new Lr(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new Ur,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return Nu(e,this,i,t),i.sort(Gu),i}intersectObjects(e,t=!0,i=[]){for(let r=0,n=e.length;r<n;r++)Nu(e[r],this,i,t);return i.sort(Gu),i}}function Gu(e,t){return e.distance-t.distance}function Nu(e,t,i,r){if(e.layers.test(t.layers)&&e.raycast(t,i),!0===r){const r=e.children;for(let e=0,n=r.length;e<n;e++)Nu(r[e],t,i,!0)}}class Uu{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(bi(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class ju{constructor(e=1,t=0,i=0){return this.radius=e,this.theta=t,this.y=i,this}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}clone(){return(new this.constructor).copy(this)}}const qu=new _i;class Xu{constructor(e=new _i(1/0,1/0),t=new _i(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=qu.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return qu.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Yu=new nr,Ju=new nr;class Zu{constructor(e=new nr,t=new nr){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Yu.subVectors(e,this.start),Ju.subVectors(this.end,this.start);const i=Ju.dot(Ju);let r=Ju.dot(Yu)/i;return t&&(r=bi(r,0,1)),r}closestPointToPoint(e,t,i){const r=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const Ku=new nr;class ep extends sn{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const i=new Qn,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,i=32;e<i;e++,t++){const n=e/i*Math.PI*2,o=t/i*Math.PI*2;r.push(Math.cos(n),Math.sin(n),1,Math.cos(o),Math.sin(o),1)}i.setAttribute("position",new En(r,3));const n=new ql({fog:!1,toneMapped:!1});this.cone=new rc(i,n),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Ku.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Ku),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const tp=new nr,ip=new Ir,rp=new Ir;class np extends rc{constructor(e){const t=op(e),i=new Qn,r=[],n=[],o=new zi(0,0,1),a=new zi(0,1,0);for(let e=0;e<t.length;e++){const i=t[e];i.parent&&i.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),n.push(o.r,o.g,o.b),n.push(a.r,a.g,a.b))}i.setAttribute("position",new En(r,3)),i.setAttribute("color",new En(n,3));super(i,new ql({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,r=i.getAttribute("position");rp.copy(this.root.matrixWorld).invert();for(let e=0,i=0;e<t.length;e++){const n=t[e];n.parent&&n.parent.isBone&&(ip.multiplyMatrices(rp,n.matrixWorld),tp.setFromMatrixPosition(ip),r.setXYZ(i,tp.x,tp.y,tp.z),ip.multiplyMatrices(rp,n.parent.matrixWorld),tp.setFromMatrixPosition(ip),r.setXYZ(i+1,tp.x,tp.y,tp.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function op(e){const t=[];!0===e.isBone&&t.push(e);for(let i=0;i<e.children.length;i++)t.push.apply(t,op(e.children[i]));return t}class ap extends ao{constructor(e,t,i){super(new Dh(t,4,2),new vn({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.light.updateMatrixWorld(),this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const sp=new nr,lp=new zi,cp=new zi;class hp extends sn{constructor(e,t,i){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;const r=new Th(t);r.rotateY(.5*Math.PI),this.material=new vn({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const n=r.getAttribute("position"),o=new Float32Array(3*n.count);r.setAttribute("color",new Sn(o,3)),this.add(new ao(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");lp.copy(this.light.color),cp.copy(this.light.groundColor);for(let e=0,i=t.count;e<i;e++){const r=e<i/2?lp:cp;t.setXYZ(e,r.r,r.g,r.b)}t.needsUpdate=!0}e.lookAt(sp.setFromMatrixPosition(this.light.matrixWorld).negate())}}class dp extends rc{constructor(e=10,t=10,i=4473924,r=8947848){i=new zi(i),r=new zi(r);const n=t/2,o=e/t,a=e/2,s=[],l=[];for(let e=0,c=0,h=-a;e<=t;e++,h+=o){s.push(-a,0,h,a,0,h),s.push(h,0,-a,h,0,a);const t=e===n?i:r;t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3}const c=new Qn;c.setAttribute("position",new En(s,3)),c.setAttribute("color",new En(l,3));super(c,new ql({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class up extends rc{constructor(e=10,t=16,i=8,r=64,n=4473924,o=8947848){n=new zi(n),o=new zi(o);const a=[],s=[];if(t>1)for(let i=0;i<t;i++){const r=i/t*(2*Math.PI),l=Math.sin(r)*e,c=Math.cos(r)*e;a.push(0,0,0),a.push(l,0,c);const h=1&i?n:o;s.push(h.r,h.g,h.b),s.push(h.r,h.g,h.b)}for(let t=0;t<i;t++){const l=1&t?n:o,c=e-e/i*t;for(let e=0;e<r;e++){let t=e/r*(2*Math.PI),i=Math.sin(t)*c,n=Math.cos(t)*c;a.push(i,0,n),s.push(l.r,l.g,l.b),t=(e+1)/r*(2*Math.PI),i=Math.sin(t)*c,n=Math.cos(t)*c,a.push(i,0,n),s.push(l.r,l.g,l.b)}}const l=new Qn;l.setAttribute("position",new En(a,3)),l.setAttribute("color",new En(s,3));super(l,new ql({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const pp=new nr,mp=new nr,fp=new nr;class gp extends sn{constructor(e,t,i){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===t&&(t=1);let r=new Qn;r.setAttribute("position",new En([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const n=new ql({fog:!1,toneMapped:!1});this.lightPlane=new ec(r,n),this.add(this.lightPlane),r=new Qn,r.setAttribute("position",new En([0,0,0,0,0,1],3)),this.targetLine=new ec(r,n),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){pp.setFromMatrixPosition(this.light.matrixWorld),mp.setFromMatrixPosition(this.light.target.matrixWorld),fp.subVectors(mp,pp),this.lightPlane.lookAt(mp),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(mp),this.targetLine.scale.z=fp.length()}}const xp=new nr,bp=new mo;class yp extends rc{constructor(e){const t=new Qn,i=new ql({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],o={};function a(e,t){s(e),s(t)}function s(e){r.push(0,0,0),n.push(0,0,0),void 0===o[e]&&(o[e]=[]),o[e].push(r.length/3-1)}a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4"),t.setAttribute("position",new En(r,3)),t.setAttribute("color",new En(n,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const l=new zi(16755200),c=new zi(16711680),h=new zi(43775),d=new zi(16777215),u=new zi(3355443);this.setColors(l,c,h,d,u)}setColors(e,t,i,r,n){const o=this.geometry.getAttribute("color");o.setXYZ(0,e.r,e.g,e.b),o.setXYZ(1,e.r,e.g,e.b),o.setXYZ(2,e.r,e.g,e.b),o.setXYZ(3,e.r,e.g,e.b),o.setXYZ(4,e.r,e.g,e.b),o.setXYZ(5,e.r,e.g,e.b),o.setXYZ(6,e.r,e.g,e.b),o.setXYZ(7,e.r,e.g,e.b),o.setXYZ(8,e.r,e.g,e.b),o.setXYZ(9,e.r,e.g,e.b),o.setXYZ(10,e.r,e.g,e.b),o.setXYZ(11,e.r,e.g,e.b),o.setXYZ(12,e.r,e.g,e.b),o.setXYZ(13,e.r,e.g,e.b),o.setXYZ(14,e.r,e.g,e.b),o.setXYZ(15,e.r,e.g,e.b),o.setXYZ(16,e.r,e.g,e.b),o.setXYZ(17,e.r,e.g,e.b),o.setXYZ(18,e.r,e.g,e.b),o.setXYZ(19,e.r,e.g,e.b),o.setXYZ(20,e.r,e.g,e.b),o.setXYZ(21,e.r,e.g,e.b),o.setXYZ(22,e.r,e.g,e.b),o.setXYZ(23,e.r,e.g,e.b),o.setXYZ(24,t.r,t.g,t.b),o.setXYZ(25,t.r,t.g,t.b),o.setXYZ(26,t.r,t.g,t.b),o.setXYZ(27,t.r,t.g,t.b),o.setXYZ(28,t.r,t.g,t.b),o.setXYZ(29,t.r,t.g,t.b),o.setXYZ(30,t.r,t.g,t.b),o.setXYZ(31,t.r,t.g,t.b),o.setXYZ(32,i.r,i.g,i.b),o.setXYZ(33,i.r,i.g,i.b),o.setXYZ(34,i.r,i.g,i.b),o.setXYZ(35,i.r,i.g,i.b),o.setXYZ(36,i.r,i.g,i.b),o.setXYZ(37,i.r,i.g,i.b),o.setXYZ(38,r.r,r.g,r.b),o.setXYZ(39,r.r,r.g,r.b),o.setXYZ(40,n.r,n.g,n.b),o.setXYZ(41,n.r,n.g,n.b),o.setXYZ(42,n.r,n.g,n.b),o.setXYZ(43,n.r,n.g,n.b),o.setXYZ(44,n.r,n.g,n.b),o.setXYZ(45,n.r,n.g,n.b),o.setXYZ(46,n.r,n.g,n.b),o.setXYZ(47,n.r,n.g,n.b),o.setXYZ(48,n.r,n.g,n.b),o.setXYZ(49,n.r,n.g,n.b),o.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap;bp.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),wp("c",t,e,bp,0,0,-1),wp("t",t,e,bp,0,0,1),wp("n1",t,e,bp,-1,-1,-1),wp("n2",t,e,bp,1,-1,-1),wp("n3",t,e,bp,-1,1,-1),wp("n4",t,e,bp,1,1,-1),wp("f1",t,e,bp,-1,-1,1),wp("f2",t,e,bp,1,-1,1),wp("f3",t,e,bp,-1,1,1),wp("f4",t,e,bp,1,1,1),wp("u1",t,e,bp,.7,1.1,-1),wp("u2",t,e,bp,-.7,1.1,-1),wp("u3",t,e,bp,0,2,-1),wp("cf1",t,e,bp,-1,0,1),wp("cf2",t,e,bp,1,0,1),wp("cf3",t,e,bp,0,-1,1),wp("cf4",t,e,bp,0,1,1),wp("cn1",t,e,bp,-1,0,-1),wp("cn2",t,e,bp,1,0,-1),wp("cn3",t,e,bp,0,-1,-1),wp("cn4",t,e,bp,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function wp(e,t,i,r,n,o,a){xp.set(n,o,a).unproject(r);const s=t[e];if(void 0!==s){const e=i.getAttribute("position");for(let t=0,i=s.length;t<i;t++)e.setXYZ(s[t],xp.x,xp.y,xp.z)}}const vp=new sr;class $p extends rc{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),n=new Qn;n.setIndex(new Sn(i,1)),n.setAttribute("position",new Sn(r,3)),super(n,new ql({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&vp.setFromObject(this.object),vp.isEmpty())return;const t=vp.min,i=vp.max,r=this.geometry.attributes.position,n=r.array;n[0]=i.x,n[1]=i.y,n[2]=i.z,n[3]=t.x,n[4]=i.y,n[5]=i.z,n[6]=t.x,n[7]=t.y,n[8]=i.z,n[9]=i.x,n[10]=t.y,n[11]=i.z,n[12]=i.x,n[13]=i.y,n[14]=t.z,n[15]=t.x,n[16]=i.y,n[17]=t.z,n[18]=t.x,n[19]=t.y,n[20]=t.z,n[21]=i.x,n[22]=t.y,n[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}}class Mp extends rc{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Qn;r.setIndex(new Sn(i,1)),r.setAttribute("position",new En([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new ql({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}class Sp extends ec{constructor(e,t=1,i=16776960){const r=i,n=new Qn;n.setAttribute("position",new En([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),n.computeBoundingSphere(),super(n,new ql({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const o=new Qn;o.setAttribute("position",new En([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),o.computeBoundingSphere(),this.add(new ao(o,new vn({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}}const Pp=new nr;let kp,_p;class Tp extends sn{constructor(e=new nr(0,0,1),t=new nr(0,0,0),i=1,r=16776960,n=.2*i,o=.2*n){super(),this.type="ArrowHelper",void 0===kp&&(kp=new Qn,kp.setAttribute("position",new En([0,0,0,0,1,0],3)),_p=new Fc(0,.5,1,5,1),_p.translate(0,-.5,0)),this.position.copy(t),this.line=new ec(kp,new ql({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ao(_p,new vn({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,n,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Pp.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Pp,t)}}setLength(e,t=.2*e,i=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}class Cp extends rc{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=new Qn;i.setAttribute("position",new En(t,3)),i.setAttribute("color",new En([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(i,new ql({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,i){const r=new zi,n=this.geometry.attributes.color.array;return r.set(e),r.toArray(n,0),r.toArray(n,3),r.set(t),r.toArray(n,6),r.toArray(n,9),r.set(i),r.toArray(n,12),r.toArray(n,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Ap{constructor(){this.type="ShapePath",this.color=new zi,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Vc,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,i,r){return this.currentPath.quadraticCurveTo(e,t,i,r),this}bezierCurveTo(e,t,i,r,n,o){return this.currentPath.bezierCurveTo(e,t,i,r,n,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(e,t){const i=t.length;let r=!1;for(let n=i-1,o=0;o<i;n=o++){let i=t[n],a=t[o],s=a.x-i.x,l=a.y-i.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(i=t[o],s=-s,a=t[n],l=-l),e.y<i.y||e.y>a.y)continue;if(e.y===i.y){if(e.x===i.x)return!0}else{const t=l*(e.x-i.x)-s*(e.y-i.y);if(0===t)return!0;if(t<0)continue;r=!r}}else{if(e.y!==i.y)continue;if(a.x<=e.x&&e.x<=i.x||i.x<=e.x&&e.x<=a.x)return!0}}return r}const i=$h.isClockWise,r=this.subPaths;if(0===r.length)return[];let n,o,a;const s=[];if(1===r.length)return o=r[0],a=new Yc,a.curves=o.curves,s.push(a),s;let l=!i(r[0].getPoints());l=e?!l:l;const c=[],h=[];let d,u,p=[],m=0;h[m]=void 0,p[m]=[];for(let t=0,a=r.length;t<a;t++)o=r[t],d=o.getPoints(),n=i(d),n=e?!n:n,n?(!l&&h[m]&&m++,h[m]={s:new Yc,p:d},h[m].s.curves=o.curves,l&&m++,p[m]=[]):p[m].push({h:o,p:d[0]});if(!h[0])return function(e){const t=[];for(let i=0,r=e.length;i<r;i++){const r=e[i],n=new Yc;n.curves=r.curves,t.push(n)}return t}(r);if(h.length>1){let e=!1,i=0;for(let e=0,t=h.length;e<t;e++)c[e]=[];for(let r=0,n=h.length;r<n;r++){const n=p[r];for(let o=0;o<n.length;o++){const a=n[o];let s=!0;for(let n=0;n<h.length;n++)t(a.p,h[n].p)&&(r!==n&&i++,s?(s=!1,c[n].push(a)):e=!0);s&&c[r].push(a)}}i>0&&!1===e&&(p=c)}for(let e=0,t=h.length;e<t;e++){a=h[e].s,s.push(a),u=p[e];for(let e=0,t=u.length;e<t;e++)a.holes.push(u[e].h)}return s}}const Dp=Rp();function Rp(){const e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),r=new Uint32Array(512),n=new Uint32Array(512);for(let e=0;e<256;++e){const t=e-127;t<-27?(r[e]=0,r[256|e]=32768,n[e]=24,n[256|e]=24):t<-14?(r[e]=1024>>-t-14,r[256|e]=1024>>-t-14|32768,n[e]=-t-1,n[256|e]=-t-1):t<=15?(r[e]=t+15<<10,r[256|e]=t+15<<10|32768,n[e]=13,n[256|e]=13):t<128?(r[e]=31744,r[256|e]=64512,n[e]=24,n[256|e]=24):(r[e]=31744,r[256|e]=64512,n[e]=13,n[256|e]=13)}const o=new Uint32Array(2048),a=new Uint32Array(64),s=new Uint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,i=0;for(;0==(8388608&t);)t<<=1,i-=8388608;t&=-8388609,i+=947912704,o[e]=t|i}for(let e=1024;e<2048;++e)o[e]=939524096+(e-1024<<13);for(let e=1;e<31;++e)a[e]=e<<23;a[31]=1199570944,a[32]=2147483648;for(let e=33;e<63;++e)a[e]=2147483648+(e-32<<23);a[63]=3347054592;for(let e=1;e<64;++e)32!==e&&(s[e]=1024);return{floatView:t,uint32View:i,baseTable:r,shiftTable:n,mantissaTable:o,exponentTable:a,offsetTable:s}}var Ep=Object.freeze({__proto__:null,toHalfFloat:function(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=bi(e,-65504,65504),Dp.floatView[0]=e;const t=Dp.uint32View[0],i=t>>23&511;return Dp.baseTable[i]+((8388607&t)>>Dp.shiftTable[i])},fromHalfFloat:function(e){const t=e>>10;return Dp.uint32View[0]=Dp.mantissaTable[Dp.offsetTable[t]+(1023&e)]+Dp.exponentTable[t],Dp.floatView[0]}});function Lp(){console.error("THREE.ImmediateRenderObject has been removed.")}class Ip extends Ji{constructor(e,t,i){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),super(e,t,i),this.samples=4}}class Bp extends Zi{constructor(e,t,i,r){console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),super(e,t,i,r)}}class Vp extends er{constructor(e,t,i,r){console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),super(e,t,i,r)}}class Op extends lo{constructor(e,t,i,r,n,o){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(e,t,i,r,n,o)}}class Wp extends Wc{constructor(e,t,i,r){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(e,t,i,r)}}class Hp extends Hc{constructor(e,t,i,r){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(e,t,i,r)}}class Fp extends Qc{constructor(e,t,i,r,n,o,a){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(e,t,i,r,n,o,a)}}class Qp extends Fc{constructor(e,t,i,r,n,o,a,s){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(e,t,i,r,n,o,a,s)}}class zp extends Gc{constructor(e,t){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(e,t)}}class Gp extends Ph{constructor(e,t){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(e,t)}}class Np extends _h{constructor(e,t){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(e,t)}}class Up extends Oc{constructor(e,t,i,r){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(e,t,i,r)}}class jp extends Th{constructor(e,t){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(e,t)}}class qp extends Co{constructor(e,t,i,r){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(e,t,i,r)}}class Xp extends zc{constructor(e,t,i,r){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(e,t,i,r)}}class Yp extends Ch{constructor(e,t,i,r,n,o){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(e,t,i,r,n,o)}}class Jp extends Ah{constructor(e,t){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(e,t)}}class Zp extends Dh{constructor(e,t,i,r,n,o,a){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(e,t,i,r,n,o,a)}}class Kp extends Rh{constructor(e,t){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(e,t)}}class em extends Eh{constructor(e,t,i,r,n){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(e,t,i,r,n)}}class tm extends Lh{constructor(e,t,i,r,n,o){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(e,t,i,r,n,o)}}class im extends Ih{constructor(e,t,i,r,n){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(e,t,i,r,n)}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:i}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=i)})),parcelRequire.register("9HO6e",(function(e,t){$parcel$export(e.exports,"UtilCore",(()=>r));var i=parcelRequire("4xklQ");class r{static createCenterLine(e,t){var r=new(0,i.LineBasicMaterial)({color:"#00FFFF",depthTest:!1}),n=new(0,i.BufferGeometry);n.setFromPoints([new(0,i.Vector3)(t.x,t.y,0),new(0,i.Vector3)(e.x,e.y,0)]);var o=new(0,i.Line)(n,r);return o.renderOrder=4,o}static createPointHelper(e,t){let n=new(0,i.Group);var o=new(0,i.CircleGeometry)(80,32),a=new(0,i.MeshBasicMaterial)({color:"#27408B",transparent:!0}),s=new(0,i.CircleGeometry)(90,32),l=new(0,i.MeshBasicMaterial)({color:16777215,depthTest:!1,transparent:!0}),c=new(0,i.Mesh)(o,a),h=new(0,i.Mesh)(s,l);return c.position.set(e.x,e.y,20),h.position.set(e.x,e.y,20),c.renderOrder=8,h.renderOrder=7,n.add(c),n.add(h),t&&n.add(r.createCenterLine(e,t)),n}static smallDistanceByPointOnLine(e,t){if("X"==e[0])return new(0,i.Vector2)(t.x,e[2]);if("Y"==e[0])return new(0,i.Vector2)(e[2],t.y);{let r=-1/e[1],n=t.y-r*t.x,o=(n-e[2])/(e[1]-r),a=r*o+n;return new(0,i.Vector2)(o,a)}}static get3dWallDistance(e,t){let n=r.handleLineData(t.startPoint,t.endPoint),o=new(0,i.Vector3)(e.x,-e.z,e.y),a=r.smallDistanceByPointOnLine(n,o);if(!r.pointIsInLine(a,t.startPoint,t.endPoint))return[];let s=a.clone().distanceTo(o.clone());return a=new(0,i.Vector3)(a.x,e.y,-a.y),[s,a]}static getAllSpecialPoint(e){let t=[],i=e.allWalls;return i=i.concat(e.splitRoomLineGroup.children),i.forEach((e=>{e.startPoint&&t.push([e.startPoint,e.endPoint])})),t}static getCurrentArea(e,t,i){let r,n,o=e.x;return"y"==i&&(o=e.y),o>=0?o<t?(r=0,n=t):(r=parseInt(o/t)*t,n=parseInt(o/t)*t+t):o<0&&(Math.abs(o)<t?(r=-t,n=0):(r=parseInt(o/t)*t-t,n=parseInt(o/t)*t)),[r,n]}static handleOrthogonalPoint(e,t){return Math.abs(e.x-t.x)>=Math.abs(e.y-t.y)?t.y=e.y:t.x=e.x,t}static handleSpecialPoint(e,t,n){if(n.pointHelpGroup.children=[],!n.adsorbentModel)return e;let o="";if("free"!=n.toolType||n.currentDownSelect.length>0){let t=r.getCurrentArea(e,n.gridProportion,"x"),a=r.getCurrentArea(e,n.gridProportion,"y"),s=new(0,i.Vector2)(e.x,e.y),l=[new(0,i.Vector2)(t[0],a[0]),new(0,i.Vector2)(t[1],a[0]),new(0,i.Vector2)(t[1],a[1]),new(0,i.Vector2)(t[0],a[1])],c=[];if(l.forEach((e=>{c.push(s.clone().distanceTo(e.clone()))})),Math.min.apply(null,c)<=50){let e=l[c.indexOf(Math.min.apply(null,c))];o=e}}let a=e.clone();if(0==t.length){""!=o&&(a=o),Math.abs(a.x-n.startPoint.x)<n.config.pointArea-90&&(a.x=n.startPoint.x),Math.abs(a.y-n.startPoint.y)<n.config.pointArea-90&&(a.y=n.startPoint.y);let e=r.createPointHelper(a,n.startPoint);return n.pointHelpGroup.add(e),a}let s={center:[],points:[],isCenter:!1,alreadyPoint:[]};""!=o&&(s.isCenter=!0,s.center[0]=o);let l=!1,c=!1;if(t.forEach((t=>{let h=r.handleLineData(t[0],t[1]),d=r.smallDistanceByPointOnLine(h,e.clone()),u=d.clone().distanceTo(e.clone());if(c)return;let p=r.toVector3(t[0]).distanceTo(e.clone()),m=r.toVector3(t[1]).distanceTo(e.clone()),f="";if(p<240&&(f=t[0].clone()),m<240&&(f=t[1].clone()),""!=f)return a=f.clone(),s.isCenter=!0,s.center[0]=a,void(c=!0);if(""!=o)return;let g=[];if(u<n.config.pointArea){a=d;let e=t[0].clone().distanceTo(a.clone()),r=t[1].clone().distanceTo(a.clone());(e<n.config.pointArea||r<n.config.pointArea)&&(e<n.config.pointArea&&(a=t[0].clone()),r<n.config.pointArea&&(a=t[1].clone())),g[0]=t[0],e>r&&(g[0]=t[1]),Math.abs(e-r)<=80&&(a=new(0,i.Vector2)((t[0].x+t[1].x)/2,(t[0].y+t[1].y)/2),s.isCenter=!0),s.center[0]=a,l=!0,s.alreadyPoint.push(t[0]),s.alreadyPoint.push(t[1])}else{let e=[],o=!0,c=!0;s.alreadyPoint.forEach((e=>{r.isSameVector(t[0],e)&&(o=!1),r.isSameVector(t[1],e)&&(c=!1)})),Math.abs(t[0].x-a.x)<n.config.pointArea-90&&o&&(a.x=t[0].x,e=["x",t[0].x]),Math.abs(t[0].y-a.y)<n.config.pointArea-90&&o&&(a.y=t[0].y,e=["y",t[0].y]),Math.abs(t[1].x-a.x)<n.config.pointArea-90&&c&&(a.x=t[1].x,e=["x",t[1].x]),Math.abs(t[1].y-a.y)<n.config.pointArea-90&&c&&(a.y=t[1].y,e=["y",t[1].y]),(Math.abs(t[0].x-a.x)<.1&&o||Math.abs(t[0].y-a.y)<.1&&o)&&g.push(t[0]),(Math.abs(t[1].x-a.x)<.1&&c||Math.abs(t[1].y-a.y)<.1&&c)&&g.push(t[1]),a=new(0,i.Vector2)(a.x,a.y),l?0!=e.length&&("x"==e[0]&&(s.center[0].x=e[1]),"y"==e[0]&&(s.center[0].y=e[1])):s.center[0]=a}r.isSameVector(a,e)||g.forEach((e=>{let t=!0,i=0;s.points.forEach((n=>{let o=r.handleLineData(s.center[0],n),a=r.handleLineData(s.center[0],e);if(o[0]==a[0]&&o[1]==a[1]&&o[2]==a[2]){let r=s.center[0].clone().distanceTo(n.clone());s.center[0].clone().distanceTo(e.clone())<r&&(s.points[i]=e),t=!1}i++})),t&&s.points.push(e)}))})),"free"!=n.toolType)if(s.isCenter){let e=r.createPointHelper(s.center[0],"");n.pointHelpGroup.add(e)}else s.points.forEach((e=>{let t=r.createPointHelper(s.center[0],e);n.pointHelpGroup.add(t)}));return a}static handleLineData(e,t){let i="",r="",n="";return Math.abs(e.x-t.x)<1?(i="Y",n=e.x):Math.abs(e.y-t.y)<1?(i="X",n=e.y):(i="XY",r=(t.y-e.y)/(t.x-e.x),n=t.y-r*t.x),[i,r,n]}static lineIsIntersection(e,t){if("X"==e[0]){if("X"==t[0])return!1;if("Y"==t[0])return new(0,i.Vector2)(t[2],e[2]);{let r=(e[2]-t[2])/t[1];return new(0,i.Vector2)(r,e[2])}}if("Y"==e[0]){if("X"==t[0])return new(0,i.Vector2)(e[2],t[2]);if("Y"==t[0])return!1;{let r=t[1]*e[2]+t[2];return new(0,i.Vector2)(e[2],r)}}if("X"==t[0])return new(0,i.Vector2)((t[2]-e[2])/e[1],t[2]);if("Y"==t[0])return new(0,i.Vector2)(t[2],t[2]*e[1]+e[2]);{if(Math.abs(e[1]-t[1])<.01)return!1;let r=(t[2]-e[2])/(e[1]-t[1]),n=e[1]*r+e[2];return new(0,i.Vector2)(r,n)}}static pointInLine(e,t){let i=!1;if("X"==t[0])i=Math.abs(e.y-t[2])<.1;else if("Y"==t[0])i=Math.abs(e.x-t[2])<.1;else{let r=t[1]*e.x+t[2];i=Math.abs(e.y-r)<.1}return i}static pointIsInLine(e,t,i,r=1){let n=1*Math.min(t.x,i.x).toFixed(2),o=1*Math.min(t.y,i.y).toFixed(2),a=1*Math.max(t.x,i.x).toFixed(2),s=1*Math.max(t.y,i.y).toFixed(2),l=1*e.x.toFixed(2)>=n-r,c=1*e.x.toFixed(2)<=a+r,h=1*e.y.toFixed(2)>=o-r,d=1*e.y.toFixed(2)<=s+r;return l&&c&&h&&d}static getLinkRealWall(e,t,i){let n=i.clone().sub(t).angle(),o="",a="",s="",l="";return e.forEach((e=>{if(r.checkSameWallByPoint(t,i,e.startPoint,e.endPoint))return;let c=r.getMeshOtherPoint(e,t),h=c.clone().sub(t).angle(),d=r.getClockWise(i,t,c),u=Math.abs(n-h);d<0?(""==o||u<a)&&(a=u,o=e):(""==s||u<l)&&(l=u,s=e)})),o||s?o&&!s?[o]:!o&&s?[s]:o&&s?[o,s]:void 0:[]}static getRealWallByIntersection(e,t,n,o,a){let s=e.endPoint.clone().sub(e.startPoint.clone());"end"==a&&(s=e.startPoint.clone().sub(e.endPoint.clone()));let l=new(0,i.Vector3)(s.x,s.y,0),c=[],h=[],d=r.getMeshOtherPoint(e,o),u=r.getClockWise(d,o,t),p=(r.pointMoveDir(t,e.startPoint,e.endPoint),r.handleLineData(e.startPoint,e.endPoint));return n.forEach((e=>{let t=r.getMeshOtherPoint(e,o);r.getClockWise(d,o,t)*u<0||r.pointInLine(t,p)||h.push(e)})),0==h.length?(n.forEach((e=>{let t=r.getMeshOtherPoint(e,o).clone().sub(o.clone()),n=new(0,i.Vector3)(t.x,t.y,0),a=l.angleTo(n);c.push(a)})),n[c.indexOf(Math.min.apply(null,c))]):(h.forEach((e=>{let t=r.getMeshOtherPoint(e,o).clone().sub(o.clone()),n=new(0,i.Vector3)(t.x,t.y,0),a=l.angleTo(n);c.push(a)})),h[c.indexOf(Math.min.apply(null,c))])}static getRealWallByPosition(e,t,i){let n="";return i.forEach((i=>{let o=r.isSameVector(e,i.startPoint)||r.isSameVector(e,i.endPoint),a=r.isSameVector(t,i.startPoint)||r.isSameVector(t,i.endPoint);o&&a&&(n=i)})),n}static toVector3(e){return new(0,i.Vector3)(e.x,e.y,0)}static toVector2(e){return new(0,i.Vector2)(e.x,e.y)}static getMeshOtherPoint(e,t){let i=e.startPoint;return Math.abs(t.x-e.startPoint.x)<20&&Math.abs(t.y-e.startPoint.y)<20&&(i=e.endPoint),i}static pointMoveDir(e,t,i){let n=r.handleLineData(t,i),o="";if("X"==n[0])o=e.y>=n[2]?"Y":"-Y";else if("Y"==n[0])o=e.x>=n[2]?"X":"-X";else{let t=n[1]*e.x+n[2];o=e.y>=t?"Y":"-Y"}return o}static getDistanceLine(e,t){let i=0;return i="X"==e[0]||"Y"==e[0]?Math.abs(e[2]-t[2]):Math.abs(e[2]-t[2])/Math.sqrt(e[1]*e[1]+1),i}static checkHaveSameVertex(e,t){let i=e.startPoint,n=e.endPoint,o=t.startPoint,a=t.endPoint,s=r.isSameVector(i,o)||r.isSameVector(i,a),l=r.isSameVector(n,o)||r.isSameVector(n,a);return s||l}static getSamePointTwoWall(e,t){let i=t.startPoint,n=t.endPoint,o=e.startPoint,a=e.endPoint,s=r.isSameVector(i,o),l=r.isSameVector(i,a),c=r.isSameVector(n,o),h=r.isSameVector(n,a);return!!(s||l||c||h)&&(s||l?i:c||h?n:void 0)}static getSamePointWall(e,t){let i=[];return t.forEach((t=>{e.wallID!=t.wallID&&t.startPoint&&r.checkHaveSameVertex(e,t)&&i.push(t)})),i}static checkSameWall(e,t){let i=e.startPoint,n=e.endPoint,o=t.startPoint,a=t.endPoint,s=r.isSameVector(i,o)||r.isSameVector(i,a),l=r.isSameVector(n,o)||r.isSameVector(n,a);return s&&l}static checkSameWallByPoint(e,t,i,n){let o=r.isSameVector(e,i)||r.isSameVector(e,n),a=r.isSameVector(t,i)||r.isSameVector(t,n);return o&&a}static wallIsInLine(e,t){let i=r.getSamePointTwoWall(e,t);if(!i)return!1;let n=r.getMeshOtherPoint(e,i),o=r.getMeshOtherPoint(t,i);return r.checkWallContainPoint(i.x,i.y,n.x,n.y,o.x,o.y)}static checkContainWall(e,t,i,n){let o=r.handleLineData(e,t),a=r.handleLineData(i,n);if(o[0]==a[0]&&Math.abs(o[1]-a[1])<.1&&Math.abs(o[2]-a[2])<.1){let o=r.isSameVector(e,i),a=r.isSameVector(e,n),s=r.isSameVector(t,i),l=r.isSameVector(t,n);if((o||s)&&r.pointIsInLine(n,e,t))return!0;if((a||l)&&r.pointIsInLine(i,e,t))return!0}return!1}static getSamePositionWall(e,t){let i=[];return t.forEach((t=>{r.checkSameWall(e,t)&&i.push(t)})),i}static havePointWall(e,t,i=""){let n=[];return t.forEach((t=>{if(""!=i&&t.uuid==i.uuid)return;let o=r.isSameVector(e,t.startPoint),a=r.isSameVector(e,t.endPoint);(o||a)&&n.push(t)})),n}static getWallMoveRule(e,t,i){let n=r.havePointWall(e.startPoint,t,e),o=r.havePointWall(e.endPoint,t,e),a=r.getRealWallByIntersection(e,i.currentPoint.clone(),n,e.startPoint,"start"),s=r.getRealWallByIntersection(e,i.currentPoint.clone(),o,e.endPoint,"end"),l="",c="";a&&(l=r.getSamePointTwoWall(e,a)),s&&(c=r.getSamePointTwoWall(e,s));let h=e.clone();return h.startPoint=e.startPoint.clone(),h.endPoint=e.endPoint.clone(),[a,s,n,o,l,c,h]}static checkWallContainPoint(e,t,n,o,a,s){if(e<Math.min(n,a)||e>Math.max(n,a))return!1;if(t<Math.min(o,s)||t>Math.max(o,s))return!1;let l=new(0,i.Vector3)(e,t,0),c=new(0,i.Vector3)(n,o,0),h=new(0,i.Vector3)(a,s,0),d=c.distanceTo(h),u=c.distanceTo(l),p=h.distanceTo(l);return!r.isSameVector(l,c)&&!r.isSameVector(l,h)&&Math.abs(d-(u+p))<.01}static checkWallContainPointNew(e,t,i){let n=r.handleLineData(e,t),o=r.pointInLine(i,n),a=r.pointIsInLine(i,e,t);return o&&a}static getAllIntersectionWall(e,t,i,n){let o=e.startPoint,a=e.endPoint,s=n.currentPoint,l=r.handleLineData(o,a),c=[[],[],"","",!1,!1],h="",d="",u=[],p=[];t.forEach((e=>{let t=e.startPoint,n=e.endPoint;if(r.isSameVector(t,o)&&r.isSameVector(n,a))return;let s=r.handleLineData(t,n),c=r.lineIsIntersection(l,s);if(!c){let e=r.isSameVector(o,t)||o.clone().distanceTo(t.clone())<i,s=r.isSameVector(o,n)||o.clone().distanceTo(n.clone())<i,l=r.isSameVector(a,t)||a.clone().distanceTo(t.clone())<i,c=r.isSameVector(a,n)||a.clone().distanceTo(n.clone())<i;if(!(e||s||l||c))return;return e&&(h=t),s&&(h=n),l&&(d=t),void(c&&(d=n))}let m=r.isSameVector(c,o),f=r.isSameVector(c,a);if(!m&&!f)return;m&&u.push(e),f&&p.push(e);let g=c.clone().distanceTo(t.clone()),x=c.clone().distanceTo(n.clone());if(g<i+2||x<i+2){let t=e.startPoint;x<g&&(t=e.endPoint);let r=[e.startPoint,e.endPoint],n=[g,x],s=Math.max.apply(null,n);s<i+10&&(t=r[n.indexOf(s)]);let l=t.clone().distanceTo(o.clone()),c=t.clone().distanceTo(a.clone());l<c&&(h=t),l>c&&(d=t)}}));let m=r.moveLineToPoint(s,l.slice(0));if(u.length>=1){let t="";if(u.forEach((i=>{r.pointInLine(e.startPoint,r.handleLineData(i.startPoint,i.endPoint))&&r.pointIsInLine(e.startPoint,i.startPoint,i.endPoint)&&(t=i)})),""!=t){let i=t.startPoint,o=t.endPoint,a=r.handleLineData(i,o),s=r.lineIsIntersection(a,m);if(s&&!r.pointIsInLine(s,i,o)){let a=s.clone().distanceTo(i.clone())<s.clone().distanceTo(o.clone())?i:o;if(""!=h&&r.isSameVector(a,h))h=a;else{h=a;let i=t.parent;i&&r.checkHaveSameVertex(t,e)&&(i.remove(t),n.removeHelperByWall(t),n.allWalls.indexOf(t)>=0&&n.allWalls.splice(n.allWalls.indexOf(t),1))}}}}if(p.length>=1){let t="";if(p.forEach((i=>{r.pointInLine(e.endPoint,r.handleLineData(i.startPoint,i.endPoint))&&r.pointIsInLine(e.endPoint,i.startPoint,i.endPoint)&&(t=i)})),""!=t){let i=t.startPoint,o=t.endPoint,a=r.handleLineData(i,o),s=r.lineIsIntersection(a,m);if(s&&!r.pointIsInLine(s,i,o)){let a=s.clone().distanceTo(i.clone())<s.clone().distanceTo(o.clone())?i:o;if(""!=d&&r.isSameVector(a,d))d=a;else{d=a;let i=t.parent;i&&r.checkHaveSameVertex(t,e)&&(i.remove(t),n.removeHelperByWall(t),n.allWalls.indexOf(t)>=0&&n.allWalls.splice(n.allWalls.indexOf(t),1))}}}}return t.forEach((e=>{let t=e.startPoint,i=e.endPoint;if(o!=t||a!=i){if(h){let n=r.isSameVector(h,t),o=r.isSameVector(h,i);(n||o)&&c[0].push(e)}if(d){let n=r.isSameVector(d,t),o=r.isSameVector(d,i);(n||o)&&c[1].push(e)}if(!h||!d){let n=r.handleLineData(t,i),s=r.lineIsIntersection(l,n);if(s){if(r.pointIsInLine(s,t,i)){let t=r.isSameVector(s,o),i=r.isSameVector(s,a);t&&!h&&(c[0].push(e),c[2]=s),i&&!d&&(c[1].push(e),c[3]=s)}}}}})),h&&(c[2]=h,c[4]=!0),d&&(c[3]=d,c[5]=!0),c}static isSameVector(e,t){return Math.abs(e.x-t.x)<1&&Math.abs(e.y-t.y)<1}static moveLineToPoint(e,t){return"X"==t[0]?t[2]=e.y:"Y"==t[0]?t[2]=e.x:t[2]=e.y-t[1]*e.x,t}static getModelVertex(e){const t=(new(0,i.Box3)).setFromObject(e);let r=1*(t.max.x-t.min.x).toFixed(2)/2,n=1*(t.max.y-t.min.y).toFixed(2)/2;e.width&&(r=1*e.width/2,n=1*e.height/2);let o=[new(0,i.Vector3)(-r,n,0),new(0,i.Vector3)(-r,-n,0),new(0,i.Vector3)(r,-n,0),new(0,i.Vector3)(r,n,0),new(0,i.Vector3)(-r,0,0),new(0,i.Vector3)(0,-n,0),new(0,i.Vector3)(0,n,0),new(0,i.Vector3)(r,0,0)];e.updateWorldMatrix(!0,!1);for(let t=0;t<o.length;t++){let i=e.localToWorld(o[t]);o[t]=i}return o}static updateLineDimensionsLine(e){if(!e.config.settingJson.dimension)return;let t=e.allWalls.slice(0),n=[],o=[];if(t.forEach((t=>{let a=t.geometry.attributes.position.array,s=new(0,i.Vector2)(a[0],a[1]),l=new(0,i.Vector2)(a[9],a[10]),c=t.startPoint,h=t.endPoint,d=Math.round(c.clone().distanceTo(h.clone())),u=Math.round(s.clone().distanceTo(l.clone()));if(n.indexOf(t.startPoint.x)<0&&n.push(t.startPoint.x),n.indexOf(t.endPoint.x)<0&&n.push(t.endPoint.x),o.indexOf(t.startPoint.y)<0&&o.push(t.startPoint.y),o.indexOf(t.endPoint.y)<0&&o.push(t.endPoint.y),t.isArc)e.removeHelperByWall(t,!1);else if(0==t.roomCenter)if(Math.abs(d-u)>.1)e.removeHelperByWall(t,!1),e.addLineWallHelper(c,h,!1,s,l);else{let i=e.getWallHelperByWall(t);i&&Math.abs(i.lineLength-d)>.1&&(e.removeHelperByWall(t,!1),e.addLineWallHelper(c,h)),i||e.addLineWallHelper(c,h)}else{let n=new(0,i.Vector2)(a[0],a[1]),o=new(0,i.Vector2)(a[6],a[7]),s=new(0,i.Vector2)(a[9],a[10]),l=new(0,i.Vector2)(a[15],a[16]);t.roomCenter.forEach((a=>{let d=new(0,i.Vector2)(a[0],a[1]),u=r.handleLineData(n,s),p=r.smallDistanceByPointOnLine(u,d.clone()),m=r.handleLineData(o,l),f=r.smallDistanceByPointOnLine(m,d.clone()),g=p.clone().distanceTo(d.clone()),x=f.clone().distanceTo(d.clone()),b=n,y=s,w=160;g>x&&(b=o,y=l,w=-160),e.removeHelperByWall(t,!1),e.addLineWallHelper(c,h,!1,b,y,w)}))}})),0==n.length||0==e.floorGroup2d.children.length)return;let a=Math.min.apply(null,n),s=Math.max.apply(null,n),l=Math.min.apply(null,o),c=Math.max.apply(null,o),h=1500,d=e.helperGroup.children.slice(0);d.forEach((t=>{"outerLine"==t.useType&&(e.removeInputByClassName(e.uiPanelBox.dom,"showWallLength"+t.uuid),e.helperGroup.remove(t))})),d=[e.addLineWallHelper(new(0,i.Vector2)(a-h,c),new(0,i.Vector2)(a-h,l),!1),e.addLineWallHelper(new(0,i.Vector2)(a,l-h),new(0,i.Vector2)(s,l-h),!1),e.addLineWallHelper(new(0,i.Vector2)(s+h,l),new(0,i.Vector2)(s+h,c),!1),e.addLineWallHelper(new(0,i.Vector2)(a,c+750),new(0,i.Vector2)(s,c+750),!1)],d.forEach((e=>{e.useType="outerLine"})),e.camera.isOrthographicCamera&&e.autoShowHidden(e.camera.zoom)}static getLineData(e,t,r){let n,o;e.x==t.x?(n="X",o=e.x):e.y==t.y?(n="Y",o=e.y):(n=(e.y-t.y)/(e.x-t.x),o=e.y-n*e.x);let a=new(0,i.Vector2)(t.x,t.y).sub(new(0,i.Vector2)(e.x,e.y));if(0!=Math.abs(Number(Math.cos(a.angle())).toFixed(11))&&1!=Math.abs(Number(Math.cos(a.angle())).toFixed(11))){o-=r/Number(Math.cos(a.angle())).toFixed(11)}else 180*a.angle()/Math.PI==0&&(o-=r),180*a.angle()/Math.PI==90&&(o+=r),180*a.angle()/Math.PI==180&&(o+=r),180*a.angle()/Math.PI==270&&(o-=r);return[n,o]}static getCursorByWall(e){let t=e.startPoint,r=e.endPoint.clone().sub(t.clone()),n=new(0,i.Vector2)(r.x,r.y).angle();n=180/Math.PI*n;let o=30;return n>=60&&n<=120||n<=300&&n>=240?"w-resize":n>=0&&n<=o||n<=180&&n>=150||n<=360&&n>=330?"s-resize":n>o&&n<60||n>210&&n<240?"nw-resize":n>120&&n<150||n>300&&n<330?"ne-resize":void 0}static getCursorByScaleTool(e,t){let r=t.clone().sub(e.clone()),n=new(0,i.Vector2)(r.x,r.y).angle();n=180/Math.PI*n;let o=30;return n>=60&&n<=120||n<=300&&n>=240?"s-resize":n>=0&&n<=o||n<=180&&n>=150||n<=360&&n>=330?"w-resize":n>o&&n<60||n>210&&n<240?"ne-resize":n>120&&n<150||n>300&&n<330?"nw-resize":void 0}static getClockWise(e,t,i){let r=e.x,n=e.y,o=t.x,a=t.y,s=i.x;return(o-r)*(i.y-a)-(a-n)*(s-o)}static getMinEdge(e){let t=e.geometry.attributes.position.array,n=r.handleLineData(e.startPoint,e.endPoint),o=r.smallDistanceByPointOnLine(n,new(0,i.Vector2)(t[0],t[1])),a=r.smallDistanceByPointOnLine(n,new(0,i.Vector2)(t[6],t[7])),s=r.smallDistanceByPointOnLine(n,new(0,i.Vector2)(t[9],t[10])),l=r.smallDistanceByPointOnLine(n,new(0,i.Vector2)(t[15],t[16])),c=o.clone().distanceTo(e.endPoint),h=a.clone().distanceTo(e.endPoint),d=s.clone().distanceTo(e.startPoint)<l.clone().distanceTo(e.startPoint)?s:l;return(c<h?o:a).distanceTo(d)}static getCenterNormalLine(e,t){let i=t;return"X"==t[0]?(i[0]="Y",i[2]=e.x):"Y"==t[0]?(i[0]="X",i[2]=e.y):(i[1]=-1/i[1],i=r.moveLineToPoint(e,i)),i}static getArcCenter(e,t,i){let n=r.handleLineData(e,t),o=r.handleLineData(e,i),a=r.getPointsCenter(e,t),s=r.getPointsCenter(e,i),l=r.getCenterNormalLine(a,n),c=r.getCenterNormalLine(s,o),h=r.lineIsIntersection(l,c);if(!h)return[];let d=h.clone().distanceTo(e.clone());return h?[h,d]:void 0}static getPointsCenter(e,t){return new(0,i.Vector3)((e.x+t.x)/2,(e.y+t.y)/2,0)}static getPointInArc(e,t,r,n,o){let a=new(0,i.Vector3)(e.x,e.y,0),s=new(0,i.Vector3)(t.x,t.y,0),l=a.angleTo(s)/2,c="";return c=r>0?e.clone().rotateAround(n,l):e.clone().rotateAround(n,-l),c}static extendParamWall(e,t){t.wallID=e.wallID,t.style=e.style,t.height=e.height,t.thickness=e.thickness,t.isArc=e.isArc}static getAllWallLine(e){let t=Array.from(e.geometry.attributes.position.array),i=[];for(let e=0;e<t.length/9-1;e++)i.push([t[9*e],t[9*e+1]],[t[9*(e+1)],t[9*(e+1)+1]],[t[3*(3*e+2)],t[3*(3*e+2)+1]],[t[3*(3*(e+1)+2)],t[3*(3*(e+1)+2)+1]]);return i}static getArrayIndex(e,t,i){let r=[];for(let n=0;n<e.length;n++)t[0]==e[n][0]&&t[1]==e[n][1]&&(0==n?r.push(e[n]):r.push(e[n-1])),i[0]==e[n][0]&&i[1]==e[n][1]&&(n==e.length-1?r.push(e[n]):r.push(e[n+1]));return r}static getNewPoint(e,t="start"){let n=e.geometry.attributes.position.array,o=r.handleLineData(e.startPoint,e.endPoint),a=new(0,i.Vector2)(n[0],n[1]),s=new(0,i.Vector2)(n[6],n[7]),l=e.endPoint.clone();"end"==t&&(a=new(0,i.Vector2)(n[9],n[10]),s=new(0,i.Vector2)(n[15],n[16]),l=e.startPoint.clone());let c=r.smallDistanceByPointOnLine(o,a),h=r.smallDistanceByPointOnLine(o,s);return c.clone().distanceTo(l)<=h.clone().distanceTo(l)?c:h}static sortPoint(e,t,i){let n=[],o=[[t.x,t.y]];return e.forEach((e=>{let i=t.clone().distanceTo(r.toVector3(e));n.push(i)})),n.slice(0).sort((function(e,t){return e-t})).forEach((t=>{let i=e[n.indexOf(t)];o.push([i.x,i.y])})),o.push([i.x,i.y]),o}static checkHasSameVec(e,t){let i=!1;return e.forEach((e=>{r.isSameVector(e,t)&&(i=!0)})),i}static getSplitLineByUuid(e,t){let i="";return e.forEach((e=>{e.uuid==t&&(i=e)})),i}static getWallLen(e){let t=e.geometry.attributes.position.array,r=new(0,i.Vector2)(t[6],t[7]),n=new(0,i.Vector2)(t[15],t[16]),o=new(0,i.Vector2)(t[0],t[1]),a=new(0,i.Vector2)(t[9],t[10]),s=new(0,i.Vector2)(t[3],t[4]),l=new(0,i.Vector2)(t[12],t[13]),c=s.distanceTo(l),h=o.distanceTo(a);return[r.distanceTo(n),c,h]}static calculateAngleWithHorizontalPlane(e){let t=e.x,i=e.z,r=Math.sqrt(e.x**2+e.y**2+e.z**2),n=Math.sqrt(t**2+i**2),o=(e.x*t+0*e.y+e.z*i)/(r*n);return isNaN(o)?NaN:Math.acos(o)}}})),parcelRequire.register("ia4Lh",(function(e,t){$parcel$export(e.exports,"Line2",(()=>o));var i=parcelRequire("3KKM9"),r=parcelRequire("g4HAh"),n=parcelRequire("7WCxl");class o extends i.LineSegments2{constructor(e=new(0,r.LineGeometry),t=new(0,n.LineMaterial)({color:16777215*Math.random()})){super(e,t),this.isLine2=!0,this.type="Line2"}}})),parcelRequire.register("3KKM9",(function(e,t){$parcel$export(e.exports,"LineSegments2",(()=>$));var i=parcelRequire("4xklQ"),r=parcelRequire("bnZk5"),n=parcelRequire("7WCxl");const o=new(0,i.Vector3),a=new(0,i.Vector3),s=new(0,i.Vector4),l=new(0,i.Vector4),c=new(0,i.Vector4),h=new(0,i.Vector3),d=new(0,i.Matrix4),u=new(0,i.Line3),p=new(0,i.Vector3),m=new(0,i.Box3),f=new(0,i.Sphere),g=new(0,i.Vector4);let x,b,y,w;function v(e,t,i){return g.set(0,0,-t,1).applyMatrix4(e.projectionMatrix),g.multiplyScalar(1/g.w),g.x=w/i.width,g.y=w/i.height,g.applyMatrix4(e.projectionMatrixInverse),g.multiplyScalar(1/g.w),Math.abs(Math.max(g.x,g.y))}class $ extends i.Mesh{constructor(e=new(0,r.LineSegmentsGeometry),t=new(0,n.LineMaterial)({color:16777215*Math.random()})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,r=e.attributes.instanceEnd,n=new Float32Array(2*t.count);for(let e=0,i=0,s=t.count;e<s;e++,i+=2)o.fromBufferAttribute(t,e),a.fromBufferAttribute(r,e),n[i]=0===i?0:n[i-1],n[i+1]=n[i]+o.distanceTo(a);const s=new(0,i.InstancedInterleavedBuffer)(n,2,1);return e.setAttribute("instanceDistanceStart",new(0,i.InterleavedBufferAttribute)(s,1,0)),e.setAttribute("instanceDistanceEnd",new(0,i.InterleavedBufferAttribute)(s,1,1)),this}raycast(e,t){const r=this.material.worldUnits,n=e.camera;null!==n||r||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const o=void 0!==e.params.Line2&&e.params.Line2.threshold||0;x=e.ray;const a=this.matrixWorld,g=this.geometry,$=this.material;let M,S;if(w=$.linewidth+o,b=g.attributes.instanceStart,y=g.attributes.instanceEnd,null===g.boundingSphere&&g.computeBoundingSphere(),f.copy(g.boundingSphere).applyMatrix4(a),r)M=.5*w;else{M=v(n,Math.max(n.near,f.distanceToPoint(x.origin)),$.resolution)}if(f.radius+=M,!1!==x.intersectsSphere(f)){if(null===g.boundingBox&&g.computeBoundingBox(),m.copy(g.boundingBox).applyMatrix4(a),r)S=.5*w;else{S=v(n,Math.max(n.near,m.distanceToPoint(x.origin)),$.resolution)}m.expandByScalar(S),!1!==x.intersectsBox(m)&&(r?function(e,t){for(let r=0,n=b.count;r<n;r++){u.start.fromBufferAttribute(b,r),u.end.fromBufferAttribute(y,r);const n=new(0,i.Vector3),o=new(0,i.Vector3);x.distanceSqToSegment(u.start,u.end,o,n),o.distanceTo(n)<.5*w&&t.push({point:o,pointOnLine:n,distance:x.origin.distanceTo(o),object:e,face:null,faceIndex:r,uv:null,uv2:null})}}(this,t):function(e,t,r){const n=t.projectionMatrix,o=e.material.resolution,a=e.matrixWorld,m=e.geometry,f=m.attributes.instanceStart,g=m.attributes.instanceEnd,b=-t.near;x.at(1,c),c.w=1,c.applyMatrix4(t.matrixWorldInverse),c.applyMatrix4(n),c.multiplyScalar(1/c.w),c.x*=o.x/2,c.y*=o.y/2,c.z=0,h.copy(c),d.multiplyMatrices(t.matrixWorldInverse,a);for(let t=0,c=f.count;t<c;t++){if(s.fromBufferAttribute(f,t),l.fromBufferAttribute(g,t),s.w=1,l.w=1,s.applyMatrix4(d),l.applyMatrix4(d),s.z>b&&l.z>b)continue;if(s.z>b){const e=s.z-l.z,t=(s.z-b)/e;s.lerp(l,t)}else if(l.z>b){const e=l.z-s.z,t=(l.z-b)/e;l.lerp(s,t)}s.applyMatrix4(n),l.applyMatrix4(n),s.multiplyScalar(1/s.w),l.multiplyScalar(1/l.w),s.x*=o.x/2,s.y*=o.y/2,l.x*=o.x/2,l.y*=o.y/2,u.start.copy(s),u.start.z=0,u.end.copy(l),u.end.z=0;const c=u.closestPointToPointParameter(h,!0);u.at(c,p);const m=i.MathUtils.lerp(s.z,l.z,c),y=m>=-1&&m<=1,v=h.distanceTo(p)<.5*w;if(y&&v){u.start.fromBufferAttribute(f,t),u.end.fromBufferAttribute(g,t),u.start.applyMatrix4(a),u.end.applyMatrix4(a);const n=new(0,i.Vector3),o=new(0,i.Vector3);x.distanceSqToSegment(u.start,u.end,o,n),r.push({point:o,pointOnLine:n,distance:x.origin.distanceTo(o),object:e,face:null,faceIndex:t,uv:null,uv2:null})}}}(this,n,t))}}}})),parcelRequire.register("bnZk5",(function(e,t){$parcel$export(e.exports,"LineSegmentsGeometry",(()=>o));var i=parcelRequire("4xklQ");const r=new(0,i.Box3),n=new(0,i.Vector3);class o extends i.InstancedBufferGeometry{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new(0,i.Float32BufferAttribute)([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new(0,i.Float32BufferAttribute)([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const t=this.attributes.instanceStart,i=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),i.applyMatrix4(e),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const r=new(0,i.InstancedInterleavedBuffer)(t,6,1);return this.setAttribute("instanceStart",new(0,i.InterleavedBufferAttribute)(r,3,0)),this.setAttribute("instanceEnd",new(0,i.InterleavedBufferAttribute)(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const r=new(0,i.InstancedInterleavedBuffer)(t,6,1);return this.setAttribute("instanceColorStart",new(0,i.InterleavedBufferAttribute)(r,3,0)),this.setAttribute("instanceColorEnd",new(0,i.InterleavedBufferAttribute)(r,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new(0,i.WireframeGeometry)(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new(0,i.Box3));const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),r.setFromBufferAttribute(t),this.boundingBox.union(r))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new(0,i.Sphere)),null===this.boundingBox&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){const i=this.boundingSphere.center;this.boundingBox.getCenter(i);let r=0;for(let o=0,a=e.count;o<a;o++)n.fromBufferAttribute(e,o),r=Math.max(r,i.distanceToSquared(n)),n.fromBufferAttribute(t,o),r=Math.max(r,i.distanceToSquared(n));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}})),parcelRequire.register("7WCxl",(function(e,t){$parcel$export(e.exports,"LineMaterial",(()=>r));var i=parcelRequire("4xklQ");i.UniformsLib.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new(0,i.Vector2)(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},i.ShaderLib.line={uniforms:i.UniformsUtils.merge([i.UniformsLib.common,i.UniformsLib.fog,i.UniformsLib.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\t#ifdef WORLD_UNITS\n\n\t\t\tvarying vec4 worldPos;\n\t\t\tvarying vec3 worldStart;\n\t\t\tvarying vec3 worldEnd;\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t#endif\n\n\t\t#else\n\n\t\t\tvarying vec2 vUv;\n\n\t\t#endif\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\t\t\t\tvUv = uv;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\tworldStart = start.xyz;\n\t\t\t\tworldEnd = end.xyz;\n\n\t\t\t#else\n\n\t\t\t\tvUv = uv;\n\n\t\t\t#endif\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec3 ndcStart = clipStart.xyz / clipStart.w;\n\t\t\tvec3 ndcEnd = clipEnd.xyz / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd.xy - ndcStart.xy;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t// get the offset direction as perpendicular to the view vector\n\t\t\t\tvec3 worldDir = normalize( end.xyz - start.xyz );\n\t\t\t\tvec3 offset;\n\t\t\t\tif ( position.y < 0.5 ) {\n\n\t\t\t\t\toffset = normalize( cross( start.xyz, worldDir ) );\n\n\t\t\t\t} else {\n\n\t\t\t\t\toffset = normalize( cross( end.xyz, worldDir ) );\n\n\t\t\t\t}\n\n\t\t\t\t// sign flip\n\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\tfloat forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );\n\n\t\t\t\t// don't extend the line if we're rendering dashes because we\n\t\t\t\t// won't be rendering the endcaps\n\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t// extend the line bounds to encompass  endcaps\n\t\t\t\t\tstart.xyz += - worldDir * linewidth * 0.5;\n\t\t\t\t\tend.xyz += worldDir * linewidth * 0.5;\n\n\t\t\t\t\t// shift the position of the quad so it hugs the forward edge of the line\n\t\t\t\t\toffset.xy -= dir * forwardOffset;\n\t\t\t\t\toffset.z += 0.5;\n\n\t\t\t\t#endif\n\n\t\t\t\t// endcaps\n\t\t\t\tif ( position.y > 1.0 || position.y < 0.0 ) {\n\n\t\t\t\t\toffset.xy += dir * 2.0 * forwardOffset;\n\n\t\t\t\t}\n\n\t\t\t\t// adjust for linewidth\n\t\t\t\toffset *= linewidth * 0.5;\n\n\t\t\t\t// set the world position\n\t\t\t\tworldPos = ( position.y < 0.5 ) ? start : end;\n\t\t\t\tworldPos.xyz += offset;\n\n\t\t\t\t// project the worldpos\n\t\t\t\tvec4 clip = projectionMatrix * worldPos;\n\n\t\t\t\t// shift the depth of the projected points so the line\n\t\t\t\t// segments overlap neatly\n\t\t\t\tvec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;\n\t\t\t\tclip.z = clipPose.z * clip.w;\n\n\t\t\t#else\n\n\t\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\t\t\t\t// undo aspect ratio adjustment\n\t\t\t\tdir.x /= aspect;\n\t\t\t\toffset.x /= aspect;\n\n\t\t\t\t// sign flip\n\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t// endcaps\n\t\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\t\toffset += - dir;\n\n\t\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\t\toffset += dir;\n\n\t\t\t\t}\n\n\t\t\t\t// adjust for linewidth\n\t\t\t\toffset *= linewidth;\n\n\t\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\t\toffset /= resolution.y;\n\n\t\t\t\t// select end\n\t\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t\t// back to clip space\n\t\t\t\toffset *= clip.w;\n\n\t\t\t\tclip.xy += offset;\n\n\t\t\t#endif\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\t\tuniform float linewidth;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashOffset;\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#ifdef WORLD_UNITS\n\n\t\t\tvarying vec4 worldPos;\n\t\t\tvarying vec3 worldStart;\n\t\t\tvarying vec3 worldEnd;\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t#endif\n\n\t\t#else\n\n\t\t\tvarying vec2 vUv;\n\n\t\t#endif\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {\n\n\t\t\tfloat mua;\n\t\t\tfloat mub;\n\n\t\t\tvec3 p13 = p1 - p3;\n\t\t\tvec3 p43 = p4 - p3;\n\n\t\t\tvec3 p21 = p2 - p1;\n\n\t\t\tfloat d1343 = dot( p13, p43 );\n\t\t\tfloat d4321 = dot( p43, p21 );\n\t\t\tfloat d1321 = dot( p13, p21 );\n\t\t\tfloat d4343 = dot( p43, p43 );\n\t\t\tfloat d2121 = dot( p21, p21 );\n\n\t\t\tfloat denom = d2121 * d4343 - d4321 * d4321;\n\n\t\t\tfloat numer = d1343 * d4321 - d1321 * d4343;\n\n\t\t\tmua = numer / denom;\n\t\t\tmua = clamp( mua, 0.0, 1.0 );\n\t\t\tmub = ( d1343 + d4321 * ( mua ) ) / d4343;\n\t\t\tmub = clamp( mub, 0.0, 1.0 );\n\n\t\t\treturn vec2( mua, mub );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tfloat alpha = opacity;\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t// Find the closest points on the view ray and the line segment\n\t\t\t\tvec3 rayEnd = normalize( worldPos.xyz ) * 1e5;\n\t\t\t\tvec3 lineDir = worldEnd - worldStart;\n\t\t\t\tvec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );\n\n\t\t\t\tvec3 p1 = worldStart + lineDir * params.x;\n\t\t\t\tvec3 p2 = rayEnd * params.y;\n\t\t\t\tvec3 delta = p1 - p2;\n\t\t\t\tfloat len = length( delta );\n\t\t\t\tfloat norm = len / linewidth;\n\n\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\tfloat dnorm = fwidth( norm );\n\t\t\t\t\t\talpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tif ( norm > 0.5 ) {\n\n\t\t\t\t\t\t\tdiscard;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#endif\n\n\t\t\t#else\n\n\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t// artifacts appear on some hardware if a derivative is taken within a conditional\n\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\tfloat len2 = a * a + b * b;\n\t\t\t\t\tfloat dlen = fwidth( len2 );\n\n\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\talpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );\n\n\t\t\t\t\t}\n\n\t\t\t\t#else\n\n\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t\t\t}\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, alpha );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, alpha );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t}\n\t\t"};class r extends i.ShaderMaterial{constructor(e){super({type:"LineMaterial",uniforms:i.UniformsUtils.clone(i.ShaderLib.line.uniforms),vertexShader:i.ShaderLib.line.vertexShader,fragmentShader:i.ShaderLib.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(e){!0===e?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(e){Boolean(e)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),!0===e?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(e){Boolean(e)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),!0===e?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}})),parcelRequire.register("g4HAh",(function(e,t){$parcel$export(e.exports,"LineGeometry",(()=>r));var i=parcelRequire("bnZk5");class r extends i.LineSegmentsGeometry{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,i=new Float32Array(2*t);for(let r=0;r<t;r+=3)i[2*r]=e[r],i[2*r+1]=e[r+1],i[2*r+2]=e[r+2],i[2*r+3]=e[r+3],i[2*r+4]=e[r+4],i[2*r+5]=e[r+5];return super.setPositions(i),this}setColors(e){const t=e.length-3,i=new Float32Array(2*t);for(let r=0;r<t;r+=3)i[2*r]=e[r],i[2*r+1]=e[r+1],i[2*r+2]=e[r+2],i[2*r+3]=e[r+3],i[2*r+4]=e[r+4],i[2*r+5]=e[r+5];return super.setColors(i),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}})),parcelRequire.register("6Hryq",(function(e,t){$parcel$export(e.exports,"Brush",(()=>a));var i=parcelRequire("4xklQ"),r=parcelRequire("1DCdP"),n=parcelRequire("cy3as"),o=parcelRequire("14bAY");class a extends i.Mesh{constructor(...e){super(...e),this.isBrush=!0,this._previousMatrix=new(0,i.Matrix4),this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){const{matrix:e,_previousMatrix:t}=this,i=e.elements,r=t.elements;for(let e=0;e<16;e++)if(i[e]!==r[e])return!0;return!1}prepareGeometry(){const e=this.geometry,t=e.attributes;if((0,o.areSharedArrayBuffersSupported)())for(const e in t){const i=t[e];if(i.isInterleavedBufferAttribute)throw new Error("Brush: InterleavedBufferAttributes are not supported.");i.array=(0,o.convertToSharedArrayBuffer)(i.array)}if(e.boundsTree||(e.boundsTree=new(0,r.MeshBVH)(e,{maxLeafTris:3}),e.halfEdges&&e.halfEdges.updateFrom(e)),e.halfEdges||(e.halfEdges=new(0,n.HalfEdgeMap)(e)),!e.groupIndices){const t=e.index.count/3,i=new Uint16Array(t),r=e.groups;for(let e=0,t=r.length;e<t;e++){const{start:t,count:n}=r[e];for(let r=t/3,o=(t+n)/3;r<o;r++)i[r]=e}e.groupIndices=i}}disposeCacheData(){const{geometry:e}=this;e.halfEdges=null,e.boundsTree=null,e.groupIndices=null}}})),parcelRequire.register("1DCdP",(function(e,t){$parcel$export(e.exports,"MeshBVH",(()=>S));var i=parcelRequire("4xklQ"),r=parcelRequire("ckwVR"),n=parcelRequire("IWLEN"),o=parcelRequire("iR33e"),a=parcelRequire("8YY3V"),s=parcelRequire("57zgU"),l=parcelRequire("f8eJn"),c=parcelRequire("fcnhI"),h=parcelRequire("bNX9f");const d=Symbol("skip tree generation"),u=new(0,i.Box3),p=new(0,i.Box3),m=new(0,i.Matrix4),f=new(0,a.OrientedBox),g=new(0,a.OrientedBox),x=new(0,i.Vector3),b=new(0,i.Vector3),y=new(0,i.Vector3),w=new(0,i.Vector3),v=new(0,i.Vector3),$=new(0,i.Box3),M=new(0,l.PrimitivePool)((()=>new(0,s.ExtendedTriangle)));class S{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),S.serialize(arguments[0],{cloneBuffers:void 0===arguments[2]||arguments[2]});t={cloneBuffers:!0,...t};const i=e.geometry,r=e._roots,n=i.getIndex();let o;return o=t.cloneBuffers?{roots:r.map((e=>e.slice())),index:n.array.slice()}:{roots:r,index:n.array},o}static deserialize(e,t,r={}){if("boolean"==typeof r)return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),S.deserialize(arguments[0],arguments[1],{setIndex:void 0===arguments[2]||arguments[2]});r={setIndex:!0,...r};const{index:n,roots:o}=e,a=new S(t,{...r,[d]:!0});if(a._roots=o,r.setIndex){const r=t.getIndex();if(null===r){const r=new(0,i.BufferAttribute)(e.index,1,!1);t.setIndex(r)}else r.array!==n&&(r.array.set(n),r.needsUpdate=!0)}return a}constructor(e,t={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((t=Object.assign({strategy:r.CENTER,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[d]:!1},t)).useSharedArrayBuffer&&"undefined"==typeof SharedArrayBuffer)throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[d]||(this._roots=(0,n.buildPackedTree)(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new(0,i.Box3)))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=this.geometry,i=t.index.array,n=t.attributes.position;let o,a,s,l,c=0;const h=this._roots;for(let e=0,t=h.length;e<t;e++)o=h[e],a=new Uint32Array(o),s=new Uint16Array(o),l=new Float32Array(o),d(0,c),c+=o.byteLength;function d(t,o,c=!1){const h=2*t;if(s[h+15]===r.IS_LEAFNODE_FLAG){const e=a[t+6];let r=1/0,o=1/0,c=1/0,d=-1/0,u=-1/0,p=-1/0;for(let t=3*e,a=3*(e+s[h+14]);t<a;t++){const e=i[t],a=n.getX(e),s=n.getY(e),l=n.getZ(e);a<r&&(r=a),a>d&&(d=a),s<o&&(o=s),s>u&&(u=s),l<c&&(c=l),l>p&&(p=l)}return(l[t+0]!==r||l[t+1]!==o||l[t+2]!==c||l[t+3]!==d||l[t+4]!==u||l[t+5]!==p)&&(l[t+0]=r,l[t+1]=o,l[t+2]=c,l[t+3]=d,l[t+4]=u,l[t+5]=p,!0)}{const i=t+8,r=a[t+6],n=i+o,s=r+o;let h=c,u=!1,p=!1;e?h||(u=e.has(n),p=e.has(s),h=!u&&!p):(u=!0,p=!0);const m=h||p;let f=!1;(h||u)&&(f=d(i,o,h));let g=!1;m&&(g=d(r,o,h));const x=f||g;if(x)for(let e=0;e<3;e++){const n=i+e,o=r+e,a=l[n],s=l[n+3],c=l[o],h=l[o+3];l[t+e]=a<c?a:c,l[t+e+3]=s>h?s:h}return x}}}traverse(e,t=0){const i=this._roots[t],n=new Uint32Array(i),o=new Uint16Array(i);!function t(a,s=0){const l=2*a,c=o[l+15]===r.IS_LEAFNODE_FLAG;if(c){const t=n[a+6],r=o[l+14];e(s,c,new Float32Array(i,4*a,6),t,r)}else{const o=a+r.BYTES_PER_NODE/4,l=n[a+6],h=n[a+7];e(s,c,new Float32Array(i,4*a,6),h)||(t(o,s+1),t(l,s+1))}}(0)}raycast(e,t=i.FrontSide){const r=this._roots,n=this.geometry,a=[],s=t.isMaterial,l=Array.isArray(t),c=n.groups,h=s?t.side:t;for(let i=0,s=r.length;i<s;i++){const s=l?t[c[i].materialIndex].side:h,d=a.length;if((0,o.setBuffer)(r[i]),(0,o.raycast)(0,n,s,e,a),(0,o.clearBuffer)(),l){const e=c[i].materialIndex;for(let t=d,i=a.length;t<i;t++)a[t].face.materialIndex=e}}return a}raycastFirst(e,t=i.FrontSide){const r=this._roots,n=this.geometry,a=t.isMaterial,s=Array.isArray(t);let l=null;const c=n.groups,h=a?t.side:t;for(let i=0,a=r.length;i<a;i++){const a=s?t[c[i].materialIndex].side:h;(0,o.setBuffer)(r[i]);const d=(0,o.raycastFirst)(0,n,a,e);(0,o.clearBuffer)(),null!=d&&(null==l||d.distance<l.distance)&&(l=d,s&&(d.face.materialIndex=c[i].materialIndex))}return l}intersectsGeometry(e,t){const i=this.geometry;let r=!1;for(const n of this._roots)if((0,o.setBuffer)(n),r=(0,o.intersectsGeometry)(0,i,e,t),(0,o.clearBuffer)(),r)break;return r}shapecast(e,t,i){const r=this.geometry;if(e instanceof Function){if(t){const e=t;t=(t,i,r,n)=>{const o=3*i;return e(t,o,o+1,o+2,r,n)}}e={boundsTraverseOrder:i,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const n=M.getPrimitive();let{boundsTraverseOrder:a,intersectsBounds:s,intersectsRange:l,intersectsTriangle:c}=e;if(l&&c){const e=l;l=(t,i,o,a,s)=>!!e(t,i,o,a,s)||(0,h.iterateOverTriangles)(t,i,r,c,o,a,n)}else l||(l=c?(e,t,i,o)=>(0,h.iterateOverTriangles)(e,t,r,c,i,o,n):(e,t,i)=>i);let d=!1,u=0;for(const e of this._roots){if((0,o.setBuffer)(e),d=(0,o.shapecast)(0,r,s,l,a,u),(0,o.clearBuffer)(),d)break;u+=e.byteLength}return M.releasePrimitive(n),d}bvhcast(e,t,i){let{intersectsRanges:r,intersectsTriangles:n}=i;const o=this.geometry.index,a=this.geometry.attributes.position,s=e.geometry.index,l=e.geometry.attributes.position;m.copy(t).invert();const c=M.getPrimitive(),d=M.getPrimitive();if(n){function g(e,i,r,u,p,m,f,g){for(let x=r,b=r+u;x<b;x++){(0,h.setTriangle)(d,3*x,s,l),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let t=e,r=e+i;t<r;t++)if((0,h.setTriangle)(c,3*t,o,a),c.needsUpdate=!0,n(c,d,t,x,p,m,f,g))return!0}return!1}if(r){const x=r;r=function(e,t,i,r,n,o,a,s){return!!x(e,t,i,r,n,o,a,s)||g(e,t,i,r,n,o,a,s)}}else r=g}e.getBoundingBox(p),p.applyMatrix4(t);const f=this.shapecast({intersectsBounds:e=>p.intersectsBox(e),intersectsRange:(t,i,n,o,a,s)=>(u.copy(s),u.applyMatrix4(m),e.shapecast({intersectsBounds:e=>u.intersectsBox(e),intersectsRange:(e,n,s,l,c)=>r(t,i,e,n,o,a,l,c)}))});return M.releasePrimitive(c),M.releasePrimitive(d),f}intersectsBox(e,t){return f.set(e.min,e.max,t),f.needsUpdate=!0,this.shapecast({intersectsBounds:e=>f.intersectsBox(e),intersectsTriangle:e=>f.intersectsTriangle(e)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},r={},n=0,o=1/0){e.boundingBox||e.computeBoundingBox(),f.set(e.boundingBox.min,e.boundingBox.max,t),f.needsUpdate=!0;const a=this.geometry,s=a.attributes.position,l=a.index,c=e.attributes.position,d=e.index,u=M.getPrimitive(),p=M.getPrimitive();let x=b,$=y,S=null,P=null;r&&(S=w,P=v);let k=1/0,_=null,T=null;return m.copy(t).invert(),g.matrix.copy(m),this.shapecast({boundsTraverseOrder:e=>f.distanceToBox(e),intersectsBounds:(e,t,i)=>i<k&&i<o&&(t&&(g.min.copy(e.min),g.max.copy(e.max),g.needsUpdate=!0),!0),intersectsRange:(i,r)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:e=>g.distanceToBox(e),intersectsBounds:(e,t,i)=>i<k&&i<o,intersectsRange:(e,o)=>{for(let a=3*e,m=3*(e+o);a<m;a+=3){(0,h.setTriangle)(p,a,d,c),p.a.applyMatrix4(t),p.b.applyMatrix4(t),p.c.applyMatrix4(t),p.needsUpdate=!0;for(let e=3*i,t=3*(i+r);e<t;e+=3){(0,h.setTriangle)(u,e,l,s),u.needsUpdate=!0;const t=u.distanceToTriangle(p,x,S);if(t<k&&($.copy(x),P&&P.copy(S),k=t,_=e/3,T=a/3),t<n)return!0}}}});for(let e=0,o=d?d.count:c.count;e<o;e+=3){(0,h.setTriangle)(p,e,d,c),p.a.applyMatrix4(t),p.b.applyMatrix4(t),p.c.applyMatrix4(t),p.needsUpdate=!0;for(let t=3*i,o=3*(i+r);t<o;t+=3){(0,h.setTriangle)(u,t,l,s),u.needsUpdate=!0;const i=u.distanceToTriangle(p,x,S);if(i<k&&($.copy(x),P&&P.copy(S),k=i,_=t/3,T=e/3),i<n)return!0}}}}),M.releasePrimitive(u),M.releasePrimitive(p),k===1/0?null:(i.point?i.point.copy($):i.point=$.clone(),i.distance=k,i.faceIndex=_,r&&(r.point?r.point.copy(P):r.point=P.clone(),r.point.applyMatrix4(m),$.applyMatrix4(m),r.distance=$.sub(r.point).length(),r.faceIndex=T),i)}closestPointToPoint(e,t={},i=0,r=1/0){const n=i*i,o=r*r;let a=1/0,s=null;if(this.shapecast({boundsTraverseOrder:t=>(x.copy(e).clamp(t.min,t.max),x.distanceToSquared(e)),intersectsBounds:(e,t,i)=>i<a&&i<o,intersectsTriangle:(t,i)=>{t.closestPointToPoint(e,x);const r=e.distanceToSquared(x);return r<a&&(b.copy(x),a=r,s=i),r<n}}),a===1/0)return null;const l=Math.sqrt(a);return t.point?t.point.copy(b):t.point=b.clone(),t.distance=l,t.faceIndex=s,t}getBoundingBox(e){e.makeEmpty();return this._roots.forEach((t=>{(0,c.arrayToBox)(0,new Float32Array(t),$),e.union($)})),e}}})),parcelRequire.register("ckwVR",(function(e,t){$parcel$export(e.exports,"CENTER",(()=>i)),$parcel$export(e.exports,"AVERAGE",(()=>r)),$parcel$export(e.exports,"SAH",(()=>n)),$parcel$export(e.exports,"CONTAINED",(()=>o)),$parcel$export(e.exports,"TRIANGLE_INTERSECT_COST",(()=>a)),$parcel$export(e.exports,"TRAVERSAL_COST",(()=>s)),$parcel$export(e.exports,"BYTES_PER_NODE",(()=>l)),$parcel$export(e.exports,"IS_LEAFNODE_FLAG",(()=>c)),$parcel$export(e.exports,"FLOAT32_EPSILON",(()=>h));const i=0,r=1,n=2,o=2,a=1.25,s=1,l=32,c=65535,h=Math.pow(2,-24)})),parcelRequire.register("IWLEN",(function(e,t){$parcel$export(e.exports,"buildPackedTree",(()=>u));var i=parcelRequire("4xklQ"),r=parcelRequire("2tMyf"),n=parcelRequire("fcnhI"),o=parcelRequire("ckwVR");function a(e,t,i,r,n=null){let o=1/0,a=1/0,s=1/0,l=-1/0,c=-1/0,h=-1/0,d=1/0,u=1/0,p=1/0,m=-1/0,f=-1/0,g=-1/0;const x=null!==n;for(let r=6*t,n=6*(t+i);r<n;r+=6){const t=e[r+0],i=e[r+1],n=t-i,b=t+i;n<o&&(o=n),b>l&&(l=b),x&&t<d&&(d=t),x&&t>m&&(m=t);const y=e[r+2],w=e[r+3],v=y-w,$=y+w;v<a&&(a=v),$>c&&(c=$),x&&y<u&&(u=y),x&&y>f&&(f=y);const M=e[r+4],S=e[r+5],P=M-S,k=M+S;P<s&&(s=P),k>h&&(h=k),x&&M<p&&(p=M),x&&M>g&&(g=M)}r[0]=o,r[1]=a,r[2]=s,r[3]=l,r[4]=c,r[5]=h,x&&(n[0]=d,n[1]=u,n[2]=p,n[3]=m,n[4]=f,n[5]=g)}const s=32,l=(e,t)=>e.candidate-t.candidate,c=new Array(s).fill().map((()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}))),h=new Float32Array(6);function d(e,t){function d(e){v&&v(e/$)}function u(t,i,p,v=null,$=0){if(!M&&$>=x&&(M=!0,b&&(console.warn(`MeshBVH: Max depth of ${x} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),p<=y||$>=x)return d(i+p),t.offset=i,t.count=p,t;const S=function(e,t,i,r,a,d){let u=-1,p=0;if(d===o.CENTER)u=(0,n.getLongestEdgeIndex)(t),-1!==u&&(p=(t[u]+t[u+3])/2);else if(d===o.AVERAGE)u=(0,n.getLongestEdgeIndex)(e),-1!==u&&(p=function(e,t,i,r){let n=0;for(let o=t,a=t+i;o<a;o++)n+=e[6*o+2*r];return n/i}(i,r,a,u));else if(d===o.SAH){const d=(0,n.computeSurfaceArea)(e);let m=o.TRIANGLE_INTERSECT_COST*a;const f=6*r,g=6*(r+a);for(let e=0;e<3;e++){const r=t[e],x=(t[e+3]-r)/s;if(a<8){const t=[...c];t.length=a;let r=0;for(let o=f;o<g;o+=6,r++){const a=t[r];a.candidate=i[o+2*e],a.count=0;const{bounds:s,leftCacheBounds:l,rightCacheBounds:c}=a;for(let e=0;e<3;e++)c[e]=1/0,c[e+3]=-1/0,l[e]=1/0,l[e+3]=-1/0,s[e]=1/0,s[e+3]=-1/0;(0,n.expandByTriangleBounds)(o,i,s)}t.sort(l);let s=a;for(let e=0;e<s;e++){const i=t[e];for(;e+1<s&&t[e+1].candidate===i.candidate;)t.splice(e+1,1),s--}for(let r=f;r<g;r+=6){const o=i[r+2*e];for(let e=0;e<s;e++){const a=t[e];o>=a.candidate?(0,n.expandByTriangleBounds)(r,i,a.rightCacheBounds):((0,n.expandByTriangleBounds)(r,i,a.leftCacheBounds),a.count++)}}for(let i=0;i<s;i++){const r=t[i],s=r.count,l=a-r.count,c=r.leftCacheBounds,h=r.rightCacheBounds;let f=0;0!==s&&(f=(0,n.computeSurfaceArea)(c)/d);let g=0;0!==l&&(g=(0,n.computeSurfaceArea)(h)/d);const x=o.TRAVERSAL_COST+o.TRIANGLE_INTERSECT_COST*(f*s+g*l);x<m&&(u=e,m=x,p=r.candidate)}}else{for(let e=0;e<s;e++){const t=c[e];t.count=0,t.candidate=r+x+e*x;const i=t.bounds;for(let e=0;e<3;e++)i[e]=1/0,i[e+3]=-1/0}for(let t=f;t<g;t+=6){let o=~~((i[t+2*e]-r)/x);o>=s&&(o=31);const a=c[o];a.count++,(0,n.expandByTriangleBounds)(t,i,a.bounds)}const t=c[31];(0,n.copyBounds)(t.bounds,t.rightCacheBounds);for(let e=30;e>=0;e--){const t=c[e],i=c[e+1];(0,n.unionBounds)(t.bounds,i.rightCacheBounds,t.rightCacheBounds)}let l=0;for(let t=0;t<31;t++){const i=c[t],r=i.count,s=i.bounds,f=c[t+1].rightCacheBounds;0!==r&&(0===l?(0,n.copyBounds)(s,h):(0,n.unionBounds)(s,h,h)),l+=r;let g=0,x=0;0!==l&&(g=(0,n.computeSurfaceArea)(h)/d);const b=a-l;0!==b&&(x=(0,n.computeSurfaceArea)(f)/d);const y=o.TRAVERSAL_COST+o.TRIANGLE_INTERSECT_COST*(g*l+x*b);y<m&&(u=e,m=y,p=i.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${d} used.`);return{axis:u,pos:p}}(t.boundingData,v,f,i,p,w);if(-1===S.axis)return d(i+p),t.offset=i,t.count=p,t;const P=function(e,t,i,r,n){let o=i,a=i+r-1;const s=n.pos,l=2*n.axis;for(;;){for(;o<=a&&t[6*o+l]<s;)o++;for(;o<=a&&t[6*a+l]>=s;)a--;if(!(o<a))return o;for(let i=0;i<3;i++){let r=e[3*o+i];e[3*o+i]=e[3*a+i],e[3*a+i]=r;let n=t[6*o+2*i+0];t[6*o+2*i+0]=t[6*a+2*i+0],t[6*a+2*i+0]=n;let s=t[6*o+2*i+1];t[6*o+2*i+1]=t[6*a+2*i+1],t[6*a+2*i+1]=s}o++,a--}}(g,f,i,p,S);if(P===i||P===i+p)d(i+p),t.offset=i,t.count=p;else{t.splitAxis=S.axis;const e=new(0,r.MeshBVHNode),n=i,o=P-i;t.left=e,e.boundingData=new Float32Array(6),a(f,n,o,e.boundingData,m),u(e,n,o,m,$+1);const s=new(0,r.MeshBVHNode),l=P,c=p-o;t.right=s,s.boundingData=new Float32Array(6),a(f,l,c,s.boundingData,m),u(s,l,c,m,$+1)}return t}!function(e,t){if(!e.index){const r=e.attributes.position.count,n=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let o;o=r>65535?new Uint32Array(new n(4*r)):new Uint16Array(new n(2*r)),e.setIndex(new(0,i.BufferAttribute)(o,1));for(let e=0;e<r;e++)o[e]=e}}(e,t);const p=new Float32Array(6),m=new Float32Array(6),f=function(e,t){const i=e.attributes.position,r=e.index.array,n=r.length/3,a=new Float32Array(6*n),s=i.normalized,l=i.array,c=i.offset||0;let h=3;i.isInterleavedBufferAttribute&&(h=i.data.stride);const d=["getX","getY","getZ"];for(let e=0;e<n;e++){const n=3*e,u=6*e;let p,m,f;s?(p=r[n+0],m=r[n+1],f=r[n+2]):(p=r[n+0]*h+c,m=r[n+1]*h+c,f=r[n+2]*h+c);for(let e=0;e<3;e++){let r,n,c;s?(r=i[d[e]](p),n=i[d[e]](m),c=i[d[e]](f)):(r=l[p+e],n=l[m+e],c=l[f+e]);let h=r;n<h&&(h=n),c<h&&(h=c);let g=r;n>g&&(g=n),c>g&&(g=c);const x=(g-h)/2,b=2*e;a[u+b+0]=h+x,a[u+b+1]=x+(Math.abs(h)+x)*o.FLOAT32_EPSILON,h<t[e]&&(t[e]=h),g>t[e+3]&&(t[e+3]=g)}}return a}(e,p),g=e.index.array,x=t.maxDepth,b=t.verbose,y=t.maxLeafTris,w=t.strategy,v=t.onProgress,$=e.index.count/3;let M=!1;const S=[],P=function(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];const t=[],i=new Set;for(const t of e.groups)i.add(t.start),i.add(t.start+t.count);const r=Array.from(i.values()).sort(((e,t)=>e-t));for(let e=0;e<r.length-1;e++){const i=r[e],n=r[e+1];t.push({offset:i/3,count:(n-i)/3})}return t}(e);if(1===P.length){const e=P[0],t=new(0,r.MeshBVHNode);t.boundingData=p,function(e,t,i,r){let n=1/0,o=1/0,a=1/0,s=-1/0,l=-1/0,c=-1/0;for(let r=6*t,h=6*(t+i);r<h;r+=6){const t=e[r+0];t<n&&(n=t),t>s&&(s=t);const i=e[r+2];i<o&&(o=i),i>l&&(l=i);const h=e[r+4];h<a&&(a=h),h>c&&(c=h)}r[0]=n,r[1]=o,r[2]=a,r[3]=s,r[4]=l,r[5]=c}(f,e.offset,e.count,m),u(t,e.offset,e.count,m),S.push(t)}else for(let e of P){const t=new(0,r.MeshBVHNode);t.boundingData=new Float32Array(6),a(f,e.offset,e.count,t.boundingData,m),u(t,e.offset,e.count,m),S.push(t)}return S}function u(e,t){const i=d(e,t);let r,n,a;const s=[],l=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let e=0;e<i.length;e++){const t=i[e];let d=c(t);const u=new l(o.BYTES_PER_NODE*d);r=new Float32Array(u),n=new Uint32Array(u),a=new Uint16Array(u),h(0,t),s.push(u)}return s;function c(e){return e.count?1:1+c(e.left)+c(e.right)}function h(e,t){const i=e/4,s=e/2,l=!!t.count,c=t.boundingData;for(let e=0;e<6;e++)r[i+e]=c[e];if(l){const r=t.offset,l=t.count;return n[i+6]=r,a[s+14]=l,a[s+15]=o.IS_LEAFNODE_FLAG,e+o.BYTES_PER_NODE}{const r=t.left,a=t.right,s=t.splitAxis;let l;if(l=h(e+o.BYTES_PER_NODE,r),l/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[i+6]=l/4,l=h(l,a),n[i+7]=s,l}}}})),parcelRequire.register("2tMyf",(function(e,t){$parcel$export(e.exports,"MeshBVHNode",(()=>i));class i{constructor(){}}})),parcelRequire.register("fcnhI",(function(e,t){function i(e,t,i){return i.min.x=t[e],i.min.y=t[e+1],i.min.z=t[e+2],i.max.x=t[e+3],i.max.y=t[e+4],i.max.z=t[e+5],i}function r(e){let t=-1,i=-1/0;for(let r=0;r<3;r++){const n=e[r+3]-e[r];n>i&&(i=n,t=r)}return t}function n(e,t){t.set(e)}function o(e,t,i){let r,n;for(let o=0;o<3;o++){const a=o+3;r=e[o],n=t[o],i[o]=r<n?r:n,r=e[a],n=t[a],i[a]=r>n?r:n}}function a(e,t,i){for(let r=0;r<3;r++){const n=t[e+2*r],o=t[e+2*r+1],a=n-o,s=n+o;a<i[r]&&(i[r]=a),s>i[r+3]&&(i[r+3]=s)}}function s(e){const t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2];return 2*(t*i+i*r+r*t)}$parcel$export(e.exports,"arrayToBox",(()=>i)),$parcel$export(e.exports,"getLongestEdgeIndex",(()=>r)),$parcel$export(e.exports,"copyBounds",(()=>n)),$parcel$export(e.exports,"unionBounds",(()=>o)),$parcel$export(e.exports,"expandByTriangleBounds",(()=>a)),$parcel$export(e.exports,"computeSurfaceArea",(()=>s))})),parcelRequire.register("iR33e",(function(e,t){$parcel$export(e.exports,"raycast",(()=>m)),$parcel$export(e.exports,"raycastFirst",(()=>f)),$parcel$export(e.exports,"shapecast",(()=>g)),$parcel$export(e.exports,"intersectsGeometry",(()=>x)),$parcel$export(e.exports,"setBuffer",(()=>S)),$parcel$export(e.exports,"clearBuffer",(()=>P));var i=parcelRequire("4xklQ"),r=parcelRequire("ckwVR"),n=parcelRequire("8YY3V"),o=parcelRequire("57zgU"),a=parcelRequire("2nenX"),s=parcelRequire("bNX9f"),l=parcelRequire("fcnhI"),c=parcelRequire("f8eJn"),h=parcelRequire("kBHG0");const d=new(0,i.Box3),u=new(0,i.Vector3),p=["x","y","z"];function m(e,t,i,r,n){let o=2*e,s=v,l=$,c=M;if((0,h.IS_LEAF)(o,l)){const s=(0,h.OFFSET)(e,c),d=(0,h.COUNT)(o,l);(0,a.intersectTris)(t,i,r,s,d,n)}else{const o=(0,h.LEFT_NODE)(e);b(o,s,r,u)&&m(o,t,i,r,n);const a=(0,h.RIGHT_NODE)(e,c);b(a,s,r,u)&&m(a,t,i,r,n)}}function f(e,t,i,r){let n=2*e,o=v,s=$,l=M;if((0,h.IS_LEAF)(n,s)){const o=(0,h.OFFSET)(e,l),c=(0,h.COUNT)(n,s);return(0,a.intersectClosestTri)(t,i,r,o,c)}{const n=(0,h.SPLIT_AXIS)(e,l),a=p[n],s=r.direction[a]>=0;let c,d;s?(c=(0,h.LEFT_NODE)(e),d=(0,h.RIGHT_NODE)(e,l)):(c=(0,h.RIGHT_NODE)(e,l),d=(0,h.LEFT_NODE)(e));const m=b(c,o,r,u)?f(c,t,i,r):null;if(m){const e=m.point[a];if(s?e<=o[d+n]:e>=o[d+n+3])return m}const g=b(d,o,r,u)?f(d,t,i,r):null;return m&&g?m.distance<=g.distance?m:g:m||g||null}}const g=function(){let e,t;const n=[],o=new(0,c.PrimitivePool)((()=>new(0,i.Box3)));return function(...i){e=o.getPrimitive(),t=o.getPrimitive(),n.push(e,t);const r=a(...i);o.releasePrimitive(e),o.releasePrimitive(t),n.pop(),n.pop();const s=n.length;return s>0&&(t=n[s-1],e=n[s-2]),r};function a(i,n,o,s,c=null,d=0,u=0){function p(e){let t=2*e,i=$,r=M;for(;!(0,h.IS_LEAF)(t,i);)t=2*(e=(0,h.LEFT_NODE)(e));return(0,h.OFFSET)(e,r)}function m(e){let t=2*e,i=$,r=M;for(;!(0,h.IS_LEAF)(t,i);)t=2*(e=(0,h.RIGHT_NODE)(e,r));return(0,h.OFFSET)(e,r)+(0,h.COUNT)(t,i)}let f=2*i,g=v,x=$,b=M;if((0,h.IS_LEAF)(f,x)){const t=(0,h.OFFSET)(i,b),r=(0,h.COUNT)(f,x);return(0,l.arrayToBox)((0,h.BOUNDING_DATA_INDEX)(i),g,e),s(t,r,!1,u,d+i,e)}{const f=(0,h.LEFT_NODE)(i),y=(0,h.RIGHT_NODE)(i,b);let w,v,$,M,S=f,P=y;if(c&&($=e,M=t,(0,l.arrayToBox)((0,h.BOUNDING_DATA_INDEX)(S),g,$),(0,l.arrayToBox)((0,h.BOUNDING_DATA_INDEX)(P),g,M),w=c($),v=c(M),v<w)){S=y,P=f;const e=w;w=v,v=e,$=M}$||($=e,(0,l.arrayToBox)((0,h.BOUNDING_DATA_INDEX)(S),g,$));const k=o($,(0,h.IS_LEAF)(2*S,x),w,u+1,d+S);let _;if(k===r.CONTAINED){const e=p(S);_=s(e,m(S)-e,!0,u+1,d+S,$)}else _=k&&a(S,n,o,s,c,d,u+1);if(_)return!0;M=t,(0,l.arrayToBox)((0,h.BOUNDING_DATA_INDEX)(P),g,M);const T=o(M,(0,h.IS_LEAF)(2*P,x),v,u+1,d+P);let C;if(T===r.CONTAINED){const e=p(P);C=s(e,m(P)-e,!0,u+1,d+P,M)}else C=T&&a(P,n,o,s,c,d,u+1);return!!C}}}(),x=function(){const e=new(0,o.ExtendedTriangle),t=new(0,o.ExtendedTriangle),r=new(0,i.Matrix4),a=new(0,n.OrientedBox),c=new(0,n.OrientedBox);return function i(n,o,u,p,m=null){let f=2*n,g=v,x=$,b=M;null===m&&(u.boundingBox||u.computeBoundingBox(),a.set(u.boundingBox.min,u.boundingBox.max,p),m=a);if(!(0,h.IS_LEAF)(f,x)){const e=n+8,t=b[n+6];(0,l.arrayToBox)((0,h.BOUNDING_DATA_INDEX)(e),g,d);if(m.intersectsBox(d)&&i(e,o,u,p,m))return!0;(0,l.arrayToBox)((0,h.BOUNDING_DATA_INDEX)(t),g,d);return!!(m.intersectsBox(d)&&i(t,o,u,p,m))}{const i=o,a=i.index,d=i.attributes.position,m=u.index,y=u.attributes.position,w=(0,h.OFFSET)(n,b),v=(0,h.COUNT)(f,x);if(r.copy(p).invert(),u.boundsTree){(0,l.arrayToBox)((0,h.BOUNDING_DATA_INDEX)(n),g,c),c.matrix.copy(r),c.needsUpdate=!0;return u.boundsTree.shapecast({intersectsBounds:e=>c.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(p),e.b.applyMatrix4(p),e.c.applyMatrix4(p),e.needsUpdate=!0;for(let i=3*w,r=3*(v+w);i<r;i+=3)if((0,s.setTriangle)(t,i,a,d),t.needsUpdate=!0,e.intersectsTriangle(t))return!0;return!1}})}for(let i=3*w,n=v+3*w;i<n;i+=3){(0,s.setTriangle)(e,i,a,d),e.a.applyMatrix4(r),e.b.applyMatrix4(r),e.c.applyMatrix4(r),e.needsUpdate=!0;for(let i=0,r=m.count;i<r;i+=3)if((0,s.setTriangle)(t,i,m,y),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}}}();function b(e,t,i,r){return(0,l.arrayToBox)(e,t,d),i.intersectBox(d,r)}const y=[];let w,v,$,M;function S(e){w&&y.push(w),w=e,v=new Float32Array(e),$=new Uint16Array(e),M=new Uint32Array(e)}function P(){w=null,v=null,$=null,M=null,y.length&&S(y.pop())}})),parcelRequire.register("8YY3V",(function(e,t){$parcel$export(e.exports,"OrientedBox",(()=>a));var i=parcelRequire("4xklQ"),r=parcelRequire("OS03B"),n=parcelRequire("57zgU"),o=parcelRequire("3jQfW");class a extends i.Box3{constructor(...e){super(...e),this.isOrientedBox=!0,this.matrix=new(0,i.Matrix4),this.invMatrix=new(0,i.Matrix4),this.points=new Array(8).fill().map((()=>new(0,i.Vector3))),this.satAxes=new Array(3).fill().map((()=>new(0,i.Vector3))),this.satBounds=new Array(3).fill().map((()=>new(0,r.SeparatingAxisBounds))),this.alignedSatBounds=new Array(3).fill().map((()=>new(0,r.SeparatingAxisBounds))),this.needsUpdate=!1}set(e,t,i){super.set(e,t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){super.copy(e),this.matrix.copy(e.matrix),this.needsUpdate=!0}}a.prototype.update=function(){const e=this.matrix,t=this.min,i=this.max,r=this.points;for(let n=0;n<=1;n++)for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const s=r[1*n|2*o|4*a];s.x=n?i.x:t.x,s.y=o?i.y:t.y,s.z=a?i.z:t.z,s.applyMatrix4(e)}const n=this.satBounds,o=this.satAxes,a=r[0];for(let e=0;e<3;e++){const t=o[e],i=n[e],s=r[1<<e];t.subVectors(a,s),i.setFromPoints(t,r)}const s=this.alignedSatBounds;s[0].setFromPointsField(r,"x"),s[1].setFromPointsField(r,"y"),s[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},a.prototype.intersectsBox=function(){const e=new(0,r.SeparatingAxisBounds);return function(t){this.needsUpdate&&this.update();const i=t.min,r=t.max,n=this.satBounds,o=this.satAxes,a=this.alignedSatBounds;if(e.min=i.x,e.max=r.x,a[0].isSeparated(e))return!1;if(e.min=i.y,e.max=r.y,a[1].isSeparated(e))return!1;if(e.min=i.z,e.max=r.z,a[2].isSeparated(e))return!1;for(let i=0;i<3;i++){const r=o[i],a=n[i];if(e.setFromBox(r,t),a.isSeparated(e))return!1}return!0}}(),a.prototype.intersectsTriangle=function(){const e=new(0,n.ExtendedTriangle),t=new Array(3),o=new(0,r.SeparatingAxisBounds),a=new(0,r.SeparatingAxisBounds),s=new(0,i.Vector3);return function(i){this.needsUpdate&&this.update(),i.isExtendedTriangle?i.needsUpdate&&i.update():(e.copy(i),e.update(),i=e);const r=this.satBounds,n=this.satAxes;t[0]=i.a,t[1]=i.b,t[2]=i.c;for(let e=0;e<3;e++){const i=r[e],a=n[e];if(o.setFromPoints(a,t),i.isSeparated(o))return!1}const l=i.satBounds,c=i.satAxes,h=this.points;for(let e=0;e<3;e++){const t=l[e],i=c[e];if(o.setFromPoints(i,h),t.isSeparated(o))return!1}for(let e=0;e<3;e++){const i=n[e];for(let e=0;e<4;e++){const r=c[e];if(s.crossVectors(i,r),o.setFromPoints(s,t),a.setFromPoints(s,h),o.isSeparated(a))return!1}}return!0}}(),a.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},a.prototype.distanceToPoint=function(){const e=new(0,i.Vector3);return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),a.prototype.distanceToBox=function(){const e=["x","y","z"],t=new Array(12).fill().map((()=>new(0,i.Line3))),r=new Array(12).fill().map((()=>new(0,i.Line3))),n=new(0,i.Vector3),a=new(0,i.Vector3);return function(i,s=0,l=null,c=null){if(this.needsUpdate&&this.update(),this.intersectsBox(i))return(l||c)&&(i.getCenter(a),this.closestPointToPoint(a,n),i.closestPointToPoint(n,a),l&&l.copy(n),c&&c.copy(a)),0;const h=s*s,d=i.min,u=i.max,p=this.points;let m=1/0;for(let e=0;e<8;e++){const t=p[e];a.copy(t).clamp(d,u);const i=t.distanceToSquared(a);if(i<m&&(m=i,l&&l.copy(t),c&&c.copy(a),i<h))return Math.sqrt(i)}let f=0;for(let i=0;i<3;i++)for(let n=0;n<=1;n++)for(let o=0;o<=1;o++){const a=(i+1)%3,s=(i+2)%3,l=1<<i|n<<a|o<<s,c=p[n<<a|o<<s],h=p[l];t[f].set(c,h);const m=e[i],g=e[a],x=e[s],b=r[f],y=b.start,w=b.end;y[m]=d[m],y[g]=n?d[g]:u[g],y[x]=o?d[x]:u[g],w[m]=u[m],w[g]=n?d[g]:u[g],w[x]=o?d[x]:u[g],f++}for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let i=0;i<=1;i++){a.x=e?u.x:d.x,a.y=t?u.y:d.y,a.z=i?u.z:d.z,this.closestPointToPoint(a,n);const r=a.distanceToSquared(n);if(r<m&&(m=r,l&&l.copy(n),c&&c.copy(a),r<h))return Math.sqrt(r)}for(let e=0;e<12;e++){const i=t[e];for(let e=0;e<12;e++){const t=r[e];(0,o.closestPointsSegmentToSegment)(i,t,n,a);const s=n.distanceToSquared(a);if(s<m&&(m=s,l&&l.copy(n),c&&c.copy(a),s<h))return Math.sqrt(s)}}return Math.sqrt(m)}}()})),parcelRequire.register("OS03B",(function(e,t){$parcel$export(e.exports,"SeparatingAxisBounds",(()=>r));var i=parcelRequire("4xklQ");class r{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,r=-1/0;for(let n=0,o=e.length;n<o;n++){const o=e[n][t];i=o<i?o:i,r=o>r?o:r}this.min=i,this.max=r}setFromPoints(e,t){let i=1/0,r=-1/0;for(let n=0,o=t.length;n<o;n++){const o=t[n],a=e.dot(o);i=a<i?a:i,r=a>r?a:r}this.min=i,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}}r.prototype.setFromBox=function(){const e=new(0,i.Vector3);return function(t,i){const r=i.min,n=i.max;let o=1/0,a=-1/0;for(let i=0;i<=1;i++)for(let s=0;s<=1;s++)for(let l=0;l<=1;l++){e.x=r.x*i+n.x*(1-i),e.y=r.y*s+n.y*(1-s),e.z=r.z*l+n.z*(1-l);const c=t.dot(e);o=Math.min(c,o),a=Math.max(c,a)}this.min=o,this.max=a}}();!function(){const e=new r}()})),parcelRequire.register("57zgU",(function(e,t){$parcel$export(e.exports,"ExtendedTriangle",(()=>a));var i=parcelRequire("4xklQ"),r=parcelRequire("OS03B"),n=parcelRequire("3jQfW");function o(e){return Math.abs(e)<1e-15}class a extends i.Triangle{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new(0,i.Vector3))),this.satBounds=new Array(4).fill().map((()=>new(0,r.SeparatingAxisBounds))),this.points=[this.a,this.b,this.c],this.sphere=new(0,i.Sphere),this.plane=new(0,i.Plane),this.needsUpdate=!0}intersectsSphere(e){return(0,n.sphereIntersectTriangle)(e,this)}update(){const e=this.a,t=this.b,i=this.c,r=this.points,n=this.satAxes,o=this.satBounds,a=n[0],s=o[0];this.getNormal(a),s.setFromPoints(a,r);const l=n[1],c=o[1];l.subVectors(e,t),c.setFromPoints(l,r);const h=n[2],d=o[2];h.subVectors(t,i),d.setFromPoints(h,r);const u=n[3],p=o[3];u.subVectors(i,e),p.setFromPoints(u,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}}a.prototype.closestPointToSegment=function(){const e=new(0,i.Vector3),t=new(0,i.Vector3),r=new(0,i.Line3);return function(i,o=null,a=null){const{start:s,end:l}=i,c=this.points;let h,d=1/0;for(let s=0;s<3;s++){const l=(s+1)%3;r.start.copy(c[s]),r.end.copy(c[l]),(0,n.closestPointsSegmentToSegment)(r,i,e,t),h=e.distanceToSquared(t),h<d&&(d=h,o&&o.copy(e),a&&a.copy(t))}return this.closestPointToPoint(s,e),h=s.distanceToSquared(e),h<d&&(d=h,o&&o.copy(e),a&&a.copy(s)),this.closestPointToPoint(l,e),h=l.distanceToSquared(e),h<d&&(d=h,o&&o.copy(e),a&&a.copy(l)),Math.sqrt(d)}}(),a.prototype.intersectsTriangle=function(){const e=new a,t=new Array(3),n=new Array(3),s=new(0,r.SeparatingAxisBounds),l=new(0,r.SeparatingAxisBounds),c=new(0,i.Vector3),h=new(0,i.Vector3),d=new(0,i.Vector3),u=new(0,i.Vector3),p=new(0,i.Line3),m=new(0,i.Line3),f=new(0,i.Line3);return function(i,r=null){this.needsUpdate&&this.update(),i.isExtendedTriangle?i.needsUpdate&&i.update():(e.copy(i),e.update(),i=e);const a=this.plane,g=i.plane;if(Math.abs(a.normal.dot(g.normal))>1-1e-10){const e=this.satBounds,o=this.satAxes;n[0]=i.a,n[1]=i.b,n[2]=i.c;for(let t=0;t<4;t++){const i=e[t],r=o[t];if(s.setFromPoints(r,n),i.isSeparated(s))return!1}const a=i.satBounds,h=i.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let e=0;e<4;e++){const i=a[e],r=h[e];if(s.setFromPoints(r,t),i.isSeparated(s))return!1}for(let e=0;e<4;e++){const i=o[e];for(let e=0;e<4;e++){const r=h[e];if(c.crossVectors(i,r),s.setFromPoints(c,t),l.setFromPoints(c,n),s.isSeparated(l))return!1}}return r&&(console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),r.start.set(0,0,0),r.end.set(0,0,0)),!0}{const e=this.points;let t=!1,n=0;for(let i=0;i<3;i++){const r=e[i],a=e[(i+1)%3];p.start.copy(r),p.end.copy(a),p.delta(h);const s=t?m.start:m.end,l=o(g.distanceToPoint(r));if(o(g.normal.dot(h))&&l){m.copy(p),n=2;break}if((g.intersectLine(p,s)||l)&&!o(s.distanceTo(a))){if(n++,t)break;t=!0}}if(1===n&&this.containsPoint(m.end))return r&&(r.start.copy(m.end),r.end.copy(m.end)),!0;if(2!==n)return!1;const s=i.points;let l=!1,c=0;for(let e=0;e<3;e++){const t=s[e],i=s[(e+1)%3];p.start.copy(t),p.end.copy(i),p.delta(d);const r=l?f.start:f.end,n=o(a.distanceToPoint(t));if(o(a.normal.dot(d))&&n){f.copy(p),c=2;break}if((a.intersectLine(p,r)||n)&&!o(r.distanceTo(i))){if(c++,l)break;l=!0}}if(1===c&&this.containsPoint(f.end))return r&&(r.start.copy(f.end),r.end.copy(f.end)),!0;if(2!==c)return!1;if(m.delta(h),f.delta(d),h.dot(d)<0){let e=f.start;f.start=f.end,f.end=e}const x=m.start.dot(h),b=m.end.dot(h),y=f.start.dot(h),w=f.end.dot(h),v=b<y,$=x<w;return(x===w||y===b||v!==$)&&(r&&(u.subVectors(m.start,f.start),u.dot(h)>0?r.start.copy(m.start):r.start.copy(f.start),u.subVectors(m.end,f.end),u.dot(h)<0?r.end.copy(m.end):r.end.copy(f.end)),!0)}}}(),a.prototype.distanceToPoint=function(){const e=new(0,i.Vector3);return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),a.prototype.distanceToTriangle=function(){const e=new(0,i.Vector3),t=new(0,i.Vector3),r=["a","b","c"],o=new(0,i.Line3),a=new(0,i.Line3);return function(i,s=null,l=null){const c=s||l?o:null;if(this.intersectsTriangle(i,c))return(s||l)&&(s&&c.getCenter(s),l&&c.getCenter(l)),0;let h=1/0;for(let t=0;t<3;t++){let n;const o=r[t],a=i[o];this.closestPointToPoint(a,e),n=a.distanceToSquared(e),n<h&&(h=n,s&&s.copy(e),l&&l.copy(a));const c=this[o];i.closestPointToPoint(c,e),n=c.distanceToSquared(e),n<h&&(h=n,s&&s.copy(c),l&&l.copy(e))}for(let c=0;c<3;c++){const d=r[c],u=r[(c+1)%3];o.set(this[d],this[u]);for(let c=0;c<3;c++){const d=r[c],u=r[(c+1)%3];a.set(i[d],i[u]),(0,n.closestPointsSegmentToSegment)(o,a,e,t);const p=e.distanceToSquared(t);p<h&&(h=p,s&&s.copy(e),l&&l.copy(t))}}return Math.sqrt(h)}}()})),parcelRequire.register("3jQfW",(function(e,t){$parcel$export(e.exports,"closestPointsSegmentToSegment",(()=>n)),$parcel$export(e.exports,"sphereIntersectTriangle",(()=>o));var i=parcelRequire("4xklQ");const r=function(){const e=new(0,i.Vector3),t=new(0,i.Vector3),r=new(0,i.Vector3);return function(i,n,o){const a=i.start,s=e,l=n.start,c=t;r.subVectors(a,l),e.subVectors(i.end,i.start),t.subVectors(n.end,n.start);const h=r.dot(c),d=c.dot(s),u=c.dot(c),p=r.dot(s),m=s.dot(s)*u-d*d;let f,g;f=0!==m?(h*d-p*u)/m:0,g=(h+f*d)/u,o.x=f,o.y=g}}(),n=function(){const e=new(0,i.Vector2),t=new(0,i.Vector3),n=new(0,i.Vector3);return function(i,o,a,s){r(i,o,e);let l=e.x,c=e.y;if(l>=0&&l<=1&&c>=0&&c<=1)return i.at(l,a),void o.at(c,s);if(l>=0&&l<=1)return c<0?o.at(0,s):o.at(1,s),void i.closestPointToPoint(s,!0,a);if(c>=0&&c<=1)return l<0?i.at(0,a):i.at(1,a),void o.closestPointToPoint(a,!0,s);{let e,r;e=l<0?i.start:i.end,r=c<0?o.start:o.end;const h=t,d=n;return i.closestPointToPoint(r,!0,t),o.closestPointToPoint(e,!0,n),h.distanceToSquared(r)<=d.distanceToSquared(e)?(a.copy(h),void s.copy(r)):(a.copy(e),void s.copy(d))}}}(),o=function(){const e=new(0,i.Vector3),t=new(0,i.Vector3),r=new(0,i.Plane),n=new(0,i.Line3);return function(i,o){const{radius:a,center:s}=i,{a:l,b:c,c:h}=o;n.start=l,n.end=c;if(n.closestPointToPoint(s,!0,e).distanceTo(s)<=a)return!0;n.start=l,n.end=h;if(n.closestPointToPoint(s,!0,e).distanceTo(s)<=a)return!0;n.start=c,n.end=h;if(n.closestPointToPoint(s,!0,e).distanceTo(s)<=a)return!0;const d=o.getPlane(r);if(Math.abs(d.distanceToPoint(s))<=a){const e=d.projectPoint(s,t);if(o.containsPoint(e))return!0}return!1}}()})),parcelRequire.register("2nenX",(function(e,t){$parcel$export(e.exports,"intersectTris",(()=>r)),$parcel$export(e.exports,"intersectClosestTri",(()=>n)),$parcel$export(e.exports,"convertRaycastIntersect",(()=>o));var i=parcelRequire("4tjWS");function r(e,t,r,n,o,a){for(let s=n,l=n+o;s<l;s++)(0,i.intersectTri)(e,t,r,s,a)}function n(e,t,r,n,o){let a=1/0,s=null;for(let l=n,c=n+o;l<c;l++){const n=(0,i.intersectTri)(e,t,r,l);n&&n.distance<a&&(s=n,a=n.distance)}return s}function o(e,t,i){return null===e?null:(e.point.applyMatrix4(t.matrixWorld),e.distance=e.point.distanceTo(i.ray.origin),e.object=t,e.distance<i.near||e.distance>i.far?null:e)}})),parcelRequire.register("4tjWS",(function(e,t){$parcel$export(e.exports,"intersectTri",(()=>d));var i=parcelRequire("4xklQ");const r=new(0,i.Vector3),n=new(0,i.Vector3),o=new(0,i.Vector3),a=new(0,i.Vector2),s=new(0,i.Vector2),l=new(0,i.Vector2),c=new(0,i.Vector3);function h(e,t,h,d,u,p,m){r.fromBufferAttribute(t,d),n.fromBufferAttribute(t,u),o.fromBufferAttribute(t,p);const f=function(e,t,r,n,o,a){let s;return s=a===i.BackSide?e.intersectTriangle(n,r,t,!0,o):e.intersectTriangle(t,r,n,a!==i.DoubleSide,o),null===s?null:{distance:e.origin.distanceTo(o),point:o.clone()}}(e,r,n,o,c,m);if(f){h&&(a.fromBufferAttribute(h,d),s.fromBufferAttribute(h,u),l.fromBufferAttribute(h,p),f.uv=i.Triangle.getUV(c,r,n,o,a,s,l,new(0,i.Vector2)));const e={a:d,b:u,c:p,normal:new(0,i.Vector3),materialIndex:0};i.Triangle.getNormal(r,n,o,e.normal),f.face=e,f.faceIndex=d}return f}function d(e,t,i,r,n){const o=3*r,a=e.index.getX(o),s=e.index.getX(o+1),l=e.index.getX(o+2),c=h(i,e.attributes.position,e.attributes.uv,a,s,l,t);return c?(c.faceIndex=r,n&&n.push(c),c):null}})),parcelRequire.register("bNX9f",(function(e,t){$parcel$export(e.exports,"setTriangle",(()=>i)),$parcel$export(e.exports,"iterateOverTriangles",(()=>r));parcelRequire("4xklQ");function i(e,t,i,r){const n=e.a,o=e.b,a=e.c;let s=t,l=t+1,c=t+2;i&&(s=i.getX(t),l=i.getX(t+1),c=i.getX(t+2)),n.x=r.getX(s),n.y=r.getY(s),n.z=r.getZ(s),o.x=r.getX(l),o.y=r.getY(l),o.z=r.getZ(l),a.x=r.getX(c),a.y=r.getY(c),a.z=r.getZ(c)}function r(e,t,r,n,o,a,s){const l=r.index,c=r.attributes.position;for(let r=e,h=t+e;r<h;r++)if(i(s,3*r,l,c),s.needsUpdate=!0,n(s,r,o,a))return!0;return!1}})),parcelRequire.register("f8eJn",(function(e,t){$parcel$export(e.exports,"PrimitivePool",(()=>i));class i{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}})),parcelRequire.register("kBHG0",(function(e,t){function i(e,t){return 65535===t[e+15]}function r(e,t){return t[e+6]}function n(e,t){return t[e+14]}function o(e){return e+8}function a(e,t){return t[e+6]}function s(e,t){return t[e+7]}function l(e){return e}$parcel$export(e.exports,"IS_LEAF",(()=>i)),$parcel$export(e.exports,"OFFSET",(()=>r)),$parcel$export(e.exports,"COUNT",(()=>n)),$parcel$export(e.exports,"LEFT_NODE",(()=>o)),$parcel$export(e.exports,"RIGHT_NODE",(()=>a)),$parcel$export(e.exports,"SPLIT_AXIS",(()=>s)),$parcel$export(e.exports,"BOUNDING_DATA_INDEX",(()=>l))})),parcelRequire.register("4J2OP",(function(e,t){$parcel$export(e.exports,"computeBoundsTree",(()=>n)),$parcel$export(e.exports,"disposeBoundsTree",(()=>o));var i=parcelRequire("4xklQ"),r=(parcelRequire("2nenX"),parcelRequire("1DCdP"));i.Mesh.prototype.raycast;function n(e){return this.boundsTree=new(0,r.MeshBVH)(this,e),this.boundsTree}function o(){this.boundsTree=null}})),parcelRequire.register("kEmYZ",(function(e,t){$parcel$export(e.exports,"MeshBVHUniformStruct",(()=>a));var i=parcelRequire("4xklQ"),r=parcelRequire("jzv0I"),n=parcelRequire("ckwVR"),o=parcelRequire("kBHG0");class a{constructor(){this.autoDispose=!0,this.index=new(0,r.UIntVertexAttributeTexture),this.position=new(0,r.FloatVertexAttributeTexture),this.bvhBounds=new(0,i.DataTexture),this.bvhContents=new(0,i.DataTexture),this.index.overrideItemSize=3}updateFrom(e){const{geometry:t}=e;!function(e,t,r){const a=e._roots;if(1!==a.length)throw new Error("MeshBVHUniformStruct: Multi-root BVHs not supported.");const s=a[0],l=new Uint16Array(s),c=new Uint32Array(s),h=new Float32Array(s),d=s.byteLength/n.BYTES_PER_NODE,u=2*Math.ceil(Math.sqrt(d/2)),p=new Float32Array(4*u*u),m=Math.ceil(Math.sqrt(d)),f=new Uint32Array(2*m*m);for(let e=0;e<d;e++){const t=e*n.BYTES_PER_NODE/4,i=2*t,r=(0,o.BOUNDING_DATA_INDEX)(t);for(let t=0;t<3;t++)p[8*e+0+t]=h[r+0+t],p[8*e+4+t]=h[r+3+t];if((0,o.IS_LEAF)(i,l)){const r=(0,o.COUNT)(i,l),n=(0,o.OFFSET)(t,c),a=4294901760|r;f[2*e+0]=a,f[2*e+1]=n}else{const i=4*(0,o.RIGHT_NODE)(t,c)/n.BYTES_PER_NODE,r=(0,o.SPLIT_AXIS)(t,c);f[2*e+0]=r,f[2*e+1]=i}}t.image.data=p,t.image.width=u,t.image.height=u,t.format=i.RGBAFormat,t.type=i.FloatType,t.internalFormat="RGBA32F",t.minFilter=i.NearestFilter,t.magFilter=i.NearestFilter,t.generateMipmaps=!1,t.needsUpdate=!0,t.dispose(),r.image.data=f,r.image.width=m,r.image.height=m,r.format=i.RGIntegerFormat,r.type=i.UnsignedIntType,r.internalFormat="RG32UI",r.minFilter=i.NearestFilter,r.magFilter=i.NearestFilter,r.generateMipmaps=!1,r.needsUpdate=!0,r.dispose()}(e,this.bvhBounds,this.bvhContents),this.index.updateFrom(t.index),this.position.updateFrom(t.attributes.position)}dispose(){const{index:e,position:t,bvhBounds:i,bvhContents:r}=this;e&&e.dispose(),t&&t.dispose(),i&&i.dispose(),r&&r.dispose()}}})),parcelRequire.register("jzv0I",(function(e,t){$parcel$export(e.exports,"UIntVertexAttributeTexture",(()=>o)),$parcel$export(e.exports,"FloatVertexAttributeTexture",(()=>a));var i=parcelRequire("4xklQ");function r(e){switch(e){case 1:return i.RedIntegerFormat;case 2:return i.RGIntegerFormat;case 3:case 4:return i.RGBAIntegerFormat}}class n extends i.DataTexture{constructor(){super(),this.minFilter=i.NearestFilter,this.magFilter=i.NearestFilter,this.generateMipmaps=!1,this.overrideItemSize=null,this._forcedType=null}updateFrom(e){const t=this.overrideItemSize,n=e.itemSize,o=e.count;if(null!==t){if(n*o%t!=0)throw new Error("VertexAttributeTexture: overrideItemSize must divide evenly into buffer length.");e.itemSize=t,e.count=o*n/t}const a=e.itemSize,s=e.count,l=e.normalized,c=e.array.constructor,h=c.BYTES_PER_ELEMENT;let d,u,p,m,f=this._forcedType,g=a;if(null===f)switch(c){case Float32Array:f=i.FloatType;break;case Uint8Array:case Uint16Array:case Uint32Array:f=i.UnsignedIntType;break;case Int8Array:case Int16Array:case Int32Array:f=i.IntType}let x=function(e){switch(e){case 1:return"R";case 2:return"RG";case 3:case 4:return"RGBA"}throw new Error}(a);switch(f){case i.FloatType:p=1,u=function(e){switch(e){case 1:return i.RedFormat;case 2:return i.RGFormat;case 3:case 4:return i.RGBAFormat}}(a),l&&1===h?(m=c,x+="8",c===Uint8Array?d=i.UnsignedByteType:(d=i.ByteType,x+="_SNORM")):(m=Float32Array,x+="32F",d=i.FloatType);break;case i.IntType:x+=8*h+"I",p=l?Math.pow(2,8*c.BYTES_PER_ELEMENT-1):1,u=r(a),1===h?(m=Int8Array,d=i.ByteType):2===h?(m=Int16Array,d=i.ShortType):(m=Int32Array,d=i.IntType);break;case i.UnsignedIntType:x+=8*h+"UI",p=l?Math.pow(2,8*c.BYTES_PER_ELEMENT-1):1,u=r(a),1===h?(m=Uint8Array,d=i.UnsignedByteType):2===h?(m=Uint16Array,d=i.UnsignedShortType):(m=Uint32Array,d=i.UnsignedIntType)}3!==g||u!==i.RGBAFormat&&u!==i.RGBAIntegerFormat||(g=4);const b=Math.ceil(Math.sqrt(s)),y=new m(g*b*b);for(let t=0;t<s;t++){const i=g*t;y[i]=e.getX(t)/p,a>=2&&(y[i+1]=e.getY(t)/p),a>=3&&(y[i+2]=e.getZ(t)/p,4===g&&(y[i+3]=1)),a>=4&&(y[i+3]=e.getW(t)/p)}this.internalFormat=x,this.format=u,this.type=d,this.image.width=b,this.image.height=b,this.image.data=y,this.needsUpdate=!0,this.dispose(),e.itemSize=n,e.count=o}}class o extends n{constructor(){super(),this._forcedType=i.UnsignedIntType}}class a extends n{constructor(){super(),this._forcedType=i.FloatType}}})),parcelRequire.register("5jaKi",(function(e,t){$parcel$export(e.exports,"shaderStructs",(()=>i)),$parcel$export(e.exports,"shaderIntersectFunction",(()=>r));const i="\n#ifndef TRI_INTERSECT_EPSILON\n#define TRI_INTERSECT_EPSILON 1e-5\n#endif\n\n#ifndef INFINITY\n#define INFINITY 1e20\n#endif\n\nstruct BVH {\n\n\tusampler2D index;\n\tsampler2D position;\n\n\tsampler2D bvhBounds;\n\tusampler2D bvhContents;\n\n};\n\n// Note that a struct cannot be used for the hit record including faceIndices, faceNormal, barycoord,\n// side, and dist because on some mobile GPUS (such as Adreno) numbers are afforded less precision specifically\n// when in a struct leading to inaccurate hit results. See KhronosGroup/WebGL#3351 for more details.\n",r="\n\nuvec4 uTexelFetch1D( usampler2D tex, uint index ) {\n\n\tuint width = uint( textureSize( tex, 0 ).x );\n\tuvec2 uv;\n\tuv.x = index % width;\n\tuv.y = index / width;\n\n\treturn texelFetch( tex, ivec2( uv ), 0 );\n\n}\n\nivec4 iTexelFetch1D( isampler2D tex, uint index ) {\n\n\tuint width = uint( textureSize( tex, 0 ).x );\n\tuvec2 uv;\n\tuv.x = index % width;\n\tuv.y = index / width;\n\n\treturn texelFetch( tex, ivec2( uv ), 0 );\n\n}\n\nvec4 texelFetch1D( sampler2D tex, uint index ) {\n\n\tuint width = uint( textureSize( tex, 0 ).x );\n\tuvec2 uv;\n\tuv.x = index % width;\n\tuv.y = index / width;\n\n\treturn texelFetch( tex, ivec2( uv ), 0 );\n\n}\n\nvec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {\n\n\treturn\n\t\tbarycoord.x * texelFetch1D( tex, faceIndices.x ) +\n\t\tbarycoord.y * texelFetch1D( tex, faceIndices.y ) +\n\t\tbarycoord.z * texelFetch1D( tex, faceIndices.z );\n\n}\n\nvoid ndcToCameraRay(\n\tvec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,\n\tout vec3 rayOrigin, out vec3 rayDirection\n) {\n\n\t// get camera look direction and near plane for camera clipping\n\tvec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );\n\tvec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );\n\tfloat near = abs( nearVector.z / nearVector.w );\n\n\t// get the camera direction and position from camera matrices\n\tvec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );\n\tdirection /= direction.w;\n\tdirection = cameraWorld * direction - origin;\n\n\t// slide the origin along the ray until it sits at the near clip plane position\n\torigin.xyz += direction.xyz * near / dot( direction, lookDirection );\n\n\trayOrigin = origin.xyz;\n\trayDirection = direction.xyz;\n\n}\n\nfloat intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax ) {\n\n\t// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/\n\t// https://tavianator.com/2011/ray_box.html\n\tvec3 invDir = 1.0 / rayDirection;\n\n\t// find intersection distances for each plane\n\tvec3 tMinPlane = invDir * ( boundsMin - rayOrigin );\n\tvec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );\n\n\t// get the min and max distances from each intersection\n\tvec3 tMinHit = min( tMaxPlane, tMinPlane );\n\tvec3 tMaxHit = max( tMaxPlane, tMinPlane );\n\n\t// get the furthest hit distance\n\tvec2 t = max( tMinHit.xx, tMinHit.yz );\n\tfloat t0 = max( t.x, t.y );\n\n\t// get the minimum hit distance\n\tt = min( tMaxHit.xx, tMaxHit.yz );\n\tfloat t1 = min( t.x, t.y );\n\n\t// set distance to 0.0 if the ray starts inside the box\n\tfloat dist = max( t0, 0.0 );\n\n\treturn t1 >= dist ? dist : INFINITY;\n\n}\n\nbool intersectsTriangle(\n\tvec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,\n\tout vec3 barycoord, out vec3 norm, out float dist, out float side\n) {\n\n\t// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d\n\tvec3 edge1 = b - a;\n\tvec3 edge2 = c - a;\n\tnorm = cross( edge1, edge2 );\n\n\tfloat det = - dot( rayDirection, norm );\n\tfloat invdet = 1.0 / det;\n\n\tvec3 AO = rayOrigin - a;\n\tvec3 DAO = cross( AO, rayDirection );\n\n\tvec4 uvt;\n\tuvt.x = dot( edge2, DAO ) * invdet;\n\tuvt.y = - dot( edge1, DAO ) * invdet;\n\tuvt.z = dot( AO, norm ) * invdet;\n\tuvt.w = 1.0 - uvt.x - uvt.y;\n\n\t// set the hit information\n\tbarycoord = uvt.wxy; // arranged in A, B, C order\n\tdist = uvt.z;\n\tside = sign( det );\n\tnorm = side * normalize( norm );\n\n\t// add an epsilon to avoid misses between triangles\n\tuvt += vec4( TRI_INTERSECT_EPSILON );\n\n\treturn all( greaterThanEqual( uvt, vec4( 0.0 ) ) );\n\n}\n\nbool intersectTriangles(\n\tBVH bvh, vec3 rayOrigin, vec3 rayDirection, uint offset, uint count,\n\tinout float minDistance,\n\n\t// output variables\n\tout uvec4 faceIndices, out vec3 faceNormal, out vec3 barycoord,\n\tout float side, out float dist\n) {\n\n\tbool found = false;\n\tvec3 localBarycoord, localNormal;\n\tfloat localDist, localSide;\n\tfor ( uint i = offset, l = offset + count; i < l; i ++ ) {\n\n\t\tuvec3 indices = uTexelFetch1D( bvh.index, i ).xyz;\n\t\tvec3 a = texelFetch1D( bvh.position, indices.x ).rgb;\n\t\tvec3 b = texelFetch1D( bvh.position, indices.y ).rgb;\n\t\tvec3 c = texelFetch1D( bvh.position, indices.z ).rgb;\n\n\t\tif (\n\t\t\tintersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )\n\t\t\t&& localDist < minDistance\n\t\t) {\n\n\t\t\tfound = true;\n\t\t\tminDistance = localDist;\n\n\t\t\tfaceIndices = uvec4( indices.xyz, i );\n\t\t\tfaceNormal = localNormal;\n\n\t\t\tside = localSide;\n\t\t\tbarycoord = localBarycoord;\n\t\t\tdist = localDist;\n\n\t\t}\n\n\t}\n\n\treturn found;\n\n}\n\nfloat intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, BVH bvh, uint currNodeIndex ) {\n\n\tvec3 boundsMin = texelFetch1D( bvh.bvhBounds, currNodeIndex * 2u + 0u ).xyz;\n\tvec3 boundsMax = texelFetch1D( bvh.bvhBounds, currNodeIndex * 2u + 1u ).xyz;\n\treturn intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax );\n\n}\n\nbool bvhIntersectFirstHit(\n\tBVH bvh, vec3 rayOrigin, vec3 rayDirection,\n\n\t// output variables\n\tout uvec4 faceIndices, out vec3 faceNormal, out vec3 barycoord,\n\tout float side, out float dist\n) {\n\n\t// stack needs to be twice as long as the deepest tree we expect because\n\t// we push both the left and right child onto the stack every traversal\n\tint ptr = 0;\n\tuint stack[ 60 ];\n\tstack[ 0 ] = 0u;\n\n\tfloat triangleDistance = 1e20;\n\tbool found = false;\n\twhile ( ptr > - 1 && ptr < 60 ) {\n\n\t\tuint currNodeIndex = stack[ ptr ];\n\t\tptr --;\n\n\t\t// check if we intersect the current bounds\n\t\tfloat boundsHitDistance = intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh, currNodeIndex );\n\t\tif ( boundsHitDistance == INFINITY || boundsHitDistance > triangleDistance ) {\n\n\t\t\tcontinue;\n\n\t\t}\n\n\t\tuvec2 boundsInfo = uTexelFetch1D( bvh.bvhContents, currNodeIndex ).xy;\n\t\tbool isLeaf = bool( boundsInfo.x & 0xffff0000u );\n\n\t\tif ( isLeaf ) {\n\n\t\t\tuint count = boundsInfo.x & 0x0000ffffu;\n\t\t\tuint offset = boundsInfo.y;\n\n\t\t\tfound = intersectTriangles(\n\t\t\t\tbvh, rayOrigin, rayDirection, offset, count, triangleDistance,\n\t\t\t\tfaceIndices, faceNormal, barycoord, side, dist\n\t\t\t) || found;\n\n\t\t} else {\n\n\t\t\tuint leftIndex = currNodeIndex + 1u;\n\t\t\tuint splitAxis = boundsInfo.x & 0x0000ffffu;\n\t\t\tuint rightIndex = boundsInfo.y;\n\n\t\t\tbool leftToRight = rayDirection[ splitAxis ] >= 0.0;\n\t\t\tuint c1 = leftToRight ? leftIndex : rightIndex;\n\t\t\tuint c2 = leftToRight ? rightIndex : leftIndex;\n\n\t\t\t// set c2 in the stack so we traverse it later. We need to keep track of a pointer in\n\t\t\t// the stack while we traverse. The second pointer added is the one that will be\n\t\t\t// traversed first\n\t\t\tptr ++;\n\t\t\tstack[ ptr ] = c2;\n\n\t\t\tptr ++;\n\t\t\tstack[ ptr ] = c1;\n\n\t\t}\n\n\t}\n\n\treturn found;\n\n}\n\n"})),parcelRequire.register("8NtlR",(function(e,t){$parcel$export(e.exports,"StaticGeometryGenerator",(()=>y));var i=parcelRequire("4xklQ");const r=new(0,i.Vector3),n=new(0,i.Vector3),o=new(0,i.Vector3),a=new(0,i.Vector4),s=new(0,i.Vector3),l=new(0,i.Vector3),c=new(0,i.Vector4),h=new(0,i.Vector4),d=new(0,i.Matrix4),u=new(0,i.Matrix4);function p(e,t){if(!e&&!t)return;const i=e.count===t.count,r=e.normalized===t.normalized,n=e.array.constructor===t.array.constructor,o=e.itemSize===t.itemSize;if(!(i&&r&&n&&o))throw new Error}function m(e,t=null){const r=e.array.constructor,n=e.normalized,o=e.itemSize,a=null===t?e.count:t;return new(0,i.BufferAttribute)(new r(o*a),o,n)}function f(e,t,i=0){if(e.isInterleavedBufferAttribute){const r=e.itemSize;for(let n=0,o=e.count;n<o;n++){const o=n+i;t.setX(o,e.getX(n)),r>=2&&t.setY(o,e.getY(n)),r>=3&&t.setZ(o,e.getZ(n)),r>=4&&t.setW(o,e.getW(n))}}else{const r=t.array,n=r.constructor,o=r.BYTES_PER_ELEMENT*e.itemSize*i;new n(r.buffer,o,e.array.length).set(e.array)}}function g(e,t,i){const r=e.elements,n=t.elements;for(let e=0,t=n.length;e<t;e++)r[e]+=n[e]*i}function x(e,t,i){const r=e.skeleton,n=e.geometry,o=r.bones,a=r.boneInverses;c.fromBufferAttribute(n.attributes.skinIndex,t),h.fromBufferAttribute(n.attributes.skinWeight,t),d.elements.fill(0);for(let e=0;e<4;e++){const t=h.getComponent(e);if(0!==t){const i=c.getComponent(e);u.multiplyMatrices(o[i].matrixWorld,a[i]),g(d,u,t)}}return d.multiply(e.bindMatrix).premultiply(e.bindMatrixInverse),i.transformDirection(d),i}function b(e,t,i,r,n){s.set(0,0,0);for(let o=0,a=e.length;o<a;o++){const a=t[o],c=e[o];0!==a&&(l.fromBufferAttribute(c,r),i?s.addScaledVector(l,a):s.addScaledVector(l.sub(n),a))}n.add(s)}class y{constructor(e){Array.isArray(e)||(e=[e]);const t=[];e.forEach((e=>{e.traverse((e=>{e.isMesh&&t.push(e)}))})),this.meshes=t,this.useGroups=!0,this.applyWorldTransforms=!0,this.attributes=["position","normal","tangent","uv","uv2"],this._intermediateGeometry=new Array(t.length).fill().map((()=>new(0,i.BufferGeometry)))}getMaterials(){const e=[];return this.meshes.forEach((t=>{Array.isArray(t.material)?e.push(...t.material):e.push(t.material)})),e}generate(e=new(0,i.BufferGeometry)){const{meshes:t,useGroups:r,_intermediateGeometry:n}=this;for(let e=0,i=t.length;e<i;e++){const i=t[e],r=n[e];this._convertToStaticGeometry(i,r)}!function(e,t={useGroups:!1,updateIndex:!1},r=new(0,i.BufferGeometry)){const n=null!==e[0].index,{useGroups:o,updateIndex:a}=t,s=new Set(Object.keys(e[0].attributes)),l={};let c=0;for(let t=0;t<e.length;++t){const i=e[t];let a=0;if(n!==(null!==i.index))throw new Error("StaticGeometryGenerator: All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them.");for(const e in i.attributes){if(!s.has(e))throw new Error('StaticGeometryGenerator: All geometries must have compatible attributes; make sure "'+e+'" attribute exists among all geometries, or in none of them.');void 0===l[e]&&(l[e]=[]),l[e].push(i.attributes[e]),a++}if(a!==s.size)throw new Error("StaticGeometryGenerator: Make sure all geometries have the same number of attributes.");if(o){let e;if(n)e=i.index.count;else{if(void 0===i.attributes.position)throw new Error("StaticGeometryGenerator: The geometry must have either an index or a position attribute");e=i.attributes.position.count}r.addGroup(c,e,t),c+=e}}if(n){let t=!1;if(!r.index){let n=0;for(let t=0;t<e.length;++t)n+=e[t].index.count;r.setIndex(new(0,i.BufferAttribute)(new Uint32Array(n),1,!1)),t=!0}if(a||t){const t=r.index;let i=0,n=0;for(let r=0;r<e.length;++r){const o=e[r],a=o.index;for(let e=0;e<a.count;++e)t.setX(i,a.getX(e)+n),i++;n+=o.attributes.position.count}}}for(const e in l){const t=l[e];if(!(e in r.attributes)){let i=0;for(const e in t)i+=t[e].count;r.setAttribute(e,m(l[e][0],i))}const i=r.attributes[e];let n=0;for(const e in t){const r=t[e];f(r,i,n),n+=r.count}}}(n,{useGroups:r},e);for(const t in e.attributes)e.attributes[t].needsUpdate=!0;return e}_convertToStaticGeometry(e,t=new(0,i.BufferGeometry)){const s=e.geometry,l=this.applyWorldTransforms,c=this.attributes.includes("normal"),h=this.attributes.includes("tangent"),d=s.attributes,u=t.attributes;t.index||(t.index=s.index),u.position||t.setAttribute("position",m(d.position)),c&&!u.normal&&d.normal&&t.setAttribute("normal",m(d.normal)),h&&!u.tangent&&d.tangent&&t.setAttribute("tangent",m(d.tangent)),p(s.index,t.index),p(d.position,u.position),c&&p(d.normal,u.normal),h&&p(d.tangent,u.tangent);const g=d.position,y=c?d.normal:null,w=h?d.tangent:null,v=s.morphAttributes.position,$=s.morphAttributes.normal,M=s.morphAttributes.tangent,S=s.morphTargetsRelative,P=e.morphTargetInfluences,k=new(0,i.Matrix3);k.getNormalMatrix(e.matrixWorld);for(let t=0,i=d.position.count;t<i;t++)r.fromBufferAttribute(g,t),y&&n.fromBufferAttribute(y,t),w&&(a.fromBufferAttribute(w,t),o.fromBufferAttribute(w,t)),P&&(v&&b(v,P,S,t,r),$&&b($,P,S,t,n),M&&b(M,P,S,t,o)),e.isSkinnedMesh&&(e.boneTransform(t,r),y&&x(e,t,n),w&&x(e,t,o)),l&&r.applyMatrix4(e.matrixWorld),u.position.setXYZ(t,r.x,r.y,r.z),y&&(l&&n.applyNormalMatrix(k),u.normal.setXYZ(t,n.x,n.y,n.z)),w&&(l&&o.transformDirection(e.matrixWorld),u.tangent.setXYZW(t,o.x,o.y,o.z,a.w));for(const e in this.attributes){const i=this.attributes[e];"position"!==i&&"tangent"!==i&&"normal"!==i&&i in d&&(u[i]||t.setAttribute(i,m(d[i])),p(d[i],u[i]),f(d[i],u[i]))}return t}}})),parcelRequire.register("cy3as",(function(e,t){$parcel$export(e.exports,"HalfEdgeMap",(()=>a));var i=parcelRequire("4xklQ");const r=[new(0,i.Vector3),new(0,i.Vector3),new(0,i.Vector3)];function n(e){return~~(1e4*e)}function o(e){return`${n(e.x)},${n(e.y)},${n(e.z)}`}class a{constructor(e=null){this.data=null,this.unmatchedEdges=null,this.matchedEdges=null,this.useDrawRange=!0,e&&this.updateFrom(e)}getSiblingTriangleIndex(e,t){const i=this.data[3*e+t];return-1===i?-1:~~(i/3)}getSiblingEdgeIndex(e,t){const i=this.data[3*e+t];return-1===i?-1:i%3}updateFrom(e){const t=new Map,{attributes:i}=e,n=e.index,a=i.position;let s=n?n.count/3:a.count/3;const l=s;let c=0;this.useDrawRange&&(c=e.drawRange.start,e.drawRange.count!==1/0&&(s=~~(e.drawRange.count/3)));let h=this.data;(!h||h.length<3*l)&&(h=new Int32Array(3*l)),h.fill(-1);let d=0,u=0;for(let e=0;e<s;e++){const i=3*e+c;for(let e=0;e<3;e++){let t=i+e;n&&(t=n.getX(t)),r[e].fromBufferAttribute(a,t)}for(let e=0;e<3;e++){const n=(e+1)%3,a=r[e],s=r[n],l=o(a),c=o(s),p=`${c}_${l}`;if(t.has(p)){const r=t.get(p);h[i+e]=r,h[r]=i+e,t.delete(p),d--,u++}else{const r=`${l}_${c}`;t.set(r,i+e),d++}}}this.matchedEdges=u,this.unmatchedEdges=d,this.data=h}}})),parcelRequire.register("14bAY",(function(e,t){function i(){return"undefined"!=typeof SharedArrayBuffer}function r(e){if(e.buffer instanceof SharedArrayBuffer)return e;const t=e.constructor,i=e.buffer,r=new SharedArrayBuffer(i.byteLength),n=new Uint8Array(i);return new Uint8Array(r).set(n,0),new t(r)}$parcel$export(e.exports,"areSharedArrayBuffersSupported",(()=>i)),$parcel$export(e.exports,"convertToSharedArrayBuffer",(()=>r))})),parcelRequire.register("94t2y",(function(e,t){$parcel$export(e.exports,"Evaluator",(()=>h));var i=parcelRequire("4xklQ"),r=parcelRequire("6dW4N"),n=parcelRequire("kY0n3"),o=parcelRequire("9EDRu"),a=parcelRequire("lIlSF"),s=parcelRequire("gKQJE"),l=parcelRequire("6Hryq");function c(e,t){let i=t;return Array.isArray(t)||(i=[],e.forEach((e=>{i[e.materialIndex]=t}))),i}class h{constructor(){this.triangleSplitter=new(0,r.TriangleSplitter),this.attributeData=new(0,n.TypedAttributeData),this.attributes=["position","uv","normal"],this.useGroups=!0,this.debug=new(0,o.OperationDebugData)}evaluate(e,t,r,n=new(0,l.Brush)){e.prepareGeometry(),t.prepareGeometry();const{triangleSplitter:o,attributeData:h,attributes:d,useGroups:u,debug:p}=this,m=n.geometry,f=e.geometry.attributes;for(let e=0,t=d.length;e<t;e++){const t=d[e],i=f[t];h.initializeArray(t,i.array.constructor)}for(const e in h.attributes)d.includes(e)||h.delete(e);for(const e in m.attributes)d.includes(e)||(m.deleteAttribute(e),m.dispose());h.clear(),p.enabled&&(p.reset(),(0,s.setDebugContext)(p)),(0,a.performOperation)(e,t,r,o,h,{useGroups:u}),p.enabled&&(0,s.setDebugContext)(null);const g=u&&0!==e.geometry.groups.length?e.geometry.groups.map((e=>({...e}))):[{start:0,count:1/0,materialIndex:0}],x=u&&0!==t.geometry.groups.length?t.geometry.groups.map((e=>({...e}))):[{start:0,count:1/0,materialIndex:0}],b=c(g,e.material),y=c(x,t.material);x.forEach((e=>{e.materialIndex+=b.length})),function(e,t,r,n){let o=!1,a=-1;const s=n.groupCount,l=e.attributes,c=n.groupAttributes[0];for(const r in c){const h=n.getTotalLength(r,s),d=c[r].type;let u=l[r];if(!u||u.array.length<h){const n=t.attributes[r];u=new(0,i.BufferAttribute)(new d(h),n.itemSize,n.normalized),e.setAttribute(r,u),o=!0}let p=0;for(let e=0;e<s;e++){const{array:t,type:i,length:o}=n.groupAttributes[e][r],a=new i(t.buffer,0,o);u.array.set(a,p),p+=a.length}u.needsUpdate=!0,a=h/u.itemSize}e.setDrawRange(0,a),e.clearGroups();let h=0;for(let t=0;t<s;t++){const i=n.getGroupArray("position",t).length/3;if(0!==i){const n=r[t];e.addGroup(h,i,n.materialIndex),h+=i}}if(e.index){const t=e.index.array;if(t.length<a)e.index=null,o=!0;else for(let e=0,i=t.length;e<i;e++)t[e]=e}e.boundsTree=null,o&&e.dispose()}(m,e.geometry,[...g,...x],h);const w=m.groups;if(u){const e=new Map,t=[...b,...y];let i=0;for(let r=0,n=t.length;r<n;r++){Boolean(w.find((e=>e.materialIndex===r)))?(e.set(r,i),i++):t[r]=null}for(let t=0,i=w.length;t<i;t++){const i=w[t];i.materialIndex=e.get(i.materialIndex)}n.material=t.filter((e=>e))}return n}evaluateHierarchy(e,t=new(0,l.Brush)){e.updateMatrixWorld(!0);const i=(e,t)=>{const r=e.children;for(let e=0,n=r.length;e<n;e++){const n=r[e];n.isOperationGroup?i(n,t):t(n)}},r=e=>{const t=e.children;let n=!1;for(let e=0,i=t.length;e<i;e++){const i=t[e];n=r(i)||n}const o=e.isDirty();if(o&&e.markUpdated(),n&&!e.isOperationGroup){let t;return i(e,(i=>{t=t?this.evaluate(t,i,i.operation):this.evaluate(e,i,i.operation)})),e._cachedGeometry=t.geometry,e._cachedMaterials=t.material,!0}return n||o};return r(e),t.geometry=e._cachedGeometry,t.material=e._cachedMaterials,t}reset(){this.triangleSplitter.reset()}}})),parcelRequire.register("6dW4N",(function(e,t){$parcel$export(e.exports,"TriangleSplitter",(()=>g));var i=parcelRequire("4xklQ"),r=parcelRequire("57zgU"),n=parcelRequire("gKQJE");const o=1e-14,a=1e-7,s=new(0,i.Line3),l=new(0,i.Line3),c=new(0,i.Vector3),h=new(0,i.Vector3),d=new(0,i.Plane),u=new(0,r.ExtendedTriangle);function p(e){return e.a.distanceToSquared(e.b)<o||e.a.distanceToSquared(e.c)<o||e.b.distanceToSquared(e.c)<o}class m extends i.Triangle{constructor(...e){super(...e),this.side=null,this.originalSide=null,this.coplanarCount=0}init(){this.side=null,this.originalSide=null,this.coplanarCount=0}initFrom(e){this.side=e.side,this.originalSide=e.originalSide,this.coplanarCount=e.coplanarCount}updateSide(e,t=null,i=-1){if(null!==this.originalSide&&null===this.side)return;c.copy(this.a).add(this.b).add(this.c).multiplyScalar(1/3);const r=e.distanceToPoint(c)<0?n.BACK_SIDE:n.FRONT_SIDE;t&&-1!==i?r===n.FRONT_SIDE&&(this.coplanarCount++,3===this.coplanarCount&&(this.side=n.COPLANAR)):(null===this.originalSide&&(this.originalSide=r,this.side=r),r!==this.side&&(this.side=null))}}class f{constructor(){this._pool=[],this._index=0}getTriangle(){this._index>=this._pool.length&&this._pool.push(new m);const e=this._pool[this._index++];return e.init(),e}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class g{constructor(){this.trianglePool=new f,this.triangles=[],this.normal=new(0,i.Vector3)}initialize(e){const{triangles:t,trianglePool:i,normal:r}=this;if(t.length=0,i.clear(),Array.isArray(e))for(let n=0,a=e.length;n<a;n++){const a=e[n];if(0===n)a.getNormal(r);else if(Math.abs(1-a.getNormal(c).dot(r))>o)throw new Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");const s=i.getTriangle();s.copy(a),t.push(s)}else{e.getNormal(r);const n=i.getTriangle();n.copy(e),t.push(n)}}splitByTriangle(e){const{normal:t,triangles:i}=this;if(e.getPlane(d),Math.abs(1-Math.abs(d.normal.dot(t)))<a){const r=[e.a,e.b,e.c];for(let i=0;i<3;i++){const n=(i+1)%3,o=r[i],a=r[n];c.subVectors(a,o).normalize(),h.crossVectors(t,c),d.setFromNormalAndCoplanarPoint(h,o),this.splitByPlane(d,e,i)}for(let e=0,t=i.length;e<t;e++){i[e].coplanarCount=0}}else this.splitByPlane(d,e)}splitByPlane(e,t=null,i=-1){const{triangles:r,trianglePool:n}=this;let h=null;null!==t&&(h=u,h.copy(t),h.needsUpdate=!0);for(let t=0,d=r.length;t<d;t++){const u=r[t],{a:m,b:f,c:g}=u;if(h&&(!h.intersectsTriangle(u,s)||s.distance()<1e-5)){u.updateSide(e,h,i),u.side=null;continue}let x=0,b=-1,y=0,w=0,v=!1;const $=[m,f,g];for(let t=0;t<3;t++){const i=(t+1)%3;s.start.copy($[t]),s.end.copy($[i]);const r=e.distanceToPoint(s.start),n=e.distanceToPoint(s.end);Math.abs(r)<o?w++:r>0&&y++,Math.abs(r)<a&&Math.abs(n)<a&&(v=!0);let h=!!e.intersectLine(s,c);!h&&Math.abs(n)<o&&(c.copy(s.end),h=!0),!h||c.distanceTo(s.start)<o||(c.distanceTo(s.end)<o&&(b=t),0===x?l.start.copy(c):l.end.copy(c),x++)}if(!v&&w<2&&2===x&&l.distance()>a)if(-1!==b){b=(b+1)%3;let o=0;o===b&&(o=(o+1)%3);let a=o+1;a===b&&(a=(a+1)%3);const s=n.getTriangle();s.a.copy($[a]),s.b.copy(l.end),s.c.copy(l.start),p(s)||(r.push(s),s.initFrom(u),s.updateSide(e,h,i)),u.a.copy($[o]),u.b.copy(l.start),u.c.copy(l.end),p(u)?(r.splice(t,1),t--,d--):u.updateSide(e,h,i)}else{const o=$.findIndex((t=>y>=2?e.distanceToPoint(t)<0:e.distanceToPoint(t)>0));if(0===o){let e=l.start;l.start=l.end,l.end=e}else if(-1===o)continue;const a=(o+1)%3,s=(o+2)%3,c=n.getTriangle(),m=n.getTriangle();$[a].distanceToSquared(l.start)<$[s].distanceToSquared(l.end)?(c.a.copy($[a]),c.b.copy(l.start),c.c.copy(l.end),m.a.copy($[a]),m.b.copy($[s]),m.c.copy(l.start)):(c.a.copy($[s]),c.b.copy(l.start),c.c.copy(l.end),m.a.copy($[a]),m.b.copy($[s]),m.c.copy(l.end)),u.a.copy($[o]),u.b.copy(l.end),u.c.copy(l.start),p(c)||(r.push(c),c.initFrom(u),c.updateSide(e,h,i)),p(m)||(r.push(m),m.initFrom(u),m.updateSide(e,h,i)),p(u)?(r.splice(t,1),t--,d--):u.updateSide(e,h,i)}else 3===x&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0}}})),parcelRequire.register("gKQJE",(function(e,t){$parcel$export(e.exports,"COPLANAR",(()=>x)),$parcel$export(e.exports,"BACK_SIDE",(()=>b)),$parcel$export(e.exports,"FRONT_SIDE",(()=>y)),$parcel$export(e.exports,"INVERT_TRI",(()=>w)),$parcel$export(e.exports,"ADD_TRI",(()=>v)),$parcel$export(e.exports,"SKIP_TRI",(()=>$)),$parcel$export(e.exports,"setDebugContext",(()=>S)),$parcel$export(e.exports,"getHitSide",(()=>P)),$parcel$export(e.exports,"collectIntersectingTriangles",(()=>k)),$parcel$export(e.exports,"appendAttributeFromTriangle",(()=>_)),$parcel$export(e.exports,"appendAttributesFromIndices",(()=>T)),$parcel$export(e.exports,"getOperationAction",(()=>C));var i=parcelRequire("4xklQ"),r=parcelRequire("iaU8k"),n=parcelRequire("7BJhL");const o=new(0,i.Ray),a=new(0,i.Matrix4),s=new(0,i.Triangle),l=new(0,i.Vector3),c=new(0,i.Vector4),h=new(0,i.Vector4),d=new(0,i.Vector4),u=new(0,i.Vector4),p=new(0,i.Vector4),m=new(0,i.Vector4),f=new(0,i.Line3),g=1e-8,x=0,b=-1,y=1,w=0,v=1,$=2;let M=null;function S(e){M=e}function P(e,t){function r(){return Math.random()-.5}o.origin.copy(e.a).add(e.b).add(e.c).multiplyScalar(1/3),e.getNormal(o.direction);let n=0,a=1/0;for(let e=0;e<3;e++){o.direction.x+=r()*g,o.direction.y+=r()*g,o.direction.z+=r()*g;const s=t.raycastFirst(o,i.DoubleSide);if(Boolean(s&&o.direction.dot(s.face.normal)>0)&&n++,null!==s&&(a=Math.min(a,s.distance)),0===a||n/3>.5||(e-n+1)/3>.5)break}return 0===a?x:n/3>.5?b:y}function k(e,t){const i=new(0,r.IntersectionMap),n=new(0,r.IntersectionMap);return a.copy(e.matrixWorld).invert().multiply(t.matrixWorld),e.geometry.boundsTree.bvhcast(t.geometry.boundsTree,a,{intersectsTriangles:(e,t,r,o)=>(e.intersectsTriangle(t,f)&&f.distance()>1e-5&&(i.add(r,o),n.add(o,r),M&&(M.addEdge(f),M.addIntersectingTriangles(r,e,o,t))),!1)}),{aIntersections:i,bIntersections:n}}function _(e,t,i,r,n,o,a=!1){const l=i.attributes,u=i.index,p=3*e,m=u.getX(p+0),f=u.getX(p+1),g=u.getX(p+2);for(const e in o){const i=l[e],u=o[e];if(!(e in l))throw new Error(`CSG Operations: Attribute ${e} not available on geometry.`);const p=i.itemSize;"position"===e?(s.a.fromBufferAttribute(i,m).applyMatrix4(r),s.b.fromBufferAttribute(i,f).applyMatrix4(r),s.c.fromBufferAttribute(i,g).applyMatrix4(r),A(s.a,s.b,s.c,t,3,u,a)):"normal"===e?(s.a.fromBufferAttribute(i,m).applyNormalMatrix(n),s.b.fromBufferAttribute(i,f).applyNormalMatrix(n),s.c.fromBufferAttribute(i,g).applyNormalMatrix(n),a&&(s.a.multiplyScalar(-1),s.b.multiplyScalar(-1),s.c.multiplyScalar(-1)),A(s.a,s.b,s.c,t,3,u,a,!0)):(c.fromBufferAttribute(i,m),h.fromBufferAttribute(i,f),d.fromBufferAttribute(i,g),A(c,h,d,t,p,u,a))}}function T(e,t,i,r,n,o,a,s=!1){D(e,r,n,o,a,s),D(t,r,n,o,a,s),D(i,r,n,o,a,s)}function C(e,t,i=!1){switch(e){case n.ADDITION:if(t===y||t===x&&i)return v;break;case n.SUBTRACTION:if(i){if(t===b)return w}else if(t===y)return v;break;case n.DIFFERENCE:if(t===b)return w;if(t===y)return v;case n.INTERSECTION:if(t===b||t===x&&i)return v;break;default:throw new Error(`Unrecognized CSG operation enum "${e}".`)}return $}function A(e,t,i,r,n,o,a=!1,s=!1){const l=e=>{o.push(e.x),n>1&&o.push(e.y),n>2&&o.push(e.z),n>3&&o.push(e.w)};u.set(0,0,0,0).addScaledVector(e,r.a.x).addScaledVector(t,r.a.y).addScaledVector(i,r.a.z),p.set(0,0,0,0).addScaledVector(e,r.b.x).addScaledVector(t,r.b.y).addScaledVector(i,r.b.z),m.set(0,0,0,0).addScaledVector(e,r.c.x).addScaledVector(t,r.c.y).addScaledVector(i,r.c.z),s&&(u.normalize(),p.normalize(),m.normalize()),l(u),a?(l(m),l(p)):(l(p),l(m))}function D(e,t,i,r,n,o=!1){for(const a in n){const s=t[a],c=n[a];if(!(a in t))throw new Error(`CSG Operations: Attribute ${a} no available on geometry.`);const h=s.itemSize;"position"===a?(l.fromBufferAttribute(s,e).applyMatrix4(i),c.push(l.x,l.y,l.z)):"normal"===a?(l.fromBufferAttribute(s,e).applyNormalMatrix(r),o&&l.multiplyScalar(-1),c.push(l.x,l.y,l.z)):(c.push(s.getX(e)),h>1&&c.push(s.getY(e)),h>2&&c.push(s.getZ(e)),h>3&&c.push(s.getW(e)))}}})),parcelRequire.register("iaU8k",(function(e,t){$parcel$export(e.exports,"IntersectionMap",(()=>i));class i{constructor(){this.intersectionSet={},this.ids=[]}add(e,t){const{intersectionSet:i,ids:r}=this;i[e]||(i[e]=[],r.push(e)),i[e].push(t)}}})),parcelRequire.register("7BJhL",(function(e,t){$parcel$export(e.exports,"ADDITION",(()=>i)),$parcel$export(e.exports,"SUBTRACTION",(()=>r)),$parcel$export(e.exports,"DIFFERENCE",(()=>n)),$parcel$export(e.exports,"INTERSECTION",(()=>o));const i=0,r=1,n=3,o=4})),parcelRequire.register("kY0n3",(function(e,t){$parcel$export(e.exports,"TypedAttributeData",(()=>r));var i=parcelRequire("84u5U");class r{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(e){return this.groupAttributes[0][e].type}getTotalLength(e){const{groupCount:t,groupAttributes:i}=this;let r=0;for(let n=0;n<t;n++){r+=i[n][e].length}return r}getGroupSet(e=0){const{groupAttributes:t}=this;if(t[e])return this.groupCount=Math.max(this.groupCount,e+1),t[e];const r=t[0];for(this.groupCount=Math.max(this.groupCount,e+1);e>=t.length;){const e={};t.push(e);for(const t in r)e[t]=new(0,i.TypeBackedArray)(r[t].type)}return t[e]}getGroupArray(e,t=0){const{groupAttributes:i}=this;if(!i[0][e])throw new Error(`TypedAttributeData: Attribute with "${e}" has not been initialized`);return this.getGroupSet(t)[e]}initializeArray(e,t){const{groupAttributes:r}=this,n=r[0][e];if(n){if(n.type!==t)throw new Error(`TypedAttributeData: Array ${e} already initialized with a different type.`)}else for(let n=0,o=r.length;n<o;n++)r[n][e]=new(0,i.TypeBackedArray)(t)}clear(){this.groupCount=0;const{groupAttributes:e}=this;e.forEach((e=>{for(const t in e)e[t].clear()}))}delete(e){this.groupAttributes.forEach((t=>{delete t[e]}))}reset(){this.groupAttributes=[]}}})),parcelRequire.register("84u5U",(function(e,t){$parcel$export(e.exports,"TypeBackedArray",(()=>r));var i=parcelRequire("14bAY");class r{constructor(e,t=500){const r=(0,i.areSharedArrayBuffersSupported)()?SharedArrayBuffer:ArrayBuffer;this.expansionFactor=1.5,this.type=e,this.array=new e(new r(t*e.BYTES_PER_ELEMENT)),this.length=0}expand(e=null){const{type:t,array:i,expansionFactor:r}=this;null===e&&(e=~~(i.length*r));const n=new t(e);n.set(i,0),this.array=n}push(...e){let{array:t,length:i}=this;i+e.length>t.length&&(this.expand(),t=this.array);for(let r=0,n=e.length;r<n;r++)t[i+r]=e[r];this.length+=e.length}clear(){this.length=0}}})),parcelRequire.register("9EDRu",(function(e,t){$parcel$export(e.exports,"OperationDebugData",(()=>o));var i=parcelRequire("4xklQ");class r{constructor(e){this.triangle=(new(0,i.Triangle)).copy(e),this.intersects={}}addTriangle(e,t){this.intersects[e]=(new(0,i.Triangle)).copy(t)}getIntersectArray(){const e=[],{intersects:t}=this;for(const i in t)e.push(t[i]);return e}}class n{constructor(){this.data={}}addTriangleIntersection(e,t,i,n){const{data:o}=this;o[e]||(o[e]=new r(t)),o[e].addTriangle(i,n)}getTrianglesAsArray(e=null){const{data:t}=this,i=[];if(null!==e)e in t&&i.push(t[e].triangle);else for(const e in t)i.push(t[e].triangle);return i}getTriangleIndices(){return Object.keys(this.data).map((e=>parseInt(e)))}getIntersectionIndices(e){const{data:t}=this;return t[e]?Object.keys(t[e].intersects).map((e=>parseInt(e))):[]}getIntersectionsAsArray(e=null,t=null){const{data:i}=this,r=new Set,n=[],o=e=>{if(i[e])if(null!==t)i[e].intersects[t]&&n.push(i[e].intersects[t]);else{const t=i[e].intersects;for(const e in t)r.has(e)||(r.add(e),n.push(t[e]))}};if(null!==e)o(e);else for(const e in i)o(e);return n}reset(){this.data={}}}class o{constructor(){this.enabled=!1,this.triangleIntersectsA=new n,this.triangleIntersectsB=new n,this.intersectionEdges=[]}addIntersectingTriangles(e,t,i,r){const{triangleIntersectsA:n,triangleIntersectsB:o}=this;n.addTriangleIntersection(e,t,i,r),o.addTriangleIntersection(i,r,e,t)}addEdge(e){this.intersectionEdges.push(e.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}}})),parcelRequire.register("lIlSF",(function(e,t){$parcel$export(e.exports,"performOperation",(()=>d));var i=parcelRequire("4xklQ"),r=parcelRequire("gKQJE");const n=new(0,i.Matrix4),o=new(0,i.Matrix3),a=new(0,i.Triangle),s=new(0,i.Triangle),l=new(0,i.Triangle),c=new(0,i.Triangle);function h(e){for(const t of e)return t}function d(e,t,i,n,o,a){const{useGroups:s=!0}=a,{aIntersections:l,bIntersections:c}=(0,r.collectIntersectingTriangles)(e,t);let h;return h=s?0:-1,p(e,t,l,i,!1,o,h),u(e,t,l,i,!1,n,o,h),h=s?e.geometry.groups.length||1:-1,p(t,e,c,i,!0,o,h),u(t,e,c,i,!0,n,o,h),{groups:[],materials:null}}function u(e,t,i,l,h,d,u,p=0){n.copy(t.matrixWorld).invert().multiply(e.matrixWorld),o.getNormalMatrix(e.matrixWorld);const m=e.geometry.groupIndices,f=e.geometry.index,g=e.geometry.attributes.position,x=t.geometry.boundsTree,b=t.geometry.index,y=t.geometry.attributes.position,w=i.ids,v=i.intersectionSet;for(let t=0,i=w.length;t<i;t++){const i=w[t],$=-1===p?0:m[i]+p,M=u.getGroupSet($),S=3*i,P=f.getX(S+0),k=f.getX(S+1),_=f.getX(S+2);a.a.fromBufferAttribute(g,P).applyMatrix4(n),a.b.fromBufferAttribute(g,k).applyMatrix4(n),a.c.fromBufferAttribute(g,_).applyMatrix4(n),d.initialize(a);const T=v[i];for(let e=0,t=T.length;e<t;e++){const t=3*T[e],i=b.getX(t+0),r=b.getX(t+1),n=b.getX(t+2);s.a.fromBufferAttribute(y,i),s.b.fromBufferAttribute(y,r),s.c.fromBufferAttribute(y,n),d.splitByTriangle(s)}const C=d.triangles;for(let t=0,n=C.length;t<n;t++){const n=C[t],s=(0,r.getHitSide)(n,x),d=(0,r.getOperationAction)(l,s,h);if(d!==r.SKIP_TRI)switch(a.getBarycoord(n.a,c.a),a.getBarycoord(n.b,c.b),a.getBarycoord(n.c,c.c),d){case r.ADD_TRI:(0,r.appendAttributeFromTriangle)(i,c,e.geometry,e.matrixWorld,o,M);break;case r.INVERT_TRI:(0,r.appendAttributeFromTriangle)(i,c,e.geometry,e.matrixWorld,o,M,!0)}}}return w.length}function p(e,t,i,a,s,c,d=0){n.copy(t.matrixWorld).invert().multiply(e.matrixWorld),o.getNormalMatrix(e.matrixWorld);const u=t.geometry.boundsTree,p=e.geometry.groupIndices,m=e.geometry.index,f=e.geometry.attributes,g=f.position,x=[],b=e.geometry.halfEdges,y=new Set;for(let e=0,t=m.count/3;e<t;e++)e in i.intersectionSet||y.add(e);for(;y.size>0;){const t=h(y);y.delete(t),x.push(t);const i=3*t,w=m.getX(i+0),v=m.getX(i+1),$=m.getX(i+2);l.a.fromBufferAttribute(g,w).applyMatrix4(n),l.b.fromBufferAttribute(g,v).applyMatrix4(n),l.c.fromBufferAttribute(g,$).applyMatrix4(n);const M=(0,r.getHitSide)(l,u),S=(0,r.getOperationAction)(a,M,s);for(;x.length>0;){const t=x.pop(),i=-1===d?0:p[t]+d,n=c.getGroupSet(i);for(let e=0;e<3;e++){const i=b.getSiblingTriangleIndex(t,e);-1!==i&&y.has(i)&&(x.push(i),y.delete(i))}const a=3*t,l=m.getX(a+0),h=m.getX(a+1),u=m.getX(a+2);switch(S){case r.ADD_TRI:(0,r.appendAttributesFromIndices)(l,h,u,f,e.matrixWorld,o,n);break;case r.INVERT_TRI:(0,r.appendAttributesFromIndices)(u,h,l,f,e.matrixWorld,o,n,s)}}}}})),parcelRequire.register("2C75G",(function(e,t){$parcel$export(e.exports,"WallCreator",(()=>o)),$parcel$export(e.exports,"Wall3DGeometry",(()=>a));var i=parcelRequire("4xklQ"),r=(i=parcelRequire("4xklQ"),parcelRequire("hrM0U"));class n extends i.Mesh{constructor(e,t){super(e,t),this.useType="wall",this.parameter={}}computeVertices(){let e=Array.from(this.geometry.attributes.position.array),t=[];for(let r=0;r<e.length;r+=3)t.push(new(0,i.Vector2)(e[r],e[r+1]));this.parameter.points=t}computeLineEquation(){this.isArc,0==this.isArc&&(this.parameter.innerLineEquation=r.CommonFunc.getLineEquation(this.parameter.points[0],this.parameter.points[3]),this.parameter.middleLineEquation=r.CommonFunc.getLineEquation(this.parameter.points[1],this.parameter.points[4]),this.parameter.outerLineEquation=r.CommonFunc.getLineEquation(this.parameter.points[2],this.parameter.points[5])),this.isArc}updateVertex(e,t){let r=this.geometry.attributes.position.array;r[3*e]=t.x,r[3*e+1]=t.y,this.geometry.attributes.position=new(0,i.BufferAttribute)(new Float32Array(r),3);let n=this.geometry.attributes.position.array;this.parameter.points[e]=new(0,i.Vector2)(n[3*e],n[3*e+1]),this.updateMatrix()}updateVertex2(e,t){this.parameter.points.forEach((e=>{e.equals()}))}getIndex(e){for(let t=0;t<this.parameter.points.length;t++)if(this.parameter.points[t].equals(e))return t}}class o{static wallList2D=[];static wallList3D=[];static create2DWall(e){let t=[];for(let i=0;i<e.length;i++)if(e[i].isArc)t.push(e[i]);else{let t=this.create2D(e[i]);this.recordInfo(t,e[i]),t.computeLineEquation(),this.handleIntersection(t),this.wallList2D.push(t)}let n=[];this.wallList2D.forEach((e=>{n.push(e.startPoint,e.endPoint)}));let o=[];for(;t.length>0;){let e=this.getLinkArcJson(n,t);e||(e=t.splice(0,1)[0],n.push(new(0,i.Vector2)(e.start.x,e.start.y),new(0,i.Vector2)(e.end.x,e.end.y)));let a,s,l,c=new(0,i.Vector2)(e.start.x,e.start.y),h=new(0,i.Vector2)(e.end.x,e.end.y),d=!0;if(e.cp)l=new(0,i.Vector2)(e.cp.x,e.cp.y),a=r.CommonFunc.getCircleCenter(l,c,h),s=a.distanceTo(c),d=r.CommonFunc.getClockWise(c,l,h);else{a=c.clone().add(h).divideScalar(2),s=c.distanceTo(a),d=this.getArcClockwise(c,h);let e=c.clone().sub(a);l=d?new(0,i.Vector2)(a.x+e.y,a.y-e.x):new(0,i.Vector2)(a.x-e.y,a.y+e.x)}let u=c.clone().sub(a).angle(),p=h.clone().sub(a).angle(),m=d?2*Math.PI-(p-u):p-u,f=Math.PI*(s-e.thickness/2)*2,g=(Math.round(f*(m/(2*Math.PI))/(1.6*e.thickness)),Math.round(Math.PI/Math.asin(e.thickness/2/(s+e.thickness/2))/2));g=g>100?100:g;let x=this.getArcPoints({type:e.isArc,center:a,radius:s,beginAngle:u,endAngle:p,clockWise:d,pointNum:g,start:c,end:h,controlP:l}),b=[],y=Object.assign({},e);y.isArc=!1;for(let t=0;t<x.length-1;t++){let n=new(0,i.Vector2)(r.CommonFunc.keepDecimalRound(x[t].x,2),r.CommonFunc.keepDecimalRound(x[t].y,2)),o=new(0,i.Vector2)(r.CommonFunc.keepDecimalRound(x[t+1].x,2),r.CommonFunc.keepDecimalRound(x[t+1].y,2));y.start.x=n.x,y.start.y=n.y,y.end.x=o.x,y.end.y=o.y;let s=this.create2D(y);s.isArc=!1,s.arcCenter=a,s.cp=l,s.computeLineEquation(),this.recordInfo(s,e),this.handleIntersection(s),this.wallList2D.push(s),b.push(s)}b.push(c,h),o.push(b)}return this.unionArcWall(o),this.resetWallList2D(this.wallList2D)}static resetWallList2D(){let e=Array.from(this.wallList2D);return this.wallList2D=[],e}static getLinkArcJson(e,t){let r;for(let n=0;n<t.length;n++)if(this.whetherCrossWall(t[n],e)){r=t.splice(n,1)[0],e.push(new(0,i.Vector2)(r.start.x,r.start.y),new(0,i.Vector2)(r.end.x,r.end.y));break}return r}static getArcClockwise(e,t){let i=this.findCrossWall(e,t);i=[...i[0],...i[1]];let n=0,o=0;for(let a=0;a<i.length;a++){let s=i[a],l=s.startPoint.clone().add(s.endPoint).divideScalar(2);r.CommonFunc.getClockWise(e,l,t)?o++:n++}return!(n<o)}static getArcPoints(e){let t;if("circle"==e.type){let r=new(0,i.Path);r.arc(e.center.x,e.center.y,e.radius,e.beginAngle,e.endAngle,e.clockWise),t=r.getPoints(e.pointNum)}if("bezier"===e.type){t=new i.QuadraticBezierCurve3(e.start,e.controlP,e.end).getPoints(e.pointNum)}return t}static unionArcWall(e){for(let t=0;t<e.length;t++){let i=e[t].pop(),r=e[t].pop(),n=[],o=[];for(let i=0;i<e[t].length;i++){let r=Array.from(e[t][i].geometry.attributes.position.array);for(let e=0;e<9;e++)n.push(r[e]);if(i==e[t].length-1)for(let e=9;e<18;e++)n.push(r[e]);o.push(3*i,3*i+3,3*i+4,3*i+1,3*i,3*i+4,3*i+1,3*i+4,3*i+5,3*i+2,3*i+1,3*i+5)}let a=this.createMesh(n,o,e[t][0].material);this.recordInfo(a,e[t][0]),a.wallID=e[t][0].wallID,a.arcCenter=e[t][0].arcCenter,a.cp=e[t][0].cp,a.startPoint=r,a.endPoint=i,this.wallList2D.splice(this.wallList2D.indexOf(e[t][0]),e[t].length),this.wallList2D.push(a)}}static create2D(e){let t=new(0,i.Vector2)(e.start.x,e.start.y),r=new(0,i.Vector2)(e.end.x,e.end.y);var n=(new(0,i.Vector2)).subVectors(t,r);switch(n=new(0,i.Vector2)(-n.y,n.x).normalize().setLength(e.thickness/2),e.line){case 0:var o=t.clone().add(n.clone().negate()),a=t.clone(),s=t.clone().add(n.clone()),l=r.clone().add(n.clone().negate()),c=r.clone(),h=r.clone().add(n.clone());break;case 1:n=n.clone().negate(),o=(a=(s=t.clone()).clone().add(n.clone())).clone().add(n.clone()),l=(c=(h=r.clone()).clone().add(n.clone())).clone().add(n.clone());break;case 2:s=(a=(o=t.clone()).clone().add(n.clone())).clone().add(n.clone()),h=(c=(l=r.clone()).clone().add(n.clone())).clone().add(n.clone())}let d=[];[o,a,s,l,c,h].forEach((e=>{d.push(e.x,e.y,0)}));let u=new(0,i.MeshBasicMaterial)({color:3552822,side:i.DoubleSide,transparent:!0,opacity:.8}),p=this.createMesh(d,[0,3,4,1,0,4,1,4,5,2,1,5],u);return p.position.z=1,p.startPoint=t,p.endPoint=r,p}static createMesh(e,t,r){let o=new(0,i.BufferGeometry);o.attributes.position=new(0,i.BufferAttribute)(new Float32Array(e),3),o.index=new(0,i.BufferAttribute)(new Uint16Array(t),1);let a=new n(o,r);return a.computeVertices(),a.renderOrder=2,a}static recordInfo(e,t){e.line=t.line,e.style=t.style,e.thickness=t.thickness,e.height=t.height,e.wallID=t.id,e.name=t.id,e.offsetXY=t.offsetXY,e.isArc=t.isArc}static handleIntersection(e){let t=e.startPoint.clone(),i=e.endPoint.clone(),[n,o]=this.findCrossWall(t,i);if(n.length>0){let o=[];if(n.length>1&&this.getIntersectAngle(n,t,o),o.length>1){let a=i.clone().sub(t).angle();for(let i=0;i<n.length;i++){let s,l,c,h,d,u=0,p=2,m=e.parameter.innerLineEquation,f=e.parameter.outerLineEquation,g=n[i],[x,b]=[g.startPoint,g.endPoint];x.equals(t)?(s=b.clone().sub(t).angle(),h=g.parameter.outerLineEquation,d=g.parameter.innerLineEquation,l=2,c=0):b.equals(t)&&(s=x.clone().sub(t).angle(),h=g.parameter.innerLineEquation,d=g.parameter.outerLineEquation,l=3,c=5);let[y,w]=this.checkBetweenAngle(o,a,s);if(a<s)if(y){if(!w){let i=r.CommonFunc.getIntersectPoint(f,d,t);this.checkIntersect(i)&&(e.updateVertex(p,i),g.updateVertex(c,i))}}else{let i=r.CommonFunc.getIntersectPoint(m,h,t);this.checkIntersect(i)&&(e.updateVertex(u,i),g.updateVertex(l,i))}else if(y){if(!w){let i=r.CommonFunc.getIntersectPoint(m,h,t);this.checkIntersect(i)&&(e.updateVertex(u,i),g.updateVertex(l,i))}}else{let i=r.CommonFunc.getIntersectPoint(f,d,t);this.checkIntersect(i)&&(e.updateVertex(p,i),g.updateVertex(c,i))}}}else{let i,o,a=n[0],[s,l]=[a.startPoint,a.endPoint];if(e.isArc)if(a.isArc)e.updateVertex(0,a.parameter.points[3]),e.updateVertex(2,a.parameter.points[5]);else{let i,n;s.equals(t)?(i=r.CommonFunc.getIntersectPoint(e.parameter.innerLineEquation,a.parameter.outerLineEquation),n=r.CommonFunc.getIntersectPoint(e.parameter.outerLineEquation,a.parameter.innerLineEquation),this.checkIntersect(i)&&a.updateVertex(2,i),this.checkIntersect(n)&&a.updateVertex(0,n)):l.equals(t)&&(i=r.CommonFunc.getIntersectPoint(e.parameter.innerLineEquation,a.parameter.innerLineEquation),n=r.CommonFunc.getIntersectPoint(e.parameter.outerLineEquation,a.parameter.outerLineEquation),this.checkIntersect(i)&&a.updateVertex(3,i),this.checkIntersect(n)&&a.updateVertex(5,n)),this.checkAndUpdate(e,3,0,i),this.checkAndUpdate(e,5,2,n)}else s.equals(t)?(i=r.CommonFunc.getIntersectPoint(e.parameter.innerLineEquation,a.parameter.outerLineEquation),o=r.CommonFunc.getIntersectPoint(e.parameter.outerLineEquation,a.parameter.innerLineEquation),this.checkIntersect(i)&&a.updateVertex(2,i),this.checkIntersect(o)&&a.updateVertex(0,o)):l.equals(t)&&(i=r.CommonFunc.getIntersectPoint(e.parameter.innerLineEquation,a.parameter.innerLineEquation),o=r.CommonFunc.getIntersectPoint(e.parameter.outerLineEquation,a.parameter.outerLineEquation),this.checkIntersect(i)&&a.updateVertex(3,i),this.checkIntersect(o)&&a.updateVertex(5,o)),this.checkIntersect(i)&&e.updateVertex(0,i),this.checkIntersect(o)&&e.updateVertex(2,o)}}if(o.length>0){let n=[];if(o.length>1&&this.getIntersectAngle(o,i,n),n.length>1){let a=t.clone().sub(i).angle();for(let t=0;t<o.length;t++){let s,l,c,h,d,u=5,p=3,m=e.parameter.outerLineEquation,f=e.parameter.innerLineEquation,g=o[t],[x,b]=[g.startPoint,g.endPoint];x.equals(i)?(s=b.clone().sub(i).angle(),h=g.parameter.outerLineEquation,d=g.parameter.innerLineEquation,l=2,c=0):b.equals(i)&&(s=x.clone().sub(i).angle(),h=g.parameter.innerLineEquation,d=g.parameter.outerLineEquation,l=3,c=5);let[y,w]=this.checkBetweenAngle(n,a,s);if(a<s)if(y){if(!w){let t=r.CommonFunc.getIntersectPoint(f,d,i);this.checkIntersect(t)&&(e.updateVertex(p,t),g.updateVertex(c,t))}}else{let t=r.CommonFunc.getIntersectPoint(m,h,i);this.checkIntersect(t)&&(e.updateVertex(u,t),g.updateVertex(l,t))}else if(y){if(!w){let t=r.CommonFunc.getIntersectPoint(m,h,i);this.checkIntersect(t)&&(e.updateVertex(u,t),g.updateVertex(l,t))}}else{let t=r.CommonFunc.getIntersectPoint(f,d,i);this.checkIntersect(t)&&(e.updateVertex(p,t),g.updateVertex(c,t))}}}else{let t,n,a=o[0],[s,l]=[a.startPoint,a.endPoint];if(e.isArc){if(!a.isArc){let t,n;return s.equals(i)?(t=r.CommonFunc.getIntersectPoint(e.parameter.innerLineEquation,a.parameter.innerLineEquation),n=r.CommonFunc.getIntersectPoint(e.parameter.outerLineEquation,a.parameter.outerLineEquation),this.checkIntersect(t)&&a.updateVertex(0,t),this.checkIntersect(n)&&a.updateVertex(2,n)):l.equals(i)&&(t=r.CommonFunc.getIntersectPoint(e.parameter.innerLineEquation,a.parameter.outerLineEquation),n=r.CommonFunc.getIntersectPoint(e.parameter.outerLineEquation,a.parameter.innerLineEquation),this.checkIntersect(t)&&a.updateVertex(5,t),this.checkIntersect(n)&&a.updateVertex(3,n)),this.checkAndUpdate(e,0,3,t),void this.checkAndUpdate(e,2,5,n)}console.log("arc with arc")}s.equals(i)?(t=r.CommonFunc.getIntersectPoint(e.parameter.innerLineEquation,a.parameter.innerLineEquation),n=r.CommonFunc.getIntersectPoint(e.parameter.outerLineEquation,a.parameter.outerLineEquation),this.checkIntersect(t)&&a.updateVertex(0,t),this.checkIntersect(n)&&a.updateVertex(2,n)):l.equals(i)&&(t=r.CommonFunc.getIntersectPoint(e.parameter.innerLineEquation,a.parameter.outerLineEquation),n=r.CommonFunc.getIntersectPoint(e.parameter.outerLineEquation,a.parameter.innerLineEquation),this.checkIntersect(t)&&a.updateVertex(5,t),this.checkIntersect(n)&&a.updateVertex(3,n)),this.checkIntersect(t)&&e.updateVertex(3,t),this.checkIntersect(n)&&e.updateVertex(5,n)}}}static getIntersectAngle(e,t,i=[]){for(let r=0;r<e.length;r++){let n=e[r].startPoint,o=e[r].endPoint,a=n.equals(t)?o.clone().sub(t):n.clone().sub(t);i.push(a.angle())}return i}static checkBetweenAngle(e,t,i){let r=Math.min(t,i),n=Math.max(t,i),o=!1,a=!1;for(let t=0;t<e.length;t++)e[t]>r&&e[t]<n&&(o=!0),(e[t]<r||e[t]>n)&&(a=!0);return[o,a]}static checkIntersect(e){return 0!=e&&"whole"!=e}static checkAndUpdate(e,t,i,r){if(0==r||"whole"==r)return;let n=e.parameter.points[t],o=e.parameter.points[i];e.updateVertex(i,r),n.y==o.y?n.x>o.x?r.x>n.x&&e.updateVertex(t,r):r.x<n.x&&e.updateVertex(t,r):n.y>o.y?r.y>n.y&&e.updateVertex(t,r):r.y<n.y&&e.updateVertex(t,r)}static findCrossWall(e,t,i=this.wallList2D){let r=[],n=[];for(let o=0;o<i.length;o++)this.whetherCross(e,i[o])&&r.push(i[o]),this.whetherCross(t,i[o])&&n.push(i[o]);return[r,n]}static whetherCross(e,t){let i=t.startPoint,r=t.endPoint;return e.equals(i)||e.equals(r)}static whetherCrossWall(e,t){let r=new(0,i.Vector2)(e.start.x,e.start.y),n=new(0,i.Vector2)(e.end.x,e.end.y);for(let e=0;e<t.length;e++)if(r.equals(t[e])||n.equals(t[e]))return!0}}class a extends i.BufferGeometry{constructor(e){super(),this.type="Wall3DGeometry";let t=e.geometry.attributes.position;const r=this,n=[],o=[],a=[],s=[];let l,c,h=0,d=0,u=new(0,i.Vector3)(0,0,1);if("circle"==e.isArc){l=e.arcCenter?e.arcCenter.distanceTo(e.endPoint):e.startPoint.distanceTo(e.endPoint)/2;let t=e.startPoint.clone().sub(e.arcCenter),i=e.endPoint.clone().sub(e.arcCenter);c=this.getIncludeAngle(t,i)}function p(p){let m=[],f=t.count;if(0==p&&m.push(f-1,f-2,f-3),1==p&&m.push(0,1,2),2==p||3==p){let e=2==p?2:0;for(let t=0;t<f/3;t++)m.push(e+3*t);3==p&&m.reverse()}let g=0,x=0,b=r.getPoint(t,m[0]),y=r.getPoint(t,m[m.length-1]).clone().sub(b),w=new(0,i.Vector3)(y.y,-y.x,0),v=[];m.forEach((i=>{let n=(i=r.getPoint(t,i)).clone();n.z=e.height,v.push(i,n)}));let $,M,S=(new(0,i.Box3)).setFromPoints(v),P=S.max.clone().sub(S.min),k=P.angleTo(u);$=e.isArc&&[2,3].includes(p)?l*c:P.length()*Math.sin(k),M=P.length()*Math.cos(k);let _=$>M?$:M,T=r.getPoint(t,m[m.length-1]);T.z=e.height;let C=1,A=1;for(let i=0;i<m.length;i++)for(let n=0;n<2;n++){let l=r.getPoint(t,m[i]).clone();0==n&&(l.z=e.height),o.push(...l.toArray()),a.push(...w.toArray());let c=T.clone().sub(l),h=c.angleTo(u),d=C+c.length()*Math.sin(h)/_,p=A+c.length()*Math.cos(h)/_;s.push(d,-p),T=l,C=d,A=p,g+=1}for(let e=0;e<m.length-1;e++)for(let t=0;t<1;t++){const i=h+t+2*e,r=h+t+2*(e+1),o=h+(t+1)+2*(e+1),a=h+(t+1)+2*e;n.push(a,r,i),n.push(a,o,r),x+=6}r.addGroup(d,x,p),d+=x,h+=g}function m(i,l,c){i=[];for(let e=0;e<t.count/3;e++)i.push([3*e,3*e+1,3*e+2]);if(5==l)for(let e=0;e<i.length;e++)i[e].reverse();let u=0,p=0;for(let n=0;n<i.length;n++)for(let l=0;l<i[n].length;l++){let h=r.getPoint(t,i[n][l]);o.push(h.x,h.y,"top"==c?e.height:0),a.push(0,0,"btm"==c?-1:1),s.push(l/(i[n].length-1),1-n),u+=1}for(let e=0;e<i.length-1;e++)for(let t=0;t<i[e].length-1;t++){const r=h+t+i[e].length*e,o=h+t+i[e].length*(e+1),a=h+(t+1)+i[e].length*(e+1),s=h+(t+1)+i[e].length*e;n.push(s,o,r),n.push(s,a,o),p+=6}r.addGroup(d,p,l),d+=p,h+=u}p(0),p(1),p(2),p(3),m([[0,1,2],[3,4,5]],4,"top"),m([[2,1,0],[5,4,3]],5,"btm"),this.setIndex(n),this.setAttribute("position",new(0,i.Float32BufferAttribute)(o,3)),this.setAttribute("normal",new(0,i.Float32BufferAttribute)(a,3)),this.setAttribute("uv",new(0,i.Float32BufferAttribute)(s,2))}getPoint(e,t){let r=e.getX(t),n=e.getY(t);if(2==e.itemSize)return new(0,i.Vector2)(r,n);if(3==e.itemSize){let o=e.getZ(t);return new(0,i.Vector3)(r,n,o)}}getIncludeAngle(e,t){let i=Math.atan2(e.y,e.x)-Math.atan2(t.y,t.x);return i<0&&(i=2*Math.PI+i),i}}})),parcelRequire.register("hrM0U",(function(e,t){$parcel$export(e.exports,"CommonFunc",(()=>d));var i=parcelRequire("4xklQ"),r=(i=parcelRequire("4xklQ"),parcelRequire("ia4Lh")),n=parcelRequire("g4HAh"),o=parcelRequire("7WCxl"),a=parcelRequire("7BJhL"),s=parcelRequire("6Hryq"),l=parcelRequire("94t2y"),c=parcelRequire("ckwVR"),h=parcelRequire("jDRRp");class d{constructor(){this.getMiddlePoint=d.getMiddlePoint.bind(this),this.getLineEquation=d.getLineEquation.bind(this),this.getVerticalLineEquation=d.getVerticalLineEquation.bind(this),this.getVecByEquation=d.getVecByEquation.bind(this),this.getProjectVecByEquation=d.getProjectVecByEquation.bind(this),this.getIntersectPoint=d.getIntersectPoint.bind(this),this.getProjectPoint=d.getProjectPoint.bind(this),this.createThreeDimensionLabel=d.createThreeDimensionLabel.bind(this),this.getRandomNum=d.getRandomNum.bind(this),this.arrayTransformToVector=d.arrayTransformToVector.bind(this),this.vectorTransformToArray=d.vectorTransformToArray.bind(this),this.vectorTransformToObject=d.vectorTransformToObject.bind(this),this.filterArray=d.filterArray.bind(this),this.filterObjArray=d.filterObjArray.bind(this),this.removeItemFromArr=d.removeItemFromArr.bind(this),this.keepDecimalRound=d.keepDecimalRound.bind(this),this.isParallel2=d.isParallel2.bind(this),this.isSameDirection2=d.isSameDirection2.bind(this),this.includeUndefined=d.includeUndefined.bind(this),this.transToVector2=d.transToVector2.bind(this),this.transToVector3=d.transToVector3.bind(this),this.findNewItem=d.findNewItem.bind(this),this.isCollinear=d.isCollinear.bind(this),this.getClockWise=d.getClockWise.bind(this),this.getCircleCenter=d.getCircleCenter.bind(this),this.createPoint=d.createPoint.bind(this),this.createLine=d.createLine.bind(this),this.createShapeByPoints=d.createShapeByPoints.bind(this),this.createShape=d.createShape.bind(this)}static boolean(e,t,r="subtract"){"subtract"==r&&(r=a.SUBTRACTION),"union"==r&&(r=a.ADDITION),"intersect"==r&&(r=a.INTERSECTION),e.updateMatrixWorld(!0);let n=new(0,s.Brush)(e.geometry,e.material),o=new(0,s.Brush)(t.geometry,t.material);n.applyMatrix4(e.matrix),o.applyMatrix4(t.matrix),n.updateMatrixWorld(),o.updateMatrixWorld(),n.geometry.computeBoundsTree({maxLeafTris:5,strategy:parseFloat(c.CENTER)}),n.geometry.boundsTree.splitStrategy=c.CENTER,o.geometry.computeBoundsTree({maxLeafTris:5,strategy:parseFloat(c.CENTER)}),o.geometry.boundsTree.splitStrategy=c.CENTER;let h=new(0,l.Evaluator);if(h.attributes=["position","normal"],h.debug.enabled=!0,h.useGroups=!0,r==a.ADDITION||r==a.INTERSECTION){return h.evaluate(n,o,r)}if(r==a.SUBTRACTION){let t=new i.Mesh(new i.BufferGeometry,new i.MeshStandardMaterial({color:16711680,flatShading:!1,polygonOffset:!0,polygonOffsetUnits:.1,polygonOffsetFactor:.1}));return t.castShadow=!0,t.receiveShadow=!0,h.evaluate(n,o,r,t),t.geometry.computeBoundingBox(),t.geometry.center(),t.applyMatrix4(e.matrix),t}}static getMiddlePoint(e,t){if((!e.isVector2||t.isVector2)&&(!e.isVector3||t.isVector3)&&(!e.isVector4||t.isVector4))return e.clone().add(t).divideScalar(2)}static getLineEquation(e,t){let i,r;return Array.isArray(e)&&(e=this.arrayTransformToVector(e)),Array.isArray(t)&&(t=this.arrayTransformToVector(t)),e.x==t.x?(i="X",r=e.x):e.y==t.y?(i="Y",r=e.y):(i=(e.y-t.y)/(e.x-t.x),r=e.y-i*e.x),{slope:i,constant:r}}static getCircleEquation(e,t){return{a:e.x,b:e.y,r:t}}static getNormalVecOffset(e,t,r){var n=(new(0,i.Vector2)).subVectors(t,e);n=new(0,i.Vector2)(-n.y,n.x).normalize().setLength(r);let o=e.clone().add(n),a=t.clone().add(n);return[o.x,o.y,a.x,a.y]}static getVerticalLineEquation(e,t=new(0,i.Vector2)){let r,n;return"X"==e.slope?(r="Y",n=t.y):"Y"==e.slope?(r="X",n=t.x):(r=-1/e.slope,n=t.y-r*t.x),{slope:r,constant:n}}static getVecByEquation(e,t=1){return"X"==e.slope?new(0,i.Vector2)(0,t):"Y"==e.slope?new(0,i.Vector2)(t,0):new(0,i.Vector2)(1,e.slope+e.constant).setLength(t)}static getProjectVecByEquation(e,t=1){let r=this.getVecByEquation(e);return new(0,i.Vector2)(-r.y,r.x).setLength(t)}static getIntersectPoint(e,t,r=!1){if(e.slope==t.slope){if(e.constant!=t.constant){if(Math.abs(e.constant-t.constant)<1){let t=this.getVerticalLineEquation(e,r);return this.getIntersectPoint(t,e)}return!1}if(r){let t=this.getVerticalLineEquation(e,r);return this.getIntersectPoint(t,e)}return"whole"}let n;if("X"==e.slope)n="Y"==t.slope?new(0,i.Vector2)(e.constant,t.constant):new(0,i.Vector2)(e.constant,t.slope*e.constant+t.constant);else if("Y"==e.slope)n="X"==t.slope?new(0,i.Vector2)(t.constant,e.constant):new(0,i.Vector2)((e.constant-t.constant)/t.slope,e.constant);else if("X"==t.slope)n=new(0,i.Vector2)(t.constant,e.slope*t.constant+e.constant);else if("Y"==t.slope)n=new(0,i.Vector2)((t.constant-e.constant)/e.slope,t.constant);else{let r=(t.constant-e.constant)/(e.slope-t.slope),o=e.slope*r+e.constant;t.slope,t.constant;n=new(0,i.Vector2)(r,o)}return n}static getIntersectPoint2(e,t){let r=Object.assign({},e);r.slope="Y"==e.slope?0:"X"==e.slope?1/0:e.slope;let n=-2*(r.slope*r.constant-r.slope*t.b-t.a),o=(2*(r.slope*r.constant-r.slope*t.b-t.a))**2-4*(1+r.slope**2)*(t.a**2+(r.constant-t.b)**2-t.r**2),a=2*(1+r.slope**2),s=(n+o**.5)/a,l=(n-o**.5)/a;return[new(0,i.Vector2)(s,r.slope*s+r.constant),new(0,i.Vector2)(l,r.slope*l+r.constant)]}static getProjectPoint(e,t){let r;if(e.r){let n=new i.Vector2(e.a,e.b),o=new i.Vector2(t.x,t.y),a=d.getLineEquation(n,o);n.distanceTo(o),e.r;let s=this.getIntersectPoint2(a,e);console.log("res",s),r=o.distanceTo(s[0])<o.distanceTo(s[1])?s[0]:s[1]}else{let i=this.getVerticalLineEquation(e,t);r=this.getIntersectPoint(e,i)}return r}static createThreeDimensionLabel(e,t,r=0){e=new(0,i.Vector3)(e.x,e.y,e.z),t=new(0,i.Vector3)(t.x,t.y,t.z);let n=this.getLineEquation(e,t),o=this.getVerticalLineEquation(n,t),a="X"==o.slope?0:"Y"==o.slope?1/0:o.slope,s=new(0,i.Vector3)(.1*Math.sin(Math.atan(a))/2,.1*Math.cos(Math.atan(a))/2),l=t.clone().add(s),c=t.clone().add(s.negate()),h=new(0,i.LineSegments)((new(0,i.BufferGeometry)).setFromPoints([e,t,l,c]),new(0,i.MeshBasicMaterial)({color:r,side:i.DoubleSide,depthTest:!1}));return h.name="label",h.labelLength=e.distanceTo(t),h.center=e.clone().add(t).divideScalar(2),h}static getRandomNum(e,t){return Math.floor(Math.random()*(t-e+1))+e}static arrayTransformToVector(e){return 2==e.length?new(0,i.Vector2)(e[0],e[1]):3==e.length?new(0,i.Vector3)(e[0],e[1],e[2]):4==e.length?new(0,i.Vector4)(e[0],e[1],e[2],e[3]):void console.log("Check Array length again.")}static vectorTransformToArray(e,t=3){if(e.isVector2){if(2==t)return[e.x,e.y];if(3==t)return[e.x,e.y,0];if(4==t)return[e.x,e.y,0,0]}if(e.isVector3){if(2==t)return[e.x,e.y];if(3==t)return[e.x,e.y,e.z];if(4==t)return[e.x,e.y,e.z,0]}if(e.isVector4){if(2==t)return[e.x,e.y];if(3==t)return[e.x,e.y,e.z];if(4==t)return[e.x,e.y,e.z,e.w]}if(Array.isArray(e)){let i=[];return e.forEach((e=>{i.push(...this.vectorTransformToArray(e,t))})),i}}static vectorTransformToObject(e,t=!1,i=!0){let r={};return e.isVector2&&(i&&(r.x=e.x,r.y=e.y),t&&(r.X=e.x,r.Y=e.y)),e.isVector3&&(i&&(r.x=e.x,r.y=e.y,r.z=e.z),t&&(r.X=e.x,r.Y=e.y,r.Z=e.z)),e.isVector4&&(i&&(r.x=e.x,r.y=e.y,r.z=e.z,r.w=e.w),t&&(r.X=e.x,r.Y=e.y,r.Z=e.z,r.W=e.w)),r}static filterArray(e){let t=[];return e.forEach((e=>{let i=!0;t.forEach((r=>{r?e[0]===r[0]&&e[1]===r[1]&&(i=!1):t.push(e)})),i&&t.push(e)})),t}static filterArray2(e){const t=[];return e.forEach((e=>{let i=!0;t.forEach((r=>{r?(e[0]===r[0]&&e[1]===r[1]&&(i=!1),e[0]===r[1]&&e[1]===r[0]&&(i=!1)):t.push(e)})),i&&t.push(e)})),t}static isInclude(e,t){for(let i=0;i<e.length;i++)if(e[i].equals(t))return!0;return!1}static filterArray3(e){let t=[];return e.forEach((e=>{let i=!0;t.forEach((r=>{r?e.equals(r)&&(i=!1):t.push(e)})),i&&t.push(e)})),t}static getIndex(e,t){for(let i=0;i<e.length;i++)if(t[0]==e[i][0]&&t[1]==e[i][1])return i;return!1}static filterObjArray(e){let t=[],i={};for(let r of e)i[r]||(t.push(r),i[r]=1);return t}static isEqualArray(e,t){if(e.length!=t.length)return!1;let i=Array.from(e),r=0;for(var n of t)if(Array.isArray(n)){for(let e of t)if(e.length==n.length){let t=!0;for(let i=0;i<e.length;i++)-1==n.indexOf(e[i])&&(t=!1);t&&r++}}else i.includes(n)&&r++;return r==i.length}static whetherSameItemExist(e,t){for(let i=0;i<e.length;i++){let r=e[i];for(let e=0;e<t.length;e++){let n=t[e];if(r.x==n.x&&r.y==n.y)return[i,e]}}return!1}static compareArray(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!=t[i])return!1;return!0}static removeItemFromArr(e,t){e.splice(e.indexOf(t),1)}static keepDecimalRound(e,t){return Math.round(e*10**t)/10**t}static isParallel2(e,t){return e.angle()%Math.PI==t.angle()%Math.PI}static isSameDirection2(e,t){return e.angle()%(2*Math.PI)==t.angle()%(2*Math.PI)}static isParallel3(){}static includeUndefined(e){for(let t=0;t<e.length;t++)if(Array.isArray(e[t])){let i=this.includeUndefined(e[t]);if(i)return i}else if(null==e[t])return!0;return!1}static transToVector2(e){return new(0,i.Vector2)(e.x,e.y)}static transToVector3(e){return e.isVector2?new(0,i.Vector3)(e.x,e.y,0):e.isVector3?e:new(0,i.Vector3)(e.x,e.y,e.y)}static findNewItem(e,t){for(let i=0;i<e.length;i++)if(-1==t.indexOf(e[i]))return e[i]}static isCollinear(e,t,i){e=this.transToVector2(e.clone()),t=this.transToVector2(t.clone()),i=this.transToVector2(i.clone());let r=this.getLineEquation(e,t),n=this.getLineEquation(t,i);return r.slope==n.slope&&r.constant==n.constant}static getClockWise(e,t,i){e=this.transToVector2(e.clone()),t=this.transToVector2(t.clone()),i=this.transToVector2(i.clone());let r=(t.x-e.x)*(i.y-t.y)-(t.y-e.y)*(i.x-t.x);return 0==r?0:r<0}static getCircleCenter(e,t,i){if(this.isCollinear(e,t,i))return;let r=this.getVerticalLineEquation(this.getLineEquation(e,t),this.getMiddlePoint(e,t)),n=this.getVerticalLineEquation(this.getLineEquation(t,i),this.getMiddlePoint(t,i));return this.getIntersectPoint(r,n)}static createFloor3D(e,t){let r=new(0,i.Shape);r.moveTo(e[0].x,e[0].y);for(let t=1;t<e.length;t++)r.lineTo(e[t].x,e[t].y);if(r.lineTo(e[0].x,e[0].y),0==window.floorDep){let n=new(0,i.ShapeGeometry)(r),o=new(0,i.MeshStandardMaterial)({map:t});this.recomputeUV(n);let a=new(0,h.Floor3D)(n,o);return a.allPoints=e,a}const n={steps:2,depth:window.floorDep,bevelEnabled:!1},o=new i.ExtrudeGeometry(r,n),a=new(0,i.MeshStandardMaterial)({map:t});this.recomputeUV(o);let s=new(0,h.Floor3D)(o,a);return s.geometry.translate(0,0,-window.floorDep),s.allPoints=e,s}static recomputeUV(e){let t=e.attributes.position.array,r=e.attributes.normal.array,n=e.attributes.uv,o={};for(let e=0;e<r.length;e+=3){let n=`${r[e]}_${r[e+1]}_${r[e+2]}`,a=new(0,i.Vector3)(t[e],t[e+1],t[e+2]);o[n]?o[n].push({index:e/3,vertex:a}):o[n]=[{index:e/3,vertex:a}]}let a=new(0,i.Vector3)(1,0,0),s=new(0,i.Vector3)(0,0,1);for(let e in o){let t=e.split("_").map((e=>parseFloat(e))),r=(new(0,i.Vector3)).fromArray(t),l=[];for(let t=0;t<o[e].length;t++)l.push(o[e][t].vertex);let c,h,d=(new(0,i.Box3)).setFromPoints(l),u=d.max.clone().sub(d.min),p=Math.PI/2-u.angleTo(s),m=this.getOriginP(l,r);for(let t=0;t<o[e].length;t++){let i=o[e][t],r=i.vertex.clone().sub(m),l=0==p?r.angleTo(a):Math.PI/2-r.angleTo(s);c=r.length()*Math.cos(l),h=r.length()*Math.sin(l),n.setXY(i.index,c/960,h/960)}}}static getOriginP(e,t){let r=new(0,i.Vector3),n=(new(0,i.Box3)).setFromPoints(e),o=new(0,i.Vector3)(1,0,0),a=new(0,i.Vector3)(0,1,0),s=new(0,i.Vector3)(0,0,1);if(t.equals(s))r=n.min;else if(t.equals(s.negate()))r=n.max;else if(t.equals(o))r=n.min;else if(t.equals(o.negate()))r=new(0,i.Vector3)(n.max.x,n.max.y,n.min.z);else if(t.equals(a))r=new(0,i.Vector3)(n.max.x,n.max.y,n.min.z);else if(t.equals(a.negate()))r=n.min;else{let e=t.angleTo(o),s=t.angleTo(a);console.log("normal - angleX - angleY - ",t,e,s),e<Math.PI/2&&s<Math.PI/2&&(r=new(0,i.Vector3)(n.min.x,n.max.y,n.min.z)),e<Math.PI/2&&s>Math.PI/2&&(r=n.max),e>Math.PI/2&&s<Math.PI/2&&(r=n.min),e>Math.PI/2&&s>Math.PI/2&&(r=new(0,i.Vector3)(n.max.x,n.min.y,n.min.y))}return r}static between(e,t,i){let r,n;return t>i?(r=t,n=i):(r=i,n=t),e<=r&&e>=n}static createPoint(e={},t,r){let n=e.radius||10,o=new(0,i.SphereGeometry)(n),a=new(0,i.Mesh)(o,r);return a.position.set(t.x,t.y,t.z),a}static createLine(e,t={}){t.color=t.color||0,t.linewidth=t.linewidth||1.5,t.dashed=t.dashed||!1;let i=[];e.forEach((e=>{i.push(...d.transToVector3(e).toArray())}));let a=(new(0,n.LineGeometry)).setPositions(i),s=new(0,o.LineMaterial)(t);s.resolution.set(window.innerWidth,window.innerHeight);let l=new(0,r.Line2)(a,s);return l.computeLineDistances(),l}static createShapeByPoints(e,t=!1){let r=new(0,i.Shape);if(r.moveTo(e[e.length-1].x,e[e.length-1].y),e.forEach((e=>{r.lineTo(e.x,e.y)})),!t)return r;let n=new(0,i.ShapeGeometry)(r);return new(0,i.Mesh)(n,t)}static createShape(e,t,r){let n=new(0,i.BufferGeometry);return n.attributes.position=new(0,i.BufferAttribute)(new Float32Array(e),3),n.index=new(0,i.BufferAttribute)(new Uint16Array(t),1),new(0,i.Mesh)(n,r)}static createCone(e={},t=0){e.radius||=1,e.height||=1,e.radialSegments||=8,e.heightSegments||=1,e.openEnded||=!1,e.thetaStart||=0,e.thetaLength||=2*Math.PI;let r=new(0,i.ConeGeometry)(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength),n=new(0,i.MeshBasicMaterial)({color:t});return new(0,i.Mesh)(r,n)}static getJsonLength(e){let t=0;for(let i in e)t++;return t}static contrastVec(e,t){return this.getJsonLength(e)==this.getJsonLength(t)&&2==this.getJsonLength(e)?e.x==t.x&&e.y==t.y:this.getJsonLength(e)==this.getJsonLength(t)&&3==this.getJsonLength(e)?e.x==t.x&&e.y==t.y&&e.z==t.z:void 0}}})),parcelRequire.register("jDRRp",(function(e,t){$parcel$export(e.exports,"Floor3D",(()=>n));var i=parcelRequire("4xklQ"),r=(i=parcelRequire("4xklQ"),parcelRequire("hrM0U"));i.Mesh;class n extends i.Mesh{constructor(e,t){super(e,t),this.type="Floor3D"}refresh(){let e=Object.assign({},this.geometry.parameters.options);this.geometry.parameters.shapes;e.depth=window.floorDep,this.geometry.dispose();let t=r.CommonFunc.createFloor3D(this.allPoints,this.material.map);this.geometry=t.geometry.clone(),t.geometry.dispose()}computeUVs(){}changeMaterial(){}}})),parcelRequire.register("5sV3G",(function(module,exports){$parcel$export(module.exports,"DigHole",(()=>DigHole));var $4xklQ=parcelRequire("4xklQ");parcelRequire("jPMpS");var $cTA6h=parcelRequire("cTA6h"),$hu0fb=parcelRequire("hu0fb"),$9QhXH=parcelRequire("9QhXH"),$4xgHd=parcelRequire("4xgHd"),$7BJhL=parcelRequire("7BJhL"),$6Hryq=parcelRequire("6Hryq"),$94t2y=parcelRequire("94t2y"),$4J2OP=parcelRequire("4J2OP"),$ckwVR=parcelRequire("ckwVR");$4xklQ.BufferGeometry.prototype.computeBoundsTree=$4J2OP.computeBoundsTree,$4xklQ.BufferGeometry.prototype.disposeBoundsTree=$4J2OP.disposeBoundsTree;class DigHole{constructor(e){this.scene=e.wallGroup3D,this.editor=e;let t=this.editor.config.uvGridTexture;t.wrapS=$4xklQ.RepeatWrapping,t.wrapT=$4xklQ.RepeatWrapping,this.material=new $4xklQ.MeshBasicMaterial({map:t}),this.resultObject=new $4xklQ.Mesh(new $4xklQ.BufferGeometry,new $4xklQ.MeshStandardMaterial({color:16711680,flatShading:!1,polygonOffset:!0,polygonOffsetUnits:.1,polygonOffsetFactor:.1})),this.resultObject.castShadow=!0,this.resultObject.receiveShadow=!0,this.tmpM=new $4xklQ.Mesh(new $4xklQ.BoxGeometry(1,1,1),new $4xklQ.MeshBasicMaterial({color:16711680})),this.tmpM.position.set(-1,-1,-1)}resetResultObj(){this.resultObject.geometry=new $4xklQ.BufferGeometry}workOld(e,t){let i=[];for(let r=0;r<t.length;r++){let n,o,a,s=t[r];if(e.forEach((function(e,t){e.wallID==s.wallID&&(n=e,o=t)})),n){let e=n.startPoint,t=n.endPoint;if(s.isArc){let i,r,o=e.clone().add(t).divideScalar(2),l=o.distanceTo(n.startPoint);switch(n.line){case 0:i=l-n.thickness/2-1,r=l+n.thickness/2+1;break;case 1:i=l-1,r=l+n.thickness+1;break;case 2:i=l-n.thickness-1,r=l+1}let c=this.createArcMesh(o,i,r,s.startRadian,s.endRadian,s.height,s.positionZ);a=this.boolean(n,c),s.path&&this.createArcWindow(i,r,n,s)}else{let i=e.clone().add(t).divideScalar(2);i=new $4xklQ.Vector3(i.x,i.y,n.height/2);let r=t.clone().sub(e).angle(),o=new $4xklQ.Vector3(s.location.x,s.location.y,s.location.z),l=this.createBooleanMesh(s.width,s.height,s.windowThick+2,s.withSector,r);l.position.set(o.x,o.y,o.z),a=this.boolean(n,l),s.path&&a&&this.placeWindow(this.scene,s,n,o,r)}a&&(this.paramInherit(a,n),this.recomputeUVs(a),i.push(a))}}return this.scene}work(e,t){let i=[],r=[];for(let i=0;i<t.length;i++){let n=t[i];for(let t=0;t<e.length;t++)if(e[t].wallID==n.wallID){r[t]?r[t].push(n):r[t]=[n];break}}for(let t=0;t<e.length;t++){let n=[],o=e[t];if(r[t]){let e=o.startPoint,a=o.endPoint;if(o.isArc)for(let e=0;e<r[t].length;e++){let i,a,s=r[t][e],l=o.arcCenter,c=Math.round(100*l.distanceTo(new $4xklQ.Vector2(1e3*o.startPoint.x,1e3*o.startPoint.y)))/100;switch(o.line){case 0:i=c-1e3*o.thickness/2-1,a=c+1e3*o.thickness/2+1;break;case 1:i=c-1,a=c+1e3*o.thickness+1;break;case 2:i=c-1e3*o.thickness-1,a=c+1}let h=this.createArcMesh(l,i-1,a+1,s.startRadian,s.endRadian,s.height,s.positionZ);h.updateMatrix(),n.push(h),this.place3DWindow(this.scene,s,o)}else for(let i=0;i<r[t].length;i++){let s=r[t][i],l=a.clone().sub(e).angle();(s.masterAngle||0==s.masterAngle)&&(l=s.masterAngle);let c,h=new $4xklQ.Vector3(s.location.x,s.location.y,s.location.z);"UWindow"==s.dir&&(s.path="uWindow"),"dooropen"==s.dir&&(s.path="dooropen"),s.path&&(s.path.includes("LWindow")&&(s.width+=2*s.diff),this.place3DWindow(this.scene,s,o,h,l)),("UWindow"==s.dir||s.path)&&(s.windowThick+=1e3*o.thickness,s.windowThickL+=1e3*o.thickness,s.windowThickR+=1e3*o.thickness),s.path.includes("uWindow")?(c=this.createUWindowBooleanMesh(s,l,h),c.geometry.translate(0,-(s.windowThickL-1200)/2,0)):c=this.createBooleanMesh(s.width,s.height,s.windowThick+2,s.withSector,l),c.position.add(h),c.updateMatrix(),n.push(c)}let s=n[0];1==n.length&&(s=this.boolean(s,this.tmpM,"union"));for(let e=1;e<n.length;e++)s=this.boolean(s,n[e],"union");let l=this.boolean(o,s);this.scene.add(l),l?(this.paramInherit(l,o),i.push(l)):console.log("boolean error",r[t],o)}}return this.scene}place3DWindow(e,t,i,r,n){let o,a=new $4xklQ.Group;if(t.path.includes("baseDoor")&&(a=$4xgHd.Entry3D.createBaseDoor({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:n,editor:this.editor}),"rightSide"!=t.doorDir&&"leftSide"!=t.doorDir||(a.rotation.y+=Math.PI)),t.path.includes("doubleOpenDoor")&&(a=$4xgHd.Entry3D.createDoubleOpenDoor({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:n,editor:this.editor})),t.path.includes("slidingDoor")&&(a=$4xgHd.Entry3D.createSlidingDoor({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:n,editor:this.editor})),t.path.includes("baseWindow")&&(a=$4xgHd.Entry3D.createBaseWindow({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:n,style:1,editor:this.editor})),t.path.includes("frenchWindow")&&(a=$4xgHd.Entry3D.createFrenchWindow({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:n,editor:this.editor})),t.path.includes("lashDoor")&&(a=$4xgHd.Entry3D.createLashDoor({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:n,editor:this.editor}),"rightSide"!=t.doorDir&&"leftSide"!=t.doorDir||(a.rotation.y+=Math.PI)),t.path.includes("pass")&&(a=$4xgHd.Entry3D.createPass({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:n,editor:this.editor})),t.path.includes("sectorDoor")&&(a=$4xgHd.Entry3D.createSectorDoor({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:n,editor:this.editor,arcHei:t.arcHei})),t.path.includes("sectorWindow")&&(a=$4xgHd.Entry3D.createSectorWindow({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:n,editor:this.editor})),t.path.includes("arcWindow")&&(a=$4xgHd.Entry3D.createArcWindow({hole:t,wall:i,editor:this.editor})),t.path.includes("LWindow")){if(this.info=this.info||[],t.path.includes("left"))if(0==this.info.length)this.info.push({leftWidth:t.width-t.diff,leftDepth:i.thickness/2*1e3,leftSP:new $4xklQ.Vector2(1e3*i.startPoint.x,1e3*i.startPoint.y),leftEP:new $4xklQ.Vector2(1e3*i.endPoint.x,1e3*i.endPoint.y),commonPoint:t.commonPoint});else{let e=!0;for(let r=0;r<this.info.length;r++)if(this.info[r].commonPoint.x==t.commonPoint.x&&this.info[r].commonPoint.y==t.commonPoint.y&&this.info[r].commonPoint.z==t.commonPoint.z){let n=new $4xklQ.Vector2(1e3*i.startPoint.x,1e3*i.startPoint.y),o=new $4xklQ.Vector2(1e3*i.endPoint.x,1e3*i.endPoint.y);e=!1,this.info[r].leftWidth=t.width-t.diff,this.info[r].leftDepth=i.thickness/2*1e3,this.info[r].leftSP=n,this.info[r].leftEP=o}e&&this.info.push({leftWidth:t.width-t.diff,leftDepth:i.thickness/2*1e3,leftSP:new $4xklQ.Vector2(1e3*i.startPoint.x,1e3*i.startPoint.y),leftEP:new $4xklQ.Vector2(1e3*i.endPoint.x,1e3*i.endPoint.y),commonPoint:t.commonPoint})}if(t.path.includes("right"))if(0==this.info.length)this.info.push({rightWidth:t.width-t.diff,rightDepth:i.thickness/2*1e3,rightSP:new $4xklQ.Vector2(1e3*i.startPoint.x,1e3*i.startPoint.y),rightEP:new $4xklQ.Vector2(1e3*i.endPoint.x,1e3*i.endPoint.y),commonPoint:t.commonPoint});else{let e=!0;for(let r=0;r<this.info.length;r++)if(this.info[r].commonPoint.x==t.commonPoint.x&&this.info[r].commonPoint.y==t.commonPoint.y&&this.info[r].commonPoint.z==t.commonPoint.z){let n=new $4xklQ.Vector2(1e3*i.startPoint.x,1e3*i.startPoint.y),o=new $4xklQ.Vector2(1e3*i.endPoint.x,1e3*i.endPoint.y);e=!1,this.info[r].rightWidth=t.width-t.diff,this.info[r].rightDepth=i.thickness/2*1e3,this.info[r].rightSP=n,this.info[r].rightEP=o}e&&this.info.push({rightWidth:t.width-t.diff,rightDepth:i.thickness/2*1e3,rightSP:new $4xklQ.Vector2(1e3*i.startPoint.x,1e3*i.startPoint.y),rightEP:new $4xklQ.Vector2(1e3*i.endPoint.x,1e3*i.endPoint.y),commonPoint:t.commonPoint})}let e=[];for(let i=0;i<this.info.length;i++){let n=this.info[i];n.leftSP&&n.rightSP&&(n.leftSP.equals(n.rightSP)||n.leftSP.equals(n.rightEP)?(n.commonPoint=n.leftSP,n.leftVec=n.leftEP.clone().sub(n.leftSP).normalize(),n.leftSP.equals(n.rightSP)?n.rightVec=n.rightEP.clone().sub(n.leftSP).normalize():n.rightVec=n.leftSP.clone().sub(n.rightEP).normalize()):(n.commonPoint=n.leftEP,n.leftVec=n.leftSP.clone().sub(n.leftEP).normalize(),n.leftEP.equals(n.rightSP)?n.rightVec=n.rightEP.clone().sub(n.rightSP).normalize():n.rightVec=n.rightSP.clone().sub(n.rightEP).normalize()),a=$4xgHd.Entry3D.createLWindow({leftPoint:n.commonPoint.clone().add(n.leftVec.setLength(n.leftWidth)),rightPoint:n.commonPoint.clone().add(n.rightVec.setLength(n.rightWidth)),commonPoint:n.commonPoint,height:t.height,leftDepth:n.leftDepth,rightDepth:n.rightDepth,position:r,editor:this.editor}),e.push(n))}e.forEach((e=>{this.info.splice(this.info.indexOf(e),1)}))}if(t.path.includes("panoramicWindow")&&(a=$4xgHd.Entry3D.createPanoramicWindow({width:t.width,height:t.height,position:r,thickness:1e3*i.thickness,rotAngle:n,editor:this.editor})),(t.path.includes("uWindow")||"UWindow"==t.dir)&&(this.uwInfo=this.uwInfo||{wallArr:[],wallList:[],editor:this.editor},this.uwInfo.wallArr.push(t.wallID),t.path.includes("uWindow")&&!t.dir?this.uwInfo.middleWall=i:this.uwInfo.wallList.push(i),this.uwInfo.width||(this.uwInfo.width=t.width,this.uwInfo.height=t.height,this.uwInfo.windowThick=t.windowThick,this.uwInfo.windowThickL=t.windowThickL,this.uwInfo.windowThickR=t.windowThickR,this.uwInfo.rotAngle=n,this.uwInfo.position=r),t.uuid&&(this.uwInfo.uuid=t.uuid),3==this.uwInfo.wallArr.length&&(a=$4xgHd.Entry3D.createUWindow(this.uwInfo),t.uuid=this.uwInfo.uuid,delete this.uwInfo)),"dooropen"==t.path&&(a=$4xgHd.Entry3D.createDooropen({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:n,editor:this.editor})),a.parameter){for(let e=0;e<this.editor.otherMeshs.length;e++)if(this.editor.otherMeshs[e].uuid==t.uuid){o=this.editor.otherMeshs[e];break}o&&a.parameter&&(a.parameter.tdm=o),o&&(o.parameter=[a]),a.modelType="CodeModel",a.modelPath=t.path,a.isLock=t.isLock,e.add(a)}}createBooleanMesh(e,t,i,r,n){r&&(t-=e/2);let o=new $4xklQ.MeshBasicMaterial({color:255,side:$4xklQ.DoubleSide}),a=new $4xklQ.Mesh(new $4xklQ.BoxGeometry(e,i,t),o);if(r){var s=new $4xklQ.Mesh(new $4xklQ.CylinderGeometry(e/2,e/2,i,50),o);s.position.add(new $4xklQ.Vector3(0,0,t/2)),s.updateMatrix(),a.material=new $4xklQ.MeshBasicMaterial({color:65520,side:$4xklQ.DoubleSide}),a=this.boolean(a,s,"union")}return a.geometry.computeBoundingBox(),a.geometry.center(),a.rotateZ(n),a}createUWindowBooleanMesh(e,t,i){let r=new $4xklQ.MeshBasicMaterial({color:16711680,side:$4xklQ.DoubleSide}),n=new $4xklQ.MeshBasicMaterial({color:65280,side:$4xklQ.DoubleSide}),o=new $4xklQ.Mesh(new $4xklQ.BoxGeometry(e.width/2+1,e.windowThickL+10,e.height),r);o.geometry.translate(-e.width/4,-(e.windowThickL-1200)/2,0);let a=new $4xklQ.Mesh(new $4xklQ.BoxGeometry(e.width/2+1,e.windowThickR+10,e.height),n);a.geometry.translate(e.width/4,-(e.windowThickR-1200)/2,0);let s=this.boolean(o,a,"union");return s.geometry.computeBoundingBox(),s.geometry.center(),s.geometry.translate(0,10,0),s.rotateZ(t),s}createArcMesh(e,t,i,r,n,o,a){var s=new $4xklQ.Path;s.arc(e.x,e.y,t,r,n,!1);let l=Math.round(Math.PI/Math.asin(120/(t+120))/2);l=l>100?100:l;var c=s.getPoints(l),h=new $4xklQ.Path;h.arc(e.x,e.y,i,r,n,!1);let d=Math.round(Math.PI/Math.asin(120/(t+120))/2);d=d>100?100:d;var u=h.getPoints(d),p=c.concat(u.reverse()),m=p.shift(),f=new $4xklQ.Shape;f.moveTo(m.x,m.y),p.forEach((function(e){f.lineTo(e.x,e.y)})),f.lineTo(m.x,m.y);var g={steps:2,depth:o,bevelEnabled:!1,bevelThickness:1,bevelSize:1,bevelSegments:1},x=new $4xklQ.ExtrudeGeometry(f,g),b=new $4xklQ.MeshBasicMaterial({color:16777215*Math.random()}),y=new $4xklQ.Mesh(x,b);y.geometry.computeBoundingBox();var w=y.geometry.boundingBox.min,v=y.geometry.boundingBox.max,$=w.clone().add(v).divideScalar(2);return y.geometry.center(),y.position.set($.x,$.y,a-1e-5),y}booleanBack(e,t,i="subtract"){e.updateMatrix(),t.updateMatrix();let r=$cTA6h.CSG.fromMesh(e),n=$cTA6h.CSG.fromMesh(t);var o;if("union"==i)o=r.union(n);else{if(0==r.intersect(n).polygons.length)return!1;"subtract"==i&&(o=r.subtract(n)),"intersect"==i&&(o=r.intersect(n))}let a=$cTA6h.CSG.toMesh(o,e.matrix,e.material);return this.scene.remove(e),a}boolean(e,t,i="subtract"){"subtract"==i&&(i=$7BJhL.SUBTRACTION),"union"==i&&(i=$7BJhL.ADDITION),"intersect"==i&&(i=$7BJhL.INTERSECTION),e.updateMatrixWorld(!0);let r=new(0,$6Hryq.Brush)(e.geometry,e.material),n=new(0,$6Hryq.Brush)(t.geometry,t.material);r.applyMatrix4(e.matrix),n.applyMatrix4(t.matrix),r.updateMatrixWorld(),n.updateMatrixWorld(),r.geometry.computeBoundsTree({maxLeafTris:5,strategy:parseFloat($ckwVR.CENTER)}),r.geometry.boundsTree.splitStrategy=$ckwVR.CENTER,n.geometry.computeBoundsTree({maxLeafTris:5,strategy:parseFloat($ckwVR.CENTER)}),n.geometry.boundsTree.splitStrategy=$ckwVR.CENTER,this.scene.remove(e);let o=new(0,$94t2y.Evaluator);if(o.attributes=["position","normal"],o.debug.enabled=!0,o.useGroups=!0,i==$7BJhL.ADDITION||i==$7BJhL.INTERSECTION){return o.evaluate(r,n,i)}if(i==$7BJhL.SUBTRACTION){let t=new $4xklQ.Mesh(new $4xklQ.BufferGeometry,new $4xklQ.MeshStandardMaterial({color:16711680,flatShading:!1,polygonOffset:!0,polygonOffsetUnits:.1,polygonOffsetFactor:.1}));return t.castShadow=!0,t.receiveShadow=!0,o.evaluate(r,n,i,t),t.geometry.computeBoundingBox(),t.geometry.center(),t.applyMatrix4(e.matrix),t}}paramInherit(target,origin){target.layers.mask=origin.layers.mask,["line","name","style","isArc","height","wallID","offsetXY","thickness","startPoint","endPoint","modelType","arcCenter","origin3DWall"].forEach((function(item){eval("target."+item+"= origin."+item)}))}placeWindow(e,t,i,r,n){if(t.path.includes("LWindow"))return void this.createLWindow(e,t,i,r,n);let o=this.editor;(new(0,$hu0fb.GLTFLoader)).load(t.path,(function(a){var s=a.scene,l=(new $4xklQ.Box3).setFromObject(s),c=l.max.x-l.min.x,h=l.max.y-l.min.y,d=l.max.z-l.min.z,u=t.width,p=t.height,m=t.windowThick;if(t.withSector&&(p+=u/2),-1!=t.path.indexOf("WaveWindow")){m=3*i.thickness;var f=new $4xklQ.Vector3(vector.y,-vector.x,0).setLength(i.thickness);s.position.add(f);var g=u;if(-1!=t.path.indexOf("leftLWaveWindow")){f=vector.negate();u=2e3*(u-i.thickness)/1420,f=new $4xklQ.Vector3(f.x,f.y,0).setLength((u-g)/2),s.position.add(f)}-1!=t.path.indexOf("rightLWaveWindow")&&(u=2e3*(u-i.thickness)/1420,f=new $4xklQ.Vector3(vector.x,vector.y,0).setLength((u-g)/2),s.position.add(f))}if(s.scale.set(u/c,p/h,m/d),s.rotateX(Math.PI/2),s.rotateY(n),-1!=t.path.indexOf("panoramicWindow")){let e=new $4xklQ.Vector3(0,(m-i.thickness)/2,0),t=(new $4xklQ.Matrix4).makeRotationZ(n);s.position.add(e.applyMatrix4(t))}let x;s.position.add(r),o.addBoxForMesh(s,[]),s.layers.set(2),s.traverse((function(e){e.layers.set(2)})),s.modelPath=t.path;for(let e=0;e<o.otherMeshs.length;e++)if(o.otherMeshs[e].uuid==t.uuid){x=o.otherMeshs[e];break}x&&(s.parameter={tdm:x},s.isLock=!1,x.isLock&&(s.isLock=x.isLock)),s.modelType="CodeModel",e.add(s)}))}createArcWindow(e,t,i,r){let n=i.arcCenter;var o=(e+t)/2,a=o-i.thickness/4,s=o+i.thickness/4,l=this.createArcMesh(n,a,s,r.startRadian,r.endRadian,r.height,r.positionZ);l.material=new $4xklQ.MeshStandardMaterial({color:new $4xklQ.Color(.0385,.0385,.0385),roughness:.9,metalness:.1,normalScale:new $4xklQ.Vector2(1,-1)}),this.scene.add(l);var c=50,h=c/a,d=r.startRadian+h,u=r.endRadian-h,p=r.height-2*c,m=this.createArcMesh(n,a-1,s+1,d,u,p,r.positionZ);let f=this.boolean(l,m);this.scene.add(f),h=(c-=1)/a,d=r.startRadian+h,u=r.endRadian-h,p=r.height-2*c;var g=o-i.thickness/8,x=o+i.thickness/8,b=this.createArcMesh(n,g,x,d,u,p,r.positionZ);b.material=new $4xklQ.MeshStandardMaterial({color:new $4xklQ.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new $4xklQ.Vector2(1,-1),side:2,transparent:!0,opacity:.64,roughness:.9}),this.scene.add(b)}createLWindow(e,t,i,r,n){let o,a,s,l=50;if(t.path.includes("leftLWindow")){let e=new $4xklQ.Vector2(-t.width/2,i.thickness/2),r=new $4xklQ.Vector2(t.width/2,i.thickness/2),n=new $4xklQ.Vector2(t.width/2-t.diff,0),c=new $4xklQ.Vector2(-t.width/2,0);o=$9QhXH.DM.createShapeByPointArr([e,r,n,c],"shape");let h=new $4xklQ.Vector2(-t.width/2+l,i.thickness/2),d=new $4xklQ.Vector2(t.width/2-t.diff,i.thickness/2),u=new $4xklQ.Vector2(t.width/2-t.diff,0),p=new $4xklQ.Vector2(-t.width/2+l,0);a=$9QhXH.DM.createShapeByPointArr([h,d,u,p],"shape");let m=new $4xklQ.Vector2(-t.width/2+l-10,3*i.thickness/8),f=new $4xklQ.Vector2(t.width/2-t.diff/4,3*i.thickness/8),g=new $4xklQ.Vector2(t.width/2-3*t.diff/4,i.thickness/8),x=new $4xklQ.Vector2(-t.width/2+l-10,i.thickness/8);s=$9QhXH.DM.createShapeByPointArr([m,f,g,x],"shape")}if(t.path.includes("rightLWindow")){let e=new $4xklQ.Vector2(-t.width/2,i.thickness/2),r=new $4xklQ.Vector2(t.width/2,i.thickness/2),n=new $4xklQ.Vector2(t.width/2,0),c=new $4xklQ.Vector2(-t.width/2+t.diff,0);o=$9QhXH.DM.createShapeByPointArr([e,r,n,c],"shape");let h=new $4xklQ.Vector2(-t.width/2+t.diff,i.thickness/2),d=new $4xklQ.Vector2(t.width/2-l,i.thickness/2),u=new $4xklQ.Vector2(t.width/2-l,0),p=new $4xklQ.Vector2(-t.width/2+t.diff,0);a=$9QhXH.DM.createShapeByPointArr([h,d,u,p],"shape");let m=new $4xklQ.Vector2(-t.width/2+t.diff/4,3*i.thickness/8),f=new $4xklQ.Vector2(t.width/2-l+10,3*i.thickness/8),g=new $4xklQ.Vector2(t.width/2-l+10,i.thickness/8),x=new $4xklQ.Vector2(-t.width/2+3*t.diff/4,i.thickness/8);s=$9QhXH.DM.createShapeByPointArr([m,f,g,x],"shape")}let c=new $4xklQ.MeshStandardMaterial({color:new $4xklQ.Color(.0385,.0385,.0385),roughness:.9,metalness:.1,normalScale:new $4xklQ.Vector2(1,-1)}),h=this.createMeshByParam(t.height,o,c);h.position.set(r.x,r.y,r.z-t.height/2),h.rotation.z=n,e.add(h);let d=this.createMeshByParam(t.height-100,a,c);d.position.set(r.x,r.y,r.z-(t.height-100)/2),d.rotation.z=n;let u=this.boolean(h,d);e.add(u);let p=new $4xklQ.MeshStandardMaterial({color:new $4xklQ.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new $4xklQ.Vector2(1,-1),side:2,transparent:!0,opacity:.64,roughness:.9}),m=t.height-100+20,f=this.createMeshByParam(m,s,p);f.position.set(r.x,r.y,r.z-m/2),f.rotation.z=n,e.add(f)}createMeshByParam(e,t,i){let r={steps:2,depth:e,bevelEnabled:!1,bevelThickness:1,bevelSize:1,bevelSegments:1},n=new $4xklQ.ExtrudeGeometry(t,r);return new $4xklQ.Mesh(n,i)}recomputeUVs(e){let t=e.startPoint,i=e.endPoint,r=Array.from(e.geometry.attributes.position.array),n=[],o=[];for(let e=0;e<r.length/3;e++)n.push(new $4xklQ.Vector3(r[3*e],r[3*e+1],r[3*e+2]));for(let e=0;e<n.length/3;e++)o.push([n[3*e],n[3*e+1],n[3*e+2]]);let a=[],s=[];if(e.isArc){let r=t.clone().add(i).divideScalar(2);r=new $4xklQ.Vector2(1e3*r.x,1e3*r.y);let n=t.distanceTo(i)/2*Math.PI,l=(new $4xklQ.Matrix3).setUvTransform(0,0,n/1024,e.height/1024,0,0,0);e.geometry.attributes.uv.applyMatrix3(l),o.forEach((function(t){var i=t[0],n=t[1],o=t[2];i.applyMatrix4(e.matrixWorld),n.applyMatrix4(e.matrixWorld),o.applyMatrix4(e.matrixWorld);var l=new $4xklQ.Vector3(r.x,r.y,n.z).sub(n),c=l.clone().negate(),h=o.clone().sub(n),d=i.clone().sub(n),u=h.cross(d).normalize(),p=180*u.angleTo(l)/Math.PI,m=180*u.angleTo(c)/Math.PI;p<6&&a.push(...t),m<6&&s.push(...t)}))}else{let r=t.distanceTo(i),n=(new $4xklQ.Matrix3).setUvTransform(0,0,r/1024,e.height/1024,0,0,0);e.geometry.attributes.uv.applyMatrix3(n);let l=i.clone().sub(t).normalize(),c=new $4xklQ.Vector3;0==l.y?c.x=0:c.x=-Math.round(1e3*l.y)/1e3,0==l.x?c.y=0:c.y=Math.round(1e3*l.x)/1e3;let h=c.clone().negate();for(let t=0;t<o.length;t++){let i=o[t][0],r=o[t][1],n=o[t][2];i.applyMatrix4(e.matrixWorld),r.applyMatrix4(e.matrixWorld),n.applyMatrix4(e.matrixWorld);let l=n.clone().sub(r),d=i.clone().sub(r),u=l.cross(d).normalize();0==u.x?u.x=0:u.x=Math.round(1e3*u.x)/1e3,0==u.y?u.y=0:u.y=Math.round(1e3*u.y)/1e3,0==u.z?u.z=0:u.z=Math.round(1e3*u.z)/1e3,u.equals(c)&&a.push(...o[t]),u.equals(h)&&s.push(...o[t])}}let l=[],c=[];a.forEach((function(e){l.push(n.indexOf(e))})),s.forEach((function(e){c.push(n.indexOf(e))}));var h=[],d=Math.min(...l),u=Math.max(...c);let p=new $4xklQ.MeshStandardMaterial({color:"#9e9b9b"}),m=[p,p,p];0!=d&&h.push({start:0,count:d,materialIndex:0});for(var f=l[0],g=l[0],x=[],b=1,y=1;b<l.length;b++)l[b]-g==1?y++:(x.push({start:f,count:y,materialIndex:1}),x.push({start:l[b-1]+1,count:l[b]-l[b-1]-1,materialIndex:0}),f=l[b],y=1),g=l[b],b==l.length-1&&x.push({start:f,count:y,materialIndex:1});h.push(...x);f=c[0],g=c[0];var w=[];for(b=1,y=1;b<c.length;b++)c[b]-g==1?y++:(w.push({start:f,count:y,materialIndex:2}),w.push({start:c[b-1]+1,count:c[b]-c[b-1]-1,materialIndex:0}),f=c[b],y=1),g=c[b],b==c.length-1&&w.push({start:f,count:y,materialIndex:2});h.push(...w),h.push({start:u+1,count:r.length/3-u-1,materialIndex:0}),e.geometry.groups=h,e.material=m}}DigHole.prototype.boolean=DigHole.prototype.booleanBack})),parcelRequire.register("jPMpS",(function(e,t){$parcel$export(e.exports,"CSG",(()=>parcelRequire("cTA6h").CSG));var i=parcelRequire("4xklQ"),r=parcelRequire("cTA6h");parcelRequire("i56yD");let{BufferGeometry:n,Vector3:o,Vector2:a}=i;r.CSG.fromGeometry=function(e,t){let i=[];if(e.isGeometry){let n=e.faces,o=e.vertices,a=["a","b","c"];for(let s=0;s<n.length;s++){let l=n[s],c=[];for(let t=0;t<3;t++)c.push(new(0,r.Vertex)(o[l[a[t]]],l.vertexNormals[t],e.faceVertexUvs[0][s][t]));i.push(new(0,r.Polygon)(c,t))}}else if(e.isBufferGeometry){let n,o=e.attributes.position,a=e.attributes.normal,s=e.attributes.uv,l=e.attributes.color;if(e.index)n=e.index.array;else{n=new Array(o.array.length/o.itemSize|0);for(let e=0;e<n.length;e++)n[e]=e}let c=n.length/3|0;i=new Array(c);for(let e=0,c=0,h=n.length;e<h;e+=3,c++){let h=new Array(3);for(let t=0;t<3;t++){let i=n[e+t],c=3*i,d=2*i,u=o.array[c],p=o.array[c+1],m=o.array[c+2],f=a.array[c],g=a.array[c+1],x=a.array[c+2];h[t]=new(0,r.Vertex)({x:u,y:p,z:m},{x:f,y:g,z:x},s&&{x:s.array[d],y:s.array[d+1],z:0},l&&{x:l.array[d],y:l.array[d+1],z:l.array[d+2]})}i[c]=new(0,r.Polygon)(h,t)}}else console.error("Unsupported CSG input type:"+e.type);return r.CSG.fromPolygons(i)};let s=new i.Vector3,l=new i.Matrix3;r.CSG.fromMesh=function(e,t){e.geometry.computeVertexNormals();let i=r.CSG.fromGeometry(e.geometry,t);l.getNormalMatrix(e.matrix);for(let t=0;t<i.polygons.length;t++){let r=i.polygons[t];for(let t=0;t<r.vertices.length;t++){let i=r.vertices[t];i.pos.copy(s.copy(i.pos).applyMatrix4(e.matrix)),i.normal.copy(s.copy(i.normal).applyMatrix3(l))}}return i};let c=e=>({top:0,array:new Float32Array(e),write:function(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y,this.array[this.top++]=e.z}}),h=e=>({top:0,array:new Float32Array(e),write:function(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y}});r.CSG.toGeometry=function(e,t=!0){let r,n,o=e.polygons;if(t){let e=0;o.forEach((t=>e+=t.vertices.length-2)),r=new i.BufferGeometry;let t,a,s=c(9*e),l=c(9*e),d=[];if(o.forEach((i=>{let r=i.vertices,n=r.length;void 0!==i.shared&&(d[i.shared]||(d[i.shared]=[])),n&&(void 0!==r[0].color&&(a||(a=c(9*e))),void 0!==r[0].uv&&(t||(t=h(6*e))));for(let e=3;e<=n;e++)void 0!==i.shared&&d[i.shared].push(s.top/3,s.top/3+1,s.top/3+2),s.write(r[0].pos),s.write(r[e-2].pos),s.write(r[e-1].pos),l.write(r[0].normal),l.write(r[e-2].normal),l.write(r[e-1].normal),t&&r[0].uv&&(t.write(r[0].uv)||t.write(r[e-2].uv)||t.write(r[e-1].uv)),a&&(a.write(r[0].color)||a.write(r[e-2].color)||a.write(r[e-1].color))})),r.setAttribute("position",new i.BufferAttribute(s.array,3)),r.setAttribute("normal",new i.BufferAttribute(l.array,3)),t&&r.setAttribute("uv",new i.BufferAttribute(t.array,2)),a&&r.setAttribute("color",new i.BufferAttribute(a.array,3)),d.length){let e=[],t=0;for(let i=0;i<d.length;i++)r.addGroup(t,d[i].length,i),t+=d[i].length,e=e.concat(d[i]);r.setIndex(e)}n=r}else{r=new Geometry;let e=r.vertices,t=r.faceVertexUvs[0];for(let n=0;n<o.length;n++){let a=o[n],s=a.vertices,l=e.length,c=s.length;for(let t=0;t<c;t++)e.push((new i.Vector3).copy(s[t].pos));for(let e=3;e<=c;e++){let n=new i.Face3,o=[];t.push(o);let c=n.vertexNormals;n.a=l,n.b=l+e-2,n.c=l+e-1,c.push((new i.Vector3).copy(s[0].normal)),c.push((new i.Vector3).copy(s[e-2].normal)),c.push((new i.Vector3).copy(s[e-1].normal)),o.push((new i.Vector3).copy(s[0].uv)),o.push((new i.Vector3).copy(s[e-2].uv)),o.push((new i.Vector3).copy(s[e-1].uv)),n.normal=(new i.Vector3).copy(a.plane.normal),r.faces.push(n)}}r=(new i.BufferGeometry).fromGeometry(r),r.verticesNeedUpdate=r.elementsNeedUpdate=r.normalsNeedUpdate=!0}return r},r.CSG.toMesh=function(e,t,n){let o=r.CSG.toGeometry(e),a=(new i.Matrix4).copy(t).invert();o.applyMatrix4(a),o.computeBoundingSphere(),o.computeBoundingBox();let s=new i.Mesh(o,n);return s.matrix.copy(t),s.matrix.decompose(s.position,s.quaternion,s.scale),s.rotation.setFromQuaternion(s.quaternion),s.updateMatrixWorld(),s.castShadow=s.receiveShadow=!0,s}})),parcelRequire.register("cTA6h",(function(e,t){$parcel$export(e.exports,"CSG",(()=>i)),$parcel$export(e.exports,"Vertex",(()=>a)),$parcel$export(e.exports,"Polygon",(()=>l));class i{constructor(){this.polygons=[]}clone(){let e=new i;return e.polygons=this.polygons.map((e=>e.clone())),e}toPolygons(){return this.polygons}union(e){let t=new c(this.clone().polygons),r=new c(e.clone().polygons);return t.clipTo(r),r.clipTo(t),r.invert(),r.clipTo(t),r.invert(),t.build(r.allPolygons()),i.fromPolygons(t.allPolygons())}subtract(e){let t=new c(this.clone().polygons),r=new c(e.clone().polygons);return t.invert(),t.clipTo(r),r.clipTo(t),r.invert(),r.clipTo(t),r.invert(),t.build(r.allPolygons()),t.invert(),i.fromPolygons(t.allPolygons())}intersect(e){let t=new c(this.clone().polygons),r=new c(e.clone().polygons);return t.invert(),r.clipTo(t),r.invert(),t.clipTo(r),r.clipTo(t),t.build(r.allPolygons()),t.invert(),i.fromPolygons(t.allPolygons())}inverse(){let e=this.clone();return e.polygons.forEach((e=>e.flip())),e}}i.fromPolygons=function(e){let t=new i;return t.polygons=e,t};class r{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new r(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}times(e){return this.x*=e,this.y*=e,this.z*=e,this}dividedBy(e){return this.x/=e,this.y/=e,this.z/=e,this}lerp(e,t){return this.add(n.copy(e).sub(this).times(t))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(this.x**2+this.y**2+this.z**2)}normalize(){return this.unit()}cross(e){let t=this;const i=t.x,r=t.y,n=t.z,o=e.x,a=e.y,s=e.z;return this.x=r*s-n*a,this.y=n*o-i*s,this.z=i*a-r*o,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}}let n=new r,o=new r;class a{constructor(e,t,i,n){this.pos=(new r).copy(e),this.normal=(new r).copy(t),i&&(this.uv=(new r).copy(i))&&(this.uv.z=0),n&&(this.color=(new r).copy(n))}clone(){return new a(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(e,t){return new a(this.pos.clone().lerp(e.pos,t),this.normal.clone().lerp(e.normal,t),this.uv&&e.uv&&this.uv.clone().lerp(e.uv,t),this.color&&e.color&&this.color.clone().lerp(e.color,t))}}class s{constructor(e,t){this.normal=e,this.w=t}clone(){return new s(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(e,t,i,r,o){let a=0,c=[];for(let t=0;t<e.vertices.length;t++){let i=this.normal.dot(e.vertices[t].pos)-this.w,r=i<-s.EPSILON?2:i>s.EPSILON?1:0;a|=r,c.push(r)}switch(a){case 0:(this.normal.dot(e.plane.normal)>0?t:i).push(e);break;case 1:r.push(e);break;case 2:o.push(e);break;case 3:let a=[],s=[];for(let t=0;t<e.vertices.length;t++){let i=(t+1)%e.vertices.length,r=c[t],o=c[i],l=e.vertices[t],h=e.vertices[i];if(2!=r&&a.push(l),1!=r&&s.push(2!=r?l.clone():l),3==(r|o)){let e=(this.w-this.normal.dot(l.pos))/this.normal.dot(n.copy(h.pos).sub(l.pos)),t=l.interpolate(h,e);a.push(t),s.push(t.clone())}}a.length>=3&&r.push(new l(a,e.shared)),s.length>=3&&o.push(new l(s,e.shared))}}}s.EPSILON=1e-5,s.fromPoints=function(e,t,i){let r=n.copy(t).sub(e).cross(o.copy(i).sub(e)).normalize();return new s(r.clone(),r.dot(e))};class l{constructor(e,t){this.vertices=e,this.shared=t,this.plane=s.fromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){return new l(this.vertices.map((e=>e.clone())),this.shared)}flip(){this.vertices.reverse().forEach((e=>e.flip())),this.plane.flip()}}class c{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)}clone(){let e=new c;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map((e=>e.clone())),e}invert(){for(let e=0;e<this.polygons.length;e++)this.polygons[e].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();let e=this.front;this.front=this.back,this.back=e}clipPolygons(e){if(!this.plane)return e.slice();let t=[],i=[];for(let r=0;r<e.length;r++)this.plane.splitPolygon(e[r],t,i,t,i);return this.front&&(t=this.front.clipPolygons(t)),i=this.back?this.back.clipPolygons(i):[],t.concat(i)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}build(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());let t=[],i=[];for(let r=0;r<e.length;r++)this.plane.splitPolygon(e[r],this.polygons,this.polygons,t,i);t.length&&(this.front||(this.front=new c),this.front.build(t)),i.length&&(this.back||(this.back=new c),this.back.build(i))}}i.fromJSON=function(e){return i.fromPolygons(e.polygons.map((e=>new l(e.vertices.map((e=>new a(e.pos,e.normal,e.uv))),e.shared))))}})),parcelRequire.register("i56yD",(function(e,t){var i=parcelRequire("cTA6h");let r,n,o=!1,a=0,s={},l=()=>o?r&&!r.busy?(r.busy=!0,{then:e=>e(r)}):{then:function(){return this}}:(o=!0,fetch("../csg-lib.js").then((function(e){return e.text().then((function(e){e=e.slice(0,e.lastIndexOf("export"));const t=new Blob([e+"\n                    self.onmessage=(message)=>{\n                    let task = JSON.parse(message.data)\n                    //console.log(\"Got task:\"+task.op+' '+task.taskId)\n                    postMessage(JSON.stringify({\n                        taskId:task.taskId,\n                        result : CSG.fromJSON(task.a)[task.op](CSG.fromJSON(task.b))\n                    }))\n                }\n                console.log('CSG worker started!')"],{type:"application/javascript"});n=URL.createObjectURL(t)})).then((()=>(()=>{const e=new Worker(n);return e.onmessage=function(e){let t=JSON.parse(e.data),n=s[t.taskId];delete s[t.taskId],n.resolve(i.CSG.fromJSON(t.result)),r.busy=!1},r={worker:e,busy:!1}})()))})));i.CSG.doAsync=(e,t,i)=>l().then((r=>{let n={a:e,op:t,b:i,taskId:a};return s[a]=n,a++,n.result=new Promise(((e,t)=>{n.resolve=e,r.busy=!0,r.worker.postMessage(JSON.stringify(n))})),n.result}))})),parcelRequire.register("hu0fb",(function(e,t){$parcel$export(e.exports,"GLTFLoader",(()=>r));var i=parcelRequire("4xklQ");class r extends i.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new c(e)})),this.register((function(e){return new g(e)})),this.register((function(e){return new x(e)})),this.register((function(e){return new d(e)})),this.register((function(e){return new u(e)})),this.register((function(e){return new p(e)})),this.register((function(e){return new m(e)})),this.register((function(e){return new l(e)})),this.register((function(e){return new f(e)})),this.register((function(e){return new h(e)})),this.register((function(e){return new a(e)})),this.register((function(e){return new b(e)}))}load(e,t,r,n){const o=this;let a;a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:i.LoaderUtils.extractUrlBase(e),this.manager.itemStart(e);const s=function(t){n?n(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},l=new(0,i.FileLoader)(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,(function(i){try{o.parse(i,a,(function(i){t(i),o.manager.itemEnd(e)}),s)}catch(e){s(e)}}),r,s)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,n){let a;const l={},c={};if("string"==typeof e)a=e;else{if(i.LoaderUtils.decodeText(new Uint8Array(e,0,4))===y){try{l[o.KHR_BINARY_GLTF]=new $(e)}catch(e){return void(n&&n(e))}a=l[o.KHR_BINARY_GLTF].content}else a=i.LoaderUtils.decodeText(new Uint8Array(e))}const h=JSON.parse(a);if(void 0===h.asset||h.asset.version[0]<2)return void(n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const d=new ee(h,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});d.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](d);c[t.name]=t,l[t.name]=!0}if(h.extensionsUsed)for(let e=0;e<h.extensionsUsed.length;++e){const t=h.extensionsUsed[e],i=h.extensionsRequired||[];switch(t){case o.KHR_MATERIALS_UNLIT:l[t]=new s;break;case o.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:l[t]=new k;break;case o.KHR_DRACO_MESH_COMPRESSION:l[t]=new M(h,this.dracoLoader);break;case o.KHR_TEXTURE_TRANSFORM:l[t]=new S;break;case o.KHR_MESH_QUANTIZATION:l[t]=new _;break;default:i.indexOf(t)>=0&&void 0===c[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}d.setExtensions(l),d.setPlugins(c),d.parse(r,n)}parseAsync(e,t){const i=this;return new Promise((function(r,n){i.parse(e,t,r,n)}))}}function n(){let e={};return{get:function(t){return e[t]},add:function(t,i){e[t]=i},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const o={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class a{constructor(e){this.parser=e,this.name=o.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,r=t.length;i<r;i++){const r=t[i];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,r="light:"+e;let n=t.cache.get(r);if(n)return n;const o=t.json,a=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let s;const l=new(0,i.Color)(16777215);void 0!==a.color&&l.fromArray(a.color);const c=void 0!==a.range?a.range:0;switch(a.type){case"directional":s=new(0,i.DirectionalLight)(l),s.target.position.set(0,0,-1),s.add(s.target);break;case"point":s=new(0,i.PointLight)(l),s.distance=c;break;case"spot":s=new(0,i.SpotLight)(l),s.distance=c,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,s.angle=a.spot.outerConeAngle,s.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,s.target.position.set(0,0,-1),s.add(s.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return s.position.set(0,0,0),s.decay=2,void 0!==a.intensity&&(s.intensity=a.intensity),s.name=t.createUniqueName(a.name||"light_"+e),n=Promise.resolve(s),t.cache.add(r,n),n}createNodeAttachment(e){const t=this,i=this.parser,r=i.json.nodes[e],n=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===n?null:this._loadLight(n).then((function(e){return i._getNodeRef(t.cache,n,e)}))}}class s{constructor(){this.name=o.KHR_MATERIALS_UNLIT}getMaterialType(){return i.MeshBasicMaterial}extendParams(e,t,r){const n=[];e.color=new(0,i.Color)(1,1,1),e.opacity=1;const o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const t=o.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==o.baseColorTexture&&n.push(r.assignTexture(e,"map",o.baseColorTexture,i.sRGBEncoding))}return Promise.all(n)}}class l{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name].emissiveStrength;return void 0!==r&&(t.emissiveIntensity=r),Promise.resolve()}}class c{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],a=n.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&o.push(r.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&o.push(r.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(o.push(r.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){const e=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new(0,i.Vector2)(e,e)}return Promise.all(o)}}class h{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const n=[],o=r.extensions[this.name];return void 0!==o.iridescenceFactor&&(t.iridescence=o.iridescenceFactor),void 0!==o.iridescenceTexture&&n.push(i.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),void 0!==o.iridescenceIor&&(t.iridescenceIOR=o.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==o.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),void 0!==o.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),void 0!==o.iridescenceThicknessTexture&&n.push(i.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(n)}}class d{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[];t.sheenColor=new(0,i.Color)(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=n.extensions[this.name];return void 0!==a.sheenColorFactor&&t.sheenColor.fromArray(a.sheenColorFactor),void 0!==a.sheenRoughnessFactor&&(t.sheenRoughness=a.sheenRoughnessFactor),void 0!==a.sheenColorTexture&&o.push(r.assignTexture(t,"sheenColorMap",a.sheenColorTexture,i.sRGBEncoding)),void 0!==a.sheenRoughnessTexture&&o.push(r.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(o)}}class u{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const n=[],o=r.extensions[this.name];return void 0!==o.transmissionFactor&&(t.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&n.push(i.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(n)}}class p{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],a=n.extensions[this.name];t.thickness=void 0!==a.thicknessFactor?a.thicknessFactor:0,void 0!==a.thicknessTexture&&o.push(r.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||0;const s=a.attenuationColor||[1,1,1];return t.attenuationColor=new(0,i.Color)(s[0],s[1],s[2]),Promise.all(o)}}class m{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name];return t.ior=void 0!==r.ior?r.ior:1.5,Promise.resolve()}}class f{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],a=n.extensions[this.name];t.specularIntensity=void 0!==a.specularFactor?a.specularFactor:1,void 0!==a.specularTexture&&o.push(r.assignTexture(t,"specularIntensityMap",a.specularTexture));const s=a.specularColorFactor||[1,1,1];return t.specularColor=new(0,i.Color)(s[0],s[1],s[2]),void 0!==a.specularColorTexture&&o.push(r.assignTexture(t,"specularColorMap",a.specularColorTexture,i.sRGBEncoding)),Promise.all(o)}}class g{constructor(e){this.parser=e,this.name=o.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,r=i.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const n=r.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,n.source,o)}}class x{constructor(e){this.parser=e,this.name=o.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,r=i.json,n=r.textures[e];if(!n.extensions||!n.extensions[t])return null;const o=n.extensions[t],a=r.images[o.source];let s=i.textureLoader;if(a.uri){const e=i.options.manager.getHandler(a.uri);null!==e&&(s=e)}return this.detectSupport().then((function(n){if(n)return i.loadTextureImage(e,o.source,s);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class b{constructor(e){this.name=o.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const e=i.extensions[this.name],r=this.parser.getDependency("buffer",e.buffer),n=this.parser.options.meshoptDecoder;if(!n||!n.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then((function(t){const i=e.byteOffset||0,r=e.byteLength||0,o=e.count,a=e.byteStride,s=new Uint8Array(t,i,r);return n.decodeGltfBufferAsync?n.decodeGltfBufferAsync(o,a,s,e.mode,e.filter).then((function(e){return e.buffer})):n.ready.then((function(){const t=new ArrayBuffer(o*a);return n.decodeGltfBuffer(new Uint8Array(t),o,a,s,e.mode,e.filter),t}))}))}return null}}const y="glTF",w=1313821514,v=5130562;class ${constructor(e){this.name=o.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:i.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==y)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-12,n=new DataView(e,12);let a=0;for(;a<r;){const t=n.getUint32(a,!0);a+=4;const r=n.getUint32(a,!0);if(a+=4,r===w){const r=new Uint8Array(e,12+a,t);this.content=i.LoaderUtils.decodeText(r)}else if(r===v){const i=12+a;this.body=e.slice(i,i+t)}a+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class M{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=o.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,r=this.dracoLoader,n=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},s={},l={};for(const e in o){const t=Q[e]||e.toLowerCase();a[t]=o[e]}for(const t in e.attributes){const r=Q[t]||t.toLowerCase();if(void 0!==o[t]){const n=i.accessors[e.attributes[t]],o=O[n.componentType];l[r]=o.name,s[r]=!0===n.normalized}}return t.getDependency("bufferView",n).then((function(e){return new Promise((function(t){r.decodeDracoFile(e,(function(e){for(const t in e.attributes){const i=e.attributes[t],r=s[t];void 0!==r&&(i.normalized=r)}t(e)}),a,l)}))}))}}class S{constructor(){this.name=o.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class P extends i.MeshStandardMaterial{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),r=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),o=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),a=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),s={specular:{value:(new(0,i.Color)).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=s,this.onBeforeCompile=function(e){for(const t in s)e.uniforms[t]=s[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",r).replace("#include <roughnessmap_fragment>",n).replace("#include <metalnessmap_fragment>",o).replace("#include <lights_physical_fragment>",a)},Object.defineProperties(this,{specular:{get:function(){return s.specular.value},set:function(e){s.specular.value=e}},specularMap:{get:function(){return s.specularMap.value},set:function(e){s.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return s.glossiness.value},set:function(e){s.glossiness.value=e}},glossinessMap:{get:function(){return s.glossinessMap.value},set:function(e){s.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class k{constructor(){this.name=o.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return P}extendParams(e,t,r){const n=t.extensions[this.name];e.color=new(0,i.Color)(1,1,1),e.opacity=1;const o=[];if(Array.isArray(n.diffuseFactor)){const t=n.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==n.diffuseTexture&&o.push(r.assignTexture(e,"map",n.diffuseTexture,i.sRGBEncoding)),e.emissive=new(0,i.Color)(0,0,0),e.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,e.specular=new(0,i.Color)(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){const t=n.specularGlossinessTexture;o.push(r.assignTexture(e,"glossinessMap",t)),o.push(r.assignTexture(e,"specularMap",t,i.sRGBEncoding))}return Promise.all(o)}createMaterial(e){const t=new P(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=void 0===e.emissiveIntensity?1:e.emissiveIntensity,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=i.TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t}}class _{constructor(){this.name=o.KHR_MESH_QUANTIZATION}}class T extends i.Interpolant{constructor(e,t,i,r){super(e,t,i,r)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r*3+r;for(let e=0;e!==r;e++)t[e]=i[n+e];return t}interpolate_(e,t,i,r){const n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=2*a,l=3*a,c=r-t,h=(i-t)/c,d=h*h,u=d*h,p=e*l,m=p-l,f=-2*u+3*d,g=u-d,x=1-f,b=g-d+h;for(let e=0;e!==a;e++){const t=o[m+e+a],i=o[m+e+s]*c,r=o[p+e+a],l=o[p+e]*c;n[e]=x*t+b*i+f*r+g*l}return n}}const C=new(0,i.Quaternion);class A extends T{interpolate_(e,t,i,r){const n=super.interpolate_(e,t,i,r);return C.fromArray(n).normalize().toArray(n),n}}const D=0,R=1,E=2,L=3,I=4,B=5,V=6,O={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},W={9728:i.NearestFilter,9729:i.LinearFilter,9984:i.NearestMipmapNearestFilter,9985:i.LinearMipmapNearestFilter,9986:i.NearestMipmapLinearFilter,9987:i.LinearMipmapLinearFilter},H={33071:i.ClampToEdgeWrapping,33648:i.MirroredRepeatWrapping,10497:i.RepeatWrapping},F={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Q={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},z={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},G={CUBICSPLINE:void 0,LINEAR:i.InterpolateLinear,STEP:i.InterpolateDiscrete},N="OPAQUE",U="MASK",j="BLEND";function q(e,t,i){for(const r in i.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=i.extensions[r])}function X(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Y(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let i=0,r=t.weights.length;i<r;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){const i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(let t=0,r=i.length;t<r;t++)e.morphTargetDictionary[i[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function J(e){const t=e.extensions&&e.extensions[o.KHR_DRACO_MESH_COMPRESSION];let i;return i=t?"draco:"+t.bufferView+":"+t.indices+":"+Z(t.attributes):e.indices+":"+Z(e.attributes)+":"+e.mode,i}function Z(e){let t="";const i=Object.keys(e).sort();for(let r=0,n=i.length;r<n;r++)t+=i[r]+":"+e[i[r]]+";";return t}function K(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class ee{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new n,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const r=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),o=navigator.userAgent.indexOf("Firefox")>-1,a=o?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;"undefined"==typeof createImageBitmap||r||o&&a<98?this.textureLoader=new(0,i.TextureLoader)(this.options.manager):this.textureLoader=new(0,i.ImageBitmapLoader)(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new(0,i.FileLoader)(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,r=this.json,n=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])})).then((function(t){const o={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:i,userData:{}};q(n,o,r),X(o,r),Promise.all(i._invokeAll((function(e){return e.afterRoot&&e.afterRoot(o)}))).then((function(){e(o)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let i=0,r=t.length;i<r;i++){const r=t[i].joints;for(let t=0,i=r.length;t<i;t++)e[r[t]].isBone=!0}for(let t=0,r=e.length;t<r;t++){const r=e[t];void 0!==r.mesh&&(this._addNodeRef(this.meshCache,r.mesh),void 0!==r.skin&&(i[r.mesh].isSkinnedMesh=!0)),void 0!==r.camera&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const r=i.clone(),n=(e,t)=>{const i=this.associations.get(e);null!=i&&this.associations.set(t,i);for(const[i,r]of e.children.entries())n(r,t.children[i])};return n(i,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const r=e(t[i]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let r=0;r<t.length;r++){const n=e(t[r]);n&&i.push(n)}return i}getDependency(e,t){const i=e+":"+t;let r=this.cache.get(i);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":r=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(i,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map((function(t,r){return i.getDependency(e,r)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[o.KHR_BINARY_GLTF].body);const n=this.options;return new Promise((function(e,o){r.load(i.LoaderUtils.resolveURL(t.uri,n.path),e,void 0,(function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const i=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+i)}))}loadAccessor(e){const t=this,r=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);const o=[];return void 0!==n.bufferView?o.push(this.getDependency("bufferView",n.bufferView)):o.push(null),void 0!==n.sparse&&(o.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(o).then((function(e){const o=e[0],a=F[n.type],s=O[n.componentType],l=s.BYTES_PER_ELEMENT,c=l*a,h=n.byteOffset||0,d=void 0!==n.bufferView?r.bufferViews[n.bufferView].byteStride:void 0,u=!0===n.normalized;let p,m;if(d&&d!==c){const e=Math.floor(h/d),r="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+e+":"+n.count;let c=t.cache.get(r);c||(p=new s(o,e*d,n.count*d/l),c=new(0,i.InterleavedBuffer)(p,d/l),t.cache.add(r,c)),m=new(0,i.InterleavedBufferAttribute)(c,a,h%d/l,u)}else p=null===o?new s(n.count*a):new s(o,h,n.count*a),m=new(0,i.BufferAttribute)(p,a,u);if(void 0!==n.sparse){const t=F.SCALAR,r=O[n.sparse.indices.componentType],l=n.sparse.indices.byteOffset||0,c=n.sparse.values.byteOffset||0,h=new r(e[1],l,n.sparse.count*t),d=new s(e[2],c,n.sparse.count*a);null!==o&&(m=new(0,i.BufferAttribute)(m.array.slice(),m.itemSize,m.normalized));for(let e=0,t=h.length;e<t;e++){const t=h[e];if(m.setX(t,d[e*a]),a>=2&&m.setY(t,d[e*a+1]),a>=3&&m.setZ(t,d[e*a+2]),a>=4&&m.setW(t,d[e*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return m}))}loadTexture(e){const t=this.json,i=this.options,r=t.textures[e].source,n=t.images[r];let o=this.textureLoader;if(n.uri){const e=i.manager.getHandler(n.uri);null!==e&&(o=e)}return this.loadTextureImage(e,r,o)}loadTextureImage(e,t,r){const n=this,o=this.json,a=o.textures[e],s=o.images[t],l=(s.uri||s.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,r).then((function(t){t.flipY=!1,a.name&&(t.name=a.name);const r=(o.samplers||{})[a.sampler]||{};return t.magFilter=W[r.magFilter]||i.LinearFilter,t.minFilter=W[r.minFilter]||i.LinearMipmapLinearFilter,t.wrapS=H[r.wrapS]||i.RepeatWrapping,t.wrapT=H[r.wrapT]||i.RepeatWrapping,n.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[l]=c,c}loadImageSource(e,t){const r=this.json,n=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const o=r.images[e],a=self.URL||self.webkitURL;let s=o.uri||"",l=!1;if(void 0!==o.bufferView)s=this.getDependency("bufferView",o.bufferView).then((function(e){l=!0;const t=new Blob([e],{type:o.mimeType});return s=a.createObjectURL(t),s}));else if(void 0===o.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const c=Promise.resolve(s).then((function(e){return new Promise((function(r,o){let a=r;!0===t.isImageBitmapLoader&&(a=function(e){const t=new(0,i.Texture)(e);t.needsUpdate=!0,r(t)}),t.load(i.LoaderUtils.resolveURL(e,n.path),a,void 0,o)}))})).then((function(e){var t;return!0===l&&a.revokeObjectURL(s),e.userData.mimeType=o.mimeType||((t=o.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",s),e}));return this.sourceCache[e]=c,c}assignTexture(e,t,i,r){const n=this;return this.getDependency("texture",i.index).then((function(a){if(void 0===i.texCoord||0==i.texCoord||"aoMap"===t&&1==i.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+t+" not yet supported."),n.extensions[o.KHR_TEXTURE_TRANSFORM]){const e=void 0!==i.extensions?i.extensions[o.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=n.associations.get(a);a=n.extensions[o.KHR_TEXTURE_TRANSFORM].extendTexture(a,e),n.associations.set(a,t)}}return void 0!==r&&(a.encoding=r),e[t]=a,a}))}assignFinalMaterial(e){const t=e.geometry;let r=e.material;const n=void 0===t.attributes.tangent,o=void 0!==t.attributes.color,a=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+r.uuid;let t=this.cache.get(e);t||(t=new(0,i.PointsMaterial),i.Material.prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,t.sizeAttenuation=!1,this.cache.add(e,t)),r=t}else if(e.isLine){const e="LineBasicMaterial:"+r.uuid;let t=this.cache.get(e);t||(t=new(0,i.LineBasicMaterial),i.Material.prototype.copy.call(t,r),t.color.copy(r.color),this.cache.add(e,t)),r=t}if(n||o||a){let e="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),n&&(e+="derivative-tangents:"),o&&(e+="vertex-colors:"),a&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=r.clone(),o&&(t.vertexColors=!0),a&&(t.flatShading=!0),n&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(r))),r=t}r.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=r}getMaterialType(){return i.MeshStandardMaterial}loadMaterial(e){const t=this,r=this.json,n=this.extensions,a=r.materials[e];let s;const l={},c=a.extensions||{},h=[];if(c[o.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const e=n[o.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];s=e.getMaterialType(),h.push(e.extendParams(l,a,t))}else if(c[o.KHR_MATERIALS_UNLIT]){const e=n[o.KHR_MATERIALS_UNLIT];s=e.getMaterialType(),h.push(e.extendParams(l,a,t))}else{const r=a.pbrMetallicRoughness||{};if(l.color=new(0,i.Color)(1,1,1),l.opacity=1,Array.isArray(r.baseColorFactor)){const e=r.baseColorFactor;l.color.fromArray(e),l.opacity=e[3]}void 0!==r.baseColorTexture&&h.push(t.assignTexture(l,"map",r.baseColorTexture,i.sRGBEncoding)),l.metalness=void 0!==r.metallicFactor?r.metallicFactor:1,l.roughness=void 0!==r.roughnessFactor?r.roughnessFactor:1,void 0!==r.metallicRoughnessTexture&&(h.push(t.assignTexture(l,"metalnessMap",r.metallicRoughnessTexture)),h.push(t.assignTexture(l,"roughnessMap",r.metallicRoughnessTexture))),s=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),h.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,l)}))))}!0===a.doubleSided&&(l.side=i.DoubleSide);const d=a.alphaMode||N;if(d===j?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,d===U&&(l.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&s!==i.MeshBasicMaterial&&(h.push(t.assignTexture(l,"normalMap",a.normalTexture)),l.normalScale=new(0,i.Vector2)(1,1),void 0!==a.normalTexture.scale)){const e=a.normalTexture.scale;l.normalScale.set(e,e)}return void 0!==a.occlusionTexture&&s!==i.MeshBasicMaterial&&(h.push(t.assignTexture(l,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(l.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&s!==i.MeshBasicMaterial&&(l.emissive=(new(0,i.Color)).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&s!==i.MeshBasicMaterial&&h.push(t.assignTexture(l,"emissiveMap",a.emissiveTexture,i.sRGBEncoding)),Promise.all(h).then((function(){let i;return i=s===P?n[o.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(l):new s(l),a.name&&(i.name=a.name),X(i,a),t.associations.set(i,{materials:e}),a.extensions&&q(n,i,a),i}))}createUniqueName(e){const t=i.PropertyBinding.sanitizeNodeName(e||"");let r=t;for(let e=1;this.nodeNamesUsed[r];++e)r=t+"_"+e;return this.nodeNamesUsed[r]=!0,r}loadGeometries(e){const t=this,r=this.extensions,n=this.primitiveCache;function a(e){return r[o.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(i){return ie(i,e,t)}))}const s=[];for(let r=0,l=e.length;r<l;r++){const l=e[r],c=J(l),h=n[c];if(h)s.push(h.promise);else{let e;e=l.extensions&&l.extensions[o.KHR_DRACO_MESH_COMPRESSION]?a(l):ie(new(0,i.BufferGeometry),l,t),n[c]={primitive:l,promise:e},s.push(e)}}return Promise.all(s)}loadMesh(e){const t=this,r=this.json,n=this.extensions,o=r.meshes[e],a=o.primitives,s=[];for(let e=0,t=a.length;e<t;e++){const t=void 0===a[e].material?(void 0===(l=this.cache).DefaultMaterial&&(l.DefaultMaterial=new(0,i.MeshStandardMaterial)({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:i.FrontSide})),l.DefaultMaterial):this.getDependency("material",a[e].material);s.push(t)}var l;return s.push(t.loadGeometries(a)),Promise.all(s).then((function(r){const s=r.slice(0,r.length-1),l=r[r.length-1],c=[];for(let r=0,h=l.length;r<h;r++){const h=l[r],d=a[r];let u;const p=s[r];if(d.mode===I||d.mode===B||d.mode===V||void 0===d.mode)u=!0===o.isSkinnedMesh?new(0,i.SkinnedMesh)(h,p):new(0,i.Mesh)(h,p),!0!==u.isSkinnedMesh||u.geometry.attributes.skinWeight.normalized||u.normalizeSkinWeights(),d.mode===B?u.geometry=re(u.geometry,i.TriangleStripDrawMode):d.mode===V&&(u.geometry=re(u.geometry,i.TriangleFanDrawMode));else if(d.mode===R)u=new(0,i.LineSegments)(h,p);else if(d.mode===L)u=new(0,i.Line)(h,p);else if(d.mode===E)u=new(0,i.LineLoop)(h,p);else{if(d.mode!==D)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);u=new(0,i.Points)(h,p)}Object.keys(u.geometry.morphAttributes).length>0&&Y(u,o),u.name=t.createUniqueName(o.name||"mesh_"+e),X(u,o),d.extensions&&q(n,u,d),t.assignFinalMaterial(u),c.push(u)}for(let i=0,r=c.length;i<r;i++)t.associations.set(c[i],{meshes:e,primitives:i});if(1===c.length)return c[0];const h=new(0,i.Group);t.associations.set(h,{meshes:e});for(let e=0,t=c.length;e<t;e++)h.add(c[e]);return h}))}loadCamera(e){let t;const r=this.json.cameras[e],n=r[r.type];if(n)return"perspective"===r.type?t=new(0,i.PerspectiveCamera)(i.MathUtils.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===r.type&&(t=new(0,i.OrthographicCamera)(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),X(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],i={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(i):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return i.inverseBindMatrices=e,i}))}loadAnimation(e){const t=this.json.animations[e],r=[],n=[],o=[],a=[],s=[];for(let e=0,i=t.channels.length;e<i;e++){const i=t.channels[e],l=t.samplers[i.sampler],c=i.target,h=c.node,d=void 0!==t.parameters?t.parameters[l.input]:l.input,u=void 0!==t.parameters?t.parameters[l.output]:l.output;r.push(this.getDependency("node",h)),n.push(this.getDependency("accessor",d)),o.push(this.getDependency("accessor",u)),a.push(l),s.push(c)}return Promise.all([Promise.all(r),Promise.all(n),Promise.all(o),Promise.all(a),Promise.all(s)]).then((function(r){const n=r[0],o=r[1],a=r[2],s=r[3],l=r[4],c=[];for(let e=0,t=n.length;e<t;e++){const t=n[e],r=o[e],h=a[e],d=s[e],u=l[e];if(void 0===t)continue;let p;switch(t.updateMatrix(),z[u.path]){case z.weights:p=i.NumberKeyframeTrack;break;case z.rotation:p=i.QuaternionKeyframeTrack;break;default:p=i.VectorKeyframeTrack}const m=t.name?t.name:t.uuid,f=void 0!==d.interpolation?G[d.interpolation]:i.InterpolateLinear,g=[];z[u.path]===z.weights?t.traverse((function(e){e.morphTargetInfluences&&g.push(e.name?e.name:e.uuid)})):g.push(m);let x=h.array;if(h.normalized){const e=K(x.constructor),t=new Float32Array(x.length);for(let i=0,r=x.length;i<r;i++)t[i]=x[i]*e;x=t}for(let e=0,t=g.length;e<t;e++){const t=new p(g[e]+"."+z[u.path],r.array,x,f);"CUBICSPLINE"===d.interpolation&&(t.createInterpolant=function(e){return new(this instanceof i.QuaternionKeyframeTrack?A:T)(this.times,this.values,this.getValueSize()/3,e)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(t)}}const h=t.name?t.name:"animation_"+e;return new(0,i.AnimationClip)(h,void 0,c)}))}createNodeMesh(e){const t=this.json,i=this,r=t.nodes[e];return void 0===r.mesh?null:i.getDependency("mesh",r.mesh).then((function(e){const t=i._getNodeRef(i.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,i=r.weights.length;t<i;t++)e.morphTargetInfluences[t]=r.weights[t]})),t}))}loadNode(e){const t=this.json,r=this.extensions,n=this,o=t.nodes[e],a=o.name?n.createUniqueName(o.name):"";return function(){const t=[],i=n._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return i&&t.push(i),void 0!==o.camera&&t.push(n.getDependency("camera",o.camera).then((function(e){return n._getNodeRef(n.cameraCache,o.camera,e)}))),n._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(t){let s;if(s=!0===o.isBone?new(0,i.Bone):t.length>1?new(0,i.Group):1===t.length?t[0]:new(0,i.Object3D),s!==t[0])for(let e=0,i=t.length;e<i;e++)s.add(t[e]);if(o.name&&(s.userData.name=o.name,s.name=a),X(s,o),o.extensions&&q(r,s,o),void 0!==o.matrix){const e=new(0,i.Matrix4);e.fromArray(o.matrix),s.applyMatrix4(e)}else void 0!==o.translation&&s.position.fromArray(o.translation),void 0!==o.rotation&&s.quaternion.fromArray(o.rotation),void 0!==o.scale&&s.scale.fromArray(o.scale);return n.associations.has(s)||n.associations.set(s,{}),n.associations.get(s).nodes=e,s}))}loadScene(e){const t=this.json,r=this.extensions,n=this.json.scenes[e],o=this,a=new(0,i.Group);n.name&&(a.name=o.createUniqueName(n.name)),X(a,n),n.extensions&&q(r,a,n);const s=n.nodes||[],l=[];for(let e=0,i=s.length;e<i;e++)l.push(te(s[e],a,t,o));return Promise.all(l).then((function(){return o.associations=(e=>{const t=new Map;for(const[e,r]of o.associations)(e instanceof i.Material||e instanceof i.Texture)&&t.set(e,r);return e.traverse((e=>{const i=o.associations.get(e);null!=i&&t.set(e,i)})),t})(a),a}))}}function te(e,t,r,n){const o=r.nodes[e];return n.getDependency("node",e).then((function(e){if(void 0===o.skin)return e;let t;return n.getDependency("skin",o.skin).then((function(e){t=e;const i=[];for(let e=0,r=t.joints.length;e<r;e++)i.push(n.getDependency("node",t.joints[e]));return Promise.all(i)})).then((function(r){return e.traverse((function(e){if(!e.isMesh)return;const n=[],o=[];for(let e=0,a=r.length;e<a;e++){const a=r[e];if(a){n.push(a);const r=new(0,i.Matrix4);void 0!==t.inverseBindMatrices&&r.fromArray(t.inverseBindMatrices.array,16*e),o.push(r)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}e.bind(new(0,i.Skeleton)(n,o),e.matrixWorld)})),e}))})).then((function(e){t.add(e);const i=[];if(o.children){const t=o.children;for(let o=0,a=t.length;o<a;o++){const a=t[o];i.push(te(a,e,r,n))}}return Promise.all(i)}))}function ie(e,t,r){const n=t.attributes,o=[];function a(t,i){return r.getDependency("accessor",t).then((function(t){e.setAttribute(i,t)}))}for(const t in n){const i=Q[t]||t.toLowerCase();i in e.attributes||o.push(a(n[t],i))}if(void 0!==t.indices&&!e.index){const i=r.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));o.push(i)}return X(e,t),function(e,t,r){const n=t.attributes,o=new(0,i.Box3);if(void 0===n.POSITION)return;{const e=r.json.accessors[n.POSITION],t=e.min,a=e.max;if(void 0===t||void 0===a)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(o.set(new(0,i.Vector3)(t[0],t[1],t[2]),new(0,i.Vector3)(a[0],a[1],a[2])),e.normalized){const t=K(O[e.componentType]);o.min.multiplyScalar(t),o.max.multiplyScalar(t)}}const a=t.targets;if(void 0!==a){const e=new(0,i.Vector3),t=new(0,i.Vector3);for(let i=0,n=a.length;i<n;i++){const n=a[i];if(void 0!==n.POSITION){const i=r.json.accessors[n.POSITION],o=i.min,a=i.max;if(void 0!==o&&void 0!==a){if(t.setX(Math.max(Math.abs(o[0]),Math.abs(a[0]))),t.setY(Math.max(Math.abs(o[1]),Math.abs(a[1]))),t.setZ(Math.max(Math.abs(o[2]),Math.abs(a[2]))),i.normalized){const e=K(O[i.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(e)}e.boundingBox=o;const s=new(0,i.Sphere);o.getCenter(s.center),s.radius=o.min.distanceTo(o.max)/2,e.boundingSphere=s}(e,t,r),Promise.all(o).then((function(){return void 0!==t.targets?function(e,t,i){let r=!1,n=!1,o=!1;for(let e=0,i=t.length;e<i;e++){const i=t[e];if(void 0!==i.POSITION&&(r=!0),void 0!==i.NORMAL&&(n=!0),void 0!==i.COLOR_0&&(o=!0),r&&n&&o)break}if(!r&&!n&&!o)return Promise.resolve(e);const a=[],s=[],l=[];for(let c=0,h=t.length;c<h;c++){const h=t[c];if(r){const t=void 0!==h.POSITION?i.getDependency("accessor",h.POSITION):e.attributes.position;a.push(t)}if(n){const t=void 0!==h.NORMAL?i.getDependency("accessor",h.NORMAL):e.attributes.normal;s.push(t)}if(o){const t=void 0!==h.COLOR_0?i.getDependency("accessor",h.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(a),Promise.all(s),Promise.all(l)]).then((function(t){const i=t[0],a=t[1],s=t[2];return r&&(e.morphAttributes.position=i),n&&(e.morphAttributes.normal=a),o&&(e.morphAttributes.color=s),e.morphTargetsRelative=!0,e}))}(e,t.targets,r):e}))}function re(e,t){let r=e.getIndex();if(null===r){const t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),r=e.getIndex()}const n=r.count-2,o=[];if(t===i.TriangleFanDrawMode)for(let e=1;e<=n;e++)o.push(r.getX(0)),o.push(r.getX(e)),o.push(r.getX(e+1));else for(let e=0;e<n;e++)e%2==0?(o.push(r.getX(e)),o.push(r.getX(e+1)),o.push(r.getX(e+2))):(o.push(r.getX(e+2)),o.push(r.getX(e+1)),o.push(r.getX(e)));o.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const a=e.clone();return a.setIndex(o),a}})),parcelRequire.register("9QhXH",(function(e,t){$parcel$export(e.exports,"DM",(()=>M));var i=parcelRequire("4xklQ"),r=parcelRequire("ia4Lh"),n=parcelRequire("7WCxl"),o=parcelRequire("g4HAh"),a=parcelRequire("5XTH3"),s=(i=parcelRequire("4xklQ"),parcelRequire("9HO6e")),l=parcelRequire("jizqJ"),c=parcelRequire("9f3nc"),h=parcelRequire("5HP0C"),d=parcelRequire("kHWob"),u=parcelRequire("xl6VI"),p=parcelRequire("gMe2U"),m=parcelRequire("lUO0N"),f=parcelRequire("arwMC"),g=parcelRequire("8C2VU"),x=parcelRequire("1Wv1c"),b=parcelRequire("eZ4ri"),y=parcelRequire("bWffP"),w=parcelRequire("lDEcB"),v=parcelRequire("kKNer"),$=parcelRequire("iDVm9");parcelRequire("hrM0U");class M{static thickness=240;static lineRenderOrder=100;static shapeRenderOrder=90;static componentZ=10;static cornerWindowWidth=500;static doubleSlidingDoorLimit=2e3;static tripleSlidingDoorLimit=2500;static tool=new(0,a.DrawWallTool);static addDoorParam(e,t,r,n,o,a,s,l,c=""){e.updateMatrixWorld(),e.doorWid=t,e.wallDep=r,""!=n&&(e.wallStartPoint=n),""!=o&&(e.wallEndPoint=o),e.center=a,e.startPoint=e.localToWorld(new i.Vector3(-t/2,0,0)),e.endPoint=e.localToWorld(new i.Vector3(t/2,0,0)),e.angle=s,e.modelType=l,e.doorDir=c,e.height=2100,e.floorHei=500,(l.includes("Door")||l.includes("door"))&&(e.height=2300,e.floorHei=0),"frenchwindows"==l&&(e.floorHei=0),"leftSide"==c&&(e.scale.x=-1),"inside"==c&&(e.scale.y=-1),"rightSide"==c&&(e.scale.x=-1,e.scale.y=-1)}static addMemberParam(e,t,i,r,n,o,a){e.angle=t,i&&(e.width=i),e.height=r,e.depth=n,e.center=o,e.modelType=a}static createScaleTool(e,t){let r=240,n=e.clone().distanceTo(t.clone()),o=s.UtilCore.getPointsCenter(e,t),a=new i.Group,l=new i.Vector2(-n/2,-120),c=new i.Vector2(-n/2,120),h=new i.Vector2(n/2,120),d=new i.Vector2(n/2,-120),u=this.createShapeByPointArr([l,c,h,d],"mesh","rgb(57,110,254)");u.useType="scaleHelpTool";let p=0;for(let e=0;e<parseInt(n/50);e++){p+=50;let t=new i.Vector2(-n/2+p,100),r=new i.Vector2(-n/2+p,0);(e+1)%5==0&&(r.y=-60);let o=this.createLine([t,r],16777215);o.useType="scaleHelpTool",a.add(o)}l.y=-240,c.y=r,h.y=r,d.y=-240;let m=this.createLine([l,c],"rgb(57,110,254)"),f=this.createLine([h,d],"rgb(57,110,254)");m.useType="scaleHelpTool",f.useType="scaleHelpTool",a.position.set(o.x,o.y,this.componentZ),a.add(u,m,f);let g=new i.Vector2(t.x,t.y).sub(new i.Vector2(e.x,e.y)).angle();return a.rotation.z=g,a}static createBaseDoor(e,t,r="outside",n=0,o=this.thickness,a="",s=""){let l=new i.Group,c=new i.Vector2(-t/2,-o/2),h=new i.Vector2(-t/2,o/2),d=new i.Vector2(t/2,o/2),u=new i.Vector2(t/2,-o/2),p=this.createShapeByPointArr([c,h,d,u]),m=new i.Vector2(o/2-t/2,o/2),f=new i.Vector2(-t/2,0),g=new i.Vector2(-t/2,f.y+t),x=new i.Vector2(g.x+o/2,g.y),b=new i.Vector2(x.x,f.y),y=this.createShapeByPointArr([h,g,x,m]),w=this.createLine([c,g,x,b,f]),v=this.createLine([d,u]),$=this.createArc(m,t-o/2,0,Math.PI/2,14145753),S=this.createArc(m,t-o/2,0,Math.PI/2,16777215,!0);S.push(m);let P=this.createShapeByPointArr(S,"mesh",16185336);return l.add(p,y,w,v,$,P),"inside"==r&&(l.scale.y=-1),l.rotation.z=n,l.position.set(e.x,e.y,this.componentZ),M.addDoorParam(l,t,o,a,s,e,n,"door",r),l.modelPath=url+"/assets/model/door/baseDoor/baseDoor.glb",l}static createSectorDoor(e,t,r=0,n=this.thickness,o="",a="",s=""){let l=new i.Group,c=new i.Vector2(-t/2,-n/2),h=new i.Vector2(-t/2,n/2),d=new i.Vector2(t/2,n/2),u=new i.Vector2(t/2,-n/2),p=h.clone().add(d).divideScalar(2),m=h.distanceTo(d)/2;s||(s=m);let f=h.clone().sub(p).angle(),g=d.clone().sub(p).angle(),x=this.createArc(p,m,g,f,16777215,!0),b=this.createShapeByPointArr([...x,c,u]),y=this.createLine([u,...x,c]);return l.add(b,y),l.rotation.z=r,l.position.set(e.x,e.y,this.componentZ),M.addDoorParam(l,t,n,o,a,e,r,"archDoor"),l.modelPath=url+"/assets/model/door/sectorDoor/sectorDoor.glb",l.arcHei=s,l}static createSectorWindow(e,t,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=new i.Vector2(-t/2,-n/2),c=new i.Vector2(-t/2,n/2),h=new i.Vector2(t/2,n/2),d=new i.Vector2(t/2,-n/2),u=l.clone().add(d).divideScalar(2),p=c.clone().add(h).divideScalar(2),m=c.distanceTo(h)/2,f=c.clone().sub(p).angle(),g=h.clone().sub(p).angle(),x=this.createArc(p,m,g,f,16777215,!0),b=this.createShapeByPointArr([...x,l,d]),y=this.createLine([d,...x,l]),w=this.createLine([h,c]),v=this.createLine([p,u]);return s.add(b,y,w,v),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),M.addDoorParam(s,t,n,o,a,e,r,"archWindow"),s.modelPath=url+"/assets/model/window/sectorWindow/sectorWindow.glb",s}static createDODoor(e,t,r=0,n=this.thickness,o="",a="",s="outside"){let l=new i.Group,c=new i.Vector2(-t/2,-n/2),h=new i.Vector2(-t/2,n/2),d=new i.Vector2(t/2,n/2),u=new i.Vector2(t/2,-n/2),p=this.createShapeByPointArr([h,d,u,c]),m=new i.Vector2(-t/2,0),f=new i.Vector2(m.x,m.y+t/2),g=new i.Vector2(f.x+n/2,f.y),x=new i.Vector2(g.x,g.y-t/2),b=new i.Vector2(x.x,x.y+n/2),y=this.createArc(b,(t-n)/2,0,Math.PI/2,14145753),w=this.createShapeByPointArr([f,g,x,m]),v=this.createLine([c,f,g,x,m]),$=new i.Vector2(-m.x,m.y),S=new i.Vector2(-f.x,f.y),P=new i.Vector2(-g.x,g.y),k=new i.Vector2(-x.x,x.y),_=new i.Vector2(-b.x,b.y),T=this.createArc(_,(t-n)/2,Math.PI/2,Math.PI,14145753),C=this.createShapeByPointArr([S,P,k,$]),A=this.createLine([u,S,P,k,$]);return l.add(p,w,v,C,A,y,T),l.rotation.z=r,l.position.set(e.x,e.y,this.componentZ),M.addDoorParam(l,t,n,o,a,e,r,"doubledoor",s),l.modelPath=url+"/assets/model/door/doubleOpenDoor/doubleOpenDoor.glb",l}static createLashDoor(e,t=1450,r=0,n=this.thickness,o="",a="",s="outside"){let l=new i.Group,c=new i.Vector2(-t/2,-n/2),h=new i.Vector2(-t/2,n/2),d=new i.Vector2(t/2,n/2),u=new i.Vector2(t/2,-n/2),p=this.createShapeByPointArr([c,h,d,u]),m=this.createLine([c,h,d,u,c]),f=new i.Vector2(-t/2,-n/6),g=new i.Vector2(-t/2,n/6),x=new i.Vector2(t/2,n/6),b=new i.Vector2(t/2,-n/6),y=new i.Vector2(t/4,n/6),w=new i.Vector2(t/4,-n/6),v=this.createLine([f,b]),$=this.createLine([g,x]),S=this.createLine([y,w]);return l.add(p,m,v,$,S),l.rotation.z=r,l.position.set(e.x,e.y,this.componentZ),M.addDoorParam(l,t,n,o,a,e,r,"childMotherDoor",s),l.modelPath=url+"/assets/model/door/lashDoor/lashDoor.glb",l}static createSlidingDoor(e,t,r=0,n=this.thickness,o="",a="",s="outside"){let l=new i.Group,c=new i.Vector2(-t/2,-n/2),h=new i.Vector2(-t/2,n/2),d=new i.Vector2(t/2,n/2),u=new i.Vector2(t/2,-n/2),p=this.createShapeByPointArr([h,d,u,c]),m=this.createLine([c,h,d,u,c]);if(t<=this.doubleSlidingDoorLimit){let e=2*t/3,r=new i.Vector2(10-t/2,0),o=new i.Vector2(r.x,r.y+n/4),a=new i.Vector2(o.x+e,o.y),s=new i.Vector2(a.x,a.y-n/4),c=this.createLine([r,o,a,s,r]),h=new i.Vector2(-r.x,-r.y),d=new i.Vector2(-o.x,-o.y),u=new i.Vector2(-a.x,-a.y),p=new i.Vector2(-s.x,-s.y),m=this.createLine([h,d,u,p,h]);l.add(c,m)}else if(t<=this.tripleSlidingDoorLimit){let e=2*t/5,r=new i.Vector2(10-t/2,-n/4),o=new i.Vector2(r.x,r.y+n/4),a=new i.Vector2(o.x+e,o.y),s=new i.Vector2(a.x,a.y-n/4),c=this.createLine([r,o,a,s,r]),h=new i.Vector2(-s.x,s.y),d=new i.Vector2(-a.x,a.y),u=new i.Vector2(-o.x,o.y),p=new i.Vector2(-r.x,r.y),m=this.createLine([h,d,u,p,h]),f=new i.Vector2(-e/2,0),g=new i.Vector2(f.x,f.y+n/4),x=new i.Vector2(g.x+e,g.y),b=new i.Vector2(x.x,x.y-n/4),y=this.createLine([f,g,x,b,f]);l.add(c,m,y)}else{let e=t/4,r=new i.Vector2(10-t/2,n/4),o=new i.Vector2(r.x,r.y-n/4),a=new i.Vector2(o.x+e,o.y),s=new i.Vector2(a.x,a.y+n/4),c=this.createLine([r,o,a,s,r]),h=new i.Vector2(a.x-e/4,a.y),d=new i.Vector2(h.x,h.y-n/4),u=new i.Vector2(d.x+e,d.y),p=new i.Vector2(u.x,u.y+n/4),m=this.createLine([h,d,u,p,h]),f=new i.Vector2(-r.x,r.y),g=new i.Vector2(-o.x,o.y),x=new i.Vector2(-a.x,a.y),b=new i.Vector2(-s.x,s.y),y=this.createLine([f,g,x,b,f]),w=new i.Vector2(-h.x,h.y),v=new i.Vector2(-d.x,d.y),$=new i.Vector2(-u.x,u.y),M=new i.Vector2(-p.x,p.y),S=this.createLine([w,v,$,M,w]);l.add(c,m,y,S)}return l.add(p,m),l.rotation.z=r,l.position.set(e.x,e.y,this.componentZ),M.addDoorParam(l,t,n,o,a,e,r,"slidingdoor",s),l.modelPath=url+"/assets/model/door/slidingDoor/slidingDoor.glb",l}static createPass(e,t,r=0,n=this.thickness,o="",a="",s="outside"){let l=new i.Group,c=new i.Vector2(-t/2,n/2),h=new i.Vector2(t/2,n/2),d=new i.Vector2(t/2,n/6),u=new i.Vector2(-t/2,n/6),p=new i.Vector2(-t/2,-n/6),m=new i.Vector2(t/2,-n/6),f=new i.Vector2(t/2,-n/2),g=new i.Vector2(-t/2,-n/2),x=this.createShapeByPointArr([c,h,f,g]),b=this.createLine([c,h,d,u,c]),y=this.createLine([p,m,f,g,p]);return l.add(x,b,y),l.rotation.z=r,l.position.set(e.x,e.y,this.componentZ),M.addDoorParam(l,t,n,o,a,e,r,"passDoor",s),l.modelPath=url+"/assets/model/door/pass/pass1.glb",l}static createLWindow(e,t,r,n=1200,o=1200){let a=new i.Group,s=new i.Vector2(-t/2,-r/2-o),l=new i.Vector2(-t/2,r/2),c=new i.Vector2(l.x+t+n,r/2),h=new i.Vector2(c.x,c.y-r),d=new i.Vector2(t/2,-r/2),u=new i.Vector2(s.x+t,s.y),p=this.createShapeByPointArr([s,l,c,h,d,u]),m=this.createLine([s,l,c,h,d,u,s]),f=new i.Vector2(0,-r/2-o),g=new i.Vector2(t/2+n,0),x=this.createLine([f,new i.Vector2,g]);return a.add(p,m,x),a.rotation.z=0,a.position.set(e.x,e.y,this.componentZ),M.addDoorParam(a,n,r,0,0,e,0,"LWindow"),a}static createLWindowNew(e,t,r,n=1200,o=1200){let a=new i.Group,s=new(0,w.LWindowGeometry)(t,r,n,o),l=new i.Mesh(s,new i.MeshBasicMaterial({color:16777215})),c=(new(0,f.DWHelper)).active(l);a.add(l,c);let h,d,u,p,m,g,x,b="",y="";if(t&&r){let a,s,l=this.getCommonPoint(t,r);t.startPoint.x==l.x&&t.startPoint.y==l.y?(a=new i.Vector2(t.endPoint.x,t.endPoint.y),g=a.clone().sub(t.startPoint)):(a=new i.Vector2(t.startPoint.x,t.startPoint.y),g=a.clone().sub(t.endPoint)),r.startPoint.x==l.x&&r.startPoint.y==l.y?(s=new i.Vector2(r.endPoint.x,r.endPoint.y),x=s.clone().sub(r.startPoint)):(s=new i.Vector2(r.startPoint.x,r.startPoint.y),x=s.clone().sub(r.endPoint)),d=g.angle(),u=x.angle(),h=this.tool.computeMiter(a,l,s,t.thickness,r.thickness).angle(),p=t.thickness,m=r.thickness,b=e.clone().add(g.clone().setLength(n+r.thickness/2)),y=e.clone().add(x.clone().setLength(o+t.thickness/2))}else p=this.thickness,m=this.thickness,g=new i.Vector2(0,-1),x=new i.Vector2(1,0),d=g.angle(),u=x.angle(),h=(d+u)/2;let v=h>u?h-u:h+2*Math.PI-u,$=h<d?Math.PI-d+h:h-d-Math.PI,S=Math.abs(m/2/Math.tan(v)),P=Math.abs(p/2/Math.tan($)),k=e.clone().add(g.clone().setLength(n/2)),_=e.clone().add(x.clone().setLength(o/2));a.position.set(e.x,e.y,this.componentZ),a.leftWindow=[t,n,k,url+"/assets/model/window/LWindow/leftLWindow.glb",P,b],a.rightWindow=[r,o,_,url+"/assets/model/window/LWindow/rightLWindow.glb",S,y];let T=n+m,C=o+p;return M.addDoorParam(a,T,C,"","",e,"","LWindow"),a}static getCommonPoint(e,t){let r=new i.Vector2(e.startPoint.x,e.startPoint.y),n=new i.Vector2(e.endPoint.x,e.endPoint.y),o=new i.Vector2(t.startPoint.x,t.startPoint.y),a=new i.Vector2(t.endPoint.x,t.endPoint.y);return r.equals(o)||r.equals(a)?r:n.equals(o)||n.equals(a)?n:void 0}static createBaseWindow(e,t,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=(new i.Vector2).add(new i.Vector2(-t/2,n/2)),c=(new i.Vector2).add(new i.Vector2(-t/2,0)),h=(new i.Vector2).add(new i.Vector2(-t/2,-n/2)),d=(new i.Vector2).add(new i.Vector2(t/2,n/2)),u=(new i.Vector2).add(new i.Vector2(t/2,0)),p=(new i.Vector2).add(new i.Vector2(t/2,-n/2)),m=this.createShapeByPointArr([l,h,p,d]),f=this.createLine([c,h,p,d,l,c,u]);return s.add(m,f),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),M.addDoorParam(s,t,n,o,a,e,r,"window"),s.modelPath=url+"/assets/model/window/baseWindow/baseWindow.glb",s}static createArcBaseWindow(e,t=!1,r=this.thickness,n=Math.PI/12){let o,a,s=new i.Group,l=1500;if(e=new i.Vector2(e.x,e.y),t){let r=e.clone().sub(t);l=r.length();let s=new i.Vector2(r.x,r.y).angle();o=s-n,a=s+n}else{t=new i.Vector2(e.x,e.y).add(new i.Vector2(0,-1).setLength(l)),o=5*Math.PI/12,a=7*Math.PI/12}let c=this.createArc(t,l+r/2,o,a,16777215,!0),h=this.createArc(t,l,o,a,16777215,!0),d=this.createArc(t,l-r/2,o,a,16777215,!0);c.unshift(d[0]),d.reverse().forEach((e=>{c.push(e)}));let u=this.createLine(c),p=this.createLine(h);c.shift();let m=this.createShapeByPointArr(c);return m.geometry.computeBoundingBox(),s.add(u,p,m),M.addDoorParam(s,1e3,r,h[0],h[h.length-1],e,n,"arcWindow"),s.startPoint=h[0],s.endPoint=h[h.length-1],s.arcCenter=t,s.position.z=this.componentZ,s.modelPath=url+"/assets/model/window/05/arcWindow.glb",s}static createLWaveWindow(e,t,r,n,o,a=0,s=500,l=500){let c=new i.Group,h=new i.Vector2(n/2,o/2-r),d=new i.Vector2(h.x-n-s,h.y),u=new i.Vector2(d.x,d.y+r+l),p=new i.Vector2(u.x+s+t,u.y),m=new i.Vector2(p.x,p.y-l-o),f=new i.Vector2(n/2,-o/2),g=this.createShapeByPointArr([h,d,u,p,m,f],"mesh",13421772),x=this.createLine([h,d,u,p,m,f,h]),b=new i.Vector2(-n/2,o/2-r-this.thickness/2),y=new i.Vector2(b.x-s-this.thickness/2,b.y),w=new i.Vector2(y.x,y.y+this.thickness+r+l),v=new i.Vector2(w.x+this.thickness+t+s,w.y),$=new i.Vector2(v.x,v.y-this.thickness/2-l),M=new i.Vector2(h.x-n,h.y),S=new i.Vector2(m.x,m.y+o),P=[M,b,y,w,v,$,S,p,u,d],k=this.createShapeByPointArr(P),_=this.createLine([M,b,y,w,v,$,S]),T=new i.Vector2(M.x,M.y-this.thickness/4),C=new i.Vector2(T.x-s-this.thickness/4,T.y),A=new i.Vector2(C.x,C.y+this.thickness/2+r+l),D=new i.Vector2(A.x+this.thickness/2+t+s,A.y),R=new i.Vector2(D.x,D.y-this.thickness/4-l),E=this.createLine([T,C,A,D,R]);return c.add(g,x,k,_,E),c.rotation.z=a,c.position.set(e.x,e.y,this.componentZ),c}static createUWindow(e,t,r,n,o=1200,a=1200){let l=new i.Group,c=240,h=240,d=240,u=0,p=2500,m="",f="";if(t&&r&&n){c=t.thickness,h=r.thickness,d=n.thickness,p=r.startPoint.distanceTo(r.endPoint)-c/2-d/2;let e,i,l=r.startPoint,g=r.endPoint,x=t.startPoint,b=t.endPoint,y=n.startPoint,w=n.endPoint;l.equals(x)||l.equals(b)?e=l:(g.equals(x)||g.equals(b))&&(e=g),l.equals(y)||l.equals(w)?i=l:(g.equals(y)||g.equals(w))&&(i=g);let v=s.UtilCore.getMeshOtherPoint(t,e),$=s.UtilCore.getMeshOtherPoint(n,i);m=e.clone().add(v.clone().sub(e).setLength(o+h/2)),f=i.clone().add($.clone().sub(i).setLength(a+h/2)),e&&i&&(u=i.clone().sub(e).angle())}let g=new i.Vector2(-p/2,-o-h/2),x=new i.Vector2(g.x-c,g.y),b=new i.Vector2(x.x,x.y+o+h),y=new i.Vector2(b.x+c+p+d,b.y),w=new i.Vector2(y.x,y.y-h-a),v=new i.Vector2(w.x-d,w.y),$=new i.Vector2(v.x,v.y+a),S=new i.Vector2($.x-p,$.y),P=this.createShapeByPointArr([g,x,b,y,w,v,$,S]),k=this.createLine([g,x,b,y,w,v,$,S,g]),_=new i.Vector2(g.x-c/2,g.y),T=new i.Vector2(_.x,0),C=new i.Vector2(p/2+d/2,T.y),A=new i.Vector2(C.x,C.y-h/2-a),D=this.createLine([_,T,C,A]);l.add(P,k,D),l.rotation.z=u,l.position.set(e.x,e.y,this.componentZ),l.leftWindow=[t,o,m],l.rightWindow=[n,a,f];let R=o+h;return a>o&&(R=a+h),M.addDoorParam(l,p+c+d,R,"","",e,u,"UWindow"),l.modelPath=url+"/assets/model/window/uWindow/uWindow.glb",l}static createUWindowOld(e,t,r,n,o,a=0,s=1200,l=1200){let c=new i.Group,h=new i.Vector2(-o/2,-s-r/2),d=new i.Vector2(h.x-t,h.y),u=new i.Vector2(d.x,d.y+s+r),p=new i.Vector2(u.x+t+o+n,u.y),m=new i.Vector2(p.x,p.y-r-l),f=new i.Vector2(m.x-n,m.y),g=new i.Vector2(f.x,f.y+l),x=new i.Vector2(g.x-o,g.y),b=this.createShapeByPointArr([h,d,u,p,m,f,g,x]),y=this.createLine([h,d,u,p,m,f,g,x,h]),w=new i.Vector2(h.x-t/2,h.y),v=new i.Vector2(w.x,0),$=new i.Vector2(o/2+n/2,v.y),S=new i.Vector2($.x,$.y-r/2-l),P=this.createLine([w,v,$,S]);return c.add(b,y,P),c.rotation.z=a,c.position.set(e.x,e.y,this.componentZ),M.addDoorParam(c,o+t+n,r,"","",e,a,"UWindow"),c.modelPath=url+"/assets/model/window/uWindow/uWindow.glb",c}static createUWaveWindow(e,t,r,n,o,a=0,s=1e3,l=500,c=500,h=500){let d=new i.Group,u=new i.Vector2(-t/2,-n/2-s),p=new i.Vector2(u.x-r-l,u.y),m=new i.Vector2(p.x,n/2+c),f=new i.Vector2(t/2+o+h,m.y),g=new i.Vector2(f.x,u.y),x=new i.Vector2(t/2,g.y),b=new i.Vector2(x.x,-n/2),y=new i.Vector2(-t/2,b.y),w=this.createShapeByPointArr([u,p,m,f,g,x,b,y],"mesh",13421772),v=this.createLine([u,p,m,f,g,x,b,y,u]),$=new i.Vector2(-t/2-r,u.y),M=new i.Vector2($.x,$.y-this.thickness/2),S=new i.Vector2(M.x-l-this.thickness/2,M.y),P=new i.Vector2(S.x,m.y+this.thickness/2),k=new i.Vector2(f.x+this.thickness/2,P.y),_=new i.Vector2(k.x,g.y-this.thickness/2),T=new i.Vector2(t/2+o,_.y),C=new i.Vector2(T.x,T.y+this.thickness/2),A=this.createShapeByPointArr([$,M,S,P,k,_,T,C,g,f,m,p]),D=this.createLine([$,M,S,P,k,_,T,C]),R=new i.Vector2($.x,$.y-this.thickness/4),E=new i.Vector2(p.x-this.thickness/4,R.y),L=new i.Vector2(E.x,m.y+this.thickness/4),I=new i.Vector2(f.x+this.thickness/4,L.y),B=new i.Vector2(I.x,g.y-this.thickness/4),V=new i.Vector2(C.x,B.y),O=this.createLine([R,E,L,I,B,V]);return d.add(w,v,A,D,O),d.rotation.z=a,d.position.set(e.x,e.y,this.componentZ),d.modelPath=url+"/assets/model/window/waveWindow/waveWindow.glb",d}static createFrenchWindow(e,t,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=new i.Vector2(-t/2,-n/2),c=new i.Vector2(-t/2,n/2),h=new i.Vector2(t/2,n/2),d=new i.Vector2(t/2,-n/2),u=this.createShapeByPointArr([c,h,d,l]),p=this.createLine([l,c,h,d,l]),m=new i.Vector2(-t/2,-n/6),f=new i.Vector2(t/2,-n/6),g=new i.Vector2(-t/2,0),x=new i.Vector2(t/2,0),b=new i.Vector2(-t/2,n/6),y=new i.Vector2(t/2,n/6),w=new i.Vector2(0,n/6),v=new i.Vector2(0,-n/6),$=this.createLine([m,f]),S=this.createLine([g,x]),P=this.createLine([b,y]),k=this.createLine([w,v]);return s.add(u,p,$,S,P,k),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),M.addDoorParam(s,t,n,o,a,e,r,"frenchwindows"),s.modelPath=url+"/assets/model/window/frenchWindow/frenchWindow.glb",s}static createPanoramicWindow(e,t,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=t-n,c=new i.Vector2(-l/2,-n/2),h=new i.Vector2(c.x,c.y+this.cornerWindowWidth),d=new i.Vector2(h.x+l,h.y),u=new i.Vector2(l/2,-n/2),p=this.createShapeByPointArr([h,d,u,c],"mesh",13421772),m=this.createLine([c,h,d,u,c]),f=new i.Vector2(-l/2,n/2),g=new i.Vector2(f.x-n,f.y),x=new i.Vector2(g.x,g.y+this.cornerWindowWidth),b=new i.Vector2(x.x+t+n,x.y),y=new i.Vector2(b.x,b.y-this.cornerWindowWidth),w=new i.Vector2(y.x-n,y.y),v=new i.Vector2(f.x-n/2,f.y),$=new i.Vector2(v.x,v.y+this.cornerWindowWidth-n/2),S=new i.Vector2($.x+l+n,$.y),P=new i.Vector2(S.x,S.y-this.cornerWindowWidth+n/2),k=this.createShapeByPointArr([g,x,b,y,w,d,h,f]),_=this.createLine([f,g,x,b,y,w]),T=this.createLine([v,$,S,P]);return s.add(p,m,k,_,T),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),M.addDoorParam(s,t,740,o,a,e,r,"straightBayWindow"),s.modelPath=url+"/assets/model/window/panoramicWindow/panoramicWindow.glb",s}static createBeam(e,t,r=0,n=400,o=400,a=!1,s=!1,l="R"){let c,h,d=new i.Group;if("beam"==t){let t=new(0,$.BeamMesh)({position:e,rotation:r,thickness:n,depth:o,wallList:a,width:s,model:l});return t.create(),M.addMemberParam(t,r,t.parameter.width,n,o,e,"beam"),t.name="bridge",t}if("pillars"==t){let t=new i.Vector2(-s/2,-n/2),a=new i.Vector2(s/2,-n/2),l=new i.Vector2(s/2,n/2),u=new i.Vector2(-s/2,n/2);h=this.createShapeByPointArr([a,l,u,t],"mesh",0),c=this.createLine([t,a,l,u,t]),d.add(h,c),d.rotation.z=r,d.position.set(e.x,e.y,this.componentZ),d.name="post",M.addMemberParam(d,r,s,n,o,e,"pillars")}return h.position.z=5,d}static getIntersect(e,t,r,n,o){let a=[],s=[],l=[],c=[],h="",d="";for(let h=0;h<n.length;h++){let d=Array.from(n[h].geometry.attributes.position.array),u=new i.Vector2(d[0],d[1]),p=new i.Vector2(d[6],d[7]),m=new i.Vector2(d[9],d[10]),f=new i.Vector2(d[15],d[16]),g=this.getAndCheck(u,m,[t,r],o),x=this.getAndCheck(p,f,[t,r],o);if(g&&x){let t=e.distanceTo(g)>e.distanceTo(x)?x:g;t.x>e.x?(a.push(t),l.push(n[h])):t.x<e.x?(s.push(t),c.push(n[h])):t.y>e.y?(a.push(t),l.push(n[h])):(s.push(t),c.push(n[h]))}}return a.length>1?a.forEach((t=>{if(""==h)h=t;else{let i=e.distanceTo(h);e.distanceTo(t)<i&&(h=t)}})):(h=a[0],h&&(h.wall=l[0])),s.length>1?s.forEach((t=>{if(""==d)d=t;else{let i=e.distanceTo(d);e.distanceTo(t)<i&&(d=t)}})):(d=s[0],d&&(d.wall=c[0])),[d,h]}static getAndCheck(e,t,r,n){let o=n.getLineData(e,t),a=n.computeIntersectPoint(o,r,new i.Vector2(0,0)),s=Math.min(Math.round(1e3*e.x)/1e3,Math.round(1e3*t.x)/1e3),l=Math.max(Math.round(1e3*e.x)/1e3,Math.round(1e3*t.x)/1e3),c=Math.min(Math.round(1e3*e.y)/1e3,Math.round(1e3*t.y)/1e3),h=Math.max(Math.round(1e3*e.y)/1e3,Math.round(1e3*t.y)/1e3);if(a){let e=a.x>=s&&a.x<=l,t=a.y>=c&&a.y<=h;return!(!e||!t)&&a}return!1}static createFlue(e,t=650,r=650,n=0){let o=new i.Group,a=new i.Vector2(-t/2,r/2),s=new i.Vector2(t/2,r/2),l=new i.Vector2(t/2,-r/2),c=new i.Vector2(-t/2,-r/2),h=new i.Vector2(a.x+40,a.y-40),d=new i.Vector2(s.x-40,s.y-40),u=new i.Vector2(l.x-40,l.y+40),p=new i.Vector2(c.x+40,c.y+40),m=new i.Vector2(t*(500/650)-t/2,r/2-r*(155/650)),f=this.createShapeByPointArr([a,s,l,c]),g=this.createLine([a,s,l,c,a]),x=this.createLine([h,d,u,p,h,m,u]);return o.add(f,g,x),o.position.set(e.x,e.y,this.componentZ),o.rotation.z=n,M.addMemberParam(o,n,t,r,window.storeyHei,e,"flue"),o.name="flue",o}static createDoorHole(e,t,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=new i.Vector2(-t/2,n/2),c=new i.Vector2(t/2,n/2),h=new i.Vector2(t/2,-n/2),d=new i.Vector2(-t/2,-n/2),u=this.createShapeByPointArr([l,c,h,d]),p=this.createLine([l,c],0,!0),m=this.createLine([c,h]),f=this.createLine([h,d],0,!0),g=this.createLine([d,l]);return s.add(u,p,m,f,g),s.position.set(e.x,e.y,this.componentZ),s.rotation.z=r,M.addDoorParam(s,t,n,o,a,e,r,"dooropen"),s}static createLine(e,t=0,a=!1,s=1.5){let l=[];e.forEach((e=>{l.push(e.x,e.y,0)}));var c=(new(0,o.LineGeometry)).setPositions(l),h=new(0,n.LineMaterial)({color:t,linewidth:s,dashed:a,transparent:!0,side:i.DoubleSide});h.resolution.set(window.innerWidth,window.innerHeight);var d=new(0,r.Line2)(c,h);return d.renderOrder=this.lineRenderOrder,d.computeLineDistances(),d}static createShapeByPointArr(e,t="mesh",r=16777215){let n=new i.Shape;if(n.moveTo(e[e.length-1].x,e[e.length-1].y),e.forEach((e=>{n.lineTo(e.x,e.y)})),"shape"==t)return n;let o=new i.ShapeGeometry(n),a=new i.Mesh(o,new i.MeshBasicMaterial({color:r}));return a.renderOrder=this.shapeRenderOrder,a.position.z=-5,a}static createArc(e,t,r,n,o=0,a=!1){let s=(new i.Path).arc(e.x,e.y,t,r,n,!1).getPoints();if(a)return s;let l=(new i.BufferGeometry).setFromPoints(s),c=new i.Line(l,new i.LineBasicMaterial({color:o}));return c.renderOrder=this.lineRenderOrder,c}static createBaseDoorNew(e,t,r="outside",n="left",o=0,a=this.thickness,s="",c=""){let h=new i.Group,d=new(0,l.BaseDoorGeometry)(t,a,r,n),u=new i.Mesh(d,new i.MeshBasicMaterial({color:16777215})),p=(new(0,f.DWHelper)).active(u);return h.add(u,p),h.rotation.z=o,h.position.set(e.x,e.y,this.componentZ),M.addDoorParam(h,t,a,s,c,e,o,"door",r),h.modelPath=url+"/assets/model/door/baseDoor/baseDoor.glb",h}static createDODoorNew(e,t,r="outside",n=0,o=this.thickness,a="",s=""){let l=new i.Group,h=new(0,c.DoubleOpenDoorGeometry)(t,o,r),d=new i.Mesh(h,new i.MeshBasicMaterial({color:16777215})),u=(new(0,f.DWHelper)).active(d);return l.add(d,u),l.rotation.z=n,l.position.set(e.x,e.y,this.componentZ),M.addDoorParam(l,t,o,a,s,e,n,"doubledoor"),l.modelPath=url+"/assets/model/door/doubleOpenDoor/doubleOpenDoor.glb",l}static createSlidingDoorNew(e,t,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=new(0,h.SlidingDoorGeometry)(t,n),c=new i.Mesh(l,new i.MeshBasicMaterial({color:16777215})),d=(new(0,f.DWHelper)).active(c);return s.add(c,d),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),M.addDoorParam(s,t,n,o,a,e,r,"slidingdoor"),s.modelPath=url+"/assets/model/door/slidingDoor/slidingDoor.glb",s}static createBaseWindowNew(e,t,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=new(0,d.BaseWindowGeometry)(t,n),c=new i.Mesh(l,new i.MeshPhongMaterial({color:16777215})),h=(new(0,f.DWHelper)).active(c);return s.add(c,h),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),M.addDoorParam(s,t,n,o,a,e,r,"window"),s.modelPath=url+"/assets/model/window/baseWindow/baseWindow.glb",s}static createPanoramicWindowNew(e,t,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=new(0,u.PanoramicWindowGeometry)(t,n);console.log(l);let c=new i.Mesh(l,[new i.MeshBasicMaterial({color:13421772}),new i.MeshBasicMaterial({color:16777215})]),h=(new(0,f.DWHelper)).active(c);return s.add(c,h),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),M.addDoorParam(s,t,n,o,a,e,r,"straightBayWindow"),s.modelPath=url+"/assets/model/window/panoramicWindow/panoramicWindow.glb",s}static createFrenchWindowNew(e,t,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=new(0,p.FrenchWindowGeometry)(t,n),c=new i.Mesh(l,new i.MeshBasicMaterial({color:16777215})),h=(new(0,f.DWHelper)).active(c);return s.add(c,h),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),M.addDoorParam(s,t,n,o,a,e,r,"frenchwindows"),s.modelPath=url+"/assets/model/window/frenchWindow/frenchWindow.glb",s}static createLashDoorNew(e,t=1450,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=new(0,m.LashDoorGeometry)(t,n),c=new i.Mesh(l,new i.MeshBasicMaterial({color:16777215})),h=(new(0,f.DWHelper)).active(c);return s.add(c,h),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),M.addDoorParam(s,t,n,o,a,e,r,"childMotherDoor"),s.modelPath=url+"/assets/model/door/lashDoor/lashDoor.glb",s}static createPassNew(e,t,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=new(0,g.PassGeometry)(t,n),c=new i.Mesh(l,new i.MeshBasicMaterial({color:16777215})),h=(new(0,f.DWHelper)).active(c);return s.add(c,h),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),M.addDoorParam(s,t,n,o,a,e,r,"passDoor"),s.modelPath=url+"/assets/model/door/pass/pass1.glb",s}static createSectorDoorNew(e,t,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=new(0,x.SectorDoorGeometry)(t,n),c=new i.Mesh(l,new i.MeshBasicMaterial({color:16777215})),h=(new(0,f.DWHelper)).active(c);return s.add(c,h),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),M.addDoorParam(s,t,n,o,a,e,r,"archDoor"),s.modelPath=url+"/assets/model/door/sectorDoor/sectorDoor.glb",s}static createSectorWindowNew(e,t,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=new(0,b.SectorWindowGeometry)(t,n),c=new i.Mesh(l,new i.MeshBasicMaterial({color:16777215})),h=(new(0,f.DWHelper)).active(c);return s.add(c,h),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),M.addDoorParam(s,t,n,o,a,e,r,"archWindow"),s.modelPath=url+"/assets/model/window/sectorWindow/sectorWindow.glb",s}static createArcBaseWindowNew(e,t=!1,r=this.thickness,n=Math.PI/12){let o,a,s=new i.Group,l=1500;if(e=new i.Vector2(e.x,e.y),t){let r=e.clone().sub(t);l=r.length();let s=new i.Vector2(r.x,r.y).angle();o=s-n,a=s+n}else{t=new i.Vector2(e.x,e.y).add(new i.Vector2(0,-1).setLength(l)),o=5*Math.PI/12,a=7*Math.PI/12}let c=this.createArc(t,l,o,a,16777215,!0),h=new(0,y.ArcBaseWindowGeometry)(t,l,r,o,a),d=new i.Mesh(h,new i.MeshBasicMaterial({color:16777215})),u=(new(0,f.DWHelper)).active(d);return s.add(d,u),M.addDoorParam(s,1e3,r,c[0],c[c.length-1],e,n,"arcWindow"),s.startPoint=c[0],s.endPoint=c[c.length-1],s.arcCenter=t,s.position.z=this.componentZ,s.modelPath=url+"/assets/model/window/05/arcWindow.glb",s}static createUWindowNew(e,t,r,n,o=1200,a=1200){let s=new i.Group,l=240,c=240,h=240,d=0,u=2500;if(t&&r&&n){l=t.thickness,c=r.thickness,h=n.thickness,u=r.startPoint.distanceTo(r.endPoint)-l/2-h/2;let e,i,o=r.startPoint,a=r.endPoint,s=t.startPoint,p=t.endPoint,m=n.startPoint,f=n.endPoint;o.equals(s)||o.equals(p)?e=o:(a.equals(s)||a.equals(p))&&(e=a),o.equals(m)||o.equals(f)?i=o:(a.equals(m)||a.equals(f))&&(i=a),e&&i&&(d=i.clone().sub(e).angle())}let p=new(0,v.UWindowGeometry)(u,o,a,l,c,h),m=new i.Mesh(p,new i.MeshBasicMaterial({color:16777215})),g=(new(0,f.DWHelper)).active(m);return s.add(m,g),s.rotation.z=d,s.position.set(e.x,e.y,this.componentZ),s.leftWindow=[t,o],s.rightWindow=[n,a],M.addDoorParam(s,u+l+h,c,"","",e,d,"UWindow"),s.modelPath=url+"/assets/model/window/uWindow/uWindow.glb",s}static getHoleJson(e,t){let i=[];return e.forEach((e=>{let r=e.modelType;if(!r)return;let n=e.center,o=e.doorWid,a=e.wallId,l="",c=e.wallDep,h=1*e.floorHei,d=1*e.height;if(r.includes("Door")||r.includes("door"))l={location:{x:n.x,y:n.y,z:d/2+h},width:o,height:d,withSector:!1,offsetXY:0,wallID:a,windowThick:c},e.doorDir&&(l.doorDir=e.doorDir),"archDoor"==r&&(l.withSector=!0),"dooropen"==r&&(l.dir=r);else if(r.includes("Window")||r.includes("window")){if(l={location:{x:n.x,y:n.y,z:d/2+h},width:o,height:d,withSector:!1,offsetXY:0,wallID:a,windowThick:c},"UWindow"==r&&(l.windowThickL=e.leftWindow[1],l.windowThickR=e.rightWindow[1]),"waveWindow"==r&&(l.windowThick+=500),"straightBayWindow"==r&&(l.masterAngle=e.rotation.z,l.windowThick+=500),"archWindow"==r&&(l.withSector=!0),"arcWindow"==r){l.isArc=!0;let t=e.center.clone().sub(e.arcCenter.clone()).angle();l.startRadian=t-e.angle,l.endRadian=t+e.angle,l.positionZ=d/2+h}}else l={location:{x:n.x,y:n.y,z:d/2+h},width:o,height:d,withSector:!1,offsetXY:0,wallID:a,windowThick:c};if("LWindow"==r){let t=e.leftWindow,r=e.rightWindow;l.commonPoint=l.location,l.location={x:t[2].x,y:t[2].y,z:d/2+h},l.width=t[1],l.wallID=t[0].wallID,l.windowThick=t[0].thickness,l.path=t[3],l.diff=t[4];let n=JSON.parse(JSON.stringify(l));n.location={x:r[2].x,y:r[2].y,z:d/2+h},n.width=r[1],n.wallID=r[0].wallID,n.windowThick=r[0].thickness,n.path=r[3],n.diff=r[4],n.uuid=e.uuid,i.push(n)}if("UWindow"==r){let r=t.getWallByWallId(l.wallID),o=s.UtilCore.getSamePointWall(r,t.allWalls),a=r.startPoint,c=s.UtilCore.getMeshOtherPoint(o[1],a);(s.UtilCore.isSameVector(o[0].startPoint,a)||s.UtilCore.isSameVector(o[0].endPoint,a))&&(c=s.UtilCore.getMeshOtherPoint(o[0],a));let h=c.clone().sub(a.clone()).setLength(480);l.location.x=n.x+h.x,l.location.y=n.y+h.y;let d=JSON.parse(JSON.stringify(l));d.masterAngle=e.angle,d.width+=1,d.wallID=o[0].wallID,d.dir="UWindow";let u=JSON.parse(JSON.stringify(l));u.wallID=o[1].wallID,u.masterAngle=e.angle,u.width+=1,u.dir="UWindow",i.push(d),i.push(u)}e.modelPath&&(l.path=e.modelPath),e.arcHei&&(l.arcHei=e.arcHei),l.isLock=!!e.isLock,l.uuid=e.uuid,i.push(l)})),i}static memberJson(e){let t=[];return e.forEach((e=>{let i=e.position,r={location:{x:i.x,y:i.y,z:e.depth/2},height:Math.round(e.height*e.scale.y),depth:e.depth,rotation:e.rotation.z,angle:e.angle,type:e.modelType,id:e.id,isLock:!!e.isLock};"beam"==e.modelType&&(r.location.z=window.storeyHei-e.depth/2),"flue"==e.modelType&&(r.location.z=window.storeyHei/2),e.width&&(r.width=Math.round(e.width*e.scale.x)),t.push(r)})),t}static getWallJson(e){let t=[],r=0,n=this.getWallId(e);return 0!=n.length&&(r=Math.max(...n)),e.forEach((e=>{if(s.UtilCore.isSameVector(e.startPoint,e.endPoint))return;if("remove"==e.status)return;e.wallID||(r+=1),t.forEach((t=>{let r=s.UtilCore.handleLineData(t.start,t.end);if(!s.UtilCore.pointInLine(e.startPoint,r))return;let n=new(0,i.Vector2)(t.start.x,t.start.y),o=new(0,i.Vector2)(t.end.x,t.end.y),a=n.clone().distanceTo(e.startPoint.clone()),l=n.clone().distanceTo(e.endPoint.clone()),c=o.clone().distanceTo(e.startPoint.clone()),h=o.clone().distanceTo(e.endPoint.clone());a<=30&&(e.startPoint=n.clone()),l<=30&&(e.endPoint=n.clone()),c<=30&&(e.startPoint=o.clone()),h<=30&&(e.endPoint=o.clone())}));let n={start:{x:e.startPoint.x,y:e.startPoint.y,z:0},end:{x:e.endPoint.x,y:e.endPoint.y,z:0},id:e.wallID?e.wallID:r,style:e.style,line:e.line,isArc:e.isArc,thickness:e.thickness,height:e.height,offsetXY:100};e.isArc&&e.cp&&(n.cp={x:1*e.cp.x.toFixed(2),y:1*e.cp.y.toFixed(2),z:0}),t.push(n)})),t}static getModelJson(e,t=[],i=!1){return e.forEach((e=>{let r={},n=editor.getRealSize(e);if(e.imgPath)return r={imgPath:e.imgPath,modelPath:e.modelPath,width:n[0]/e.scale.x,height:n[1]/e.scale.y,depth:n[2]/e.scale.z,rotation:e.rotation.y,modelPosition:e.modelPosition,location:{x:e.position.x,y:e.position.y,z:e.position.z},rotate:{x:e.rotation.x,y:e.rotation.y,z:e.rotation.z},scale:{x:e.scale.x,y:e.scale.y,z:e.scale.z},imgLayer:e.param[0].position.z},e.param[0].position.z<=-.1&&(r.imgLayer=-.1),r.isLock=!!e.isLock,t.push(r),void(e.sliceArr&&(r.sliceArr=e.sliceArr));r.child=M.getModelJson(e.children,[],i),r.modelType=e.modelType,r.location={x:e.position.x,y:e.position.y,z:e.position.z},r.isLock=!!e.isLock,r.rotation=e.rotation.y,r.rotate={x:e.rotation.x,y:e.rotation.y,z:e.rotation.z},r.scale={x:e.scale.x,y:e.scale.y,z:e.scale.z},r.width=n[0]/e.scale.x,r.height=n[1]/e.scale.y,r.depth=n[2]/e.scale.z,t.push(r)})),t}static getSplitLineJson(e){let t=[];return e.forEach((e=>{let i={start:{x:1*e.startPoint.x.toFixed(2),y:1*e.startPoint.y.toFixed(2),z:0},end:{x:1*e.endPoint.x.toFixed(2),y:1*e.endPoint.y.toFixed(2),z:0},useType:e.useType};t.push(i)})),t}static getWallId(e){let t=[];return e.forEach((e=>{e.wallID&&t.push(e.wallID)})),t}}})),parcelRequire.register("jizqJ",(function(e,t){$parcel$export(e.exports,"BaseDoorGeometry",(()=>n));var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class n extends i.BufferGeometry{constructor(e,t,n,o){super(),this.type="BaseDoorGeometry",this.parameters={width:e,height:t,openType:n,openDirection:o};const a=[],s=[],l=[],c=[];!function(e,t,r,n){let o=new(0,i.Shape),h=new(0,i.Vector2)(e/2,t/2),d=new(0,i.Vector2)(e/2,-t/2),u=new(0,i.Vector2)(-e/2,-t/2),p=new(0,i.Vector2)(-e/2,e),m=new(0,i.Vector2)(-e/2+t/2,e),f=new(0,i.Vector2)(-e/2+t/2,t/2);[h,d,u,p,m,f].forEach((e=>{e=function(e,t,i){"outside"==t?"right"==i&&(e.x=-e.x):"inside"==t&&("left"==i?e.y=-e.y:"right"==i&&(e.x=-e.x,e.y=-e.y));return e}(e,r,n)})),o.moveTo(f.x,f.y),[h,d,u,p,m,f].forEach((e=>{o.lineTo(e.x,e.y)}));let g=new(0,i.ShapeGeometry)(o);a.push(...Array.from(g.index.array)),s.push(...Array.from(g.attributes.position.array)),l.push(...Array.from(g.attributes.normal.array)),c.push(...Array.from(g.attributes.uv.array))}(e,t,n,o),this.setIndex(a),this.setAttribute("position",new(0,r.Float32BufferAttribute)(s,3)),this.setAttribute("normal",new(0,r.Float32BufferAttribute)(l,3)),this.setAttribute("uv",new(0,r.Float32BufferAttribute)(c,2))}}})),parcelRequire.register("7UrFP",(function(e,t){$parcel$export(e.exports,"Float32BufferAttribute",(()=>c));var i=parcelRequire("1cnge"),r=parcelRequire("90poP"),n=parcelRequire("lYiBp"),o=parcelRequire("fpCf6");const a=new(0,i.Vector3),s=new(0,r.Vector2);class l{constructor(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.usage=o.StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,n=this.itemSize;r<n;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)s.fromBufferAttribute(this,t),s.applyMatrix3(e),this.setXY(t,s.x,s.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)a.fromBufferAttribute(this,t),a.applyMatrix3(e),this.setXYZ(t,a.x,a.y,a.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)a.fromBufferAttribute(this,t),a.applyMatrix4(e),this.setXYZ(t,a.x,a.y,a.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)a.fromBufferAttribute(this,t),a.applyNormalMatrix(e),this.setXYZ(t,a.x,a.y,a.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)a.fromBufferAttribute(this,t),a.transformDirection(e),this.setXYZ(t,a.x,a.y,a.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=(0,n.denormalize)(t,this.array)),t}setX(e,t){return this.normalized&&(t=(0,n.normalize)(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=(0,n.denormalize)(t,this.array)),t}setY(e,t){return this.normalized&&(t=(0,n.normalize)(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=(0,n.denormalize)(t,this.array)),t}setZ(e,t){return this.normalized&&(t=(0,n.normalize)(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=(0,n.denormalize)(t,this.array)),t}setW(e,t){return this.normalized&&(t=(0,n.normalize)(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=(0,n.normalize)(t,this.array),i=(0,n.normalize)(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=(0,n.normalize)(t,this.array),i=(0,n.normalize)(i,this.array),r=(0,n.normalize)(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,o){return e*=this.itemSize,this.normalized&&(t=(0,n.normalize)(t,this.array),i=(0,n.normalize)(i,this.array),r=(0,n.normalize)(r,this.array),o=(0,n.normalize)(o,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==o.StaticDrawUsage&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class c extends l{constructor(e,t,i){super(new Float32Array(e),t,i)}}})),parcelRequire.register("1cnge",(function(e,t){$parcel$export(e.exports,"Vector3",(()=>n));var i=parcelRequire("lYiBp"),r=parcelRequire("deibi");class n{constructor(e=0,t=0,i=0){n.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(a.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(a.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,n=e.elements,o=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*o,this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*o,this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,n=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*r-a*i,c=s*i+a*t-n*r,h=s*r+n*i-o*t,d=-n*t-o*i-a*r;return this.x=l*s+d*-n+c*-a-h*-o,this.y=c*s+d*-o+h*-n-l*-a,this.z=h*s+d*-a+l*-o-c*-n,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,n=e.z,o=t.x,a=t.y,s=t.z;return this.x=r*s-n*a,this.y=n*o-i*s,this.z=i*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return o.copy(this).projectOnVector(e),this.sub(o)}reflect(e){return this.sub(o.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(i.clamp(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const o=new n,a=new(0,r.Quaternion)})),parcelRequire.register("lYiBp",(function(e,t){$parcel$export(e.exports,"clamp",(()=>i)),$parcel$export(e.exports,"denormalize",(()=>r)),$parcel$export(e.exports,"normalize",(()=>n));Math.PI,Math.PI;function i(e,t,i){return Math.max(t,Math.min(i,e))}function r(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function n(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}})),parcelRequire.register("deibi",(function(e,t){$parcel$export(e.exports,"Quaternion",(()=>r));var i=parcelRequire("lYiBp");class r{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,n,o,a){let s=i[r+0],l=i[r+1],c=i[r+2],h=i[r+3];const d=n[o+0],u=n[o+1],p=n[o+2],m=n[o+3];if(0===a)return e[t+0]=s,e[t+1]=l,e[t+2]=c,void(e[t+3]=h);if(1===a)return e[t+0]=d,e[t+1]=u,e[t+2]=p,void(e[t+3]=m);if(h!==m||s!==d||l!==u||c!==p){let e=1-a;const t=s*d+l*u+c*p+h*m,i=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const n=Math.sqrt(r),o=Math.atan2(n,t*i);e=Math.sin(e*o)/n,a=Math.sin(a*o)/n}const n=a*i;if(s=s*e+d*n,l=l*e+u*n,c=c*e+p*n,h=h*e+m*n,e===1-a){const e=1/Math.sqrt(s*s+l*l+c*c+h*h);s*=e,l*=e,c*=e,h*=e}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,i,r,n,o){const a=i[r],s=i[r+1],l=i[r+2],c=i[r+3],h=n[o],d=n[o+1],u=n[o+2],p=n[o+3];return e[t]=a*p+c*h+s*u-l*d,e[t+1]=s*p+c*d+l*h-a*u,e[t+2]=l*p+c*u+a*d-s*h,e[t+3]=c*p-a*h-s*d-l*u,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const i=e._x,r=e._y,n=e._z,o=e._order,a=Math.cos,s=Math.sin,l=a(i/2),c=a(r/2),h=a(n/2),d=s(i/2),u=s(r/2),p=s(n/2);switch(o){case"XYZ":this._x=d*c*h+l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h-d*u*p;break;case"YXZ":this._x=d*c*h+l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h+d*u*p;break;case"ZXY":this._x=d*c*h-l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h-d*u*p;break;case"ZYX":this._x=d*c*h-l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h+d*u*p;break;case"YZX":this._x=d*c*h+l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h-d*u*p;break;case"XZY":this._x=d*c*h-l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h+d*u*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],n=t[8],o=t[1],a=t[5],s=t[9],l=t[2],c=t[6],h=t[10],d=i+a+h;if(d>0){const e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(c-s)*e,this._y=(n-l)*e,this._z=(o-r)*e}else if(i>a&&i>h){const e=2*Math.sqrt(1+i-a-h);this._w=(c-s)/e,this._x=.25*e,this._y=(r+o)/e,this._z=(n+l)/e}else if(a>h){const e=2*Math.sqrt(1+a-i-h);this._w=(n-l)/e,this._x=(r+o)/e,this._y=.25*e,this._z=(s+c)/e}else{const e=2*Math.sqrt(1+h-i-a);this._w=(o-r)/e,this._x=(n+l)/e,this._y=(s+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(i.clamp(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,n=e._z,o=e._w,a=t._x,s=t._y,l=t._z,c=t._w;return this._x=i*c+o*a+r*l-n*s,this._y=r*c+o*s+n*a-i*l,this._z=n*c+o*l+i*s-r*a,this._w=o*c-i*a-r*s-n*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,r=this._y,n=this._z,o=this._w;let a=o*e._w+i*e._x+r*e._y+n*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=n,this;const s=1-a*a;if(s<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*i+t*this._x,this._y=e*r+t*this._y,this._z=e*n+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(s),c=Math.atan2(l,a),h=Math.sin((1-t)*c)/l,d=Math.sin(t*c)/l;return this._w=o*h+this._w*d,this._x=i*h+this._x*d,this._y=r*h+this._y*d,this._z=n*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(n),i*Math.cos(n),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}})),parcelRequire.register("90poP",(function(e,t){$parcel$export(e.exports,"Vector2",(()=>i));class i{constructor(e=0,t=0){i.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*i-o*r+e.x,this.y=n*r+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}})),parcelRequire.register("fpCf6",(function(e,t){$parcel$export(e.exports,"StaticDrawUsage",(()=>i));const i=35044})),parcelRequire.register("9f3nc",(function(e,t){$parcel$export(e.exports,"DoubleOpenDoorGeometry",(()=>n));var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class n extends i.BufferGeometry{constructor(e,t,n){super(),this.type="DoubleOpenDoorGeometry",this.parameters={width:e,height:t,openType:n};const o=[],a=[],s=[],l=[];!function(e,t,r){let n=new(0,i.Shape),c=new(0,i.Vector2)(e/2-t/2,t/2),h=new(0,i.Vector2)(e/2-t/2,e/2),d=new(0,i.Vector2)(e/2,e/2),u=new(0,i.Vector2)(e/2,-t/2),p=new(0,i.Vector2)(-c.x,c.y),m=new(0,i.Vector2)(-h.x,h.y),f=new(0,i.Vector2)(-d.x,d.y),g=new(0,i.Vector2)(-u.x,u.y);"inside"==r&&[c,h,d,u,g,f,m,p].forEach((e=>{e.y=-e.y}));n.moveTo(p.x,p.y),[c,h,d,u,g,f,m,p].forEach((e=>{n.lineTo(e.x,e.y)}));let x=new(0,i.ShapeGeometry)(n);o.push(...Array.from(x.index.array)),a.push(...Array.from(x.attributes.position.array)),s.push(...Array.from(x.attributes.normal.array)),l.push(...Array.from(x.attributes.uv.array))}(e,t,n),this.setIndex(o),this.setAttribute("position",new(0,r.Float32BufferAttribute)(a,3)),this.setAttribute("normal",new(0,r.Float32BufferAttribute)(s,3)),this.setAttribute("uv",new(0,r.Float32BufferAttribute)(l,2))}}})),parcelRequire.register("5HP0C",(function(e,t){$parcel$export(e.exports,"SlidingDoorGeometry",(()=>r));var i=parcelRequire("lmKU8");class r extends i.RectangularGeometry{constructor(e,t){super(e,t),this.type="SlidingDoorGeometry",this.parameters={width:e,height:t}}}})),parcelRequire.register("lmKU8",(function(e,t){$parcel$export(e.exports,"RectangularGeometry",(()=>n));var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class n extends i.BufferGeometry{constructor(e,t){super(),this.parameters={width:e,height:t};const n=[],o=[],a=[],s=[];!function(e,t){let r=new(0,i.Shape),l=new(0,i.Vector2)(e/2,t/2),c=new(0,i.Vector2)(e/2,-t/2),h=new(0,i.Vector2)(-e/2,-t/2),d=new(0,i.Vector2)(-e/2,t/2);r.moveTo(d.x,d.y),[l,c,h,d].forEach((e=>{r.lineTo(e.x,e.y)}));let u=new(0,i.ShapeGeometry)(r);n.push(...Array.from(u.index.array)),o.push(...Array.from(u.attributes.position.array)),a.push(...Array.from(u.attributes.normal.array)),s.push(...Array.from(u.attributes.uv.array))}(e,t),this.setIndex(n),this.setAttribute("position",new(0,r.Float32BufferAttribute)(o,3)),this.setAttribute("normal",new(0,r.Float32BufferAttribute)(a,3)),this.setAttribute("uv",new(0,r.Float32BufferAttribute)(s,2))}}})),parcelRequire.register("kHWob",(function(e,t){$parcel$export(e.exports,"BaseWindowGeometry",(()=>r));var i=parcelRequire("lmKU8");class r extends i.RectangularGeometry{constructor(e,t){super(e,t),this.type="BaseWindowGeometry",this.parameters={width:e,height:t}}}})),parcelRequire.register("xl6VI",(function(e,t){$parcel$export(e.exports,"PanoramicWindowGeometry",(()=>n));var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class n extends i.BufferGeometry{constructor(e,t,n=500){super(),this.type="PanoramicWindowGeometry",this.parameters={width:e,thickness:t,platHeight:n};const o=[],a=[],s=[],l=[],c=[];!function(e,t,r){let n=e-t,h=new(0,i.Shape),d=new(0,i.Vector2)(-n/2,-t/2),u=new(0,i.Vector2)(-n/2,d.y+r),p=new(0,i.Vector2)(n/2,u.y),m=new(0,i.Vector2)(n/2,-t/2);h.moveTo(m.x,m.y),[d,u,p,m].forEach((e=>{h.lineTo(e.x,e.y)}));let f=new(0,i.ShapeGeometry)(h);o.push(...Array.from(f.index.array)),a.push(...Array.from(f.attributes.position.array)),s.push(...Array.from(f.attributes.normal.array)),l.push(...Array.from(f.attributes.uv.array)),c.push({start:0,count:f.index.array.length,materialIndex:0});let g=new(0,i.Shape),x=new(0,i.Vector2)(-n/2,t/2),b=new(0,i.Vector2)(-e/2-t/2,t/2),y=new(0,i.Vector2)(-e/2-t/2,t/2+r),w=new(0,i.Vector2)(e/2+t/2,t/2+r),v=new(0,i.Vector2)(e/2+t/2,t/2),$=new(0,i.Vector2)(n/2,t/2);g.moveTo(u.x,u.y),[x,b,y,w,v,$,p,u].forEach((e=>{g.lineTo(e.x,e.y)}));let M=new(0,i.ShapeGeometry)(g),S=Array.from(M.index.array);for(let e=0;e<S.length;e++)S[e]+=f.attributes.position.array.length/3;o.push(...S),a.push(...Array.from(M.attributes.position.array)),s.push(...Array.from(M.attributes.normal.array)),l.push(...Array.from(M.attributes.uv.array)),c.push({start:f.index.array.length,count:M.index.array.length,materialIndex:1})}(e,t,n),this.setIndex(o),this.setAttribute("position",new(0,r.Float32BufferAttribute)(a,3)),this.setAttribute("normal",new(0,r.Float32BufferAttribute)(s,3)),this.setAttribute("uv",new(0,r.Float32BufferAttribute)(l,2)),this.groups=c}}})),parcelRequire.register("gMe2U",(function(e,t){$parcel$export(e.exports,"FrenchWindowGeometry",(()=>r));var i=parcelRequire("lmKU8");class r extends i.RectangularGeometry{constructor(e,t){super(e,t),this.type="FrenchWindowGeometry",this.parameters={width:e,height:t}}}})),parcelRequire.register("lUO0N",(function(e,t){$parcel$export(e.exports,"LashDoorGeometry",(()=>r));var i=parcelRequire("lmKU8");class r extends i.RectangularGeometry{constructor(e,t){super(e,t),this.type="LashDoorGeometry",this.parameters={width:e,height:t}}}})),parcelRequire.register("arwMC",(function(e,t){$parcel$export(e.exports,"DWHelper",(()=>a));var i=parcelRequire("4xklQ"),r=parcelRequire("7WCxl"),n=parcelRequire("3KKM9"),o=parcelRequire("bnZk5");class a extends n.LineSegments2{constructor(e=new(0,o.LineSegmentsGeometry),t=new(0,r.LineMaterial)({color:16777215*Math.random()})){super(e,t),this.type="DWHelper",this.matrixAutoUpdate=!1}active(e,t=0){this.object=e;const i=[];let n,a;switch(this.vertices=i,"BaseDoorGeometry"==e.geometry.type&&(n=.0015,a=!1,this.getBaseDoorVertices(e)),e.geometry.type){case"BaseDoorGeometry":n=.0015,a=!1,this.getBaseDoorVertices(e);break;case"DoubleOpenDoorGeometry":n=.0015,a=!1,this.getDoubleOpenDoorVertices(e);break;case"SlidingDoorGeometry":n=.0015,a=!1,this.getSlidingDoorVertices(e);break;case"BaseWindowGeometry":n=.0015,a=!1,this.getBaseWindowVertices(e);break;case"PanoramicWindowGeometry":n=.001,a=!1,this.getPanoramicWindowVertices(e);break;case"FrenchWindowGeometry":n=.001,a=!1,this.getFrenchWindowVertices(e);break;case"LashDoorGeometry":n=.001,a=!1,this.getLashDoorVertices(e);break;case"PassGeometry":n=.001,a=!1,this.getPassVertices(e);break;case"SectorDoorGeometry":n=.001,a=!1,this.getSectorDoorVertices(e);break;case"SectorWindowGeometry":n=.001,a=!1,this.getSectorWindowVertices(e);break;case"ArcBaseWindowGeometry":n=.001,a=!1,this.getArcBaseWindowVertices(e);break;case"LWindowGeometry":n=.001,a=!1,this.getLWindowVertices(e);break;case"UWindowGeometry":n=.001,a=!1,this.getUWindowVertices(e)}const s=(new(0,o.LineSegmentsGeometry)).setPositions(i);return this.geometry.dispose(),this.geometry=s,this.material=new(0,r.LineMaterial)({color:t,linewidth:n,dashed:a}),this}getBaseDoorVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,n=e.geometry.parameters.openType,o=e.geometry.parameters.openDirection,a=new(0,i.Vector2)(t/2,r/2),s=new(0,i.Vector2)(t/2,-r/2),l=new(0,i.Vector2)(-t/2,-r/2),c=new(0,i.Vector2)(-t/2,t),h=new(0,i.Vector2)(-t/2+r/2,t),d=new(0,i.Vector2)(-t/2+r/2,0),u=new(0,i.Vector2)(-t/2,0);[a,s,l,c,h,d,u].forEach((e=>{e=getNewPoint(e,n,o)})),[a,s,l,c,c,h,h,d,d,u].forEach((e=>{vertices.push(e.x,e.y,0)}));let p=getAngle(n,o,"start"),m=getAngle(n,o,"end"),f=(new(0,i.Path)).arc(u.x,u.y,t,p,m).getPoints();f.forEach(((e,t)=>{t!=f.length-1&&(vertices.push(e.x,e.y,0),vertices.push(f[t+1].x,f[t+1].y,0))}))}getNewPoint(e,t,i){return"outside"==t?"right"==i&&(e.x=-e.x):"inside"==t&&("left"==i?e.y=-e.y:"right"==i&&(e.x=-e.x,e.y=-e.y)),e}getAngle(e,t,i){if("outside"==e){if("left"==t){if("start"==i)return 0;if("end"==i)return Math.PI/2}if("right"==t){if("start"==i)return Math.PI/2;if("end"==i)return Math.PI}}if("inside"==e){if("left"==t){if("start"==i)return 3*Math.PI/2;if("end"==i)return 0}if("right"==t){if("start"==i)return Math.PI;if("end"==i)return 3*Math.PI/2}}}getDoubleOpenDoorVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,n=e.geometry.parameters.openType,o=new(0,i.Vector2)(t/2,-r/2),a=new(0,i.Vector2)(t/2,t/2),s=new(0,i.Vector2)(t/2-r/2,t/2),l=new(0,i.Vector2)(t/2-r/2,0),c=new(0,i.Vector2)(t/2,0),h=new(0,i.Vector2)(-o.x,o.y),d=new(0,i.Vector2)(-a.x,a.y),u=new(0,i.Vector2)(-s.x,s.y),p=new(0,i.Vector2)(-l.x,l.y),m=new(0,i.Vector2)(-c.x,c.y);"inside"==n&&[o,a,s,l,c,h,d,u,p,m].forEach((e=>{e.y=-e.y})),[o,a,a,s,s,l,l,c].forEach((e=>{vertices.push(e.x,e.y,0)})),[h,d,d,u,u,p,p,m].forEach((e=>{vertices.push(e.x,e.y,0)}));let f=m,g=c,x=0,b=Math.PI/2,y=Math.PI;"inside"==n&&(f=c,g=m,x=Math.PI,b=3*Math.PI/2,y=0);let w=(new(0,i.Path)).arc(f.x,f.y,t/2,x,b).getPoints();w.forEach(((e,t)=>{t!=w.length-1&&(vertices.push(e.x,e.y,0),vertices.push(w[t+1].x,w[t+1].y,0))}));let v=(new(0,i.Path)).arc(g.x,g.y,t/2,b,y).getPoints();v.forEach(((e,t)=>{t!=w.length-1&&(vertices.push(e.x,e.y,0),vertices.push(v[t+1].x,v[t+1].y,0))}))}getSlidingDoorVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,n=new(0,i.Vector2)(t/2,-r/2),o=new(0,i.Vector2)(t/2,r/2),a=new(0,i.Vector2)(-t/2,r/2),s=new(0,i.Vector2)(-t/2,-r/2);if([n,o,o,a,a,s,s,n].forEach((e=>{vertices.push(e.x,e.y,0)})),t<=2e3){let e=2*t/3,n=new(0,i.Vector2)(10-t/2,0),o=new(0,i.Vector2)(n.x,n.y+r/4),a=new(0,i.Vector2)(o.x+e,o.y),s=new(0,i.Vector2)(a.x,a.y-r/4);[n,o,o,a,a,s,s,n].forEach((e=>{vertices.push(e.x,e.y,0)}));let l=new(0,i.Vector2)(-n.x,-n.y),c=new(0,i.Vector2)(-o.x,-o.y),h=new(0,i.Vector2)(-a.x,-a.y),d=new(0,i.Vector2)(-s.x,-s.y);[l,c,c,h,h,d,d,l].forEach((e=>{vertices.push(e.x,e.y,0)}))}else if(t<=2500){let e=2*t/5,n=new(0,i.Vector2)(10-t/2,-r/4),o=new(0,i.Vector2)(n.x,n.y+r/4),a=new(0,i.Vector2)(o.x+e,o.y),s=new(0,i.Vector2)(a.x,a.y-r/4);[n,o,o,a,a,s,s,n].forEach((e=>{vertices.push(e.x,e.y,0)}));let l=new(0,i.Vector2)(-s.x,s.y),c=new(0,i.Vector2)(-a.x,a.y),h=new(0,i.Vector2)(-o.x,o.y),d=new(0,i.Vector2)(-n.x,n.y);[l,c,c,h,h,d,d,l].forEach((e=>{vertices.push(e.x,e.y,0)}));let u=new(0,i.Vector2)(-e/2,0),p=new(0,i.Vector2)(u.x,u.y+r/4),m=new(0,i.Vector2)(p.x+e,p.y),f=new(0,i.Vector2)(m.x,m.y-r/4);[u,p,p,m,m,f,f,u].forEach((e=>{vertices.push(e.x,e.y,0)}))}else{let e=t/4,n=new(0,i.Vector2)(10-t/2,-r/4),o=new(0,i.Vector2)(n.x,n.y+r/4),a=new(0,i.Vector2)(o.x+e,o.y),s=new(0,i.Vector2)(a.x,a.y-r/4);[n,o,o,a,a,s,s,n].forEach((e=>{vertices.push(e.x,e.y,0)}));let l=new(0,i.Vector2)(a.x-e/4,a.y),c=new(0,i.Vector2)(l.x,l.y+r/4),h=new(0,i.Vector2)(c.x+e,c.y),d=new(0,i.Vector2)(h.x,h.y-r/4);[l,c,c,h,h,d,d,l].forEach((e=>{vertices.push(e.x,e.y,0)}));let u=new(0,i.Vector2)(-n.x,n.y),p=new(0,i.Vector2)(-o.x,o.y),m=new(0,i.Vector2)(-a.x,a.y),f=new(0,i.Vector2)(-s.x,s.y);[u,p,p,m,m,f,f,u].forEach((e=>{vertices.push(e.x,e.y,0)}));let g=new(0,i.Vector2)(-l.x,l.y),x=new(0,i.Vector2)(-c.x,c.y),b=new(0,i.Vector2)(-h.x,h.y),y=new(0,i.Vector2)(-d.x,d.y);[g,x,x,b,b,y,y,g].forEach((e=>{vertices.push(e.x,e.y,0)}))}}getBaseWindowVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,n=new(0,i.Vector2)(t/2,0),o=new(0,i.Vector2)(t/2,-r/2),a=new(0,i.Vector2)(-t/2,-r/2),s=new(0,i.Vector2)(-t/2,0),l=[n,o,a,s,new(0,i.Vector2)(-t/2,r/2),new(0,i.Vector2)(t/2,r/2),n,s];this.getContinuousLine(l)}getPanoramicWindowVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.thickness,n=t-r,o=e.geometry.parameters.platHeight,a=new(0,i.Vector2)(-t/2-r/2,r/2),s=new(0,i.Vector2)(-t/2-r/2,r/2+o),l=new(0,i.Vector2)(t/2+r/2,r/2+o),c=new(0,i.Vector2)(t/2+r/2,r/2),h=new(0,i.Vector2)(t/2,r/2),d=new(0,i.Vector2)(t/2,o),u=new(0,i.Vector2)(-t/2,o),p=new(0,i.Vector2)(-t/2,r/2),m=new(0,i.Vector2)(-n/2,r/2),f=new(0,i.Vector2)(-n/2,o-r/2),g=new(0,i.Vector2)(n/2,o-r/2),x=new(0,i.Vector2)(n/2,r/2),b=new(0,i.Vector2)(n/2,-r/2),y=new(0,i.Vector2)(-n/2,-r/2),w=[a,s,l,c,h,d,u,p,m,f,g,x,b,y];this.getContinuousLine(w),this.getContinuousLine([a,p]),this.getContinuousLine([h,x]),this.getContinuousLine([m,y])}getFrenchWindowVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,n=new(0,i.Vector2)(-t/2,r/2),o=new(0,i.Vector2)(t/2,r/2),a=new(0,i.Vector2)(t/2,-r/2),s=new(0,i.Vector2)(-t/2,-r/2);this.getContinuousLine([n,o,a,s,n]);let l=new(0,i.Vector2)(-t/2,r/6),c=new(0,i.Vector2)(t/2,r/6);this.getContinuousLine([l,c]);let h=new(0,i.Vector2)(-t/2,0),d=new(0,i.Vector2)(t/2,0);this.getContinuousLine([h,d]);let u=new(0,i.Vector2)(-t/2,-r/6),p=new(0,i.Vector2)(t/2,-r/6);this.getContinuousLine([u,p]);let m=new(0,i.Vector2)(0,r/6),f=new(0,i.Vector2)(0,-r/6);this.getContinuousLine([m,f])}getLashDoorVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,n=new(0,i.Vector2)(-t/2,-r/2),o=new(0,i.Vector2)(-t/2,r/2),a=new(0,i.Vector2)(t/2,r/2),s=new(0,i.Vector2)(t/2,-r/2);this.getContinuousLine([n,o,a,s,n]);let l=new(0,i.Vector2)(-t/2,-r/6),c=new(0,i.Vector2)(-t/2,r/6),h=new(0,i.Vector2)(t/2,r/6),d=new(0,i.Vector2)(t/2,-r/6),u=new(0,i.Vector2)(-t/4,r/6),p=new(0,i.Vector2)(-t/4,-r/6);this.getContinuousLine([l,d]),this.getContinuousLine([c,h]),this.getContinuousLine([u,p])}getPassVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,n=new(0,i.Vector2)(-t/2,r/2),o=new(0,i.Vector2)(t/2,r/2),a=new(0,i.Vector2)(t/2,r/6),s=new(0,i.Vector2)(-t/2,r/6),l=new(0,i.Vector2)(-t/2,-r/6),c=new(0,i.Vector2)(t/2,-r/6),h=new(0,i.Vector2)(t/2,-r/2),d=new(0,i.Vector2)(-t/2,-r/2);this.getContinuousLine([n,o,a,s,n]),this.getContinuousLine([l,c,h,d,l])}getSectorDoorVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,n=new(0,i.Vector2)(-t/2,-r/2),o=new(0,i.Vector2)(-t/2,r/2),a=new(0,i.Vector2)(t/2,r/2),s=new(0,i.Vector2)(t/2,-r/2),l=o.clone().add(a).divideScalar(2),c=o.distanceTo(a)/2,h=o.clone().sub(l).angle(),d=a.clone().sub(l).angle(),u=[s,...(new(0,i.Path)).arc(l.x,l.y,c,d,h,!1).getPoints(),n];this.getContinuousLine(u)}getSectorWindowVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,n=new(0,i.Vector2)(-t/2,-r/2),o=new(0,i.Vector2)(-t/2,r/2),a=new(0,i.Vector2)(t/2,r/2),s=new(0,i.Vector2)(t/2,-r/2),l=n.clone().add(s).divideScalar(2),c=o.clone().add(a).divideScalar(2),h=o.distanceTo(a)/2,d=o.clone().sub(c).angle(),u=a.clone().sub(c).angle(),p=[s,...(new(0,i.Path)).arc(c.x,c.y,h,u,d,!1).getPoints(),n];this.getContinuousLine(p),this.getContinuousLine([a,o]),this.getContinuousLine([c,l])}getArcBaseWindowVertices(e){let t=e.geometry.parameters.center,r=e.geometry.parameters.radius,n=e.geometry.parameters.thickness,o=e.geometry.parameters.startAngle,a=e.geometry.parameters.endAngle,s=r+n/2,l=r-n/2,c=(new(0,i.Path)).arc(t.x,t.y,s,o,a,!1).getPoints(),h=(new(0,i.Path)).arc(t.x,t.y,r,o,a,!1).getPoints(),d=(new(0,i.Path)).arc(t.x,t.y,l,o,a,!1).getPoints();this.getContinuousLine(c),this.getContinuousLine(h),this.getContinuousLine(d),this.getContinuousLine([d[0],c[0]]),this.getContinuousLine([d[d.length-1],c[c.length-1]])}getLWindowVertices(e){let t=e.geometry.parameters.rightDiff,r=e.geometry.parameters.leftDiff,n=e.geometry.parameters.thicknessR,o=e.geometry.parameters.thicknessL,a=e.geometry.parameters.rightAngle,s=e.geometry.parameters.leftAngle,l=e.geometry.parameters.widthR,c=e.geometry.parameters.widthL,h=new(0,i.Vector3),d=new(0,i.Vector3)(-t,n/2,0),u=new(0,i.Vector3)(l+t,n/2,0),p=new(0,i.Vector3)(l+t,0,0),m=new(0,i.Vector3)(l+t,-n/2,0),f=new(0,i.Vector3)(t,-n/2,0);[d,u,p,m,f,h].forEach((e=>{e.applyAxisAngle(new(0,i.Vector3)(0,0,1),a)})),this.getContinuousLine([d,u,m,f]),this.getContinuousLine([p,h]);let g=new(0,i.Vector3)(r,o/2,0),x=new(0,i.Vector3)(c+r,o/2,0),b=new(0,i.Vector3)(c+r,0,0),y=new(0,i.Vector3)(c+r,-o/2,0),w=new(0,i.Vector3)(-r,-o/2,0);[g,x,b,y,w].forEach((e=>{e.applyAxisAngle(new(0,i.Vector3)(0,0,1),s)})),this.getContinuousLine([g,x,y,w]),this.getContinuousLine([b,h])}getUWindowVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.heightL,n=e.geometry.parameters.heightR,o=e.geometry.parameters.thicknessL,a=e.geometry.parameters.thicknessM,s=e.geometry.parameters.thicknessR,l=new(0,i.Vector2)(-t/2,-r-a/2),c=new(0,i.Vector2)(l.x-o,l.y),h=new(0,i.Vector2)(c.x,c.y+r+a),d=new(0,i.Vector2)(h.x+o+t+s,h.y),u=new(0,i.Vector2)(d.x,d.y-a-n),p=new(0,i.Vector2)(u.x-s,u.y),m=new(0,i.Vector2)(p.x,p.y+n),f=new(0,i.Vector2)(m.x-t,m.y);this.getContinuousLine([l,c,h,d,u,p,m,f,l]);let g=new(0,i.Vector2)(l.x-o/2,l.y),x=new(0,i.Vector2)(g.x,0),b=new(0,i.Vector2)(t/2+s/2,x.y),y=new(0,i.Vector2)(b.x,b.y-a/2-n);this.getContinuousLine([g,x,b,y])}getContinuousLine(e){for(let t=0;t<e.length-1;t++)this.vertices.push(e[t].x,e[t].y,0),this.vertices.push(e[t+1].x,e[t+1].y,0)}}})),parcelRequire.register("8C2VU",(function(e,t){$parcel$export(e.exports,"PassGeometry",(()=>r));var i=parcelRequire("lmKU8");class r extends i.RectangularGeometry{constructor(e,t){super(e,t),this.type="PassGeometry",this.parameters={width:e,height:t}}}})),parcelRequire.register("1Wv1c",(function(e,t){$parcel$export(e.exports,"SectorDoorGeometry",(()=>n));var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class n extends i.BufferGeometry{constructor(e,t){super(),this.type="SectorDoorGeometry",this.parameters={width:e,height:t};const n=[],o=[],a=[],s=[];!function(e,t){let r=new(0,i.Shape),l=new(0,i.Vector2)(-e/2,-t/2),c=new(0,i.Vector2)(-e/2,t/2),h=new(0,i.Vector2)(e/2,t/2),d=new(0,i.Vector2)(e/2,-t/2),u=c.clone().add(h).divideScalar(2),p=c.distanceTo(h)/2,m=c.clone().sub(u).angle(),f=h.clone().sub(u).angle(),g=[...(new(0,i.Path)).arc(u.x,u.y,p,f,m,!1).getPoints(),l,d];r.moveTo(d.x,d.y),g.forEach((e=>{r.lineTo(e.x,e.y)}));let x=new(0,i.ShapeGeometry)(r);n.push(...Array.from(x.index.array)),o.push(...Array.from(x.attributes.position.array)),a.push(...Array.from(x.attributes.normal.array)),s.push(...Array.from(x.attributes.uv.array))}(e,t),this.setIndex(n),this.setAttribute("position",new(0,r.Float32BufferAttribute)(o,3)),this.setAttribute("normal",new(0,r.Float32BufferAttribute)(a,3)),this.setAttribute("uv",new(0,r.Float32BufferAttribute)(s,2))}}})),parcelRequire.register("eZ4ri",(function(e,t){$parcel$export(e.exports,"SectorWindowGeometry",(()=>n));var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class n extends i.BufferGeometry{constructor(e,t){super(),this.type="SectorWindowGeometry",this.parameters={width:e,height:t};const n=[],o=[],a=[],s=[];!function(e,t){let r=new(0,i.Shape),l=new(0,i.Vector2)(-e/2,-t/2),c=new(0,i.Vector2)(-e/2,t/2),h=new(0,i.Vector2)(e/2,t/2),d=new(0,i.Vector2)(e/2,-t/2),u=c.clone().add(h).divideScalar(2),p=c.distanceTo(h)/2,m=c.clone().sub(u).angle(),f=h.clone().sub(u).angle(),g=[...(new(0,i.Path)).arc(u.x,u.y,p,f,m,!1).getPoints(),l,d];r.moveTo(d.x,d.y),g.forEach((e=>{r.lineTo(e.x,e.y)}));let x=new(0,i.ShapeGeometry)(r);n.push(...Array.from(x.index.array)),o.push(...Array.from(x.attributes.position.array)),a.push(...Array.from(x.attributes.normal.array)),s.push(...Array.from(x.attributes.uv.array))}(e,t),this.setIndex(n),this.setAttribute("position",new(0,r.Float32BufferAttribute)(o,3)),this.setAttribute("normal",new(0,r.Float32BufferAttribute)(a,3)),this.setAttribute("uv",new(0,r.Float32BufferAttribute)(s,2))}}})),parcelRequire.register("bWffP",(function(e,t){$parcel$export(e.exports,"ArcBaseWindowGeometry",(()=>n));var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class n extends i.BufferGeometry{constructor(e,t,n,o,a){super(),this.type="ArcBaseWindowGeometry",this.parameters={center:e,radius:t,thickness:n,startAngle:o,endAngle:a};const s=[],l=[],c=[],h=[];!function(e,t,r,n,o){let a=t+r/2,d=t-r/2,u=(new(0,i.Path)).arc(e.x,e.y,a,n,o,!1).getPoints(),p=(new(0,i.Path)).arc(e.x,e.y,d,n,o,!1).getPoints(),m=new(0,i.Shape);m.moveTo(p[0].x,p[0].y),p.reverse().forEach((e=>{u.push(e)})),u.forEach((e=>{m.lineTo(e.x,e.y)}));let f=new(0,i.ShapeGeometry)(m);s.push(...Array.from(f.index.array)),l.push(...Array.from(f.attributes.position.array)),c.push(...Array.from(f.attributes.normal.array)),h.push(...Array.from(f.attributes.uv.array))}(e,t,n,o,a),this.setIndex(s),this.setAttribute("position",new(0,r.Float32BufferAttribute)(l,3)),this.setAttribute("normal",new(0,r.Float32BufferAttribute)(c,3)),this.setAttribute("uv",new(0,r.Float32BufferAttribute)(h,2))}}})),parcelRequire.register("lDEcB",(function(e,t){$parcel$export(e.exports,"LWindowGeometry",(()=>n));var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class n extends i.BufferGeometry{constructor(e,t,n,o){super(),this.type="LWindowGeometry",this.parameters={leftWall:e,widthL:n,rightWall:t,widthR:o};const a=this,s=[],l=[],c=[],h=[];!function(e,t,r,n){let o,d,u,p,m,f,g;if(e&&t){let r,n,a=function(e,t){let r=new(0,i.Vector2)(e.startPoint.x,e.startPoint.y),n=new(0,i.Vector2)(e.endPoint.x,e.endPoint.y),o=new(0,i.Vector2)(t.startPoint.x,t.startPoint.y),a=new(0,i.Vector2)(t.endPoint.x,t.endPoint.y);if(r.equals(o)||r.equals(a))return r;if(n.equals(o)||n.equals(a))return n}(e,t);e.startPoint.x==a.x&&e.startPoint.y==a.y?(r=new(0,i.Vector2)(e.endPoint.x,e.endPoint.y),f=r.clone().sub(e.startPoint)):(r=new(0,i.Vector2)(e.startPoint.x,e.startPoint.y),f=r.clone().sub(e.endPoint)),t.startPoint.x==a.x&&t.startPoint.y==a.y?(n=new(0,i.Vector2)(t.endPoint.x,t.endPoint.y),g=n.clone().sub(t.startPoint)):(n=new(0,i.Vector2)(t.startPoint.x,t.startPoint.y),g=n.clone().sub(t.endPoint)),d=f.angle(),u=g.angle();let s=function(e,t,r,n,o){let a=(new(0,i.Vector2)).subVectors(t,e).normalize(),s=(new(0,i.Vector2)).subVectors(r,t).normalize(),l=new(0,i.Vector2)(-s.y,s.x).normalize(),c=o/a.dot(l),h=a.clone().setLength(c),d=new(0,i.Vector2)(-a.y,a.x).normalize(),u=n/s.clone().negate().dot(d),p=s.clone().negate().setLength(u);return h.add(p)}(r,a,n,e.thickness,t.thickness);o=s.angle(),p=e.thickness,m=t.thickness}else p=240,m=240,f=new(0,i.Vector2)(0,-1),g=new(0,i.Vector2)(1,0),d=f.angle(),u=g.angle(),o=(d+u)/2;let x=o>u?o-u:o+2*Math.PI-u,b=o<d?Math.PI-d+o:o-d-Math.PI,y=Math.abs(m/2/Math.tan(x)),w=Math.abs(p/2/Math.tan(b));a.parameters.rightDiff=y,a.parameters.leftDiff=w,a.parameters.thicknessR=m,a.parameters.thicknessL=p,a.parameters.rightAngle=u,a.parameters.leftAngle=d,a.parameters.widthR=n,a.parameters.widthL=r;let v=new(0,i.Vector3)(-y,m/2,0),$=new(0,i.Vector3)(n+y,m/2,0),M=new(0,i.Vector3)(n+y,-m/2,0),S=new(0,i.Vector3)(y,-m/2,0),P=new(0,i.Shape),k=S.clone().applyAxisAngle(new(0,i.Vector3)(0,0,1),u);P.moveTo(k.x,k.y),[v,$,M,S].forEach((e=>{let t=e.clone().applyAxisAngle(new(0,i.Vector3)(0,0,1),u);P.lineTo(t.x,t.y)}));let _=new(0,i.ShapeGeometry)(P);s.push(...Array.from(_.index.array)),l.push(...Array.from(_.attributes.position.array)),c.push(...Array.from(_.attributes.normal.array)),h.push(...Array.from(_.attributes.uv.array));let T=new(0,i.Vector3)(w,p/2,0),C=new(0,i.Vector3)(r+w,p/2,0),A=new(0,i.Vector3)(r+w,-p/2,0),D=new(0,i.Vector3)(-w,-p/2,0),R=new(0,i.Shape),E=D.clone().applyAxisAngle(new(0,i.Vector3)(0,0,1),d);R.moveTo(E.x,E.y),[T,C,A,D].forEach((e=>{let t=e.clone().applyAxisAngle(new(0,i.Vector3)(0,0,1),d);R.lineTo(t.x,t.y)}));let L=new(0,i.ShapeGeometry)(R),I=Array.from(L.index.array);for(let e=0;e<I.length;e++)I[e]+=_.attributes.position.array.length/3;s.push(...I),l.push(...Array.from(L.attributes.position.array)),c.push(...Array.from(L.attributes.normal.array)),h.push(...Array.from(L.attributes.uv.array))}(e,t,n,o),this.setIndex(s),this.setAttribute("position",new(0,r.Float32BufferAttribute)(l,3)),this.setAttribute("normal",new(0,r.Float32BufferAttribute)(c,3)),this.setAttribute("uv",new(0,r.Float32BufferAttribute)(h,2))}}})),parcelRequire.register("kKNer",(function(e,t){$parcel$export(e.exports,"UWindowGeometry",(()=>n));var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class n extends i.BufferGeometry{constructor(e,t,n,o,a,s){super(),this.type="UWindowGeometry",this.parameters={width:e,heightL:t,heightR:n,thicknessL:o,thicknessM:a,thicknessR:s};const l=[],c=[],h=[],d=[];!function(e,t,r,n,o,a){let s=new(0,i.Vector2)(-e/2,-t-o/2),u=new(0,i.Vector2)(s.x-n,s.y),p=new(0,i.Vector2)(u.x,u.y+t+o),m=new(0,i.Vector2)(p.x+n+e+a,p.y),f=new(0,i.Vector2)(m.x,m.y-o-r),g=new(0,i.Vector2)(f.x-a,f.y),x=new(0,i.Vector2)(g.x,g.y+r),b=new(0,i.Vector2)(x.x-e,x.y),y=new(0,i.Shape);y.moveTo(b.x,b.y),[s,u,p,m,f,g,x,b].forEach((e=>{y.lineTo(e.x,e.y)}));let w=new(0,i.ShapeGeometry)(y);l.push(...Array.from(w.index.array)),c.push(...Array.from(w.attributes.position.array)),h.push(...Array.from(w.attributes.normal.array)),d.push(...Array.from(w.attributes.uv.array))}(e,t,n,o,a,s),this.setIndex(l),this.setAttribute("position",new(0,r.Float32BufferAttribute)(c,3)),this.setAttribute("normal",new(0,r.Float32BufferAttribute)(h,3)),this.setAttribute("uv",new(0,r.Float32BufferAttribute)(d,2))}}})),parcelRequire.register("iDVm9",(function(e,t){$parcel$export(e.exports,"BeamMesh",(()=>o));var i=parcelRequire("9vZPJ"),r=parcelRequire("4xklQ"),n=(r=parcelRequire("4xklQ"),parcelRequire("hrM0U"));class o extends i.Base3DMesh{constructor(e={}){super(),this.type="Group",e.position=e.position?new(0,r.Vector2)(n.CommonFunc.keepDecimalRound(e.position.x,3),n.CommonFunc.keepDecimalRound(e.position.y,3)):new(0,r.Vector2),e.center=e.position,e.rotation=e.rotation||0,e.thickness=e.thickness||400,e.depth=e.depth||400,e.wallList=e.wallList||[],e.width=e.width||!1,e.model=e.model||"R",e.material=e.material||new(0,r.MeshBasicMaterial)({color:16777215}),this.parameter=e,this.parameter.leftWall=[],this.parameter.rightWall=[]}create(){this.getLineData();let e={slope:this.parameter.equation.slope,constant:this.parameter.upConstant},t=this.getIntersectPoint(this.parameter.locationUp,this.parameter.rotationVec,e),i=this.getIntersectPoint(this.parameter.position,this.parameter.rotationVec,this.parameter.equation),o={slope:this.parameter.equation.slope,constant:this.parameter.downConstant},a=this.getIntersectPoint(this.parameter.locationDown,this.parameter.rotationVec,o),s=n.CommonFunc.includeUndefined(t),l=n.CommonFunc.includeUndefined(i),c=n.CommonFunc.includeUndefined(a);if(s||l||c||(this.parameter.leftWall=n.CommonFunc.filterObjArray([t[0].wall.wallID,i[0].wall.wallID,a[0].wall.wallID]),this.parameter.rightWall=n.CommonFunc.filterObjArray([t[1].wall.wallID,i[1].wall.wallID,a[1].wall.wallID])),s||l||c||"R"!=this.parameter.model){let e=new(0,r.Vector2)(-this.parameter.width/2,-this.parameter.thickness/2),t=[new(0,r.Vector2)(this.parameter.width/2,-this.parameter.thickness/2),new(0,r.Vector2)(this.parameter.width/2,this.parameter.thickness/2),new(0,r.Vector2)(-this.parameter.width/2,this.parameter.thickness/2),e],i=n.CommonFunc.createShapeByPoints(t,this.parameter.material);i.position.z=10;let o=n.CommonFunc.createLine([...t,t[0]]);this.add(i,o),this.parameter.model="L"}else{let e=[],o=i[0].clone().add(i[1]).multiplyScalar(.5);[t[0],i[0],...a,i[1],t[1]].forEach((t=>{let i=t.clone().sub(o),n=new(0,r.Vector3)(i.x,i.y,0).applyMatrix4((new(0,r.Matrix4)).makeRotationZ(-this.parameter.rotation));e.push(new(0,r.Vector2)(n.x,n.y))}));let s=n.CommonFunc.createShapeByPoints(e,this.parameter.material);s.position.z=10;let l=n.CommonFunc.createLine([...e,e[0]]);this.add(s,l),this.parameter.center=o,this.parameter.width=parseInt(i[0].distanceTo(i[1]))}this.position.set(this.parameter.center.x,this.parameter.center.y,10),this.rotation.z=this.parameter.rotation}getLineData(){let e=this.parameter.rotation%(2*Math.PI);0==e||e==Math.PI?(this.parameter.equation={slope:"Y",constant:this.parameter.position.y},0==e&&(this.parameter.rotationVec=new(0,r.Vector2)(1,0)),e==Math.PI&&(this.parameter.rotationVec=new(0,r.Vector2)(-1,0))):e==Math.PI/2||e==3*Math.PI/2?(this.parameter.equation={slope:"X",constant:this.parameter.position.x},e==Math.PI/2&&(this.parameter.rotationVec=new(0,r.Vector2)(0,1)),e==3*Math.PI/2&&(this.parameter.rotationVec=new(0,r.Vector2)(0,-1))):(this.parameter.equation={slope:Math.round(1e3*Math.tan(this.parameter.rotation))/1e3},this.parameter.equation.constant=this.parameter.position.y-this.parameter.equation.slope*this.parameter.position.x,this.parameter.rotationVec=new(0,r.Vector2)(1,this.parameter.equation.slope));let t=new(0,r.Vector2)(-this.parameter.rotationVec.y,this.parameter.rotationVec.x);this.parameter.locationUp=this.parameter.position.clone().add(t.setLength(this.parameter.thickness/2)),this.parameter.locationDown=this.parameter.position.clone().add(t.clone().negate()),"X"==this.parameter.equation.slope?(this.parameter.upConstant=this.parameter.locationUp.x,this.parameter.downConstant=this.parameter.locationDown.x):"Y"==this.parameter.equation.slope?(this.parameter.upConstant=this.parameter.locationUp.y,this.parameter.downConstant=this.parameter.locationDown.y):(this.parameter.upConstant=this.parameter.locationUp.y-this.parameter.equation.slope*this.parameter.locationUp.x,this.parameter.downConstant=this.parameter.locationDown.y-this.parameter.equation.slope*this.parameter.locationDown.x)}getIntersectPoint(e,t,i){let o,a,s=[],l=[],c=[],h=[];for(let o=0;o<this.parameter.wallList.length;o++){let a,d=this.parameter.wallList[o],u=Array.from(d.geometry.attributes.position.array),p=new(0,r.Vector2)(u[0],u[1]),m=new(0,r.Vector2)(u[6],u[7]),f=new(0,r.Vector2)(u[9],u[10]),g=new(0,r.Vector2)(u[15],u[16]),x=this.getAndCheck(p,f,i),b=this.getAndCheck(m,g,i);if(x&&b?a=e.distanceTo(x)>e.distanceTo(b)?b:x:(x&&(a=x),b&&(a=b)),a){let i=a.clone().sub(e);n.CommonFunc.isSameDirection2(i,t)?(l.push(a),h.push(d)):(s.push(a),c.push(d))}}if(l.length>0){a=l[0],a.wall=h[0];for(let t=1;t<l.length;t++)a.distanceTo(e)>l[t].distanceTo(e)&&(a=l[t],a.wall=h[t])}if(s.length>0){o=s[0],o.wall=c[0];for(let t=1;t<s.length;t++)o.distanceTo(e)>s[t].distanceTo(e)&&(o=s[t],o.wall=c[t])}return[o,a]}getAndCheck(e,t,i){let r=n.CommonFunc.getLineEquation(e,t),o=n.CommonFunc.getIntersectPoint(i,r);if(o){let i=Math.min(e.x,t.x),r=Math.max(e.x,t.x),n=Math.min(e.y,t.y),a=Math.max(e.y,t.y),s=o.x>=i&&o.x<=r,l=o.y>=n&&o.y<=a;return!(!s||!l)&&o}return!1}setModel(e,t=!1){this.parameter.model=e,t&&this.refresh()}refresh(e={}){e.position&&(this.parameter.position=e.position,this.parameter.center=e.position),e.rotation&&(this.parameter.rotation=e.rotation),e.thickness&&(this.parameter.thickness=e.thickness),e.depth&&(this.parameter.rotation=e.rotation),e.wallList&&(this.parameter.wallList=e.wallList),e.width&&(this.parameter.width=e.width),e.model&&(this.parameter.model=e.model),e.material&&(this.parameter.material=e.material),console.log("refresh",this.angle,this.rotation.z,this.angle!=this.rotation.z,this.parameter.rotation),this.angle!=this.rotation.z&&console.log(this.angle,this.rotation.z,this.parameter.rotation),this.children=[],this.create(),console.log("refresh finish",this.rotation.z)}}})),parcelRequire.register("9vZPJ",(function(e,t){$parcel$export(e.exports,"Base3DMesh",(()=>o));var i=parcelRequire("4xklQ");i=parcelRequire("4xklQ");parcelRequire("jPMpS");var r=parcelRequire("cTA6h"),n=parcelRequire("9QhXH");class o extends i.Object3D{constructor(){super(),this.type="Base3DMesh"}createLine(e,t=0){this.add(n.DM.createLine(e,t))}createBox(e){let t=e.width,r=e.height,n=e.depth,o=new(0,i.BoxGeometry)(t,r,n);o.computeBoundingBox();let a=e.material?e.material:new(0,i.MeshStandardMaterial)({color:0}),s=o.attributes.position,l=o.attributes.uv,c=o.attributes.normal,h=new(0,i.Vector3)(0,0,1),d=new(0,i.Vector3)(0,1,0),u=new(0,i.Vector3)(1,0,0);for(let e=0;e<s.count;e++){let o=new(0,i.Vector3)(c.getX(e),c.getY(e),c.getZ(e));(o.equals(u)||o.equals(u.clone().negate()))&&l.setX(e,l.getX(e)*n/r),(o.equals(h)||o.equals(h.clone().negate()))&&l.setX(e,l.getX(e)*t/r),(o.equals(d)||o.equals(d.clone().negate()))&&(l.setY(e,l.getY(e)*n/t*t/r),l.setX(e,l.getX(e)*t/r))}return new(0,i.Mesh)(o,a)}createArchBox(e){let t=e.width,r=e.height+e.width/2,n=e.depth,o=t>r?t:r>n?r:n,a=new i.Shape,s=new i.Vector2(-e.width/2,-e.height/2),l=new i.Vector2(-e.width/2,e.height/2),c=new i.Vector2(e.width/2,-e.height/2),h=new i.Vector2(0,e.height/2);a.moveTo(s.x,s.y),a.lineTo(l.x,l.y),a.absarc(h.x,h.y,e.width/2,Math.PI,0,!0),a.lineTo(c.x,c.y);const d={steps:2,depth:e.depth,bevelEnabled:!0,bevelThickness:0,bevelSize:0,bevelSegments:1};let u=new i.ExtrudeGeometry(a,d);u.translate(0,0,-e.depth/2);let p=u.attributes.uv;for(let e=0;e<p.count;e++)p.setX(e,p.getX(e)/o),p.setY(e,p.getY(e)/o);return new i.Mesh(u,e.material)}createDoorstone(){this.parameter.width,this.parameter.depth,this.parameter.width,this.parameter.depth,this.parameter.width,this.parameter.depth,this.parameter.width,this.parameter.depth;let e=new i.PlaneGeometry(this.parameter.width,this.parameter.depth),t=e.attributes.uv;for(let e=0;e<t.count;e++)t.setY(e,t.getY(e)*this.parameter.depth/this.parameter.width*this.parameter.width/this.parameter.height),t.setX(e,t.getX(e)*this.parameter.width/this.parameter.height);let r=this.parameter.editor.config.marbleTexture;r.wrapS=i.RepeatWrapping,r.wrapT=i.RepeatWrapping;let n=new(0,i.MeshStandardMaterial)({map:r,side:i.DoubleSide}),o=new(0,i.Mesh)(e,n);return o.rotation.x=-Math.PI/2,o.position.y=-this.parameter.height/2+1,o}createBox_Back(e){let t=e.width/1e3,r=e.height/1e3,n=e.depth/1e3,o=new(0,i.BoxGeometry)(t,r,n);o.computeBoundingBox();let a=e.material?e.material:new(0,i.MeshBasicMaterial)({color:0});return new(0,i.Mesh)(o,a)}createSingleWindow(e,t,r,n){let o={width:e/2+r/2,height:t,depth:n,material:this.parameter.windowTexture||this.parameter.frameTexture},a={width:o.width-2*r,height:o.height-2*r,depth:o.depth,material:this.parameter.mirrorTexture},s=new(0,i.Group),l=this.createBox(o),c=this.createBox(a);l=this.boolean(l,c),a.depth/=4;let h=this.createBox(a);return h.name="glass",h.position.add(new(0,i.Vector3)(0,0,-(o.depth-a.depth)/2)),s.add(l,h),s}createTriangle(e){let t=e.width/1e3,r=e.height/1e3,n=e.depth/1e3,o=new(0,i.Vector2)(-t/2,-r/2),a=new(0,i.Vector2)(t/2,-r/2),s=new(0,i.Vector2)(0,r/2),l=new(0,i.Shape);l.moveTo(o.x,o.y),[a,s,o].forEach((e=>{l.lineTo(e.x,e.y)}));let c={steps:2,depth:n,bevelEnabled:!1,bevelThickness:1,bevelSize:1,bevelSegments:1},h=new(0,i.ExtrudeGeometry)(l,c),d=e.mat?e.mat:16711680,u=new(0,i.Mesh)(h,new(0,i.MeshBasicMaterial)({color:d}));return u.rotation.x=Math.PI/2,u.position.add(new(0,i.Vector3)(0,n/2,0)),u}createShapeOrStereoscopic(e,t,r){let n,o=e.shift(),a=new(0,i.Shape);if(a.moveTo(o.x,o.y),e.forEach((function(e){a.lineTo(e.x,e.y)})),a.lineTo(o.x,o.y),1*t!=0){let e={steps:2,depth:t,bevelEnabled:!1,bevelThickness:1,bevelSize:1,bevelSegments:1},o=new(0,i.ExtrudeGeometry)(a,e),s=o.attributes.uv;for(let e=0;e<s.count;e++)s.setX(e,s.getX(e)/t),s.setY(e,s.getY(e)/t);n=new(0,i.Mesh)(o,r)}else{let e=new(0,i.ShapeGeometry)(a);n=new(0,i.Mesh)(e,r)}return n.rotation.x=-Math.PI/2,n}createStyle(e){console.log("Base3DMesh.createStyle")}boolean(e,t,i="subtract"){e.updateMatrix(),t.updateMatrix();let n=r.CSG.fromMesh(e),o=r.CSG.fromMesh(t);var a;if("union"==i)a=n.union(o);else{if(0==n.intersect(o).polygons.length)return!1;"subtract"==i&&(a=n.subtract(o)),"intersect"==i&&(a=n.intersect(o))}return r.CSG.toMesh(a,e.matrix,e.material)}create(){console.log("暂时不支持创建。")}destroy(){this.parent?this.parent.remove(this):console.log("无法删除，没有父级。")}update(){0==this.children.length?console.log("子数组为空，不支持更新。"):(this.children=[],this.create(),this.inheritLayers(this.layers.mask))}setParameter(e,t,i=!1){this.parameter[e]?(this.parameter[e]=t,i&&this.update()):console.log("参数不存在，请检查参数名称。")}setLayers(e,t=this){t.layers.set(e),t.children.forEach((t=>{"Group"==t.type?this.setLayers(e,t):this.setLayer(t,e)}))}setLayer(e,t){e.layers.set(t)}enableLayers(e,t=this){t.layers.enable(e),t.children.forEach((t=>{"Group"==t.type?this.enableLayers(e,t):this.enableLayer(t,e)}))}enableLayer(e,t){e.layers.enable(t)}inheritLayers(e,t=this){t.layers.mask=e,t.children.forEach((t=>{"Group"==t.type?this.inheritLayers(e,t):this.inheritLayer(t,e)}))}inheritLayer(e,t){e.layers.mask=t}setWidth(e,t=!1){this.setParameter("width",e,t)}getWidth(){return this.parameter.width}setHeight(e,t=!1){this.setParameter("height",e,t)}getHeight(){return this.parameter.height}setDepth(e,t=!1){this.setParameter("depth",e,t)}getDepth(){return this.parameter.depth}}})),parcelRequire.register("4xgHd",(function(e,t){$parcel$export(e.exports,"Entry3D",(()=>x));var i=parcelRequire("4xklQ"),r=parcelRequire("evkYu"),n=parcelRequire("5L0a9"),o=parcelRequire("8y3mE"),a=parcelRequire("4cEbr"),s=parcelRequire("eDeYG"),l=parcelRequire("b4XIY"),c=parcelRequire("gKzkd"),h=parcelRequire("7T7Cq"),d=parcelRequire("fxI5g"),u=parcelRequire("eiZ6q"),p=parcelRequire("heK7I"),m=parcelRequire("3tFct"),f=parcelRequire("dFygm"),g=parcelRequire("k63JT");class x{static createBaseDoor(e){let t=new(0,r.BaseDoorMesh)({width:e.width,height:e.height,depth:e.thickness,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.copy(e.position),t.rotation.y=e.rotAngle,t}static createDoubleOpenDoor(e){let t=new(0,n.DoubleOpenDoorMesh)({width:e.width,height:e.height,depth:e.thickness,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.copy(e.position),t.rotation.y=e.rotAngle,t}static createSlidingDoor(e){let t=new(0,o.SlidingDoorMesh)({width:e.width,height:e.height,depth:e.thickness,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.copy(e.position),t.rotation.y=e.rotAngle,t}static createBaseWindow(e){let t=new(0,a.BaseWindowMesh)({width:e.width,height:e.height,depth:e.thickness,heightFromGround:e.position.z-e.height/2,style:e.style,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.copy(e.position),t.rotation.y=e.rotAngle,t}static createFrenchWindow(e){let t=new(0,s.FrenchWindowMesh)({width:e.width,height:e.height,depth:e.thickness,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.copy(e.position),t.rotation.y=e.rotAngle,t}static createLashDoor(e){let t=new(0,l.LashDoorMesh)({width:e.width,height:e.height,depth:e.thickness,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.copy(e.position),t.rotation.y=e.rotAngle,t}static createPass(e){let t=new(0,c.PassMesh)({width:e.width,height:e.height,depth:e.thickness,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.copy(e.position),t.rotation.y=e.rotAngle,t}static createDooropen(e){let t=new(0,g.DooropenMesh)({width:e.width,height:e.height,depth:e.thickness,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.copy(e.position),t.rotation.y=e.rotAngle,t}static createSectorDoor(e){let t=new(0,h.SectorDoorMesh)({width:e.width,height:e.height-e.width/2,depth:e.thickness,editor:e.editor,arcHei:e.arcHei});return t.create(),t.rotation.x=Math.PI/2,t.position.set(e.position.x,e.position.y,e.position.z-e.width/4),t.rotation.y=e.rotAngle,t}static createSectorWindow(e){let t=new(0,d.SectorWindowMesh)({width:e.width,height:e.height-e.width/2,depth:e.thickness,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.set(e.position.x,e.position.y,e.position.z-e.width/4),t.rotation.y=e.rotAngle,t}static createArcWindow(e){let t=e.hole,r=e.wall,n=new i.Vector2(1e3*r.startPoint.x,1e3*r.startPoint.y),o=(new i.Vector2(1e3*r.endPoint.x,1e3*r.endPoint.y),r.arcCenter.distanceTo(n));console.log(t,r,t.startRadian,t.endRadian,o);let a=new(0,u.ArcBaseWindowMesh)({height:t.height,startAngle:t.startRadian,endAngle:t.endRadian,radius:o,thickness:1e3*r.thickness,editor:e.editor});return a.create(),console.log(a),a.position.set(r.arcCenter.x,r.arcCenter.y,t.positionZ-t.height/2),a.rotation.x=Math.PI/2,a}static createLWindow(e){let t=new(0,p.LWindowMesh)(e);return t.create(),t.rotation.x=Math.PI/2,t.position.z=e.position.z-e.height/2,t}static createPanoramicWindow(e){let t=new(0,m.PanoramicWindowMesh)(e);return t.create(),t.rotation.x=Math.PI/2,t.position.set(e.position.x,e.position.y,e.position.z),t.rotation.y=e.rotAngle,t}static createUWindow(e){let t=new(0,f.UWindowMesh)(e);return t.create(),t.rotation.x=Math.PI/2,t.children.forEach((e=>{e.geometry.translate(0,480,0)})),t.position.set(e.position.x,e.position.y,e.position.z-e.height/2),t.rotation.y=e.rotAngle,t}}})),parcelRequire.register("evkYu",(function(e,t){$parcel$export(e.exports,"BaseDoorMesh",(()=>o));var i=parcelRequire("9vZPJ"),r=parcelRequire("4xklQ"),n=(r=parcelRequire("4xklQ"),parcelRequire("hu0fb"));i.Base3DMesh;class o extends i.Base3DMesh{constructor(e={}){if(super(),this.type="BaseDoorMesh",e.width=e.width||900,e.height=e.height||2200,e.depth=e.depth||150,e.doorDep=e.doorDep||50,e.frameBorder=e.frameBorder||38,e.handleEdge=e.handleEdge||50,e.handleBtm=e.handleBtm||1e3,!e.frameTexture){let t=e.editor.config.baseDoorFrame;t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,e.frameTexture=new(0,r.MeshStandardMaterial)({map:t})}if(!e.doorTexture){let t=e.editor.config.baseDoorFace;t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,e.doorTexture=new(0,r.MeshStandardMaterial)({map:t})}this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.frameTexture},t=this.createBox(e),i={width:this.parameter.width-2*this.parameter.frameBorder,height:this.parameter.height-this.parameter.frameBorder,depth:this.parameter.depth,material:new(0,r.MeshBasicMaterial)({color:16711680})},n=this.createBox(i);n.position.add(new(0,r.Vector3)(0,-this.parameter.frameBorder/2,0)),t=this.boolean(t,n);let o={width:this.parameter.width-2*this.parameter.frameBorder,height:this.parameter.height-this.parameter.frameBorder,depth:this.parameter.doorDep,material:this.parameter.doorTexture},a=this.createBox(o);a.position.add(new(0,r.Vector3)(0,-this.parameter.frameBorder/2,0));let s=this.createDoorstone();this.addHandle(),this.add(t,a,s)}addHandle(){const e=new(0,n.GLTFLoader),t=this;e.load(window.url+"/assets/component/outerHandle.glb",(function(e){let i=e.scene.children[0];i.applyMatrix4((new(0,r.Matrix4)).makeScale(-1e3,1e3,1e3)),e.scene.traverse((function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)}));let n=(new r.Box3).setFromObject(i);i.translateX(t.parameter.width/2-n.max.x-t.parameter.frameBorder-t.parameter.handleEdge),i.translateY(n.max.y-t.parameter.height/2+t.parameter.handleBtm),i.translateZ(-(n.max.z+t.parameter.doorDep/2)),t.add(i)})),e.load(window.url+"/assets/component/innerHandle.glb",(function(e){let i=e.scene.children[0];i.applyMatrix4((new(0,r.Matrix4)).makeScale(-1e3,1e3,1e3)),e.scene.traverse((function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)}));let n=(new r.Box3).setFromObject(i);i.translateX(t.parameter.width/2-n.max.x-t.parameter.frameBorder-t.parameter.handleEdge),i.translateY(n.max.y-t.parameter.height/2+t.parameter.handleBtm-59.08065149103135),i.translateZ(n.max.z+t.parameter.doorDep/2),t.add(i)}))}}})),parcelRequire.register("5L0a9",(function(e,t){$parcel$export(e.exports,"DoubleOpenDoorMesh",(()=>o));var i=parcelRequire("4xklQ"),r=(i=parcelRequire("4xklQ"),parcelRequire("9vZPJ")),n=parcelRequire("hu0fb");r.Base3DMesh;class o extends r.Base3DMesh{constructor(e={}){if(super(),this.type="DoubleOpenDoorMesh",e.width=e.width||1500,e.height=e.height||2200,e.depth=e.depth||150,e.frameBorder=e.frameBorder||38,e.doorDep=e.doorDep||50,e.handleEdge=e.handleEdge||50,e.handleBtm=e.handleBtm||1e3,!e.frameTexture){let t=e.editor.config.baseDoorFrame;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.frameTexture=new(0,i.MeshStandardMaterial)({map:t})}if(!e.doorTexture){let t=e.editor.config.baseDoorFace;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.doorTexture=new(0,i.MeshStandardMaterial)({map:t})}this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.frameTexture},t=this.createBox(e),r={width:this.parameter.width-2*this.parameter.frameBorder,height:this.parameter.height-this.parameter.frameBorder,depth:this.parameter.depth},n=this.createBox(r);n.position.add(new(0,i.Vector3)(0,-this.parameter.frameBorder/2,0)),t=this.boolean(t,n),this.add(t);let o={width:this.parameter.width/2-this.parameter.frameBorder,height:this.parameter.height-this.parameter.frameBorder,depth:this.parameter.doorDep,material:this.parameter.doorTexture},a=this.createBox(o);a.position.add(new(0,i.Vector3)(-o.width/2,-this.parameter.frameBorder/2,0));let s=this.createBox(o);s.position.add(new(0,i.Vector3)(o.width/2,-this.parameter.frameBorder/2,0));let l=this.createDoorstone();this.addHandle(o.width/2),this.add(a,s,l)}addHandle(e){const t=new(0,n.GLTFLoader),r=this;t.load(window.url+"/assets/component/outerHandle.glb",(function(e){let t=e.scene.children[0];t.applyMatrix4((new(0,i.Matrix4)).makeScale(-1e3,1e3,1e3)),e.scene.traverse((function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)}));let n=(new i.Box3).setFromObject(t);t.translateX(-n.max.x-r.parameter.handleEdge),t.translateY(n.max.y-r.parameter.height/2+r.parameter.handleBtm),t.translateZ(-(n.max.z+r.parameter.doorDep/2)),r.add(t)})),t.load(window.url+"/assets/component/innerHandle.glb",(function(e){let t=e.scene.children[0];t.applyMatrix4((new(0,i.Matrix4)).makeScale(-1e3,1e3,1e3)),e.scene.traverse((function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)}));let n=(new i.Box3).setFromObject(t);t.translateX(-n.max.x-r.parameter.handleEdge),t.translateY(n.max.y-r.parameter.height/2+r.parameter.handleBtm-59.08065149103135),t.translateZ(n.max.z+r.parameter.doorDep/2),r.add(t)})),t.load(window.url+"/assets/component/outerHandle.glb",(function(e){let t=e.scene.children[0];t.applyMatrix4((new(0,i.Matrix4)).makeScale(1e3,1e3,1e3)),e.scene.traverse((function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)}));let n=(new i.Box3).setFromObject(t);t.translateX(n.max.x+r.parameter.handleEdge),t.translateY(n.max.y-r.parameter.height/2+r.parameter.handleBtm),t.translateZ(-(n.max.z+r.parameter.doorDep/2)),r.add(t)})),t.load(window.url+"/assets/component/innerHandle.glb",(function(e){let t=e.scene.children[0];t.applyMatrix4((new(0,i.Matrix4)).makeScale(1e3,1e3,1e3)),e.scene.traverse((function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)}));let n=(new i.Box3).setFromObject(t);t.translateX(n.max.x+r.parameter.handleEdge),t.translateY(n.max.y-r.parameter.height/2+r.parameter.handleBtm-59.08065149103135),t.translateZ(n.max.z+r.parameter.doorDep/2),r.add(t)}))}}})),parcelRequire.register("8y3mE",(function(e,t){$parcel$export(e.exports,"SlidingDoorMesh",(()=>n));var i=parcelRequire("9vZPJ"),r=parcelRequire("4xklQ");r=parcelRequire("4xklQ");class n extends i.Base3DMesh{constructor(e={}){var t;if(super(),this.type="SlidingDoorMesh",e.width=e.width||1660,e.height=e.height||2200,e.depth=e.depth||100,e.doorDepth=e.doorDepth||35,e.frameBorder=e.frameBorder||30,e.doorNum=e.doorNum||((t=e.width)<=2e3?2:t<2500?3:4),e.doorCoincide=e.doorCoincide||18,e.doorBorder=e.doorBorder||150,e.doorGap=e.doorGap||2,!e.frameTexture){let t=e.editor.config.slidingDoorframe;t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,e.frameTexture=new(0,r.MeshStandardMaterial)({map:t})}if(!e.doorTexture){let t=e.editor.config.slidingDoorFace;t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,e.doorTexture=new(0,r.MeshStandardMaterial)({map:t})}this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.frameTexture},t=this.createBox(e),i=this.parameter.width-2*this.parameter.frameBorder,n=this.parameter.height-this.parameter.frameBorder,o={width:i,height:n,depth:this.parameter.depth},a=this.createBox(o);a.position.add(new(0,r.Vector3)(0,-this.parameter.frameBorder/2,0));let s=this.boolean(t,a),l={width:i/this.parameter.doorNum+this.parameter.doorCoincide,height:n,depth:this.parameter.doorDepth,material:this.parameter.doorTexture},c={width:l.width-2*this.parameter.doorBorder,height:l.height-2*this.parameter.doorBorder,depth:l.depth,material:new r.MeshStandardMaterial({color:new r.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new r.Vector2(1,-1),side:2,transparent:!0,opacity:.1,roughness:.1})};if(2===this.parameter.doorNum){let e=this.createDoor(l,c),t=e.clone();e.position.add(new(0,r.Vector3)(-(i-l.width)/2,0,-(l.depth+this.parameter.doorGap)/2)),t.position.add(new(0,r.Vector3)((i-l.width)/2,0,(l.depth+this.parameter.doorGap)/2)),this.add(e,t)}if(3===this.parameter.doorNum){let e=this.createDoor(l,c),t=e.clone(),n=e.clone();e.position.add(new(0,r.Vector3)(-(i-l.width)/2,0,(l.depth+this.parameter.doorGap)/2)),t.position.add(new(0,r.Vector3)(0,0,-(l.depth+this.parameter.doorGap)/2)),n.position.add(new(0,r.Vector3)((i-l.width)/2,0,(l.depth+this.parameter.doorGap)/2)),this.add(e,t,n)}if(4===this.parameter.doorNum){let e=this.createDoor(l,c),t=e.clone(),n=e.clone(),o=e.clone();e.position.add(new(0,r.Vector3)(-(i-l.width)/2,0,-(l.depth+this.parameter.doorGap)/2)),t.position.add(new(0,r.Vector3)(-l.width/2,0,(l.depth+this.parameter.doorGap)/2)),n.position.add(new(0,r.Vector3)(l.width/2,0,(l.depth+this.parameter.doorGap)/2)),o.position.add(new(0,r.Vector3)((i-l.width)/2,0,-(l.depth+this.parameter.doorGap)/2)),this.add(e,t,n,o)}let h=this.createDoorstone();this.add(s,h)}createDoor(e,t){let i=new(0,r.Group),n=this.createBox(e),o=this.createBox(t);n=this.boolean(n,o),t.depth/=3;let a=this.createBox(t);return i.add(n,a),i}setFrameBorder(e,t=!1){this.setParameter("frameBorder",e,t)}getFrameBorder(){return this.parameter.frameBorder}setDoorDepth(e,t=!1){this.setParameter("doorDepth",e,t)}getDoorDepth(){return this.parameter.doorDepth}setDoorNum(e,t=!1){this.setParameter("doorNum",e,t)}getDoorNum(){return this.parameter.doorNum}setDoorCoincide(e,t=!1){this.setParameter("doorCoincide",e,t)}getDoorCoincide(){return this.parameter.doorCoincide}setFrameTexture(e,t=!1){this.setParameter("frameTexture",e,t)}getFrameTexture(){return this.parameter.frameTexture}setDoorTexture(e,t=!1){this.setParameter("doorTexture",e,t)}getDoorTexture(){return this.parameter.doorTexture}setDoorBorder(e,t=!1){this.setParameter("doorBorder",e,t)}getDoorBorder(){return this.parameter.doorBorder}setDoorGap(e,t=!1){this.setParameter("doorGap",e,t)}getDoorGap(){return this.parameter.doorGap}}})),parcelRequire.register("4cEbr",(function(e,t){$parcel$export(e.exports,"BaseWindowMesh",(()=>n));var i=parcelRequire("9vZPJ"),r=parcelRequire("4xklQ");r=parcelRequire("4xklQ");class n extends i.Base3DMesh{constructor(e={}){if(super(),this.type="BaseWindowMesh",e.style=e.style||1,e.width=e.width||1600,e.height=e.height||1200,e.depth=e.depth||100,e.frameBorder=e.frameBorder||50,e.windowDepth=e.windowDepth||40,e.windowBorder=e.windowBorder||50,e.windowCoincide=e.windowCoincide||50,e.heightFromGround=e.heightFromGround||500,2==e.style&&(e.height=e.height||1500,e.top=e.top||"double",e.bottom=e.bottom||"double",e.rungPosition=e.rungPosition||"top|"+(e.height-3*e.frameBorder)/4,e.rungHeight=e.rungHeight||50),!e.frameTexture){let t=e.editor.config.baseWindowFrame;t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,e.frameTexture=new(0,r.MeshStandardMaterial)({map:t})}if(!e.windowTexture){let t=e.editor.config.baseWindowFace;t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,e.windowTexture=new(0,r.MeshStandardMaterial)({map:t})}e.mirrorTexture=new r.MeshStandardMaterial({color:new r.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new r.Vector2(1,-1),side:2,transparent:!0,opacity:.1,roughness:.1}),this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.frameTexture},t=this.createBox(e);1==this.parameter.style&&this.createStyle1(t),2==this.parameter.style&&this.createStyle2(t)}createStyle1(e){let t=this.parameter.width-2*this.parameter.frameBorder,i=this.parameter.height-2*this.parameter.frameBorder,n={width:t,height:i,depth:this.parameter.depth},o=this.createBox(n),a=this.boolean(e,o),s=this.createSingleWindow(t,i,this.parameter.windowBorder,this.parameter.windowDepth),l=t/2+this.parameter.windowBorder/2,c=s.clone();s.position.add(new(0,r.Vector3)((this.parameter.windowBorder-l)/2,0,this.parameter.windowDepth/2)),c.position.add(new(0,r.Vector3)(-(this.parameter.windowBorder-l)/2,0,-this.parameter.windowDepth/2)),this.add(a,s,c)}createStyle2(e){let t=this.parameter.width-2*this.parameter.frameBorder,i=this.parameter.height-2*this.parameter.frameBorder,n=this.parameter.rungPosition.split("|"),o=parseFloat(n[1]);if(o>i-this.parameter.rungHeight)return void console.log("数据不合法，请检查参数。");console.log(n);let a=this.getFinalFrame(e,n[0],o,t,i);this.add(a);let s,l={width:t,depth:this.parameter.windowDepth/4,material:new(0,r.MeshBasicMaterial)({color:16711680,transparent:!0,opacity:.5})},c=t/2+this.parameter.windowBorder/2;if("single"==this.parameter.top){"top"==n[0]&&(l.height=o),"bottom"==n[0]&&(l.height=i-o-this.parameter.rungHeight);let e=this.createBox(l);e.position.add(new(0,r.Vector3)(0,(i-l.height)/2,0)),this.add(e)}else if("double"==this.parameter.top){"top"==n[0]&&(s=o),"bottom"==n[0]&&(s=i-o-this.parameter.rungHeight);let e=this.createSingleWindow(t,s,this.parameter.windowBorder,this.parameter.windowDepth);e.position.add(new(0,r.Vector3)((this.parameter.windowBorder-c)/2,(i-s)/2,this.parameter.windowDepth/2));let a=this.createSingleWindow(t,s,this.parameter.windowBorder,this.parameter.windowDepth);a.position.add(new(0,r.Vector3)(-(this.parameter.windowBorder-c)/2,(i-s)/2,-this.parameter.windowDepth/2)),this.add(e,a)}if("single"==this.parameter.bottom){"top"==n[0]&&(l.height=i-o-this.parameter.rungHeight),"bottom"==n[0]&&(l.height=o);let e=this.createBox(l);e.position.add(new(0,r.Vector3)(0,-(i-l.height)/2,0)),this.add(e)}else if("double"==this.parameter.bottom){"top"==n[0]&&(s=i-o-this.parameter.rungHeight),"bottom"==n[0]&&(s=o);let e=this.createSingleWindow(t,s,this.parameter.windowBorder,this.parameter.windowDepth);e.position.add(new(0,r.Vector3)((this.parameter.windowBorder-c)/2,-(i-s)/2,this.parameter.windowDepth/2));let a=this.createSingleWindow(t,s,this.parameter.windowBorder,this.parameter.windowDepth);a.position.add(new(0,r.Vector3)(-(this.parameter.windowBorder-c)/2,-(i-s)/2,-this.parameter.windowDepth/2)),this.add(e,a)}}getFinalFrame(e,t,i,n,o){let a,s;if("top"==t){let e={width:n,height:i,depth:this.parameter.depth,material:new(0,r.MeshBasicMaterial)({color:65280})};a=this.createBox(e),a.position.add(new(0,r.Vector3)(0,(o-i)/2,0));let t={width:n,height:o-i-this.parameter.rungHeight,depth:this.parameter.depth,material:new(0,r.MeshBasicMaterial)({color:16711680})};s=this.createBox(t),s.position.add(new(0,r.Vector3)(0,(t.height-o)/2,0))}if("bottom"==t){let e={width:n,height:i,depth:this.parameter.depth,material:new(0,r.MeshBasicMaterial)({color:16711680})};s=this.createBox(e),s.position.add(new(0,r.Vector3)(0,-(o-i)/2,0));let t={width:n,height:o-i-this.parameter.rungHeight,depth:this.parameter.depth,material:new(0,r.MeshBasicMaterial)({color:65280})};a=this.createBox(t),a.position.add(new(0,r.Vector3)(0,(o-t.height)/2,0))}let l=this.boolean(a,s,"union");return e=this.boolean(e,l)}setFrameBorder(e,t=!1){this.setParameter("frameBorder",e,t)}getFrameBorder(){return this.parameter.frameBorder}setWindowDepth(e,t=!1){this.setParameter("windowDepth",e,t)}getWindowDepth(){return this.parameter.windowDepth}setWindowBorder(e,t=!1){this.setParameter("windowBorder",e,t)}getWindowBorder(){return this.parameter.windowBorder}setWindowCoincide(e,t=!1){this.setParameter("windowCoincide",e,t)}getWindowCoincide(){return this.parameter.windowCoincide}setFrameTexture(e,t=!1){this.setParameter("frameTexture",e,t)}getFrameTexture(){return this.parameter.frameTexture}}})),parcelRequire.register("eDeYG",(function(e,t){$parcel$export(e.exports,"FrenchWindowMesh",(()=>n));var i=parcelRequire("9vZPJ"),r=parcelRequire("4xklQ");r=parcelRequire("4xklQ");class n extends i.Base3DMesh{constructor(e={}){super(),this.type="FrenchWindowMesh",e.style=e.style||1,e.width=e.width||2e3,e.height=e.height||1800,e.depth=e.depth||80,e.frameBorder=e.frameBorder||50,e.middleRatio=e.middleRatio||750/1800,e.gap=e.gap||15,e.bulge=e.bulge||5;let t=e.editor.config.baseWindowFrame;t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,e.frameTexture=new(0,r.MeshStandardMaterial)({map:t});let i=e.editor.config.baseWindowFace;i.wrapS=r.RepeatWrapping,i.wrapT=r.RepeatWrapping,e.windowTexture=new(0,r.MeshStandardMaterial)({map:i}),e.mirrorTexture=new r.MeshStandardMaterial({color:new r.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new r.Vector2(1,-1),side:2,transparent:!0,opacity:.1,roughness:.1}),this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.frameTexture},t=this.createBox(e);1==this.parameter.style&&this.createStyle1(t),2==this.parameter.style&&this.createStyle2(t)}createStyle1(e){let t=this.parameter.width-4*this.parameter.frameBorder,i=this.parameter.height-3*this.parameter.frameBorder,n=this.getStyle1Hole(t,i),o=this.boolean(e,n);this.add(o);let a={width:t*this.parameter.middleRatio,height:.75*i,depth:this.parameter.depth/8,material:this.parameter.mirrorTexture},s=this.createBox(a);s.name="glass",s.position.add(new(0,r.Vector3)(0,(i-a.height)/2,0));let l={width:(t+this.parameter.frameBorder)/2,height:.25*i,depth:this.parameter.depth/8,material:this.parameter.mirrorTexture},c=this.createBox(l);c.name="glass",c.position.add(new(0,r.Vector3)(-(t+2*this.parameter.frameBorder-l.width)/2,(l.height-(i+this.parameter.frameBorder))/2,0));let h=this.createBox(l);h.name="glass",h.position.add(new(0,r.Vector3)((t+2*this.parameter.frameBorder-l.width)/2,(l.height-(i+this.parameter.frameBorder))/2,0)),this.add(s,c,h);let d=this.createTuWindow(t,i);d.position.add(new(0,r.Vector3)(-((t-t*(1-this.parameter.middleRatio)/2-this.parameter.gap)/2+this.parameter.frameBorder),.25*i/2,this.parameter.depth/4+this.parameter.bulge));let u=this.createTuWindow(t,i);u.position.add(new(0,r.Vector3)((t-t*(1-this.parameter.middleRatio)/2-this.parameter.gap)/2+this.parameter.frameBorder,.25*i/2,this.parameter.depth/4+this.parameter.bulge)),this.add(d,u)}createTuWindow(e,t){let i=new(0,r.Group),n={width:e*(1-this.parameter.middleRatio)/2+this.parameter.gap,height:.75*t+2*this.parameter.gap,depth:this.parameter.depth/2,material:this.parameter.windowTexture},o=this.createBox(n),a={width:n.width,height:this.parameter.gap,depth:n.depth-this.parameter.bulge,material:new(0,r.MeshBasicMaterial)({color:16711680})},s={width:this.parameter.gap/2,height:n.height,depth:n.depth-this.parameter.bulge,material:new(0,r.MeshBasicMaterial)({color:16711680})},l=this.createBox(a);l.position.add(new(0,r.Vector3)(0,(n.height-a.height)/2,-this.parameter.bulge/1));let c=this.createBox(a);c.position.add(new(0,r.Vector3)(0,(a.height-n.height)/2,-this.parameter.bulge/1));let h=this.createBox(s);h.position.add(new(0,r.Vector3)(-(s.width-n.width)/2,0,-this.parameter.bulge/1));let d=this.createBox(s);d.position.add(new(0,r.Vector3)((s.width-n.width)/2,0,-this.parameter.bulge/1));let u={width:n.width-2*this.parameter.frameBorder,height:n.height-2*this.parameter.frameBorder,depth:n.depth,material:this.parameter.mirrorTexture},p=this.createBox(u);[l,c,h,d].forEach((e=>{p=this.boolean(p,e,"union")})),o=this.boolean(o,p);let m=this.createBox(u);return m.name="glass",i.add(o,m),i}getStyle1Hole(e,t){let i={width:e*(1-this.parameter.middleRatio)/2,height:.75*t,depth:this.parameter.depth},n={width:e*this.parameter.middleRatio,height:.75*t,depth:this.parameter.depth},o={width:(e+this.parameter.frameBorder)/2,height:.25*t,depth:this.parameter.depth},a=this.createBox(i);a.position.add(new(0,r.Vector3)(-((e-i.width)/2+this.parameter.frameBorder)/1,(t-i.height)/2,0));let s=this.createBox(i);s.position.add(new(0,r.Vector3)(((e-i.width)/2+this.parameter.frameBorder)/1,(t-i.height)/2,0));let l=this.createBox(n);l.position.add(new(0,r.Vector3)(0,(t-n.height)/2,0));let c=this.createBox(o);c.position.add(new(0,r.Vector3)(-(e+2*this.parameter.frameBorder-o.width)/2,(o.height-(t+this.parameter.frameBorder))/2,0));let h=this.createBox(o);h.position.add(new(0,r.Vector3)((e+2*this.parameter.frameBorder-o.width)/2,(o.height-(t+this.parameter.frameBorder))/2,0));let d=a;return[s,l,c,h].forEach((e=>{d=this.boolean(d,e,"union")})),d}createStyle2(e){}}})),parcelRequire.register("b4XIY",(function(e,t){$parcel$export(e.exports,"LashDoorMesh",(()=>o));var i=parcelRequire("4xklQ"),r=(i=parcelRequire("4xklQ"),parcelRequire("9vZPJ")),n=parcelRequire("hu0fb");class o extends r.Base3DMesh{constructor(e={}){if(super(),this.type="LashDoorMesh",e.style=e.style||1,e.width=e.width||1100,e.height=e.height||2200,e.depth=e.depth||240,e.frameBorder=e.frameBorder||10,e.coincide=e.coincide||3,e.doorDep=e.doorDep||50,e.handleEdge=e.handleEdge||50,e.handleBtm=e.handleBtm||1e3,!e.frameTexture){let t=e.editor.config.baseDoorFrame;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.frameTexture=new(0,i.MeshStandardMaterial)({map:t})}if(!e.doorTexture){let t=e.editor.config.baseDoorFace;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.doorTexture=new(0,i.MeshStandardMaterial)({map:t})}if(!e.partitionTexture){let t=e.editor.config.lashDoorPartition;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.partitionTexture=new(0,i.MeshStandardMaterial)({map:t})}this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.frameTexture},t=this.createBox(e);1==this.parameter.style&&this.createStyle1(t),2==this.parameter.style&&this.createStyle2(t);let i=this.createDoorstone();this.add(i)}createStyle1(e){let t=this.parameter.width-2*this.parameter.frameBorder,r=this.parameter.height-this.parameter.frameBorder,n={width:t,height:r,depth:this.parameter.depth},o=this.createBox(n);o.position.set(0,-this.parameter.frameBorder/2,0);let a=this.boolean(e,o);this.add(a);let s={width:.33*t-this.parameter.coincide/2,height:r,depth:this.parameter.doorDep,material:this.parameter.doorTexture},l=this.createBox(s);l.position.add(new(0,i.Vector3)((t-s.width+this.parameter.coincide/2)/2,-this.parameter.frameBorder/2,0)),console.log("partition - ",this.parameter.coincide);let c={width:this.parameter.coincide,height:r,depth:this.parameter.doorDep,material:this.parameter.partitionTexture},h=this.createBox(c);h.translateX(.17*t),h.translateY(-this.parameter.frameBorder/2),this.add(h);let d={width:.67*t-this.parameter.coincide/2,height:r,depth:this.parameter.doorDep,material:this.parameter.doorTexture},u=this.createBox(d);return u.position.add(new(0,i.Vector3)(-(t-d.width+this.parameter.coincide/2)/2,-this.parameter.frameBorder/2,0)),this.add(l,u),this.addHandle(),this}createStyle2(e){}addHandle(){const e=new(0,n.GLTFLoader),t=this;e.load(window.url+"/assets/component/outerHandle.glb",(function(e){let r=e.scene.children[0];r.applyMatrix4((new(0,i.Matrix4)).makeScale(-1e3,1e3,1e3)),e.scene.traverse((function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)}));let n=(new i.Box3).setFromObject(r);r.translateX(.17*t.parameter.width-n.max.x-t.parameter.handleEdge),r.translateY(n.max.y-t.parameter.height/2+t.parameter.handleBtm),r.translateZ(-(n.max.z+t.parameter.doorDep/2)),t.add(r)})),e.load(window.url+"/assets/component/innerHandle.glb",(function(e){let r=e.scene.children[0];r.applyMatrix4((new(0,i.Matrix4)).makeScale(-1e3,1e3,1e3)),e.scene.traverse((function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)}));let n=(new i.Box3).setFromObject(r);r.translateX(.17*t.parameter.width-n.max.x-t.parameter.handleEdge),r.translateY(n.max.y-t.parameter.height/2+t.parameter.handleBtm-59.08065149103135),r.translateZ(n.max.z+t.parameter.doorDep/2),t.add(r)}))}}})),parcelRequire.register("gKzkd",(function(e,t){$parcel$export(e.exports,"PassMesh",(()=>n));var i=parcelRequire("9vZPJ"),r=parcelRequire("4xklQ");r=parcelRequire("4xklQ");class n extends i.Base3DMesh{constructor(e={}){if(super(),this.type="PassDoorMesh",e.width=e.width||900,e.height=e.height||2250,e.depth=e.depth||100,e.frameBorder=e.frameBorder||50,!e.frameTexture){let t=e.editor.config.passMeshTexture;t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,e.frameTexture=new(0,r.MeshStandardMaterial)({map:t})}this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.frameTexture},t=this.createBox(e),i={width:this.parameter.width-2*this.parameter.frameBorder,height:this.parameter.height-this.parameter.frameBorder,depth:this.parameter.depth},r=this.createBox(i);r.position.set(0,-this.parameter.frameBorder,0);let n=this.boolean(t,r),o=this.createDoorstone();this.add(n,o)}}})),parcelRequire.register("7T7Cq",(function(e,t){$parcel$export(e.exports,"SectorDoorMesh",(()=>o));var i=parcelRequire("4xklQ"),r=(i=parcelRequire("4xklQ"),parcelRequire("9vZPJ")),n=parcelRequire("hu0fb");class o extends r.Base3DMesh{constructor(e={}){if(super(),this.type="SectorDoorMesh",e.width=e.width||860,e.height=e.height||2e3,e.depth=e.depth||65,e.frameBorder=e.frameBorder||38,e.doorDep=e.doorDep||50,e.handleEdge=e.handleEdge||50,e.handleBtm=e.handleBtm||1e3,!e.frameTexture){let t=e.editor.config.baseDoorFrame;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.frameTexture=new(0,i.MeshStandardMaterial)({map:t})}if(!e.texture){let t=e.editor.config.sectorDoorTexture;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.texture=new(0,i.MeshStandardMaterial)({map:t})}this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.frameTexture},t=this.createArchBox(e),i={width:this.parameter.width-2*this.parameter.frameBorder,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.texture},r=this.createArchBox(i);t=this.boolean(t,r),i.depth=this.parameter.doorDep;let n=this.createArchBox(i),o=this.createDoorstone();this.add(t,n,o),this.addHandle()}addHandle(){const e=new(0,n.GLTFLoader),t=this;e.load(window.url+"/assets/component/outerHandle.glb",(function(e){let r=e.scene.children[0];r.applyMatrix4((new(0,i.Matrix4)).makeScale(-1e3,1e3,1e3)),e.scene.traverse((function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)}));let n=(new i.Box3).setFromObject(r);r.translateX(t.parameter.width/2-n.max.x-t.parameter.frameBorder-t.parameter.handleEdge),r.translateY(n.max.y-t.parameter.height/2+t.parameter.handleBtm),r.translateZ(-(n.max.z+t.parameter.doorDep/2)),t.add(r)})),e.load(window.url+"/assets/component/innerHandle.glb",(function(e){let r=e.scene.children[0];r.applyMatrix4((new(0,i.Matrix4)).makeScale(-1e3,1e3,1e3)),e.scene.traverse((function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)}));let n=(new i.Box3).setFromObject(r);r.translateX(t.parameter.width/2-n.max.x-t.parameter.frameBorder-t.parameter.handleEdge),r.translateY(n.max.y-t.parameter.height/2+t.parameter.handleBtm-59.08065149103135),r.translateZ(n.max.z+t.parameter.doorDep/2),t.add(r)}))}}})),parcelRequire.register("fxI5g",(function(e,t){$parcel$export(e.exports,"SectorWindowMesh",(()=>n));var i=parcelRequire("4xklQ"),r=(i=parcelRequire("4xklQ"),parcelRequire("9vZPJ"));class n extends r.Base3DMesh{constructor(e={}){if(super(),this.type="SectorWindowMesh",e.style=e.style||1,e.width=e.width||1600,e.height=e.height||1600,e.depth=e.depth||100,e.frameBorder=e.frameBorder||50,!e.texture){let t=e.editor.config.baseWindowFrame;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.texture=new(0,i.MeshStandardMaterial)({map:t})}if(!e.windowTexture){let t=e.editor.config.baseWindowFace;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.windowTexture=new(0,i.MeshStandardMaterial)({map:t})}e.mirrorTexture=new(0,i.MeshStandardMaterial)({color:new i.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new i.Vector2(1,-1),side:2,transparent:!0,opacity:.1,roughness:.1}),this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.texture},t=this.createBox(e),r={width:this.parameter.width-2*this.parameter.frameBorder,height:this.parameter.height-2*this.parameter.frameBorder,depth:this.parameter.depth,material:new(0,i.MeshBasicMaterial)({color:16711680})},n=this.createBox(r),o=this.boolean(t,n);this.add(o);let a=new(0,i.CylinderGeometry)(this.parameter.width/2,this.parameter.width/2,this.parameter.depth/1,32),s=new(0,i.Mesh)(a,this.parameter.texture);s.position.y=this.parameter.height/2/1,s.rotation.x=Math.PI/2,s=this.boolean(s,t);let l=(this.parameter.width-2*this.parameter.frameBorder)/2,c=new(0,i.CylinderGeometry)(l,l,this.parameter.depth/1,32),h=new(0,i.Mesh)(c,new(0,i.MeshBasicMaterial)({color:16711680}));h.position.y=this.parameter.height/2/1,h.rotation.x=Math.PI/2,h=this.boolean(h,t),s=this.boolean(s,h),this.add(s);let d=new(0,i.CylinderGeometry)(l,l,this.parameter.depth/10,32),u=new(0,i.Mesh)(d,this.parameter.mirrorTexture);u.position.y=this.parameter.height/2/1,u.rotation.x=Math.PI/2,u=this.boolean(u,t),u.name="glass",this.add(u),1==this.parameter.style&&this.createStyle1(),2==this.parameter.style&&this.createStyle2()}createStyle1(){let e=this.parameter.width-2*this.parameter.frameBorder,t=this.parameter.height-2*this.parameter.frameBorder,r=this.createSingleWindow(e,t,this.parameter.frameBorder,40);r.position.add(new(0,i.Vector3)((-e/2+this.parameter.frameBorder/2)/2,0,20));let n=this.createSingleWindow(e,t,this.parameter.frameBorder,40);n.position.add(new(0,i.Vector3)((e/2-this.parameter.frameBorder/2)/2,0,-20)),this.add(r,n)}createStyle2(){let e={width:this.parameter.width-2*this.parameter.frameBorder,height:this.parameter.height-2*this.parameter.frameBorder,depth:this.parameter.depth/10,material:this.parameter.mirrorTexture},t=this.createBox(e);this.add(t)}}})),parcelRequire.register("eiZ6q",(function(e,t){$parcel$export(e.exports,"ArcBaseWindowMesh",(()=>n));var i=parcelRequire("4xklQ"),r=(i=parcelRequire("4xklQ"),parcelRequire("9vZPJ"));class n extends r.Base3DMesh{constructor(e={}){if(super(),this.type="ArcBaseWindowMesh",e.height=e.height||1600,e.startAngle=e.startAngle||Math.PI/4,e.endAngle=e.endAngle||.75*Math.PI,e.radius=e.radius||2e3,e.thickness=e.thickness||120,e.frameBorder=e.frameBorder||50,!e.texture){let t=e.editor.config.baseWindowFrame;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.texture=new(0,i.MeshStandardMaterial)({map:t})}this.mirrorTexture=new i.MeshStandardMaterial({color:new i.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new i.Vector2(1,-1),side:2,transparent:!0,opacity:.1,roughness:.1}),this.parameter=e}create(){console.log(this.parameter.radius,this.parameter.thickness);let e=this.parameter.radius+this.parameter.thickness/2,t=this.parameter.radius-this.parameter.thickness/2,r=Math.round(Math.PI/Math.asin(this.parameter.thickness/(e+this.parameter.thickness))/2);r=r>100?100:r;let n=this.getArcPath(e,this.parameter.startAngle,this.parameter.endAngle,r,!0),o=this.getArcPath(t,this.parameter.startAngle,this.parameter.endAngle,r,!0),a=n.concat(o.reverse()),s=this.createShapeOrStereoscopic(a,this.parameter.height,this.parameter.texture),l=this.parameter.frameBorder/t,c=this.parameter.startAngle+l,h=this.parameter.endAngle-l,d=this.parameter.height-2*this.parameter.frameBorder,u=this.getArcPath(e+1,c,h,r,!0),p=this.getArcPath(t-1,c,h,r,!0),m=u.concat(p.reverse()),f=this.createShapeOrStereoscopic(m,d,new(0,i.MeshBasicMaterial)({color:16711680}));f.position.y=this.parameter.frameBorder;let g=this.boolean(s,f);this.add(g);let x=this.parameter.radius+this.parameter.thickness/4,b=this.parameter.radius-this.parameter.thickness/4,y=this.getArcPath(x,c,h,r,!0),w=this.getArcPath(b,c,h,r,!0),v=y.concat(w.reverse()),$=this.createShapeOrStereoscopic(v,d,this.mirrorTexture);$.position.y=this.parameter.frameBorder,$.name="glass",this.add($)}getArcPath(e,t,r,n,o=!1){let a=new(0,i.Path);return a.arc(0,0,e,t,r,!1),o?a.getPoints(n):a}}})),parcelRequire.register("heK7I",(function(e,t){$parcel$export(e.exports,"LWindowMesh",(()=>n));var i=parcelRequire("4xklQ"),r=(i=parcelRequire("4xklQ"),parcelRequire("9vZPJ"));class n extends r.Base3DMesh{constructor(e={}){if(super(),this.type="LWindowMesh",e.style=e.style||1,e.leftPoint=e.leftPoint||new(0,i.Vector2)(0,-1320),e.commonPoint=e.commonPoint||new(0,i.Vector2),e.rightPoint=e.rightPoint||new(0,i.Vector2)(1320,0),e.height=e.height||1600,e.leftDepth=e.leftDepth||120,e.rightDepth=e.rightDepth||120,e.frameBorder=e.frameBorder||50,!e.texture){let t=e.editor.config.baseWindowFrame;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.texture=new(0,i.MeshStandardMaterial)({map:t})}this.mirrorTexture=new(0,i.MeshStandardMaterial)({color:new i.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new i.Vector2(1,-1),side:2,transparent:!0,opacity:.1,roughness:.1}),function(e){let t=function(e,t,r,n,o){let a=(new(0,i.Vector2)).subVectors(t,e).normalize(),s=(new(0,i.Vector2)).subVectors(r,t).normalize(),l=new(0,i.Vector2)(-s.y,s.x).normalize(),c=o/a.dot(l),h=a.clone().setLength(c),d=new(0,i.Vector2)(-a.y,a.x).normalize(),u=n/s.clone().negate().dot(d),p=s.clone().negate().setLength(u);return h.add(p)}(e.leftPoint,e.commonPoint,e.rightPoint,e.leftDepth/2,e.rightDepth/2),r=t.angle(),n=e.leftPoint.clone().sub(e.commonPoint).angle(),o=e.rightPoint.clone().sub(e.commonPoint).angle(),a=r>o?r-o:r+2*Math.PI-o,s=r<n?Math.PI-n+r:r-n-Math.PI,l=Math.abs(e.rightDepth/2/Math.tan(a)),c=Math.abs(e.leftDepth/2/Math.tan(s));e.miter=t,e.leftDiff=Math.round(100*c)/100,e.rightDiff=Math.round(100*l)/100}(e),this.parameter=e}create(){let e=this.parameter.commonPoint.clone().add(this.parameter.miter),t=e.clone().add(this.parameter.miter),r=e.clone().add(this.parameter.commonPoint).divideScalar(2),n=e.clone().add(t).divideScalar(2),o=this.parameter.leftPoint.clone().sub(this.parameter.commonPoint),a=this.parameter.leftPoint.clone().distanceTo(this.parameter.commonPoint)+2*this.parameter.leftDiff,s=t.clone().add(o.clone().setLength(a)),l=[this.parameter.commonPoint,this.parameter.leftPoint,s,t],c=this.createShapeOrStereoscopic(l,this.parameter.height,this.parameter.texture),h=this.parameter.leftPoint.clone().add(o.clone().negate().setLength(this.parameter.frameBorder)),d=s.clone().add(o.clone().negate().setLength(this.parameter.frameBorder)),u=10,p=this.parameter.commonPoint.clone().add(this.parameter.commonPoint.clone().sub(t).setLength(u));p=p.clone().add(p.clone().sub(h).setLength(u));let m=t.clone().add(t.clone().sub(this.parameter.commonPoint).setLength(u));m=m.clone().add(m.clone().sub(d).setLength(u));let f=h.clone().add(h.clone().sub(d).setLength(u)),g=d.clone().add(d.clone().sub(h).setLength(u)),x=[p,f,g,m],b=this.createShapeOrStereoscopic(x,this.parameter.height-2*this.parameter.frameBorder,new(0,i.MeshBasicMaterial)({color:65280}));b.position.y=this.parameter.frameBorder,c=this.boolean(c,b);let y=r.clone().add(o.clone().setLength(o.length()-this.parameter.frameBorder+this.parameter.leftDiff/2)),w=n.clone().add(o.clone().setLength(o.length()-this.parameter.frameBorder+3*this.parameter.leftDiff/2)),v=[r,y,w,n],$=this.createShapeOrStereoscopic(v,this.parameter.height-2*this.parameter.frameBorder,this.mirrorTexture);$.position.y=this.parameter.frameBorder,$.name="glass";let M=this.parameter.rightPoint.clone().sub(this.parameter.commonPoint),S=this.parameter.rightPoint.clone().distanceTo(this.parameter.commonPoint)+2*this.parameter.rightDiff,P=t.clone().add(M.clone().setLength(S)),k=[this.parameter.commonPoint,this.parameter.rightPoint,P,t],_=this.createShapeOrStereoscopic(k,this.parameter.height,this.parameter.texture),T=this.parameter.rightPoint.clone().add(M.clone().negate().setLength(this.parameter.frameBorder)),C=P.clone().add(M.clone().negate().setLength(this.parameter.frameBorder));p=this.parameter.commonPoint.clone().add(this.parameter.commonPoint.clone().sub(t).setLength(u)),p=p.clone().add(p.clone().sub(T).setLength(u)),m=t.clone().add(t.clone().sub(this.parameter.commonPoint).setLength(u)),m=m.clone().add(m.clone().sub(C).setLength(u)),f=T.clone().add(T.clone().sub(C).setLength(u)),g=C.clone().add(C.clone().sub(T).setLength(u));let A=[p,f,g,m],D=this.createShapeOrStereoscopic(A,this.parameter.height-2*this.parameter.frameBorder,new(0,i.MeshBasicMaterial)({color:255}));D.position.y=this.parameter.frameBorder,_=this.boolean(_,D);let R=r.clone().add(M.clone().setLength(M.length()-this.parameter.frameBorder+this.parameter.rightDiff/2)),E=n.clone().add(M.clone().setLength(M.length()-this.parameter.frameBorder+3*this.parameter.rightDiff/2)),L=[r,R,E,n],I=this.createShapeOrStereoscopic(L,this.parameter.height-2*this.parameter.frameBorder,this.mirrorTexture);I.position.y=this.parameter.frameBorder,I.name="glass";let B=[y,w,n,E,R,r],V=this.createShapeOrStereoscopic(B,this.parameter.height-2*this.parameter.frameBorder,this.mirrorTexture);V.position.y=this.parameter.frameBorder,V.name="glass",this.add(c,_),this.add(V)}}})),parcelRequire.register("3tFct",(function(e,t){$parcel$export(e.exports,"PanoramicWindowMesh",(()=>n));var i=parcelRequire("4xklQ"),r=(i=parcelRequire("4xklQ"),parcelRequire("9vZPJ"));class n extends r.Base3DMesh{constructor(e={}){if(super(),this.type="PanoramicWindowMesh",e.width=e.width||2e3,e.height=e.height||2e3,e.depth=e.depth||1e3,e.platformBorder=e.platformBorder||100,e.windowFrameBorder=e.windowFrameBorder||50,e.thickness=e.thickness||240,e.top=e.top||"double",e.bottom=e.bottom||"double",e.rungPosition=e.rungPosition||"bottom|"+(e.height-3*e.windowFrameBorder)/4,!e.texture){let t=e.editor.config.baseWindowFrame;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.texture=new(0,i.MeshStandardMaterial)({map:t})}e.mirrorTexture=new i.MeshStandardMaterial({color:new i.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new i.Vector2(1,-1),side:2,transparent:!0,opacity:.1,roughness:.1}),this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:new(0,i.MeshStandardMaterial)({color:16777215})},t=this.createBox(e),r={width:this.parameter.width-2*this.parameter.platformBorder,height:this.parameter.height-2*this.parameter.platformBorder,depth:this.parameter.depth},n=this.createBox(r);t=this.boolean(t,n),t.position.add(new(0,i.Vector3)(0,0,this.parameter.thickness/2-e.depth/2)),this.createWindow(),this.add(t)}createWindow(){let e=this.parameter.width-2*this.parameter.platformBorder-2*this.parameter.windowFrameBorder,t=this.parameter.height-2*this.parameter.platformBorder-2*this.parameter.windowFrameBorder,i=this.parameter.rungPosition.split("|"),r=parseFloat(i[1]);r>t-this.parameter.windowFrameBorder?console.log("数据不合法，请检查参数。"):this.getFinalWindow(i[0],r,e,t)}getFinalWindow(e,t,r,n){let o,a,s=new(0,i.Group),l={width:this.parameter.width-2*this.parameter.platformBorder,height:this.parameter.height-2*this.parameter.platformBorder,depth:100,material:this.parameter.texture},c=this.createBox(l);if("top"==e){if("single"==this.parameter.top){let e={width:r,height:t,depth:100,material:new(0,i.MeshBasicMaterial)({color:65280})};o=this.createBox(e),o.position.add(new(0,i.Vector3)(0,(n-t)/2,0)),e.depth/=2,e.material=this.parameter.mirrorTexture;let a=this.createBox(e);a.position.add(new(0,i.Vector3)(0,(n-t)/2,0)),a.name="glass",s.add(a)}else if("double"==this.parameter.top){let e={width:(r-this.parameter.windowFrameBorder)/2,height:t,depth:100,material:new(0,i.MeshBasicMaterial)({color:65280})},a=this.createBox(e),l=a.clone();a.position.add(new(0,i.Vector3)(-(r+this.parameter.windowFrameBorder)/4,(n-t)/2,0)),l.position.add(new(0,i.Vector3)((r+this.parameter.windowFrameBorder)/4,(n-t)/2,0)),o=this.boolean(a,l,"union"),e.depth/=2,e.material=this.parameter.mirrorTexture;let c=this.createBox(e),h=c.clone();c.position.add(new(0,i.Vector3)(-(r+this.parameter.windowFrameBorder)/4,(n-t)/2,0)),h.position.add(new(0,i.Vector3)((r+this.parameter.windowFrameBorder)/4,(n-t)/2,0)),c.name="glass",h.name="glass",s.add(c,h)}if("single"==this.parameter.bottom){let e={width:r,height:n-t-this.parameter.windowFrameBorder,depth:100,material:new(0,i.MeshBasicMaterial)({color:16711680})};a=this.createBox(e),a.position.add(new(0,i.Vector3)(0,(e.height-n)/2,0)),e.depth/=2,e.material=this.parameter.mirrorTexture;let o=this.createBox(e);o.position.add(new(0,i.Vector3)(0,(e.height-n)/2,0)),o.name="glass",s.add(o)}else if("double"==this.parameter.bottom){let e={width:(r-this.parameter.windowFrameBorder)/2,height:n-t-this.parameter.windowFrameBorder,depth:100,material:new(0,i.MeshBasicMaterial)({color:16711680})},o=this.createBox(e),l=o.clone();o.position.add(new(0,i.Vector3)(-(r+this.parameter.windowFrameBorder)/4,(e.height-n)/2,0)),l.position.add(new(0,i.Vector3)((r+this.parameter.windowFrameBorder)/4,(e.height-n)/2,0)),a=this.boolean(o,l,"union"),e.depth/=2,e.material=this.parameter.mirrorTexture;let c=this.createBox(e),h=c.clone();c.position.add(new(0,i.Vector3)(-(r+this.parameter.windowFrameBorder)/4,(e.height-n)/2,0)),h.position.add(new(0,i.Vector3)((r+this.parameter.windowFrameBorder)/4,(e.height-n)/2,0)),c.name="glass",h.name="glass",s.add(c,h)}}else if("bottom"==e){if("single"==this.parameter.top){let e={width:r,height:n-t-this.parameter.windowFrameBorder,depth:100,material:new(0,i.MeshBasicMaterial)({color:65280})};o=this.createBox(e),o.position.add(new(0,i.Vector3)(0,(n-e.height)/2,0)),e.depth/=2,e.material=this.parameter.mirrorTexture;let a=this.createBox(e);a.position.add(new(0,i.Vector3)(0,(n-e.height)/2,0)),a.name="glass",s.add(a)}else if("double"==this.parameter.top){let e={width:(r-this.parameter.windowFrameBorder)/2,height:n-t-this.parameter.windowFrameBorder,depth:100,material:new(0,i.MeshBasicMaterial)({color:65280})},a=this.createBox(e),l=a.clone();a.position.add(new(0,i.Vector3)(-(r+this.parameter.windowFrameBorder)/4,(n-e.height)/2,0)),l.position.add(new(0,i.Vector3)((r+this.parameter.windowFrameBorder)/4,(n-e.height)/2,0)),o=this.boolean(a,l,"union"),e.depth/=2,e.material=this.parameter.mirrorTexture;let c=this.createBox(e),h=c.clone();c.position.add(new(0,i.Vector3)(-(r+this.parameter.windowFrameBorder)/4,(n-e.height)/2,0)),h.position.add(new(0,i.Vector3)((r+this.parameter.windowFrameBorder)/4,(n-e.height)/2,0)),c.name="glass",h.name="glass",s.add(c,h)}if("single"==this.parameter.bottom){let e={width:r,height:t,depth:100,material:new(0,i.MeshBasicMaterial)({color:16711680})};a=this.createBox(e),a.position.add(new(0,i.Vector3)(0,-(n-t)/2,0)),e.depth/=2,e.material=this.parameter.mirrorTexture;let o=this.createBox(e);o.position.add(new(0,i.Vector3)(0,-(n-t)/2,0)),o.name="glass",s.add(o)}else if("double"==this.parameter.bottom){let e={width:(r-this.parameter.windowFrameBorder)/2,height:t,depth:100,material:new(0,i.MeshBasicMaterial)({color:16711680})},o=this.createBox(e),l=o.clone();o.position.add(new(0,i.Vector3)(-(r+this.parameter.windowFrameBorder)/4,-(n-t)/2,0)),l.position.add(new(0,i.Vector3)((r+this.parameter.windowFrameBorder)/4,-(n-t)/2,0)),a=this.boolean(o,l,"union"),e.depth/=2,e.material=this.parameter.mirrorTexture;let c=this.createBox(e),h=c.clone();c.position.add(new(0,i.Vector3)(-(r+this.parameter.windowFrameBorder)/4,-(n-t)/2,0)),h.position.add(new(0,i.Vector3)((r+this.parameter.windowFrameBorder)/4,-(n-t)/2,0)),c.name="glass",h.name="glass",s.add(c,h)}}let h=this.boolean(o,a,"union");c=this.boolean(c,h),s.add(c),s.position.add(new(0,i.Vector3)(0,0,-this.parameter.depth+this.parameter.thickness/2+50)),this.add(s)}}})),parcelRequire.register("dFygm",(function(e,t){$parcel$export(e.exports,"UWindowMesh",(()=>o));var i=parcelRequire("4xklQ"),r=(i=parcelRequire("4xklQ"),parcelRequire("9vZPJ")),n=parcelRequire("hrM0U");class o extends r.Base3DMesh{constructor(e={}){super(),this.type="UWindowMesh";let t=e.wallList[0].position,r=e.wallList[1].position;if(n.CommonFunc.getClockWise(t,e.middleWall.position,r)?(e.leftWall=e.wallList[1],e.rightWall=e.wallList[0]):(e.leftWall=e.wallList[0],e.rightWall=e.wallList[1]),e.leftPoint=new(0,i.Vector2)(-(e.width/2-3e3*e.leftWall.thickness/4),250*-e.middleWall.thickness),e.leftBPoint=new(0,i.Vector2)(e.leftPoint.x,-(e.windowThickL+500*e.middleWall.thickness)),e.rightPoint=new(0,i.Vector2)(e.width/2-3e3*e.rightWall.thickness/4,250*-e.middleWall.thickness),e.rightBPoint=new(0,i.Vector2)(e.rightPoint.x,-(e.windowThickR+500*e.middleWall.thickness)),e.frameBorer=e.frameBorer||50,!e.texture){let t=e.editor.config.baseWindowFrame;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.texture=new(0,i.MeshStandardMaterial)({map:t})}this.mirrorTexture=new(0,i.MeshStandardMaterial)({color:new i.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new i.Vector2(1,-1),side:2,transparent:!0,opacity:.1,roughness:.1}),this.parameter=e}create(){let e=this.parameter.leftPoint.clone().sub(this.parameter.leftBPoint),t=this.parameter.rightPoint.clone().sub(this.parameter.leftPoint),r=t.clone().negate().setLength(500*this.parameter.leftWall.thickness),n=this.parameter.leftBPoint.clone().add(r),o=this.parameter.leftPoint.clone().add(r),a=e.clone().setLength(500*this.parameter.middleWall.thickness),s=this.parameter.leftPoint.clone().add(a),l=(this.parameter.rightPoint.clone().add(a),t.clone().setLength(500*this.parameter.rightWall.thickness)),c=this.parameter.rightPoint.clone().add(l),h=this.parameter.rightBPoint.clone().add(l),d=(new(0,i.Path)).arc(this.parameter.leftPoint.x,this.parameter.leftPoint.y,500*this.parameter.leftWall.thickness,Math.PI,Math.PI/2,!0).getPoints(),u=(new(0,i.Path)).arc(this.parameter.rightPoint.x,this.parameter.rightPoint.y,500*this.parameter.rightWall.thickness,Math.PI/2,0,!0).getPoints(),p=[this.parameter.leftBPoint,n,...d,...u,h,this.parameter.rightBPoint,this.parameter.rightPoint,this.parameter.leftPoint],m=this.createShapeOrStereoscopic(p,this.parameter.height,this.parameter.texture),f=e.clone().setLength(this.parameter.frameBorer),g=this.parameter.leftBPoint.clone().add(f),x=n.clone().add(f),b=o.clone().add(a),y=c.clone().add(a),w=h.clone().add(f),v=this.parameter.rightBPoint.clone().add(f),$=[g,x,b,y,w,v,this.parameter.rightPoint,this.parameter.leftPoint],M=this.createShapeOrStereoscopic($,this.parameter.height-2*this.parameter.frameBorer,new(0,i.MeshBasicMaterial)({color:16711680}));M.position.y+=this.parameter.frameBorer,m=this.boolean(m,M);let S=g.clone().add(t.clone().negate().setLength(125*this.parameter.leftWall.thickness)),P=x.clone().add(t.clone().setLength(125*this.parameter.leftWall.thickness)),k=s.clone().add(e.clone().negate().setLength(125*this.parameter.middleWall.thickness)),_=new(0,i.Vector2)(P.x,k.y),T=c.clone().add(t.clone().negate().setLength(125*this.parameter.rightWall.thickness)),C=new(0,i.Vector2)(T.x,_.y),A=w.clone().add(t.clone().negate().setLength(125*this.parameter.rightWall.thickness)),D=v.clone().add(t.clone().setLength(125*this.parameter.rightWall.thickness)),R=c.clone().add(e.clone().setLength(125*this.parameter.middleWall.thickness)),E=new(0,i.Vector2)(D.x,R.y),L=[S,P,_,C,A,D,E,new(0,i.Vector2)(S.x,E.y)],I=this.createShapeOrStereoscopic(L,this.parameter.height-2*this.parameter.frameBorer,this.mirrorTexture);I.name="glass",I.position.y+=this.parameter.frameBorer,this.add(m,I)}}})),parcelRequire.register("k63JT",(function(e,t){$parcel$export(e.exports,"DooropenMesh",(()=>r));var i=parcelRequire("9vZPJ");class r extends i.Base3DMesh{constructor(e={}){super(),this.type="PassMesh",this.parameter=e}create(){let e=this.createDoorstone();this.add(e)}}}));var $1b1bca85b83d896c$exports={};parcelRequire("dRo73").register(JSON.parse('{"8kZ9I":"index.b63d2076.js","6lZac":"generateAsync.worker.31fef1fa.js"}'));var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ"),$0f7bfe5028a81ceb$var$tmp=new(0,$4xklQ.Vector2),$0f7bfe5028a81ceb$var$capEnd=new(0,$4xklQ.Vector2),$0f7bfe5028a81ceb$var$lineA=new(0,$4xklQ.Vector2),$0f7bfe5028a81ceb$var$lineB=new(0,$4xklQ.Vector2),$0f7bfe5028a81ceb$var$tangent=new(0,$4xklQ.Vector2),$0f7bfe5028a81ceb$var$miter=new(0,$4xklQ.Vector2);function $0f7bfe5028a81ceb$export$18d19c7a3aa33064(e){if(!(this instanceof $0f7bfe5028a81ceb$export$18d19c7a3aa33064))return new $0f7bfe5028a81ceb$export$18d19c7a3aa33064(e);e=e||{},this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||20,this.thickrules=e.thickrules||[],this.join=e.join||"miter",this.cap=e.cap||"butt",this._normal=null,this._lastFlip=-1,this._started=!1}function $0f7bfe5028a81ceb$var$extrusions(e,t,i,r,n,o){$0f7bfe5028a81ceb$var$scaleAndAdd($0f7bfe5028a81ceb$var$tmp,r,n,-o),e.push($0f7bfe5028a81ceb$var$tmp.clone().toArray()),i.push($0f7bfe5028a81ceb$var$tmp.clone().toArray()),$0f7bfe5028a81ceb$var$scaleAndAdd($0f7bfe5028a81ceb$var$tmp,r,n,o),e.push($0f7bfe5028a81ceb$var$tmp.clone().toArray()),t.push($0f7bfe5028a81ceb$var$tmp.clone().toArray())}function $0f7bfe5028a81ceb$var$direction(e,t,i){var r=new(0,$4xklQ.Vector2)(t[0],t[1]),n=new(0,$4xklQ.Vector2)(i[0],i[1]);return e.subVectors(r,n).normalize(),e}function $0f7bfe5028a81ceb$var$normal(e,t){return e.set(-t.y,t.x),e}function $0f7bfe5028a81ceb$var$scaleAndAdd(e,t,i,r){var n=new(0,$4xklQ.Vector2)(t[0],t[1]),o=i.clone().setLength(r);return e.addVectors(n,o)}function $0f7bfe5028a81ceb$var$computeMiter(e,t,i,r,n,o){var a=new(0,$4xklQ.Vector2)(-r.y,r.x).normalize(),s=o/i.dot(a),l=i.clone().setLength(s),c=new(0,$4xklQ.Vector2)(-i.y,i.x).normalize(),h=n/r.clone().negate().dot(c),d=r.clone().negate().setLength(h);return t.addVectors(l,d),t.length()}$0f7bfe5028a81ceb$export$18d19c7a3aa33064.prototype.mapThickness=function(e,t,i){var r=null;return this.thickrules.forEach((function(e){t>=e[0]&&t<=e[1]&&(r=e[2])})),null!=r?r:this.thickness},$0f7bfe5028a81ceb$export$18d19c7a3aa33064.prototype.clockwise=function(e){return e},$0f7bfe5028a81ceb$export$18d19c7a3aa33064.prototype.build=function(e){var t={positions:[],cells:[],outter:[],innner:[]};if(e.length<=1)return t;var i=e.length;this._lastFlip=-1,this._started=!1,this._normal=null;for(var r=1,n=0;r<i;r++){var o=e[r-1],a=e[r],s=r<e.length-1?e[r+1]:null,l=this.mapThickness(a,r,e),c=this.mapThickness(s,r+1,e);n+=this._seg(t,n,o,a,s,l/2,c/2)}return this.clockwise(t)},$0f7bfe5028a81ceb$export$18d19c7a3aa33064.prototype._seg=function(e,t,i,r,n,o,a){var s=0,l=e.cells,c=e.positions,h=e.outter,d=e.innner,u="square"===this.cap,p="bevel"===this.join;if($0f7bfe5028a81ceb$var$direction($0f7bfe5028a81ceb$var$lineA,r,i),this._normal||(this._normal=new(0,$4xklQ.Vector2),$0f7bfe5028a81ceb$var$normal(this._normal,$0f7bfe5028a81ceb$var$lineA)),this._started||(this._started=!0,u&&($0f7bfe5028a81ceb$var$scaleAndAdd($0f7bfe5028a81ceb$var$capEnd,i,$0f7bfe5028a81ceb$var$lineA,-o),i=$0f7bfe5028a81ceb$var$capEnd.toArray()),$0f7bfe5028a81ceb$var$extrusions(c,h,d,i,this._normal,o)),l.push([t+0,t+1,t+2]),n){$0f7bfe5028a81ceb$var$direction($0f7bfe5028a81ceb$var$lineB,n,r);var m=$0f7bfe5028a81ceb$var$computeMiter($0f7bfe5028a81ceb$var$tangent,$0f7bfe5028a81ceb$var$miter,$0f7bfe5028a81ceb$var$lineA,$0f7bfe5028a81ceb$var$lineB,o,a),f=$0f7bfe5028a81ceb$var$tangent.dot(this._normal)<0?-1:1,g=p;if(!g&&"miter"===this.join)m/o>this.miterLimit&&(g=!0);g||($0f7bfe5028a81ceb$var$extrusions(c,h,d,r,$0f7bfe5028a81ceb$var$miter,m),l.push(1===this._lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3]),f=-1,this.normal=$0f7bfe5028a81ceb$var$miter.clone(),s+=2),this._lastFlip=f}else $0f7bfe5028a81ceb$var$normal(this._normal,$0f7bfe5028a81ceb$var$lineA),u&&($0f7bfe5028a81ceb$var$scaleAndAdd($0f7bfe5028a81ceb$var$capEnd,r,$0f7bfe5028a81ceb$var$lineA,o),r=$0f7bfe5028a81ceb$var$capEnd.toArray()),$0f7bfe5028a81ceb$var$extrusions(c,h,d,r,this._normal,o),l.push(1===this._lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3]),s+=2;return s};var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ");const $a82ce66e6c7e4e60$export$4c2b49800098dff3={triangulate:function(e,t,i=2){const r=t&&t.length,n=r?t[0]*i:e.length;let o=$a82ce66e6c7e4e60$var$linkedList(e,0,n,i,!0);const a=[];if(!o||o.next===o.prev)return a;let s,l,c,h,d,u,p;if(r&&(o=$a82ce66e6c7e4e60$var$eliminateHoles(e,t,o,i)),e.length>80*i){s=c=e[0],l=h=e[1];for(let t=i;t<n;t+=i)d=e[t],u=e[t+1],d<s&&(s=d),u<l&&(l=u),d>c&&(c=d),u>h&&(h=u);p=Math.max(c-s,h-l),p=0!==p?1/p:0}return $a82ce66e6c7e4e60$var$earcutLinked(o,a,i,s,l,p),a}};function $a82ce66e6c7e4e60$var$linkedList(e,t,i,r,n){let o,a;if(n===$a82ce66e6c7e4e60$var$signedArea(e,t,i,r)>0)for(o=t;o<i;o+=r)a=$a82ce66e6c7e4e60$var$insertNode(o,e[o],e[o+1],a);else for(o=i-r;o>=t;o-=r)a=$a82ce66e6c7e4e60$var$insertNode(o,e[o],e[o+1],a);return a&&$a82ce66e6c7e4e60$var$equals(a,a.next)&&($a82ce66e6c7e4e60$var$removeNode(a),a=a.next),a}function $a82ce66e6c7e4e60$var$filterPoints(e,t){if(!e)return e;t||(t=e);let i,r=e;do{if(i=!1,r.steiner||!$a82ce66e6c7e4e60$var$equals(r,r.next)&&0!==$a82ce66e6c7e4e60$var$area(r.prev,r,r.next))r=r.next;else{if($a82ce66e6c7e4e60$var$removeNode(r),r=t=r.prev,r===r.next)break;i=!0}}while(i||r!==t);return t}function $a82ce66e6c7e4e60$var$earcutLinked(e,t,i,r,n,o,a){if(!e)return;!a&&o&&$a82ce66e6c7e4e60$var$indexCurve(e,r,n,o);let s,l,c=e;for(;e.prev!==e.next;)if(s=e.prev,l=e.next,o?$a82ce66e6c7e4e60$var$isEarHashed(e,r,n,o):$a82ce66e6c7e4e60$var$isEar(e))t.push(s.i/i),t.push(e.i/i),t.push(l.i/i),$a82ce66e6c7e4e60$var$removeNode(e),e=l.next,c=l.next;else if((e=l)===c){a?1===a?$a82ce66e6c7e4e60$var$earcutLinked(e=$a82ce66e6c7e4e60$var$cureLocalIntersections($a82ce66e6c7e4e60$var$filterPoints(e),t,i),t,i,r,n,o,2):2===a&&$a82ce66e6c7e4e60$var$splitEarcut(e,t,i,r,n,o):$a82ce66e6c7e4e60$var$earcutLinked($a82ce66e6c7e4e60$var$filterPoints(e),t,i,r,n,o,1);break}}function $a82ce66e6c7e4e60$var$isEar(e){const t=e.prev,i=e,r=e.next;if($a82ce66e6c7e4e60$var$area(t,i,r)>=0)return!1;let n=e.next.next;for(;n!==e.prev;){if($a82ce66e6c7e4e60$var$pointInTriangle(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&$a82ce66e6c7e4e60$var$area(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function $a82ce66e6c7e4e60$var$isEarHashed(e,t,i,r){const n=e.prev,o=e,a=e.next;if($a82ce66e6c7e4e60$var$area(n,o,a)>=0)return!1;const s=n.x<o.x?n.x<a.x?n.x:a.x:o.x<a.x?o.x:a.x,l=n.y<o.y?n.y<a.y?n.y:a.y:o.y<a.y?o.y:a.y,c=n.x>o.x?n.x>a.x?n.x:a.x:o.x>a.x?o.x:a.x,h=n.y>o.y?n.y>a.y?n.y:a.y:o.y>a.y?o.y:a.y,d=$a82ce66e6c7e4e60$var$zOrder(s,l,t,i,r),u=$a82ce66e6c7e4e60$var$zOrder(c,h,t,i,r);let p=e.prevZ,m=e.nextZ;for(;p&&p.z>=d&&m&&m.z<=u;){if(p!==e.prev&&p!==e.next&&$a82ce66e6c7e4e60$var$pointInTriangle(n.x,n.y,o.x,o.y,a.x,a.y,p.x,p.y)&&$a82ce66e6c7e4e60$var$area(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,m!==e.prev&&m!==e.next&&$a82ce66e6c7e4e60$var$pointInTriangle(n.x,n.y,o.x,o.y,a.x,a.y,m.x,m.y)&&$a82ce66e6c7e4e60$var$area(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;p&&p.z>=d;){if(p!==e.prev&&p!==e.next&&$a82ce66e6c7e4e60$var$pointInTriangle(n.x,n.y,o.x,o.y,a.x,a.y,p.x,p.y)&&$a82ce66e6c7e4e60$var$area(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=u;){if(m!==e.prev&&m!==e.next&&$a82ce66e6c7e4e60$var$pointInTriangle(n.x,n.y,o.x,o.y,a.x,a.y,m.x,m.y)&&$a82ce66e6c7e4e60$var$area(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function $a82ce66e6c7e4e60$var$cureLocalIntersections(e,t,i){let r=e;do{const n=r.prev,o=r.next.next;!$a82ce66e6c7e4e60$var$equals(n,o)&&$a82ce66e6c7e4e60$var$intersects(n,r,r.next,o)&&$a82ce66e6c7e4e60$var$locallyInside(n,o)&&$a82ce66e6c7e4e60$var$locallyInside(o,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(o.i/i),$a82ce66e6c7e4e60$var$removeNode(r),$a82ce66e6c7e4e60$var$removeNode(r.next),r=e=o),r=r.next}while(r!==e);return $a82ce66e6c7e4e60$var$filterPoints(r)}function $a82ce66e6c7e4e60$var$splitEarcut(e,t,i,r,n,o){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&$a82ce66e6c7e4e60$var$isValidDiagonal(a,e)){let s=$a82ce66e6c7e4e60$var$splitPolygon(a,e);return a=$a82ce66e6c7e4e60$var$filterPoints(a,a.next),s=$a82ce66e6c7e4e60$var$filterPoints(s,s.next),$a82ce66e6c7e4e60$var$earcutLinked(a,t,i,r,n,o),void $a82ce66e6c7e4e60$var$earcutLinked(s,t,i,r,n,o)}e=e.next}a=a.next}while(a!==e)}function $a82ce66e6c7e4e60$var$eliminateHoles(e,t,i,r){const n=[];let o,a,s,l,c;for(o=0,a=t.length;o<a;o++)s=t[o]*r,l=o<a-1?t[o+1]*r:e.length,c=$a82ce66e6c7e4e60$var$linkedList(e,s,l,r,!1),c===c.next&&(c.steiner=!0),n.push($a82ce66e6c7e4e60$var$getLeftmost(c));for(n.sort($a82ce66e6c7e4e60$var$compareX),o=0;o<n.length;o++)$a82ce66e6c7e4e60$var$eliminateHole(n[o],i),i=$a82ce66e6c7e4e60$var$filterPoints(i,i.next);return i}function $a82ce66e6c7e4e60$var$compareX(e,t){return e.x-t.x}function $a82ce66e6c7e4e60$var$eliminateHole(e,t){if(t=$a82ce66e6c7e4e60$var$findHoleBridge(e,t)){const i=$a82ce66e6c7e4e60$var$splitPolygon(t,e);$a82ce66e6c7e4e60$var$filterPoints(t,t.next),$a82ce66e6c7e4e60$var$filterPoints(i,i.next)}}function $a82ce66e6c7e4e60$var$findHoleBridge(e,t){let i=t;const r=e.x,n=e.y;let o,a=-1/0;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){const e=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=r&&e>a){if(a=e,e===r){if(n===i.y)return i;if(n===i.next.y)return i.next}o=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!o)return null;if(r===a)return o;const s=o,l=o.x,c=o.y;let h,d=1/0;i=o;do{r>=i.x&&i.x>=l&&r!==i.x&&$a82ce66e6c7e4e60$var$pointInTriangle(n<c?r:a,n,l,c,n<c?a:r,n,i.x,i.y)&&(h=Math.abs(n-i.y)/(r-i.x),$a82ce66e6c7e4e60$var$locallyInside(i,e)&&(h<d||h===d&&(i.x>o.x||i.x===o.x&&$a82ce66e6c7e4e60$var$sectorContainsSector(o,i)))&&(o=i,d=h)),i=i.next}while(i!==s);return o}function $a82ce66e6c7e4e60$var$sectorContainsSector(e,t){return $a82ce66e6c7e4e60$var$area(e.prev,e,t.prev)<0&&$a82ce66e6c7e4e60$var$area(t.next,e,e.next)<0}function $a82ce66e6c7e4e60$var$indexCurve(e,t,i,r){let n=e;do{null===n.z&&(n.z=$a82ce66e6c7e4e60$var$zOrder(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,$a82ce66e6c7e4e60$var$sortLinked(n)}function $a82ce66e6c7e4e60$var$sortLinked(e){let t,i,r,n,o,a,s,l,c=1;do{for(i=e,e=null,o=null,a=0;i;){for(a++,r=i,s=0,t=0;t<c&&(s++,r=r.nextZ,r);t++);for(l=c;s>0||l>0&&r;)0!==s&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,s--):(n=r,r=r.nextZ,l--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=r}o.nextZ=null,c*=2}while(a>1);return e}function $a82ce66e6c7e4e60$var$zOrder(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function $a82ce66e6c7e4e60$var$getLeftmost(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function $a82ce66e6c7e4e60$var$pointInTriangle(e,t,i,r,n,o,a,s){return(n-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(r-s)-(i-a)*(t-s)>=0&&(i-a)*(o-s)-(n-a)*(r-s)>=0}function $a82ce66e6c7e4e60$var$isValidDiagonal(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!$a82ce66e6c7e4e60$var$intersectsPolygon(e,t)&&($a82ce66e6c7e4e60$var$locallyInside(e,t)&&$a82ce66e6c7e4e60$var$locallyInside(t,e)&&$a82ce66e6c7e4e60$var$middleInside(e,t)&&($a82ce66e6c7e4e60$var$area(e.prev,e,t.prev)||$a82ce66e6c7e4e60$var$area(e,t.prev,t))||$a82ce66e6c7e4e60$var$equals(e,t)&&$a82ce66e6c7e4e60$var$area(e.prev,e,e.next)>0&&$a82ce66e6c7e4e60$var$area(t.prev,t,t.next)>0)}function $a82ce66e6c7e4e60$var$area(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function $a82ce66e6c7e4e60$var$equals(e,t){return e.x===t.x&&e.y===t.y}function $a82ce66e6c7e4e60$var$intersects(e,t,i,r){const n=$a82ce66e6c7e4e60$var$sign($a82ce66e6c7e4e60$var$area(e,t,i)),o=$a82ce66e6c7e4e60$var$sign($a82ce66e6c7e4e60$var$area(e,t,r)),a=$a82ce66e6c7e4e60$var$sign($a82ce66e6c7e4e60$var$area(i,r,e)),s=$a82ce66e6c7e4e60$var$sign($a82ce66e6c7e4e60$var$area(i,r,t));return n!==o&&a!==s||(!(0!==n||!$a82ce66e6c7e4e60$var$onSegment(e,i,t))||(!(0!==o||!$a82ce66e6c7e4e60$var$onSegment(e,r,t))||(!(0!==a||!$a82ce66e6c7e4e60$var$onSegment(i,e,r))||!(0!==s||!$a82ce66e6c7e4e60$var$onSegment(i,t,r)))))}function $a82ce66e6c7e4e60$var$onSegment(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function $a82ce66e6c7e4e60$var$sign(e){return e>0?1:e<0?-1:0}function $a82ce66e6c7e4e60$var$intersectsPolygon(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&$a82ce66e6c7e4e60$var$intersects(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function $a82ce66e6c7e4e60$var$locallyInside(e,t){return $a82ce66e6c7e4e60$var$area(e.prev,e,e.next)<0?$a82ce66e6c7e4e60$var$area(e,t,e.next)>=0&&$a82ce66e6c7e4e60$var$area(e,e.prev,t)>=0:$a82ce66e6c7e4e60$var$area(e,t,e.prev)<0||$a82ce66e6c7e4e60$var$area(e,e.next,t)<0}function $a82ce66e6c7e4e60$var$middleInside(e,t){let i=e,r=!1;const n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}function $a82ce66e6c7e4e60$var$splitPolygon(e,t){const i=new $a82ce66e6c7e4e60$var$Node(e.i,e.x,e.y),r=new $a82ce66e6c7e4e60$var$Node(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function $a82ce66e6c7e4e60$var$insertNode(e,t,i,r){const n=new $a82ce66e6c7e4e60$var$Node(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function $a82ce66e6c7e4e60$var$removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function $a82ce66e6c7e4e60$var$Node(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function $a82ce66e6c7e4e60$var$signedArea(e,t,i,r){let n=0;for(let o=t,a=i-r;o<i;o+=r)n+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return n}class $b590b02110506a77$export$96bdf6d9c66d7ba8{static area(e){const t=e.length;let i=0;for(let r=t-1,n=0;n<t;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return.5*i}static isClockWise(e){return $b590b02110506a77$export$96bdf6d9c66d7ba8.area(e)<0}static triangulateShape(e,t){const i=[],r=[],n=[];$b590b02110506a77$var$removeDupEndPts(e),$b590b02110506a77$var$addContour(i,e);let o=e.length;t.forEach($b590b02110506a77$var$removeDupEndPts);for(let e=0;e<t.length;e++)r.push(o),o+=t[e].length,$b590b02110506a77$var$addContour(i,t[e]);const a=$a82ce66e6c7e4e60$export$4c2b49800098dff3.triangulate(i,r);for(let e=0;e<a.length;e+=3)n.push(a.slice(e,e+3));return n}}function $b590b02110506a77$var$removeDupEndPts(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function $b590b02110506a77$var$addContour(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}var $9HO6e=parcelRequire("9HO6e"),$4xklQ=parcelRequire("4xklQ");const $44a90fc8a2825c34$var$a={c:null,u:[new(0,$4xklQ.Vector3),new(0,$4xklQ.Vector3),new(0,$4xklQ.Vector3)],e:[]},$44a90fc8a2825c34$var$b={c:null,u:[new(0,$4xklQ.Vector3),new(0,$4xklQ.Vector3),new(0,$4xklQ.Vector3)],e:[]},$44a90fc8a2825c34$var$R=[[],[],[]],$44a90fc8a2825c34$var$AbsR=[[],[],[]],$44a90fc8a2825c34$var$t=[],$44a90fc8a2825c34$var$xAxis=new(0,$4xklQ.Vector3),$44a90fc8a2825c34$var$yAxis=new(0,$4xklQ.Vector3),$44a90fc8a2825c34$var$zAxis=new(0,$4xklQ.Vector3),$44a90fc8a2825c34$var$v1=new(0,$4xklQ.Vector3),$44a90fc8a2825c34$var$size=new(0,$4xklQ.Vector3),$44a90fc8a2825c34$var$closestPoint=new(0,$4xklQ.Vector3),$44a90fc8a2825c34$var$rotationMatrix=new(0,$4xklQ.Matrix3),$44a90fc8a2825c34$var$aabb=new(0,$4xklQ.Box3),$44a90fc8a2825c34$var$matrix=new(0,$4xklQ.Matrix4),$44a90fc8a2825c34$var$inverse=new(0,$4xklQ.Matrix4),$44a90fc8a2825c34$var$localRay=new(0,$4xklQ.Ray);class $44a90fc8a2825c34$export$f7a1f6dc3f8b082f{constructor(e=new(0,$4xklQ.Vector3),t=new(0,$4xklQ.Vector3),i=new(0,$4xklQ.Matrix3)){this.center=e,this.halfSize=t,this.rotation=i}set(e,t,i){return this.center=e,this.halfSize=t,this.rotation=i,this}copy(e){return this.center.copy(e.center),this.halfSize.copy(e.halfSize),this.rotation.copy(e.rotation),this}clone(){return(new this.constructor).copy(this)}getSize(e){return e.copy(this.halfSize).multiplyScalar(2)}clampPoint(e,t){const i=this.halfSize;$44a90fc8a2825c34$var$v1.subVectors(e,this.center),this.rotation.extractBasis($44a90fc8a2825c34$var$xAxis,$44a90fc8a2825c34$var$yAxis,$44a90fc8a2825c34$var$zAxis),t.copy(this.center);const r=$4xklQ.MathUtils.clamp($44a90fc8a2825c34$var$v1.dot($44a90fc8a2825c34$var$xAxis),-i.x,i.x);t.add($44a90fc8a2825c34$var$xAxis.multiplyScalar(r));const n=$4xklQ.MathUtils.clamp($44a90fc8a2825c34$var$v1.dot($44a90fc8a2825c34$var$yAxis),-i.y,i.y);t.add($44a90fc8a2825c34$var$yAxis.multiplyScalar(n));const o=$4xklQ.MathUtils.clamp($44a90fc8a2825c34$var$v1.dot($44a90fc8a2825c34$var$zAxis),-i.z,i.z);return t.add($44a90fc8a2825c34$var$zAxis.multiplyScalar(o)),t}containsPoint(e){return $44a90fc8a2825c34$var$v1.subVectors(e,this.center),this.rotation.extractBasis($44a90fc8a2825c34$var$xAxis,$44a90fc8a2825c34$var$yAxis,$44a90fc8a2825c34$var$zAxis),Math.abs($44a90fc8a2825c34$var$v1.dot($44a90fc8a2825c34$var$xAxis))<=this.halfSize.x&&Math.abs($44a90fc8a2825c34$var$v1.dot($44a90fc8a2825c34$var$yAxis))<=this.halfSize.y&&Math.abs($44a90fc8a2825c34$var$v1.dot($44a90fc8a2825c34$var$zAxis))<=this.halfSize.z}intersectsBox3(e){return this.intersectsOBB($44a90fc8a2825c34$var$obb.fromBox3(e))}intersectsSphere(e){return this.clampPoint(e.center,$44a90fc8a2825c34$var$closestPoint),$44a90fc8a2825c34$var$closestPoint.distanceToSquared(e.center)<=e.radius*e.radius}intersectsOBB(e,t=Number.EPSILON){$44a90fc8a2825c34$var$a.c=this.center,$44a90fc8a2825c34$var$a.e[0]=this.halfSize.x,$44a90fc8a2825c34$var$a.e[1]=this.halfSize.y,$44a90fc8a2825c34$var$a.e[2]=this.halfSize.z,this.rotation.extractBasis($44a90fc8a2825c34$var$a.u[0],$44a90fc8a2825c34$var$a.u[1],$44a90fc8a2825c34$var$a.u[2]),$44a90fc8a2825c34$var$b.c=e.center,$44a90fc8a2825c34$var$b.e[0]=e.halfSize.x,$44a90fc8a2825c34$var$b.e[1]=e.halfSize.y,$44a90fc8a2825c34$var$b.e[2]=e.halfSize.z,e.rotation.extractBasis($44a90fc8a2825c34$var$b.u[0],$44a90fc8a2825c34$var$b.u[1],$44a90fc8a2825c34$var$b.u[2]);for(let e=0;e<3;e++)for(let t=0;t<3;t++)$44a90fc8a2825c34$var$R[e][t]=$44a90fc8a2825c34$var$a.u[e].dot($44a90fc8a2825c34$var$b.u[t]);$44a90fc8a2825c34$var$v1.subVectors($44a90fc8a2825c34$var$b.c,$44a90fc8a2825c34$var$a.c),$44a90fc8a2825c34$var$t[0]=$44a90fc8a2825c34$var$v1.dot($44a90fc8a2825c34$var$a.u[0]),$44a90fc8a2825c34$var$t[1]=$44a90fc8a2825c34$var$v1.dot($44a90fc8a2825c34$var$a.u[1]),$44a90fc8a2825c34$var$t[2]=$44a90fc8a2825c34$var$v1.dot($44a90fc8a2825c34$var$a.u[2]);for(let e=0;e<3;e++)for(let i=0;i<3;i++)$44a90fc8a2825c34$var$AbsR[e][i]=Math.abs($44a90fc8a2825c34$var$R[e][i])+t;let i,r;for(let e=0;e<3;e++)if(i=$44a90fc8a2825c34$var$a.e[e],r=$44a90fc8a2825c34$var$b.e[0]*$44a90fc8a2825c34$var$AbsR[e][0]+$44a90fc8a2825c34$var$b.e[1]*$44a90fc8a2825c34$var$AbsR[e][1]+$44a90fc8a2825c34$var$b.e[2]*$44a90fc8a2825c34$var$AbsR[e][2],Math.abs($44a90fc8a2825c34$var$t[e])>i+r)return!1;for(let e=0;e<3;e++)if(i=$44a90fc8a2825c34$var$a.e[0]*$44a90fc8a2825c34$var$AbsR[0][e]+$44a90fc8a2825c34$var$a.e[1]*$44a90fc8a2825c34$var$AbsR[1][e]+$44a90fc8a2825c34$var$a.e[2]*$44a90fc8a2825c34$var$AbsR[2][e],r=$44a90fc8a2825c34$var$b.e[e],Math.abs($44a90fc8a2825c34$var$t[0]*$44a90fc8a2825c34$var$R[0][e]+$44a90fc8a2825c34$var$t[1]*$44a90fc8a2825c34$var$R[1][e]+$44a90fc8a2825c34$var$t[2]*$44a90fc8a2825c34$var$R[2][e])>i+r)return!1;return i=$44a90fc8a2825c34$var$a.e[1]*$44a90fc8a2825c34$var$AbsR[2][0]+$44a90fc8a2825c34$var$a.e[2]*$44a90fc8a2825c34$var$AbsR[1][0],r=$44a90fc8a2825c34$var$b.e[1]*$44a90fc8a2825c34$var$AbsR[0][2]+$44a90fc8a2825c34$var$b.e[2]*$44a90fc8a2825c34$var$AbsR[0][1],!(Math.abs($44a90fc8a2825c34$var$t[2]*$44a90fc8a2825c34$var$R[1][0]-$44a90fc8a2825c34$var$t[1]*$44a90fc8a2825c34$var$R[2][0])>i+r)&&(i=$44a90fc8a2825c34$var$a.e[1]*$44a90fc8a2825c34$var$AbsR[2][1]+$44a90fc8a2825c34$var$a.e[2]*$44a90fc8a2825c34$var$AbsR[1][1],r=$44a90fc8a2825c34$var$b.e[0]*$44a90fc8a2825c34$var$AbsR[0][2]+$44a90fc8a2825c34$var$b.e[2]*$44a90fc8a2825c34$var$AbsR[0][0],!(Math.abs($44a90fc8a2825c34$var$t[2]*$44a90fc8a2825c34$var$R[1][1]-$44a90fc8a2825c34$var$t[1]*$44a90fc8a2825c34$var$R[2][1])>i+r)&&(i=$44a90fc8a2825c34$var$a.e[1]*$44a90fc8a2825c34$var$AbsR[2][2]+$44a90fc8a2825c34$var$a.e[2]*$44a90fc8a2825c34$var$AbsR[1][2],r=$44a90fc8a2825c34$var$b.e[0]*$44a90fc8a2825c34$var$AbsR[0][1]+$44a90fc8a2825c34$var$b.e[1]*$44a90fc8a2825c34$var$AbsR[0][0],!(Math.abs($44a90fc8a2825c34$var$t[2]*$44a90fc8a2825c34$var$R[1][2]-$44a90fc8a2825c34$var$t[1]*$44a90fc8a2825c34$var$R[2][2])>i+r)&&(i=$44a90fc8a2825c34$var$a.e[0]*$44a90fc8a2825c34$var$AbsR[2][0]+$44a90fc8a2825c34$var$a.e[2]*$44a90fc8a2825c34$var$AbsR[0][0],r=$44a90fc8a2825c34$var$b.e[1]*$44a90fc8a2825c34$var$AbsR[1][2]+$44a90fc8a2825c34$var$b.e[2]*$44a90fc8a2825c34$var$AbsR[1][1],!(Math.abs($44a90fc8a2825c34$var$t[0]*$44a90fc8a2825c34$var$R[2][0]-$44a90fc8a2825c34$var$t[2]*$44a90fc8a2825c34$var$R[0][0])>i+r)&&(i=$44a90fc8a2825c34$var$a.e[0]*$44a90fc8a2825c34$var$AbsR[2][1]+$44a90fc8a2825c34$var$a.e[2]*$44a90fc8a2825c34$var$AbsR[0][1],r=$44a90fc8a2825c34$var$b.e[0]*$44a90fc8a2825c34$var$AbsR[1][2]+$44a90fc8a2825c34$var$b.e[2]*$44a90fc8a2825c34$var$AbsR[1][0],!(Math.abs($44a90fc8a2825c34$var$t[0]*$44a90fc8a2825c34$var$R[2][1]-$44a90fc8a2825c34$var$t[2]*$44a90fc8a2825c34$var$R[0][1])>i+r)&&(i=$44a90fc8a2825c34$var$a.e[0]*$44a90fc8a2825c34$var$AbsR[2][2]+$44a90fc8a2825c34$var$a.e[2]*$44a90fc8a2825c34$var$AbsR[0][2],r=$44a90fc8a2825c34$var$b.e[0]*$44a90fc8a2825c34$var$AbsR[1][1]+$44a90fc8a2825c34$var$b.e[1]*$44a90fc8a2825c34$var$AbsR[1][0],!(Math.abs($44a90fc8a2825c34$var$t[0]*$44a90fc8a2825c34$var$R[2][2]-$44a90fc8a2825c34$var$t[2]*$44a90fc8a2825c34$var$R[0][2])>i+r)&&(i=$44a90fc8a2825c34$var$a.e[0]*$44a90fc8a2825c34$var$AbsR[1][0]+$44a90fc8a2825c34$var$a.e[1]*$44a90fc8a2825c34$var$AbsR[0][0],r=$44a90fc8a2825c34$var$b.e[1]*$44a90fc8a2825c34$var$AbsR[2][2]+$44a90fc8a2825c34$var$b.e[2]*$44a90fc8a2825c34$var$AbsR[2][1],!(Math.abs($44a90fc8a2825c34$var$t[1]*$44a90fc8a2825c34$var$R[0][0]-$44a90fc8a2825c34$var$t[0]*$44a90fc8a2825c34$var$R[1][0])>i+r)&&(i=$44a90fc8a2825c34$var$a.e[0]*$44a90fc8a2825c34$var$AbsR[1][1]+$44a90fc8a2825c34$var$a.e[1]*$44a90fc8a2825c34$var$AbsR[0][1],r=$44a90fc8a2825c34$var$b.e[0]*$44a90fc8a2825c34$var$AbsR[2][2]+$44a90fc8a2825c34$var$b.e[2]*$44a90fc8a2825c34$var$AbsR[2][0],!(Math.abs($44a90fc8a2825c34$var$t[1]*$44a90fc8a2825c34$var$R[0][1]-$44a90fc8a2825c34$var$t[0]*$44a90fc8a2825c34$var$R[1][1])>i+r)&&(i=$44a90fc8a2825c34$var$a.e[0]*$44a90fc8a2825c34$var$AbsR[1][2]+$44a90fc8a2825c34$var$a.e[1]*$44a90fc8a2825c34$var$AbsR[0][2],r=$44a90fc8a2825c34$var$b.e[0]*$44a90fc8a2825c34$var$AbsR[2][1]+$44a90fc8a2825c34$var$b.e[1]*$44a90fc8a2825c34$var$AbsR[2][0],!(Math.abs($44a90fc8a2825c34$var$t[1]*$44a90fc8a2825c34$var$R[0][2]-$44a90fc8a2825c34$var$t[0]*$44a90fc8a2825c34$var$R[1][2])>i+r)))))))))}intersectsPlane(e){this.rotation.extractBasis($44a90fc8a2825c34$var$xAxis,$44a90fc8a2825c34$var$yAxis,$44a90fc8a2825c34$var$zAxis);const t=this.halfSize.x*Math.abs(e.normal.dot($44a90fc8a2825c34$var$xAxis))+this.halfSize.y*Math.abs(e.normal.dot($44a90fc8a2825c34$var$yAxis))+this.halfSize.z*Math.abs(e.normal.dot($44a90fc8a2825c34$var$zAxis)),i=e.normal.dot(this.center)-e.constant;return Math.abs(i)<=t}intersectRay(e,t){return this.getSize($44a90fc8a2825c34$var$size),$44a90fc8a2825c34$var$aabb.setFromCenterAndSize($44a90fc8a2825c34$var$v1.set(0,0,0),$44a90fc8a2825c34$var$size),$44a90fc8a2825c34$var$matrix.setFromMatrix3(this.rotation),$44a90fc8a2825c34$var$matrix.setPosition(this.center),$44a90fc8a2825c34$var$inverse.copy($44a90fc8a2825c34$var$matrix).invert(),$44a90fc8a2825c34$var$localRay.copy(e).applyMatrix4($44a90fc8a2825c34$var$inverse),$44a90fc8a2825c34$var$localRay.intersectBox($44a90fc8a2825c34$var$aabb,t)?t.applyMatrix4($44a90fc8a2825c34$var$matrix):null}intersectsRay(e){return null!==this.intersectRay(e,$44a90fc8a2825c34$var$v1)}fromBox3(e){return e.getCenter(this.center),e.getSize(this.halfSize).multiplyScalar(.5),this.rotation.identity(),this}equals(e){return e.center.equals(this.center)&&e.halfSize.equals(this.halfSize)&&e.rotation.equals(this.rotation)}applyMatrix4(e){const t=e.elements;let i=$44a90fc8a2825c34$var$v1.set(t[0],t[1],t[2]).length();const r=$44a90fc8a2825c34$var$v1.set(t[4],t[5],t[6]).length(),n=$44a90fc8a2825c34$var$v1.set(t[8],t[9],t[10]).length();e.determinant()<0&&(i=-i),$44a90fc8a2825c34$var$rotationMatrix.setFromMatrix4(e);const o=1/i,a=1/r,s=1/n;return $44a90fc8a2825c34$var$rotationMatrix.elements[0]*=o,$44a90fc8a2825c34$var$rotationMatrix.elements[1]*=o,$44a90fc8a2825c34$var$rotationMatrix.elements[2]*=o,$44a90fc8a2825c34$var$rotationMatrix.elements[3]*=a,$44a90fc8a2825c34$var$rotationMatrix.elements[4]*=a,$44a90fc8a2825c34$var$rotationMatrix.elements[5]*=a,$44a90fc8a2825c34$var$rotationMatrix.elements[6]*=s,$44a90fc8a2825c34$var$rotationMatrix.elements[7]*=s,$44a90fc8a2825c34$var$rotationMatrix.elements[8]*=s,this.rotation.multiply($44a90fc8a2825c34$var$rotationMatrix),this.halfSize.x*=i,this.halfSize.y*=r,this.halfSize.z*=n,$44a90fc8a2825c34$var$v1.setFromMatrixPosition(e),this.center.add($44a90fc8a2825c34$var$v1),this}}const $44a90fc8a2825c34$var$obb=new $44a90fc8a2825c34$export$f7a1f6dc3f8b082f;var $g4HAh=parcelRequire("g4HAh"),$7WCxl=parcelRequire("7WCxl"),$ia4Lh=parcelRequire("ia4Lh");class $d0f874000594cf7a$export$a955f3d6a39ce4b2{drawWallHelp(e,t,i=400){let r=this.createLineDimensionsLine(e,t,!0,i),n=this.createCircleDimensionsLine(e,t),o=Math.abs(e.x-t.x)<.1||Math.abs(e.x-t.y)<.1,a=Math.abs(e.y-t.x)<.1||Math.abs(e.y-t.y)<.1,s=new(0,$4xklQ.Group);return s.add(r),s.lineLength=r.lineLength,s.lineCenter=r.center,o||a?(s.realAngle="",s.arcCenter=""):(s.add(n[0]),s.add(n[1]),s.add(n[2]),s.add(n[3]),s.realAngle=n[0].realAngle,s.arcCenter=n[0].center),s}createSplitWallMesh(e,t){var i=[];e.forEach((function(e){i.push(e.x,e.y,0)}));var r=new $4xklQ.BufferGeometry;r.attributes.position=new $4xklQ.BufferAttribute(new Float32Array(i),3),r.index=new $4xklQ.BufferAttribute(new Uint16Array([0,1,2,2,1,3]),1);var n=new $4xklQ.Mesh(r,t);return n.renderOrder=2,n}createCurveHelp(e,t,i){let r=new(0,$4xklQ.Group),n=$523a84362d27c3e8$export$b680ca477a72be07.makeControlPoint(i);var o=(new(0,$4xklQ.BufferGeometry)).setFromPoints([e,i,t]),a=new(0,$4xklQ.Line)(o,new(0,$4xklQ.MeshBasicMaterial)({color:"#1E90FF",side:$4xklQ.DoubleSide,transparent:!0}));return r.add(n),r.add(a),r.useType="arcHelper",r.controlMesh=n,r}createLineDimensionsLine(e,t,i=!0,r=280,n="#000000",o=6){e=new(0,$4xklQ.Vector3)(e.x,e.y,0),t=new(0,$4xklQ.Vector3)(t.x,t.y,0);let a=(new(0,$4xklQ.Vector3)).subVectors(t,e),s=new(0,$4xklQ.Vector3)(-a.y,a.x,0);i&&(s=s.negate()),s.setLength(r);let l=e.clone().add(s),c=t.clone().add(s),h=new(0,$4xklQ.MeshBasicMaterial)({color:n,side:$4xklQ.DoubleSide,depthTest:!1,transparent:!0}),d=[l,c];d=this.createEndpoint(l,s).concat(d),d=d.concat(this.createEndpoint(c,s));let u=new(0,$4xklQ.Line)((new(0,$4xklQ.BufferGeometry)).setFromPoints(d),h);u.renderOrder=o;let p=new(0,$4xklQ.Vector3)((l.x+c.x)/2,(l.y+c.y)/2,0),m=Math.round(e.clone().distanceTo(t.clone()));return u.center=p,u.lineLength=m,u.startPoint=e,u.endPoint=t,u}createDimensionsLineForDoor(e,t,i,r=280){e=new(0,$4xklQ.Vector3)(e.x,e.y,0),t=new(0,$4xklQ.Vector3)(t.x,t.y,0);let n=(new(0,$4xklQ.Vector3)).subVectors(t,e),o=new(0,$4xklQ.Vector3)(-n.y,n.x,0).negate();o.setLength(r);let a=e.clone().add(o.setLength(r)),s=t.clone().add(o.setLength(r)),l=new(0,$4xklQ.MeshBasicMaterial)({color:"#000000",side:$4xklQ.DoubleSide,depthTest:!1,transparent:!0}),c=[a,s];c=this.createEndpoint(a,o,80).concat(c),c=c.concat(this.createEndpoint(s,o,80));let h=new(0,$4xklQ.Line)((new(0,$4xklQ.BufferGeometry)).setFromPoints(c),l);h.renderOrder=400;let d=new(0,$4xklQ.Vector3)((a.x+s.x)/2,(a.y+s.y)/2,0),u=Math.round(e.clone().distanceTo(t.clone()));return h.center=d,h.startPoint=e,h.endPoint=t,h.lineLength=u,h}createCircleLine(e,t,i,r=3){let n=$9HO6e.UtilCore.getMeshOtherPoint(t,e),o=t.startPoint.clone().distanceTo(t.endPoint.clone()),a=i.startPoint.clone().distanceTo(i.endPoint.clone()),s=o<a?o:a,l=n.clone().sub(e.clone()),c=$9HO6e.UtilCore.getMeshOtherPoint(i,e).clone().sub(e.clone()),h=$9HO6e.UtilCore.toVector3(l).angleTo($9HO6e.UtilCore.toVector3(c));h=Math.round(180/Math.PI*h);let d=$9HO6e.UtilCore.toVector2(l).angle(),u=$9HO6e.UtilCore.getMeshOtherPoint(i,e),p=u.clone().sub(e.clone()),m=$9HO6e.UtilCore.toVector2(p).angle(),f=$9HO6e.UtilCore.getClockWise(n,e,u);f=f>0;let g=new(0,$4xklQ.MeshBasicMaterial)({color:"#1C1C1C",side:$4xklQ.DoubleSide,transparent:!0}),x=new(0,$4xklQ.EllipseCurve)(e.x,e.y,s/r,s/r,d,m,f).getPoints(50),b=new(0,$4xklQ.Line)((new(0,$4xklQ.BufferGeometry)).setFromPoints(x),g),y=x[Math.round(x.length/2)];return b.renderOrder=6,b.realAngle=h+"°",b.center=new(0,$4xklQ.Vector3)(y.x,y.y,0),b}createCircleDimensionsLine(e,t,i=600){e=new(0,$4xklQ.Vector3)(e.x,e.y,0),t=new(0,$4xklQ.Vector3)(t.x,t.y,0);let r=e.distanceTo(t)+i,n=new(0,$4xklQ.Vector3)(1,0,0),o=(new(0,$4xklQ.Vector3)).subVectors(t,e).angleTo(n),a=!1,s=0,l=180/Math.PI*o,c=new(0,$4xklQ.LineDashedMaterial)({color:"#1C1C1C",dashSize:3,gapSize:3}),h=new(0,$4xklQ.MeshBasicMaterial)({color:"#1C1C1C",side:$4xklQ.DoubleSide,transparent:!0});e.x<t.x&&e.y>t.y&&(a=!0,o*=-1),e.x>t.x&&e.y<t.y&&(s=Math.PI,a=!0,l=180/Math.PI*(Math.PI-o)),e.x>t.x&&e.y>t.y&&(s=Math.PI,a=!1,l=180/Math.PI*(Math.PI-o),o*=-1);let d=new(0,$4xklQ.EllipseCurve)(e.x,e.y,r/10,r/10,s,o,a).getPoints(50),u=new(0,$4xklQ.Line)((new(0,$4xklQ.BufferGeometry)).setFromPoints(d),c);var p=new(0,$4xklQ.EllipseCurve)(e.x,e.y,r,r,s,o,a).getPoints(50);let m=new(0,$4xklQ.Line)((new(0,$4xklQ.BufferGeometry)).setFromPoints([e,p[0]]),c),f=new(0,$4xklQ.Line)((new(0,$4xklQ.BufferGeometry)).setFromPoints([e,p[p.length-1]]),c);m.computeLineDistances(),f.computeLineDistances();let g=(new(0,$4xklQ.Vector3)).subVectors(e.clone(),p[0].clone()),x=(new(0,$4xklQ.Vector3)).subVectors(e.clone(),p[p.length-1].clone());g.z=0,x.z=0,p=(p=this.createEndpoint(p[0],g).concat(p)).concat(this.createEndpoint(p[p.length-1],x));let b=new(0,$4xklQ.Line)((new(0,$4xklQ.BufferGeometry)).setFromPoints(p),h),y=p[Math.round(p.length/2)];return b.realAngle=Math.round(l)+"°",b.center=new(0,$4xklQ.Vector3)(y.x,y.y,0),[b,m,f,u]}createCircleAngleLine(e,t,i,r,n){let o=new(0,$4xklQ.MeshBasicMaterial)({color:"#1C1C1C",side:$4xklQ.DoubleSide,transparent:!0}),a=new(0,$4xklQ.EllipseCurve)(e.x,e.y,t/2,t/2,i,r,n).getPoints(50),s=new(0,$4xklQ.Line)((new(0,$4xklQ.BufferGeometry)).setFromPoints(a),o),l=a[Math.round(a.length/2)];return s.center=new(0,$4xklQ.Vector3)(l.x,l.y,0),s}createEndpoint(e,t,i=100){let r=t.clone().setLength(i),n=t.clone().negate().setLength(i),o=r.clone().applyAxisAngle(new $4xklQ.Vector3(0,0,1),70),a=o.clone().negate().setLength(i),s=e.clone().add(r),l=e.clone().add(n),c=e.clone().add(o),h=e.clone().add(a);return[s,l,e,c,h]}createPoint(e,t="",i=80){let r=new(0,$4xklQ.Group);""==t&&(t=e);var n=new(0,$4xklQ.CircleGeometry)(i/3,32),o=new(0,$4xklQ.MeshBasicMaterial)({color:"#363636",transparent:!0}),a=new(0,$4xklQ.CircleGeometry)(i,32),s=new(0,$4xklQ.MeshBasicMaterial)({color:"#FFFF00",depthTest:!1,transparent:!0}),l=new(0,$4xklQ.Mesh)(n,o),c=new(0,$4xklQ.Mesh)(a,s);return l.position.set(e.x,e.y,10),c.position.set(e.x,e.y,10),l.renderOrder=5,c.renderOrder=4,r.add(l),r.add(c),r.center=t,l.useType="dragPoint",c.useType="dragPoint",r.radio=i,r}createDragPoint(e,t="",i=80){let r=new(0,$4xklQ.Group);""==t&&(t=e);var n=new(0,$4xklQ.CircleGeometry)(i,32),o=new(0,$4xklQ.MeshBasicMaterial)({color:"#ffffff",transparent:!0,opacity:.4}),a=new(0,$4xklQ.Mesh)(n,o);return a.position.set(e.x,e.y,10),a.renderOrder=6,r.add(a),r.center=t,r.radio=i,a.useType="dragPoint",r}createScaleToolPoint(e,t,i=60){var r=new(0,$4xklQ.CircleGeometry)(i,32),n=new(0,$4xklQ.MeshBasicMaterial)({color:"rgb(f,f,f)",depthTest:!1,transparent:!0,opacity:.8,side:$4xklQ.DoubleSide}),o=new(0,$4xklQ.Mesh)(r,n);return o.position.set(e.x,e.y,10),o.renderOrder=100,o.useType="movePoint",o.positionType=t,o.positionCenter=e,o}createDoorPoint(e,t,i=60){var r=new(0,$4xklQ.CircleGeometry)(i,32),n=new(0,$4xklQ.MeshBasicMaterial)({color:"rgb(62, 130, 247)",depthTest:!1,transparent:!0,opacity:.8}),o=new(0,$4xklQ.Mesh)(r,n);return o.position.set(e.x,e.y,10),o.renderOrder=6,o.useType="movePoint",o.positionType=t,o.positionCenter=e,o}createNormalPoint(e,t=60){var i=new(0,$4xklQ.CircleGeometry)(t,32),r=new(0,$4xklQ.MeshBasicMaterial)({color:"#FFFF00",depthTest:!1,transparent:!0,opacity:.8}),n=new(0,$4xklQ.Mesh)(i,r);return n.position.set(e.x,e.y,10),n.renderOrder=6,n}createDoorOuterPoint(e,t=100,i="rgb(255, 255, 255)",r=0){var n=new(0,$4xklQ.CircleGeometry)(t,32),o=new(0,$4xklQ.MeshBasicMaterial)({color:i,depthTest:!1,transparent:!0}),a=new(0,$4xklQ.Mesh)(n,o);return a.position.set(e.x,e.y,r),a.renderOrder=5,a.useType="moveOuterPoint",a.positionCenter=e,a}createHelperForMumber(e,t=60){let i="";e.children.forEach((e=>{"Mesh"!=e.type||(i=e)})),e.modelType&&e.modelType.indexOf("Model")>=0&&(i=e);let r=this.addScaleTool(i),n=0;return n=e.rotation.z,[r,this.addAngleTool(i,1500,n-Math.PI/8,n+Math.PI/8)]}addAngleTool(e,t,i,r,n="rgb(153,193,244)"){let o=this.getMeshCenter(e),a=this.makeRotateToolGem(o,i,r,t,n,100,!0);return a.currentModel=e,a}getMeshCenter(e){let t=new(0,$4xklQ.Vector3);return e.updateWorldMatrix(),e.getWorldPosition(t),t}addBoxFor2dModel(e,t=window.editor.config.boxLineColor,i="line"){let r=[e[0],e[1],e[2],e[3],e[0]],n=[];r.forEach((e=>{n.push(e.x,e.y,e.z)}));var o=(new(0,$g4HAh.LineGeometry)).setPositions(n),a=new(0,$7WCxl.LineMaterial)({color:t,linewidth:window.editor.config.boxLineWidth,side:$4xklQ.DoubleSide});"line"!=i&&(a=new(0,$7WCxl.LineMaterial)({color:0,dashScale:20,side:$4xklQ.DoubleSide,dashed:!0})),a.resolution.set(window.innerWidth,window.innerHeight);var s=new(0,$ia4Lh.Line2)(o,a);return s.computeLineDistances(),s.renderOrder=100,s}addScaleTool(e,t=60){let i=this.getModelVertex(e),r=new(0,$4xklQ.Group);for(let e=0;e<i.length;e++){var n=new(0,$4xklQ.CircleGeometry)(t,32),o=new(0,$4xklQ.MeshBasicMaterial)({color:"rgb(26, 122, 251)",depthTest:!1,transparent:!0,opacity:.8}),a=new $4xklQ.Mesh(n,o);a.position.set(i[e].x,i[e].y,10),a.renderOrder=10,a.useType="scalePoint",a.arcCenter=new(0,$4xklQ.Vector3)(i[e].x,i[e].y,0),0==e&&(a.scaleDir="-XY",a.linePoint=[i[0],i[2]]),2==e&&(a.scaleDir="X-Y",a.linePoint=[i[0],i[2]]),1==e&&(a.scaleDir="-X-Y",a.linePoint=[i[1],i[3]]),3==e&&(a.scaleDir="XY",a.linePoint=[i[1],i[3]]),4==e&&(a.scaleDir="-X",a.linePoint=[i[4],i[7]]),7==e&&(a.scaleDir="X",a.linePoint=[i[4],i[7]]),5==e&&(a.scaleDir="-Y",a.linePoint=[i[5],i[6]]),6==e&&(a.scaleDir="Y",a.linePoint=[i[5],i[6]]),r.add(a)}"2dModelGroup"==e.modelType&&(r=new(0,$4xklQ.Group)),r.useType="scaleTool",r.currentModel=e;let s=this.addBoxFor2dModel(i);return r.add(s),r}getWorldRotation(e){return null===e?new(0,$4xklQ.Vector3):(t=e.rotation,i=this.getWorldRotation(e.parent),new(0,$4xklQ.Vector3)(t.x+i.x,t.y+i.y,t.z+i.z));var t,i}addOBB2DBox(e,t=window.editor.config.boxLineColor){let i=1e3*e.width/2,r=1e3*e.depth/2,n=new(0,$4xklQ.Vector3)(-i,r,0),o=new(0,$4xklQ.Vector3)(-i,-r,0),a=new(0,$4xklQ.Vector3)(i,-r,0),s=new(0,$4xklQ.Vector3)(i,r,0),l=e.position.clone(),c=e.rot,h=this.addBoxFor2dModel([n,o,a,s,n],t);return l.x*=1e3,l.y=-1e3*l.z,l.z=.1,h.rotation.set(c.x,0,c.y),h.position.set(l.x,l.y,l.z),h}addOBBbox(e,t=window.editor.config.boxLineColor){var i="";if("Mesh"==e.type&&"pillars"!=e.modeType&&"beam"!=e.modeType&&e.parent&&"3dwall"!=e.parent.name){const r=new $4xklQ.EdgesGeometry(e.geometry,4);(i=new $4xklQ.LineSegments(r,new(0,$4xklQ.LineBasicMaterial)({color:t}))).position.set(e.position.x,e.position.z,-e.position.y),i.rotation.x=-Math.PI/2,i.rotation.z=e.rotation.z,i.scale.copy(e.scale);let n=(new(0,$4xklQ.Matrix4)).makeScale(.001,.001,.001);i.applyMatrix4(n)}else{let r=e.rotation.x,n=e.rotation.y,o=e.rotation.z,a=this.getWorldRotation(e);e.rotation.set(0,0,0);let s=new(0,$4xklQ.Vector3);e.updateWorldMatrix(!0),e.getWorldPosition(s);let l=new(0,$4xklQ.Box3),c=new $44a90fc8a2825c34$export$f7a1f6dc3f8b082f;const h=l.setFromObject(e);e.rotation.set(r,n,o);let d=c.fromBox3(h),u=2*d.halfSize.x,p=2*d.halfSize.y,m=2*d.halfSize.z;if("CodeModel"!=e.modelType){let t=e.clone(),i=(new(0,$4xklQ.Vector3)).setFromMatrixScale(e.matrixWorld);t.scale.copy(i),t.rotation.set(0,0,0);const r=l.setFromObject(t);let n=c.fromBox3(r);u=2*n.halfSize.x,p=2*n.halfSize.y,m=2*n.halfSize.z}if((i=this.obbBoxMain(u,p,m,t)).position.set(s.x,s.y+.01,s.z),"CodeModel"==e.modelType){if(i.rotation.set(r,o,Math.PI-n),i.position.y=e.position.z/1e3+.01,"PanoramicWindowMesh"==e.type){let t=new(0,$4xklQ.Vector3)(0,1,0);t.applyEuler(new(0,$4xklQ.Euler)(e.rotation.x,0,0,"XYZ")),t.applyEuler(new(0,$4xklQ.Euler)(0,e.rotation.y,0,"XYZ")),t.applyEuler(new(0,$4xklQ.Euler)(0,0,e.rotation.z,"XYZ")),t.setLength(-m/4),i.position.add(t)}}else i.rotation.set(a.x,a.y,a.z);i.width=u,i.height=p,i.depth=m,i.rot=a}return i}addOBBDotBox(e,t=window.editor.config.boxLineColor){let i=e.rotation.x,r=e.rotation.y,n=e.rotation.z;e.rotation.set(0,0,0);const o=(new(0,$4xklQ.Box3)).setFromObject(e);e.rotation.set(i,r,n);let a=(new $44a90fc8a2825c34$export$f7a1f6dc3f8b082f).fromBox3(o),s=this.obbBoxMain(2.5*a.halfSize.x,2.5*a.halfSize.y,2.5*a.halfSize.z,t,"dash");return s.position.set(a.center.x,a.center.y+.01,a.center.z),s.rotation.set(i,r,n),s}obbBoxMain(e,t,i,r=window.editor.config.boxLineColor,n="line"){let o=new(0,$4xklQ.Vector3)(e/2,-t/2,-i/2),a=new(0,$4xklQ.Vector3)(e/2,-t/2,i/2),s=new(0,$4xklQ.Vector3)(-e/2,-t/2,i/2),l=new(0,$4xklQ.Vector3)(-e/2,-t/2,-i/2),c=new(0,$4xklQ.Vector3)(e/2,t/2,-i/2),h=new(0,$4xklQ.Vector3)(e/2,t/2,i/2),d=new(0,$4xklQ.Vector3)(-e/2,t/2,i/2),u=new(0,$4xklQ.Vector3)(-e/2,t/2,-i/2),p=[];[o,a,s,l,o,c,h,a,h,d,s,d,u,l,u,c].forEach((e=>{p.push(e.x,e.y,e.z)}));var m=(new(0,$g4HAh.LineGeometry)).setPositions(p),f=new(0,$7WCxl.LineMaterial)({color:r,linewidth:window.editor.config.boxLineWidth,side:$4xklQ.DoubleSide});"line"!=n&&(f=new(0,$7WCxl.LineMaterial)({color:0,dashScale:20,side:$4xklQ.DoubleSide,dashed:!0})),f.resolution.set(window.innerWidth,window.innerHeight);var g=new(0,$ia4Lh.Line2)(m,f);return g.computeLineDistances(),g.renderOrder=100,g}addRotateTool(e,t=1500){let i=0,r=0,n=new $4xklQ.Group,o=this.getMeshCenter(e);for(;i<8;){let e=this.makeRotateToolGem(o,r+Math.PI/180,2*Math.PI/8*(i+1),t,"#6495ED",100);r=2*Math.PI/8*(i+1),i++,n.add(e)}return n.useType="rotateClock",n.arcCenter=o,n.arcRadio=t,n}makeRotateToolGem(e,t,i,r,n,o,a=!1){let s=$0f7bfe5028a81ceb$export$18d19c7a3aa33064({thickness:140});var l=new $4xklQ.EllipseCurve(e.x,e.y,r,r,t,i,!1,0).getPoints(50),c=[];l.forEach((function(e){c.push([e.x,e.y])}));var h=s.build(c);h=this.process(c,h);var d=[];h.positions.forEach((function(e){d.push(e[0],e[1],0)}));var u=[];h.cells.forEach((function(e){u.push(e[0],e[1],e[2])}));var p=new $4xklQ.BufferGeometry;p.attributes.position=new $4xklQ.BufferAttribute(new Float32Array(d),3),p.index=new $4xklQ.BufferAttribute(new Uint16Array(u),1);var m=new $4xklQ.MeshBasicMaterial({color:n,side:$4xklQ.DoubleSide,depthTest:!1,transparent:!0,opacity:1});(h=new $4xklQ.Mesh(p,m)).position.z=20,h.renderOrder=99;let f=new $4xklQ.Group;if(f.add(h),a){h.useType="rotateTool",f.useType="rotateTool";var g=new $4xklQ.Vector3(c[0][0],c[0][1],0),x=new $4xklQ.Vector3(c[1][0],c[1][1],0);let e=g.clone().sub(x.clone());e.normalize();var b=new $4xklQ.ArrowHelper(e,g,200,n,2.5*o,2.5*o),y=new $4xklQ.Vector3(c[c.length-1][0],c[c.length-1][1],0),w=new $4xklQ.Vector3(c[c.length-2][0],c[c.length-2][1],0);let t=y.clone().sub(w.clone());t.normalize();var v=new $4xklQ.ArrowHelper(t,y,200,n,2.5*o,2.5*o);b.position.z=10,v.position.z=10,f.add(b),f.add(v)}return f.startAngle=t,f.endAngle=i,f.arcCenter=e,f.arcRadio=r,f}process(e,t,i=[]){return t.innner=[],t.outter=[],e.forEach((function(e){i.push(new $4xklQ.Vector2(e[0],e[1]))})),t.clock=$b590b02110506a77$export$96bdf6d9c66d7ba8.isClockWise(i),t.positions.forEach((function(e,i){i%2==0?t.clock?t.innner.push(e):t.outter.push(e):t.clock?t.outter.push(e):t.innner.push(e)})),t}getModelVertex(e,t=1){let i=e.parent;e.modelType&&e.modelType.indexOf("Model")>=0&&(i=e),i.updateWorldMatrix(!0,!0);let r=i.clone();r.scale.set(1,1,1),r.rotation.set(0,0,0);const n=(new(0,$4xklQ.Box3)).setFromObject(r);let o=(new $44a90fc8a2825c34$export$f7a1f6dc3f8b082f).fromBox3(n),a=1*o.halfSize.x.toFixed(2)*t,s=1*o.halfSize.y.toFixed(2)*t;i.width&&(a=1*i.width/2*t,s=1*i.height/2*t),i.realWidth&&(a=1*i.realWidth/2);let l=[new(0,$4xklQ.Vector3)(-a,s,0),new(0,$4xklQ.Vector3)(-a,-s,0),new(0,$4xklQ.Vector3)(a,-s,0),new(0,$4xklQ.Vector3)(a,s,0),new(0,$4xklQ.Vector3)(-a,0,0),new(0,$4xklQ.Vector3)(0,-s,0),new(0,$4xklQ.Vector3)(0,s,0),new(0,$4xklQ.Vector3)(a,0,0)],c=e.parent;e.modelType&&e.modelType.indexOf("Model")>=0&&(c=e),c.updateWorldMatrix(!0,!1);for(let e=0;e<l.length;e++){let t=c.localToWorld(l[e]);t.z=.1,l[e]=t}return l}}var $5XTH3=parcelRequire("5XTH3");function $2176137edde06fbe$export$fee71b7b1f0877fa(e,t){let i=[];for(;e.length>0;){let t=$2176137edde06fbe$var$reduceWalk($2176137edde06fbe$var$closedWalkFrom($2176137edde06fbe$var$leftBottomVertex(e)));t.length>2&&i.push(t),$2176137edde06fbe$var$removeEdge(t[0],t[1]),e=$2176137edde06fbe$var$removeFilamentAt(t[0],e),e=$2176137edde06fbe$var$removeFilamentAt(t[1],e)}return i}function $2176137edde06fbe$var$leftBottomVertex(e){return e.reduce(((e,t)=>{let i=t.x-e.x;return i<0?t:i>0||t.y-e.y<0?e:t}))}function $2176137edde06fbe$var$closedWalkFrom(e){let t,i=[],r=e;do{i.push(r),[r,t]=$2176137edde06fbe$var$getNext(r,t)}while(r!==e);return i}function $2176137edde06fbe$var$reduceWalk(e){for(let t=1;t<e.length;t++){let i=e.lastIndexOf(e[t]);i>t&&e.splice(t+1,i-t)}return e}function $2176137edde06fbe$var$withoutVertex(e,t){return t.filter((t=>t!==e))}function $2176137edde06fbe$var$removeEdge(e,t){e.adj=$2176137edde06fbe$var$withoutVertex(t,e.adj),t.adj=$2176137edde06fbe$var$withoutVertex(e,t.adj)}function $2176137edde06fbe$var$removeFilamentAt(e,t){let i,r=e;for(;r&&r.adj.length<2;)t=$2176137edde06fbe$var$withoutVertex(r,t),i=r.adj[0],i&&$2176137edde06fbe$var$removeEdge(r,i),r=i;return t}function $2176137edde06fbe$var$getNext(e,t){return[1==e.adj.length?e.adj[0]:$2176137edde06fbe$var$best_by_kind(t,e,t?"ccw":"cw"),e]}function $2176137edde06fbe$var$best_by_kind(e,t,i){let r,n=t.adj;return e?(r=$2176137edde06fbe$var$vsub(t,e),n=$2176137edde06fbe$var$withoutVertex(e,n)):r={x:0,y:-1},n.reduce(((e,n)=>$2176137edde06fbe$var$better_by_kind(n,e,t,r,i)))}function $2176137edde06fbe$var$better_by_kind(e,t,i,r,n){let o,a=$2176137edde06fbe$var$vsub(e,i),s=$2176137edde06fbe$var$vsub(t,i),l=$2176137edde06fbe$var$dot_perp(s,r)>0,c=$2176137edde06fbe$var$dot_perp(r,a),h=$2176137edde06fbe$var$dot_perp(s,a);return o="cw"==n?l&&(c>=0||h>=0)||!l&&c>=0&&h>=0:!l&&(c<0||h<0)||l&&c<0&&h<0,o?e:t}function $2176137edde06fbe$var$vsub(e,t){return{x:e.x-t.x,y:e.y-t.y}}function $2176137edde06fbe$var$dot_perp(e,t){return e.x*t.y-t.x*e.y}var $4xklQ=parcelRequire("4xklQ"),$5XTH3=parcelRequire("5XTH3"),$9QhXH=parcelRequire("9QhXH");function $9725c2b30524cf65$export$f89346e4832a4893(e,t,i,r){var n=e[0],o=e[1],a=!1;void 0===i&&(i=0),void 0===r&&(r=t.length);for(var s=(r-i)/2,l=0,c=s-1;l<s;c=l++){var h=t[i+2*l+0],d=t[i+2*l+1],u=t[i+2*c+0],p=t[i+2*c+1];d>o!=p>o&&n<(u-h)*(o-d)/(p-d)+h&&(a=!a)}return a}function $c356862cd9aed4c4$export$7370663eeb73660e(e,t,i,r){var n=e[0],o=e[1],a=!1;void 0===i&&(i=0),void 0===r&&(r=t.length);for(var s=r-i,l=0,c=s-1;l<s;c=l++){var h=t[l+i][0],d=t[l+i][1],u=t[c+i][0],p=t[c+i][1];d>o!=p>o&&n<(u-h)*(o-d)/(p-d)+h&&(a=!a)}return a}function $a59c92c620a56c0f$export$7f6bc8d3d7d61b11(e,t,i,r){return t.length>0&&Array.isArray(t[0])?$c356862cd9aed4c4$export$7370663eeb73660e(e,t,i,r):$9725c2b30524cf65$export$f89346e4832a4893(e,t,i,r)}var $hrM0U=parcelRequire("hrM0U"),$4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ"),$hrM0U=parcelRequire("hrM0U");class $d5e8224393d3fc4b$export$d78f121d8d1152c5{constructor(e=[],t=$d5e8224393d3fc4b$var$defaultCompare){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:i}=this,r=t[e];for(;e>0;){const n=e-1>>1,o=t[n];if(i(r,o)>=0)break;t[e]=o,e=n}t[e]=r}_down(e){const{data:t,compare:i}=this,r=this.length>>1,n=t[e];for(;e<r;){let r=1+(e<<1),o=t[r];const a=r+1;if(a<this.length&&i(t[a],o)<0&&(r=a,o=t[a]),i(o,n)>=0)break;t[e]=o,e=r}t[e]=n}}function $d5e8224393d3fc4b$var$defaultCompare(e,t){return e<t?-1:e>t?1:0}var $b6efaaece0bcc309$var$Queue=$d5e8224393d3fc4b$export$d78f121d8d1152c5;function $b6efaaece0bcc309$export$a1687b1810059e02(e,t,i){var r,n,o,a;t=t||1;for(var s=0;s<e[0].length;s++){var l=e[0][s];(!s||l[0]<r)&&(r=l[0]),(!s||l[1]<n)&&(n=l[1]),(!s||l[0]>o)&&(o=l[0]),(!s||l[1]>a)&&(a=l[1])}var c=o-r,h=a-n,d=Math.min(c,h),u=d/2;if(0===d){var p=[r,n];return p.distance=0,p}for(var m=new $b6efaaece0bcc309$var$Queue(void 0,$b6efaaece0bcc309$var$compareMax),f=r;f<o;f+=d)for(var g=n;g<a;g+=d)m.push(new $b6efaaece0bcc309$var$Cell(f+u,g+u,u,e));var x=$b6efaaece0bcc309$var$getCentroidCell(e),b=new $b6efaaece0bcc309$var$Cell(r+c/2,n+h/2,0,e);b.d>x.d&&(x=b);for(var y=m.length;m.length;){var w=m.pop();w.d>x.d&&(x=w,i&&console.log("found best %d after %d probes",Math.round(1e4*w.d)/1e4,y)),w.max-x.d<=t||(u=w.h/2,m.push(new $b6efaaece0bcc309$var$Cell(w.x-u,w.y-u,u,e)),m.push(new $b6efaaece0bcc309$var$Cell(w.x+u,w.y-u,u,e)),m.push(new $b6efaaece0bcc309$var$Cell(w.x-u,w.y+u,u,e)),m.push(new $b6efaaece0bcc309$var$Cell(w.x+u,w.y+u,u,e)),y+=4)}i&&(console.log("num probes: "+y),console.log("best distance: "+x.d));var v=[x.x,x.y];return v.distance=x.d,v}function $b6efaaece0bcc309$var$compareMax(e,t){return t.max-e.max}function $b6efaaece0bcc309$var$Cell(e,t,i,r){this.x=e,this.y=t,this.h=i,this.d=$b6efaaece0bcc309$var$pointToPolygonDist(e,t,r),this.max=this.d+this.h*Math.SQRT2}function $b6efaaece0bcc309$var$pointToPolygonDist(e,t,i){for(var r=!1,n=1/0,o=0;o<i.length;o++)for(var a=i[o],s=0,l=a.length,c=l-1;s<l;c=s++){var h=a[s],d=a[c];h[1]>t!=d[1]>t&&e<(d[0]-h[0])*(t-h[1])/(d[1]-h[1])+h[0]&&(r=!r),n=Math.min(n,$b6efaaece0bcc309$var$getSegDistSq(e,t,h,d))}return 0===n?0:(r?1:-1)*Math.sqrt(n)}function $b6efaaece0bcc309$var$getCentroidCell(e){for(var t=0,i=0,r=0,n=e[0],o=0,a=n.length,s=a-1;o<a;s=o++){var l=n[o],c=n[s],h=l[0]*c[1]-c[0]*l[1];i+=(l[0]+c[0])*h,r+=(l[1]+c[1])*h,t+=3*h}return 0===t?new $b6efaaece0bcc309$var$Cell(n[0][0],n[0][1],0,e):new $b6efaaece0bcc309$var$Cell(i/t,r/t,0,e)}function $b6efaaece0bcc309$var$getSegDistSq(e,t,i,r){var n=i[0],o=i[1],a=r[0]-n,s=r[1]-o;if(0!==a||0!==s){var l=((e-n)*a+(t-o)*s)/(a*a+s*s);l>1?(n=r[0],o=r[1]):l>0&&(n+=a*l,o+=s*l)}return(a=e-n)*a+(s=t-o)*s}$b6efaaece0bcc309$var$Queue.default&&($b6efaaece0bcc309$var$Queue=$b6efaaece0bcc309$var$Queue.default);class $38a97d266629f9dd$export$525628e68e798fb4 extends $4xklQ.Mesh{constructor(e,t){super(e,t),this.useType="room",this.parameter={}}initParams(e=[]){this.computeVertices(),this.computeArea(),this.computeCenter(),this.computeWalls(e)}setName(e){this.parameter.name=e}getName(){return this.parameter.name}computeVertices(){let e=Array.from(this.geometry.attributes.position.array);this.parameter.points=[];for(let t=0;t<e.length;t+=3)this.parameter.points.push(new(0,$4xklQ.Vector2)($hrM0U.CommonFunc.keepDecimalRound(e[t],2),$hrM0U.CommonFunc.keepDecimalRound(e[t+1],2)))}computeArea(){this.parameter.area=Math.abs($b590b02110506a77$export$96bdf6d9c66d7ba8.area(this.parameter.points)/1e6),this.parameter.area=$hrM0U.CommonFunc.keepDecimalRound(this.parameter.area,2)}computeCenter(){let e=[];this.parameter.points.forEach((t=>{e.push($hrM0U.CommonFunc.vectorTransformToArray(t,2))})),this.parameter.center=$b6efaaece0bcc309$export$a1687b1810059e02([e],1)}computeWalls(e){this.parameter.walls=[];for(let t=0;t<this.parameter.points.length;t++){let i=t==this.parameter.points.length-1?0:t+1;e.forEach((e=>{this.vecIsIn(this.parameter.points[t],this.parameter.points[i],e.parameter.points)&&this.parameter.walls.push(e)}))}}vecIsIn(e,t,i){let r=!1,n=!1;for(let o=0;o<i.length;o++)e.equals(i[o])&&(r=!0),t.equals(i[o])&&(n=!0);return r&&n}updateVertex(){}}parcelRequire("jDRRp");var $4xklQ=parcelRequire("4xklQ"),$hrM0U=parcelRequire("hrM0U");class $b918a4521263ae88$export$d9d93634284e4ef0 extends $4xklQ.Mesh{constructor(e,t){super(e,t),this.type="FlueMesh"}hollow(){let e=this.geometry.clone();e.scale(.618,.618,1);let t=new(0,$4xklQ.Mesh)(e,this.material),i=$hrM0U.CommonFunc.boolean(this,t);this.geometry=i.geometry}}class $5c31b6cd7f4237f1$export$4880b0ae5643c62b{constructor(e,t){this.wallList=e,this.editor=t,this.texture=this.editor.config.floorTexture,this.texture.wrapS=$4xklQ.RepeatWrapping,this.texture.wrapT=$4xklQ.RepeatWrapping,this.beamMaterial=new $4xklQ.MeshStandardMaterial({color:10394523,side:$4xklQ.DoubleSide}),this.pillarsMaterial=new $4xklQ.MeshStandardMaterial({color:10394523,side:$4xklQ.DoubleSide})}getFloorOld(){let e=this.getAllVertex(),t=this.getIndexArr(e),i=this.transformVertex(e);if(this.transformAdj(t,i),i.length<3)return[];$2176137edde06fbe$export$fee71b7b1f0877fa(i);let r=[];return this.getAllLines(e,r),r}getFloor2D(e="2D"){let t=[],i=this.preLoad();var r=MiniCycles.getResult(i.newVertices,i.allIndex);0==r.length&&console.log("is planar cycle",MiniCycles.is_planar(i.newVertices,i.allIndex));let n=this.getWallIndexes(i.wallPoints,i.allVertices,i.change);return this.removeWallCycle(r,n).forEach((r=>{let n=[];r.forEach((e=>{n.push(new $4xklQ.Vector3(i.allVertices[e][0],i.allVertices[e][1],20))}));let o="2D"==e?this.createMesh(n):this.createFloor3D(n);o.useType="floor",t.push(o)})),t}createFloor3D(e){return $hrM0U.CommonFunc.createFloor3D(e,this.texture)}preLoad(){let e=[],t=this.getAllPoints(e),i=this.getAllIndex(t),r=0,n=0;t.forEach((e=>{e[0]<r&&(r=e[0]),e[1]<n&&(n=e[1])}));let o=[];t.forEach((e=>{o.push([e[0]+Math.abs(r),e[1]+Math.abs(n)])}));let a=[];for(let e=0;e<o.length;e++){let t=[];i.forEach((i=>{i.includes(e)&&t.push(i)}));for(let e=0;e<t.length-1;e++){let i=$hrM0U.CommonFunc.getLineEquation(o[t[e][0]],o[t[e][1]]);for(let r=e+1;r<t.length;r++){let n=$hrM0U.CommonFunc.getLineEquation(o[t[r][0]],o[t[r][1]]),s=$hrM0U.CommonFunc.getIntersectPoint(i,n),l=[...t[e],...t[r]],c=!0;a.forEach((e=>{$hrM0U.CommonFunc.isEqualArray(e,l)&&(c=!1)})),"whole"==s&&c&&a.push(l)}}}let s=[];return a.forEach((e=>{let t,i,r,n,a,l,c,h;e.forEach((n=>{e.indexOf(n)!=e.lastIndexOf(n)?t=n:i||0==i?r=n:i=n})),h=o[i][0]==o[r][0]?1:0,n=Math.min(o[i][h],o[t][h],o[r][h]),a=Math.max(o[i][h],o[t][h],o[r][h]),o[i][h]<a&&o[i][h]>n&&(l=i,c=r),o[r][h]<a&&o[r][h]>n&&(l=r,c=i),n!=o[t][h]&&a!=o[t][h]||s.push([[t,c],l])})),s.forEach((e=>{i.forEach(((t,r)=>{$hrM0U.CommonFunc.isEqualArray(t,e[0])&&(i[r][i[r].indexOf(e[0][0])]=e[1])}))})),{allVertices:t,newVertices:o,allIndex:i,change:s,wallPoints:e}}getWallIndexes(e,t,i){let r=[];return e.forEach((e=>{let n=this.transToIndex(e,t);for(let e=0;e<n.length;e++){let t=e==n.length-1?0:e+1;i.forEach((i=>{(i[0][0]==n[e]&&i[0][1]==n[t]||i[0][0]==n[t]&&i[0][1]==n[e])&&n.push(i[1])}))}r.push(n)})),r}removeWallCycle(e,t){let i=[];return e.forEach((e=>{if(e.pop(),0==e.length)return;let r=!0;t.forEach((t=>{$hrM0U.CommonFunc.isEqualArray(e,t)&&(r=!1)})),r&&i.push(e)})),i}getFloor(e=!1,t=!1,i="2D"){window.performance.now();let r=[];this.editor;if(!e||!t){let e=this.getFloor2D(i);window.performance.now();return e}return this.getVertexAdjByEdges(e,t,r),r}getMiniCycleTree(e,t){e.forEach((e=>{0==e.children.length?t.push(e.cycle):this.getMiniCycleTree(e.children,t)}))}getAllPoints(e){let t=[];return this.wallList.forEach((i=>{let r=Array.from(i.geometry.attributes.position.array),n=[];for(let e=0;e<r.length/3;e++)e%3==1&&1!=e&&e!=r.length/3-2||n.push([r[3*e],r[3*e+1]]),t.push([r[3*e],r[3*e+1]]);e.push(n)})),this.filterArray(t)}getAllIndex(e){let t=[],i=[];return this.wallList.forEach((e=>{let t=Array.from(e.geometry.attributes.position.array),r=[];for(let e=0;e<t.length/3/3;e++)0==r.length||e==t.length/3/3-1?(e==t.length/3/3-1&&i.push([r[0],[t[9*e],t[9*e+1]]],[r[2],[t[3*(3*e+2)],t[3*(3*e+2)+1]]]),i.push([[t[9*e],t[9*e+1]],[t[3*(3*e+1)],t[3*(3*e+1)+1]]],[[t[3*(3*e+1)],t[3*(3*e+1)+1]],[t[3*(3*e+2)],t[3*(3*e+2)+1]]])):i.push([r[0],[t[9*e],t[9*e+1]]],[r[2],[t[3*(3*e+2)],t[3*(3*e+2)+1]]]),r=[[t[9*e],t[9*e+1]],[t[3*(3*e+1)],t[3*(3*e+1)+1]],[t[3*(3*e+2)],t[3*(3*e+2)+1]]]})),i.forEach((i=>{t.push([this.getIndex(e,i[0]),this.getIndex(e,i[1])])})),this.filterArray(t)}createCircle(e){let t=new $4xklQ.SphereGeometry(50),i=new $4xklQ.Mesh(t,new $4xklQ.MeshBasicMaterial({color:16711680}));return i.position.copy(e),i}transToIndex(e,t){let i=[];return e.forEach((e=>{i.push(this.getIndex(t,e))})),i}transformVertex(e){let t=[];return e.forEach((function(e){t.push({x:e[0],y:e[1],adj:[]})})),t}transformAdj(e,t){e.forEach((function(e){let i=t[e[0]],r=t[e[1]];i.adj.push(r),r.adj.push(i)}))}getAllLines(e,t){let i=Array(e.length).fill(0);this.wallList.forEach((t=>{let r=[t.startPoint.x,t.startPoint.y],n=[t.endPoint.x,t.endPoint.y];i[this.getIndex(e,r)]++,i[this.getIndex(e,n)]++}));let r=[],n=this.getAllVertices(r),o=[];this.wallList.forEach((t=>{let r=Array.from(t.geometry.attributes.position.array);if(18==r.length){let a=[r[0],r[1]],s=[r[9],r[10]],l=[r[6],r[7]],c=[r[15],r[16]];o.push([this.getIndex(n,a),this.getIndex(n,s)],[this.getIndex(n,l),this.getIndex(n,c)]),1==i[this.getIndex(e,[t.startPoint.x,t.startPoint.y])]&&o.push([this.getIndex(n,a),this.getIndex(n,l)]),1==i[this.getIndex(e,[t.endPoint.x,t.endPoint.y])]&&o.push([this.getIndex(n,s),this.getIndex(n,c)])}else{for(let e=0;e<r.length/9-1;e++){let t=[r[9*e],r[9*e+1]],i=[r[9*(e+1)],r[9*(e+1)+1]],a=[r[3*(3*e+2)],r[3*(3*e+2)+1]],s=[r[3*(3*(e+1)+2)],r[3*(3*(e+1)+2)+1]];o.push([this.getIndex(n,t),this.getIndex(n,i)],[this.getIndex(n,a),this.getIndex(n,s)])}if(1==i[this.getIndex(e,[t.startPoint.x,t.startPoint.y])]){let e=[r[0],r[1]],t=[r[6],r[7]];o.push([this.getIndex(n,e),this.getIndex(n,t)])}if(1==i[this.getIndex(e,[t.endPoint.x,t.endPoint.y])]){let e=[r[r.length-3],r[r.length-2]],t=[r[r.length-9],r[r.length-8]];o.push([this.getIndex(n,e),this.getIndex(n,t)])}}}));let a=this.transformVertex(n);this.transformAdj(o,a);let s=$2176137edde06fbe$export$fee71b7b1f0877fa(a),l=[];s.forEach((e=>{let t=[];e.forEach((e=>{t.push(e.x,e.y)})),l.push(t)}));let c=this.getRoom(l,t);c=this.deleteWallCircle(c,r),c.forEach((e=>{let i=[];for(let t=0;t<e.length/2;t++)i.push(new $4xklQ.Vector2(e[2*t],e[2*t+1]));let r=this.createMesh(i);r.useType="floor",t.push(r)}))}getVertexAdjByEdges(e,t,i){let r=[];e.forEach((e=>{let t=[e[0],e[1]],i=[e[2],e[3]];r.push(t,i)})),r=this.filterArray(r);let n=[];e.forEach((e=>{let t=[e[0],e[1]],i=[e[2],e[3]];new $4xklQ.Vector2(e[0],e[1]),new $4xklQ.Vector2(e[2],e[3]);n.push([this.getIndex(r,t),this.getIndex(r,i)])}));let o=this.transformVertex(r);this.transformAdj(n,o);let a=$2176137edde06fbe$export$fee71b7b1f0877fa(o),s=[];a.forEach((e=>{let t=[];e.forEach((e=>{t.push(e.x,e.y)})),s.push(t)}));let l=this.getRoom(s,i);l=this.deleteWallCircle(l,t),l.forEach((e=>{let t=[];for(let i=0;i<e.length/2;i++)t.push(new $4xklQ.Vector2(e[2*i],e[2*i+1]));let r=this.createMesh(t);r.useType="floor",i.push(r)}))}getAllVertices(e){let t=[];return this.wallList.forEach((i=>{let r=[],n=Array.from(i.geometry.attributes.position.array);for(let e=0;e<n.length/9-1;e++)r.push([n[9*e],n[9*e+1]],[n[9*(e+1)],n[9*(e+1)+1]],[n[3*(3*e+2)],n[3*(3*e+2)+1]],[n[3*(3*(e+1)+2)],n[3*(3*(e+1)+2)+1]]),t.push([n[9*e],n[9*e+1]],[n[9*(e+1)],n[9*(e+1)+1]],[n[3*(3*e+2)],n[3*(3*e+2)+1]],[n[3*(3*(e+1)+2)],n[3*(3*(e+1)+2)+1]]);let o=[];this.filterArray(r).forEach((e=>{o.push({x:e[0],y:e[1]})})),e.push(o)})),this.filterArray(t)}handleIndex(e,t,i=0){let r=t[e[i][0]],n=t[e[i][1]];console.log(r,n)}getRoom(e,t){let i=Array(e.length);for(let e=0;e<i.length;e++)i[e]=Array(2).fill(0);for(let t=0;t<e.length-1;t++)for(let r=t+1;r<e.length;r++){let n=e[r].length/2,o=0,a=0;for(let i=0;i<n;i++)$a59c92c620a56c0f$export$7f6bc8d3d7d61b11([e[r][2*i],e[r][2*i+1]],e[t])?o++:a++;if(o===n)i[t][0]++,i[r][1]++;else{let n=0;for(let i=0;i<e[t].length/2;i++)$a59c92c620a56c0f$export$7f6bc8d3d7d61b11([e[t][2*i],e[t][2*i+1]],e[r])?o++:a++;n==e[t].length/2&&(i[t][1]++,i[r][0]++)}}return i.reverse().forEach(((t,r)=>{0==t[1]&&0!=t[0]&&e.splice(i.length-1-r,1)})),e}deleteWallCircle(e,t){let i=[];for(let r=0;r<e.length;r++){let n=e[r],o=this.findWallByVertex(t,n),a=[];o.forEach((e=>{a.push(...t[e])}));let s=[];a.forEach((e=>{s.push([e.x,e.y])})),s=this.filterArray(s);let l=[];for(let e=0;e<n.length/2;e++)l.push([n[2*e],n[2*e+1]]);l=this.filterArray(l),this.isEqual(s,l)&&i.push(r)}return i.reverse().forEach((t=>{e.splice(t,1)})),e}findWallByVertex(e,t){let i=Array(t.length/2);for(let e=0;e<i.length;e++)i[e]=Array();for(let r=0;r<e.length;r++)for(let n=0;n<e[r].length;n++)for(let o=0;o<t.length/2;o++)e[r][n].x==t[2*o]&&e[r][n].y==t[2*o+1]&&i[o].push(r);let r=[];return i.forEach((e=>{r.push(...e)})),Array.from(new Set(r))}isEqual(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++){let r=!1;for(let n=0;n<t.length;n++)if(!r)if(e[i][0]!=t[n][0]||e[i][1]!=t[n][1]){if(n==t.length-1)return!1}else r=!0}for(let i=0;i<t.length;i++){let r=!1;for(let n=0;n<e.length;n++)if(!r)if(t[i][0]!=e[n][0]||t[i][1]!=e[n][1]){if(n==e.length-1)return!1}else r=!0}return!0}isInPoly(e,t){for(let i=0;i<e.length/2;i++)if(!PolyK.ContainsPoint(t,e[2*i],e[2*i+1]))return!1;return!0}getCeiling(){let e=this.getFloor(),t=[];this.wallList.forEach((e=>{t.push(e.height)}));let i=Math.max(...t),r=[];for(let t=0;t<e.length;t++){let n=e[t].geometry.clone(),o=Array.from(n.attributes.position.array);for(let e=0;e<o.length/3;e++)o[3*e+2]=i;n.attributes.position=new $4xklQ.BufferAttribute(new Float32Array(o),3);let a=Array.from(n.index.array);for(let e=0;e<a.length/3;e++){let t=a[3*e];a[3*e]=a[3*e+2],a[3*e+2]=t}n.index=new $4xklQ.BufferAttribute(new Uint16Array(a),1),n.computeVertexNormals();let s=new $4xklQ.Mesh(n,new $4xklQ.MeshStandardMaterial({color:10394523}));r.push(s)}return r}getBeam(e,t){let i=[],r=new(0,$5XTH3.DrawWallTool);for(let n=0;n<e.length;n++){if("beam"==e[n].type){let o=this.getShape(e[n],t,r),a={steps:2,depth:e[n].depth,bevelEnabled:!1,bevelThickness:1,bevelSize:1,bevelSegments:1},s=new $4xklQ.ExtrudeGeometry(o,a);s.computeBoundingBox();let l=s.boundingBox.min.clone().add(s.boundingBox.max).divideScalar(2);s.center();let c=new $4xklQ.Mesh(s,this.beamMaterial);c.name="beam",c.position.set(l.x,l.y,e[n].location.z),i.push(c)}if("pillars"==e[n].type||"flue"==e[n].type){let t=this.createPillars(e[n]),r={steps:2,depth:e[n].depth,bevelEnabled:!1,bevelThickness:1,bevelSize:1,bevelSegments:1},o=new $4xklQ.ExtrudeGeometry(t,r);o.computeBoundingBox();let a=o.boundingBox.min.clone().add(o.boundingBox.max).divideScalar(2);o.center();let s=new $4xklQ.Mesh(o,this.pillarsMaterial);s.name=e[n].type,s.position.set(a.x,a.y,e[n].location.z),i.push(s)}}return console.log(i),i}getBeamNew(e,t){let i=[];for(let r=0;r<e.length;r++){let n,o={steps:2,depth:e[r].depth,bevelEnabled:!1,bevelThickness:1,bevelSize:1,bevelSegments:1},a=new $4xklQ.Shape;t[r].children.forEach((e=>{"Mesh"==e.type&&(n=e.geometry)}));let s=Array.from(n.attributes.position.array),l=[];for(let e=0;e<s.length/3;e++)l.push(new $4xklQ.Vector2(s[3*e]*t[r].scale.x,s[3*e+1]*t[r].scale.y));a.moveTo(l[0].x,l[0].y);for(let e=1;e<l.length;e++)a.lineTo(l[e].x,l[e].y);a.lineTo(l[0].x,l[0].y);let c=new $4xklQ.ExtrudeGeometry(a,o);c.computeBoundingBox(),c.center();let h=t[r].position;if("beam"==e[r].type){let n=new $4xklQ.Mesh(c,this.beamMaterial);n.name="beam",n.modeType=e[r].type,n.rotation.z=t[r].rotation.z,n.position.set(h.x,h.y,e[r].location.z),n.model2DId=e[r].id,t[r].threeD=n,n.twoD=t[r],i.push(n)}if("pillars"==e[r].type||"flue"==e[r].type){let n="flue"==e[r].type?new $b918a4521263ae88$export$d9d93634284e4ef0(c,this.pillarsMaterial):new $4xklQ.Mesh(c,this.pillarsMaterial);"flue"==e[r].type&&n.hollow(),n.name=e[r].type,n.modeType=e[r].type,n.position.set(h.x,h.y,e[r].location.z),n.rotation.z=t[r].rotation.z,n.model2DId=e[r].id,t[r].threeD=n,n.twoD=t[r],i.push(n)}}return i}getShape(e,t,i){let r,n,o=new $4xklQ.Vector2(e.location.x,e.location.y),a=o.clone(),s=o.clone();if(e.rotation%Math.PI==0)r="Y",n=o.y;else if(e.rotation%(Math.PI/2)==0)r="X",n=o.x;else{let t=Math.tan(e.rotation);r=Math.round(1e3*t)/1e3,n=o.y-r*o.x}let l="X"==r||"Y"==r?e.height/2:e.height/2/Math.cos(e.rotation);"X"==r?(a.x+=l,s.x-=l):(a.y+=l,s.y-=l);let c=$9QhXH.DM.getIntersect(a,r,n+l,t,i),h=$9QhXH.DM.getIntersect(o,r,n,t,i),d=$9QhXH.DM.getIntersect(s,r,n-l,t,i),u=new $4xklQ.Shape;return u.moveTo(c[0].x,c[0].y),u.lineTo(h[0].x,h[0].y),u.lineTo(d[0].x,d[0].y),u.lineTo(d[1].x,d[1].y),u.lineTo(h[1].x,h[1].y),u.lineTo(c[1].x,c[1].y),u.lineTo(c[0].x,c[0].y),u}createPillars(e){let t=new $4xklQ.Vector2(e.location.x,e.location.y),i=t.clone().add(new $4xklQ.Vector2(-e.width/2,0)).add(new $4xklQ.Vector2(0,e.height/2)),r=t.clone().add(new $4xklQ.Vector2(e.width/2,0)).add(new $4xklQ.Vector2(0,e.height/2)),n=t.clone().add(new $4xklQ.Vector2(e.width/2,0)).add(new $4xklQ.Vector2(0,-e.height/2)),o=t.clone().add(new $4xklQ.Vector2(-e.width/2,0)).add(new $4xklQ.Vector2(0,-e.height/2)),a=new $4xklQ.Shape;return a.moveTo(i.x,i.y),a.lineTo(r.x,r.y),a.lineTo(n.x,n.y),a.lineTo(o.x,o.y),a.lineTo(i.x,i.y),a}getAllVertex(){let e=[];return this.wallList.forEach((function(t){let i=[t.startPoint.x,t.startPoint.y],r=[t.endPoint.x,t.endPoint.y];e.push(i,r)})),this.filterArray(e)}checkNum(e,t){let i=0;for(let r=0;r<e.length;r++){let n=e[r].startPoint,o=e[r].endPoint;if(n.x==t.x&&n.y==t.y&&i++,o.x==t.x&&o.y==t.y&&i++,i>1)return!0}return!1}filterArray(e){const t=[];return e.forEach((e=>{let i=!0;t.forEach((r=>{r?(e[0]===r[0]&&e[1]===r[1]&&(i=!1),e[0]===r[1]&&e[1]===r[0]&&(i=!1)):t.push(e)})),i&&t.push(e)})),t}getIndexArr(e){let t=[];for(let i=0;i<this.wallList.length;i++){let r=this.wallList[i],n=[r.startPoint.x,r.startPoint.y],o=[r.endPoint.x,r.endPoint.y];t.push([this.getIndex(e,n),this.getIndex(e,o)])}return t}getIndexArr2(e,t){let i=[];for(let r=0;r<t.length;r++){let n=t[r],o=Array.from(n.geometry.attributes.position.array);for(let t=0;t<o.length/9-1;t++){let r=[o[9*t],o[9*t+1]],n=[o[9*(t+1)],o[9*(t+1)+1]],a=[o[3*(3*t+2)],o[3*(3*t+2)+1]],s=[o[3*(3*(t+1)+2)],o[3*(3*(t+1)+2)+1]];i.push([this.getIndex(e,r),this.getIndex(e,n)],[this.getIndex(e,a),this.getIndex(e,s)])}if(this.checkNum(t,n.startPoint)){if(!this.checkNum(t,n.endPoint)){let t=[o[3*(o.length/3-1)],o[3*(o.length/3-1)+1]],r=[o[3*(o.length/3-3)],o[3*(o.length/3-3)+1]];i.push([this.getIndex(e,t),this.getIndex(e,r)])}}else{let t=[o[0],o[1]],r=[o[6],o[7]];i.push([this.getIndex(e,t),this.getIndex(e,r)])}}return i}getIndex(e,t){for(let i=0;i<e.length;i++)if(t[0]==e[i][0]&&t[1]==e[i][1])return i;return!1}createFloor(e){let t=[];for(let i=0;i<e.length;i++){let r=[],n=[],o=e[i],a=[];for(let e=0;e<o.length;e++){let t=o[e],i=e,n=i==o.length-1?o[0]:o[i+1],s=this.getWall(t,n);a.push(s);let l=this.getLineData(t,n,s.thickness/2);s.isRoomInnerWall=l,r.push(l)}let s=[],l=[],c=!1;for(let e=0;e<a.length;e++)if(a[e].isArc){let t=Array.from(a[e].geometry.attributes.position.array);for(let e=0;e<t.length/9;e++){let i=[t[9*e],t[9*e+1]],r=[t[9*e+6],t[9*e+7]],n=[t[9*e+9],t[9*e+10]],o=[t[9*e+15],t[9*e+16]];l.push([i,n],[r,o])}c=!0}else{let t=Array.from(a[e].geometry.attributes.position.array),i=[t[0],t[1]],r=[t[6],t[7]],n=[t[9],t[10]],o=[t[15],t[16]];s.push(i,r,n,o),l.push([i,n],[r,o])}if(c){for(let e=0;e<a.length;e++)if(!a[e].isArc){let i=Array.from(a[e].geometry.attributes.position.array),r=[i[0],i[1]],n=[i[6],i[7]],o=[i[9],i[10]],s=[i[15],i[16]],c=this.getCycle([r,o],l),h=this.getCycle([n,s],l),d=[],u=[];c&&(d.push(...c[0]),c.shift(),d=this.getPoints(d[1],c,d)),h&&(u.push(...h[0]),h.shift(),u=this.getPoints(u[1],h,u));let p=[],m=[];if(d.forEach((function(e){p.push(new $4xklQ.Vector2(e[0],e[1]))})),u.forEach((function(e){m.push(new $4xklQ.Vector2(e[0],e[1]))})),d.length>0&&u.length>0){let e=Math.abs($b590b02110506a77$export$96bdf6d9c66d7ba8.area(p))>Math.abs($b590b02110506a77$export$96bdf6d9c66d7ba8.area(m))?this.createMesh(m):this.createMesh(p);t.push(e)}if(d.length>0&&0==u.length){let e=this.createMesh(p);t.push(e)}if(0==d.length&&u.length>0){let e=this.createMesh(m);t.push(e)}break}continue}for(let e=0;e<r.length;e++){let t=r[e],i=e,s=i==r.length-1?r[0]:r[i+1],l=i==r.length-1?o[0]:o[i+1],c=(0==i?o[i+1]:o[i-1],a[i]),h=i==r.length-1?a[0]:a[i+1];if(c.isArc)console.log("当前墙是弧线墙");else{if(h.isArc);else{let e=this.getIntersectPoint(t,s,l);n.push(e)}}}let h=this.createMesh(n);t.push(h)}return t}createFloorNew(e){let t=[];return e.forEach((e=>{let i=[],r=[],n=[];for(let t=0;t<e.length;t++)for(let i=0;i<this.wallList.length;i++){let o=this.wallList[i],a=o.startPoint,s=o.endPoint;if(a.x==e[t].x&&a.y==e[t].y||s.x==e[t].x&&s.y==e[t].y){-1==n.indexOf(o)&&n.push(o);let e=Array.from(o.geometry.attributes.position.array);for(let t=0;t<e.length/9-1;t++)r.push([e[9*t],e[9*t+1]],[e[9*(t+1)],e[9*(t+1)+1]],[e[3*(3*t+2)],e[3*(3*t+2)+1]],[e[3*(3*(t+1)+2)],e[3*(3*(t+1)+2)+1]])}}r=this.filterArray(r);let o=this.getIndexArr2(r,n),a=this.transformVertex(r);this.transformAdj(o,a);let s,l=$2176137edde06fbe$export$fee71b7b1f0877fa(a),c=0;l.forEach((e=>{let t=[];e.forEach((e=>{t.push(new $4xklQ.Vector2(e.x,e.y))}));let r=this.createMesh(t);r.useType="floor";let n=Math.round(100*Math.abs($b590b02110506a77$export$96bdf6d9c66d7ba8.area(t)/1e6))/100;n>c&&(c=n,s=r),i.push(r)})),i.splice(i.indexOf(s),1),1==i.length&&t.push(...i)})),t}createMesh(e){let t=new $4xklQ.Shape;t.moveTo(e[0].x,e[0].y);for(let i=1;i<e.length;i++)t.lineTo(e[i].x,e[i].y);t.lineTo(e[0].x,e[0].y);let i=new $4xklQ.ShapeGeometry(t),r=i.attributes.position.array;i.computeBoundingBox();let n=i.boundingBox.min,o=i.boundingBox.max,a=o.x-n.x,s=o.y-n.y,l=[n.x,n.y],c=[];for(let e=0;e<r.length/3;e++){let t=[r[3*e],r[3*e+1]];c.push((t[0]-l[0])/a,(t[1]-l[1])/s)}let h=(new $4xklQ.Matrix3).setUvTransform(0,0,a/1920,s/1920,0,0,0),d=new $4xklQ.BufferAttribute(new Float32Array(c),2);d.applyMatrix3(h),c=Array.from(d.array),i.attributes.uv=new $4xklQ.BufferAttribute(new Float32Array(c),2);let u=new $38a97d266629f9dd$export$525628e68e798fb4(i,new $4xklQ.MeshStandardMaterial({map:this.texture}));return u.initParams(this.wallList),u.allPoints=e,u}getPoints(e,t,i){let r=i[0],n=i[1];for(let o=0;o<t.length;o++){let a=t[o][0],s=t[o][1],l=r[0]==a[0]&&r[1]==a[1],c=r[0]==s[0]&&r[1]==s[1],h=n[0]==a[0]&&n[1]==a[1],d=n[0]==s[0]&&n[1]==s[1];if(!(l&&d||c&&h)){if(a[0]==e[0]&&a[1]==e[1])return i.push(s),t.splice(o,1),this.getPoints(s,t,i);if(s[0]==e[0]&&s[1]==e[1])return i.push(a),t.splice(o,1),this.getPoints(a,t,i)}}return i}getWall(e,t){let i=[];for(let r=0;r<this.wallList.length;r++){let n=this.wallList[r],o=e.x==n.startPoint.x&&e.y==n.startPoint.y,a=e.x==n.endPoint.x&&e.y==n.endPoint.y,s=t.x==n.startPoint.x&&t.y==n.startPoint.y,l=t.x==n.endPoint.x&&t.y==n.endPoint.y;if(o)if(l)i.push(n);else{let e=!0;for(let t=0;t<this.wallList.length;t++)if(r!=t){let i=this.wallList[t].startPoint.x==n.endPoint.x&&this.wallList[t].startPoint.y==n.endPoint.y,r=this.wallList[t].endPoint.x==n.endPoint.x&&this.wallList[t].endPoint.y==n.endPoint.y;(i||r)&&(e=!1)}e&&i.push(n)}else if(a)if(s)i.push(n);else{let e=!0;for(let t=0;t<this.wallList.length;t++)if(r!=t){let i=this.wallList[t].startPoint.x==n.startPoint.x&&this.wallList[t].startPoint.y==n.startPoint.y,r=this.wallList[t].endPoint.x==n.startPoint.x&&this.wallList[t].endPoint.y==n.startPoint.y;(i||r)&&(e=!1)}e&&i.push(n)}}return i}getLineData(e,t,i){let r,n;e.x==t.x?(r="X",n=e.x):e.y==t.y?(r="Y",n=e.y):(r=(e.y-t.y)/(e.x-t.x),n=e.y-r*e.x);let o=new $4xklQ.Vector2(t.x,t.y).sub(new $4xklQ.Vector2(e.x,e.y));if(0!=Math.abs(Number(Math.cos(o.angle())).toFixed(11))&&1!=Math.abs(Number(Math.cos(o.angle())).toFixed(11))){n-=i/Number(Math.cos(o.angle())).toFixed(11)}else 180*o.angle()/Math.PI==0&&(n-=i),180*o.angle()/Math.PI==90&&(n+=i),180*o.angle()/Math.PI==180&&(n+=i),180*o.angle()/Math.PI==270&&(n-=i);return[r,n]}getIntersectPoint(e,t,i){if("X"==e[0]){if("X"==t[0])return e[1]==t[1]&&new $4xklQ.Vector2(e[1],i.y);if("Y"==t[0])return new $4xklQ.Vector2(e[1],t[1]);var r=t[0]*e[1]+t[1];return new $4xklQ.Vector2(e[1],r)}if("Y"==e[0]){if("X"==t[0])return new $4xklQ.Vector2(t[1],e[1]);if("Y"==t[0])return e[1]==t[1]&&new $4xklQ.Vector2(i.x,e[1]);var n=(e[1]-t[1])/t[0];return new $4xklQ.Vector2(n,e[1])}if("X"==t[0]){r=e[0]*t[1]+e[1];return new $4xklQ.Vector2(t[1],r)}if("Y"==t[0]){n=(t[1]-e[1])/e[0];return new $4xklQ.Vector2(n,t[1])}if(e[0]==t[0]){let t=-1/e[0],r=i.y-t*i.x,n=(r-e[1])/(e[0]-t),o=t*n+r;return new $4xklQ.Vector2(n,o)}n=(t[1]-e[1])/(e[0]-t[0]),r=e[0]*n+e[1];return new $4xklQ.Vector2(n,r)}}var $5sV3G=parcelRequire("5sV3G"),$9HO6e=parcelRequire("9HO6e"),$9QhXH=parcelRequire("9QhXH");class $2a0c8f99fe7360a8$export$f03163d7279986d4{constructor(e){this.dom=e}add(){for(let e=0;e<arguments.length;e++){const t=arguments[e];t instanceof $2a0c8f99fe7360a8$export$f03163d7279986d4?this.dom.appendChild(t.dom):console.error("UIElement:",t,"is not an instance of UIElement.")}return this}remove(){for(let e=0;e<arguments.length;e++){const t=arguments[e];t instanceof $2a0c8f99fe7360a8$export$f03163d7279986d4?this.dom.removeChild(t.dom):console.error("UIElement:",t,"is not an instance of UIElement.")}return this}clear(){for(;this.dom.children.length;)this.dom.removeChild(this.dom.lastChild)}setId(e){return this.dom.id=e,this}getId(){return this.dom.id}setClass(e){return this.dom.className=e,this}addClass(e){return this.dom.classList.add(e),this}removeClass(e){return this.dom.classList.remove(e),this}setStyle(e,t){for(let i=0;i<t.length;i++)this.dom.style[e]=t[i];return this}setDisabled(e){return this.dom.disabled=e,this}setTextContent(e){return this.dom.textContent=e,this}setInnerHTML(e){this.dom.innerHTML=e}getIndexOfChild(e){return Array.prototype.indexOf.call(this.dom.children,e.dom)}cleanChildByClassName(e){for(let t=0;t<this.dom.children.length;t++)this.dom.children[t].className==e&&this.dom.removeChild(this.dom.children[t]);return this}setAttribute(e,t){this.dom.setAttribute(e,t)}getAttribute(e){return this.dom.getAttribute(e)}}const $2a0c8f99fe7360a8$var$properties=["position","left","top","right","bottom","width","height","border","borderLeft","borderTop","borderRight","borderBottom","borderColor","display","overflow","margin","marginLeft","marginTop","marginRight","marginBottom","padding","paddingLeft","paddingTop","paddingRight","paddingBottom","verticalAlign","color","background","backgroundColor","opacity","fontSize","fontWeight","textAlign","textDecoration","textTransform","cursor","zIndex"];$2a0c8f99fe7360a8$var$properties.forEach((function(e){const t="set"+e.substr(0,1).toUpperCase()+e.substr(1,e.length);$2a0c8f99fe7360a8$export$f03163d7279986d4.prototype[t]=function(){return this.setStyle(e,arguments),this}}));const $2a0c8f99fe7360a8$var$events=["KeyUp","KeyDown","MouseOver","MouseOut","Click","DblClick","Change","Input","Blur"];$2a0c8f99fe7360a8$var$events.forEach((function(e){const t="on"+e;$2a0c8f99fe7360a8$export$f03163d7279986d4.prototype[t]=function(t){return this.dom.addEventListener(e.toLowerCase(),t.bind(this)),this}}));class $2a0c8f99fe7360a8$export$2de04cb471254707 extends $2a0c8f99fe7360a8$export$f03163d7279986d4{constructor(){super(document.createElement("span"))}}class $2a0c8f99fe7360a8$export$ac7b10f01e8d236b extends $2a0c8f99fe7360a8$export$f03163d7279986d4{constructor(){super(document.createElement("div")),this.dom.style.position="absolute"}}class $2a0c8f99fe7360a8$export$7fe3fe34544b4730 extends $2a0c8f99fe7360a8$export$ac7b10f01e8d236b{constructor(){super(),this.dom.className="Row"}}class $2a0c8f99fe7360a8$export$ab8ce44154d5decc extends $2a0c8f99fe7360a8$export$ac7b10f01e8d236b{constructor(){super(),this.dom.className="Panel",this.dom.style.position="absolute"}}class $2a0c8f99fe7360a8$export$3dc21c16dab61cf7 extends $2a0c8f99fe7360a8$export$2de04cb471254707{constructor(e,t=!0){super(),this.dom.className="Text",this.dom.style.cursor="default",this.dom.style.display="inline-block",this.dom.style.position="absolute",this.dom.style.fontWeight="550",t&&(this.dom.style.textShadow="-1px 0 #fff, 0 1px #fff, 1px 0 #fff, 0 -1px #fff"),this.setValue(e)}getValue(){return this.dom.textContent}setValue(e){return void 0!==e&&(this.dom.textContent=e),this}}class $2a0c8f99fe7360a8$export$ab52802de2137ca0 extends $2a0c8f99fe7360a8$export$f03163d7279986d4{constructor(e){super(document.createElement("input")),this.dom.className="Input",this.dom.style.padding="2px",this.dom.style.border="1px solid transparent",this.dom.style.pointerEvents="auto",this.dom.style.textAlign="center",this.dom.style.position="absolute",this.dom.style.fontSize="12px",this.dom.style.fontWeight="550",this.dom.style.textShadow="-1px 0 #fff, 0 1px #fff, 1px 0 #fff, 0 -1px #fff",this.dom.setAttribute("autocomplete","off"),this.dom.addEventListener("keydown",(function(e){e.stopPropagation()})),this.setValue(e)}getValue(){return this.dom.value}setValue(e){return this.dom.value=e,this}setFocus(){return this.dom.focus(),this.dom.setSelectionRange(0,this.dom.value.length),this}setBlur(){return this.dom.blur(),this}setNumber(){this.dom.type="Number"}}class $2a0c8f99fe7360a8$export$5e7e537401aa8003 extends $2a0c8f99fe7360a8$export$f03163d7279986d4{constructor(){super(document.createElement("textarea")),this.dom.className="TextArea",this.dom.style.padding="2px",this.dom.spellcheck=!1,this.dom.setAttribute("autocomplete","off"),this.dom.addEventListener("keydown",(function(e){if(e.stopPropagation(),9===e.keyCode){e.preventDefault();const t=this.selectionStart;this.value=this.value.substring(0,t)+"\t"+this.value.substring(t),this.selectionStart=t+1,this.selectionEnd=this.selectionStart}}))}getValue(){return this.dom.value}setValue(e){return this.dom.value=e,this}}class $2a0c8f99fe7360a8$export$2da7878a4c9bfee1 extends $2a0c8f99fe7360a8$export$f03163d7279986d4{constructor(){super(document.createElement("select")),this.dom.className="Select",this.dom.style.padding="2px",this.dom.setAttribute("autocomplete","off")}setMultiple(e){return this.dom.multiple=e,this}setOptions(e){const t=this.dom.value;for(;this.dom.children.length>0;)this.dom.removeChild(this.dom.firstChild);for(const t in e){const i=document.createElement("option");i.value=t,i.innerHTML=e[t],this.dom.appendChild(i)}return this.dom.value=t,this}getValue(){return this.dom.value}setValue(e){return e=String(e),this.dom.value!==e&&(this.dom.value=e),this}}class $2a0c8f99fe7360a8$export$571c9b715b83d94f extends $2a0c8f99fe7360a8$export$f03163d7279986d4{constructor(e){super(document.createElement("input")),this.dom.className="Checkbox",this.dom.type="checkbox",this.setValue(e)}getValue(){return this.dom.checked}setValue(e){return void 0!==e&&(this.dom.checked=e),this}}class $2a0c8f99fe7360a8$export$10dbe6334ee40107 extends $2a0c8f99fe7360a8$export$f03163d7279986d4{constructor(){super(document.createElement("input")),this.dom.className="Color",this.dom.style.width="32px",this.dom.style.height="16px",this.dom.style.border="0px",this.dom.style.padding="2px",this.dom.style.backgroundColor="transparent",this.dom.setAttribute("autocomplete","off");try{this.dom.type="color",this.dom.value="#ffffff"}catch(e){}}getValue(){return this.dom.value}getHexValue(){return parseInt(this.dom.value.substr(1),16)}setValue(e){return this.dom.value=e,this}setHexValue(e){return this.dom.value="#"+("000000"+e.toString(16)).slice(-6),this}}class $2a0c8f99fe7360a8$export$460e875d69da065f extends $2a0c8f99fe7360a8$export$f03163d7279986d4{constructor(e){super(document.createElement("input")),this.dom.style.cursor="ns-resize",this.dom.className="Number",this.dom.value="0.00",this.dom.setAttribute("autocomplete","off"),this.value=0,this.min=-1/0,this.max=1/0,this.precision=2,this.step=1,this.unit="",this.nudge=.01,this.setValue(e);const t=this,i=document.createEvent("HTMLEvents");i.initEvent("change",!0,!0);let r=0,n=0;const o={x:0,y:0},a={x:0,y:0};function s(e){const s=t.value;o.x=e.clientX,o.y=e.clientY,r+=o.x-a.x-(o.y-a.y);let l=n+r/(e.shiftKey?5:50)*t.step;l=Math.min(t.max,Math.max(t.min,l)),s!==l&&(t.setValue(l),t.dom.dispatchEvent(i)),a.x=e.clientX,a.y=e.clientY}function l(){document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",l),Math.abs(r)<2&&(t.dom.focus(),t.dom.select())}function c(e){const s=t.value;o.x=e.touches[0].pageX,o.y=e.touches[0].pageY,r+=o.x-a.x-(o.y-a.y);let l=n+r/(e.shiftKey?5:50)*t.step;l=Math.min(t.max,Math.max(t.min,l)),s!==l&&(t.setValue(l),t.dom.dispatchEvent(i)),a.x=e.touches[0].pageX,a.y=e.touches[0].pageY}function h(e){0===e.touches.length&&(document.removeEventListener("touchmove",c),document.removeEventListener("touchend",h))}function d(){t.dom.style.backgroundColor="transparent",t.dom.style.cursor="ns-resize"}d(),this.dom.addEventListener("keydown",(function(e){switch(e.stopPropagation(),e.keyCode){case 13:t.dom.blur();break;case 38:e.preventDefault(),t.setValue(t.getValue()+t.nudge),t.dom.dispatchEvent(i);break;case 40:e.preventDefault(),t.setValue(t.getValue()-t.nudge),t.dom.dispatchEvent(i)}})),this.dom.addEventListener("mousedown",(function(e){e.preventDefault(),r=0,n=t.value,a.x=e.clientX,a.y=e.clientY,document.addEventListener("mousemove",s),document.addEventListener("mouseup",l)})),this.dom.addEventListener("touchstart",(function(e){1===e.touches.length&&(r=0,n=t.value,a.x=e.touches[0].pageX,a.y=e.touches[0].pageY,document.addEventListener("touchmove",c),document.addEventListener("touchend",h))})),this.dom.addEventListener("change",(function(){t.setValue(t.dom.value)})),this.dom.addEventListener("focus",(function(){t.dom.style.backgroundColor="",t.dom.style.cursor=""})),this.dom.addEventListener("blur",d)}getValue(){return this.value}setValue(e){return void 0!==e&&((e=parseFloat(e))<this.min&&(e=this.min),e>this.max&&(e=this.max),this.value=e,this.dom.value=e.toFixed(this.precision),""!==this.unit&&(this.dom.value+=" "+this.unit)),this}setPrecision(e){return this.precision=e,this}setStep(e){return this.step=e,this}setNudge(e){return this.nudge=e,this}setRange(e,t){return this.min=e,this.max=t,this}setUnit(e){return this.unit=e,this}}class $2a0c8f99fe7360a8$export$8211f4a26ed299bc extends $2a0c8f99fe7360a8$export$f03163d7279986d4{constructor(e){super(document.createElement("input")),this.dom.style.cursor="ns-resize",this.dom.className="Number",this.dom.value="0",this.dom.setAttribute("autocomplete","off"),this.value=0,this.min=-1/0,this.max=1/0,this.step=1,this.nudge=1,this.setValue(e);const t=this,i=document.createEvent("HTMLEvents");i.initEvent("change",!0,!0);let r=0,n=0;const o={x:0,y:0},a={x:0,y:0};function s(e){const s=t.value;o.x=e.clientX,o.y=e.clientY,r+=o.x-a.x-(o.y-a.y);let l=n+r/(e.shiftKey?5:50)*t.step;l=0|Math.min(t.max,Math.max(t.min,l)),s!==l&&(t.setValue(l),t.dom.dispatchEvent(i)),a.x=e.clientX,a.y=e.clientY}function l(){document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",l),Math.abs(r)<2&&(t.dom.focus(),t.dom.select())}function c(){t.dom.style.backgroundColor="transparent",t.dom.style.cursor="ns-resize"}c(),this.dom.addEventListener("keydown",(function(e){switch(e.stopPropagation(),e.keyCode){case 13:t.dom.blur();break;case 38:e.preventDefault(),t.setValue(t.getValue()+t.nudge),t.dom.dispatchEvent(i);break;case 40:e.preventDefault(),t.setValue(t.getValue()-t.nudge),t.dom.dispatchEvent(i)}})),this.dom.addEventListener("mousedown",(function(e){e.preventDefault(),r=0,n=t.value,a.x=e.clientX,a.y=e.clientY,document.addEventListener("mousemove",s),document.addEventListener("mouseup",l)})),this.dom.addEventListener("change",(function(){t.setValue(t.dom.value)})),this.dom.addEventListener("focus",(function(){t.dom.style.backgroundColor="",t.dom.style.cursor=""})),this.dom.addEventListener("blur",c)}getValue(){return this.value}setValue(e){return void 0!==e&&(e=parseInt(e),this.value=e,this.dom.value=e),this}setStep(e){return this.step=parseInt(e),this}setNudge(e){return this.nudge=e,this}setRange(e,t){return this.min=e,this.max=t,this}}class $2a0c8f99fe7360a8$export$81e71053636b1487 extends $2a0c8f99fe7360a8$export$f03163d7279986d4{constructor(){super(document.createElement("br")),this.dom.className="Break"}}class $2a0c8f99fe7360a8$export$ffffbaf85064f83e extends $2a0c8f99fe7360a8$export$f03163d7279986d4{constructor(){super(document.createElement("hr")),this.dom.className="HorizontalRule"}}class $2a0c8f99fe7360a8$export$d03954f05e20853e extends $2a0c8f99fe7360a8$export$f03163d7279986d4{constructor(e){super(document.createElement("button")),this.dom.className="Button",this.dom.textContent=e}}class $2a0c8f99fe7360a8$export$f26d295322e01bd8 extends $2a0c8f99fe7360a8$export$f03163d7279986d4{constructor(e){super(document.createElement("progress")),this.dom.value=e}setValue(e){this.dom.value=e}}class $2a0c8f99fe7360a8$export$b1e8772dd1369eb1 extends $2a0c8f99fe7360a8$export$ac7b10f01e8d236b{constructor(){super(),this.dom.className="TabbedPanel",this.tabs=[],this.panels=[],this.tabsDiv=new $2a0c8f99fe7360a8$export$ac7b10f01e8d236b,this.tabsDiv.setClass("Tabs"),this.panelsDiv=new $2a0c8f99fe7360a8$export$ac7b10f01e8d236b,this.panelsDiv.setClass("Panels"),this.add(this.tabsDiv),this.add(this.panelsDiv),this.selected=""}select(e){let t,i;const r=this;return this.selected&&this.selected.length&&(t=this.tabs.find((function(e){return e.dom.id===r.selected})),i=this.panels.find((function(e){return e.dom.id===r.selected})),t&&t.removeClass("selected"),i&&i.setDisplay("none")),t=this.tabs.find((function(t){return t.dom.id===e})),i=this.panels.find((function(t){return t.dom.id===e})),t&&t.addClass("selected"),i&&i.setDisplay(""),this.selected=e,this}addTab(e,t,i){const r=new $2a0c8f99fe7360a8$var$UITab(t,this);r.setId(e),this.tabs.push(r),this.tabsDiv.add(r);const n=new $2a0c8f99fe7360a8$export$ac7b10f01e8d236b;n.setId(e),n.add(i),n.setDisplay("none"),this.panels.push(n),this.panelsDiv.add(n),this.select(e)}}class $2a0c8f99fe7360a8$var$UITab extends $2a0c8f99fe7360a8$export$3dc21c16dab61cf7{constructor(e,t){super(e),this.dom.className="Tab",this.parent=t;const i=this;this.dom.addEventListener("click",(function(){i.parent.select(i.dom.id)}))}}class $2a0c8f99fe7360a8$export$b153a4f9d1932444 extends $2a0c8f99fe7360a8$export$ac7b10f01e8d236b{constructor(){super(),this.dom.className="Listbox",this.dom.tabIndex=0,this.items=[],this.listitems=[],this.selectedIndex=0,this.selectedValue=null}setItems(e){Array.isArray(e)&&(this.items=e),this.render()}render(){for(;this.listitems.length;){this.listitems[0].dom.remove(),this.listitems.splice(0,1)}for(let e=0;e<this.items.length;e++){const t=this.items[e],i=new $2a0c8f99fe7360a8$export$b153a4f9d1932444.ListboxItem(this);i.setId(t.id||`Listbox-${e}`),i.setTextContent(t.name||t.type),this.add(i)}}add(){const e=Array.from(arguments);this.listitems=this.listitems.concat(e),$2a0c8f99fe7360a8$export$f03163d7279986d4.prototype.add.apply(this,e)}selectIndex(e){e>=0&&e<this.items.length&&this.setValue(this.listitems[e].getId()),this.selectedIndex=e}getValue(){return this.selectedValue}setValue(e){for(let t=0;t<this.listitems.length;t++){const i=this.listitems[t];i.getId()===e?i.addClass("active"):i.removeClass("active")}this.selectedValue=e;const t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!0),this.dom.dispatchEvent(t)}}class $2a0c8f99fe7360a8$export$197d17ca3ddb2a96 extends $2a0c8f99fe7360a8$export$ac7b10f01e8d236b{constructor(e){super(),this.dom.className="ListboxItem",this.parent=e;const t=this;this.dom.addEventListener("click",(function(){t.parent&&t.parent.setValue(t.getId())}))}}var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ");const $a69b488eccbcfd7b$var$_changeEvent={type:"change"},$a69b488eccbcfd7b$var$_startEvent={type:"start"},$a69b488eccbcfd7b$var$_endEvent={type:"end"};class $a69b488eccbcfd7b$export$8ff7788029dfdf52 extends $4xklQ.EventDispatcher{constructor(e,t,i){super(),void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new(0,$4xklQ.Vector3),this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:$4xklQ.MOUSE.ROTATE,MIDDLE:$4xklQ.MOUSE.DOLLY,RIGHT:$4xklQ.MOUSE.PAN},this.touches={ONE:$4xklQ.TOUCH.ROTATE,TWO:$4xklQ.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return s.phi},this.getAzimuthalAngle=function(){return s.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",G),this._domElementKeyEvents=e},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent($a69b488eccbcfd7b$var$_changeEvent),r.update(),o=n.NONE},this.update=function(){const t=new(0,$4xklQ.Vector3),i=(new(0,$4xklQ.Quaternion)).setFromUnitVectors(e.up,new(0,$4xklQ.Vector3)(0,1,0)),u=i.clone().invert(),p=new(0,$4xklQ.Vector3),m=new(0,$4xklQ.Quaternion),f=2*Math.PI;return function(){const e=r.object.position;t.copy(e).sub(r.target),t.applyQuaternion(i),s.setFromVector3(t),r.autoRotate&&o===n.NONE&&S(2*Math.PI/60/60*r.autoRotateSpeed),r.enableDamping?(s.theta+=l.theta*r.dampingFactor,s.phi+=l.phi*r.dampingFactor):(s.theta+=l.theta,s.phi+=l.phi);let g=r.minAzimuthAngle,x=r.maxAzimuthAngle;return isFinite(g)&&isFinite(x)&&(g<-Math.PI?g+=f:g>Math.PI&&(g-=f),x<-Math.PI?x+=f:x>Math.PI&&(x-=f),s.theta=g<=x?Math.max(g,Math.min(x,s.theta)):s.theta>(g+x)/2?Math.max(g,s.theta):Math.min(x,s.theta)),s.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,s.phi)),s.makeSafe(),s.radius*=c,s.radius=Math.max(r.minDistance,Math.min(r.maxDistance,s.radius)),!0===r.enableDamping?r.target.addScaledVector(h,r.dampingFactor):r.target.add(h),t.setFromSpherical(s),t.applyQuaternion(u),e.copy(r.target).add(t),r.object.lookAt(r.target),!0===r.enableDamping?(l.theta*=1-r.dampingFactor,l.phi*=1-r.dampingFactor,h.multiplyScalar(1-r.dampingFactor)):(l.set(0,0,0),h.set(0,0,0)),c=1,!!(d||p.distanceToSquared(r.object.position)>a||8*(1-m.dot(r.object.quaternion))>a)&&(r.dispatchEvent($a69b488eccbcfd7b$var$_changeEvent),p.copy(r.object.position),m.copy(r.object.quaternion),d=!1,!0)}}(),this.dispose=function(){r.domElement.removeEventListener("contextmenu",N),r.domElement.removeEventListener("pointerdown",W),r.domElement.removeEventListener("pointercancel",Q),r.domElement.removeEventListener("wheel",z),r.domElement.removeEventListener("pointermove",H),r.domElement.removeEventListener("pointerup",F),null!==r._domElementKeyEvents&&r._domElementKeyEvents.removeEventListener("keydown",G)};const r=this,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=n.NONE;const a=1e-6,s=new(0,$4xklQ.Spherical),l=new(0,$4xklQ.Spherical);let c=1;const h=new(0,$4xklQ.Vector3);let d=!1;const u=new(0,$4xklQ.Vector2),p=new(0,$4xklQ.Vector2),m=new(0,$4xklQ.Vector2),f=new(0,$4xklQ.Vector2),g=new(0,$4xklQ.Vector2),x=new(0,$4xklQ.Vector2),b=new(0,$4xklQ.Vector2),y=new(0,$4xklQ.Vector2),w=new(0,$4xklQ.Vector2),v=[],$={};function M(){return Math.pow(.95,r.zoomSpeed)}function S(e){l.theta-=e}function P(e){l.phi-=e}const k=function(){const e=new(0,$4xklQ.Vector3);return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),h.add(e)}}(),_=function(){const e=new(0,$4xklQ.Vector3);return function(t,i){!0===r.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(r.object.up,e)),e.multiplyScalar(t),h.add(e)}}(),T=function(){const e=new(0,$4xklQ.Vector3);return function(t,i){const n=r.domElement;if(r.object.isPerspectiveCamera){const o=r.object.position;e.copy(o).sub(r.target);let a=e.length();a*=Math.tan(r.object.fov/2*Math.PI/180),k(2*t*a/n.clientHeight,r.object.matrix),_(2*i*a/n.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(k(t*(r.object.right-r.object.left)/r.object.zoom/n.clientWidth,r.object.matrix),_(i*(r.object.top-r.object.bottom)/r.object.zoom/n.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}}();function C(e){if(r.object.isPerspectiveCamera){let t=1500/s.radius/100;t<.11&&(t=.1,s.radius=150),r.object.zoomNum=t,i.list.changeCameraSlider.dispatch("2d",t),t>.11&&(c/=e)}else if(r.object.isOrthographicCamera){let t=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*e));t<.11&&(t=.1),r.object.zoom=t,i.autoShowHidden(t),i.list.changeCameraSlider.dispatch("2d",t),r.object.updateProjectionMatrix(),d=!0}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1}function A(e){if(r.object.isPerspectiveCamera){c*=e;let t=1500/s.radius/100;r.object.zoomNum=t,i.list.changeCameraSlider.dispatch("2d",t)}else if(r.object.isOrthographicCamera){r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/e));let t=r.object.zoom;i.autoShowHidden(t),i.list.changeCameraSlider.dispatch("2d",r.object.zoom),r.object.updateProjectionMatrix(),d=!0}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1}function D(e){u.set(e.clientX,e.clientY)}function R(e){f.set(e.clientX,e.clientY)}function E(){if(1===v.length)u.set(v[0].pageX,v[0].pageY);else{const e=.5*(v[0].pageX+v[1].pageX),t=.5*(v[0].pageY+v[1].pageY);u.set(e,t)}}function L(){if(1===v.length)f.set(v[0].pageX,v[0].pageY);else{const e=.5*(v[0].pageX+v[1].pageX),t=.5*(v[0].pageY+v[1].pageY);f.set(e,t)}}function I(){const e=v[0].pageX-v[1].pageX,t=v[0].pageY-v[1].pageY,i=Math.sqrt(e*e+t*t);b.set(0,i)}function B(e){if(1==v.length)p.set(e.pageX,e.pageY);else{const t=q(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);p.set(i,r)}m.subVectors(p,u).multiplyScalar(r.rotateSpeed);const t=r.domElement;S(2*Math.PI*m.x/t.clientHeight),P(2*Math.PI*m.y/t.clientHeight),u.copy(p)}function V(e){if(1===v.length)g.set(e.pageX,e.pageY);else{const t=q(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);g.set(i,r)}x.subVectors(g,f).multiplyScalar(r.panSpeed),T(x.x,x.y),f.copy(g)}function O(e){const t=q(e),i=e.pageX-t.x,n=e.pageY-t.y,o=Math.sqrt(i*i+n*n);y.set(0,o),w.set(0,Math.pow(y.y/b.y,r.zoomSpeed)),C(w.y),b.copy(y)}function W(e){!1!==r.enabled&&(0===v.length&&(r.domElement.setPointerCapture(e.pointerId),r.domElement.addEventListener("pointermove",H),r.domElement.addEventListener("pointerup",F)),function(e){v.push(e)}(e),"touch"===e.pointerType?function(e){switch(j(e),v.length){case 1:switch(r.touches.ONE){case $4xklQ.TOUCH.ROTATE:if(!1===r.enableRotate)return;E(),o=n.TOUCH_ROTATE;break;case $4xklQ.TOUCH.PAN:if(!1===r.enablePan)return;L(),o=n.TOUCH_PAN;break;default:o=n.NONE}break;case 2:switch(r.touches.TWO){case $4xklQ.TOUCH.DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;r.enableZoom&&I(),r.enablePan&&L(),o=n.TOUCH_DOLLY_PAN;break;case $4xklQ.TOUCH.DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;r.enableZoom&&I(),r.enableRotate&&E(),o=n.TOUCH_DOLLY_ROTATE;break;default:o=n.NONE}break;default:o=n.NONE}o!==n.NONE&&r.dispatchEvent($a69b488eccbcfd7b$var$_startEvent)}(e):function(e){let t;switch(e.button){case 0:t=r.mouseButtons.LEFT;break;case 1:t=r.mouseButtons.MIDDLE;break;case 2:t=r.mouseButtons.RIGHT;break;default:t=-1}switch(t){case $4xklQ.MOUSE.DOLLY:if(!1===r.enableZoom)return;!function(e){b.set(e.clientX,e.clientY)}(e),o=n.DOLLY;break;case $4xklQ.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enablePan)return;R(e),o=n.PAN}else{if(!1===r.enableRotate)return;D(e),o=n.ROTATE}break;case $4xklQ.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enableRotate)return;D(e),o=n.ROTATE}else{if(!1===r.enablePan)return;R(e),o=n.PAN}break;default:o=n.NONE}o!==n.NONE&&r.dispatchEvent($a69b488eccbcfd7b$var$_startEvent)}(e))}function H(e){!1!==r.enabled&&("touch"===e.pointerType?function(e){switch(j(e),o){case n.TOUCH_ROTATE:if(!1===r.enableRotate)return;B(e),r.update();break;case n.TOUCH_PAN:if(!1===r.enablePan)return;V(e),r.update();break;case n.TOUCH_DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;!function(e){r.enableZoom&&O(e),r.enablePan&&V(e)}(e),r.update();break;case n.TOUCH_DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;!function(e){r.enableZoom&&O(e),r.enableRotate&&B(e)}(e),r.update();break;default:o=n.NONE}}(e):function(e){if(!1===r.enabled)return;switch(o){case n.ROTATE:if(!1===r.enableRotate)return;!function(e){p.set(e.clientX,e.clientY),m.subVectors(p,u).multiplyScalar(r.rotateSpeed);const t=r.domElement;S(2*Math.PI*m.x/t.clientHeight),P(2*Math.PI*m.y/t.clientHeight),u.copy(p),r.update()}(e);break;case n.DOLLY:if(!1===r.enableZoom)return;!function(e){y.set(e.clientX,e.clientY),w.subVectors(y,b),w.y>0?C(M()):w.y<0&&A(M()),b.copy(y),r.update()}(e);break;case n.PAN:if(!1===r.enablePan)return;!function(e){g.set(e.clientX,e.clientY),x.subVectors(g,f).multiplyScalar(r.panSpeed),T(x.x,x.y),f.copy(g),r.update()}(e)}}(e))}function F(e){U(e),0===v.length&&(r.domElement.releasePointerCapture(e.pointerId),r.domElement.removeEventListener("pointermove",H),r.domElement.removeEventListener("pointerup",F)),r.dispatchEvent($a69b488eccbcfd7b$var$_endEvent),o=n.NONE}function Q(e){U(e)}function z(e){!1!==r.enabled&&!1!==r.enableZoom&&o===n.NONE&&(e.preventDefault(),r.dispatchEvent($a69b488eccbcfd7b$var$_startEvent),function(e){e.deltaY<0?A(M()):e.deltaY>0&&C(M()),r.update(),i.updateDom()}(e),r.dispatchEvent($a69b488eccbcfd7b$var$_endEvent))}function G(e){!1!==r.enabled&&!1!==r.enablePan&&function(e){let t=!1;switch(e.code){case r.keys.UP:T(0,r.keyPanSpeed),t=!0;break;case r.keys.BOTTOM:T(0,-r.keyPanSpeed),t=!0;break;case r.keys.LEFT:T(r.keyPanSpeed,0),t=!0;break;case r.keys.RIGHT:T(-r.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),r.update())}(e)}function N(e){!1!==r.enabled&&e.preventDefault()}function U(e){delete $[e.pointerId];for(let t=0;t<v.length;t++)if(v[t].pointerId==e.pointerId)return void v.splice(t,1)}function j(e){let t=$[e.pointerId];void 0===t&&(t=new(0,$4xklQ.Vector2),$[e.pointerId]=t),t.set(e.pageX,e.pageY)}function q(e){const t=e.pointerId===v[0].pointerId?v[1]:v[0];return $[t.pointerId]}r.domElement.addEventListener("contextmenu",N),r.domElement.addEventListener("pointerdown",W),r.domElement.addEventListener("pointercancel",Q),r.domElement.addEventListener("wheel",z,{passive:!1}),this.update()}}class $a69b488eccbcfd7b$export$7628ccdac312035f extends $a69b488eccbcfd7b$export$8ff7788029dfdf52{constructor(e,t){super(e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=$4xklQ.MOUSE.PAN,this.mouseButtons.RIGHT=$4xklQ.MOUSE.ROTATE,this.touches.ONE=$4xklQ.TOUCH.PAN,this.touches.TWO=$4xklQ.TOUCH.DOLLY_ROTATE}}class $3c82f100e7ba0388$export$bc845c5c4f62a4a1{constructor(e,t,i,r,n,o,a){this.editor=e,this.newCamera=t,this.scene=i,this.newRenderer=r,this.box=n,this.miniMapWidth=o,this.miniMapHeight=a}main(){let e=document.getElementsByClassName("miniBox")[0];for(var t=e.firstElementChild;t;)t.remove(),t=e.firstElementChild;if(this.newCamera.isOrthographicCamera&&this.newCamera.position.set(0,0,1e3),e.appendChild(this.newRenderer.domElement),this.newCamera.isOrthographicCamera){let e=this.miniMapWidth/this.miniMapHeight,t=-5e3;this.newCamera.left=t*e,this.newCamera.right=-t*e,this.newCamera.top=-t,this.newCamera.bottom=t}else this.newCamera.aspect=this.miniMapWidth/this.miniMapHeight;this.newCamera.updateProjectionMatrix(),this.newRenderer.setSize(this.miniMapWidth,this.miniMapHeight),this.newCamera.updateProjectionMatrix(),""!=this.editor.miniControls2d&&(this.editor.miniControls2d.enabled=!1),""!=this.editor.miniControls3d&&(this.editor.miniControls3d.enabled=!1),this.newCamera.isOrthographicCamera?(this.editor.miniControls2d=new $a69b488eccbcfd7b$export$8ff7788029dfdf52(this.newCamera,e,this.editor),this.editor.miniControls2d.enableRotate=!1):this.editor.miniControls3d=new $a69b488eccbcfd7b$export$8ff7788029dfdf52(this.newCamera,e,this.editor),this.updateMapMan()}updateMapMan(){var e=document.querySelector(".miniMapMan"),t=this.computeDeg();if(e.style.transform="rotateZ(".concat(t,"deg)"),this.editor.miniMapCamera.isOrthographicCamera){let t=this.getScreenPosition();e.style.left=t.x+"px",e.style.top=t.y+"px"}}getScreenPosition(){var e=document.querySelector(".miniMapDom");let t=this.editor.viewportCamera.position.clone(),i=300;"3dRomaCamera"==this.editor.viewportCamera.name&&(t=this.editor.viewportCamera.realPosition.clone(),i=1e3);let r=new(0,$4xklQ.Vector3)(t.x*i,t.z*i,t.y*i);r=r.project(this.editor.miniMapCamera);let n=e.offsetWidth/2,o=e.offsetHeight/2;return{x:Math.round(r.x*n+n),y:Math.round(r.y*o+o)}}computeDeg=function(){var e=new(0,$4xklQ.Vector3)(0,0,-1),t=new(0,$4xklQ.Vector3)(-1,0,0),i=this.editor.camera.getWorldDirection(new(0,$4xklQ.Vector3)).normalize();i.setY(0);var r=i.angleTo(e),n=i.angleTo(t),o=$4xklQ.MathUtils.radToDeg(r);return($4xklQ.MathUtils.radToDeg(n)>=90?o:180-o+180)+180}}class $523a84362d27c3e8$export$b680ca477a72be07{constructor(e="",t=""){this.stroke=$0f7bfe5028a81ceb$export$18d19c7a3aa33064({thickness:240,cap:"butt"}),this.editor=e,this.object=t}createLineWall(e,t,i=240){if(2==this.editor.innerDraw&&"wall"==this.editor.toolType){let r=t.clone().sub(e.clone()),n=new(0,$4xklQ.Vector2)(-r.y,r.x).setLength(i/2);e=e.clone().add(n),t=t.clone().add(n)}let r=e.clone(),n=t.clone(),o={start:{x:r.x,y:r.y,z:0},end:{x:n.x,y:n.y,z:0},style:2,line:0,isArc:!1,thickness:i,height:window.storeyHei,direction:"",offsetXY:100};return this.makeLineWallByJson(o)}makeLineWallByJson(e){let t=new(0,$4xklQ.Vector2)(e.start.x,e.start.y),i=new(0,$4xklQ.Vector2)(e.end.x,e.end.y),r=this.editor.wallTool.createBottomFace(t,i,e.line,e.thickness);return r.startPoint=t,r.endPoint=i,r.useType="wall",this.editor.wallTool.recordInfo(r,e),r}wallToJson(e="2D",t=[],i="hole"){let r=$9QhXH.DM.getWallJson(this.editor.allWalls),n=$9QhXH.DM.getHoleJson(this.editor.otherMeshs,this.editor),o=$9QhXH.DM.memberJson(this.editor.otherMember);0!=t.length&&(r=t,this.editor.cleanWallHelper());let a=new(0,$5XTH3.DrawWallTool),s=a.create2DWall(r),l=s.pop(),c=this.editor.floorGroup2d.children;this.editor.floorGroup.children;this.editor.wallGroup.children=[],this.editor.wallGroup3D.children=[],this.editor.floorGroup.children=[],this.editor.memberGroup3D.children=[],this.editor.lineGroup3D.children=[],this.editor.floorGroup2d.children=[],l.length>0&&this.editor.wallGroup.add(...l),this.editor.allWalls=s;let h=this.editor.splitRoomByLine(),d=new $5c31b6cd7f4237f1$export$4880b0ae5643c62b(s,this.editor),u=d.getFloor(h[0],h[1],"3D");if(this.editor.noHiddenDialog||this.editor.list.hiddenDialog.dispatch(),this.editor.allWalls.forEach((e=>{e.material.color=this.editor.getWallColor(e),e.roomCenter=[]})),u.length>0){let e=this.editor.cacheJson,t=[];e?(e=JSON.parse(e),this.editor.addFloor(d,u,"2D",h,e.roomJson),t=e.roomJson):(this.editor.addFloor(d,u,"2D",h),c.forEach((e=>{let i=Number(e.roomCenter[0]).toFixed(2)+"/"+Number(e.roomCenter[1]).toFixed(2);t.push([i,1,1==e.material.color.r])}))),this.editor.floorGroup2d.children.forEach((e=>{let i=e.roomCenter,r=i[0]+"/"+i[1];t.forEach((t=>{r!=t[0]||t[2]||(e.material=new $4xklQ.MeshBasicMaterial({color:15264748,side:$4xklQ.DoubleSide,transparent:e.material.transparent,opacity:e.material.opacity}))}))}))}else this.editor.removeInputByClassName(this.editor.uiPanelBox.dom,"roomName");if(s.length>0&&"hole"==i){this.editor.wallGroup.add(...s);let e=a.switchTo3D(s);this.editor.wallGroup3D.add(...e),this.editor.createDoorCamera(n),n.length>0&&new(0,$5sV3G.DigHole)(this.editor).work(e,n)}let p=[];this.editor.wallGroup3D.children.forEach((e=>{e.height&&p.push(e.height),this.editor.addBoxForMesh(e,[])}));let m=Math.max.apply(null,p);0==p.length&&(m=window.storeyHei),this.editor.wallGroup3D.roomHeight=m;let f=d.getBeamNew(o,this.editor.otherMember);f.forEach((e=>{this.editor.addBoxForMesh(e,[])})),f.length>0&&this.editor.memberGroup3D.add(...f);let g=d.getCeiling();g.length>0&&this.editor.floorGroup.add(...g);let x=(new(0,$4xklQ.Matrix4)).makeScale(.001,.001,.001);1==this.editor.wallGroup3D.scale.x&&(this.editor.wallGroup3D.applyMatrix4(x),this.editor.lineGroup3D.applyMatrix4(x),this.editor.memberGroup3D.applyMatrix4(x),this.editor.floorGroup.applyMatrix4(x)),this.editor.list.showHiddenHelper.dispatch("","only",this.editor.config.settingJson),"3D"==e?(this.editor.toolType="free",this.editor.switchHelperGroup("hidden"),this.editor.hiddenDomsByClassName(this.editor.uiPanelBox.dom,"roomName")):(this.editor.addIntersectPointHelper(),this.editor.switchHelperGroup("show"),$9HO6e.UtilCore.updateLineDimensionsLine(this.editor)),this.editor.allGroup3d.forEach((e=>{e.traverse((function(e){e.layers.set(1)}))})),this.editor.scene.children.slice(0).forEach((e=>{e.startPoint&&"wall"==e.useType&&this.editor.scene.remove(e)})),this.editor.splitRoomLineGroup.children.slice(0).forEach((e=>{"splitOuterLine"==e.useType&&this.editor.splitRoomLineGroup.remove(e)})),this.editor.miniDom=document.getElementById("scrollviewcontent");let b=document.getElementsByClassName("view_box")[0].clientWidth,y=document.getElementsByClassName("view_box")[0].clientHeight;this.editor.miniMapObj=new $3c82f100e7ba0388$export$bc845c5c4f62a4a1(this.editor,this.editor.miniMapCamera,this.editor.scene,this.editor.newRenderer,this.editor.miniDom,b,y-28),this.editor.miniMapObj.main()}createCurveWall(e,t,i="",r=!1,n=240){this.stroke.thickness=n,""==i&&(i=$523a84362d27c3e8$export$b680ca477a72be07.initControlPoint(e,t)),r&&(i=autoHandlePoint(e,t,i));var o=new(0,$4xklQ.QuadraticBezierCurve3)(e,i,t).getPoints(50),a=[];o.forEach((function(e){a.push([e.x,e.y])}));var s=this.stroke.build(a);s=$523a84362d27c3e8$export$b680ca477a72be07.process(a,s);var l=[];s.positions.forEach((function(e){l.push(e[0],e[1],0)}));var c=[];s.cells.forEach((function(e){c.push(e[0],e[1],e[2])}));var h=new(0,$4xklQ.BufferGeometry);h.attributes.position=new(0,$4xklQ.BufferAttribute)(new Float32Array(l),3),h.index=new(0,$4xklQ.BufferAttribute)(new Uint16Array(c),1);var d=new(0,$4xklQ.MeshBasicMaterial)({color:"#4169E1",side:$4xklQ.DoubleSide});return(s=new(0,$4xklQ.Mesh)(h,d)).controlPoint=i,s.startPoint=e,s.endPoint=t,s.useType="wall",s.wallType="rectangleWall",s}createCircleWall(e,t,i,r,n=240){let o={start:{x:1*e.x.toFixed(2),y:1*e.y.toFixed(2),z:0},end:{x:1*t.x.toFixed(2),y:1*t.y.toFixed(2),z:0},style:2,line:0,cp:{x:1*i.x.toFixed(2),y:1*i.y.toFixed(2),z:0},isArc:r,thickness:n,height:window.storeyHei,direction:"",offsetXY:100};var a=this.editor.wallTool.create2DWall([o]);a.pop();return a[0]}splitWall(e,t){let i=e.startPoint,r=e.endPoint,n=Math.abs(i.x-t.x)<.1&&Math.abs(i.y-t.y)<.1,o=Math.abs(r.x-t.x)<.1&&Math.abs(r.y-t.y)<.1;if(n||o)return n&&(e.startPoint=t),o&&(e.endPoint=t),this.editor.allWalls.indexOf(e)<0&&this.editor.allWalls.push(e),[e];this.editor.removeWall(e);let a=this.editor.addWall(i,t),s=this.editor.addWall(t,r);return a.wallID=e.wallID,a.style=e.style,s.style=e.style,a.height=e.height,s.height=e.height,a.thickness=e.thickness,s.thickness=e.thickness,a.material.color=this.editor.getWallColor(a),s.material.color=this.editor.getWallColor(s),this.editor.getAllWindowInWall(e).forEach((n=>{$9HO6e.UtilCore.pointIsInLine(n.center,i,t)?n.wallId=e.wallID:(n.wallId="",n.wallPoint=[t,r])})),[a,s]}static makeControlPoint(e){var t=new(0,$4xklQ.BufferGeometry);let i=80;var r=new Float32Array([e.x-i,e.y-i,0,e.x+i,e.y-i,0,e.x+i,e.y+i,0,e.x-i,e.y+i,0]);t.attributes.position=new(0,$4xklQ.BufferAttribute)(r,3);var n=new Uint16Array([0,1,2,0,2,3]);t.index=new(0,$4xklQ.BufferAttribute)(n,1);var o=new(0,$4xklQ.MeshBasicMaterial)({color:"#4169E1",side:$4xklQ.DoubleSide,transparent:!0}),a=new(0,$4xklQ.Mesh)(t,o);return a.useType="controlPoint",a}static process(e,t,i=[]){return t.innner=[],t.outter=[],e.forEach((function(e){i.push(new $4xklQ.Vector2(e[0],e[1]))})),t.clock=$b590b02110506a77$export$96bdf6d9c66d7ba8.isClockWise(i),t.positions.forEach((function(e,i){i%2==0?t.clock?t.innner.push(e):t.outter.push(e):t.clock?t.outter.push(e):t.innner.push(e)})),t}static initControlPoint(e,t,i=2e3){let r=(e.x+t.x)/2,n=(e.y+t.y)/2,o=new(0,$4xklQ.Vector3)(r,n,0);var a=(new(0,$4xklQ.Vector3)).subVectors(t,e),s=new(0,$4xklQ.Vector3)(-a.y,a.x,0);return s.setLength(i),(new(0,$4xklQ.Vector3)).addVectors(o,s)}}class $523a84362d27c3e8$export$43cb61aa07eebcbc{constructor(e="",t=""){this.editor=e,this.object=t}createRoom(e,t,i=240){let r=new(0,$4xklQ.Vector3)(t.x,e.y,0),n=new(0,$4xklQ.Vector3)(e.x,t.y,0),o=t.x>e.x?t.x+i/2:t.x-i/2,a=t.y>r.y?t.y+i/2:t.y-i/2,s=n.x<t.x?n.x-i/2:n.x+i/2,l=e.y>n.y?e.y+i/2:e.y-i/2,c=new(0,$4xklQ.Vector3)(o,e.y,0),h=new(0,$4xklQ.Vector3)(t.x,a,0),d=new(0,$4xklQ.Vector3)(s,t.y,0),u=new(0,$4xklQ.Vector3)(e.x,l,0),p=new $523a84362d27c3e8$export$b680ca477a72be07(this.editor),m=p.createLineWall(e,c,i),f=p.createLineWall(r,h,i),g=p.createLineWall(t,d,i),x=p.createLineWall(n,u,i);return m.startPoint=e,m.endPoint=r,f.startPoint=r,f.endPoint=t,g.startPoint=t,g.endPoint=n,x.startPoint=n,x.endPoint=e,[m,f,g,x]}createRectangle(e,t,i){let r=new(0,$4xklQ.Vector3)((e[0].x+e[1].x)/2,(e[0].y+e[1].y)/2,0),n=new(0,$4xklQ.PlaneGeometry)(t,i),o=new(0,$4xklQ.MeshLambertMaterial)({color:16776960,side:$4xklQ.DoubleSide}),a=new(0,$4xklQ.Mesh)(n,o);return a.position.x=r.x,a.position.y=r.y,a}}var $5XTH3=parcelRequire("5XTH3"),$9HO6e=parcelRequire("9HO6e"),$4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ");class $cda9fa5069073a5c$export$c32c7942a3d4b7c1{constructor(){this.pluginCallbacks=[],this.register((function(e){return new $cda9fa5069073a5c$var$GLTFLightExtension(e)})),this.register((function(e){return new $cda9fa5069073a5c$var$GLTFMaterialsUnlitExtension(e)})),this.register((function(e){return new $cda9fa5069073a5c$var$GLTFMaterialsPBRSpecularGlossiness(e)})),this.register((function(e){return new $cda9fa5069073a5c$var$GLTFMaterialsTransmissionExtension(e)})),this.register((function(e){return new $cda9fa5069073a5c$var$GLTFMaterialsVolumeExtension(e)})),this.register((function(e){return new $cda9fa5069073a5c$var$GLTFMaterialsClearcoatExtension(e)})),this.register((function(e){return new $cda9fa5069073a5c$var$GLTFMaterialsIridescenceExtension(e)}))}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,r){const n=new $cda9fa5069073a5c$var$GLTFWriter,o=[];for(let e=0,t=this.pluginCallbacks.length;e<t;e++)o.push(this.pluginCallbacks[e](n));n.setPlugins(o),n.write(e,t,r).catch(i)}parseAsync(e,t){const i=this;return new Promise((function(r,n){i.parse(e,r,n,t)}))}}const $cda9fa5069073a5c$var$WEBGL_CONSTANTS={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},$cda9fa5069073a5c$var$THREE_TO_WEBGL={};$cda9fa5069073a5c$var$THREE_TO_WEBGL[$4xklQ.NearestFilter]=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.NEAREST,$cda9fa5069073a5c$var$THREE_TO_WEBGL[$4xklQ.NearestMipmapNearestFilter]=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.NEAREST_MIPMAP_NEAREST,$cda9fa5069073a5c$var$THREE_TO_WEBGL[$4xklQ.NearestMipmapLinearFilter]=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.NEAREST_MIPMAP_LINEAR,$cda9fa5069073a5c$var$THREE_TO_WEBGL[$4xklQ.LinearFilter]=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.LINEAR,$cda9fa5069073a5c$var$THREE_TO_WEBGL[$4xklQ.LinearMipmapNearestFilter]=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.LINEAR_MIPMAP_NEAREST,$cda9fa5069073a5c$var$THREE_TO_WEBGL[$4xklQ.LinearMipmapLinearFilter]=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.LINEAR_MIPMAP_LINEAR,$cda9fa5069073a5c$var$THREE_TO_WEBGL[$4xklQ.ClampToEdgeWrapping]=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.CLAMP_TO_EDGE,$cda9fa5069073a5c$var$THREE_TO_WEBGL[$4xklQ.RepeatWrapping]=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.REPEAT,$cda9fa5069073a5c$var$THREE_TO_WEBGL[$4xklQ.MirroredRepeatWrapping]=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.MIRRORED_REPEAT;const $cda9fa5069073a5c$var$PATH_PROPERTIES={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},$cda9fa5069073a5c$var$GLB_HEADER_BYTES=12,$cda9fa5069073a5c$var$GLB_HEADER_MAGIC=1179937895,$cda9fa5069073a5c$var$GLB_VERSION=2,$cda9fa5069073a5c$var$GLB_CHUNK_PREFIX_BYTES=8,$cda9fa5069073a5c$var$GLB_CHUNK_TYPE_JSON=1313821514,$cda9fa5069073a5c$var$GLB_CHUNK_TYPE_BIN=5130562;function $cda9fa5069073a5c$var$equalArray(e,t){return e.length===t.length&&e.every((function(e,i){return e===t[i]}))}function $cda9fa5069073a5c$var$stringToArrayBuffer(e){return(new TextEncoder).encode(e).buffer}function $cda9fa5069073a5c$var$isIdentityMatrix(e){return $cda9fa5069073a5c$var$equalArray(e.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function $cda9fa5069073a5c$var$getMinMax(e,t,i){const r={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let n=t;n<t+i;n++)for(let t=0;t<e.itemSize;t++){let i;e.itemSize>4?i=e.array[n*e.itemSize+t]:0===t?i=e.getX(n):1===t?i=e.getY(n):2===t?i=e.getZ(n):3===t&&(i=e.getW(n)),r.min[t]=Math.min(r.min[t],i),r.max[t]=Math.max(r.max[t],i)}return r}function $cda9fa5069073a5c$var$getPaddedBufferSize(e){return 4*Math.ceil(e/4)}function $cda9fa5069073a5c$var$getPaddedArrayBuffer(e,t=0){const i=$cda9fa5069073a5c$var$getPaddedBufferSize(e.byteLength);if(i!==e.byteLength){const r=new Uint8Array(i);if(r.set(new Uint8Array(e)),0!==t)for(let n=e.byteLength;n<i;n++)r[n]=t;return r.buffer}return e}function $cda9fa5069073a5c$var$getCanvas(){return"undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function $cda9fa5069073a5c$var$getToBlobPromise(e,t){if(void 0!==e.toBlob)return new Promise((i=>e.toBlob(i,t)));let i;return"image/jpeg"===t?i=.92:"image/webp"===t&&(i=.8),e.convertToBlob({type:t,quality:i})}class $cda9fa5069073a5c$var$GLTFWriter{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,i){this.options=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const r=this,n=r.buffers,o=r.json;i=r.options;const a=r.extensionsUsed,s=new Blob(n,{type:"application/octet-stream"}),l=Object.keys(a);if(l.length>0&&(o.extensionsUsed=l),o.buffers&&o.buffers.length>0&&(o.buffers[0].byteLength=s.size),!0===i.binary){const e=new FileReader;e.readAsArrayBuffer(s),e.onloadend=function(){const i=$cda9fa5069073a5c$var$getPaddedArrayBuffer(e.result),r=new DataView(new ArrayBuffer($cda9fa5069073a5c$var$GLB_CHUNK_PREFIX_BYTES));r.setUint32(0,i.byteLength,!0),r.setUint32(4,$cda9fa5069073a5c$var$GLB_CHUNK_TYPE_BIN,!0);const n=$cda9fa5069073a5c$var$getPaddedArrayBuffer($cda9fa5069073a5c$var$stringToArrayBuffer(JSON.stringify(o)),32),a=new DataView(new ArrayBuffer($cda9fa5069073a5c$var$GLB_CHUNK_PREFIX_BYTES));a.setUint32(0,n.byteLength,!0),a.setUint32(4,$cda9fa5069073a5c$var$GLB_CHUNK_TYPE_JSON,!0);const s=new ArrayBuffer($cda9fa5069073a5c$var$GLB_HEADER_BYTES),l=new DataView(s);l.setUint32(0,$cda9fa5069073a5c$var$GLB_HEADER_MAGIC,!0),l.setUint32(4,$cda9fa5069073a5c$var$GLB_VERSION,!0);const c=$cda9fa5069073a5c$var$GLB_HEADER_BYTES+a.byteLength+n.byteLength+r.byteLength+i.byteLength;l.setUint32(8,c,!0);const h=new Blob([s,a,n,r,i],{type:"application/octet-stream"}),d=new FileReader;d.readAsArrayBuffer(h),d.onloadend=function(){t(d.result)}}}else if(o.buffers&&o.buffers.length>0){const e=new FileReader;e.readAsDataURL(s),e.onloadend=function(){const i=e.result;o.buffers[0].uri=i,t(o)}}else t(o)}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;const i=this.options,r=this.extensionsUsed;try{const n=JSON.parse(JSON.stringify(e.userData));if(i.includeCustomExtensions&&n.gltfExtensions){void 0===t.extensions&&(t.extensions={});for(const e in n.gltfExtensions)t.extensions[e]=n.gltfExtensions[e],r[e]=!0;delete n.gltfExtensions}Object.keys(n).length>0&&(t.extras=n)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}getUID(e,t=!1){if(!1===this.uids.has(e)){const t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new(0,$4xklQ.Vector3);for(let i=0,r=e.count;i<r;i++)if(Math.abs(t.fromBufferAttribute(e,i).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const i=e.clone(),r=new(0,$4xklQ.Vector3);for(let e=0,t=i.count;e<t;e++)r.fromBufferAttribute(i,e),0===r.x&&0===r.y&&0===r.z?r.setX(1):r.normalize(),i.setXYZ(e,r.x,r.y,r.z);return t.attributesNormalized.set(e,i),i}applyTextureTransform(e,t){let i=!1;const r={};0===t.offset.x&&0===t.offset.y||(r.offset=t.offset.toArray(),i=!0),0!==t.rotation&&(r.rotation=t.rotation,i=!0),1===t.repeat.x&&1===t.repeat.y||(r.scale=t.repeat.toArray(),i=!0),i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=r,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function i(e){return e.encoding===$4xklQ.sRGBEncoding?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const r=e?.image,n=t?.image,o=Math.max(r?.width||0,n?.width||0),a=Math.max(r?.height||0,n?.height||0),s=$cda9fa5069073a5c$var$getCanvas();s.width=o,s.height=a;const l=s.getContext("2d");l.fillStyle="#00ffff",l.fillRect(0,0,o,a);const c=l.getImageData(0,0,o,a);if(r){l.drawImage(r,0,0,o,a);const t=i(e),n=l.getImageData(0,0,o,a).data;for(let e=2;e<n.length;e+=4)c.data[e]=256*t(n[e]/256)}if(n){l.drawImage(n,0,0,o,a);const e=i(t),r=l.getImageData(0,0,o,a).data;for(let t=1;t<r.length;t+=4)c.data[t]=256*e(r[t]/256)}l.putImageData(c,0,0);const h=(e||t).clone();return h.source=new(0,$4xklQ.Source)(s),h.encoding=$4xklQ.LinearEncoding,h}processBuffer(e){const t=this.json,i=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),i.push(e),0}processBufferView(e,t,i,r,n){const o=this.json;let a;o.bufferViews||(o.bufferViews=[]),a=t===$cda9fa5069073a5c$var$WEBGL_CONSTANTS.UNSIGNED_BYTE?1:t===$cda9fa5069073a5c$var$WEBGL_CONSTANTS.UNSIGNED_SHORT?2:4;const s=$cda9fa5069073a5c$var$getPaddedBufferSize(r*e.itemSize*a),l=new DataView(new ArrayBuffer(s));let c=0;for(let n=i;n<i+r;n++)for(let i=0;i<e.itemSize;i++){let r;e.itemSize>4?r=e.array[n*e.itemSize+i]:0===i?r=e.getX(n):1===i?r=e.getY(n):2===i?r=e.getZ(n):3===i&&(r=e.getW(n)),t===$cda9fa5069073a5c$var$WEBGL_CONSTANTS.FLOAT?l.setFloat32(c,r,!0):t===$cda9fa5069073a5c$var$WEBGL_CONSTANTS.UNSIGNED_INT?l.setUint32(c,r,!0):t===$cda9fa5069073a5c$var$WEBGL_CONSTANTS.UNSIGNED_SHORT?l.setUint16(c,r,!0):t===$cda9fa5069073a5c$var$WEBGL_CONSTANTS.UNSIGNED_BYTE&&l.setUint8(c,r),c+=a}const h={buffer:this.processBuffer(l.buffer),byteOffset:this.byteOffset,byteLength:s};void 0!==n&&(h.target=n),n===$cda9fa5069073a5c$var$WEBGL_CONSTANTS.ARRAY_BUFFER&&(h.byteStride=e.itemSize*a),this.byteOffset+=s,o.bufferViews.push(h);return{id:o.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,i=t.json;return i.bufferViews||(i.bufferViews=[]),new Promise((function(r){const n=new FileReader;n.readAsArrayBuffer(e),n.onloadend=function(){const e=$cda9fa5069073a5c$var$getPaddedArrayBuffer(n.result),o={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,r(i.bufferViews.push(o)-1)}}))}processAccessor(e,t,i,r){const n=this.options,o=this.json;let a;if(e.array.constructor===Float32Array)a=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.FLOAT;else if(e.array.constructor===Uint32Array)a=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.UNSIGNED_INT;else if(e.array.constructor===Uint16Array)a=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.UNSIGNED_SHORT;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");a=$cda9fa5069073a5c$var$WEBGL_CONSTANTS.UNSIGNED_BYTE}if(void 0===i&&(i=0),void 0===r&&(r=e.count),n.truncateDrawRange&&void 0!==t&&null===t.index){const n=i+r,o=t.drawRange.count===1/0?e.count:t.drawRange.start+t.drawRange.count;i=Math.max(i,t.drawRange.start),(r=Math.min(n,o)-i)<0&&(r=0)}if(0===r)return null;const s=$cda9fa5069073a5c$var$getMinMax(e,i,r);let l;void 0!==t&&(l=e===t.index?$cda9fa5069073a5c$var$WEBGL_CONSTANTS.ELEMENT_ARRAY_BUFFER:$cda9fa5069073a5c$var$WEBGL_CONSTANTS.ARRAY_BUFFER);const c=this.processBufferView(e,a,i,r,l),h={bufferView:c.id,byteOffset:c.byteOffset,componentType:a,count:r,max:s.max,min:s.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(h.normalized=!0),o.accessors||(o.accessors=[]),o.accessors.push(h)-1}processImage(e,t,i,r="image/png"){const n=this,o=n.cache,a=n.json,s=n.options,l=n.pending;o.images.has(e)||o.images.set(e,{});const c=o.images.get(e),h=r+":flipY/"+i.toString();if(void 0!==c[h])return c[h];a.images||(a.images=[]);const d={mimeType:r},u=$cda9fa5069073a5c$var$getCanvas();u.width=Math.min(e.width,s.maxTextureSize),u.height=Math.min(e.height,s.maxTextureSize);const p=u.getContext("2d");if(!0===i&&(p.translate(0,u.height),p.scale(1,-1)),void 0!==e.data){t!==$4xklQ.RGBAFormat&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>s.maxTextureSize||e.height>s.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const i=new Uint8ClampedArray(e.height*e.width*4);for(let t=0;t<i.length;t+=4)i[t+0]=e.data[t+0],i[t+1]=e.data[t+1],i[t+2]=e.data[t+2],i[t+3]=e.data[t+3];p.putImageData(new ImageData(i,e.width,e.height),0,0)}else p.drawImage(e,0,0,u.width,u.height);!0===s.binary?l.push($cda9fa5069073a5c$var$getToBlobPromise(u,r).then((e=>n.processBufferViewImage(e))).then((e=>{d.bufferView=e}))):void 0!==u.toDataURL?d.uri=u.toDataURL(r):l.push($cda9fa5069073a5c$var$getToBlobPromise(u,r).then((e=>(new FileReader).readAsDataURL(e))).then((e=>{d.uri=e})));const m=a.images.push(d)-1;return c[h]=m,m}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const i={magFilter:$cda9fa5069073a5c$var$THREE_TO_WEBGL[e.magFilter],minFilter:$cda9fa5069073a5c$var$THREE_TO_WEBGL[e.minFilter],wrapS:$cda9fa5069073a5c$var$THREE_TO_WEBGL[e.wrapS],wrapT:$cda9fa5069073a5c$var$THREE_TO_WEBGL[e.wrapT]};return t.samplers.push(i)-1}processTexture(e){const t=this.cache,i=this.json;if(t.textures.has(e))return t.textures.get(e);i.textures||(i.textures=[]);let r=e.userData.mimeType;"image/webp"===r&&(r="image/png");const n={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,r)};e.name&&(n.name=e.name),this._invokeAll((function(t){t.writeTexture&&t.writeTexture(e,n)}));const o=i.textures.push(n)-1;return t.textures.set(e,o),o}processMaterial(e){const t=this.cache,i=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;i.materials||(i.materials=[]);const r={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const n=e.color.toArray().concat([e.opacity]);if($cda9fa5069073a5c$var$equalArray(n,[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=n),e.isMeshStandardMaterial?(r.pbrMetallicRoughness.metallicFactor=e.metalness,r.pbrMetallicRoughness.roughnessFactor=e.roughness):(r.pbrMetallicRoughness.metallicFactor=.5,r.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const t=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),i={index:this.processTexture(t)};this.applyTextureTransform(i,t),r.pbrMetallicRoughness.metallicRoughnessTexture=i}if(e.map){const t={index:this.processTexture(e.map)};this.applyTextureTransform(t,e.map),r.pbrMetallicRoughness.baseColorTexture=t}if(e.emissive){const t=e.emissive.clone().multiplyScalar(e.emissiveIntensity),i=Math.max(t.r,t.g,t.b);if(i>1&&(t.multiplyScalar(1/i),console.warn("THREE.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),i>0&&(r.emissiveFactor=t.toArray()),e.emissiveMap){const t={index:this.processTexture(e.emissiveMap)};this.applyTextureTransform(t,e.emissiveMap),r.emissiveTexture=t}}if(e.normalMap){const t={index:this.processTexture(e.normalMap)};e.normalScale&&1!==e.normalScale.x&&(t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),r.normalTexture=t}if(e.aoMap){const t={index:this.processTexture(e.aoMap),texCoord:1};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),r.occlusionTexture=t}e.transparent?r.alphaMode="BLEND":e.alphaTest>0&&(r.alphaMode="MASK",r.alphaCutoff=e.alphaTest),e.side===$4xklQ.DoubleSide&&(r.doubleSided=!0),""!==e.name&&(r.name=e.name),this.serializeUserData(e,r),this._invokeAll((function(t){t.writeMaterial&&t.writeMaterial(e,r)}));const o=i.materials.push(r)-1;return t.materials.set(e,o),o}processMesh(e){const t=this.cache,i=this.json,r=[e.geometry.uuid];if(Array.isArray(e.material))for(let t=0,i=e.material.length;t<i;t++)r.push(e.material[t].uuid);else r.push(e.material.uuid);const n=r.join(":");if(t.meshes.has(n))return t.meshes.get(n);const o=e.geometry;let a;a=e.isLineSegments?$cda9fa5069073a5c$var$WEBGL_CONSTANTS.LINES:e.isLineLoop?$cda9fa5069073a5c$var$WEBGL_CONSTANTS.LINE_LOOP:e.isLine?$cda9fa5069073a5c$var$WEBGL_CONSTANTS.LINE_STRIP:e.isPoints?$cda9fa5069073a5c$var$WEBGL_CONSTANTS.POINTS:e.material.wireframe?$cda9fa5069073a5c$var$WEBGL_CONSTANTS.LINES:$cda9fa5069073a5c$var$WEBGL_CONSTANTS.TRIANGLES;const s={},l={},c=[],h=[],d={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},u=o.getAttribute("normal");void 0===u||this.isNormalizedNormalAttribute(u)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),o.setAttribute("normal",this.createNormalizedNormalAttribute(u)));let p=null;for(let e in o.attributes){if("morph"===e.slice(0,5))continue;const i=o.attributes[e];e=d[e]||e.toUpperCase();if(/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(e)||(e="_"+e),t.attributes.has(this.getUID(i))){l[e]=t.attributes.get(this.getUID(i));continue}p=null;const r=i.array;"JOINTS_0"!==e||r instanceof Uint16Array||r instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),p=new(0,$4xklQ.BufferAttribute)(new Uint16Array(r),i.itemSize,i.normalized));const n=this.processAccessor(p||i,o);null!==n&&(l[e]=n,t.attributes.set(this.getUID(i),n))}if(void 0!==u&&o.setAttribute("normal",u),0===Object.keys(l).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){const i=[],r=[],n={};if(void 0!==e.morphTargetDictionary)for(const t in e.morphTargetDictionary)n[e.morphTargetDictionary[t]]=t;for(let a=0;a<e.morphTargetInfluences.length;++a){const s={};let l=!1;for(const e in o.morphAttributes){if("position"!==e&&"normal"!==e){l||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),l=!0);continue}const i=o.morphAttributes[e][a],r=e.toUpperCase(),n=o.attributes[e];if(t.attributes.has(this.getUID(i,!0))){s[r]=t.attributes.get(this.getUID(i,!0));continue}const c=i.clone();if(!o.morphTargetsRelative)for(let e=0,t=i.count;e<t;e++)c.setXYZ(e,i.getX(e)-n.getX(e),i.getY(e)-n.getY(e),i.getZ(e)-n.getZ(e));s[r]=this.processAccessor(c,o),t.attributes.set(this.getUID(n,!0),s[r])}h.push(s),i.push(e.morphTargetInfluences[a]),void 0!==e.morphTargetDictionary&&r.push(n[a])}s.weights=i,r.length>0&&(s.extras={},s.extras.targetNames=r)}const m=Array.isArray(e.material);if(m&&0===o.groups.length)return null;const f=m?e.material:[e.material],g=m?o.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let e=0,i=g.length;e<i;e++){const i={mode:a,attributes:l};if(this.serializeUserData(o,i),h.length>0&&(i.targets=h),null!==o.index){let r=this.getUID(o.index);void 0===g[e].start&&void 0===g[e].count||(r+=":"+g[e].start+":"+g[e].count),t.attributes.has(r)?i.indices=t.attributes.get(r):(i.indices=this.processAccessor(o.index,o,g[e].start,g[e].count),t.attributes.set(r,i.indices)),null===i.indices&&delete i.indices}const r=this.processMaterial(f[g[e].materialIndex]);null!==r&&(i.material=r),c.push(i)}s.primitives=c,i.meshes||(i.meshes=[]),this._invokeAll((function(t){t.writeMesh&&t.writeMesh(e,s)}));const x=i.meshes.push(s)-1;return t.meshes.set(n,x),x}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const i=e.isOrthographicCamera,r={type:i?"orthographic":"perspective"};return i?r.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:$4xklQ.MathUtils.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(r.name=e.type),t.cameras.push(r)-1}processAnimation(e,t){const i=this.json,r=this.nodeMap;i.animations||(i.animations=[]);const n=(e=$cda9fa5069073a5c$export$c32c7942a3d4b7c1.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,o=[],a=[];for(let e=0;e<n.length;++e){const i=n[e],s=$4xklQ.PropertyBinding.parseTrackName(i.name);let l=$4xklQ.PropertyBinding.findNode(t,s.nodeName);const c=$cda9fa5069073a5c$var$PATH_PROPERTIES[s.propertyName];if("bones"===s.objectName&&(l=!0===l.isSkinnedMesh?l.skeleton.getBoneByName(s.objectIndex):void 0),!l||!c)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',i.name),null;const h=1;let d,u=i.values.length/i.times.length;c===$cda9fa5069073a5c$var$PATH_PROPERTIES.morphTargetInfluences&&(u/=l.morphTargetInfluences.length),!0===i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(d="CUBICSPLINE",u/=3):d=i.getInterpolation()===$4xklQ.InterpolateDiscrete?"STEP":"LINEAR",a.push({input:this.processAccessor(new(0,$4xklQ.BufferAttribute)(i.times,h)),output:this.processAccessor(new(0,$4xklQ.BufferAttribute)(i.values,u)),interpolation:d}),o.push({sampler:a.length-1,target:{node:r.get(l),path:c}})}return i.animations.push({name:e.name||"clip_"+i.animations.length,samplers:a,channels:o}),i.animations.length-1}processSkin(e){const t=this.json,i=this.nodeMap,r=t.nodes[i.get(e)],n=e.skeleton;if(void 0===n)return null;const o=e.skeleton.bones[0];if(void 0===o)return null;const a=[],s=new Float32Array(16*n.bones.length),l=new(0,$4xklQ.Matrix4);for(let t=0;t<n.bones.length;++t)a.push(i.get(n.bones[t])),l.copy(n.boneInverses[t]),l.multiply(e.bindMatrix).toArray(s,16*t);void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new(0,$4xklQ.BufferAttribute)(s,16)),joints:a,skeleton:i.get(o)});return r.skin=t.skins.length-1}processNode(e){const t=this.json,i=this.options,r=this.nodeMap;t.nodes||(t.nodes=[]);const n={};if(i.trs){const t=e.quaternion.toArray(),i=e.position.toArray(),r=e.scale.toArray();$cda9fa5069073a5c$var$equalArray(t,[0,0,0,1])||(n.rotation=t),$cda9fa5069073a5c$var$equalArray(i,[0,0,0])||(n.translation=i),$cda9fa5069073a5c$var$equalArray(r,[1,1,1])||(n.scale=r)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===$cda9fa5069073a5c$var$isIdentityMatrix(e.matrix)&&(n.matrix=e.matrix.elements);if(""!==e.name&&(n.name=String(e.name)),this.serializeUserData(e,n),e.isMesh||e.isLine||e.isPoints){const t=this.processMesh(e);null!==t&&(n.mesh=t)}else e.isCamera&&(n.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const t=[];for(let r=0,n=e.children.length;r<n;r++){const n=e.children[r];if(n.visible||!1===i.onlyVisible){const e=this.processNode(n);null!==e&&t.push(e)}}t.length>0&&(n.children=t)}this._invokeAll((function(t){t.writeNode&&t.writeNode(e,n)}));const o=t.nodes.push(n)-1;return r.set(e,o),o}processScene(e){const t=this.json,i=this.options;t.scenes||(t.scenes=[],t.scene=0);const r={};""!==e.name&&(r.name=e.name),t.scenes.push(r);const n=[];for(let t=0,r=e.children.length;t<r;t++){const r=e.children[t];if(r.visible||!1===i.onlyVisible){const e=this.processNode(r);null!==e&&n.push(e)}}n.length>0&&(r.nodes=n),this.serializeUserData(e,r)}processObjects(e){const t=new(0,$4xklQ.Scene);t.name="AuxScene";for(let i=0;i<e.length;i++)t.children.push(e[i]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll((function(t){t.beforeParse&&t.beforeParse(e)}));const i=[];for(let t=0;t<e.length;t++)e[t]instanceof $4xklQ.Scene?this.processScene(e[t]):i.push(e[t]);i.length>0&&this.processObjects(i);for(let e=0;e<this.skins.length;++e)this.processSkin(this.skins[e]);for(let i=0;i<t.animations.length;++i)this.processAnimation(t.animations[i],e[0]);this._invokeAll((function(t){t.afterParse&&t.afterParse(e)}))}_invokeAll(e){for(let t=0,i=this.plugins.length;t<i;t++)e(this.plugins[t])}}class $cda9fa5069073a5c$var$GLTFLightExtension{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const i=this.writer,r=i.json,n=i.extensionsUsed,o={};e.name&&(o.name=e.name),o.color=e.color.toArray(),o.intensity=e.intensity,e.isDirectionalLight?o.type="directional":e.isPointLight?(o.type="point",e.distance>0&&(o.range=e.distance)):e.isSpotLight&&(o.type="spot",e.distance>0&&(o.range=e.distance),o.spot={},o.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,o.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),n[this.name]||(r.extensions=r.extensions||{},r.extensions[this.name]={lights:[]},n[this.name]=!0);const a=r.extensions[this.name].lights;a.push(o),t.extensions=t.extensions||{},t.extensions[this.name]={light:a.length-1}}}class $cda9fa5069073a5c$var$GLTFMaterialsUnlitExtension{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const i=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},i[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class $cda9fa5069073a5c$var$GLTFMaterialsPBRSpecularGlossiness{constructor(e){this.writer=e,this.name="KHR_materials_pbrSpecularGlossiness"}writeMaterial(e,t){if(!e.isGLTFSpecularGlossinessMaterial)return;const i=this.writer,r=i.extensionsUsed,n={};t.pbrMetallicRoughness.baseColorFactor&&(n.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor);const o=[1,1,1];if(e.specular.toArray(o,0),n.specularFactor=o,n.glossinessFactor=e.glossiness,t.pbrMetallicRoughness.baseColorTexture&&(n.diffuseTexture=t.pbrMetallicRoughness.baseColorTexture),e.specularMap){const t={index:i.processTexture(e.specularMap)};i.applyTextureTransform(t,e.specularMap),n.specularGlossinessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,r[this.name]=!0}}class $cda9fa5069073a5c$var$GLTFMaterialsClearcoatExtension{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;const i=this.writer,r=i.extensionsUsed,n={};if(n.clearcoatFactor=e.clearcoat,e.clearcoatMap){const t={index:i.processTexture(e.clearcoatMap)};i.applyTextureTransform(t,e.clearcoatMap),n.clearcoatTexture=t}if(n.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const t={index:i.processTexture(e.clearcoatRoughnessMap)};i.applyTextureTransform(t,e.clearcoatRoughnessMap),n.clearcoatRoughnessTexture=t}if(e.clearcoatNormalMap){const t={index:i.processTexture(e.clearcoatNormalMap)};i.applyTextureTransform(t,e.clearcoatNormalMap),n.clearcoatNormalTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,r[this.name]=!0}}class $cda9fa5069073a5c$var$GLTFMaterialsIridescenceExtension{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;const i=this.writer,r=i.extensionsUsed,n={};if(n.iridescenceFactor=e.iridescence,e.iridescenceMap){const t={index:i.processTexture(e.iridescenceMap)};i.applyTextureTransform(t,e.iridescenceMap),n.iridescenceTexture=t}if(n.iridescenceIor=e.iridescenceIOR,n.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],n.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const t={index:i.processTexture(e.iridescenceThicknessMap)};i.applyTextureTransform(t,e.iridescenceThicknessMap),n.iridescenceThicknessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,r[this.name]=!0}}class $cda9fa5069073a5c$var$GLTFMaterialsTransmissionExtension{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const i=this.writer,r=i.extensionsUsed,n={};if(n.transmissionFactor=e.transmission,e.transmissionMap){const t={index:i.processTexture(e.transmissionMap)};i.applyTextureTransform(t,e.transmissionMap),n.transmissionTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,r[this.name]=!0}}class $cda9fa5069073a5c$var$GLTFMaterialsVolumeExtension{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const i=this.writer,r=i.extensionsUsed,n={};if(n.thicknessFactor=e.thickness,e.thicknessMap){const t={index:i.processTexture(e.thicknessMap)};i.applyTextureTransform(t,e.thicknessMap),n.thicknessTexture=t}n.attenuationDistance=e.attenuationDistance,n.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,r[this.name]=!0}}$cda9fa5069073a5c$export$c32c7942a3d4b7c1.Utils={insertKeyframe:function(e,t){const i=.001,r=e.getValueSize(),n=new e.TimeBufferType(e.times.length+1),o=new e.ValueBufferType(e.values.length+r),a=e.createInterpolant(new e.ValueBufferType(r));let s;if(0===e.times.length){n[0]=t;for(let e=0;e<r;e++)o[e]=0;s=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<i)return 0;n[0]=t,n.set(e.times,1),o.set(a.evaluate(t),0),o.set(e.values,r),s=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<i)return e.times.length-1;n[n.length-1]=t,n.set(e.times,0),o.set(e.values,0),o.set(a.evaluate(t),e.values.length),s=n.length-1}else for(let l=0;l<e.times.length;l++){if(Math.abs(e.times[l]-t)<i)return l;if(e.times[l]<t&&e.times[l+1]>t){n.set(e.times.slice(0,l+1),0),n[l+1]=t,n.set(e.times.slice(l+1),l+2),o.set(e.values.slice(0,(l+1)*r),0),o.set(a.evaluate(t),(l+1)*r),o.set(e.values.slice((l+1)*r),(l+2)*r),s=l+1;break}}return e.times=n,e.values=o,s},mergeMorphTargetTracks:function(e,t){const i=[],r={},n=e.tracks;for(let e=0;e<n.length;++e){let o=n[e];const a=$4xklQ.PropertyBinding.parseTrackName(o.name),s=$4xklQ.PropertyBinding.findNode(t,a.nodeName);if("morphTargetInfluences"!==a.propertyName||void 0===a.propertyIndex){i.push(o);continue}if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),o=o.clone(),o.setInterpolation($4xklQ.InterpolateLinear)}const l=s.morphTargetInfluences.length,c=s.morphTargetDictionary[a.propertyIndex];if(void 0===c)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let h;if(void 0===r[s.uuid]){h=o.clone();const e=new h.ValueBufferType(l*h.times.length);for(let t=0;t<h.times.length;t++)e[t*l+c]=h.values[t];h.name=(a.nodeName||"")+".morphTargetInfluences",h.values=e,r[s.uuid]=h,i.push(h);continue}const d=o.createInterpolant(new o.ValueBufferType(1));h=r[s.uuid];for(let e=0;e<h.times.length;e++)h.values[e*l+c]=d.evaluate(h.times[e]);for(let e=0;e<o.times.length;e++){const t=this.insertKeyframe(h,o.times[e]);h.values[t*l+c]=o.values[e]}}return e.tracks=i,e}};var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ");class $95d6a1447ab71b35$export$c682e94218fd2425{constructor(){this.id=0,this.object=null,this.z=0,this.renderOrder=0}}class $95d6a1447ab71b35$export$1cd1d524e22c1604{constructor(){this.id=0,this.v1=new $95d6a1447ab71b35$export$b1d83c23148ffa1b,this.v2=new $95d6a1447ab71b35$export$b1d83c23148ffa1b,this.v3=new $95d6a1447ab71b35$export$b1d83c23148ffa1b,this.normalModel=new(0,$4xklQ.Vector3),this.vertexNormalsModel=[new(0,$4xklQ.Vector3),new(0,$4xklQ.Vector3),new(0,$4xklQ.Vector3)],this.vertexNormalsLength=0,this.color=new(0,$4xklQ.Color),this.material=null,this.uvs=[new(0,$4xklQ.Vector2),new(0,$4xklQ.Vector2),new(0,$4xklQ.Vector2)],this.z=0,this.renderOrder=0}}class $95d6a1447ab71b35$export$b1d83c23148ffa1b{constructor(){this.position=new(0,$4xklQ.Vector3),this.positionWorld=new(0,$4xklQ.Vector3),this.positionScreen=new(0,$4xklQ.Vector4),this.visible=!0}copy(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)}}class $95d6a1447ab71b35$export$a3be0aa4e4a40577{constructor(){this.id=0,this.v1=new $95d6a1447ab71b35$export$b1d83c23148ffa1b,this.v2=new $95d6a1447ab71b35$export$b1d83c23148ffa1b,this.vertexColors=[new(0,$4xklQ.Color),new(0,$4xklQ.Color)],this.material=null,this.z=0,this.renderOrder=0}}class $95d6a1447ab71b35$export$2a395e50c8655b14{constructor(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new(0,$4xklQ.Vector2),this.material=null,this.renderOrder=0}}class $95d6a1447ab71b35$export$c1e1cb5f4fbcd06d{constructor(){let e,t,i,r,n,o,a,s,l,c,h,d=0,u=0,p=0,m=0,f=0;const g={objects:[],lights:[],elements:[]},x=new(0,$4xklQ.Vector3),b=new(0,$4xklQ.Vector4),y=new(0,$4xklQ.Box3)(new(0,$4xklQ.Vector3)(-1,-1,-1),new(0,$4xklQ.Vector3)(1,1,1)),w=new(0,$4xklQ.Box3),v=new Array(3),$=new(0,$4xklQ.Matrix4),M=new(0,$4xklQ.Matrix4),S=new(0,$4xklQ.Matrix4),P=new(0,$4xklQ.Frustum),k=[],_=[],T=[],C=[],A=[];const D=new function(){const e=[],t=[],o=[];let l=null;const c=new(0,$4xklQ.Matrix3);function d(e){const t=e.position,i=e.positionWorld,r=e.positionScreen;i.copy(t).applyMatrix4(h),r.copy(i).applyMatrix4(M);const n=1/r.w;r.x*=n,r.y*=n,r.z*=n,e.visible=r.x>=-1&&r.x<=1&&r.y>=-1&&r.y<=1&&r.z>=-1&&r.z<=1}function p(e,t,i){return!0===e.visible||!0===t.visible||!0===i.visible||(v[0]=e.positionScreen,v[1]=t.positionScreen,v[2]=i.positionScreen,y.intersectsBox(w.setFromPoints(v)))}function f(e,t,i){return(i.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(i.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0}return{setObject:function(i){l=i,c.getNormalMatrix(l.matrixWorld),e.length=0,t.length=0,o.length=0},projectVertex:d,checkTriangleVisibility:p,checkBackfaceCulling:f,pushVertex:function(e,t,n){i=function(){if(r===u){const e=new $95d6a1447ab71b35$export$b1d83c23148ffa1b;return _.push(e),u++,r++,e}return _[r++]}(),i.position.set(e,t,n),d(i)},pushNormal:function(t,i,r){e.push(t,i,r)},pushColor:function(e,i,r){t.push(e,i,r)},pushUv:function(e,t){o.push(e,t)},pushLine:function(e,i){const r=_[e],n=_[i];r.positionScreen.copy(r.position).applyMatrix4(S),n.positionScreen.copy(n.position).applyMatrix4(S),!0===function(e,t){let i=0,r=1;const n=e.z+e.w,o=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return n>=0&&o>=0&&a>=0&&s>=0||!(n<0&&o<0||a<0&&s<0)&&(n<0?i=Math.max(i,n/(n-o)):o<0&&(r=Math.min(r,n/(n-o))),a<0?i=Math.max(i,a/(a-s)):s<0&&(r=Math.min(r,a/(a-s))),!(r<i)&&(e.lerp(t,i),t.lerp(e,1-r),!0))}(r.positionScreen,n.positionScreen)&&(r.positionScreen.multiplyScalar(1/r.positionScreen.w),n.positionScreen.multiplyScalar(1/n.positionScreen.w),a=function(){if(s===m){const e=new $95d6a1447ab71b35$export$a3be0aa4e4a40577;return C.push(e),m++,s++,e}return C[s++]}(),a.id=l.id,a.v1.copy(r),a.v2.copy(n),a.z=Math.max(r.positionScreen.z,n.positionScreen.z),a.renderOrder=l.renderOrder,a.material=l.material,l.material.vertexColors&&(a.vertexColors[0].fromArray(t,3*e),a.vertexColors[1].fromArray(t,3*i)),g.elements.push(a))},pushTriangle:function(i,r,a,s){const h=_[i],d=_[r],u=_[a];if(!1!==p(h,d,u)&&(s.side===$4xklQ.DoubleSide||!0===f(h,d,u))){n=I(),n.id=l.id,n.v1.copy(h),n.v2.copy(d),n.v3.copy(u),n.z=(h.positionScreen.z+d.positionScreen.z+u.positionScreen.z)/3,n.renderOrder=l.renderOrder,x.subVectors(u.position,d.position),b.subVectors(h.position,d.position),x.cross(b),n.normalModel.copy(x),n.normalModel.applyMatrix3(c).normalize();for(let t=0;t<3;t++){const i=n.vertexNormalsModel[t];i.fromArray(e,3*arguments[t]),i.applyMatrix3(c).normalize();n.uvs[t].fromArray(o,2*arguments[t])}n.vertexNormalsLength=3,n.material=s,s.vertexColors&&n.color.fromArray(t,3*i),g.elements.push(n)}}}};function R(e){if(!1===e.visible)return;if(e.isLight)g.lights.push(e);else if(e.isMesh||e.isLine||e.isPoints){if(!1===e.material.visible)return;if(!0===e.frustumCulled&&!1===P.intersectsObject(e))return;E(e)}else if(e.isSprite){if(!1===e.material.visible)return;if(!0===e.frustumCulled&&!1===P.intersectsSprite(e))return;E(e)}const t=e.children;for(let e=0,i=t.length;e<i;e++)R(t[e])}function E(i){e=function(){if(t===d){const e=new $95d6a1447ab71b35$export$c682e94218fd2425;return k.push(e),d++,t++,e}return k[t++]}(),e.id=i.id,e.object=i,x.setFromMatrixPosition(i.matrixWorld),x.applyMatrix4(M),e.z=x.z,e.renderOrder=i.renderOrder,g.objects.push(e)}function L(e,t,i){const r=1/e.w;e.z*=r,e.z>=-1&&e.z<=1&&(l=function(){if(c===f){const e=new $95d6a1447ab71b35$export$2a395e50c8655b14;return A.push(e),f++,c++,e}return A[c++]}(),l.id=t.id,l.x=e.x*r,l.y=e.y*r,l.z=e.z,l.renderOrder=t.renderOrder,l.object=t,l.rotation=t.rotation,l.scale.x=t.scale.x*Math.abs(l.x-(e.x+i.projectionMatrix.elements[0])/(e.w+i.projectionMatrix.elements[12])),l.scale.y=t.scale.y*Math.abs(l.y-(e.y+i.projectionMatrix.elements[5])/(e.w+i.projectionMatrix.elements[13])),l.material=t.material,g.elements.push(l))}function I(){if(o===p){const e=new $95d6a1447ab71b35$export$1cd1d524e22c1604;return T.push(e),p++,o++,e}return T[o++]}function B(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}this.projectScene=function(e,i,n,a){o=0,s=0,c=0,g.elements.length=0,!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===i.parent&&!0===i.matrixWorldAutoUpdate&&i.updateMatrixWorld(),$.copy(i.matrixWorldInverse),M.multiplyMatrices(i.projectionMatrix,$),P.setFromProjectionMatrix(M),t=0,g.objects.length=0,g.lights.length=0,R(e),!0===n&&g.objects.sort(B);const l=g.objects;for(let e=0,t=l.length;e<t;e++){const t=l[e].object,n=t.geometry;if(D.setObject(t),h=t.matrixWorld,r=0,t.isMesh){let e=t.material;const i=Array.isArray(e),r=n.attributes,o=n.groups;if(void 0===r.position)continue;const a=r.position.array;for(let e=0,i=a.length;e<i;e+=3){let i=a[e],r=a[e+1],o=a[e+2];const s=n.morphAttributes.position;if(void 0!==s){const l=n.morphTargetsRelative,c=t.morphTargetInfluences;for(let t=0,n=s.length;t<n;t++){const n=c[t];if(0===n)continue;const h=s[t];l?(i+=h.getX(e/3)*n,r+=h.getY(e/3)*n,o+=h.getZ(e/3)*n):(i+=(h.getX(e/3)-a[e])*n,r+=(h.getY(e/3)-a[e+1])*n,o+=(h.getZ(e/3)-a[e+2])*n)}}D.pushVertex(i,r,o)}if(void 0!==r.normal){const e=r.normal.array;for(let t=0,i=e.length;t<i;t+=3)D.pushNormal(e[t],e[t+1],e[t+2])}if(void 0!==r.color){const e=r.color.array;for(let t=0,i=e.length;t<i;t+=3)D.pushColor(e[t],e[t+1],e[t+2])}if(void 0!==r.uv){const e=r.uv.array;for(let t=0,i=e.length;t<i;t+=2)D.pushUv(e[t],e[t+1])}if(null!==n.index){const r=n.index.array;if(o.length>0)for(let n=0;n<o.length;n++){const a=o[n];if(e=!0===i?t.material[a.materialIndex]:t.material,void 0!==e)for(let t=a.start,i=a.start+a.count;t<i;t+=3)D.pushTriangle(r[t],r[t+1],r[t+2],e)}else for(let t=0,i=r.length;t<i;t+=3)D.pushTriangle(r[t],r[t+1],r[t+2],e)}else if(o.length>0)for(let r=0;r<o.length;r++){const n=o[r];if(e=!0===i?t.material[n.materialIndex]:t.material,void 0!==e)for(let t=n.start,i=n.start+n.count;t<i;t+=3)D.pushTriangle(t,t+1,t+2,e)}else for(let t=0,i=a.length/3;t<i;t+=3)D.pushTriangle(t,t+1,t+2,e)}else if(t.isLine){S.multiplyMatrices(M,h);const e=n.attributes;if(void 0!==e.position){const i=e.position.array;for(let e=0,t=i.length;e<t;e+=3)D.pushVertex(i[e],i[e+1],i[e+2]);if(void 0!==e.color){const t=e.color.array;for(let e=0,i=t.length;e<i;e+=3)D.pushColor(t[e],t[e+1],t[e+2])}if(null!==n.index){const e=n.index.array;for(let t=0,i=e.length;t<i;t+=2)D.pushLine(e[t],e[t+1])}else{const e=t.isLineSegments?2:1;for(let t=0,r=i.length/3-1;t<r;t+=e)D.pushLine(t,t+1)}}}else if(t.isPoints){S.multiplyMatrices(M,h);const e=n.attributes;if(void 0!==e.position){const r=e.position.array;for(let e=0,n=r.length;e<n;e+=3)b.set(r[e],r[e+1],r[e+2],1),b.applyMatrix4(S),L(b,t,i)}}else t.isSprite&&(t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),b.set(h.elements[12],h.elements[13],h.elements[14],1),b.applyMatrix4(M),L(b,t,i))}return!0===a&&g.elements.sort(B),g}}}class $9aaa1afb37141370$export$a7d407e21d82038d extends $4xklQ.Object3D{constructor(e){super(),this.isSVGObject=!0,this.node=e}}class $9aaa1afb37141370$export$42e42f98ac770ce0{constructor(){let e,t,i,r,n,o,a,s,l,c,h,d,u,p=0,m=null,f=1;const g=this,x=new(0,$4xklQ.Box2),b=new(0,$4xklQ.Box2),y=new(0,$4xklQ.Color),w=new(0,$4xklQ.Color),v=new(0,$4xklQ.Color),$=new(0,$4xklQ.Color),M=new(0,$4xklQ.Color),S=new(0,$4xklQ.Color),P=new(0,$4xklQ.Vector3),k=new(0,$4xklQ.Vector3),_=new(0,$4xklQ.Vector3),T=new(0,$4xklQ.Matrix3),C=new(0,$4xklQ.Matrix4),A=new(0,$4xklQ.Matrix4),D=[],R=new $95d6a1447ab71b35$export$c1e1cb5f4fbcd06d,E=document.createElementNS("http://www.w3.org/2000/svg","svg");function L(){for(p=0;E.childNodes.length>0;)E.removeChild(E.childNodes[0])}function I(e){return null!==m?e.toFixed(m):e}function B(e,t,i){let r=t.scale.x*o,n=t.scale.y*a;i.isPointsMaterial&&(r*=i.size,n*=i.size);const s="M"+I(e.x-.5*r)+","+I(e.y-.5*n)+"h"+I(r)+"v"+I(n)+"h"+I(-r)+"z";let l="";(i.isSpriteMaterial||i.isPointsMaterial)&&(l="fill:"+i.color.getStyle()+";fill-opacity:"+i.opacity),H(l,s)}function V(e,t,i){const r="M"+I(e.positionScreen.x)+","+I(e.positionScreen.y)+"L"+I(t.positionScreen.x)+","+I(t.positionScreen.y);if(i.isLineBasicMaterial){let e="fill:none;stroke:"+i.color.getStyle()+";stroke-opacity:"+i.opacity+";stroke-width:"+i.linewidth+";stroke-linecap:"+i.linecap;i.isLineDashedMaterial&&(e=e+";stroke-dasharray:"+i.dashSize+","+i.gapSize),H(e,r)}}function O(e,t,r,n,o){g.info.render.vertices+=3,g.info.render.faces++;const a="M"+I(e.positionScreen.x)+","+I(e.positionScreen.y)+"L"+I(t.positionScreen.x)+","+I(t.positionScreen.y)+"L"+I(r.positionScreen.x)+","+I(r.positionScreen.y)+"z";let s="";o.isMeshBasicMaterial?(y.copy(o.color),o.vertexColors&&y.multiply(n.color)):o.isMeshLambertMaterial||o.isMeshPhongMaterial||o.isMeshStandardMaterial?(w.copy(o.color),o.vertexColors&&w.multiply(n.color),y.copy(v),k.copy(e.positionWorld).add(t.positionWorld).add(r.positionWorld).divideScalar(3),function(e,t,i,r){for(let n=0,o=e.length;n<o;n++){const o=e[n],a=o.color;if(o.isDirectionalLight){const e=P.setFromMatrixPosition(o.matrixWorld).normalize();let t=i.dot(e);if(t<=0)continue;t*=o.intensity,r.r+=a.r*t,r.g+=a.g*t,r.b+=a.b*t}else if(o.isPointLight){const e=P.setFromMatrixPosition(o.matrixWorld);let n=i.dot(P.subVectors(e,t).normalize());if(n<=0)continue;if(n*=0==o.distance?1:1-Math.min(t.distanceTo(e)/o.distance,1),0==n)continue;n*=o.intensity,r.r+=a.r*n,r.g+=a.g*n,r.b+=a.b*n}}}(i,k,n.normalModel,y),y.multiply(w).add(o.emissive)):o.isMeshNormalMaterial&&(_.copy(n.normalModel).applyMatrix3(T).normalize(),y.setRGB(_.x,_.y,_.z).multiplyScalar(.5).addScalar(.5)),s=o.wireframe?"fill:none;stroke:"+y.getStyle()+";stroke-opacity:"+o.opacity+";stroke-width:"+o.wireframeLinewidth+";stroke-linecap:"+o.wireframeLinecap+";stroke-linejoin:"+o.wireframeLinejoin:"fill:"+y.getStyle()+";fill-opacity:"+o.opacity,H(s,a)}function W(e,t,i){let r=t.x-e.x,n=t.y-e.y;const o=r*r+n*n;if(0===o)return;const a=i/Math.sqrt(o);r*=a,n*=a,t.x+=r,t.y+=n,e.x-=r,e.y-=n}function H(e,t){u===e?d+=t:(F(),u=e,d=t)}function F(){d&&(h=function(e){if(null==D[e])return D[e]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==f&&D[e].setAttribute("shape-rendering","crispEdges"),D[e];return D[e]}(p++),h.setAttribute("d",d),h.setAttribute("style",u),E.appendChild(h)),d="",u=""}this.domElement=E,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.overdraw=.5,this.info={render:{vertices:0,faces:0}},this.setQuality=function(e){switch(e){case"high":f=1;break;case"low":f=0}},this.setClearColor=function(e){S.set(e)},this.setPixelRatio=function(){},this.setSize=function(e,t){r=e,n=t,o=r/2,a=n/2,E.setAttribute("viewBox",-o+" "+-a+" "+r+" "+n),E.setAttribute("width",r),E.setAttribute("height",n),x.min.set(-o,-a),x.max.set(o,a)},this.getSize=function(){return{width:r,height:n}},this.setPrecision=function(e){m=e},this.clear=function(){L(),E.style.backgroundColor=S.getStyle()},this.render=function(r,n){if(n instanceof $4xklQ.Camera==!1)return void console.error("THREE.SVGRenderer.render: camera is not an instance of Camera.");const h=r.background;h&&h.isColor?(L(),E.style.backgroundColor=h.getStyle()):!0===this.autoClear&&this.clear(),g.info.render.vertices=0,g.info.render.faces=0,C.copy(n.matrixWorldInverse),A.multiplyMatrices(n.projectionMatrix,C),e=R.projectScene(r,n,this.sortObjects,this.sortElements),t=e.elements,i=e.lights,T.getNormalMatrix(n.matrixWorldInverse),function(e){v.setRGB(0,0,0),$.setRGB(0,0,0),M.setRGB(0,0,0);for(let t=0,i=e.length;t<i;t++){const i=e[t],r=i.color;i.isAmbientLight?(v.r+=r.r,v.g+=r.g,v.b+=r.b):i.isDirectionalLight?($.r+=r.r,$.g+=r.g,$.b+=r.b):i.isPointLight&&(M.r+=r.r,M.g+=r.g,M.b+=r.b)}}(i),d="",u="";for(let e=0,i=t.length;e<i;e++){const i=t[e],r=i.material;if(void 0!==r&&0!==r.opacity)if(b.makeEmpty(),i instanceof $95d6a1447ab71b35$export$2a395e50c8655b14)s=i,s.x*=o,s.y*=-a,B(s,i,r);else if(i instanceof $95d6a1447ab71b35$export$a3be0aa4e4a40577)s=i.v1,l=i.v2,s.positionScreen.x*=o,s.positionScreen.y*=-a,l.positionScreen.x*=o,l.positionScreen.y*=-a,b.setFromPoints([s.positionScreen,l.positionScreen]),!0===x.intersectsBox(b)&&V(s,l,r);else if(i instanceof $95d6a1447ab71b35$export$1cd1d524e22c1604){if(s=i.v1,l=i.v2,c=i.v3,s.positionScreen.z<-1||s.positionScreen.z>1)continue;if(l.positionScreen.z<-1||l.positionScreen.z>1)continue;if(c.positionScreen.z<-1||c.positionScreen.z>1)continue;s.positionScreen.x*=o,s.positionScreen.y*=-a,l.positionScreen.x*=o,l.positionScreen.y*=-a,c.positionScreen.x*=o,c.positionScreen.y*=-a,this.overdraw>0&&(W(s.positionScreen,l.positionScreen,this.overdraw),W(l.positionScreen,c.positionScreen,this.overdraw),W(c.positionScreen,s.positionScreen,this.overdraw)),b.setFromPoints([s.positionScreen,l.positionScreen,c.positionScreen]),!0===x.intersectsBox(b)&&O(s,l,c,i,r)}}F(),r.traverseVisible((function(e){if(e.isSVGObject){if(P.setFromMatrixPosition(e.matrixWorld),P.applyMatrix4(A),P.z<-1||P.z>1)return;const t=P.x*o,i=-P.y*a,r=e.node;r.setAttribute("transform","translate("+t+","+i+")"),E.appendChild(r)}}))}}}var $9QhXH=parcelRequire("9QhXH"),$5sV3G=parcelRequire("5sV3G"),$4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ"),$9HO6e=parcelRequire("9HO6e"),$9HO6e=parcelRequire("9HO6e");class $46f32ef2047263b6$export$6bf150a1b9f8c161{constructor(e){this.editor=e,this.currenObj={}}splitMain(){this.currenObj.main={startPoint:this.editor.currenDraw.startPoint,endPoint:this.editor.currenDraw.endPoint,mesh:[]},this.currenObj.other=[];let e=this.currenObj.main.startPoint,t=this.currenObj.main.endPoint,i=$9HO6e.UtilCore.handleLineData(e,t);if(this.editor.allWalls.length>0){let n=[],o=[];if(this.editor.allWalls.slice(0).forEach((r=>{if("remove"==r.status)return;let a=r.startPoint,s=r.endPoint,l=$9HO6e.UtilCore.handleLineData(a,s),c=$9HO6e.UtilCore.isSameVector(e,a),h=$9HO6e.UtilCore.isSameVector(e,s),d=$9HO6e.UtilCore.isSameVector(t,a),u=$9HO6e.UtilCore.isSameVector(t,s);if(""==this.editor.currenDraw)return;if($9HO6e.UtilCore.checkSameWall(r,this.editor.currenDraw))return;let p="";(c||h)&&(p=$9HO6e.UtilCore.getMeshOtherPoint(this.editor.currenDraw,e)),(d||u)&&(p=$9HO6e.UtilCore.getMeshOtherPoint(this.editor.currenDraw,t));let m=!1;if(""!=p&&$9HO6e.UtilCore.pointInLine(p,l)&&$9HO6e.UtilCore.pointIsInLine(p,a,s)&&(m=!0),(c||h||d||u)&&!m)return;if(m){let e=new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).splitWall(r,p),t={startPoint:r.startPoint,endPoint:r.endPoint,mesh:e};return this.currenObj.other.push(t),this.editor.removeWall(this.editor.currenDraw),void(this.editor.currenDraw="")}let f=$9HO6e.UtilCore.lineIsIntersection(i,l);if(f){let i=$9HO6e.UtilCore.pointIsInLine(f,e,t),l=$9HO6e.UtilCore.pointIsInLine(f,a,s);if(!i||!l)return;n.push(f),o.push(f.clone().distanceTo(e));let c=new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).splitWall(r,f),h={startPoint:r.startPoint,endPoint:r.endPoint,mesh:c};this.currenObj.other.push(h)}})),o.length>0){var r=o.slice(0);r.sort((function(e,t){return e-t}));let e=this.editor.currenDraw;r.forEach((t=>{let i=o.indexOf(t),a=new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).splitWall(e,n[i]);this.currenObj.main.mesh.push(a[0]),a.length>1&&(r.indexOf(t)==r.length-1&&this.currenObj.main.mesh.push(a[1]),e=a[1])}))}else{if(""==this.editor.currenDraw)return;this.editor.allWalls.indexOf(this.editor.currenDraw)<0&&this.editor.allWalls.push(this.editor.currenDraw),this.currenObj.main.mesh.push(this.editor.currenDraw)}}else this.currenObj.main.mesh.push(this.editor.currenDraw),this.editor.allWalls.push(this.editor.currenDraw)}undoSplit(){let e=[];var t=this.editor.allWalls.slice(0);this.currenObj.main.mesh.forEach((e=>{t.forEach((t=>{if($9HO6e.UtilCore.isSameVector(e.startPoint,t.startPoint)&&$9HO6e.UtilCore.isSameVector(e.endPoint,t.endPoint))return this.editor.wallGroup.remove(t),this.editor.removeHelperByWall(t),void(this.editor.allWalls.indexOf(t)>=0&&this.editor.allWalls.splice(this.editor.allWalls.indexOf(t),1))}))})),this.editor.allWalls.slice(0).forEach((t=>{let i=$9HO6e.UtilCore.isSameVector(this.currenObj.main.startPoint,t.startPoint)||$9HO6e.UtilCore.isSameVector(this.currenObj.main.startPoint,t.endPoint),r=$9HO6e.UtilCore.isSameVector(this.currenObj.main.endPoint,t.startPoint)||$9HO6e.UtilCore.isSameVector(this.currenObj.main.endPoint,t.endPoint);(i||r)&&e.push(t)})),e.forEach((e=>{this.editor.addArcPointHelper(e.startPoint,e.endPoint)})),this.currenObj.other.reverse().forEach((e=>{let t="";e.mesh.forEach((e=>{this.editor.allWalls.slice(0).forEach((i=>{if($9HO6e.UtilCore.isSameVector(e.startPoint,i.startPoint)&&$9HO6e.UtilCore.isSameVector(e.endPoint,i.endPoint))return this.editor.wallGroup.remove(i),t=i,this.editor.removeHelperByWall(i),void(this.editor.allWalls.indexOf(i)>=0&&this.editor.allWalls.splice(this.editor.allWalls.indexOf(i),1))}))}));let i=new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).createLineWall(e.startPoint,e.endPoint);this.editor.addLineWallHelper(e.startPoint,e.endPoint),i.material.color=this.editor.getWallColor(i),""!=t&&(i.style=t.style,i.height=t.height,i.thickness=t.thickness),this.editor.scene.add(i),this.editor.allWalls.push(i)}))}}class $fff7b0667b4b396b$export$912fb411e26e3541{constructor(e,t=[]){this.editor=e,this.param=t}drawMain(){if("Mesh"!=this.editor.currenDraw.type&&"Group"!=this.editor.currenDraw.type||(this.editor.currenDraw=""),""!=this.editor.currenDraw&&this.editor.currenDraw.forEach((e=>{this.editor.scene.remove(e),this.editor.removeHelperByWallId(e.id)})),0!=this.param.length){let e=$9HO6e.UtilCore.toVector3(this.editor.startPoint),t=new(0,$4xklQ.Vector3)(this.editor.currentPoint.x,e.y,0).sub(e.clone()),i=new(0,$4xklQ.Vector3)(e.x,this.editor.currentPoint.y,0).sub(e.clone()),r=e.clone().add(t.setLength(this.param[0]+this.editor.wallDep)),n=e.clone().add(i.setLength(this.param[1]+this.editor.wallDep)),o=new(0,$4xklQ.Vector3)(r.x,n.y,0);this.editor.currenDraw=new $523a84362d27c3e8$export$43cb61aa07eebcbc(this.editor).createRoom(e,o,this.editor.roomWallDep),this.editor.startPoint=""}else this.editor.currenDraw=new $523a84362d27c3e8$export$43cb61aa07eebcbc(this.editor).createRoom(this.editor.startPoint,this.editor.currentPoint,this.editor.roomWallDep);this.editor.currenDraw.forEach((e=>{this.editor.scene.add(e)}));let e=[this.editor.startPoint.x,this.editor.currentPoint.x],t=[this.editor.startPoint.y,this.editor.currentPoint.y],i=Math.min.apply(null,e),r=Math.max.apply(null,e),n=Math.min.apply(null,t),o=Math.max.apply(null,t),a=new(0,$4xklQ.Vector3)(i,o,0),s=new(0,$4xklQ.Vector3)(r,o,0),l=new(0,$4xklQ.Vector3)(i,n,0),c=this.editor.wallHelper.drawingRoomHelper(a,s,l,this.editor.wallDep);c[0].wallId=this.editor.currenDraw[0].id,c[1].wallId=this.editor.currenDraw[3].id,this.editor.helperGroup.add(...c)}execute(){this.drawMain(),this.editor.currenDraw.forEach((e=>{this.editor.removeHelperByWallId(e.id),e.material.color=this.editor.cancelChooseColor,this.editor.allWalls.push(e)})),this.editor.removeInputByClassName(this.editor.uiPanelBox.dom,"moveInput"),this.splitWallCommand=new $46f32ef2047263b6$export$6bf150a1b9f8c161(this.editor),this.editor.currenDraw.forEach((e=>{this.editor.currenDraw=e,this.splitWallCommand.splitMain()})),this.editor.currenDraw="";let e=this.editor.allWalls.slice(0);e.forEach((t=>{let i=$9HO6e.UtilCore.getSamePositionWall(t,e);if(i.length>1){let e=i.pop();$9HO6e.UtilCore.extendParamWall(t,e),i.forEach((e=>{this.editor.removeWall(e)}))}})),new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).wallToJson()}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}}var $4xklQ=parcelRequire("4xklQ");class $b11833ee6970dca8$export$5be3661e3be4a62a{constructor(e,t=[]){this.editor=e,this.param=t}drawMain(){this.editor.currenDraw&&(this.editor.scene.remove(this.editor.currenDraw),this.editor.removeHelperByWallId(this.editor.currenDraw.id),this.editor.removeInputByClassName(this.editor.uiPanelBox.dom,"moveInput"));let e=this.editor.startPoint,t=this.editor.endPoint,i=t.clone().sub(e.clone());if(0!=this.param.length){let r=this.param[0],n=this.param[1],o=this.param[2],a=new(0,$4xklQ.Vector3)(1,0,0);if(""!=n&&""==o){n=n.replace(/°/g,""),n*=1;let i="";t.x>e.x&&t.y>e.y?i=Math.PI/180*n:t.x<e.x&&t.y>e.y?i=Math.PI-Math.PI/180*n:t.x<e.x&&t.y<e.y?i=Math.PI+Math.PI/180*n:t.x>e.x&&t.y<e.y&&(i=2*Math.PI-Math.PI/180*n),a.applyEuler(new(0,$4xklQ.Euler)(0,0,i,"XYZ")),t=e.clone().add(a.setLength(r))}else if(""==n&&""!=o||""!=n&&""!=o){let i=Math.PI/180*o;a.applyEuler(new(0,$4xklQ.Euler)(0,0,i,"XYZ")),t=e.clone().add(a.setLength(r))}else t=e.clone().add(i.setLength(r));this.editor.startPoint=t}this.editor.currenDraw=new(0,$4xklQ.Line)((new(0,$4xklQ.BufferGeometry)).setFromPoints([e,t]),this.editor.config.drawDotMaterial),this.editor.currenDraw.startPoint=e,this.editor.currenDraw.endPoint=t,this.editor.currenDraw.useType="splitLine",this.editor.currenDraw.computeLineDistances(),this.editor.currenDraw.renderOrder=50,this.editor.scene.add(this.editor.currenDraw),new $002a82be864d68ed$export$a80d7a02e87abd45(this.editor,"sliptRoom").drawingWallHelper(e.clone(),t.clone()).wallId=this.editor.currenDraw.id}execute(){this.drawMain(),this.editor.currenDraw.material=this.editor.config.dotMaterial,this.editor.currenDraw.useType=this.editor.splitType,this.editor.splitRoomLine.add(this.editor.currenDraw),this.editor.removeHelperByWallId(this.editor.currenDraw.id),this.editor.removeInputByClassName(this.editor.uiPanelBox.dom,"moveInput"),this.editor.currenDraw="",new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).wallToJson()}undo(){}}var $9HO6e=parcelRequire("9HO6e"),$4xklQ=parcelRequire("4xklQ");class $4e6d6bcbeea35653$export$e5e2c7c57f7de029{constructor(e,t=[]){this.editor=e,this.splitWallCommand="",this.param=t}drawMain(e="",t=""){""!=this.editor.currenDraw&&(this.editor.scene.remove(this.editor.currenDraw),this.editor.removeHelperByWallId(this.editor.currenDraw.id));let i=this.editor.startPoint,r=this.editor.endPoint;""!=this.splitWallCommand&&"{}"!=JSON.stringify(this.splitWallCommand.currenObj)&&(i=this.splitWallCommand.currenObj.main.startPoint,r=this.splitWallCommand.currenObj.main.endPoint);let n=new(0,$4xklQ.Vector2)(r.x,r.y);if(r=this.handleEndPoint(i,r),$9HO6e.UtilCore.isSameVector(i,r))return;let o=r.clone().sub(i.clone());if(0!=this.param.length){let e=this.param[0],t=this.param[1],n=this.param[2],a=new(0,$4xklQ.Vector3)(1,0,0);if(""!=t&&""==n){t=t.replace(/°/g,""),t*=1;let n="";r.x>i.x&&r.y>i.y?n=Math.PI/180*t:r.x<i.x&&r.y>i.y?n=Math.PI-Math.PI/180*t:r.x<i.x&&r.y<i.y?n=Math.PI+Math.PI/180*t:r.x>i.x&&r.y<i.y&&(n=2*Math.PI-Math.PI/180*t),a.applyEuler(new(0,$4xklQ.Euler)(0,0,n,"XYZ")),r=i.clone().add(a.setLength(e))}else if(""==t&&""!=n||""!=t&&""!=n){let t=Math.PI/180*n;a.applyEuler(new(0,$4xklQ.Euler)(0,0,t,"XYZ")),r=i.clone().add(a.setLength(e))}else r=i.clone().add(o.setLength(e));i=new(0,$4xklQ.Vector2)(1*i.x.toFixed(2),1*i.y.toFixed(2)),r=new(0,$4xklQ.Vector2)(1*r.x.toFixed(2),1*r.y.toFixed(2)),this.editor.startPoint=r}this.editor.currenDraw=new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).createLineWall(i,r,this.editor.wallDep),2==this.editor.innerDraw&&(this.editor.currenDraw.realStart=i.clone(),this.editor.currenDraw.realEnd=r.clone()),this.editor.scene.add(this.editor.currenDraw);let a=this.editor.wallHelper.drawingWallHelper(i.clone(),r.clone()),s=$9HO6e.UtilCore.havePointWall(i,this.editor.allWalls),l=[];s.forEach((e=>{let t=$9HO6e.UtilCore.getMeshOtherPoint(e,i).clone().sub(i.clone()),r=$9HO6e.UtilCore.toVector3(t).angleTo($9HO6e.UtilCore.toVector3(o));r=Math.round(180/Math.PI*r),l.push(r)}));let c=Math.min.apply(null,l),h=l.indexOf(c);if(h>=0){let e=s[h],t=$9HO6e.UtilCore.getMeshOtherPoint(e,i),n=Math.round(180/Math.PI*$9HO6e.UtilCore.toVector2(t.clone().sub(i.clone())).angle()),o=this.editor.wallHelp.createCircleLine(i,e,this.editor.currenDraw),l=$9HO6e.UtilCore.getClockWise(t,i,r);l=l>0?-1:1,a.wallRealAngle=o.realAngle,a.add(o);let c=this.editor.getScreenPosition(o.center.clone());if(this.editor.checkHasCurrentInput(this.editor.uiPanelBox.dom,"realAngleInput")>=0){let e=document.getElementById("realAngleInput");e.style.marginLeft=c.x+"px",e.style.marginTop=c.y+"px",e.value=o.realAngle}else{let e=new $2a0c8f99fe7360a8$export$ab52802de2137ca0(o.realAngle).setClass("moveInput").setId("realAngleInput").setFontSize("15px").setWidth("40px").setMarginTop(c.y+"px").setMarginLeft(c.x+"px").setFocus().onKeyDown(function(e){if("Tab"==e.key&&(document.getElementById("lengthInput").focus(),document.getElementById("lengthInput").select(),e.preventDefault()),"Escape"==e.key&&this.editor.exitTool(),"13"==e.keyCode){let e="";document.getElementById("angleInput")&&(e=document.getElementById("angleInput").value,e.replace(/°/g,"")==a.realAngle.replace(/°/g,"")&&(e=""));let t=document.getElementById("lengthInput").value,i=1*document.getElementById("realAngleInput").value,r=[t,e,n+i*l];this.editor.list.startPlayer.dispatch(),this.editor.execute(new $4e6d6bcbeea35653$export$e5e2c7c57f7de029(this.editor,r),"画墙")}}.bind(this));e.dom.addEventListener("mousedown",function(e){2==e.button&&this.editor.camera.isOrthographicCamera&&this.editor.exitTool()}.bind(this)),e.setAttribute("wallAngle",n),e.setAttribute("clockWise",l),e.setAttribute("tabInput",0),this.editor.uiPanelBox.add(e)}}a.wallId=this.editor.currenDraw.id;let d=!0;if(this.editor.allLinkWallByStartPoint.forEach((e=>{let t=$9HO6e.UtilCore.handleLineData(e.startPoint,e.endPoint);$9HO6e.UtilCore.pointInLine(n,t)&&(d=!1)})),d&&""==this.splitWallCommand){this.editor.wallTool.handleIntersectNew3(this.editor.currenDraw,this.editor.allLinkWallByStartPoint)}}execute(e="",t=""){if(this.drawMain(e,t),!this.editor.currenDraw)return;if(2==this.editor.innerDraw&&"wall"==this.editor.toolType){let e=this.editor.currenDraw.geometry.attributes.position.array,t=new(0,$4xklQ.Vector2)(e[6],e[7]),i=new(0,$4xklQ.Vector2)(e[15],e[16]),r=new(0,$4xklQ.Vector2)(e[0],e[1]),n=new(0,$4xklQ.Vector2)(e[9],e[10]),o=this.editor.allWalls.slice(0),a=$9HO6e.UtilCore.handleLineData(this.editor.currenDraw.startPoint,this.editor.currenDraw.endPoint),s=[[],[]];o.forEach((e=>{if(!e.wallID)return;let o=e.geometry.attributes.position.array,l=[new(0,$4xklQ.Vector2)(o[9],o[10]),new(0,$4xklQ.Vector2)(o[12],o[13]),new(0,$4xklQ.Vector2)(o[15],o[16]),new(0,$4xklQ.Vector2)(o[0],o[1]),new(0,$4xklQ.Vector2)(o[3],o[4]),new(0,$4xklQ.Vector2)(o[6],o[7])],c=-1,h=-1,d=0;if(l.forEach((e=>{d++,($9HO6e.UtilCore.isSameVector(t,e)||$9HO6e.UtilCore.isSameVector(r,e))&&(c=d),($9HO6e.UtilCore.isSameVector(i,e)||$9HO6e.UtilCore.isSameVector(n,e))&&(h=d)})),-1==c&&-1==h)return;let u=$9HO6e.UtilCore.handleLineData(e.startPoint,e.endPoint),p=$9HO6e.UtilCore.lineIsIntersection(a,u),m=1==c||2==c||3==c||1==h||2==h||3==h,f=4==c||5==c||6==c||4==h||5==h||6==h;p||(m&&(p=e.endPoint.clone()),f&&(p=e.startPoint.clone()));let g=[e,p,"",""];m&&(g[2]="end",g[3]=e.endPoint.clone()),f&&(g[2]="start",g[3]=e.startPoint.clone()),-1!=c&&s[0].push(g),-1!=h&&s[1].push(g)}));let l=s[0],c=s[1];if(1==l.length){let e=l[0][0];this.editor.removeHelperByWall(e),"end"==l[0][2]?e.endPoint=l[0][1]:e.startPoint=l[0][1],this.editor.currenDraw.startPoint=l[0][1]}else l.length>1&&(this.editor.currenDraw.startPoint=l[0][3],0==c.length&&(this.editor.currenDraw.endPoint=this.editor.currenDraw.realEnd.clone()));if(1==c.length){let e=c[0][0];this.editor.removeHelperByWall(e),"end"==c[0][2]?e.endPoint=c[0][1]:e.startPoint=c[0][1],this.editor.currenDraw.endPoint=c[0][1]}else c.length>1&&(this.editor.currenDraw.endPoint=c[0][3],0==l.length&&(this.editor.currenDraw.startPoint=this.editor.currenDraw.realStart.clone()))}this.editor.removeHelperByWallId(this.editor.currenDraw.id),this.editor.removeInputByClassName(this.editor.uiPanelBox.dom,"moveInput"),this.editor.addLineWallHelper(this.editor.currenDraw.startPoint,this.editor.currenDraw.endPoint),this.editor.currenDraw.material.color=this.editor.cancelChooseColor,this.splitWallCommand=new $46f32ef2047263b6$export$6bf150a1b9f8c161(this.editor),this.splitWallCommand.splitMain(),this.editor.currenDraw="";let i=this.editor.floorGroup2d.children.length;new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).wallToJson(),i!=this.editor.floorGroup2d.children.length&&this.editor.exitTool(),0!=this.param.length&&(this.editor.allLinkWallByStartPoint=[],this.editor.allLinkWallByStartPoint=$9HO6e.UtilCore.havePointWall(this.editor.startPoint,this.editor.allWalls)),this.editor.otherMeshs.forEach((e=>{if(""==e.wallId&&e.wallPoint){let t=$9HO6e.UtilCore.getRealWallByPosition(e.wallPoint[0],e.wallPoint[1],this.editor.allWalls);t&&(e.wallId=t.wallID)}}))}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}handleEndPoint(e,t){return Math.abs(e.x-t.x)<150&&(t.x=e.x),Math.abs(e.y-t.y)<150&&(t.y=e.y),t}toJson(){let e=[];this.editor.allWalls.forEach((t=>{let i={start:{x:1*t.startPoint.x.toFixed(2),y:1*t.startPoint.y.toFixed(2),z:0},end:{x:1*t.endPoint.x.toFixed(2),y:1*t.endPoint.y.toFixed(2),z:0},style:0,line:0,isArc:!1,thickness:240,height:280,direction:"",offsetXY:100};e.push(i)}))}}class $002a82be864d68ed$export$a80d7a02e87abd45{constructor(e,t="wall"){this.editor=e,this.tool=t}drawingWallHelper(e,t,i=280){let r=this.editor.wallHelp.drawWallHelp(e.clone(),t.clone(),i);if(""!=r.realAngle){let e=this.editor.checkHasCurrentInput(this.editor.uiPanelBox.dom,"angleInput"),t=this.editor.getScreenPosition(r.arcCenter.clone());if(e>=0){let e=document.getElementById("angleInput");e.style.marginLeft=t.x+"px",e.style.marginTop=t.y+"px",e.value=r.realAngle}else{let e=new $2a0c8f99fe7360a8$export$ab52802de2137ca0(r.realAngle).setClass("moveInput").setId("angleInput").setFocus().setFontSize("15px").setWidth("40px").setMarginTop(t.y+"px").setMarginLeft(t.x+"px").onKeyDown(function(e){if("Tab"==e.key&&(document.getElementById("realAngleInput")?(document.getElementById("realAngleInput").focus(),document.getElementById("realAngleInput").select()):(document.getElementById("lengthInput").focus(),document.getElementById("lengthInput").select()),e.preventDefault()),"Escape"==e.key&&this.editor.exitTool(),"13"==e.keyCode){let e=document.getElementById("angleInput").value,t=document.getElementById("lengthInput").value,i="";if(document.getElementById("realAngleInput")&&(i=document.getElementById("realAngleInput").value,i.replace(/°/g,"")==r.wallRealAngle.replace(/°/g,"")&&(i=""),""!=i)){i=i.replace(/°/g,"");let e=this.editor.getDomById(this.editor.uiPanelBox.dom,"realAngleInput");e&&(i=1*e.getAttribute("wallAngle")+i*e.getAttribute("clockWise")*1)}let n=[t,e,i];this.editor.list.startPlayer.dispatch(),"wall"==this.tool?this.editor.execute(new $4e6d6bcbeea35653$export$e5e2c7c57f7de029(this.editor,n),"画墙"):this.editor.execute(new $b11833ee6970dca8$export$5be3661e3be4a62a(this.editor,n),"分割墙")}}.bind(this));e.dom.addEventListener("mousedown",function(e){2==e.button&&this.editor.camera.isOrthographicCamera&&this.editor.exitTool()}.bind(this)),e.setAttribute("tabInput",0),this.editor.uiPanelBox.add(e)}}else document.getElementById("angleInput")&&this.editor.uiPanelBox.dom.removeChild(document.getElementById("angleInput"));let n=this.editor.checkHasCurrentInput(this.editor.uiPanelBox.dom,"lengthInput"),o=this.editor.getScreenPosition(r.lineCenter.clone());if(n>=0){let e=document.getElementById("lengthInput");e.style.marginLeft=o.x+"px",e.style.marginTop=o.y+"px",e.value=r.lineLength,e.focus(),e.select()}else{let e=new $2a0c8f99fe7360a8$export$ab52802de2137ca0(r.lineLength).setClass("moveInput").setId("lengthInput").setFontSize("15px").setWidth("40px").setMarginTop(o.y+"px").setMarginLeft(o.x+"px").setFocus().onKeyDown(function(e){if("Tab"==e.key&&document.getElementById("angleInput")&&(document.getElementById("angleInput").focus(),document.getElementById("angleInput").select(),e.preventDefault()),"Escape"==e.key&&this.editor.exitTool(),"13"==e.keyCode){let e="";document.getElementById("angleInput")&&(e=document.getElementById("angleInput").value,e.replace(/°/g,"")==r.realAngle.replace(/°/g,"")&&(e=""));let t=document.getElementById("lengthInput").value,i="";if(document.getElementById("realAngleInput")&&(i=document.getElementById("realAngleInput").value,i.replace(/°/g,"")==r.wallRealAngle.replace(/°/g,"")&&(i=""),""!=i)){i=i.replace(/°/g,"");let e=this.editor.getDomById(this.editor.uiPanelBox.dom,"realAngleInput");e&&(i=1*e.getAttribute("wallAngle")+i*e.getAttribute("clockWise")*1)}let n=[t,e,i];this.editor.list.startPlayer.dispatch(),"wall"==this.tool?this.editor.execute(new $4e6d6bcbeea35653$export$e5e2c7c57f7de029(this.editor,n),"画墙"):this.editor.execute(new $b11833ee6970dca8$export$5be3661e3be4a62a(this.editor,n),"分割墙")}}.bind(this));e.dom.addEventListener("mousedown",function(e){2==e.button&&this.editor.camera.isOrthographicCamera&&this.editor.exitTool()}.bind(this)),e.setAttribute("tabInput",0),this.editor.uiPanelBox.add(e),document.getElementById("lengthInput").focus()}return this.editor.helperGroup.add(r),r}addLineWallHelper(e,t,i=""){let r="";r=""==i?this.editor.wallHelp.createLineDimensionsLine(e,t,!1):this.editor.wallHelp.createLineDimensionsLine(e,t,!1,i);let n=new(0,$4xklQ.Vector2)(t.x,t.y).sub(new(0,$4xklQ.Vector2)(e.x,e.y)).angle();n=180/Math.PI*n,n>180&&n<270?n=360-n+180:n>90&&n<=180?(n*=-1,n+=180):n=360-n;let o=this.editor.getScreenPosition(r.center.clone()),a=new $2a0c8f99fe7360a8$export$3dc21c16dab61cf7(r.lineLength).setClass("showWallLength"+r.uuid).setFontSize("15px").setWidth("40px").setMarginTop(o.y+"px").setMarginLeft(o.x+"px").setStyle(["transform"],["rotate("+n+"deg)"]),s=r.center.x+"/"+r.center.y+"/"+r.center.z;return a.setAttribute("worldPosition",s),a.setAttribute("angle",n),0!=r.lineLength&&this.editor.uiPanelBox.add(a),this.editor.helperGroup.add(r),r}addArcWallHelper(){}addBSRWallHelper(e){let t=e.cp,i=e.startPoint,r=e.endPoint,n=$523a84362d27c3e8$export$b680ca477a72be07.makeControlPoint(t);n.useType="bseControl",n.wall=e;var o=(new(0,$4xklQ.BufferGeometry)).setFromPoints([i,t,r]),a=new(0,$4xklQ.Line)(o,new(0,$4xklQ.MeshBasicMaterial)({color:"#1E90FF",side:$4xklQ.DoubleSide,transparent:!0}));a.startPoint=e.startPoint,a.endPoint=e.endPoint,this.editor.pointHelperGroup.add(n),a.lineType="bseLine",this.editor.helperGroup.add(a)}drawingRoomHelper(e,t,i,r=240){let n=new(0,$4xklQ.Vector3)(e.x+r/2,e.y-r/2,0),o=new(0,$4xklQ.Vector3)(t.x-r/2,t.y-r/2,0),a=new(0,$4xklQ.Vector3)(i.x+r/2,i.y+r/2,0),s=this.editor.wallHelp.createLineDimensionsLine(o,n,!1),l=this.editor.wallHelp.createLineDimensionsLine(n,a,!1),c=this.editor.getScreenPosition(s.center.clone()),h=this.editor.getScreenPosition(l.center.clone()),d=this.editor.checkHasCurrentInput(this.editor.uiPanelBox.dom,"topInput"),u=this.editor.checkHasCurrentInput(this.editor.uiPanelBox.dom,"leftInput");if(d>=0){let e=document.getElementById("topInput");e.style.marginLeft=c.x+"px",e.style.marginTop=c.y+"px",e.value=s.lineLength,e.focus(),e.select()}else{let e=new $2a0c8f99fe7360a8$export$ab52802de2137ca0(s.lineLength).setClass("moveInput").setId("topInput").setFontSize("15px").setWidth("40px").setMarginTop(c.y+"px").setMarginLeft(c.x+"px").setFocus().onKeyDown(function(t){let i=document.getElementById("leftInput");if("Tab"==t.key&&i&&(i.focus(),i.select(),t.preventDefault()),"Escape"==t.key&&this.editor.exitTool(),"13"==t.keyCode){let t=1*e.dom.value,r=1*i.value;new $fff7b0667b4b396b$export$912fb411e26e3541(this.editor,[t,r]).execute()}}.bind(this));this.editor.uiPanelBox.add(e)}if(u>=0){let e=document.getElementById("leftInput");e.style.marginLeft=h.x+"px",e.style.marginTop=h.y+"px",e.value=l.lineLength}else{let e=new $2a0c8f99fe7360a8$export$ab52802de2137ca0(l.lineLength).setClass("moveInput").setId("leftInput").setFontSize("15px").setWidth("40px").setMarginTop(h.y+"px").setMarginLeft(h.x+"px").setFocus().onKeyDown(function(t){let i=document.getElementById("topInput");if("Tab"==t.key&&i&&(i.focus(),i.select(),t.preventDefault()),"Escape"==t.key&&this.editor.exitTool(),"13"==t.keyCode){let t=1*i.value,r=1*e.dom.value;new $fff7b0667b4b396b$export$912fb411e26e3541(this.editor,[t,r]).execute()}}.bind(this));this.editor.uiPanelBox.add(e)}return[s,l]}}var $4xklQ=parcelRequire("4xklQ"),$9HO6e=parcelRequire("9HO6e"),$4xklQ=parcelRequire("4xklQ"),$9QhXH=parcelRequire("9QhXH");class $a9d7f9904bb6112a$export$6803bcffe5c71ec4{constructor(e,t="",i="",r=[],n=!0,o=""){this.editor=e,this.redrew=n,this.type=t,this.changeWall=i,this.doorWid=this.editor.config.doorWidth;this.toolType=this.editor.toolType,this.wallDepth=240,["doubledoor","slidingdoor","baywindow","frenchwindows","singleDoubleDoor"].indexOf(this.editor.toolType)>=0&&(this.doorWid=2*this.editor.config.doorWidth),""!=t&&this.editor.currentDoor&&(this.doorWid=this.editor.currentDoor.doorWid),this.res=[],this.param=r,"straightWindow"==this.toolType&&(this.doorWid=1200),"straightBayWindow"==this.toolType&&(this.doorWid=3e3),"UWindow"!=this.toolType&&"UBayWindow"!=this.toolType||(this.doorWid=2e3),this.LWidth=1200,this.RWidth=1200,this.leftWall="",this.rightWall="",this.centerWall="",this.arcWindowAngle=Math.PI/4,this.arcCenter=!1,this.extendClick=o,this.editor.copyDoor&&(this.doorWid=this.editor.copyDoor.doorWid)}drawMain(){this.editor.cleanWallHelper();let e=this.toolType;this.editor.blackbox&&this.editor.blackbox.removeDom(),this.editor.blackbox="",""!=this.type&&(e=this.editor.currentDoor.modelType);let t="outside";this.editor.copyDoor&&this.editor.copyDoor.doorDir&&(t=this.editor.copyDoor.doorDir);let i=this.editor.currentPoint.clone(),r="";if(""==this.changeWall)"LWindow"==e||"UWindow"==e?("LWindow"==e&&(r=this.getNearWallForLWindow(this.editor.currentPoint,2),this.leftWall=r[3],this.rightWall=r[4]),"UWindow"==e&&(r=this.getNearWallForUWindow(this.editor.currentPoint,2),this.leftWall=r[4],this.rightWall=r[5],this.centerWall=r[3]),this.editor.currentDoor.leftWindow&&(this.LWidth=this.editor.currentDoor.leftWindow[1],this.RWidth=this.editor.currentDoor.rightWindow[1]),this.editor.currentDoor.leftWindow&&0==r.length&&(this.leftWall=this.editor.currentDoor.leftWindow[0],this.rightWall=this.editor.currentDoor.rightWindow[0])):"arcWindow"==e?r=this.getNearWallForArcWindow(this.editor.currentPoint,2):(r=this.getNearWallByPoint(this.editor.currentPoint),this.editor.currentDoor&&"arcWindow"==this.editor.currentDoor.modelType&&(r=this.getNearWallForArcWindow(this.editor.currentPoint,2)));else{if(!this.editor.currentDoor.wallId)return;let t=this.editor.currentDoor.wallId;"LWindow"!=e&&"UWindow"!=e||(t=this.editor.currentDoor.leftWindow[0].wallID,"right"==this.changeWall&&(t=this.editor.currentDoor.rightWindow[0].wallID)),r="arcWindow"==e?this.getNearWallForArcWindowForChange(this.editor.currentPoint,t):this.getNearWallByPointForChange(this.editor.currentPoint,t)}this.res=r;let n=new(0,$4xklQ.Vector2)(1,0),o=new(0,$4xklQ.Vector2)(2,0);if(1==r.length)return;let a=0,s="",l="";if(""!=this.type){if(!this.editor.currentDoor)return;if(a=this.editor.currentDoor.angle,s=this.editor.currentDoor.height,l=this.editor.currentDoor.floorHei,this.editor.currentDoor){let e=this.editor.currentDoor;this.editor.scene.remove(e),this.editor.otherMeshs.indexOf(e)>=0&&this.editor.otherMeshs.splice(this.editor.otherMeshs.indexOf(e),1)}}if(""!=this.editor.currenDraw&&(this.editor.scene.remove(this.editor.currenDraw),this.editor.otherMeshs.indexOf(this.editor.currenDraw)>=0&&this.editor.otherMeshs.splice(this.editor.otherMeshs.indexOf(this.editor.currenDraw),1)),this.editor.pointHelpGroup.children=[],r.length>=3){i=r[0],n=r[1],o=r[2],i=new(0,$4xklQ.Vector3)(i.x,i.y,0),this.wallDepth=1*r[3].thickness;let t=$9HO6e.UtilCore.getMinEdge(r[3]);t<=this.doorWid&&(this.doorWid=t),a=new(0,$4xklQ.Vector2)(o.x,o.y).sub(new(0,$4xklQ.Vector2)(n.x,n.y)).angle();let s=$9HO6e.UtilCore.createCenterLine(r[3].startPoint,r[3].endPoint);if(this.editor.pointHelpGroup.add(s),r[3].arcCenter&&(this.arcCenter=r[3].arcCenter.clone()),"arcWindow"==e&&this.editor.currentDoor){let e=this.editor.currentDoor;this.arcCenter=e.arcCenter,this.wallDepth=e.wallDep,this.arcWindowAngle=e.angle}}else a=0;if(""!=this.changeWall){let n=this.editor.currentDoor;this.editor.scene.remove(n),this.editor.otherMeshs.indexOf(n)>=0&&this.editor.otherMeshs.splice(this.editor.otherMeshs.indexOf(n),1);let o="start"==this.changeWall?n.endPoint:n.startPoint,a=new(0,$4xklQ.Vector3)((o.x+i.x)/2,(o.y+i.y)/2,0);if(this.doorWid=1*o.clone().distanceTo(i.clone()),i=a,("LWindow"==e||"UWindow"==e)&&r.length>0){let t=new(0,$4xklQ.Vector3)(n.center.x,n.center.y,0),o=1*t.clone().distanceTo(new(0,$4xklQ.Vector3)(r[0].x,r[0].y,0));if(this.leftWall=n.leftWindow[0],this.rightWall=n.rightWindow[0],this.LWidth=n.leftWindow[1],this.RWidth=n.rightWindow[1],i=t,"UWindow"==e){this.centerWall=this.editor.getWallByWallId(n.wallId);let e="";if(e="left"==this.changeWall?$9HO6e.UtilCore.getSamePointTwoWall(this.leftWall,this.centerWall):$9HO6e.UtilCore.getSamePointTwoWall(this.rightWall,this.centerWall),e){o=1*e.clone().distanceTo(new(0,$4xklQ.Vector3)(r[0].x,r[0].y,0));let t=this.centerWall.startPoint,n=this.centerWall.endPoint;i=new(0,$4xklQ.Vector3)((t.x+n.x)/2,(t.y+n.y)/2,0)}}"left"==this.changeWall?this.LWidth=o:this.RWidth=o}if("arcWindow"==e){this.arcCenter=n.arcCenter,this.wallDepth=n.wallDep;let e=this.arcCenter.clone().distanceTo(n.center.clone()),t=0==r.length?n.endPoint.clone():r[0].clone(),o=n.startPoint.clone();"arcStart"==this.changeWall&&(o=n.endPoint.clone());let a=new(0,$4xklQ.Vector2)((t.x+o.x)/2,(t.y+o.y)/2);i=this.arcCenter.clone().add(a.clone().sub(this.arcCenter.clone()).setLength(e)),this.arcWindowAngle=$9HO6e.UtilCore.toVector3(i.clone().sub(this.arcCenter.clone())).angleTo($9HO6e.UtilCore.toVector3(o.clone().sub(this.arcCenter.clone())))}""!=n.doorDir&&(t=n.doorDir)}if(this.editor.doorHelperGroupClean(),n=new(0,$4xklQ.Vector3)(n.x,n.y,0),o=new(0,$4xklQ.Vector3)(o.x,o.y,0),0!=this.param.length){let r=this.editor.currentDoor,s=this.editor.currentDoor.center;if(this.doorWid=1*this.editor.currentDoor.doorWid,"width"==this.param[2]&&(this.doorWid=1*this.param[0],i=s),"depth"==this.param[2]&&(this.wallDepth=1*this.param[0],i=s,"LWindow"!=r.modelType&&"UWindow"!=r.modelType||(this.LWidth=r.leftWindow[1],this.RWidth=r.rightWindow[1],this.leftWall=this.editor.getWallByWallId(r.leftWindow[0].wallID),this.rightWall=this.editor.getWallByWallId(r.rightWindow[0].wallID),"UWindow"==r.modelType&&(this.centerWall=this.editor.getWallByWallId(r.wallId)))),"start"==this.param[2]){let e=r.endPoint.clone().sub(r.startPoint.clone()).setLength(this.param[1]);i=s.add(e)}if("end"==this.param[2]){let e=r.startPoint.clone().sub(r.endPoint.clone()).setLength(this.param[1]);i=s.add(e)}if("angle"==this.param[2]){a=r.angle;let n=["outside","leftSide","rightSide","inside"],o=n.indexOf(t);o==n.length-1&&(o=-1),t=n[o+1],i=s,(e.indexOf("Window")>=0||e.indexOf("window")>=0)&&(a+=Math.PI)}if("left"==this.param[2]||"right"==this.param[2]){let t=1*this.param[0];this.leftWall=r.leftWindow[0],this.rightWall=r.rightWindow[0],this.LWidth=r.leftWindow[1],this.RWidth=r.rightWindow[1],"UWindow"==e&&(this.centerWall=this.editor.getWallByWallId(r.wallId)),"left"==this.param[2]?this.LWidth=t:this.RWidth=t}if("center"==this.param[2]){if(i=this.param[1][0],a=this.param[0].angle,this.doorWid=this.param[0].doorWid,this.wallDepth=this.param[0].wallDepth,n=this.param[1][1],o=this.param[1][2],"LWindow"==this.param[0].modelType||"UWindow"==this.param[0].modelType){let e=this.param[0];if(this.leftWall=this.editor.getWallByWallId(e.leftWindow[0].wallID),this.rightWall=this.editor.getWallByWallId(e.rightWindow[0].wallID),this.LWidth=e.leftWindow[1],this.RWidth=e.rightWindow[1],i=$9HO6e.UtilCore.getSamePointTwoWall(this.leftWall,this.rightWall),"UWindow"==this.param[0].modelType){this.centerWall=this.editor.getWallByWallId(e.wallId);let t=this.centerWall.startPoint,r=this.centerWall.endPoint;i=new(0,$4xklQ.Vector3)((t.x+r.x)/2,(t.y+r.y)/2,0)}}if("arcWindow"==this.param[0].modelType){let e=this.param[0];this.arcCenter=this.param[1][3].clone(),this.wallDepth=e.wallDep,this.arcWindowAngle=e.angle}}if("wall"==this.param[2]){let e=this.param[1][1];if(i=this.param[1][0],n=e.startPoint,o=e.endPoint,i=new(0,$4xklQ.Vector3)(i.x,i.y,0),this.wallDepth=1*e.thickness,a=new(0,$4xklQ.Vector2)(o.x,o.y,0).sub(new(0,$4xklQ.Vector2)(n.x,n.y,0)).angle(),"LWindow"==this.param[0].modelType){let e=this.param[0];this.leftWall=this.editor.getWallByWallId(e.leftWindow[0].wallID),this.rightWall=this.editor.getWallByWallId(e.rightWindow[0].wallID),this.LWidth=e.leftWindow[1],this.RWidth=e.rightWindow[1],i=$9HO6e.UtilCore.getSamePointTwoWall(this.leftWall,this.rightWall)}if("arcWindow"==this.param[0].modelType){let e=this.param[0],t=this.param[1][2];this.arcCenter=t.arcCenter,this.wallDepth=t.wallDep,this.arcWindowAngle=e.angle;let r=e.center.clone().sub(e.arcCenter.clone()),n=t.cp.distanceTo(t.arcCenter);i=t.arcCenter.clone().add(r.setLength(n))}}if("arcAngle"==this.param[2]){let e=this.param[1];this.arcCenter=e.arcCenter,this.wallDepth=e.wallDep,this.arcWindowAngle=Math.PI/180*(this.param[0]/2),i=e.center}}"doubledoor"==e?this.editor.currenDraw=$9QhXH.DM.createDODoor(i,this.doorWid,a,this.wallDepth,n,o,t):"door"==e?this.editor.currenDraw=$9QhXH.DM.createBaseDoor(i,this.doorWid,t,a,this.wallDepth,n,o):"slidingdoor"==e?this.editor.currenDraw=$9QhXH.DM.createSlidingDoor(i,this.doorWid,a,this.wallDepth,n,o,t):"window"==e?this.editor.currenDraw=$9QhXH.DM.createBaseWindow(i,this.doorWid,a,this.wallDepth,n,o):"baywindow"==e?this.editor.currenDraw=$9QhXH.DM.createPanoramicWindow(i,this.doorWid,a,this.wallDepth,n,o):"frenchwindows"==e?this.editor.currenDraw=$9QhXH.DM.createFrenchWindow(i,this.doorWid,a,this.wallDepth,n,o):"singledoor"==e?this.editor.currenDraw=$9QhXH.DM.createBaseDoor(i,this.doorWid,t,a,this.wallDepth,n,o):"singleDoubleDoor"==e?this.editor.currenDraw=$9QhXH.DM.createDODoor(i,this.doorWid,a,this.wallDepth,n,o,t):"childMotherDoor"==e?this.editor.currenDraw=$9QhXH.DM.createLashDoor(i,this.doorWid,a,this.wallDepth,n,o,t):"moveDoor"==e?this.editor.currenDraw=$9QhXH.DM.createSlidingDoor(i,this.doorWid,a,this.wallDepth,n,o,t):"pass"==e||"passDoor"==e?this.editor.currenDraw=$9QhXH.DM.createPass(i,this.doorWid,a,this.wallDepth,n,o,t):"straightWindow"==e?this.editor.currenDraw=$9QhXH.DM.createBaseWindow(i,this.doorWid,a,this.wallDepth,n,o):"straightBayWindow"==e?this.editor.currenDraw=$9QhXH.DM.createPanoramicWindow(i,this.doorWid,a,this.wallDepth,n,o):"LWindow"==e?this.editor.currenDraw=$9QhXH.DM.createLWindowNew(i,this.leftWall,this.rightWall,this.LWidth,this.RWidth):"LBayWindow"==e||("UWindow"==e?this.editor.currenDraw=$9QhXH.DM.createUWindow(i,this.leftWall,this.centerWall,this.rightWall,this.LWidth,this.RWidth):"UBayWindow"==e||("dooropen"==e?this.editor.currenDraw=$9QhXH.DM.createDoorHole(i,this.doorWid,a,this.wallDepth,n,o):"archDoor"==e?this.editor.currenDraw=$9QhXH.DM.createSectorDoor(i,this.doorWid,a,this.wallDepth,n,o):"archWindow"==e?(this.doorWid==this.editor.config.doorWidth&&(this.doorWid+=583),this.editor.currenDraw=$9QhXH.DM.createSectorWindow(i,this.doorWid,a,this.wallDepth,n,o)):"arcDoor"==e||"arcWindow"==e&&(this.editor.currenDraw=$9QhXH.DM.createArcBaseWindow(i,this.arcCenter,this.wallDepth,this.arcWindowAngle)))),""!=this.editor.currenDraw&&(""!=s&&(this.editor.currenDraw.height=s),""!=l&&(this.editor.currenDraw.floorHei=l),this.editor.scene.add(this.editor.currenDraw),r.length>=3&&"free"!=e&&(this.editor.currenDraw.wallId=r[3].wallID),0!=this.param.length&&"center"==this.param[2]&&(this.editor.currenDraw.wallId=this.param[0].wallId),"UWindow"==e&&this.centerWall&&(this.editor.currenDraw.wallId=this.centerWall.wallID),this.editor.addLineHelperForDoor(this.editor.currenDraw),0!=this.param.length&&(this.editor.currentDoor=this.editor.currenDraw,this.editor.currentDoor.isLock=this.param[0].isLock),this.editor.copyDoor&&(this.editor.currenDraw.height=this.editor.copyDoor.height,this.editor.currenDraw.floorHei=this.editor.copyDoor.floorHei))}execute(){this.drawMain(),0!=this.res.length||""==this.editor.currenDraw||this.editor.currentDoor?(0==this.res.length&&""!=this.editor.currenDraw&&this.editor.currentDoor&&(this.editor.scene.remove(this.editor.currenDraw),this.editor.currentPoint=this.editor.currentDoor.center.clone(),new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor,"door").drawMain()),this.editor.doorHelperGroupClean(),this.editor.pointHelpGroup.children=[],""!=this.editor.currenDraw&&this.editor.otherMeshs.push(this.editor.currenDraw),""!=this.extendClick&&(this.editor.clickSelect[0].object.parent=this.editor.currenDraw),this.redrew&&new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).wallToJson(),this.editor.cleanWallHelper(),""==this.type&&""==this.changeWall||this.editor.addLineHelperForDoor(this.editor.currenDraw,!0),this.editor.currenDraw=""):this.editor.scene.remove(this.editor.currenDraw)}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}getNearWallForArcWindowForChange(e,t){let i=[];return e=$9HO6e.UtilCore.toVector2(e),this.editor.allWalls.forEach((r=>{if(r.wallID!=t)return;let n=$9HO6e.UtilCore.toVector2(r.arcCenter),o=$9HO6e.UtilCore.toVector2(r.startPoint),a=$9HO6e.UtilCore.toVector2(r.endPoint),s=n.distanceTo(o),l=n.clone().add(e.clone().sub(n.clone()).setLength(s)),c=e.distanceTo(n)-s,h=$9HO6e.UtilCore.getClockWise(o,r.cp,a),d=$9HO6e.UtilCore.getClockWise(o,l,a);this.editor.config.drawDoorArea>=Math.abs(c)&&h*d>0&&(i=[l,r.startPoint,r.endPoint,r])})),i}getNearWallForArcWindow(e){let t=[];e=$9HO6e.UtilCore.toVector2(e);let i="";if(this.editor.allWalls.forEach((r=>{if("circle"==r.isArc){let i=$9HO6e.UtilCore.toVector2(r.arcCenter),n=$9HO6e.UtilCore.toVector2(r.startPoint),o=$9HO6e.UtilCore.toVector2(r.endPoint),a=i.distanceTo(n),s=i.clone().add(e.clone().sub(i.clone()).setLength(a)),l=e.distanceTo(i)-a,c=$9HO6e.UtilCore.getClockWise(n,r.cp,o),h=$9HO6e.UtilCore.getClockWise(n,s,o);this.editor.config.drawDoorArea>=Math.abs(l)&&c*h>0&&(t=[s,r.startPoint,r.endPoint,r])}else{let t=$9HO6e.UtilCore.handleLineData(r.startPoint,r.endPoint),n=$9HO6e.UtilCore.smallDistanceByPointOnLine(t,e.clone());if(!$9HO6e.UtilCore.pointIsInLine(n,r.startPoint,r.endPoint))return;let o=n.clone().distanceTo(e.clone());this.editor.config.drawDoorArea>=o&&(i=r)}})),i){let e=this.editor.getScreenPosition(this.editor.currentPoint.clone());this.editor.list.blackBox.dispatch(e.x,e.y,"弧形窗只支持在弧形墙上面放置")}return t}getNearWallByPoint(e){let t=[],i="";return this.editor.allWalls.forEach((r=>{let n=$9HO6e.UtilCore.handleLineData(r.startPoint,r.endPoint),o=$9HO6e.UtilCore.smallDistanceByPointOnLine(n,e.clone()),a=o.clone().distanceTo(e.clone());if(this.editor.config.drawDoorArea>=a){let e=$9HO6e.UtilCore.getNewPoint(r),n=$9HO6e.UtilCore.getNewPoint(r,"end"),a=Math.round(o.clone().distanceTo(e.clone())),s=Math.round(o.clone().distanceTo(n.clone())),l=r.endPoint.clone().sub(r.startPoint.clone()),c=$9HO6e.UtilCore.getMinEdge(r);if(c>=this.doorWid&&(c=this.doorWid),$9HO6e.UtilCore.pointIsInLine(o,r.startPoint,r.endPoint)){i=!0;let h=30;if(a-c/2<h)return o=e.clone().add(l.clone().setLength(c/2)),void(t=[o,r.startPoint,r.endPoint,r]);if(s-c/2<h)return o=n.clone().add(l.clone().negate().setLength(c/2)),void(t=[o,r.startPoint,r.endPoint,r]);if(a<=c/2||s<=c/2)return void(t=["notAllowMove1"])}else{if(i)return;if(a<=this.editor.config.drawDoorArea)return o=e.clone().add(l.clone().setLength(c/2)),void(t=[o,r.startPoint,r.endPoint,r]);if(s<=this.editor.config.drawDoorArea)return o=n.clone().add(l.clone().negate().setLength(c/2)),void(t=[o,r.startPoint,r.endPoint,r]);if(a>this.editor.config.drawDoorArea&&s>this.editor.config.drawDoorArea)return;if(a<=c/2||s<=c/2)return void(t=["notAllowMove"])}0==t.length&&(t=[o,r.startPoint,r.endPoint,r])}else;})),t}getNearWallByPointForChange(e,t){let i=[];return this.editor.allWalls.forEach((r=>{if(r.wallID!=t)return;let n=$9HO6e.UtilCore.handleLineData(r.startPoint,r.endPoint),o=$9HO6e.UtilCore.smallDistanceByPointOnLine(n,e.clone());if($9HO6e.UtilCore.pointIsInLine(o,r.startPoint,r.endPoint))i=[o,r.startPoint,r.endPoint,r];else{let e=o.clone().distanceTo(r.startPoint.clone()),t=o.clone().distanceTo(r.endPoint.clone());i=e<t?[r.startPoint,r.startPoint,r.endPoint,r]:[r.endPoint,r.startPoint,r.endPoint,r]}})),i}getNearWallByPointForLWindow(e){let t=this.editor.currentDoor.leftWindow[0].wallID;"right"==this.changeWall&&(t=this.editor.currentDoor.rightWindow[0].wallID);let i=[];return this.editor.allWalls.forEach((r=>{if(r.wallID!=t)return;let n=$9HO6e.UtilCore.handleLineData(r.startPoint,r.endPoint),o=$9HO6e.UtilCore.smallDistanceByPointOnLine(n,e.clone());if($9HO6e.UtilCore.pointIsInLine(o,r.startPoint,r.endPoint))i=[o,r.startPoint,r.endPoint,r];else{let e=o.clone().distanceTo(r.startPoint.clone()),t=o.clone().distanceTo(r.endPoint.clone());i=e<t?[r.startPoint,r.startPoint,r.endPoint,r]:[r.endPoint,r.startPoint,r.endPoint,r]}})),i}getNearWallForLWindow(e,t){let i=[];return this.editor.allWalls.forEach((r=>{let n=r.startPoint,o=r.endPoint,a="";if($9HO6e.UtilCore.toVector3(n).distanceTo(e)<=this.editor.config.drawDoorArea&&(a=n),$9HO6e.UtilCore.toVector3(o).distanceTo(e)<=this.editor.config.drawDoorArea&&(a=o),""==a)return;let s=$9HO6e.UtilCore.havePointWall(a,this.editor.allWalls);if(s.length!=t)return;if(1!=r.roomCenter.length)return;let l=r.roomCenter[0];l=new(0,$4xklQ.Vector3)(l[0],l[1],0);l.clone().sub(a.clone()).setLength(1e5);let c=$9HO6e.UtilCore.getMeshOtherPoint(s[0],a),h=$9HO6e.UtilCore.getMeshOtherPoint(s[1],a),d=(c.clone().sub(a.clone()).setLength(100),h.clone().sub(a.clone()).setLength(100),$9HO6e.UtilCore.getClockWise(c,a,h));d<0&&(i=[a,s[0].startPoint,s[0].endPoint,s[0],s[1],r.roomCenter]),d>0&&(i=[a,s[1].startPoint,s[1].endPoint,s[1],s[0],r.roomCenter])})),i}getNearWallForUWindow(e){let t=[];return this.editor.allWalls.forEach((i=>{let r=$9HO6e.UtilCore.handleLineData(i.startPoint,i.endPoint),n=$9HO6e.UtilCore.smallDistanceByPointOnLine(r,e.clone()),o=n.clone().distanceTo(e.clone());if(this.editor.config.drawDoorArea>=o){let e=i.startPoint,r=i.endPoint,o=$9HO6e.UtilCore.havePointWall(e,this.editor.allWalls),a=$9HO6e.UtilCore.havePointWall(r,this.editor.allWalls);if(2!=o.length&&2!=a.length)return;if(1!=i.roomCenter.length)return;let s="";o.forEach((e=>{e.wallID!=i.wallID&&(s=e)}));let l="";a.forEach((e=>{e.wallID!=i.wallID&&(l=e)}));let c=$9HO6e.UtilCore.getMeshOtherPoint(s,e),h=$9HO6e.UtilCore.getMeshOtherPoint(l,r),d=$9HO6e.UtilCore.handleLineData(e,r),u=!1;if("X"==d[0])(c.y>d[2]&&h.y>d[2]||c.y<d[2]&&h.y<d[2])&&(u=!0);else if("Y"==d[0])(c.x>d[2]&&h.x>d[2]||c.x<d[2]&&h.x<d[2])&&(u=!0);else{let e=d[1],t=d[2];(c.y-e*c.x-t)*(h.y-e*h.x-t)>0&&(u=!0)}if(!u)return;let p=r.clone().sub(e.clone()),m=c.clone().sub(e.clone()),f=h.clone().sub(r.clone());if(0!=p.dot(m)||0!=p.dot(f))return;let g=i.roomCenter[0];g=new(0,$4xklQ.Vector3)(g[0],g[1],0);let x=new(0,$4xklQ.Vector3)((e.x+r.x)/2,(e.y+r.y)/2,0),b=g.clone().sub(x.clone()).setLength(1e5),y=c.clone().sub(n.clone()).setLength(100),w=h.clone().sub(n.clone()).setLength(100),v=$9HO6e.UtilCore.getClockWise(y,b,w);v<0&&(t=[x,e,r,i,l,s,i.roomCenter]),v>0&&(t=[x,e,r,i,s,l,i.roomCenter])}})),t}}var $9HO6e=parcelRequire("9HO6e");class $aa3f6685526d27fa$export$d9f78ae40723f6c8{constructor(e){this.editor=e}addLineDoorHelper(e,t,i,r,n=!0,o=280){let a=(new $d0f874000594cf7a$export$a955f3d6a39ce4b2).createDimensionsLineForDoor(e,t,i,o);this.editor.doorHelperGroup.add(a);let s=this.editor.getScreenPosition(a.center.clone()),l=new $2a0c8f99fe7360a8$export$ab52802de2137ca0(a.lineLength).setClass("showDoorLength"+a.uuid).setId("showDoorLength_"+r).setFontSize("15px").setWidth("40px").setMarginTop(s.y+"px").setFocus().setMarginLeft(s.x+"px").onKeyDown(function(e){if("Tab"==e.key){let t="";t="start"==r?document.getElementById("showDoorLength_width"):"width"==r?document.getElementById("showDoorLength_end"):document.getElementById("showDoorLength_start"),t.focus(),t.select(),e.preventDefault()}if("13"==e.keyCode){let e=document.getElementsByClassName("showDoorLength"+a.uuid)[0].value;this.editor.list.startPlayer.dispatch(),this.editor.currenDraw&&(this.editor.currentDoor=this.editor.currenDraw),this.editor.execute(new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor,"door","end",[e,1*e-a.lineLength,r]),"改变门尺寸")}}.bind(this)),c=a.center.x+"/"+a.center.y+"/"+a.center.z;return n||l.setDisabled(!0),l.setAttribute("worldPosition",c),this.editor.uiPanelBox.add(l),"start"==r&&this.editor.currenDraw&&(l.setFocus(),document.getElementById("showDoorLength_"+r).select()),a}addDoorHelper(e,t,i){let r=$9HO6e.UtilCore.getNewPoint(e),n=$9HO6e.UtilCore.getNewPoint(e,"end"),o=t.startPoint.clone(),a=t.endPoint.clone(),s=this.editor.getDisByScreen();this.addLineDoorHelper(o,a,t.wallDep,"width",!t.isLock,240/s);let l=$9HO6e.UtilCore.pointIsInLine(o,a,r),c=this.editor.getAllWindowInWall(e),h=[];c.forEach((i=>{i.uuid!=t.uuid&&("LWindow"==i.modelType?(i.leftWindow[0].wallID==e.wallID&&h.push(i.leftWindow[5]),i.rightWindow[0].wallID==e.wallID&&h.push(i.rightWindow[5])):"UWindow"==i.modelType?(i.leftWindow[0].wallID==e.wallID&&h.push(i.leftWindow[2]),i.rightWindow[0].wallID==e.wallID&&h.push(i.rightWindow[2])):h.push(i.startPoint.clone(),i.endPoint.clone()))})),h.push(t.startPoint.clone(),t.endPoint.clone());let d=$9HO6e.UtilCore.sortPoint(h,r,n);l||d.reverse();let u=[o.x,o.y],p=[a.x,a.y],m=$9HO6e.UtilCore.getArrayIndex(d,u,p),f=new(0,$4xklQ.Vector3)(m[0][0],m[0][1]),g=new(0,$4xklQ.Vector3)(m[1][0],m[1][1]);if(this.addLineDoorHelper(f,o,t.wallDep,"start",!t.isLock,240/s),this.addLineDoorHelper(a,g,t.wallDep,"end",!t.isLock,240/s),i&&!t.isLock){let e=new $d0f874000594cf7a$export$a955f3d6a39ce4b2;this.editor.pointHelperGroup.add(e.createDoorPoint(o,"start")),this.editor.pointHelperGroup.add(e.createDoorPoint(a,"end"))}}addUWindowHelper(e,t,i){let r=$9HO6e.UtilCore.getNewPoint(e),n=$9HO6e.UtilCore.getNewPoint(e,"end");if(this.addLineDoorHelper(r,n,t.wallDep,"width",!1),t.leftWindow){let r=t.leftWindow[0],n=t.leftWindow[1],o=t.rightWindow[0],a=t.rightWindow[1],s=$9HO6e.UtilCore.getSamePointTwoWall(e,r).clone(),l=$9HO6e.UtilCore.getSamePointTwoWall(e,o).clone(),c=$9HO6e.UtilCore.getMeshOtherPoint(r,s),h=$9HO6e.UtilCore.getMeshOtherPoint(o,l);s.add(c.clone().sub(s.clone()).setLength(e.thickness/2)),l.add(h.clone().sub(l.clone()).setLength(e.thickness/2));let d=s.clone().add(c.clone().sub(s.clone()).setLength(n)),u=l.clone().add(h.clone().sub(l.clone()).setLength(a));if(this.addLineDoorHelper(d,s,t.wallDep,"left",!t.isLock),this.addLineDoorHelper(l,u,t.wallDep,"right",!t.isLock),i){let e=new $d0f874000594cf7a$export$a955f3d6a39ce4b2;this.editor.pointHelperGroup.add(e.createDoorPoint(d,"left")),this.editor.pointHelperGroup.add(e.createDoorPoint(u,"right"))}}}addLWindowHelper(e,t){if(e.leftWindow){let i=e.leftWindow[0],r=e.leftWindow[1],n=e.rightWindow[0],o=e.rightWindow[1],a=e.center.clone(),s=e.center.clone(),l=$9HO6e.UtilCore.getMeshOtherPoint(i,a),c=$9HO6e.UtilCore.getMeshOtherPoint(n,s);a.add(l.clone().sub(a.clone()).setLength(e.leftWindow[4])),s.add(c.clone().sub(s.clone()).setLength(e.rightWindow[4]));let h=a.clone().add(l.clone().sub(a.clone()).setLength(r)),d=s.clone().add(c.clone().sub(s.clone()).setLength(o));if(this.addLineDoorHelper(a,h,e.wallDep,"left",!e.isLock),this.addLineDoorHelper(d,s,e.wallDep,"right",!e.isLock),t){let e=new $d0f874000594cf7a$export$a955f3d6a39ce4b2;this.editor.pointHelperGroup.add(e.createDoorPoint(h,"left")),this.editor.pointHelperGroup.add(e.createDoorPoint(d,"right"))}}}addArcWindowHelper(e){let t=new $d0f874000594cf7a$export$a955f3d6a39ce4b2;this.addLineDoorHelper(e.arcCenter,e.wallStartPoint,e.wallDep,"start",!1,0),this.addLineDoorHelper(e.wallEndPoint,e.arcCenter,e.wallDep,"end",!1,0),this.addArcLineHelper(e);let i="arcStart",r="arcEnd";$9HO6e.UtilCore.getClockWise(e.wallStartPoint,e.center,e.wallEndPoint)<0&&(i="arcEnd",r="arcStart"),this.editor.pointHelperGroup.add(t.createDoorPoint(e.wallStartPoint,i)),this.editor.pointHelperGroup.add(t.createDoorPoint(e.wallEndPoint,r))}addArcLineHelper(e){let t=new $d0f874000594cf7a$export$a955f3d6a39ce4b2,i=e.center.clone().sub(e.arcCenter.clone()).angle(),r=i-e.angle,n=i+e.angle,o=e.arcCenter.distanceTo(e.startPoint),a=t.createCircleAngleLine(e.arcCenter,o,r,n,!1);this.editor.doorHelperGroup.add(a);let s=this.editor.getScreenPosition(a.center.clone()),l=Math.round(180/Math.PI*(2*e.angle))+"°",c=new $2a0c8f99fe7360a8$export$ab52802de2137ca0(l).setClass("showDoorLength"+a.uuid).setFontSize("15px").setWidth("40px").setMarginTop(s.y+"px").setFocus().setMarginLeft(s.x+"px").onKeyDown(function(t){if("13"==t.keyCode){let t=document.getElementsByClassName("showDoorLength"+a.uuid)[0].value;t=t.replace(/°/g,""),this.editor.execute(new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor,"door","end",[1*t,e,"arcAngle"]),"改变圆弧门角度尺寸")}}.bind(this)),h=a.center.x+"/"+a.center.y+"/"+a.center.z;return c.setAttribute("worldPosition",h),this.editor.uiPanelBox.add(c),a}}class $d1f58c4378eaed8a$export$79a920aedf5098c2{constructor(e){this.editor=e}addMemberHelper(e){let t="";e.children.forEach((e=>{"Mesh"!=e.type||(t=e)})),e.modelType&&e.modelType.indexOf("Model")>=0&&(t=e);let i=this.editor.wallHelp.addScaleTool(t),r=e.rotation.z-Math.PI/2,n=this.editor.wallHelp.addAngleTool(t,1500,r-Math.PI/8,r+Math.PI/8);return this.editor.addPositionHelper(e,!0),[i,n]}}var $g4HAh=parcelRequire("g4HAh"),$7WCxl=parcelRequire("7WCxl"),$ia4Lh=parcelRequire("ia4Lh"),$4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ");function $7105639920ca2782$export$6c88edee752dd9eb(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function $7105639920ca2782$export$2109ac0eb198e8e1(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function $7105639920ca2782$export$4502ca4ab902332b(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function $7105639920ca2782$export$12777782e1f2ebd6(e,t,i){const r=t[0],n=t[1],o=t[2],a=i[0],s=i[1],l=i[2];return e[0]=n*l-o*s,e[1]=o*a-r*l,e[2]=r*s-n*a,e}function $7105639920ca2782$export$61e064fa4319657e(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function $7105639920ca2782$export$161c7d8fe92cc5b8(e,t,i,r){return e[0]=i[0]*r+t[0],e[1]=i[1]*r+t[1],e[2]=i[2]*r+t[2],e}function $7105639920ca2782$export$e1cd8e8a2c5628e8(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function $7105639920ca2782$export$e58585affaf72c80(e,t){let i=Math.sqrt(t[0]**2+t[1]**2+t[2]**2);return 0!=i&&(i=1/i,e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i),e}function $7105639920ca2782$export$dd965c5947d39cd9(e,t,i){const r=i[0],n=i[1],o=i[2],a=i[3],s=t[0],l=t[1],c=t[2],h=n*c-o*l,d=o*s-r*c,u=r*l-n*s,p=a*h+n*u-o*d,m=a*d+o*h-r*u,f=a*u+r*d-n*h;return e[0]=s+2*p,e[1]=l+2*m,e[2]=c+2*f,e}function $7105639920ca2782$export$b5fac42edf93a2c4(e,t){return void 0===t?e[0]**2+e[1]**2+e[2]**2:(e[0]-t[0])**2+(e[1]-t[1])**2+(e[2]-t[2])**2}function $7105639920ca2782$export$248e13d25bcf0477(e,t){return void 0===t?Math.sqrt(e[0]**2+e[1]**2+e[2]**2):Math.sqrt((e[0]-t[0])**2+(e[1]-t[1])**2+(e[2]-t[2])**2)}function $7105639920ca2782$export$73f2472758f1a945(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function $7105639920ca2782$export$22396e39055416da(e,t,i,r){const n=1-r;return e[0]=t[0]*n+i[0]*r,e[1]=t[1]*n+i[1]*r,e[2]=t[2]*n+i[2]*r,e}function $7105639920ca2782$export$4965da4a2b45c55c(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function $7105639920ca2782$export$751d2f71684a1803(e,t,i){const r=t[0],n=t[1],o=t[2],a=t[3],s=i[0],l=i[1],c=i[2],h=i[3];return e[0]=r*h+a*s+n*c-o*l,e[1]=n*h+a*l+o*s-r*c,e[2]=o*h+a*c+r*l-n*s,e[3]=a*h-r*s-n*l-o*c,e}function $7105639920ca2782$export$f6df5bcafeec890a(e,t){let i=t[0]**2+t[1]**2+t[2]**2+t[3]**2;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i),e}function $7105639920ca2782$export$a37b936e06864608(e,t,i){const r=.5*i,n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function $7105639920ca2782$export$4cd473ec64bcb9d1(e,t){return void 0===t?e[0]**2+e[1]**2+e[2]**2+e[3]**2:(e[0]-t[0])**2+(e[1]-t[1])**2+(e[2]-t[2])**2+(e[3]-t[3])**2}class $ca835aece37b4faf$export$a186db52eed6d40e{posStart=[0,0,0];posEnd=[0,0,0];direction=[0,0,0];vecLength=[0,0,0];posAt(e,t){return(t=t||[0,0,0])[0]=this.vecLength[0]*e+this.posStart[0],t[1]=this.vecLength[1]*e+this.posStart[1],t[2]=this.vecLength[2]*e+this.posStart[2],t}directionAt(e,t){return(t=t||[0,0,0])[0]=this.direction[0]*e+this.posStart[0],t[1]=this.direction[1]*e+this.posStart[1],t[2]=this.direction[2]*e+this.posStart[2],t}fromCaster(e){$7105639920ca2782$export$6c88edee752dd9eb(this.posStart,e.ray.origin.toArray()),$7105639920ca2782$export$6c88edee752dd9eb(this.direction,e.ray.direction.toArray());const t=e.far==1/0?1e3:e.far;$7105639920ca2782$export$e1cd8e8a2c5628e8(this.vecLength,this.direction,t),$7105639920ca2782$export$2109ac0eb198e8e1(this.posEnd,this.posStart,this.vecLength)}}function $ca835aece37b4faf$export$9c807428cab3165a(e,t,i){const r=i*i,n=$7105639920ca2782$export$4502ca4ab902332b([0,0,0],t,e.posStart),o=$7105639920ca2782$export$61e064fa4319657e(n,e.direction);return!($7105639920ca2782$export$b5fac42edf93a2c4(n)-o*o>r)}function $ca835aece37b4faf$export$982e9c0e8681b1ba(e,t,i){const r=$7105639920ca2782$export$61e064fa4319657e(e.vecLength,i);if(r<=1e-6&&r>=-1e-6)return null;const n=$7105639920ca2782$export$61e064fa4319657e($7105639920ca2782$export$4502ca4ab902332b([0,0,0],t,e.posStart),i)/r;return n>=0?n:null}function $ca835aece37b4faf$export$1a557053019a130b(e,t,i,r,n,o=!0){const a=$7105639920ca2782$export$4502ca4ab902332b([0,0,0],i,t),s=$7105639920ca2782$export$4502ca4ab902332b([0,0,0],r,t),l=$7105639920ca2782$export$12777782e1f2ebd6([0,0,0],e.direction,s),c=$7105639920ca2782$export$61e064fa4319657e(a,l);if(o&&c<1e-6)return!1;const h=1/c,d=$7105639920ca2782$export$4502ca4ab902332b([0,0,0],e.posStart,t),u=$7105639920ca2782$export$61e064fa4319657e(d,l)*h;if(u<0||u>1)return!1;const p=$7105639920ca2782$export$12777782e1f2ebd6([0,0,0],d,a),m=$7105639920ca2782$export$61e064fa4319657e(e.direction,p)*h;if(m<0||u+m>1)return!1;if(n){const t=$7105639920ca2782$export$61e064fa4319657e(s,p)*h;e.directionAt(t,n)}return!0}function $ca835aece37b4faf$export$fcb4e708533b5535(e,t,i=.1){const r=$7105639920ca2782$export$4502ca4ab902332b([0,0,0],t,e.posStart);$7105639920ca2782$export$73f2472758f1a945(r,r,e.vecLength);const n=(r[0]+r[1]+r[2])/$7105639920ca2782$export$b5fac42edf93a2c4(e.vecLength);if(n<0||n>1)return null;return $7105639920ca2782$export$b5fac42edf93a2c4(e.posAt(n,r),t)<=i*i?n:null}class $ca835aece37b4faf$export$54b042963a16d37f{segPosition=[0,0,0];rayPosition=[0,0,0];distanceSq=0;distance=0}function $ca835aece37b4faf$export$afc7f583ff059022(e,t,i,r=null){const n=$7105639920ca2782$export$4502ca4ab902332b([0,0,0],i,t),o=e.vecLength,a=$7105639920ca2782$export$4502ca4ab902332b([0,0,0],t,e.posStart),s=$7105639920ca2782$export$61e064fa4319657e(n,n),l=$7105639920ca2782$export$61e064fa4319657e(n,o),c=$7105639920ca2782$export$61e064fa4319657e(o,o),h=$7105639920ca2782$export$61e064fa4319657e(n,a),d=$7105639920ca2782$export$61e064fa4319657e(o,a),u=s*c-l*l;let p=0,m=0;return u<1e-6?(p=0,m=l>c?h/l:d/c):(p=(l*d-c*h)/u,m=(s*d-l*h)/u),!(p<0||p>1||m<0||m>1)&&(r&&($7105639920ca2782$export$22396e39055416da(r.rayPosition,e.posStart,e.posEnd,m),$7105639920ca2782$export$22396e39055416da(r.segPosition,t,i,p),r.distance=$7105639920ca2782$export$248e13d25bcf0477(r.segPosition,r.rayPosition)),!0)}const $8aa2c62b7a798ac5$export$85791ce3793386a5=Object.freeze({Translate:0,Rotate:1,Scale:2});class $8aa2c62b7a798ac5$export$78a53f609f65f689{scaleFactor=10;minFlipAdjust=-.02;minHitDistance=.1;minPntDistance=.1;minArcDistance=.1;lastCamPos=[0,0,0];lastCamRot=[0,0,0,1];hasHit=!1;hasUpdated=!0;isDragging=!1;isActive=!1;intersectPos=[0,0,0];position=[0,0,0];scale=[1,1,1];infoScale=1;arcRadius=1;axisLen=1;midPointLen=.55;sclPointLen=1.1;useTranslate=!0;useScale=!0;useRotate=!0;axes=[{dir:[1,0,0],endPos:[1,0,0],midPos:[0,0,0],sclPos:[0,0,0]},{dir:[0,1,0],endPos:[0,1,0],midPos:[0,0,0],sclPos:[0,0,0]},{dir:[0,0,1],endPos:[0,0,1],midPos:[0,0,0],sclPos:[0,0,0]}];traceStep=.5;traceLine={isActive:!1,hitPos:[0,0,0],origin:[0,0,0],a:[0,0,0],b:[0,0,0],dir:[0,0,0]};activeMode=$8aa2c62b7a798ac5$export$85791ce3793386a5.Translate;activeAxis=-1;activePlane=-1;onDragStart=null;onDragEnd=null;onTranslate=null;onRotate=null;onScale=null;setPosition(e,t,i){return 3===e.length?(this.position[0]=e[0],this.position[1]=e[1],this.position[2]=e[2]):(this.position[0]=e,this.position[1]=t,this.position[2]=i),this.hasUpdated=!0,this}updateFromCamera(e,t,i=!1){return(this.isDragging||Math.abs($7105639920ca2782$export$b5fac42edf93a2c4(e,this.lastCamPos))<=1e-6&&Math.abs($7105639920ca2782$export$4cd473ec64bcb9d1(t,this.lastCamRot))<=1e-6)&&!i||($7105639920ca2782$export$6c88edee752dd9eb(this.lastCamPos,e),$7105639920ca2782$export$4965da4a2b45c55c(this.lastCamRot,t),this._calcCameraScale()),this}resetState(){this.traceLine.isActive=!1,this.activeMode=$8aa2c62b7a798ac5$export$85791ce3793386a5.Translate,this.activeAxis=-1,this.activePlane=-1}startDrag(){this.isDragging=!0,this.onDragStart&&this.onDragStart()}stopDrag(){this.isDragging=!1,this.onDragEnd&&this.onDragEnd()}_movePlane(e,t){const i=this.axes[t].dir,r=$ca835aece37b4faf$export$982e9c0e8681b1ba(e,this.position,i);return null!=r&&(e.posAt(r,this.position),this.calcAxesPosition(),this.onTranslate&&this.onTranslate(this.position.slice(0)),!0)}_moveTrace(e){const t=new $ca835aece37b4faf$export$54b042963a16d37f;if($ca835aece37b4faf$export$afc7f583ff059022(e,this.traceLine.a,this.traceLine.b,t)){switch($7105639920ca2782$export$6c88edee752dd9eb(this.traceLine.hitPos,t.segPosition),this.activeMode){case $8aa2c62b7a798ac5$export$85791ce3793386a5.Translate:$7105639920ca2782$export$6c88edee752dd9eb(this.position,t.segPosition),this.calcAxesPosition(),this.onTranslate&&this.onTranslate(t.segPosition.slice(0));break;case $8aa2c62b7a798ac5$export$85791ce3793386a5.Rotate:case $8aa2c62b7a798ac5$export$85791ce3793386a5.Scale:const e=$7105639920ca2782$export$4502ca4ab902332b([0,0,0],t.segPosition,this.traceLine.origin),i=$7105639920ca2782$export$248e13d25bcf0477(e),r=Math.sign($7105639920ca2782$export$61e064fa4319657e(e,this.traceLine.dir)),n=i/this.traceStep*r;this.onRotate&&this.activeMode===$8aa2c62b7a798ac5$export$85791ce3793386a5.Rotate&&this.onRotate(n,this.activeAxis),this.onScale&&this.activeMode===$8aa2c62b7a798ac5$export$85791ce3793386a5.Scale&&this.onScale(n,this.activeAxis>=0?this.activeAxis:null)}return!0}return!1}onRayDown(e){return!(!this.isActive||!this._rayIntersect(e))&&(this.startDrag(),!0)}onRayHover(e){return!(!this.isActive||this.isDragging)&&this._rayIntersect(e)}onRayMove(e){if(this.isActive&&!this.isDragging)return!1;if(-1!=this.activeAxis)this._moveTrace(e);else if(-1!=this.activePlane)return this._movePlane(e,this.activePlane);return!1}_setTraceLine(e,t=-1){this.traceLine.isActive=!0,$7105639920ca2782$export$6c88edee752dd9eb(this.traceLine.origin,e),$7105639920ca2782$export$6c88edee752dd9eb(this.traceLine.hitPos,e),-1==t?$7105639920ca2782$export$dd965c5947d39cd9(this.traceLine.dir,[1,0,0],this.lastCamRot):$7105639920ca2782$export$6c88edee752dd9eb(this.traceLine.dir,this.axes[t].dir),$7105639920ca2782$export$161c7d8fe92cc5b8(this.traceLine.a,e,this.traceLine.dir,-1e3),$7105639920ca2782$export$161c7d8fe92cc5b8(this.traceLine.b,e,this.traceLine.dir,1e3)}_calcCameraScale(){const e=$7105639920ca2782$export$4502ca4ab902332b([0,0,0],this.lastCamPos,this.position),t=$7105639920ca2782$export$248e13d25bcf0477(e);this.infoScale=t/this.scaleFactor,$7105639920ca2782$export$e58585affaf72c80(e,e),$7105639920ca2782$export$e1cd8e8a2c5628e8(this.scale,[1,1,1],this.infoScale),$7105639920ca2782$export$61e064fa4319657e(e,[1,0,0])<this.minFlipAdjust&&(this.scale[0]=-this.scale[0]),$7105639920ca2782$export$61e064fa4319657e(e,[0,1,0])<this.minFlipAdjust&&(this.scale[1]=-this.scale[1]),$7105639920ca2782$export$61e064fa4319657e(e,[0,0,1])<this.minFlipAdjust&&(this.scale[2]=-this.scale[2]),this.calcAxesPosition()}calcAxesPosition(){const e=this.axes;for(let t=0;t<3;t++)$7105639920ca2782$export$161c7d8fe92cc5b8(e[t].endPos,this.position,e[t].dir,this.scale[t]*this.axisLen),$7105639920ca2782$export$161c7d8fe92cc5b8(e[t].midPos,this.position,e[t].dir,this.scale[t]*this.midPointLen),$7105639920ca2782$export$161c7d8fe92cc5b8(e[t].sclPos,this.position,e[t].dir,this.scale[t]*this.sclPointLen);this.hasUpdated=!0}_rayIntersect(e){if(!this._testSphere(e))return!1;const t=this.activeAxis;this.resetState();let i=this.useScale&&this._testPoints(e);return i=i||this.useTranslate&&this._testAxis(e),i=i||this.useRotate&&this._testArc(e),t!==this.activeAxis&&(this.hasUpdated=!0),this.hasHit=i,i}_testSphere(e){return $ca835aece37b4faf$export$9c807428cab3165a(e,this.position,(this.sclPointLen+this.minPntDistance)*this.infoScale)}_testPlanes(e){const t=this.axes;let i,r;for(i=0;i<3;i++)if(r=(i+1)%3,$ca835aece37b4faf$export$1a557053019a130b(e,t[i].midPos,t[r].midPos,this.position,this.intersectPos,!1))return this.activePlane=(i+2)%3,!0;return!1}_testArc(e){const t=this.infoScale*this.minArcDistance,i=this.axes,r=[0,0,0],n=[0,0,0],o=[0,0,0],a=this.arcRadius*this.infoScale;let s,l,c,h,d;for(c=0;c<3;c++)if(s=$ca835aece37b4faf$export$982e9c0e8681b1ba(e,this.position,i[c].dir),null!==s&&(e.posAt(s,r),l=$7105639920ca2782$export$248e13d25bcf0477(this.position,r),Math.abs(l-a)<=t&&(h=(c+1)%3,$7105639920ca2782$export$4502ca4ab902332b(n,r,this.position),$7105639920ca2782$export$e1cd8e8a2c5628e8(o,i[h].dir,Math.sign(this.scale[h])),$7105639920ca2782$export$61e064fa4319657e(n,o)>=0&&(d=(c+2)%3,$7105639920ca2782$export$e1cd8e8a2c5628e8(o,i[d].dir,Math.sign(this.scale[d])),$7105639920ca2782$export$61e064fa4319657e(n,o)>=0))))return this.activeAxis=c,this.activeMode=$8aa2c62b7a798ac5$export$85791ce3793386a5.Rotate,this._setTraceLine(r),$7105639920ca2782$export$6c88edee752dd9eb(this.intersectPos,r),!0;return!1}_testAxis(e){const t=this.infoScale*this.minHitDistance,i=new $ca835aece37b4faf$export$54b042963a16d37f,r=[0,0,0];let n,o=1/0,a=-1;for(let s=0;s<3;s++)n=this.axes[s],$ca835aece37b4faf$export$afc7f583ff059022(e,this.position,n.endPos,i)&&i.distance<=t&&i.distance<o&&(o=i.distance,a=s,$7105639920ca2782$export$6c88edee752dd9eb(r,i.segPosition));return-1!==a&&(this.activeAxis=a,this._setTraceLine(r,a),$7105639920ca2782$export$6c88edee752dd9eb(this.intersectPos,r),!0)}_testPoints(e){const t=this.infoScale*this.minPntDistance;let i=$ca835aece37b4faf$export$fcb4e708533b5535(e,this.position,t);if(null!==i)return this._setTraceLine(this.position),this.activeMode=$8aa2c62b7a798ac5$export$85791ce3793386a5.Scale,this.activeAxis=-2,!0;for(let r=0;r<3;r++)if(i=$ca835aece37b4faf$export$fcb4e708533b5535(e,this.axes[r].sclPos,t),null!==i)return this._setTraceLine(this.axes[r].sclPos,r),this.activeAxis=r,this.activeMode=$8aa2c62b7a798ac5$export$85791ce3793386a5.Scale,$7105639920ca2782$export$6c88edee752dd9eb(this.intersectPos,this.axes[r].sclPos),!0;return!1}}var $4xklQ=parcelRequire("4xklQ");class $ec81fbac4de7de11$export$49da1b7bd1faada1 extends $4xklQ.Group{axisColors=[16216426,7186922,8509299];axisLines=[];axisArcs=[];axisPoints=[];axisTris=[];grpCtrl=new(0,$4xklQ.Group);meshTracePnt=null;meshTraceLine=null;colSelect=16777215;colOrigin=16776960;constructor(e){super();const t=.5*Math.PI,i=e.arcRadius,r=e.sclPointLen;this.visible=!1;const n=new(0,$4xklQ.MeshBasicMaterial)({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0,side:$4xklQ.DoubleSide,opacity:1,color:16777215}),o=new(0,$4xklQ.LineBasicMaterial)({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0,color:9474192}),a=new(0,$4xklQ.BufferGeometry);a.setAttribute("position",new(0,$4xklQ.Float32BufferAttribute)([0,0,0,0,100,0],3));const s=new(0,$4xklQ.BufferGeometry);s.setAttribute("position",new(0,$4xklQ.Float32BufferAttribute)([0,0,0,e.midPointLen,0,0,0,e.midPointLen,0],3));const l=new(0,$4xklQ.SphereGeometry)(.1,8,8),c=new(0,$4xklQ.TorusGeometry)(i,.03,3,10,t),h=new(0,$4xklQ.CylinderGeometry)(.03,.03,e.axisLen,3);h.translate(0,.5*e.axisLen,0);const d=new(0,$4xklQ.Mesh)(h,n.clone());this.grpCtrl.add(d);const u=new(0,$4xklQ.Mesh)(h,n.clone());u.rotation.x=t,this.grpCtrl.add(u);const p=new(0,$4xklQ.Mesh)(h,n.clone());p.rotation.z=-t,this.grpCtrl.add(p),this.axisLines.push(p,d,u);const m=new(0,$4xklQ.Mesh)(c,n.clone());m.name="ZAXIS",this.grpCtrl.add(m);const f=new(0,$4xklQ.Mesh)(c,n.clone());f.name="XAXIS",f.rotation.y=-t,this.grpCtrl.add(f);const g=new(0,$4xklQ.Mesh)(c,n.clone());g.rotation.x=t,this.grpCtrl.add(g),this.axisArcs.push(f,g,m);const x=new(0,$4xklQ.Mesh)(l,n.clone());x.position.z=r,this.grpCtrl.add(x);const b=new(0,$4xklQ.Mesh)(l,n.clone());b.position.x=r,this.grpCtrl.add(b);const y=new(0,$4xklQ.Mesh)(l,n.clone());y.position.y=r,this.grpCtrl.add(y),this.axisPoints.push(b,y,x);const w=new(0,$4xklQ.Mesh)(s,n.clone()),v=new(0,$4xklQ.Mesh)(s,n.clone());v.rotation.x=t;const $=new(0,$4xklQ.Mesh)(s,n.clone());$.rotation.y=-t,this.axisTris.push($,v,w),this.meshTraceLine=new(0,$4xklQ.Line)(a,o),this.meshTraceLine.visible=!1,this.meshTraceLine.layers.set(2),this.add(this.meshTraceLine),this.meshTracePnt=new(0,$4xklQ.Mesh)(l,n.clone()),this.meshTracePnt.visible=!1,this.meshTraceLine.layers.set(2),this.add(this.meshTracePnt),this.origin=new(0,$4xklQ.Mesh)(l,n.clone()),this.grpCtrl.add(this.origin),this.grpCtrl.traverse((function(e){e.layers.set(2)})),this.add(this.grpCtrl)}showGizmo(){this.grpCtrl.visible=!0}hideGizmo(){this.grpCtrl.visible=!1}updateLook(e){let t;for(t of this.axisArcs)t.visible=e.useRotate;for(t of(this.origin.visible=e.useScale,this.axisPoints))t.visible=e.useScale;for(t of this.axisTris)t.visible=e.useTranslate}update(e){if(e.hasUpdated||e.hasHit){this.grpCtrl.scale.fromArray(e.scale),this.grpCtrl.position.fromArray(e.position),-2===e.activeAxis&&e.activeMode===$8aa2c62b7a798ac5$export$85791ce3793386a5.Scale?this.origin.material.color.setHex(this.colSelect):this.origin.material.color.setHex(this.colOrigin);for(let t=0;t<3;t++){if(this.axisLines[t].material.color.setHex(this.axisColors[t]),this.axisArcs[t].material.color.setHex(this.axisColors[t]),this.axisPoints[t].material.color.setHex(this.axisColors[t]),this.axisTris[t].material.color.setHex(this.axisColors[t]),t===e.activeAxis)switch(e.activeMode){case $8aa2c62b7a798ac5$export$85791ce3793386a5.Translate:this.axisLines[t].material.color.setHex(this.colSelect);break;case $8aa2c62b7a798ac5$export$85791ce3793386a5.Rotate:this.axisArcs[t].material.color.setHex(this.colSelect);break;case $8aa2c62b7a798ac5$export$85791ce3793386a5.Scale:this.axisPoints[t].material.color.setHex(this.colSelect)}t===e.activePlane&&this.axisTris[t].material.color.setHex(16777215)}if(e.traceLine.isActive){const t=Math.abs(e.scale[2]);this.meshTracePnt.visible=!0,this.meshTracePnt.scale.set(t,t,t),this.meshTracePnt.position.fromArray(e.traceLine.origin),this.meshTraceLine.visible=!0,this.meshTraceLine.geometry.attributes.position.needsUpdate=!0;const i=this.meshTraceLine.geometry.attributes.position.array;i[0]=e.traceLine.a[0],i[1]=e.traceLine.a[1],i[2]=e.traceLine.a[2],i[3]=e.traceLine.b[0],i[4]=e.traceLine.b[1],i[5]=e.traceLine.b[2]}else this.meshTraceLine.visible=!1,this.meshTracePnt.visible=!1}}}class $07cd6c79b5fb98d9$export$a4d73611b6b02716{mesh=null;data=null;attachedObject=null;_camera=null;_renderer=null;_caster=new(0,$4xklQ.Raycaster);_ray=new $ca835aece37b4faf$export$a186db52eed6d40e;_scaleStep=.1;_rotateStep=10*Math.PI/180;_intersectOffset=[0,0,0];_initDragPosition=[0,0,0];_initDragQuaternion=[0,0,0,1];_initDragScale=[0,0,0];_3jsVec=new(0,$4xklQ.Vector3);_3jsQuat=new(0,$4xklQ.Quaternion);constructor(e,t,i,r=null,n=!1){this.data=new $8aa2c62b7a798ac5$export$78a53f609f65f689,this._camera=t,this.editor=i,n||(this.mesh=new $ec81fbac4de7de11$export$49da1b7bd1faada1(this.data),this.mesh.layers.set(2),this.mesh.name="modelAxisHelper",this.editor.modelHelperGroup.add(this.mesh)),this.clickEventHandler=this.clickEvent.bind(this),this.pointerMoveHandler=this.pointermove.bind(this),this.pointerDownHandler=this.pointerdown.bind(this),this.pointerUpHandler=this.pointerup.bind(this),this.dragstartHandler=this.dragstart.bind(this),this.dragendHandler=this.dragend.bind(this),this.boxColor=this.editor.config.boxColor,this.data.onDragStart=()=>this._onDragStart(),this.data.onDragEnd=()=>this._onDragEnd(),this.data.onTranslate=e=>this._onTranslate(e),this.data.onRotate=(e,t)=>this._onRotate(e,t),this.data.onScale=(e,t)=>this._onScale(e,t),this.stopClick=!1,r&&this.setRenderer(r),this.update(!0)}clickEvent(e){this.stopClick&&(e.stopImmediatePropagation(),this.stopClick=!1)}pointermove(e){if(!this.editor.camera.isOrthographicCamera)if(this.update(),this._updateRaycaster(e),this.data.isDragging){if(this.data.onRayMove(this._ray),this.editor.dom.setPointerCapture(e.pointerId),e.preventDefault(),e.stopPropagation(),2==this.data.activeMode){let e=this.attachedObject,t=e.modelPosition;e.updateMatrixWorld(!0,!0);let i=this.editor.getRealSize(e);e.updateMatrixWorld(!0,!0);let r=(new(0,$4xklQ.Vector3)).setFromMatrixScale(e.matrixWorld).clone().divide(e.scale),n=(i[1]-e.oldFloor)/2/r.y;"top"==t?e.position.y-=n:e.position.y+=n,this.attachedObject.oldFloor=i[1]}if(this.editor.synchroModel(this.attachedObject),this.editor.clickDepthMsg.uuid){this.editor.modelDotGroup.children=[];let e=this.editor.getOuterParent(this.attachedObject,this.attachedObject,"outer");this.editor.addDashBoxForGroup(e),this.editor.addDashBoxFor2dGroup(e.param[0])}this.editor.modelHelperGroup.children.slice(0).forEach((e=>{"modelBox"==e.name&&this.editor.modelHelperGroup.remove(e)})),this.editor.addBoxForGroup(this.attachedObject),this.editor.doorHelperGroupClean(),this.editor.addLineHelperForMember(this.attachedObject.param[0])}else this.data.onRayHover(this._ray)}pointerdown(e){if(this.editor.downPoint=this.editor.getWorldPosition(e),this._updateRaycaster(e),this.data.onRayDown(this._ray)){this.startPoint=[e.offsetX,e.offsetY],this.startJson=this.editor.getSceneAllJson(),e.preventDefault(),e.stopPropagation(),this.stopClick=!0,this.attachedObject.updateMatrixWorld(!0,!0);let t=this.editor.getRealSize(this.attachedObject);this.attachedObject.oldFloor=t[1]}}pointerup(e){if(this.editor.currentPoint=this.editor.getWorldPosition(e),this.data.isDragging){if("CodeModel"==this.attachedObject.modelType&&this.attachedObject.parent){let e=this.editor.getWallByMesh(this.attachedObject);this.editor.partRefreshWall(e,this.attachedObject)}e.offsetX==this.startPoint[0]&&e.offsetY==this.startPoint[1]||this.editor.execute("","",this.startJson),this.data.stopDrag(),this.editor.dom.releasePointerCapture(e.pointerId)}this.attachedObject.oldFloor&&delete this.attachedObject.oldFloor}dragstart(e){""!=this.editor.globalControl&&(this.editor.globalControl.enabled=!1)}dragend(e){""!=this.editor.globalControl&&(this.editor.globalControl.enabled=!0)}setRenderer(e){const t=this.editor.dom;if(this._renderer=e,this.editor.transform3DTool){let e=this.editor.transform3DTool;t.removeEventListener("pointermove",e.pointerMoveHandler),t.removeEventListener("pointerdown",e.pointerDownHandler),t.removeEventListener("pointerup",e.pointerUpHandler),t.removeEventListener("dragstart",e.dragstartHandler),t.removeEventListener("dragend",e.dragendHandler)}this.editor.camera.isOrthographicCamera||(t.addEventListener("click",this.clickEventHandler),t.addEventListener("pointermove",this.pointerMoveHandler),t.addEventListener("pointerdown",this.pointerDownHandler),t.addEventListener("pointerup",this.pointerUpHandler),t.addEventListener("dragstart",this.dragstartHandler),t.addEventListener("dragend",this.dragendHandler))}rayHover(e){return this.update(),this._ray.fromCaster(e),this.data.onRayHover(this._ray)}rayMove(e){return this.update(),this._ray.fromCaster(e),this.data.onRayMove(this._ray)}rayDown(e){return this._ray.fromCaster(e),this.data.onRayDown(this._ray)}rayUp(){this.data.isDragging&&this.data.stopDrag()}isDragging(){return this.data.isDragging}isActive(){return this.data.isActive}setActive(e){return this.data.isActive=e,this.mesh&&(this.mesh.visible=e),e&&this.updateStateFromCamera(),this}useTranslate(e){return this.data.useTranslate=e,this.mesh.updateLook(this.data),this}useRotate(e){return this.data.useRotate=e,this.mesh.updateLook(this.data),this}useScale(e){return this.data.useScale=e,this.mesh.updateLook(this.data),this}setTraceLineStepDistance(e){return this.data.traceStep=e,this}setScaleStep(e){return this._scaleStep=e,this}setRotationStep(e){return this._rotateStep=e*Math.PI/180,this}setScaleFactor(e){return this.data.scaleFactor=e,this}attach(e){if(!this.data.isActive)return;this.attachedObject=e;var t=new(0,$4xklQ.Vector3);e.getWorldPosition(t),this.data.setPosition(t.toArray()),this.data.calcAxesPosition(),this.update(!0);const i=this.editor.wallHelp.addOBBbox(e,this.boxColor);i.name="modelBox",i.layers.set(2),this.editor.modelHelperGroup.add(i)}switchRot(e){return this.mesh.axisArcs.forEach((t=>{""!=t.name&&(t.visible=e)})),this}switchMove(e){return this.mesh.axisLines.forEach((t=>{t.visible=e})),this}detach(){this.attachedObject=null}update(e=!1){return!(!this.data.isActive&&!e)&&(this.updateStateFromCamera(e),!(!this.data.hasUpdated&&!this.data.hasHit||!this.mesh)&&(this.mesh.update(this.data),this.data.hasUpdated=!1,this.data.hasHit=!1,!0))}updateStateFromCamera(e=!1){this._camera.getWorldPosition(this._3jsVec),this._camera.getWorldQuaternion(this._3jsQuat),this.data.updateFromCamera(this._3jsVec.toArray(),this._3jsQuat.toArray(),e)}isDragging(){return this.data.isDragging}_screenToNDCCoord(e){const t=this.editor.dom.getBoundingClientRect(),i=e.clientX-t.x,r=e.clientY-t.y;return{x:i/t.width*2-1,y:-r/t.height*2+1}}_updateRaycaster(e){this._caster.setFromCamera(this._screenToNDCCoord(e),this._camera),this._ray.fromCaster(this._caster)}_onDragStart(){$7105639920ca2782$export$6c88edee752dd9eb(this._initDragPosition,this.attachedObject.position.toArray()),$7105639920ca2782$export$6c88edee752dd9eb(this._initDragScale,this.attachedObject.scale.toArray()),$7105639920ca2782$export$4965da4a2b45c55c(this._initDragQuaternion,this.attachedObject.quaternion.toArray()),$7105639920ca2782$export$4502ca4ab902332b(this._intersectOffset,this.data.position,this.data.intersectPos),this.data.activeMode,$8aa2c62b7a798ac5$export$85791ce3793386a5.Translate,this.data.hasUpdated=!0,this._emit("dragstart")}_onDragEnd(){this.data.calcAxesPosition(),this.data.resetState(),this.mesh.showGizmo();let e=this.editor.getOuterParent(this.attachedObject,this.attachedObject,"outer");if(this.editor.refreshRealSizeByBox(e,this.attachedObject),this.editor.updateModelPosition(this.attachedObject.parent,e),this.editor.clickDepthMsg.uuid){this.editor.modelDotGroup.children=[];let e=this.editor.getOuterParent(this.attachedObject,this.attachedObject,"outer");this.editor.addDashBoxForGroup(e),this.editor.addDashBoxFor2dGroup(e.param[0])}this._emit("dragend")}_onTranslate(e){let t=$7105639920ca2782$export$2109ac0eb198e8e1([0,0,0],e,this._intersectOffset);if(this.data.setPosition(t),this.attachedObject.parent){if("Scene"!=this.attachedObject.parent.type){this.attachedObject.parent.updateWorldMatrix(!0,!1);let e=new(0,$4xklQ.Vector3)(t[0],t[1],t[2]),i=this.attachedObject.parent.worldToLocal(e);t=[i.x,i.y,i.z]}this.attachedObject.position.fromArray(t),this._emit("translate",t)}}_onRotate(e,t){if(!this.mesh.axisArcs[0].visible&&1!=t)return;const i=1===t?1:-Math.sign(this.data.scale[t]);2==t&&(e*=-1);let r=Math.round(180/Math.PI*e);r>0&&(r-=360*parseInt(r/360)),r<0&&(r+=360*Math.abs(parseInt(r/360))),r<0&&(r+=360);r>=-8&&r<=8&&(r=0),r>=37&&r<=53&&(r=45),r>=82&&r<=98&&(r=90),r>=127&&r<=143&&(r=135),r>=172&&r<=188&&(r=180),r>=217&&r<=233&&(r=225),r>=262&&r<=278&&(r=270),r>=307&&r<=323&&(r=315),r>=352&&r<=368&&(r=360),e=Math.PI/180*r;const n=$7105639920ca2782$export$a37b936e06864608([0,0,0,1],this.data.axes[t].dir,this._rotateStep*e*i);$7105639920ca2782$export$751d2f71684a1803(n,n,this._initDragQuaternion),$7105639920ca2782$export$f6df5bcafeec890a(n,n),0==t&&(this.attachedObject.rotation.x=e),1==t&&(this.attachedObject.rotation.y=e),2==t&&(this.attachedObject.rotation.z=e),this._emit("rotate",n)}_onScale(e,t){const i=this._initDragScale.slice(0),r=e*this._scaleStep;null===t?(i[0]+=r,i[1]+=r,i[2]+=r):i[t]+=r*Math.sign(this.data.scale[t]),this.attachedObject.scale.fromArray(i),this._emit("scale",i)}on(e,t){this.editor.dom.addEventListener(e,t)}_emit(e,t=null){this.editor.dom.dispatchEvent(new CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0,composed:!1}))}}class $102b3df9ca2da060$export$aead3d23b4737909{constructor(e){this.editor=e,this.boxColor=this.editor.config.boxColor}selectObj(e){if(this.editor.modelHelperGroup.children=[],this.editor.doorHelperGroupClean(),e.length>1){let t=!1;e.forEach((e=>{let i=this.editor.getOuterParent(e);const r=this.editor.wallHelp.addOBBbox(i,this.editor.config.boxColor);r.name="modelBox",r.layers.set(2),this.editor.modelHelperGroup.add(r),t=i.isLock,this.editor.addBoxFor2dGroup(i.param[0])}));let i=this.editor.get3DModelDialogPosition(this.editor.getOuterParent(e[e.length-1]));this.editor.list.modelGroup3D.dispatch(9,"3D多选模型",i,[{isLock:t}])}else{let t=e[0],i=this.editor.getOuterParent(t);if(""==i&&"Mesh"!=t.type||"3DWall"==t.modelType||"3dwall"==i.parent.name)return;if("Line2"==i.type)return;let r=this.editor.get3DModelDialogPosition(i),n=this.editor.getRealSize(i),o=1e3*n[0].toFixed(3),a=1e3*n[1].toFixed(3),s=1e3*n[2].toFixed(3),l=1e3*i.width.toFixed(3),c=1e3*i.height.toFixed(3),h=1e3*i.depth.toFixed(3),d=new(0,$4xklQ.Vector3)(0,i.position.y,0);i.parent.localToWorld(d);let u=1e3*(d.y-n[1]/2).toFixed(3),p=0;if("top"==i.modelPosition){let e=window.storeyHei;this.editor.wallGroup3D.roomHeight,p=1e3*(e/1e3-i.height).toFixed(3),p<10&&(p=0)}u<10&&(u=0);let m=360-Math.abs(parseInt(180/Math.PI*i.rotation.x)),f=360-Math.abs(parseInt(180/Math.PI*i.rotation.y)),g=360-Math.abs(parseInt(180/Math.PI*i.rotation.z));360==m&&(m=0),360==f&&(f=0),360==g&&(g=0);let x={isLock:i.isLock,width:o,height:a,depth:s,oldWidth:l,oldHeight:c,oldDepth:h,floorHei:u,rotation:[m,g,f],oldFloorHei:p};if("modelGroup"==i.modelType){i.children.slice(0).forEach((e=>{const t=this.editor.wallHelp.addOBBbox(e,this.editor.config.boxColor);t.name="modelBox",t.layers.set(2),this.editor.modelHelperGroup.add(t);let i=this.editor.wallHelp.addOBB2DBox(t,this.editor.config.boxColor);this.editor.modelHelperGroup.add(i)})),this.editor.camera.isOrthographicCamera?this.editor.list.showDialog.dispatch(14,"组合模型",r,[x]):this.editor.list.showDialog.dispatch(10,"组合模型",r,[x])}else this.editor.camera.isOrthographicCamera?this.editor.list.showDialog.dispatch(8,"单品模型",r,[x]):this.editor.list.showDialog.dispatch(11,"单品模型",r,[x]);this.main(i)}}main(e){if(e.isLock){const t=this.editor.wallHelp.addOBBbox(e,this.editor.config.boxColor);if(t.name="modelBox",t.layers.set(2),this.editor.modelHelperGroup.add(t),this.editor.transform3DTool&&"ThreeDimensionMoveHelper"!=this.editor.transform3DTool.name){let e=this.editor.transform3DTool;this.editor.dom.removeEventListener("pointermove",e.pointerMoveHandler),this.editor.dom.removeEventListener("pointerdown",e.pointerDownHandler),this.editor.dom.removeEventListener("pointerup",e.pointerUpHandler),this.editor.dom.removeEventListener("dragstart",e.dragstartHandler),this.editor.dom.removeEventListener("dragend",e.dragendHandler),this.editor.transform3DTool.detach()}return this.editor.addPositionHelper(e.param[0],!0),void this.editor.addBoxFor2dGroup(e.param[0])}this.editor.addLineHelperForMember(e.param[0]),this.editor.camera.isOrthographicCamera?this.editor.transform3DTool=new $07cd6c79b5fb98d9$export$a4d73611b6b02716(this.editor.scene,this.editor.miniMapCamera,this.editor,this.editor.newRenderer):this.editor.transform3DTool=new $07cd6c79b5fb98d9$export$a4d73611b6b02716(this.editor.scene,this.editor.camera,this.editor,this.editor.renderer),this.editor.transform3DTool.setActive(!0),this.editor.transform3DTool.attach(e),this.editor.transform3DTool.useRotate(!0).useScale(!1).useTranslate(!0)}}var $4xklQ=parcelRequire("4xklQ");parcelRequire("5XTH3");var $hrM0U=parcelRequire("hrM0U"),$5sV3G=parcelRequire("5sV3G");class $f708759ef0d3ebee$var$ThreeDimensionMoveHelperBack{constructor(e,t=""){this.name="ThreeDimensionMoveHelper",this.editor=e,this.camera=e.camera,this.dom=e.dom,this._caster=new $4xklQ.Raycaster,this.ray=new $4xklQ.Ray,this._caster.layers.mask=6,this.mouse=new $4xklQ.Vector2,this.offset=new $4xklQ.Vector3,this.selected=null,this.intersects=[],this.isDragging=!1,this.labelTextArr=[],this.pointerMoveHandler=this.pointermove.bind(this),this.pointerDownHandler=this.pointerdown.bind(this),this.pointerUpHandler=this.pointerup.bind(this),this.addEventListener(),this.currentObj=t,this.digHole=new(0,$5sV3G.DigHole)(this.editor)}selectObj(e){let t=this.editor.getOuterParent(e);if(""!=this.currentObj&&(t=this.currentObj),""==t&&"Mesh"!=e.type||"3DWall"==e.modelType)return;this.selected=t,this.addBox(t),this._lastWall=t.parameter.tdm.wallId,this._currentWallHole=this.getHoleByWallID(this._lastWall),this._lastPosition=t.position.clone(),this._lastRotation=t.rotation.z,this.editor.wallGroup3D.children.forEach((e=>{e.wallID==t.parameter.tdm.wallId&&(this._lastRotation=this.getRotation(e))})),""!=this.currentObj&&(this.isDragging=!0,this._lastWall=this.selected.parameter.tdm.wallId),this.originPosition=this.selected.position.clone();let i,r=this.editor.getWallByMesh(this.selected);this.editor.wallGroup3D.children.forEach((e=>{e.wallID==r.wallID&&(i=e)}));let n=i.endPoint.clone().sub(i.startPoint).angle(),o=this.selected.parameter.tdm,a="archDoor"==o.modelType||"archWindow"==o.modelType,s=this.digHole.createBooleanMesh(o.doorWid,o.height,o.wallDep+2,a,n);s.position.add(new $4xklQ.Vector3(o.center.x,o.center.y,o.height/2+o.floorHei)),s.updateMatrix(),this.selectedBM=s;let l=[];for(let e=0;e<this._currentWallHole.length;e++){let e=this.selected.parameter.tdm,t="archDoor"==e.modelType||"archWindow"==e.modelType,i=this.digHole.createBooleanMesh(e.doorWid,e.height,e.wallDep+2,t,n);i.position.add(new $4xklQ.Vector3(e.center.x,e.center.y,e.height/2+e.floorHei)),i.updateMatrix(),l.push(i)}if(l.length>0){this._currentWallHoleBM=l[0];for(let e=0;e<l.length;e++)this._currentWallHoleBM=this.digHole.boolean(this._currentWallHoleBM,l[e],"union")}}getHoleByWallID(e){let t=[];return this.editor.wallGroup3D.children.forEach((i=>{"CodeModel"==i.modelType&&i.parameter.tdm.wallId==e&&t.push(i)})),$hrM0U.CommonFunc.removeItemFromArr(t,this.selected),t}addBox(e){const t=this.editor.wallHelp.addOBBbox(e,1735416);t.name="modelBox",t.layers.set(2),this.editor.modelHelperGroup.add(t),t.material.depthTest=!1,e.parameter.box=t;let i=this.editor.get3DWallByMesh(e);i&&this.addMarkLabel(i)}addEventListener(){const e=this.editor.dom;e.addEventListener("pointermove",this.pointerMoveHandler),e.addEventListener("pointerdown",this.pointerDownHandler),e.addEventListener("pointerup",this.pointerUpHandler)}removeEventListener(){const e=this.editor.dom;e.removeEventListener("pointermove",this.pointerMoveHandler),e.removeEventListener("pointerdown",this.pointerDownHandler),e.removeEventListener("pointerup",this.pointerUpHandler)}pointermove(e){if(this.mouse.x=e.clientX/window.innerWidth*2-1,this.mouse.y=-e.clientY/window.innerHeight*2+1,this.hiddenLabel&&this.removeLabel(),this.isDragging&&this.selected){if(this.syncPosition1(),"CodeModel"==this.selected.modelType&&this.selected.parent){let e,t=this.editor.getWallByMesh(this.selected);this.editor.wallGroup3D.children.forEach((i=>{i.wallID==t.wallID&&(e=i)})),this._currentWallHole.push(this.selected),this.partRefresh(e,this._currentWallHole),$hrM0U.CommonFunc.removeItemFromArr(this._currentWallHole,this.selected)}this.dragstart(),this.editor.dom.setPointerCapture(e.pointerId),e.preventDefault(),e.stopPropagation()}}partRefresh(e,t){if(0==t.length)return e.geometry.dispose(),e.geometry=e.origin3DWall.geometry,e.material=e.origin3DWall.material,void e.updateMatrix();let i=[];for(let r=0;r<t.length;r++){let n=t[r].parameter.tdm,o=e.endPoint.clone().sub(e.startPoint).angle(),a="archDoor"==n.modelType||"archWindow"==n.modelType,s=this.digHole.createBooleanMesh(n.doorWid,n.height,n.wallDep+2,a,o);s.position.add(new $4xklQ.Vector3(n.center.x,n.center.y,n.height/2+n.floorHei)),s.updateMatrix(),i.push(s)}let r=i[0];for(let e=1;e<i.length;e++)r=this.digHole.boolean(r,i[e],"union");let n=this.digHole.boolean(e.origin3DWall,r);e.geometry.dispose(),e.geometry=n.geometry,e.material=n.material,e.updateMatrix()}partRefreshNew(e,t){if(0==t.length)return e.geometry.dispose(),e.geometry=e.origin3DWall.geometry,e.material=e.origin3DWall.material,void e.updateMatrix()}syncPosition1(){let e,t,i=this.getObject(!0),r=this.getPosition(),n=0;i&&r?(t=r[0].object,"3DWall"==t.modelType?(n=this.getRotation(t),e=this.getProjectPoint(t,r[0].point.clone())):e=new $4xklQ.Vector2(1e3*i.point.x,1e3*-i.point.z)):i?e=new $4xklQ.Vector2(1e3*i.point.x,1e3*-i.point.z):(e=this._lastPosition,n=this._lastRotation),this.selected.position.x=e.x,this.selected.position.y=e.y,this.selected.rotation.y=n,this.removeBox(),this.addBox(this.selected),this.syncPosition2(t)}addMarkLabel(e){let t=this.getBox();t.geometry.computeBoundingBox();let i=t.geometry.boundingBox,r=new $4xklQ.Vector3(i.min.x,0,0).applyEuler(t.rotation).add(t.position),n=new $4xklQ.Vector3(i.max.x,0,0).applyEuler(t.rotation).add(t.position);this.rayCasterFunc(r,r.clone().sub(n),e,"leftInput"),this.rayCasterFunc(n,n.clone().sub(r),e,"rightInput");new $4xklQ.Vector3(0,0,i.max.z).applyEuler(t.rotation).add(t.position),new $4xklQ.Vector3(0,0,i.min.z).applyEuler(t.rotation).add(t.position);let o=new $4xklQ.Vector3(0,i.max.y,0).applyEuler(t.rotation).add(t.position),a=new $4xklQ.Vector3(0,i.min.y,0).applyEuler(t.rotation).add(t.position);this.rayCasterFunc(o,o.clone().sub(a),e,"frontInput"),this.rayCasterFunc(a,a.clone().sub(o),e,"backInput")}rayCasterFunc(e,t,i,r){this.ray.set(e,t.normalize());let n=Array.from(i.geometry.attributes.position.array),o=new $4xklQ.Vector3,a=new $4xklQ.Vector2(1e3*i.startPoint.x,1e3*i.startPoint.y),s=new $4xklQ.Vector2(1e3*i.endPoint.x,1e3*i.endPoint.y),l=a.distanceTo(s),c=s.clone().sub(a).angle();for(let a=0;a<n.length/9;a++){let s=i.localToWorld(new $4xklQ.Vector3(n[9*a],n[9*a+1],n[9*a+2])),h=i.localToWorld(new $4xklQ.Vector3(n[9*a+3],n[9*a+4],n[9*a+5])),d=i.localToWorld(new $4xklQ.Vector3(n[9*a+6],n[9*a+7],n[9*a+8]));if(this.ray.intersectTriangle(s,h,d,!1,o),!o.equals(new $4xklQ.Vector3)){let n=$hrM0U.CommonFunc.createThreeDimensionLabel(e,o);n.layers.set(2),this.editor.modelHelperGroup.add(n);let a=this.editor.getScreenPosition(new $4xklQ.Vector3(n.center.x,n.center.y,n.center.z)),s=new $2a0c8f99fe7360a8$export$ab52802de2137ca0(Math.round(1e3*n.labelLength)).setClass("showDistance").setId(r).setFontSize("15px").setWidth("40px").setStyle(["transform"],["rotate("+c+"deg)"]).setMarginTop(a.y+"px").setMarginLeft(a.x+"px").onKeyDown(function(e){if("Tab"==e.key&&(document.getElementsById(r)[0].focus(),e.preventDefault()),"13"==e.keyCode){this.editor.execute();let e=document.getElementById(r).value,o=e-Math.round(1e3*n.labelLength);if("frontInput"==r&&(t=new $4xklQ.Vector3(0,0,1),o=-o),"backInput"==r&&(t=new $4xklQ.Vector3(0,0,-1)),e>l)return;"frontInput"==r||"backInput"==r?this.selected.parameter.tdm.floorHei+=o:this.selected.position.add(t.clone().negate().setLength(o)),this.addBox(this.selected),this.addMarkLabel(i),this.syncPosition2(i);let a=this.editor.getWallByMesh(this.selected);this.editor.wallGroup3D.remove(this.selected),this.editor.partRefreshWall(a),this.removeBox()}}.bind(this));return s.setAttribute("worldPosition",n.center.x+"/"+n.center.y+"/"+n.center.z),this.labelTextArr.push(s),void this.editor.uiPanelBox.add(s)}}}syncPosition2(e){let t=this.selected.parameter.tdm;if(t.position.x=this.selected.position.x,t.position.y=this.selected.position.y,t.center.x=this.selected.position.x,t.center.y=this.selected.position.y,t.startPoint=t.localToWorld(new $4xklQ.Vector3(-t.doorWid/2,0,0)),t.endPoint=t.localToWorld(new $4xklQ.Vector3(t.doorWid/2,0,0)),e){let i=new $4xklQ.Vector2(e.endPoint.x,e.endPoint.y).sub(new $4xklQ.Vector2(e.startPoint.x,e.startPoint.y)).angle();if(t.rotation.z=i,t.wallId!=e.wallID){let i;this.editor.wallGroup3D.children.forEach((e=>{e.wallID==t.wallId&&(i=e)}));let r=this.getHoleByWallID(t.wallId);this.partRefresh(i,r),t.wallId=e.wallID,this._lastWall=e.wallID,this._lastPosition=this.selected.position.clone(),this._lastRotation=this.selected.rotation.y,this._currentWallHole=this.getHoleByWallID(t.wallId)}}else t.wallId=this._lastWall}getProjectPoint(e,t){let i=new $4xklQ.Vector2(1e3*e.startPoint.x,1e3*e.startPoint.y),r=new $4xklQ.Vector2(1e3*e.endPoint.x,1e3*e.endPoint.y);t.x=Math.round(1e5*t.x)/100,t.y=-Math.round(1e5*t.z)/100;let n=$hrM0U.CommonFunc.getLineEquation(i,r);return $hrM0U.CommonFunc.getProjectPoint(n,t)}getRotation(e){let t=new $4xklQ.Vector2(1e3*e.startPoint.x,1e3*e.startPoint.y),i=new $4xklQ.Vector2(1e3*e.endPoint.x,1e3*e.endPoint.y);return t.sub(i).angle()}dragstart(e){""!=this.editor.globalControl&&(this.editor.globalControl.enabled=!1)}dragend(e){""!=this.editor.globalControl&&(this.editor.globalControl.enabled=!0),this.removeBox()}removeLabel(){this.editor.modelHelperGroup.children.slice(0).forEach((e=>{"label"==e.name&&this.editor.modelHelperGroup.remove(e)})),this.labelTextArr.forEach((e=>{e.dom.remove()}))}removeBox(){this.editor.modelHelperGroup.children.slice(0).forEach((e=>{"modelBox"==e.name&&this.editor.modelHelperGroup.remove(e),"label"==e.name&&this.editor.modelHelperGroup.remove(e)})),this.labelTextArr.forEach((e=>{e.dom.remove()}))}getBox(){let e=this.editor.modelHelperGroup.children.slice(0);for(let t=0;t<e.length;t++)if("modelBox"==e[t].name)return e[t]}pointerdown(e){""==this.currentObj&&(e.preventDefault(),e.stopPropagation(),this.mouse.x=e.clientX/window.innerWidth*2-1,this.mouse.y=-e.clientY/window.innerHeight*2+1,this.hiddenLabel=!0,this.selected&&this.getObject()==this.selected&&(this.isDragging=!0,this._lastWall=this.selected.parameter.tdm.wallId,this.editor.execute()))}getObject(e=!1){this._caster.setFromCamera(this.mouse,this.camera);let t=this.editor.pointHelperGroup.children.concat(this.editor.otherMeshs);if(t=t.concat(this.editor.wallGroup3D.children),t=t.concat(this.editor.floor),e&&t.splice(t.indexOf(this.selected),1),this.intersects=this._caster.intersectObjects(t,!0),this.intersects.length>0)return e?this.intersects[0]:this.editor.getOuterParent(this.intersects[0].object)}getPosition(){this._caster.setFromCamera(this.mouse,this.camera),this.intersects=Array.from(this.editor.wallGroup3D.children);let e=this.createTmpBox(this.intersects);this.editor.scene.add(e),this.intersects.push(e),this.intersects=[e];let t=this._caster.intersectObjects(this.intersects,!1);if(this.editor.scene.remove(e),t.length>0)return t;let i=this._caster.intersectObjects(this.editor.wallGroup3D.children,!1);return i.length>0?i:void 0}createTmpBox(e){let t;this.editor.wallGroup3D.children.forEach((i=>{if(i.wallID==this.selected.parameter.tdm.wallId)return t=i,void $hrM0U.CommonFunc.removeItemFromArr(e,i)}));let i=t.geometry.boundingBox.max.x-t.geometry.boundingBox.min.x,r=t.geometry.boundingBox.max.y-t.geometry.boundingBox.min.y,n=t.geometry.boundingBox.max.z-t.geometry.boundingBox.min.z,o=new $4xklQ.Mesh(new $4xklQ.BoxGeometry(i,r,n),new $4xklQ.MeshBasicMaterial({color:16711680,side:2}));o.layers.mask=t.layers.mask,o.rotation.x=-Math.PI/2,o.position.set(t.position.x,t.position.z,-t.position.y),o.startPoint=t.startPoint.clone(),o.endPoint=t.endPoint.clone(),o.wallID=t.wallID,o.modelType="3DWall";let a=(new $4xklQ.Matrix4).makeScale(.001,.001,.001);return o.applyMatrix4(a),o.updateMatrixWorld(),o}pointerup(e){if(this.mouse.x=e.clientX/window.innerWidth*2-1,this.mouse.y=-e.clientY/window.innerHeight*2+1,this.isDragging&&this.selected){if("CodeModel"==this.selected.modelType&&this.selected.parent){if(!this.getPosition()){let e;this.selected.position.x=this._lastPosition.x,this.selected.position.y=this._lastPosition.y,this.selected.rotation.y=this._lastRotation,this.syncPosition2(),this.editor.wallGroup3D.children.forEach((t=>{t.wallID==this.selected.parameter.tdm.wallId&&(e=t)}));let t=this.getHoleByWallID(e.wallID);t.push(this.selected),this.partRefresh(e,t)}}this.editor.refreshDoorCamera()}this.isDragging=!1,this.hiddenLabel=!1,this.dragend()}}class $f708759ef0d3ebee$export$cbb426a6cd1f3789{constructor(e,t=""){this.name="ThreeDimensionMoveHelper",this.editor=e,this.camera=e.camera,this.dom=e.dom,this._caster=new $4xklQ.Raycaster,this._caster.layers.mask=6,this.ray=new $4xklQ.Ray,this.mouse=new $4xklQ.Vector2,this.selected=void 0,this.isDragging=!1,this.hiddenLabel=!1,this.currentObj=t,this.labelTextArr=[],this.pointerMoveHandler=this.pointermove.bind(this),this.pointerDownHandler=this.pointerdown.bind(this),this.pointerUpHandler=this.pointerup.bind(this),this.addEventListener(),this.digHole=new(0,$5sV3G.DigHole)(e),this.tmpBox=new $4xklQ.Mesh(new $4xklQ.BoxGeometry(1,1,1),new $4xklQ.MeshBasicMaterial({color:16711680}))}addEventListener(){const e=this.editor.dom;e.addEventListener("pointermove",this.pointerMoveHandler),e.addEventListener("pointerdown",this.pointerDownHandler),e.addEventListener("pointerup",this.pointerUpHandler)}removeEventListener(){const e=this.editor.dom;e.removeEventListener("pointermove",this.pointerMoveHandler),e.removeEventListener("pointerdown",this.pointerDownHandler),e.removeEventListener("pointerup",this.pointerUpHandler)}selectObj(e){let t=this.editor.getOuterParent(e);if(""!=this.currentObj&&(t=this.currentObj),""==t&&"Mesh"!=e.type||"3DWall"==e.modelType)return;if("ArcBaseWindowMesh"==t.type)return;this.selected=t,this.addBox(t);let i,r=this.editor.getWallByMesh(this.selected);this.editor.wallGroup3D.children.forEach((e=>{e.wallID==r.wallID&&(i=e)}));let n=i.endPoint.clone().sub(i.startPoint).angle(),o=this.selected.parameter.tdm,a="archDoor"==o.modelType||"archWindow"==o.modelType,s=this.digHole.createBooleanMesh(o.doorWid,o.height,o.wallDep+2,a,n);s.position.add(new $4xklQ.Vector3(o.center.x,o.center.y,o.height/2+o.floorHei)),s.updateMatrix(),this.selectedBM=s,this._lastWall=t.parameter.tdm.wallId,this._currentWallHole=this.getHoleByWallID(this._lastWall),this._currentWall=i,""!=this.currentObj&&(this.isDragging=!0,this._lastWall=this.selected.parameter.tdm.wallId),this._lastPosition=t.position.clone(),this._lastRotation=t.rotation.z,this.editor.wallGroup3D.children.forEach((e=>{e.wallID!=t.parameter.tdm.wallId||(this._lastRotation=this.getRotation(e))})),this.originPosition=this.selected.position.clone()}pointermove(e){if(this.mouse.x=e.clientX/window.innerWidth*2-1,this.mouse.y=-e.clientY/window.innerHeight*2+1,this.hiddenLabel&&this.removeLabel(),this.isDragging){if(this.selected.isLock){let e=this.editor.getScreenPosition(this.editor.currentPoint.clone());return void this.editor.list.blackBox.dispatch(e.x,e.y,"该模型已锁定,请先解锁")}if(this.syncPosition1(),"CodeModel"==this.selected.modelType&&this.selected.parent){let e,t=this.editor.getWallByMesh(this.selected);this.editor.wallGroup3D.children.forEach((i=>{i.wallID==t.wallID&&(e=i)}));let i=this._currentWallHole?this.digHole.boolean(this.selectedBM,this._currentWallHole,"union"):this.digHole.boolean(this.selectedBM,this.tmpBox,"union");this.partRefresh(e,i)}this.dragstart(),this.editor.dom.setPointerCapture(e.pointerId),e.preventDefault(),e.stopPropagation()}}syncPosition1(){let e,t,i=this.getObject(!0),r=this.getPosition(),n=0;r?(t=r[0].object,"3DWall"==t.modelType?(n=this.getRotation(t),e=this.getProjectPoint(t,r[0].point.clone())):e=new $4xklQ.Vector2(1e3*i.point.x,1e3*-i.point.z)):i?e=new $4xklQ.Vector2(1e3*i.point.x,1e3*-i.point.z):(e=this._lastPosition,n=this._lastRotation),this.selected.position.x=e.x,this.selected.position.y=e.y,this.selected.rotation.y=n,this._lastPosition=this.selected.position.clone(),this._lastRotation=this.selected.rotation.y,this.selectedBM.position.x=e.x,this.selectedBM.position.y=e.y,this.selectedBM.rotation.z=n,this.editor.modelHelperGroup.remove(this.selected.parameter.box),this.disposeGeom(this.selected.parameter.box),this.addBox(this.selected),this.syncPosition2(t)}syncPosition2(e){let t=this.selected.parameter.tdm;if(t.position.x=this.selected.position.x,t.position.y=this.selected.position.y,t.center.x=this.selected.position.x,t.center.y=this.selected.position.y,t.startPoint=t.localToWorld(new $4xklQ.Vector3(-t.doorWid/2,0,0)),t.endPoint=t.localToWorld(new $4xklQ.Vector3(t.doorWid/2,0,0)),e){let i=this.getRotation(e);if(t.rotation.z=i,t.wallId!=e.wallID){let i;this.editor.wallGroup3D.children.forEach((e=>{e.wallID==t.wallId&&(i=e)})),this.partRefresh(i,this._currentWallHole),t.wallId=e.wallID,this._lastWall=e.wallID,this._lastPosition=this.selected.position.clone(),this._lastRotation=this.selected.rotation.y,this._currentWallHole=this.getHoleByWallID(t.wallId)}}else t.wallId=this._lastWall}partRefresh(e,t){if(null==t)return e.geometry.dispose(),e.geometry=e.origin3DWall.geometry,e.material=e.origin3DWall.material,void e.updateMatrix();let i=this.digHole.boolean(e.origin3DWall,t);e.geometry.dispose(),e.geometry=i.geometry,e.material=i.material,e.updateMatrix()}pointerdown(e){""==this.currentObj&&(this.editor.downEvent=e,e.preventDefault(),e.stopPropagation(),this.mouse.x=e.clientX/window.innerWidth*2-1,this.mouse.y=-e.clientY/window.innerHeight*2+1,this.hiddenLabel=!0,this.getObject()==this.selected&&(this.isDragging=!0,this._lastWall=this.selected.parameter.tdm.wallId,this.editor.execute()))}pointerup(e){this.editor.blackbox&&this.editor.blackbox.removeDom(),this.editor.blackbox="",this.mouse.x=e.clientX/window.innerWidth*2-1,this.mouse.y=-e.clientY/window.innerHeight*2+1,this.selected&&this.editor.modelHelperGroup.remove(this.selected.parameter.box),this.isDragging=!1,this.hiddenLabel=!1,this.dragend()}getObject(e=!1){this._caster.setFromCamera(this.mouse,this.camera);let t=this.editor.pointHelperGroup.children.concat(this.editor.otherMeshs);t=t.concat(this.editor.wallGroup3D.children),t=t.concat(this.editor.floor),e&&t.splice(t.indexOf(this.selected),1);let i=this._caster.intersectObjects(t,!0);if(i.length>0)return e?i[0]:this.editor.getOuterParent(i[0].object)}getPosition(){this._caster.setFromCamera(this.mouse,this.camera),this.intersects=Array.from(this.editor.wallGroup3D.children);let e=this.createTmpBox(this.intersects);this.editor.scene.add(e),this.intersects.push(e),this.intersects=[e];let t=this._caster.intersectObjects(this.intersects,!1);if(this.editor.scene.remove(e),e.geometry.dispose(),e.material.dispose(),t.length>0)return t;let i=this._caster.intersectObjects(this.editor.wallGroup3D.children,!1);return i.length>0?i:void 0}dragstart(e){""!=this.editor.globalControl&&(this.editor.globalControl.enabled=!1)}dragend(e){""!=this.editor.globalControl&&(this.editor.globalControl.enabled=!0),this.removeBox()}addBox(e){let t=new $4xklQ.Group;e.children.forEach((e=>{t.add(e.clone())})),t.applyMatrix4((new $4xklQ.Matrix4).makeScale(.001,.001,.001)),t.position.set(e.position.x/1e3,e.position.z/1e3,-e.position.y/1e3);let i=(new $4xklQ.Box3).setFromObject(t);this.disposeGeom(t);const r=this.editor.wallHelp.addOBBbox(e,1735416);if(r.name="modelBox",r.layers.set(2),"UWindowMesh"==e.type&&(r.position.y+=(i.max.y-i.min.y)/2),"LWindowMesh"==e.type){let e=new $4xklQ.Vector3;i.getCenter(e),r.position.copy(e.clone())}this.editor.modelHelperGroup.add(r),r.material.depthTest=!1,e.parameter.box=r;let n=this.editor.get3DWallByMesh(e);n&&this.addMarkLabel(n)}disposeGeom(e){if(e.isMesh&&e.geometry.dispose(),e.isGroup||e.isObject3D)for(;e.children.length>0;){let t=e.children.shift();"Group"==t.type||t.isObject3D&&t.children.length>0?this.disposeGeom(t):t.geometry.dispose()}}removeBox(){this.editor.modelHelperGroup.children.slice(0).forEach((e=>{"modelBox"==e.name&&this.editor.modelHelperGroup.remove(e),"label"==e.name&&this.editor.modelHelperGroup.remove(e)})),this.labelTextArr.forEach((e=>{e.dom.remove()}))}getBox(){let e=this.editor.modelHelperGroup.children.slice(0);for(let t=0;t<e.length;t++)if("modelBox"==e[t].name)return e[t]}addMarkLabel(e){let t=this.getBox();t.geometry.computeBoundingBox();let i=t.geometry.boundingBox,r=new $4xklQ.Vector3(i.min.x,0,0).applyEuler(t.rotation).add(t.position),n=new $4xklQ.Vector3(i.max.x,0,0).applyEuler(t.rotation).add(t.position);this.rayCasterFunc(r,r.clone().sub(n),e,"leftInput"),this.rayCasterFunc(n,n.clone().sub(r),e,"rightInput");let o=new $4xklQ.Vector3(0,i.max.y,0).applyEuler(t.rotation).add(t.position),a=new $4xklQ.Vector3(0,i.min.y,0).applyEuler(t.rotation).add(t.position);this.rayCasterFunc(o,o.clone().sub(a),e,"frontInput"),this.rayCasterFunc(a,a.clone().sub(o),e,"backInput")}removeLabel(){this.editor.modelHelperGroup.children.slice(0).forEach((e=>{"label"==e.name&&this.editor.modelHelperGroup.remove(e)})),this.labelTextArr.forEach((e=>{e.dom.remove()}))}rayCasterFunc(e,t,i,r){this.ray.set(e,t.normalize());let n=Array.from(i.geometry.attributes.position.array),o=new $4xklQ.Vector3,a=new $4xklQ.Vector2(1e3*i.startPoint.x,1e3*i.startPoint.y),s=new $4xklQ.Vector2(1e3*i.endPoint.x,1e3*i.endPoint.y),l=a.distanceTo(s),c=s.clone().sub(a).angle();for(let a=0;a<n.length/9;a++){let s=i.localToWorld(new $4xklQ.Vector3(n[9*a],n[9*a+1],n[9*a+2])),h=i.localToWorld(new $4xklQ.Vector3(n[9*a+3],n[9*a+4],n[9*a+5])),d=i.localToWorld(new $4xklQ.Vector3(n[9*a+6],n[9*a+7],n[9*a+8]));if(this.ray.intersectTriangle(s,h,d,!1,o),!o.equals(new $4xklQ.Vector3)){let n=$hrM0U.CommonFunc.createThreeDimensionLabel(e,o);n.layers.set(2),this.editor.modelHelperGroup.add(n);let a=this.editor.getScreenPosition(new $4xklQ.Vector3(n.center.x,n.center.y,n.center.z)),s=new $2a0c8f99fe7360a8$export$ab52802de2137ca0(Math.round(1e3*n.labelLength)).setClass("showDistance").setId(r).setFontSize("15px").setWidth("40px").setStyle(["transform"],["rotate("+c+"deg)"]).setMarginTop(a.y+"px").setMarginLeft(a.x+"px").onKeyDown(function(e){if("Tab"==e.key&&(e.preventDefault(),document.getElementsById(r)[0].focus()),"13"==e.keyCode){this.editor.execute();let e=document.getElementById(r).value,o=e-Math.round(1e3*n.labelLength);if("frontInput"==r&&(t=new $4xklQ.Vector3(0,0,1),o=-o),"backInput"==r&&(t=new $4xklQ.Vector3(0,0,-1)),e>l)return;"frontInput"==r||"backInput"==r?this.selected.parameter.tdm.floorHei+=o:this.selected.position.add(t.clone().negate().setLength(o)),this.addBox(this.selected),this.addMarkLabel(i),this.syncPosition2(i);let a=this.editor.getWallByMesh(this.selected);this.editor.wallGroup3D.remove(this.selected),this.editor.partRefreshWall(a),this.removeBox()}}.bind(this));return s.setAttribute("worldPosition",n.center.x+"/"+n.center.y+"/"+n.center.z),this.labelTextArr.push(s),void this.editor.uiPanelBox.add(s)}}}getHoleByWallID(e){let t,i=[];this.editor.wallGroup3D.children.forEach((r=>{-1==["LWindowMesh","UWindowMesh"].indexOf(r.type)&&"ArcBaseWindowMesh"!=r.type&&("CodeModel"==r.modelType&&r.parameter.tdm.wallId==e&&i.push(r),"3DWall"==r.modelType&&r.wallID==e&&(t=r))})),$hrM0U.CommonFunc.removeItemFromArr(i,this.selected);let r,n=t.endPoint.clone().sub(t.startPoint).angle(),o=[];for(let e=0;e<i.length;e++){let t=i[e].parameter.tdm,r="archDoor"==t.modelType||"archWindow"==t.modelType,a=this.digHole.createBooleanMesh(t.doorWid,t.height,t.wallDep+2,r,n);a.position.add(new $4xklQ.Vector3(t.center.x,t.center.y,t.height/2+t.floorHei)),a.updateMatrix(),o.push(a)}if(o.length>0){r=o[0];for(let e=1;e<o.length;e++)r=this.digHole.boolean(r,o[e],"union")}return r}getRotation(e){let t=new $4xklQ.Vector2(1e3*e.startPoint.x,1e3*e.startPoint.y);return new $4xklQ.Vector2(1e3*e.endPoint.x,1e3*e.endPoint.y).sub(t).angle()}getProjectPoint(e,t){let i,r=new $4xklQ.Vector2(1e3*e.startPoint.x,1e3*e.startPoint.y),n=new $4xklQ.Vector2(1e3*e.endPoint.x,1e3*e.endPoint.y);if(t.x=Math.round(1e5*t.x)/100,t.y=-Math.round(1e5*t.z)/100,e.arcCenter){let t=e.arcCenter.distanceTo(n);i=$hrM0U.CommonFunc.getCircleEquation(e.arcCenter,t)}else i=$hrM0U.CommonFunc.getLineEquation(r,n);return $hrM0U.CommonFunc.getProjectPoint(i,t)}createTmpBox(e){let t;this.editor.wallGroup3D.children.forEach((i=>{if(i.wallID==this.selected.parameter.tdm.wallId)return t=i,void $hrM0U.CommonFunc.removeItemFromArr(e,i)}));let i=new $4xklQ.Mesh(t.origin3DWall.geometry,new $4xklQ.MeshBasicMaterial({color:65280}));i.layers.mask=t.layers.mask,i.rotation.x=-Math.PI/2,i.position.set(t.position.x,t.position.z,-t.position.y),i.startPoint=t.startPoint.clone(),i.endPoint=t.endPoint.clone(),i.wallID=t.wallID,t.isArc&&(i.arcCenter=t.arcCenter),i.modelType="3DWall";let r=(new $4xklQ.Matrix4).makeScale(.001,.001,.001);return i.applyMatrix4(r),i.updateMatrixWorld(),i}}var $71ecd547b7457eca$exports={},$71ecd547b7457eca$var$process=$71ecd547b7457eca$exports={},$71ecd547b7457eca$var$cachedSetTimeout,$71ecd547b7457eca$var$cachedClearTimeout;function $71ecd547b7457eca$var$defaultSetTimout(){throw new Error("setTimeout has not been defined")}function $71ecd547b7457eca$var$defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function $71ecd547b7457eca$var$runTimeout(e){if($71ecd547b7457eca$var$cachedSetTimeout===setTimeout)return setTimeout(e,0);if(($71ecd547b7457eca$var$cachedSetTimeout===$71ecd547b7457eca$var$defaultSetTimout||!$71ecd547b7457eca$var$cachedSetTimeout)&&setTimeout)return $71ecd547b7457eca$var$cachedSetTimeout=setTimeout,setTimeout(e,0);try{return $71ecd547b7457eca$var$cachedSetTimeout(e,0)}catch(t){try{return $71ecd547b7457eca$var$cachedSetTimeout.call(null,e,0)}catch(t){return $71ecd547b7457eca$var$cachedSetTimeout.call(this,e,0)}}}function $71ecd547b7457eca$var$runClearTimeout(e){if($71ecd547b7457eca$var$cachedClearTimeout===clearTimeout)return clearTimeout(e);if(($71ecd547b7457eca$var$cachedClearTimeout===$71ecd547b7457eca$var$defaultClearTimeout||!$71ecd547b7457eca$var$cachedClearTimeout)&&clearTimeout)return $71ecd547b7457eca$var$cachedClearTimeout=clearTimeout,clearTimeout(e);try{return $71ecd547b7457eca$var$cachedClearTimeout(e)}catch(t){try{return $71ecd547b7457eca$var$cachedClearTimeout.call(null,e)}catch(t){return $71ecd547b7457eca$var$cachedClearTimeout.call(this,e)}}}!function(){try{$71ecd547b7457eca$var$cachedSetTimeout="function"==typeof setTimeout?setTimeout:$71ecd547b7457eca$var$defaultSetTimout}catch(e){$71ecd547b7457eca$var$cachedSetTimeout=$71ecd547b7457eca$var$defaultSetTimout}try{$71ecd547b7457eca$var$cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:$71ecd547b7457eca$var$defaultClearTimeout}catch(e){$71ecd547b7457eca$var$cachedClearTimeout=$71ecd547b7457eca$var$defaultClearTimeout}}();var $71ecd547b7457eca$var$queue=[],$71ecd547b7457eca$var$draining=!1,$71ecd547b7457eca$var$currentQueue,$71ecd547b7457eca$var$queueIndex=-1;function $71ecd547b7457eca$var$cleanUpNextTick(){$71ecd547b7457eca$var$draining&&$71ecd547b7457eca$var$currentQueue&&($71ecd547b7457eca$var$draining=!1,$71ecd547b7457eca$var$currentQueue.length?$71ecd547b7457eca$var$queue=$71ecd547b7457eca$var$currentQueue.concat($71ecd547b7457eca$var$queue):$71ecd547b7457eca$var$queueIndex=-1,$71ecd547b7457eca$var$queue.length&&$71ecd547b7457eca$var$drainQueue())}function $71ecd547b7457eca$var$drainQueue(){if(!$71ecd547b7457eca$var$draining){var e=$71ecd547b7457eca$var$runTimeout($71ecd547b7457eca$var$cleanUpNextTick);$71ecd547b7457eca$var$draining=!0;for(var t=$71ecd547b7457eca$var$queue.length;t;){for($71ecd547b7457eca$var$currentQueue=$71ecd547b7457eca$var$queue,$71ecd547b7457eca$var$queue=[];++$71ecd547b7457eca$var$queueIndex<t;)$71ecd547b7457eca$var$currentQueue&&$71ecd547b7457eca$var$currentQueue[$71ecd547b7457eca$var$queueIndex].run();$71ecd547b7457eca$var$queueIndex=-1,t=$71ecd547b7457eca$var$queue.length}$71ecd547b7457eca$var$currentQueue=null,$71ecd547b7457eca$var$draining=!1,$71ecd547b7457eca$var$runClearTimeout(e)}}function $71ecd547b7457eca$var$Item(e,t){this.fun=e,this.array=t}function $71ecd547b7457eca$var$noop(){}$71ecd547b7457eca$var$process.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];$71ecd547b7457eca$var$queue.push(new $71ecd547b7457eca$var$Item(e,t)),1!==$71ecd547b7457eca$var$queue.length||$71ecd547b7457eca$var$draining||$71ecd547b7457eca$var$runTimeout($71ecd547b7457eca$var$drainQueue)},$71ecd547b7457eca$var$Item.prototype.run=function(){this.fun.apply(null,this.array)},$71ecd547b7457eca$var$process.title="browser",$71ecd547b7457eca$var$process.browser=!0,$71ecd547b7457eca$var$process.env={},$71ecd547b7457eca$var$process.argv=[],$71ecd547b7457eca$var$process.version="",$71ecd547b7457eca$var$process.versions={},$71ecd547b7457eca$var$process.on=$71ecd547b7457eca$var$noop,$71ecd547b7457eca$var$process.addListener=$71ecd547b7457eca$var$noop,$71ecd547b7457eca$var$process.once=$71ecd547b7457eca$var$noop,$71ecd547b7457eca$var$process.off=$71ecd547b7457eca$var$noop,$71ecd547b7457eca$var$process.removeListener=$71ecd547b7457eca$var$noop,$71ecd547b7457eca$var$process.removeAllListeners=$71ecd547b7457eca$var$noop,$71ecd547b7457eca$var$process.emit=$71ecd547b7457eca$var$noop,$71ecd547b7457eca$var$process.prependListener=$71ecd547b7457eca$var$noop,$71ecd547b7457eca$var$process.prependOnceListener=$71ecd547b7457eca$var$noop,$71ecd547b7457eca$var$process.listeners=function(e){return[]},$71ecd547b7457eca$var$process.binding=function(e){throw new Error("process.binding is not supported")},$71ecd547b7457eca$var$process.cwd=function(){return"/"},$71ecd547b7457eca$var$process.chdir=function(e){throw new Error("process.chdir is not supported")},$71ecd547b7457eca$var$process.umask=function(){return 0};var $0a029741d8f7787c$export$cea96571ebbff9dd={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.sin((1-e)*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.sin(Math.PI*(.5-e)))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return 1===e?1:e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return 0===e?0:--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-$0a029741d8f7787c$export$cea96571ebbff9dd.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*$0a029741d8f7787c$export$cea96571ebbff9dd.Bounce.In(2*e):.5*$0a029741d8f7787c$export$cea96571ebbff9dd.Bounce.Out(2*e-1)+.5}},generatePow:function(e){return void 0===e&&(e=4),e=(e=e<Number.EPSILON?Number.EPSILON:e)>1e4?1e4:e,{In:function(t){return Math.pow(t,e)},Out:function(t){return 1-Math.pow(1-t,e)},InOut:function(t){return t<.5?Math.pow(2*t,e)/2:(1-Math.pow(2-2*t,e))/2+.5}}}},$0a029741d8f7787c$var$now;$0a029741d8f7787c$var$now="undefined"==typeof self&&void 0!==$71ecd547b7457eca$exports&&$71ecd547b7457eca$exports.hrtime?function(){var e=$71ecd547b7457eca$exports.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()};var $0a029741d8f7787c$export$461939dd4422153=$0a029741d8f7787c$var$now,$0a029741d8f7787c$export$eb2fcfdbd7ba97d4=function(){function e(){this._tweens={},this._tweensAddedDuringUpdate={}}return e.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map((function(t){return e._tweens[t]}))},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},e.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},e.prototype.update=function(e,t){void 0===e&&(e=$0a029741d8f7787c$export$461939dd4422153()),void 0===t&&(t=!1);var i=Object.keys(this._tweens);if(0===i.length)return!1;for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<i.length;r++){var n=this._tweens[i[r]],o=!t;n&&!1===n.update(e,o)&&!t&&delete this._tweens[i[r]]}i=Object.keys(this._tweensAddedDuringUpdate)}return!0},e}(),$0a029741d8f7787c$export$b0cc4f9860136880={Linear:function(e,t){var i=e.length-1,r=i*t,n=Math.floor(r),o=$0a029741d8f7787c$export$b0cc4f9860136880.Utils.Linear;return t<0?o(e[0],e[1],r):t>1?o(e[i],e[i-1],i-r):o(e[n],e[n+1>i?i:n+1],r-n)},Bezier:function(e,t){for(var i=0,r=e.length-1,n=Math.pow,o=$0a029741d8f7787c$export$b0cc4f9860136880.Utils.Bernstein,a=0;a<=r;a++)i+=n(1-t,r-a)*n(t,a)*e[a]*o(r,a);return i},CatmullRom:function(e,t){var i=e.length-1,r=i*t,n=Math.floor(r),o=$0a029741d8f7787c$export$b0cc4f9860136880.Utils.CatmullRom;return e[0]===e[i]?(t<0&&(n=Math.floor(r=i*(1+t))),o(e[(n-1+i)%i],e[n],e[(n+1)%i],e[(n+2)%i],r-n)):t<0?e[0]-(o(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[i]-(o(e[i],e[i],e[i-1],e[i-1],r-i)-e[i]):o(e[n?n-1:0],e[n],e[i<n+1?i:n+1],e[i<n+2?i:n+2],r-n)},Utils:{Linear:function(e,t,i){return(t-e)*i+e},Bernstein:function(e,t){var i=$0a029741d8f7787c$export$b0cc4f9860136880.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:(a=[1],function(e){var t=1;if(a[e])return a[e];for(var i=e;i>1;i--)t*=i;return a[e]=t,t}),CatmullRom:function(e,t,i,r,n){var o=.5*(i-e),a=.5*(r-t),s=n*n;return(2*t-2*i+o+a)*(n*s)+(-3*t+3*i-2*o-a)*s+o*n+t}}},a,$0a029741d8f7787c$export$edde1bcb1b2b310e=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),$0a029741d8f7787c$var$mainGroup=new $0a029741d8f7787c$export$eb2fcfdbd7ba97d4,$0a029741d8f7787c$export$208a41d6b4e37b97=function(){function e(e,t){void 0===t&&(t=$0a029741d8f7787c$var$mainGroup),this._object=e,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=$0a029741d8f7787c$export$cea96571ebbff9dd.Linear.None,this._interpolationFunction=$0a029741d8f7787c$export$b0cc4f9860136880.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=$0a029741d8f7787c$export$edde1bcb1b2b310e.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.to=function(e,t){return this._valuesEnd=Object.create(e),void 0!==t&&(this._duration=t),this},e.prototype.duration=function(e){return void 0===e&&(e=1e3),this._duration=e,this},e.prototype.start=function(e){if(void 0===e&&(e=$0a029741d8f7787c$export$461939dd4422153()),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var t in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(t),this._valuesStart[t]=this._valuesStartRepeat[t];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},e.prototype._setupProperties=function(e,t,i,r){for(var n in i){var o=e[n],a=Array.isArray(o),s=a?"array":typeof o,l=!a&&Array.isArray(i[n]);if("undefined"!==s&&"function"!==s){if(l){var c=i[n];if(0===c.length)continue;c=c.map(this._handleRelativeValue.bind(this,o)),i[n]=[o].concat(c)}if("object"!==s&&!a||!o||l)void 0===t[n]&&(t[n]=o),a||(t[n]*=1),r[n]=l?i[n].slice().reverse():t[n]||0;else{for(var h in t[n]=a?[]:{},o)t[n][h]=o[h];r[n]=a?[]:{},this._setupProperties(o,t[n],i[n],r[n])}}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},e.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},e.prototype.pause=function(e){return void 0===e&&(e=$0a029741d8f7787c$export$461939dd4422153()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this)),this},e.prototype.resume=function(e){return void 0===e&&(e=$0a029741d8f7787c$export$461939dd4422153()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this},e.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},e.prototype.group=function(e){return void 0===e&&(e=$0a029741d8f7787c$var$mainGroup),this._group=e,this},e.prototype.delay=function(e){return void 0===e&&(e=0),this._delayTime=e,this},e.prototype.repeat=function(e){return void 0===e&&(e=0),this._initialRepeat=e,this._repeat=e,this},e.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},e.prototype.yoyo=function(e){return void 0===e&&(e=!1),this._yoyo=e,this},e.prototype.easing=function(e){return void 0===e&&(e=$0a029741d8f7787c$export$cea96571ebbff9dd.Linear.None),this._easingFunction=e,this},e.prototype.interpolation=function(e){return void 0===e&&(e=$0a029741d8f7787c$export$b0cc4f9860136880.Linear),this._interpolationFunction=e,this},e.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},e.prototype.onStart=function(e){return this._onStartCallback=e,this},e.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},e.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},e.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},e.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},e.prototype.onStop=function(e){return this._onStopCallback=e,this},e.prototype.update=function(e,t){if(void 0===e&&(e=$0a029741d8f7787c$export$461939dd4422153()),void 0===t&&(t=!0),this._isPaused)return!0;var i,r,n=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>n)return!1;t&&this.start(e)}if(this._goToEnd=!1,e<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),!1===this._onEveryStartCallbackFired&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0),r=(e-this._startTime)/this._duration,r=0===this._duration||r>1?1:r;var o=this._easingFunction(r);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,o),this._onUpdateCallback&&this._onUpdateCallback(this._object,r),1===r){if(this._repeat>0){for(i in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[i]||(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo&&this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i];return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var a=0,s=this._chainedTweens.length;a<s;a++)this._chainedTweens[a].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},e.prototype._updateProperties=function(e,t,i,r){for(var n in i)if(void 0!==t[n]){var o=t[n]||0,a=i[n],s=Array.isArray(e[n]),l=Array.isArray(a);!s&&l?e[n]=this._interpolationFunction(a,r):"object"==typeof a&&a?this._updateProperties(e[n],o,a,r):"number"==typeof(a=this._handleRelativeValue(o,a))&&(e[n]=o+(a-o)*r)}},e.prototype._handleRelativeValue=function(e,t){return"string"!=typeof t?t:"+"===t.charAt(0)||"-"===t.charAt(0)?e+parseFloat(t):parseFloat(t)},e.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],i=this._valuesEnd[e];this._valuesStartRepeat[e]="string"==typeof i?this._valuesStartRepeat[e]+parseFloat(i):this._valuesEnd[e],this._valuesEnd[e]=t},e}(),$0a029741d8f7787c$export$a4ad2735b021c132="18.6.4",$0a029741d8f7787c$export$79a1817568da084b=$0a029741d8f7787c$export$edde1bcb1b2b310e.nextId,$0a029741d8f7787c$var$TWEEN=$0a029741d8f7787c$var$mainGroup,$0a029741d8f7787c$export$2774c37398bee8b2=$0a029741d8f7787c$var$TWEEN.getAll.bind($0a029741d8f7787c$var$TWEEN),$0a029741d8f7787c$export$1cfc7aad5cb1833b=$0a029741d8f7787c$var$TWEEN.removeAll.bind($0a029741d8f7787c$var$TWEEN),$0a029741d8f7787c$export$e16d8520af44a096=$0a029741d8f7787c$var$TWEEN.add.bind($0a029741d8f7787c$var$TWEEN),$0a029741d8f7787c$export$cd7f480d6b8286c3=$0a029741d8f7787c$var$TWEEN.remove.bind($0a029741d8f7787c$var$TWEEN),$0a029741d8f7787c$export$722fbec263ad908a=$0a029741d8f7787c$var$TWEEN.update.bind($0a029741d8f7787c$var$TWEEN),$0a029741d8f7787c$var$exports={Easing:$0a029741d8f7787c$export$cea96571ebbff9dd,Group:$0a029741d8f7787c$export$eb2fcfdbd7ba97d4,Interpolation:$0a029741d8f7787c$export$b0cc4f9860136880,now:$0a029741d8f7787c$export$461939dd4422153,Sequence:$0a029741d8f7787c$export$edde1bcb1b2b310e,nextId:$0a029741d8f7787c$export$79a1817568da084b,Tween:$0a029741d8f7787c$export$208a41d6b4e37b97,VERSION:$0a029741d8f7787c$export$a4ad2735b021c132,getAll:$0a029741d8f7787c$export$2774c37398bee8b2,removeAll:$0a029741d8f7787c$export$1cfc7aad5cb1833b,add:$0a029741d8f7787c$export$e16d8520af44a096,remove:$0a029741d8f7787c$export$cd7f480d6b8286c3,update:$0a029741d8f7787c$export$722fbec263ad908a},$0a029741d8f7787c$export$2e2bcd8739ae039=$0a029741d8f7787c$var$exports,$hrM0U=parcelRequire("hrM0U"),$2C75G=parcelRequire("2C75G"),$4xklQ=parcelRequire("4xklQ");class $7312f6e931728810$export$8c08921df1bef753{parse(e){let t="",i=0,r=0,n=0;const o=new(0,$4xklQ.Vector3),a=new(0,$4xklQ.Color),s=new(0,$4xklQ.Vector3),l=new(0,$4xklQ.Vector2),c=[];return e.traverse((function(e){!0===e.isMesh&&function(e){let a=0,h=0,d=0;const u=e.geometry,p=new(0,$4xklQ.Matrix3),m=u.getAttribute("position"),f=u.getAttribute("normal"),g=u.getAttribute("uv"),x=u.getIndex();if(t+="o "+e.name+"\n",e.material&&e.material.name&&(t+="usemtl "+e.material.name+"\n"),void 0!==m)for(let i=0,r=m.count;i<r;i++,a++)o.fromBufferAttribute(m,i),o.applyMatrix4(e.matrixWorld),t+="v "+o.x+" "+o.y+" "+o.z+"\n";if(void 0!==g)for(let e=0,i=g.count;e<i;e++,d++)l.fromBufferAttribute(g,e),t+="vt "+l.x+" "+l.y+"\n";if(void 0!==f){p.getNormalMatrix(e.matrixWorld);for(let e=0,i=f.count;e<i;e++,h++)s.fromBufferAttribute(f,e),s.applyMatrix3(p).normalize(),t+="vn "+s.x+" "+s.y+" "+s.z+"\n"}if(null!==x)for(let e=0,o=x.count;e<o;e+=3){for(let t=0;t<3;t++){const o=x.getX(e+t)+1;c[t]=i+o+(f||g?"/"+(g?r+o:"")+(f?"/"+(n+o):""):"")}t+="f "+c.join(" ")+"\n"}else for(let e=0,o=m.count;e<o;e+=3){for(let t=0;t<3;t++){const o=e+t+1;c[t]=i+o+(f||g?"/"+(g?r+o:"")+(f?"/"+(n+o):""):"")}t+="f "+c.join(" ")+"\n"}i+=a,r+=d,n+=h}(e),!0===e.isLine&&function(e){let r=0;const n=e.geometry,a=e.type,s=n.getAttribute("position");if(t+="o "+e.name+"\n",void 0!==s)for(let i=0,n=s.count;i<n;i++,r++)o.fromBufferAttribute(s,i),o.applyMatrix4(e.matrixWorld),t+="v "+o.x+" "+o.y+" "+o.z+"\n";if("Line"===a){t+="l ";for(let e=1,r=s.count;e<=r;e++)t+=i+e+" ";t+="\n"}if("LineSegments"===a)for(let e=1,r=e+1,n=s.count;e<n;e+=2,r=e+1)t+="l "+(i+e)+" "+(i+r)+"\n";i+=r}(e),!0===e.isPoints&&function(e){let r=0;const n=e.geometry,s=n.getAttribute("position"),l=n.getAttribute("color");if(t+="o "+e.name+"\n",void 0!==s){for(let i=0,n=s.count;i<n;i++,r++)o.fromBufferAttribute(s,i),o.applyMatrix4(e.matrixWorld),t+="v "+o.x+" "+o.y+" "+o.z,void 0!==l&&(a.fromBufferAttribute(l,i).convertLinearToSRGB(),t+=" "+a.r+" "+a.g+" "+a.b),t+="\n";t+="p ";for(let e=1,r=s.count;e<=r;e++)t+=i+e+" ";t+="\n"}i+=r}(e)})),t}}class $d7301d69748e22e3$export$dea64c44705995a5{checkModelIsInGroupModel(e){return!!e.parent&&("3dModel"!=e.name&&"2dModel"!=e.name&&(!!this.clickDepthMsg.uuid&&(e.parent.uuid==this.clickDepthMsg.uuid||this.checkModelIsInGroupModel(e.parent))))}createFileChunk(e,t=2097152){const i=[];let r=0;for(;r<e.size;)i.push({file:e.slice(r,r+t)}),r+=t;return i}async handleUpload(e,t){const i=this.createFileChunk(e);console.log("切片数量"+i.length),this.list.alert.dispatch("正在同步模型到云端,请稍等"),this.list.uploadModelBar.dispatch();let r=i.map(((t,i)=>({chunk:t,hash:e.name+"**"+i})));await this.uploadChunks(r,t,i.length)}async uploadChunks(e,t,i){let r=0,n=this;e.map(((e,o)=>{setTimeout((()=>{const o=new FormData;let a=new Date,s=a.getFullYear()+""+(a.getMonth()+1)+a.getDate()+Math.round(1e4*Math.random()+1)+".json";var l=new File([e.chunk.file],s,{type:"application/json"}),c=new FileReader;c.onload=()=>{let e=JSON.stringify({fileName:s,value:c.result}),t=new File([e],s,{type:"application/json"});o.append("file",t);const a=new XMLHttpRequest;a.open("POST",this.config.remoteCacheUrl,!0),a.onreadystatechange=()=>{if(4===a.readyState&&200===a.status){r++;let e=parseInt(100*(r/i).toFixed(2));n.list.changeBar.dispatch(e),r==i&&(n.list.alert.dispatch("模型云端同步完成"),n.list.closeBar.dispatch()),console.log("上传成功")}},a.send(o)},c.readAsDataURL(l);let h=e.hash.split("**");t.sliceArr?t.sliceArr.push(s+"**"+h[1]):t.sliceArr=[s+"**"+h[1]]}),100)}))}mergeFile(e,t){let i=new Array(e.length),r=0,n=this;e.map((o=>{setTimeout((()=>{r++;let a=o.split("**");const s=new XMLHttpRequest;s.open("GET",n.config.remoteUrl+a[0],!1),s.onreadystatechange=()=>{if(4===s.readyState&&200===s.status){for(var o=JSON.parse(s.responseText).value.split(","),l=o[0].match(/:(.*?);/)[1],c=atob(o[1]),h=c.length,d=new Uint8Array(h);h--;)d[h]=c.charCodeAt(h);var u=new Blob([d],{type:l});i[1*a[1]]=u;let m=parseInt(100*(r/e.length).toFixed(2));if(n.list.progressChange.dispatch(m),r==e.length){const e=new Blob(i,{type:"application/octet-stream"});var p=new File([e],"aa.glb",{type:"application/octet-stream"});n.list.uploadFile.dispatch("",p,t),n.list.alert.dispatch("云端模型加载完成"),console.log("合并完成")}}},s.send(),r==e.length&&n.list.progressClose.dispatch()}),100)}));const o=new Blob(i,{type:"application/octet-stream"});return new File([o],"aa.glb",{type:"application/octet-stream"})}saveJsonToSever(e,t,i=!1){const r=JSON.stringify(e),n=new File([r],t,{type:"application/json"}),o=new XMLHttpRequest;o.open("POST",this.config.remoteCacheUrl,!0),o.onreadystatechange=()=>{4===o.readyState&&200===o.status&&i&&(this.currentCacheJson=e.sceneJson,this.list.alert.dispatch("方案保存成功"))};const a=new FormData;a.append("file",n),o.send(a)}delCommonPoint(e){let t=$9HO6e.UtilCore.havePointWall(e,this.allWalls);2==t.length&&$9HO6e.UtilCore.wallIsInLine(t[0],t[1])?(this.pointHelperGroup.children.slice(0).forEach((e=>{"clickPoint"!=e.useType&&"moveOuterPoint"!=e.useType||e.parent.remove(e)})),this.execute(),this.margeWall(t[0],t[1]),new $523a84362d27c3e8$export$b680ca477a72be07(this).wallToJson()):this.list.alert.dispatch("只允许删除共线墙的公共端点","error")}moveCurrentCamera(e){var t=new $4xklQ.Vector3;this.camera.getWorldDirection(t);let i=100,r=new(0,$4xklQ.Vector3)(t.z,t.y,-t.x),n=this.camera.position.clone(),o=new(0,$4xklQ.Vector3)(0,1,0);if("3dRomaCamera"!=this.camera.name){if(this.camera.isOrthographicCamera)"w"==e&&this.camera.position.add(new(0,$4xklQ.Vector3)(0,1,0).multiplyScalar(i)),"a"==e&&this.camera.position.add(new(0,$4xklQ.Vector3)(-1,0,0).multiplyScalar(i)),"s"==e&&this.camera.position.add(new(0,$4xklQ.Vector3)(0,-1,0).multiplyScalar(i)),"d"==e&&this.camera.position.add(new(0,$4xklQ.Vector3)(1,0,0).multiplyScalar(i)),this.camera.position.z=n.z,this.controlsArr[0].target.copy(this.camera.position);else{i=.1,"w"==e&&this.camera.position.add(t.multiplyScalar(i)),"a"==e&&this.camera.position.add(r.multiplyScalar(i)),"s"==e&&this.camera.position.add(t.multiplyScalar(-i)),"d"==e&&this.camera.position.add(r.multiplyScalar(-i)),"q"==e&&this.camera.position.add(o.multiplyScalar(i)),"e"==e&&this.camera.position.add(o.multiplyScalar(-i)),"q"!=e&&"e"!=e&&(this.camera.position.y=n.y);let a=this.camera.position.clone().sub(n),s=this.controlsArr[1].target.clone().add(a);this.controlsArr[1].target.copy(s)}this.camera.updateProjectionMatrix()}}margeWall(e,t){if(!$9HO6e.UtilCore.wallIsInLine(e,t))return;this.removeHelperByWall(t),this.removeHelperByWall(e);let i=$9HO6e.UtilCore.getSamePointTwoWall(e,t),r=$9HO6e.UtilCore.getMeshOtherPoint(t,i);$9HO6e.UtilCore.isSameVector(i,e.startPoint)?e.startPoint=r:e.endPoint=r,this.getAllWindowInWall(t).forEach((t=>{t.wallId=e.wallID,t.wallStartPoint=e.startPoint,t.wallEndPoint=e.endPoint,t.wallDep=e.thickness})),this.removeWall(t)}addModelBox(e){let t=this.getOuterParent(e,e,"outer");console.log(t);let i=e,r=e.param[0];"2dModel"==t.parent.name&&(i=e.param[0],r=e),this.modelHelperGroup.children=[],this.doorHelperGroupClean(),this.addBoxForGroup(i),this.addBoxFor2dGroup(r),e.isLock||(this.addLineHelperForMember(r),new $102b3df9ca2da060$export$aead3d23b4737909(this).selectObj([i]))}getWallCenterLen(e,t){let i=e.geometry.attributes.position.array,r=new(0,$4xklQ.Vector3)(i[3],i[4],0),n=new(0,$4xklQ.Vector3)(i[12],i[13],0).sub(r),o=new(0,$4xklQ.Vector3)(i[6],i[7],0).sub(r),a=n.angleTo(o);a>Math.PI/2&&(a=Math.PI-a);let s=e.thickness/2/Math.tan(a);return t=n.angleTo(o)>Math.PI/2?t-s:t+s,Math.round(t)}refreshRealSizeByBox(e,t){let i=t.parent;if(!e.parent)return;if("2dModel"==e.parent.name&&(i=i.param[0],e=e.param[0]),!i)return;let r=i.rotation.x,n=i.rotation.y,o=i.rotation.z;i.rotation.set(0,0,0);const a=(new(0,$4xklQ.Box3)).setFromObject(i);i.rotation.set(r,n,o);let s=(new $44a90fc8a2825c34$export$f7a1f6dc3f8b082f).fromBox3(a),l=(new(0,$4xklQ.Vector3)).setFromMatrixScale(i.matrixWorld),c=2*s.halfSize.x/l.x,h=2*s.halfSize.y/l.y,d=2*s.halfSize.z/l.z;i.width=c,i.height=h,i.depth=d,i.param&&(i.param[0].width=1e3*c,i.param[0].height=1e3*d,i.param[0].depth=1e3*h),i.uuid!=e.uuid&&this.refreshRealSizeByBox(e,i)}getRealSize(e){let t=e;"2dModelGroup"!=e.modelType&&"2DModel"!=e.modelType||(t=e.param[0]);let i=(new(0,$4xklQ.Vector3)).setFromMatrixScale(t.matrixWorld);if("CodeModel"!=t.modelType){let e=t.clone();e.scale.copy(i),e.rotation.set(0,0,0);const r=(new(0,$4xklQ.Box3)).setFromObject(e);let n=(new $44a90fc8a2825c34$export$f7a1f6dc3f8b082f).fromBox3(r);return[2*n.halfSize.x,2*n.halfSize.y,2*n.halfSize.z]}return[t.width*i.x,t.height*i.y,t.depth*i.z]}addBoxForGroup(e,t=2){const i=this.wallHelp.addOBBbox(e,this.config.boxColor);i.name="modelBox",i.layers.set(t),this.modelHelperGroup.add(i)}addDashBoxForGroup(e,t=2){const i=this.wallHelp.addOBBDotBox(e);i.name="modelBox",i.layers.set(t),this.modelDotGroup.add(i)}addDashBoxFor2dGroup(e){let t=this.wallHelp.getModelVertex(e,1.2);const i=this.wallHelp.addBoxFor2dModel(t,this.config.boxLineColor,"dot");i.name="modelBox",this.modelDotGroup.add(i)}addBoxFor2dGroup(e,t=window.editor.config.boxLineColor){let i=this.wallHelp.getModelVertex(e),r=this.wallHelp.addBoxFor2dModel(i,t);this.doorHelperGroup.add(r)}getWallByMesh(e){let t=e.parameter.tdm.wallId;return this.getWallById(t)}getWallById(e){for(let t=0;t<this.allWalls.length;t++)if(this.allWalls[t].wallID==e)return this.allWalls[t];return!1}get3DWallByMesh(e){let t=e.parameter.tdm.wallId;return this.get3DWallById(t)}get3DWallById(e){for(let t=0;t<this.wallGroup3D.children.length;t++){let i=this.wallGroup3D.children[t];if("3DWall"==i.modelType&&i.wallID==e)return i}return!1}get3DWindowBy2dWindow(e){let t="";return this.wallGroup3D.children.forEach((i=>{if(!i.parameter)return;i.parameter.tdm.uuid==e.uuid&&(t=i)})),t}partRefreshWall(e){let t=[];this.otherMeshs.forEach((i=>{i.wallId==e.wallID&&t.push(i)}));let i=[];this.wallGroup3D.children.forEach((t=>{"CodeModel"!=t.modelType||t.parameter&&t.parameter.tdm.wallId!=e.wallID||i.push(t)})),this.wallGroup3D.remove(...i),this.wallGroup3D.children.forEach((t=>{"3DWall"==t.modelType&&t.wallID==e.wallID&&this.wallGroup3D.remove(t)}));let r=(new(0,$5XTH3.DrawWallTool)).switchTo3D([e]);this.wallGroup3D.add(...r);let n=$9QhXH.DM.getHoleJson(t,this);new(0,$5sV3G.DigHole)(this).work(r,n),this.wallGroup3D.traverse((function(e){e.layers.set(1)}))}btnSVGExportClick(){var e=new $9aaa1afb37141370$export$42e42f98ac770ce0;e.setSize(window.innerWidth,window.innerHeight),e.render(this.scene,this.camera),this.ExportToSVG(e,"test.svg")}ExportToSVG(e,t){var i=(new XMLSerializer).serializeToString(e.domElement),r=new Blob(['<?xml version="1.0" standalone="no"?>\r\n',i],{type:"image/svg+xml;charset=utf-8"}),n=URL.createObjectURL(r),o=document.createElement("a");o.href=n,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o)}exportModelGlb(e){this.camera.isOrthographicCamera&&(e=this.get3DModelBy2DModel(e));let t=e.clone();t.position.set(0,0,0);(new $cda9fa5069073a5c$export$c32c7942a3d4b7c1).parse([t],(function(e){var t=JSON.stringify(e),i=new Blob([t],{type:"text/plain"});e instanceof ArrayBuffer&&(i=new Blob([e],{type:"application/octet-stream"}));var r=document.createElement("a");r.style.display="none",r.href=URL.createObjectURL(i),r.download="rjh_test_"+Date.parse(new Date)+".glb",r.click()}),(function(e){console.log("error",e)}),{trs:!1,onlyVisible:!0,truncateDrawRange:!0,binary:!0,maxTextureSize:4096})}getScreen(e,t){let i=e.project(t),r=window.innerWidth/2,n=window.innerHeight/2;return[Math.round(i.x*r+r),Math.round(-i.y*n+n)]}exportAllScenePng(){this.list.setViewportCamera.dispatch("3D",this),this.grid3d.visible=!1;let e=this;setTimeout((function(){var t=document.createElement("a");let i=e.renderer.domElement.toDataURL("image/jpeg");t.href=i,t.download="rjh_test_"+Date.parse(new Date)+".jpg",t.click(),e.grid3d.visible=!0}),100)}autoMakeRenderPng(){let e=document.getElementsByClassName("shot_box")[0].getBoundingClientRect(),t=editor.renderViewCamera.aspect;editor.RenderRend.setSize(e.width,e.height),editor.renderViewCamera.aspect=e.width/e.height,editor.renderViewCamera.updateProjectionMatrix(),setTimeout((function(){var e=document.createElement("a");let i=editor.RenderRend.domElement.toDataURL("image/jpeg"),r={pngBase64:i},n=editor.renderFloorGroup.children.concat(editor.renderModel3dGroup.children).concat(editor.renderWall3dGroup.children).concat(editor.renderMember3dGroup.children);editor.setRandomColor(n),setTimeout((()=>{let e=editor.RenderRend.domElement.toDataURL("image/jpeg");var i=document.createElement("a");i.href=e,i.download="rjh_test_"+Date.parse(new Date)+".jpg",editor.saveJsonToSever(r,"testPng.json"),editor.setRandomColor(n,!1),editor.renderViewCamera.aspect=t,editor.renderViewCamera.updateProjectionMatrix(),editor.RenderRend.setSize(window.innerWidth,window.innerHeight),editor.RenderRend.render(editor.renderScene,editor.renderViewCamera)}),100),e.href=i,e.download="rjh_test_"+Date.parse(new Date)+".jpg"}),100)}setRandomColor(e,t=!0){if(e.forEach((e=>{e.traverse((function(e){e.isMesh&&e.oldColor&&(e.material=e.oldColor.clone())}))})),!t)return;let i={};e.forEach((e=>{e.traverse((function(e){if(e.isMesh&&"outlineMesh"!=e.name){e.oldColor||(e.oldColor=e.material.clone());let r=e.material.color.toArray(),n=r[0]+"-"+r[1]+"-"+r[2];if(e.modelType,i.hasOwnProperty(n))e.material=i[n].clone();else{let r=new(0,$4xklQ.MeshBasicMaterial);var t=new Float32Array([Math.random(),Math.random(),Math.random()]);r.color.fromArray(t),e.material=r,i[n]=e.material.clone()}}}))}))}initCameraPngScene(e,t="auto"){this.cameraScene.children=[];let i=new(0,$4xklQ.PointLight)(10394523,6,1e4);i.position.set(0,600,0),i.layers.enableAll(),this.cameraScene.add(i);let r=new(0,$4xklQ.AmbientLight)(10394523,2,1e4);r.layers.enableAll(),this.cameraScene.add(r);let n=e.clone();if(e.parent&&(this.pngCamera="2dModel"==e.parent.name?this._DEFAULT_CAMERA1.clone():this._DEFAULT_CAMERA.clone()),"top"==t){this.pngCamera=this._DEFAULT_CAMERA1.clone();let e=(new(0,$4xklQ.Matrix4)).makeScale(1e3,1e3,1e3);n.applyMatrix4(e),n.traverse((function(e){e.layers.set(0)})),n.rotation.x=Math.PI/2}"2D"==t&&(this.pngCamera=this._DEFAULT_CAMERA1.clone()),n.position.set(0,0,0);const o=(new(0,$4xklQ.Box3)).setFromObject(n);let a=new(0,$4xklQ.Vector3);o.getCenter(a);let s=o.max.x-o.min.x,l=o.max.y-o.min.y;this.pngCamera.isOrthographicCamera||(l=o.max.z-o.min.z),"top"!=t&&"2D"!=t||(l=o.max.y-o.min.y);let c=this.getScreen(new(0,$4xklQ.Vector3)(o.max.x,0,0),this.pngCamera),h=this.getScreen(new(0,$4xklQ.Vector3)(o.min.x,0,0),this.pngCamera),d=Math.round(c[0]-h[0]),u=Math.round(l*d/s);if(this.pngCamera.isOrthographicCamera)n.position.set(-a.x,-a.y,0),this.pngCamera.left=s/-2,this.pngCamera.right=s/2,this.pngCamera.top=l/2,this.pngCamera.bottom=l/-2,this.pngCamera.far=1e5,r.position.set(0,0,2*l),i.position.set(0,0,2*l),this.pngCamera.position.set(0,0,l/2);else{i.intensity=3,r.intensity=1,this.pngCamera.aspect=s/l;let e=new $4xklQ.Box3;e.expandByObject(n);let a=new $4xklQ.Vector3;e.getSize(a);let c=this.maxSize(a),h=o.max.y-o.min.y;if("right"==t){let e=this.getScreen(new(0,$4xklQ.Vector3)(o.max.x,0,o.max.z),this.pngCamera),t=this.getScreen(new(0,$4xklQ.Vector3)(o.min.x,0,o.min.z),this.pngCamera);d=new(0,$4xklQ.Vector2)(e[0],e[1]).distanceTo(new(0,$4xklQ.Vector2)(t[0],t[1])),u=Math.round(l*d/s),this.pngCamera.position.copy(new(0,$4xklQ.Vector3)(0,0,0).addScalar(c)),this.pngCamera.position.y=h}else{let e=this.getScreen(new(0,$4xklQ.Vector3)(o.max.x,0,o.max.z),this.pngCamera),t=this.getScreen(new(0,$4xklQ.Vector3)(o.min.x,0,o.min.z),this.pngCamera);d=new(0,$4xklQ.Vector2)(e[0],e[1]).distanceTo(new(0,$4xklQ.Vector2)(t[0],t[1])),u=Math.round(l*d/s),this.pngCamera.position.copy(new(0,$4xklQ.Vector3)(0,0,0).add(new(0,$4xklQ.Vector3)(0,h/2,1.5*c)))}this.pngCamera.near=.1*c,this.pngCamera.far=300*c,this.pngCamera.lookAt(0,0,0)}this.pngCamera.updateProjectionMatrix(),this.cameraRenderer.setSize(d,u),this.cameraScene.add(n),this.pngCamera.zoom=1,"2D"==t&&(this.pngCamera.zoom=.4),this.pngCamera.updateProjectionMatrix()}maxSize(e){let t;return t=e.x>e.y?e.x:e.y,t>e.z||(t=e.z),t}exportModelImg(){if(""==editor.clickSelect||""==editor.clickSelect[0].object)return;let e=editor.clickSelect[0].object;e=this.getOuterParent(e),this.initCameraPngScene(e);let t=this;setTimeout((function(){var i=document.createElement("a");i.href=t.cameraRenderer.domElement.toDataURL("image/png"),i.download="rjh_test_"+Date.parse(new Date)+".png",i.click(),t.exportModelGlb(e)}),100)}getPositionByScreen(e,t){const i=new(0,$4xklQ.Vector3)(e,t,.5);let r=this.camera;return this.camera.isOrthographicCamera||(r=this.getOtherCamera(this.camera)),i.unproject(r)}getTextCanvas2(e=""){let t=document.createElement("canvas"),i=t.getContext("2d"),r=this.getPositionByScreen(-1,1),n=this.getPositionByScreen(1,1),o=this.getPositionByScreen(-1,-1),a=this.getPositionByScreen(window.innerWidth/2/window.innerWidth*2-1,-window.innerHeight/2/window.innerHeight*2+1),s=r.distanceTo(n),l=r.distanceTo(o);t.width=window.innerWidth,t.height=window.innerHeight,i.fillStyle="black",i.font='normal 20px "楷体"';let c=document.getElementsByClassName("Panel")[0].children;for(let t=0;t<c.length;t++)if(!(""!=e&&c[t].className.indexOf(e)<0)&&c[t].getAttribute("worldPosition")){c[t].getAttribute("worldPosition").split("/");let e=getComputedStyle(c[t],null),r=1*e.marginTop.replace("px","")+20,n=1*e.marginLeft.replace("px",""),o=c[t].innerHTML.split("<br>"),a=0;o.forEach((e=>{i.fillText(e,n,r+20*a),a++}))}let h=t.toDataURL("image/png"),d=(new $4xklQ.TextureLoader).load(h),u=new $4xklQ.PlaneGeometry(s,l),p=new $4xklQ.MeshBasicMaterial({map:d,transparent:!0,opacity:1,depthTest:!1}),m=new $4xklQ.Mesh(u,p);return m.renderOrder=5,m.position.set(a.x,a.y,1),m}exportPDF(){this.camera.isOrthographicCamera||this.list.setViewportCamera.dispatch("2D",this);var e=window.innerWidth,t=window.innerHeight,i=592.28/e*t;let r=this.getTextCanvas2();this.scene.add(r),setTimeout((()=>{var e=this.renderer.domElement.toDataURL("image/jpeg",1);r.parent.remove(r);var t=new jsPDF("p","pt","a4");t.addImage(e,"JPEG",0,0,595.28,i),t.save("download.pdf")}),500)}delMap(){this.scene.children.forEach((e=>{"mapImage"==e.useType&&this.scene.remove(e)})),this.list.baseMap.dispatch(1)}createMapMesh(e,t="",i="",r=!0){let n=new(0,$4xklQ.TextureLoader);n.setCrossOrigin("");let o=URL.createObjectURL(e);n.load(o,(n=>{let o=10*n.image.width,a=10*n.image.height;""!=t&&(o=t,a=i);let s=new(0,$4xklQ.Mesh)(new(0,$4xklQ.PlaneBufferGeometry)(o,a),new(0,$4xklQ.MeshBasicMaterial)({map:n,transparent:!0}));s.position.set(0,0,0),s.useType="mapImage",s.width=o,s.height=a,s.visible=r;var l=new FileReader;l.onload=()=>{s.imgUrl=l.result},l.readAsDataURL(e),this.scene.add(s),""==t&&this.allHelperForScaleTool(new(0,$4xklQ.Vector3)(-1e3,0,0),new(0,$4xklQ.Vector3)(1e3,0,0)),this.toolType="free",this.list.baseMap.dispatch(0)}))}importMapMain(){this.scene.children.forEach((e=>{"mapImage"==e.useType&&this.scene.remove(e)})),this.list.removeAll.dispatch("save",!1);let e=document.createElement("form");e.style.display="none",document.body.appendChild(e);let t=document.createElement("input");t.type="file",t.accept="image/png, image/jpeg, image/jpg, image/gif",t.onchange=e=>{if(0===t.files.length)return;let i=e.target.files[0];this.createMapMesh(i)},e.appendChild(t),t.click()}getModelOuterParent(e){return e.param?e:this.getModelOuterParent(e.parent)}getOuterParent(e,t=e,i="auto"){if(!e)return"";if(!e.parent)return"";return["3dwall","3dModel","2dModel"].indexOf(e.parent.name)>-1&&"Group"==e.parent.type?("auto"!=i||(this.clickDepthMsg.uuid==e.uuid||e.param&&this.clickDepthMsg.uuid==e.param[0].uuid)&&1==this.clickDepthMsg.depth&&(e=this.getModelOuterParent(t)),e):this.getOuterParent(e.parent,t,i)}getTopModePosition(e,t,i){if("Mesh"!=e.type)e.children.slice(0).forEach((e=>{this.getTopModePosition(e,t,i)}));else{let r=new(0,$4xklQ.Vector3);e.updateMatrixWorld(),e.getWorldPosition(r),t.updateMatrixWorld();let n=t.worldToLocal(r);n.z>i[0]&&(i[0]=n.z),n.z<i[1]&&(i[1]=n.z)}}getTopModePositionOld(e){let t=e.children.slice(0),i=0,r=0;return t.forEach((e=>{e.position.z>i&&(i=e.position.z),e.position.z<r&&(r=e.position.z)})),[i,r]}synchroModel(e){let t="",i=e.scale;if("3DModel"==e.modelType||"CodeModel"==e.modelType||"modelGroup"==e.modelType){if("CodeModel"==e.modelType)return t=e.parameter.tdm,t.position.x=e.position.x,t.position.y=e.position.y,t.center.x=e.position.x,void(t.center.y=e.position.y);if(t=this.get2DModelBy3DModel(e),t||(t=this.get2DMemberBy3DMember(e)),!t)return;t.rotation.z=e.rotation.y;let r=new(0,$4xklQ.Vector3)(1e3*e.position.x,1e3*-e.position.z,0);t.position.x=r.x,t.position.y=r.y,t.scale.set(i.x,i.z,i.y),t.isLock=e.isLock}else{if(t=this.get3DModelBy2DModel(e),t||(t=this.get3DMemberBy2DMember(e)),!t)return;let r=t.height,n=new(0,$4xklQ.Vector3)(e.position.x/1e3,0,-e.position.y/1e3);if(!t.modelPosition){if(1==this._scaleStart.x&&1==this._scaleStart.y&&1==this._scaleStart.z)t.scale.set(i.x,i.y,1);else{let e=i.x/this._scaleStart.x,r=i.y/this._scaleStart.y,n=i.z/this._scaleStart.z;t.scale.set(e,r,n)}t.rotation.z=e.rotation.z;let r=t.position;return t.position.set(e.position.x,e.position.y,r.z),void(this.modelHelperGroup.children=[])}if(t.rotation.y=e.rotation.z,t.position.set(n.x,t.position.y,n.z),e.groundHei){let n=t.position.y-r*i.z/2;t.position.y+=e.groundHei-n}t.scale.set(i.x,i.z,i.y),t.isLock=e.isLock,this.modelHelperGroup.children=[]}}get2DModelBy3DModel(e){return e.param?e.param[0]:""}get2DMemberBy3DMember(e){return e.twoD}get3DMemberBy2DMember(e){return e.threeD}get3DModelBy2DModel(e){return e.param?e.param[0]:""}createLine(e,t=0,i=1.5){var r=(new(0,$g4HAh.LineGeometry)).setPositions(e),n=new(0,$7WCxl.LineMaterial)({color:t,linewidth:i});n.resolution.set(window.innerWidth,window.innerHeight);var o=new(0,$ia4Lh.Line2)(r,n);return o.renderOrder=1,o.computeLineDistances(),o}createGrid(e=14152177,t=16777215){let i=15e4,r=300;this.gridProportion=i/r;let n=new(0,$4xklQ.GridHelper)(i,r,4473924,e);n.name="2dGrid1";let o=new(0,$4xklQ.GridHelper)(i,r/5,4473924,t);o.name="2dGrid2";let a=new(0,$4xklQ.GridHelper)(150,r,4473924,e);a.name="3dGrid1";let s=new(0,$4xklQ.GridHelper)(150,r/5,4473924,t);s.name="3dGrid2";let l=new(0,$4xklQ.MeshBasicMaterial)({color:"#ff0000"}),c=new(0,$4xklQ.MeshBasicMaterial)({color:"#00ff00"});r=8e4;let h=new(0,$4xklQ.Line)((new(0,$4xklQ.BufferGeometry)).setFromPoints([new(0,$4xklQ.Vector3)(-r,0,0),new(0,$4xklQ.Vector3)(r,0,0)]),l),d=new(0,$4xklQ.Line)((new(0,$4xklQ.BufferGeometry)).setFromPoints([new(0,$4xklQ.Vector3)(0,0,-r),new(0,$4xklQ.Vector3)(0,0,r)]),c),u=this.createLine([-r,0,0,r,0,0],"#ff0000"),p=this.createLine([0,0,-r,0,0,r],"#00ff00");u.layers.set(1),p.layers.set(1),a.layers.set(1),s.layers.set(1),this.grid.add(n),this.grid.add(o),this.grid.add(h),this.grid.add(d),this.grid3d.add(a),this.grid3d.add(s),this.grid3d.add(u),this.grid3d.add(p),this.floorGroup2d.children.length>0&&(this.floorGroup2d.children.forEach((e=>{e.position.z=.1})),this.floorGroup.children.forEach((e=>{e.position.y=.1})))}removeScene(e,t="all"){if(this.specialPointArr=[],"all"==t){this.scene.children.slice(0).forEach((e=>{"Group"==e.type&&"3dGrid"!=e.name&&"2dGrid"!=e.name&&(e.children=[])}));let e=this.uiPanelBox.dom;for(;e.hasChildNodes();)e.removeChild(e.firstChild);this.allWalls=[],this.otherMeshs=[],this.otherMember=[],this.doorHoleArr=[],this.splitRoomLine.children=[]}else"lable"==t&&this.removeAllHelper();"save"==e&&this.saveSceneJson()}removeAllHelper(){this.helperGroup.children=[],this.removeInputByClassName(this.uiPanelBox.dom)}testSmartRoom(){setInterval((()=>{let e=parseInt(3*Math.random()+1),t=parseInt(2*Math.random()+1);this.list.smartRoom.dispatch([e,t,1])}),1e3)}addFloor(e,t,i,r,n=[]){this.floorGroup2d.add(...e.getFloor(r[0],r[1])),this.floorGroup2d.children.forEach((e=>{e.material.transparent=!0,e.material.opacity=roomOpacity})),this.floorGroup.add(...t),this.roomList=[[],[]],this.allRoomCenterCamera.children=[];let o=this.getDomsByClassName(this.uiPanelBox.dom,"roomName");this.removeInputByClassName(this.uiPanelBox.dom,"roomName");let a={};o.forEach((e=>{let t=e.getAttribute("center"),i=e.innerHTML.replace(/<br>/g,"\n");i=i.replace(/undefined/g,""),a[t]=i})),n.forEach((e=>{let t=e[1].replace(/<br>/g,"\n");t=t.replace(/undefined/g,""),a[e[0]]=t}));let s=new $4xklQ.MeshBasicMaterial({color:16711680,side:$4xklQ.DoubleSide,transparent:!0,opacity:.2});for(let e=0;e<t.length;e++){this.debug&&(t[e].material.color=new(0,$4xklQ.Color)(16777215*Math.random())),t[e].position.z=3;let r=Array.from(t[e].geometry.attributes.position.array),n=[],o=[];for(let e=0;e<r.length/3;e++)n.push(new(0,$4xklQ.Vector2)(r[3*e],r[3*e+1])),o.push([r[3*e],r[3*e+1]]);let l=[],c=this.floorGroup2d.children[e],h=c.parameter.center;this.roomList[0].push(h);const d=new $4xklQ.SphereGeometry(.05,32,16),u=new $4xklQ.Mesh(d,s);u.position.set(h[0]/1e3,this.wallGroup3D.roomHeight/2e3,-h[1]/1e3),u.layers.set(2),u.name="camera_room"+e+1,this.allRoomCenterCamera.add(u);for(let e=0;e<this.allWalls.length;e++){let t=this.allWalls[e];t.roomCenter||(t.roomCenter=[]);let i=Array.from(t.geometry.attributes.position.array),r=[];for(let e=0;e<i.length/3;e++)r.push(new(0,$4xklQ.Vector2)(i[3*e],i[3*e+1]));for(let e=0,i=!1;e<r.length;e++){for(let o=0;o<n.length;o++)if(r[e].equals(n[o])){l.push(t),t.roomCenter.push(h),i=!0;break}if(i)break}}let p=c.parameter.area;this.roomList[1].push(p);let m="房间"+(e+1),f=h[0].toFixed(2)+"/"+h[1].toFixed(2);a.hasOwnProperty(f)&&(m=a[f].split("\n")[0]),this.floorGroup2d.children[e].roomName=m,this.floorGroup2d.children[e].roomCenter=[h[0].toFixed(2),h[1].toFixed(2)],t[e].roomName=m,t[e].roomCenter=h;let g=this.getScreenPosition(new(0,$4xklQ.Vector3)(h[0],h[1],0)),x=new $2a0c8f99fe7360a8$export$3dc21c16dab61cf7(m+"\n"+p+"m²").setId("roomName"+this.floorGroup2d.children[e].uuid).setClass("roomName").setStyle(["white-space"],["pre"]).setMarginTop(g.y+"px").setMarginLeft(g.x+"px");x.setAttribute("worldPosition",h[0]+"/"+h[1]+"/1"),x.setAttribute("roomName",m),x.setAttribute("roomArea",p+"m²"),"2D"==i&&(this.uiPanelBox.add(x),x.setAttribute("center",h[0].toFixed(2)+"/"+h[1].toFixed(2)))}}autoShowHidden(e){this.floorGroup2d.children.forEach((t=>{let i=document.getElementById("roomName"+t.uuid);if(!i)return;let r=i.innerHTML,n=parseFloat(r.split("<br>")[1]),o=!0;n||(o=!1,n=i.getAttribute("roomArea"));let a=[];t.allPoints.forEach((e=>{a.push(e.x,e.y)})),parseInt(100*e)<=66-parseInt(10*n)?(i.style.display="none",this.helperGroup.children.forEach((e=>{if(!e.newStart)return;let t=this.PolyK.ContainsPoint(a,(e.newStart.x+e.newEnd.x)/2,(e.newStart.y+e.newEnd.y)/2),i=document.getElementsByClassName("showWallLength"+e.uuid)[0];t&&i&&(e.visible=!1,i.style.display="none")}))):(o&&(i.style.display="block"),this.helperGroup.children.forEach((e=>{if(!e.newStart)return;let t=this.PolyK.ContainsPoint(a,(e.newStart.x+e.newEnd.x)/2,(e.newStart.y+e.newEnd.y)/2),i=document.getElementsByClassName("showWallLength"+e.uuid)[0];t&&i&&(e.visible=!0,this.config.settingJson.dimension&&(i.style.display="block"))})))}))}eachShowHiddenModel(e,t,i){e.modelPosition&&(e.modelPosition==t&&(e.visible=i,e.param[0].visible=i),e.children.forEach((e=>{this.eachShowHiddenModel(e,t,i)})))}showHiddenHelperMain(e,t){switch(e){case"roomName":case"roomArea":if(!this.camera.isOrthographicCamera)return;let i=this.uiPanelBox.dom.children;for(let r=0;r<i.length;r++){let n=i[r];if("roomName"==n.className){let i=n.innerText.split("\n");t?("roomName"==e&&(i[0]=n.getAttribute("roomName")),"roomArea"==e&&(i[1]=n.getAttribute("roomArea"))):("roomName"==e&&(i[0]=""),"roomArea"==e&&(i[1]="")),i[0]=i[0].replace(/undefined/g,""),n.innerText=i[0]+"\n"+i[1]}}break;case"dimension":if(!this.camera.isOrthographicCamera)return;if(t)this.helperGroup.visible=!0,$9HO6e.UtilCore.updateLineDimensionsLine(this);else{this.helperGroup.visible=!1;let e=this.uiPanelBox.dom.children;if(0==e.length)return;for(let t=0;t<e.length;t++)e[t].className.indexOf("showWallLength")>=0&&(e[t].style.display="none")}break;case"showCeilFurniture":this.model3D.children.forEach((e=>{this.eachShowHiddenModel(e,"top",t)}));break;case"showFloorFurniture":this.model3D.children.forEach((e=>{this.eachShowHiddenModel(e,"bottom",t)}));break;case"showKitchen":case"showAllHouseFurniture":break;case"showWallFurniture":this.model3D.children.forEach((e=>{this.eachShowHiddenModel(e,"free",t)}));break;case"showMember":this.otherMember.forEach((e=>{"beam"==e.modelType&&(e.visible=t,e.threeD.visible=t)}))}}refreshDoorCamera(){this.allRoomCenterCamera.children.slice(0).forEach((e=>{e.name.indexOf("openDoorCtrl_")>=0&&e.parent&&e.parent.remove(e)}));let e=$9QhXH.DM.getHoleJson(this.otherMeshs,this);this.createDoorCamera(e)}createDoorCamera(e){let t=new $4xklQ.MeshBasicMaterial({color:65280,side:$4xklQ.DoubleSide,transparent:!0,opacity:.2}),i=1;e.forEach((e=>{if(e.path&&e.path.indexOf("door")>=0){let l=this.getWallByWallId(e.wallID);if(!l)return;let c=l.endPoint.clone().sub(l.startPoint.clone()),h=new(0,$4xklQ.Vector3)(-c.y,0,c.x).setLength(400);var r=new(0,$4xklQ.Vector3)(e.location.x,e.location.z,-e.location.y);let d=r.clone().add(h),u=r.clone().add(h.negate()),p=.1;var n=new(0,$4xklQ.BoxGeometry)(p,p,p),o=new(0,$4xklQ.BoxGeometry)(p,p,p),a=new $4xklQ.Mesh(n,t),s=new $4xklQ.Mesh(o,t);a.position.set(d.x/1e3,p,d.z/1e3),s.position.set(u.x/1e3,p,u.z/1e3),a.layers.set(2),s.layers.set(2),a.name="openDoorCtrl_"+i,s.name="openDoorCtrl_"+(i+1),i+=2,this.allRoomCenterCamera.add(a),this.allRoomCenterCamera.add(s)}}))}destroy3DModelHelper(){if(this.transform3DTool){let e=this.transform3DTool;this.dom.removeEventListener("pointermove",e.pointerMoveHandler),this.dom.removeEventListener("pointerdown",e.pointerDownHandler),this.dom.removeEventListener("pointerup",e.pointerUpHandler),this.dom.removeEventListener("dragstart",e.dragstartHandler),this.dom.removeEventListener("dragend",e.dragendHandler),this.transform3DTool.boxColor&&this.transform3DTool.detach()}}splitRoomByLine(){if(this.splitRoomLine.children.length>0){let e=[],t=[],i={};this.allWalls.slice(0).forEach((r=>{let n=$9HO6e.UtilCore.getAllWallLine(r),o=new(0,$4xklQ.Vector3)(n[0][0],n[0][1],0),a=new(0,$4xklQ.Vector3)(n[1][0],n[1][1],0),s=new(0,$4xklQ.Vector3)(n[2][0],n[2][1],0),l=new(0,$4xklQ.Vector3)(n[3][0],n[3][1],0),c=$9HO6e.UtilCore.handleLineData(o,a),h=$9HO6e.UtilCore.handleLineData(s,l),d=[],u=[];this.splitRoomLine.children.forEach((e=>{let t=e.startPoint,r=e.endPoint,n=$9HO6e.UtilCore.handleLineData(t,r),p=$9HO6e.UtilCore.lineIsIntersection(c,n),m=$9HO6e.UtilCore.lineIsIntersection(h,n);if(p){let n=$9HO6e.UtilCore.pointIsInLine(p,t,r),s=$9HO6e.UtilCore.pointIsInLine(p,o,a);n&&s&&(d.push(p),i.hasOwnProperty(e.uuid)?$9HO6e.UtilCore.checkHasSameVec(i[e.uuid],p)||i[e.uuid].push(p):i[e.uuid]=[p])}if(m){let n=$9HO6e.UtilCore.pointIsInLine(m,t,r),o=$9HO6e.UtilCore.pointIsInLine(m,s,l);n&&o&&(u.push(m),i.hasOwnProperty(e.uuid)?$9HO6e.UtilCore.checkHasSameVec(i[e.uuid],m)||i[e.uuid].push(m):i[e.uuid]=[m])}}));let p=[{x:o.x,y:o.y},{x:s.x,y:s.y},{x:a.x,y:a.y},{x:l.x,y:l.y}];if(d.length>0){let t=$9HO6e.UtilCore.sortPoint(d,o,a);for(let i=0;i<t.length-1;i++){0!=i&&p.push({x:t[i][0],y:t[i][1]});let r=t[i].concat(t[i+1]);e.push(r)}}else e.push([o.x,o.y,a.x,a.y]);if(u.length>0){let t=$9HO6e.UtilCore.sortPoint(u,s,l);for(let i=0;i<t.length-1;i++){let r=t[i].concat(t[i+1]);0!=i&&p.push({x:t[i][0],y:t[i][1]}),e.push(r)}}else e.push([s.x,s.y,l.x,l.y]);t.push(p)}));for(const t in i){let r=$9HO6e.UtilCore.getSplitLineByUuid(this.splitRoomLine.children,t);if(""!=r){let n=$9HO6e.UtilCore.sortPoint(i[t],r.startPoint,r.endPoint);for(let t=0;t<n.length-1;t++){let i=n[t].concat(n[t+1]);e.push(i)}}}return[e,t]}return[!1,!1]}recoveModel(e,t=this.model3D,i=this.model2D){e.forEach((e=>{if(e.imgPath)if("localPath"==e.imgPath){if(e.sliceArr){console.log("开始合并"),this.list.alert.dispatch("正在加载云端模型,请稍等"),this.list.progressOpen.dispatch(1);let t=this;setTimeout((()=>{t.mergeFile(e.sliceArr,e)}),100)}}else this.list.loadGltf.dispatch([],e,t,i);else{let r=new(0,$4xklQ.Group),n=e.location;r.position.set(n.x,n.y,n.z),r.rotation.y=e.rotation,r.layers.set(2),e.rotate&&r.rotation.set(e.rotate.x,e.rotate.y,e.rotate.z),r.modelType=e.modelType,t.add(r);let o=new(0,$4xklQ.Group);e.scale&&(r.scale.copy(e.scale),o.scale.set(e.scale.x,e.scale.z,e.scale.y)),o.rotation.z=e.rotation,o.position.set(1e3*n.x,1e3*-n.z,0),i.add(o),"modelGroup"==r.modelType&&(o.modelType="2dModelGroup"),r.modelId=o.uuid,r.param=[o],o.modelId=r.uuid,o.param=[r],r.isLock=e.isLock,o.isLock=e.isLock;let a="bottom";e.modelPosition&&(a=e.modelPosition),r.modelPosition=a,o.modelPosition=a,r&&(r.width=e.width,r.height=e.height,r.depth=e.depth,o.width=1e3*r.width,o.height=1e3*r.depth,o.depth=1e3*r.height),this.recoveModel(e.child,r,o)}}))}readCache(e){if(this.list.removeAll.dispatch("noSave",!1),!e)return void(document.getElementsByClassName("Panel")[0].style.display="block");if((e=JSON.parse(e)).version!=this.dataVersion)return void(document.getElementsByClassName("Panel")[0].style.display="block");e.roomOpacity&&(window.roomOpacity=e.roomOpacity),e.storeyHei&&(window.storeyHei=e.storeyHei),e.floorDep&&(window.floorDep=e.floorDep),e.wall.forEach((e=>{e.start.x/=100,e.start.y/=100,e.end.x/=100,e.end.y/=100}));let t=(new(0,$5XTH3.DrawWallTool)).create2DWall(e.wall),i=t.pop();this.wallGroup.children=[],this.wallGroup3D.children=[],this.floorGroup.children=[],this.memberGroup3D.children=[],this.lineGroup3D.children=[],t.length>0&&this.wallGroup.add(...i,...t),this.allWalls=t,e.splitLine.forEach((e=>{this.addSplitLine(e.start,e.end,e.useType)})),e.member.forEach((e=>{let t,i=new(0,$4xklQ.Vector3)(e.location.x,e.location.y,e.location.z);"beam"==e.type&&(t=$9QhXH.DM.createBeam(i,"beam",e.angle,e.height,e.depth,this.allWalls,e.width,"L"),t.rotation.z=e.rotation),"flue"==e.type&&(t=$9QhXH.DM.createFlue(i,e.width,e.height,e.rotation)),"pillars"==e.type&&(t=$9QhXH.DM.createBeam(i,"pillars",e.rotation,e.height,e.depth,this.allWalls,e.width)),t.isLock=e.isLock,this.otherMember.push(t)})),this.otherMember.length>0&&this.scene.add(...this.otherMember);let r=[],n=[];e.hole.forEach((e=>{let t,i,o=new(0,$4xklQ.Vector3)(e.location.x,e.location.y,e.location.z);if(this.allWalls.forEach((i=>{i.wallID!=e.wallID||(t=i)})),!t)return;let a=t.startPoint,s=t.endPoint,l=new(0,$4xklQ.Vector2)(s.x,s.y).sub(new(0,$4xklQ.Vector2)(a.x,a.y)).angle();if(e.path){let c="outside";if(e.doorDir&&(c=e.doorDir),e.path.includes("baseDoor")&&(i=$9QhXH.DM.createBaseDoor(o,e.width,c,l,t.thickness,a,s)),e.path.includes("panoramicWindow")&&(i=$9QhXH.DM.createPanoramicWindow(o,e.width,l,t.thickness,a,s)),e.path.includes("frenchWindow")&&(i=$9QhXH.DM.createFrenchWindow(o,e.width,l,t.thickness,a,s)),e.path.includes("doubleOpenDoor")&&(i=$9QhXH.DM.createDODoor(o,e.width,l,t.thickness,a,s,c)),e.path.includes("slidingDoor")&&(i=$9QhXH.DM.createSlidingDoor(o,e.width,l,t.thickness,a,s,c)),e.path.includes("baseWindow")&&(i=$9QhXH.DM.createBaseWindow(o,e.width,l,t.thickness,a,s)),e.path.includes("sectorWindow")&&(i=$9QhXH.DM.createSectorWindow(o,e.width,l,t.thickness,a,s)),e.path.includes("lashDoor")&&(i=$9QhXH.DM.createLashDoor(o,e.width,l,t.thickness,a,s,c)),e.path.includes("pass")&&(i=$9QhXH.DM.createPass(o,e.width,l,t.thickness,a,s,c)),e.path.includes("sectorDoor")&&(i=$9QhXH.DM.createSectorDoor(o,e.width,l,t.thickness,a,s)),e.path.includes("arcWindow")&&(i=$9QhXH.DM.createArcBaseWindow(o,t.arcCenter,t.thickness,(e.endRadian-e.startRadian)/2)),e.path.includes("rightLWindow")&&(r[0]&&r[2]||(r[2]=t,r[3]=e.width),r[0]&&r[2]&&(o=$9QhXH.DM.getCommonPoint(r[0],r[2]),i=$9QhXH.DM.createLWindowNew(o,r[0],r[2],r[1],r[3]),i.wallId=r[0].wallID,r=[])),e.path.includes("leftLWindow")&&(r[0]&&r[2]||(r[0]=t,r[1]=e.width),r[0]&&r[2]&&(o=$9QhXH.DM.getCommonPoint(r[0],r[2]),i=$9QhXH.DM.createLWindowNew(o,r[0],r[2],r[1],r[3]),i.wallId=r[0].wallID,r=[])),e.path.includes("uWindow")&&(n.unshift(new $4xklQ.Vector3(e.location.x,e.location.y,e.location.z)),n.unshift(t),n[0]&&n[2]&&n[4])){let r,a,s,l,c,h,d=$9QhXH.DM.getCommonPoint(n[0],n[2]);r=d.equals(n[0].startPoint)?n[0].endPoint:n[0].startPoint,a=d.equals(n[2].startPoint)?n[2].endPoint:n[2].startPoint,$9HO6e.UtilCore.getClockWise(r,d,a)>0?(s=n[2],l=n[3],c=n[4],h=n[5]):(c=n[2],h=n[3],s=n[4],l=n[5]),l=e.windowThickL,h=e.windowThickR;let u=$9HO6e.UtilCore.getSamePointWall(t,this.allWalls),p=t.startPoint,m=$9HO6e.UtilCore.getMeshOtherPoint(u[1],p);($9HO6e.UtilCore.isSameVector(u[0].startPoint,p)||$9HO6e.UtilCore.isSameVector(u[0].endPoint,p))&&(m=$9HO6e.UtilCore.getMeshOtherPoint(u[0],p));let f=m.clone().sub(p.clone()).setLength(480);o=new $4xklQ.Vector2(n[1].x-f.x,n[1].y-f.y),i=$9QhXH.DM.createUWindow(o,s,t,c,l,h),n=[]}}else if("dooropen"==e.dir&&(i=$9QhXH.DM.createDoorHole(o,e.width,l,t.thickness,a,s)),"UWindow"==e.dir&&(n.push(t,e.windowThick),n[0]&&n[2]&&n[4])){let r,a,s,l,c,h,d=$9QhXH.DM.getCommonPoint(n[0],n[2]);r=d.equals(n[0].startPoint)?n[0].endPoint:n[0].startPoint,a=d.equals(n[2].startPoint)?n[2].endPoint:n[2].startPoint,$9HO6e.UtilCore.getClockWise(r,d,a)>0?(s=n[2],l=n[3],c=n[4],h=n[5]):(c=n[2],h=n[3],s=n[4],l=n[5]),l=e.windowThickL,h=e.windowThickR;let u=$9HO6e.UtilCore.getSamePointWall(t,this.allWalls),p=t.startPoint,m=$9HO6e.UtilCore.getMeshOtherPoint(u[1],p);($9HO6e.UtilCore.isSameVector(u[0].startPoint,p)||$9HO6e.UtilCore.isSameVector(u[0].endPoint,p))&&(m=$9HO6e.UtilCore.getMeshOtherPoint(u[0],p));let f=m.clone().sub(p.clone()).setLength(480);o=new $4xklQ.Vector2(n[1].x-f.x,n[1].y-f.y),i=$9QhXH.DM.createUWindow(o,s,t,c,l,h),n=[]}i&&(e.height&&(i.height=e.height),e.floorHei&&(i.floorHei=e.floorHei),e.wallID&&(i.wallId=e.wallID),e.isLock&&(i.isLock=e.isLock),this.otherMeshs.push(i))})),this.otherMeshs.length>0&&this.scene.add(...this.otherMeshs),this.recoveModel(e.model);let o=e.mapJson,a=!0;if(o.width){o.hasOwnProperty("visible")&&(a=o.visible);let e=o.imgUrl;if(e){for(var s=e.split(","),l=s[0].match(/:(.*?);/)[1],c=atob(s[1]),h=c.length,d=new Uint8Array(h);h--;)d[h]=c.charCodeAt(h);var u=new Blob([d],{type:l});let t=new File([u],"upload.jpg",{type:"image/jpeg",lastModified:Date.now()});this.createMapMesh(t,o.width,o.height,a)}}this.list.setDefaultParams.dispatch({roomOpacity:100*window.roomOpacity,storeyHei:window.storeyHei,floorDep:window.floorDep,mapVisible:a});let p=e.cameraJson;if(new $523a84362d27c3e8$export$b680ca477a72be07(this).wallToJson(),"{}"==JSON.stringify(e.cameraJson))return this.list.setViewportCamera.dispatch("2D",editor),void(document.getElementsByClassName("Panel")[0].style.display="block");this.setViewportCamera(p.sceneModel,this,!1),this.miniMapObj=new $3c82f100e7ba0388$export$bc845c5c4f62a4a1(this,this.miniMapCamera,this.scene,this.newRenderer,this.miniDom,240,202),this.miniMapObj.main(),this.list.changeTheme.dispatch(e.themeColor);let m=e.themeColor;""==m&&(m="1"),e.settingJson&&(this.config.settingJson=e.settingJson),this.config.settingJson.hasOwnProperty("showMember")||(this.config.settingJson.showMember=!0),this.config.settingJson.hasOwnProperty("showFloorFurniture")||(this.config.settingJson.showFloorFurniture=!0),this.config.settingJson.hasOwnProperty("showWallFurniture")||(this.config.settingJson.showWallFurniture=!0),this.config.settingJson.hasOwnProperty("showCeilFurniture")||(this.config.settingJson.showCeilFurniture=!0),this.config.settingJson.hasOwnProperty("showKitchen")||(this.config.settingJson.showKitchen=!0),this.config.settingJson.hasOwnProperty("showAllHouseFurniture")||(this.config.settingJson.showAllHouseFurniture=!0),setTimeout((()=>{this.list.getShowHiddenFlag.dispatch(JSON.stringify(this.config.settingJson)),this.list.themeSwitch.dispatch(m),this.list.threeDimensions.dispatch(p.sceneModel);let e=p.zoom;if(this.camera.isOrthographicCamera){let e=this.getOtherCamera(this.camera);e.zoomNum=p["3dVal"],e.position.copy(new(0,$4xklQ.Vector3)(p["3dPosition"].x,p["3dPosition"].y,p["3dPosition"].z)),e.rotation.copy(new(0,$4xklQ.Vector3)(p["3dRotation"].x,p["3dRotation"].y,p["3dRotation"].z)),e.lookAt(new(0,$4xklQ.Vector3)(0,0,0)),this.camera.zoom=p.zoom,this.camera.position.copy(new(0,$4xklQ.Vector3)(p.position.x,p.position.y,p.position.z)),this.camera.rotation.copy(new(0,$4xklQ.Vector3)(p.rotation.x,p.rotation.y,p.rotation.z)),e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix()}else{"3dRomaCamera"==this.camera.name?this.roamTool.restore(p["3dPosition"],p["3dRotation"]):(this.camera.zoomNum=p["3dVal"],e=p["3dVal"],this.camera.position.copy(new(0,$4xklQ.Vector3)(p["3dPosition"].x,p["3dPosition"].y,p["3dPosition"].z)),this.camera.rotation.copy(new(0,$4xklQ.Vector3)(p["3dRotation"].x,p["3dRotation"].y,p["3dRotation"].z)),this.camera.lookAt(new(0,$4xklQ.Vector3)(0,0,0))),this.camera.aspect=window.innerWidth/window.innerHeight;let t=this.getOtherCamera(this.camera);t.zoom=p.zoom,t.position.copy(new(0,$4xklQ.Vector3)(p.position.x,p.position.y,p.position.z)),t.rotation.copy(new(0,$4xklQ.Vector3)(p.rotation.x,p.rotation.y,p.rotation.z)),t.updateProjectionMatrix(),this.switchHelperGroup("hidden"),this.hiddenDomsByClassName(this.uiPanelBox.dom,"roomName")}this.controlsArr[0].target.copy(new(0,$4xklQ.Vector3)(p.target.x,p.target.y,p.target.z)),this.controlsArr[1].target.copy(new(0,$4xklQ.Vector3)(p["3dTarget"].x,p["3dTarget"].y,p["3dTarget"].z)),this.camera.updateProjectionMatrix(),this.controlsArr[0].update(),this.controlsArr[1].update(),this.list.executeTool.dispatch("moveFree"),this.list.changeCameraSlider.dispatch("2d",e),this.updateDom(),this.camera.updateProjectionMatrix(),this.specialPointArr=$9HO6e.UtilCore.getAllSpecialPoint(this),this.camera.isOrthographicCamera&&this.autoShowHidden(this.camera.zoom),document.getElementsByClassName("Panel")[0].style.display="block"}),100)}readCacheOld(e){if(this.list.removeAll.dispatch("noSave",!1),!e)return;if((e=JSON.parse(e)).version!=this.dataVersion)return;e.wall.forEach((e=>{e.start.x/=100,e.start.y/=100,e.end.x/=100,e.end.y/=100}));let t=(new(0,$5XTH3.DrawWallTool)).create2DWall(e.wall),i=t.pop();this.wallGroup.children=[],this.wallGroup3D.children=[],this.floorGroup.children=[],this.memberGroup3D.children=[],this.lineGroup3D.children=[],t.length>0&&this.wallGroup.add(...i,...t),this.allWalls=t,e.splitLine.forEach((e=>{this.addSplitLine(e.start,e.end,e.useType)})),e.member.forEach((e=>{let t,i=new(0,$4xklQ.Vector3)(e.location.x,e.location.y,e.location.z);"beam"==e.type&&(t=$9QhXH.DM.createBeam(i,"beam",e.angle,e.height,e.depth,this.allWalls),t.rotation.z=e.rotation),"flue"==e.type&&(t=$9QhXH.DM.createFlue(i,e.width,e.height,e.rotation)),"pillars"==e.type&&(t=$9QhXH.DM.createBeam(i,"pillars",e.rotation,e.height,e.depth,this.allWalls,e.width)),this.otherMember.push(t)})),this.otherMember.length>0&&this.scene.add(...this.otherMember);let r=[],n=[];e.hole.forEach((e=>{let t,i,o=new(0,$4xklQ.Vector3)(e.location.x,e.location.y,e.location.z);this.allWalls.forEach((i=>{i.wallID!=e.wallID||(t=i)}));let a=t.startPoint,s=t.endPoint,l=new(0,$4xklQ.Vector2)(s.x,s.y).sub(new(0,$4xklQ.Vector2)(a.x,a.y)).angle();if(e.path){if(e.path.includes("baseDoor")&&(i=$9QhXH.DM.createBaseDoor(o,e.width,"outside",l,t.thickness,a,s)),e.path.includes("panoramicWindow")&&(i=$9QhXH.DM.createPanoramicWindow(o,e.width,l,t.thickness,a,s)),e.path.includes("frenchWindow")&&(i=$9QhXH.DM.createFrenchWindow(o,e.width,l,t.thickness,a,s)),e.path.includes("doubleOpenDoor")&&(i=$9QhXH.DM.createDODoor(o,e.width,l,t.thickness,a,s)),e.path.includes("slidingDoor")&&(i=$9QhXH.DM.createSlidingDoor(o,e.width,l,t.thickness,a,s)),e.path.includes("baseWindow")&&(i=$9QhXH.DM.createBaseWindow(o,e.width,l,t.thickness,a,s)),e.path.includes("sectorWindow")&&(i=$9QhXH.DM.createSectorWindow(o,e.width,l,t.thickness,a,s)),e.path.includes("lashDoor")&&(i=$9QhXH.DM.createLashDoor(o,e.width,l,t.thickness,a,s)),e.path.includes("pass")&&(i=$9QhXH.DM.createPass(o,e.width,l,t.thickness,a,s)),e.path.includes("sectorDoor")&&(i=$9QhXH.DM.createSectorDoor(o,e.width,l,t.thickness,a,s)),e.path.includes("arcWindow")&&(i=$9QhXH.DM.createArcBaseWindow(o,t.arcCenter,t.thickness,(e.endRadian-e.startRadian)/2)),e.path.includes("rightLWindow")&&(r[0]&&r[2]||(r[2]=t,r[3]=e.width-240),r[0]&&r[2]&&(o=$9QhXH.DM.getCommonPoint(r[0],r[2]),i=$9QhXH.DM.createLWindowNew(o,r[0],r[2],r[1],r[3]),i.wallId=r[0].wallID,r=[])),e.path.includes("leftLWindow")&&(r[0]&&r[2]||(r[0]=t,r[1]=e.width-240),r[0]&&r[2]&&(o=$9QhXH.DM.getCommonPoint(r[0],r[2]),i=$9QhXH.DM.createLWindowNew(o,r[0],r[2],r[1],r[3]),i.wallId=r[0].wallID,r=[])),e.path.includes("uWindow")&&(n.unshift(new $4xklQ.Vector3(e.location.x,e.location.y,e.location.z)),n.unshift(t),n[0]&&n[2]&&n[4])){let e,r,a,s,l,c,h=$9QhXH.DM.getCommonPoint(n[0],n[2]);e=h.equals(n[0].startPoint)?n[0].endPoint:n[0].startPoint,r=h.equals(n[2].startPoint)?n[2].endPoint:n[2].startPoint,$9HO6e.UtilCore.getClockWise(e,h,r)>0?(a=n[2],s=n[3],l=n[4],c=n[5]):(l=n[2],c=n[3],a=n[4],s=n[5]);let d=$9HO6e.UtilCore.getSamePointWall(t,this.allWalls),u=t.startPoint,p=$9HO6e.UtilCore.getMeshOtherPoint(d[1],u);($9HO6e.UtilCore.isSameVector(d[0].startPoint,u)||$9HO6e.UtilCore.isSameVector(d[0].endPoint,u))&&(p=$9HO6e.UtilCore.getMeshOtherPoint(d[0],u));let m=p.clone().sub(u.clone()).setLength(480);o=new $4xklQ.Vector2(n[1].x-m.x,n[1].y-m.y),i=$9QhXH.DM.createUWindow(o,a,t,l,s,c),n=[]}}else if("dooropen"==e.dir&&(i=$9QhXH.DM.createDoorHole(o,e.width,l,t.thickness,a,s)),"UWindow"==e.dir&&(n.push(t,e.height),n[0]&&n[2]&&n[4])){let e,r,a,s,l,c,h=$9QhXH.DM.getCommonPoint(n[0],n[2]);e=h.equals(n[0].startPoint)?n[0].endPoint:n[0].startPoint,r=h.equals(n[2].startPoint)?n[2].endPoint:n[2].startPoint,$9HO6e.UtilCore.getClockWise(e,h,r)>0?(a=n[2],s=n[3],l=n[4],c=n[5]):(l=n[2],c=n[3],a=n[4],s=n[5]);let d=$9HO6e.UtilCore.getSamePointWall(t,this.allWalls),u=t.startPoint,p=$9HO6e.UtilCore.getMeshOtherPoint(d[1],u);($9HO6e.UtilCore.isSameVector(d[0].startPoint,u)||$9HO6e.UtilCore.isSameVector(d[0].endPoint,u))&&(p=$9HO6e.UtilCore.getMeshOtherPoint(d[0],u));let m=p.clone().sub(u.clone()).setLength(480);o=new $4xklQ.Vector2(n[1].x-m.x,n[1].y-m.y),i=$9QhXH.DM.createUWindow(o,a,t,l,s,c),n=[]}i&&(e.height&&(i.height=e.height),e.floorHei&&(i.floorHei=e.floorHei),e.wallID&&(i.wallId=e.wallID),this.otherMeshs.push(i))})),this.otherMeshs.length>0&&this.scene.add(...this.otherMeshs);let o=e.cameraJson;this.setViewportCamera(o.sceneModel,this),this.camera.zoom=o.zoom,this.camera.position.x=o.position.x,this.camera.position.y=o.position.y,this.camera.position.z=o.position.z,this.camera.rotation.x=o.rotation.x,this.camera.rotation.y=o.rotation.y,this.camera.rotation.z=o.rotation.z,this.globalControl.target.x=o.target.x,this.globalControl.target.y=o.target.y,this.globalControl.target.z=o.target.z,this.camera.updateProjectionMatrix(),this.list.executeTool.dispatch("moveFree"),setTimeout((()=>{this.list.threeDimensions.dispatch(o.sceneModel),this.updateDom()}),100)}addSplitLine(e,t,i){let r=new(0,$4xklQ.Vector3)(e.x,e.y,0),n=new(0,$4xklQ.Vector3)(t.x,t.y,0),o=new(0,$4xklQ.Line)((new(0,$4xklQ.BufferGeometry)).setFromPoints([r,n]),this.config.drawDotMaterial);o.startPoint=r,o.endPoint=n,o.useType=i,o.computeLineDistances(),o.renderOrder=50,this.splitRoomLine.add(o)}execute(e="",t="",i=""){this.history.execute(e,t,i)}exportModelGlb(e){let t=e.clone();t.position.set(0,0,0);(new $cda9fa5069073a5c$export$c32c7942a3d4b7c1).parse([t],(t=>{let i=new Blob([t],{type:"application/octet-stream"});var r=document.createElement("a");r.style.display="none",r.href=URL.createObjectURL(i);let n="模型";e.name&&(n=e.name),r.download=n+".glb",r.click()}),(e=>{console.log("error",e)}),{trs:!1,onlyVisible:!0,truncateDrawRange:!0,binary:!0,maxTextureSize:4096})}codeModelCopy(e){let t=new(0,$4xklQ.Group);return e.children.slice(0).forEach((e=>{t.add(e.clone())})),t.position.copy(e.position),t.rotation.copy(e.rotation),t}exportGLTF(e="gltf"){this.saveSceneJson();let t=new $cda9fa5069073a5c$export$c32c7942a3d4b7c1,i=!1;"glb"==e&&(i=!0);let r={trs:!1,onlyVisible:!0,truncateDrawRange:!0,binary:i,maxTextureSize:4096},n=new(0,$4xklQ.Group);n.name="roomCamera";let o=new(0,$4xklQ.Group);o.name="openDoorCtrl",this.allRoomCenterCamera.children.slice(0).forEach((e=>{if(e.name.indexOf("camera")>=0){var t=new(0,$4xklQ.PerspectiveCamera)(50,window.innerWidth/window.innerHeight,.01,1e3);t.name=e.name;let i=e.position;t.position.set(i.x,i.y,i.z),t.lookAt(new(0,$4xklQ.Vector3)(i.x,i.y,i.z)),n.add(t)}else o.add(e)}));let a=this.camera.clone();this.camera.isOrthographicCamera&&(a=this.getOtherCamera(a).clone());let s=new(0,$4xklQ.Group);s.name="3dFloor";let l=new(0,$4xklQ.Group);l.name="3dCeiling";let c=(new(0,$4xklQ.Matrix4)).makeScale(.001,.001,.001),h=new(0,$4xklQ.Group);h.name="3dWall";let d=new(0,$4xklQ.Group);d.name="3dDoor";let u=new(0,$4xklQ.Group);u.name="3dWindow",[h,d,u,s,l].forEach((e=>{e.rotation.x=-Math.PI/2,e.applyMatrix4(c)})),this.floorGroup.children.slice(0).forEach((t=>{if(t.roomName)s.add(t.clone());else{let i=t.clone();i.material=t.material.clone(),"gltf"==e&&(i.material.side=$4xklQ.DoubleSide),l.add(i)}})),this.wallGroup3D.children.slice(0).forEach(((e,t)=>{if("3DWall"==e.modelType&&h.add(e.clone()),(e.type.indexOf("Door")>-1||e.type.indexOf("door")>-1||e.type.indexOf("PassMesh")>-1)&&d.add(this.codeModelCopy(e)),e.type.indexOf("Window")>-1||e.type.indexOf("window")>-1){let i=this.codeModelCopy(e);i.name="window_"+t,u.add(i)}}));let p=[h,d,u,this.memberGroup3D,s,l,this.model3D];if(console.log("同步su"),"obj"==e){let e=new(0,$4xklQ.Scene);p.forEach((t=>{e.add(t)}));const t=(new $7312f6e931728810$export$8c08921df1bef753).parse(e);var m=document.createElement("a");return m.style.display="none",m.href=URL.createObjectURL(new Blob([t],{type:"text/plain"})),m.download="scene.obj",void m.click()}t.parse(p,(e=>{try{console.log("SU connect with JS, gltf is exporting..."+e);let t=JSON.stringify(e);sketchup.import_window("window",t)}catch(o){console.log("Not Su");var t=JSON.stringify(e),i=new Blob([t],{type:"text/plain"});e instanceof ArrayBuffer&&(i=new Blob([e],{type:"application/octet-stream"}));var n=document.createElement("a");n.style.display="none",n.href=URL.createObjectURL(i),r.binary?n.download="rjh_test_"+Date.parse(new Date)+".glb":(editor.saveSceneJsonToFile(),n.download="rjh_test_"+Date.parse(new Date)+".gltf"),n.click()}}),(e=>{console.log("error",e)}),r)}undo(){this.history.undo()}redo(){this.history.redo()}initMiniMap(){var e=document.createElement("div");e.className="miniMapDom",e.style.width=this.miniMapWidth+"px",e.style.height=this.miniMapHeight+"px",e.style.pointerEvents="none";var t=document.createElement("div");t.style.pointerEvents="all",t.className="miniBox";var i=document.createElement("div");i.className="miniMapMan",e.appendChild(i),e.appendChild(t);var r=document.createElement("span");r.className="miniMapIcom miniMapNorth",e.appendChild(r),this.miniDom.appendChild(e),e.classList.add("show")}setViewportCamera(e,t,i=!0){let r=1;for(let n in t.cameras){if("2D"==e&&"2dCamera"==t.cameras[n].name)t.list.default2D.dispatch(),t.viewportCamera=t.cameras[n],r=t.viewportCamera.zoom;else if("3D"==e&&"3dCamera"==t.cameras[n].name){t.lastCamera="3dCamera";let e=t.viewportCamera.position.clone();e.x/=1e3,e.y/=1e3,e.z/=1e3,t.viewportCamera=t.cameras[n];let o=t.viewportCamera.position.clone();if(t.viewportCamera.position.copy(e),i){let i=new $0a029741d8f7787c$export$208a41d6b4e37b97({x:e.x,y:e.y,z:e.z});i.onUpdate((e=>{t.viewportCamera.position.set(e.x,e.y,e.z)}));let r=e.distanceTo(o)/.2/3;i.to({x:o.x,y:o.y,z:o.z},10*r).start()}r=t.viewportCamera.zoomNum}else"3DRoam"==e&&"3dRomaCamera"==t.cameras[n].name&&(t.lastCamera="3dRomaCamera",t.viewportCamera=t.cameras[n],t.roamTool&&t.roamTool.active());t.viewportCamera.sceneModel=e}t.list.threeDimensions.dispatch(e),t.list.changeCameraSlider.dispatch("2d",r),t.miniMapCamera=t.getOtherCamera(t.viewportCamera).clone(),t.list.viewportCameraChanged.dispatch(t,i)}getOtherCamera(e){let t=this,i=e.name,r="";for(let e in t.cameras)"2dCamera"==i?"3dCamera"==t.cameras[e].name&&(r=t.cameras[e]):"2dCamera"==t.cameras[e].name&&(r=t.cameras[e]);return r}focus(e){void 0!==e&&this.signals.objectFocused.dispatch(e)}focusById(e){this.focus(this.scene.getObjectById(e))}select(e){if(this.selected!==e){var t=null;null!==e&&(t=e.uuid),this.selected=e,this.config.setKey("selected",t),this.signals.objectSelected.dispatch(e)}}selectById(e){e!==this.camera.id?this.select(this.scene.getObjectById(e)):this.select(this.camera)}getWorldPosition(e){let t=new(0,$4xklQ.Vector3)(0,0,0);e.clientX||0==e.clientX?(t.x=e.clientX/window.innerWidth*2-1,t.y=-e.clientY/window.innerHeight*2+1):(t.x=e.changedTouches[0].pageX/window.innerWidth*2-1,t.y=-e.changedTouches[0].pageY/window.innerHeight*2+1);let i=[this.floor];i=i.concat(this.wallGroup3D.children),i=i.concat(this.floorGroup.children),this.raycaster.setFromCamera(t,this.camera);var r=this.raycaster.intersectObjects(i,!0);let n=new(0,$4xklQ.Vector3)(0,0,0);return r.length>0&&(n=r[0].point),n}getWallColor(e){let t="";return t=0==e.style?this.cancelChooseHeavyColor:1==e.style?this.cancelChooseShortColor:this.cancelChooseColor,t}getScreenPosition(e){e=e.project(this.camera);let t=window.innerWidth/2,i=window.innerHeight/2;return{x:Math.round(e.x*t+t)-22,y:Math.round(-e.y*i+i)-10}}getDomById(e,t){let i=e.children,r="";for(let e=0;e<i.length;e++)i[e].id==t&&(r=i[e]);return r}getDomsByClassName(e,t){let i=e.children,r=[];for(let e=0;e<i.length;e++)i[e].className==t&&r.push(i[e]);return r}hiddenDomsByClassName(e,t){let i=e.children;for(let e=0;e<i.length;e++)i[e].className==t&&(i[e].display="none");return[]}checkHasCurrentInput(e,t){let i=e.children,r=-1;for(let e=0;e<i.length;e++)i[e].id==t&&(r=e);return r}removeInputByClassName(e,t=""){let i=e.children,r="",n=[];for(let e=0;e<i.length;e++)i[e].className!=t&&""!=t||(r=i[e],n.push(r));return n.forEach((t=>{e.removeChild(t)})),r}removeHelperByWallId(e){let t=this.helperGroup.children;for(let i=0;i<t.length;i++)t[i].wallId&&t[i].wallId==e&&this.helperGroup.remove(t[i])}removeHelperByModelId(e){let t=this.helperGroup.children;this.removeInputByClassName(this.uiPanelBox.dom,"showModelDis");for(let i=0;i<t.length;i++)t[i].modelId&&t[i].modelId==e&&this.helperGroup.remove(t[i])}cleanWallHelper(){this.helperGroup.children=[];let e=this.uiPanelBox.dom,t=e.children,i=[];for(let e=0;e<t.length;e++)"roomName"==t[e].className&&i.push(t[e]);for(;e.hasChildNodes();)e.removeChild(e.firstChild);for(let t=0;t<i.length;t++)e.appendChild(i[t])}cleanModelHelper(){this.helperGroup.children=[],this.removeInputByClassName(this.uiPanelBox.dom,"showModelDis")}removeCircleHelper(e){let t=e.startPoint,i=e.endPoint,r=this.helperGroup.children;for(let e=0;e<r.length;e++){let n=r[e].startPoint,o=r[e].endPoint,a=$9HO6e.UtilCore.isSameVector(t,n)||$9HO6e.UtilCore.isSameVector(t,o),s=$9HO6e.UtilCore.isSameVector(i,n)||$9HO6e.UtilCore.isSameVector(i,o);a&&s&&(this.removeInputByClassName(this.uiPanelBox.dom,"showAngle"),this.helperGroup.remove(r[e]))}}removeHelperByWall(e,t=!0){let i=this.helperGroup.children,r=e.startPoint,n=e.endPoint;for(let e=0;e<i.length;e++){let t=i[e].startPoint,o=i[e].endPoint;if(!t||!o)continue;let a=$9HO6e.UtilCore.isSameVector(r,t)||$9HO6e.UtilCore.isSameVector(r,o),s=$9HO6e.UtilCore.isSameVector(n,t)||$9HO6e.UtilCore.isSameVector(n,o);a&&s&&(this.removeInputByClassName(this.uiPanelBox.dom,"showWallLength"+i[e].uuid),this.helperGroup.remove(i[e])),i[e]&&"miniCircle"==i[e].name&&(this.removeInputByClassName(this.uiPanelBox.dom,"showAngle"),this.helperGroup.remove(i[e]))}this.removeInputByClassName(this.uiPanelBox.dom,"showAngle"),t&&this.pointHelperGroup.children.slice(0).forEach((e=>{"bseControl"==e.useType&&this.pointHelperGroup.remove(e),"Mesh"!=e.type&&e.center&&($9HO6e.UtilCore.isSameVector(r,e.center)&&this.pointHelperGroup.remove(e),$9HO6e.UtilCore.isSameVector(n,e.center)&&this.pointHelperGroup.remove(e))}))}changeWallLength(e,t,i,r=""){let n=new(0,$4xklQ.Vector2)(e.startPoint.x,e.startPoint.y),o=new(0,$4xklQ.Vector2)(e.endPoint.x,e.endPoint.y);if("start"==i){let i=o.clone().sub(n.clone());o=n.clone().add(i.setLength(t)),""!=r?e.startPoint=r:e.endPoint=o}else{let i=n.clone().sub(o.clone());n=o.clone().add(i.setLength(t)),""!=r?e.endPoint=r:e.startPoint=n}}getWallHelperByWall(e){let t="",i=this.helperGroup.children,r=e.startPoint,n=e.endPoint;for(let e=0;e<i.length;e++){if(!i[e].startPoint)continue;let o=i[e].startPoint,a=i[e].endPoint,s=$9HO6e.UtilCore.isSameVector(r,o)||$9HO6e.UtilCore.isSameVector(r,a),l=$9HO6e.UtilCore.isSameVector(n,o)||$9HO6e.UtilCore.isSameVector(n,a);s&&l&&(t=i[e])}return t}removeBSRHelper(){this.pointHelperGroup.children.slice(0).forEach((e=>{"bseControl"==e.useType&&this.pointHelperGroup.remove(e)})),this.helperGroup.children.slice(0).forEach((e=>{"bseLine"==e.lineType&&this.helperGroup.remove(e)}))}removeDoor(e){this.scene.remove(e),this.otherMeshs.indexOf(e)>=0&&this.otherMeshs.splice(this.otherMeshs.indexOf(e),1)}removeMember(e){this.scene.remove(e),this.otherMember.indexOf(e)>=0&&this.otherMember.splice(this.otherMember.indexOf(e),1),e.threeD.parent.remove(e.threeD)}removeWall(e){e.parent&&e.parent.remove(e),this.allWalls.indexOf(e)>=0&&this.allWalls.splice(this.allWalls.indexOf(e),1),this.removeHelperByWall(e)}addWall(e,t,i=240,r=!0){let n=new $523a84362d27c3e8$export$b680ca477a72be07(this).createLineWall(e,t,i);return this.scene.add(n),this.allWalls.push(n),n.material.color=this.cancelChooseColor,this.addLineWallHelper(e,t,r),n}addArcWall(e,t,i,r){let n=new $523a84362d27c3e8$export$b680ca477a72be07(this).createCircleWall(e,t,i,r);return this.scene.add(n),this.allWalls.push(n),n.material.color=this.cancelChooseColor,n}getAllWindowInWall(e){let t=[];return this.otherMeshs.forEach((i=>{i.wallId==e.wallID?t.push(i):i.leftWindow&&(i.leftWindow[0].wallID!=e.wallID&&i.rightWindow[0].wallID!=e.wallID||t.push(i))})),t}cleanScaleTool(){this.helperGroup.children.slice(0).forEach((e=>{e.useType&&"scaleHelpTool"==e.useType&&(this.helperGroup.remove(e),this.removeInputByClassName(this.uiPanelBox.dom,"showScaleLength"+e.uuid))})),this.pointHelperGroup.children=[]}getMap(){let e="";return this.scene.children.forEach((t=>{"mapImage"==t.useType&&(e=t)})),e}allHelperForScaleTool(e,t){let i=new $d0f874000594cf7a$export$a955f3d6a39ce4b2,r=this.getMap(),n=$9QhXH.DM.createScaleTool(e,t);n.useType="scaleHelpTool",n.startPoint=e,n.endPoint=t;let o=i.createLineDimensionsLine(t,e,!1);o.useType="scaleHelpTool";let a=this.getScreenPosition(o.center.clone()),s=new $2a0c8f99fe7360a8$export$ab52802de2137ca0("").setFontSize("15px").setWidth("70px").onKeyDown(function(e){if("Tab"==e.key&&e.preventDefault(),"13"==e.keyCode){let e=s.dom.value;if(!e)return;let t=e/o.lineLength;this.camera.zoom=t,this.camera.updateProjectionMatrix(),this.globalControl.update(),this.cleanScaleTool(),r.scale.set(t,t,1)}}.bind(this)).onBlur(function(e){let t=s.dom.value;if(!t)return;if(t==o.lineLength)return;let i=t/o.lineLength;this.camera.zoom=i,this.camera.updateProjectionMatrix(),this.globalControl.update(),this.cleanScaleTool(),r.scale.set(i,i,1)}.bind(this));s.setNumber();let l=new $2a0c8f99fe7360a8$export$3dc21c16dab61cf7("mm").setMarginLeft("80px").setStyle(["z-index"],[10]);l.dom.style.fontSize="14px",l.dom.style.color="#000",a.y+=20;let c=(new $2a0c8f99fe7360a8$export$ac7b10f01e8d236b).setClass("showScaleLength"+o.uuid).setMarginTop(a.y+"px").setMarginLeft(a.x+"px"),h=o.center.x+"/"+o.center.y+"/"+o.center.z;c.setAttribute("worldPosition",h),c.add(l,s),this.uiPanelBox.add(c),this.helperGroup.add(o),this.pointHelperGroup.add(n);let d=i.createScaleToolPoint(e,"start"),u=i.createScaleToolPoint(t,"end");return d.useType="scaleRuleTool",d.otherPosition=t,u.useType="scaleRuleTool",u.otherPosition=e,this.pointHelperGroup.add(d),this.pointHelperGroup.add(u),n}addLineWallHelper(e,t,i=!0,r="",n="",o=160){let a="";return""==r?a=new $002a82be864d68ed$export$a80d7a02e87abd45(this).addLineWallHelper(e,t):(a=new $002a82be864d68ed$export$a80d7a02e87abd45(this).addLineWallHelper(r,n,o),a.startPoint=e,a.endPoint=t,a.newStart=r,a.newEnd=n),i&&this.addArcPointHelper(e,t),a}addBSRWallHelper(e){new $002a82be864d68ed$export$a80d7a02e87abd45(this).addBSRWallHelper(e)}getNWalls(e,t,i){let r=$2C75G.WallCreator.findCrossWall(e.startPoint,e.endPoint,t);if(r[0].length>0||r[1].length>1){let e=[...r[0],...r[1]];i.push(...e),e.forEach((e=>{t.splice(t.indexOf(e),1)})),e.forEach((e=>{this.getNWalls(e,t,i)}))}}getOuterMidPoints(e){let t=Array.from(this.allWalls);t.splice(t.indexOf(e),1);let i=[e];this.getNWalls(e,t,i);let r=[],n=[],o=[],a=[];i.forEach((e=>{let t=[e.parameter.points[0].x,e.parameter.points[0].y],i=[e.parameter.points[3].x,e.parameter.points[3].y],o=[e.parameter.points[2].x,e.parameter.points[2].y],s=[e.parameter.points[5].x,e.parameter.points[5].y];r.push(t,i,o,s),n.push([t,i],[o,s]),a.push(e.startPoint,e.endPoint)})),a=$hrM0U.CommonFunc.filterArray3(a);let s=(new $4xklQ.Box2).setFromPoints(a),l=[s.min.clone(),new(0,$4xklQ.Vector2)(s.min.x,s.max.y),s.max.clone(),new(0,$4xklQ.Vector2)(s.max.x,s.min.y)];r=$hrM0U.CommonFunc.filterArray2(r);let c=[];r.forEach((e=>{c.push({x:e[0],y:e[1],adj:[]})})),n.forEach((e=>{o.push([$hrM0U.CommonFunc.getIndex(r,e[0]),$hrM0U.CommonFunc.getIndex(r,e[1])])})),o.forEach((e=>{let t=c[e[0]],i=c[e[1]];t.adj.push(i),i.adj.push(t)}));let h=$2176137edde06fbe$export$fee71b7b1f0877fa(c),d=[];if(h.length>0){let e=h[0];for(let t=1;t<h.length;t++)h[t].length>e.length&&(e=h[t]);let t=[];e.forEach((e=>{t.push(new(0,$4xklQ.Vector2)(e.x,e.y))}));for(let e=0;e<t.length;e++){let r=e==t.length-1?0:e+1;i.forEach((i=>{$hrM0U.CommonFunc.isInclude(i.parameter.points,t[e])&&$hrM0U.CommonFunc.isInclude(i.parameter.points,t[r])&&d.push(i.startPoint,i.endPoint)}))}}else i.forEach((e=>{d.push(e.startPoint,e.endPoint)}));return d=$hrM0U.CommonFunc.filterArray3(d),[d,l,i]}getOrderPoints(e,t,i){let r=e.distanceTo(i[0])+t.distanceTo(i[0]),n=e.distanceTo(i[1])+t.distanceTo(i[1]),o=e.distanceTo(i[2])+t.distanceTo(i[2]),a=e.distanceTo(i[3])+t.distanceTo(i[3]),s=Math.min(r,n,o,a);return r==s?e.distanceTo(i[0])>t.distanceTo(i[0])?[e,t]:[t,e]:n==s?e.distanceTo(i[1])>t.distanceTo(i[1])?[e,t]:[t,e]:o==s?e.distanceTo(i[2])>t.distanceTo(i[2])?[e,t]:[t,e]:a==s?e.distanceTo(i[3])>t.distanceTo(i[3])?[e,t]:[t,e]:void 0}getCross(e,t){let i=[];return t.forEach((t=>{(t.startPoint.equals(e)||t.endPoint.equals(e))&&i.push(t)})),i}getFinalEquation(e,t,i,r){let n=e.distanceTo(t),o=t.clone().sub(e).normalize(),a=Math.asin(i/n),s="MORE"==r?o.angle()-a:o.angle()+a,l=Math.tan(s);return{slope:l,constant:t.y-l*t.x}}getRightWall(e,t,i){if(1==e.length){let i=e[0],r=i.startPoint.equals(t)?i.endPoint:i.startPoint;return[i,r,i,r]}let r=[],n=[];return 0==i||i==2*Math.PI?e.forEach((e=>{let i=e.startPoint.equals(t)?e.endPoint:e.startPoint,o=i.clone().sub(t).angle();(0==r.length||o<r[0])&&(r=[o,e,i]),(0==n.length||o>n[0])&&(n=[o,e,i])})):e.forEach((e=>{let o=e.startPoint.equals(t)?e.endPoint:e.startPoint,a=o.clone().sub(t).angle();a=0==a?2*Math.PI:a,0==r.length?r.push(a,e,o):a>i?(a<r[0]||r[0]<i)&&(r=[a,e,o]):r[0]<i&&a<r[0]&&(r=[a,e,o]),a=a==2*Math.PI?0:a,0==n.length?n.push(a,e,o):a<i?(a>n[0]||n[0]>i)&&(n=[a,e,o]):n[0]>i&&a>n[0]&&(n=[a,e,o])})),[r[1],r[2],n[1],n[2]]}inputChangeWall(e,t,i,r){let n=t.newStart||t.startPoint,o=t.newEnd||t.endPoint,a=e.getIndex(n),s=e.getIndex(o),[l,c,h]=this.getOuterMidPoints(e),d=($hrM0U.CommonFunc.isInclude(l,e.startPoint),$hrM0U.CommonFunc.isInclude(l,e.endPoint),Math.round(n.distanceTo(o))),u=e.startPoint,p=e.endPoint;if(console.log("dir --- ",r),"start"==r||"center"==r){let t=p.clone().sub(u),l=Math.abs(i-d);"center"==r&&(l/=2),d<i&&t.negate();let c,m=(a>s?o:n).clone().add(t.setLength(l)),f=d<i?t.clone().negate().angle():t.angle(),g=this.getCross(u,h);if(g.splice(g.indexOf(e),1),g.length>0){let t,i,r,n=this.getRightWall(g,u,f);[0,3].includes(a)?(t=n[0],i=n[1],r="MORE"):[2,5].includes(a)&&(t=n[2],i=n[3],r="LESS");let o=this.getFinalEquation(m,i,t.thickness/2,r);c=$hrM0U.CommonFunc.getIntersectPoint(e.parameter.middleLineEquation,o)}else c=u.clone().add(t.setLength(l));[...g,e].forEach((e=>{let t=this.getWallHelperByWall(e);t&&this.removeHelperByWall(t),e.startPoint.equals(u)?e.startPoint=c:e.endPoint=c}))}if("end"==r||"center"==r){let t=u.clone().sub(p),l=Math.abs(i-d);"center"==r&&(l/=2),d<i&&t.negate();let c,m=(a>s?n:o).clone().add(t.setLength(l)),f=i>d?t.clone().negate().angle():t.angle(),g=this.getCross(p,h);if(g.splice(g.indexOf(e),1),g.length>0){let t,i,r,n=this.getRightWall(g,p,f);[0,3].includes(a)?(t=n[2],i=n[3],r="LESS"):[2,5].includes(a)&&(t=n[0],i=n[1],r="MORE");let o=this.getFinalEquation(m,i,t.thickness/2,r);c=$hrM0U.CommonFunc.getIntersectPoint(e.parameter.middleLineEquation,o)}else c=p.clone().add(t.setLength(l));[...g,e].forEach((e=>{let t=this.getWallHelperByWall(e);t&&this.removeHelperByWall(t),e.startPoint.equals(p)?e.startPoint=c:e.endPoint=c}))}new $523a84362d27c3e8$export$b680ca477a72be07(this).wallToJson()}inputChangeLinkWall(e,t,i,r,n,o,a){let s=o.clone(),l=$9HO6e.UtilCore.getRealWallByIntersection(e,t,i,o,r),c=o.clone().add(n),h=[];if(l){let i=$9HO6e.UtilCore.handleLineData(e.startPoint,e.endPoint),r=$9HO6e.UtilCore.moveLineToPoint(t,i.slice(0)),n=$9HO6e.UtilCore.handleLineData(l.startPoint,l.endPoint),o=$9HO6e.UtilCore.lineIsIntersection(r,n);o&&(c=o)}if(2==a.length)this.removeHelperByWall(i[0],!0),h.push([$9HO6e.UtilCore.getNewPoint(i[0]),$9HO6e.UtilCore.getNewPoint(i[0],"end"),i[0]]),$9HO6e.UtilCore.isSameVector(i[0].startPoint,s)?i[0].startPoint=c:i[0].endPoint=c;else if(a.length>2&&l){if(!$9HO6e.UtilCore.pointIsInLine(c,l.startPoint,l.endPoint)){let t=!1;if(a.forEach((i=>{i.uuid!=e.uuid&&$9HO6e.UtilCore.checkWallContainPointNew(i.startPoint,i.endPoint,c)&&(t=!0)})),!t){let e=this.addWall(s,c,l.thickness,!1);e.style=l.style,e.height=l.height,e.thickness=l.thickness}}}let d=[];return a.forEach((t=>{t.uuid!=e.uuid&&d.push(t)})),2==d.length&&$9HO6e.UtilCore.wallIsInLine(d[0],d[1])&&this.margeWall(d[0],d[1]),"end"==r?(e.startPoint=t,e.endPoint=c):(e.startPoint=c,e.endPoint=t),h}changTextToInput(e,t="",i="",r="",n="",o=""){let a=this.getWallHelperByWall(e),s=this.removeInputByClassName(this.uiPanelBox.dom,"showWallLength"+a.uuid);if(!s||""!=s&&"none"==s.style.display)return;let l=e.startPoint.clone().distanceTo(e.endPoint),c=$9HO6e.UtilCore.handleLineData(e.startPoint,e.endPoint),h=$9HO6e.UtilCore.smallDistanceByPointOnLine(c,this.currentPoint.clone()).clone().distanceTo(e.startPoint),d=l/this.config.wallNum,u="";h>=0&&h<=d&&(u="start"),h>d&&h<=d*(this.config.wallNum-1)&&(u="center"),h>d*(this.config.wallNum-1)&&h<=l&&(u="end");let p=new $2a0c8f99fe7360a8$export$ab52802de2137ca0(s.textContent).setClass(s.className).setFontSize("15px").setWidth("40px").setMarginTop(s.style.marginTop).setMarginLeft(s.style.marginLeft).onKeyDown(function(l){if("Tab"==l.key&&document.getElementById("realAngleInput")&&(document.getElementById("realAngleInput").focus(),l.preventDefault()),"13"==l.keyCode){let l=p.dom.value;if(l<0)return;if(a&&this.removeHelperByWall(a),this.execute(),t){let a=[];t=t.clone();let c=$9HO6e.UtilCore.getMeshOtherPoint(e,t),h=this.clickSelect[0].object,d=$9HO6e.UtilCore.getNewPoint(h),u=$9HO6e.UtilCore.getNewPoint(h,"end"),p=c.clone().sub(t).setLength(1*s.textContent-1*l),m=t.clone().add(p),f=$9HO6e.UtilCore.isSameVector(t,h.startPoint)?"end":"start",g="start"==f?h.startPoint.clone():h.endPoint.clone();if(this.removeHelperByWall(h,!0),2==n.length)this.removeHelperByWall(i[0],!0),a.push([$9HO6e.UtilCore.getNewPoint(i[0]),$9HO6e.UtilCore.getNewPoint(i[0],"end"),i[0]]),$9HO6e.UtilCore.isSameVector(i[0].startPoint,t)?i[0].startPoint=m:i[0].endPoint=m;else if(n.length>2){if(!$9HO6e.UtilCore.pointIsInLine(m,e.startPoint,e.endPoint)){let i=!1;if(n.forEach((t=>{t.uuid!=e.uuid&&$9HO6e.UtilCore.checkWallContainPointNew(t.startPoint,t.endPoint,m)&&(i=!0)})),!i){let i=this.addWall(t,m,e.thickness,!1);i.style=e.style,i.height=e.height,i.thickness=e.thickness}}let i=[];n.forEach((e=>{e.uuid!=h.uuid&&i.push(e)})),2==i.length&&$9HO6e.UtilCore.wallIsInLine(i[0],i[1])&&this.margeWall(i[0],i[1])}let x=this.inputChangeLinkWall(h,m,r,f,p,g,o);a=a.concat(x);let b=new $46f32ef2047263b6$export$6bf150a1b9f8c161(this);this.currenDraw=h,b.splitMain();let y=$9QhXH.DM.getWallJson(this.allWalls),w=new(0,$5XTH3.DrawWallTool);this.allWalls=w.create2DWall(y),this.allWalls.pop(),a.forEach((e=>{let t=this.getAllWindowInWall(e[2]),i=e[0].clone(),r=e[1].clone();if(0==t.length)return;let n=this.getWallByWallId(e[2].wallID),o=$9HO6e.UtilCore.getNewPoint(n),a=$9HO6e.UtilCore.getNewPoint(n,"end");t.forEach((t=>{let s=1*$9HO6e.UtilCore.toVector3(t.center).distanceTo($9HO6e.UtilCore.toVector3(i)),l=1*$9HO6e.UtilCore.toVector3(t.center).distanceTo($9HO6e.UtilCore.toVector3(r));""==this.doorDistance&&(this.doorDistance=s<l?[s,i,r,"start"]:[l,r,i,"end"]);let c=e[2].endPoint.clone().sub(e[2].startPoint.clone()),h=o.clone().add(c.setLength(this.doorDistance[0]));"end"==this.doorDistance[3]&&(c=e[2].startPoint.clone().sub(e[2].endPoint.clone()),h=a.clone().add(c.setLength(this.doorDistance[0]))),this.currentDoor=t,new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this,"door","end",[t,[h,n,n],"wall"]).execute(),this.doorHelperGroupClean(),this.currentDoor="",this.doorDistance=""}))}));let v=this.getAllWindowInWall(h);if(v.length>0){let e=this.getWallByWallId(h.wallID),t=$9HO6e.UtilCore.getNewPoint(e),i=$9HO6e.UtilCore.getNewPoint(e,"end");v.forEach((r=>{if(!r.center)return;let n=1*$9HO6e.UtilCore.toVector3(r.center).distanceTo($9HO6e.UtilCore.toVector3(d)),o=1*$9HO6e.UtilCore.toVector3(r.center).distanceTo($9HO6e.UtilCore.toVector3(u));""==this.doorDistance&&(this.doorDistance=n<o?[n,d,u,"start"]:[o,u,d,"end"]);let a=e.endPoint.clone().sub(e.startPoint.clone()),s=t.clone().add(a.setLength(this.doorDistance[0]));"end"==this.doorDistance[3]&&(a=e.startPoint.clone().sub(e.endPoint.clone()),s=i.clone().add(a.setLength(this.doorDistance[0]))),this.currentDoor=r,new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this,"door","end",[r,[s,e,e],"wall"]).execute(),this.doorHelperGroupClean(),this.currentDoor="",this.doorDistance=""}))}return void new $523a84362d27c3e8$export$b680ca477a72be07(this).wallToJson()}this.inputChangeWall(e,a,l,u)}}.bind(this));p.setAttribute("worldPosition",s.getAttribute("worldPosition")),p.setAttribute("angle",s.getAttribute("angle"));let m=$9HO6e.UtilCore.havePointWall(e.startPoint,this.allWalls),f=$9HO6e.UtilCore.havePointWall(e.endPoint,this.allWalls);if(!(m.length>1&&f.length>1)){let i=e.startPoint,r=m;1==m.length&&(i=e.endPoint,r=f);let n=[],o=$9HO6e.UtilCore.getMeshOtherPoint(e,i).clone().sub(i.clone());r.forEach((t=>{if(t.wallID==e.wallID)return;let r=$9HO6e.UtilCore.getMeshOtherPoint(t,i).clone().sub(i.clone()),a=$9HO6e.UtilCore.toVector3(r).angleTo($9HO6e.UtilCore.toVector3(o));a=Math.round(180/Math.PI*a),n.push(a)}));let a=Math.min.apply(null,n),l=n.indexOf(a),c=[];if(r.forEach((t=>{t.wallID!=e.wallID&&c.push(t)})),l>=0&&!t){let t=c[l],r=this.wallHelp.createCircleLine(i,t,e);r.wallId=e.wallID,r.startPoint=e.startPoint,r.endPoint=e.endPoint,r.name="miniCircle",this.helperGroup.add(r);let n=this.getScreenPosition(r.center.clone()),o=new $2a0c8f99fe7360a8$export$ab52802de2137ca0(r.realAngle).setClass("showAngle").setId("realAngleInput").setFontSize("15px").setWidth("40px").setMarginTop(n.y+"px").setMarginLeft(n.x+"px").setFocus().onKeyDown(function(n){if("Tab"==n.key&&(document.getElementsByClassName(s.className)[0].focus(),n.preventDefault()),"Escape"==n.key&&this.exitTool(),"13"==n.keyCode){let n=$9HO6e.UtilCore.getMeshOtherPoint(t,i),a=$9HO6e.UtilCore.getMeshOtherPoint(e,i),s=$9HO6e.UtilCore.getClockWise(n,i,a);s=s>0?-1:1;let l=p.dom.value,c=o.dom.value;c=1*c.replace(/°/g,"");let h=Math.round(180/Math.PI*$9HO6e.UtilCore.toVector2(n.clone().sub(i.clone())).angle());c=Math.PI/180*(h+c*s);let d=new(0,$4xklQ.Vector3)(1,0,0);d.applyEuler(new(0,$4xklQ.Euler)(0,0,c,"XYZ")),this.removeHelperByWall(r),$9HO6e.UtilCore.isSameVector(i,e.startPoint)?(i=e.startPoint.clone().add(d.setLength(l)),e.endPoint=i):(i=e.endPoint.clone().add(d.setLength(l)),e.startPoint=i),new $523a84362d27c3e8$export$b680ca477a72be07(this).wallToJson()}}.bind(this));o.dom.addEventListener("mousedown",function(e){2==e.button&&this.camera.isOrthographicCamera&&this.editor.exitTool()}.bind(this)),this.uiPanelBox.add(o)}}this.uiPanelBox.add(p)}changInputToText(e){this.removeInputByClassName(this.uiPanelBox.dom,e.className);let t=new $2a0c8f99fe7360a8$export$3dc21c16dab61cf7(e.value).setClass(e.className).setFontSize("15px").setWidth("40px").setMarginTop(e.style.marginTop).setMarginLeft(e.style.marginLeft).setStyle(["transform"],["rotate("+e.getAttribute("angle")+"deg)"]);t.setAttribute("worldPosition",e.getAttribute("worldPosition")),t.setAttribute("angle",e.getAttribute("angle")),this.uiPanelBox.add(t)}changAllInputToText(){let e=this.uiPanelBox.dom.children;for(let t=0;t<e.length;t++)"INPUT"==e[t].tagName&&e[t].className.indexOf("showWallLength")>=0&&this.changInputToText(e[t])}getWallByWallId(e){let t="";return this.allWalls.forEach((i=>{i.wallID==e&&(t=i)})),t}get3dWallByWallId(e){let t="";return this.wallGroup3D.children.slice(0).forEach((i=>{i.wallID==e&&(t=i)})),t}changeClickColor(e){e&&e.children.forEach((e=>{"Line"!=e.type&&"Line2"!=e.type&&"DWHelper"!=e.type||(e.material.color.equals(this.moveDoorOutColor)||e.material.color.equals(this.moveDoorColor))&&(e.material.color=this.clickColor)}))}addLineHelperForDoor(e,t=!1){if(!e.wallId)return;if(!e.startPoint)return;let i=this.getWallByWallId(e.wallId);if(""==i)return;let r=new(0,$4xklQ.Vector3)(i.startPoint.x,i.startPoint.y,0),n=new(0,$4xklQ.Vector3)(i.endPoint.x,i.endPoint.y,0);if(r.clone().distanceTo(n.clone())<10)return;let o=new $aa3f6685526d27fa$export$d9f78ae40723f6c8(this);"UWindow"==e.modelType?o.addUWindowHelper(i,e,t):"LWindow"==e.modelType?o.addLWindowHelper(e,t):"arcWindow"==e.modelType?o.addArcWindowHelper(e):o.addDoorHelper(i,e,t),this.changeClickColor()}addLineHelperForMember(e){this.cleanWallHelper(),this.doorHelperGroupClean();let t=new $d1f58c4378eaed8a$export$79a920aedf5098c2(this).addMemberHelper(e);this.pointHelperGroup.add(...t)}doorHelperGroupClean(){let e=this.pointHelperGroup.children.slice(0);e.forEach((e=>{!e.useType||"scaleTool"!=e.useType&&"rotateTool"!=e.useType||this.pointHelperGroup.remove(e)})),e=this.helperGroup.children.slice(0),this.removeInputByClassName(this.uiPanelBox.dom,"showModelDis"),e.forEach((e=>{e.modelId&&this.helperGroup.remove(e)})),0!=this.doorHelperGroup.children.length&&(this.doorHelperGroup.children.forEach((e=>{this.removeInputByClassName(this.uiPanelBox.dom,"showDoorLength"+e.uuid)})),e=this.pointHelperGroup.children.slice(0),e.forEach((e=>{"Mesh"==e.type&&this.pointHelperGroup.remove(e)})),this.doorHelperGroup.children=[],this.otherMeshs.forEach((e=>{e.children.forEach((e=>{"Line"!=e.type&&"Line2"!=e.type||e.material.color.equals(this.clickColor)&&(e.material.color=this.moveDoorOutColor)}))})))}addArcPointHelper(e,t){let i=new $d0f874000594cf7a$export$a955f3d6a39ce4b2,r=this.pointHelperGroup.children.slice(0),n=!0,o=!0;this.allWalls.forEach((i=>{let r=i.startPoint,a=i.endPoint,s=$9HO6e.UtilCore.isSameVector(e,r)||$9HO6e.UtilCore.isSameVector(e,a),l=$9HO6e.UtilCore.isSameVector(t,r)||$9HO6e.UtilCore.isSameVector(t,a);s&&l||(s&&(n=!1),l&&(o=!1))}));let a=!1,s=!1;r.forEach((i=>{"Mesh"!=i.type&&i.center&&($9HO6e.UtilCore.isSameVector(e,i.center)&&(a=!0),$9HO6e.UtilCore.isSameVector(t,i.center)&&(s=!0),$9HO6e.UtilCore.isSameVector(e,i.center)&&!n&&this.pointHelperGroup.remove(i),$9HO6e.UtilCore.isSameVector(t,i.center)&&!o&&this.pointHelperGroup.remove(i))})),this.innerDraw,n&&!a&&this.pointHelperGroup.add(i.createPoint(e)),o&&!s&&this.pointHelperGroup.add(i.createPoint(t))}addIntersectPointHelper(){let e=new $d0f874000594cf7a$export$a955f3d6a39ce4b2,t=[];this.allWalls.forEach((e=>{let i=e.startPoint.clone(),r=e.endPoint.clone(),n=!1,o=!1;t.forEach((e=>{$9HO6e.UtilCore.isSameVector(e,i)&&(n=!0),$9HO6e.UtilCore.isSameVector(e,r)&&(o=!0)})),n||t.push(i),o||t.push(r)}));let i=this.pointHelperGroup.children.slice(0);t.forEach((t=>{let r=0,n=[];this.allWalls.forEach((e=>{let i=e.startPoint.clone(),o=e.endPoint.clone();$9HO6e.UtilCore.isSameVector(t,i)&&r++,$9HO6e.UtilCore.isSameVector(t,o)&&r++,($9HO6e.UtilCore.isSameVector(t,i)||$9HO6e.UtilCore.isSameVector(t,o))&&n.push(1*e.thickness)}));let o=Math.min.apply(null,n);if(r>1){let r=!1;i.forEach((e=>{"Mesh"!=e.type&&e.center&&$9HO6e.UtilCore.isSameVector(t,e.center)&&(r=!0)})),r||this.pointHelperGroup.add(e.createDragPoint(t,"",o/3))}else if(1==r){let r=!1;i.forEach((e=>{"Mesh"!=e.type&&e.center&&$9HO6e.UtilCore.isSameVector(t,e.center)&&(r=!0)})),r||this.pointHelperGroup.add(e.createPoint(t,"",o/3))}}))}switchHelperGroup(e="show",t=!0){let i=this.uiPanelBox.dom.children;if(0!=i.length)for(let t=0;t<i.length;t++)"show"==e&&(i[t].className.indexOf("showWallLength")>=0?this.config.settingJson.dimension&&(i[t].style.display="block"):i[t].style.display="inline-block"),"hidden"==e&&(i[t].style.display="none")}updateDom(){let e=this.uiPanelBox.dom.children;if(0!=e.length)for(let t=0;t<e.length;t++){if(!e[t].getAttribute("worldPosition"))continue;let i=e[t].getAttribute("worldPosition").split("/"),r=new(0,$4xklQ.Vector3)(i[0],i[1],i[2]),n=this.getScreenPosition(r);e[t].className.indexOf("showScaleLength")>=0&&(n.y+=20),e[t].style.marginTop=n.y+"px",e[t].style.marginLeft=n.x+"px"}}getDisByScreen(){let e=this.getScreen(new(0,$4xklQ.Vector3)(100,0,0),this.camera),t=this.getScreen(new(0,$4xklQ.Vector3)(0,0,0),this.camera);return Math.round(e[0]-t[0])/20}getDialogPosition(e,t,i=""){let r="";r=""!=i?$9HO6e.UtilCore.toVector3(i).project(this.camera):e.x<t.x?t.clone().project(this.camera):e.clone().project(this.camera);let n=window.innerWidth/2,o=window.innerHeight/2,a=[Math.round(r.x*n+n),Math.round(-r.y*o+o)];return a[0]+=30,a[1]-=60,a}get3DModelDialogPosition(e,t=50){const i=(new(0,$4xklQ.Box3)).setFromObject(e);let r=1*(i.max.y-i.min.y).toFixed(2)/2;e.height&&(r=1*e.height/2),e.updateMatrixWorld(!0);var n=new $4xklQ.Vector3;e.getWorldPosition(n),n.y+=r;let o=n.project(this.camera),a=window.innerWidth/2,s=window.innerHeight/2,l=[Math.round(o.x*a+a),Math.round(-o.y*s+s)];return l[0]+=2*t,l[1]-=t,l}updateDialogPosition(e){if(!e.useType||!e.startPoint)return;let t=this.getDialogPosition(new(0,$4xklQ.Vector3)(e.startPoint.x,e.startPoint.y,0),new(0,$4xklQ.Vector3)(e.endPoint.x,e.endPoint.y,0));this.list.showDialog.dispatch(0,"wall",t,[])}addBoxForMesh(e,t){if(e.geometry){const t=new $4xklQ.EdgesGeometry(e.geometry,4),i=new $4xklQ.LineSegments(t,this.boxLineMaterial);e.updateWorldMatrix(!0);let r=e.position.clone();e.parent&&e.parent.localToWorld(r),this.lineGroup3D.updateWorldMatrix(!0),this.lineGroup3D.worldToLocal(r);let n=this.getOuterParent(e),o=n.rotation;"CodeModel"==n.modelType&&i.rotation.set(o.x,o.y,o.z),i.position.copy(r),this.lineGroup3D.add(i)}else e.children.forEach((e=>{this.addBoxForMesh(e,t)}))}addPositionHelper(e,t=!1){let i=0;i=e.rotation.z;let r=parseInt(180/Math.PI*i);r<0&&(r+=360);let n,o,a,s,l=$9HO6e.UtilCore.getModelVertex(e);if(r>355||r<=5||r>85&&r<=95||r>175&&r<=185||r>265&&r<=275){let e=[l[4].x,l[5].x,l[6].x,l[7].x].sort((function(e,t){return e-t})),t=[l[4].y,l[5].y,l[6].y,l[7].y].sort((function(e,t){return e-t}));for(let i=4;i<l.length;i++)Math.abs(l[i].y-t[t.length-1])<.01&&(Math.abs(l[i].x-e[1])<.01||Math.abs(l[i].x-e[2])<.01)&&(n=l[i]),Math.abs(l[i].y-t[0])<.01&&(Math.abs(l[i].x-e[1])<.01||Math.abs(l[i].x-e[2])<.01)&&(o=l[i]),(Math.abs(l[i].y-t[1])<.01||Math.abs(l[i].y-t[2])<.01)&&Math.abs(l[i].x-e[0])<.01&&(a=l[i]),(Math.abs(l[i].y-t[1])<.01||Math.abs(l[i].y-t[2])<.01)&&Math.abs(l[i].x-e[e.length-1])<.01&&(s=l[i])}else{let e=[l[0].x,l[1].x,l[2].x,l[3].x],t=[l[0].y,l[1].y,l[2].y,l[3].y],i=e.indexOf(Math.min(...e)),r=e.indexOf(Math.max(...e)),c=t.indexOf(Math.min(...t)),h=t.indexOf(Math.max(...t));n=l[h],o=l[c],a=l[i],s=l[r]}l=[n,o,a,s];let c=[[0,1],[0,-1],[-1,0],[1,0]];if(!l[0])return;n=["Y","",l[0].x],o=["Y","",l[1].x],a=["X","",l[2].y],s=["X","",l[3].y];let h=[[],[],[],[]],d=[[],[],[],[]],u=this.allWalls.slice(0);u=u.concat(this.model2D.children),u=u.concat(this.otherMember),u.forEach((t=>{if(t.id==e.id)return;let i=[];if(t.geometry&&"2DModel"!=t.modelType){let e=t.geometry.attributes.position.array;i=[e[0],e[1],e[9],e[10],e[15],e[16],e[6],e[7]]}else{let e=$9HO6e.UtilCore.getModelVertex(t);i=[e[0].x,e[0].y,e[3].x,e[3].y,e[2].x,e[2].y,e[1].x,e[1].y]}for(let e=0;e<=3;e++){let t=c[e],r=PolyK.Raycast(i,l[e].x,l[e].y,t[0],t[1]);if(r){let i=l[e].clone().add(new(0,$4xklQ.Vector3)(t[0],t[1],0).setLength(r.dist));h[e].push(i),d[e].push(r.dist)}}}));let p=Math.min.apply(null,d[0]),m=Math.min.apply(null,d[1]),f=Math.min.apply(null,d[2]),g=Math.min.apply(null,d[3]);this.addMinDisInput(h[0],l[0],p,"top",e,t),this.addMinDisInput(h[1],l[1],m,"bot",e,t),this.addMinDisInput(h[2],l[2],f,"lef",e,t),this.addMinDisInput(h[3],l[3],g,"rig",e,t)}addMinDisInput(e,t,i,r,n,o){e.forEach((e=>{let a=$9HO6e.UtilCore.toVector3(e).distanceTo($9HO6e.UtilCore.toVector3(t));if(Math.abs(a-i)<.01){let i=this.wallHelp.createLineDimensionsLine(t,e,!1,10);i.modelId=n.id;let a=new(0,$4xklQ.Vector2)(e.x,e.y).sub(new(0,$4xklQ.Vector2)(t.x,t.y)).angle();a=180/Math.PI*a,a>180&&a<270?a=360-a+180:a>90&&a<=180?(a*=-1,a+=180):a=360-a;let s=this.getScreenPosition(i.center.clone()),l=new $2a0c8f99fe7360a8$export$3dc21c16dab61cf7(i.lineLength).setClass("showModelDis").setFontSize("15px").setWidth("40px").setMarginTop(s.y+"px").setMarginLeft(s.x+"px").setStyle(["transform"],["rotate("+a+"deg)"]);o&&(l=new $2a0c8f99fe7360a8$export$ab52802de2137ca0(i.lineLength).setClass("showModelDis").setFontSize("15px").setWidth("40px").setMarginTop(s.y+"px").setMarginLeft(s.x+"px").onKeyDown(function(e){if("13"==e.keyCode){this.pointHelperGroup.children.slice(0).forEach((e=>{"rotateTool"!=e.useType&&"scaleTool"!=e.useType||this.pointHelperGroup.remove(e)})),this.cleanModelHelper();let e=l.dom.value,t=l.getAttribute("moveDir"),r=1*e-1*i.lineLength;"rig"==t&&(n.position.x-=r),"lef"==t&&(n.position.x+=r),"top"==t&&(n.position.y-=r),"bot"==t&&(n.position.y+=r);let o=(new $d0f874000594cf7a$export$a955f3d6a39ce4b2).createHelperForMumber(n);this.synchroModel(n),this.pointHelperGroup.add(...o),this.addPositionHelper(n,!0);let a=$9HO6e.UtilCore.toVector3(n.position.clone()).project(this.camera),s=window.innerWidth/2,c=window.innerHeight/2,h=[1*Math.round(a.x*s+s),1*Math.round(-a.y*c+c)];h[0]+=40,h[1]-=80,this.list.showDialog.dispatch("","",h)}}.bind(this)));let c=i.center.x+"/"+i.center.y+"/"+i.center.z;return l.setAttribute("worldPosition",c),l.setAttribute("angle",a),l.setAttribute("moveDir",r),this.camera.isOrthographicCamera&&i.lineLength>10&&this.uiPanelBox.add(l),void this.helperGroup.add(i)}}))}getWallNearModelSide(e,t,i,r,n,o,a,s){let l=$9HO6e.UtilCore.lineIsIntersection(t,i);if(!l)return;let c=$9HO6e.UtilCore.lineIsIntersection(r,i),h=$9HO6e.UtilCore.pointIsInLine(c,l,o);if(h||(c=$9HO6e.UtilCore.lineIsIntersection(n,i)),h){if(!$9HO6e.UtilCore.pointIsInLine(c,a[0],a[1]))return}else if(!$9HO6e.UtilCore.pointIsInLine(c,s[0],s[1]))return;if("top"==e&&c.y<=o.y)return;if("bot"==e&&c.y>=o.y)return;if("lef"==e&&c.x>=o.x)return;if("rig"==e&&c.x<=o.x)return;let d=$9HO6e.UtilCore.toVector3(o).distanceTo($9HO6e.UtilCore.toVector3(c));return[$9HO6e.UtilCore.toVector3(c),d]}exitTool(e=!0,t=!0){if(this.startPoint="",this.copyDoor="",this.copyFloorMaterial="",this.splitRoomLineGroup.children=[],this.list.startPlayer.dispatch(),this.selectObjArr=[],this.doorHelperGroupClean(),this.clickSelect.length>0&&""!=this.clickSelect[0].object&&"wall"==this.clickSelect[0].object.useType&&(this.clickSelect[0].object.material.color=this.getWallColor(this.clickSelect[0].object)),this.list.resetproperty.dispatch({roomOpacity:100*window.roomOpacity,storeyHei:window.storeyHei,floorDep:window.floorDep}),this.list.hiddenDialog.dispatch(),this.modelHelperGroup.children=[],this.clickSelect=[],this.destroy3DModelHelper(),this.currenDraw&&""!=this.currenDraw?"Mesh"==this.currenDraw.type||"Group"==this.currenDraw.type||"Line"==this.currenDraw.type?("Group"==this.currenDraw.type&&(this.dom.style.cursor="default",this.toolType="free",this.doorHelperGroupClean()),this.scene.remove(this.currenDraw),this.removeHelperByWallId(this.currenDraw.id)):this.currenDraw.forEach((e=>{this.scene.remove(e),this.removeHelperByWallId(e.id)})):(this.dom.style.cursor="default",this.toolType="free",this.list.switchBounced.dispatch("")),this.removeInputByClassName(this.uiPanelBox.dom,"moveInput"),this.removeInputByClassName(this.uiPanelBox.dom,"moveInput"),""!=this.mouseCoverObj){if(this.viewportCamera.isOrthographicCamera){this.model2D.remove(this.mouseCoverObj);let e=this.get3DModelBy2DModel(this.mouseCoverObj);this.model3D.remove(e)}else{this.model3D.remove(this.mouseCoverObj);let e=editor.get2DModelBy3DModel(this.mouseCoverObj);this.model2D.remove(e)}this.mouseCoverObj=""}this.currenDraw="",""!=this.currentPoint&&$9HO6e.UtilCore.handleSpecialPoint(this.currentPoint.clone(),this.specialPointArr,this),this.pointHelpGroup.children=[],t&&e&&(this.viewportCamera.isOrthographicCamera?new $523a84362d27c3e8$export$b680ca477a72be07(this).wallToJson():new $523a84362d27c3e8$export$b680ca477a72be07(this).wallToJson("3D"))}getArcOtherPoint(e,t,i,r){let n=e.clone().distanceTo(i.arcCenter.clone()),o=new(0,$4xklQ.Vector2)((e.x+r.x)/2,(e.y+r.y)/2),a=new(0,$4xklQ.Vector2)((e.x+t.x)/2,(e.y+t.y)/2),s=e.clone().distanceTo(r.clone()),l=s/2/n,c=n*(e.clone().distanceTo(t.clone())/2)/(s/2),h=c*Math.sqrt(1-l*l),d=a.clone().add(i.arcCenter.clone().sub(o.clone()).setLength(h));return Math.abs(l-1)<1e-4&&(d=a.clone()),d.clone().add(i.cp.clone().sub(i.arcCenter.clone()).setLength(c))}getSceneAllJson(e=!1){let t=$9QhXH.DM.getHoleJson(this.otherMeshs,this),i=$9QhXH.DM.memberJson(this.otherMember),r=$9QhXH.DM.getWallJson(this.allWalls),n=$9QhXH.DM.getModelJson(this.model3D.children,[],e),o=$9QhXH.DM.getSplitLineJson(this.splitRoomLine.children);r.forEach((e=>{e.start.x*=100,e.start.y*=100,e.end.x*=100,e.end.y*=100}));let a=this.camera,s=this.camera.isOrthographicCamera?"2D":"3D";this.camera.isOrthographicCamera&&(a=this.getOtherCamera(a));let l=this.camera;this.camera.isOrthographicCamera||(l=this.getOtherCamera(l));let c=1;a.zoomNum&&(c=a.zoomNum);let h=[this.controlsArr[0].target.x,this.controlsArr[0].target.y,this.controlsArr[0].target.z],d=[0,0,0];2==this.controlsArr.length&&(d=[this.controlsArr[1].target.x,this.controlsArr[1].target.y,this.controlsArr[1].target.z]);let u={sceneModel:s,zoom:l.zoom,position:{x:l.position.x,y:l.position.y,z:l.position.z},rotation:{x:l.rotation.x,y:l.rotation.y,z:l.rotation.z},"3dPosition":{x:a.position.x,y:a.position.y,z:a.position.z},"3dRotation":{x:a.rotation.x,y:a.rotation.y,z:a.rotation.z},target:{x:h[0],y:h[1],z:h[2]},"3dTarget":{x:d[0],y:d[1],z:d[2]},"3dVal":c};"3dRomaCamera"==a.name&&(u["3dPosition"]={x:a.realPosition.x,y:a.realPosition.y,z:a.realPosition.z},u["3dRotation"]={x:"",y:a.realRotation[0].y,z:a.realRotation[1].z});let p=this.getDomsByClassName(this.uiPanelBox.dom,"roomName"),m=[],f=this.floorGroup2d.children;p.forEach((e=>{let t=e.getAttribute("center"),i=e.getAttribute("roomName")+"\n"+e.getAttribute("roomArea");i=i.replace(/<br>/g,"\n"),i=i.replace(/undefined/g,"");let r=[t,i];f.forEach((e=>{let i=e.roomCenter,n=e.parameter.points,o=[];n.forEach((e=>{o.push([e.x,e.y])}));let a=i[0]+"/"+i[1];t==a&&(r.push(1==e.material.color.r),r.push(o))})),m.push(r)}));let g=[];this.allRoomCenterCamera.children.slice(0).forEach((e=>{if(e.name.indexOf("camera")>=0){let t=e.position,i={position:{x:1e3*t.x,y:window.storeyHei,z:1e3*t.z}};g.push(i)}}));let x="";this.scene.children.forEach((e=>{"mapImage"==e.useType&&(x=e)}));let b={};return""!=x&&(b={width:x.width*x.scale.x,height:x.height*x.scale.y,imgUrl:x.imgUrl,visible:x.visible}),{version:this.dataVersion,themeColor:this.themeColor,wall:r,hole:t,member:i,model:n,splitLine:o,cameraJson:u,roomJson:m,mapJson:b,settingJson:this.config.settingJson,roomOpacity:window.roomOpacity,storeyHei:window.storeyHei,floorDep:window.floorDep,allLightMsg:g}}saveSceneJsonToFile(){var e=JSON.stringify(this.getSceneAllJson(!0)),t=new Blob([e],{type:"text/json"}),i=document.createElement("a");i.style.display="none",i.href=URL.createObjectURL(t),i.download="rjh_scene.json",i.click()}saveSceneJson(){let e=this.getSceneAllJson();this.cacheJson=JSON.stringify(e);let t={sceneJson:e},i="";if(localStorage.getItem("sceneData")){let r=new Date;if(i=localStorage.getItem("sceneData"),i.indexOf("version")>=0){if(JSON.stringify(e)==i)return;i=r.getFullYear()+""+(r.getMonth()+1)+r.getDate()+Math.round(1e4*Math.random()+1)+".json",localStorage.setItem("sceneData",i),this.saveJsonToSever(t,i,!0)}else if(this.currentCacheJson){let r=this.currentCacheJson;if(JSON.stringify(e)==JSON.stringify(r))return;console.log("保存:"+i),localStorage.setItem("sceneData",i),this.saveJsonToSever(t,i,!0)}}else{let e=new Date;i||(i=e.getFullYear()+""+(e.getMonth()+1)+e.getDate()+Math.round(1e4*Math.random()+1)+".json"),localStorage.setItem("sceneData",i),this.saveJsonToSever(t,i,!0)}}isObj(e){return e&&"object"==typeof e&&"[object object]"==Object.prototype.toString.call(e).toLowerCase()}isArray(e){return e&&"object"==typeof e&&e.constructor==Array}getLength(e){var t=0;for(var i in e)t++;return t}CompareJsonObj(e,t){return!(!this.isObj(e)||!this.isObj(t))&&(this.getLength(e)==this.getLength(t)&&this.CompareObj(e,t,!0))}CompareObj(e,t,i,r=["uuid"]){if(this.getLength(e)!=this.getLength(t))return!1;for(var n in e){if(!i)break;if(!t.hasOwnProperty(n)){i=!1;break}if("cameraJson"!=n)if(this.isArray(e[n])){if(!this.isArray(t[n])){i=!1;break}var o=e[n],a=t[n];if(o.length!=a.length){i=!1;break}for(var s in o){if(!i)break;i=this.CompareObj(o[s],a[s],i)}}else if(this.isObj(e[n])){if(!this.isObj(t[n])){i=!1;break}if(!i)break;i=this.CompareObj(e[n],t[n],i)}else{if(r.indexOf(n)>=0)continue;if(String(t[n])!=String(e[n])){i=!1;break}}}return i}updateModel(e){if(this.clickDepthMsg.uuid){this.modelDotGroup.children=[];let t=this.getOuterParent(e,e,"outer"),i=t.param[0];this.refreshRealSizeByBox(t,e),this.updateModelPosition(e.parent,t),this.addDashBoxFor2dGroup(i),this.addDashBoxForGroup(t)}}updateModelPosition(e,t){if(!e)return;if("3dModel"==e.name||"2dModel"==e.name)return;let i=e;"2dModel"==t.parent.name&&(i=e.param[0],t=t.param[0]),e.updateWorldMatrix(!0,!0);let r=[];e.children.forEach((t=>{let i=t.position.clone();i=e.localToWorld(i),r.push(i)}));let n=new(0,$4xklQ.Vector3);this.getRealCenter(e).getCenter(n),e.parent.worldToLocal(n),e.position.set(n.x,n.y,n.z),this.synchroModel(e);let o=0;e.updateWorldMatrix(!0,!0),e.children.forEach((t=>{let i=r[o];e.worldToLocal(i),t.position.set(i.x,i.y,i.z),this.synchroModel(t),o++}));let a=this.getRealCenter(i),s=(new $44a90fc8a2825c34$export$f7a1f6dc3f8b082f).fromBox3(a);i.width=2*s.halfSize.x/i.scale.x,i.height=2*s.halfSize.y/i.scale.y,i.depth=2*s.halfSize.z/i.scale.z,i.param[0].width=1e3*i.width,i.param[0].height=1e3*i.depth,i.param[0].depth=1e3*i.height,this.updateModelPosition(e.parent,t)}getWorldRotation(e){return null===e?new(0,$4xklQ.Vector3):(t=e.rotation,i=this.getWorldRotation(e.parent),new(0,$4xklQ.Vector3)(t.x+i.x,t.y+i.y,t.z+i.z));var t,i}getRealCenter(e){let t=this.getWorldRotation(e);t.x=-t.x+e.rotation.x,t.y=-t.y+e.rotation.y,t.z=-t.z+e.rotation.z;let i=e.rotation.x,r=e.rotation.y,n=e.rotation.z;e.rotation.set(t.x,t.y,t.z);const o=(new(0,$4xklQ.Box3)).setFromObject(e);return e.rotation.set(i,r,n),o}makeGroup(e="3d"){this.execute(),this.doorHelperGroupClean();let t=new(0,$4xklQ.Group),i=this.selectObjArr.slice(0),r=new(0,$4xklQ.Group),n="",o="",a=[];i.forEach((i=>{let s=this.getOuterParent(i);if("3d"==e){let e=this.get2DModelBy3DModel(s);o=s.parent,n=o.param?o.param[0]:this.model2D,r.add(e),t.add(s)}else{let e=this.get3DModelBy2DModel(s);n=s.parent,o=n.param?n.param[0]:this.model3D,r.add(s),t.add(e)}s.modelPosition&&a.push(s.modelPosition),s.param[0].modelPosition&&a.push(s.param[0].modelPosition)})),a.indexOf("bottom")<0&&a.indexOf("free")<0?(t.modelPosition="top",r.modelPosition="top"):a.indexOf("bottom")<0&&a.indexOf("top")<0?(t.modelPosition="free",r.modelPosition="free"):(t.modelPosition="bottom",r.modelPosition="bottom"),o.add(t),n.add(r),t.updateWorldMatrix(!0,!1);const s=(new(0,$4xklQ.Box3)).setFromObject(t);let l=(new $44a90fc8a2825c34$export$f7a1f6dc3f8b082f).fromBox3(s);t.width=1*Math.abs(s.max.x-s.min.x).toFixed(2),t.height=1*Math.abs(s.max.y-s.min.y).toFixed(2),t.depth=1*Math.abs(s.max.z-s.min.z).toFixed(2),r.updateWorldMatrix();const c=(new(0,$4xklQ.Box3)).setFromObject(r);let h=(new $44a90fc8a2825c34$export$f7a1f6dc3f8b082f).fromBox3(c).center.clone();n.updateMatrixWorld(),n.worldToLocal(h),r.position.copy(h);let d=l.center.clone();o.updateMatrixWorld(),o.worldToLocal(d),t.position.copy(d),t.children.forEach((e=>{e.position.sub(d)})),r.children.forEach((e=>{e.position.sub(h)})),t.modelType="modelGroup",t.modelId=r.uuid,t.param=[r],r.modelId=t.uuid,r.param=[t],r.modelType="2dModelGroup",this.selectObjArr=this.camera.isOrthographicCamera?[r]:[t],this.modelHelperGroup.children=[],this.addBoxForGroup(t),this.addBoxFor2dGroup(r)}explodeGroup(e="3d",t=!0){if(1!=this.selectObjArr.length)return;t&&this.execute(),this.doorHelperGroupClean(),this.modelHelperGroup.children=[];let i=this.getOuterParent(this.selectObjArr[0]),r=i.parent,n=i.children.slice(0);n.forEach((t=>{t.matrixWorld.decompose(t.position,t.quaternion,t.scale),r.add(t),"3d"==e?this.addBoxForGroup(t):this.addBoxFor2dGroup(t)})),i.parent.remove(i);let o="3d"==e?this.get2DModelBy3DModel(i):this.get3DModelBy2DModel(i),a=o.parent;n=o.children.slice(0),n.forEach((t=>{t.matrixWorld.decompose(t.position,t.quaternion,t.scale),a.add(t),"3d"==e?this.addBoxForGroup(t):this.addBoxFor2dGroup(t)})),o.parent.remove(o),this.selectObjArr=[]}setLayers(e,t){if(e.layers.set(t),e.children){e.children.slice(0).forEach((e=>{this.setLayers(e,t)}))}}extendParam(e,t,i=""){for(const i in e)t.hasOwnProperty(i)||(t[i]=e[i]&&e[i].isVector3?e[i].clone():e[i]);if(e.rotation.x!=t.rotation.x&&(t.rotation.x=e.rotation.x,t.rotation.y=e.rotation.y,t.rotation.z=e.rotation.z),""!=i&&(t.param=[i],i.param=[t]),!e.imgPath){let r=0,n=t.children;e.children.slice(0).forEach((e=>{let t="";""!=i&&i.children.forEach((i=>{i.param[0].uuid==e.uuid&&(t=i)})),this.extendParam(e,n[r],t),r++}))}}modelCopy(){let e=this.camera.isOrthographicCamera?"2d":"3d";if(""==this.clickSelect||""==this.clickSelect[0].object)return;let t=this.getOuterParent(this.clickSelect[0].object),i=t.clone();if(this.extendParam(t,i),"2d"==e){let e=this.get3DModelBy2DModel(t),r=e.clone();this.extendParam(e,r,i),t.parent.add(i),e.parent.add(r)}else{let e=this.get2DModelBy3DModel(t),r=e.clone();this.extendParam(e,r,i),t.parent.add(i),e.parent.add(r)}this.mouseCoverObj=i}modelReverse(e){let t=this.camera.isOrthographicCamera?"2d":"3d";if(""==this.clickSelect||""==this.clickSelect[0].object)return;let i=this.getOuterParent(this.clickSelect[0].object);Math.PI;"2d"==t?"frontBackTurn"==e?i.scale.y*=-1:i.scale.x*=-1:"frontBackTurn"==e?i.scale.z*=-1:i.scale.x*=-1,this.getRealCenter(i),this.synchroModel(i)}doorSetLock(){if(""==this.clickSelect||""==this.clickSelect[0].object)return;if("2d"==(this.camera.isOrthographicCamera?"2d":"3d")){let e=this.clickSelect[0].object.parent;e.isLock=!e.isLock,this.doorHelperGroupClean(),this.addLineHelperForDoor(e,!0);let t=this.getWallById(e.wallId);this.partRefreshWall(t)}else{let e=this.clickSelect[0].object,t=this.getOuterParent(e);t.isLock=!t.isLock,t.parameter.tdm.isLock=t.isLock}}memberSetLock(){if(""==this.clickSelect||""==this.clickSelect[0].object)return;if("2d"==(this.camera.isOrthographicCamera?"2d":"3d")){let e=this.clickSelect[0].object.parent;e.isLock=!e.isLock,this.doorHelperGroupClean(),e.isLock?this.addPositionHelper(e,!0):this.addLineHelperForMember(e),this.get3DMemberBy2DMember(e).isLock=e.isLock}else{let e=this.clickSelect[0].object;e.isLock=!e.isLock,this.get2DMemberBy3DMember(e).isLock=e.isLock}}modelHidden(){if(""==this.clickSelect||""==this.clickSelect[0].object)return;this.doorHelperGroupClean(),this.list.hiddenDialog.dispatch(),this.modelHelperGroup.children=[];let e=[];e=1==this.selectObjArr.length?[this.clickSelect[0].object]:this.selectObjArr,this.execute(),e.forEach((e=>{let t=this.getOuterParent(e);if(t.isLock)return void(1==this.selectObjArr.length&&this.list.alert.dispatch("模型已锁定,请先解锁","warning"));t.visible=!1,t.param[0].visible=!1;let i=t.modelPosition;t.modelPosition||(i=t.param[0].modelPosition),"bottom"==i?this.config.settingJson.showFloorFurniture=!1:"top"==i?this.config.settingJson.showCeilFurniture=!1:this.config.settingJson.showWallFurniture=!1})),this.list.getShowHiddenFlag.dispatch(JSON.stringify(this.config.settingJson),!1)}modelSetLock(){if(""==this.selectObjArr||0==this.selectObjArr.length)return;let e=this.camera.isOrthographicCamera?"2d":"3d",t=!0;this.selectObjArr.forEach((e=>{this.getOuterParent(e).isLock||(t=!1)})),this.selectObjArr.forEach((i=>{let r=this.getOuterParent(i);if(r.isLock=!t,"2d"==e){this.get3DModelBy2DModel(r).isLock=r.isLock,this.doorHelperGroupClean(),this.addPositionHelper(r,!0)}else{this.get2DModelBy3DModel(r).isLock=r.isLock,new $102b3df9ca2da060$export$aead3d23b4737909(this).selectObj([r])}}))}door3DCopy(){if(""==this.clickSelect||""==this.clickSelect[0].object)return;let e=this.getOuterParent(this.clickSelect[0].object),t=this.codeModelCopy(e),i=e.parameter.tdm,r=i.clone();for(const i in e)t.hasOwnProperty(i)||(t[i]=e[i]&&e[i].isVector3?e[i].clone():e[i]);for(const e in i)r.hasOwnProperty(e)||(r[e]=i[e]&&i[e].isVector3?i[e].clone():i[e]);r.name="copy",t.parameter.tdm=r,this.wallGroup3D.add(t),this.scene.add(r),this.otherMeshs.push(r),new $f708759ef0d3ebee$export$cbb426a6cd1f3789(this,t).selectObj(this.clickSelect[0].object)}modelReplace(){if(""==this.clickSelect||""==this.clickSelect[0].object)return;let e=this.getOuterParent(this.clickSelect[0].object);if(e.modelRealType){let t=e.modelRealType;this.list.modelReplace.dispatch(t)}}modelFloat(e){if(""==this.clickSelect||""==this.clickSelect[0].object)return;let t=this.getOuterParent(this.clickSelect[0].object),i=[0,0];this.getTopModePosition(t.parent,t.parent,i);"topFloat"==e?t.position.z=i[0]+.002:(t.position.z=i[1]-.002,t.position.z<=-.1&&(t.position.z=-.1))}modelReplaceMain(e){if(""==this.clickSelect||""==this.clickSelect[0].object)return;let t=this.getOuterParent(this.clickSelect[0].object);this.modelReplaceCore(t,e);let i="",r="";this.camera.isOrthographicCamera?(i=this.get3DModelBy2DModel(t),r=this.get3DModelBy2DModel(e)):(i=this.get2DModelBy3DModel(t),r=this.get2DModelBy3DModel(e)),i&&r&&this.modelReplaceCore(i,r),this.clickSelect[0].object=e,this.camera.isOrthographicCamera?this.addLineHelperForMember(e):new $102b3df9ca2da060$export$aead3d23b4737909(this).selectObj([e]),this.updateModelPosition(e.parent,e)}modelReplaceCore(e,t,i="position"){e.parent.add(t);for(const i in e)t.hasOwnProperty(i)||(t[i]=e[i]&&e[i].isVector3?e[i].clone():e[i]);t.position.copy(e.position);var r=new(0,$4xklQ.Box3);r.setFromObject(t);let n=1*(r.max.x-r.min.x).toFixed(2),o=1*(r.max.y-r.min.y).toFixed(2),a=1*(r.max.z-r.min.z).toFixed(2);if("position"==i){if(0!=a){let i=t.modelPosition,r=o-e.height*e.scale.y;"top"==i?t.position.y-=r/2:t.position.y+=r/2}}else t.scale.set(e.width*e.scale.x/n,e.height*e.scale.y/o,e.depth*e.scale.z/a),0==a&&(t.scale.z=1);t.rotation.copy(e.rotation),e.parent.remove(e)}cleanInterval(e){let t="";if(editor.model3D.children.forEach((e=>{let i=e.position;9999==i.x&&9999==i.z&&(t=e)})),!t)return;if(!t.param&&"localPath"==t.imgPath)return;if("Line2"==t.type)return;let i="";i=editor.camera.isOrthographicCamera?editor.get2DModelBy3DModel(t):t,"load"==e?editor.mouseCoverObj=i:this.camera.isOrthographicCamera?this.modelReplaceMain(this.get2DModelBy3DModel(t)):this.modelReplaceMain(t),clearInterval(window.intervalClear)}loadGLTFJsonCore(e,t){let i=e.Products;i[0].location={x:9999,y:9999,z:9999},editor.recoveModel(i),window.intervalClear=setInterval((()=>{this.cleanInterval(t)}),100)}get3DModelPoint(e){let t=[new(0,$4xklQ.Vector3)(0,0,e.depth/2),new(0,$4xklQ.Vector3)(0,0,-e.depth/2),new(0,$4xklQ.Vector3)(-e.width/2,0,0),new(0,$4xklQ.Vector3)(e.width/2,0,0),new(0,$4xklQ.Vector3)(0,e.height/2,0),new(0,$4xklQ.Vector3)(0,-e.height/2,0)];e.updateWorldMatrix(!0,!1);for(let i=0;i<t.length;i++){let r=e.localToWorld(t[i]);t[i]=r}return t}getFinalPoint(e,t){let i=t[0];return t.forEach((t=>{"X"==e&&t.x>i.x&&(i=t),"-X"==e&&t.x<i.x&&(i=t),"Y"==e&&t.z>i.z&&(i=t),"-Y"==e&&t.z<i.z&&(i=t),"Z"==e&&t.y>i.y&&(i=t),"-Z"==e&&t.y<i.y&&(i=t)})),i}modelAlign(e,t){let i=t[0],r=new(0,$4xklQ.Vector3)(0,0,i.depth/2),n=new(0,$4xklQ.Vector3)(0,0,-i.depth/2),o=new(0,$4xklQ.Vector3)(-i.width/2,0,0),a=new(0,$4xklQ.Vector3)(i.width/2,0,0),s=new(0,$4xklQ.Vector3)(0,i.height/2,0),l=new(0,$4xklQ.Vector3)(0,-i.height/2,0);[r,n,o,a,s,l].forEach((e=>{i.localToWorld(e)}));let c=new(0,$4xklQ.Vector2)(r.x,r.z).sub(new(0,$4xklQ.Vector2)(n.x,n.z)).angle(),h="";c>=0&&c<=Math.PI/4||c>1.75*Math.PI&&c<=2*Math.PI?h="X":c>Math.PI/4&&c<=3*Math.PI/4?h="Y":c>3*Math.PI/4&&c<=5*Math.PI/4?h="-X":c>5*Math.PI/4&&c<=1.75*Math.PI&&(h="-Y"),t.shift(),t.forEach((t=>{let c=t,d=this.get3DModelPoint(c),u="",p="",m="",f="";if("frontAligning"==e){u="X"==h||"-X"==h?"X":"Y",m=r;let e={X:"X","-X":"-X",Y:"Y","-Y":"-Y"};f=this.getFinalPoint(e[h],d)}else if("rearAligning"==e){u="X"==h||"-X"==h?"X":"Y",m=n;let e={X:"-X","-X":"X",Y:"-Y","-Y":"Y"};f=this.getFinalPoint(e[h],d)}else if("leftAligning"==e){m=o,u="X"==h||"-X"==h?"Y":"X";let e={X:"-Y","-X":"Y",Y:"-X","-Y":"X"};f=this.getFinalPoint(e[h],d)}else if("rightAligning"==e){m=a,u="X"==h||"-X"==h?"Y":"X";let e={X:"Y","-X":"-Y",Y:"X","-Y":"-X"};f=this.getFinalPoint(e[h],d)}else"topAligning"==e?(u="Z",f=this.getFinalPoint("Z",d),m=s):"bottomAligning"==e?(u="Z",f=this.getFinalPoint("-Z",d),m=l):"frontAndBackAligning"==e?(u="X"==h||"-X"==h?"X":"Y",m=i.position.clone(),f=c.position.clone()):"leftRightAligning"==e?(u="X"==h||"-X"==h?"Y":"X",m=i.position.clone(),f=c.position.clone()):"topBottomAligning"==e&&(u="Z",m=i.position.clone(),f=c.position.clone());c.updateMatrixWorld(!0);let g=new(0,$4xklQ.Vector3);c.getWorldPosition(g),"X"==u?(p=m.x-f.x,g.x+=p):"Y"==u?(p=m.z-f.z,g.z+=p):(p=m.y-f.y,g.y+=p),c.parent.worldToLocal(g),c.position.copy(g),this.synchroModel(c),this.updateModelPosition(c.param[0].parent,c.param[0])})),this.modelHelperGroup.children=[],this.doorHelperGroupClean(),t.push(i),t.forEach((e=>{let t=e,i=this.get2DModelBy3DModel(t);this.addBoxFor2dGroup(i);const r=this.wallHelp.addOBBbox(t,this.config.boxColor);r.name="modelBox",r.layers.set(2),this.modelHelperGroup.add(r)}))}exportModelJson(e){return{meta:{version:"0.1",origin:"",magic:"",unit:"mm"},boundingBox:{xLen:1e3*(e.width*e.scale.x).toFixed(2),yLen:1e3*(e.height*e.scale.y).toFixed(2),zLen:1e3*(e.depth*e.scale.z).toFixed(2)},Products:$9QhXH.DM.getModelJson([e])}}getSceneCenter(){this.cameraScene.children=[];let e=new(0,$4xklQ.Group),t=(new(0,$4xklQ.Matrix4)).makeScale(.001,.001,.001),i=new(0,$4xklQ.Group);i.applyMatrix4(t);let r=new(0,$4xklQ.Group),n=new(0,$4xklQ.Group);n.applyMatrix4(t),e.add(i,r,n),this.wallGroup3D.children.slice(0).forEach((e=>{"3DWall"==e.modelType&&i.add(e.clone())})),i.rotation.x=-Math.PI/2,n.rotation.x=-Math.PI/2,this.model3D.children.slice(0).forEach((e=>{r.add(e.clone())})),this.memberGroup3D.children.slice(0).forEach((e=>{n.add(e.clone())}));const o=(new(0,$4xklQ.Box3)).setFromObject(e);e.position.set(0,0,0);let a=new(0,$4xklQ.Vector3);o.getCenter(a);let s=o.max.x-o.min.x,l=o.max.y-o.min.y,c=o.max.z-o.min.z;return a=new(0,$4xklQ.Vector3)(1*a.x.toFixed(3),1*a.y.toFixed(3),1*a.z.toFixed(3)),[a,s,l,c,o]}rotatePoint(e,t,i){var r=t.x,n=t.y,o=e.x,a=e.y;return{x:r+(o-r)*Math.cos(i*Math.PI/180)-(a-n)*Math.sin(i*Math.PI/180),y:n+(o-r)*Math.sin(i*Math.PI/180)+(a-n)*Math.cos(i*Math.PI/180)}}setCurrentCamera(e){"+"!=e&&"-"!=e&&"*"!=e&&"/"!=e&&(e*=1);let t=900,i=600,r=this.getSceneCenter(),n=r[0],o=this.camera.position.clone();o=new(0,$4xklQ.Vector3)(1*o.x.toFixed(3),1*o.y.toFixed(3),1*o.z.toFixed(3));let a=this.camera.zoom;var s=new $4xklQ.Vector3;this.camera.getWorldDirection(s);let l=10,c=Math.PI/180*15;switch(e){case 1:this.camera.position.set(n.x,n.y,l);break;case 2:case 8:l=o.distanceTo(n);let t=o.clone().sub(n),i=t.clone();i.y=0;let r=t.angleTo(i);n.y>o.y&&(r*=-1),this.camera.oldRotDir&&(r=this.camera.oldRotDir,r<2*-Math.PI&&(r+=2*Math.PI)),this.camera.oldRotDir=r-c;let a=l*Math.sin(r-c);a+=n.y;let s=l*Math.cos(r-c),h=new(0,$4xklQ.Vector2)(n.x,n.z),d=new(0,$4xklQ.Vector2)(o.x,o.z),u=d.clone().sub(h);0==u.x&&0==u.y&&(this.camera.cameraRotDir||(u=d.clone().sub(new(0,$4xklQ.Vector2)(n.x,n.z-10)))),this.camera.cameraRotDir?u=this.camera.cameraRotDir.clone():this.camera.cameraRotDir=u.clone();let p=u.setLength(s);p.x+=n.x,p.y+=n.z,this.camera.position.set(p.x,a,p.y);break;case 3:let m=new(0,$4xklQ.Vector2)(o.x,o.z).sub(new(0,$4xklQ.Vector2)(n.x,n.z)).angle(),f=this.rotatePoint(new(0,$4xklQ.Vector2)(o.x,o.z),new(0,$4xklQ.Vector2)(n.x,n.z),180*-m/Math.PI);this.camera.position.set(f.x,o.y,f.y);break;case 4:let g=this.rotatePoint(new(0,$4xklQ.Vector2)(o.x,o.z),new(0,$4xklQ.Vector2)(n.x,n.z),10);this.camera.position.set(g.x,o.y,g.y);break;case 5:case"*":case"/":break;case 6:let x=this.rotatePoint(new(0,$4xklQ.Vector2)(o.x,o.z),new(0,$4xklQ.Vector2)(n.x,n.z),-10);this.camera.position.set(x.x,o.y,x.y);break;case 7:this.camera.position.set(n.x,l,n.z);break;case 9:let b=this.rotatePoint(new(0,$4xklQ.Vector2)(o.x,o.z),new(0,$4xklQ.Vector2)(n.x,n.z),180);this.camera.position.set(b.x,o.y,b.y);break;case 0:let y=new(0,$4xklQ.Vector2)(n.x,n.z).add(new(0,$4xklQ.Vector2)(1,1).setLength(15));document.querySelector("#cameraShot_box")?(this.camera.position.copy(this.camera.oldPos),this.grid3d.visible=!0):(this.camera.oldPos=this.camera.position.clone(),this.camera.position.set(y.x,n.y+15,y.y),this.grid3d.visible=!1);break;case"+":case"-":let w=.855,v=this.controlsArr[1];v.object.zoom="+"==e?Math.max(v.minZoom,Math.min(v.maxZoom,v.object.zoom/w)):Math.max(v.minZoom,Math.min(v.maxZoom,v.object.zoom*w))}if(this.camera.lookAt(n),this.camera.aspect=window.innerWidth/window.innerHeight,"+"!=e&&"-"!=e&&(this.camera.zoom=a),1==e||3==e||7==e||9==e||0==e){let e=new $0a029741d8f7787c$export$208a41d6b4e37b97({x:o.x,y:o.y,z:o.z});e.onUpdate((e=>{this.camera.position.set(e.x,e.y,e.z)}));let t=this.camera.position.clone(),i=o.distanceTo(t)/.2/3;e.to({x:t.x,y:t.y,z:t.z},10*i).start()}if(this.camera.updateProjectionMatrix(),this.controlsArr[1].target.copy(n),this.controlsArr[1].update(),0==e)if(document.querySelector("#cameraShot_box"))this.list.cameraShot.dispatch(t,i);else{let e=r[4],n=new(0,$4xklQ.Vector3)(e.min.x,0,e.max.z),o=new(0,$4xklQ.Vector3)(e.max.x,0,e.max.z),a=new(0,$4xklQ.Vector3)(e.max.x,0,e.min.z),s=new(0,$4xklQ.Vector3)(e.min.x,0,e.min.z),l=new(0,$4xklQ.Vector3)(e.min.x,r[2],e.max.z),c=new(0,$4xklQ.Vector3)(e.max.x,r[2],e.max.z),h=new(0,$4xklQ.Vector3)(e.max.x,r[2],e.min.z),d=new(0,$4xklQ.Vector3)(e.min.x,r[2],e.min.z),u=[],p=[];[n,o,a,s,l,c,h,d].forEach((e=>{let t=this.getScreen(e,this.camera);u.push(t[0]),p.push(t[1])}));let m=Math.min(...p),f=Math.max(...p),g=Math.min(...u),x=20,b=20;t=Math.max(...u)-g+x,i=f-m+b,this.list.cameraShot.dispatch(t,i,g-x/2,m-b/2)}this.updateDom()}getRenderCameraAngle(){let e=editor.renderViewControl.target.clone().sub(editor.renderViewCamera.position),t=$9HO6e.UtilCore.calculateAngleWithHorizontalPlane(e);if(!isNaN(t))return this.renderViewCamera.position.y<editor.renderViewControl.target.y&&(t*=-1),t>=-5*Math.PI/180&&t<=5*Math.PI/180&&(t=0),Math.round(180*t/Math.PI)}}var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ");const $50d9c80e72e6b8f4$var$_changeEvent={type:"change"},$50d9c80e72e6b8f4$var$_startEvent={type:"start"},$50d9c80e72e6b8f4$var$_endEvent={type:"end"};class $50d9c80e72e6b8f4$export$8ff7788029dfdf52 extends $4xklQ.EventDispatcher{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new(0,$4xklQ.Vector3),this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:$4xklQ.MOUSE.ROTATE,MIDDLE:$4xklQ.MOUSE.DOLLY,RIGHT:$4xklQ.MOUSE.PAN},this.touches={ONE:$4xklQ.TOUCH.ROTATE,TWO:$4xklQ.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",z),this._domElementKeyEvents=e},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent($50d9c80e72e6b8f4$var$_changeEvent),i.update(),n=r.NONE},this.update=function(){const t=new(0,$4xklQ.Vector3),d=(new(0,$4xklQ.Quaternion)).setFromUnitVectors(e.up,new(0,$4xklQ.Vector3)(0,1,0)),u=d.clone().invert(),p=new(0,$4xklQ.Vector3),m=new(0,$4xklQ.Quaternion),f=2*Math.PI;return function(){const e=i.object.position;t.copy(e).sub(i.target),t.applyQuaternion(d),a.setFromVector3(t),i.autoRotate&&n===r.NONE&&M(2*Math.PI/60/60*i.autoRotateSpeed),i.enableDamping?(a.theta+=s.theta*i.dampingFactor,a.phi+=s.phi*i.dampingFactor):(a.theta+=s.theta,a.phi+=s.phi);let g=i.minAzimuthAngle,x=i.maxAzimuthAngle;return isFinite(g)&&isFinite(x)&&(g<-Math.PI?g+=f:g>Math.PI&&(g-=f),x<-Math.PI?x+=f:x>Math.PI&&(x-=f),a.theta=g<=x?Math.max(g,Math.min(x,a.theta)):a.theta>(g+x)/2?Math.max(g,a.theta):Math.min(x,a.theta)),a.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=l,a.radius=Math.max(i.minDistance,Math.min(i.maxDistance,a.radius)),!0===i.enableDamping?i.target.addScaledVector(c,i.dampingFactor):i.target.add(c),t.setFromSpherical(a),t.applyQuaternion(u),e.copy(i.target).add(t),i.object.lookAt(i.target),!0===i.enableDamping?(s.theta*=1-i.dampingFactor,s.phi*=1-i.dampingFactor,c.multiplyScalar(1-i.dampingFactor)):(s.set(0,0,0),c.set(0,0,0)),l=1,!!(h||p.distanceToSquared(i.object.position)>o||8*(1-m.dot(i.object.quaternion))>o)&&(i.dispatchEvent($50d9c80e72e6b8f4$var$_changeEvent),p.copy(i.object.position),m.copy(i.object.quaternion),h=!1,!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",G),i.domElement.removeEventListener("pointerdown",O),i.domElement.removeEventListener("pointercancel",F),i.domElement.removeEventListener("wheel",Q),i.domElement.removeEventListener("pointermove",W),i.domElement.removeEventListener("pointerup",H),null!==i._domElementKeyEvents&&i._domElementKeyEvents.removeEventListener("keydown",z)};const i=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let n=r.NONE;const o=1e-6,a=new(0,$4xklQ.Spherical),s=new(0,$4xklQ.Spherical);let l=1;const c=new(0,$4xklQ.Vector3);let h=!1;const d=new(0,$4xklQ.Vector2),u=new(0,$4xklQ.Vector2),p=new(0,$4xklQ.Vector2),m=new(0,$4xklQ.Vector2),f=new(0,$4xklQ.Vector2),g=new(0,$4xklQ.Vector2),x=new(0,$4xklQ.Vector2),b=new(0,$4xklQ.Vector2),y=new(0,$4xklQ.Vector2),w=[],v={};function $(){return Math.pow(.95,i.zoomSpeed)}function M(e){s.theta-=e}function S(e){s.phi-=e}const P=function(){const e=new(0,$4xklQ.Vector3);return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),c.add(e)}}(),k=function(){const e=new(0,$4xklQ.Vector3);return function(t,r){!0===i.screenSpacePanning?e.setFromMatrixColumn(r,1):(e.setFromMatrixColumn(r,0),e.crossVectors(i.object.up,e)),e.multiplyScalar(t),c.add(e)}}(),_=function(){const e=new(0,$4xklQ.Vector3);return function(t,r){const n=i.domElement;if(i.object.isPerspectiveCamera){const o=i.object.position;e.copy(o).sub(i.target);let a=e.length();a*=Math.tan(i.object.fov/2*Math.PI/180),P(2*t*a/n.clientHeight,i.object.matrix),k(2*r*a/n.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(P(t*(i.object.right-i.object.left)/i.object.zoom/n.clientWidth,i.object.matrix),k(r*(i.object.top-i.object.bottom)/i.object.zoom/n.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function T(e){i.object.isPerspectiveCamera?l/=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*e)),i.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function C(e){i.object.isPerspectiveCamera?l*=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/e)),i.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function A(e){d.set(e.clientX,e.clientY)}function D(e){m.set(e.clientX,e.clientY)}function R(){if(1===w.length)d.set(w[0].pageX,w[0].pageY);else{const e=.5*(w[0].pageX+w[1].pageX),t=.5*(w[0].pageY+w[1].pageY);d.set(e,t)}}function E(){if(1===w.length)m.set(w[0].pageX,w[0].pageY);else{const e=.5*(w[0].pageX+w[1].pageX),t=.5*(w[0].pageY+w[1].pageY);m.set(e,t)}}function L(){const e=w[0].pageX-w[1].pageX,t=w[0].pageY-w[1].pageY,i=Math.sqrt(e*e+t*t);x.set(0,i)}function I(e){if(1==w.length)u.set(e.pageX,e.pageY);else{const t=j(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);u.set(i,r)}p.subVectors(u,d).multiplyScalar(i.rotateSpeed);const t=i.domElement;M(2*Math.PI*p.x/t.clientHeight),S(2*Math.PI*p.y/t.clientHeight),d.copy(u)}function B(e){if(1===w.length)f.set(e.pageX,e.pageY);else{const t=j(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);f.set(i,r)}g.subVectors(f,m).multiplyScalar(i.panSpeed),_(g.x,g.y),m.copy(f)}function V(e){const t=j(e),r=e.pageX-t.x,n=e.pageY-t.y,o=Math.sqrt(r*r+n*n);b.set(0,o),y.set(0,Math.pow(b.y/x.y,i.zoomSpeed)),T(y.y),x.copy(b)}function O(e){!1!==i.enabled&&(0===w.length&&(i.domElement.setPointerCapture(e.pointerId),i.domElement.addEventListener("pointermove",W),i.domElement.addEventListener("pointerup",H)),function(e){w.push(e)}(e),"touch"===e.pointerType?function(e){switch(U(e),w.length){case 1:switch(i.touches.ONE){case $4xklQ.TOUCH.ROTATE:if(!1===i.enableRotate)return;R(),n=r.TOUCH_ROTATE;break;case $4xklQ.TOUCH.PAN:if(!1===i.enablePan)return;E(),n=r.TOUCH_PAN;break;default:n=r.NONE}break;case 2:switch(i.touches.TWO){case $4xklQ.TOUCH.DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;i.enableZoom&&L(),i.enablePan&&E(),n=r.TOUCH_DOLLY_PAN;break;case $4xklQ.TOUCH.DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;i.enableZoom&&L(),i.enableRotate&&R(),n=r.TOUCH_DOLLY_ROTATE;break;default:n=r.NONE}break;default:n=r.NONE}n!==r.NONE&&i.dispatchEvent($50d9c80e72e6b8f4$var$_startEvent)}(e):function(e){let t;switch(e.button){case 0:t=i.mouseButtons.LEFT;break;case 1:t=i.mouseButtons.MIDDLE;break;case 2:t=i.mouseButtons.RIGHT;break;default:t=-1}switch(t){case $4xklQ.MOUSE.DOLLY:if(!1===i.enableZoom)return;!function(e){x.set(e.clientX,e.clientY)}(e),n=r.DOLLY;break;case $4xklQ.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enablePan)return;D(e),n=r.PAN}else{if(!1===i.enableRotate)return;A(e),n=r.ROTATE}break;case $4xklQ.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enableRotate)return;A(e),n=r.ROTATE}else{if(!1===i.enablePan)return;D(e),n=r.PAN}break;default:n=r.NONE}n!==r.NONE&&i.dispatchEvent($50d9c80e72e6b8f4$var$_startEvent)}(e))}function W(e){!1!==i.enabled&&("touch"===e.pointerType?function(e){switch(U(e),n){case r.TOUCH_ROTATE:if(!1===i.enableRotate)return;I(e),i.update();break;case r.TOUCH_PAN:if(!1===i.enablePan)return;B(e),i.update();break;case r.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;!function(e){i.enableZoom&&V(e),i.enablePan&&B(e)}(e),i.update();break;case r.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;!function(e){i.enableZoom&&V(e),i.enableRotate&&I(e)}(e),i.update();break;default:n=r.NONE}}(e):function(e){switch(n){case r.ROTATE:if(!1===i.enableRotate)return;!function(e){u.set(e.clientX,e.clientY),p.subVectors(u,d).multiplyScalar(i.rotateSpeed);const t=i.domElement;M(2*Math.PI*p.x/t.clientHeight),S(2*Math.PI*p.y/t.clientHeight),d.copy(u),i.update()}(e);break;case r.DOLLY:if(!1===i.enableZoom)return;!function(e){b.set(e.clientX,e.clientY),y.subVectors(b,x),y.y>0?T($()):y.y<0&&C($()),x.copy(b),i.update()}(e);break;case r.PAN:if(!1===i.enablePan)return;!function(e){f.set(e.clientX,e.clientY),g.subVectors(f,m).multiplyScalar(i.panSpeed),_(g.x,g.y),m.copy(f),i.update()}(e)}}(e))}function H(e){N(e),0===w.length&&(i.domElement.releasePointerCapture(e.pointerId),i.domElement.removeEventListener("pointermove",W),i.domElement.removeEventListener("pointerup",H)),i.dispatchEvent($50d9c80e72e6b8f4$var$_endEvent),n=r.NONE}function F(e){N(e)}function Q(e){!1!==i.enabled&&!1!==i.enableZoom&&n===r.NONE&&(e.preventDefault(),i.dispatchEvent($50d9c80e72e6b8f4$var$_startEvent),function(e){e.deltaY<0?C($()):e.deltaY>0&&T($()),i.update()}(e),i.dispatchEvent($50d9c80e72e6b8f4$var$_endEvent))}function z(e){!1!==i.enabled&&!1!==i.enablePan&&function(e){let t=!1;switch(e.code){case i.keys.UP:_(0,i.keyPanSpeed),t=!0;break;case i.keys.BOTTOM:_(0,-i.keyPanSpeed),t=!0;break;case i.keys.LEFT:_(i.keyPanSpeed,0),t=!0;break;case i.keys.RIGHT:_(-i.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),i.update())}(e)}function G(e){!1!==i.enabled&&e.preventDefault()}function N(e){delete v[e.pointerId];for(let t=0;t<w.length;t++)if(w[t].pointerId==e.pointerId)return void w.splice(t,1)}function U(e){let t=v[e.pointerId];void 0===t&&(t=new(0,$4xklQ.Vector2),v[e.pointerId]=t),t.set(e.pageX,e.pageY)}function j(e){const t=e.pointerId===w[0].pointerId?w[1]:w[0];return v[t.pointerId]}i.domElement.addEventListener("contextmenu",G),i.domElement.addEventListener("pointerdown",O),i.domElement.addEventListener("pointercancel",F),i.domElement.addEventListener("wheel",Q,{passive:!1}),this.update()}}class $50d9c80e72e6b8f4$export$7628ccdac312035f extends $50d9c80e72e6b8f4$export$8ff7788029dfdf52{constructor(e,t){super(e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=$4xklQ.MOUSE.PAN,this.mouseButtons.RIGHT=$4xklQ.MOUSE.ROTATE,this.touches.ONE=$4xklQ.TOUCH.PAN,this.touches.TWO=$4xklQ.TOUCH.DOLLY_ROTATE}}var $4xklQ=parcelRequire("4xklQ");const $8d1fbad8232a9667$var$_plane=new(0,$4xklQ.Plane),$8d1fbad8232a9667$var$_raycaster=new(0,$4xklQ.Raycaster),$8d1fbad8232a9667$var$_pointer=new(0,$4xklQ.Vector2),$8d1fbad8232a9667$var$_offset=new(0,$4xklQ.Vector3),$8d1fbad8232a9667$var$_intersection=new(0,$4xklQ.Vector3),$8d1fbad8232a9667$var$_worldPosition=new(0,$4xklQ.Vector3),$8d1fbad8232a9667$var$_inverseMatrix=new(0,$4xklQ.Matrix4);class $8d1fbad8232a9667$export$350d0cf1f91b53f4 extends $4xklQ.EventDispatcher{constructor(e,t,i){super(),i.style.touchAction="none";let r=null,n=null;const o=[],a=this;function s(){i.addEventListener("pointermove",c),i.addEventListener("pointerdown",h),i.addEventListener("pointerup",d),i.addEventListener("pointerleave",d)}function l(){i.removeEventListener("pointermove",c),i.removeEventListener("pointerdown",h),i.removeEventListener("pointerup",d),i.removeEventListener("pointerleave",d),i.style.cursor=""}function c(s){if(!1!==a.enabled){if(u(s),$8d1fbad8232a9667$var$_raycaster.setFromCamera($8d1fbad8232a9667$var$_pointer,t),r)return $8d1fbad8232a9667$var$_raycaster.ray.intersectPlane($8d1fbad8232a9667$var$_plane,$8d1fbad8232a9667$var$_intersection)&&r.position.copy($8d1fbad8232a9667$var$_intersection.sub($8d1fbad8232a9667$var$_offset).applyMatrix4($8d1fbad8232a9667$var$_inverseMatrix)),void a.dispatchEvent({type:"drag",object:r});if("mouse"===s.pointerType||"pen"===s.pointerType)if(o.length=0,$8d1fbad8232a9667$var$_raycaster.setFromCamera($8d1fbad8232a9667$var$_pointer,t),$8d1fbad8232a9667$var$_raycaster.intersectObjects(e,!0,o),o.length>0){const e=o[0].object;$8d1fbad8232a9667$var$_plane.setFromNormalAndCoplanarPoint(t.getWorldDirection($8d1fbad8232a9667$var$_plane.normal),$8d1fbad8232a9667$var$_worldPosition.setFromMatrixPosition(e.matrixWorld)),n!==e&&null!==n&&(a.dispatchEvent({type:"hoveroff",object:n}),i.style.cursor="auto",n=null),n!==e&&(a.dispatchEvent({type:"hoveron",object:e}),i.style.cursor="pointer",n=e)}else null!==n&&(a.dispatchEvent({type:"hoveroff",object:n}),i.style.cursor="auto",n=null)}}function h(n){!1!==a.enabled&&(u(n),o.length=0,$8d1fbad8232a9667$var$_raycaster.setFromCamera($8d1fbad8232a9667$var$_pointer,t),$8d1fbad8232a9667$var$_raycaster.intersectObjects(e,!0,o),o.length>0&&(r=!0===a.transformGroup?e[0]:o[0].object,$8d1fbad8232a9667$var$_plane.setFromNormalAndCoplanarPoint(t.getWorldDirection($8d1fbad8232a9667$var$_plane.normal),$8d1fbad8232a9667$var$_worldPosition.setFromMatrixPosition(r.matrixWorld)),$8d1fbad8232a9667$var$_raycaster.ray.intersectPlane($8d1fbad8232a9667$var$_plane,$8d1fbad8232a9667$var$_intersection)&&($8d1fbad8232a9667$var$_inverseMatrix.copy(r.parent.matrixWorld).invert(),$8d1fbad8232a9667$var$_offset.copy($8d1fbad8232a9667$var$_intersection).sub($8d1fbad8232a9667$var$_worldPosition.setFromMatrixPosition(r.matrixWorld))),i.style.cursor="move",a.dispatchEvent({type:"dragstart",object:r})))}function d(){!1!==a.enabled&&(r&&(a.dispatchEvent({type:"dragend",object:r}),r=null),i.style.cursor=n?"pointer":"auto")}function u(e){const t=i.getBoundingClientRect();$8d1fbad8232a9667$var$_pointer.x=(e.clientX-t.left)/t.width*2-1,$8d1fbad8232a9667$var$_pointer.y=-(e.clientY-t.top)/t.height*2+1}s(),this.enabled=!0,this.transformGroup=!1,this.activate=s,this.deactivate=l,this.dispose=function(){l()},this.getObjects=function(){return e},this.getRaycaster=function(){return $8d1fbad8232a9667$var$_raycaster}}}parcelRequire("9HO6e");class $9b1db6660d92c803$export$fd171b37577d7494{static toolType="free";static dom="";constructor(e){this.editor=e,this.uiPanelBox="",this.scene="",this.camera="",this.renderer="",this.raycaster="",this.floor="",this.startPoint="",this.endPoint="",this.currenDraw="",this.helperGroup=new(0,$4xklQ.Group),this.labelRenderer="",this.chooseColor=new(0,$4xklQ.Color)("#4169E1"),this.cancelChooseColor=new(0,$4xklQ.Color)("#363636"),this.allMesh=[],this.allDrapMesh=[],this.curentChoose="",this.currentPoint="",this.downPoint=""}sceneInit(e){$9b1db6660d92c803$export$fd171b37577d7494.dom=e,this.uiPanelBox=new $2a0c8f99fe7360a8$export$ab8ce44154d5decc,this.uiPanelBox.setWidth(window.innerWidth+"px"),this.uiPanelBox.setHeight(window.innerHeight+"px"),this.scene=new(0,$4xklQ.Scene),this.scene.background=new(0,$4xklQ.Color)("#FFFFFF"),this.raycaster=new(0,$4xklQ.Raycaster),this.camera=new(0,$4xklQ.PerspectiveCamera)(70,window.innerWidth/window.innerHeight,1,1e4),this.camera.position.set(0,0,1e4),this.camera.lookAt(this.scene.position);const t=new(0,$4xklQ.PlaneGeometry)(2e5,2e5),i=new(0,$4xklQ.MeshStandardMaterial)({color:16777215,roughness:1,metalness:0});this.floor=new(0,$4xklQ.Mesh)(t,i),this.floor.material.opacity=0,this.floor.material.transparent=!0,this.scene.add(this.floor);const r=new(0,$4xklQ.GridHelper)(2e5,400,255,1118481);r.material.opacity=.5,r.material.transparent=!0,r.rotation.x=-Math.PI/2,this.scene.add(r),this.scene.add(new(0,$4xklQ.HemisphereLight)(8947831,7829384));const n=new(0,$4xklQ.DirectionalLight)(16777215);n.position.set(0,6,0),this.scene.add(n);let o=new $50d9c80e72e6b8f4$export$8ff7788029dfdf52(this.camera,e);o.target.set(0,0,0),o.enableRotate=!1,o.minDistance=100,o.maxDistance=1e4,o.update(),this.renderer=new(0,$4xklQ.WebGLRenderer)({antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.xr.enabled=!0,this.renderer.outputEncoding=$4xklQ.sRGBEncoding,e.appendChild(this.renderer.domElement),e.parentNode.appendChild(this.uiPanelBox.dom),this.scene.add(this.helperGroup);let a=new $8d1fbad8232a9667$export$350d0cf1f91b53f4(this.allDrapMesh,this.camera,e);return a.transformGroup=!0,a.addEventListener("drag",this.dragging.bind(this)),window.addEventListener("resize",this.onWindowResize),e.addEventListener("mousemove",this.mouseMove.bind(this)),e.addEventListener("mousedown",this.mouseDown.bind(this)),e.addEventListener("click",this.mouseClick.bind(this)),e.addEventListener("touchstart",this.onTouchStart.bind(this)),e.addEventListener("touchend",this.onTouchEnd.bind(this)),document.onkeydown=function(e){switch(27==window.event.keyCode&&($9b1db6660d92c803$export$fd171b37577d7494.toolType="free",this.editor.list.startPlayer.dispatch(),this.startPoint="",""!=this.currenDraw&&this.removeMesh(this.currenDraw),this.removeInputByClassName(this.uiPanelBox.dom,"moveInput"),this.removeInputByClassName(this.uiPanelBox.dom,"moveInput"),this.currenDraw),e.key.toLowerCase()){case"backspace":e.preventDefault();case"delete":const t=this.editor.selected;if(null===t)return;null!==t.parent&&this.editor.execute(new RemoveObjectCommand(this.editor,t));break;case this.editor.config.getKey("settings/shortcuts/translate"):signals.transformModeChanged.dispatch("translate");break;case this.editor.config.getKey("settings/shortcuts/rotate"):signals.transformModeChanged.dispatch("rotate");break;case this.editor.config.getKey("settings/shortcuts/scale"):signals.transformModeChanged.dispatch("scale");break;case this.editor.config.getKey("settings/shortcuts/undo"):(this.editor.config.IS_MAC?e.metaKey:e.ctrlKey)&&(e.preventDefault(),this.editor.undo());break;case this.editor.config.getKey("settings/shortcuts/redo"):(this.editor.config.IS_MAC?e.metaKey:e.ctrlKey)&&(e.preventDefault(),this.editor.redo());break;case this.editor.config.getKey("settings/shortcuts/focus"):null!==this.editor.selected&&this.editor.focus(this.editor.selected)}}.bind(this),this}clearScene(e){for(var t=e.lastElementChild;t;)e.removeChild(t),t=e.lastElementChild}onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}dragging(e){if("controlPoint"==e.object.useType){let e=this.curentChoose.startPoint,t=this.curentChoose.endPoint,i=this.currentPoint;this.removeMesh(this.curentChoose);let r=(new $523a84362d27c3e8$export$b680ca477a72be07).createCurveWall(e,t,i),n=(new $d0f874000594cf7a$export$a955f3d6a39ce4b2).createCurveHelp(e,t,r.controlPoint);this.allDrapMesh[0]=n.controlMesh,this.addMesh(r),n.wallId=r.id,this.helperGroup.add(n),this.curentChoose=r}}mouseDown(e){this.downPoint=this.getWorldPosition(e)}mouseMove(e){let t=new(0,$4xklQ.Vector3)(0,0,0);t.x=e.clientX/window.innerWidth*2-1,t.y=-e.clientY/window.innerHeight*2+1;let i=this.getWorldPosition(e);if(this.currentPoint=i,"free"!=$9b1db6660d92c803$export$fd171b37577d7494.toolType){if(!this.startPoint)return;if(""!=this.currenDraw&&this.removeMesh(this.currenDraw),this.editor.list.stopPlayer.dispatch(),"wall"==$9b1db6660d92c803$export$fd171b37577d7494.toolType){this.currenDraw=(new $523a84362d27c3e8$export$b680ca477a72be07).createLineWall(this.startPoint,i);let e=(new $d0f874000594cf7a$export$a955f3d6a39ce4b2).drawWallHelp(this.startPoint,i);e.wallId=this.currenDraw.id,this.removeInputByClassName(this.uiPanelBox.dom,"moveInput");let t=this.getScreenPosition(e.arcCenter.clone()),r=new $2a0c8f99fe7360a8$export$ab52802de2137ca0(e.realAngle).setClass("moveInput").setFontSize("15px").setWidth("40px").setMarginTop(t.y+"px").setMarginLeft(t.x+"px"),n=this.getScreenPosition(e.lineCenter.clone()),o=new $2a0c8f99fe7360a8$export$ab52802de2137ca0(e.lineLength).setClass("moveInput").setFontSize("15px").setWidth("40px").setMarginTop(n.y+"px").setMarginLeft(n.x+"px");this.uiPanelBox.add(r),this.uiPanelBox.add(o),this.scene.add(this.currenDraw),this.helperGroup.add(e)}else"room"==$9b1db6660d92c803$export$fd171b37577d7494.toolType&&(this.currenDraw=(new $523a84362d27c3e8$export$43cb61aa07eebcbc).createRoom(this.startPoint,i),this.scene.add(this.currenDraw))}else{this.raycaster.setFromCamera(t,this.camera);for(let e=0;e<this.allMesh.length;e++)"wall"==this.allMesh[e].useType&&this.allMesh[e]!=this.curentChoose&&(this.allMesh[e].material.color=this.cancelChooseColor);$9b1db6660d92c803$export$fd171b37577d7494.dom.style.cursor="default";var r=this.raycaster.intersectObjects(this.allMesh);r.length>0&&"wall"==r[0].object.useType&&(r[0].object.material.color=this.chooseColor,$9b1db6660d92c803$export$fd171b37577d7494.dom.style.cursor="move")}}mouseClick(e){let t=this.getWorldPosition(e);if("free"!=$9b1db6660d92c803$export$fd171b37577d7494.toolType)this.startPoint?(this.endPoint=t,this.editor.list.startPlayer.dispatch(),"wall"==$9b1db6660d92c803$export$fd171b37577d7494.toolType?(this.currenDraw.material.color=this.cancelChooseColor,this.allMesh.push(this.currenDraw),this.removeInputByClassName(this.uiPanelBox.dom,"moveInput"),this.removeInputByClassName(this.uiPanelBox.dom,"moveInput"),this.removeMesh(this.currenDraw),this.editor.execute(new $523a84362d27c3e8$export$b680ca477a72be07(this.editor,this.currenDraw),"画墙"),this.startPoint=t):"room"==$9b1db6660d92c803$export$fd171b37577d7494.toolType&&(this.removeMesh(this.currenDraw),this.editor.execute(new $523a84362d27c3e8$export$43cb61aa07eebcbc(this.editor,this.currenDraw),"画房间"),this.startPoint=""),this.currenDraw=""):this.startPoint=t;else{let r=new(0,$4xklQ.Vector3)(0,0,0);r.x=e.clientX/window.innerWidth*2-1,r.y=-e.clientY/window.innerHeight*2+1,this.raycaster.setFromCamera(r,this.camera),$9b1db6660d92c803$export$fd171b37577d7494.dom.style.cursor="default";var i=this.raycaster.intersectObjects(this.allMesh);if(i.length>0){if("wall"==i[0].object.useType){i[0].object.material.color=this.chooseColor;let e=i[0].object.startPoint,t=i[0].object.endPoint;this.removeMesh(i[0].object),this.removeInputByClassName(this.uiPanelBox.dom,"showWallLength"+i[0].object.uuid);let r="";if(this.curentChoose){this.curentChoose.material.color=this.cancelChooseColor;for(let e=0;e<this.curentChoose.children.length;e++)"arcHelper"==this.curentChoose.children[e].useType&&this.curentChoose.remove(this.curentChoose.children[e])}if("lineWall"==i[0].object.wallType){r=(new $523a84362d27c3e8$export$b680ca477a72be07).createCurveWall(e,t);let i=(new $d0f874000594cf7a$export$a955f3d6a39ce4b2).createCurveHelp(e,t,r.controlPoint);this.allDrapMesh[0]=i.controlMesh,this.addMesh(r),i.wallId=r.id,this.helperGroup.add(i)}else{r=(new $523a84362d27c3e8$export$b680ca477a72be07).createLineWall(e,t,!1);let i=(new $d0f874000594cf7a$export$a955f3d6a39ce4b2).createLineDimensionsLine(e,t,!1),n=this.getScreenPosition(i.center.clone()),o=new $2a0c8f99fe7360a8$export$3dc21c16dab61cf7(i.lineLength).setClass("showWallLength"+r.uuid).setFontSize("15px").setWidth("20px").setMarginTop(n.y+"px").setMarginLeft(n.x+"px");this.uiPanelBox.add(o),i.wallId=r.id,this.helperGroup.add(i),this.addMesh(r)}r.material.color=this.chooseColor,this.curentChoose=r}}else{let e=this.downPoint.clone().distanceTo(t.clone());this.curentChoose&&"wall"==this.curentChoose.useType&&e<5&&(this.curentChoose.material.color=this.cancelChooseColor,this.removeHelperByWallId(this.curentChoose.id),this.curentChoose="")}}}onTouchStart(e){}onTouchEnd(e){}removeHelperByWallId(e){let t=this.helperGroup.children;for(let i=0;i<t.length;i++)t[i].wallId&&t[i].wallId==e&&this.helperGroup.remove(t[i])}createLastWall(e){let t=(new $d0f874000594cf7a$export$a955f3d6a39ce4b2).createLineDimensionsLine(e.startPoint,e.endPoint,!1),i=this.getScreenPosition(t.center.clone()),r=new $2a0c8f99fe7360a8$export$3dc21c16dab61cf7(t.lineLength).setClass("showWallLength"+e.uuid).setFontSize("15px").setWidth("20px").setMarginTop(i.y+"px").setMarginLeft(i.x+"px");this.uiPanelBox.add(r),t.wallId=e.id,this.helperGroup.add(t),this.scene.add(e)}createRoom(e){this.scene.add(e)}removeMesh(e){this.allMesh.indexOf(e)>=0&&this.allMesh.splice(this.allMesh.indexOf(e),1),this.removeHelperByWallId(e.id),this.scene.remove(e),this.removeInputByClassName(this.uiPanelBox.dom,"showWallLength"+e.uuid)}addMesh(e){this.allMesh.push(e),this.scene.add(e)}removeInputByClassName(e,t){let i=e.children;for(let r=0;r<i.length;r++)i[r].className==t&&e.removeChild(i[r])}getWorldPosition(e){let t=new(0,$4xklQ.Vector3)(0,0,0);t.x=e.clientX/window.innerWidth*2-1,t.y=-e.clientY/window.innerHeight*2+1,this.raycaster.setFromCamera(t,this.camera);var i=this.raycaster.intersectObjects([this.floor]);let r=new(0,$4xklQ.Vector3)(0,0,0);return i.length>0&&(r=i[0].point),r}getScreenPosition(e){e=e.project(this.camera);let t=window.innerWidth/2,i=window.innerHeight/2;return{x:Math.round(e.x*t+t)-22,y:Math.round(-e.y*i+i)-10}}getModelVertex(e){e.updateWorldMatrix(!0,!1);let t=e.geometry.attributes.position.array,i=new(0,$4xklQ.Vector3)(t[0],t[1],0),r=new(0,$4xklQ.Vector3)(t[6],t[7],0),n=new(0,$4xklQ.Vector3)(t[9],t[10],0),o=new(0,$4xklQ.Vector3)(t[3],t[4],0),a=[i,r,n,o,new(0,$4xklQ.Vector3)((i.x+r.x)/2,(i.y+r.y)/2,0),new(0,$4xklQ.Vector3)((r.x+n.x)/2,(r.y+n.y)/2,0),new(0,$4xklQ.Vector3)((i.x+o.x)/2,(i.y+o.y)/2,0),new(0,$4xklQ.Vector3)((o.x+n.x)/2,(o.y+n.y)/2,0)];for(let t=0;t<a.length;t++)a[t]=e.localToWorld(a[t]);return a}animate(){this.renderer.setAnimationLoop(this.render.bind(this))}render(){this.renderer.render(this.scene,this.camera)}}class $3fdc31d914635d41$export$84202caead5689ba{constructor(e){this.editor=e,this.undos=[],this.undosJson=[],this.redos=[],this.redosJson=[],this.lastCmdTime=new Date,this.idCounter=0,this.historyDisabled=!1,this.config=e.config;const t=this;this.editor.list.startPlayer.add((function(){t.historyDisabled=!1})),this.editor.list.stopPlayer.add((function(){t.historyDisabled=!0}))}execute(e,t,i=""){const r=this.undos[this.undos.length-1],n=(new Date).getTime()-this.lastCmdTime.getTime(),o=r&&r.updatable&&e.updatable&&r.object===e.object&&r.type===e.type&&r.script===e.script&&r.attributeName===e.attributeName;o&&"SetScriptValueCommand"===e.type||o&&n<500?(r.update(e),e=r):(this.undos.push(e),0!=this.editor.statusJson.length?this.undosJson.push(JSON.stringify(this.editor.statusJson)):""!=i?this.undosJson.push(JSON.stringify(i)):this.undosJson.push(JSON.stringify(this.editor.getSceneAllJson())),""!=e&&(e.id=++this.idCounter)),""!=e&&(e.name=void 0!==t?t:e.name,e.execute(),e.inMemory=!0,this.config.getKey("settings/history")&&(e.json=e.toJSON())),this.lastCmdTime=new Date,this.redos=[],this.redosJson=[]}undo(){if(this.historyDisabled)return;let e,t="";return this.undos.length>0&&(e=this.undos.pop(),t=this.undosJson.pop(),!1===e.inMemory&&e.fromJSON(e.json)),void 0===e&&""!=e||(this.redosJson.push(JSON.stringify(this.editor.getSceneAllJson())),""==e?(this.editor.cacheJson=t,this.editor.readCache(t)):e.undo(t),this.redos.push(e)),e}redo(){if(this.historyDisabled)return;let e,t="";return this.redos.length>0&&(e=this.redos.pop(),t=this.redosJson.pop(),!1===e.inMemory&&e.fromJSON(e.json)),void 0===e&&""!=e||(this.undosJson.push(JSON.stringify(this.editor.getSceneAllJson())),""==e?(this.editor.cacheJson=t,this.editor.readCache(t)):e.redo(t),this.undos.push(e)),e}}var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ");class $8b391c7d7cfc95c8$export$29cd7b75162a9425{constructor(){if(this.name="threejs-editor",this.centerArea=240,this.pointArea=240,this.drawDoorArea=500,this.doorWidth=750,this.angleToolChooseColor=new(0,$4xklQ.Color)("rgb(26,122,248)"),this.angleToolUnChooseColor=new(0,$4xklQ.Color)("rgb(153,193,244)"),this.drawDotMaterial=new(0,$4xklQ.LineDashedMaterial)({color:0,depthTest:!1,dashSize:3,gapSize:3}),this.dotMaterial=new(0,$4xklQ.LineDashedMaterial)({color:0,depthTest:!1,dashSize:30,gapSize:10}),this.boxColor="#396EFE",this.circleRadio=1500,this.boxLineWidth=3,this.boxLineColor=this.boxColor,this.wallNum=4,this.wallFirstMaterial=new(0,$4xklQ.MeshBasicMaterial)({color:"#2D61A4",side:$4xklQ.DoubleSide,transparent:!0,opacity:.8}),window.roomOpacity=.8,window.storeyHei=2800,window.floorDep=0,this.maxWidth=10,this.remoteUrl="https://rjhcdn.bsphpro.com/ocean/upload_data/uploads/",this.remoteCacheUrl="https://dev.rjhapi.bsphpro.com/ocean/upload",this.storage={language:"en",autosave:!0,"project/title":"","project/editable":!1,"project/vr":!1,"project/renderer/antialias":!0,"project/renderer/shadows":!0,"project/renderer/shadowType":1,"project/renderer/physicallyCorrectLights":!1,"project/renderer/toneMapping":0,"project/renderer/toneMappingExposure":1,"settings/history":!1,"settings/shortcuts/translate":"w","settings/shortcuts/rotate":"e","settings/shortcuts/scale":"r","settings/shortcuts/undo":"z","settings/shortcuts/redo":"y","settings/shortcuts/focus":"f"},this.IS_MAC=navigator.platform.toUpperCase().indexOf("MAC")>=0,void 0===window.localStorage[this.name])window.localStorage[this.name]=JSON.stringify(this.storage);else{const e=JSON.parse(window.localStorage[this.name]);for(const t in e)this.storage[t]=e[t]}this.toolTypeConfig={doubledoor:"doubledoor",door:"door",slidingdoor:"slidingdoor",window:"window",straightBayWindow:"baywindow",frenchwindows:"frenchwindows",doubledoor:"singleDoubleDoor",childMotherDoor:"childMotherDoor",passDoor:"pass",straightBayWindow:"straightBayWindow",LWindow:"LWindow",LBayWindow:"",UWindow:"UWindow",UBayWindow:"",dooropen:"dooropen",archDoor:"archDoor",archWindow:"archWindow",arcDoor:"",arcWindow:"arcWindow",beam:"bridge",pillars:"post",flue:"flue"},this.settingJson={roomName:!0,roomArea:!0,dimension:!0,showMember:!0,showFloorFurniture:!0,showWallFurniture:!0,showCeilFurniture:!0,showKitchen:!0,showAllHouseFurniture:!0},this.modelTypeJson={doubledoor:"双开门",door:"单开门",slidingdoor:"移门",window:"窗",straightBayWindow:"飘窗",frenchwindows:"落地窗",childMotherDoor:"字母门",passDoor:"垭口",LWindow:"L型窗",UWindow:"U型窗",dooropen:"门洞",archDoor:"拱形门",archWindow:"拱形窗",arcWindow:"弧形窗"};let e=Date.now();this.settingJsonCopy=JSON.parse(JSON.stringify(this.settingJson)),this.baseDoorFrame=(new(0,$4xklQ.TextureLoader)).load(window.url+"/assets/images/material/frame.jpg?"+e),this.baseDoorFace=(new(0,$4xklQ.TextureLoader)).load(window.url+"/assets/images/material/doorFace.jpg?"+e),this.slidingDoorframe=(new(0,$4xklQ.TextureLoader)).load(window.url+"/assets/images/material/sliddoorframe.jpg?"+e),this.slidingDoorFace=(new(0,$4xklQ.TextureLoader)).load(window.url+"/assets/images/material/sliddoorFace.jpg?"+e),this.lashDoorPartition=(new(0,$4xklQ.TextureLoader)).load(window.url+"/assets/images/material/zimudoorcrack.jpg?"+e),this.baseWindowFrame=(new(0,$4xklQ.TextureLoader)).load(window.url+"/assets/images/material/windowframe.jpg?"+e),this.baseWindowFace=(new(0,$4xklQ.TextureLoader)).load(window.url+"/assets/images/material/windowFace.jpg?"+e),this.passMeshTexture=(new(0,$4xklQ.TextureLoader)).load(window.url+"/assets/images/material/material01.jpg?"+e),this.sectorDoorTexture=(new(0,$4xklQ.TextureLoader)).load(window.url+"/assets/images/material/material02.jpg?"+e),this.marbleTexture=(new(0,$4xklQ.TextureLoader)).load(window.url+"/assets/images/material/marble.jpg?"+e),this.uvGridTexture=(new(0,$4xklQ.TextureLoader)).load(window.url+"/assets/images/banner/uvGrid.jpg?"+e),this.floorTexture=(new(0,$4xklQ.TextureLoader)).load(window.url+"/assets/images/banner/floor.jpg?"+e)}getKey(e){return this.storage[e]}setKey(){for(let e=0,t=arguments.length;e<t;e+=2)storage[arguments[e]]=arguments[e+1];window.localStorage[name]=JSON.stringify(storage)}clear(){delete window.localStorage[name]}}var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ"),$ba6ad40603587d6b$export$a33e02b86664bfb2={inTouch:!1,rd:!1,md:!1,inZoom:!1,firstPosition:new $4xklQ.Vector2(0,0),disVec2:0,disVec2_first:0,XcountOffset:0,YcountOffset:0,ZcountOffset:0,ctrlCamera:"",Init:function(e){e.removeEventListener("mousedown",$ba6ad40603587d6b$export$a33e02b86664bfb2.OnForbidden,!1),e.removeEventListener("mouseup",$ba6ad40603587d6b$export$a33e02b86664bfb2.OnForbidden,!1),e.removeEventListener("mousemove",$ba6ad40603587d6b$export$a33e02b86664bfb2.OnForbidden,!1),e.removeEventListener("mouseout",$ba6ad40603587d6b$export$a33e02b86664bfb2.OnForbidden,!1),e.removeEventListener("mousewheel",$ba6ad40603587d6b$export$a33e02b86664bfb2.OnForbidden,!1),e.removeEventListener("touchstart",$ba6ad40603587d6b$export$a33e02b86664bfb2.OnForbidden,!1),e.removeEventListener("touchmove",$ba6ad40603587d6b$export$a33e02b86664bfb2.OnForbidden,!1),e.removeEventListener("touchend",$ba6ad40603587d6b$export$a33e02b86664bfb2.OnForbidden,!1),e.addEventListener("mousedown",$ba6ad40603587d6b$export$a33e02b86664bfb2.onCanvasMouseDown,!1),e.addEventListener("mouseup",$ba6ad40603587d6b$export$a33e02b86664bfb2.onCanvasMouseUp,!1),e.addEventListener("mousemove",$ba6ad40603587d6b$export$a33e02b86664bfb2.onCanvasMouseMove,!1),e.addEventListener("mouseout",$ba6ad40603587d6b$export$a33e02b86664bfb2.onCanvasMouseOut,!1),e.addEventListener("mousewheel",$ba6ad40603587d6b$export$a33e02b86664bfb2.OnMousewheel,!1),e.addEventListener("touchstart",$ba6ad40603587d6b$export$a33e02b86664bfb2.OnTouchStart,!1),e.addEventListener("touchmove",$ba6ad40603587d6b$export$a33e02b86664bfb2.OnTouchMove,!1),e.addEventListener("touchend",$ba6ad40603587d6b$export$a33e02b86664bfb2.OnTouchEnd,!1),e.addEventListener("contextmenu",$ba6ad40603587d6b$export$a33e02b86664bfb2.oncontextmenu.bind(this),!0)},oncontextmenu:function(e){e.preventDefault(),$ba6ad40603587d6b$export$a33e02b86664bfb2.rd=!1},SetCtrlCamera:function(e){$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera=e},OnMousewheel:function(e){e.preventDefault(),$ba6ad40603587d6b$export$a33e02b86664bfb2.ZcountOffset+=.1*-e.wheelDelta,$ba6ad40603587d6b$export$a33e02b86664bfb2.UpdateCamera()},OnForbidden:function(e){e.preventDefault()},onCanvasMouseDown:function(e){e.preventDefault(),$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera&&(2==e.button&&($ba6ad40603587d6b$export$a33e02b86664bfb2.rd=!0),1==e.button&&($ba6ad40603587d6b$export$a33e02b86664bfb2.md=!0),$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.countXBegin=57.3*$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.cameraRotX.rotation.x,$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.countYBegin=57.3*$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.cameraRotY.rotation.y,$ba6ad40603587d6b$export$a33e02b86664bfb2.XcountOffset=0,$ba6ad40603587d6b$export$a33e02b86664bfb2.YcountOffset=0,$ba6ad40603587d6b$export$a33e02b86664bfb2.firstPosition=new $4xklQ.Vector2(e.clientX,e.clientY),$ba6ad40603587d6b$export$a33e02b86664bfb2.inTouch=!0,$ba6ad40603587d6b$export$a33e02b86664bfb2.UpdateCamera())},onCanvasMouseUp:function(e){e.preventDefault(),$ba6ad40603587d6b$export$a33e02b86664bfb2.inTouch=!1,$ba6ad40603587d6b$export$a33e02b86664bfb2.md=!1,$ba6ad40603587d6b$export$a33e02b86664bfb2.UpdateCamera()},onCanvasMouseMove:function(e){e.preventDefault(),$ba6ad40603587d6b$export$a33e02b86664bfb2.inTouch&&($ba6ad40603587d6b$export$a33e02b86664bfb2.XcountOffset=$ba6ad40603587d6b$export$a33e02b86664bfb2.firstPosition.x-e.clientX,$ba6ad40603587d6b$export$a33e02b86664bfb2.YcountOffset=$ba6ad40603587d6b$export$a33e02b86664bfb2.firstPosition.y-e.clientY),$ba6ad40603587d6b$export$a33e02b86664bfb2.UpdateCamera()},onCanvasMouseOut:function(e){$ba6ad40603587d6b$export$a33e02b86664bfb2.UpdateCamera()},OnTouchStart:function(e){e.preventDefault(),$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera&&($ba6ad40603587d6b$export$a33e02b86664bfb2.inTouch=!0,$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.countXBegin=57.3*$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.cameraRotX.rotation.x,$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.countYBegin=57.3*$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.cameraRotY.rotation.y,2==e.targetTouches.length?($ba6ad40603587d6b$export$a33e02b86664bfb2.ZcountOffset=0,$ba6ad40603587d6b$export$a33e02b86664bfb2.disVec2=new $4xklQ.Vector2(e.targetTouches[0].clientX-e.targetTouches[1].clientX,e.targetTouches[0].clientY-e.targetTouches[1].clientY),$ba6ad40603587d6b$export$a33e02b86664bfb2.disVec2_first=$ba6ad40603587d6b$export$a33e02b86664bfb2.disVec2.length(),$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.countZBegin=$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.Zcount):$ba6ad40603587d6b$export$a33e02b86664bfb2.inZoom=!1,$ba6ad40603587d6b$export$a33e02b86664bfb2.XcountOffset=0,$ba6ad40603587d6b$export$a33e02b86664bfb2.YcountOffset=0,$ba6ad40603587d6b$export$a33e02b86664bfb2.firstPosition.x=e.targetTouches[0].clientX,$ba6ad40603587d6b$export$a33e02b86664bfb2.firstPosition.y=e.targetTouches[0].clientY,$ba6ad40603587d6b$export$a33e02b86664bfb2.UpdateCamera())},OnTouchMove:function(e){if(e.preventDefault(),$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera){if($ba6ad40603587d6b$export$a33e02b86664bfb2.inTouch=!0,1!=e.targetTouches.length||$ba6ad40603587d6b$export$a33e02b86664bfb2.inZoom){if(2==e.targetTouches.length){$ba6ad40603587d6b$export$a33e02b86664bfb2.inZoom=!0,$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.countXBegin=57.3*$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.cameraRotX.rotation.x,$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.countYBegin=57.3*$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.cameraRotY.rotation.y;var t=new $4xklQ.Vector2(e.targetTouches[0].clientX-e.targetTouches[1].clientX,e.targetTouches[0].clientY-e.targetTouches[1].clientY);$ba6ad40603587d6b$export$a33e02b86664bfb2.ZcountOffset=5*($ba6ad40603587d6b$export$a33e02b86664bfb2.disVec2_first-t.length())}}else $ba6ad40603587d6b$export$a33e02b86664bfb2.XcountOffset=$ba6ad40603587d6b$export$a33e02b86664bfb2.firstPosition.x-e.targetTouches[0].clientX,$ba6ad40603587d6b$export$a33e02b86664bfb2.YcountOffset=$ba6ad40603587d6b$export$a33e02b86664bfb2.firstPosition.y-e.targetTouches[0].clientY;$ba6ad40603587d6b$export$a33e02b86664bfb2.UpdateCamera()}},OnTouchEnd:function(e){e.preventDefault(),$ba6ad40603587d6b$export$a33e02b86664bfb2.inTouch=!1,$ba6ad40603587d6b$export$a33e02b86664bfb2.UpdateCamera(),$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.maximumZ<.01&&($ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.Xcount=0)},UpdateCamera:function(){$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera&&$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.setUpdateState($ba6ad40603587d6b$export$a33e02b86664bfb2.XcountOffset,$ba6ad40603587d6b$export$a33e02b86664bfb2.YcountOffset,$ba6ad40603587d6b$export$a33e02b86664bfb2.ZcountOffset)}},$ba6ad40603587d6b$export$c7dab90f68cf5e8d={walkingSpeed:.25,cameraName:"",compass:"",zhiBeiZhenCorrect:0,sommthFactor:.08,countXBegin:0,countYBegin:0,countZBegin:0,Xcount:0,Ycount:0,Zcount:0,Xsmooth:0,Ysmooth:0,Zsmooth:0,minimumX:0,maximumX:0,minimumZ:0,maximumZ:1e3,camera:"",camBase:"",cameraRotX:"",cameraRotY:"",defaultXcount:0,defaultYcount:0,defaultZcount:0,defaultPosX:0,defaultPosY:0,defaultPosZ:0,posX:0,posY:0,posZ:0,smoothPosX:0,smoothPosY:0,smoothPosZ:0,Init:function(e){$ba6ad40603587d6b$export$c7dab90f68cf5e8d.viewport=e,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camera=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.viewport.editor.camera,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camBase=new $4xklQ.Object3D,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.cameraRotX=new $4xklQ.Object3D,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.cameraRotY=new $4xklQ.Object3D,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camBase.name="camBase",$ba6ad40603587d6b$export$c7dab90f68cf5e8d.cameraRotX.name="cameraRotX",$ba6ad40603587d6b$export$c7dab90f68cf5e8d.cameraRotY.name="cameraRotY",$ba6ad40603587d6b$export$c7dab90f68cf5e8d.cameraRotX.add($ba6ad40603587d6b$export$c7dab90f68cf5e8d.camera),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.cameraRotY.add($ba6ad40603587d6b$export$c7dab90f68cf5e8d.cameraRotX),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camBase.add($ba6ad40603587d6b$export$c7dab90f68cf5e8d.cameraRotY);var t=new $4xklQ.BufferGeometry,i=new Float32Array([-1,-1,1,1,-1,1,1,1,1,1,1,1,-1,1,1,-1,-1,1]),r=new Float32Array([0,0,1,0,1,1,1,1,0,1,0,0]);t.setAttribute("position",new $4xklQ.BufferAttribute(i,3)),t.setAttribute("uv",new $4xklQ.BufferAttribute(r,2));var n=new $4xklQ.MeshBasicMaterial({color:16777215});n.depthWrite=!1,n.depthFunc=$4xklQ.AlwaysDepth,n.transparent=!0;var o=new $4xklQ.Mesh(t,n);$ba6ad40603587d6b$export$c7dab90f68cf5e8d.compass=o,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.compass.scale.x=.15,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.compass.scale.y=.15,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.compass.scale.z=.15,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.compass.position.x=-1,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.compass.position.y=.9,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.compass.position.z=-2,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.compass.renderOrder=1e4,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camera.add($ba6ad40603587d6b$export$c7dab90f68cf5e8d.compass),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.compass.visible=!1},SetInitStates:function(e,t,i,r){$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camera.aspect=e,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camera.fov=t,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camera.near=i,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camera.far=r,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camera.updateProjectionMatrix()},SetupCameraCtrl:function(e,t){$ba6ad40603587d6b$export$c7dab90f68cf5e8d.RecordDefaultState(e[0],e[1],e[2],-e[3],-e[4],e[5]),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.SetCameraPos(e[0],e[1],e[2]),console.log(),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.minimumX=e[9],$ba6ad40603587d6b$export$c7dab90f68cf5e8d.maximumX=e[10],$ba6ad40603587d6b$export$c7dab90f68cf5e8d.minimumZ=e[11],$ba6ad40603587d6b$export$c7dab90f68cf5e8d.maximumZ=e[12],$ba6ad40603587d6b$export$c7dab90f68cf5e8d.zhiBeiZhenCorrect=e[13],$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camBase.updateMatrix(),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.ResetCameraState(t),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zcount+=.01,$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera&&$ba6ad40603587d6b$export$a33e02b86664bfb2.ctrlCamera.NeedUpdate()&&console.log("aaa")},RecordDefaultState:function(e,t,i,r,n,o){$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultPosX=e,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultPosY=t,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultPosZ=i,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultXcount=r,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultYcount=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.ModiferYCount($ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ycount,n),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultZcount=o},SetCameraPos:function(e,t,i){""!==e&&($ba6ad40603587d6b$export$c7dab90f68cf5e8d.posX=Number(e)),""!==t&&($ba6ad40603587d6b$export$c7dab90f68cf5e8d.posY=Number(t),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camBase.position.y=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.posY),""!==i&&($ba6ad40603587d6b$export$c7dab90f68cf5e8d.posZ=Number(i))},ModiferYCount:function(e,t){var i,r=e%360,n=t%360;return n<0&&(n+=360),r<0&&(r+=360),r>n?(r-n>180&&(n+=360),i=e+n-r):(r-n<-180&&(r+=360),i=e-(r-n)),i},SetCameraXYZcount:function(e,t,i){""!=e&&($ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xcount=-Number(e),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.countXBegin=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xcount),""!=t&&($ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ycount=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.ModiferYCount($ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ycount,-Number(t)),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.countYBegin=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ycount),""!=i&&($ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zcount=Number(i),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.countZBegin=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zcount),$ba6ad40603587d6b$export$a33e02b86664bfb2.XcountOffset=0,$ba6ad40603587d6b$export$a33e02b86664bfb2.YcountOffset=0,$ba6ad40603587d6b$export$a33e02b86664bfb2.ZcountOffset=0},SetCameraStates:function(e){$ba6ad40603587d6b$export$c7dab90f68cf5e8d.SetCameraPos(e[0],e[1],e[2]),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.SetCameraXYZcount(e[3],e[4],e[5])},ResetCameraState:function(e){$ba6ad40603587d6b$export$c7dab90f68cf5e8d.countXBegin=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultXcount,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.countYBegin=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultYcount,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.countZBegin=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultZcount,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xcount=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultXcount,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ycount=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultYcount,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zcount=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultZcount,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.posX=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultPosX,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.posY=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultPosY,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.posZ=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultPosZ,$ba6ad40603587d6b$export$a33e02b86664bfb2.XcountOffset=0,$ba6ad40603587d6b$export$a33e02b86664bfb2.YcountOffset=0,$ba6ad40603587d6b$export$a33e02b86664bfb2.ZcountOffset=0,e&&($ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xsmooth=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xcount,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ysmooth=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ycount,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zsmooth=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zcount,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.smoothPosX=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultPosX,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.smoothPosY=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultPosY,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.smoothPosZ=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.defaultPosZ)},setUpdateState:function(e,t,i){$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xcount=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.countXBegin+.5*t*.1,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ycount=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.countYBegin+.5*e*.1,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zcount=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.countZBegin+.1*i*.1},NeedUpdate:function(){if($ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xcount=$4xklQ.MathUtils.clamp($ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xcount,-$ba6ad40603587d6b$export$c7dab90f68cf5e8d.maximumX,-$ba6ad40603587d6b$export$c7dab90f68cf5e8d.minimumX),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zcount=$4xklQ.MathUtils.clamp($ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zcount,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.minimumZ,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.maximumZ),$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xsmooth=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xsmooth*(1-$ba6ad40603587d6b$export$c7dab90f68cf5e8d.sommthFactor)+$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xcount*$ba6ad40603587d6b$export$c7dab90f68cf5e8d.sommthFactor,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ysmooth=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ysmooth*(1-$ba6ad40603587d6b$export$c7dab90f68cf5e8d.sommthFactor)+$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ycount*$ba6ad40603587d6b$export$c7dab90f68cf5e8d.sommthFactor,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zsmooth=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zsmooth*(1-$ba6ad40603587d6b$export$c7dab90f68cf5e8d.sommthFactor)+$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zcount*$ba6ad40603587d6b$export$c7dab90f68cf5e8d.sommthFactor,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.smoothPosX=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.smoothPosX*(1-$ba6ad40603587d6b$export$c7dab90f68cf5e8d.sommthFactor)+$ba6ad40603587d6b$export$c7dab90f68cf5e8d.posX*$ba6ad40603587d6b$export$c7dab90f68cf5e8d.sommthFactor,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.smoothPosZ=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.smoothPosZ*(1-$ba6ad40603587d6b$export$c7dab90f68cf5e8d.sommthFactor)+$ba6ad40603587d6b$export$c7dab90f68cf5e8d.posZ*$ba6ad40603587d6b$export$c7dab90f68cf5e8d.sommthFactor,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camBase.position.x=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.smoothPosX,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camBase.position.z=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.smoothPosZ,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.cameraRotX.rotation.x=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xsmooth/57.3,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.cameraRotY.rotation.y=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ysmooth/57.3,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camera.position.z=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zsmooth,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.compass.rotation.z=-$ba6ad40603587d6b$export$c7dab90f68cf5e8d.cameraRotY.rotation.y+$ba6ad40603587d6b$export$c7dab90f68cf5e8d.zhiBeiZhenCorrect,$ba6ad40603587d6b$export$a33e02b86664bfb2.inTouch&&$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zcount<1){let i=new $4xklQ.Vector3;$ba6ad40603587d6b$export$c7dab90f68cf5e8d.cameraRotY.getWorldDirection(i);let r=new $4xklQ.Vector3(i.x,i.y,i.z);$ba6ad40603587d6b$export$a33e02b86664bfb2.rd?(i.x=-i.x,i.y=-i.y,i.z=-i.z):i=r,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.camBase.forward=i;var e=!0,t=new $4xklQ.Ray($ba6ad40603587d6b$export$c7dab90f68cf5e8d.camBase.position,i);let n=[];!function e(t){t.children.length>0&&t.children.forEach((function(t){"Mesh"==t.type&&2==t.layers.mask&&n.push(t),"Group"==t.type&&e(t)}))}($ba6ad40603587d6b$export$c7dab90f68cf5e8d.camBase.parent);for(let i=0;i<n.length;i++){n[i].updateMatrix(),n[i].updateMatrixWorld(!0);let r=Array.from(n[i].geometry.attributes.position.array);if(n[i].geometry.index){let o=Array.from(n[i].geometry.index.array);for(let a=0;a<o.length/3;a++){let s=new $4xklQ.Vector3(r[3*o[3*a]],r[3*o[3*a]+1],r[3*o[3*a]+2]),l=new $4xklQ.Vector3(r[3*o[3*a+1]],r[3*o[3*a+1]+1],r[3*o[3*a+1]+2]),c=new $4xklQ.Vector3(r[3*o[3*a+2]],r[3*o[3*a+2]+1],r[3*o[3*a+2]+2]);n[i].localToWorld(s),n[i].localToWorld(l),n[i].localToWorld(c);let h=new $4xklQ.Vector3;if(t.intersectTriangle(s,l,c,!1,h),!h.equals(new $4xklQ.Vector3)){if($ba6ad40603587d6b$export$c7dab90f68cf5e8d.camBase.position.distanceTo(h)<1)return e=!1,!1;e=!0}}}else for(let i=0;i<r.length/9;i++){let n=new $4xklQ.Vector3(r[9*i],r[9*i+1],r[9*i+2]),o=new $4xklQ.Vector3(r[9*i+3],r[9*i+4],r[9*i+5]),a=new $4xklQ.Vector3(r[9*i+6],r[9*i+7],r[9*i+8]),s=new $4xklQ.Vector3;new $4xklQ.Vector3;if(t.intersectTriangle(n,o,a,!1,s),!s.equals(new $4xklQ.Vector3)){if($ba6ad40603587d6b$export$c7dab90f68cf5e8d.camBase.position.distanceTo(s)<1)return e=!1,!1;e=!0}}}e&&($ba6ad40603587d6b$export$a33e02b86664bfb2.md||($ba6ad40603587d6b$export$c7dab90f68cf5e8d.posX=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.posX+.02*i.x*$ba6ad40603587d6b$export$c7dab90f68cf5e8d.walkingSpeed,$ba6ad40603587d6b$export$c7dab90f68cf5e8d.posZ=$ba6ad40603587d6b$export$c7dab90f68cf5e8d.posZ+.02*i.z*$ba6ad40603587d6b$export$c7dab90f68cf5e8d.walkingSpeed))}return!!($ba6ad40603587d6b$export$a33e02b86664bfb2.inTouch||Math.abs($ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xsmooth-$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Xcount)>.001||Math.abs($ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ysmooth-$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Ycount)>.001||Math.abs($ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zsmooth-$ba6ad40603587d6b$export$c7dab90f68cf5e8d.Zcount)>.001)}},$9HO6e=parcelRequire("9HO6e"),$9QhXH=parcelRequire("9QhXH"),$4xklQ=parcelRequire("4xklQ"),$9HO6e=parcelRequire("9HO6e");class $c338f49977b1ce90$export$4eacab61b79af859{constructor(e){this.editor=e}main(){if(""==this.editor.mouseCoverObj)return;this.editor.doorHelperGroupClean(),this.editor.switchHelperGroup("hidden");let e=this.editor.currentPoint.clone();if(0==e.x&&0==e.y&&0==e.z)return;let t="";if(this.editor.camera.isOrthographicCamera){"model2dBox"==this.editor.mouseCoverObj.name&&(this.editor.mouseCoverObj.parent&&this.editor.mouseCoverObj.parent.remove(this.editor.mouseCoverObj),this.editor.model2D.children.slice(0).forEach((e=>{e.uuid==this.editor.mouseCoverObj.modelUUID&&(this.editor.mouseCoverObj=e)})));let i="";this.editor.floorGroup2d.children.forEach((t=>{if("floor"==t.useType){let r=[];t.allPoints.forEach((e=>{r.push(e.x,e.y)})),this.editor.PolyK.ContainsPoint(r,e.x,e.y)&&(i=t.roomCenter)}})),this.editor.allWalls.forEach((t=>{let r=$9HO6e.UtilCore.smallDistanceByPointOnLine($9HO6e.UtilCore.handleLineData(t.startPoint,t.endPoint),e);if(!$9HO6e.UtilCore.pointIsInLine(r,t.startPoint,t.endPoint))return;let n=r.clone().distanceTo($9HO6e.UtilCore.toVector3(e)),o=Math.min(this.editor.mouseCoverObj.width,this.editor.mouseCoverObj.height),a=t.thickness/2+o/2;if(n<=a){let n=t.endPoint.clone().sub(t.startPoint.clone()).angle();if(i){$9HO6e.UtilCore.getClockWise(t.startPoint,t.endPoint,new(0,$4xklQ.Vector2)(i[0],i[1]))>0&&(n+=Math.PI)}this.editor.mouseCoverObj.rotation.z=n,this.editor.mouseCoverObj.coverWallId=t.wallID,e=r.clone().add($9HO6e.UtilCore.toVector2(e).sub(r.clone()).setLength(a));let o=r.distanceTo(t.startPoint),s=r.distanceTo(t.endPoint);if(o<this.editor.mouseCoverObj.width/2+t.thickness/2){let i=this.editor.mouseCoverObj.width/2-o+t.thickness/2,r=t.endPoint.clone().sub(t.startPoint).setLength(i);r=new(0,$4xklQ.Vector3)(r.x,r.y,e.z),e.add(r)}if(s<this.editor.mouseCoverObj.width/2+t.thickness/2){let i=this.editor.mouseCoverObj.width/2-s+t.thickness/2,r=t.startPoint.clone().sub(t.endPoint).setLength(i);r=new(0,$4xklQ.Vector3)(r.x,r.y,e.z),e.add(r)}}})),this.editor.mouseCoverObj.position.set(e.x,e.y,0),this.editor.cleanModelHelper(),this.editor.addPositionHelper(this.editor.mouseCoverObj),t=this.editor.get3DModelBy2DModel(this.editor.mouseCoverObj),e=new(0,$4xklQ.Vector3)(e.x/1e3,0,-e.y/1e3)}else{if("model3dBox"==this.editor.mouseCoverObj.name&&(this.editor.mouseCoverObj.parent&&this.editor.mouseCoverObj.parent.remove(this.editor.mouseCoverObj),this.editor.model3D.children.slice(0).forEach((e=>{e.uuid==this.editor.mouseCoverObj.modelUUID&&(this.editor.mouseCoverObj=e)}))),t=this.editor.mouseCoverObj,"top"==t.modelPosition);else{let t="";this.editor.floorGroup.children.forEach((i=>{if("Floor3D"==i.type){let r=[];i.allPoints.forEach((e=>{r.push(e.x,e.y)})),this.editor.PolyK.ContainsPoint(r,1e3*e.x,1e3*-e.z)&&(t=i.roomCenter)}})),this.editor.wallGroup3D.children.forEach((i=>{if(!i.startPoint)return;let r=$9HO6e.UtilCore.get3dWallDistance(e,i);if(0==r.length)return;let n=r[0],o=i.thickness/2+this.editor.mouseCoverObj.depth/2;if(n<=o){let n=i.endPoint.clone().sub(i.startPoint.clone()).angle();if(t){$9HO6e.UtilCore.getClockWise(i.startPoint,i.endPoint,new(0,$4xklQ.Vector2)(t[0]/1e3,t[1]/1e3))>0&&(n+=Math.PI)}this.editor.mouseCoverObj.rotation.y=n,this.editor.mouseCoverObj.coverWallId=i.wallID;let a=r[1];e=a.clone().add(e.clone().sub(a.clone()).setLength(o));let s=new(0,$4xklQ.Vector2)(a.x,-a.z),l=s.distanceTo(i.startPoint),c=s.distanceTo(i.endPoint);if(l<this.editor.mouseCoverObj.width/2+i.thickness/2){let t=this.editor.mouseCoverObj.width/2-l+i.thickness/2,r=i.endPoint.clone().sub(i.startPoint).setLength(t);r=new(0,$4xklQ.Vector3)(r.x,e.y,-r.y),e.add(r)}if(c<this.editor.mouseCoverObj.width/2+i.thickness/2){let t=this.editor.mouseCoverObj.width/2-c+i.thickness/2,r=i.startPoint.clone().sub(i.endPoint).setLength(t);r=new(0,$4xklQ.Vector3)(r.x,e.y,-r.y),e.add(r)}}}))}e.y=this.editor.currentPoint.y;let i=this.editor.get2DModelBy3DModel(this.editor.mouseCoverObj);""!=i&&i.position.set(1e3*e.x,1e3*-e.z,0)}if(""==t||!t.parent)return;let i=this.editor.getRealSize(t);"top"==t.modelPosition?(t.position.set(e.x,this.editor.wallGroup3D.roomHeight/1e3-i[1]/2,e.z),t.floorHei=this.editor.wallGroup3D.roomHeight/1e3-i[1]):"bottom"==t.modelPosition?(t.position.set(e.x,i[1]/2,e.z),t.floorHei=0):(t.position.set(e.x,e.y+i[1]/2,e.z),t.floorHei=e.y);let r=t.position.clone();if(t.parent.worldToLocal(r),t.position.copy(r),this.editor.clickDepthMsg.uuid&&this.editor.checkModelIsInGroupModel(this.editor.mouseCoverObj)){var n=e.clone();let t=this.editor.mouseCoverObj;t.parent.uuid==this.editor.clickDepthMsg.uuid||"3dModel"!=t.parent.name&&"2dModel"!=t.parent.name||(this.editor.clickDepthMsg.model.add(t),this.editor.clickDepthMsg.model.param[0].add(t.param[0])),this.editor.camera.isOrthographicCamera&&(n=this.editor.mouseCoverObj.position.clone(),t.parent.worldToLocal(n),t.position.x=n.x,t.position.y=n.y);let i=this.editor.getOuterParent(t,t,"outer");this.editor.refreshRealSizeByBox(i,t),this.editor.updateModelPosition(t.parent,i),this.editor.modelDotGroup.children=[],this.editor.camera.isOrthographicCamera?(this.editor.addDashBoxFor2dGroup(i),this.editor.addDashBoxForGroup(i.param[0]),this.editor.cleanModelHelper()):(this.editor.addDashBoxForGroup(i),this.editor.addDashBoxFor2dGroup(i.param[0]))}this.editor.synchroModel(this.editor.mouseCoverObj)}execute(){let e=this.editor.model2D.children,t="model2dBox";this.editor.camera.isOrthographicCamera&&(e=this.editor.model3D.children,t="model3dBox");let i=e.slice(0);this.editor.mouseCoverObj.parent.param&&(e=this.editor.mouseCoverObj.parent.param[0].children);let r="";if(e.forEach((e=>{e.name==t&&(r=e)})),""!=r){let e="";i.forEach((t=>{t.uuid==r.modelUUID&&(e=t)})),e.position.copy(r.position),e.rotation.copy(r.rotation),r.parent.add(e),r.parent.remove(r),this.editor.mouseCoverObj.modelId=e.uuid,this.editor.mouseCoverObj.param=[e],e.param=[this.editor.mouseCoverObj]}if(this.editor.cleanWallHelper(),this.editor.doorHelperGroupClean(),this.editor.camera.isOrthographicCamera?this.editor.mouseCoverObj.isLock?this.editor.addPositionHelper(this.editor.mouseCoverObj,!0):this.editor.addLineHelperForMember(this.editor.mouseCoverObj):new $102b3df9ca2da060$export$aead3d23b4737909(this.editor).selectObj([this.editor.mouseCoverObj]),"casualModel"==this.editor.mouseCoverObj.modelType){this.editor.selectObjArr=[this.editor.mouseCoverObj];let e=this.editor.camera.isOrthographicCamera?"2d":"3d";this.editor.explodeGroup(e,!1)}this.editor.mouseCoverObj=""}undo(){}redo(){}}var $4xklQ=parcelRequire("4xklQ");const $887b34e694533b37$var$_raycaster=new(0,$4xklQ.Raycaster),$887b34e694533b37$var$_tempVector=new(0,$4xklQ.Vector3),$887b34e694533b37$var$_tempVector2=new(0,$4xklQ.Vector3),$887b34e694533b37$var$_tempQuaternion=new(0,$4xklQ.Quaternion),$887b34e694533b37$var$_unit={X:new(0,$4xklQ.Vector3)(1,0,0),Y:new(0,$4xklQ.Vector3)(0,1,0),Z:new(0,$4xklQ.Vector3)(0,0,1)},$887b34e694533b37$var$_changeEvent={type:"change"},$887b34e694533b37$var$_mouseDownEvent={type:"mouseDown"},$887b34e694533b37$var$_mouseUpEvent={type:"mouseUp",mode:null},$887b34e694533b37$var$_objectChangeEvent={type:"objectChange"};class $887b34e694533b37$export$198e80c116632110 extends $4xklQ.Object3D{constructor(e,t){super(),void 0===t&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const i=new $887b34e694533b37$export$c2ae06a69fb9d31f;this._gizmo=i,this.add(i);const r=new $887b34e694533b37$export$c0ab73045548e2ca;this._plane=r,this.add(r);const n=this;function o(e,t){let o=t;Object.defineProperty(n,e,{get:function(){return void 0!==o?o:t},set:function(t){o!==t&&(o=t,r[e]=t,i[e]=t,n.dispatchEvent({type:e+"-changed",value:t}),n.dispatchEvent($887b34e694533b37$var$_changeEvent))}}),n[e]=t,r[e]=t,i[e]=t}o("camera",e),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0);const a=new(0,$4xklQ.Vector3),s=new(0,$4xklQ.Vector3),l=new(0,$4xklQ.Quaternion),c=new(0,$4xklQ.Quaternion),h=new(0,$4xklQ.Vector3),d=new(0,$4xklQ.Quaternion),u=new(0,$4xklQ.Vector3),p=new(0,$4xklQ.Vector3),m=new(0,$4xklQ.Vector3),f=new(0,$4xklQ.Vector3);o("worldPosition",a),o("worldPositionStart",s),o("worldQuaternion",l),o("worldQuaternionStart",c),o("cameraPosition",h),o("cameraQuaternion",d),o("pointStart",u),o("pointEnd",p),o("rotationAxis",m),o("rotationAngle",0),o("eye",f),this._offset=new(0,$4xklQ.Vector3),this._startNorm=new(0,$4xklQ.Vector3),this._endNorm=new(0,$4xklQ.Vector3),this._cameraScale=new(0,$4xklQ.Vector3),this._parentPosition=new(0,$4xklQ.Vector3),this._parentQuaternion=new(0,$4xklQ.Quaternion),this._parentQuaternionInv=new(0,$4xklQ.Quaternion),this._parentScale=new(0,$4xklQ.Vector3),this._worldScaleStart=new(0,$4xklQ.Vector3),this._worldQuaternionInv=new(0,$4xklQ.Quaternion),this._worldScale=new(0,$4xklQ.Vector3),this._positionStart=new(0,$4xklQ.Vector3),this._quaternionStart=new(0,$4xklQ.Quaternion),this._scaleStart=new(0,$4xklQ.Vector3),this._getPointer=$887b34e694533b37$var$getPointer.bind(this),this._onPointerDown=$887b34e694533b37$var$onPointerDown.bind(this),this._onPointerHover=$887b34e694533b37$var$onPointerHover.bind(this),this._onPointerMove=$887b34e694533b37$var$onPointerMove.bind(this),this._onPointerUp=$887b34e694533b37$var$onPointerUp.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye):this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(void 0===this.object||!0===this.dragging)return;$887b34e694533b37$var$_raycaster.setFromCamera(e,this.camera);const t=$887b34e694533b37$var$intersectObjectWithRay(this._gizmo.picker[this.mode],$887b34e694533b37$var$_raycaster);this.axis=t?t.object.name:null}pointerDown(e){if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){$887b34e694533b37$var$_raycaster.setFromCamera(e,this.camera);const t=$887b34e694533b37$var$intersectObjectWithRay(this._plane,$887b34e694533b37$var$_raycaster,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,$887b34e694533b37$var$_mouseDownEvent.mode=this.mode,this.dispatchEvent($887b34e694533b37$var$_mouseDownEvent)}}pointerMove(e){const t=this.axis,i=this.mode,r=this.object;let n=this.space;if("scale"===i?n="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(n="world"),void 0===r||null===t||!1===this.dragging||-1!==e.button)return;$887b34e694533b37$var$_raycaster.setFromCamera(e,this.camera);const o=$887b34e694533b37$var$intersectObjectWithRay(this._plane,$887b34e694533b37$var$_raycaster,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),"translate"===i)this._offset.copy(this.pointEnd).sub(this.pointStart),"local"===n&&"XYZ"!==t&&this._offset.applyQuaternion(this._worldQuaternionInv),-1===t.indexOf("X")&&(this._offset.x=0),-1===t.indexOf("Y")&&(this._offset.y=0),-1===t.indexOf("Z")&&(this._offset.z=0),"local"===n&&"XYZ"!==t?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),r.position.copy(this._offset).add(this._positionStart),this.translationSnap&&("local"===n&&(r.position.applyQuaternion($887b34e694533b37$var$_tempQuaternion.copy(this._quaternionStart).invert()),-1!==t.search("X")&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.position.applyQuaternion(this._quaternionStart)),"world"===n&&(r.parent&&r.position.add($887b34e694533b37$var$_tempVector.setFromMatrixPosition(r.parent.matrixWorld)),-1!==t.search("X")&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.parent&&r.position.sub($887b34e694533b37$var$_tempVector.setFromMatrixPosition(r.parent.matrixWorld))));else if("scale"===i){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(e*=-1),$887b34e694533b37$var$_tempVector2.set(e,e,e)}else $887b34e694533b37$var$_tempVector.copy(this.pointStart),$887b34e694533b37$var$_tempVector2.copy(this.pointEnd),$887b34e694533b37$var$_tempVector.applyQuaternion(this._worldQuaternionInv),$887b34e694533b37$var$_tempVector2.applyQuaternion(this._worldQuaternionInv),$887b34e694533b37$var$_tempVector2.divide($887b34e694533b37$var$_tempVector),-1===t.search("X")&&($887b34e694533b37$var$_tempVector2.x=1),-1===t.search("Y")&&($887b34e694533b37$var$_tempVector2.y=1),-1===t.search("Z")&&($887b34e694533b37$var$_tempVector2.z=1);r.scale.copy(this._scaleStart).multiply($887b34e694533b37$var$_tempVector2),this.scaleSnap&&(-1!==t.search("X")&&(r.scale.x=Math.round(r.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(r.scale.y=Math.round(r.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(r.scale.z=Math.round(r.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===i){this._offset.copy(this.pointEnd).sub(this.pointStart);const e=20/this.worldPosition.distanceTo($887b34e694533b37$var$_tempVector.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):"XYZE"===t?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot($887b34e694533b37$var$_tempVector.copy(this.rotationAxis).cross(this.eye))*e):"X"!==t&&"Y"!==t&&"Z"!==t||(this.rotationAxis.copy($887b34e694533b37$var$_unit[t]),$887b34e694533b37$var$_tempVector.copy($887b34e694533b37$var$_unit[t]),"local"===n&&$887b34e694533b37$var$_tempVector.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot($887b34e694533b37$var$_tempVector.cross(this.eye).normalize())*e),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===n&&"E"!==t&&"XYZE"!==t?(r.quaternion.copy(this._quaternionStart),r.quaternion.multiply($887b34e694533b37$var$_tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),r.quaternion.copy($887b34e694533b37$var$_tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),r.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent($887b34e694533b37$var$_changeEvent),this.dispatchEvent($887b34e694533b37$var$_objectChangeEvent)}}pointerUp(e){0===e.button&&(this.dragging&&null!==this.axis&&($887b34e694533b37$var$_mouseUpEvent.mode=this.mode,this.dispatchEvent($887b34e694533b37$var$_mouseUpEvent)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse((function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}))}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent($887b34e694533b37$var$_changeEvent),this.dispatchEvent($887b34e694533b37$var$_objectChangeEvent),this.pointStart.copy(this.pointEnd))}getRaycaster(){return $887b34e694533b37$var$_raycaster}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function $887b34e694533b37$var$getPointer(e){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:e.button};{const t=this.domElement.getBoundingClientRect();return{x:(e.clientX-t.left)/t.width*2-1,y:-(e.clientY-t.top)/t.height*2+1,button:e.button}}}function $887b34e694533b37$var$onPointerHover(e){if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(e))}}function $887b34e694533b37$var$onPointerDown(e){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(e)),this.pointerDown(this._getPointer(e)))}function $887b34e694533b37$var$onPointerMove(e){this.enabled&&this.pointerMove(this._getPointer(e))}function $887b34e694533b37$var$onPointerUp(e){this.enabled&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(e)))}function $887b34e694533b37$var$intersectObjectWithRay(e,t,i){const r=t.intersectObject(e,!0);for(let e=0;e<r.length;e++)if(r[e].object.visible||i)return r[e];return!1}const $887b34e694533b37$var$_tempEuler=new(0,$4xklQ.Euler),$887b34e694533b37$var$_alignVector=new(0,$4xklQ.Vector3)(0,1,0),$887b34e694533b37$var$_zeroVector=new(0,$4xklQ.Vector3)(0,0,0),$887b34e694533b37$var$_lookAtMatrix=new(0,$4xklQ.Matrix4),$887b34e694533b37$var$_tempQuaternion2=new(0,$4xklQ.Quaternion),$887b34e694533b37$var$_identityQuaternion=new(0,$4xklQ.Quaternion),$887b34e694533b37$var$_dirVector=new(0,$4xklQ.Vector3),$887b34e694533b37$var$_tempMatrix=new(0,$4xklQ.Matrix4),$887b34e694533b37$var$_unitX=new(0,$4xklQ.Vector3)(1,0,0),$887b34e694533b37$var$_unitY=new(0,$4xklQ.Vector3)(0,1,0),$887b34e694533b37$var$_unitZ=new(0,$4xklQ.Vector3)(0,0,1),$887b34e694533b37$var$_v1=new(0,$4xklQ.Vector3),$887b34e694533b37$var$_v2=new(0,$4xklQ.Vector3),$887b34e694533b37$var$_v3=new(0,$4xklQ.Vector3);class $887b34e694533b37$export$c2ae06a69fb9d31f extends $4xklQ.Object3D{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new(0,$4xklQ.MeshBasicMaterial)({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new(0,$4xklQ.LineBasicMaterial)({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=e.clone();i.opacity=.15;const r=t.clone();r.opacity=.5;const n=e.clone();n.color.setHex(16711680);const o=e.clone();o.color.setHex(65280);const a=e.clone();a.color.setHex(255);const s=e.clone();s.color.setHex(16711680),s.opacity=.5;const l=e.clone();l.color.setHex(65280),l.opacity=.5;const c=e.clone();c.color.setHex(255),c.opacity=.5;const h=e.clone();h.opacity=.25;const d=e.clone();d.color.setHex(16776960),d.opacity=.25;e.clone().color.setHex(16776960);const u=e.clone();u.color.setHex(7895160);const p=new(0,$4xklQ.CylinderGeometry)(0,.04,.1,12);p.translate(0,.05,0);const m=new(0,$4xklQ.BoxGeometry)(.08,.08,.08);m.translate(0,.04,0);const f=new(0,$4xklQ.BufferGeometry);f.setAttribute("position",new(0,$4xklQ.Float32BufferAttribute)([0,0,0,1,0,0],3));const g=new(0,$4xklQ.CylinderGeometry)(.0075,.0075,.5,3);function x(e,t){const i=new(0,$4xklQ.TorusGeometry)(e,.0075,3,64,t*Math.PI*2);return i.rotateY(Math.PI/2),i.rotateX(Math.PI/2),i}g.translate(0,.25,0);const b={X:[[new(0,$4xklQ.Mesh)(p,n),[.5,0,0],[0,0,-Math.PI/2]],[new(0,$4xklQ.Mesh)(p,n),[-.5,0,0],[0,0,Math.PI/2]],[new(0,$4xklQ.Mesh)(g,n),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new(0,$4xklQ.Mesh)(p,o),[0,.5,0]],[new(0,$4xklQ.Mesh)(p,o),[0,-.5,0],[Math.PI,0,0]],[new(0,$4xklQ.Mesh)(g,o)]],Z:[[new(0,$4xklQ.Mesh)(p,a),[0,0,.5],[Math.PI/2,0,0]],[new(0,$4xklQ.Mesh)(p,a),[0,0,-.5],[-Math.PI/2,0,0]],[new(0,$4xklQ.Mesh)(g,a),null,[Math.PI/2,0,0]]],XYZ:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.OctahedronGeometry)(.1,0),h.clone()),[0,0,0]]],XY:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.BoxGeometry)(.15,.15,.01),c.clone()),[.15,.15,0]]],YZ:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.BoxGeometry)(.15,.15,.01),s.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.BoxGeometry)(.15,.15,.01),l.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},y={X:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.CylinderGeometry)(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new(0,$4xklQ.Mesh)(new(0,$4xklQ.CylinderGeometry)(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.CylinderGeometry)(.2,0,.6,4),i),[0,.3,0]],[new(0,$4xklQ.Mesh)(new(0,$4xklQ.CylinderGeometry)(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.CylinderGeometry)(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new(0,$4xklQ.Mesh)(new(0,$4xklQ.CylinderGeometry)(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.OctahedronGeometry)(.2,0),i)]],XY:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.BoxGeometry)(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.BoxGeometry)(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.BoxGeometry)(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},w={START:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.OctahedronGeometry)(.01,2),r),null,null,null,"helper"]],END:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.OctahedronGeometry)(.01,2),r),null,null,null,"helper"]],DELTA:[[new(0,$4xklQ.Line)(function(){const e=new(0,$4xklQ.BufferGeometry);return e.setAttribute("position",new(0,$4xklQ.Float32BufferAttribute)([0,0,0,1,1,1],3)),e}(),r),null,null,null,"helper"]],X:[[new(0,$4xklQ.Line)(f,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new(0,$4xklQ.Line)(f,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new(0,$4xklQ.Line)(f,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},v={XYZE:[[new(0,$4xklQ.Mesh)(x(.5,1),u),null,[0,Math.PI/2,0]]],X:[[new(0,$4xklQ.Mesh)(x(.5,.5),n)]],Y:[[new(0,$4xklQ.Mesh)(x(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new(0,$4xklQ.Mesh)(x(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new(0,$4xklQ.Mesh)(x(.75,1),d),null,[0,Math.PI/2,0]]]},$={AXIS:[[new(0,$4xklQ.Line)(f,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},M={XYZE:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.SphereGeometry)(.25,10,8),i)]],X:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.TorusGeometry)(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.TorusGeometry)(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.TorusGeometry)(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.TorusGeometry)(.75,.1,2,24),i)]]},S={X:[[new(0,$4xklQ.Mesh)(m,n),[.5,0,0],[0,0,-Math.PI/2]],[new(0,$4xklQ.Mesh)(g,n),[0,0,0],[0,0,-Math.PI/2]],[new(0,$4xklQ.Mesh)(m,n),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new(0,$4xklQ.Mesh)(m,o),[0,.5,0]],[new(0,$4xklQ.Mesh)(g,o)],[new(0,$4xklQ.Mesh)(m,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new(0,$4xklQ.Mesh)(m,a),[0,0,.5],[Math.PI/2,0,0]],[new(0,$4xklQ.Mesh)(g,a),[0,0,0],[Math.PI/2,0,0]],[new(0,$4xklQ.Mesh)(m,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.BoxGeometry)(.15,.15,.01),c),[.15,.15,0]]],YZ:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.BoxGeometry)(.15,.15,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.BoxGeometry)(.15,.15,.01),l),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.BoxGeometry)(.1,.1,.1),h.clone())]]},P={X:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.CylinderGeometry)(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new(0,$4xklQ.Mesh)(new(0,$4xklQ.CylinderGeometry)(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.CylinderGeometry)(.2,0,.6,4),i),[0,.3,0]],[new(0,$4xklQ.Mesh)(new(0,$4xklQ.CylinderGeometry)(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.CylinderGeometry)(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new(0,$4xklQ.Mesh)(new(0,$4xklQ.CylinderGeometry)(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.BoxGeometry)(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.BoxGeometry)(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.BoxGeometry)(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new(0,$4xklQ.Mesh)(new(0,$4xklQ.BoxGeometry)(.2,.2,.2),i),[0,0,0]]]},k={X:[[new(0,$4xklQ.Line)(f,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new(0,$4xklQ.Line)(f,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new(0,$4xklQ.Line)(f,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function _(e){const t=new(0,$4xklQ.Object3D);for(const i in e)for(let r=e[i].length;r--;){const n=e[i][r][0].clone(),o=e[i][r][1],a=e[i][r][2],s=e[i][r][3],l=e[i][r][4];n.name=i,n.tag=l,o&&n.position.set(o[0],o[1],o[2]),a&&n.rotation.set(a[0],a[1],a[2]),s&&n.scale.set(s[0],s[1],s[2]),n.updateMatrix();const c=n.geometry.clone();c.applyMatrix4(n.matrix),n.geometry=c,n.renderOrder=1/0,n.position.set(0,0,0),n.rotation.set(0,0,0),n.scale.set(1,1,1),t.add(n)}return t}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=_(b)),this.add(this.gizmo.rotate=_(v)),this.add(this.gizmo.scale=_(S)),this.add(this.picker.translate=_(y)),this.add(this.picker.rotate=_(M)),this.add(this.picker.scale=_(P)),this.add(this.helper.translate=_(w)),this.add(this.helper.rotate=_($)),this.add(this.helper.scale=_(k)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t="local"===("scale"===this.mode?"local":this.space)?this.worldQuaternion:$887b34e694533b37$var$_identityQuaternion;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let e=0;e<i.length;e++){const r=i[e];let n;if(r.visible=!0,r.rotation.set(0,0,0),r.position.copy(this.worldPosition),n=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),r.scale.set(1,1,1).multiplyScalar(n*this.size/4),"helper"!==r.tag){if(r.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){const e=.99,i=.2;"X"===r.name&&Math.abs($887b34e694533b37$var$_alignVector.copy($887b34e694533b37$var$_unitX).applyQuaternion(t).dot(this.eye))>e&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"Y"===r.name&&Math.abs($887b34e694533b37$var$_alignVector.copy($887b34e694533b37$var$_unitY).applyQuaternion(t).dot(this.eye))>e&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"Z"===r.name&&Math.abs($887b34e694533b37$var$_alignVector.copy($887b34e694533b37$var$_unitZ).applyQuaternion(t).dot(this.eye))>e&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"XY"===r.name&&Math.abs($887b34e694533b37$var$_alignVector.copy($887b34e694533b37$var$_unitZ).applyQuaternion(t).dot(this.eye))<i&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"YZ"===r.name&&Math.abs($887b34e694533b37$var$_alignVector.copy($887b34e694533b37$var$_unitX).applyQuaternion(t).dot(this.eye))<i&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"XZ"===r.name&&Math.abs($887b34e694533b37$var$_alignVector.copy($887b34e694533b37$var$_unitY).applyQuaternion(t).dot(this.eye))<i&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1)}else"rotate"===this.mode&&($887b34e694533b37$var$_tempQuaternion2.copy(t),$887b34e694533b37$var$_alignVector.copy(this.eye).applyQuaternion($887b34e694533b37$var$_tempQuaternion.copy(t).invert()),-1!==r.name.search("E")&&r.quaternion.setFromRotationMatrix($887b34e694533b37$var$_lookAtMatrix.lookAt(this.eye,$887b34e694533b37$var$_zeroVector,$887b34e694533b37$var$_unitY)),"X"===r.name&&($887b34e694533b37$var$_tempQuaternion.setFromAxisAngle($887b34e694533b37$var$_unitX,Math.atan2(-$887b34e694533b37$var$_alignVector.y,$887b34e694533b37$var$_alignVector.z)),$887b34e694533b37$var$_tempQuaternion.multiplyQuaternions($887b34e694533b37$var$_tempQuaternion2,$887b34e694533b37$var$_tempQuaternion),r.quaternion.copy($887b34e694533b37$var$_tempQuaternion)),"Y"===r.name&&($887b34e694533b37$var$_tempQuaternion.setFromAxisAngle($887b34e694533b37$var$_unitY,Math.atan2($887b34e694533b37$var$_alignVector.x,$887b34e694533b37$var$_alignVector.z)),$887b34e694533b37$var$_tempQuaternion.multiplyQuaternions($887b34e694533b37$var$_tempQuaternion2,$887b34e694533b37$var$_tempQuaternion),r.quaternion.copy($887b34e694533b37$var$_tempQuaternion)),"Z"===r.name&&($887b34e694533b37$var$_tempQuaternion.setFromAxisAngle($887b34e694533b37$var$_unitZ,Math.atan2($887b34e694533b37$var$_alignVector.y,$887b34e694533b37$var$_alignVector.x)),$887b34e694533b37$var$_tempQuaternion.multiplyQuaternions($887b34e694533b37$var$_tempQuaternion2,$887b34e694533b37$var$_tempQuaternion),r.quaternion.copy($887b34e694533b37$var$_tempQuaternion)));r.visible=r.visible&&(-1===r.name.indexOf("X")||this.showX),r.visible=r.visible&&(-1===r.name.indexOf("Y")||this.showY),r.visible=r.visible&&(-1===r.name.indexOf("Z")||this.showZ),r.visible=r.visible&&(-1===r.name.indexOf("E")||this.showX&&this.showY&&this.showZ),r.material._color=r.material._color||r.material.color.clone(),r.material._opacity=r.material._opacity||r.material.opacity,r.material.color.copy(r.material._color),r.material.opacity=r.material._opacity,this.enabled&&this.axis&&(r.name===this.axis||this.axis.split("").some((function(e){return r.name===e})))&&(r.material.color.setHex(16776960),r.material.opacity=1)}else r.visible=!1,"AXIS"===r.name?(r.position.copy(this.worldPositionStart),r.visible=!!this.axis,"X"===this.axis&&($887b34e694533b37$var$_tempQuaternion.setFromEuler($887b34e694533b37$var$_tempEuler.set(0,0,0)),r.quaternion.copy(t).multiply($887b34e694533b37$var$_tempQuaternion),Math.abs($887b34e694533b37$var$_alignVector.copy($887b34e694533b37$var$_unitX).applyQuaternion(t).dot(this.eye))>.9&&(r.visible=!1)),"Y"===this.axis&&($887b34e694533b37$var$_tempQuaternion.setFromEuler($887b34e694533b37$var$_tempEuler.set(0,0,Math.PI/2)),r.quaternion.copy(t).multiply($887b34e694533b37$var$_tempQuaternion),Math.abs($887b34e694533b37$var$_alignVector.copy($887b34e694533b37$var$_unitY).applyQuaternion(t).dot(this.eye))>.9&&(r.visible=!1)),"Z"===this.axis&&($887b34e694533b37$var$_tempQuaternion.setFromEuler($887b34e694533b37$var$_tempEuler.set(0,Math.PI/2,0)),r.quaternion.copy(t).multiply($887b34e694533b37$var$_tempQuaternion),Math.abs($887b34e694533b37$var$_alignVector.copy($887b34e694533b37$var$_unitZ).applyQuaternion(t).dot(this.eye))>.9&&(r.visible=!1)),"XYZE"===this.axis&&($887b34e694533b37$var$_tempQuaternion.setFromEuler($887b34e694533b37$var$_tempEuler.set(0,Math.PI/2,0)),$887b34e694533b37$var$_alignVector.copy(this.rotationAxis),r.quaternion.setFromRotationMatrix($887b34e694533b37$var$_lookAtMatrix.lookAt($887b34e694533b37$var$_zeroVector,$887b34e694533b37$var$_alignVector,$887b34e694533b37$var$_unitY)),r.quaternion.multiply($887b34e694533b37$var$_tempQuaternion),r.visible=this.dragging),"E"===this.axis&&(r.visible=!1)):"START"===r.name?(r.position.copy(this.worldPositionStart),r.visible=this.dragging):"END"===r.name?(r.position.copy(this.worldPosition),r.visible=this.dragging):"DELTA"===r.name?(r.position.copy(this.worldPositionStart),r.quaternion.copy(this.worldQuaternionStart),$887b34e694533b37$var$_tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),$887b34e694533b37$var$_tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),r.scale.copy($887b34e694533b37$var$_tempVector),r.visible=this.dragging):(r.quaternion.copy(t),this.dragging?r.position.copy(this.worldPositionStart):r.position.copy(this.worldPosition),this.axis&&(r.visible=-1!==this.axis.search(r.name)))}super.updateMatrixWorld(e)}}class $887b34e694533b37$export$c0ab73045548e2ca extends $4xklQ.Mesh{constructor(){super(new(0,$4xklQ.PlaneGeometry)(1e5,1e5,2,2),new(0,$4xklQ.MeshBasicMaterial)({visible:!1,wireframe:!0,side:$4xklQ.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(t="local"),$887b34e694533b37$var$_v1.copy($887b34e694533b37$var$_unitX).applyQuaternion("local"===t?this.worldQuaternion:$887b34e694533b37$var$_identityQuaternion),$887b34e694533b37$var$_v2.copy($887b34e694533b37$var$_unitY).applyQuaternion("local"===t?this.worldQuaternion:$887b34e694533b37$var$_identityQuaternion),$887b34e694533b37$var$_v3.copy($887b34e694533b37$var$_unitZ).applyQuaternion("local"===t?this.worldQuaternion:$887b34e694533b37$var$_identityQuaternion),$887b34e694533b37$var$_alignVector.copy($887b34e694533b37$var$_v2),this.mode){case"translate":case"scale":switch(this.axis){case"X":$887b34e694533b37$var$_alignVector.copy(this.eye).cross($887b34e694533b37$var$_v1),$887b34e694533b37$var$_dirVector.copy($887b34e694533b37$var$_v1).cross($887b34e694533b37$var$_alignVector);break;case"Y":$887b34e694533b37$var$_alignVector.copy(this.eye).cross($887b34e694533b37$var$_v2),$887b34e694533b37$var$_dirVector.copy($887b34e694533b37$var$_v2).cross($887b34e694533b37$var$_alignVector);break;case"Z":$887b34e694533b37$var$_alignVector.copy(this.eye).cross($887b34e694533b37$var$_v3),$887b34e694533b37$var$_dirVector.copy($887b34e694533b37$var$_v3).cross($887b34e694533b37$var$_alignVector);break;case"XY":$887b34e694533b37$var$_dirVector.copy($887b34e694533b37$var$_v3);break;case"YZ":$887b34e694533b37$var$_dirVector.copy($887b34e694533b37$var$_v1);break;case"XZ":$887b34e694533b37$var$_alignVector.copy($887b34e694533b37$var$_v3),$887b34e694533b37$var$_dirVector.copy($887b34e694533b37$var$_v2);break;case"XYZ":case"E":$887b34e694533b37$var$_dirVector.set(0,0,0)}break;default:$887b34e694533b37$var$_dirVector.set(0,0,0)}0===$887b34e694533b37$var$_dirVector.length()?this.quaternion.copy(this.cameraQuaternion):($887b34e694533b37$var$_tempMatrix.lookAt($887b34e694533b37$var$_tempVector.set(0,0,0),$887b34e694533b37$var$_dirVector,$887b34e694533b37$var$_alignVector),this.quaternion.setFromRotationMatrix($887b34e694533b37$var$_tempMatrix)),super.updateMatrixWorld(e)}}var $f31f472336ab70f0$var$Stats=function(){var e=0,t=document.createElement("div");function i(e){return t.appendChild(e.dom),e}function r(i){for(var r=0;r<t.children.length;r++)t.children[r].style.display=r===i?"block":"none";e=i}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",(function(i){i.preventDefault(),r(++e%t.children.length)}),!1);var n=(performance||Date).now(),o=n,a=0,s=i(new $f31f472336ab70f0$var$Stats.Panel("FPS","#0ff","#002")),l=i(new $f31f472336ab70f0$var$Stats.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=i(new $f31f472336ab70f0$var$Stats.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:t,addPanel:i,showPanel:r,begin:function(){n=(performance||Date).now()},end:function(){a++;var e=(performance||Date).now();if(l.update(e-n,200),e>=o+1e3&&(s.update(1e3*a/(e-o),100),o=e,a=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){n=this.end()},domElement:t,setMode:r}};$f31f472336ab70f0$var$Stats.Panel=function(e,t,i){var r=1/0,n=0,o=Math.round,a=o(window.devicePixelRatio||1),s=80*a,l=48*a,c=3*a,h=2*a,d=3*a,u=15*a,p=74*a,m=30*a,f=document.createElement("canvas");f.width=s,f.height=l,f.style.cssText="width:80px;height:48px";var g=f.getContext("2d");return g.font="bold "+9*a+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=i,g.fillRect(0,0,s,l),g.fillStyle=t,g.fillText(e,c,h),g.fillRect(d,u,p,m),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(d,u,p,m),{dom:f,update:function(l,x){r=Math.min(r,l),n=Math.max(n,l),g.fillStyle=i,g.globalAlpha=1,g.fillRect(0,0,s,u),g.fillStyle=t,g.fillText(o(l)+" "+e+" ("+o(r)+"-"+o(n)+")",c,h),g.drawImage(f,d+a,u,p-a,m,d,u,p-a,m),g.fillRect(d+p-a,u,a,m),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(d+p-a,u,a,o((1-l/x)*m))}}};var $f31f472336ab70f0$export$2e2bcd8739ae039=$f31f472336ab70f0$var$Stats,$4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ"),$hrM0U=parcelRequire("hrM0U"),$4xklQ=parcelRequire("4xklQ");class $22831dcc74231be4$export$959ae9097e74a233 extends $4xklQ.Loader{constructor(e){super(e),this.defaultDPI=90,this.defaultUnit="px"}load(e,t,i,r){const n=this,o=new(0,$4xklQ.FileLoader)(n.manager);o.setPath(n.path),o.setRequestHeader(n.requestHeader),o.setWithCredentials(n.withCredentials),o.load(e,(function(i){try{t(n.parse(i))}catch(t){r?r(t):console.error(t),n.manager.itemError(e)}}),i,r)}parse(e){const t=this;function i(e,t,i,n,o,a,s,l){if(0==t||0==i)return void e.lineTo(l.x,l.y);n=n*Math.PI/180,t=Math.abs(t),i=Math.abs(i);const c=(s.x-l.x)/2,h=(s.y-l.y)/2,d=Math.cos(n)*c+Math.sin(n)*h,u=-Math.sin(n)*c+Math.cos(n)*h;let p=t*t,m=i*i;const f=d*d,g=u*u,x=f/p+g/m;if(x>1){const e=Math.sqrt(x);p=(t*=e)*t,m=(i*=e)*i}const b=p*g+m*f,y=(p*m-b)/b;let w=Math.sqrt(Math.max(0,y));o===a&&(w=-w);const v=w*t*u/i,$=-w*i*d/t,M=Math.cos(n)*v-Math.sin(n)*$+(s.x+l.x)/2,S=Math.sin(n)*v+Math.cos(n)*$+(s.y+l.y)/2,P=r(1,0,(d-v)/t,(u-$)/i),k=r((d-v)/t,(u-$)/i,(-d-v)/t,(-u-$)/i)%(2*Math.PI);e.currentPath.absellipse(M,S,t,i,P,P+k,0===a,n)}function r(e,t,i,r){const n=e*i+t*r,o=Math.sqrt(e*e+t*t)*Math.sqrt(i*i+r*r);let a=Math.acos(Math.max(-1,Math.min(1,n/o)));return e*r-t*i<0&&(a=-a),a}function n(e,t){t=Object.assign({},t);let i={};if(e.hasAttribute("class")){const t=e.getAttribute("class").split(/\s/).filter(Boolean).map((e=>e.trim()));for(let e=0;e<t.length;e++)i=Object.assign(i,p["."+t[e]])}function r(r,n,o){void 0===o&&(o=function(e){return e.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),e}),e.hasAttribute(r)&&(t[n]=o(e.getAttribute(r))),i[r]&&(t[n]=o(i[r])),e.style&&""!==e.style[r]&&(t[n]=o(e.style[r]))}function n(e){return Math.max(0,Math.min(1,c(e)))}function o(e){return Math.max(0,c(e))}return e.hasAttribute("id")&&(i=Object.assign(i,p["#"+e.getAttribute("id")])),r("fill","fill"),r("fill-opacity","fillOpacity",n),r("fill-rule","fillRule"),r("opacity","opacity",n),r("stroke","stroke"),r("stroke-opacity","strokeOpacity",n),r("stroke-width","strokeWidth",o),r("stroke-linejoin","strokeLineJoin"),r("stroke-linecap","strokeLineCap"),r("stroke-miterlimit","strokeMiterLimit",o),r("visibility","visibility"),t}function o(e,t){return e-(t-e)}function a(e,t,i){if("string"!=typeof e)throw new TypeError("Invalid input: "+typeof e);const r={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/};let n=0,o=!0,a="",s="";const l=[];function c(e,t,i){const r=new SyntaxError('Unexpected character "'+e+'" at index '+t+".");throw r.partial=i,r}function h(){""!==a&&(""===s?l.push(Number(a)):l.push(Number(a)*Math.pow(10,Number(s)))),a="",s=""}let d;const u=e.length;for(let p=0;p<u;p++)if(d=e[p],Array.isArray(t)&&t.includes(l.length%i)&&r.FLAGS.test(d))n=1,a=d,h();else{if(0===n){if(r.WHITESPACE.test(d))continue;if(r.DIGIT.test(d)||r.SIGN.test(d)){n=1,a=d;continue}if(r.POINT.test(d)){n=2,a=d;continue}r.COMMA.test(d)&&(o&&c(d,p,l),o=!0)}if(1===n){if(r.DIGIT.test(d)){a+=d;continue}if(r.POINT.test(d)){a+=d,n=2;continue}if(r.EXP.test(d)){n=3;continue}r.SIGN.test(d)&&1===a.length&&r.SIGN.test(a[0])&&c(d,p,l)}if(2===n){if(r.DIGIT.test(d)){a+=d;continue}if(r.EXP.test(d)){n=3;continue}r.POINT.test(d)&&"."===a[a.length-1]&&c(d,p,l)}if(3===n){if(r.DIGIT.test(d)){s+=d;continue}if(r.SIGN.test(d)){if(""===s){s+=d;continue}1===s.length&&r.SIGN.test(s)&&c(d,p,l)}}r.WHITESPACE.test(d)?(h(),n=0,o=!1):r.COMMA.test(d)?(h(),n=0,o=!0):r.SIGN.test(d)?(h(),n=1,a=d):r.POINT.test(d)?(h(),n=2,a=d):c(d,p,l)}return h(),l}const s=["mm","cm","in","pt","pc","px"],l={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function c(e){let i,r="px";if("string"==typeof e||e instanceof String)for(let t=0,i=s.length;t<i;t++){const i=s[t];if(e.endsWith(i)){r=i,e=e.substring(0,e.length-i.length);break}}return"px"===r&&"px"!==t.defaultUnit?i=l.in[t.defaultUnit]/t.defaultDPI:(i=l[r][t.defaultUnit],i<0&&(i=l[r].in*t.defaultDPI)),i*parseFloat(e)}function h(e){const t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function d(e){const t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}const u=[],p={},m=[],f=new(0,$4xklQ.Matrix3),g=new(0,$4xklQ.Matrix3),x=new(0,$4xklQ.Matrix3),b=new(0,$4xklQ.Matrix3),y=new(0,$4xklQ.Vector2),w=new(0,$4xklQ.Vector3),v=new(0,$4xklQ.Matrix3),$=(new DOMParser).parseFromString(e,"image/svg+xml");!function e(t,r){if(1!==t.nodeType)return;const s=function(e){if(!(e.hasAttribute("transform")||"use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))))return null;const t=function(e){const t=new(0,$4xklQ.Matrix3),i=f;if("use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))){const i=c(e.getAttribute("x")),r=c(e.getAttribute("y"));t.translate(i,r)}if(e.hasAttribute("transform")){const r=e.getAttribute("transform").split(")");for(let e=r.length-1;e>=0;e--){const n=r[e].trim();if(""===n)continue;const o=n.indexOf("("),s=n.length;if(o>0&&o<s){const e=n.slice(0,o),t=a(n.slice(o+1));switch(i.identity(),e){case"translate":if(t.length>=1){const e=t[0];let r=0;t.length>=2&&(r=t[1]),i.translate(e,r)}break;case"rotate":if(t.length>=1){let e=0,r=0,n=0;e=-t[0]*Math.PI/180,t.length>=3&&(r=t[1],n=t[2]),g.identity().translate(-r,-n),x.identity().rotate(e),b.multiplyMatrices(x,g),g.identity().translate(r,n),i.multiplyMatrices(g,b)}break;case"scale":if(t.length>=1){const e=t[0];let r=e;t.length>=2&&(r=t[1]),i.scale(e,r)}break;case"skewX":1===t.length&&i.set(1,Math.tan(t[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===t.length&&i.set(1,0,0,Math.tan(t[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===t.length&&i.set(t[0],t[2],t[4],t[1],t[3],t[5],0,0,1)}}t.premultiply(i)}}return t}(e);m.length>0&&t.premultiply(m[m.length-1]);return v.copy(t),m.push(t),t}(t);let l=!1,$=null;switch(t.nodeName){case"svg":case"g":r=n(t,r);break;case"style":!function(e){if(!e.sheet||!e.sheet.cssRules||!e.sheet.cssRules.length)return;for(let t=0;t<e.sheet.cssRules.length;t++){const i=e.sheet.cssRules[t];if(1!==i.type)continue;const r=i.selectorText.split(/,/gm).filter(Boolean).map((e=>e.trim()));for(let e=0;e<r.length;e++){const t=Object.fromEntries(Object.entries(i.style).filter((([,e])=>""!==e)));p[r[e]]=Object.assign(p[r[e]]||{},t)}}}(t);break;case"path":r=n(t,r),t.hasAttribute("d")&&($=function(e){const t=new(0,$4xklQ.ShapePath),r=new(0,$4xklQ.Vector2),n=new(0,$4xklQ.Vector2),s=new(0,$4xklQ.Vector2);let l=!0,c=!1;const h=e.getAttribute("d").match(/[a-df-z][^a-df-z]*/gi);for(let e=0,d=h.length;e<d;e++){const d=h[e],u=d.charAt(0),p=d.slice(1).trim();let m;switch(!0===l&&(c=!0,l=!1),u){case"M":m=a(p);for(let e=0,i=m.length;e<i;e+=2)r.x=m[e+0],r.y=m[e+1],n.x=r.x,n.y=r.y,0===e?t.moveTo(r.x,r.y):t.lineTo(r.x,r.y),0===e&&s.copy(r);break;case"H":m=a(p);for(let e=0,i=m.length;e<i;e++)r.x=m[e],n.x=r.x,n.y=r.y,t.lineTo(r.x,r.y),0===e&&!0===c&&s.copy(r);break;case"V":m=a(p);for(let e=0,i=m.length;e<i;e++)r.y=m[e],n.x=r.x,n.y=r.y,t.lineTo(r.x,r.y),0===e&&!0===c&&s.copy(r);break;case"L":m=a(p);for(let e=0,i=m.length;e<i;e+=2)r.x=m[e+0],r.y=m[e+1],n.x=r.x,n.y=r.y,t.lineTo(r.x,r.y),0===e&&!0===c&&s.copy(r);break;case"C":m=a(p);for(let e=0,i=m.length;e<i;e+=6)t.bezierCurveTo(m[e+0],m[e+1],m[e+2],m[e+3],m[e+4],m[e+5]),n.x=m[e+2],n.y=m[e+3],r.x=m[e+4],r.y=m[e+5],0===e&&!0===c&&s.copy(r);break;case"S":m=a(p);for(let e=0,i=m.length;e<i;e+=4)t.bezierCurveTo(o(r.x,n.x),o(r.y,n.y),m[e+0],m[e+1],m[e+2],m[e+3]),n.x=m[e+0],n.y=m[e+1],r.x=m[e+2],r.y=m[e+3],0===e&&!0===c&&s.copy(r);break;case"Q":m=a(p);for(let e=0,i=m.length;e<i;e+=4)t.quadraticCurveTo(m[e+0],m[e+1],m[e+2],m[e+3]),n.x=m[e+0],n.y=m[e+1],r.x=m[e+2],r.y=m[e+3],0===e&&!0===c&&s.copy(r);break;case"T":m=a(p);for(let e=0,i=m.length;e<i;e+=2){const i=o(r.x,n.x),a=o(r.y,n.y);t.quadraticCurveTo(i,a,m[e+0],m[e+1]),n.x=i,n.y=a,r.x=m[e+0],r.y=m[e+1],0===e&&!0===c&&s.copy(r)}break;case"A":m=a(p,[3,4],7);for(let e=0,o=m.length;e<o;e+=7){if(m[e+5]==r.x&&m[e+6]==r.y)continue;const o=r.clone();r.x=m[e+5],r.y=m[e+6],n.x=r.x,n.y=r.y,i(t,m[e],m[e+1],m[e+2],m[e+3],m[e+4],o,r),0===e&&!0===c&&s.copy(r)}break;case"m":m=a(p);for(let e=0,i=m.length;e<i;e+=2)r.x+=m[e+0],r.y+=m[e+1],n.x=r.x,n.y=r.y,0===e?t.moveTo(r.x,r.y):t.lineTo(r.x,r.y),0===e&&s.copy(r);break;case"h":m=a(p);for(let e=0,i=m.length;e<i;e++)r.x+=m[e],n.x=r.x,n.y=r.y,t.lineTo(r.x,r.y),0===e&&!0===c&&s.copy(r);break;case"v":m=a(p);for(let e=0,i=m.length;e<i;e++)r.y+=m[e],n.x=r.x,n.y=r.y,t.lineTo(r.x,r.y),0===e&&!0===c&&s.copy(r);break;case"l":m=a(p);for(let e=0,i=m.length;e<i;e+=2)r.x+=m[e+0],r.y+=m[e+1],n.x=r.x,n.y=r.y,t.lineTo(r.x,r.y),0===e&&!0===c&&s.copy(r);break;case"c":m=a(p);for(let e=0,i=m.length;e<i;e+=6)t.bezierCurveTo(r.x+m[e+0],r.y+m[e+1],r.x+m[e+2],r.y+m[e+3],r.x+m[e+4],r.y+m[e+5]),n.x=r.x+m[e+2],n.y=r.y+m[e+3],r.x+=m[e+4],r.y+=m[e+5],0===e&&!0===c&&s.copy(r);break;case"s":m=a(p);for(let e=0,i=m.length;e<i;e+=4)t.bezierCurveTo(o(r.x,n.x),o(r.y,n.y),r.x+m[e+0],r.y+m[e+1],r.x+m[e+2],r.y+m[e+3]),n.x=r.x+m[e+0],n.y=r.y+m[e+1],r.x+=m[e+2],r.y+=m[e+3],0===e&&!0===c&&s.copy(r);break;case"q":m=a(p);for(let e=0,i=m.length;e<i;e+=4)t.quadraticCurveTo(r.x+m[e+0],r.y+m[e+1],r.x+m[e+2],r.y+m[e+3]),n.x=r.x+m[e+0],n.y=r.y+m[e+1],r.x+=m[e+2],r.y+=m[e+3],0===e&&!0===c&&s.copy(r);break;case"t":m=a(p);for(let e=0,i=m.length;e<i;e+=2){const i=o(r.x,n.x),a=o(r.y,n.y);t.quadraticCurveTo(i,a,r.x+m[e+0],r.y+m[e+1]),n.x=i,n.y=a,r.x=r.x+m[e+0],r.y=r.y+m[e+1],0===e&&!0===c&&s.copy(r)}break;case"a":m=a(p,[3,4],7);for(let e=0,o=m.length;e<o;e+=7){if(0==m[e+5]&&0==m[e+6])continue;const o=r.clone();r.x+=m[e+5],r.y+=m[e+6],n.x=r.x,n.y=r.y,i(t,m[e],m[e+1],m[e+2],m[e+3],m[e+4],o,r),0===e&&!0===c&&s.copy(r)}break;case"Z":case"z":t.currentPath.autoClose=!0,t.currentPath.curves.length>0&&(r.copy(s),t.currentPath.currentPoint.copy(r),l=!0);break;default:console.warn(d)}c=!1}return t}(t));break;case"rect":r=n(t,r),$=function(e){const t=c(e.getAttribute("x")||0),i=c(e.getAttribute("y")||0),r=c(e.getAttribute("rx")||e.getAttribute("ry")||0),n=c(e.getAttribute("ry")||e.getAttribute("rx")||0),o=c(e.getAttribute("width")),a=c(e.getAttribute("height")),s=.448084975506,l=new(0,$4xklQ.ShapePath);l.moveTo(t+r,i),l.lineTo(t+o-r,i),(0!==r||0!==n)&&l.bezierCurveTo(t+o-r*s,i,t+o,i+n*s,t+o,i+n);l.lineTo(t+o,i+a-n),(0!==r||0!==n)&&l.bezierCurveTo(t+o,i+a-n*s,t+o-r*s,i+a,t+o-r,i+a);l.lineTo(t+r,i+a),(0!==r||0!==n)&&l.bezierCurveTo(t+r*s,i+a,t,i+a-n*s,t,i+a-n);l.lineTo(t,i+n),(0!==r||0!==n)&&l.bezierCurveTo(t,i+n*s,t+r*s,i,t+r,i);return l}(t);break;case"polygon":r=n(t,r),$=function(e){function t(e,t,i){const o=c(t),a=c(i);0===n?r.moveTo(o,a):r.lineTo(o,a),n++}const i=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,r=new(0,$4xklQ.ShapePath);let n=0;return e.getAttribute("points").replace(i,t),r.currentPath.autoClose=!0,r}(t);break;case"polyline":r=n(t,r),$=function(e){function t(e,t,i){const o=c(t),a=c(i);0===n?r.moveTo(o,a):r.lineTo(o,a),n++}const i=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,r=new(0,$4xklQ.ShapePath);let n=0;return e.getAttribute("points").replace(i,t),r.currentPath.autoClose=!1,r}(t);break;case"circle":r=n(t,r),$=function(e){const t=c(e.getAttribute("cx")||0),i=c(e.getAttribute("cy")||0),r=c(e.getAttribute("r")||0),n=new(0,$4xklQ.Path);n.absarc(t,i,r,0,2*Math.PI);const o=new(0,$4xklQ.ShapePath);return o.subPaths.push(n),o}(t);break;case"ellipse":r=n(t,r),$=function(e){const t=c(e.getAttribute("cx")||0),i=c(e.getAttribute("cy")||0),r=c(e.getAttribute("rx")||0),n=c(e.getAttribute("ry")||0),o=new(0,$4xklQ.Path);o.absellipse(t,i,r,n,0,2*Math.PI);const a=new(0,$4xklQ.ShapePath);return a.subPaths.push(o),a}(t);break;case"line":r=n(t,r),$=function(e){const t=c(e.getAttribute("x1")||0),i=c(e.getAttribute("y1")||0),r=c(e.getAttribute("x2")||0),n=c(e.getAttribute("y2")||0),o=new(0,$4xklQ.ShapePath);return o.moveTo(t,i),o.lineTo(r,n),o.currentPath.autoClose=!1,o}(t);break;case"defs":l=!0;break;case"use":r=n(t,r);const s=(t.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),h=t.viewportElement.getElementById(s);h?e(h,r):console.warn("SVGLoader: 'use node' references non-existent node id: "+s)}$&&(void 0!==r.fill&&"none"!==r.fill&&$.color.setStyle(r.fill),function(e,t){function i(e){w.set(e.x,e.y,1).applyMatrix3(t),e.set(w.x,w.y)}const r=function(e){return 0!==e.elements[1]||0!==e.elements[3]}(t),n=e.subPaths;for(let e=0,o=n.length;e<o;e++){const o=n[e].curves;for(let e=0;e<o.length;e++){const n=o[e];n.isLineCurve?(i(n.v1),i(n.v2)):n.isCubicBezierCurve?(i(n.v0),i(n.v1),i(n.v2),i(n.v3)):n.isQuadraticBezierCurve?(i(n.v0),i(n.v1),i(n.v2)):n.isEllipseCurve&&(r&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),y.set(n.aX,n.aY),i(y),n.aX=y.x,n.aY=y.y,n.xRadius*=h(t),n.yRadius*=d(t))}}}($,v),u.push($),$.userData={node:t,style:r});const M=t.childNodes;for(let t=0;t<M.length;t++){const i=M[t];l&&"style"!==i.nodeName&&"defs"!==i.nodeName||e(i,r)}s&&(m.pop(),m.length>0?v.copy(m[m.length-1]):v.identity())}($.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4});return{paths:u,xml:$.documentElement}}static createShapes(e){const t=999999999,i=0,r=1,n=2,o=3,a=4,s=5,l=6,c={loc:i,t:0};function h(e,t,r,o){const a=e.x,s=t.x,l=r.x,h=o.x,u=e.y,p=t.y,m=r.y,f=o.y,g=(h-l)*(u-m)-(f-m)*(a-l),x=(f-m)*(s-a)-(h-l)*(p-u),b=g/x,y=((s-a)*(u-m)-(p-u)*(a-l))/x;if(0===x&&0!==g||b<=0||b>=1||y<0||y>1)return null;if(0===g&&0===x){for(let l=0;l<2;l++){if(d(0===l?r:o,e,t),c.loc==i){const e=0===l?r:o;return{x:e.x,y:e.y,t:c.t}}if(c.loc==n){return{x:+(a+c.t*(s-a)).toPrecision(10),y:+(u+c.t*(p-u)).toPrecision(10),t:c.t}}}return null}for(let n=0;n<2;n++)if(d(0===n?r:o,e,t),c.loc==i){const e=0===n?r:o;return{x:e.x,y:e.y,t:c.t}}return{x:+(a+b*(s-a)).toPrecision(10),y:+(u+b*(p-u)).toPrecision(10),t:b}}function d(e,t,h){const d=h.x-t.x,u=h.y-t.y,p=e.x-t.x,m=e.y-t.y,f=d*m-p*u;if(e.x===t.x&&e.y===t.y)return c.loc=i,void(c.t=0);if(e.x===h.x&&e.y===h.y)return c.loc=r,void(c.t=1);if(f<-Number.EPSILON)return void(c.loc=o);if(f>Number.EPSILON)return void(c.loc=a);if(d*p<0||u*m<0)return void(c.loc=s);if(Math.sqrt(d*d+u*u)<Math.sqrt(p*p+m*m))return void(c.loc=l);let g;g=0!==d?p/d:m/u,c.loc=n,c.t=g}function u(e,t,i){const r=new(0,$4xklQ.Vector2);t.getCenter(r);const n=[];return i.forEach((t=>{if(t.boundingBox.containsPoint(r)){(function(e,t){const i=[],r=[];for(let n=1;n<e.length;n++){const o=e[n-1],a=e[n];for(let e=1;e<t.length;e++){const n=h(o,a,t[e-1],t[e]);null!==n&&void 0===i.find((e=>e.t<=n.t+Number.EPSILON&&e.t>=n.t-Number.EPSILON))&&(i.push(n),r.push(new(0,$4xklQ.Vector2)(n.x,n.y)))}}return r})(e,t.points).forEach((e=>{n.push({identifier:t.identifier,isCW:t.isCW,point:e})}))}})),n.sort(((e,t)=>e.point.x-t.point.x)),n}let p=0,m=t,f=-999999999,g=e.subPaths.map((e=>{const i=e.getPoints();let r=-999999999,n=t,o=-999999999,a=t;for(let e=0;e<i.length;e++){const t=i[e];t.y>r&&(r=t.y),t.y<n&&(n=t.y),t.x>o&&(o=t.x),t.x<a&&(a=t.x)}return f<=o&&(f=o+1),m>=a&&(m=a-1),{curves:e.curves,points:i,isCW:$4xklQ.ShapeUtils.isClockWise(i),identifier:p++,boundingBox:new(0,$4xklQ.Box2)(new(0,$4xklQ.Vector2)(a,n),new(0,$4xklQ.Vector2)(o,r))}}));g=g.filter((e=>e.points.length>1));const x=g.map((t=>function(e,t,i,r,n){null!=n&&""!==n||(n="nonzero");const o=new(0,$4xklQ.Vector2);e.boundingBox.getCenter(o);const a=u([new(0,$4xklQ.Vector2)(i,o.y),new(0,$4xklQ.Vector2)(r,o.y)],e.boundingBox,t);a.sort(((e,t)=>e.point.x-t.point.x));const s=[],l=[];a.forEach((t=>{t.identifier===e.identifier?s.push(t):l.push(t)}));const c=s[0].point.x,h=[];let d=0;for(;d<l.length&&l[d].point.x<c;)h.length>0&&h[h.length-1]===l[d].identifier?h.pop():h.push(l[d].identifier),d++;if(h.push(e.identifier),"evenodd"===n){const t=h.length%2==0,i=h[h.length-2];return{identifier:e.identifier,isHole:t,for:i}}if("nonzero"===n){let i=!0,r=null,n=null;for(let e=0;e<h.length;e++){const o=h[e];i?(n=t[o].isCW,i=!1,r=o):n!==t[o].isCW&&(n=t[o].isCW,i=!0)}return{identifier:e.identifier,isHole:i,for:r}}console.warn('fill-rule: "'+n+'" is currently not implemented.')}(t,g,m,f,e.userData?.style.fillRule))),b=[];return g.forEach((e=>{if(!x[e.identifier].isHole){const t=new(0,$4xklQ.Shape);t.curves=e.curves;x.filter((t=>t.isHole&&t.for===e.identifier)).forEach((e=>{const i=g[e.identifier],r=new(0,$4xklQ.Path);r.curves=i.curves,t.holes.push(r)})),b.push(t)}})),b}static getStrokeStyle(e,t,i,r,n){return{strokeColor:t=void 0!==t?t:"#000",strokeWidth:e=void 0!==e?e:1,strokeLineJoin:i=void 0!==i?i:"miter",strokeLineCap:r=void 0!==r?r:"butt",strokeMiterLimit:n=void 0!==n?n:4}}static pointsToStroke(e,t,i,r){const n=[],o=[],a=[];if(0===$22831dcc74231be4$export$959ae9097e74a233.pointsToStrokeWithBuffers(e,t,i,r,n,o,a))return null;const s=new(0,$4xklQ.BufferGeometry);return s.setAttribute("position",new(0,$4xklQ.Float32BufferAttribute)(n,3)),s.setAttribute("normal",new(0,$4xklQ.Float32BufferAttribute)(o,3)),s.setAttribute("uv",new(0,$4xklQ.Float32BufferAttribute)(a,2)),s}static pointsToStrokeWithBuffers(e,t,i,r,n,o,a,s){const l=new(0,$4xklQ.Vector2),c=new(0,$4xklQ.Vector2),h=new(0,$4xklQ.Vector2),d=new(0,$4xklQ.Vector2),u=new(0,$4xklQ.Vector2),p=new(0,$4xklQ.Vector2),m=new(0,$4xklQ.Vector2),f=new(0,$4xklQ.Vector2),g=new(0,$4xklQ.Vector2),x=new(0,$4xklQ.Vector2),b=new(0,$4xklQ.Vector2),y=new(0,$4xklQ.Vector2),w=new(0,$4xklQ.Vector2),v=new(0,$4xklQ.Vector2),$=new(0,$4xklQ.Vector2),M=new(0,$4xklQ.Vector2),S=new(0,$4xklQ.Vector2);i=void 0!==i?i:12,r=void 0!==r?r:.001,s=void 0!==s?s:0;const P=(e=function(e){let t=!1;for(let i=1,n=e.length-1;i<n;i++)if(e[i].distanceTo(e[i+1])<r){t=!0;break}if(!t)return e;const i=[];i.push(e[0]);for(let t=1,n=e.length-1;t<n;t++)e[t].distanceTo(e[t+1])>=r&&i.push(e[t]);return i.push(e[e.length-1]),i}(e)).length;if(P<2)return 0;const k=e[0].equals(e[P-1]);let _,T,C=e[0];const A=t.strokeWidth/2,D=1/(P-1);let R,E,L,I,B=0,V=!1,O=0,W=3*s,H=2*s;F(e[0],e[1],l).multiplyScalar(A),f.copy(e[0]).sub(l),g.copy(e[0]).add(l),x.copy(f),b.copy(g);for(let i=1;i<P;i++){_=e[i],T=i===P-1?k?e[1]:void 0:e[i+1];const r=l;if(F(C,_,r),h.copy(r).multiplyScalar(A),y.copy(_).sub(h),w.copy(_).add(h),R=B+D,E=!1,void 0!==T){F(_,T,c),h.copy(c).multiplyScalar(A),v.copy(_).sub(h),$.copy(_).add(h),L=!0,h.subVectors(T,C),r.dot(h)<0&&(L=!1),1===i&&(V=L),h.subVectors(T,_),h.normalize();const e=Math.abs(r.dot(h));if(e>Number.EPSILON){const i=A/e;h.multiplyScalar(-i),d.subVectors(_,C),u.copy(d).setLength(i).add(h),M.copy(u).negate();const r=u.length(),n=d.length();d.divideScalar(n),p.subVectors(T,_);const o=p.length();switch(p.divideScalar(o),d.dot(M)<n&&p.dot(M)<o&&(E=!0),S.copy(u).add(_),M.add(_),I=!1,E?L?($.copy(M),w.copy(M)):(v.copy(M),y.copy(M)):G(),t.strokeLineJoin){case"bevel":N(L,E,R);break;case"round":U(L,E),L?z(_,y,v,R,0):z(_,$,w,R,1);break;default:const e=A*t.strokeMiterLimit/r;if(e<1){if("miter-clip"!==t.strokeLineJoin){N(L,E,R);break}U(L,E),L?(p.subVectors(S,y).multiplyScalar(e).add(y),m.subVectors(S,v).multiplyScalar(e).add(v),Q(y,R,0),Q(p,R,0),Q(_,R,.5),Q(_,R,.5),Q(p,R,0),Q(m,R,0),Q(_,R,.5),Q(m,R,0),Q(v,R,0)):(p.subVectors(S,w).multiplyScalar(e).add(w),m.subVectors(S,$).multiplyScalar(e).add($),Q(w,R,1),Q(p,R,1),Q(_,R,.5),Q(_,R,.5),Q(p,R,1),Q(m,R,1),Q(_,R,.5),Q(m,R,1),Q($,R,1))}else E?(L?(Q(g,B,1),Q(f,B,0),Q(S,R,0),Q(g,B,1),Q(S,R,0),Q(M,R,1)):(Q(g,B,1),Q(f,B,0),Q(S,R,1),Q(f,B,0),Q(M,R,0),Q(S,R,1)),L?v.copy(S):$.copy(S)):L?(Q(y,R,0),Q(S,R,0),Q(_,R,.5),Q(_,R,.5),Q(S,R,0),Q(v,R,0)):(Q(w,R,1),Q(S,R,1),Q(_,R,.5),Q(_,R,.5),Q(S,R,1),Q($,R,1)),I=!0}}else G()}else G();k||i!==P-1||j(e[0],x,b,L,!0,B),B=R,C=_,f.copy(v),g.copy($)}if(k){if(E&&n){let e=S,t=M;V!==L&&(e=M,t=S),L?(I||V)&&(t.toArray(n,0),t.toArray(n,9),I&&e.toArray(n,3)):!I&&V||(t.toArray(n,3),t.toArray(n,9),I&&e.toArray(n,0))}}else j(_,y,w,L,!1,R);return O;function F(e,t,i){return i.subVectors(t,e),i.set(-i.y,i.x).normalize()}function Q(e,t,i){n&&(n[W]=e.x,n[W+1]=e.y,n[W+2]=0,o&&(o[W]=0,o[W+1]=0,o[W+2]=1),W+=3,a&&(a[H]=t,a[H+1]=i,H+=2)),O+=3}function z(e,t,r,n,o){l.copy(t).sub(e).normalize(),c.copy(r).sub(e).normalize();let a=Math.PI;const s=l.dot(c);Math.abs(s)<1&&(a=Math.abs(Math.acos(s))),a/=i,h.copy(t);for(let t=0,r=i-1;t<r;t++)d.copy(h).rotateAround(e,a),Q(h,n,o),Q(d,n,o),Q(e,n,.5),h.copy(d);Q(d,n,o),Q(r,n,o),Q(e,n,.5)}function G(){Q(g,B,1),Q(f,B,0),Q(y,R,0),Q(g,B,1),Q(y,R,1),Q(w,R,0)}function N(e,t,i){t?e?(Q(g,B,1),Q(f,B,0),Q(y,R,0),Q(g,B,1),Q(y,R,0),Q(M,R,1),Q(y,i,0),Q(v,i,0),Q(M,i,.5)):(Q(g,B,1),Q(f,B,0),Q(w,R,1),Q(f,B,0),Q(M,R,0),Q(w,R,1),Q(w,i,1),Q($,i,0),Q(M,i,.5)):e?(Q(y,i,0),Q(v,i,0),Q(_,i,.5)):(Q(w,i,1),Q($,i,0),Q(_,i,.5))}function U(e,t){t&&(e?(Q(g,B,1),Q(f,B,0),Q(y,R,0),Q(g,B,1),Q(y,R,0),Q(M,R,1),Q(y,B,0),Q(_,R,.5),Q(M,R,1),Q(_,R,.5),Q(v,B,0),Q(M,R,1)):(Q(g,B,1),Q(f,B,0),Q(w,R,1),Q(f,B,0),Q(M,R,0),Q(w,R,1),Q(w,B,1),Q(M,R,0),Q(_,R,.5),Q(_,R,.5),Q(M,R,0),Q($,B,1)))}function j(e,i,r,o,a,s){switch(t.strokeLineCap){case"round":a?z(e,r,i,s,.5):z(e,i,r,s,.5);break;case"square":if(a)l.subVectors(i,e),c.set(l.y,-l.x),h.addVectors(l,c).add(e),d.subVectors(c,l).add(e),o?(h.toArray(n,3),d.toArray(n,0),d.toArray(n,9)):(h.toArray(n,3),h.toArray(n,9),d.toArray(n,0));else{l.subVectors(r,e),c.set(l.y,-l.x),h.addVectors(l,c).add(e),d.subVectors(c,l).add(e);const t=n.length;o?(h.toArray(n,t-3),d.toArray(n,t-6),d.toArray(n,t-12)):(h.toArray(n,t-6),d.toArray(n,t-3),d.toArray(n,t-12))}}}}}class $b47acdbb1ebb3974$export$72fae0e7761deb0c{constructor(e){this.Tween=new $0a029741d8f7787c$export$208a41d6b4e37b97,this.Tween.onUpdate((e=>{console.log(e.x,e.y,e.z),this.camBase.position.set(e.x,e.y,e.z),this.editor.miniCamera.position.x=1e3*this.camBase.position.x,this.editor.miniCamera.position.y=1e3*-this.camBase.position.z,this.tmpCone&&e.x==this.tmpCone.position.x&&e.z==this.tmpCone.position.z&&(this.editor.scene.remove(this.tmpCone),this.tmpCone.geometry.dispose(),this.tmpCone=null)})),this.rotate=!1,this.viewport=e,this.editor=e.editor,this.camera=this.editor.camera,this.cameraRotX=new(0,$4xklQ.Object3D),this.cameraRotX.name="cameraRotX",this.cameraRotY=new(0,$4xklQ.Object3D),this.cameraRotY.name="cameraRotY",this.camBase=new(0,$4xklQ.Object3D),this.camBase.name="camBase",this.originPosition=this.camera.position.clone(),this.originPosition.y=1.7,this.camera.position.set(0,0,0),this.cameraRotX.add(this.camera),this.cameraRotY.add(this.cameraRotX),this.camBase.add(this.cameraRotY),this.setPosition(this.originPosition),this.camera.lookAt(new(0,$4xklQ.Vector3)(1,1.7,0)),this.camera.realPosition=this.camBase.position,this.camera.realRotation=[this.cameraRotY.rotation,this.cameraRotX.rotation],this.tmpVec=new(0,$4xklQ.Vector3),this.moveSpeed=.02,this.keyPress={},this.ray=new $4xklQ.Ray,this.canMove=!1,this.rayCaster=new $4xklQ.Raycaster,this.handleListener(e.container),this.firstPosition=new(0,$4xklQ.Vector2),this.XcountOffset=0,this.YcountOffset=0,this.countXBegin=0,this.countYBegin=0,this.countZBegin=0,this.Xcount=0,this.Ycount=0,this.Zcount=0,this.createMinMap(),this.activeFlag=!0}active(){this.activeFlag=!0,this.editor.miniCamera.visible=!0}deactive(){this.activeFlag=!1,this.editor.miniCamera.visible=!1}handleListener(e){if(this.mouseDownHandler=this.onCanvasMouseDown.bind(this),this.mouseUpHandler=this.onCanvasMouseUp.bind(this),this.mouseMoveHandler=this.onCanvasMouseMove.bind(this),this.mouseWheelHandler=this.OnMousewheel.bind(this),this.editor.roamTool){let t=this.editor.roamTool;e.removeEventListener("mousedown",t.mouseDownHandler),e.removeEventListener("mouseup",t.mouseUpHandler),e.removeEventListener("mousemove",t.mouseMoveHandler),e.removeEventListener("wheel",t.mouseWheelHandler)}e.addEventListener("mousedown",this.mouseDownHandler,!1),e.addEventListener("mouseup",this.mouseUpHandler,!1),e.addEventListener("mousemove",this.mouseMoveHandler,!1),e.addEventListener("wheel",this.mouseWheelHandler,!1),e.addEventListener("contextmenu",this.OnForbidden.bind(this),!0)}OnForbidden(e){e.preventDefault()}onCanvasMouseDown(e){e.preventDefault();let t=new(0,$4xklQ.Vector2);t.x=e.clientX/window.innerWidth*2-1,t.y=-e.clientY/window.innerHeight*2+1,this.getIntersect3(t),console.log("---------------------------------------------------------------------"),console.log(this.cameraRotX.rotation.x,this.cameraRotX.rotation.y,this.cameraRotX.rotation.z),console.log(this.cameraRotY.rotation.x,this.cameraRotY.rotation.y,this.cameraRotY.rotation.z),console.log(this.camera.rotation.x,this.camera.rotation.y,this.camera.rotation.z),console.log("---------------------------------------------------------------------"),this.camera&&(this.rotate=!0,this.countXBegin=this.cameraRotX.rotation.z,this.countYBegin=this.cameraRotY.rotation.y,this.XcountOffset=0,this.YcountOffset=0,this.firstPosition=new(0,$4xklQ.Vector2)(e.clientX,e.clientY),this.updateCamera())}createCone(){this.tmpCone&&(this.editor.scene.remove(this.tmpCone),this.tmpCone.geometry.dispose(),this.tmpCone=null,console.log("A tween stop"),this.Tween.stop());let e=new $4xklQ.ConeGeometry(.05,.15,32),t=new $4xklQ.Mesh(e,new $4xklQ.MeshBasicMaterial({color:16711680}));t.layers.mask=6,this.editor.scene.add(t),t.rotation.x=Math.PI,t.position.y=.075,this.tmpCone=t}onCanvasMouseUp(e){e.preventDefault(),this.rotate=!1,this.updateCamera()}onCanvasMouseMove(e){e.preventDefault(),this.rotate&&(this.XcountOffset=this.firstPosition.y-e.clientY,this.YcountOffset=this.firstPosition.x-e.clientX),this.updateCamera()}OnMousewheel(e){e.preventDefault();let t=this.getRadian(),i=Math.sin(t)*e.wheelDelta/1e3,r=Math.cos(t)*e.wheelDelta/1e3,n=new(0,$4xklQ.Vector3)(i,0,r);this.canMove=!0,this.getIntersect2(n),this.canMove&&(this.camBase.position.add(n),this.editor.miniCamera.position.x=1e3*this.camBase.position.x,this.editor.miniCamera.position.y=1e3*this.camBase.position.z)}getIntersect(e){let t=this.getRadian();e||=new(0,$4xklQ.Vector3)(Math.sin(t),0,Math.cos(t)).normalize(),this.ray.set(this.camBase.position,e);let i,r,n=1/0;return this.editor.wallGroup3D.children.forEach(((e,t)=>{let o=new(0,$4xklQ.Vector3),a=new(0,$4xklQ.Vector3);this.ray.distanceSqToSegment(new(0,$4xklQ.Vector3)(e.startPoint.x,0,e.startPoint.y),new(0,$4xklQ.Vector3)(e.endPoint.x,0,e.endPoint.y),o,a);let s=a.distanceTo(o);s<n&&(n=s,i=t,r=o)})),{rayVec:e,minDist:n,minIndex:i,minPoint:r}}getIntersect2(e,t=!1){this.ray.set(this.camBase.localToWorld(this.camera.position.clone()),e);let i=Array.from(this.editor.wallGroup3D.children);i=i.concat(this.editor.floorGroup2d.children);for(let e=0;e<i.length;e++){let r=i[e];if("3DWall"==r.modelType||"floor"==r.useType){let e=Array.from(r.geometry.attributes.position.array);if(r.geometry.index){let i=Array.from(r.geometry.index.array);for(let n=0;n<i.length/3;n++){let o=new(0,$4xklQ.Vector3),a=new(0,$4xklQ.Vector3)(e[3*i[3*n]],e[3*i[3*n]+1],e[3*i[3*n]+2]),s=new(0,$4xklQ.Vector3)(e[3*i[3*n+1]],e[3*i[3*n+1]+1],e[3*i[3*n+1]+2]),l=new(0,$4xklQ.Vector3)(e[3*i[3*n+2]],e[3*i[3*n+2]+1],e[3*i[3*n+2]+2]);if(a=r.localToWorld(a),s=r.localToWorld(s),l=r.localToWorld(l),"floor"==r.useType&&(a=new(0,$4xklQ.Vector3)(a.x/1e3,a.z/1e3,-a.y/1e3),s=new(0,$4xklQ.Vector3)(s.x/1e3,s.z/1e3,-s.y/1e3),l=new(0,$4xklQ.Vector3)(l.x/1e3,l.z/1e3,-l.y/1e3)),this.ray.intersectTriangle(a,s,l,!0,o),!o.equals(new(0,$4xklQ.Vector3))){let e=this.camBase.position.distanceTo(o);if(t)return{point:o,obj:r};e<.3&&(this.canMove=!1)}}}else for(let i=0;i<e.length/9;i++){let n=new(0,$4xklQ.Vector3),o=new(0,$4xklQ.Vector3)(e[9*i],e[9*i+1],e[9*i+2]),a=new(0,$4xklQ.Vector3)(e[9*i+3],e[9*i+4],e[9*i+5]),s=new(0,$4xklQ.Vector3)(e[9*i+6],e[9*i+7],e[9*i+8]);if(o=r.localToWorld(o),a=r.localToWorld(a),s=r.localToWorld(s),this.ray.intersectTriangle(o,a,s,!0,n),!n.equals(new(0,$4xklQ.Vector3))){let e=this.camBase.position.distanceTo(n);if(t)return{point:n,obj:r};e<.3&&(this.canMove=!1)}}}}}getIntersect3(e){this.rayCaster.setFromCamera(e,this.camera);let t=this.getIntersect2(this.rayCaster.ray.direction,!0);t&&0==t.point.y&&(this.createCone(),this.tmpCone.position.x=t.point.x,this.tmpCone.position.z=t.point.z,this.tween(this.camBase.position,new(0,$4xklQ.Vector3)(t.point.x,this.camBase.position.y,t.point.z)))}tween(e,t){this.Tween._object={x:e.x,y:e.y,z:e.z},this.Tween._valuesStart={x:e.x,y:e.y,z:e.z};let i=this.cameraRot(e,t);this.Tween.to({x:t.x,y:t.y,z:t.z},i).start()}cameraRot(e,t){let i=t.distanceTo(e)/this.moveSpeed/3*10,r=new(0,$4xklQ.Vector2)(t.z,t.x).sub(new(0,$4xklQ.Vector2)(e.z,e.x)).angle();r-=Math.PI/2;let n=r-(this.cameraRotY.rotation.y<0?2*Math.PI+this.cameraRotY.rotation.y%(2*Math.PI):this.cameraRotY.rotation.y%(2*Math.PI));Math.abs(n)>Math.PI&&(n<0?n=2*Math.PI+n:n-=2*Math.PI);let o=10*Math.round(i/50);for(let e=0;e<o;e++)setTimeout((()=>{this.cameraRotY.rotation.y+=n/o,this.editor.miniCamera.rotation.z=this.cameraRotY.rotation.y}),5*e);return i}getRadian(){return this.camera.getWorldDirection(this.tmpVec),Math.atan2(this.tmpVec.x,this.tmpVec.z)}updateCamera(){this.camera&&this.setUpdateState()}setUpdateState(){this.Xcount=this.countXBegin+10*Math.asin(this.XcountOffset/window.innerHeight/2),this.Ycount=this.countYBegin+10*Math.asin(this.YcountOffset/window.innerWidth/2),this.Zcount=this.countZBegin}onKeyDown(e){if(console.log("A---------------------------------------------------------------------"),console.log(this.cameraRotX.rotation.x,this.cameraRotX.rotation.y,this.cameraRotX.rotation.z),console.log(this.cameraRotY.rotation.x,this.cameraRotY.rotation.y,this.cameraRotY.rotation.z),console.log(this.camera.rotation.x,this.camera.rotation.y,this.camera.rotation.z),console.log("---------------------------------------------------------------------"),-1!=["w","a","s","d","q","e","W","A","S","D","Q","E","Shift"].indexOf(e.key)&&(e.preventDefault(),this.keyPress[e.key.toLowerCase()]=!0),32==e.keyCode&&(this.camBase.position.set(this.originPosition.x,17,this.originPosition.z),this.cameraRotX.rotation.z=-Math.PI/2,this.camera.rotation.y=-Math.PI/2,console.log(this.camera.rotation)),e.keyCode>48&&e.keyCode<=48+this.editor.floorGroup2d.children.length){let t=this.editor.floorGroup2d.children[e.keyCode-49].roomCenter,i=new(0,$4xklQ.Vector3)(Number(t[0])/1e3,1.7,-Number(t[1])/1e3),r=this.camBase.position.distanceTo(i)/this.moveSpeed/3*10,n=-this.cameraRotX.rotation.z,o=10*Math.round(r/50);for(let e=0;e<o;e++)setTimeout((()=>{this.cameraRotX.rotation.z+=n/o,this.editor.miniCamera.rotation.z=this.cameraRotY.rotation.y}),5*e);this.cameraRot((new(0,$4xklQ.Vector3)).copy(this.camBase.position),i.clone()),this.Tween&&this.Tween.stop(),console.log(this.camBase.position.x,this.camBase.position.y,this.camBase.position.z),console.log(i.x,i.y,i.z),this.Tween._object={x:this.camBase.position.x,y:this.camBase.position.y,z:this.camBase.position.z},this.Tween._valuesStart={x:this.camBase.position.x,y:this.camBase.position.y,z:this.camBase.position.z},this.Tween.to({x:i.x,y:i.y,z:i.z},r).start(),this.camBase.position.copy(i)}this.canMove=!0,console.log("B---------------------------------------------------------------------"),console.log(this.cameraRotX.rotation.x,this.cameraRotX.rotation.y,this.cameraRotX.rotation.z),console.log(this.cameraRotY.rotation.x,this.cameraRotY.rotation.y,this.cameraRotY.rotation.z),console.log(this.camera.rotation.x,this.camera.rotation.y,this.camera.rotation.z),console.log("---------------------------------------------------------------------")}onKeyUp(e){-1!=["w","a","s","d","q","e","W","A","S","D","Q","E","Shift"].indexOf(e.key)&&(e.preventDefault(),this.keyPress[e.key.toLowerCase()]=!1),this.canMove=this.keyPress.w||this.keyPress.a||this.keyPress.s||this.keyPress.d||this.keyPress.q||this.keyPress.e}needUpdate(){if(this.activeFlag&&(this.rotate&&(this.camBase.position.y<=2.8&&(this.camera.rotation.y=-Math.PI/2),this.Xcount=$4xklQ.MathUtils.clamp(this.Xcount,-.7,.7),this.cameraRotX.rotation.z=this.Xcount,this.cameraRotY.rotation.y=this.Ycount,this.editor.miniCamera.rotation.z=this.cameraRotY.rotation.y),this.canMove)){this.tmpCone&&(this.editor.scene.remove(this.tmpCone),this.tmpCone.geometry.dispose(),this.tmpCone=null,console.log("C tween stop"),this.Tween.stop());let e=this.getRadian(),t=this.keyPress.shift?2:1,i=Math.sin(e)*this.moveSpeed*t,r=Math.cos(e)*this.moveSpeed*t,n=new(0,$4xklQ.Vector3);this.keyPress.w&&n.add(new(0,$4xklQ.Vector3)(i,0,r)),this.keyPress.a&&n.add(new(0,$4xklQ.Vector3)(r,0,-i)),this.keyPress.s&&n.add(new(0,$4xklQ.Vector3)(-i,0,-r)),this.keyPress.d&&n.add(new(0,$4xklQ.Vector3)(-r,0,i)),this.keyPress.q&&this.camBase.position.y<2.55&&n.add(new(0,$4xklQ.Vector3)(0,this.moveSpeed,0)),this.keyPress.e&&this.camBase.position.y>.05&&n.add(new(0,$4xklQ.Vector3)(0,-this.moveSpeed,0)),this.getIntersect2(n),this.canMove&&(this.camBase.position.add(n),this.editor.miniCamera.position.x=1e3*this.camBase.position.x,this.editor.miniCamera.position.y=1e3*-this.camBase.position.z)}}restore(e,t){this.setPosition(e),this.cameraRotY.rotation.y=t.y,this.cameraRotX.rotation.z=t.z,this.editor.miniCamera.rotation.z=this.cameraRotY.rotation.y,this.editor.miniCamera.position.x=1e3*this.camBase.position.x,this.editor.miniCamera.position.y=1e3*-this.camBase.position.z,this.camera.rotation.y=e.y>2.8?-Math.PI/2:0,console.log(this.camera.rotation.x,this.camera.rotation.y,this.camera.rotation.z),console.log(this.cameraRotX.rotation.x,this.cameraRotX.rotation.y,this.cameraRotX.rotation.z),console.log(this.cameraRotY.rotation.x,this.cameraRotY.rotation.y,this.cameraRotY.rotation.z)}setPosition(e){this.camBase.position.set(e.x,e.y,e.z)}createMinMap(){let e=document.getElementsByClassName("roaming_box")[0];this.mmRenderer=new(0,$4xklQ.WebGLRenderer)({antialias:!0}),this.mmRenderer.setClearColor(15264748),this.mmRenderer.setPixelRatio(window.devicePixelRatio),this.mmRenderer.shadowMap.enabled=!0,this.mmRenderer.xr.enabled=!0;for(let e in this.editor.cameras)"2dCamera"==this.editor.cameras[e].name&&(this.mmCamera=this.editor.cameras[e].clone());let t=240/258,i=-5e3;this.mmCamera.left=i*t,this.mmCamera.right=-i*t,this.mmCamera.top=-i,this.mmCamera.bottom=i,this.mmRenderer.setSize(240,258),this.mmCamera.updateProjectionMatrix(),this.mmRenderer.render(this.editor.scene,this.mmCamera),this.mmRenderer.domElement.style.cssText="position: absolute;left: 0;top: 0;width: 100%;height: 100%;",e.appendChild(this.mmRenderer.domElement),this.addListener(e),this.createCamera(),this.editor.miniCamera.roamControls=new $50d9c80e72e6b8f4$export$8ff7788029dfdf52(this.mmCamera,e),this.editor.miniCamera.roamControls.enableRotate=!1,this.editor.miniCamera.roamControls.target.copy(this.mmCamera.position),this.editor.miniCamera.roamControls.update(),this.editor.miniCamera.camera=this.mmCamera,this.editor.miniCamera.renderer=this.mmRenderer}addListener(e){let t=this.rayCaster,i=this.editor,r=this.mmCamera,n=this.camBase,o=this.cameraRotY,a=i.floor.clone();a.rotation.x=0,a.material=a.material.clone(),a.material.color=new $4xklQ.Color(16711680),a.layers.set(0),i.scene.add(a),e.addEventListener("pointermove",(function(s){let l=new(0,$4xklQ.Vector2);l.x=(s.clientX+e.clientWidth-window.innerWidth)/e.clientWidth*2-1,l.y=-s.clientY/e.clientHeight*2+1,t.setFromCamera(l,r);let c=t.intersectObjects(i.miniCamera.children,!0),h=t.intersectObjects([a],!0);if(i.miniCamera.canRot&&"ready"!=i.miniCamera.canRot){let e=h[0].point.clone().sub(i.miniCamera.position);i.miniCamera.rotation.z=new $4xklQ.Vector2(e.x,e.y).angle(),o.rotation.y=i.miniCamera.rotation.z}if(c.length>0)if(1==c.length)i.miniCamera.nosc.visible=!0,i.miniCamera.selc.visible=!1,"ready"==i.miniCamera.canRot&&(i.miniCamera.nosr.visible=!0,i.miniCamera.selr.visible=!1,i.miniCamera.canRot=!1);else{let e=c[0].object.parent.name;if(i.miniCamera.canMove&&"ready"!=i.miniCamera.canMove){let e=h[0].point.clone().sub(i.miniCamera.originPosition);i.miniCamera.originPosition=h[0].point.clone(),i.miniCamera.position.add(e),n.position.x=i.miniCamera.position.x/1e3,n.position.z=-i.miniCamera.position.y/1e3}else"nosc"==e&&(i.miniCamera.nosc.visible=!1,i.miniCamera.selc.visible=!0,i.miniCamera.canMove="ready");i.miniCamera.canRot&&"ready"!=i.miniCamera.canRot?console.log(i.miniCamera.canRot,"旋转"):"nosr"==e&&(i.miniCamera.nosr.visible=!1,i.miniCamera.selr.visible=!0,i.miniCamera.canRot="ready")}else i.miniCamera.nosc.visible=!0,i.miniCamera.selc.visible=!1,i.miniCamera.canMove=!1,"ready"==i.miniCamera.canRot?(i.miniCamera.nosr.visible=!0,i.miniCamera.selr.visible=!1,i.miniCamera.canRot=!1):i.miniCamera.canRot})),e.addEventListener("wheel",(function(e){let t=i.miniCamera.position.clone(),n=i.miniCamera.scale;i.miniCamera.scale.set(1,1,1),i.miniCamera.applyMatrix4((new $4xklQ.Matrix4).makeScale(1/r.zoom*n.x,1/r.zoom*n.y,1)),i.miniCamera.position.set(t.x,t.y,t.z)})),e.addEventListener("pointerdown",(function(n){let o=new(0,$4xklQ.Vector2);o.x=(n.clientX+e.clientWidth-window.innerWidth)/e.clientWidth*2-1,o.y=-n.clientY/e.clientHeight*2+1,t.setFromCamera(o,r);let s=t.intersectObjects([a],!1);"ready"==i.miniCamera.canMove&&(i.miniCamera.canMove=!0),"ready"==i.miniCamera.canRot&&(i.miniCamera.canRot=!0),(i.miniCamera.canMove||i.miniCamera.canRot&&"ready"!=i.miniCamera.canRot)&&(i.miniCamera.originPosition=s[0].point)})),e.addEventListener("pointerup",(function(e){i.miniCamera.canMove&&(i.miniCamera.canMove="ready"),i.miniCamera.canRot&&(i.miniCamera.nosr.visible=!0,i.miniCamera.selr.visible=!1,i.miniCamera.canRot=!1)}))}createCamera(){let e=20,t=new(0,$4xklQ.Vector3)(-600,-600,e),i=new(0,$4xklQ.Vector3)(-600,200,e),r=new(0,$4xklQ.Vector3)(-200,200,e),n=new(0,$4xklQ.Vector3)(-400,600,e),o=new(0,$4xklQ.Vector3)(400,600,e),a=new(0,$4xklQ.Vector3)(200,200,e),s=new(0,$4xklQ.Vector3)(600,200,e),l=new(0,$4xklQ.Vector3)(600,-600,e),c=($hrM0U.CommonFunc.createShapeByPoints([t,i,r,n,o,a,s,l],new $4xklQ.MeshBasicMaterial({color:16711680,side:2})),new $4xklQ.Group);var{object:h,update:d}=this.renderSVG('<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 28 28" id="camera-hover" width="28" height="28"><g fill="#675D50" fill-rule="evenodd" stroke="#FFF"><path d="M17.5 7A2.5 2.5 0 0015 4.5H7A2.5 2.5 0 004.5 7v14A2.5 2.5 0 007 23.5h8a2.5 2.5 0 002.5-2.5V7zM23.5 7.717a.5.5 0 00-.741-.438l-4.482 2.468a1.5 1.5 0 00-.777 1.314v5.888a1.5 1.5 0 00.777 1.314l4.482 2.468a.5.5 0 00.741-.438V7.717z"></path></g></svg>');let u=(new $4xklQ.Box3).setFromObject(h).getSize(new $4xklQ.Vector3);h.position.x-=u.x/2,c.add(h),h.name="nosc",c.nosc=h;var{object:h,update:d}=this.renderSVG('<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 28 28" id="camera-hover" width="28" height="28"><g fill="#1A7AFB" fill-rule="evenodd" stroke="#FFF"><path d="M17.5 7A2.5 2.5 0 0015 4.5H7A2.5 2.5 0 004.5 7v14A2.5 2.5 0 007 23.5h8a2.5 2.5 0 002.5-2.5V7zM23.5 7.717a.5.5 0 00-.741-.438l-4.482 2.468a1.5 1.5 0 00-.777 1.314v5.888a1.5 1.5 0 00.777 1.314l4.482 2.468a.5.5 0 00.741-.438V7.717z"></path></g></svg>');h.position.x-=u.x/2,c.add(h),h.name="selc",c.selc=h,h.visible=!1;let p=3e3,m=105/180*Math.PI,f=new $4xklQ.Mesh(new $4xklQ.CircleGeometry(p,32,-m/2,m),new $4xklQ.MeshBasicMaterial({color:6774096,side:2,transparent:!0,opacity:.7}));f.name="circle";var{object:h,update:d}=this.renderSVG('<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 60 132" id="rotate" width="60" height="132"><g fill="#1E2329" fill-opacity=".5" fill-rule="evenodd" stroke="#FFF" stroke-width="3" transform="rotate(90 28.5 28.5)"><path d="M129.384 26.898L103.5 45.11V8.872l25.884 18.026zM2.616 26.898L28.5 45.11V8.873L2.616 26.898z"></path><circle cx="66" cy="27" r="25.5"></circle></g></svg>');h.scale.x=10,h.scale.y=10,h.position.x=p,h.name="nosr",c.add(h),c.nosr=h;var{object:h,update:d}=this.renderSVG('<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 60 132" id="rotate" width="60" height="132"><g fill="#1A7AFB" fill-opacity=".5" fill-rule="evenodd" stroke="#FFF" stroke-width="3" transform="rotate(90 28.5 28.5)"><path d="M129.384 26.898L103.5 45.11V8.872l25.884 18.026zM2.616 26.898L28.5 45.11V8.873L2.616 26.898z"></path><circle cx="66" cy="27" r="25.5"></circle></g></svg>');h.scale.x=10,h.scale.y=10,h.position.x=p,h.name="selr",h.visible=!1,c.selr=h,c.add(h,f),this.editor.miniCamera=c,this.editor.scene.add(c),c.rotation.z=this.cameraRotY.rotation.y,c.position.x=1e3*this.camBase.position.x,c.position.y=1e3*this.camBase.position.z,c.canMove=!1,c.canRot=!1}renderSVG(e){const t=(new $22831dcc74231be4$export$959ae9097e74a233).parse(e),i=new $4xklQ.Group,r=[],n=new $4xklQ.LineBasicMaterial({color:"#FF0000",transparent:!0,opacity:.7});t.paths.forEach((e=>{const t=$22831dcc74231be4$export$959ae9097e74a233.createShapes(e),o=new $4xklQ.MeshBasicMaterial({color:e.color,transparent:!0,opacity:.7});t.forEach((e=>{const t=new $4xklQ.ExtrudeBufferGeometry(e,{depth:1,bevelEnabled:!1}),a=new $4xklQ.EdgesGeometry(t),s=new $4xklQ.Mesh(t,o),l=new $4xklQ.LineSegments(a,n);r.push({shape:e,mesh:s,lines:l}),i.add(s,l)}))}));const o=(new $4xklQ.Box3).setFromObject(i),a=o.getSize(new $4xklQ.Vector3),s=a.y/-2,l=a.x/-2;return i.children.forEach((e=>{e.position.x=l-o.min.x,e.position.y=s-o.min.y})),i.position.z=100,i.applyMatrix4((new $4xklQ.Matrix4).makeScale(30,30,1)),{object:i,update(e){r.forEach((t=>{const i=new $4xklQ.ExtrudeBufferGeometry(t.shape,{depth:e,bevelEnabled:!1}),r=new $4xklQ.EdgesGeometry(i);t.mesh.geometry.dispose(),t.lines.geometry.dispose(),t.mesh.geometry=i,t.lines.geometry=r}))}}}}class $19e26f6affaac76b$export$15d36fc1a69ab4a0{static toolType="free";constructor(e,t){this.stats=new $f31f472336ab70f0$export$2e2bcd8739ae039,this.stats.dom.setAttribute("class","stats"),this.stats.dom.style.top=window.innerHeight-48+"px",this.container=t,this.renderer=null,this.editor=e,this.transformControls=new $887b34e694533b37$export$198e80c116632110(this.editor.camera,this.container),this.controls=new $a69b488eccbcfd7b$export$8ff7788029dfdf52(this.editor.camera,this.container,e),this.editor.globalControl=this.controls,this.controls.target.set(0,0,0),this.controls.enableRotate=!1;let i=this.editor.getOtherCamera(this.editor.camera);this.controls3D=new $a69b488eccbcfd7b$export$8ff7788029dfdf52(i,this.container,this.editor),this.controls3DRoam="",this.editor.controlsArr=[this.controls,this.controls3D],this.grid=new $4xklQ.Group,this.editor.grid=this.grid,this.grid.name="2dGrid",this.grid3D=new(0,$4xklQ.Group),this.grid3D.name="3dGrid",this.editor.grid3d=this.grid3D,this.grid.rotation.x=-Math.PI/2,this.editor.createGrid(),this.editor.scene.add(this.grid),this.editor.scene.add(this.grid3D);const r=new(0,$4xklQ.PlaneGeometry)(2e5,2e5),n=new(0,$4xklQ.MeshStandardMaterial)({color:16777215,roughness:1,metalness:0,transparent:!0,opacity:0});this.editor.floor=new(0,$4xklQ.Mesh)(r,n),this.editor.scene.add(this.editor.floor),new $4xklQ.AxesHelper(500).layers.set(1),this.createRenderer();var o=new(0,$4xklQ.SphereGeometry)(.1,8,8);let a=new(0,$4xklQ.PointLight)(10394523,1,100);a.add(new(0,$4xklQ.Mesh)(o,new(0,$4xklQ.MeshBasicMaterial)({color:16711680}))),a.position.set(0,70,0),a.layers.enableAll(),this.editor.scene.add(a);let s=new(0,$4xklQ.AmbientLight)(10394523);s.intensity=1,s.layers.enableAll(),s.position.set(0,0,800),this.editor.scene.add(s),e.list.viewportCameraChanged.add(this.viewportCameraChanged.bind(this)),window.addEventListener("resize",this.onWindowResize.bind(this)),window.addEventListener("mousewheel",this.onMousewheel.bind(this),!0),window.addEventListener("beforeunload",function(e){this.editor.uiPanelBox.dom.remove()}.bind(this)),document.onkeydown=this.onkeydown.bind(this),document.onkeyup=this.onkeyup.bind(this),t.addEventListener("mousedown",this.onMouseDown.bind(this)),t.addEventListener("mouseup",this.onMouseUp.bind(this)),t.addEventListener("mousemove",this.mouseMove.bind(this)),t.addEventListener("touchstart",this.onTouchStart.bind(this)),t.addEventListener("touchmove",this.onTouchMove.bind(this)),t.addEventListener("touchend",this.onTouchEnd.bind(this)),t.addEventListener("dblclick",this.onDoubleClick.bind(this)),t.addEventListener("click",this.mouseClick.bind(this)),t.addEventListener("contextmenu",this.oncontextmenu.bind(this),!0),document.getElementsByClassName("Panel")[0].style.display="none",this.editor.miniDom=document.getElementById("scrollviewcontent"),this.editor.initMiniMap(),setInterval((()=>{this.editor.saveSceneJson()}),3e4),this.editor.list.setDefaultParams.dispatch({roomOpacity:100*window.roomOpacity,storeyHei:window.storeyHei,floorDep:window.floorDep});let l=localStorage.getItem("sceneData");l?l.indexOf("version")>=0?(this.editor.cacheJson=l,this.editor.readCache(l)):fetch(this.editor.config.remoteUrl+l).then((e=>e.json())).then((e=>{let t=e.sceneJson;this.editor.currentCacheJson=e.sceneJson,this.editor.cacheJson=JSON.stringify(t),this.editor.readCache(JSON.stringify(t))})).catch((e=>{document.getElementsByClassName("Panel")[0].style.display="block",localStorage.removeItem("sceneData")})):document.getElementsByClassName("Panel")[0].style.display="block"}createRenderer(){let e=new(0,$4xklQ.WebGLRenderer)({antialias:!0,preserveDrawingBuffer:!0});e.shadowMap.enabled=!0,e.shadowMap.type=$4xklQ.PCFSoftShadowMap,e.setPixelRatio(window.devicePixelRatio),e.setSize(window.innerWidth,window.innerHeight),e.xr.enabled=!0,e.outputEncoding=$4xklQ.sRGBEncoding,e.setClearColor(15264748),this.renderer=e,this.editor.renderer=e,this.container.appendChild(this.renderer.domElement),this.container.parentNode.appendChild(this.editor.uiPanelBox.dom),this.animate(),this.draggable()}cameraChanged(){this.render()}animate(){this.renderer.setAnimationLoop(this.render.bind(this))}draggable(){$((function(){$(".stats").draggable({handle:"canvas"})}))}render(){$0a029741d8f7787c$export$722fbec263ad908a(),this.renderer.render(this.editor.scene,this.editor.viewportCamera),this.editor.newRenderer.render(this.editor.scene,this.editor.miniMapCamera),this.editor.cameraRenderer.render(this.editor.cameraScene,this.editor.pngCamera),this.editor.miniMapObj&&this.editor.miniMapObj.updateMapMan(),""!=this.controls3DRoam&&"3DRoam"==this.editor.viewportCamera.sceneModel&&this.controls3DRoam.animate(),this.stats.update(),this.editor.roamTool&&(this.editor.roamTool.needUpdate(),this.editor.roamTool.mmRenderer.render(this.editor.scene,this.editor.roamTool.mmCamera))}viewportCameraChanged(e,t=!0){const i=e.viewportCamera;this.editor.camera=i;let r=new $523a84362d27c3e8$export$b680ca477a72be07(e);if(this.editor.baseRender&&($("#loading").remove(),$(".lil-gui.autoPlace").hide(),$(this.editor.dom).empty(),this.editor.dom.appendChild(this.renderer.domElement),this.editor.baseRender=!1,$("#sampele").remove(),this.render()),i.isOrthographicCamera){let e=window.innerWidth/window.innerHeight,i=-5e3;this.editor.camera.left=i*e,this.editor.camera.right=-i*e,this.editor.camera.top=-i,this.editor.camera.bottom=i,this.controls.enabled=!0,""!=this.controls3D&&(this.controls3D.enabled=!1),this.editor.floor.rotation.x==-Math.PI/2&&(this.editor.floor.rotation.x=0),this.editor.globalControl=this.controls,this.editor.raycaster.layers.set(0),this.editor.floor.layers.set(0),this.editor.raycaster.layers.enable(0),t&&r.wallToJson()}else{if(this.controls.enabled=!1,this.editor.raycaster.layers.set(1),this.editor.floor.layers.set(1),this.editor.raycaster.layers.enable(2),""!=this.controls3D&&(this.controls3D.enabled=!1),""!=this.controls3DRoam&&(this.controls3DRoam.enabled=!1),this.editor.camera.aspect=window.innerWidth/window.innerHeight,"3DRoam"==i.sceneModel){if(this.editor.roamTool);else{if(this.editor.roomList[0].length>0){let e=this.editor.roomList[0],t=this.editor.roomList[1],i=Math.max.apply(null,t),r=e[t.indexOf(i)];this.editor.camera.position.set(r[0]/1e3,.15,-r[1]/1e3),this.editor.camera.lookAt(new(0,$4xklQ.Vector3)(0,.15,1))}this.editor.roamTool=new $b47acdbb1ebb3974$export$72fae0e7761deb0c(this)}this.editor.globalControl=""}else""!=this.controls3D?this.controls3D.enabled=!0:this.controls3D=new $a69b488eccbcfd7b$export$8ff7788029dfdf52(i,this.container,this.editor),this.editor.globalControl=this.controls3D;0==this.editor.floor.rotation.x&&(this.editor.floor.rotation.x=-Math.PI/2),t&&r.wallToJson("3D")}this.editor.camera.updateProjectionMatrix(),this.render()}onMousewheel(e){this.editor.camera.isOrthographicCamera&&this.editor.updateDom()}onkeydown(e){if(!this.editor.sceneActive)return;if(this.editor.baseRender)return void this.editor.baseRender.onkeydown(e);let t=window.event.keyCode;if(74==e.keyCode||"j"==e.key.toLowerCase()||83==e.keyCode&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)){if(e.preventDefault(),this.editor.saveSceneJson(),"j"==e.key.toLowerCase()){var i=JSON.stringify(this.editor.getSceneAllJson()),r=new Blob([i],{type:"text/plain"}),n=document.createElement("a");n.style.display="none",n.href=URL.createObjectURL(r),n.download="rjh_test_"+Date.parse(new Date)+".json",n.click()}}else if(this.editor.roamTool&&this.editor.roamTool.onKeyDown(e),1*e.key.toLowerCase()!=2&&(this.editor.camera.oldRotDir="",this.editor.camera.cameraRotDir=""),32!=t)switch(e.key.toLowerCase()){case"backspace":break;case"delete":if(""==this.editor.clickSelect||""==this.editor.clickSelect[0].object)return;let t=this.editor.clickSelect[0].object;if(!t)return;if("wall"==t.useType)this.editor.list.delWall.dispatch();else if("splitRoom"==t.useType||"splitFloor"==t.useType||"splitCeil"==t.useType)this.editor.list.delSplitLine.dispatch();else if("dragPoint"==t.useType)this.editor.delCommonPoint(t.parent.center);else{let e=t.parent,i=["beam","flue","pillars"];if(e&&i.indexOf(e.modelType)>=0)this.editor.list.delMember.dispatch();else if("2DModel"==t.modelType)this.editor.list.delModel.dispatch();else{let e=this.editor.getOuterParent(t);"3DModel"==e.modelType||"modelGroup"==e.modelType?this.editor.list.delModel.dispatch():"CodeModel"==e.modelType?(this.editor.list.change3DDoor.dispatch(["del"]),this.editor.list.hiddenDialog.dispatch()):this.editor.list.delDoor.dispatch()}}break;case this.editor.config.getKey("settings/shortcuts/undo"):(this.editor.config.IS_MAC?e.metaKey:e.ctrlKey)&&(e.preventDefault(),this.editor.undo());break;case this.editor.config.getKey("settings/shortcuts/redo"):(this.editor.config.IS_MAC?e.metaKey:e.ctrlKey)&&(e.preventDefault(),this.editor.redo());break;case this.editor.config.getKey("settings/shortcuts/focus"):null!==this.editor.selected&&this.editor.focus(this.editor.selected);break;case"escape":"3dRomaCamera"==this.editor.camera.name&&this.editor.list.exitRomaScene.dispatch(),this.editor.exitTool();break;case"w":case"a":case"s":case"d":case"q":case"e":this.editor.moveCurrentCamera(e.key.toLowerCase());break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"0":case"+":case"-":case"*":case"/":if(this.editor.camera.isOrthographicCamera)return;if("body"!=e.target.localName)return;this.editor.setCurrentCamera(e.key.toLowerCase())}else{if(e.preventDefault(),this.editor.clickSelect.length>0){let e=this.editor.getOuterParent(this.editor.clickSelect[0].object);if(e&&("3DModel"==e.modelType||"2DModel"==e.modelType||"2dModelGroup"==e.modelType||"modelGroup"==e.modelType)&&!this.editor.mouseCoverObj){if("2DModel"!=e.modelType&&"2dModelGroup"!=e.modelType||(e=e.param[0]),e.isLock)return;return e.rotation.y<=0&&(e.rotation.y+=2*Math.PI),e.rotation.y-=Math.PI/180*45,this.editor.synchroModel(e),this.editor.updateModel(e),void new $102b3df9ca2da060$export$aead3d23b4737909(this.editor).selectObj([e])}}this.editor.list.resetCamera.dispatch()}}onkeyup(e){this.editor.roamTool&&this.editor.roamTool.onKeyUp(e)}mouseMove(e){if(!this.editor.baseRender){if(this.editor.sceneActive=!0,this.editor.camera.isOrthographicCamera&&this.editor.menuSwitch&&this.editor.updateDom(),this.editor.currentPoint=this.editor.getWorldPosition(e),this.editor.currentMoveSelect=[],this.editor.menuSwitch||(this.editor.currentMoveSelect=this.getObject(e)),this.editor.currentMoveSelect.length<=0&&this.editor.updateDom(),"grab"!=this.editor.dom.style.cursor&&(this.editor.dom.style.cursor="default"),"wall"!=this.editor.toolType&&"room"!=this.editor.toolType&&"splitTool"!=this.editor.toolType||(this.editor.dom.style.cursor="crosshair"),this.editor.copyFloorMaterial){let e=this.editor.getScreenPosition(this.editor.currentPoint.clone());this.editor.list.blackBox.dispatch(e.x,e.y,"点击应用到该房间")}if("free"!=this.editor.toolType)if("wall"==this.editor.toolType||"room"==this.editor.toolType||"splitTool"==this.editor.toolType){if(this.editor.orthogonalModel&&""!=this.editor.startPoint&&(this.editor.currentPoint=$9HO6e.UtilCore.handleOrthogonalPoint(this.editor.startPoint,this.editor.currentPoint)),this.editor.currentPoint=$9HO6e.UtilCore.handleSpecialPoint(this.editor.currentPoint.clone(),this.editor.specialPointArr,this.editor),""==this.editor.startPoint)return;this.editor.endPoint=this.editor.currentPoint,this.editor.list.executeTool.dispatch("moveDraw")}else this.editor.list.executeTool.dispatch("moveDraw");else{if(this.controls3D.enablePan=!0,this.controls3D.enableRotate=!0,!this.editor.camera.isOrthographicCamera&&this.editor.currentMoveSelect.length>0){let e=this.editor.getOuterParent(this.editor.currentMoveSelect[0].object);e.modelType&&(e.modelType.indexOf("Model")>=0||e.modelType.indexOf("model")>=0)&&(this.controls3D.enableRotate=!1)}this.editor.otherMeshs.concat(this.editor.otherMember).forEach((e=>{e.children.forEach((e=>{"Line"!=e.type&&"Line2"!=e.type&&"DWHelper"!=e.type||e.material.color.equals(this.editor.moveDoorColor)&&!e.material.color.equals(this.editor.clickColor)&&(e.material.color=this.editor.moveDoorOutColor)}))})),this.editor.splitRoomLineGroup.children.slice(0).forEach((e=>{"splitOuterLine"==e.useType&&this.editor.splitRoomLineGroup.remove(e)}));let e="";if(this.editor.splitRoomLine.children.slice(0).forEach((t=>{let i=$9HO6e.UtilCore.smallDistanceByPointOnLine($9HO6e.UtilCore.handleLineData(t.startPoint,t.endPoint),this.editor.currentPoint.clone());$9HO6e.UtilCore.pointIsInLine(i,t.startPoint,t.endPoint)&&$9HO6e.UtilCore.toVector2(this.editor.currentPoint).distanceTo(i.clone())<100&&(e=t)})),""!=e){let t=$9QhXH.DM.createLine([e.startPoint,e.endPoint],"#00EEFF",!1,3);t.useType="splitOuterLine",this.editor.splitRoomLineGroup.add(t),this.editor.currentMoveSelect=[{object:e}]}if(this.editor.currentMoveSelect.length>0&&"floor"==this.editor.currentMoveSelect[0].object.useType&&this.editor.updateDom(),""!=this.editor.downPoint){let e=this.editor.currentPoint.clone().distanceTo(this.editor.downPoint.clone()),t=40;if(this.editor.camera.isOrthographicCamera||(t/=1e3),e<t)return}this.editor.list.executeTool.dispatch("moveFree")}this.editor.currentMoveSelect.length>0&&"floor"!=this.editor.currentMoveSelect[0].object.useType?(this.controls.mouseButtons={LEFT:$4xklQ.MOUSE.LEFT,RIGHT:$4xklQ.MOUSE.PAN},this.controls.touches={ONE:-1}):(this.controls.mouseButtons={LEFT:$4xklQ.MOUSE.PAN,RIGHT:$4xklQ.MOUSE.PAN,MIDDLE:$4xklQ.MOUSE.PAN},this.controls3D.mouseButtons.MIDDLE=$4xklQ.MOUSE.PAN,this.controls.touches={ONE:$4xklQ.TOUCH.PAN})}}mouseClick(e){if(this.editor.baseRender)return;this.editor.splitRoomLineGroup.children=[];let t=!0,i=this.editor.downEvent,r=e,n=Math.abs(i.screenX-r.screenX)<.01&&Math.abs(i.screenY-r.screenY)<.01;if(n&&(this.editor.list.hiddenDialog.dispatch(),this.editor.list.closeReplaceView.dispatch(),this.editor.camera.isOrthographicCamera&&this.editor.changAllInputToText()),this.editor.pointHelperGroup.children.slice(0).forEach((e=>{"clickPoint"==e.useType&&e.parent.remove(e)})),""!=this.editor.mouseCoverObj&&this.editor.execute(new $c338f49977b1ce90$export$4eacab61b79af859(this.editor),"放置模型"),"free"!=this.editor.toolType){let t=this.editor.currentPoint.clone();(e.clientX||0!=e.changedTouches.length)&&(t=this.editor.getWorldPosition(e)),"wall"==this.editor.toolType||"splitTool"==this.editor.toolType?(t=$9HO6e.UtilCore.handleSpecialPoint(this.editor.currentPoint.clone(),this.editor.specialPointArr,this.editor),this.editor.allLinkWallByStartPoint=[],""==this.editor.startPoint?(this.editor.startPoint=t,this.editor.allLinkWallByStartPoint=$9HO6e.UtilCore.havePointWall(t,this.editor.allWalls)):(this.editor.endPoint=t,this.editor.statusJson=this.editor.getSceneAllJson(),this.editor.list.executeTool.dispatch("sureDraw"),this.editor.allLinkWallByStartPoint=$9HO6e.UtilCore.havePointWall(t,this.editor.allWalls),this.editor.startPoint=t,this.editor.currenDraw="",this.editor.specialPointArr=$9HO6e.UtilCore.getAllSpecialPoint(this.editor),"free"==this.editor.toolType&&(this.editor.startPoint=""))):"room"==this.editor.toolType?(t=$9HO6e.UtilCore.handleSpecialPoint(this.editor.currentPoint.clone(),this.editor.specialPointArr,this.editor),""==this.editor.startPoint?this.editor.startPoint=t:(this.editor.endPoint=t,this.editor.statusJson=this.editor.getSceneAllJson(),$9HO6e.UtilCore.toVector3(this.editor.startPoint.clone()).distanceTo($9HO6e.UtilCore.toVector3(t.clone()))>40&&this.editor.list.executeTool.dispatch("sureDraw"),this.editor.startPoint="",this.editor.currenDraw="",this.editor.specialPointArr=$9HO6e.UtilCore.getAllSpecialPoint(this.editor))):this.editor.list.executeTool.dispatch("sureDraw")}else{let i=this.getObject(e);if(i.length>0){if(this.editor.transform3DTool&&"ThreeDimensionMoveHelper"==this.editor.transform3DTool.name&&this.editor.transform3DTool.removeEventListener(),e.shiftKey||e.ctrlKey){let e=i[0].object;this.editor.selectObjArr.indexOf(e)>=0?this.editor.selectObjArr.splice(this.editor.selectObjArr.indexOf(e),1):this.editor.selectObjArr.push(i[0].object)}else this.editor.selectObjArr=[i[0].object];if(this.editor.camera.isOrthographicCamera){this.editor.clickSelect.length>0&&""!=this.editor.clickSelect[0].object&&"wall"==this.editor.clickSelect[0].object.useType&&(this.editor.clickSelect[0].object.material.color=this.editor.getWallColor(this.editor.clickSelect[0].object)),this.editor.clickSelect=i;let e="";this.editor.currentDownSelect[0].object.parent&&(e=this.editor.currentDownSelect[0].object.parent.currentModel),e&&(this.editor.clickSelect[0].object=e);let r="";if(this.editor.splitRoomLine.children.slice(0).forEach((e=>{let t=$9HO6e.UtilCore.smallDistanceByPointOnLine($9HO6e.UtilCore.handleLineData(e.startPoint,e.endPoint),this.editor.currentPoint.clone());$9HO6e.UtilCore.pointIsInLine(t,e.startPoint,e.endPoint)&&$9HO6e.UtilCore.toVector2(this.editor.currentPoint).distanceTo(t.clone())<100&&(r=e)})),""!=r){let e=$9QhXH.DM.createLine([r.startPoint,r.endPoint],"#00EEFF",!1,3);e.useType="splitCheckLine",this.editor.splitRoomLineGroup.add(e),this.editor.clickSelect=[{object:r}]}let n=this.editor.clickSelect[0].object.useType;if($9HO6e.UtilCore.updateLineDimensionsLine(this.editor),"wall"==n){this.editor.doorHelperGroupClean(),this.editor.clickSelect[0].object.material.color=this.editor.clickColor;let e=this.editor.clickSelect[0].object;e.children=[];let t=this.editor.getDialogPosition("","",this.editor.currentPoint.clone()),i=Math.round(e.startPoint.clone().distanceTo(e.endPoint.clone())),r=$9HO6e.UtilCore.havePointWall(e.startPoint,this.editor.allWalls),n=$9HO6e.UtilCore.havePointWall(e.endPoint,this.editor.allWalls),o=r.length>1,a=n.length>1;this.editor.changTextToInput(e);let s=$9HO6e.UtilCore.getLinkRealWall(r,e.startPoint,e.endPoint),l=$9HO6e.UtilCore.getLinkRealWall(n,e.endPoint,e.startPoint);s.forEach((t=>{this.editor.changTextToInput(t,e.startPoint,s,l,r,n)})),l.forEach((t=>{this.editor.changTextToInput(t,e.endPoint,l,s,n,r)})),this.editor.list.showDialog.dispatch(0,"wall",t,[i,e.thickness,o,a,e.style,e.height]),"bezier"==e.isArc&&this.editor.addBSRWallHelper(e)}else if("scaleRuleTool"==n||"scaleHelpTool"==n);else if("rotateTool"==n||"scalePoint"==n);else if("bseControl"==n);else if("splitRoom"==n||"splitFloor"==n||"splitCeil"==n);else if("floor"==n){this.editor.doorHelperGroupClean();let e=this.editor.clickSelect[0].object;editor.copyFloorMaterial&&(this.editor.execute(),e.material=editor.copyFloorMaterial);for(let t=0;t<e.allPoints.length;t++){let i=e.allPoints[t],r=e.allPoints[0];t!=e.allPoints.length-1&&(r=e.allPoints[t+1]);let n=$9QhXH.DM.createLine([i,r],"#00EEFF",!1,2.5);n.useType="splitCheckLine",this.editor.splitRoomLineGroup.add(n)}let t=this.editor.getDialogPosition("","",this.editor.currentPoint.clone());this.editor.list.showDialog.dispatch(3,"地面",t,[this.editor.clickSelect[0].object.roomName])}else if("dragPoint"==n){let e=this.editor.clickSelect[0].object,t=(new $d0f874000594cf7a$export$a955f3d6a39ce4b2).createDoorOuterPoint(e.parent.center,2*e.parent.radio,"rgb(26, 122, 251)");t.useType="clickPoint",this.editor.pointHelperGroup.add(t)}else if("2DModel"==this.editor.clickSelect[0].object.modelType){this.editor.doorHelperGroupClean();let e=this.editor.getOuterParent(this.editor.clickSelect[0].object);if(!e.visible)return;let i=this.editor.getDialogPosition("","",this.editor.currentPoint.clone()),r=this.editor.clickSelect[0].object,n=this.editor.getOuterParent(r,r,"outer");if(this.editor.clickDepthMsg.uuid&&this.editor.clickDepthMsg.uuid==n.uuid&&(t=!1),this.editor.modelHelperGroup.children=[],this.editor.selectObjArr.length>1){let e=!1;this.editor.selectObjArr.forEach((t=>{let i=this.editor.getOuterParent(t);this.editor.addBoxFor2dGroup(i);let r=this.editor.get3DModelBy2DModel(i);this.editor.addBoxForGroup(r),e=i.isLock})),this.editor.list.showDialog.dispatch(9,"2d软装多选",i,[{isLock:e}])}else{let t=this.editor.get3DModelBy2DModel(e);if("Line2"==t.type&&this.editor.model3D.children.forEach((e=>{e.uuid==t.modelUUID&&(t=e)})),"Line2"==t.type)return;if(e.isLock){this.editor.addPositionHelper(e,!0),this.editor.addBoxFor2dGroup(e);const i=this.editor.wallHelp.addOBBbox(t,this.editor.config.boxColor);i.name="modelBox",i.layers.set(2),this.editor.modelHelperGroup.add(i)}else{let e={};this.editor.clickDepthMsg.uuid&&(e=this.editor.clickDepthMsg,this.editor.clickDepthMsg={uuid:n.param[0].uuid,depth:1,model:n.param[0]}),new $102b3df9ca2da060$export$aead3d23b4737909(this.editor).selectObj([t]),this.editor.clickDepthMsg=e}let i=this.editor.getDialogPosition("","",this.editor.currentPoint.clone()),r=t,o=this.editor.getRealSize(r),a=1e3*o[0].toFixed(3),s=1e3*o[1].toFixed(3),l=1e3*o[2].toFixed(3),c=1e3*r.width.toFixed(3),h=1e3*r.height.toFixed(3),d=1e3*r.depth.toFixed(3),u=new(0,$4xklQ.Vector3)(0,r.position.y,0);r.parent.localToWorld(u);let p=1e3*(u.y-o[1]/2).toFixed(3),m=0;if("top"==r.modelPosition){let e=window.storeyHei;this.editor.wallGroup3D.roomHeight,m=1e3*(e/1e3-r.height).toFixed(3),m<10&&(m=0)}p<10&&(p=0);let f=360-Math.abs(parseInt(180/Math.PI*r.rotation.x)),g=360-Math.abs(parseInt(180/Math.PI*r.rotation.y)),x=360-Math.abs(parseInt(180/Math.PI*r.rotation.z));360==f&&(f=0),360==g&&(g=0),360==x&&(x=0);let b={isLock:e.isLock,width:a,height:s,depth:l,oldWidth:c,oldHeight:h,oldDepth:d,floorHei:p,rotation:[f,x,g],oldFloorHei:m};"2dModelGroup"==e.modelType?this.editor.list.showDialog.dispatch(14,"组合模型",i,[b]):("{}"!=JSON.stringify(this.editor.clickDepthMsg)&&(b.isGroupChild=!0),this.editor.list.showDialog.dispatch(8,"单品模型",i,[b]))}}else{let e=this.editor.clickSelect[0].object.parent,t=e;this.editor.cleanWallHelper(),this.editor.doorHelperGroupClean();let i=["beam","flue","pillars"];if(t&&this.editor.changeClickColor(t),i.indexOf(t.modelType)>=0){t.isLock?this.editor.addPositionHelper(e,!0):this.editor.addLineHelperForMember(e);let i=40,r=$9HO6e.UtilCore.toVector3(t.position.clone()).project(this.editor.camera),n=window.innerWidth/2,o=window.innerHeight/2,a=[Math.round(r.x*n+n),Math.round(-r.y*o+o)];a[0]+=i,a[1]-=2*i;let s=Math.round(180/Math.PI*t.rotation.z);s<0&&(s=360+s);let l=[Math.round(t.width*t.scale.x),Math.round(t.height*t.scale.y),Math.round(t.depth*t.scale.z),s,{isLock:t.isLock}],c=4;"flue"==t.modelType&&(c=5),"pillars"==t.modelType&&(c=6),this.editor.list.showDialog.dispatch(c,t.modelType,a,l)}else if(t.startPoint){this.editor.addLineHelperForDoor(e,!0);let i=Math.abs(Math.round(t.doorWid*t.scale.x)),r=this.editor.getDialogPosition("","",this.editor.currentPoint.clone()),n=t.modelType,o=this.editor.getWallByWallId(t.wallId),a=this.editor.config.modelTypeJson[t.modelType];n.includes("Door")||n.includes("door")?this.editor.list.showDialog.dispatch(2,a,r,[i,t.height,Math.round(t.wallDep),t.floorHei,o.height,{isLock:t.isLock}]):(n.includes("Window")||n.includes("window"))&&this.editor.list.showDialog.dispatch(1,a,r,[i,t.height,Math.round(t.wallDep),t.floorHei,o.height,{isLock:t.isLock}]),e.wallId&&(this.editor.currentDoor=e)}}}else if(this.editor.clickSelect=i,"CodeModel"==this.editor.getOuterParent(i[0].object).modelType){let e=this.editor.getOuterParent(i[0].object);this.editor.transform3DTool=new $f708759ef0d3ebee$export$cbb426a6cd1f3789(this.editor),this.editor.transform3DTool.selectObj(i[0].object);let t=e.parameter.tdm,r=this.editor.get3DModelDialogPosition(e,30),n=[Math.abs(Math.round(t.doorWid*t.scale.x)),Math.round(t.height),Math.round(t.wallDep),t.floorHei,{isLock:t.isLock}],o=12;t.modelType.toLowerCase().indexOf("window")>=0&&(o=15);let a=this.editor.config.modelTypeJson[t.modelType];this.editor.list.showDialog.dispatch(o,a,r,n)}else if("3dMember"==i[0].object.parent.name){let e=this.editor.get3DModelDialogPosition(i[0].object,30),t=4;this.editor.modelHelperGroup.children=[],this.editor.addBoxForGroup(i[0].object);let r=i[0].object.twoD;"flue"==r.modelType&&(t=5),"pillars"==r.modelType&&(t=6);let n=Math.round(180/Math.PI*r.rotation.z);n<0&&(n=360+n);let o=[Math.round(r.width*r.scale.x),Math.round(r.height*r.scale.y),Math.round(r.depth*r.scale.z),n,{isLock:r.isLock}];this.editor.list.showDialog.dispatch(t,i[0].object.modelType,e,o)}else if("3dwall"==i[0].object.parent.name)this.editor.modelHelperGroup.children=[];else{let e=this.editor.getOuterParent(i[0].object,i[0].object,"outer");if(!e.visible)return;this.editor.clickDepthMsg.uuid&&this.editor.clickDepthMsg.uuid==e.uuid&&(t=!1);let r=this.editor.downPoint,n=this.editor.currentPoint;Math.abs(r.x-n.x)<.01&&Math.abs(r.y-n.y)<.01&&Math.abs(r.z-n.z)<.01&&new $102b3df9ca2da060$export$aead3d23b4737909(this.editor).selectObj(this.editor.selectObjArr)}}else if(n){this.editor.otherMeshs.concat(this.editor.otherMember).forEach((e=>{e.children.forEach((e=>{"Line"!=e.type&&"Line2"!=e.type&&"DWHelper"!=e.type||(e.material.color=this.editor.moveDoorOutColor)}))})),this.editor.camera.isOrthographicCamera&&(this.editor.switchHelperGroup("show"),this.editor.clickSelect.length>0&&""!=this.editor.clickSelect[0].object&&"wall"==this.editor.clickSelect[0].object.useType&&(this.editor.clickSelect[0].object.material.color=this.editor.getWallColor(this.editor.clickSelect[0].object)),$9HO6e.UtilCore.updateLineDimensionsLine(this.editor)),this.editor.removeBSRHelper(),this.editor.selectObjArr=[],this.editor.list.hiddenDialog.dispatch(),this.editor.list.resetproperty.dispatch({roomOpacity:100*window.roomOpacity,storeyHei:window.storeyHei,floorDep:window.floorDep}),this.editor.currentDoor="",0==this.editor.currentDownSelect.length&&this.editor.doorHelperGroupClean(),this.editor.modelHelperGroup.children=[],this.editor.clickSelect=[],this.editor.destroy3DModelHelper();let e="";if(this.editor.splitRoomLine.children.slice(0).forEach((t=>{let i=$9HO6e.UtilCore.smallDistanceByPointOnLine($9HO6e.UtilCore.handleLineData(t.startPoint,t.endPoint),this.editor.currentPoint.clone());$9HO6e.UtilCore.pointIsInLine(i,t.startPoint,t.endPoint)&&$9HO6e.UtilCore.toVector2(this.editor.currentPoint).distanceTo(i.clone())<100&&(e=t)})),""!=e){let t=$9QhXH.DM.createLine([e.startPoint,e.endPoint],"#00EEFF",!1,3);t.useType="splitCheckLine",this.editor.splitRoomLineGroup.add(t),this.editor.clickSelect=[{object:e}]}this.editor.copyFloorMaterial=""}}t&&this.editor.clickDepthMsg.uuid&&n&&this.exitModelHierarchy(),this.editor.downPoint="",this.editor.currentDownSelect="",this.editor.statusJson=[]}exitModelHierarchy(){this.editor.modelDotGroup.children=[],this.editor.clickDepthMsg={}}oncontextmenu(e){this.editor.clickSelect.length>0&&""!=this.editor.clickSelect[0].object&&"floor"!=this.editor.clickSelect[0].object.useType&&this.editor.updateDialogPosition(this.editor.clickSelect[0].object);let t=this.editor.downEvent,i=e;Math.abs(t.screenX-i.screenX)<.01&&Math.abs(t.screenY-i.screenY)<.01&&this.editor.exitTool(!0,!1)}onMouseDown(e){if(!this.editor.baseRender)if(this.editor.downEvent=e,2!=e.button&&1!=e.button){if(this.editor.statusJson=this.editor.getSceneAllJson(),this.editor.currentDownSelect=this.getObject(e),0!=this.editor.currentDownSelect.length||"default"!=this.editor.dom.style.cursor&&""!=this.editor.dom.style.cursor||(this.editor.dom.style.cursor="grab"),this.editor.startChooseWall=this.getObject(e),this.editor.specialPointArr=$9HO6e.UtilCore.getAllSpecialPoint(this.editor),this.editor.currentDownSelect.length>0){let e=this.editor.currentDownSelect[0].object;if("wall"==e.useType)this.editor.moveStartPosition=e.position.clone();else{let e=this.editor.currentDownSelect[0].object;"Line2"==e.type&&e.parent.currentModel&&(this.editor.currentDownSelect[0].object=e.parent.currentModel);let t=this.editor.currentDownSelect[0].object.parent,i=this.editor.currentDownSelect[0].object;i=this.editor.getOuterParent(i),i.modelType&&i.modelType.indexOf("Model")>=0&&(t=i),this.editor._scaleStart=(new $4xklQ.Vector3).copy(t.scale),this.editor._offsetStart=(new $4xklQ.Vector3).copy(t.position),t.currentModel&&(this.editor._scaleStart=(new $4xklQ.Vector3).copy(t.currentModel.parent.scale),this.editor._offsetStart=(new $4xklQ.Vector3).copy(t.currentModel.parent.position)),t.wallId&&(this.editor.currentDoor=t)}}else this.editor.menuSwitch=!0;this.editor.downPoint=this.editor.getWorldPosition(e)}else this.editor.menuSwitch=!0}onMouseUp(e){if(this.editor.baseRender)return;e.preventDefault();let t=this.editor.getWorldPosition(e);"free"==this.editor.toolType&&this.editor.downPoint&&t.clone().distanceTo(this.editor.downPoint.clone())>40&&this.editor.list.executeTool.dispatch("moveMesh"),this.editor.blackbox&&this.editor.blackbox.removeDom(),this.editor.blackbox="",this.editor.statusJson=[],this.editor.startChooseWall="",this.editor.menuSwitch=!1,"wall"!=this.editor.toolType&&"room"!=this.editor.toolType&&(this.editor.dom.style.cursor="default");let i=this.editor.downEvent,r=e,n=r.screenX-i.screenX,o=r.screenY-i.screenY;this.editor.list.updateDialog.dispatch(n,o)}onTouchStart(e){e.preventDefault(),this.editor.currentPoint=this.editor.getWorldPosition(e),""!=this.editor.touchStart&&$9HO6e.UtilCore.isSameVector(this.editor.touchStart,this.editor.currentPoint)?(this.editor.touchStart="",this.editor.exitTool()):this.editor.touchStart=this.editor.currentPoint,this.onMouseDown(e)}onTouchMove(e){this.mouseMove(e),this.editor.updateDom()}onTouchEnd(e){e.preventDefault(),this.onMouseUp(e),this.mouseClick(e)}onDoubleClick(e){if(!this.editor.baseRender&&this.editor.selectObjArr.length>0){let e=this.editor.selectObjArr[0],t=this.editor.getOuterParent(e);if("modelGroup"==t.modelType)this.editor.modelHelperGroup.children=[],this.editor.addDashBoxForGroup(t),this.editor.doorHelperGroupClean(),this.editor.clickDepthMsg={uuid:t.uuid,depth:1,model:t},this.editor.clickSelect[0].object=e,new $102b3df9ca2da060$export$aead3d23b4737909(this.editor).selectObj([e]),this.editor.addDashBoxFor2dGroup(t.param[0]);else if("2dModelGroup"==t.modelType){if(this.editor.modelHelperGroup.children=[],this.editor.addDashBoxForGroup(t.param[0]),this.editor.doorHelperGroupClean(),e.isLock){this.editor.addPositionHelper(e,!0),this.editor.addBoxFor2dGroup(e);const t=this.editor.wallHelp.addOBBbox(e.param[0],this.editor.config.boxColor);t.name="modelBox",t.layers.set(2),this.editor.modelHelperGroup.add(t)}else this.editor.clickDepthMsg={uuid:t.param[0].uuid,depth:1,model:t},new $102b3df9ca2da060$export$aead3d23b4737909(this.editor).selectObj([e.param[0].children[0]]),this.editor.addLineHelperForMember(e);this.editor.addDashBoxFor2dGroup(t),this.editor.clickDepthMsg={uuid:t.uuid,depth:1,model:t},this.editor.clickSelect[0].object=e;let i=this.editor.getDialogPosition("","",this.editor.currentPoint.clone());t=e;let r=this.editor.getRealSize(t),n=t.param[0],o=1e3*r[0].toFixed(3),a=1e3*r[1].toFixed(3),s=1e3*r[2].toFixed(3),l=1e3*n.width.toFixed(3),c=1e3*n.height.toFixed(3),h=1e3*n.depth.toFixed(3),d=new(0,$4xklQ.Vector3)(0,n.position.y,0);n.parent.localToWorld(d);let u=1e3*(d.y-r[1]/2).toFixed(3),p=0;if("top"==n.modelPosition){let e=window.storeyHei;this.editor.wallGroup3D.roomHeight,p=1e3*(e/1e3-n.height).toFixed(3),p<10&&(p=0)}u<10&&(u=0);let m=360-Math.abs(parseInt(180/Math.PI*t.rotation.x)),f=360-Math.abs(parseInt(180/Math.PI*t.rotation.y)),g=360-Math.abs(parseInt(180/Math.PI*t.rotation.z));360==m&&(m=0),360==f&&(f=0),360==g&&(g=0);let x={isLock:t.isLock,width:o,height:a,depth:s,oldWidth:l,oldHeight:c,oldDepth:h,floorHei:u,rotation:[m,f,g],oldFloorHei:p};"2dModelGroup"==e.modelType?this.editor.list.showDialog.dispatch(10,"2d软装",i,[x]):(x.isGroupChild=!0,this.editor.list.showDialog.dispatch(8,"2d软装",i,[x]))}}}getObject(e){e.clientX||0==e.clientX?(this.editor.mouse.x=e.clientX/window.innerWidth*2-1,this.editor.mouse.y=-e.clientY/window.innerHeight*2+1):(this.editor.mouse.x=e.changedTouches[0].pageX/window.innerWidth*2-1,this.editor.mouse.y=-e.changedTouches[0].pageY/window.innerHeight*2+1),this.editor.raycaster.setFromCamera(this.editor.mouse,this.editor.camera);let t=this.editor.pointHelperGroup.children.concat(this.editor.otherMeshs);return t=t.concat(this.editor.allWalls),t=t.concat(this.editor.otherMember),t=t.concat(this.editor.wallGroup3D.children),t=t.concat(this.editor.model3D.children),t=t.concat(this.editor.model2D.children),t=t.concat(this.editor.floorGroup2d.children),t=t.concat(this.editor.memberGroup3D.children),this.editor.raycaster.intersectObjects(t,!0)}onWindowResize(){if(this.editor.camera.isOrthographicCamera){let e=window.innerWidth/window.innerHeight,t=-5e3;this.editor.camera.left=t*e,this.editor.camera.right=-t*e,this.editor.camera.top=-t,this.editor.camera.bottom=t}else this.editor.camera.aspect=window.innerWidth/window.innerHeight;this.editor.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}}var $5XTH3=parcelRequire("5XTH3"),$9HO6e=parcelRequire("9HO6e"),$9HO6e=parcelRequire("9HO6e"),$9HO6e=parcelRequire("9HO6e"),$4xklQ=parcelRequire("4xklQ"),$9QhXH=parcelRequire("9QhXH"),$5XTH3=parcelRequire("5XTH3");class $671a9ada1efb021a$export$ad57cb3fe2de1d52{constructor(e){this.editor=e,this.moveCommandObj={},this.repairCommandObj=[],this.splitWallCommand="",this.sureMove=!1,this.wallCore=new $523a84362d27c3e8$export$b680ca477a72be07(this.editor),this.wallHelper=new $d0f874000594cf7a$export$a955f3d6a39ce4b2(this.editor),this.spiltWall=[],this.spiltOldWall=[],this.linkWall=[]}moveWallMain(){if(!this.editor.startChooseWall[0])return;if(this.editor.currentDownSelect.length>0){if("bezier"==this.editor.currentDownSelect[0].object.isArc)return}let e="",t="",i="",r=this.editor.currentDownSelect[0].object;i=r;let n=this.editor.allWalls.slice(0),o=[];this.editor.moveRule||(this.editor.moveRule=$9HO6e.UtilCore.getWallMoveRule(r,n,this.editor),n.forEach((e=>{let t=e.clone();t.startPoint=e.startPoint.clone(),t.endPoint=e.endPoint.clone(),o.push(t)})),this.editor.moveRule.push(o));let a=this.moveCoreMain(r,this.editor.moveRule);if(!a||!a[0]||!a[1])return;this.editor.scene.remove(r),this.editor.removeHelperByWall(r);let s=this.editor.allWalls.indexOf(r);if(s>=0&&this.editor.allWalls.splice(s,1),""!=this.editor.currenDraw){let e=this.editor.allWalls.indexOf(this.editor.currenDraw);e>=0&&this.editor.allWalls.splice(e,1),this.editor.scene.remove(this.editor.currenDraw),this.editor.removeHelperByWall(this.editor.currenDraw)}if(e=a[0],t=a[1],this.moveCommandObj.oldMesh=this.editor.startChooseWall[0].object,i.isArc){let e=i.startPoint,t=i.endPoint;""!=this.editor.circlePoint&&this.editor.scene.remove(this.editor.circlePoint),this.editor.circlePoint=this.wallHelper.createNormalPoint(this.editor.currentPoint),this.editor.scene.add(this.editor.circlePoint),this.editor.currenDraw=this.wallCore.createCircleWall(e,t,this.editor.currentPoint,i.isArc,this.moveCommandObj.oldMesh.thickness)}else this.editor.currenDraw=this.wallCore.createLineWall(e,t,this.moveCommandObj.oldMesh.thickness);this.editor.currenDraw.cover=a[2],this.editor.currenDraw.isArc=i.isArc,this.editor.currenDraw.style=i.style,this.editor.currenDraw.height=i.height,this.editor.currenDraw.thickness=i.thickness,this.moveCommandObj.currentMesh=this.editor.currenDraw;let l=$9HO6e.UtilCore.getAllWallLine(this.editor.currentDownSelect[0].object);this.editor.currentDownSelect&&(this.editor.currentDownSelect[0].object=this.editor.currenDraw),this.editor.scene.add(this.editor.currenDraw),this.editor.allWalls.push(this.editor.currenDraw);let c=l[0].concat(l[1]);c=c.concat(l[3]),c=c.concat(l[2]);let h=this.editor.splitRoomLine.children.slice(0),d=$9HO6e.UtilCore.handleLineData(e,t);h.forEach((e=>{let t=e.startPoint,i=e.endPoint,r=this.editor.PolyK.ContainsPoint(c,t.x,t.y),n=this.editor.PolyK.ContainsPoint(c,i.x,i.y),o=$9HO6e.UtilCore.handleLineData(t,i),a=$9HO6e.UtilCore.lineIsIntersection(o,d);r&&a&&(this.editor.splitRoomLine.remove(e),this.editor.addSplitLine(a,i,e.useType)),n&&a&&(this.editor.splitRoomLine.remove(e),this.editor.addSplitLine(t,a,e.useType))})),this.editor.currenDraw.wallID=this.editor.startChooseWall[0].object.wallID,this.editor.otherMember.forEach((e=>{if(!e.parameter)return;let t=this.editor.startChooseWall[0].object;if(e.parameter.leftWall.includes(t.wallID)||e.parameter.rightWall.includes(t.wallID)){let t=$9QhXH.DM.memberJson([e]);this.editor.otherMember.splice(this.editor.otherMember.indexOf(e),1),this.editor.scene.remove(e),t.forEach((e=>{let t,i=new(0,$4xklQ.Vector3)(e.location.x,e.location.y,e.location.z);"beam"==e.type&&(t=$9QhXH.DM.createBeam(i,"beam",e.angle,e.height,e.depth,this.editor.allWalls),t.rotation.z=e.rotation,this.editor.otherMember.push(t),this.editor.scene.add(t))}))}}))}execute(){if(""!=this.editor.currenDraw&&(this.editor.currentDownSelect.length>0||"{}"!=JSON.stringify(this.moveCommandObj))){this.sureMove=!0,this.moveWallMain(),this.editor.moveRule="",""!=this.editor.circlePoint&&this.editor.scene.remove(this.editor.circlePoint),this.editor.circlePoint="";let e=this.editor.currenDraw;if(this.editor.currenDraw){this.editor.addLineWallHelper(this.editor.currenDraw.startPoint,this.editor.currenDraw.endPoint),this.splitWallCommand=new $46f32ef2047263b6$export$6bf150a1b9f8c161(this.editor),this.spiltWall.push(this.editor.currenDraw);let e=this.spiltWall.slice(0),t=[];e.forEach((e=>{t.push(e.wallID)})),this.linkWall.forEach((i=>{t.indexOf(i.wallID)<0&&e.push(i)})),e.forEach((e=>{this.editor.currenDraw=e,this.splitWallCommand.splitMain()}))}this.editor.currenDraw=e;let t="";this.editor.startChooseWall?(t=this.editor.startChooseWall[0].object,this.editor.currenDraw.wallID=t.wallID):t=this.moveCommandObj.oldMesh;let i=this.editor.currenDraw,r=0,n=$9QhXH.DM.getWallJson(this.editor.allWalls),o=new(0,$5XTH3.DrawWallTool);this.editor.allWalls=o.create2DWall(n),this.editor.allWalls.pop(),this.spiltOldWall.forEach((e=>{let t=this.editor.getWallByWallId(this.spiltWall[r].wallID),i=$9HO6e.UtilCore.getNewPoint(t),n=$9HO6e.UtilCore.getNewPoint(t,"end");this.editor.getAllWindowInWall(t).forEach((r=>{if(!r.center)return;let o=$9HO6e.UtilCore.getNewPoint(e[0]),a=$9HO6e.UtilCore.getNewPoint(e[0],"end"),s=1*$9HO6e.UtilCore.toVector3(r.center).distanceTo($9HO6e.UtilCore.toVector3(o)),l=1*$9HO6e.UtilCore.toVector3(r.center).distanceTo($9HO6e.UtilCore.toVector3(a)),c=s,h="start";s>l&&(c=l,h="end");let d=i.clone().add(t.endPoint.clone().sub(t.startPoint.clone()).setLength(c));if("end"==h&&(d=n.clone().add(t.startPoint.clone().sub(t.endPoint.clone()).setLength(c))),this.editor.currentDoor=r,this.editor.currenDraw=r,"circle"==t.isArc){let o=t.cp.distanceTo(t.arcCenter),a=r.center.clone().sub(e[0].arcCenter.clone()),s=t.arcCenter.clone().add(a.setLength(o));new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor,"door","end",[r,[s,i,n,t.arcCenter],"center"]).execute()}else new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor,"door","end",[r,[d,i,n],"center"]).execute();this.editor.doorHelperGroupClean(),this.editor.currentDoor=""})),r+=1})),this.editor.currenDraw=i,this.editor.currenDraw.wallID=t.wallID;let a=new(0,$4xklQ.Vector3)((t.startPoint.x+t.endPoint.x)/2,(t.startPoint.y+t.endPoint.y)/2),s=this.editor.getAllWindowInWall(t),l=0,c=0;if("circle"==t.isArc&&(l=this.editor.currenDraw.cp.distanceTo(this.editor.currenDraw.arcCenter),c=this.editor.currenDraw.arcCenter),s.length>0){let e=$9HO6e.UtilCore.getNewPoint(this.editor.currenDraw),i=$9HO6e.UtilCore.getNewPoint(this.editor.currenDraw,"end"),r=new(0,$4xklQ.Vector3)((e.x+i.x)/2,(e.y+i.y)/2,0).clone().sub(a.clone());s.forEach((n=>{if(!n.center)return;this.editor.currentDoor=n;let o=n.center.clone().add(r.clone());if(this.editor.currenDraw=n,"circle"==t.isArc){let r=n.center.clone().sub(t.arcCenter.clone()),o=c.clone().add(r.setLength(l));new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor,"door","end",[n,[o,e,i,c],"center"]).execute()}else new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor,"door","end",[n,[o,e,i],"center"]).execute();this.editor.doorHelperGroupClean(),this.editor.currentDoor=""}))}this.editor.currenDraw&&(this.delCommonPoint(this.editor.currenDraw.startPoint.clone()),this.delCommonPoint(this.editor.currenDraw.endPoint.clone())),this.editor.currenDraw="";let h=this.editor.allWalls.slice(0);h.forEach((e=>{let t=$9HO6e.UtilCore.getSamePositionWall(e,h);if(t.length>1){let i=t.pop();$9HO6e.UtilCore.extendParamWall(e,i),t.forEach((e=>{this.editor.removeWall(e)}))}$9HO6e.UtilCore.isSameVector(e.startPoint,e.endPoint)&&this.editor.removeWall(e)})),new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).wallToJson();let d=[];this.editor.otherMeshs.forEach((e=>{let t=this.editor.getWallByWallId(e.wallId),i=!1;""==t&&(i=!0,this.editor.allWalls.forEach((t=>{$9HO6e.UtilCore.pointInLine(e.center,$9HO6e.UtilCore.handleLineData(t.startPoint,t.endPoint))&&$9HO6e.UtilCore.pointIsInLine(e.center,t.startPoint,t.endPoint)&&(e.wallId=t.wallID,e.wallDep=t.thickness,e.wallStartPoint=t.startPoint,e.wallEndPoint=t.startPoint,i=!1)}))),i&&d.push(e)})),d.forEach((e=>{this.editor.scene.remove(e),this.editor.otherMeshs.indexOf(e)>=0&&this.editor.otherMeshs.splice(this.editor.otherMeshs.indexOf(e),1)}))}}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}delCommonPoint(e){let t=$9HO6e.UtilCore.havePointWall(e,this.editor.allWalls);2==t.length&&$9HO6e.UtilCore.wallIsInLine(t[0],t[1])&&(this.editor.pointHelperGroup.children.slice(0).forEach((e=>{"clickPoint"!=e.useType&&"moveOuterPoint"!=e.useType||e.parent.remove(e)})),this.editor.margeWall(t[0],t[1]))}getNearPoint(e,t,i){let r=!!t&&$9HO6e.UtilCore.handleLineData(t.startPoint,t.endPoint),n=!!i&&$9HO6e.UtilCore.handleLineData(i.startPoint,i.endPoint),o="",a=0,s="",l=0;return this.editor.moveRule[7].forEach((t=>{if(t.uuid==e.uuid)return;let i=!!r&&$9HO6e.UtilCore.pointInLine(t.startPoint,r),c=!!r&&$9HO6e.UtilCore.pointInLine(t.endPoint,r),h=!!n&&$9HO6e.UtilCore.pointInLine(t.startPoint,n),d=!!n&&$9HO6e.UtilCore.pointInLine(t.endPoint,n);if(i||c||h||d){if(i||c){let i=t.startPoint;c&&(i=t.endPoint);let r=e.startPoint.clone().distanceTo(i);(0==a||r<a)&&(o=i,a=r)}if(h||d){let i=t.startPoint;c&&(i=t.endPoint);let r=e.endPoint.clone().distanceTo(i);(0==l||r<l)&&(s=i,l=r)}}})),[o,s,a,l]}moveCoreMain(e,t){let i=!1,r=t[0],n=t[1],o=t[2],a=t[3],s="",l="",c=$9HO6e.UtilCore.handleLineData(e.startPoint,e.endPoint),h=$9HO6e.UtilCore.moveLineToPoint(this.editor.currentPoint,c.slice(0)),d=this.getNearPoint(e,r,n),u="",p="";d[0]&&d[1]?d[2]>d[3]?(u=d[3],p=d[1]):(u=d[2],p=d[0]):(d[0]&&(u=d[2],p=d[0]),d[1]&&(u=d[3],p=d[1]));let m=this.editor.startChooseWall[0].object;if(m.uuid==e.uuid){let t=$9HO6e.UtilCore.handleLineData(m.startPoint,m.endPoint);if($9HO6e.UtilCore.getDistanceLine(t,h)<e.thickness)return}else if(e.cover){let t=e.cover.clone();if($9HO6e.UtilCore.smallDistanceByPointOnLine(h,t).clone().distanceTo($9HO6e.UtilCore.toVector3(t))<e.thickness)return}else""!=u&&u<e.thickness/2&&(h=$9HO6e.UtilCore.moveLineToPoint(p,c.slice(0)),i=p);if(0==o.length){let t=this.handleLineData(c,e.startPoint),i=$9HO6e.UtilCore.lineIsIntersection(h,t);i&&(s=i)}else if(1==o.length){let t=$9HO6e.UtilCore.handleLineData(r.startPoint,r.endPoint),i=$9HO6e.UtilCore.lineIsIntersection(h,t);if(i)s=i;else{let t=this.handleLineData(c,e.startPoint),i=$9HO6e.UtilCore.lineIsIntersection(h,t);i&&(s=i)}}else{let e=$9HO6e.UtilCore.handleLineData(r.startPoint,r.endPoint),t=$9HO6e.UtilCore.lineIsIntersection(h,e);t&&(s=t)}if(0==a.length){let t=this.handleLineData(c,e.endPoint),i=$9HO6e.UtilCore.lineIsIntersection(h,t);i&&(l=i)}else if(1==a.length){let t=$9HO6e.UtilCore.handleLineData(n.startPoint,n.endPoint),i=$9HO6e.UtilCore.lineIsIntersection(h,t);if(i)l=i;else{let t=this.handleLineData(c,e.endPoint),i=$9HO6e.UtilCore.lineIsIntersection(h,t);i&&(l=i)}}else{let e=$9HO6e.UtilCore.handleLineData(n.startPoint,n.endPoint),t=$9HO6e.UtilCore.lineIsIntersection(h,e);t&&(l=t)}if(s&&l&&!e.isArc){this.editor.allWalls.slice(0).forEach((e=>{"move"==e.status&&this.editor.removeWall(e)})),r&&this.repairWallNew(s,this.editor.moveRule[4],e,r,o,"start",this.editor.moveRule[6]),n&&this.repairWallNew(l,this.editor.moveRule[5],e,n,a,"end",this.editor.moveRule[6])}return[s,l,i]}repairWallNew(e,t,i,r,n,o,a){let s="",l="",c=0;if(this.editor.moveRule[7].forEach((n=>{if($9HO6e.UtilCore.checkSameWall(n,a))return;let o=$9HO6e.UtilCore.checkWallContainPoint(e.x,e.y,n.startPoint.x,n.startPoint.y,n.endPoint.x,n.endPoint.y),h=$9HO6e.UtilCore.checkWallContainPoint(n.startPoint.x,n.startPoint.y,e.x,e.y,t.x,t.y),d=$9HO6e.UtilCore.checkWallContainPoint(n.endPoint.x,n.endPoint.y,e.x,e.y,t.x,t.y),u=$9HO6e.UtilCore.handleLineData(r.startPoint,r.endPoint),p=$9HO6e.UtilCore.handleLineData(n.startPoint,n.endPoint),m=$9HO6e.UtilCore.lineIsIntersection(u,p);o&&!m&&(s=n);let f="";if(h&&(f=n.startPoint),d&&(f=n.endPoint),!f)return;if($9HO6e.UtilCore.isSameVector(f,e)||$9HO6e.UtilCore.isSameVector(t,f))return;if(n.uuid==i.uuid)return;let g=f.clone().distanceTo(e);0==c?(l=f,c=g):g<c&&(l=f)})),s)1==n.length?l?this.editor.removeWall(n[0]):this.repairWall(n[0],e,t):2==n.length&&this.mergeWall(n);else if(l){let t=$9HO6e.UtilCore.havePointWall(l,this.editor.moveRule[7],i);if(2==n.length&&this.mergeWall(n),t.length>1)this.repairWall(i,e,l,"newWall");else{let t=$9HO6e.UtilCore.havePointWall(l,this.editor.allWalls,i);this.repairWall(t[0],e,l)}}else 1!=n.length||$9HO6e.UtilCore.wallIsInLine(a,r)?(2==n.length&&this.mergeWall(n),$9HO6e.UtilCore.checkSameWallByPoint(r.startPoint,r.endPoint,e,t)||this.repairWall(i,e,t,"newWall")):this.repairWall(r,e,t)}getWallIntersection(e,t){if(e.isArc)return[1,1];let i=!1,r=e.startPoint,n=e.endPoint,o=$9HO6e.UtilCore.handleLineData(r,n),a="",s="",l=$9HO6e.UtilCore.moveLineToPoint(this.editor.currentPoint,o.slice(0));if(t[4]||t[5]){0!=t[0].length&&this.linkWall.push(...t[0]),0!=t[1].length&&this.linkWall.push(...t[1]);let a=t[0],s=t[2],c="start";if(t[5]&&(a=t[1],s=t[3],c="end"),t[4]&&t[5]){let i=$9HO6e.UtilCore.isSameVector(e.startPoint,t[2]),r=$9HO6e.UtilCore.isSameVector(e.endPoint,t[3]);if(r||i)r&&(a=t[0],s=t[2],c="start");else{e.startPoint.clone().distanceTo(t[2].clone())<e.endPoint.clone().distanceTo(t[3].clone())?(a=t[0],s=t[2],c="start"):(a=t[1],s=t[3],c="end")}}let h=s.clone().distanceTo($9HO6e.UtilCore.toVector3(r));"end"==c&&(h=s.clone().distanceTo($9HO6e.UtilCore.toVector3(n)));let d=this.editor.startChooseWall[0].object;if(d.wallID==e.wallID){let t=$9HO6e.UtilCore.handleLineData(d.startPoint,d.endPoint);if($9HO6e.UtilCore.getDistanceLine(t,l)<e.thickness)return}else if(e.cover){let t=e.cover.clone();if($9HO6e.UtilCore.smallDistanceByPointOnLine(l,t).clone().distanceTo($9HO6e.UtilCore.toVector3(t))<e.thickness)return}else 0!=h&&(l=$9HO6e.UtilCore.moveLineToPoint(s,o.slice(0)),i=s)}if(0==t[0].length){let e=this.handleLineData(o,r),t=$9HO6e.UtilCore.lineIsIntersection(l,e);t&&(a=t)}else if(1==t[0].length){let i=$9HO6e.UtilCore.handleLineData(t[0][0].startPoint,t[0][0].endPoint),n=$9HO6e.UtilCore.lineIsIntersection(l,i);if(n)a=n,$9HO6e.UtilCore.checkHaveSameVertex(e,t[0][0])&&this.repairWall(t[0][0],a,t[2]);else{let i=this.handleLineData(o,r),n=$9HO6e.UtilCore.lineIsIntersection(l,i);n&&(a=n,this.repairWall(e,t[2],a,"newWall"))}}else if(t[0].length>1){let i=$9HO6e.UtilCore.getRealWallByIntersection(e,this.editor.currentPoint.clone(),t[0],t[2],"start");i=this.editor.moveRule[0];let n=$9HO6e.UtilCore.handleLineData(i.startPoint,i.endPoint),s=$9HO6e.UtilCore.lineIsIntersection(l,n);if(2==t[0].length&&this.mergeWall(t[0]),s&&(a=s),s){$9HO6e.UtilCore.pointIsInLine(a,i.startPoint,i.endPoint)||this.repairWall(i,a,t[2],"noMarge")}else{let i=this.handleLineData(o,r),n=$9HO6e.UtilCore.lineIsIntersection(l,i);n&&(a=n,this.repairWall(e,t[2],a,"newWall"))}}if(0==t[1].length){let e=this.handleLineData(o,n),t=$9HO6e.UtilCore.lineIsIntersection(l,e);t&&(s=t)}else if(1==t[1].length){let i=$9HO6e.UtilCore.handleLineData(t[1][0].startPoint,t[1][0].endPoint),r=$9HO6e.UtilCore.lineIsIntersection(l,i);if(r)s=r,$9HO6e.UtilCore.checkHaveSameVertex(e,t[1][0])&&this.repairWall(t[1][0],s,t[3]);else{let i=this.handleLineData(o,n),r=$9HO6e.UtilCore.lineIsIntersection(l,i);r&&(s=r,this.repairWall(e,t[3],s,"newWall"))}}else if(t[1].length>1){let i=$9HO6e.UtilCore.getRealWallByIntersection(e,this.editor.currentPoint.clone(),t[1],t[3],"end");i=this.editor.moveRule[1];let r=$9HO6e.UtilCore.handleLineData(i.startPoint,i.endPoint),a=$9HO6e.UtilCore.lineIsIntersection(l,r);if(2==t[1].length&&this.mergeWall(t[1]),a&&(s=a),a){$9HO6e.UtilCore.pointIsInLine(s,i.startPoint,i.endPoint)||this.repairWall(i,s,t[3],"noMarge")}else{let i=this.handleLineData(o,n),r=$9HO6e.UtilCore.lineIsIntersection(l,i);r&&(s=r,this.repairWall(e,t[3],s,"newWall"))}}return[a,s,i]}handleLineData(e,t){let i=e.slice(0);return"X"==e[0]?(i[0]="Y",i[2]=t.x):"Y"==e[0]?(i[0]="X",i[2]=t.y):(i[0]="XY",i[1]=-1/e[1],i[2]=t.y-i[1]*t.x),i}mergeWall(e){if(2!=e.length)return"";let t=$9HO6e.UtilCore.handleLineData(e[0].startPoint,e[0].endPoint),i=$9HO6e.UtilCore.handleLineData(e[1].startPoint,e[1].endPoint);if(Math.abs(t[1]-i[1])>.1||t[0]!=i[0])return;let r=e[0],n=e[1];if(""!=r&&""!=n){let e=$9HO6e.UtilCore.isSameVector(r.startPoint,n.startPoint),t=$9HO6e.UtilCore.isSameVector(r.startPoint,n.endPoint),i=$9HO6e.UtilCore.isSameVector(r.endPoint,n.startPoint),o=$9HO6e.UtilCore.isSameVector(r.endPoint,n.endPoint),a="",s="";e?(a=r.endPoint,s=n.endPoint):t?(a=r.endPoint,s=n.startPoint):i?(a=r.startPoint,s=n.endPoint):o&&(a=r.startPoint,s=n.startPoint),this.editor.removeWall(r),this.editor.removeWall(n),this.editor.allWalls.forEach((e=>{if("mergeWall"!=e.statusWall)return;let t=a,i=s,r=e.startPoint,n=e.endPoint,o=$9HO6e.UtilCore.isSameVector(t,r)||$9HO6e.UtilCore.isSameVector(t,n),l=$9HO6e.UtilCore.isSameVector(i,r)||$9HO6e.UtilCore.isSameVector(i,n);o&&l&&this.editor.removeWall(e)}));let l=this.editor.addWall(a,s);return l.statusWall="mergeWall",l.status="move",l.style=r.style,l.height=r.height,l.thickness=r.thickness,l}return""}repairWall(e,t,i,r=""){let n=$9HO6e.UtilCore.getMeshOtherPoint(e,i),o={oldMesh:this.editor.startChooseWall[0].object,currentMesh:"",center:t},a="";if("noMarge"==r){let e=240,r=i.clone().distanceTo(t.clone());if(i==t||r<=this.editor.centerArea)return;this.editor.allWalls.slice(0).forEach((r=>{let n=r.startPoint,o=r.endPoint;$9HO6e.UtilCore.checkContainWall(i,t,n,o)&&(this.editor.removeWall(r),e=1*r.thickness)})),a=this.editor.addWall(i,t,e)}else if("newWall"==r)a=this.editor.addWall(i,t),a.wallID=e.wallID;else{if($9HO6e.UtilCore.isSameVector(n,t))return;if(e.status="remove",this.editor.removeHelperByWall(e),e.isArc){let r=this.getArcOtherPoint(n,t,e,i);"bezier"==e.isArc&&(r=e.cp),a=$9HO6e.UtilCore.isSameVector(e.startPoint,i)?this.editor.addArcWall(t,n,r,e.isArc):this.editor.addArcWall(n,t,r,e.isArc),a.wallID=e.wallID}else a=$9HO6e.UtilCore.isSameVector(e.startPoint,i)?this.editor.addWall(t,n,1*e.thickness):this.editor.addWall(n,t,1*e.thickness);a.wallID=e.wallID}return""!=a&&(a.status="move",a.style=e.style,a.height=e.height,a.thickness=e.thickness,"newWall"!=r&&(this.spiltWall.push(a),this.spiltOldWall.push([e,e.startPoint,e.endPoint,n]))),o.currentMesh=a,this.sureMove&&this.repairCommandObj.push(o),a}getArcOtherPoint(e,t,i,r){let n=e.clone().distanceTo(i.arcCenter.clone()),o=new(0,$4xklQ.Vector2)((e.x+r.x)/2,(e.y+r.y)/2),a=new(0,$4xklQ.Vector2)((e.x+t.x)/2,(e.y+t.y)/2),s=e.clone().distanceTo(r.clone()),l=s/2/n,c=n*(e.clone().distanceTo(t.clone())/2)/(s/2),h=c*Math.sqrt(1-l*l),d=a.clone().add(i.arcCenter.clone().sub(o.clone()).setLength(h));return Math.abs(l-1)<1e-4&&(d=a.clone()),d.clone().add(i.cp.clone().sub(i.arcCenter.clone()).setLength(c))}}var $9HO6e=parcelRequire("9HO6e");class $8b583e2b755b0fc3$export$12c0e9563e080ba5{constructor(e){this.editor=e,this.dis="",this.arr=[],this.oldWallArr=[]}moveVertexMain(e=!1){if("Mesh"==this.editor.currenDraw.type)return;let t=this.editor.currentDownSelect[0].object.parent.center,i=!1;if(this.editor.otherMeshs.forEach((e=>{if("UWindow"==e.modelType){let r=this.editor.getWallByWallId(e.wallId),n=e.leftWindow[0],o=e.rightWindow[0],a=$9HO6e.UtilCore.isSameVector(r.startPoint,t)||$9HO6e.UtilCore.isSameVector(r.endPoint,t),s=$9HO6e.UtilCore.isSameVector(n.startPoint,t)||$9HO6e.UtilCore.isSameVector(n.endPoint,t),l=$9HO6e.UtilCore.isSameVector(o.startPoint,t)||$9HO6e.UtilCore.isSameVector(o.endPoint,t);(a||s||l)&&(i=!0)}})),i)return;""!=this.editor.currenDraw&&this.editor.scene.remove(...this.editor.currenDraw),this.editor.currenDraw=[],0==this.editor.samePointWall.length&&(this.editor.samePointByDrag=t.clone(),this.editor.samePointWall=$9HO6e.UtilCore.havePointWall(t,this.editor.allWalls));let r=this.editor.samePointByDrag.clone();this.editor.samePointWall.forEach((i=>{this.editor.removeHelperByWall(i);let n=$9HO6e.UtilCore.isSameVector(r,i.endPoint),o=t,a=i.endPoint;n?(o=i.startPoint,a=t,e&&(i.endPoint=t)):e&&(i.startPoint=t);let s=new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).createLineWall(o,a,1*i.thickness);s.material.color=this.editor.getWallColor(s),s.wallID=i.wallID,this.editor.currenDraw.push(s),this.arr.push(s)})),this.editor.scene.add(...this.editor.currenDraw),this.editor.currentPoint=$9HO6e.UtilCore.handleSpecialPoint(this.editor.currentPoint.clone(),this.editor.specialPointArr,this.editor),this.editor.currentDownSelect[0].object.parent.center.x=this.editor.currentPoint.x,this.editor.currentDownSelect[0].object.parent.center.y=this.editor.currentPoint.y}execute(){this.splitWallCommand=new $46f32ef2047263b6$export$6bf150a1b9f8c161(this.editor);let e=[];this.editor.samePointWall.forEach((t=>{let i=$9HO6e.UtilCore.getNewPoint(t),r=$9HO6e.UtilCore.getNewPoint(t,"end");e.push([t.wallID,i,r])})),this.moveVertexMain(!0),this.arr.forEach((e=>{let t=this.editor.getWallByWallId(e.wallID);this.editor.currenDraw=t,this.splitWallCommand.splitMain()})),new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).wallToJson("2D",[],"noHole"),this.arr.forEach((t=>{let i=this.editor.getWallByWallId(t.wallID),r=this.editor.getAllWindowInWall(i);r.length>0&&r.forEach((t=>{if(!t.center)return;this.editor.currentDoor=t;let r=this.getOldWall(t.wallId,e);if(!r)return this.editor.currenDraw=t,new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor,"door","end",[t,[t.center,i,i],"wall"]).execute(),this.editor.doorHelperGroupClean(),this.editor.currentDoor="",void(this.editor.doorDistance="");let n=r[1],o=r[2],a=1*$9HO6e.UtilCore.toVector3(t.center).distanceTo($9HO6e.UtilCore.toVector3(n)),s=1*$9HO6e.UtilCore.toVector3(t.center).distanceTo($9HO6e.UtilCore.toVector3(o));""==this.editor.doorDistance&&(this.editor.doorDistance=a<s?[a,n,o,"start"]:[s,o,n,"end"]);let l=$9HO6e.UtilCore.getNewPoint(i),c=$9HO6e.UtilCore.getNewPoint(i,"end"),h=i.endPoint.clone().sub(i.startPoint.clone()),d=l.clone().add(h.setLength(this.editor.doorDistance[0]));"end"==this.editor.doorDistance[3]&&(h=i.startPoint.clone().sub(i.endPoint.clone()),d=c.clone().add(h.setLength(this.editor.doorDistance[0]))),this.editor.currenDraw=t,new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor,"door","end",[t,[d,i,i],"wall"]).execute(),this.editor.doorHelperGroupClean(),this.editor.currentDoor="",this.editor.doorDistance=""}))})),new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).wallToJson(),this.editor.addIntersectPointHelper(),this.editor.currenDraw="",this.editor.doorDistance="",this.editor.samePointWall=[],this.editor.samePoint=""}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}getOldWall(e,t){let i="";return t.forEach((t=>{t[0]==e&&(i=t)})),i}}var $4xklQ=parcelRequire("4xklQ"),$9HO6e=parcelRequire("9HO6e");class $e25392babd100f13$export$203d609e8f23eda2{constructor(e,t){this.editor=e,this.tool=t,this.wallHelp=new $d0f874000594cf7a$export$a955f3d6a39ce4b2}drawMain(){let e=this.editor.currentDownSelect[0].object.parent.currentModel;this.editor.doorHelperGroupClean(),this.editor.cleanModelHelper(),""!=this.editor.currenDraw&&this.editor.scene.remove(this.editor.currenDraw),this.editor.scene.children.slice(0).forEach((e=>{"rotateTool"==e.useType&&this.editor.scene.remove(e)}));let t="";if(e)t=e.parent,e.modelType&&e.modelType.indexOf("Model")>=0&&(t=e);else{t=this.editor.currentDownSelect[0].object.parent;let e=this.editor.currentDownSelect[0].object;e=this.editor.getOuterParent(e),e.modelType&&e.modelType.indexOf("Model")>=0&&(t=e)}if("rotateTool"==this.tool){let i=!1;this.editor.doorHelperGroup.children.forEach((e=>{"rotateClock"!=e.useType||(i=!0)})),i||this.editor.doorHelperGroup.add(this.wallHelp.addRotateTool(e));let r=this.editor.currentDownSelect[0].object.parent;this.editor.currentDownSelect.length>0&&this.editor.pointHelperGroup.remove(r);let n=r.arcCenter,o=r.arcRadio,a=this.editor.currentPoint.clone().sub(n.clone());a.setLength(o);let s=n.clone().add(a),l=new(0,$4xklQ.Vector3)(n.x,n.y-o,0),c=l.clone().sub(n.clone()).angleTo(s.clone().sub(n.clone()));s.x<l.x&&(c=2*Math.PI-c);for(let e=0;e<9;e++)Math.abs(45*e-180/Math.PI*c)<=10&&(c=e*(Math.PI/4));let h=parseInt(180/Math.PI*c);this.editor.currenDraw=this.wallHelp.makeRotateToolGem(n,c-Math.PI/2-Math.PI/4,c-Math.PI/2+Math.PI/4,o,this.editor.config.angleToolChooseColor,100),this.editor.currenDraw.currentModel=e,this.editor.scene.add(this.editor.currenDraw),t.currentAngle=c,t.quaternion.copy((new(0,$4xklQ.Quaternion)).setFromAxisAngle(new(0,$4xklQ.Vector3)(0,0,1),c));let d=(new $d0f874000594cf7a$export$a955f3d6a39ce4b2).createHelperForMumber(t);this.editor.pointHelperGroup.add(d[0]),h<0&&(h+=360),360==h&&(h=0);let u=this.editor.getScreenPosition(this.editor.currentPoint.clone());this.editor.list.blackBox.dispatch(u.x,u.y,h)}else if("moveTool"==this.tool){let e=this.editor.currentPoint.clone();if($9HO6e.UtilCore.isSameVector(e,new(0,$4xklQ.Vector3)(0,0,0)))return;let i=this.editor.downPoint,r=new(0,$4xklQ.Vector3);r.copy(e).sub(i),t.position.copy(r).add(this.editor._offsetStart);let n=(new $d0f874000594cf7a$export$a955f3d6a39ce4b2).createHelperForMumber(t);this.editor.pointHelperGroup.add(...n)}else if("scaleTool"==this.tool){let i=["-XY","-X","-X-Y","Y","-Y","XY","X","X-Y"];e.updateMatrix();let r=(new $d0f874000594cf7a$export$a955f3d6a39ce4b2).createHelperForMumber(t);this.editor.pointHelperGroup.add(r[0]);let n=this.scaleTool(t,i.indexOf(this.editor.currentDownSelect[0].object.scaleDir)+1,this.editor.currentPoint.clone());n.x>0&&n.y>0&&n.z>0&&this.applyScale(t,i.indexOf(this.editor.currentDownSelect[0].object.scaleDir)+1,n)}if(this.editor.synchroModel(t),this.editor.list.hiddenDialog.dispatch(),this.editor.clickDepthMsg.uuid){this.editor.modelDotGroup.children=[];let e=this.editor.getOuterParent(t,t,"outer"),i=e.param[0];this.editor.refreshRealSizeByBox(e,t),this.editor.updateModelPosition(t.parent,e),this.editor.addDashBoxFor2dGroup(e),this.editor.addDashBoxForGroup(i)}}execute(){""!=this.editor.currenDraw&&this.editor.scene.remove(this.editor.currenDraw);let e=this.editor.currentDownSelect[0].object.parent.currentModel;this.editor.currenDraw="";let t="";if(e)t=e.parent,e.modelType&&e.modelType.indexOf("Model")>=0&&(t=e);else{t=this.editor.currentDownSelect[0].object.parent;let e=this.editor.currentDownSelect[0].object;e.modelType&&e.modelType.indexOf("Model")>=0&&(t=e)}let i=this.editor.getOuterParent(t,t,"outer");"{}"==JSON.stringify(this.editor.clickDepthMsg)&&i&&i.uuid!=t.uuid&&(t=i),this.editor.addLineHelperForMember(t),this.editor.doorHelperGroup.children.forEach((e=>{"rotateClock"!=e.useType||this.editor.doorHelperGroup.remove(e)}))}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}scaleTool(e,t,i){let r=new(0,$4xklQ.Vector3)(1,1,1);var n=e.matrix.clone();e.position.set(0,0,0),e.rotation.set(0,0,0);var o=(new(0,$4xklQ.Box3)).setFromObject(e),a=(o.max.x-o.min.x)/2,s=(o.max.y-o.min.y)/2,l=(a**2+s**2)**.5;e.scale.set(1,1,1),e.updateMatrixWorld(!0),e.applyMatrix4(n);let c=i.clone();e.parent.worldToLocal(c);var h=c.clone().sub(e.position).length();if(-1!=[1,3,6,8].indexOf(t)){var d=(h+l)/(2*l);r.x=d,r.y=d}else-1!=[2,7].indexOf(t)?r.x=(h+a)/(2*a):r.y=(h+s)/(2*s);return r}applyScale(e,t,i){e.updateMatrix();var r=e.matrix.clone();e.position.set(0,0,0),e.rotation.set(0,0,0),e.scale.set(1,1,1),e.updateMatrixWorld(!0);var n=(new(0,$4xklQ.Box3)).setFromObject(e),o=(n.max.x-n.min.x)/2,a=(n.max.y-n.min.y)/2,s=(n.max.z,n.min.z,0),l=0;switch(t){case 1:s=-o,l=a;break;case 2:s=-o;break;case 3:s=-o,l=-a;break;case 4:l=a;break;case 5:l=-a;break;case 6:s=o,l=a;break;case 7:s=o;break;case 8:s=o,l=-a}var c=(new(0,$4xklQ.Matrix4)).makeTranslation(s,l,0),h=(new(0,$4xklQ.Matrix4)).makeScale(i.x,i.y,1),d=(new(0,$4xklQ.Matrix4)).makeTranslation(-s,-l,-0);h.multiply(c),d.multiply(h),r.multiply(d),e.applyMatrix4(r)}}class $41d8560ca8780b9e$export$95a0b96ed37a9fe3{constructor(e,t="scale"){this.editor=e,this.type=t}drawMain(){""!=this.editor.currenDraw&&this.editor.cleanScaleTool();let e=this.editor.currentPoint,t="";if("scale"==this.type){let i=this.editor.currentDownSelect[0].object.otherPosition;t=i,"start"!=this.editor.currentDownSelect[0].object.positionType?(e=i,t=this.editor.currentPoint,t=this.handlePoint(i,t)):e=this.handlePoint(i,e)}else{let i=this.editor.currentDownSelect[0].object.parent,r=this.editor.downPoint.clone(),n=this.editor.currentPoint,o=n.clone().sub(r.clone()).setLength(1*n.clone().distanceTo(r.clone()));e=i.startPoint.clone().add(o.clone()),t=i.endPoint.clone().add(o.clone())}this.editor.currenDraw=this.editor.allHelperForScaleTool(e,t)}execute(){this.drawMain(),this.editor.currenDraw=""}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}handlePoint(e,t){return Math.abs(e.x-t.x)<=80&&(t.x=e.x),Math.abs(e.y-t.y)<=80&&(t.y=e.y),t}}class $349f250ecfb48a4c$export$c072eb4abd42caf{constructor(e){this.editor=e,this.wallCore=new $523a84362d27c3e8$export$b680ca477a72be07(e)}drawMain(){let e=this.editor.currentDownSelect[0].object.wall;this.editor.removeHelperByWall(e),e.cp=this.editor.currentPoint.clone();let t=e.startPoint,i=e.endPoint;""!=this.editor.currenDraw&&this.editor.scene.remove(this.editor.currenDraw),this.editor.currenDraw=this.wallCore.createCircleWall(t,i,this.editor.currentPoint,e.isArc),this.editor.scene.add(this.editor.currenDraw),this.editor.addBSRWallHelper(this.editor.currenDraw),this.editor.currenDraw.wallID=e.wallID}execute(){this.drawMain();let e=this.editor.allWalls.slice(0);e.forEach((e=>{e.wallID==this.editor.currenDraw.wallID&&(e.cp=this.editor.currentPoint)})),new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).wallToJson(),this.editor.addBSRWallHelper(this.editor.currenDraw);let t=this.editor.currentDownSelect[0].object.wall.wallID;e=this.editor.allWalls.slice(0),e.forEach((e=>{e.wallID==t&&(e.material.color=this.editor.chooseColor)})),this.editor.currenDraw=""}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}}var $9QhXH=parcelRequire("9QhXH"),$4xklQ=parcelRequire("4xklQ"),$9QhXH=parcelRequire("9QhXH"),$9HO6e=parcelRequire("9HO6e");class $cc13264a46e73685$export$c9cf1b7a5c1d69dd{constructor(e){this.editor=e}main(){""==this.editor.currenDraw&&(this.editor.doorHelperGroupClean(),this.editor.currenDraw=this.editor.currentDownSelect[0].object.parent);let e=this.editor.currenDraw.name,t=Math.round(this.editor.currenDraw.width*this.editor.currenDraw.scale.x),i=Math.round(this.editor.currenDraw.height*this.editor.currenDraw.scale.y),r=Math.round(this.editor.currenDraw.depth*this.editor.currenDraw.scale.z),n=this.editor.currentPoint.clone(),o=this.editor.allWalls.slice(0),a="",s=this.editor.currenDraw.rotation.z;this.editor.allWalls.forEach((e=>{let r=$9HO6e.UtilCore.smallDistanceByPointOnLine($9HO6e.UtilCore.handleLineData(e.startPoint,e.endPoint),n);if(!$9HO6e.UtilCore.pointIsInLine(r,e.startPoint,e.endPoint))return;let o=r.clone().distanceTo($9HO6e.UtilCore.toVector3(n));o<=e.thickness/2&&(a=e);let s=Math.min(t,i),l=e.thickness/2+s/2;o<=l&&(n=r.add($9HO6e.UtilCore.toVector2(n).sub(r.clone()).setLength(l)))})),a||(this.editor.scene.remove(this.editor.currenDraw),this.editor.otherMember.indexOf(this.editor.currenDraw)>=0&&this.editor.otherMember.splice(this.editor.otherMember.indexOf(this.editor.currenDraw),1),"bridge"==e?this.editor.currenDraw=$9QhXH.DM.createBeam(n,"beam",s,i,r,o,t):"flue"==e?(this.editor.currenDraw=$9QhXH.DM.createFlue(n,t,i,0),this.editor.currenDraw.rotation.z=s):"post"==e&&(this.editor.currenDraw=$9QhXH.DM.createBeam(n,"pillars",0,i,r,o,t),this.editor.currenDraw.rotation.z=s),this.editor.cleanModelHelper(),this.editor.switchHelperGroup("hidden"),this.editor.addLineHelperForMember(this.editor.currenDraw),this.editor.currenDraw.name=e,this.editor.scene.add(this.editor.currenDraw))}execute(){this.main(),this.editor.otherMember.push(this.editor.currenDraw),this.editor.addLineHelperForMember(this.editor.currenDraw),this.editor.currenDraw="",new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).wallToJson()}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}}class $a43a7063b14aae40$export$57f28e97ee2333c7{constructor(e){this.editor=e}main(){for(let e=0;e<this.editor.allWalls.length;e++){let t=this.editor.allWalls[e];if(t.children=[],!(this.editor.clickSelect.length>0&&this.editor.clickSelect[0].object==t))if(t.isArc&&"bezier"==t.isArc){let e=this.editor.pointHelperGroup.children.slice(0),i=!1;e.some((e=>{if("bseControl"==e.useType)return i=!0,!0})),i||(t.material.color=this.editor.getWallColor(t))}else t.material.color=this.editor.getWallColor(t)}let e=this.editor.pointHelperGroup.children.slice(0);for(let t=0;t<e.length;t++){let i=e[t];"moveOuterPoint"==i.useType&&this.editor.pointHelperGroup.remove(i),"rotateTool"==i.useType&&i.children.forEach((e=>{"Mesh"==e.type?e.material.color=this.editor.config.angleToolUnChooseColor:e.children[1].material.color=this.editor.config.angleToolUnChooseColor}))}this.editor.modelHelperGroup.children.slice(0).forEach((e=>{"moveModelBox"==e.name&&e.parent.remove(e)}));let t="";if(this.editor.currentMoveSelect.length>0){let e=this.editor.currentMoveSelect[0].object;if(t=e,e.parent&&e.parent.type&&"Group"==e.parent.type&&e.parent.children.forEach((e=>{"Line"!=e.type&&"Line2"!=e.type&&"DWHelper"!=e.type||e.material.color.equals(this.editor.moveDoorOutColor)&&!e.material.color.equals(this.editor.clickColor)&&(e.material.color=this.editor.moveDoorColor)})),"CodeModel"==this.editor.getOuterParent(e).modelType){let t=this.editor.getOuterParent(e),i=(new(0,$4xklQ.Box3)).setFromObject(t);const r=this.editor.wallHelp.addOBBbox(t,"#00EEFF");if(r.name="moveModelBox",r.layers.set(2),"UWindowMesh"==t.type&&(r.position.y+=(i.max.y-i.min.y)/2),"LWindowMesh"==t.type){let e=new(0,$4xklQ.Vector3);i.getCenter(e),r.position.copy(e.clone())}return r.material.depthTest=!1,void this.editor.modelHelperGroup.add(r)}if("3dMember"==e.parent.name){const t=this.editor.wallHelp.addOBBbox(e,"#00EEFF");return t.name="moveModelBox",t.layers.set(2),void this.editor.modelHelperGroup.add(t)}if("wall"==e.useType){if(this.editor.dom.style.cursor=$9HO6e.UtilCore.getCursorByWall(e),!(this.editor.clickSelect.length>0&&this.editor.clickSelect[0].object==e||0!=this.editor.currentDownSelect.length||(e.material.color=this.editor.chooseColor,e.isArc))){let t=e.startPoint.clone().distanceTo(e.endPoint)/this.editor.config.wallNum,i=e.geometry.attributes.position.array,r=new(0,$4xklQ.Vector3)(i[0],i[1],i[2]),n=(new(0,$4xklQ.Vector3)(i[3],i[4],i[5]),new(0,$4xklQ.Vector3)(i[6],i[7],i[8])),o=new(0,$4xklQ.Vector3)(i[9],i[10],i[11]),a=(new(0,$4xklQ.Vector3)(i[12],i[13],i[14]),new(0,$4xklQ.Vector3)(i[15],i[16],i[17])),s=$9HO6e.UtilCore.toVector3(e.endPoint).sub($9HO6e.UtilCore.toVector3(e.startPoint)),l=$9HO6e.UtilCore.toVector3(e.startPoint).add(s.setLength(t)),c=$9HO6e.UtilCore.toVector3(e.startPoint).add(s.setLength(t*(this.editor.config.wallNum-1))),h=new(0,$4xklQ.Vector3)(-s.y,s.x,0),d=l.clone().add(h.setLength(e.thickness/2)),u=l.clone().add(h.setLength(e.thickness/2).negate()),p=c.clone().add(h.setLength(e.thickness/2)),m=c.clone().add(h.setLength(e.thickness/2).negate()),f=this.editor.wallHelp.createSplitWallMesh([r,n,d,u],this.editor.config.wallFirstMaterial),g=this.editor.wallHelp.createSplitWallMesh([p,m,a,o],this.editor.config.wallFirstMaterial);e.add(f,g)}}else if("movePoint"==e.useType){let t=e.positionCenter;this.editor.pointHelperGroup.add((new $d0f874000594cf7a$export$a955f3d6a39ce4b2).createDoorOuterPoint(t))}else if("dragPoint"==e.useType){let t=e.parent.center;this.editor.pointHelperGroup.add((new $d0f874000594cf7a$export$a955f3d6a39ce4b2).createDoorOuterPoint(t,2*e.parent.radio,"rgb(26, 122, 251)")),this.editor.dom.style.cursor="move"}else if("rotateTool"==e.useType)e.parent.children.forEach((e=>{"Mesh"==e.type?e.material.color=this.editor.config.angleToolChooseColor:e.children[1].material.color=this.editor.config.angleToolChooseColor}));else if("scalePoint"==e.useType)this.editor.dom.style.cursor=$9HO6e.UtilCore.getCursorByScaleTool(e.linePoint[0],e.linePoint[1]);else if("scaleRuleTool"==e.useType){let t=e.positionCenter;this.editor.pointHelperGroup.add((new $d0f874000594cf7a$export$a955f3d6a39ce4b2).createDoorOuterPoint(t,100,"rgb(26, 122, 251)"))}else if("bseControl"==e.useType)this.editor.dom.style.cursor="move";else if("floor"==e.useType)for(let t=0;t<e.allPoints.length;t++){let i=e.allPoints[t],r=e.allPoints[0];t!=e.allPoints.length-1&&(r=e.allPoints[t+1]);let n=$9QhXH.DM.createLine([i,r],"#00EEFF",!1,2.5);n.useType="splitOuterLine",this.editor.splitRoomLineGroup.add(n)}}if(this.editor.mouseCoverObj&&(t=this.editor.mouseCoverObj),t){let e=this.editor.getOuterParent(t);if(this.editor.mouseCoverObj&&(e=this.editor.mouseCoverObj),e&&!e.visible)return;let i=[];this.editor.selectObjArr.forEach((e=>{let t=this.editor.getOuterParent(e);i.push(t.uuid)}));let r=i.indexOf(e.uuid)<0;if("3DModel"!=e.modelType&&"modelGroup"!=e.modelType||!r){if(("2DModel"==e.modelType||"2dModelGroup"==e.modelType)&&r){let t=[e];"2dModelGroup"==e.modelType&&(t=t.concat(e.children.slice(0))),t.forEach((e=>{const t=this.editor.wallHelp.addOBBbox(e.param[0],"#00EEFF");t.name="moveModelBox",t.layers.set(2),this.editor.modelHelperGroup.add(t);let i=this.editor.wallHelp.addOBB2DBox(t,"#00EEFF");i.name="moveModelBox",this.editor.modelHelperGroup.add(i)}))}}else{let t=[e];"modelGroup"==e.modelType&&(t=t.concat(e.children.slice(0))),t.forEach((e=>{const t=this.editor.wallHelp.addOBBbox(e,"#00EEFF");t.name="moveModelBox",t.layers.set(2),this.editor.modelHelperGroup.add(t);let i=this.editor.wallHelp.addOBB2DBox(t,"#00EEFF");i.name="moveModelBox",this.editor.modelHelperGroup.add(i)}))}}if(this.editor.currentDownSelect.length>0){if(this.editor.currentDownSelect[0].object.parent&&"CodeModel"==this.editor.currentDownSelect[0].object.parent.modelType)return;let e=this.editor.currentDownSelect[0].object.useType;if("wall"==e)new $671a9ada1efb021a$export$ad57cb3fe2de1d52(this.editor).moveWallMain();else if("dragPoint"==e)new $8b583e2b755b0fc3$export$12c0e9563e080ba5(this.editor).moveVertexMain();else if("rotateTool"==e)new $e25392babd100f13$export$203d609e8f23eda2(this.editor,"rotateTool").drawMain();else if("scalePoint"==e)new $e25392babd100f13$export$203d609e8f23eda2(this.editor,"scaleTool").drawMain();else if("scaleRuleTool"==e)new $41d8560ca8780b9e$export$95a0b96ed37a9fe3(this.editor).drawMain();else if("scaleHelpTool"==e)new $41d8560ca8780b9e$export$95a0b96ed37a9fe3(this.editor,"move").drawMain();else if("bseControl"==e)new $349f250ecfb48a4c$export$c072eb4abd42caf(this.editor).drawMain(this.editor.currentDownSelect[0].object.wall);else if(this.editor.dom.style.cursor="move","movePoint"==this.editor.currentDownSelect[0].object.useType)new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor,"door",this.editor.currentDownSelect[0].object.positionType).drawMain();else{let e=["beam","flue","pillars"],t=this.editor.currentDownSelect[0].object;if(e.indexOf(this.editor.currentDownSelect[0].object.parent.modelType)>=0||t.modelType&&t.modelType.indexOf("Model")>=0){let i=!1;if(i=e.indexOf(this.editor.currentDownSelect[0].object.parent.modelType)>=0?this.editor.currentDownSelect[0].object.parent.isLock:this.editor.getOuterParent(t).isLock,i){let e=this.editor.getScreenPosition(this.editor.currentPoint.clone());this.editor.list.blackBox.dispatch(e.x,e.y,"该模型已锁定,请先解锁")}else{let i=!1;if(this.editor.pointHelperGroup.children.forEach((e=>{"rotateTool"!=e.useType&&"scaleTool"!=e.useType||(i=!0)})),i){let i=this.editor.getOuterParent(t);i&&i.modelType&&(i.modelType.indexOf("Model")>=0||i.modelType.indexOf("model")>=0)?this.editor.mouseCoverObj=i:e.indexOf(this.editor.currentDownSelect[0].object.parent.modelType)>=0?new $cc13264a46e73685$export$c9cf1b7a5c1d69dd(this.editor).main():new $e25392babd100f13$export$203d609e8f23eda2(this.editor,"moveTool").drawMain()}}}else{let e=this.editor.getOuterParent(t);if(e&&e.modelType&&(e.modelType.indexOf("Model")>=0||e.modelType.indexOf("model")>=0)){let t=e.isLock;if(!e.visible)return;if(t){let e=this.editor.getScreenPosition(this.editor.currentPoint.clone());this.editor.list.blackBox.dispatch(e.x,e.y,"该模型已锁定,请先解锁")}else{this.editor.modelHelperGroup.children=[],this.editor.list.hiddenDialog.dispatch(),this.editor.mouseCoverObj=e;const t=this.editor.wallHelp.addOBBbox(e,"#00EEFF");t.name="moveModelBox",t.layers.set(2),this.editor.modelHelperGroup.add(t),this.editor.doorHelperGroupClean(),this.editor.addLineHelperForMember(e.param[0])}}else{if(0==this.editor.clickSelect.length)return;if(this.editor.currentDownSelect[0].object.parent.uuid!=this.editor.clickSelect[0].object.parent.uuid)return;if(this.editor.currentDownSelect[0].object.parent.isLock){let e=this.editor.getScreenPosition(this.editor.currentPoint.clone());this.editor.list.blackBox.dispatch(e.x,e.y,"该模型已锁定,请先解锁")}else new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor,"door").drawMain()}}}}""!=this.editor.mouseCoverObj&&new $c338f49977b1ce90$export$4eacab61b79af859(this.editor).main()}}parcelRequire("9HO6e");var $9HO6e=parcelRequire("9HO6e"),$4xklQ=parcelRequire("4xklQ"),$9QhXH=parcelRequire("9QhXH");class $6f108bd13133889a$export$66788100995c7b02{constructor(e,t=[],i=!0){this.editor=e,this.type=this.editor.toolType,this.param=t,this.redrew=i}drawMain(){let e=0,t=800;""!=this.editor.currenDraw&&(t=this.editor.currenDraw.width?this.editor.currenDraw.width:this.editor.currenDraw.realWidth,e=this.editor.currenDraw.angle,this.editor.scene.remove(this.editor.currenDraw),this.editor.otherMember.indexOf(this.editor.currenDraw)>=0&&this.editor.otherMember.splice(this.editor.otherMember.indexOf(this.editor.currenDraw),1)),this.editor.currentMoveSelect.forEach((t=>{let i=t.object;i.useType&&"wall"==i.useType&&(e=new(0,$4xklQ.Vector2)(i.endPoint.x,i.endPoint.y).sub(new(0,$4xklQ.Vector2)(i.startPoint.x,i.startPoint.y)).angle())}));let i=this.type,r=this.editor.currentPoint,n=400,o=this.editor.allWalls.slice(0);if("post"!=i&&"flue"!=i||(n=650,t=650),this.editor.copyDoor&&(t=Math.round(this.editor.copyDoor.width*this.editor.copyDoor.scale.x),n=Math.round(this.editor.copyDoor.height*this.editor.copyDoor.scale.y)),0!=this.param.length){let a=this.editor.clickSelect[0].object.parent;t=a.width,n=a.height,r=a.center,i=this.param[2],e=a.angle,o=!1,"width"==this.param[0]&&(t=this.param[1]),"height"==this.param[0]&&(n=this.param[1])}else"bridge"!=i&&this.editor.allWalls.forEach((i=>{let o=$9HO6e.UtilCore.smallDistanceByPointOnLine($9HO6e.UtilCore.handleLineData(i.startPoint,i.endPoint),r);if(!$9HO6e.UtilCore.pointIsInLine(o,i.startPoint,i.endPoint))return;let a=o.clone().distanceTo($9HO6e.UtilCore.toVector3(r)),s=Math.min(t,n),l=i.thickness/2+s/2;if(a<=l){let t=i.endPoint.clone().sub(i.startPoint.clone());e=t.angle(),r=o.add($9HO6e.UtilCore.toVector2(r).sub(o.clone()).setLength(l))}}));"bridge"==i?this.editor.currenDraw=$9QhXH.DM.createBeam(r,"beam",e,n,400,o,t):"flue"==i?(this.editor.currenDraw=$9QhXH.DM.createFlue(r,t,n,0),this.editor.currenDraw.rotation.z=e):"post"==i&&(this.editor.currenDraw=$9QhXH.DM.createBeam(r,"pillars",0,n,window.storeyHei,o,t),this.editor.currenDraw.rotation.z=e),this.editor.currenDraw.name=i,this.editor.scene.add(this.editor.currenDraw),this.editor.cleanModelHelper(),this.editor.switchHelperGroup("hidden"),this.editor.addPositionHelper(this.editor.currenDraw),this.param.length>0&&(this.editor.clickSelect[0].object.parent=this.editor.currenDraw,this.editor.currenDraw.position.copy(this.param[3]),this.editor.currenDraw.rotation.copy(this.param[4]),"rotation"==this.param[0]&&(this.editor.currenDraw.rotation.z=Math.PI/180*this.param[1]))}execute(){this.drawMain(),this.editor.otherMember.push(this.editor.currenDraw),this.editor.currenDraw="",this.redrew&&new $523a84362d27c3e8$export$b680ca477a72be07(this.editor).wallToJson(),this.param.length>0&&(this.editor.doorHelperGroupClean(),this.editor.addLineHelperForMember(this.editor.clickSelect[0].object.parent))}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}}class $5002053a529f5520$export$e0cf849ef0f13f5d{constructor(e,t){this.editor=e,this.useType=t}main(){switch(this.editor.toolType){case"wall":"moveDraw"==this.useType?(this.editor.list.stopPlayer.dispatch(),new $4e6d6bcbeea35653$export$e5e2c7c57f7de029(this.editor).drawMain()):(this.editor.list.startPlayer.dispatch(),this.editor.execute(new $4e6d6bcbeea35653$export$e5e2c7c57f7de029(this.editor),"画墙"));break;case"room":"moveDraw"==this.useType?(this.editor.list.stopPlayer.dispatch(),new $fff7b0667b4b396b$export$912fb411e26e3541(this.editor).drawMain()):(this.editor.list.startPlayer.dispatch(),this.editor.execute(new $fff7b0667b4b396b$export$912fb411e26e3541(this.editor),"画墙"));break;case"splitTool":"moveDraw"==this.useType?(this.editor.list.stopPlayer.dispatch(),new $b11833ee6970dca8$export$5be3661e3be4a62a(this.editor).drawMain()):(this.editor.list.startPlayer.dispatch(),this.editor.execute(new $b11833ee6970dca8$export$5be3661e3be4a62a(this.editor),"分割"));break;case"slidingdoor":case"doubledoor":case"window":case"baywindow":case"pass":case"frenchwindows":case"singledoor":case"singleDoubleDoor":case"childMotherDoor":case"moveDoor":case"straightWindow":case"straightBayWindow":case"UWindow":case"UBayWindow":case"UBayWindow":case"dooropen":case"archDoor":case"archWindow":case"arcDoor":case"arcWindow":case"LWindow":case"LBayWindow":case"UWindow":case"UBayWindow":case"door":"moveDraw"==this.useType?(this.editor.list.stopPlayer.dispatch(),new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor).drawMain()):(this.editor.list.startPlayer.dispatch(),this.editor.execute(new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor),"画门"));break;case"bridge":case"flue":case"post":"moveDraw"==this.useType?(this.editor.list.stopPlayer.dispatch(),new $6f108bd13133889a$export$66788100995c7b02(this.editor).drawMain()):(this.editor.list.startPlayer.dispatch(),this.editor.execute(new $6f108bd13133889a$export$66788100995c7b02(this.editor),"画梁"));break;case"free":if(""!=this.editor.currentDownSelect&&"moveMesh"==this.useType){if(this.editor.currentPoint.clone().distanceTo(this.editor.downPoint.clone())<10)return;let e=this.editor.currentDownSelect[0].object.useType;if("wall"==e)this.editor.execute(new $671a9ada1efb021a$export$ad57cb3fe2de1d52(this.editor),"移动墙");else if("rotateTool"==e||"scaleTool"==e)this.editor.execute(new $e25392babd100f13$export$203d609e8f23eda2(this.editor),"旋转工具");else if("dragPoint"==e)this.editor.execute(new $8b583e2b755b0fc3$export$12c0e9563e080ba5(this.editor),"拖拽点");else if("scaleRuleTool"==e)this.editor.execute(new $41d8560ca8780b9e$export$95a0b96ed37a9fe3(this.editor),"比例尺");else if("scaleHelpTool"==e)this.editor.execute(new $41d8560ca8780b9e$export$95a0b96ed37a9fe3(this.editor,"move"),"比例尺");else if("bseControl"==e)this.editor.execute(new $349f250ecfb48a4c$export$c072eb4abd42caf(this.editor),"贝塞尔移动");else if("movePoint"==this.editor.currentDownSelect[0].object.useType)this.editor.execute(new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor),"移动窗");else{let e=["beam","flue","pillars"],t=this.editor.currentDownSelect[0].object,i=e.indexOf(this.editor.currentDownSelect[0].object.parent.modelType)>=0||t.modelType&&t.modelType.indexOf("Model")>=0;if(this.editor.currentDownSelect[0].object.parent&&this.editor.currentDownSelect[0].object.parent.isLock)this.editor.doorHelperGroupClean();else if(i){let i=!1;i=e.indexOf(this.editor.currentDownSelect[0].object.parent.modelType)>=0?this.editor.currentDownSelect[0].object.parent.isLock:this.editor.getOuterParent(t).isLock,i||(e.indexOf(this.editor.currentDownSelect[0].object.parent.modelType)>=0?this.editor.execute(new $cc13264a46e73685$export$c9cf1b7a5c1d69dd(this.editor),"移动"):this.editor.execute(new $e25392babd100f13$export$203d609e8f23eda2(this.editor),"移动"))}else this.editor.execute(new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(this.editor),"移动窗")}}else new $a43a7063b14aae40$export$57f28e97ee2333c7(this.editor).main()}}}var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ"),$9QhXH=parcelRequire("9QhXH"),$hrM0U=parcelRequire("hrM0U");class $ca3cc62cb04c2488$export$9a58ef0d7ad3278c{constructor(){this.thickness=240,this.height=window.storeyHei,this.bufferMeter=10,this.flat=!1,this.doorWidth=800,this.balconyWidth=1300,this.cornerWindowWidth=500,this.sitRoomWidthMin=4e3+this.thickness,this.sitRoomWidthMax=6e3+this.thickness,this.sitRoomHeightMin=3600+this.thickness,this.sitRoomHeightMax=4200+this.thickness,this.history=[],this.reset()}reset(){this.jsonArr=[],this.shape=[],this.doorArr=[],this.holeArr=[]}getHome(e=0,t=0,i=1){let r=0;0==e&&(t=(e=this.getRandom(1,3))>2?this.getRandom(1,2):1,i=e>2?this.getRandom(1,2):1,2==e&&(r=this.getRandom(0,1)),3==e&&(r=1)),this.room=e,this.hall=t,this.toilet=i,console.log(e+" 室 "+t+" 厅 1 厨 "+i+" 卫 "+r+" 过道"),this.createSittingRoom(),t>1&&this.createDiningRoom(),this.createKitchen(t),this.createToilet(t),this.flat=!0,e>1&&this.createSecondBedroom(),this.createMasterBedroom(e),e>2&&this.createStudy(),this.createBalcony("A");let n=this.handleSegment();n=this.getHoleData(n);let o=[this.masterC,this.sitRoomCenter,this.kitchenCenter,this.toiletC];return e>1&&o.push(this.secondBC),t>1&&o.push(this.diningRoomCenter),[n,this.doorArr,this.holeArr,o]}getHoleData(e){let t=1e3;console.log("获取门窗开洞数据");for(let i=0;i<e.length;i++){e[i].id=t++;let r=new $4xklQ.Vector2(e[i].start.x,e[i].start.y),n=new $4xklQ.Vector2(e[i].end.x,e[i].end.y),o=r.distanceTo(n),a=r.clone().add(n).divideScalar(2);if(Math.abs(a.x)<=this.sitRoomW/2&&Math.abs(a.y)<=this.sitRoomH/2)-1!=[0,1,4,5].indexOf(this.masterP)?(0==this.masterP&&a.y==this.masterC.y-this.masterH/2&&a.x-this.masterC.x==o/2+this.masterW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("entry door",t-1)),5==this.masterP&&a.y==this.masterC.y+this.masterH/2&&a.x-this.masterC.x==o/2+this.masterW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("entry door",t-1)),1==this.masterP&&a.y==this.masterC.y-this.masterH/2&&this.masterC.x-a.x==o/2+this.masterW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("entry door",t-1)),4==this.masterP&&a.y==this.masterC.y+this.masterH/2&&a.x-this.masterC.x==o/2+this.masterW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("entry door",t-1))):(2==this.masterP&&a.x==this.masterC.x-this.masterW/2&&this.masterC.y-a.y==o/2+this.masterH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("entry door",t-1)),7==this.masterP&&a.x==this.masterC.x+this.masterW/2&&this.masterC.y-a.y==o/2+this.masterH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("entry door",t-1)),3==this.masterP&&a.x==this.masterC.x-this.masterW/2&&a.y-this.masterC.y==o/2+this.masterH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("entry door",t-1)),6==this.masterP&&a.x==this.masterC.x+this.masterW/2&&a.y-this.masterC.y==o/2+this.masterH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("entry door",t-1))),-1!=[0,1,4,5].indexOf(this.balconyAP)?a.x==this.balconyAC.x&&Math.abs(a.y-this.balconyAC.y)==this.balconyAH/2&&(this.fillHoleData("slidingDoor",e[i],this.balconyAW-800,2e3),this.setDWId("slidingDoor",t-1)):a.y==this.balconyAC.y&&Math.abs(a.x-this.balconyAC.x)==this.balconyAW/2&&(this.fillHoleData("slidingDoor",e[i],this.balconyAH-800,2e3),this.setDWId("slidingDoor",t-1)),-1!=[0,1,4,5].indexOf(this.kitchenP)?(a.x==this.kitchenCenter.x&&(0!=this.kitchenP&&1!=this.kitchenP||this.kitchenCenter.y-a.y==this.kitchenH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("kitchen door",t-1)),4!=this.kitchenP&&5!=this.kitchenP||a.y-this.kitchenCenter.y==this.kitchenH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("kitchen door",t-1))),Math.abs(a.x-this.toiletC.x)<this.toiletW/2&&Math.abs(a.y-this.toiletC.y)==this.toiletH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("toilet door",t-1))):(a.y==this.kitchenCenter.y&&(2!=this.kitchenP&&3!=this.kitchenP||this.kitchenCenter.x-a.x==this.kitchenW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("kitchen door",t-1)),6!=this.kitchenP&&7!=this.kitchenP||a.x-this.kitchenCenter.x==this.kitchenW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("kitchen door",t-1))),Math.abs(a.y-this.toiletC.y)<this.toiletH/2&&Math.abs(a.x-this.toiletC.x)==this.toiletW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("toilet door",t-1))),(this.secondBP||0==this.secondBP)&&(-1!=[0,1,4,5].indexOf(this.secondBP)?(a.x==this.secondBC.x&&Math.abs(a.y-this.secondBC.y)==this.secondBH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("secondBD door",t-1)),3==this.room&&Math.abs(a.x-this.secondBC.x)>this.secondBW/2&&Math.abs(a.y-this.secondBC.y)==this.secondBH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("study door",t-1))):(a.y==this.secondBC.y&&Math.abs(a.x-this.secondBC.x)==this.secondBW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("secondBD door",t-1)),3==this.room&&Math.abs(a.y-this.secondBC.y)>this.secondBH/2&&Math.abs(a.x-this.secondBC.x)==this.secondBW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("study door",t-1)))),-1!=[0,1,4,5].indexOf(this.masterP)?a.x==this.masterC.x&&Math.abs(a.y-this.masterC.y)==this.masterH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("masterBD door",t-1)):a.y==this.masterC.y&&Math.abs(a.x-this.masterC.x)==this.masterW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("masterBD door",t-1));else{this.diningRoomP&&(0!=this.kitchenP&&1!=this.kitchenP||a.x==this.toiletC.x&&this.toiletC.y-a.y==this.toiletH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("toilet door",t-1)),2!=this.kitchenP&&3!=this.kitchenP||a.y==this.toiletC.y&&this.toiletC.x-a.x==this.toiletW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("toilet door",t-1)),4!=this.kitchenP&&5!=this.kitchenP||a.x==this.toiletC.x&&a.y-this.toiletC.y==this.toiletH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("toilet door",t-1)),6!=this.kitchenP&&7!=this.kitchenP||a.y==this.toiletC.y&&a.x-this.toiletC.x==this.toiletW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("toilet door",t-1))),500==Math.abs(Math.abs(a.y-this.masterC.y)-this.masterH/2)&&(this.fillHoleData("baseWindow",e[i],o-240,2100),-1!=[1,2,5,6].indexOf(this.masterP)?this.setDWId("CW1",t-1):this.setDWId("CW2",t-1)),500==Math.abs(Math.abs(a.x-this.masterC.x)-this.masterW/2)&&(this.fillHoleData("baseWindow",e[i],o-240,2100),-1!=[3,4,7,0].indexOf(this.masterP)?this.setDWId("CW1",t-1):this.setDWId("CW2",t-1)),-1!=[0,1,4,5].indexOf(this.secondBP)?(0!=this.secondBP&&1!=this.secondBP||a.y-this.secondBC.y==this.secondBH/2&&(a.x==this.secondBC.x?(this.fillHoleData("baseWindow",e[i],o-600,2100),this.setDWId("secondBD window",t-1)):3==this.room&&this.fillHoleData("panoramicWindow",e[i],o-230,2100,new $4xklQ.Vector2(a.x,a.y+250))),4!=this.secondBP&&5!=this.secondBP||this.secondBC.y-a.y==this.secondBH/2&&(a.x==this.secondBC.x?(this.fillHoleData("baseWindow",e[i],o-600,2100),this.setDWId("secondBD window",t-1)):3==this.room&&this.fillHoleData("panoramicWindow",e[i],o-230,2100,new $4xklQ.Vector2(a.x,a.y-250)))):(2!=this.secondBP&&3!=this.secondBP||a.x-this.secondBC.x==this.secondBW/2&&(a.y==this.secondBC.y?(this.fillHoleData("baseWindow",e[i],o-600,2100),this.setDWId("secondBD window",t-1)):3==this.room&&(this.fillHoleData("panoramicWindow",e[i],o-230,2100,new $4xklQ.Vector2(a.x+250,a.y)),this.setDWId("study pw",t-1))),6!=this.secondBP&&7!=this.secondBP||this.secondBC.x-a.x==this.secondBW/2&&(a.y==this.secondBC.y?(this.fillHoleData("baseWindow",e[i],o-600,2100),this.setDWId("secondBD window",t-1)):3==this.room&&(this.fillHoleData("panoramicWindow",e[i],o-230,2100,new $4xklQ.Vector2(a.x-250,a.y)),this.setDWId("study pw",t-1)))),-1!=[0,1,4,5].indexOf(this.kitchenP)?(a.x==this.kitchenCenter.x&&(0!=this.kitchenP&&1!=this.kitchenP||a.y-this.kitchenCenter.y==this.kitchenH/2&&(this.fillHoleData("baseWindow",e[i],o-600,2100),this.setDWId("kitchen window",t-1)),4!=this.kitchenP&&5!=this.kitchenP||this.kitchenCenter.y-a.y==this.kitchenH/2&&(this.fillHoleData("baseWindow",e[i],o-600,2100),this.setDWId("kitchen window",t-1))),a.x==this.toiletC.x&&(0!=this.kitchenP&&1!=this.kitchenP||a.y-this.toiletC.y==this.toiletH/2&&(this.fillHoleData("baseWindow",e[i],o-600,2100),this.setDWId("toilet window",t-1)),4!=this.kitchenP&&5!=this.kitchenP||this.toiletC.y-a.y==this.toiletH/2&&(this.fillHoleData("baseWindow",e[i],o-600,2100),this.setDWId("toilet window",t-1)))):(a.y==this.kitchenCenter.y&&(2!=this.kitchenP&&3!=this.kitchenP||a.x-this.kitchenCenter.x==this.kitchenW/2&&(this.fillHoleData("baseWindow",e[i],o-600,2100),this.setDWId("kitchen window",t-1)),6!=this.kitchenP&&7!=this.kitchenP||this.kitchenCenter.x-a.x==this.kitchenW/2&&(this.fillHoleData("baseWindow",e[i],o-600,2100),this.setDWId("kitchen window",t-1))),a.y==this.toiletC.y&&(2!=this.kitchenP&&3!=this.kitchenP||a.x-this.toiletC.x==this.toiletW/2&&(this.fillHoleData("baseWindow",e[i],o-600,2100),this.setDWId("toilet window",t-1)),6!=this.kitchenP&&7!=this.kitchenP||this.toiletC.x-a.x==this.toiletW/2&&(this.fillHoleData("baseWindow",e[i],o-600,2100),this.setDWId("toilet window",t-1))));let r=o>1200?1200:o;-1!=[0,1,4,5].indexOf(this.balconyAP)?(0!=this.balconyAP&&1!=this.balconyAP||(a.y>=this.balconyAC.y&&a.y-this.balconyAC.y<this.balconyAH/2&&Math.abs(this.balconyAC.x-a.x)==this.balconyAW/2&&(r<1200?this.fillHoleData("uwl",e[i],r,2100):this.fillHoleData("uwl",e[i],r,2100,new $4xklQ.Vector2(a.x,a.y+o/2-480))),a.x==this.balconyAC.x&&a.y-this.balconyAC.y==this.balconyAH/2&&(this.fillHoleData("uWindow",e[i],o+240,2100,new $4xklQ.Vector2(a.x,a.y-480)),this.setDWId("uw",t-1))),4!=this.balconyAP&&5!=this.balconyAP||(a.y<=this.balconyAC.y&&this.balconyAC.y-a.y<this.balconyAH/2&&Math.abs(this.balconyAC.x-a.x)==this.balconyAW/2&&(r<1200?this.fillHoleData("uwl",e[i],r,2100):this.fillHoleData("uwl",e[i],r,2100,new $4xklQ.Vector2(a.x,a.y-o/2+480))),a.x==this.balconyAC.x&&this.balconyAC.y-a.y==this.balconyAH/2&&(this.fillHoleData("uWindow",e[i],o+240,2100,new $4xklQ.Vector2(a.x,a.y+480)),this.setDWId("uw",t-1)))):(2!=this.balconyAP&&3!=this.balconyAP||(a.x>=this.balconyAC.x&&a.x-this.balconyAC.x<this.balconyAW/2&&Math.abs(a.y-this.balconyAC.y)==this.balconyAH/2&&(r<1200?this.fillHoleData("uwl",e[i],r,2100):this.fillHoleData("uwl",e[i],r,2100,new $4xklQ.Vector2(a.x+o/2-480,a.y))),a.y==this.balconyAC.y&&a.x-this.balconyAC.x==this.balconyAW/2&&(this.fillHoleData("uWindow",e[i],o+240,2100,new $4xklQ.Vector2(a.x-480,a.y)),this.setDWId("uw",t-1))),6!=this.balconyAP&&7!=this.balconyAP||(a.x<=this.balconyAC.x&&this.balconyAC.x-a.x<this.balconyAW/2&&Math.abs(a.y-this.balconyAC.y)==this.balconyAH/2&&(r<1200?this.fillHoleData("uwl",e[i],r,2100):this.fillHoleData("uwl",e[i],r,2100,new $4xklQ.Vector2(a.x-o/2+480,a.y))),a.y==this.balconyAC.y&&this.balconyAC.x-a.x==this.balconyAW/2&&(this.fillHoleData("uWindow",e[i],o+240,2100,new $4xklQ.Vector2(a.x+480,a.y)),this.setDWId("uw",t-1))))}}return e}fillHoleData(e,t,i,r,n=!1){let o,a=t.thickness,s=t.id;n=n||new $4xklQ.Vector2(t.start.x+t.end.x,t.start.y+t.end.y).divideScalar(2),e.includes("Door")?(o={location:{x:n.x,y:n.y,z:r/2},width:i,height:r,withSector:!1,offsetXY:0,wallID:s,windowThick:a},"sectorDoor"==e&&(o.height=r-i/2),"sectorDoor"==e&&(o.path="static/model/door/01/doorWithThresholdStone.glb"),"baseDoor"==e&&(o.path="static/model/door/baseDoor/baseDoor.glb"),"doubleOpenDoor"==e&&(o.path="static/model/door/doubleOpenDoor/doubleOpenDoor.glb"),"lashDoor"==e&&(o.path="static/model/door/lashDoor/lashDoor.glb"),"slidingDoor"==e&&(o.path="static/model/door/slidingDoor/slidingDoor.glb")):e.includes("Window")?(o={location:{x:n.x,y:n.y,z:r/2+500},width:i,height:r,withSector:!1,offsetXY:0,wallID:s,windowThick:a},"baseWindow"==e&&(o.path="static/model/window/baseWindow/baseWindow.glb"),"uWindow"==e&&(o.path="static/model/window/uWindow/uWindow.glb",o.windowThick+=960),"waveWindow"==e&&(o.path="static/model/window/waveWindow/waveWindow.glb",o.windowThick+=500),"panoramicWindow"==e&&(this.doorArr.forEach((e=>{"study pw"==e.name&&(e.wallId=s)})),o.path="static/model/window/panoramicWindow/panoramicWindow.glb",o.windowThick+=500)):o={location:{x:n.x,y:n.y,z:r/2+500},width:i,height:r,withSector:!1,offsetXY:0,wallID:s,windowThick:a},this.holeArr.push(o)}setDWId(e,t){for(let i=0;i<this.doorArr.length;i++)if(this.doorArr[i].name==e)return void(this.doorArr[i].wallId=t)}createPanoramicWindow(e,t,i){let r=new $4xklQ.Group,n=t-this.thickness,o=new $4xklQ.Vector2(-n/2,-this.thickness/2),a=new $4xklQ.Vector2(o.x,o.y+this.cornerWindowWidth),s=new $4xklQ.Vector2(a.x+n,a.y),l=new $4xklQ.Vector2(n/2,-this.thickness/2),c=this.createShapeByPointArr([a,s,l,o],13421772);r.add(c);let h=this.createLine([o,a,s,l,o]);r.add(h);let d=new $4xklQ.Vector2(-n/2,this.thickness/2),u=new $4xklQ.Vector2(d.x-this.thickness,d.y),p=new $4xklQ.Vector2(u.x,u.y+this.cornerWindowWidth),m=new $4xklQ.Vector2(p.x+t+this.thickness,p.y),f=new $4xklQ.Vector2(m.x,m.y-this.cornerWindowWidth),g=new $4xklQ.Vector2(f.x-this.thickness,f.y),x=new $4xklQ.Vector2(d.x-this.thickness/2,d.y),b=new $4xklQ.Vector2(x.x,x.y+this.cornerWindowWidth-this.thickness/2),y=new $4xklQ.Vector2(b.x+n+this.thickness,b.y),w=new $4xklQ.Vector2(y.x,y.y-this.cornerWindowWidth+this.thickness/2),v=this.createShapeByPointArr([u,p,m,f,g,s,a,d]);r.add(v);let $=this.createLine([d,u,p,m,f,g]);r.add($);let M=this.createLine([x,b,y,w]);return r.add(M),r.rotation.z=i,r.position.set(e.x,e.y,10),r}createFrenchWindow(e,t,i){let r=new $4xklQ.Group,n=new $4xklQ.Vector2(-t/2,-this.thickness/2),o=new $4xklQ.Vector2(-t/2,this.thickness/2),a=new $4xklQ.Vector2(t/2,this.thickness/2),s=new $4xklQ.Vector2(t/2,-this.thickness/2),l=this.createShapeByPointArr([o,a,s,n]),c=this.createLine([n,o,a,s,n]),h=new $4xklQ.Vector2(-t/2,-this.thickness/6),d=new $4xklQ.Vector2(t/2,-this.thickness/6),u=new $4xklQ.Vector2(-t/2,0),p=new $4xklQ.Vector2(t/2,0),m=new $4xklQ.Vector2(-t/2,this.thickness/6),f=new $4xklQ.Vector2(t/2,this.thickness/6),g=new $4xklQ.Vector2(0,this.thickness/6),x=new $4xklQ.Vector2(0,-this.thickness/6),b=this.createLine([h,d]),y=this.createLine([u,p]),w=this.createLine([m,f]),v=this.createLine([g,x]);return r.add(l,c,b,y,w,v),r.rotation.z=i,r.position.set(e.x,e.y,100),r}createLine(e,t=0){let i=(new $4xklQ.BufferGeometry).setFromPoints(e),r=new $4xklQ.Line(i,new $4xklQ.LineBasicMaterial({color:t}));return r.renderOrder=100,r}createShapeByPointArr(e,t=16777215){let i=new $4xklQ.Shape;i.moveTo(e[e.length-1].x,e[e.length-1].y),e.forEach((e=>{i.lineTo(e.x,e.y)}));let r=new $4xklQ.ShapeGeometry(i),n=new $4xklQ.Mesh(r,new $4xklQ.MeshBasicMaterial({color:t}));return n.renderOrder=90,n}createBalcony(e){let t,i,r,n,o,a;if("A"==e){let e=[this.masterP,this.secondBP,this.kitchenP],s=[];(e.includes(0)||e.includes(1))&&s.push(0,1),(e.includes(2)||e.includes(3))&&s.push(2,3),(e.includes(4)||e.includes(5))&&s.push(4,5),(e.includes(6)||e.includes(7))&&s.push(6,7),t=this.getPosition(s),console.log("Balcony position",t);let l,c,h=0;0==parseInt(t/2)&&(l=this.sitRoomCenter.clone().add(new $4xklQ.Vector2(0,this.sitRoomH/2))),1==parseInt(t/2)&&(l=this.sitRoomCenter.clone().add(new $4xklQ.Vector2(this.sitRoomW/2,0)),h=-Math.PI/2),2==parseInt(t/2)&&(l=this.sitRoomCenter.clone().add(new $4xklQ.Vector2(0,-this.sitRoomH/2))),3==parseInt(t/2)&&(l=this.sitRoomCenter.clone().add(new $4xklQ.Vector2(-this.sitRoomW/2,0)),h=Math.PI/2),c=-1!=[0,1,4,5].indexOf(t)?this.sitRoomW-1e3:this.sitRoomH-1e3;let d=$9QhXH.DM.createSlidingDoor(l,c,h);d.name="slidingDoor",this.doorArr.push(d),-1!=[0,1,4,5].indexOf(t)?(o=this.sitRoomW,a=this.balconyWidth,r=this.sitRoomCenter.x,0!=t&&1!=t||(n=this.sitRoomCenter.y+this.sitRoomH/2+this.balconyWidth/2),4!=t&&5!=t||(n=this.sitRoomCenter.y-this.sitRoomH/2-this.balconyWidth/2)):(o=this.balconyWidth,a=this.sitRoomH,n=this.sitRoomCenter.y,2!=t&&3!=t||(r=this.sitRoomCenter.x+this.sitRoomW/2+this.balconyWidth/2),6!=t&&7!=t||(r=this.sitRoomCenter.x-this.sitRoomW/2-this.balconyWidth/2)),i=new $4xklQ.Vector2(r,n);let u,p,m,f=0;0==parseInt(t/2)&&(u=new $4xklQ.Vector2(i.x,i.y+a/2),p=o-240,m=a/2),1==parseInt(t/2)&&(u=new $4xklQ.Vector2(i.x+o/2,i.y),p=a-240,m=o/2,f=-Math.PI/2),2==parseInt(t/2)&&(u=new $4xklQ.Vector2(i.x,i.y-a/2),p=o-240,m=a/2,f=Math.PI),3==parseInt(t/2)&&(u=new $4xklQ.Vector2(i.x-o/2,i.y),p=a-240,m=o/2,f=Math.PI/2),this.balconyAC=i,this.balconyAP=t,this.balconyAW=o,this.balconyAH=a}let s=new $4xklQ.Vector2(i.x-o/2,i.y-a/2),l=new $4xklQ.Vector2(i.x+o/2,i.y+a/2),c=this.createShape(s,l);this.shape.push(c)}createBaseDoor(e,t,i){let r,n,o,a,s,l,c,h,d=this.doorWidth,u=this.thickness,p=new $4xklQ.Group,m=(new $4xklQ.Vector2).add(new $4xklQ.Vector2(-d/2,0)).add(new $4xklQ.Vector2(0,-u/2)),f=(new $4xklQ.Vector2).add(new $4xklQ.Vector2(d/2,0)).add(new $4xklQ.Vector2(0,u/2)),g=new $4xklQ.Shape;g.moveTo(m.x,m.y),g.lineTo(m.x,f.y),g.lineTo(f.x,f.y),g.lineTo(f.x,m.y),g.lineTo(m.x,m.y);let x=new $4xklQ.ShapeGeometry(g),b=new $4xklQ.Mesh(x,new $4xklQ.MeshBasicMaterial({color:16711680,side:$4xklQ.DoubleSide}));b.name="DOOR AS",b.renderOrder=1,t?(r=new $4xklQ.Vector2(f.x,m.y),n=r.clone().add(new $4xklQ.Vector2(0,u/2+d)),o=n.clone().add(new $4xklQ.Vector2(-u/2,0)),a=o.clone().add(new $4xklQ.Vector2(0,-d)),s=a.clone().add(new $4xklQ.Vector2(u/2,0)),l=r.clone().add(new $4xklQ.Vector2(-u/2,u)),c=-Math.PI,h=Math.PI/2):(r=m,n=r.clone().add(new $4xklQ.Vector2(0,u/2+d)),o=n.clone().add(new $4xklQ.Vector2(u/2,0)),a=o.clone().add(new $4xklQ.Vector2(0,-d)),s=a.clone().add(new $4xklQ.Vector2(-u/2,0)),l=r.clone().add(new $4xklQ.Vector2(u/2,u)),c=0,h=Math.PI/2);let y=(new $4xklQ.BufferGeometry).setFromPoints([r,n,o,a,s]),w=new $4xklQ.Line(y,new $4xklQ.LineBasicMaterial({color:0}));w.name="DOOR AL",w.renderOrder=10;let v=(new $4xklQ.Path).arc(l.x,l.y,d-u/2,c,h,t).getPoints(),$=(new $4xklQ.BufferGeometry).setFromPoints(v),M=new $4xklQ.Line($,new $4xklQ.LineBasicMaterial({color:0}));M.name="DOOR BL",M.renderOrder=10;let S=new $4xklQ.Shape;S.moveTo(n.x,n.y),[o,a,s,n].forEach((e=>{S.lineTo(e.x,e.y)}));let P=new $4xklQ.ShapeGeometry(S),k=new $4xklQ.Mesh(P,new $4xklQ.MeshBasicMaterial({color:65280,side:$4xklQ.DoubleSide}));k.name="DOOR BS",k.renderOrder=5,p.add(b,w,M,k);let _=0;return 0!=i&&1!=i||(_=Math.PI),2!=i&&3!=i||(_=Math.PI/2),6!=i&&7!=i||(_=-Math.PI/2),p.rotation.z=_,p.position.set(e.x,e.y),p}createBaseWindow(e,t,i){let r=new $4xklQ.Group,n=(new $4xklQ.Vector2).add(new $4xklQ.Vector2(-t/2,this.thickness/2)),o=(new $4xklQ.Vector2).add(new $4xklQ.Vector2(-t/2,0)),a=(new $4xklQ.Vector2).add(new $4xklQ.Vector2(-t/2,-this.thickness/2)),s=(new $4xklQ.Vector2).add(new $4xklQ.Vector2(t/2,this.thickness/2)),l=(new $4xklQ.Vector2).add(new $4xklQ.Vector2(t/2,0)),c=(new $4xklQ.Vector2).add(new $4xklQ.Vector2(t/2,-this.thickness/2)),h=new $4xklQ.Shape;h.moveTo(n.x,n.y),[a,c,s,n].forEach((e=>{h.lineTo(e.x,e.y)}));let d=new $4xklQ.ShapeGeometry(h),u=new $4xklQ.Mesh(d,new $4xklQ.MeshBasicMaterial({color:16777215,side:$4xklQ.DoubleSide}));u.name="WINDOW AS",u.renderOrder=10,r.add(u);let p=(new $4xklQ.BufferGeometry).setFromPoints([o,a,c,s,n,o,l]),m=new $4xklQ.Line(p,new $4xklQ.LineBasicMaterial({color:0}));return m.name="WINDOW AL",m.renderOrder=10,r.add(m),r.rotation.z=i,r.position.set(e.x,e.y,10),r}createSlidingDoor(e,t,i,r="Double"){let n=new $4xklQ.Group,o=(new $4xklQ.Vector2).add(new $4xklQ.Vector2(-t/2,this.thickness/2)),a=(new $4xklQ.Vector2).add(new $4xklQ.Vector2(-t/2,-this.thickness/2)),s=(new $4xklQ.Vector2).add(new $4xklQ.Vector2(t/2,-this.thickness/2)),l=(new $4xklQ.Vector2).add(new $4xklQ.Vector2(t/2,this.thickness/2)),c=new $4xklQ.Shape;c.moveTo(o.x,o.y),[a,s,l,o].forEach((e=>{c.lineTo(e.x,e.y)}));let h=new $4xklQ.ShapeGeometry(c),d=new $4xklQ.Mesh(h,new $4xklQ.MeshBasicMaterial({color:16777215,side:$4xklQ.DoubleSide}));d.name="Sliding Door Base Shape",d.renderOrder=10,n.add(d);let u=(new $4xklQ.BufferGeometry).setFromPoints([o,a,s,l,o]),p=new $4xklQ.Line(u,new $4xklQ.LineBasicMaterial({color:0}));if(p.name="Sliding Door Border",p.renderOrder=10,n.add(p),"Single"==r){new $4xklQ.Vector2(-t/16,this.thickness/4),new $4xklQ.Vector2(-t/16,0)}if("Double"==r){let e=new $4xklQ.Vector2(-t/2+t/4/4*3+100,0),i=new $4xklQ.Vector2(-t/2+100,0),r=i.clone().add(new $4xklQ.Vector2(0,-this.thickness/4)),o=r.clone().add(new $4xklQ.Vector2(t/4,0)),a=o.clone().add(new $4xklQ.Vector2(0,this.thickness/4)),s=a.clone().add(new $4xklQ.Vector2(t/16*3,0)),l=s.clone().add(new $4xklQ.Vector2(0,this.thickness/4)),c=l.clone().add(new $4xklQ.Vector2(-t/4,0)),h=(new $4xklQ.BufferGeometry).setFromPoints([e,i,r,o,a,s,l,c,e,a]),d=new $4xklQ.Line(h,new $4xklQ.LineBasicMaterial({color:0}));d.name="Left Sliding Door",d.renderOrder=10,n.add(d);let u=new $4xklQ.Vector2(-e.x,e.y),p=new $4xklQ.Vector2(-i.x,i.y),m=new $4xklQ.Vector2(-r.x,r.y),f=new $4xklQ.Vector2(-o.x,o.y),g=new $4xklQ.Vector2(-a.x,a.y),x=new $4xklQ.Vector2(-s.x,s.y),b=new $4xklQ.Vector2(-l.x,l.y),y=new $4xklQ.Vector2(-c.x,c.y),w=(new $4xklQ.BufferGeometry).setFromPoints([u,p,m,f,g,x,b,y,u,g]),v=new $4xklQ.Line(w,new $4xklQ.LineBasicMaterial({color:0}));v.name="Right Sliding Door",v.renderOrder=10,n.add(v)}return n.rotation.z=i,n.position.set(e.x,e.y,10),n}generateWindow(){console.log("主",this.masterP,"次",this.secondBP,"厨",this.kitchenP);let e=[this.masterP,this.secondBP,this.kitchenP],t=[];(e.includes(0)||e.includes(1))&&t.push(0,1),(e.includes(2)||e.includes(3))&&t.push(2,3),(e.includes(4)||e.includes(5))&&t.push(4,5),(e.includes(6)||e.includes(7))&&t.push(6,7);let i,r,n=this.getPosition(t),o=0;0==parseInt(n/2)&&(i=this.sitRoomCenter.clone().add(new $4xklQ.Vector2(0,this.sitRoomH/2))),1==parseInt(n/2)&&(i=this.sitRoomCenter.clone().add(new $4xklQ.Vector2(this.sitRoomW/2,0)),o=-Math.PI/2),2==parseInt(n/2)&&(i=this.sitRoomCenter.clone().add(new $4xklQ.Vector2(0,-this.sitRoomH/2))),3==parseInt(n/2)&&(i=this.sitRoomCenter.clone().add(new $4xklQ.Vector2(-this.sitRoomW/2,0)),o=Math.PI/2),r=-1!=[0,1,4,5].indexOf(n)?this.sitRoomW-1e3:this.sitRoomH-1e3;let a=$9QhXH.DM.createSlidingDoor(i,r,o);this.doorArr.push(a)}getHome2(){let e,t,i,r,n=0;return r=this.getRandom(0,1),e=this.getRandom(1,3),t=e>1?this.getRandom(1,2):1,i=e>2?this.getRandom(1,2):1,2==e&&(n=this.getRandom(0,1)),3==e&&(n=1),r=1,console.log(e+" 室 "+t+" 厅 1 厨 "+i+" 卫 "+n+" 过道 1玄关"),this.createSittingRoom(),this.createDiningRoom2(),this.createKitchen2(),this.createPorch(),[this.shape,[]]}createDiningRoom2(){let e,t,i,r,n=this.getRandom(0,3);if(this.sitRoomW>this.sitRoomH&&(e=[2,3,6,7][n]),this.sitRoomW<this.sitRoomH&&(e=[0,1,4,5][n]),this.sitRoomW==this.sitRoomH&&(e=this.getRandom(0,7)),i=this.getRandom(1600,3e3),r=this.getRandom(1600,2500),1==this.getRandom(0,1)){let e=i;i=r,r=e}-1!=[0,1,4,5].indexOf(e)&&Math.abs(this.sitRoomW-i)<=1200&&(i=this.sitRoomW,this.gmt=!0),-1!=[2,3,6,7].indexOf(e)&&Math.abs(this.sitRoomH-r)<=1200&&(r=this.sitRoomH,this.gmt=!0),t=this.computeXY(this.sitRoomCenter,this.sitRoomW,this.sitRoomH,i,r,e),this.diningRoomCenter=t,this.diningRoomW=i,this.diningRoomH=r,this.diningRoomP=e;let o=new $4xklQ.Vector2(t.x-i/2,t.y-r/2),a=new $4xklQ.Vector2(t.x+i/2,t.y+r/2),s=this.createShape(o,a);this.shape.push(s)}createKitchen2(){let e,t,i,r,n;console.log("餐厅位置",this.diningRoomP),-1!=[0,1,4,5].indexOf(this.diningRoomP)?(n=this.diningRoomH,r=this.getRandom(2500,3500),i=this.diningRoomCenter.y,-1!=[0,5].indexOf(this.diningRoomP)&&(t=this.diningRoomCenter.x+this.diningRoomW/2+r/2),-1!=[1,4].indexOf(this.diningRoomP)&&(t=this.diningRoomCenter.x-this.diningRoomW/2-r/2)):(r=this.diningRoomW,n=this.getRandom(2500,3500),t=this.diningRoomCenter.x,-1!=[2,7].indexOf(this.diningRoomP)&&(i=this.diningRoomCenter.y-this.diningRoomH/2-n/2),-1!=[3,6].indexOf(this.diningRoomP)&&(i=this.diningRoomCenter.y+this.diningRoomH/2+n/2)),e=new $4xklQ.Vector2(t,i),this.kitchenCenter=e,this.kitchenW=r,this.kitchenH=n;let o=new $4xklQ.Vector2(e.x-r/2,e.y-n/2),a=new $4xklQ.Vector2(e.x+r/2,e.y+n/2),s=this.createShape(o,a);this.shape.push(s)}createToilet2(){let e,t,i,r,n;console.log("餐客一体",this.gmt),this.gmt?(console.log("A"),-1!=[0,1,4,5].indexOf(this.diningRoomP)&&(r=this.kitchenW,n=this.getRandom(1600,2e3),t=this.kitchenCenter.x,-1!=[0,1].indexOf(this.diningRoomP)&&(i=this.kitchenCenter.y-this.kitchenH/2-n/2),-1!=[4,5].indexOf(this.diningRoomP)&&(i=this.kitchenCenter.y+this.kitchenH/2+n/2)),-1!=[2,3,6,7].indexOf(this.diningRoomP)&&(n=this.kitchenH,r=this.getRandom(1600,2e3),i=this.kitchenCenter.y,-1!=[2,3].indexOf(this.diningRoomP)&&(t=this.kitchenCenter.x-this.kitchenW/2-r/2),-1!=[6,7].indexOf(this.diningRoomP)&&(t=this.kitchenCenter.x+this.kitchenW/2+r/2))):-1!=[0,1,4,5].indexOf(this.diningRoomP)?(n=this.diningRoomH,r=this.getRandom(1800,2500),i=this.diningRoomCenter.y,-1!=[0,5].indexOf(this.diningRoomP)&&(t=this.kitchenCenter.x+this.kitchenW/2+r/2),-1!=[1,4].indexOf(this.diningRoomP)&&(t=this.kitchenCenter.x-this.kitchenW/2-r/2)):(r=this.diningRoomW,n=this.getRandom(1800,2500),t=this.diningRoomCenter.x,-1!=[2,7].indexOf(this.diningRoomP)&&(i=this.kitchenCenter.y-this.kitchenH/2-n/2),-1!=[3,6].indexOf(this.diningRoomP)&&(i=this.kitchenCenter.y+this.kitchenH/2+n/2)),e=new $4xklQ.Vector2(t,i);let o=new $4xklQ.Vector2(e.x-r/2,e.y-n/2),a=new $4xklQ.Vector2(e.x+r/2,e.y+n/2),s=this.createShape(o,a);this.shape.push(s)}computeXY(e,t,i,r,n,o){let a,s;return 0!=o&&5!=o||(a=e.x-t/2+r/2),1!=o&&4!=o||(a=e.x+t/2-r/2),0!=o&&1!=o||(s=e.y+i/2+n/2),4!=o&&5!=o||(s=e.y-i/2-n/2),2!=o&&7!=o||(s=e.y+i/2-n/2),3!=o&&6!=o||(s=e.y-i/2+n/2),2!=o&&3!=o||(a=e.x+t/2+r/2),6!=o&&7!=o||(a=e.x-t/2-r/2),new $4xklQ.Vector2(a,s)}createPorch(){this.getRandom(1300,3300),this.getRandom(1300,1500);this.getRandom(0,1)}createSittingRoom(){let e=this.getRandom(this.sitRoomWidthMin,this.sitRoomWidthMax),t=this.getRandom(this.sitRoomHeightMin,this.sitRoomHeightMax);if(this.getRandom(0,1)){let i=e;e=t,t=i}this.sitRoomCenter=new $4xklQ.Vector2,this.sitRoomW=e,this.sitRoomH=t;let i=new $4xklQ.Vector2(e/2,t/2),r=new $4xklQ.Vector2(-e/2,-t/2);this.createShape(r,i)}createDiningRoom(){let e=this.getRandom(0,7),t=this.getRandom(1600,2500),i=this.getRandom(1600,2e3);if(-1==[0,1,4,5].indexOf(e)){let e=t;t=i,i=e}let r,n=this.getCenter(this.sitRoomCenter,this.sitRoomW,this.sitRoomH,t,i,e);0==e&&(r=n.clone().add(new $4xklQ.Vector2(-t/2,-i/2-200-this.doorWidth/2))),1==e&&(r=n.clone().add(new $4xklQ.Vector2(t/2,-i/2-200-this.doorWidth/2))),2==e&&(r=n.clone().add(new $4xklQ.Vector2(-t/2-200-this.doorWidth/2,i/2))),3==e&&(r=n.clone().add(new $4xklQ.Vector2(-t/2-200-this.doorWidth/2,-i/2))),4==e&&(r=n.clone().add(new $4xklQ.Vector2(t/2,i/2+200+this.doorWidth/2))),5==e&&(r=n.clone().add(new $4xklQ.Vector2(-t/2,i/2+200+this.doorWidth/2))),6==e&&(r=n.clone().add(new $4xklQ.Vector2(t/2+200+this.doorWidth/2,-i/2))),7==e&&(r=n.clone().add(new $4xklQ.Vector2(t/2+200+this.doorWidth/2,i/2))),this.diningRoomCenter=n,this.diningRoomW=t,this.diningRoomH=i,this.diningRoomP=e;let o=new $4xklQ.Vector2(n.x-t/2,n.y-i/2),a=new $4xklQ.Vector2(n.x+t/2,n.y+i/2),s=this.createShape(o,a);this.shape.push(s)}createKitchen(e){let t,i,r,n,o,a;e>1?(0==this.diningRoomP&&(t=1),1==this.diningRoomP&&(t=0),2==this.diningRoomP&&(t=3),3==this.diningRoomP&&(t=2),4==this.diningRoomP&&(t=5),5==this.diningRoomP&&(t=4),6==this.diningRoomP&&(t=7),7==this.diningRoomP&&(t=6)):t=this.getRandom(0,7),-1!=[0,1,4,5].indexOf(t)?(this.diningRoomW?(i=this.sitRoomW-this.diningRoomW,r=this.getRandom(2500,3500)):(i=this.getRandom(1600,2e3),r=this.getRandom(2500,3500)),n=this.getCenter(this.sitRoomCenter,this.sitRoomW,this.sitRoomH,i,r,t)):(this.diningRoomW?(r=this.sitRoomH-this.diningRoomH,i=this.getRandom(2500,3500)):(r=this.getRandom(1600,2e3),i=this.getRandom(2500,3500)),n=this.getCenter(this.sitRoomCenter,this.sitRoomW,this.sitRoomH,i,r,t)),-1!=[0,1,4,5].indexOf(t)?(o=n.x,0!=t&&1!=t||(a=n.y-r/2),4!=t&&5!=t||(a=n.y+r/2)):(a=n.y,2!=t&&3!=t||(o=n.x-i/2),6!=t&&7!=t||(o=n.x+i/2));let s=0;4!=t&&5!=t||(s=Math.PI),2!=t&&3!=t||(s=-Math.PI/2),6!=t&&7!=t||(s=Math.PI/2);let l=$9QhXH.DM.createBaseDoor(new $4xklQ.Vector2(o,a),800,"inside",s);l.name="kitchen door",this.doorArr.push(l);let c,h,d,u=0;-1!=[0,1,4,5].indexOf(t)?(c=o,d=i-600,0!=t&&1!=t||(h=a+r),4!=t&&5!=t||(h=a-r)):(h=a,d=r-600,u=Math.PI/2,2!=t&&3!=t||(c=o+i),6!=t&&7!=t||(c=o-i));let p=$9QhXH.DM.createBaseWindow(new $4xklQ.Vector2(c,h),d,u);p.name="kitchen window",this.doorArr.push(p),this.kitchenCenter=n,this.kitchenW=i,this.kitchenH=r,this.kitchenP=t;let m=new $4xklQ.Vector2(n.x-i/2,n.y-r/2),f=new $4xklQ.Vector2(n.x+i/2,n.y+r/2),g=this.createShape(m,f);this.shape.push(g)}createToilet(e){let t,i,r,n,o,a,s,l;e>1?-1!=[0,1,4,5].indexOf(this.diningRoomP)?(a=this.diningRoomCenter.x,t=this.diningRoomW,i=this.kitchenH-this.diningRoomH>=1800?this.kitchenH-this.diningRoomH:this.getRandom(1800,2500),0!=this.diningRoomP&&1!=this.diningRoomP||(o=this.diningRoomCenter.y+this.diningRoomH/2+i/2,l=4,s=this.diningRoomCenter.y+this.diningRoomH/2),4!=this.diningRoomP&&5!=this.diningRoomP||(o=this.diningRoomCenter.y-this.diningRoomH/2-i/2,l=0,s=this.diningRoomCenter.y-this.diningRoomH/2),n=this.diningRoomCenter.x):(s=this.diningRoomCenter.y,i=this.diningRoomH,t=this.kitchenW-this.diningRoomW>=1800?this.kitchenW-this.diningRoomW:this.getRandom(1800,2500),2!=this.diningRoomP&&3!=this.diningRoomP||(n=this.diningRoomCenter.x+this.diningRoomW/2+t/2,l=6,a=this.diningRoomCenter.x+this.diningRoomW/2),6!=this.diningRoomP&&7!=this.diningRoomP||(n=this.diningRoomCenter.x-this.diningRoomW/2-t/2,l=2,a=this.diningRoomCenter.x-this.diningRoomW/2),o=this.diningRoomCenter.y):-1!=[0,1,4,5].indexOf(this.kitchenP)?(t=this.sitRoomW-this.kitchenW>=1600?this.sitRoomW-this.kitchenW:this.getRandom(this.sitRoomW-this.kitchenW+this.thickness+this.bufferMeter,2e3),i=this.getRandom(1800,2500),0!=this.kitchenP&&5!=this.kitchenP||(n=this.kitchenCenter.x+this.kitchenW/2+t/2),1!=this.kitchenP&&4!=this.kitchenP||(n=this.kitchenCenter.x-this.kitchenW/2-t/2),a=n,0!=this.kitchenP&&1!=this.kitchenP||(o=this.kitchenCenter.y-this.kitchenH/2+i/2,l=4,s=o-i/2),4!=this.kitchenP&&5!=this.kitchenP||(o=this.kitchenCenter.y+this.kitchenH/2-i/2,l=0,s=o+i/2)):(i=this.sitRoomH-this.kitchenH>=1600?this.sitRoomH-this.kitchenH:this.getRandom(this.sitRoomH-this.kitchenH+this.thickness+this.bufferMeter,2e3),t=this.getRandom(1800,2500),2!=this.kitchenP&&7!=this.kitchenP||(o=this.kitchenCenter.y-this.kitchenH/2-i/2),3!=this.kitchenP&&6!=this.kitchenP||(o=this.kitchenCenter.y+this.kitchenH/2+i/2),s=o,2!=this.kitchenP&&3!=this.kitchenP||(n=this.kitchenCenter.x-this.kitchenW/2+t/2,l=6,a=n-t/2),6!=this.kitchenP&&7!=this.kitchenP||(n=this.kitchenCenter.x+this.kitchenW/2-t/2,l=2,a=n+t/2)),r=new $4xklQ.Vector2(n,o);let c=0;4!=this.kitchenP&&5!=this.kitchenP||(c=Math.PI),2!=this.kitchenP&&3!=this.kitchenP||(c=-Math.PI/2),6!=this.kitchenP&&7!=this.kitchenP||(c=Math.PI/2);let h=$9QhXH.DM.createBaseDoor(new $4xklQ.Vector2(a,s),800,"inside",c);h.name="toilet door",this.doorArr.push(h);let d,u,p,m=0;-1!=[0,1,4,5].indexOf(this.kitchenP)?(d=a,p=t-600,0!=this.kitchenP&&1!=this.kitchenP||(u=s+i),4!=this.kitchenP&&5!=this.kitchenP||(u=s-i)):(u=s,p=i-600,m=Math.PI/2,2!=this.kitchenP&&3!=this.kitchenP||(d=a+t),6!=this.kitchenP&&7!=this.kitchenP||(d=a-t));let f=$9QhXH.DM.createBaseWindow(new $4xklQ.Vector2(d,u),p,m);f.name="toilet window",this.doorArr.push(f),this.toiletC=r,this.toiletW=t,this.toiletH=i;let g=new $4xklQ.Vector2(r.x-t/2,r.y-i/2),x=new $4xklQ.Vector2(r.x+t/2,r.y+i/2),b=this.createShape(g,x);this.shape.push(b)}createSecondBedroom(){let e=[];0!=this.kitchenP&&1!=this.kitchenP||(e=[0,1]),2!=this.kitchenP&&3!=this.kitchenP||(e=[2,3]),4!=this.kitchenP&&5!=this.kitchenP||(e=[4,5]),6!=this.kitchenP&&7!=this.kitchenP||(e=[6,7]);let t=this.getPosition(e);this.secondBedroomP=t;let i,r,n,o,a,s=this.getRandom(2500,3200),l=this.getRandom(2500,3e3);-1!=[0,1,4,5].indexOf(t)?(i=this.getCenterXY(this.sitRoomCenter.x,this.sitRoomW/2,s/2,t),n=i,0!=t&&1!=t||(r=this.sitRoomCenter.y+this.sitRoomH/2+l/2,a=4,o=r-l/2),4!=t&&5!=t||(r=this.sitRoomCenter.y-this.sitRoomH/2-l/2,a=0,o=r+l/2)):(r=this.getCenterXY(this.sitRoomCenter.y,this.sitRoomH/2,l/2,t),o=r,2!=t&&3!=t||(i=this.sitRoomCenter.x+this.sitRoomW/2+s/2,a=6,n=i-s/2),6!=t&&7!=t||(i=this.sitRoomCenter.x-this.sitRoomW/2-s/2,a=2,n=i+s/2));let c=new $4xklQ.Vector2(i,r),h=0;4!=t&&5!=t||(h=Math.PI),2!=t&&3!=t||(h=-Math.PI/2),6!=t&&7!=t||(h=Math.PI/2);let d=$9QhXH.DM.createBaseDoor(new $4xklQ.Vector2(n,o),800,"inside",h);d.name="secondBD door",this.doorArr.push(d);let u,p,m,f=0;-1!=[0,1,4,5].indexOf(t)?(u=n,m=s-600,0!=t&&1!=t||(p=o+l),4!=t&&5!=t||(p=o-l)):(p=o,m=l-600,f=Math.PI/2,2!=t&&3!=t||(u=n+s),6!=t&&7!=t||(u=n-s));let g=$9QhXH.DM.createBaseWindow(new $4xklQ.Vector2(u,p),m,f);g.name="secondBD window",this.doorArr.push(g),this.secondBP=t,this.secondBC=c,this.secondBW=s,this.secondBH=l;let x=new $4xklQ.Vector2(c.x-s/2,c.y-l/2),b=new $4xklQ.Vector2(c.x+s/2,c.y+l/2),y=this.createShape(x,b);this.shape.push(y)}getCenterXY(e,t,i,r=0){let n;if(this.flat)n=-1!=[0,3,5,6].indexOf(r)?e-t+i:e+t-i;else{let r=e-t+this.thickness+this.bufferMeter-i,n=e+t-this.thickness-this.bufferMeter+i,o=e-t-this.thickness-this.bufferMeter+i,a=e-t+this.thickness+this.bufferMeter+i,s=e+t-this.thickness-this.bufferMeter-i,l=e+t+this.thickness+this.bufferMeter-i,c=e-t+i,h=e+t-i,d=this.getRandom(r,n);if(d>o&&d<a)return d==c?d:this.getCenterXY(e,t,i);if(d>s&&d<l)return d==h?d:this.getCenterXY(e,t,i)}return n}createMasterBedroom(e){let t=[];0!=this.kitchenP&&1!=this.kitchenP||(t=[0,1]),2!=this.kitchenP&&3!=this.kitchenP||(t=[2,3]),4!=this.kitchenP&&5!=this.kitchenP||(t=[4,5]),6!=this.kitchenP&&7!=this.kitchenP||(t=[6,7]),e>1&&(0!=this.secondBedroomP&&1!=this.secondBedroomP||t.push(0,1),2!=this.secondBedroomP&&3!=this.secondBedroomP||t.push(2,3),4!=this.secondBedroomP&&5!=this.secondBedroomP||t.push(4,5),6!=this.secondBedroomP&&7!=this.secondBedroomP||t.push(6,7));let i,r,n=this.getPosition(t),o=this.getRandom(4e3,4500),a=this.getRandom(2800,3500),s=0;if(console.log(this.sitRoomW-o,this.sitRoomW-a),-1!=[0,1,4,5].indexOf(n))if(this.sitRoomW-o<1e3){let e=o;o=a,a=e,this.sitRoomW-o>=1e3?s=(this.sitRoomW-o)/2:(o=this.sitRoomW-1e3,s=500)}else s=(this.sitRoomW-o)/2;else if(this.sitRoomH-a<1e3){let e=o;o=a,a=e,this.sitRoomH-a>=1e3?s=(this.sitRoomH-a)/2:(a=this.sitRoomH-1e3,s=500)}else s=(this.sitRoomH-a)/2;e>1?(0!=this.secondBedroomP&&1!=this.secondBedroomP||(-1!=[2,3,6,7].indexOf(n)&&(r=this.getCenterXY(this.sitRoomCenter.y,this.sitRoomH/2,a/2,n),-1!=[2,3].indexOf(n)&&(i=this.sitRoomCenter.x+this.sitRoomW/2+o/2),-1!=[6,7].indexOf(n)&&(i=this.sitRoomCenter.x-this.sitRoomW/2-o/2)),4!=n&&5!=n||(r=this.sitRoomCenter.y-this.sitRoomH/2-a/2,i=this.getCenterXY(this.sitRoomCenter.x,this.sitRoomW/2,o/2,n))),2!=this.secondBedroomP&&3!=this.secondBedroomP||(-1!=[0,1,4,5].indexOf(n)&&(i=this.getCenterXY(this.sitRoomCenter.x,this.sitRoomW/2,o/2,n),-1!=[0,1].indexOf(n)&&(r=this.sitRoomCenter.y+this.sitRoomH/2+a/2),-1!=[4,5].indexOf(n)&&(r=this.sitRoomCenter.y-this.sitRoomH/2-a/2)),6!=n&&7!=n||(i=this.sitRoomCenter.x-this.sitRoomW/2-o/2,r=this.getCenterXY(this.sitRoomCenter.y,this.sitRoomH/2,a/2,n))),4!=this.secondBedroomP&&5!=this.secondBedroomP||(-1!=[2,3,6,7].indexOf(n)&&(r=this.getCenterXY(this.sitRoomCenter.y,this.sitRoomH/2,a/2,n),-1!=[2,3].indexOf(n)&&(i=this.sitRoomCenter.x+this.sitRoomW/2+o/2),-1!=[6,7].indexOf(n)&&(i=this.sitRoomCenter.x-this.sitRoomW/2-o/2)),0!=n&&1!=n||(r=this.sitRoomCenter.y+this.sitRoomH/2+a/2,i=this.getCenterXY(this.sitRoomCenter.x,this.sitRoomW/2,o/2,n))),6!=this.secondBedroomP&&7!=this.secondBedroomP||(-1!=[0,1,4,5].indexOf(n)&&(i=this.getCenterXY(this.sitRoomCenter.x,this.sitRoomW/2,o/2,n),-1!=[0,1].indexOf(n)&&(r=this.sitRoomCenter.y+this.sitRoomH/2+a/2),-1!=[4,5].indexOf(n)&&(r=this.sitRoomCenter.y-this.sitRoomH/2-a/2)),2!=n&&3!=n||(i=this.sitRoomCenter.x+this.sitRoomW/2+o/2,r=this.getCenterXY(this.sitRoomCenter.y,this.sitRoomH/2,a/2,n)))):(-1!=[0,1,4,5].indexOf(n)&&(i=this.getCenterXY(this.sitRoomCenter.x,this.sitRoomW/2,o/2,n),-1!=[0,1].indexOf(n)&&(r=this.sitRoomCenter.y+this.sitRoomH/2+a/2),-1!=[4,5].indexOf(n)&&(r=this.sitRoomCenter.y-this.sitRoomH/2-a/2)),-1!=[2,3,6,7].indexOf(n)&&(r=this.getCenterXY(this.sitRoomCenter.y,this.sitRoomH/2,a/2,n),-1!=[2,3].indexOf(n)&&(i=this.sitRoomCenter.x+this.sitRoomW/2+o/2),-1!=[6,7].indexOf(n)&&(i=this.sitRoomCenter.x-this.sitRoomW/2-o/2)));let l,c,h,d=new $4xklQ.Vector2(i,r);-1!=[0,1,4,5].indexOf(n)?(l=d.x,0!=n&&1!=n||(c=d.y-a/2,h=4),4!=n&&5!=n||(c=d.y+a/2,h=0)):(c=d.y,2!=n&&3!=n||(l=d.x-o/2,h=6),6!=n&&7!=n||(l=d.x+o/2,h=2));let u=0;4!=n&&5!=n||(u=Math.PI),2!=n&&3!=n||(u=-Math.PI/2),6!=n&&7!=n||(u=Math.PI/2);let p=$9QhXH.DM.createBaseDoor(new $4xklQ.Vector2(l,c),800,"inside",u);p.name="masterBD door",this.doorArr.push(p);let m=0,f=0;0!=n&&5!=n||(m=d.x+o/2+s),1!=n&&4!=n||(m=d.x-o/2-s),0!=n&&1!=n||(f=d.y-a/2),4!=n&&5!=n||(f=d.y+a/2),2!=n&&3!=n||(m=d.x-o/2),6!=n&&7!=n||(m=d.x+o/2),2!=n&&7!=n||(f=d.y-a/2-s),3!=n&&6!=n||(f=d.y+a/2+s);let g=0;0!=n&&1!=n||(g=Math.PI),2!=n&&3!=n||(g=Math.PI/2),6!=n&&7!=n||(g=-Math.PI/2);let x=$9QhXH.DM.createLashDoor(new $4xklQ.Vector2(m,f),800,g);x.name="entry door",this.doorArr.push(x),this.masterP=n,this.masterC=d,this.masterW=o,this.masterH=a;let b=new $4xklQ.Vector2(d.x-o/2,d.y-a/2),y=new $4xklQ.Vector2(d.x+o/2,d.y+a/2),w=this.createShape(b,y,"CW");this.shape.push(w)}createStudy(){let e,t,i,r,n,o,a,s;if(0==this.secondBP&&(e=1),1==this.secondBP&&(e=0),2==this.secondBP&&(e=3),3==this.secondBP&&(e=2),4==this.secondBP&&(e=5),5==this.secondBP&&(e=4),6==this.secondBP&&(e=7),7==this.secondBP&&(e=6),-1!=[0,1,4,5].indexOf(e)){t=this.getRandom(2500,3200),i=this.secondBH,n=this.secondBC.y;let r=this.sitRoomW-this.secondBW;0!=e&&1!=e||(a=this.secondBC.y-this.secondBH/2,s=4),4!=e&&5!=e||(a=this.secondBC.y+this.secondBH/2,s=0),0!=e&&5!=e||(o=this.secondBC.x-this.secondBW/2-r/2),1!=e&&4!=e||(o=this.secondBC.x+this.secondBW/2+r/2)}else{t=this.secondBW,i=this.getRandom(2500,3e3),r=this.secondBC.x;let n=this.sitRoomH-this.secondBH;2!=e&&3!=e||(o=this.secondBC.x-this.secondBW/2,s=6),6!=e&&7!=e||(o=this.secondBC.x+this.secondBW/2,s=2),2!=e&&7!=e||(a=this.secondBC.y+this.secondBH/2+n/2),3!=e&&6!=e||(a=this.secondBC.y-this.secondBH/2-n/2)}0!=this.secondBP&&5!=this.secondBP||(r=this.secondBC.x+this.secondBW/2+t/2),1!=this.secondBP&&4!=this.secondBP||(r=this.secondBC.x-this.secondBW/2-t/2),2!=this.secondBP&&7!=this.secondBP||(n=this.secondBC.y-this.secondBH/2-i/2),3!=this.secondBP&&6!=this.secondBP||(n=this.secondBC.y+this.secondBH/2+i/2);let l=new $4xklQ.Vector2(r,n),c=0;4!=this.secondBP&&5!=this.secondBP||(c=Math.PI),2!=this.secondBP&&3!=this.secondBP||(c=-Math.PI/2),6!=this.secondBP&&7!=this.secondBP||(c=Math.PI/2);let h=$9QhXH.DM.createBaseDoor(new $4xklQ.Vector2(o,a),800,"inside",c);h.name="study door",this.doorArr.push(h);let d,u,p,m,f=0;-1!=[0,1,4,5].indexOf(e)?(p=l.x,0!=e&&1!=e||(m=l.y+i/2),4!=e&&5!=e||(m=l.y-i/2,f=Math.PI),u=t):(m=l.y,2!=e&&3!=e||(p=l.x+t/2,f=-Math.PI/2),6!=e&&7!=e||(p=l.x-t/2,f=Math.PI/2),u=i),d=new $4xklQ.Vector2(p,m);let g=$9QhXH.DM.createPanoramicWindow(d,u,f);g.name="study pw",this.doorArr.push(g);let x=new $4xklQ.Vector2(l.x-t/2,l.y-i/2),b=new $4xklQ.Vector2(l.x+t/2,l.y+i/2),y=this.createShape(x,b);this.shape.push(y)}getCenter(e,t,i,r,n,o){let a,s;switch(o){case 0:a=e.x-t/2+r/2,s=e.y+i/2+n/2;break;case 1:a=e.x+t/2-r/2,s=e.y+i/2+n/2;break;case 2:a=e.x+t/2+r/2,s=e.y+i/2-n/2;break;case 3:a=e.x+t/2+r/2,s=e.y-i/2+n/2;break;case 4:a=e.x+t/2-r/2,s=e.y-i/2-n/2;break;case 5:a=e.x-t/2+r/2,s=e.y-i/2-n/2;break;case 6:a=e.x-t/2-r/2,s=e.y-i/2+n/2;break;case 7:a=e.x-t/2-r/2,s=e.y+i/2-n/2}return new $4xklQ.Vector2(a,s)}createShape(e,t,i=""){let r,n=new $4xklQ.Shape;if(""==i){n.moveTo(e.x,t.y),n.lineTo(t.x,t.y),n.lineTo(t.x,e.y),n.lineTo(e.x,e.y),n.lineTo(e.x,t.y);let i=new $4xklQ.ShapeGeometry(n);r=new $4xklQ.Mesh(i,new $4xklQ.MeshBasicMaterial({color:16777215*Math.random(),side:$4xklQ.DoubleSide})),this.jsonArr.push(this.createJsonBy2Point(new $4xklQ.Vector2(e.x,t.y),new $4xklQ.Vector2(t.x,t.y))),this.jsonArr.push(this.createJsonBy2Point(new $4xklQ.Vector2(t.x,t.y),new $4xklQ.Vector2(t.x,e.y))),this.jsonArr.push(this.createJsonBy2Point(new $4xklQ.Vector2(t.x,e.y),new $4xklQ.Vector2(e.x,e.y))),this.jsonArr.push(this.createJsonBy2Point(new $4xklQ.Vector2(e.x,e.y),new $4xklQ.Vector2(e.x,t.y)))}return"CW"==i&&(r=this.addCornerWindow(e,t,n)),r}addCornerWindow(e,t,i){let r,n,o,a,s,l,c,h,d=2500,u=1400;if(this.masterH>this.masterW){let e=d;d=u,u=e}0!=this.masterP&&7!=this.masterP||(r=e.clone(),n=new $4xklQ.Vector2(e.x,t.y-u+this.cornerWindowWidth),o=new $4xklQ.Vector2(e.x-this.cornerWindowWidth,n.y),a=new $4xklQ.Vector2(o.x,o.y+u),s=new $4xklQ.Vector2(a.x+d,a.y),l=new $4xklQ.Vector2(s.x,s.y-this.cornerWindowWidth),c=t.clone(),h=new $4xklQ.Vector2(t.x,e.y)),1!=this.masterP&&2!=this.masterP||(h=e.clone(),r=new $4xklQ.Vector2(e.x,t.y),n=new $4xklQ.Vector2(t.x-d+this.cornerWindowWidth,t.y),o=new $4xklQ.Vector2(n.x,n.y+this.cornerWindowWidth),a=new $4xklQ.Vector2(o.x+d,o.y),s=new $4xklQ.Vector2(a.x,a.y-u),l=new $4xklQ.Vector2(s.x-this.cornerWindowWidth,s.y),c=new $4xklQ.Vector2(t.x,e.y)),3!=this.masterP&&4!=this.masterP||(c=e.clone(),h=new $4xklQ.Vector2(e.x,t.y),r=t.clone(),n=new $4xklQ.Vector2(t.x,e.y+u-this.cornerWindowWidth),o=new $4xklQ.Vector2(n.x+this.cornerWindowWidth,n.y),a=new $4xklQ.Vector2(o.x,o.y-u),s=new $4xklQ.Vector2(a.x-d,a.y),l=new $4xklQ.Vector2(s.x,s.y+this.cornerWindowWidth)),5!=this.masterP&&6!=this.masterP||(c=new $4xklQ.Vector2(e.x,t.y),h=t.clone(),r=new $4xklQ.Vector2(t.x,e.y),n=new $4xklQ.Vector2(e.x+d-this.cornerWindowWidth,e.y),o=new $4xklQ.Vector2(n.x,n.y-this.cornerWindowWidth),a=new $4xklQ.Vector2(o.x-d,o.y),s=new $4xklQ.Vector2(a.x,a.y+u),l=new $4xklQ.Vector2(s.x+this.cornerWindowWidth,s.y)),i.moveTo(r.x,r.y);let p=[n,o,a,s,l,c,h,r];p.forEach((e=>{i.lineTo(e.x,e.y)}));for(let e=0;e<p.length;e++)e==p.length-1?this.jsonArr.push(this.createJsonBy2Point(p[e],p[0])):this.jsonArr.push(this.createJsonBy2Point(p[e],p[e+1]));let m,f,g=0,x=0,b=o.clone().add(a).divideScalar(2),y=a.clone().add(s).divideScalar(2);[0,7,3,4].includes(this.masterP)?(m=u-this.thickness,g=Math.PI/2,f=d-this.thickness):(m=d-this.thickness,f=u-this.thickness,x=Math.PI/2);let w=$9QhXH.DM.createBaseWindow(b,m,g),v=$9QhXH.DM.createBaseWindow(y,f,x);return w.name="CW1",v.name="CW2",this.doorArr.push(w,v),i}handleSegment(){let e=[];for(;this.jsonArr.length>0;){let t=this.jsonArr.shift();if(0==e.length)e.push(t);else{let i=e.length,r=[],n=!0;for(let o=0;o<i;o++){let i=this.handleIntersect(t,e.shift());i.length>1&&(n=!1),r.push(...i)}n&&r.push(t),e=this.mergeArr(r)}}return e=this.handleInclude(e),this.doorArr.forEach((t=>{for(let i=0;i<e.length;i++){let r=e[i],n=new $4xklQ.Vector3(r.start.x,r.start.y,0),o=new $4xklQ.Vector3(r.end.x,r.end.y,0),a=n.clone().add(o).divideScalar(2);if(t.position.x==a.x&&t.position.y==a.y){t.wallStartPoint=n,t.wallEndPoint=o;break}}})),console.log("finalArr",e),e}handleInclude(e){let t=[];for(let i=0;i<e.length;i++){let r=[],n=[],o=new $4xklQ.Vector2(e[i].start.x,e[i].start.y),a=new $4xklQ.Vector2(e[i].end.x,e[i].end.y);for(let t=0;t<e.length;t++)if(i!=t){let i=new $4xklQ.Vector2(e[t].start.x,e[t].start.y),s=new $4xklQ.Vector2(e[t].end.x,e[t].end.y);i.distanceTo(s)<o.distanceTo(a)&&((i.equals(o)||s.equals(o))&&r.push(e[t]),(i.equals(a)||s.equals(a))&&n.push(e[t]))}for(let o=0;o<r.length;o++){let a=new $4xklQ.Vector2(r[o].start.x,r[o].start.y),s=new $4xklQ.Vector2(r[o].end.x,r[o].end.y);for(let r=0;r<n.length;r++){let o=new $4xklQ.Vector2(n[r].start.x,n[r].start.y),l=new $4xklQ.Vector2(n[r].end.x,n[r].end.y);(a.equals(o)||a.equals(l)||s.equals(o)||s.equals(l))&&t.push(e[i])}}}return t.forEach((t=>{e.splice(e.indexOf(t),1)})),e}handleIntersect(e,t){let i=e.equation,r=t.equation,n=new $4xklQ.Vector2(e.start.x,e.start.y),o=new $4xklQ.Vector2(e.end.x,e.end.y),a=new $4xklQ.Vector2(t.start.x,t.start.y),s=new $4xklQ.Vector2(t.end.x,t.end.y);if("Y"==i[0]){if("Y"==r[0]){if(i[1]!=r[1])return[t];{let i=Math.min(a.x,s.x),r=Math.max(a.x,s.x),l=a.x==i?a:s,c=a.x==r?a:s;if(n.x<i){if(o.x<i)return[t];if(o.x==i)return[t];if(o.x>i&&o.x<r){return[this.createJsonBy2Point(n,l),this.createJsonBy2Point(l,o),this.createJsonBy2Point(o,c)]}if(o.x==r){return[this.createJsonBy2Point(n,l),t]}if(o.x>r){return[this.createJsonBy2Point(n,l),t,this.createJsonBy2Point(c,o)]}}if(n.x==i){if(o.x<i)return[t];if(o.x>i&&o.x<r){return[e,this.createJsonBy2Point(o,c)]}if(o.x==r)return[t];if(o.x>r){return[t,this.createJsonBy2Point(c,o)]}}if(n.x>i&&n.x<r){if(o.x<i){return[this.createJsonBy2Point(o,l),this.createJsonBy2Point(l,n),this.createJsonBy2Point(n,c)]}if(o.x==i){return[e,this.createJsonBy2Point(n,c)]}if(o.x>i&&o.x<n.x){return[this.createJsonBy2Point(l,o),e,this.createJsonBy2Point(n,c)]}if(o.x>n.x&&o.x<r){return[this.createJsonBy2Point(l,n),e,this.createJsonBy2Point(o,c)]}if(o.x==r){return[this.createJsonBy2Point(l,n),e]}if(o.x>r){return[this.createJsonBy2Point(l,n),this.createJsonBy2Point(n,c),this.createJsonBy2Point(c,o)]}}if(n.x==r){if(o.x<i){return[this.createJsonBy2Point(o,l),t]}if(o.x==i)return[t];if(o.x>i&&o.x<r){return[this.createJsonBy2Point(l,o),e]}if(o.x>r)return[t]}if(n.x>r){if(o.x<i){return[this.createJsonBy2Point(o,l),t,this.createJsonBy2Point(c,n)]}if(o.x==i){return[t,this.createJsonBy2Point(c,n)]}if(o.x>i&&o.x<r){return[this.createJsonBy2Point(l,o),this.createJsonBy2Point(o,c),this.createJsonBy2Point(c,n)]}if(o.x==r)return[t];if(o.x>r)return[t]}}}if("X"==r[0]){let e=Math.min(n.x,o.x),l=Math.max(n.x,o.x),c=n.x==e?n:o,h=n.x==l?n:o,d=Math.min(a.y,s.y),u=Math.max(a.y,s.y),p=a.y==d?a:s,m=a.y==u?a:s,f=i[1]>d&&i[1]<u,g=r[1]>e&&r[1]<l;if(f&&g){let e=new $4xklQ.Vector2(r[1],i[1]);return[this.createJsonBy2Point(c,e),this.createJsonBy2Point(e,h),this.createJsonBy2Point(p,e),this.createJsonBy2Point(e,m)]}return[t]}}else if("X"==i[0]){if("X"==r[0]){if(i[1]!=r[1])return[t];{let i=Math.min(a.y,s.y),r=Math.max(a.y,s.y),l=a.y==i?a:s,c=a.y==r?a:s;if(n.y<i){if(o.y<i)return[t];if(o.y==i)return[t];if(o.y>i&&o.y<r){return[this.createJsonBy2Point(n,l),this.createJsonBy2Point(l,o),this.createJsonBy2Point(o,c)]}if(o.y==r){return[this.createJsonBy2Point(n,l),t]}if(o.y>r){return[this.createJsonBy2Point(n,l),t,this.createJsonBy2Point(c,o)]}}if(n.y==i){if(o.y<i)return[t];if(o.y>i&&o.y<r){return[e,this.createJsonBy2Point(o,c)]}if(o.y==r)return[t];if(o.y>r){return[t,this.createJsonBy2Point(c,o)]}}if(n.y>i&&n.y<r){if(o.y<i){return[this.createJsonBy2Point(o,l),this.createJsonBy2Point(l,n),this.createJsonBy2Point(n,c)]}if(o.y==i){return[e,this.createJsonBy2Point(n,c)]}if(o.y>i&&o.y<n.y){return[this.createJsonBy2Point(l,o),e,this.createJsonBy2Point(n,c)]}if(o.y>n.y&&o.y<r){return[this.createJsonBy2Point(l,n),e,this.createJsonBy2Point(o,c)]}if(o.y==r){return[this.createJsonBy2Point(l,n),e]}if(o.y>r){return[this.createJsonBy2Point(l,n),this.createJsonBy2Point(n,c),this.createJsonBy2Point(c,o)]}}if(n.y==r){if(o.y<i){return[this.createJsonBy2Point(o,l),t]}if(o.y==i)return[t];if(o.y>i&&o.y<r){return[this.createJsonBy2Point(l,o),e]}if(o.y>r)return[t]}if(n.y>r){if(o.y<i){return[this.createJsonBy2Point(o,l),t,this.createJsonBy2Point(c,n)]}if(o.y==i){return[t,this.createJsonBy2Point(c,n)]}if(o.y>i&&o.y<r){return[this.createJsonBy2Point(l,o),this.createJsonBy2Point(o,c),this.createJsonBy2Point(c,n)]}if(o.y==r)return[t];if(o.y>r)return[t]}}}if("Y"==r[0]){let e=Math.min(a.x,s.x),l=Math.max(a.x,s.x),c=a.x==e?a:s,h=a.x==l?a:s,d=Math.min(n.y,o.y),u=Math.max(n.y,o.y),p=n.y==d?n:o,m=n.y==u?n:o,f=i[1]>e&&i[1]<l,g=r[1]>d&&r[1]<u;if(f&&g){let e=new $4xklQ.Vector2(i[1],r[1]);return[this.createJsonBy2Point(c,e),this.createJsonBy2Point(e,h),this.createJsonBy2Point(p,e),this.createJsonBy2Point(e,m)]}return[t]}}return[]}mergeArr(e){let t=[];return e.forEach((e=>{t.length>0&&this.isInclude(t,e)||t.push(e)})),t}isInclude(e,t){let i=new $4xklQ.Vector2(t.start.x,t.start.y),r=new $4xklQ.Vector2(t.end.x,t.end.y);for(let t=0;t<e.length;t++){let n=new $4xklQ.Vector2(e[t].start.x,e[t].start.y),o=new $4xklQ.Vector2(e[t].end.x,e[t].end.y),a=n.equals(i)&&o.equals(r),s=n.equals(r)&&o.equals(i);if(a||s)return!0}return!1}handleCollinear(){}createJsonBy2Point(e,t){let i=this.getLineData(e,t);return{start:{x:e.x,y:e.y,z:0},end:{x:t.x,y:t.y,z:0},style:2,line:0,isArc:!1,thickness:this.thickness,height:this.height,direction:"",offsetXY:100,equation:i}}getLineData(e,t){if(e.x==t.x)var i="X",r=e.x;else if(e.y==t.y)i="Y",r=e.y;else{i=(e.y-t.y)/(e.x-t.x);i=Math.round(1e4*i)/1e4;r=e.y-i*e.x}return[i,r=Math.round(1e3*r)/1e3]}getRandom(e,t){return Math.floor(Math.random()*(t-e+1))+e}getPosition(e=[]){let t=this.getRandom(0,7);return-1!=e.indexOf(t)&&(t=this.getPosition(e)),t}filterArray(e){const t=[];return e.forEach((e=>{let i=!0;t.forEach((r=>{r?e[0]===r[0]&&e[1]===r[1]&&(i=!1):t.push(e)})),i&&t.push(e)})),t}}class $ca3cc62cb04c2488$export$41de2da91b5a0c25{constructor(){this.thickness=240,this.height=window.storeyHei,this.bufferMeter=10,this.flat=!1,this.doorWidth=800,this.balconyWidth=1300,this.cornerWindowWidth=500,this.sitRoomWidthMin=4e3+this.thickness,this.sitRoomWidthMax=6e3+this.thickness,this.sitRoomHeightMin=3600+this.thickness,this.sitRoomHeightMax=4200+this.thickness,this.history=[],this.reset()}reset(){this.jsonArr=[],this.shape=[],this.doorArr=[],this.holeArr=[]}getHome(e=0,t=0,i=1){let r=0;0==e&&(t=(e=this.getRandom(1,3))>2?this.getRandom(1,2):1,i=e>2?this.getRandom(1,2):1,2==e&&(r=this.getRandom(0,1)),3==e&&(r=1)),this.room=e,this.hall=t,this.toilet=i,console.log(e+" 室 "+t+" 厅 1 厨 "+i+" 卫 "+r+" 过道"),this.createSittingRoom(),t>1&&this.createDiningRoom(),this.createKitchen(t),this.createToilet(t),this.flat=!0,e>1&&this.createSecondBedroom(),this.createMasterBedroom(e),e>2&&this.createStudy(),this.createBalcony("A");let n=this.handleSegment();n=this.getHoleData(n);let o=[this.masterC,this.sitRoomCenter,this.kitchenCenter,this.toiletC];return e>1&&o.push(this.secondBC),t>1&&o.push(this.diningRoomCenter),console.log(this.holeArr),this.holeArr.forEach((e=>{console.log(e.path)})),[n,this.doorArr,this.holeArr,o]}getHoleData(e){let t=1e3;console.log("获取门窗开洞数据");for(let i=0;i<e.length;i++){e[i].id=t++;let r=new $4xklQ.Vector2(e[i].start.x,e[i].start.y),n=new $4xklQ.Vector2(e[i].end.x,e[i].end.y),o=r.distanceTo(n),a=r.clone().add(n).divideScalar(2);if(Math.abs(a.x)<=this.sitRoomW/2&&Math.abs(a.y)<=this.sitRoomH/2)-1!=[0,1,4,5].indexOf(this.masterP)?(0==this.masterP&&a.y==this.masterC.y-this.masterH/2&&a.x-this.masterC.x==o/2+this.masterW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("entry door",t-1)),5==this.masterP&&a.y==this.masterC.y+this.masterH/2&&a.x-this.masterC.x==o/2+this.masterW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("entry door",t-1)),1==this.masterP&&a.y==this.masterC.y-this.masterH/2&&this.masterC.x-a.x==o/2+this.masterW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("entry door",t-1)),4==this.masterP&&a.y==this.masterC.y+this.masterH/2&&a.x-this.masterC.x==o/2+this.masterW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("entry door",t-1))):(2==this.masterP&&a.x==this.masterC.x-this.masterW/2&&this.masterC.y-a.y==o/2+this.masterH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("entry door",t-1)),7==this.masterP&&a.x==this.masterC.x+this.masterW/2&&this.masterC.y-a.y==o/2+this.masterH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("entry door",t-1)),3==this.masterP&&a.x==this.masterC.x-this.masterW/2&&a.y-this.masterC.y==o/2+this.masterH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("entry door",t-1)),6==this.masterP&&a.x==this.masterC.x+this.masterW/2&&a.y-this.masterC.y==o/2+this.masterH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("entry door",t-1))),-1!=[0,1,4,5].indexOf(this.balconyAP)?a.x==this.balconyAC.x&&Math.abs(a.y-this.balconyAC.y)==this.balconyAH/2&&(this.fillHoleData("slidingDoor",e[i],this.balconyAW-800,2e3),this.setDWId("slidingDoor",t-1)):a.y==this.balconyAC.y&&Math.abs(a.x-this.balconyAC.x)==this.balconyAW/2&&(this.fillHoleData("slidingDoor",e[i],this.balconyAH-800,2e3),this.setDWId("slidingDoor",t-1)),-1!=[0,1,4,5].indexOf(this.kitchenP)?(a.x==this.kitchenCenter.x&&(0!=this.kitchenP&&1!=this.kitchenP||this.kitchenCenter.y-a.y==this.kitchenH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("kitchen door",t-1)),4!=this.kitchenP&&5!=this.kitchenP||a.y-this.kitchenCenter.y==this.kitchenH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("kitchen door",t-1))),Math.abs(a.x-this.toiletC.x)<this.toiletW/2&&Math.abs(a.y-this.toiletC.y)==this.toiletH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("toilet door",t-1))):(a.y==this.kitchenCenter.y&&(2!=this.kitchenP&&3!=this.kitchenP||this.kitchenCenter.x-a.x==this.kitchenW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("kitchen door",t-1)),6!=this.kitchenP&&7!=this.kitchenP||a.x-this.kitchenCenter.x==this.kitchenW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("kitchen door",t-1))),Math.abs(a.y-this.toiletC.y)<this.toiletH/2&&Math.abs(a.x-this.toiletC.x)==this.toiletW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("toilet door",t-1))),(this.secondBP||0==this.secondBP)&&(-1!=[0,1,4,5].indexOf(this.secondBP)?(a.x==this.secondBC.x&&Math.abs(a.y-this.secondBC.y)==this.secondBH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("secondBD door",t-1)),3==this.room&&Math.abs(a.x-this.secondBC.x)>this.secondBW/2&&Math.abs(a.y-this.secondBC.y)==this.secondBH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("study door",t-1))):(a.y==this.secondBC.y&&Math.abs(a.x-this.secondBC.x)==this.secondBW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("secondBD door",t-1)),3==this.room&&Math.abs(a.y-this.secondBC.y)>this.secondBH/2&&Math.abs(a.x-this.secondBC.x)==this.secondBW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("study door",t-1)))),-1!=[0,1,4,5].indexOf(this.masterP)?a.x==this.masterC.x&&Math.abs(a.y-this.masterC.y)==this.masterH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("masterBD door",t-1)):a.y==this.masterC.y&&Math.abs(a.x-this.masterC.x)==this.masterW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("masterBD door",t-1));else{this.diningRoomP&&(0!=this.kitchenP&&1!=this.kitchenP||a.x==this.toiletC.x&&this.toiletC.y-a.y==this.toiletH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("toilet door",t-1)),2!=this.kitchenP&&3!=this.kitchenP||a.y==this.toiletC.y&&this.toiletC.x-a.x==this.toiletW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("toilet door",t-1)),4!=this.kitchenP&&5!=this.kitchenP||a.x==this.toiletC.x&&a.y-this.toiletC.y==this.toiletH/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("toilet door",t-1)),6!=this.kitchenP&&7!=this.kitchenP||a.y==this.toiletC.y&&a.x-this.toiletC.x==this.toiletW/2&&(this.fillHoleData("baseDoor",e[i],800,2e3),this.setDWId("toilet door",t-1))),500==Math.abs(Math.abs(a.y-this.masterC.y)-this.masterH/2)&&(this.fillHoleData("baseWindow",e[i],o-240,2100),-1!=[1,2,5,6].indexOf(this.masterP)?this.setDWId("CW1",t-1):this.setDWId("CW2",t-1)),500==Math.abs(Math.abs(a.x-this.masterC.x)-this.masterW/2)&&(this.fillHoleData("baseWindow",e[i],o-240,2100),-1!=[3,4,7,0].indexOf(this.masterP)?this.setDWId("CW1",t-1):this.setDWId("CW2",t-1)),-1!=[0,1,4,5].indexOf(this.secondBP)?(0!=this.secondBP&&1!=this.secondBP||a.y-this.secondBC.y==this.secondBH/2&&(a.x==this.secondBC.x?(this.fillHoleData("baseWindow",e[i],o-600,2100),this.setDWId("secondBD window",t-1)):3==this.room&&this.fillHoleData("panoramicWindow",e[i],o-230,2100,new $4xklQ.Vector2(a.x,a.y+250))),4!=this.secondBP&&5!=this.secondBP||this.secondBC.y-a.y==this.secondBH/2&&(a.x==this.secondBC.x?(this.fillHoleData("baseWindow",e[i],o-600,2100),this.setDWId("secondBD window",t-1)):3==this.room&&this.fillHoleData("panoramicWindow",e[i],o-230,2100,new $4xklQ.Vector2(a.x,a.y-250)))):(2!=this.secondBP&&3!=this.secondBP||a.x-this.secondBC.x==this.secondBW/2&&(a.y==this.secondBC.y?(this.fillHoleData("baseWindow",e[i],o-600,2100),this.setDWId("secondBD window",t-1)):3==this.room&&(this.fillHoleData("panoramicWindow",e[i],o-230,2100,new $4xklQ.Vector2(a.x+250,a.y)),this.setDWId("study pw",t-1))),6!=this.secondBP&&7!=this.secondBP||this.secondBC.x-a.x==this.secondBW/2&&(a.y==this.secondBC.y?(this.fillHoleData("baseWindow",e[i],o-600,2100),this.setDWId("secondBD window",t-1)):3==this.room&&(this.fillHoleData("panoramicWindow",e[i],o-230,2100,new $4xklQ.Vector2(a.x-250,a.y)),this.setDWId("study pw",t-1)))),-1!=[0,1,4,5].indexOf(this.kitchenP)?(a.x==this.kitchenCenter.x&&(0!=this.kitchenP&&1!=this.kitchenP||a.y-this.kitchenCenter.y==this.kitchenH/2&&(this.fillHoleData("baseWindow",e[i],o-600,2100),this.setDWId("kitchen window",t-1)),4!=this.kitchenP&&5!=this.kitchenP||this.kitchenCenter.y-a.y==this.kitchenH/2&&(this.fillHoleData("baseWindow",e[i],o-600,2100),this.setDWId("kitchen window",t-1))),a.x==this.toiletC.x&&(0!=this.kitchenP&&1!=this.kitchenP||a.y-this.toiletC.y==this.toiletH/2&&(this.fillHoleData("baseWindow",e[i],o-600,2100),this.setDWId("toilet window",t-1)),4!=this.kitchenP&&5!=this.kitchenP||this.toiletC.y-a.y==this.toiletH/2&&(this.fillHoleData("baseWindow",e[i],o-600,2100),this.setDWId("toilet window",t-1)))):(a.y==this.kitchenCenter.y&&(2!=this.kitchenP&&3!=this.kitchenP||a.x-this.kitchenCenter.x==this.kitchenW/2&&(this.fillHoleData("baseWindow",e[i],o-600,2100),this.setDWId("kitchen window",t-1)),6!=this.kitchenP&&7!=this.kitchenP||this.kitchenCenter.x-a.x==this.kitchenW/2&&(this.fillHoleData("baseWindow",e[i],o-600,2100),this.setDWId("kitchen window",t-1))),a.y==this.toiletC.y&&(2!=this.kitchenP&&3!=this.kitchenP||a.x-this.toiletC.x==this.toiletW/2&&(this.fillHoleData("baseWindow",e[i],o-600,2100),this.setDWId("toilet window",t-1)),6!=this.kitchenP&&7!=this.kitchenP||this.toiletC.x-a.x==this.toiletW/2&&(this.fillHoleData("baseWindow",e[i],o-600,2100),this.setDWId("toilet window",t-1))));let r=o>1200?1200:o;-1!=[0,1,4,5].indexOf(this.balconyAP)?(0!=this.balconyAP&&1!=this.balconyAP||(a.y>=this.balconyAC.y&&a.y-this.balconyAC.y<this.balconyAH/2&&Math.abs(this.balconyAC.x-a.x)==this.balconyAW/2&&(r<1200?this.fillHoleData("uwl",e[i],r,2100):this.fillHoleData("uwl",e[i],r,2100,new $4xklQ.Vector2(a.x,a.y+o/2-480))),a.x==this.balconyAC.x&&a.y-this.balconyAC.y==this.balconyAH/2&&this.setDWId("uw",t-1)),4!=this.balconyAP&&5!=this.balconyAP||(a.y<=this.balconyAC.y&&this.balconyAC.y-a.y<this.balconyAH/2&&Math.abs(this.balconyAC.x-a.x)==this.balconyAW/2&&(r<1200?this.fillHoleData("uwl",e[i],r,2100):this.fillHoleData("uwl",e[i],r,2100,new $4xklQ.Vector2(a.x,a.y-o/2+480))),a.x==this.balconyAC.x&&this.balconyAC.y-a.y==this.balconyAH/2&&this.setDWId("uw",t-1))):(2!=this.balconyAP&&3!=this.balconyAP||(a.x>=this.balconyAC.x&&a.x-this.balconyAC.x<this.balconyAW/2&&Math.abs(a.y-this.balconyAC.y)==this.balconyAH/2&&(r<1200?this.fillHoleData("uwl",e[i],r,2100):this.fillHoleData("uwl",e[i],r,2100,new $4xklQ.Vector2(a.x+o/2-480,a.y))),a.y==this.balconyAC.y&&a.x-this.balconyAC.x==this.balconyAW/2&&this.setDWId("uw",t-1)),6!=this.balconyAP&&7!=this.balconyAP||(a.x<=this.balconyAC.x&&this.balconyAC.x-a.x<this.balconyAW/2&&Math.abs(a.y-this.balconyAC.y)==this.balconyAH/2&&(r<1200?this.fillHoleData("uwl",e[i],r,2100):this.fillHoleData("uwl",e[i],r,2100,new $4xklQ.Vector2(a.x-o/2+480,a.y))),a.y==this.balconyAC.y&&this.balconyAC.x-a.x==this.balconyAW/2&&this.setDWId("uw",t-1)))}}return e}fillHoleData(e,t,i,r,n=!1){console.log(e);let o,a=t.thickness,s=t.id;n=n||new $4xklQ.Vector2(t.start.x+t.end.x,t.start.y+t.end.y).divideScalar(2),e.includes("Door")?(o={location:{x:n.x,y:n.y,z:r/2},width:i,height:r,withSector:!1,offsetXY:0,wallID:s,windowThick:a},"sectorDoor"==e&&(o.height=r-i/2),"sectorDoor"==e&&(o.path="static/model/door/01/doorWithThresholdStone.glb"),"baseDoor"==e&&(o.path="static/model/door/baseDoor/baseDoor.glb"),"doubleOpenDoor"==e&&(o.path="static/model/door/doubleOpenDoor/doubleOpenDoor.glb"),"lashDoor"==e&&(o.path="static/model/door/lashDoor/lashDoor.glb"),"slidingDoor"==e&&(o.path="static/model/door/slidingDoor/slidingDoor.glb")):e.includes("Window")?(o={location:{x:n.x,y:n.y,z:r/2+500},width:i,height:r,withSector:!1,offsetXY:0,wallID:s,windowThick:a},"baseWindow"==e&&(o.path="static/model/window/baseWindow/baseWindow.glb"),"uWindow"==e&&(o.path="static/model/window/uWindow/uWindow.glb",o.windowThick+=960),"waveWindow"==e&&(o.path="static/model/window/waveWindow/waveWindow.glb",o.windowThick+=500),"panoramicWindow"==e&&(this.doorArr.forEach((e=>{"study pw"==e.name&&(e.wallId=s)})),o.path="static/model/window/panoramicWindow/panoramicWindow.glb",o.windowThick+=500)):o={location:{x:n.x,y:n.y,z:r/2+500},width:i,height:r,withSector:!1,offsetXY:0,wallID:s,windowThick:a},this.holeArr.push(o)}setDWId(e,t){for(let i=0;i<this.doorArr.length;i++)if(this.doorArr[i].name==e)return void(this.doorArr[i].wallId=t)}createPanoramicWindow(e,t,i){let r=new $4xklQ.Group,n=t-this.thickness,o=new $4xklQ.Vector2(-n/2,-this.thickness/2),a=new $4xklQ.Vector2(o.x,o.y+this.cornerWindowWidth),s=new $4xklQ.Vector2(a.x+n,a.y),l=new $4xklQ.Vector2(n/2,-this.thickness/2),c=this.createShapeByPointArr([a,s,l,o],13421772);r.add(c);let h=this.createLine([o,a,s,l,o]);r.add(h);let d=new $4xklQ.Vector2(-n/2,this.thickness/2),u=new $4xklQ.Vector2(d.x-this.thickness,d.y),p=new $4xklQ.Vector2(u.x,u.y+this.cornerWindowWidth),m=new $4xklQ.Vector2(p.x+t+this.thickness,p.y),f=new $4xklQ.Vector2(m.x,m.y-this.cornerWindowWidth),g=new $4xklQ.Vector2(f.x-this.thickness,f.y),x=new $4xklQ.Vector2(d.x-this.thickness/2,d.y),b=new $4xklQ.Vector2(x.x,x.y+this.cornerWindowWidth-this.thickness/2),y=new $4xklQ.Vector2(b.x+n+this.thickness,b.y),w=new $4xklQ.Vector2(y.x,y.y-this.cornerWindowWidth+this.thickness/2),v=this.createShapeByPointArr([u,p,m,f,g,s,a,d]);r.add(v);let $=this.createLine([d,u,p,m,f,g]);r.add($);let M=this.createLine([x,b,y,w]);return r.add(M),r.rotation.z=i,r.position.set(e.x,e.y,10),r}createFrenchWindow(e,t,i){let r=new $4xklQ.Group,n=new $4xklQ.Vector2(-t/2,-this.thickness/2),o=new $4xklQ.Vector2(-t/2,this.thickness/2),a=new $4xklQ.Vector2(t/2,this.thickness/2),s=new $4xklQ.Vector2(t/2,-this.thickness/2),l=this.createShapeByPointArr([o,a,s,n]),c=this.createLine([n,o,a,s,n]),h=new $4xklQ.Vector2(-t/2,-this.thickness/6),d=new $4xklQ.Vector2(t/2,-this.thickness/6),u=new $4xklQ.Vector2(-t/2,0),p=new $4xklQ.Vector2(t/2,0),m=new $4xklQ.Vector2(-t/2,this.thickness/6),f=new $4xklQ.Vector2(t/2,this.thickness/6),g=new $4xklQ.Vector2(0,this.thickness/6),x=new $4xklQ.Vector2(0,-this.thickness/6),b=this.createLine([h,d]),y=this.createLine([u,p]),w=this.createLine([m,f]),v=this.createLine([g,x]);return r.add(l,c,b,y,w,v),r.rotation.z=i,r.position.set(e.x,e.y,100),r}createLine(e,t=0){let i=(new $4xklQ.BufferGeometry).setFromPoints(e),r=new $4xklQ.Line(i,new $4xklQ.LineBasicMaterial({color:t}));return r.renderOrder=100,r}createShapeByPointArr(e,t=16777215){let i=new $4xklQ.Shape;i.moveTo(e[e.length-1].x,e[e.length-1].y),e.forEach((e=>{i.lineTo(e.x,e.y)}));let r=new $4xklQ.ShapeGeometry(i),n=new $4xklQ.Mesh(r,new $4xklQ.MeshBasicMaterial({color:t}));return n.renderOrder=90,n}createBalcony(e){let t,i,r,n,o,a;if("A"==e){let e=[this.masterP,this.secondBP,this.kitchenP],s=[];(e.includes(0)||e.includes(1))&&s.push(0,1),(e.includes(2)||e.includes(3))&&s.push(2,3),(e.includes(4)||e.includes(5))&&s.push(4,5),(e.includes(6)||e.includes(7))&&s.push(6,7),t=this.getPosition(s),console.log("Balcony position",t);let l,c,h=0;0==parseInt(t/2)&&(l=this.sitRoomCenter.clone().add(new $4xklQ.Vector2(0,this.sitRoomH/2))),1==parseInt(t/2)&&(l=this.sitRoomCenter.clone().add(new $4xklQ.Vector2(this.sitRoomW/2,0)),h=-Math.PI/2),2==parseInt(t/2)&&(l=this.sitRoomCenter.clone().add(new $4xklQ.Vector2(0,-this.sitRoomH/2))),3==parseInt(t/2)&&(l=this.sitRoomCenter.clone().add(new $4xklQ.Vector2(-this.sitRoomW/2,0)),h=Math.PI/2),c=-1!=[0,1,4,5].indexOf(t)?this.sitRoomW-1e3:this.sitRoomH-1e3;let d=$9QhXH.DM.createSlidingDoor(l,c,h);d.name="slidingDoor",this.doorArr.push(d),-1!=[0,1,4,5].indexOf(t)?(o=this.sitRoomW,a=this.balconyWidth,r=this.sitRoomCenter.x,0!=t&&1!=t||(n=this.sitRoomCenter.y+this.sitRoomH/2+this.balconyWidth/2),4!=t&&5!=t||(n=this.sitRoomCenter.y-this.sitRoomH/2-this.balconyWidth/2)):(o=this.balconyWidth,a=this.sitRoomH,n=this.sitRoomCenter.y,2!=t&&3!=t||(r=this.sitRoomCenter.x+this.sitRoomW/2+this.balconyWidth/2),6!=t&&7!=t||(r=this.sitRoomCenter.x-this.sitRoomW/2-this.balconyWidth/2)),i=new $4xklQ.Vector2(r,n);let u,p,m,f=0;0==parseInt(t/2)&&(u=new $4xklQ.Vector2(i.x,i.y+a/2),p=o-240,m=a/2),1==parseInt(t/2)&&(u=new $4xklQ.Vector2(i.x+o/2,i.y),p=a-240,m=o/2,f=-Math.PI/2),2==parseInt(t/2)&&(u=new $4xklQ.Vector2(i.x,i.y-a/2),p=o-240,m=a/2,f=Math.PI),3==parseInt(t/2)&&(u=new $4xklQ.Vector2(i.x-o/2,i.y),p=a-240,m=o/2,f=Math.PI/2),this.balconyAC=i,this.balconyAP=t,this.balconyAW=o,this.balconyAH=a}let s=new $4xklQ.Vector2(i.x-o/2,i.y-a/2),l=new $4xklQ.Vector2(i.x+o/2,i.y+a/2),c=this.createShape(s,l);this.shape.push(c)}createBaseDoor(e,t,i){let r,n,o,a,s,l,c,h,d=this.doorWidth,u=this.thickness,p=new $4xklQ.Group,m=(new $4xklQ.Vector2).add(new $4xklQ.Vector2(-d/2,0)).add(new $4xklQ.Vector2(0,-u/2)),f=(new $4xklQ.Vector2).add(new $4xklQ.Vector2(d/2,0)).add(new $4xklQ.Vector2(0,u/2)),g=new $4xklQ.Shape;g.moveTo(m.x,m.y),g.lineTo(m.x,f.y),g.lineTo(f.x,f.y),g.lineTo(f.x,m.y),g.lineTo(m.x,m.y);let x=new $4xklQ.ShapeGeometry(g),b=new $4xklQ.Mesh(x,new $4xklQ.MeshBasicMaterial({color:16711680,side:$4xklQ.DoubleSide}));b.name="DOOR AS",b.renderOrder=1,t?(r=new $4xklQ.Vector2(f.x,m.y),n=r.clone().add(new $4xklQ.Vector2(0,u/2+d)),o=n.clone().add(new $4xklQ.Vector2(-u/2,0)),a=o.clone().add(new $4xklQ.Vector2(0,-d)),s=a.clone().add(new $4xklQ.Vector2(u/2,0)),l=r.clone().add(new $4xklQ.Vector2(-u/2,u)),c=-Math.PI,h=Math.PI/2):(r=m,n=r.clone().add(new $4xklQ.Vector2(0,u/2+d)),o=n.clone().add(new $4xklQ.Vector2(u/2,0)),a=o.clone().add(new $4xklQ.Vector2(0,-d)),s=a.clone().add(new $4xklQ.Vector2(-u/2,0)),l=r.clone().add(new $4xklQ.Vector2(u/2,u)),c=0,h=Math.PI/2);let y=(new $4xklQ.BufferGeometry).setFromPoints([r,n,o,a,s]),w=new $4xklQ.Line(y,new $4xklQ.LineBasicMaterial({color:0}));w.name="DOOR AL",w.renderOrder=10;let v=(new $4xklQ.Path).arc(l.x,l.y,d-u/2,c,h,t).getPoints(),$=(new $4xklQ.BufferGeometry).setFromPoints(v),M=new $4xklQ.Line($,new $4xklQ.LineBasicMaterial({color:0}));M.name="DOOR BL",M.renderOrder=10;let S=new $4xklQ.Shape;S.moveTo(n.x,n.y),[o,a,s,n].forEach((e=>{S.lineTo(e.x,e.y)}));let P=new $4xklQ.ShapeGeometry(S),k=new $4xklQ.Mesh(P,new $4xklQ.MeshBasicMaterial({color:65280,side:$4xklQ.DoubleSide}));k.name="DOOR BS",k.renderOrder=5,p.add(b,w,M,k);let _=0;return 0!=i&&1!=i||(_=Math.PI),2!=i&&3!=i||(_=Math.PI/2),6!=i&&7!=i||(_=-Math.PI/2),p.rotation.z=_,p.position.set(e.x,e.y),p}createBaseWindow(e,t,i){let r=new $4xklQ.Group,n=(new $4xklQ.Vector2).add(new $4xklQ.Vector2(-t/2,this.thickness/2)),o=(new $4xklQ.Vector2).add(new $4xklQ.Vector2(-t/2,0)),a=(new $4xklQ.Vector2).add(new $4xklQ.Vector2(-t/2,-this.thickness/2)),s=(new $4xklQ.Vector2).add(new $4xklQ.Vector2(t/2,this.thickness/2)),l=(new $4xklQ.Vector2).add(new $4xklQ.Vector2(t/2,0)),c=(new $4xklQ.Vector2).add(new $4xklQ.Vector2(t/2,-this.thickness/2)),h=new $4xklQ.Shape;h.moveTo(n.x,n.y),[a,c,s,n].forEach((e=>{h.lineTo(e.x,e.y)}));let d=new $4xklQ.ShapeGeometry(h),u=new $4xklQ.Mesh(d,new $4xklQ.MeshBasicMaterial({color:16777215,side:$4xklQ.DoubleSide}));u.name="WINDOW AS",u.renderOrder=10,r.add(u);let p=(new $4xklQ.BufferGeometry).setFromPoints([o,a,c,s,n,o,l]),m=new $4xklQ.Line(p,new $4xklQ.LineBasicMaterial({color:0}));return m.name="WINDOW AL",m.renderOrder=10,r.add(m),r.rotation.z=i,r.position.set(e.x,e.y,10),r}createSlidingDoor(e,t,i,r="Double"){let n=new $4xklQ.Group,o=(new $4xklQ.Vector2).add(new $4xklQ.Vector2(-t/2,this.thickness/2)),a=(new $4xklQ.Vector2).add(new $4xklQ.Vector2(-t/2,-this.thickness/2)),s=(new $4xklQ.Vector2).add(new $4xklQ.Vector2(t/2,-this.thickness/2)),l=(new $4xklQ.Vector2).add(new $4xklQ.Vector2(t/2,this.thickness/2)),c=new $4xklQ.Shape;c.moveTo(o.x,o.y),[a,s,l,o].forEach((e=>{c.lineTo(e.x,e.y)}));let h=new $4xklQ.ShapeGeometry(c),d=new $4xklQ.Mesh(h,new $4xklQ.MeshBasicMaterial({color:16777215,side:$4xklQ.DoubleSide}));d.name="Sliding Door Base Shape",d.renderOrder=10,n.add(d);let u=(new $4xklQ.BufferGeometry).setFromPoints([o,a,s,l,o]),p=new $4xklQ.Line(u,new $4xklQ.LineBasicMaterial({color:0}));if(p.name="Sliding Door Border",p.renderOrder=10,n.add(p),"Single"==r){new $4xklQ.Vector2(-t/16,this.thickness/4),new $4xklQ.Vector2(-t/16,0)}if("Double"==r){let e=new $4xklQ.Vector2(-t/2+t/4/4*3+100,0),i=new $4xklQ.Vector2(-t/2+100,0),r=i.clone().add(new $4xklQ.Vector2(0,-this.thickness/4)),o=r.clone().add(new $4xklQ.Vector2(t/4,0)),a=o.clone().add(new $4xklQ.Vector2(0,this.thickness/4)),s=a.clone().add(new $4xklQ.Vector2(t/16*3,0)),l=s.clone().add(new $4xklQ.Vector2(0,this.thickness/4)),c=l.clone().add(new $4xklQ.Vector2(-t/4,0)),h=(new $4xklQ.BufferGeometry).setFromPoints([e,i,r,o,a,s,l,c,e,a]),d=new $4xklQ.Line(h,new $4xklQ.LineBasicMaterial({color:0}));d.name="Left Sliding Door",d.renderOrder=10,n.add(d);let u=new $4xklQ.Vector2(-e.x,e.y),p=new $4xklQ.Vector2(-i.x,i.y),m=new $4xklQ.Vector2(-r.x,r.y),f=new $4xklQ.Vector2(-o.x,o.y),g=new $4xklQ.Vector2(-a.x,a.y),x=new $4xklQ.Vector2(-s.x,s.y),b=new $4xklQ.Vector2(-l.x,l.y),y=new $4xklQ.Vector2(-c.x,c.y),w=(new $4xklQ.BufferGeometry).setFromPoints([u,p,m,f,g,x,b,y,u,g]),v=new $4xklQ.Line(w,new $4xklQ.LineBasicMaterial({color:0}));v.name="Right Sliding Door",v.renderOrder=10,n.add(v)}return n.rotation.z=i,n.position.set(e.x,e.y,10),n}generateWindow(){console.log("主",this.masterP,"次",this.secondBP,"厨",this.kitchenP);let e=[this.masterP,this.secondBP,this.kitchenP],t=[];(e.includes(0)||e.includes(1))&&t.push(0,1),(e.includes(2)||e.includes(3))&&t.push(2,3),(e.includes(4)||e.includes(5))&&t.push(4,5),(e.includes(6)||e.includes(7))&&t.push(6,7);let i,r,n=this.getPosition(t),o=0;0==parseInt(n/2)&&(i=this.sitRoomCenter.clone().add(new $4xklQ.Vector2(0,this.sitRoomH/2))),1==parseInt(n/2)&&(i=this.sitRoomCenter.clone().add(new $4xklQ.Vector2(this.sitRoomW/2,0)),o=-Math.PI/2),2==parseInt(n/2)&&(i=this.sitRoomCenter.clone().add(new $4xklQ.Vector2(0,-this.sitRoomH/2))),3==parseInt(n/2)&&(i=this.sitRoomCenter.clone().add(new $4xklQ.Vector2(-this.sitRoomW/2,0)),o=Math.PI/2),r=-1!=[0,1,4,5].indexOf(n)?this.sitRoomW-1e3:this.sitRoomH-1e3;let a=$9QhXH.DM.createSlidingDoor(i,r,o);this.doorArr.push(a)}getHome2(){let e,t,i,r,n=0;return r=this.getRandom(0,1),e=this.getRandom(1,3),t=e>1?this.getRandom(1,2):1,i=e>2?this.getRandom(1,2):1,2==e&&(n=this.getRandom(0,1)),3==e&&(n=1),r=1,console.log(e+" 室 "+t+" 厅 1 厨 "+i+" 卫 "+n+" 过道 1玄关"),this.createSittingRoom(),this.createDiningRoom2(),this.createKitchen2(),this.createPorch(),[this.shape,[]]}createDiningRoom2(){let e,t,i,r,n=this.getRandom(0,3);if(this.sitRoomW>this.sitRoomH&&(e=[2,3,6,7][n]),this.sitRoomW<this.sitRoomH&&(e=[0,1,4,5][n]),this.sitRoomW==this.sitRoomH&&(e=this.getRandom(0,7)),i=this.getRandom(1600,3e3),r=this.getRandom(1600,2500),1==this.getRandom(0,1)){let e=i;i=r,r=e}-1!=[0,1,4,5].indexOf(e)&&Math.abs(this.sitRoomW-i)<=1200&&(i=this.sitRoomW,this.gmt=!0),-1!=[2,3,6,7].indexOf(e)&&Math.abs(this.sitRoomH-r)<=1200&&(r=this.sitRoomH,this.gmt=!0),t=this.computeXY(this.sitRoomCenter,this.sitRoomW,this.sitRoomH,i,r,e),this.diningRoomCenter=t,this.diningRoomW=i,this.diningRoomH=r,this.diningRoomP=e;let o=new $4xklQ.Vector2(t.x-i/2,t.y-r/2),a=new $4xklQ.Vector2(t.x+i/2,t.y+r/2),s=this.createShape(o,a);this.shape.push(s)}createKitchen2(){let e,t,i,r,n;console.log("餐厅位置",this.diningRoomP),-1!=[0,1,4,5].indexOf(this.diningRoomP)?(n=this.diningRoomH,r=this.getRandom(2500,3500),i=this.diningRoomCenter.y,-1!=[0,5].indexOf(this.diningRoomP)&&(t=this.diningRoomCenter.x+this.diningRoomW/2+r/2),-1!=[1,4].indexOf(this.diningRoomP)&&(t=this.diningRoomCenter.x-this.diningRoomW/2-r/2)):(r=this.diningRoomW,n=this.getRandom(2500,3500),t=this.diningRoomCenter.x,-1!=[2,7].indexOf(this.diningRoomP)&&(i=this.diningRoomCenter.y-this.diningRoomH/2-n/2),-1!=[3,6].indexOf(this.diningRoomP)&&(i=this.diningRoomCenter.y+this.diningRoomH/2+n/2)),e=new $4xklQ.Vector2(t,i),this.kitchenCenter=e,this.kitchenW=r,this.kitchenH=n;let o=new $4xklQ.Vector2(e.x-r/2,e.y-n/2),a=new $4xklQ.Vector2(e.x+r/2,e.y+n/2),s=this.createShape(o,a);this.shape.push(s)}createToilet2(){let e,t,i,r,n;console.log("餐客一体",this.gmt),this.gmt?(console.log("A"),-1!=[0,1,4,5].indexOf(this.diningRoomP)&&(r=this.kitchenW,n=this.getRandom(1600,2e3),t=this.kitchenCenter.x,-1!=[0,1].indexOf(this.diningRoomP)&&(i=this.kitchenCenter.y-this.kitchenH/2-n/2),-1!=[4,5].indexOf(this.diningRoomP)&&(i=this.kitchenCenter.y+this.kitchenH/2+n/2)),-1!=[2,3,6,7].indexOf(this.diningRoomP)&&(n=this.kitchenH,r=this.getRandom(1600,2e3),i=this.kitchenCenter.y,-1!=[2,3].indexOf(this.diningRoomP)&&(t=this.kitchenCenter.x-this.kitchenW/2-r/2),-1!=[6,7].indexOf(this.diningRoomP)&&(t=this.kitchenCenter.x+this.kitchenW/2+r/2))):-1!=[0,1,4,5].indexOf(this.diningRoomP)?(n=this.diningRoomH,r=this.getRandom(1800,2500),i=this.diningRoomCenter.y,-1!=[0,5].indexOf(this.diningRoomP)&&(t=this.kitchenCenter.x+this.kitchenW/2+r/2),-1!=[1,4].indexOf(this.diningRoomP)&&(t=this.kitchenCenter.x-this.kitchenW/2-r/2)):(r=this.diningRoomW,n=this.getRandom(1800,2500),t=this.diningRoomCenter.x,-1!=[2,7].indexOf(this.diningRoomP)&&(i=this.kitchenCenter.y-this.kitchenH/2-n/2),-1!=[3,6].indexOf(this.diningRoomP)&&(i=this.kitchenCenter.y+this.kitchenH/2+n/2)),e=new $4xklQ.Vector2(t,i);let o=new $4xklQ.Vector2(e.x-r/2,e.y-n/2),a=new $4xklQ.Vector2(e.x+r/2,e.y+n/2),s=this.createShape(o,a);this.shape.push(s)}computeXY(e,t,i,r,n,o){let a,s;return 0!=o&&5!=o||(a=e.x-t/2+r/2),1!=o&&4!=o||(a=e.x+t/2-r/2),0!=o&&1!=o||(s=e.y+i/2+n/2),4!=o&&5!=o||(s=e.y-i/2-n/2),2!=o&&7!=o||(s=e.y+i/2-n/2),3!=o&&6!=o||(s=e.y-i/2+n/2),2!=o&&3!=o||(a=e.x+t/2+r/2),6!=o&&7!=o||(a=e.x-t/2-r/2),new $4xklQ.Vector2(a,s)}createPorch(){this.getRandom(1300,3300),this.getRandom(1300,1500);this.getRandom(0,1)}createSittingRoom(){let e=this.getRandom(this.sitRoomWidthMin,this.sitRoomWidthMax),t=this.getRandom(this.sitRoomHeightMin,this.sitRoomHeightMax);if(this.getRandom(0,1)){let i=e;e=t,t=i}this.sitRoomCenter=new $4xklQ.Vector2,this.sitRoomW=e,this.sitRoomH=t;let i=new $4xklQ.Vector2(e/2,t/2),r=new $4xklQ.Vector2(-e/2,-t/2);this.createShape(r,i)}createDiningRoom(){let e=this.getRandom(0,7),t=this.getRandom(1600,2500),i=this.getRandom(1600,2e3);if(-1==[0,1,4,5].indexOf(e)){let e=t;t=i,i=e}let r,n=this.getCenter(this.sitRoomCenter,this.sitRoomW,this.sitRoomH,t,i,e);0==e&&(r=n.clone().add(new $4xklQ.Vector2(-t/2,-i/2-200-this.doorWidth/2))),1==e&&(r=n.clone().add(new $4xklQ.Vector2(t/2,-i/2-200-this.doorWidth/2))),2==e&&(r=n.clone().add(new $4xklQ.Vector2(-t/2-200-this.doorWidth/2,i/2))),3==e&&(r=n.clone().add(new $4xklQ.Vector2(-t/2-200-this.doorWidth/2,-i/2))),4==e&&(r=n.clone().add(new $4xklQ.Vector2(t/2,i/2+200+this.doorWidth/2))),5==e&&(r=n.clone().add(new $4xklQ.Vector2(-t/2,i/2+200+this.doorWidth/2))),6==e&&(r=n.clone().add(new $4xklQ.Vector2(t/2+200+this.doorWidth/2,-i/2))),7==e&&(r=n.clone().add(new $4xklQ.Vector2(t/2+200+this.doorWidth/2,i/2))),this.diningRoomCenter=n,this.diningRoomW=t,this.diningRoomH=i,this.diningRoomP=e;let o=new $4xklQ.Vector2(n.x-t/2,n.y-i/2),a=new $4xklQ.Vector2(n.x+t/2,n.y+i/2),s=this.createShape(o,a);this.shape.push(s)}createKitchen(e){let t,i,r,n,o,a;e>1?(0==this.diningRoomP&&(t=1),1==this.diningRoomP&&(t=0),2==this.diningRoomP&&(t=3),3==this.diningRoomP&&(t=2),4==this.diningRoomP&&(t=5),5==this.diningRoomP&&(t=4),6==this.diningRoomP&&(t=7),7==this.diningRoomP&&(t=6)):t=this.getRandom(0,7),-1!=[0,1,4,5].indexOf(t)?(this.diningRoomW?(i=this.sitRoomW-this.diningRoomW,r=this.getRandom(2500,3500)):(i=this.getRandom(1600,2e3),r=this.getRandom(2500,3500)),n=this.getCenter(this.sitRoomCenter,this.sitRoomW,this.sitRoomH,i,r,t)):(this.diningRoomW?(r=this.sitRoomH-this.diningRoomH,i=this.getRandom(2500,3500)):(r=this.getRandom(1600,2e3),i=this.getRandom(2500,3500)),n=this.getCenter(this.sitRoomCenter,this.sitRoomW,this.sitRoomH,i,r,t)),-1!=[0,1,4,5].indexOf(t)?(o=n.x,0!=t&&1!=t||(a=n.y-r/2),4!=t&&5!=t||(a=n.y+r/2)):(a=n.y,2!=t&&3!=t||(o=n.x-i/2),6!=t&&7!=t||(o=n.x+i/2));let s=0;4!=t&&5!=t||(s=Math.PI),2!=t&&3!=t||(s=-Math.PI/2),6!=t&&7!=t||(s=Math.PI/2);let l=$9QhXH.DM.createBaseDoor(new $4xklQ.Vector2(o,a),800,"inside",s);l.name="kitchen door",this.doorArr.push(l);let c,h,d,u=0;-1!=[0,1,4,5].indexOf(t)?(c=o,d=i-600,0!=t&&1!=t||(h=a+r),4!=t&&5!=t||(h=a-r)):(h=a,d=r-600,u=Math.PI/2,2!=t&&3!=t||(c=o+i),6!=t&&7!=t||(c=o-i));let p=$9QhXH.DM.createBaseWindow(new $4xklQ.Vector2(c,h),d,u);p.name="kitchen window",this.doorArr.push(p),this.kitchenCenter=n,this.kitchenW=i,this.kitchenH=r,this.kitchenP=t;let m=new $4xklQ.Vector2(n.x-i/2,n.y-r/2),f=new $4xklQ.Vector2(n.x+i/2,n.y+r/2),g=this.createShape(m,f);this.shape.push(g)}createToilet(e){let t,i,r,n,o,a,s,l;e>1?-1!=[0,1,4,5].indexOf(this.diningRoomP)?(a=this.diningRoomCenter.x,t=this.diningRoomW,i=this.kitchenH-this.diningRoomH>=1800?this.kitchenH-this.diningRoomH:this.getRandom(1800,2500),0!=this.diningRoomP&&1!=this.diningRoomP||(o=this.diningRoomCenter.y+this.diningRoomH/2+i/2,l=4,s=this.diningRoomCenter.y+this.diningRoomH/2),4!=this.diningRoomP&&5!=this.diningRoomP||(o=this.diningRoomCenter.y-this.diningRoomH/2-i/2,l=0,s=this.diningRoomCenter.y-this.diningRoomH/2),n=this.diningRoomCenter.x):(s=this.diningRoomCenter.y,i=this.diningRoomH,t=this.kitchenW-this.diningRoomW>=1800?this.kitchenW-this.diningRoomW:this.getRandom(1800,2500),2!=this.diningRoomP&&3!=this.diningRoomP||(n=this.diningRoomCenter.x+this.diningRoomW/2+t/2,l=6,a=this.diningRoomCenter.x+this.diningRoomW/2),6!=this.diningRoomP&&7!=this.diningRoomP||(n=this.diningRoomCenter.x-this.diningRoomW/2-t/2,l=2,a=this.diningRoomCenter.x-this.diningRoomW/2),o=this.diningRoomCenter.y):-1!=[0,1,4,5].indexOf(this.kitchenP)?(t=this.sitRoomW-this.kitchenW>=1600?this.sitRoomW-this.kitchenW:this.getRandom(this.sitRoomW-this.kitchenW+this.thickness+this.bufferMeter,2e3),i=this.getRandom(1800,2500),0!=this.kitchenP&&5!=this.kitchenP||(n=this.kitchenCenter.x+this.kitchenW/2+t/2),1!=this.kitchenP&&4!=this.kitchenP||(n=this.kitchenCenter.x-this.kitchenW/2-t/2),a=n,0!=this.kitchenP&&1!=this.kitchenP||(o=this.kitchenCenter.y-this.kitchenH/2+i/2,l=4,s=o-i/2),4!=this.kitchenP&&5!=this.kitchenP||(o=this.kitchenCenter.y+this.kitchenH/2-i/2,l=0,s=o+i/2)):(i=this.sitRoomH-this.kitchenH>=1600?this.sitRoomH-this.kitchenH:this.getRandom(this.sitRoomH-this.kitchenH+this.thickness+this.bufferMeter,2e3),t=this.getRandom(1800,2500),2!=this.kitchenP&&7!=this.kitchenP||(o=this.kitchenCenter.y-this.kitchenH/2-i/2),3!=this.kitchenP&&6!=this.kitchenP||(o=this.kitchenCenter.y+this.kitchenH/2+i/2),s=o,2!=this.kitchenP&&3!=this.kitchenP||(n=this.kitchenCenter.x-this.kitchenW/2+t/2,l=6,a=n-t/2),6!=this.kitchenP&&7!=this.kitchenP||(n=this.kitchenCenter.x+this.kitchenW/2-t/2,l=2,a=n+t/2)),r=new $4xklQ.Vector2(n,o);let c=0;4!=this.kitchenP&&5!=this.kitchenP||(c=Math.PI),2!=this.kitchenP&&3!=this.kitchenP||(c=-Math.PI/2),6!=this.kitchenP&&7!=this.kitchenP||(c=Math.PI/2);let h=$9QhXH.DM.createBaseDoor(new $4xklQ.Vector2(a,s),800,"inside",c);h.name="toilet door",this.doorArr.push(h);let d,u,p,m=0;-1!=[0,1,4,5].indexOf(this.kitchenP)?(d=a,p=t-600,0!=this.kitchenP&&1!=this.kitchenP||(u=s+i),4!=this.kitchenP&&5!=this.kitchenP||(u=s-i)):(u=s,p=i-600,m=Math.PI/2,2!=this.kitchenP&&3!=this.kitchenP||(d=a+t),6!=this.kitchenP&&7!=this.kitchenP||(d=a-t));let f=$9QhXH.DM.createBaseWindow(new $4xklQ.Vector2(d,u),p,m);f.name="toilet window",this.doorArr.push(f),this.toiletC=r,this.toiletW=t,this.toiletH=i;let g=new $4xklQ.Vector2(r.x-t/2,r.y-i/2),x=new $4xklQ.Vector2(r.x+t/2,r.y+i/2),b=this.createShape(g,x);this.shape.push(b)}createSecondBedroom(){let e=[];0!=this.kitchenP&&1!=this.kitchenP||(e=[0,1]),2!=this.kitchenP&&3!=this.kitchenP||(e=[2,3]),4!=this.kitchenP&&5!=this.kitchenP||(e=[4,5]),6!=this.kitchenP&&7!=this.kitchenP||(e=[6,7]);let t=this.getPosition(e);this.secondBedroomP=t;let i,r,n,o,a,s=this.getRandom(2500,3200),l=this.getRandom(2500,3e3);-1!=[0,1,4,5].indexOf(t)?(i=this.getCenterXY(this.sitRoomCenter.x,this.sitRoomW/2,s/2,t),n=i,0!=t&&1!=t||(r=this.sitRoomCenter.y+this.sitRoomH/2+l/2,a=4,o=r-l/2),4!=t&&5!=t||(r=this.sitRoomCenter.y-this.sitRoomH/2-l/2,a=0,o=r+l/2)):(r=this.getCenterXY(this.sitRoomCenter.y,this.sitRoomH/2,l/2,t),o=r,2!=t&&3!=t||(i=this.sitRoomCenter.x+this.sitRoomW/2+s/2,a=6,n=i-s/2),6!=t&&7!=t||(i=this.sitRoomCenter.x-this.sitRoomW/2-s/2,a=2,n=i+s/2));let c=new $4xklQ.Vector2(i,r),h=0;4!=t&&5!=t||(h=Math.PI),2!=t&&3!=t||(h=-Math.PI/2),6!=t&&7!=t||(h=Math.PI/2);let d=$9QhXH.DM.createBaseDoor(new $4xklQ.Vector2(n,o),800,"inside",h);d.name="secondBD door",this.doorArr.push(d);let u,p,m,f=0;-1!=[0,1,4,5].indexOf(t)?(u=n,m=s-600,0!=t&&1!=t||(p=o+l),4!=t&&5!=t||(p=o-l)):(p=o,m=l-600,f=Math.PI/2,2!=t&&3!=t||(u=n+s),6!=t&&7!=t||(u=n-s));let g=$9QhXH.DM.createBaseWindow(new $4xklQ.Vector2(u,p),m,f);g.name="secondBD window",this.doorArr.push(g),this.secondBP=t,this.secondBC=c,this.secondBW=s,this.secondBH=l;let x=new $4xklQ.Vector2(c.x-s/2,c.y-l/2),b=new $4xklQ.Vector2(c.x+s/2,c.y+l/2),y=this.createShape(x,b);this.shape.push(y)}getCenterXY(e,t,i,r=0){let n;if(this.flat)n=-1!=[0,3,5,6].indexOf(r)?e-t+i:e+t-i;else{let r=e-t+this.thickness+this.bufferMeter-i,n=e+t-this.thickness-this.bufferMeter+i,o=e-t-this.thickness-this.bufferMeter+i,a=e-t+this.thickness+this.bufferMeter+i,s=e+t-this.thickness-this.bufferMeter-i,l=e+t+this.thickness+this.bufferMeter-i,c=e-t+i,h=e+t-i,d=this.getRandom(r,n);if(d>o&&d<a)return d==c?d:this.getCenterXY(e,t,i);if(d>s&&d<l)return d==h?d:this.getCenterXY(e,t,i)}return n}createMasterBedroom(e){let t=[];0!=this.kitchenP&&1!=this.kitchenP||(t=[0,1]),2!=this.kitchenP&&3!=this.kitchenP||(t=[2,3]),4!=this.kitchenP&&5!=this.kitchenP||(t=[4,5]),6!=this.kitchenP&&7!=this.kitchenP||(t=[6,7]),e>1&&(0!=this.secondBedroomP&&1!=this.secondBedroomP||t.push(0,1),2!=this.secondBedroomP&&3!=this.secondBedroomP||t.push(2,3),4!=this.secondBedroomP&&5!=this.secondBedroomP||t.push(4,5),6!=this.secondBedroomP&&7!=this.secondBedroomP||t.push(6,7));let i,r,n=this.getPosition(t),o=this.getRandom(4e3,4500),a=this.getRandom(2800,3500),s=0;if(console.log(this.sitRoomW-o,this.sitRoomW-a),-1!=[0,1,4,5].indexOf(n))if(this.sitRoomW-o<1e3){let e=o;o=a,a=e,this.sitRoomW-o>=1e3?s=(this.sitRoomW-o)/2:(o=this.sitRoomW-1e3,s=500)}else s=(this.sitRoomW-o)/2;else if(this.sitRoomH-a<1e3){let e=o;o=a,a=e,this.sitRoomH-a>=1e3?s=(this.sitRoomH-a)/2:(a=this.sitRoomH-1e3,s=500)}else s=(this.sitRoomH-a)/2;e>1?(0!=this.secondBedroomP&&1!=this.secondBedroomP||(-1!=[2,3,6,7].indexOf(n)&&(r=this.getCenterXY(this.sitRoomCenter.y,this.sitRoomH/2,a/2,n),-1!=[2,3].indexOf(n)&&(i=this.sitRoomCenter.x+this.sitRoomW/2+o/2),-1!=[6,7].indexOf(n)&&(i=this.sitRoomCenter.x-this.sitRoomW/2-o/2)),4!=n&&5!=n||(r=this.sitRoomCenter.y-this.sitRoomH/2-a/2,i=this.getCenterXY(this.sitRoomCenter.x,this.sitRoomW/2,o/2,n))),2!=this.secondBedroomP&&3!=this.secondBedroomP||(-1!=[0,1,4,5].indexOf(n)&&(i=this.getCenterXY(this.sitRoomCenter.x,this.sitRoomW/2,o/2,n),-1!=[0,1].indexOf(n)&&(r=this.sitRoomCenter.y+this.sitRoomH/2+a/2),-1!=[4,5].indexOf(n)&&(r=this.sitRoomCenter.y-this.sitRoomH/2-a/2)),6!=n&&7!=n||(i=this.sitRoomCenter.x-this.sitRoomW/2-o/2,r=this.getCenterXY(this.sitRoomCenter.y,this.sitRoomH/2,a/2,n))),4!=this.secondBedroomP&&5!=this.secondBedroomP||(-1!=[2,3,6,7].indexOf(n)&&(r=this.getCenterXY(this.sitRoomCenter.y,this.sitRoomH/2,a/2,n),-1!=[2,3].indexOf(n)&&(i=this.sitRoomCenter.x+this.sitRoomW/2+o/2),-1!=[6,7].indexOf(n)&&(i=this.sitRoomCenter.x-this.sitRoomW/2-o/2)),0!=n&&1!=n||(r=this.sitRoomCenter.y+this.sitRoomH/2+a/2,i=this.getCenterXY(this.sitRoomCenter.x,this.sitRoomW/2,o/2,n))),6!=this.secondBedroomP&&7!=this.secondBedroomP||(-1!=[0,1,4,5].indexOf(n)&&(i=this.getCenterXY(this.sitRoomCenter.x,this.sitRoomW/2,o/2,n),-1!=[0,1].indexOf(n)&&(r=this.sitRoomCenter.y+this.sitRoomH/2+a/2),-1!=[4,5].indexOf(n)&&(r=this.sitRoomCenter.y-this.sitRoomH/2-a/2)),2!=n&&3!=n||(i=this.sitRoomCenter.x+this.sitRoomW/2+o/2,r=this.getCenterXY(this.sitRoomCenter.y,this.sitRoomH/2,a/2,n)))):(-1!=[0,1,4,5].indexOf(n)&&(i=this.getCenterXY(this.sitRoomCenter.x,this.sitRoomW/2,o/2,n),-1!=[0,1].indexOf(n)&&(r=this.sitRoomCenter.y+this.sitRoomH/2+a/2),-1!=[4,5].indexOf(n)&&(r=this.sitRoomCenter.y-this.sitRoomH/2-a/2)),-1!=[2,3,6,7].indexOf(n)&&(r=this.getCenterXY(this.sitRoomCenter.y,this.sitRoomH/2,a/2,n),-1!=[2,3].indexOf(n)&&(i=this.sitRoomCenter.x+this.sitRoomW/2+o/2),-1!=[6,7].indexOf(n)&&(i=this.sitRoomCenter.x-this.sitRoomW/2-o/2)));let l,c,h,d=new $4xklQ.Vector2(i,r);-1!=[0,1,4,5].indexOf(n)?(l=d.x,0!=n&&1!=n||(c=d.y-a/2,h=4),4!=n&&5!=n||(c=d.y+a/2,h=0)):(c=d.y,2!=n&&3!=n||(l=d.x-o/2,h=6),6!=n&&7!=n||(l=d.x+o/2,h=2));let u=0;4!=n&&5!=n||(u=Math.PI),2!=n&&3!=n||(u=-Math.PI/2),6!=n&&7!=n||(u=Math.PI/2);let p=$9QhXH.DM.createBaseDoor(new $4xklQ.Vector2(l,c),800,"inside",u);p.name="masterBD door",this.doorArr.push(p);let m=0,f=0;0!=n&&5!=n||(m=d.x+o/2+s),1!=n&&4!=n||(m=d.x-o/2-s),0!=n&&1!=n||(f=d.y-a/2),4!=n&&5!=n||(f=d.y+a/2),2!=n&&3!=n||(m=d.x-o/2),6!=n&&7!=n||(m=d.x+o/2),2!=n&&7!=n||(f=d.y-a/2-s),3!=n&&6!=n||(f=d.y+a/2+s);let g=0;0!=n&&1!=n||(g=Math.PI),2!=n&&3!=n||(g=Math.PI/2),6!=n&&7!=n||(g=-Math.PI/2);let x=$9QhXH.DM.createLashDoor(new $4xklQ.Vector2(m,f),800,g);x.name="entry door",this.doorArr.push(x),this.masterP=n,this.masterC=d,this.masterW=o,this.masterH=a;let b=new $4xklQ.Vector2(d.x-o/2,d.y-a/2),y=new $4xklQ.Vector2(d.x+o/2,d.y+a/2),w=this.createShape(b,y,"CW");this.shape.push(w)}createStudy(){let e,t,i,r,n,o,a,s;if(0==this.secondBP&&(e=1),1==this.secondBP&&(e=0),2==this.secondBP&&(e=3),3==this.secondBP&&(e=2),4==this.secondBP&&(e=5),5==this.secondBP&&(e=4),6==this.secondBP&&(e=7),7==this.secondBP&&(e=6),-1!=[0,1,4,5].indexOf(e)){t=this.getRandom(2500,3200),i=this.secondBH,n=this.secondBC.y;let r=this.sitRoomW-this.secondBW;0!=e&&1!=e||(a=this.secondBC.y-this.secondBH/2,s=4),4!=e&&5!=e||(a=this.secondBC.y+this.secondBH/2,s=0),0!=e&&5!=e||(o=this.secondBC.x-this.secondBW/2-r/2),1!=e&&4!=e||(o=this.secondBC.x+this.secondBW/2+r/2)}else{t=this.secondBW,i=this.getRandom(2500,3e3),r=this.secondBC.x;let n=this.sitRoomH-this.secondBH;2!=e&&3!=e||(o=this.secondBC.x-this.secondBW/2,s=6),6!=e&&7!=e||(o=this.secondBC.x+this.secondBW/2,s=2),2!=e&&7!=e||(a=this.secondBC.y+this.secondBH/2+n/2),3!=e&&6!=e||(a=this.secondBC.y-this.secondBH/2-n/2)}0!=this.secondBP&&5!=this.secondBP||(r=this.secondBC.x+this.secondBW/2+t/2),1!=this.secondBP&&4!=this.secondBP||(r=this.secondBC.x-this.secondBW/2-t/2),2!=this.secondBP&&7!=this.secondBP||(n=this.secondBC.y-this.secondBH/2-i/2),3!=this.secondBP&&6!=this.secondBP||(n=this.secondBC.y+this.secondBH/2+i/2);let l=new $4xklQ.Vector2(r,n),c=0;4!=this.secondBP&&5!=this.secondBP||(c=Math.PI),2!=this.secondBP&&3!=this.secondBP||(c=-Math.PI/2),6!=this.secondBP&&7!=this.secondBP||(c=Math.PI/2);let h=$9QhXH.DM.createBaseDoor(new $4xklQ.Vector2(o,a),800,"inside",c);h.name="study door",this.doorArr.push(h);let d,u,p,m,f=0;-1!=[0,1,4,5].indexOf(e)?(p=l.x,0!=e&&1!=e||(m=l.y+i/2),4!=e&&5!=e||(m=l.y-i/2,f=Math.PI),u=t):(m=l.y,2!=e&&3!=e||(p=l.x+t/2,f=-Math.PI/2),6!=e&&7!=e||(p=l.x-t/2,f=Math.PI/2),u=i),d=new $4xklQ.Vector2(p,m);let g=$9QhXH.DM.createPanoramicWindow(d,u,f);g.name="study pw",this.doorArr.push(g);let x=new $4xklQ.Vector2(l.x-t/2,l.y-i/2),b=new $4xklQ.Vector2(l.x+t/2,l.y+i/2),y=this.createShape(x,b);this.shape.push(y)}getCenter(e,t,i,r,n,o){let a,s;switch(o){case 0:a=e.x-t/2+r/2,s=e.y+i/2+n/2;break;case 1:a=e.x+t/2-r/2,s=e.y+i/2+n/2;break;case 2:a=e.x+t/2+r/2,s=e.y+i/2-n/2;break;case 3:a=e.x+t/2+r/2,s=e.y-i/2+n/2;break;case 4:a=e.x+t/2-r/2,s=e.y-i/2-n/2;break;case 5:a=e.x-t/2+r/2,s=e.y-i/2-n/2;break;case 6:a=e.x-t/2-r/2,s=e.y-i/2+n/2;break;case 7:a=e.x-t/2-r/2,s=e.y+i/2-n/2}return new $4xklQ.Vector2(a,s)}createShape(e,t,i=""){let r,n=new $4xklQ.Shape;if(""==i){n.moveTo(e.x,t.y),n.lineTo(t.x,t.y),n.lineTo(t.x,e.y),n.lineTo(e.x,e.y),n.lineTo(e.x,t.y);let i=new $4xklQ.ShapeGeometry(n);r=new $4xklQ.Mesh(i,new $4xklQ.MeshBasicMaterial({color:16777215*Math.random(),side:$4xklQ.DoubleSide})),this.jsonArr.push(this.createJsonBy2Point(new $4xklQ.Vector2(e.x,t.y),new $4xklQ.Vector2(t.x,t.y))),this.jsonArr.push(this.createJsonBy2Point(new $4xklQ.Vector2(t.x,t.y),new $4xklQ.Vector2(t.x,e.y))),this.jsonArr.push(this.createJsonBy2Point(new $4xklQ.Vector2(t.x,e.y),new $4xklQ.Vector2(e.x,e.y))),this.jsonArr.push(this.createJsonBy2Point(new $4xklQ.Vector2(e.x,e.y),new $4xklQ.Vector2(e.x,t.y)))}return"CW"==i&&(r=this.addCornerWindow(e,t,n)),r}addCornerWindow(e,t,i){let r,n,o,a,s,l,c,h,d=2500,u=1400;if(this.masterH>this.masterW){let e=d;d=u,u=e}0!=this.masterP&&7!=this.masterP||(r=e.clone(),n=new $4xklQ.Vector2(e.x,t.y-u+this.cornerWindowWidth),o=new $4xklQ.Vector2(e.x-this.cornerWindowWidth,n.y),a=new $4xklQ.Vector2(o.x,o.y+u),s=new $4xklQ.Vector2(a.x+d,a.y),l=new $4xklQ.Vector2(s.x,s.y-this.cornerWindowWidth),c=t.clone(),h=new $4xklQ.Vector2(t.x,e.y)),1!=this.masterP&&2!=this.masterP||(h=e.clone(),r=new $4xklQ.Vector2(e.x,t.y),n=new $4xklQ.Vector2(t.x-d+this.cornerWindowWidth,t.y),o=new $4xklQ.Vector2(n.x,n.y+this.cornerWindowWidth),a=new $4xklQ.Vector2(o.x+d,o.y),s=new $4xklQ.Vector2(a.x,a.y-u),l=new $4xklQ.Vector2(s.x-this.cornerWindowWidth,s.y),c=new $4xklQ.Vector2(t.x,e.y)),3!=this.masterP&&4!=this.masterP||(c=e.clone(),h=new $4xklQ.Vector2(e.x,t.y),r=t.clone(),n=new $4xklQ.Vector2(t.x,e.y+u-this.cornerWindowWidth),o=new $4xklQ.Vector2(n.x+this.cornerWindowWidth,n.y),a=new $4xklQ.Vector2(o.x,o.y-u),s=new $4xklQ.Vector2(a.x-d,a.y),l=new $4xklQ.Vector2(s.x,s.y+this.cornerWindowWidth)),5!=this.masterP&&6!=this.masterP||(c=new $4xklQ.Vector2(e.x,t.y),h=t.clone(),r=new $4xklQ.Vector2(t.x,e.y),n=new $4xklQ.Vector2(e.x+d-this.cornerWindowWidth,e.y),o=new $4xklQ.Vector2(n.x,n.y-this.cornerWindowWidth),a=new $4xklQ.Vector2(o.x-d,o.y),s=new $4xklQ.Vector2(a.x,a.y+u),l=new $4xklQ.Vector2(s.x+this.cornerWindowWidth,s.y)),i.moveTo(r.x,r.y);let p=[n,o,a,s,l,c,h,r];p.forEach((e=>{i.lineTo(e.x,e.y)}));for(let e=0;e<p.length;e++)e==p.length-1?this.jsonArr.push(this.createJsonBy2Point(p[e],p[0])):this.jsonArr.push(this.createJsonBy2Point(p[e],p[e+1]));let m,f,g=0,x=0,b=o.clone().add(a).divideScalar(2),y=a.clone().add(s).divideScalar(2);[0,7,3,4].includes(this.masterP)?(m=u-this.thickness,g=Math.PI/2,f=d-this.thickness):(m=d-this.thickness,f=u-this.thickness,x=Math.PI/2);let w=$9QhXH.DM.createBaseWindow(b,m,g),v=$9QhXH.DM.createBaseWindow(y,f,x);return w.name="CW1",v.name="CW2",this.doorArr.push(w,v),i}handleSegment(){let e=[];for(;this.jsonArr.length>0;){let t=this.jsonArr.shift();if(0==e.length)e.push(t);else{let i=e.length,r=[],n=!0;for(let o=0;o<i;o++){let i=this.handleIntersect(t,e.shift());i.length>1&&(n=!1),r.push(...i)}n&&r.push(t),e=this.mergeArr(r)}}return e=this.handleInclude(e),this.doorArr.forEach((t=>{for(let i=0;i<e.length;i++){let r=e[i],n=new $4xklQ.Vector3(r.start.x,r.start.y,0),o=new $4xklQ.Vector3(r.end.x,r.end.y,0),a=n.clone().add(o).divideScalar(2);if(t.position.x==a.x&&t.position.y==a.y){t.wallStartPoint=n,t.wallEndPoint=o;break}}})),console.log("finalArr",e),e}handleInclude(e){let t=[];for(let i=0;i<e.length;i++){let r=[],n=[],o=new $4xklQ.Vector2(e[i].start.x,e[i].start.y),a=new $4xklQ.Vector2(e[i].end.x,e[i].end.y);for(let t=0;t<e.length;t++)if(i!=t){let i=new $4xklQ.Vector2(e[t].start.x,e[t].start.y),s=new $4xklQ.Vector2(e[t].end.x,e[t].end.y);i.distanceTo(s)<o.distanceTo(a)&&((i.equals(o)||s.equals(o))&&r.push(e[t]),(i.equals(a)||s.equals(a))&&n.push(e[t]))}for(let o=0;o<r.length;o++){let a=new $4xklQ.Vector2(r[o].start.x,r[o].start.y),s=new $4xklQ.Vector2(r[o].end.x,r[o].end.y);for(let r=0;r<n.length;r++){let o=new $4xklQ.Vector2(n[r].start.x,n[r].start.y),l=new $4xklQ.Vector2(n[r].end.x,n[r].end.y);(a.equals(o)||a.equals(l)||s.equals(o)||s.equals(l))&&t.push(e[i])}}}return t.forEach((t=>{e.splice(e.indexOf(t),1)})),e}handleIntersect(e,t){let i=e.equation,r=t.equation,n=new $4xklQ.Vector2(e.start.x,e.start.y),o=new $4xklQ.Vector2(e.end.x,e.end.y),a=new $4xklQ.Vector2(t.start.x,t.start.y),s=new $4xklQ.Vector2(t.end.x,t.end.y);if("Y"==i[0]){if("Y"==r[0]){if(i[1]!=r[1])return[t];{let i=Math.min(a.x,s.x),r=Math.max(a.x,s.x),l=a.x==i?a:s,c=a.x==r?a:s;if(n.x<i){if(o.x<i)return[t];if(o.x==i)return[t];if(o.x>i&&o.x<r){return[this.createJsonBy2Point(n,l),this.createJsonBy2Point(l,o),this.createJsonBy2Point(o,c)]}if(o.x==r){return[this.createJsonBy2Point(n,l),t]}if(o.x>r){return[this.createJsonBy2Point(n,l),t,this.createJsonBy2Point(c,o)]}}if(n.x==i){if(o.x<i)return[t];if(o.x>i&&o.x<r){return[e,this.createJsonBy2Point(o,c)]}if(o.x==r)return[t];if(o.x>r){return[t,this.createJsonBy2Point(c,o)]}}if(n.x>i&&n.x<r){if(o.x<i){return[this.createJsonBy2Point(o,l),this.createJsonBy2Point(l,n),this.createJsonBy2Point(n,c)]}if(o.x==i){return[e,this.createJsonBy2Point(n,c)]}if(o.x>i&&o.x<n.x){return[this.createJsonBy2Point(l,o),e,this.createJsonBy2Point(n,c)]}if(o.x>n.x&&o.x<r){return[this.createJsonBy2Point(l,n),e,this.createJsonBy2Point(o,c)]}if(o.x==r){return[this.createJsonBy2Point(l,n),e]}if(o.x>r){return[this.createJsonBy2Point(l,n),this.createJsonBy2Point(n,c),this.createJsonBy2Point(c,o)]}}if(n.x==r){if(o.x<i){return[this.createJsonBy2Point(o,l),t]}if(o.x==i)return[t];if(o.x>i&&o.x<r){return[this.createJsonBy2Point(l,o),e]}if(o.x>r)return[t]}if(n.x>r){if(o.x<i){return[this.createJsonBy2Point(o,l),t,this.createJsonBy2Point(c,n)]}if(o.x==i){return[t,this.createJsonBy2Point(c,n)]}if(o.x>i&&o.x<r){return[this.createJsonBy2Point(l,o),this.createJsonBy2Point(o,c),this.createJsonBy2Point(c,n)]}if(o.x==r)return[t];if(o.x>r)return[t]}}}if("X"==r[0]){let e=Math.min(n.x,o.x),l=Math.max(n.x,o.x),c=n.x==e?n:o,h=n.x==l?n:o,d=Math.min(a.y,s.y),u=Math.max(a.y,s.y),p=a.y==d?a:s,m=a.y==u?a:s,f=i[1]>d&&i[1]<u,g=r[1]>e&&r[1]<l;if(f&&g){let e=new $4xklQ.Vector2(r[1],i[1]);return[this.createJsonBy2Point(c,e),this.createJsonBy2Point(e,h),this.createJsonBy2Point(p,e),this.createJsonBy2Point(e,m)]}return[t]}}else if("X"==i[0]){if("X"==r[0]){if(i[1]!=r[1])return[t];{let i=Math.min(a.y,s.y),r=Math.max(a.y,s.y),l=a.y==i?a:s,c=a.y==r?a:s;if(n.y<i){if(o.y<i)return[t];if(o.y==i)return[t];if(o.y>i&&o.y<r){return[this.createJsonBy2Point(n,l),this.createJsonBy2Point(l,o),this.createJsonBy2Point(o,c)]}if(o.y==r){return[this.createJsonBy2Point(n,l),t]}if(o.y>r){return[this.createJsonBy2Point(n,l),t,this.createJsonBy2Point(c,o)]}}if(n.y==i){if(o.y<i)return[t];if(o.y>i&&o.y<r){return[e,this.createJsonBy2Point(o,c)]}if(o.y==r)return[t];if(o.y>r){return[t,this.createJsonBy2Point(c,o)]}}if(n.y>i&&n.y<r){if(o.y<i){return[this.createJsonBy2Point(o,l),this.createJsonBy2Point(l,n),this.createJsonBy2Point(n,c)]}if(o.y==i){return[e,this.createJsonBy2Point(n,c)]}if(o.y>i&&o.y<n.y){return[this.createJsonBy2Point(l,o),e,this.createJsonBy2Point(n,c)]}if(o.y>n.y&&o.y<r){return[this.createJsonBy2Point(l,n),e,this.createJsonBy2Point(o,c)]}if(o.y==r){return[this.createJsonBy2Point(l,n),e]}if(o.y>r){return[this.createJsonBy2Point(l,n),this.createJsonBy2Point(n,c),this.createJsonBy2Point(c,o)]}}if(n.y==r){if(o.y<i){return[this.createJsonBy2Point(o,l),t]}if(o.y==i)return[t];if(o.y>i&&o.y<r){return[this.createJsonBy2Point(l,o),e]}if(o.y>r)return[t]}if(n.y>r){if(o.y<i){return[this.createJsonBy2Point(o,l),t,this.createJsonBy2Point(c,n)]}if(o.y==i){return[t,this.createJsonBy2Point(c,n)]}if(o.y>i&&o.y<r){return[this.createJsonBy2Point(l,o),this.createJsonBy2Point(o,c),this.createJsonBy2Point(c,n)]}if(o.y==r)return[t];if(o.y>r)return[t]}}}if("Y"==r[0]){let e=Math.min(a.x,s.x),l=Math.max(a.x,s.x),c=a.x==e?a:s,h=a.x==l?a:s,d=Math.min(n.y,o.y),u=Math.max(n.y,o.y),p=n.y==d?n:o,m=n.y==u?n:o,f=i[1]>e&&i[1]<l,g=r[1]>d&&r[1]<u;if(f&&g){let e=new $4xklQ.Vector2(i[1],r[1]);return[this.createJsonBy2Point(c,e),this.createJsonBy2Point(e,h),this.createJsonBy2Point(p,e),this.createJsonBy2Point(e,m)]}return[t]}}return[]}mergeArr(e){let t=[];return e.forEach((e=>{t.length>0&&this.isInclude(t,e)||t.push(e)})),t}isInclude(e,t){let i=new $4xklQ.Vector2(t.start.x,t.start.y),r=new $4xklQ.Vector2(t.end.x,t.end.y);for(let t=0;t<e.length;t++){let n=new $4xklQ.Vector2(e[t].start.x,e[t].start.y),o=new $4xklQ.Vector2(e[t].end.x,e[t].end.y),a=n.equals(i)&&o.equals(r),s=n.equals(r)&&o.equals(i);if(a||s)return!0}return!1}handleCollinear(){}createJsonBy2Point(e,t){let i=this.getLineData(e,t);return{start:{x:e.x,y:e.y,z:0},end:{x:t.x,y:t.y,z:0},style:2,line:0,isArc:!1,thickness:this.thickness,height:this.height,direction:"",offsetXY:100,equation:i}}getLineData(e,t){if(e.x==t.x)var i="X",r=e.x;else if(e.y==t.y)i="Y",r=e.y;else{i=(e.y-t.y)/(e.x-t.x);i=Math.round(1e4*i)/1e4;r=e.y-i*e.x}return[i,r=Math.round(1e3*r)/1e3]}getRandom(e,t){return Math.floor(Math.random()*(t-e+1))+e}getPosition(e=[]){let t=this.getRandom(0,7);return-1!=e.indexOf(t)&&(t=this.getPosition(e)),t}filterArray(e){const t=[];return e.forEach((e=>{let i=!0;t.forEach((r=>{r?e[0]===r[0]&&e[1]===r[1]&&(i=!1):t.push(e)})),i&&t.push(e)})),t}}class $ca3cc62cb04c2488$var$RangeNew2{constructor(){this.thickness=240,this.height=window.storeyHei,this.bufferMeter=10,this.doorWidth=800,this.balconyWidth=1300,this.initParam(),this.reset()}initParam(){this.sitRoomWidthMin=4e3+this.thickness,this.sitRoomWidthMax=6e3+this.thickness,this.sitRoomHeightMin=3600+this.thickness,this.sitRoomHeightMax=4200+this.thickness}reset(){this.jsonArr=[],this.shape=[],this.doorArr=[],this.holeArr=[]}getHome(e=0,t=0,i=1){this.rangeHome(e,t,i),this.createSittingRoom(),this.hall>1&&this.createDiningRoom();let r=this.handleSegment();return console.log(r),[r,[],[],[]]}createSittingRoom(){let e=$hrM0U.CommonFunc.getRandomNum(this.sitRoomWidthMin,this.sitRoomWidthMax),t=$hrM0U.CommonFunc.getRandomNum(this.sitRoomHeightMin,this.sitRoomHeightMax);$hrM0U.CommonFunc.getRandomNum(0,1)&&([e,t]=[t,e]),this.sitRoomCenter=new(0,$4xklQ.Vector2),this.sitRoomW=e,this.sitRoomH=t;let i=new(0,$4xklQ.Vector2)((e+this.thickness)/2,(t+this.thickness)/2),r=new(0,$4xklQ.Vector2)(-(e+this.thickness)/2,-(t+this.thickness)/2);this.createShape(r,i)}createDiningRoom(){let e=$hrM0U.CommonFunc.getRandomNum(0,7),t=$hrM0U.CommonFunc.getRandomNum(1600,2500),i=$hrM0U.CommonFunc.getRandomNum(1600,2e3);this.sitRoomW>this.sitRoomH&&([t,i]=[i,t]);let r=this.getCenter(this.sitRoomCenter,this.sitRoomW,this.sitRoomH,t,i,e);this.diningRoomCenter=r,this.diningRoomW=t,this.diningRoomH=i,this.diningRoomP=e;let n=new(0,$4xklQ.Vector2)(r.x-(t+this.thickness)/2,r.y-(i+this.thickness)/2),o=new(0,$4xklQ.Vector2)(r.x+(t+this.thickness)/2,r.y+(i+this.thickness)/2);this.createShape(n,o)}createShape(e,t){new(0,$4xklQ.Shape);this.jsonArr.push(this.createJsonBy2Point({x:e.x,y:t.y},{x:t.x,y:t.y})),this.jsonArr.push(this.createJsonBy2Point({x:t.x,y:t.y},{x:t.x,y:e.y})),this.jsonArr.push(this.createJsonBy2Point({x:t.x,y:e.y},{x:e.x,y:e.y})),this.jsonArr.push(this.createJsonBy2Point({x:e.x,y:e.y},{x:e.x,y:t.y}))}createJsonBy2Point(e,t){return{start:{x:e.x,y:e.y,z:0},end:{x:t.x,y:t.y,z:0},style:2,line:0,isArc:!1,thickness:this.thickness,height:this.height,direction:"",offsetXY:100,equation:$hrM0U.CommonFunc.getLineEquation(e,t)}}rangeHome(e,t,i){0==e?(this.room=$hrM0U.CommonFunc.getRandomNum(1,3),this.hall=this.room>2?$hrM0U.CommonFunc.getRandomNum(1,2):1,this.toilet=this.room>2?$hrM0U.CommonFunc.getRandomNum(1,2):1):(this.room=e,this.hall=t,this.toilet=i),console.log(this.room+" 室 "+this.hall+" 厅 1 厨 "+this.toilet+" 卫 ")}rangeParam(){}getCenter(e,t,i,r,n,o){let a,s;switch(o){case 0:a=e.x-t/2+r/2,s=e.y+i/2+n/2+this.thickness;break;case 1:a=e.x+t/2-r/2,s=e.y+i/2+n/2+this.thickness;break;case 2:a=e.x+t/2+r/2+this.thickness,s=e.y+i/2-n/2;break;case 3:a=e.x+t/2+r/2+this.thickness,s=e.y-i/2+n/2;break;case 4:a=e.x+t/2-r/2,s=e.y-i/2-n/2-this.thickness;break;case 5:a=e.x-t/2+r/2,s=e.y-i/2-n/2-this.thickness;break;case 6:a=e.x-t/2-r/2-this.thickness,s=e.y-i/2+n/2;break;case 7:a=e.x-t/2-r/2-this.thickness,s=e.y+i/2-n/2}return new $4xklQ.Vector2(a,s)}handleSegment(){let e=[];for(;this.jsonArr.length>0;){let t=this.jsonArr.shift();if(0==e.length)e.push(t);else{let i=[],r=!0;for(let n=0;n<e.length;n++){let n=this.handleIntersect(t,e.shift());n.length>1&&(r=!1),i.push(...n)}r&&i.push(t),e=this.mergeArr(i)}}return console.log("A------------",e),e=this.handleInclude(e),console.log("B------------",e),this.doorArr.forEach((t=>{for(let i=0;i<e.length;i++){let r=e[i],n=new $4xklQ.Vector3(r.start.x,r.start.y,0),o=new $4xklQ.Vector3(r.end.x,r.end.y,0),a=n.clone().add(o).divideScalar(2);if(t.position.x==a.x&&t.position.y==a.y){t.wallStartPoint=n,t.wallEndPoint=o;break}}})),e}handleInclude(e){let t=[];for(let i=0;i<e.length;i++){let r=[],n=[],o=new $4xklQ.Vector2(e[i].start.x,e[i].start.y),a=new $4xklQ.Vector2(e[i].end.x,e[i].end.y);for(let t=0;t<e.length;t++)if(i!=t){let i=new $4xklQ.Vector2(e[t].start.x,e[t].start.y),s=new $4xklQ.Vector2(e[t].end.x,e[t].end.y);i.distanceTo(s)<o.distanceTo(a)&&((i.equals(o)||s.equals(o))&&r.push(e[t]),(i.equals(a)||s.equals(a))&&n.push(e[t]))}for(let o=0;o<r.length;o++){let a=new $4xklQ.Vector2(r[o].start.x,r[o].start.y),s=new $4xklQ.Vector2(r[o].end.x,r[o].end.y);for(let r=0;r<n.length;r++){let o=new $4xklQ.Vector2(n[r].start.x,n[r].start.y),l=new $4xklQ.Vector2(n[r].end.x,n[r].end.y);(a.equals(o)||a.equals(l)||s.equals(o)||s.equals(l))&&t.push(e[i])}}}return t.forEach((t=>{e.splice(e.indexOf(t),1)})),e}handleIntersect(e,t){let i=e.equation,r=t.equation,n=new $4xklQ.Vector2(e.start.x,e.start.y),o=new $4xklQ.Vector2(e.end.x,e.end.y),a=new $4xklQ.Vector2(t.start.x,t.start.y),s=new $4xklQ.Vector2(t.end.x,t.end.y);if("Y"==i[0]){if("Y"==r[0]){if(i[1]!=r[1])return[t];{let i=Math.min(a.x,s.x),r=Math.max(a.x,s.x),l=a.x==i?a:s,c=a.x==r?a:s;if(n.x<i){if(o.x<i)return[t];if(o.x==i)return[t];if(o.x>i&&o.x<r){return[this.createJsonBy2Point(n,l),this.createJsonBy2Point(l,o),this.createJsonBy2Point(o,c)]}if(o.x==r){return[this.createJsonBy2Point(n,l),t]}if(o.x>r){return[this.createJsonBy2Point(n,l),t,this.createJsonBy2Point(c,o)]}}if(n.x==i){if(o.x<i)return[t];if(o.x>i&&o.x<r){return[e,this.createJsonBy2Point(o,c)]}if(o.x==r)return[t];if(o.x>r){return[t,this.createJsonBy2Point(c,o)]}}if(n.x>i&&n.x<r){if(o.x<i){return[this.createJsonBy2Point(o,l),this.createJsonBy2Point(l,n),this.createJsonBy2Point(n,c)]}if(o.x==i){return[e,this.createJsonBy2Point(n,c)]}if(o.x>i&&o.x<n.x){return[this.createJsonBy2Point(l,o),e,this.createJsonBy2Point(n,c)]}if(o.x>n.x&&o.x<r){return[this.createJsonBy2Point(l,n),e,this.createJsonBy2Point(o,c)]}if(o.x==r){return[this.createJsonBy2Point(l,n),e]}if(o.x>r){return[this.createJsonBy2Point(l,n),this.createJsonBy2Point(n,c),this.createJsonBy2Point(c,o)]}}if(n.x==r){if(o.x<i){return[this.createJsonBy2Point(o,l),t]}if(o.x==i)return[t];if(o.x>i&&o.x<r){return[this.createJsonBy2Point(l,o),e]}if(o.x>r)return[t]}if(n.x>r){if(o.x<i){return[this.createJsonBy2Point(o,l),t,this.createJsonBy2Point(c,n)]}if(o.x==i){return[t,this.createJsonBy2Point(c,n)]}if(o.x>i&&o.x<r){return[this.createJsonBy2Point(l,o),this.createJsonBy2Point(o,c),this.createJsonBy2Point(c,n)]}if(o.x==r)return[t];if(o.x>r)return[t]}}}if("X"==r[0]){let e=Math.min(n.x,o.x),l=Math.max(n.x,o.x),c=n.x==e?n:o,h=n.x==l?n:o,d=Math.min(a.y,s.y),u=Math.max(a.y,s.y),p=a.y==d?a:s,m=a.y==u?a:s,f=i[1]>d&&i[1]<u,g=r[1]>e&&r[1]<l;if(f&&g){let e=new $4xklQ.Vector2(r[1],i[1]);return[this.createJsonBy2Point(c,e),this.createJsonBy2Point(e,h),this.createJsonBy2Point(p,e),this.createJsonBy2Point(e,m)]}return[t]}}else if("X"==i[0]){if("X"==r[0]){if(i[1]!=r[1])return[t];{let i=Math.min(a.y,s.y),r=Math.max(a.y,s.y),l=a.y==i?a:s,c=a.y==r?a:s;if(n.y<i){if(o.y<i)return[t];if(o.y==i)return[t];if(o.y>i&&o.y<r){return[this.createJsonBy2Point(n,l),this.createJsonBy2Point(l,o),this.createJsonBy2Point(o,c)]}if(o.y==r){return[this.createJsonBy2Point(n,l),t]}if(o.y>r){return[this.createJsonBy2Point(n,l),t,this.createJsonBy2Point(c,o)]}}if(n.y==i){if(o.y<i)return[t];if(o.y>i&&o.y<r){return[e,this.createJsonBy2Point(o,c)]}if(o.y==r)return[t];if(o.y>r){return[t,this.createJsonBy2Point(c,o)]}}if(n.y>i&&n.y<r){if(o.y<i){return[this.createJsonBy2Point(o,l),this.createJsonBy2Point(l,n),this.createJsonBy2Point(n,c)]}if(o.y==i){return[e,this.createJsonBy2Point(n,c)]}if(o.y>i&&o.y<n.y){return[this.createJsonBy2Point(l,o),e,this.createJsonBy2Point(n,c)]}if(o.y>n.y&&o.y<r){return[this.createJsonBy2Point(l,n),e,this.createJsonBy2Point(o,c)]}if(o.y==r){return[this.createJsonBy2Point(l,n),e]}if(o.y>r){return[this.createJsonBy2Point(l,n),this.createJsonBy2Point(n,c),this.createJsonBy2Point(c,o)]}}if(n.y==r){if(o.y<i){return[this.createJsonBy2Point(o,l),t]}if(o.y==i)return[t];if(o.y>i&&o.y<r){return[this.createJsonBy2Point(l,o),e]}if(o.y>r)return[t]}if(n.y>r){if(o.y<i){return[this.createJsonBy2Point(o,l),t,this.createJsonBy2Point(c,n)]}if(o.y==i){return[t,this.createJsonBy2Point(c,n)]}if(o.y>i&&o.y<r){return[this.createJsonBy2Point(l,o),this.createJsonBy2Point(o,c),this.createJsonBy2Point(c,n)]}if(o.y==r)return[t];if(o.y>r)return[t]}}}if("Y"==r[0]){let e=Math.min(a.x,s.x),l=Math.max(a.x,s.x),c=a.x==e?a:s,h=a.x==l?a:s,d=Math.min(n.y,o.y),u=Math.max(n.y,o.y),p=n.y==d?n:o,m=n.y==u?n:o,f=i[1]>e&&i[1]<l,g=r[1]>d&&r[1]<u;if(f&&g){let e=new $4xklQ.Vector2(i[1],r[1]);return[this.createJsonBy2Point(c,e),this.createJsonBy2Point(e,h),this.createJsonBy2Point(p,e),this.createJsonBy2Point(e,m)]}return[t]}}return[]}mergeArr(e){let t=[];return e.forEach((e=>{t.length>0&&this.isInclude(t,e)||t.push(e)})),t}}var $hu0fb=parcelRequire("hu0fb"),$4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ");class $0684d9623c4c8e37$export$802bc10488da99c7{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const $0684d9623c4c8e37$var$_camera=new(0,$4xklQ.OrthographicCamera)(-1,1,1,-1,0,1),$0684d9623c4c8e37$var$_geometry=new(0,$4xklQ.BufferGeometry);$0684d9623c4c8e37$var$_geometry.setAttribute("position",new(0,$4xklQ.Float32BufferAttribute)([-1,3,0,-1,-1,0,3,-1,0],3)),$0684d9623c4c8e37$var$_geometry.setAttribute("uv",new(0,$4xklQ.Float32BufferAttribute)([0,2,0,0,2,0],2));class $0684d9623c4c8e37$export$3983474c8e6e978b{constructor(e){this._mesh=new(0,$4xklQ.Mesh)($0684d9623c4c8e37$var$_geometry,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,$0684d9623c4c8e37$var$_camera)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ");class $282727f340fc2a87$export$f1ac3a587b6cbb5d extends $4xklQ.ShaderMaterial{constructor(e){super(e);for(const e in this.uniforms)Object.defineProperty(this,e,{get(){return this.uniforms[e].value},set(t){this.uniforms[e].value=t}})}setDefine(e,t){null==t?e in this.defines&&(delete this.defines[e],this.needsUpdate=!0):this.defines[e]!==t&&(this.defines[e]=t,this.needsUpdate=!0)}}class $537940c5fc961741$export$70ee8b3cbd6f21d8 extends $282727f340fc2a87$export$f1ac3a587b6cbb5d{constructor(e){super({blending:$4xklQ.NoBlending,uniforms:{target1:{value:null},target2:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t\t\t}",fragmentShader:"\n\n\t\t\t\tuniform float opacity;\n\n\t\t\t\tuniform sampler2D target1;\n\t\t\t\tuniform sampler2D target2;\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec4 color1 = texture2D( target1, vUv );\n\t\t\t\t\tvec4 color2 = texture2D( target2, vUv );\n\n\t\t\t\t\tfloat invOpacity = 1.0 - opacity;\n\t\t\t\t\tfloat totalAlpha = color1.a * invOpacity + color2.a * opacity;\n\n\t\t\t\t\tif ( color1.a != 0.0 || color2.a != 0.0 ) {\n\n\t\t\t\t\t\tgl_FragColor.rgb = color1.rgb * ( invOpacity * color1.a / totalAlpha ) + color2.rgb * ( opacity * color2.a / totalAlpha );\n\t\t\t\t\t\tgl_FragColor.a = totalAlpha;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tgl_FragColor = vec4( 0.0 );\n\n\t\t\t\t\t}\n\n\t\t\t\t}"}),this.setValues(e)}}function*$2b66122c32049261$var$renderTask(){const{_renderer:e,_fsQuad:t,_blendQuad:i,_primaryTarget:r,_blendTargets:n,alpha:o,camera:a,material:s}=this,l=i.material;let[c,h]=n;for(;;){o?(l.opacity=1/(this.samples+1),s.blending=$4xklQ.NoBlending,s.opacity=1):(s.opacity=1/(this.samples+1),s.blending=$4xklQ.NormalBlending);const n=r.width,d=r.height;s.resolution.set(n,d),s.seed++;const u=this.tiles.x||1,p=this.tiles.y||1,m=u*p,f=1/e.getPixelRatio();for(let g=0;g<p;g++)for(let x=0;x<u;x++){s.cameraWorldMatrix.copy(a.matrixWorld),s.invProjectionMatrix.copy(a.projectionMatrixInverse);let b=0;a.projectionMatrix.elements[15]>0&&(b=1),a.isEquirectCamera&&(b=2),s.setDefine("CAMERA_TYPE",b);const y=e.getRenderTarget(),w=e.autoClear;let v=x,$=g;if(!this.stableTiles){const e=this._currentTile%(u*p);v=e%u,$=~~(e/u),this._currentTile=e+1}e.setRenderTarget(r),e.setScissorTest(!0),e.setScissor(f*Math.ceil(v*n/u),f*Math.ceil((p-$-1)*d/p),f*Math.ceil(n/u),f*Math.ceil(d/p)),e.autoClear=!1,t.render(e),e.setScissorTest(!1),e.setRenderTarget(y),e.autoClear=w,o&&(l.target1=c.texture,l.target2=r.texture,e.setRenderTarget(h),i.render(e),e.setRenderTarget(y)),this.samples+=1/m,yield}[c,h]=[h,c],this.samples=Math.round(this.samples)}}const $2b66122c32049261$var$ogClearColor=new(0,$4xklQ.Color);class $2b66122c32049261$export$196da6cc71a4331{get material(){return this._fsQuad.material}set material(e){this._fsQuad.material=e}get target(){return this._alpha?this._blendTargets[1]:this._primaryTarget}set alpha(e){e||(this._blendTargets[0].dispose(),this._blendTargets[1].dispose()),this._alpha=e,this.reset()}get alpha(){return this._alpha}constructor(e){this.camera=null,this.tiles=new(0,$4xklQ.Vector2)(1,1),this.samples=0,this.stableNoise=!1,this.stableTiles=!0,this._renderer=e,this._alpha=!1,this._fsQuad=new $0684d9623c4c8e37$export$3983474c8e6e978b(null),this._blendQuad=new $0684d9623c4c8e37$export$3983474c8e6e978b(new $537940c5fc961741$export$70ee8b3cbd6f21d8),this._task=null,this._currentTile=0,this._primaryTarget=new(0,$4xklQ.WebGLRenderTarget)(1,1,{format:$4xklQ.RGBAFormat,type:$4xklQ.FloatType}),this._blendTargets=[new(0,$4xklQ.WebGLRenderTarget)(1,1,{format:$4xklQ.RGBAFormat,type:$4xklQ.FloatType}),new(0,$4xklQ.WebGLRenderTarget)(1,1,{format:$4xklQ.RGBAFormat,type:$4xklQ.FloatType})]}setSize(e,t){this._primaryTarget.setSize(e,t),this._blendTargets[0].setSize(e,t),this._blendTargets[1].setSize(e,t),this.reset()}dispose(){this._primaryTarget.dispose(),this._blendTargets[0].dispose(),this._blendTargets[1].dispose(),this._fsQuad.dispose(),this._blendQuad.dispose(),this._task=null}reset(){const{_renderer:e,_primaryTarget:t,_blendTargets:i}=this,r=e.getRenderTarget(),n=e.getClearAlpha();e.getClearColor($2b66122c32049261$var$ogClearColor),e.setRenderTarget(t),e.setClearColor(0,0),e.clearColor(),e.setRenderTarget(i[0]),e.setClearColor(0,0),e.clearColor(),e.setRenderTarget(i[1]),e.setClearColor(0,0),e.clearColor(),e.setClearColor($2b66122c32049261$var$ogClearColor,n),e.setRenderTarget(r),this.samples=0,this._task=null,this.stableNoise&&(this.material.seed=0)}update(){this._task||(this._task=$2b66122c32049261$var$renderTask.call(this)),this._task.next()}}var $4xklQ=parcelRequire("4xklQ");const $62e02ca5c2ecb453$export$207a3935c1ec5d77="\n\n\t// https://github.com/KhronosGroup/glTF/blob/main/extensions/2.0/Khronos/KHR_materials_volume/README.md#attenuation\n\tvec3 transmissionAttenuation( float dist, vec3 attColor, float attDist ) {\n\n\t\tvec3 ot = - log( attColor ) / attDist;\n\t\treturn exp( - ot * dist );\n\n\t}\n\n\t// https://google.github.io/filament/Filament.md.html#materialsystem/diffusebrdf\n\tfloat schlickFresnel( float cosine, float f0 ) {\n\n\t\treturn f0 + ( 1.0 - f0 ) * pow( 1.0 - cosine, 5.0 );\n\n\t}\n\n\tvec3 schlickFresnel( float cosine, vec3 f0 ) {\n\n\t\treturn f0 + ( 1.0 - f0 ) * pow( 1.0 - cosine, 5.0 );\n\n\t}\n\n\t// https://raytracing.github.io/books/RayTracingInOneWeekend.html#dielectrics/schlickapproximation\n\tfloat iorRatioToF0( float iorRatio ) {\n\n\t\treturn pow( ( 1.0 - iorRatio ) / ( 1.0 + iorRatio ), 2.0 );\n\n\t}\n\n\tfloat schlickFresnelFromIor( float cosine, float iorRatio ) {\n\n\t\t// Schlick approximation\n\t\tfloat r_0 = iorRatioToF0( iorRatio );\n\t\treturn schlickFresnel( cosine, r_0 );\n\n\t}\n\n\t// forms a basis with the normal vector as Z\n\tmat3 getBasisFromNormal( vec3 normal ) {\n\n\t\tvec3 other;\n\t\tif ( abs( normal.x ) > 0.5 ) {\n\n\t\t\tother = vec3( 0.0, 1.0, 0.0 );\n\n\t\t} else {\n\n\t\t\tother = vec3( 1.0, 0.0, 0.0 );\n\n\t\t}\n\n\t\tvec3 ortho = normalize( cross( normal, other ) );\n\t\tvec3 ortho2 = normalize( cross( normal, ortho ) );\n\t\treturn mat3( ortho2, ortho, normal );\n\n\t}\n\n\tvec3 getHalfVector( vec3 a, vec3 b ) {\n\n\t\treturn normalize( a + b );\n\n\t}\n\n\t// The discrepancy between interpolated surface normal and geometry normal can cause issues when a ray\n\t// is cast that is on the top side of the geometry normal plane but below the surface normal plane. If\n\t// we find a ray like that we ignore it to avoid artifacts.\n\t// This function returns if the direction is on the same side of both planes.\n\tbool isDirectionValid( vec3 direction, vec3 surfaceNormal, vec3 geometryNormal ) {\n\n\t\tbool aboveSurfaceNormal = dot( direction, surfaceNormal ) > 0.0;\n\t\tbool aboveGeometryNormal = dot( direction, geometryNormal ) > 0.0;\n\t\treturn aboveSurfaceNormal == aboveGeometryNormal;\n\n\t}\n\n\tvec3 getHemisphereSample( vec3 n, vec2 uv ) {\n\n\t\t// https://www.rorydriscoll.com/2009/01/07/better-sampling/\n\t\t// https://graphics.pixar.com/library/OrthonormalB/paper.pdf\n\t\tfloat sign = n.z == 0.0 ? 1.0 : sign( n.z );\n\t\tfloat a = - 1.0 / ( sign + n.z );\n\t\tfloat b = n.x * n.y * a;\n\t\tvec3 b1 = vec3( 1.0 + sign * n.x * n.x * a, sign * b, - sign * n.x );\n\t\tvec3 b2 = vec3( b, sign + n.y * n.y * a, - n.y );\n\n\t\tfloat r = sqrt( uv.x );\n\t\tfloat theta = 2.0 * PI * uv.y;\n\t\tfloat x = r * cos( theta );\n\t\tfloat y = r * sin( theta );\n\t\treturn x * b1 + y * b2 + sqrt( 1.0 - uv.x ) * n;\n\n\t}\n\n\t// https://www.shadertoy.com/view/wltcRS\n\tuvec4 s0;\n\n\tvoid rng_initialize(vec2 p, int frame) {\n\n\t\t// white noise seed\n\t\ts0 = uvec4( p, uint( frame ), uint( p.x ) + uint( p.y ) );\n\n\t}\n\n\t// https://www.pcg-random.org/\n\tvoid pcg4d( inout uvec4 v ) {\n\n\t\tv = v * 1664525u + 1013904223u;\n\t\tv.x += v.y * v.w;\n\t\tv.y += v.z * v.x;\n\t\tv.z += v.x * v.y;\n\t\tv.w += v.y * v.z;\n\t\tv = v ^ ( v >> 16u );\n\t\tv.x += v.y*v.w;\n\t\tv.y += v.z*v.x;\n\t\tv.z += v.x*v.y;\n\t\tv.w += v.y*v.z;\n\n\t}\n\n\t// returns [ 0, 1 ]\n\tfloat rand() {\n\n\t\tpcg4d(s0);\n\t\treturn float( s0.x ) / float( 0xffffffffu );\n\n\t}\n\n\tvec2 rand2() {\n\n\t\tpcg4d( s0 );\n\t\treturn vec2( s0.xy ) / float(0xffffffffu);\n\n\t}\n\n\tvec3 rand3() {\n\n\t\tpcg4d(s0);\n\t\treturn vec3( s0.xyz ) / float( 0xffffffffu );\n\n\t}\n\n\tvec4 rand4() {\n\n\t\tpcg4d(s0);\n\t\treturn vec4(s0)/float(0xffffffffu);\n\n\t}\n\n\t// https://github.com/mrdoob/three.js/blob/dev/src/math/Vector3.js#L724\n\tvec3 randDirection() {\n\n\t\tvec2 r = rand2();\n\t\tfloat u = ( r.x - 0.5 ) * 2.0;\n\t\tfloat t = r.y * PI * 2.0;\n\t\tfloat f = sqrt( 1.0 - u * u );\n\n\t\treturn vec3( f * cos( t ), f * sin( t ), u );\n\n\t}\n\n\tvec2 triangleSample( vec2 a, vec2 b, vec2 c ) {\n\n\t\t// get the edges of the triangle and the diagonal across the\n\t\t// center of the parallelogram\n\t\tvec2 e1 = a - b;\n\t\tvec2 e2 = c - b;\n\t\tvec2 diag = normalize( e1 + e2 );\n\n\t\t// pick a random point in the parallelogram\n\t\tvec2 r = rand2();\n\t\tif ( r.x + r.y > 1.0 ) {\n\n\t\t\tr = vec2( 1.0 ) - r;\n\n\t\t}\n\n\t\treturn e1 * r.x + e2 * r.y;\n\n\t}\n\n\t// samples an aperture shape with the given number of sides. 0 means circle\n\tvec2 sampleAperture( int blades ) {\n\n\t\tif ( blades == 0 ) {\n\n\t\t\tvec2 r = rand2();\n\t\t\tfloat angle = 2.0 * PI * r.x;\n\t\t\tfloat radius = sqrt( rand() );\n\t\t\treturn vec2( cos( angle ), sin( angle ) ) * radius;\n\n\t\t} else {\n\n\t\t\tblades = max( blades, 3 );\n\n\t\t\tvec3 r = rand3();\n\t\t\tfloat anglePerSegment = 2.0 * PI / float( blades );\n\t\t\tfloat segment = floor( float( blades ) * r.x );\n\n\t\t\tfloat angle1 = anglePerSegment * segment;\n\t\t\tfloat angle2 = angle1 + anglePerSegment;\n\t\t\tvec2 a = vec2( sin( angle1 ), cos( angle1 ) );\n\t\t\tvec2 b = vec2( 0.0, 0.0 );\n\t\t\tvec2 c = vec2( sin( angle2 ), cos( angle2 ) );\n\n\t\t\treturn triangleSample( a, b, c );\n\n\t\t}\n\n\t}\n\n\tfloat colorToLuminance( vec3 color ) {\n\n\t\t// https://en.wikipedia.org/wiki/Relative_luminance\n\t\treturn 0.2126 * color.r + 0.7152 * color.g + 0.0722 * color.b;\n\n\t}\n\n\t// ray sampling x and z are swapped to align with expected background view\n\tvec2 equirectDirectionToUv( vec3 direction ) {\n\n\t\t// from Spherical.setFromCartesianCoords\n\t\tvec2 uv = vec2( atan( direction.z, direction.x ), acos( direction.y ) );\n\t\tuv /= vec2( 2.0 * PI, PI );\n\n\t\t// apply adjustments to get values in range [0, 1] and y right side up\n\t\tuv.x += 0.5;\n\t\tuv.y = 1.0 - uv.y;\n\t\treturn uv;\n\n\t}\n\n\tvec3 equirectUvToDirection( vec2 uv ) {\n\n\t\t// undo above adjustments\n\t\tuv.x -= 0.5;\n\t\tuv.y = 1.0 - uv.y;\n\n\t\t// from Vector3.setFromSphericalCoords\n\t\tfloat theta = uv.x * 2.0 * PI;\n\t\tfloat phi = uv.y * PI;\n\n\t\tfloat sinPhi = sin( phi );\n\n\t\treturn vec3( sinPhi * cos( theta ), cos( phi ), sinPhi * sin( theta ) );\n\n\t}\n\n\t// Fast arccos approximation used to remove banding artifacts caused by numerical errors in acos.\n\t// This is a cubic Lagrange interpolating polynomial for x = [-1, -1/2, 0, 1/2, 1].\n\t// For more information see: https://github.com/gkjohnson/three-gpu-pathtracer/pull/171#issuecomment-1152275248\n\tfloat acosApprox( float x ) {\n\n\t\tx = clamp( x, -1.0, 1.0 );\n\t\treturn ( - 0.69813170079773212 * x * x - 0.87266462599716477 ) * x + 1.5707963267948966;\n\n\t}\n\n\t// An acos with input values bound to the range [-1, 1].\n\tfloat acosSafe( float x ) {\n\n\t\treturn acos( clamp( x, -1.0, 1.0 ) );\n\n\t}\n\n\tfloat saturateCos( float val ) {\n\n\t\treturn clamp( val, 0.001, 1.0 );\n\n\t}\n\n\tfloat square( float t ) {\n\n\t\treturn t * t;\n\n\t}\n\n\tvec2 square( vec2 t ) {\n\n\t\treturn t * t;\n\n\t}\n\n\tvec3 square( vec3 t ) {\n\n\t\treturn t * t;\n\n\t}\n\n\tvec4 square( vec4 t ) {\n\n\t\treturn t * t;\n\n\t}\n\n\t// Finds the point where the ray intersects the plane defined by u and v and checks if this point\n\t// falls in the bounds of the rectangle on that same plane.\n\t// Plane intersection: https://lousodrome.net/blog/light/2020/07/03/intersection-of-a-ray-and-a-plane/\n\tbool intersectsRectangle( vec3 center, vec3 normal, vec3 u, vec3 v, vec3 rayOrigin, vec3 rayDirection, out float dist ) {\n\n\t\tfloat t = dot( center - rayOrigin, normal ) / dot( rayDirection, normal );\n\n\t\tif ( t > EPSILON ) {\n\n\t\t\tvec3 p = rayOrigin + rayDirection * t;\n\t\t\tvec3 vi = p - center;\n\n\t\t\t// check if p falls inside the rectangle\n\t\t\tfloat a1 = dot( u, vi );\n\t\t\tif ( abs( a1 ) <= 0.5 ) {\n\n\t\t\t\tfloat a2 = dot( v, vi );\n\t\t\t\tif ( abs( a2 ) <= 0.5 ) {\n\n\t\t\t\t\tdist = t;\n\t\t\t\t\treturn true;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn false;\n\n\t}\n\n\t// Finds the point where the ray intersects the plane defined by u and v and checks if this point\n\t// falls in the bounds of the circle on that same plane. See above URL for a description of the plane intersection algorithm.\n\tbool intersectsCircle( vec3 position, vec3 normal, vec3 u, vec3 v, vec3 rayOrigin, vec3 rayDirection, out float dist ) {\n\n\t\tfloat t = dot( position - rayOrigin, normal ) / dot( rayDirection, normal );\n\n\t\tif ( t > EPSILON ) {\n\n\t\t\tvec3 hit = rayOrigin + rayDirection * t;\n\t\t\tvec3 vi = hit - position;\n\n\t\t\tfloat a1 = dot( u, vi );\n\t\t\tfloat a2 = dot( v, vi );\n\n\t\t\tif( length( vec2( a1, a2 ) ) <= 0.5 ) {\n\n\t\t\t\tdist = t;\n\t\t\t\treturn true;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn false;\n\n\t}\n\n\t// power heuristic for multiple importance sampling\n\tfloat misHeuristic( float a, float b ) {\n\n\t\tfloat aa = a * a;\n\t\tfloat bb = b * b;\n\t\treturn aa / ( aa + bb );\n\n\t}\n\n";class $510c5bcb198fe0d5$var$PMREMCopyMaterial extends $282727f340fc2a87$export$f1ac3a587b6cbb5d{constructor(){super({uniforms:{envMap:{value:null},blur:{value:0}},vertexShader:"\n\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}\n\n\t\t\t",fragmentShader:`\n\n\t\t\t\t#include <common>\n\t\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\t\t${$62e02ca5c2ecb453$export$207a3935c1ec5d77}\n\n\t\t\t\tuniform sampler2D envMap;\n\t\t\t\tuniform float blur;\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 rayDirection = equirectUvToDirection( vUv );\n\t\t\t\t\tgl_FragColor = textureCubeUV( envMap, rayDirection, blur );\n\n\t\t\t\t}\n\n\t\t\t`})}}class $510c5bcb198fe0d5$export$13ef63fd7e562136{constructor(e){this.renderer=e,this.pmremGenerator=new(0,$4xklQ.PMREMGenerator)(e),this.copyQuad=new $0684d9623c4c8e37$export$3983474c8e6e978b(new $510c5bcb198fe0d5$var$PMREMCopyMaterial),this.renderTarget=new(0,$4xklQ.WebGLRenderTarget)(1,1,{type:$4xklQ.FloatType,format:$4xklQ.RGBAFormat})}dispose(){this.pmremGenerator.dispose(),this.copyQuad.dispose(),this.renderTarget.dispose()}generate(e,t){const{pmremGenerator:i,renderTarget:r,copyQuad:n,renderer:o}=this,a=i.fromEquirectangular(e),{width:s,height:l}=e.image;r.setSize(s,l),n.material.envMap=a.texture,n.material.blur=t;const c=o.getRenderTarget(),h=o.autoClear;o.setRenderTarget(r),o.autoClear=!0,n.render(o),o.setRenderTarget(c),o.autoClear=h;const d=new Float32Array(s*l*4);o.readRenderTargetPixels(r,0,0,s,l,d);const u=new(0,$4xklQ.DataTexture)(d,s,l,$4xklQ.RGBAFormat,$4xklQ.FloatType);return u.minFilter=e.minFilter,u.magFilter=e.magFilter,u.wrapS=e.wrapS,u.wrapT=e.wrapT,u.mapping=$4xklQ.EquirectangularReflectionMapping,u.needsUpdate=!0,u}}var $4xklQ=parcelRequire("4xklQ");class $2d12cfdcbb70f909$export$e6c92f54dc85f279 extends $282727f340fc2a87$export$f1ac3a587b6cbb5d{constructor(e){super({blending:$4xklQ.NoBlending,transparent:!1,depthWrite:!1,depthTest:!1,defines:{USE_SLIDER:0},uniforms:{sigma:{value:5},threshold:{value:.03},kSigma:{value:1},map:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t\t\t}\n\n\t\t\t",fragmentShader:"\n\n\t\t\t\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\t\t\t\t//  Copyright (c) 2018-2019 Michele Morrone\n\t\t\t\t//  All rights reserved.\n\t\t\t\t//\n\t\t\t\t//  https://michelemorrone.eu - https://BrutPitt.com\n\t\t\t\t//\n\t\t\t\t//  me@michelemorrone.eu - brutpitt@gmail.com\n\t\t\t\t//  twitter: @BrutPitt - github: BrutPitt\n\t\t\t\t//\n\t\t\t\t//  https://github.com/BrutPitt/glslSmartDeNoise/\n\t\t\t\t//\n\t\t\t\t//  This software is distributed under the terms of the BSD 2-Clause license\n\t\t\t\t//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n\t\t\t\tuniform sampler2D map;\n\n\t\t\t\tuniform float sigma;\n\t\t\t\tuniform float threshold;\n\t\t\t\tuniform float kSigma;\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t#define INV_SQRT_OF_2PI 0.39894228040143267793994605993439\n\t\t\t\t#define INV_PI 0.31830988618379067153776752674503\n\n\t\t\t\t// Parameters:\n\t\t\t\t//\t sampler2D tex\t - sampler image / texture\n\t\t\t\t//\t vec2 uv\t\t   - actual fragment coord\n\t\t\t\t//\t float sigma  >  0 - sigma Standard Deviation\n\t\t\t\t//\t float kSigma >= 0 - sigma coefficient\n\t\t\t\t//\t\t kSigma * sigma  --\x3e  radius of the circular kernel\n\t\t\t\t//\t float threshold   - edge sharpening threshold\n\t\t\t\tvec4 smartDeNoise( sampler2D tex, vec2 uv, float sigma, float kSigma, float threshold ) {\n\n\t\t\t\t\tfloat radius = round( kSigma * sigma );\n\t\t\t\t\tfloat radQ = radius * radius;\n\n\t\t\t\t\tfloat invSigmaQx2 = 0.5 / ( sigma * sigma );\n\t\t\t\t\tfloat invSigmaQx2PI = INV_PI * invSigmaQx2;\n\n\t\t\t\t\tfloat invThresholdSqx2 = 0.5 / ( threshold * threshold );\n\t\t\t\t\tfloat invThresholdSqrt2PI = INV_SQRT_OF_2PI / threshold;\n\n\t\t\t\t\tvec4 centrPx = texture2D( tex, uv );\n\t\t\t\t\tcentrPx.rgb *= centrPx.a;\n\n\t\t\t\t\tfloat zBuff = 0.0;\n\t\t\t\t\tvec4 aBuff = vec4( 0.0 );\n\t\t\t\t\tvec2 size = vec2( textureSize( tex, 0 ) );\n\n\t\t\t\t\tvec2 d;\n\t\t\t\t\tfor ( d.x = - radius; d.x <= radius; d.x ++ ) {\n\n\t\t\t\t\t\tfloat pt = sqrt( radQ - d.x * d.x );\n\n\t\t\t\t\t\tfor ( d.y = - pt; d.y <= pt; d.y ++ ) {\n\n\t\t\t\t\t\t\tfloat blurFactor = exp( - dot( d, d ) * invSigmaQx2 ) * invSigmaQx2PI;\n\n\t\t\t\t\t\t\tvec4 walkPx = texture2D( tex, uv + d / size );\n\t\t\t\t\t\t\twalkPx.rgb *= walkPx.a;\n\n\t\t\t\t\t\t\tvec4 dC = walkPx - centrPx;\n\t\t\t\t\t\t\tfloat deltaFactor = exp( - dot( dC.rgba, dC.rgba ) * invThresholdSqx2 ) * invThresholdSqrt2PI * blurFactor;\n\n\t\t\t\t\t\t\tzBuff += deltaFactor;\n\t\t\t\t\t\t\taBuff += deltaFactor * walkPx;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\treturn aBuff / zBuff;\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tgl_FragColor = smartDeNoise( map, vec2( vUv.x, vUv.y ), sigma, kSigma, threshold );\n\t\t\t\t\t#include <tonemapping_fragment>\n\t\t\t\t\t#include <encodings_fragment>\n\t\t\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t\t\t}\n\n\t\t\t"}),this.setValues(e)}}var $4xklQ=parcelRequire("4xklQ"),$kEmYZ=parcelRequire("kEmYZ"),$jzv0I=parcelRequire("jzv0I"),$5jaKi=parcelRequire("5jaKi");const $de1654de00d21b4e$export$570ab67b705632a4="\n\n\tstruct PhysicalCamera {\n\n\t\tfloat focusDistance;\n\t\tfloat anamorphicRatio;\n\t\tfloat bokehSize;\n\t\tint apertureBlades;\n\t\tfloat apertureRotation;\n\n\t};\n\n\tstruct EquirectHdrInfo {\n\n\t\tsampler2D marginalWeights;\n\t\tsampler2D conditionalWeights;\n\t\tsampler2D map;\n\n\t\tfloat totalSumWhole;\n\t\tfloat totalSumDecimal;\n\n\t};\n\n\tstruct Material {\n\n\t\tvec3 color;\n\t\tint map;\n\n\t\tfloat metalness;\n\t\tint metalnessMap;\n\n\t\tfloat roughness;\n\t\tint roughnessMap;\n\n\t\tfloat ior;\n\t\tfloat transmission;\n\t\tint transmissionMap;\n\n\t\tfloat emissiveIntensity;\n\t\tvec3 emissive;\n\t\tint emissiveMap;\n\n\t\tint normalMap;\n\t\tvec2 normalScale;\n\n\t\tfloat clearcoat;\n\t\tint clearcoatMap;\n\t\tint clearcoatNormalMap;\n\t\tvec2 clearcoatNormalScale;\n\t\tfloat clearcoatRoughness;\n\t\tint clearcoatRoughnessMap;\n\n\t\tint iridescenceMap;\n\t\tint iridescenceThicknessMap;\n\t\tfloat iridescence;\n\t\tfloat iridescenceIor;\n\t\tfloat iridescenceThicknessMinimum;\n\t\tfloat iridescenceThicknessMaximum;\n\n\t\tvec3 specularColor;\n\t\tint specularColorMap;\n\n\t\tfloat specularIntensity;\n\t\tint specularIntensityMap;\n\t\tbool thinFilm;\n\n\t\tvec3 attenuationColor;\n\t\tfloat attenuationDistance;\n\n\t\tint alphaMap;\n\n\t\tbool castShadow;\n\t\tfloat opacity;\n\t\tfloat alphaTest;\n\n\t\tfloat side;\n\t\tbool matte;\n\n\t\tvec3 sheenColor;\n\t\tint sheenColorMap;\n\t\tfloat sheenRoughness;\n\t\tint sheenRoughnessMap;\n\n\t\tbool vertexColors;\n\t\tbool transparent;\n\n\t\tmat3 mapTransform;\n\t\tmat3 metalnessMapTransform;\n\t\tmat3 roughnessMapTransform;\n\t\tmat3 transmissionMapTransform;\n\t\tmat3 emissiveMapTransform;\n\t\tmat3 normalMapTransform;\n\t\tmat3 clearcoatMapTransform;\n\t\tmat3 clearcoatNormalMapTransform;\n\t\tmat3 clearcoatRoughnessMapTransform;\n\t\tmat3 sheenColorMapTransform;\n\t\tmat3 sheenRoughnessMapTransform;\n\t\tmat3 iridescenceMapTransform;\n\t\tmat3 iridescenceThicknessMapTransform;\n\t\tmat3 specularColorMapTransform;\n\t\tmat3 specularIntensityMapTransform;\n\n\t};\n\n\tmat3 readTextureTransform( sampler2D tex, uint index ) {\n\n\t\tmat3 textureTransform;\n\n\t\tvec4 row1 = texelFetch1D( tex, index );\n\t\tvec4 row2 = texelFetch1D( tex, index + 1u );\n\n\t\ttextureTransform[0] = vec3(row1.r, row2.r, 0.0);\n\t\ttextureTransform[1] = vec3(row1.g, row2.g, 0.0);\n\t\ttextureTransform[2] = vec3(row1.b, row2.b, 1.0);\n\n\t\treturn textureTransform;\n\n\t}\n\n\tMaterial readMaterialInfo( sampler2D tex, uint index ) {\n\n\t\tuint i = index * 45u;\n\n\t\tvec4 s0 = texelFetch1D( tex, i + 0u );\n\t\tvec4 s1 = texelFetch1D( tex, i + 1u );\n\t\tvec4 s2 = texelFetch1D( tex, i + 2u );\n\t\tvec4 s3 = texelFetch1D( tex, i + 3u );\n\t\tvec4 s4 = texelFetch1D( tex, i + 4u );\n\t\tvec4 s5 = texelFetch1D( tex, i + 5u );\n\t\tvec4 s6 = texelFetch1D( tex, i + 6u );\n\t\tvec4 s7 = texelFetch1D( tex, i + 7u );\n\t\tvec4 s8 = texelFetch1D( tex, i + 8u );\n\t\tvec4 s9 = texelFetch1D( tex, i + 9u );\n\t\tvec4 s10 = texelFetch1D( tex, i + 10u );\n\t\tvec4 s11 = texelFetch1D( tex, i + 11u );\n\t\tvec4 s12 = texelFetch1D( tex, i + 12u );\n\t\tvec4 s13 = texelFetch1D( tex, i + 13u );\n\t\tvec4 s14 = texelFetch1D( tex, i + 14u );\n\n\t\tMaterial m;\n\t\tm.color = s0.rgb;\n\t\tm.map = int( round( s0.a ) );\n\n\t\tm.metalness = s1.r;\n\t\tm.metalnessMap = int( round( s1.g ) );\n\t\tm.roughness = s1.b;\n\t\tm.roughnessMap = int( round( s1.a ) );\n\n\t\tm.ior = s2.r;\n\t\tm.transmission = s2.g;\n\t\tm.transmissionMap = int( round( s2.b ) );\n\t\tm.emissiveIntensity = s2.a;\n\n\t\tm.emissive = s3.rgb;\n\t\tm.emissiveMap = int( round( s3.a ) );\n\n\t\tm.normalMap = int( round( s4.r ) );\n\t\tm.normalScale = s4.gb;\n\n\t\tm.clearcoat = s4.a;\n\t\tm.clearcoatMap = int( round( s5.r ) );\n\t\tm.clearcoatRoughness = s5.g;\n\t\tm.clearcoatRoughnessMap = int( round( s5.b ) );\n\t\tm.clearcoatNormalMap = int( round( s5.a ) );\n\t\tm.clearcoatNormalScale = s6.rg;\n\n\t\tm.sheenColor = s7.rgb;\n\t\tm.sheenColorMap = int( round( s7.a ) );\n\t\tm.sheenRoughness = s8.r;\n\t\tm.sheenRoughnessMap = int( round( s8.g ) );\n\n\t\tm.iridescenceMap = int( round( s8.b ) );\n\t\tm.iridescenceThicknessMap = int( round( s8.a ) );\n\t\tm.iridescence = s9.r;\n\t\tm.iridescenceIor = s9.g;\n\t\tm.iridescenceThicknessMinimum = s9.b;\n\t\tm.iridescenceThicknessMaximum = s9.a;\n\n\t\tm.specularColor = s10.rgb;\n\t\tm.specularColorMap = int( round( s10.a ) );\n\n\t\tm.specularIntensity = s11.r;\n\t\tm.specularIntensityMap = int( round( s11.g ) );\n\t\tm.thinFilm = bool( s11.b );\n\n\t\tm.attenuationColor = s12.rgb;\n\t\tm.attenuationDistance = s12.a;\n\n\t\tm.alphaMap = int( round( s13.r ) );\n\n\t\tm.opacity = s13.g;\n\t\tm.alphaTest = s13.b;\n\t\tm.side = s13.a;\n\n\t\tm.matte = bool( s14.r );\n\t\tm.castShadow = ! bool( s14.g );\n\t\tm.vertexColors = bool( s14.b );\n\t\tm.transparent = bool( s14.a );\n\n\t\tuint firstTextureTransformIdx = i + 15u;\n\n\t\tm.mapTransform = m.map == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx );\n\t\tm.metalnessMapTransform = m.metalnessMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 2u );\n\t\tm.roughnessMapTransform = m.roughnessMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 4u );\n\t\tm.transmissionMapTransform = m.transmissionMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 6u );\n\t\tm.emissiveMapTransform = m.emissiveMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 8u );\n\t\tm.normalMapTransform = m.normalMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 10u );\n\t\tm.clearcoatMapTransform = m.clearcoatMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 12u );\n\t\tm.clearcoatNormalMapTransform = m.clearcoatNormalMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 14u );\n\t\tm.clearcoatRoughnessMapTransform = m.clearcoatRoughnessMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 16u );\n\t\tm.sheenColorMapTransform = m.sheenColorMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 18u );\n\t\tm.sheenRoughnessMapTransform = m.sheenRoughnessMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 20u );\n\t\tm.iridescenceMapTransform = m.iridescenceMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 22u );\n\t\tm.iridescenceThicknessMapTransform = m.iridescenceThicknessMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 24u );\n\t\tm.specularColorMapTransform = m.specularColorMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 26u );\n\t\tm.specularIntensityMapTransform = m.specularIntensityMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 28u );\n\n\t\treturn m;\n\n\t}\n\n",$de1654de00d21b4e$export$2861714a2bd5835b="\n\n\t#define RECT_AREA_LIGHT_TYPE 0\n\t#define CIRC_AREA_LIGHT_TYPE 1\n\t#define SPOT_LIGHT_TYPE 2\n\n\tstruct LightsInfo {\n\n\t\tsampler2D tex;\n\t\tuint count;\n\n\t};\n\n\tstruct Light {\n\n\t\tvec3 position;\n\t\tint type;\n\n\t\tvec3 color;\n\t\tfloat intensity;\n\n\t\tvec3 u;\n\t\tvec3 v;\n\t\tfloat area;\n\n\t\t// spot light fields\n\t\tfloat radius;\n\t\tfloat near;\n\t\tfloat decay;\n\t\tfloat distance;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint iesProfile;\n\n\t};\n\n\tLight readLightInfo( sampler2D tex, uint index ) {\n\n\t\tuint i = index * 6u;\n\n\t\tvec4 s0 = texelFetch1D( tex, i + 0u );\n\t\tvec4 s1 = texelFetch1D( tex, i + 1u );\n\t\tvec4 s2 = texelFetch1D( tex, i + 2u );\n\t\tvec4 s3 = texelFetch1D( tex, i + 3u );\n\n\t\tLight l;\n\t\tl.position = s0.rgb;\n\t\tl.type = int( round( s0.a ) );\n\n\t\tl.color = s1.rgb;\n\t\tl.intensity = s1.a;\n\n\t\tl.u = s2.rgb;\n\t\tl.v = s3.rgb;\n\t\tl.area = s3.a;\n\n\t\tif ( l.type == SPOT_LIGHT_TYPE ) {\n\n\t\t\tvec4 s4 = texelFetch1D( tex, i + 4u );\n\t\t\tvec4 s5 = texelFetch1D( tex, i + 5u );\n\t\t\tl.radius = s4.r;\n\t\t\tl.near = s4.g;\n\t\t\tl.decay = s4.b;\n\t\t\tl.distance = s4.a;\n\n\t\t\tl.coneCos = s5.r;\n\t\t\tl.penumbraCos = s5.g;\n\t\t\tl.iesProfile = int( round ( s5.b ) );\n\n\t\t}\n\n\t\treturn l;\n\n\t}\n\n\tstruct SpotLight {\n\n\t\tvec3 position;\n\t\tint type;\n\n\t\tvec3 color;\n\t\tfloat intensity;\n\n\t\tvec3 u;\n\t\tvec3 v;\n\t\tfloat area;\n\n\t\tfloat radius;\n\t\tfloat near;\n\t\tfloat decay;\n\t\tfloat distance;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint iesProfile;\n\n\t};\n\n";var $4xklQ=parcelRequire("4xklQ");const $dd32143970950b7f$var$MATERIAL_PIXELS=45,$dd32143970950b7f$var$MATERIAL_STRIDE=4*$dd32143970950b7f$var$MATERIAL_PIXELS,$dd32143970950b7f$var$SIDE_OFFSET=55,$dd32143970950b7f$var$MATTE_OFFSET=56,$dd32143970950b7f$var$SHADOW_OFFSET=57;class $dd32143970950b7f$export$ae96f3619813ce17 extends $4xklQ.DataTexture{constructor(){super(new Float32Array(4),1,1),this.format=$4xklQ.RGBAFormat,this.type=$4xklQ.FloatType,this.wrapS=$4xklQ.ClampToEdgeWrapping,this.wrapT=$4xklQ.ClampToEdgeWrapping,this.generateMipmaps=!1,this.threeCompatibilityTransforms=!1}setCastShadow(e,t){this.image.data[e*$dd32143970950b7f$var$MATERIAL_STRIDE+$dd32143970950b7f$var$SHADOW_OFFSET]=t?0:1}getCastShadow(e){const t=this.image.data;return!Boolean(t[e*$dd32143970950b7f$var$MATERIAL_STRIDE+$dd32143970950b7f$var$SHADOW_OFFSET])}setSide(e,t){const i=this.image.data,r=e*$dd32143970950b7f$var$MATERIAL_STRIDE+$dd32143970950b7f$var$SIDE_OFFSET;switch(t){case $4xklQ.FrontSide:i[r]=1;break;case $4xklQ.BackSide:i[r]=-1;break;case $4xklQ.DoubleSide:i[r]=0}}getSide(e){switch(this.image.data[e*$dd32143970950b7f$var$MATERIAL_STRIDE+$dd32143970950b7f$var$SIDE_OFFSET]){case 0:return $4xklQ.DoubleSide;case 1:return $4xklQ.FrontSide;case-1:return $4xklQ.BackSide}return 0}setMatte(e,t){this.image.data[e*$dd32143970950b7f$var$MATERIAL_STRIDE+$dd32143970950b7f$var$MATTE_OFFSET]=t?1:0}getMatte(e){const t=this.image.data;return Boolean(t[e*$dd32143970950b7f$var$MATERIAL_STRIDE+$dd32143970950b7f$var$MATTE_OFFSET])}updateFrom(e,t){function i(e,i,r=-1){return i in e?t.indexOf(e[i]):r}function r(e,t,i){return t in e?e[t]:i}function n(e,t,i,r){let n;if(n=l?function(e){return e.map||e.specularMap||e.displacementMap||e.normalMap||e.bumpMap||e.roughnessMap||e.metalnessMap||e.alphaMap||e.emissiveMap||e.clearcoatMap||e.clearcoatNormalMap||e.clearcoatRoughnessMap||e.iridescenceMap||e.iridescenceThicknessMap||e.specularIntensityMap||e.specularColorMap||e.transmissionMap||e.thicknessMap||e.sheenColorMap||e.sheenRoughnessMap||null}(e):e[t]&&e[t].isTexture?e[t]:null,n){const e=n.matrix.elements;let t=0;i[r+t++]=e[0],i[r+t++]=e[3],i[r+t++]=e[6],t++,i[r+t++]=e[1],i[r+t++]=e[4],i[r+t++]=e[7],t++}return 8}let o=0;const a=e.length*$dd32143970950b7f$var$MATERIAL_PIXELS,s=Math.ceil(Math.sqrt(a)),{threeCompatibilityTransforms:l,image:c}=this;c.width!==s&&(this.dispose(),c.data=new Float32Array(s*s*4),c.width=s,c.height=s);const h=c.data;for(let a=0,s=e.length;a<s;a++){const s=e[a];h[o++]=s.color.r,h[o++]=s.color.g,h[o++]=s.color.b,h[o++]=i(s,"map"),h[o++]=r(s,"metalness",0),h[o++]=t.indexOf(s.metalnessMap),h[o++]=r(s,"roughness",0),h[o++]=t.indexOf(s.roughnessMap),h[o++]=r(s,"ior",1.5),h[o++]=r(s,"transmission",0),h[o++]=i(s,"transmissionMap"),h[o++]=r(s,"emissiveIntensity",0),"emissive"in s?(h[o++]=s.emissive.r,h[o++]=s.emissive.g,h[o++]=s.emissive.b):(h[o++]=0,h[o++]=0,h[o++]=0),h[o++]=i(s,"emissiveMap"),h[o++]=i(s,"normalMap"),"normalScale"in s?(h[o++]=s.normalScale.x,h[o++]=s.normalScale.y):(h[o++]=1,h[o++]=1),h[o++]=r(s,"clearcoat",0),h[o++]=i(s,"clearcoatMap"),h[o++]=r(s,"clearcoatRoughness",0),h[o++]=i(s,"clearcoatRoughnessMap"),h[o++]=i(s,"clearcoatNormalMap"),"clearcoatNormalScale"in s?(h[o++]=s.clearcoatNormalScale.x,h[o++]=s.clearcoatNormalScale.y):(h[o++]=1,h[o++]=1),o++,o++,"sheenColor"in s?(h[o++]=s.sheenColor.r,h[o++]=s.sheenColor.g,h[o++]=s.sheenColor.b):(h[o++]=0,h[o++]=0,h[o++]=0),h[o++]=i(s,"sheenColorMap"),h[o++]=r(s,"sheenRoughness",0),h[o++]=i(s,"sheenRoughnessMap"),h[o++]=i(s,"iridescenceMap"),h[o++]=i(s,"iridescenceThicknessMap"),h[o++]=r(s,"iridescence",0),h[o++]=r(s,"iridescenceIOR",1.3);const l=r(s,"iridescenceThicknessRange",[100,400]);h[o++]=l[0],h[o++]=l[1],"specularColor"in s?(h[o++]=s.specularColor.r,h[o++]=s.specularColor.g,h[o++]=s.specularColor.b):(h[o++]=1,h[o++]=1,h[o++]=1),h[o++]=i(s,"specularColorMap"),h[o++]=r(s,"specularIntensity",1),h[o++]=i(s,"specularIntensityMap"),h[o++]=0===r(s,"thickness",0)&&r(s,"attenuationDistance",1/0)===1/0,o++,"attenuationColor"in s?(h[o++]=s.attenuationColor.r,h[o++]=s.attenuationColor.g,h[o++]=s.attenuationColor.b):(h[o++]=1,h[o++]=1,h[o++]=1),h[o++]=r(s,"attenuationDistance",1/0),h[o++]=i(s,"alphaMap"),h[o++]=s.opacity,h[o++]=s.alphaTest,o++,o++,o++,h[o++]=Number(s.vertexColors),h[o++]=Number(s.transparent),o+=n(s,"map",h,o),o+=n(s,"metalnessMap",h,o),o+=n(s,"roughnessMap",h,o),o+=n(s,"transmissionMap",h,o),o+=n(s,"emissiveMap",h,o),o+=n(s,"normalMap",h,o),o+=n(s,"clearcoatMap",h,o),o+=n(s,"clearcoatNormalMap",h,o),o+=n(s,"clearcoatRoughnessMap",h,o),o+=n(s,"sheenColorMap",h,o),o+=n(s,"sheenRoughnessMap",h,o),o+=n(s,"iridescenceMap",h,o),o+=n(s,"iridescenceThicknessMap",h,o),o+=n(s,"specularColorMap",h,o),o+=n(s,"specularIntensityMap",h,o)}this.needsUpdate=!0}}var $4xklQ=parcelRequire("4xklQ");const $e28b7d03d182ad46$var$prevColor=new(0,$4xklQ.Color);class $e28b7d03d182ad46$export$dbbaa51cb2d0b2f7 extends $4xklQ.WebGLArrayRenderTarget{constructor(...e){super(...e);const t=this.texture;t.format=$4xklQ.RGBAFormat,t.type=$4xklQ.UnsignedByteType,t.minFilter=$4xklQ.LinearFilter,t.magFilter=$4xklQ.LinearFilter,t.wrapS=$4xklQ.RepeatWrapping,t.wrapT=$4xklQ.RepeatWrapping,t.setTextures=(...e)=>{this.setTextures(...e)};const i=new $0684d9623c4c8e37$export$3983474c8e6e978b(new(0,$4xklQ.MeshBasicMaterial));this.fsQuad=i}setTextures(e,t,i,r){const n=e.getRenderTarget(),o=e.toneMapping,a=e.getClearAlpha();e.getClearColor($e28b7d03d182ad46$var$prevColor);const s=r.length||1;this.setSize(t,i,s),e.setClearColor(0,0),e.toneMapping=$4xklQ.NoToneMapping;const l=this.fsQuad;for(let t=0,i=s;t<i;t++){const i=r[t];i&&(i.matrixAutoUpdate=!1,i.matrix.identity(),l.material.map=i,l.material.transparent=!0,e.setRenderTarget(this,t),l.render(e),i.updateMatrix(),i.matrixAutoUpdate=!0)}l.material.map=null,e.setClearColor($e28b7d03d182ad46$var$prevColor,a),e.setRenderTarget(n),e.toneMapping=o}dispose(){super.dispose(),this.fsQuad.dispose()}}const $2a5f3cf340e7c2d3$export$75d2a701aae03ef9="\n// The GGX functions provide sampling and distribution information for normals as output so\n// in order to get probability of scatter direction the half vector must be computed and provided.\n// [0] https://www.cs.cornell.edu/~srm/publications/EGSR07-btdf.pdf\n// [1] https://hal.archives-ouvertes.fr/hal-01509746/document\n// [2] http://jcgt.org/published/0007/04/01/\n// [4] http://jcgt.org/published/0003/02/03/\n\n// trowbridge-reitz === GGX === GTR\n\nvec3 ggxDirection( vec3 incidentDir, float roughnessX, float roughnessY, float random1, float random2 ) {\n\n\t// TODO: try GGXVNDF implementation from reference [2], here. Needs to update ggxDistribution\n\t// function below, as well\n\n\t// Implementation from reference [1]\n\t// stretch view\n\tvec3 V = normalize( vec3( roughnessX * incidentDir.x, roughnessY * incidentDir.y, incidentDir.z ) );\n\n\t// orthonormal basis\n\tvec3 T1 = ( V.z < 0.9999 ) ? normalize( cross( V, vec3( 0.0, 0.0, 1.0 ) ) ) : vec3( 1.0, 0.0, 0.0 );\n\tvec3 T2 = cross( T1, V );\n\n\t// sample point with polar coordinates (r, phi)\n\tfloat a = 1.0 / ( 1.0 + V.z );\n\tfloat r = sqrt( random1 );\n\tfloat phi = ( random2 < a ) ? random2 / a * PI : PI + ( random2 - a ) / ( 1.0 - a ) * PI;\n\tfloat P1 = r * cos( phi );\n\tfloat P2 = r * sin( phi ) * ( ( random2 < a ) ? 1.0 : V.z );\n\n\t// compute normal\n\tvec3 N = P1 * T1 + P2 * T2 + V * sqrt( max( 0.0, 1.0 - P1 * P1 - P2 * P2 ) );\n\n\t// unstretch\n\tN = normalize( vec3( roughnessX * N.x, roughnessY * N.y, max( 0.0, N.z ) ) );\n\n\treturn N;\n\n}\n\n// Below are PDF and related functions for use in a Monte Carlo path tracer\n// as specified in Appendix B of the following paper\n// See equation (34) from reference [0]\nfloat ggxLamda( float theta, float roughness ) {\n\n\tfloat tanTheta = tan( theta );\n\tfloat tanTheta2 = tanTheta * tanTheta;\n\tfloat alpha2 = roughness * roughness;\n\n\tfloat numerator = - 1.0 + sqrt( 1.0 + alpha2 * tanTheta2 );\n\treturn numerator / 2.0;\n\n}\n\n// See equation (34) from reference [0]\nfloat ggxShadowMaskG1( float theta, float roughness ) {\n\n\treturn 1.0 / ( 1.0 + ggxLamda( theta, roughness ) );\n\n}\n\n// See equation (125) from reference [4]\nfloat ggxShadowMaskG2( vec3 wi, vec3 wo, float roughness ) {\n\n\tfloat incidentTheta = acos( wi.z );\n\tfloat scatterTheta = acos( wo.z );\n\treturn 1.0 / ( 1.0 + ggxLamda( incidentTheta, roughness ) + ggxLamda( scatterTheta, roughness ) );\n\n}\n\n// See equation (33) from reference [0]\nfloat ggxDistribution( vec3 halfVector, float roughness ) {\n\n\tfloat a2 = roughness * roughness;\n\ta2 = max( EPSILON, a2 );\n\tfloat cosTheta = halfVector.z;\n\tfloat cosTheta4 = pow( cosTheta, 4.0 );\n\n\tif ( cosTheta == 0.0 ) return 0.0;\n\n\tfloat theta = acosSafe( halfVector.z );\n\tfloat tanTheta = tan( theta );\n\tfloat tanTheta2 = pow( tanTheta, 2.0 );\n\n\tfloat denom = PI * cosTheta4 * pow( a2 + tanTheta2, 2.0 );\n\treturn ( a2 / denom );\n\n}\n\n// See equation (3) from reference [2]\nfloat ggxPDF( vec3 wi, vec3 halfVector, float roughness ) {\n\n\tfloat incidentTheta = acos( wi.z );\n\tfloat D = ggxDistribution( halfVector, roughness );\n\tfloat G1 = ggxShadowMaskG1( incidentTheta, roughness );\n\n\treturn D * G1 * max( 0.0, dot( wi, halfVector ) ) / wi.z;\n\n}\n",$3072b6fdbbd19c0b$export$300995c3bffdc4dd="\n\n// See equation (2) in http://www.aconty.com/pdf/s2017_pbs_imageworks_sheen.pdf\nfloat velvetD( float cosThetaH, float roughness ) {\n\n\tfloat alpha = max( roughness, 0.07 );\n\talpha = alpha * alpha;\n\n\tfloat invAlpha = 1.0 / alpha;\n\n\tfloat sqrCosThetaH = cosThetaH * cosThetaH;\n\tfloat sinThetaH = max( 1.0 - sqrCosThetaH, 0.001 );\n\n\treturn ( 2.0 + invAlpha ) * pow( sinThetaH, 0.5 * invAlpha ) / ( 2.0 * PI );\n\n}\n\nfloat velvetParamsInterpolate( int i, float oneMinusAlphaSquared ) {\n\n\tconst float p0[5] = float[5]( 25.3245, 3.32435, 0.16801, -1.27393, -4.85967 );\n\tconst float p1[5] = float[5]( 21.5473, 3.82987, 0.19823, -1.97760, -4.32054 );\n\n\treturn mix( p1[i], p0[i], oneMinusAlphaSquared );\n\n}\n\nfloat velvetL( float x, float alpha ) {\n\n\tfloat oneMinusAlpha = 1.0 - alpha;\n\tfloat oneMinusAlphaSquared = oneMinusAlpha * oneMinusAlpha;\n\n\tfloat a = velvetParamsInterpolate( 0, oneMinusAlphaSquared );\n\tfloat b = velvetParamsInterpolate( 1, oneMinusAlphaSquared );\n\tfloat c = velvetParamsInterpolate( 2, oneMinusAlphaSquared );\n\tfloat d = velvetParamsInterpolate( 3, oneMinusAlphaSquared );\n\tfloat e = velvetParamsInterpolate( 4, oneMinusAlphaSquared );\n\n\treturn a / ( 1.0 + b * pow( abs( x ), c ) ) + d * x + e;\n\n}\n\n// See equation (3) in http://www.aconty.com/pdf/s2017_pbs_imageworks_sheen.pdf\nfloat velvetLambda( float cosTheta, float alpha ) {\n\n\treturn abs( cosTheta ) < 0.5 ? exp( velvetL( cosTheta, alpha ) ) : exp( 2.0 * velvetL( 0.5, alpha ) - velvetL( 1.0 - cosTheta, alpha ) );\n\n}\n\n// See Section 3, Shadowing Term, in http://www.aconty.com/pdf/s2017_pbs_imageworks_sheen.pdf\nfloat velvetG( float cosThetaO, float cosThetaI, float roughness ) {\n\n\tfloat alpha = max( roughness, 0.07 );\n\talpha = alpha * alpha;\n\n\treturn 1.0 / ( 1.0 + velvetLambda( cosThetaO, alpha ) + velvetLambda( cosThetaI, alpha ) );\n\n}\n\nfloat directionalAlbedoSheen( float cosTheta, float alpha ) {\n\n\tcosTheta = saturate( cosTheta );\n\n\tfloat c = 1.0 - cosTheta;\n\tfloat c3 = c * c * c;\n\n\treturn 0.65584461 * c3 + 1.0 / ( 4.16526551 + exp( -7.97291361 * sqrt( alpha ) + 6.33516894 ) );\n\n}\n\nfloat sheenAlbedoScaling( vec3 wo, vec3 wi, SurfaceRec surf ) {\n\n\tfloat alpha = max( surf.sheenRoughness, 0.07 );\n\talpha = alpha * alpha;\n\n\tfloat maxSheenColor = max( max( surf.sheenColor.r, surf.sheenColor.g ), surf.sheenColor.b );\n\n\tfloat eWo = directionalAlbedoSheen( saturateCos( wo.z ), alpha );\n\tfloat eWi = directionalAlbedoSheen( saturateCos( wi.z ), alpha );\n\n\treturn min( 1.0 - maxSheenColor * eWo, 1.0 - maxSheenColor * eWi );\n\n}\n\n// See Section 5, Layering, in http://www.aconty.com/pdf/s2017_pbs_imageworks_sheen.pdf\nfloat sheenAlbedoScaling( vec3 wo, SurfaceRec surf ) {\n\n\tfloat alpha = max( surf.sheenRoughness, 0.07 );\n\talpha = alpha * alpha;\n\n\tfloat maxSheenColor = max( max( surf.sheenColor.r, surf.sheenColor.g ), surf.sheenColor.b );\n\n\tfloat eWo = directionalAlbedoSheen( saturateCos( wo.z ), alpha );\n\n\treturn 1.0 - maxSheenColor * eWo;\n\n}\n\n",$54cd8bd7b32bfb02$export$edc525d01b11600f="\n\n// XYZ to sRGB color space\nconst mat3 XYZ_TO_REC709 = mat3(\n\t 3.2404542, -0.9692660,  0.0556434,\n\t-1.5371385,  1.8760108, -0.2040259,\n\t-0.4985314,  0.0415560,  1.0572252\n);\n\nvec3 fresnel0ToIor( vec3 fresnel0 ) {\n\n\tvec3 sqrtF0 = sqrt( fresnel0 );\n\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\n}\n\n// Conversion FO/IOR\nvec3 iorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\n\treturn square( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\n}\n\n// ior is a value between 1.0 and 3.0. 1.0 is air interface\nfloat iorToFresnel0( float transmittedIor, float incidentIor ) {\n\n\treturn square( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ) );\n\n}\n\n// Fresnel equations for dielectric/dielectric interfaces. See https://belcour.github.io/blog/research/2017/05/01/brdf-thin-film.html\nvec3 evalSensitivity( float OPD, vec3 shift ) {\n\n\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\n\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\n\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - square( phase ) * var );\n\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * square( phase ) );\n\txyz /= 1.0685e-7;\n\n\tvec3 srgb = XYZ_TO_REC709 * xyz;\n\treturn srgb;\n\n}\n\n// See Section 4. Analytic Spectral Integration, A Practical Extension to Microfacet Theory for the Modeling of Varying Iridescence, https://hal.archives-ouvertes.fr/hal-01518344/document\nvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\n\tvec3 I;\n\n\t// Force iridescenceIor -> outsideIOR when thinFilmThickness -> 0.0\n\tfloat iridescenceIor = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\n\t// Evaluate the cosTheta on the base layer (Snell law)\n\tfloat sinTheta2Sq = square( outsideIOR / iridescenceIor ) * ( 1.0 - square( cosTheta1 ) );\n\n\t// Handle TIR:\n\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\tif ( cosTheta2Sq < 0.0 ) {\n\n\t\treturn vec3( 1.0 );\n\n\t}\n\n\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\n\t// First interface\n\tfloat R0 = iorToFresnel0( iridescenceIor, outsideIOR );\n\tfloat R12 = schlickFresnel( cosTheta1, R0 );\n\tfloat R21 = R12;\n\tfloat T121 = 1.0 - R12;\n\tfloat phi12 = 0.0;\n\tif ( iridescenceIor < outsideIOR ) {\n\n\t\tphi12 = PI;\n\n\t}\n\tfloat phi21 = PI - phi12;\n\n\t// Second interface\n\tvec3 baseIOR = fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) ); // guard against 1.0\n\tvec3 R1 = iorToFresnel0( baseIOR, iridescenceIor );\n\tvec3 R23 = schlickFresnel( cosTheta2, R1 );\n\tvec3 phi23 = vec3( 0.0 );\n\tif ( baseIOR[0] < iridescenceIor ) {\n\n\t\tphi23[ 0 ] = PI;\n\n\t}\n\tif ( baseIOR[1] < iridescenceIor ) {\n\n\t\tphi23[ 1 ] = PI;\n\n\t}\n\tif ( baseIOR[2] < iridescenceIor ) {\n\n\t\tphi23[ 2 ] = PI;\n\n\t}\n\n\t// Phase shift\n\tfloat OPD = 2.0 * iridescenceIor * thinFilmThickness * cosTheta2;\n\tvec3 phi = vec3( phi21 ) + phi23;\n\n\t// Compound terms\n\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\tvec3 r123 = sqrt( R123 );\n\tvec3 Rs = square( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\n\t// Reflectance term for m = 0 (DC term amplitude)\n\tvec3 C0 = R12 + Rs;\n\tI = C0;\n\n\t// Reflectance term for m > 0 (pairs of diracs)\n\tvec3 Cm = Rs - T121;\n\tfor ( int m = 1; m <= 2; ++ m )\n\t{\n\t\tCm *= r123;\n\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\tI += Cm * Sm;\n\t}\n\n\t// Since out of gamut colors might be produced, negative color values are clamped to 0.\n\treturn max( I, vec3( 0.0 ) );\n}\n\n",$cf7c94388ac486fb$export$aba3482f45fc2e55=`\n\nstruct SurfaceRec {\n\tvec3 normal;\n\tvec3 faceNormal;\n\tbool frontFace;\n\tfloat roughness;\n\tfloat filteredRoughness;\n\tfloat metalness;\n\tvec3 color;\n\tvec3 emission;\n\tfloat transmission;\n\tbool thinFilm;\n\tfloat ior;\n\tfloat iorRatio;\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n\tfloat filteredClearcoatRoughness;\n\tvec3 sheenColor;\n\tfloat sheenRoughness;\n\tfloat iridescence;\n\tfloat iridescenceIor;\n\tfloat iridescenceThickness;\n\tvec3 specularColor;\n\tfloat specularIntensity;\n\tvec3 attenuationColor;\n\tfloat attenuationDistance;\n};\n\nstruct SampleRec {\n\tfloat specularPdf;\n\tfloat pdf;\n\tvec3 direction;\n\tvec3 clearcoatDirection;\n\tvec3 color;\n};\n\n${$2a5f3cf340e7c2d3$export$75d2a701aae03ef9}\n${$3072b6fdbbd19c0b$export$300995c3bffdc4dd}\n${$54cd8bd7b32bfb02$export$edc525d01b11600f}\n\n// diffuse\nfloat diffusePDF( vec3 wo, vec3 wi, SurfaceRec surf ) {\n\n\t// https://raytracing.github.io/books/RayTracingTheRestOfYourLife.html#lightscattering/thescatteringpdf\n\tfloat cosValue = wi.z;\n\treturn cosValue / PI;\n\n}\n\nvec3 diffuseDirection( vec3 wo, SurfaceRec surf ) {\n\n\tvec3 lightDirection = randDirection();\n\tlightDirection.z += 1.0;\n\tlightDirection = normalize( lightDirection );\n\n\treturn lightDirection;\n\n}\n\nvec3 diffuseColor( vec3 wo, vec3 wi, SurfaceRec surf ) {\n\n\t// TODO: scale by 1 - F here\n\t// note on division by PI\n\t// https://seblagarde.wordpress.com/2012/01/08/pi-or-not-to-pi-in-game-lighting-equation/\n\tfloat metalFactor = ( 1.0 - surf.metalness );\n\treturn surf.color * metalFactor * wi.z / PI;\n\n}\n\n// specular\nfloat specularPDF( vec3 wo, vec3 wi, SurfaceRec surf ) {\n\n\t// See 14.1.1 Microfacet BxDFs in https://www.pbr-book.org/\n\tfloat filteredRoughness = surf.filteredRoughness;\n\tvec3 halfVector = getHalfVector( wi, wo );\n\n\tfloat incidentTheta = acos( wo.z );\n\tfloat D = ggxDistribution( halfVector, filteredRoughness );\n\tfloat G1 = ggxShadowMaskG1( incidentTheta, filteredRoughness );\n\tfloat ggxPdf = D * G1 * max( 0.0, abs( dot( wo, halfVector ) ) ) / abs ( wo.z );\n\treturn ggxPdf / ( 4.0 * dot( wo, halfVector ) );\n\n}\n\nvec3 specularDirection( vec3 wo, SurfaceRec surf ) {\n\n\t// sample ggx vndf distribution which gives a new normal\n\tfloat filteredRoughness = surf.filteredRoughness;\n\tvec3 halfVector = ggxDirection(\n\t\two,\n\t\tfilteredRoughness,\n\t\tfilteredRoughness,\n\t\trand(),\n\t\trand()\n\t);\n\n\t// apply to new ray by reflecting off the new normal\n\treturn - reflect( wo, halfVector );\n\n}\n\nvec3 specularColor( vec3 wo, vec3 wi, SurfaceRec surf ) {\n\n\t// if roughness is set to 0 then D === NaN which results in black pixels\n\tfloat metalness = surf.metalness;\n\tfloat filteredRoughness = surf.filteredRoughness;\n\n\tvec3 halfVector = getHalfVector( wo, wi );\n\tfloat iorRatio = surf.iorRatio;\n\tfloat G = ggxShadowMaskG2( wi, wo, filteredRoughness );\n\tfloat D = ggxDistribution( halfVector, filteredRoughness );\n\n\tfloat f0 = iorRatioToF0( iorRatio );\n\tvec3 F = vec3( schlickFresnel( dot( wi, halfVector ), f0 ) );\n\n\tfloat cosTheta = min( wo.z, 1.0 );\n\tfloat sinTheta = sqrt( 1.0 - cosTheta * cosTheta );\n\tbool cannotRefract = iorRatio * sinTheta > 1.0;\n\tif ( cannotRefract ) {\n\n\t\tF = vec3( 1.0 );\n\n\t}\n\n\tvec3 iridescenceFresnel = evalIridescence( 1.0, surf.iridescenceIor, dot( wi, halfVector ), surf.iridescenceThickness, vec3( f0 ) );\n\tvec3 metalF = mix( F, iridescenceFresnel, surf.iridescence );\n\tvec3 dialectricF = F * surf.specularIntensity;\n\tF = mix( dialectricF, metalF, metalness );\n\n\tvec3 color = mix( surf.specularColor, surf.color, metalness );\n\tcolor = mix( color, vec3( 1.0 ), F );\n\tcolor *= G * D / ( 4.0 * abs( wi.z * wo.z ) );\n\tcolor *= mix( F, vec3( 1.0 ), metalness );\n\tcolor *= wi.z; // scale the light by the direction the light is coming in from\n\n\treturn color;\n\n}\n\n/*\n// transmission\nfunction transmissionPDF( wo, wi, material, surf ) {\n\n\t// See section 4.2 in https://www.cs.cornell.edu/~srm/publications/EGSR07-btdf.pdf\n\n\tconst { roughness, ior } = material;\n\tconst { frontFace } = hit;\n\tconst ratio = frontFace ? ior : 1 / ior;\n\tconst minRoughness = Math.max( roughness, MIN_ROUGHNESS );\n\n\thalfVector.set( 0, 0, 0 ).addScaledVector( wi, ratio ).addScaledVector( wo, 1.0 ).normalize().multiplyScalar( - 1 );\n\n\tconst denom = Math.pow( ratio * halfVector.dot( wi ) + 1.0 * halfVector.dot( wo ), 2.0 );\n\treturn ggxPDF( wo, halfVector, minRoughness ) / denom;\n\n}\n\nfunction transmissionDirection( wo, hit, material, lightDirection ) {\n\n\tconst { roughness, ior } = material;\n\tconst { frontFace } = hit;\n\tconst ratio = frontFace ? 1 / ior : ior;\n\tconst minRoughness = Math.max( roughness, MIN_ROUGHNESS );\n\n\t// sample ggx vndf distribution which gives a new normal\n\tggxDirection(\n\t\two,\n\t\tminRoughness,\n\t\tminRoughness,\n\t\tMath.random(),\n\t\tMath.random(),\n\t\thalfVector,\n\t);\n\n\t// apply to new ray by reflecting off the new normal\n\ttempDir.copy( wo ).multiplyScalar( - 1 );\n\trefract( tempDir, halfVector, ratio, lightDirection );\n\n}\n\nfunction transmissionColor( wo, wi, material, hit, colorTarget ) {\n\n\tconst { metalness, transmission } = material;\n\tcolorTarget\n\t\t.copy( material.color )\n\t\t.multiplyScalar( ( 1.0 - metalness ) * wo.z )\n\t\t.multiplyScalar( transmission );\n\n}\n*/\n\n// TODO: This is just using a basic cosine-weighted specular distribution with an\n// incorrect PDF value at the moment. Update it to correctly use a GGX distribution\nfloat transmissionPDF( vec3 wo, vec3 wi, SurfaceRec surf ) {\n\n\tfloat iorRatio = surf.iorRatio;\n\tfloat cosTheta = min( wo.z, 1.0 );\n\tfloat sinTheta = sqrt( 1.0 - cosTheta * cosTheta );\n\tfloat reflectance = schlickFresnelFromIor( cosTheta, iorRatio );\n\tbool cannotRefract = iorRatio * sinTheta > 1.0;\n\tif ( cannotRefract ) {\n\n\t\treturn 0.0;\n\n\t}\n\n\treturn 1.0 / ( 1.0 - reflectance );\n\n}\n\nvec3 transmissionDirection( vec3 wo, SurfaceRec surf ) {\n\n\tfloat roughness = surf.roughness;\n\tfloat iorRatio = surf.iorRatio;\n\n\tvec3 halfVector = normalize( vec3( 0.0, 0.0, 1.0 ) + randDirection() * roughness );\n\tvec3 lightDirection = refract( normalize( - wo ), halfVector, iorRatio );\n\n\tif ( surf.thinFilm ) {\n\n\t\tlightDirection = - refract( normalize( - lightDirection ), - vec3( 0.0, 0.0, 1.0 ), 1.0 / iorRatio );\n\n\t}\n\treturn normalize( lightDirection );\n\n}\n\nvec3 transmissionColor( vec3 wo, vec3 wi, SurfaceRec surf ) {\n\n\t// only attenuate the color if it's on the way in\n\tvec3 col = surf.thinFilm || surf.frontFace ? surf.color : vec3( 1.0 );\n\treturn surf.transmission * col;\n\n}\n\n// clearcoat\nfloat clearcoatPDF( vec3 wo, vec3 wi, SurfaceRec surf ) {\n\n\t// See equation (27) in http://jcgt.org/published/0003/02/03/\n\tfloat filteredClearcoatRoughness = surf.filteredClearcoatRoughness;\n\tvec3 halfVector = getHalfVector( wi, wo );\n\treturn ggxPDF( wo, halfVector, filteredClearcoatRoughness ) / ( 4.0 * dot( wi, halfVector ) );\n\n}\n\nvec3 clearcoatDirection( vec3 wo, SurfaceRec surf ) {\n\n\t// sample ggx vndf distribution which gives a new normal\n\tfloat filteredClearcoatRoughness = surf.filteredClearcoatRoughness;\n\tvec3 halfVector = ggxDirection(\n\t\two,\n\t\tfilteredClearcoatRoughness,\n\t\tfilteredClearcoatRoughness,\n\t\trand(),\n\t\trand()\n\t);\n\n\t// apply to new ray by reflecting off the new normal\n\treturn - reflect( wo, halfVector );\n\n}\n\nvoid clearcoatColor( inout vec3 color, vec3 wo, vec3 wi, SurfaceRec surf ) {\n\n\tfloat ior = 1.5;\n\tbool frontFace = surf.frontFace;\n\tfloat filteredClearcoatRoughness = surf.filteredClearcoatRoughness;\n\n\tvec3 halfVector = getHalfVector( wo, wi );\n\tfloat iorRatio = frontFace ? 1.0 / ior : ior;\n\tfloat G = ggxShadowMaskG2( wi, wo, filteredClearcoatRoughness );\n\tfloat D = ggxDistribution( halfVector, filteredClearcoatRoughness );\n\n\tfloat F = schlickFresnelFromIor( dot( wi, halfVector ), ior );\n\tfloat cosTheta = min( wo.z, 1.0 );\n\tfloat sinTheta = sqrt( 1.0 - cosTheta * cosTheta );\n\tbool cannotRefract = iorRatio * sinTheta > 1.0;\n\tif ( cannotRefract ) {\n\n\t\tF = 1.0;\n\n\t}\n\n\tfloat fClearcoat = F * D * G / ( 4.0 * abs( wi.z * wo.z ) );\n\n\tcolor = color * ( 1.0 - surf.clearcoat * F ) + fClearcoat * surf.clearcoat * wi.z;\n\n}\n\n// sheen\nvec3 sheenColor( vec3 wo, vec3 wi, SurfaceRec surf ) {\n\n\tvec3 halfVector = getHalfVector( wo, wi );\n\n\tfloat cosThetaO = saturateCos( wo.z );\n\tfloat cosThetaI = saturateCos( wi.z );\n\tfloat cosThetaH = halfVector.z;\n\n\tfloat D = velvetD( cosThetaH, surf.sheenRoughness );\n\tfloat G = velvetG( cosThetaO, cosThetaI, surf.sheenRoughness );\n\n\t// See equation (1) in http://www.aconty.com/pdf/s2017_pbs_imageworks_sheen.pdf\n\tvec3 color = surf.sheenColor;\n\tcolor *= D * G / ( 4.0 * abs( cosThetaO * cosThetaI ) );\n\tcolor *= wi.z;\n\n\treturn color;\n\n}\n\n// bsdf\nvoid getLobeWeights( vec3 wo, vec3 clearcoatWo, SurfaceRec surf, out float diffuseWeight, out float specularWeight, out float transmissionWeight, out float clearcoatWeight ) {\n\n\tfloat metalness = surf.metalness;\n\tfloat transmission = surf.transmission;\n\n\t// TODO: we should compute a half vector ahead of time and pass it into the sampling functions\n\t// so all functions will use the same half vector\n\tfloat iorRatio = surf.iorRatio;\n\tfloat cosTheta = min( wo.z, 1.0 );\n\tfloat sinTheta = sqrt( 1.0 - cosTheta * cosTheta );\n\tfloat reflectance = schlickFresnelFromIor( cosTheta, iorRatio );\n\tbool cannotRefract = iorRatio * sinTheta > 1.0;\n\tif ( cannotRefract ) {\n\n\t\treflectance = 1.0;\n\n\t}\n\n\tfloat transSpecularProb = mix( reflectance, 1.0, metalness );\n\tfloat diffSpecularProb = 0.5 + 0.5 * metalness;\n\n\tclearcoatWeight = surf.clearcoat * schlickFresnel( clearcoatWo.z, 0.04 );\n\tdiffuseWeight = ( 1.0 - transmission ) * ( 1.0 - diffSpecularProb ) * ( 1.0 - clearcoatWeight );\n\tspecularWeight = transmission * transSpecularProb + ( 1.0 - transmission ) * diffSpecularProb * ( 1.0 - clearcoatWeight );\n\ttransmissionWeight = transmission * ( 1.0 - transSpecularProb ) * ( 1.0 - clearcoatWeight );\n\n\tfloat totalWeight = diffuseWeight + specularWeight + transmissionWeight + clearcoatWeight;\n\tdiffuseWeight /= totalWeight;\n\tspecularWeight /= totalWeight;\n\ttransmissionWeight /= totalWeight;\n\tclearcoatWeight /= totalWeight;\n\n}\n\nfloat bsdfPdf( vec3 wo, vec3 clearcoatWo, vec3 wi, vec3 clearcoatWi, SurfaceRec surf, out float specularPdf, float diffuseWeight, float specularWeight, float transmissionWeight, float clearcoatWeight ) {\n\n\tfloat metalness = surf.metalness;\n\tfloat transmission = surf.transmission;\n\n\tfloat iorRatio = surf.iorRatio;\n\tfloat cosTheta = min( wo.z, 1.0 );\n\tfloat sinTheta = sqrt( 1.0 - cosTheta * cosTheta );\n\tfloat reflectance = schlickFresnelFromIor( cosTheta, iorRatio );\n\tbool cannotRefract = iorRatio * sinTheta > 1.0;\n\tif ( cannotRefract ) {\n\n\t\treflectance = 1.0;\n\n\t}\n\n\tfloat spdf = 0.0;\n\tfloat dpdf = 0.0;\n\tfloat tpdf = 0.0;\n\tfloat cpdf = 0.0;\n\n\tif ( wi.z < 0.0 ) {\n\n\t\tif( transmissionWeight > 0.0 ) {\n\n\t\t\ttpdf = transmissionPDF( wo, wi, surf );\n\n\t\t}\n\n\t} else {\n\n\t\tif( diffuseWeight > 0.0 ) {\n\n\t\t\tdpdf = diffusePDF( wo, wi, surf );\n\n\t\t}\n\n\t\tif( specularWeight > 0.0 ) {\n\n\t\t\tspdf = specularPDF( wo, wi, surf );\n\n\t\t}\n\n\t}\n\n\tif( clearcoatWi.z >= 0.0 && clearcoatWeight > 0.0 ) {\n\n\t\tcpdf = clearcoatPDF( clearcoatWo, clearcoatWi, surf );\n\n\t}\n\n\tfloat pdf =\n\t\t  dpdf * diffuseWeight\n\t\t+ spdf * specularWeight\n\t\t+ tpdf * transmissionWeight\n\t\t+ cpdf * clearcoatWeight;\n\n\t// retrieve specular rays for the shadows flag\n\tspecularPdf = spdf * specularWeight + cpdf * clearcoatWeight;\n\n\treturn pdf;\n\n}\n\nvec3 bsdfColor( vec3 wo, vec3 clearcoatWo, vec3 wi, vec3 clearcoatWi, SurfaceRec surf, float diffuseWeight, float specularWeight, float transmissionWeight, float clearcoatWeight ) {\n\n\tvec3 color = vec3( 0.0 );\n\tif ( wi.z < 0.0 ) {\n\n\t\tif( transmissionWeight > 0.0 ) {\n\n\t\t\tcolor = transmissionColor( wo, wi, surf );\n\n\t\t}\n\n\t} else {\n\n\t\tif( diffuseWeight > 0.0 ) {\n\n\t\t\tcolor = diffuseColor( wo, wi, surf );\n\t\t\tcolor *= 1.0 - surf.transmission;\n\n\t\t}\n\n\t\tif( specularWeight > 0.0 ) {\n\n\t\t\tcolor += specularColor( wo, wi, surf );\n\n\t\t}\n\n\t\tcolor *= sheenAlbedoScaling( wo, wi, surf );\n\t\tcolor += sheenColor( wo, wi, surf );\n\n\t}\n\n\tif( clearcoatWi.z >= 0.0 && clearcoatWeight > 0.0 ) {\n\n\t\tclearcoatColor( color, clearcoatWo, clearcoatWi, surf );\n\n\t}\n\n\treturn color;\n\n}\n\nfloat bsdfResult( vec3 wo, vec3 clearcoatWo, vec3 wi, vec3 clearcoatWi, SurfaceRec surf, out vec3 color ) {\n\n\tfloat diffuseWeight;\n\tfloat specularWeight;\n\tfloat transmissionWeight;\n\tfloat clearcoatWeight;\n\tgetLobeWeights( wo, clearcoatWo, surf, diffuseWeight, specularWeight, transmissionWeight, clearcoatWeight );\n\n\tfloat specularPdf;\n\tcolor = bsdfColor( wo, clearcoatWo, wi, clearcoatWi, surf, diffuseWeight, specularWeight, transmissionWeight, clearcoatWeight );\n\treturn bsdfPdf( wo, clearcoatWo, wi, clearcoatWi, surf, specularPdf, diffuseWeight, specularWeight, transmissionWeight, clearcoatWeight );\n\n}\n\nSampleRec bsdfSample( vec3 wo, vec3 clearcoatWo, mat3 normalBasis, mat3 invBasis, mat3 clearcoatNormalBasis, mat3 clearcoatInvBasis, SurfaceRec surf ) {\n\n\tfloat diffuseWeight;\n\tfloat specularWeight;\n\tfloat transmissionWeight;\n\tfloat clearcoatWeight;\n\tgetLobeWeights( wo, clearcoatWo, surf, diffuseWeight, specularWeight, transmissionWeight, clearcoatWeight );\n\n\tfloat pdf[4];\n\tpdf[0] = diffuseWeight;\n\tpdf[1] = specularWeight;\n\tpdf[2] = transmissionWeight;\n\tpdf[3] = clearcoatWeight;\n\n\tfloat cdf[4];\n\tcdf[0] = pdf[0];\n\tcdf[1] = pdf[1] + cdf[0];\n\tcdf[2] = pdf[2] + cdf[1];\n\tcdf[3] = pdf[3] + cdf[2];\n\n\tif( cdf[3] != 0.0 ) {\n\n\t\tfloat invMaxCdf = 1.0 / cdf[3];\n\t\tcdf[0] *= invMaxCdf;\n\t\tcdf[1] *= invMaxCdf;\n\t\tcdf[2] *= invMaxCdf;\n\t\tcdf[3] *= invMaxCdf;\n\n\t} else {\n\n\t\tcdf[0] = 1.0;\n\t\tcdf[1] = 0.0;\n\t\tcdf[2] = 0.0;\n\t\tcdf[3] = 0.0;\n\n\t}\n\n\tvec3 wi;\n\tvec3 clearcoatWi;\n\n\tfloat r = rand();\n\tif ( r <= cdf[0] ) { // diffuse\n\n\t\twi = diffuseDirection( wo, surf );\n\t\tclearcoatWi = normalize( clearcoatInvBasis * normalize( normalBasis * wi ) );\n\n\t} else if ( r <= cdf[1] ) { // specular\n\n\t\twi = specularDirection( wo, surf );\n\t\tclearcoatWi = normalize( clearcoatInvBasis * normalize( normalBasis * wi ) );\n\n\t} else if ( r <= cdf[2] ) { // transmission / refraction\n\n\t\twi = transmissionDirection( wo, surf );\n\t\tclearcoatWi = normalize( clearcoatInvBasis * normalize( normalBasis * wi ) );\n\n\t} else if ( r <= cdf[3] ) { // clearcoat\n\n\t\tclearcoatWi = clearcoatDirection( clearcoatWo, surf );\n\t\twi = normalize( invBasis * normalize( clearcoatNormalBasis * clearcoatWi ) );\n\n\t}\n\n\tSampleRec result;\n\tresult.pdf = bsdfPdf( wo, clearcoatWo, wi, clearcoatWi, surf, result.specularPdf, diffuseWeight, specularWeight, transmissionWeight, clearcoatWeight );\n\tresult.color = bsdfColor( wo, clearcoatWo, wi, clearcoatWi, surf, diffuseWeight, specularWeight, transmissionWeight, clearcoatWeight );\n\tresult.direction = wi;\n\tresult.clearcoatDirection = clearcoatWi;\n\n\treturn result;\n\n}\n`,$99a046e0a34b3c61$export$c4e96847515c3dca="\n\nvec3 sampleEquirectEnvMapColor( vec3 direction, sampler2D map ) {\n\n\treturn texture2D( map, equirectDirectionToUv( direction ) ).rgb;\n\n}\n\nfloat envMapDirectionPdf( vec3 direction ) {\n\n\tvec2 uv = equirectDirectionToUv( direction );\n\tfloat theta = uv.y * PI;\n\tfloat sinTheta = sin( theta );\n\tif ( sinTheta == 0.0 ) {\n\n\t\treturn 0.0;\n\n\t}\n\n\treturn 1.0 / ( 2.0 * PI * PI * sinTheta );\n\n}\n\nfloat envMapSample( vec3 direction, EquirectHdrInfo info, out vec3 color ) {\n\n\tvec2 uv = equirectDirectionToUv( direction );\n\tcolor = texture2D( info.map, uv ).rgb;\n\n\tfloat totalSum = info.totalSumWhole + info.totalSumDecimal;\n\tfloat lum = colorToLuminance( color );\n\tivec2 resolution = textureSize( info.map, 0 );\n\tfloat pdf = lum / totalSum;\n\n\treturn float( resolution.x * resolution.y ) * pdf * envMapDirectionPdf( direction );\n\n}\n\nfloat randomEnvMapSample( EquirectHdrInfo info, out vec3 color, out vec3 direction ) {\n\n\t// sample env map cdf\n\tvec2 r = rand2();\n\tfloat v = texture2D( info.marginalWeights, vec2( r.x, 0.0 ) ).x;\n\tfloat u = texture2D( info.conditionalWeights, vec2( r.y, v ) ).x;\n\tvec2 uv = vec2( u, v );\n\n\tvec3 derivedDirection = equirectUvToDirection( uv );\n\tdirection = derivedDirection;\n\tcolor = texture2D( info.map, uv ).rgb;\n\n\tfloat totalSum = info.totalSumWhole + info.totalSumDecimal;\n\tfloat lum = colorToLuminance( color );\n\tivec2 resolution = textureSize( info.map, 0 );\n\tfloat pdf = lum / totalSum;\n\n\treturn float( resolution.x * resolution.y ) * pdf * envMapDirectionPdf( direction );\n\n}\n\n",$c25bfd093d099434$export$72ea2c7ee2a3cb14="\n\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n\n}\n\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\n\t// based upon Frostbite 3 Moving to Physically-based Rendering\n\t// page 32, equation 26: E[window1]\n\t// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), EPSILON );\n\n\tif ( cutoffDistance > 0.0 ) {\n\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\n\t}\n\n\treturn distanceFalloff;\n\n}\n\nfloat getPhotometricAttenuation( sampler2DArray iesProfiles, int iesProfile, vec3 posToLight, vec3 lightDir, vec3 u, vec3 v ) {\n\n    float cosTheta = dot( posToLight, lightDir );\n    float angle = acos( cosTheta ) * ( 1.0 / PI );\n\n    return texture2D( iesProfiles, vec3( 0.0, angle, iesProfile ) ).r;\n\n}\n\nstruct LightSampleRec {\n\n\tbool hit;\n\tfloat dist;\n\tvec3 direction;\n\tfloat pdf;\n\tvec3 emission;\n\tint type;\n\n};\n\nLightSampleRec lightsClosestHit( sampler2D lights, uint lightCount, vec3 rayOrigin, vec3 rayDirection ) {\n\n\tLightSampleRec lightSampleRec;\n\tlightSampleRec.hit = false;\n\n\tuint l;\n\tfor ( l = 0u; l < lightCount; l ++ ) {\n\n\t\tLight light = readLightInfo( lights, l );\n\n\t\tvec3 u = light.u;\n\t\tvec3 v = light.v;\n\n\t\t// check for backface\n\t\tvec3 normal = normalize( cross( u, v ) );\n\t\tif ( dot( normal, rayDirection ) < 0.0 ) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tu *= 1.0 / dot( u, u );\n\t\tv *= 1.0 / dot( v, v );\n\n\t\tfloat dist;\n\n\t\tif(\n\t\t\t( light.type == RECT_AREA_LIGHT_TYPE && intersectsRectangle( light.position, normal, u, v, rayOrigin, rayDirection, dist ) ) ||\n\t\t\t( light.type == CIRC_AREA_LIGHT_TYPE && intersectsCircle( light.position, normal, u, v, rayOrigin, rayDirection, dist ) )\n\t\t) {\n\n\t\t\tif ( dist < lightSampleRec.dist || ! lightSampleRec.hit ) {\n\n\t\t\t\tfloat cosTheta = dot( rayDirection, normal );\n\n\t\t\t\tlightSampleRec.hit = true;\n\t\t\t\tlightSampleRec.dist = dist;\n\t\t\t\tlightSampleRec.pdf = ( dist * dist ) / ( light.area * cosTheta );\n\t\t\t\tlightSampleRec.emission = light.color * light.intensity;\n\t\t\t\tlightSampleRec.direction = rayDirection;\n\t\t\t\tlightSampleRec.type = light.type;\n\n\t\t\t}\n\n\t\t} else if ( light.type == SPOT_LIGHT_TYPE ) {\n\n\t\t\t// TODO: forward path tracing sampling needs to be made consistent with direct light sampling logic\n\t\t\t// float radius = light.radius;\n\t\t\t// vec3 lightNormal = normalize( cross( light.u, light.v ) );\n\t\t\t// float angle = acos( light.coneCos );\n\t\t\t// float angleTan = tan( angle );\n\t\t\t// float startDistance = radius / max( angleTan, EPSILON );\n\n\t\t\t// u = light.u / radius;\n\t\t\t// v = light.v / radius;\n\n\t\t\t// if (\n\t\t\t// \tintersectsCircle( light.position - normal * startDistance, normal, u, v, rayOrigin, rayDirection, dist ) &&\n\t\t\t// \t( dist < lightSampleRec.dist || ! lightSampleRec.hit )\n\t\t\t// ) {\n\n\t\t\t// \tfloat cosTheta = dot( rayDirection, normal );\n\t\t\t// \tfloat spotAttenuation = light.iesProfile != - 1 ?\n\t\t\t// \t\tgetPhotometricAttenuation( iesProfiles, light.iesProfile, rayDirection, normal, u, v )\n\t\t\t// \t\t: getSpotAttenuation( light.coneCos, light.penumbraCos, cosTheta );\n\n\t\t\t// \tfloat distanceAttenuation = getDistanceAttenuation( dist, light.distance, light.decay );\n\n\t\t\t// \tlightSampleRec.hit = true;\n\t\t\t// \tlightSampleRec.dist = dist;\n\t\t\t// \tlightSampleRec.direction = rayDirection;\n\t\t\t// \tlightSampleRec.emission = light.color * light.intensity * distanceAttenuation * spotAttenuation;\n\t\t\t// \tlightSampleRec.pdf = ( dist * dist ) / ( light.area * cosTheta );\n\n\t\t\t// }\n\n\t\t}\n\n\t}\n\n\treturn lightSampleRec;\n\n}\n\nLightSampleRec randomAreaLightSample( Light light, vec3 rayOrigin ) {\n\n\tLightSampleRec lightSampleRec;\n\tlightSampleRec.hit = true;\n\tlightSampleRec.type = light.type;\n\n\tlightSampleRec.emission = light.color * light.intensity;\n\n\tvec3 randomPos;\n\tif( light.type == RECT_AREA_LIGHT_TYPE ) {\n\n\t\t// rectangular area light\n\t\trandomPos = light.position + light.u * ( rand() - 0.5 ) + light.v * ( rand() - 0.5 );\n\n\t} else if( light.type == 1 ) {\n\n\t\t// circular area light\n\t\tfloat r = 0.5 * sqrt( rand() );\n\t\tfloat theta = rand() * 2.0 * PI;\n\t\tfloat x = r * cos( theta );\n\t\tfloat y = r * sin( theta );\n\n\t\trandomPos = light.position + light.u * x + light.v * y;\n\n\t}\n\n\tvec3 toLight = randomPos - rayOrigin;\n\tfloat lightDistSq = dot( toLight, toLight );\n\tlightSampleRec.dist = sqrt( lightDistSq );\n\n\tvec3 direction = toLight / lightSampleRec.dist;\n\tlightSampleRec.direction = direction;\n\n\tvec3 lightNormal = normalize( cross( light.u, light.v ) );\n\tlightSampleRec.pdf = lightDistSq / ( light.area * dot( direction, lightNormal ) );\n\n\treturn lightSampleRec;\n\n}\n\nLightSampleRec randomSpotLightSample( Light light, sampler2DArray iesProfiles, vec3 rayOrigin ) {\n\n\tfloat radius = light.radius * sqrt( rand() );\n\tfloat theta = rand() * 2.0 * PI;\n\tfloat x = radius * cos( theta );\n\tfloat y = radius * sin( theta );\n\n\tvec3 u = light.u;\n\tvec3 v = light.v;\n\tvec3 normal = normalize( cross( u, v ) );\n\n\tfloat angle = acos( light.coneCos );\n\tfloat angleTan = tan( angle );\n\tfloat startDistance = light.radius / max( angleTan, EPSILON );\n\n\tvec3 randomPos = light.position - normal * startDistance + u * x + v * y;\n\tvec3 toLight = randomPos - rayOrigin;\n\tfloat lightDistSq = dot( toLight, toLight );\n\tfloat dist = sqrt( lightDistSq );\n\n\tvec3 direction = toLight / max( dist, EPSILON );\n\tfloat cosTheta = dot( direction, normal );\n\n\tfloat spotAttenuation = light.iesProfile != - 1 ?\n\t\t  getPhotometricAttenuation( iesProfiles, light.iesProfile, direction, normal, u, v )\n\t\t: getSpotAttenuation( light.coneCos, light.penumbraCos, cosTheta );\n\n\tfloat distanceAttenuation = getDistanceAttenuation( dist, light.distance, light.decay );\n\tLightSampleRec lightSampleRec;\n\tlightSampleRec.hit = true;\n\tlightSampleRec.type = light.type;\n\tlightSampleRec.dist = dist;\n\tlightSampleRec.direction = direction;\n\tlightSampleRec.emission = light.color * light.intensity * distanceAttenuation * spotAttenuation;\n\n\t// TODO: this makes the result consistent between MIS and non MIS paths but at radius 0 the pdf is infinite\n\t// and the intensity of the light is not correct\n\tlightSampleRec.pdf = 1.0;\n\t// lightSampleRec.pdf = lightDistSq / ( light.area * cosTheta );\n\n\treturn lightSampleRec;\n\n}\n\nLightSampleRec randomLightSample( sampler2D lights, sampler2DArray iesProfiles, uint lightCount, vec3 rayOrigin ) {\n\n\t// pick a random light\n\tuint l = uint( rand() * float( lightCount ) );\n\tLight light = readLightInfo( lights, l );\n\n\tif ( light.type == SPOT_LIGHT_TYPE ) {\n\n\t\treturn randomSpotLightSample( light, iesProfiles, rayOrigin );\n\n\t} else {\n\n\t\t// sample the light\n\t\treturn randomAreaLightSample( light, rayOrigin );\n\n\t}\n\n}\n\n";var $4xklQ=parcelRequire("4xklQ");class $a5d14f85bceb1a69$export$baf85f88dacad6d5 extends $4xklQ.PerspectiveCamera{set bokehSize(e){this.fStop=this.getFocalLength()/e}get bokehSize(){return this.getFocalLength()/this.fStop}constructor(...e){super(...e),this.fStop=1.4,this.apertureBlades=0,this.apertureRotation=0,this.focusDistance=25,this.anamorphicRatio=1}}class $bbc0a4ca684807d3$export$2e27c77dea3c9d73{constructor(){this.bokehSize=0,this.apertureBlades=0,this.apertureRotation=0,this.focusDistance=10,this.anamorphicRatio=1}updateFrom(e){e instanceof $a5d14f85bceb1a69$export$baf85f88dacad6d5?(this.bokehSize=e.bokehSize,this.apertureBlades=e.apertureBlades,this.apertureRotation=e.apertureRotation,this.focusDistance=e.focusDistance,this.anamorphicRatio=e.anamorphicRatio):(this.bokehSize=0,this.apertureRotation=0,this.apertureBlades=0,this.focusDistance=10,this.anamorphicRatio=1)}}var $4xklQ=parcelRequire("4xklQ");function $57d502cd87eced98$var$binarySearchFindClosestIndexOf(e,t,i=0,r=e.length){let n=0,o=r;for(;n<o;){const r=~~(.5*o+.5*n);e[i+r]<t?n=r+1:o=r}return n}function $57d502cd87eced98$var$colorToLuminance(e,t,i){return.2126*e+.7152*t+.0722*i}function $57d502cd87eced98$var$preprocessEnvMap(e){const t=e.clone();t.source=new(0,$4xklQ.Source)({...t.image});const{width:i,height:r,data:n}=t.image;let o=n;if(t.type===$4xklQ.HalfFloatType){o=new Float32Array(n.length);for(const e in n)o[e]=$4xklQ.DataUtils.fromHalfFloat(n[e]);t.image.data=o,t.type=$4xklQ.FloatType}if(t.flipY){const e=o;o=o.slice();for(let t=0;t<r;t++)for(let n=0;n<i;n++){const a=4*(t*i+n),s=4*((r-t-1)*i+n);o[s+0]=e[a+0],o[s+1]=e[a+1],o[s+2]=e[a+2],o[s+3]=e[a+3]}t.flipY=!1,t.image.data=o}return t}class $57d502cd87eced98$export$e5a77e5d6a85a862{constructor(){const e=new(0,$4xklQ.DataTexture);e.type=$4xklQ.FloatType,e.format=$4xklQ.RedFormat,e.minFilter=$4xklQ.LinearFilter,e.magFilter=$4xklQ.LinearFilter,e.generateMipmaps=!1;const t=new(0,$4xklQ.DataTexture);t.type=$4xklQ.FloatType,t.format=$4xklQ.RedFormat,t.minFilter=$4xklQ.LinearFilter,t.magFilter=$4xklQ.LinearFilter,t.generateMipmaps=!1,this.marginalWeights=e,this.conditionalWeights=t,this.map=null,this.totalSumWhole=0,this.totalSumDecimal=0}dispose(){this.marginalWeights.dispose(),this.conditionalWeights.dispose(),this.map&&this.map.dispose()}updateFrom(e){const t=$57d502cd87eced98$var$preprocessEnvMap(e);t.wrapS=$4xklQ.RepeatWrapping,t.wrapT=$4xklQ.RepeatWrapping;const{width:i,height:r,data:n}=t.image,o=new Float32Array(i*r),a=new Float32Array(i*r),s=new Float32Array(r),l=new Float32Array(r);let c=0,h=0;for(let e=0;e<r;e++){let t=0;for(let r=0;r<i;r++){const s=e*i+r,l=$57d502cd87eced98$var$colorToLuminance(n[4*s+0],n[4*s+1],n[4*s+2]);t+=l,c+=l,o[s]=l,a[s]=t}if(0!==t)for(let r=e*i,n=e*i+i;r<n;r++)o[r]/=t,a[r]/=t;h+=t,s[e]=t,l[e]=h}if(0!==h)for(let e=0,t=s.length;e<t;e++)s[e]/=h,l[e]/=h;const d=new Float32Array(r),u=new Float32Array(i*r);for(let e=0;e<r;e++){const t=$57d502cd87eced98$var$binarySearchFindClosestIndexOf(l,(e+1)/r);d[e]=t/r}for(let e=0;e<r;e++)for(let t=0;t<i;t++){const r=e*i+t,n=$57d502cd87eced98$var$binarySearchFindClosestIndexOf(a,(t+1)/i,e*i,i);u[r]=n/i}this.dispose();const{marginalWeights:p,conditionalWeights:m}=this;p.image={width:r,height:1,data:d},p.needsUpdate=!0,m.image={width:i,height:r,data:u},m.needsUpdate=!0;const f=~~c,g=c-f;this.totalSumWhole=f,this.totalSumDecimal=g,this.map=t}}var $4xklQ=parcelRequire("4xklQ");const $2cf074fec953e79b$var$LIGHT_PIXELS=6,$2cf074fec953e79b$var$RECT_AREA_LIGHT=0,$2cf074fec953e79b$var$CIRC_AREA_LIGHT=1,$2cf074fec953e79b$var$SPOT_LIGHT=2;class $2cf074fec953e79b$export$bb02c0eb15767758{constructor(){const e=new(0,$4xklQ.DataTexture)(new Float32Array(4),1,1);e.format=$4xklQ.RGBAFormat,e.type=$4xklQ.FloatType,e.wrapS=$4xklQ.ClampToEdgeWrapping,e.wrapT=$4xklQ.ClampToEdgeWrapping,e.generateMipmaps=!1,this.tex=e,this.count=0}updateFrom(e,t=[]){const i=this.tex,r=Math.max(e.length*$2cf074fec953e79b$var$LIGHT_PIXELS,1),n=Math.ceil(Math.sqrt(r));i.image.width!==n&&(i.dispose(),i.image.data=new Float32Array(n*n*4),i.image.width=n,i.image.height=n);const o=i.image.data,a=new(0,$4xklQ.Vector3),s=new(0,$4xklQ.Vector3),l=new(0,$4xklQ.Matrix4),c=new(0,$4xklQ.Quaternion),h=new(0,$4xklQ.Vector3),d=new(0,$4xklQ.Vector3),u=new(0,$4xklQ.Vector3);for(let i=0,r=e.length;i<r;i++){const r=e[i],n=i*$2cf074fec953e79b$var$LIGHT_PIXELS*4;let p=0;r.getWorldPosition(s),o[n+p++]=s.x,o[n+p++]=s.y,o[n+p++]=s.z;let m=$2cf074fec953e79b$var$RECT_AREA_LIGHT;if(r.isRectAreaLight&&r.isCircular?m=$2cf074fec953e79b$var$CIRC_AREA_LIGHT:r.isSpotLight&&(m=$2cf074fec953e79b$var$SPOT_LIGHT),o[n+p++]=m,o[n+p++]=r.color.r,o[n+p++]=r.color.g,o[n+p++]=r.color.b,o[n+p++]=r.intensity,r.getWorldQuaternion(c),r.isRectAreaLight)a.set(r.width,0,0).applyQuaternion(c),o[n+p++]=a.x,o[n+p++]=a.y,o[n+p++]=a.z,p++,s.set(0,r.height,0).applyQuaternion(c),o[n+p++]=s.x,o[n+p++]=s.y,o[n+p++]=s.z,o[n+p++]=a.cross(s).length()*(r.isCircular?Math.PI/4:1);else if(r.isSpotLight){const e=r.radius;h.setFromMatrixPosition(r.matrixWorld),d.setFromMatrixPosition(r.target.matrixWorld),l.lookAt(h,d,u),c.setFromRotationMatrix(l),a.set(1,0,0).applyQuaternion(c),o[n+p++]=a.x,o[n+p++]=a.y,o[n+p++]=a.z,p++,s.set(0,1,0).applyQuaternion(c),o[n+p++]=s.x,o[n+p++]=s.y,o[n+p++]=s.z,o[n+p++]=Math.PI*e*e,o[n+p++]=e,o[n+p++]=r.shadow.camera.near,o[n+p++]=r.decay,o[n+p++]=r.distance,o[n+p++]=Math.cos(r.angle),o[n+p++]=Math.cos(r.angle*(1-r.penumbra)),o[n+p++]=t.indexOf(r.iesTexture)}}i.needsUpdate=!0,this.count=e.length}}var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ");function $afe8e8564a06cada$var$IESLamp(e){const t=this,i=e.split("\n");let r,n=0;function o(e){return(e=(e=(e=e.replace(/^\s+|\s+$/g,"")).replace(/,/g," ")).replace(/\s\s+/g," ")).split(" ")}function a(e,t){for(;;){const r=o(i[n++]);for(let e=0;e<r.length;++e)t.push(Number(r[e]));if(t.length===e)break}}for(t.verAngles=[],t.horAngles=[],t.candelaValues=[],t.tiltData={},t.tiltData.angles=[],t.tiltData.mulFactors=[];r=i[n++],!r.includes("TILT"););r.includes("NONE")||r.includes("INCLUDE")&&function(){let e=i[n++],r=o(e);t.tiltData.lampToLumGeometry=Number(r[0]),e=i[n++],r=o(e),t.tiltData.numAngles=Number(r[0]),a(t.tiltData.numAngles,t.tiltData.angles),a(t.tiltData.numAngles,t.tiltData.mulFactors)}(),function(){const e=[];a(10,e),t.count=Number(e[0]),t.lumens=Number(e[1]),t.multiplier=Number(e[2]),t.numVerAngles=Number(e[3]),t.numHorAngles=Number(e[4]),t.gonioType=Number(e[5]),t.units=Number(e[6]),t.width=Number(e[7]),t.length=Number(e[8]),t.height=Number(e[9])}(),function(){const e=[];a(3,e),t.ballFactor=Number(e[0]),t.blpFactor=Number(e[1]),t.inputWatts=Number(e[2])}();for(let e=0;e<t.numHorAngles;++e)t.candelaValues.push([]);a(t.numVerAngles,t.verAngles),a(t.numHorAngles,t.horAngles);for(let e=0;e<t.numHorAngles;++e)a(t.numVerAngles,t.candelaValues[e]);for(let e=0;e<t.numHorAngles;++e)for(let i=0;i<t.numVerAngles;++i)t.candelaValues[e][i]*=t.candelaValues[e][i]*t.multiplier*t.ballFactor*t.blpFactor;let s=-1;for(let e=0;e<t.numHorAngles;++e)for(let i=0;i<t.numVerAngles;++i){const r=t.candelaValues[e][i];s=s<r?r:s}if(s>0)for(let e=0;e<t.numHorAngles;++e)for(let i=0;i<t.numVerAngles;++i)t.candelaValues[e][i]/=s}class $afe8e8564a06cada$export$f1ffec369846389b extends $4xklQ.Loader{_getIESValues(e){const t=new Float32Array(64800);function i(t,i){let r=0,n=0,o=0,a=0,s=0,l=0;for(let t=0;t<e.numHorAngles-1;++t)if(i<e.horAngles[t+1]||t==e.numHorAngles-2){n=t,o=e.horAngles[t],a=e.horAngles[t+1];break}for(let i=0;i<e.numVerAngles-1;++i)if(t<e.verAngles[i+1]||i==e.numVerAngles-2){r=i,s=e.verAngles[i],l=e.verAngles[i+1];break}const c=a-o,h=l-s;if(0===h)return 0;const d=0===c?0:(i-o)/c,u=(t-s)/h,p=0===c?n:n+1,m=$4xklQ.MathUtils.lerp(e.candelaValues[n][r],e.candelaValues[p][r],d),f=$4xklQ.MathUtils.lerp(e.candelaValues[n][r+1],e.candelaValues[p][r+1],d);return $4xklQ.MathUtils.lerp(m,f,u)}const r=e.horAngles[0],n=e.horAngles[e.numHorAngles-1];for(let e=0;e<64800;++e){let o=e%360;const a=Math.floor(e/360);n-r!=0&&(o<r||o>=n)&&(o%=2*n,o>n&&(o=2*n-o)),t[e]=i(a,o)}return t}load(e,t,i,r){const n=new(0,$4xklQ.FileLoader)(this.manager);n.setResponseType("text"),n.setCrossOrigin(this.crossOrigin),n.setWithCredentials(this.withCredentials),n.setPath(this.path),n.setRequestHeader(this.requestHeader);const o=new(0,$4xklQ.DataTexture)(null,360,180,$4xklQ.RedFormat,$4xklQ.FloatType);return o.minFilter=$4xklQ.LinearFilter,o.magFilter=$4xklQ.LinearFilter,n.load(e,(e=>{const i=new $afe8e8564a06cada$var$IESLamp(e);o.image.data=this._getIESValues(i),o.needsUpdate=!0,void 0!==t&&t(o)}),i,r),o}parse(e){const t=new $afe8e8564a06cada$var$IESLamp(e),i=new(0,$4xklQ.DataTexture)(null,360,180,$4xklQ.RedFormat,$4xklQ.FloatType);return i.minFilter=$4xklQ.LinearFilter,i.magFilter=$4xklQ.LinearFilter,i.image.data=this._getIESValues(t),i.needsUpdate=!0,i}}const $e59089c295a08e20$var$prevColor=new(0,$4xklQ.Color);class $e59089c295a08e20$export$cc46c2e928f0cae0 extends $4xklQ.WebGLArrayRenderTarget{constructor(...e){super(...e);const t=this.texture;t.format=$4xklQ.RGBAFormat,t.type=$4xklQ.FloatType,t.minFilter=$4xklQ.LinearFilter,t.magFilter=$4xklQ.LinearFilter,t.wrapS=$4xklQ.ClampToEdgeWrapping,t.wrapT=$4xklQ.ClampToEdgeWrapping,t.generateMipmaps=!1,t.updateFrom=(...e)=>{this.updateFrom(...e)};const i=new $0684d9623c4c8e37$export$3983474c8e6e978b(new(0,$4xklQ.MeshBasicMaterial));this.fsQuad=i,this.iesLoader=new $afe8e8564a06cada$export$f1ffec369846389b}async updateFrom(e,t){const i=e.getRenderTarget(),r=e.toneMapping,n=e.getClearAlpha();e.getClearColor($e59089c295a08e20$var$prevColor);const o=t.length||1;this.setSize(360,180,o),e.setClearColor(0,0),e.toneMapping=$4xklQ.NoToneMapping;const a=this.fsQuad;for(let i=0,r=o;i<r;i++){const r=t[i];r&&(r.matrixAutoUpdate=!1,r.matrix.identity(),a.material.map=r,a.material.transparent=!0,e.setRenderTarget(this,i),a.render(e),r.updateMatrix(),r.matrixAutoUpdate=!0)}a.material.map=null,e.setClearColor($e59089c295a08e20$var$prevColor,n),e.setRenderTarget(i),e.toneMapping=r,a.dispose()}dispose(){super.dispose(),this.fsQuad.dispose()}}class $134dfafd06cc9b8a$export$746cbc9e65f5bcb8 extends $282727f340fc2a87$export$f1ac3a587b6cbb5d{onBeforeRender(){this.setDefine("FEATURE_DOF",0===this.physicalCamera.bokehSize?0:1)}constructor(e){super({transparent:!0,depthWrite:!1,defines:{FEATURE_MIS:1,FEATURE_DOF:1,FEATURE_GRADIENT_BG:0,TRANSPARENT_TRAVERSALS:5,CAMERA_TYPE:0},uniforms:{resolution:{value:new(0,$4xklQ.Vector2)},bounces:{value:3},physicalCamera:{value:new $bbc0a4ca684807d3$export$2e27c77dea3c9d73},bvh:{value:new(0,$kEmYZ.MeshBVHUniformStruct)},normalAttribute:{value:new(0,$jzv0I.FloatVertexAttributeTexture)},tangentAttribute:{value:new(0,$jzv0I.FloatVertexAttributeTexture)},uvAttribute:{value:new(0,$jzv0I.FloatVertexAttributeTexture)},colorAttribute:{value:new(0,$jzv0I.FloatVertexAttributeTexture)},materialIndexAttribute:{value:new(0,$jzv0I.UIntVertexAttributeTexture)},materials:{value:new $dd32143970950b7f$export$ae96f3619813ce17},textures:{value:(new $e28b7d03d182ad46$export$dbbaa51cb2d0b2f7).texture},lights:{value:new $2cf074fec953e79b$export$bb02c0eb15767758},iesProfiles:{value:(new $e59089c295a08e20$export$cc46c2e928f0cae0).texture},cameraWorldMatrix:{value:new(0,$4xklQ.Matrix4)},invProjectionMatrix:{value:new(0,$4xklQ.Matrix4)},backgroundBlur:{value:0},environmentIntensity:{value:1},environmentRotation:{value:new(0,$4xklQ.Matrix3)},envMapInfo:{value:new $57d502cd87eced98$export$e5a77e5d6a85a862},seed:{value:0},opacity:{value:1},filterGlossyFactor:{value:0},bgGradientTop:{value:new(0,$4xklQ.Color)(1118481)},bgGradientBottom:{value:new(0,$4xklQ.Color)(0)},backgroundAlpha:{value:1}},vertexShader:"\n\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec4 mvPosition = vec4( position, 1.0 );\n\t\t\t\t\tmvPosition = modelViewMatrix * mvPosition;\n\t\t\t\t\tgl_Position = projectionMatrix * mvPosition;\n\n\t\t\t\t\tvUv = uv;\n\n\t\t\t\t}\n\n\t\t\t",fragmentShader:`\n\t\t\t\t#define RAY_OFFSET 1e-4\n\n\t\t\t\tprecision highp isampler2D;\n\t\t\t\tprecision highp usampler2D;\n\t\t\t\tprecision highp sampler2DArray;\n\t\t\t\tvec4 envMapTexelToLinear( vec4 a ) { return a; }\n\t\t\t\t#include <common>\n\n\t\t\t\t${$5jaKi.shaderStructs}\n\t\t\t\t${$5jaKi.shaderIntersectFunction}\n\t\t\t\t${$de1654de00d21b4e$export$570ab67b705632a4}\n\t\t\t\t${$de1654de00d21b4e$export$2861714a2bd5835b}\n\n\t\t\t\t${$62e02ca5c2ecb453$export$207a3935c1ec5d77}\n\t\t\t\t${$cf7c94388ac486fb$export$aba3482f45fc2e55}\n\t\t\t\t${$99a046e0a34b3c61$export$c4e96847515c3dca}\n\n\t\t\t\tuniform mat3 environmentRotation;\n\t\t\t\tuniform float backgroundBlur;\n\t\t\t\tuniform float backgroundAlpha;\n\n\t\t\t\t#if FEATURE_GRADIENT_BG\n\n\t\t\t\tuniform vec3 bgGradientTop;\n\t\t\t\tuniform vec3 bgGradientBottom;\n\n\t\t\t\t#endif\n\n\t\t\t\t#if FEATURE_DOF\n\n\t\t\t\tuniform PhysicalCamera physicalCamera;\n\n\t\t\t\t#endif\n\n\t\t\t\tuniform vec2 resolution;\n\t\t\t\tuniform int bounces;\n\t\t\t\tuniform mat4 cameraWorldMatrix;\n\t\t\t\tuniform mat4 invProjectionMatrix;\n\t\t\t\tuniform sampler2D normalAttribute;\n\t\t\t\tuniform sampler2D tangentAttribute;\n\t\t\t\tuniform sampler2D uvAttribute;\n\t\t\t\tuniform sampler2D colorAttribute;\n\t\t\t\tuniform usampler2D materialIndexAttribute;\n\t\t\t\tuniform BVH bvh;\n\t\t\t\tuniform float environmentIntensity;\n\t\t\t\tuniform float filterGlossyFactor;\n\t\t\t\tuniform int seed;\n\t\t\t\tuniform float opacity;\n\t\t\t\tuniform sampler2D materials;\n\t\t\t\tuniform LightsInfo lights;\n\t\t\t\tuniform sampler2DArray iesProfiles;\n\n\t\t\t\t${$c25bfd093d099434$export$72ea2c7ee2a3cb14}\n\n\t\t\t\tuniform EquirectHdrInfo envMapInfo;\n\n\t\t\t\tuniform sampler2DArray textures;\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\tfloat applyFilteredGlossy( float roughness, float accumulatedRoughness ) {\n\n\t\t\t\t\treturn clamp(\n\t\t\t\t\t\tmax(\n\t\t\t\t\t\t\troughness,\n\t\t\t\t\t\t\taccumulatedRoughness * filterGlossyFactor * 5.0 ),\n\t\t\t\t\t\t0.0,\n\t\t\t\t\t\t1.0\n\t\t\t\t\t);\n\n\t\t\t\t}\n\n\t\t\t\tvec3 sampleBackground( vec3 direction ) {\n\n\t\t\t\t\t#if FEATURE_GRADIENT_BG\n\n\t\t\t\t\tdirection = normalize( direction + randDirection() * 0.05 );\n\n\t\t\t\t\tfloat value = ( direction.y + 1.0 ) / 2.0;\n\t\t\t\t\tvalue = pow( value, 2.0 );\n\n\t\t\t\t\treturn mix( bgGradientBottom, bgGradientTop, value );\n\n\t\t\t\t\t#else\n\n\t\t\t\t\tvec3 sampleDir = normalize( direction + getHemisphereSample( direction, rand2() ) * 0.5 * backgroundBlur );\n\t\t\t\t\treturn environmentIntensity * sampleEquirectEnvMapColor( sampleDir, envMapInfo.map );\n\n\t\t\t\t\t#endif\n\n\t\t\t\t}\n\n\t\t\t\t// step through multiple surface hits and accumulate color attenuation based on transmissive surfaces\n\t\t\t\tbool attenuateHit( BVH bvh, vec3 rayOrigin, vec3 rayDirection, int traversals, bool isShadowRay, out vec3 color ) {\n\n\t\t\t\t\t// hit results\n\t\t\t\t\tuvec4 faceIndices = uvec4( 0u );\n\t\t\t\t\tvec3 faceNormal = vec3( 0.0, 0.0, 1.0 );\n\t\t\t\t\tvec3 barycoord = vec3( 0.0 );\n\t\t\t\t\tfloat side = 1.0;\n\t\t\t\t\tfloat dist = 0.0;\n\n\t\t\t\t\tcolor = vec3( 1.0 );\n\n\t\t\t\t\tfor ( int i = 0; i < traversals; i ++ ) {\n\n\t\t\t\t\t\tif ( bvhIntersectFirstHit( bvh, rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist ) ) {\n\n\t\t\t\t\t\t\t// TODO: attenuate the contribution based on the PDF of the resulting ray including refraction values\n\t\t\t\t\t\t\t// Should be able to work using the material BSDF functions which will take into account specularity, etc.\n\t\t\t\t\t\t\t// TODO: should we account for emissive surfaces here?\n\n\t\t\t\t\t\t\tvec2 uv = textureSampleBarycoord( uvAttribute, barycoord, faceIndices.xyz ).xy;\n\t\t\t\t\t\t\tvec4 vertexColor = textureSampleBarycoord( colorAttribute, barycoord, faceIndices.xyz );\n\t\t\t\t\t\t\tuint materialIndex = uTexelFetch1D( materialIndexAttribute, faceIndices.x ).r;\n\t\t\t\t\t\t\tMaterial material = readMaterialInfo( materials, materialIndex );\n\n\t\t\t\t\t\t\t// adjust the ray to the new surface\n\t\t\t\t\t\t\tbool isBelowSurface = dot( rayDirection, faceNormal ) < 0.0;\n\t\t\t\t\t\t\tvec3 point = rayOrigin + rayDirection * dist;\n\t\t\t\t\t\t\tvec3 absPoint = abs( point );\n\t\t\t\t\t\t\tfloat maxPoint = max( absPoint.x, max( absPoint.y, absPoint.z ) );\n\t\t\t\t\t\t\trayOrigin = point + faceNormal * ( maxPoint + 1.0 ) * ( isBelowSurface ? - RAY_OFFSET : RAY_OFFSET );\n\n\t\t\t\t\t\t\tif ( ! material.castShadow && isShadowRay ) {\n\n\t\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Opacity Test\n\n\t\t\t\t\t\t\t// albedo\n\t\t\t\t\t\t\tvec4 albedo = vec4( material.color, material.opacity );\n\t\t\t\t\t\t\tif ( material.map != - 1 ) {\n\n\t\t\t\t\t\t\t\tvec3 uvPrime = material.mapTransform * vec3( uv, 1 );\n\t\t\t\t\t\t\t\talbedo *= texture2D( textures, vec3( uvPrime.xy, material.map ) );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( material.vertexColors ) {\n\n\t\t\t\t\t\t\t\talbedo *= vertexColor;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// alphaMap\n\t\t\t\t\t\t\tif ( material.alphaMap != - 1 ) {\n\n\t\t\t\t\t\t\t\talbedo.a *= texture2D( textures, vec3( uv, material.alphaMap ) ).x;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// transmission\n\t\t\t\t\t\t\tfloat transmission = material.transmission;\n\t\t\t\t\t\t\tif ( material.transmissionMap != - 1 ) {\n\n\t\t\t\t\t\t\t\tvec3 uvPrime = material.transmissionMapTransform * vec3( uv, 1 );\n\t\t\t\t\t\t\t\ttransmission *= texture2D( textures, vec3( uvPrime.xy, material.transmissionMap ) ).r;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// metalness\n\t\t\t\t\t\t\tfloat metalness = material.metalness;\n\t\t\t\t\t\t\tif ( material.metalnessMap != - 1 ) {\n\n\t\t\t\t\t\t\t\tvec3 uvPrime = material.metalnessMapTransform * vec3( uv, 1 );\n\t\t\t\t\t\t\t\tmetalness *= texture2D( textures, vec3( uvPrime.xy, material.metalnessMap ) ).b;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfloat alphaTest = material.alphaTest;\n\t\t\t\t\t\t\tbool useAlphaTest = alphaTest != 0.0;\n\t\t\t\t\t\t\tfloat transmissionFactor = ( 1.0 - metalness ) * transmission;\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\ttransmissionFactor < rand() && ! (\n\t\t\t\t\t\t\t\t\t// material sidedness\n\t\t\t\t\t\t\t\t\tmaterial.side != 0.0 && side == material.side\n\n\t\t\t\t\t\t\t\t\t// alpha test\n\t\t\t\t\t\t\t\t\t|| useAlphaTest && albedo.a < alphaTest\n\n\t\t\t\t\t\t\t\t\t// opacity\n\t\t\t\t\t\t\t\t\t|| material.transparent && ! useAlphaTest && albedo.a < rand()\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t) {\n\n\t\t\t\t\t\t\t\treturn true;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( side == 1.0 && isBelowSurface ) {\n\n\t\t\t\t\t\t\t\t// only attenuate by surface color on the way in\n\t\t\t\t\t\t\t\tcolor *= mix( vec3( 1.0 ), albedo.rgb, transmissionFactor );\n\n\t\t\t\t\t\t\t} else if ( side == - 1.0 ) {\n\n\t\t\t\t\t\t\t\t// attenuate by medium once we hit the opposite side of the model\n\t\t\t\t\t\t\t\tcolor *= transmissionAttenuation( dist, material.attenuationColor, material.attenuationDistance );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\treturn false;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\n\t\t\t\t}\n\n\t\t\t\t// returns whether the ray hit anything before a certain distance, not just the first surface. Could be optimized to not check the full hierarchy.\n\t\t\t\tbool anyCloserHit( BVH bvh, vec3 rayOrigin, vec3 rayDirection, float maxDist ) {\n\n\t\t\t\t\tuvec4 faceIndices = uvec4( 0u );\n\t\t\t\t\tvec3 faceNormal = vec3( 0.0, 0.0, 1.0 );\n\t\t\t\t\tvec3 barycoord = vec3( 0.0 );\n\t\t\t\t\tfloat side = 1.0;\n\t\t\t\t\tfloat dist = 0.0;\n\t\t\t\t\tbool hit = bvhIntersectFirstHit( bvh, rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist );\n\t\t\t\t\treturn hit && dist < maxDist;\n\n\t\t\t\t}\n\n\t\t\t\t// tentFilter from Peter Shirley's 'Realistic Ray Tracing (2nd Edition)' book, pg. 60\n\t\t\t\t// erichlof/THREE.js-PathTracing-Renderer/\n\t\t\t\tfloat tentFilter( float x ) {\n\n\t\t\t\t\treturn x < 0.5 ? sqrt( 2.0 * x ) - 1.0 : 1.0 - sqrt( 2.0 - ( 2.0 * x ) );\n\n\t\t\t\t}\n\n\t\t\t\tvec3 ndcToRayOrigin( vec2 coord ) {\n\n\t\t\t\t\tvec4 rayOrigin4 = cameraWorldMatrix * invProjectionMatrix * vec4( coord, - 1.0, 1.0 );\n\t\t\t\t\treturn rayOrigin4.xyz / rayOrigin4.w;\n\t\t\t\t}\n\n\t\t\t\tvoid getCameraRay( out vec3 rayDirection, out vec3 rayOrigin ) {\n\n\t\t\t\t\tvec2 ssd = vec2( 1.0 ) / resolution;\n\n\t\t\t\t\t// Jitter the camera ray by finding a uv coordinate at a random sample\n\t\t\t\t\t// around this pixel's UV coordinate\n\t\t\t\t\tvec2 jitteredUv = vUv + vec2( tentFilter( rand() ) * ssd.x, tentFilter( rand() ) * ssd.y );\n\n\t\t\t\t\t#if CAMERA_TYPE == 2\n\n\t\t\t\t\t\t// Equirectangular projection\n\n\t\t\t\t\t\tvec4 rayDirection4 = vec4( equirectUvToDirection( jitteredUv ), 0.0 );\n\t\t\t\t\t\tvec4 rayOrigin4 = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\t\t\trayDirection4 = cameraWorldMatrix * rayDirection4;\n\t\t\t\t\t\trayOrigin4 = cameraWorldMatrix * rayOrigin4;\n\n\t\t\t\t\t\trayDirection = normalize( rayDirection4.xyz );\n\t\t\t\t\t\trayOrigin = rayOrigin4.xyz / rayOrigin4.w;\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\t// get [- 1, 1] normalized device coordinates\n\t\t\t\t\t\tvec2 ndc = 2.0 * jitteredUv - vec2( 1.0 );\n\n\t\t\t\t\t\trayOrigin = ndcToRayOrigin( ndc );\n\n\t\t\t\t\t\t#if CAMERA_TYPE == 1\n\n\t\t\t\t\t\t\t// Orthographic projection\n\n\t\t\t\t\t\t\trayDirection = ( cameraWorldMatrix * vec4( 0.0, 0.0, - 1.0, 0.0 ) ).xyz;\n\t\t\t\t\t\t\trayDirection = normalize( rayDirection );\n\n\t\t\t\t\t\t#else\n\n\t\t\t\t\t\t\t// Perspective projection\n\n\t\t\t\t\t\t\trayDirection = normalize( mat3(cameraWorldMatrix) * ( invProjectionMatrix * vec4( ndc, 0.0, 1.0 ) ).xyz );\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\t#if FEATURE_DOF\n\t\t\t\t\t{\n\n\t\t\t\t\t\t// depth of field\n\t\t\t\t\t\tvec3 focalPoint = rayOrigin + normalize( rayDirection ) * physicalCamera.focusDistance;\n\n\t\t\t\t\t\t// get the aperture sample\n\t\t\t\t\t\tvec2 apertureSample = sampleAperture( physicalCamera.apertureBlades ) * physicalCamera.bokehSize * 0.5 * 1e-3;\n\n\t\t\t\t\t\t// rotate the aperture shape\n\t\t\t\t\t\tfloat ac = cos( physicalCamera.apertureRotation );\n\t\t\t\t\t\tfloat as = sin( physicalCamera.apertureRotation );\n\t\t\t\t\t\tapertureSample = vec2(\n\t\t\t\t\t\t\tapertureSample.x * ac - apertureSample.y * as,\n\t\t\t\t\t\t\tapertureSample.x * as + apertureSample.y * ac\n\t\t\t\t\t\t);\n\t\t\t\t\t\tapertureSample.x *= saturate( physicalCamera.anamorphicRatio );\n\t\t\t\t\t\tapertureSample.y *= saturate( 1.0 / physicalCamera.anamorphicRatio );\n\n\t\t\t\t\t\t// create the new ray\n\t\t\t\t\t\trayOrigin += ( cameraWorldMatrix * vec4( apertureSample, 0.0, 0.0 ) ).xyz;\n\t\t\t\t\t\trayDirection = focalPoint - rayOrigin;\n\n\t\t\t\t\t}\n\t\t\t\t\t#endif\n\n\t\t\t\t\trayDirection = normalize( rayDirection );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\trng_initialize( gl_FragCoord.xy, seed );\n\n\t\t\t\t\tvec3 rayDirection;\n\t\t\t\t\tvec3 rayOrigin;\n\n\t\t\t\t\tgetCameraRay( rayDirection, rayOrigin );\n\n\t\t\t\t\t// inverse environment rotation\n\t\t\t\t\tmat3 invEnvironmentRotation = inverse( environmentRotation );\n\n\t\t\t\t\t// final color\n\t\t\t\t\tgl_FragColor = vec4( 0.0 );\n\t\t\t\t\tgl_FragColor.a = 1.0;\n\n\t\t\t\t\t// hit results\n\t\t\t\t\tuvec4 faceIndices = uvec4( 0u );\n\t\t\t\t\tvec3 faceNormal = vec3( 0.0, 0.0, 1.0 );\n\t\t\t\t\tvec3 barycoord = vec3( 0.0 );\n\t\t\t\t\tfloat side = 1.0;\n\t\t\t\t\tfloat dist = 0.0;\n\n\t\t\t\t\t// path tracing state\n\t\t\t\t\tfloat accumulatedRoughness = 0.0;\n\t\t\t\t\tfloat accumulatedClearcoatRoughness = 0.0;\n\t\t\t\t\tbool transmissiveRay = true;\n\t\t\t\t\tint transparentTraversals = TRANSPARENT_TRAVERSALS;\n\t\t\t\t\tvec3 throughputColor = vec3( 1.0 );\n\t\t\t\t\tSampleRec sampleRec;\n\t\t\t\t\tint i;\n\t\t\t\t\tbool isShadowRay = false;\n\n\t\t\t\t\tfor ( i = 0; i < bounces; i ++ ) {\n\n\t\t\t\t\t\tbool hit = bvhIntersectFirstHit( bvh, rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist );\n\n\t\t\t\t\t\tLightSampleRec lightHit = lightsClosestHit( lights.tex, lights.count, rayOrigin, rayDirection );\n\n\t\t\t\t\t\tif ( lightHit.hit && ( lightHit.dist < dist || !hit ) ) {\n\n\t\t\t\t\t\t\tif ( i == 0 || transmissiveRay ) {\n\n\t\t\t\t\t\t\t\tgl_FragColor.rgb += lightHit.emission * throughputColor;\n\n\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\t#if FEATURE_MIS\n\n\t\t\t\t\t\t\t\t// NOTE: we skip MIS for spotlights since we haven't fixed the forward\n\t\t\t\t\t\t\t\t// path tracing code path, yet\n\t\t\t\t\t\t\t\tif ( lightHit.type == SPOT_LIGHT_TYPE ) {\n\n\t\t\t\t\t\t\t\t\tgl_FragColor.rgb += lightHit.emission * throughputColor;\n\n\t\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\t\t// weight the contribution\n\t\t\t\t\t\t\t\t\tfloat misWeight = misHeuristic( sampleRec.pdf, lightHit.pdf / float( lights.count + 1u ) );\n\t\t\t\t\t\t\t\t\tgl_FragColor.rgb += lightHit.emission * throughputColor * misWeight;\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t#else\n\n\t\t\t\t\t\t\t\tgl_FragColor.rgb += lightHit.emission * throughputColor;\n\n\t\t\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( ! hit ) {\n\n\t\t\t\t\t\t\tif ( i == 0 || transmissiveRay ) {\n\n\t\t\t\t\t\t\t\tgl_FragColor.rgb += sampleBackground( environmentRotation * rayDirection ) * throughputColor;\n\t\t\t\t\t\t\t\tgl_FragColor.a = backgroundAlpha;\n\n\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\t#if FEATURE_MIS\n\n\t\t\t\t\t\t\t\t// get the PDF of the hit envmap point\n\t\t\t\t\t\t\t\tvec3 envColor;\n\t\t\t\t\t\t\t\tfloat envPdf = envMapSample( environmentRotation * rayDirection, envMapInfo, envColor );\n\t\t\t\t\t\t\t\tenvPdf /= float( lights.count + 1u );\n\n\t\t\t\t\t\t\t\t// and weight the contribution\n\t\t\t\t\t\t\t\tfloat misWeight = misHeuristic( sampleRec.pdf, envPdf );\n\t\t\t\t\t\t\t\tgl_FragColor.rgb += environmentIntensity * envColor * throughputColor * misWeight;\n\n\t\t\t\t\t\t\t\t#else\n\n\t\t\t\t\t\t\t\tgl_FragColor.rgb +=\n\t\t\t\t\t\t\t\t\tenvironmentIntensity *\n\t\t\t\t\t\t\t\t\tsampleEquirectEnvMapColor( environmentRotation * rayDirection, envMapInfo.map ) *\n\t\t\t\t\t\t\t\t\tthroughputColor;\n\n\t\t\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tuint materialIndex = uTexelFetch1D( materialIndexAttribute, faceIndices.x ).r;\n\t\t\t\t\t\tMaterial material = readMaterialInfo( materials, materialIndex );\n\n\t\t\t\t\t\tif ( material.matte && i == 0 ) {\n\n\t\t\t\t\t\t\tgl_FragColor = vec4( 0.0 );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// if we've determined that this is a shadow ray and we've hit an item with no shadow casting\n\t\t\t\t\t\t// then skip it\n\t\t\t\t\t\tif ( ! material.castShadow && isShadowRay ) {\n\n\t\t\t\t\t\t\tvec3 point = rayOrigin + rayDirection * dist;\n\t\t\t\t\t\t\tvec3 absPoint = abs( point );\n\t\t\t\t\t\t\tfloat maxPoint = max( absPoint.x, max( absPoint.y, absPoint.z ) );\n\t\t\t\t\t\t\trayOrigin = point - ( maxPoint + 1.0 ) * faceNormal * RAY_OFFSET;\n\n\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// uv coord for textures\n\t\t\t\t\t\tvec2 uv = textureSampleBarycoord( uvAttribute, barycoord, faceIndices.xyz ).xy;\n\t\t\t\t\t\tvec4 vertexColor = textureSampleBarycoord( colorAttribute, barycoord, faceIndices.xyz );\n\n\t\t\t\t\t\t// albedo\n\t\t\t\t\t\tvec4 albedo = vec4( material.color, material.opacity );\n\t\t\t\t\t\tif ( material.map != - 1 ) {\n\n\t\t\t\t\t\t\tvec3 uvPrime = material.mapTransform * vec3( uv, 1 );\n\t\t\t\t\t\t\talbedo *= texture2D( textures, vec3( uvPrime.xy, material.map ) );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( material.vertexColors ) {\n\n\t\t\t\t\t\t\talbedo *= vertexColor;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// alphaMap\n\t\t\t\t\t\tif ( material.alphaMap != - 1 ) {\n\n\t\t\t\t\t\t\talbedo.a *= texture2D( textures, vec3( uv, material.alphaMap ) ).x;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// possibly skip this sample if it's transparent, alpha test is enabled, or we hit the wrong material side\n\t\t\t\t\t\t// and it's single sided.\n\t\t\t\t\t\t// - alpha test is disabled when it === 0\n\t\t\t\t\t\t// - the material sidedness test is complicated because we want light to pass through the back side but still\n\t\t\t\t\t\t// be able to see the front side. This boolean checks if the side we hit is the front side on the first ray\n\t\t\t\t\t\t// and we're rendering the other then we skip it. Do the opposite on subsequent bounces to get incoming light.\n\t\t\t\t\t\tfloat alphaTest = material.alphaTest;\n\t\t\t\t\t\tbool useAlphaTest = alphaTest != 0.0;\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t// material sidedness\n\t\t\t\t\t\t\tmaterial.side != 0.0 && side != material.side\n\n\t\t\t\t\t\t\t// alpha test\n\t\t\t\t\t\t\t|| useAlphaTest && albedo.a < alphaTest\n\n\t\t\t\t\t\t\t// opacity\n\t\t\t\t\t\t\t|| material.transparent && ! useAlphaTest && albedo.a < rand()\n\t\t\t\t\t\t) {\n\n\t\t\t\t\t\t\tvec3 point = rayOrigin + rayDirection * dist;\n\t\t\t\t\t\t\tvec3 absPoint = abs( point );\n\t\t\t\t\t\t\tfloat maxPoint = max( absPoint.x, max( absPoint.y, absPoint.z ) );\n\t\t\t\t\t\t\trayOrigin = point - ( maxPoint + 1.0 ) * faceNormal * RAY_OFFSET;\n\n\t\t\t\t\t\t\t// only allow a limited number of transparency discards otherwise we could\n\t\t\t\t\t\t\t// crash the context with too long a loop.\n\t\t\t\t\t\t\ti -= sign( transparentTraversals );\n\t\t\t\t\t\t\ttransparentTraversals -= sign( transparentTraversals );\n\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// fetch the interpolated smooth normal\n\t\t\t\t\t\tvec3 normal = normalize( textureSampleBarycoord(\n\t\t\t\t\t\t\tnormalAttribute,\n\t\t\t\t\t\t\tbarycoord,\n\t\t\t\t\t\t\tfaceIndices.xyz\n\t\t\t\t\t\t).xyz );\n\n\t\t\t\t\t\t// roughness\n\t\t\t\t\t\tfloat roughness = material.roughness;\n\t\t\t\t\t\tif ( material.roughnessMap != - 1 ) {\n\n\t\t\t\t\t\t\tvec3 uvPrime = material.roughnessMapTransform * vec3( uv, 1 );\n\t\t\t\t\t\t\troughness *= texture2D( textures, vec3( uvPrime.xy, material.roughnessMap ) ).g;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// metalness\n\t\t\t\t\t\tfloat metalness = material.metalness;\n\t\t\t\t\t\tif ( material.metalnessMap != - 1 ) {\n\n\t\t\t\t\t\t\tvec3 uvPrime = material.metalnessMapTransform * vec3( uv, 1 );\n\t\t\t\t\t\t\tmetalness *= texture2D( textures, vec3( uvPrime.xy, material.metalnessMap ) ).b;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// emission\n\t\t\t\t\t\tvec3 emission = material.emissiveIntensity * material.emissive;\n\t\t\t\t\t\tif ( material.emissiveMap != - 1 ) {\n\n\t\t\t\t\t\t\tvec3 uvPrime = material.emissiveMapTransform * vec3( uv, 1 );\n\t\t\t\t\t\t\temission *= texture2D( textures, vec3( uvPrime.xy, material.emissiveMap ) ).xyz;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// transmission\n\t\t\t\t\t\tfloat transmission = material.transmission;\n\t\t\t\t\t\tif ( material.transmissionMap != - 1 ) {\n\n\t\t\t\t\t\t\tvec3 uvPrime = material.transmissionMapTransform * vec3( uv, 1 );\n\t\t\t\t\t\t\ttransmission *= texture2D( textures, vec3( uvPrime.xy, material.transmissionMap ) ).r;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// normal\n\t\t\t\t\t\tvec3 baseNormal = normal;\n\t\t\t\t\t\tif ( material.normalMap != - 1 ) {\n\n\t\t\t\t\t\t\tvec4 tangentSample = textureSampleBarycoord(\n\t\t\t\t\t\t\t\ttangentAttribute,\n\t\t\t\t\t\t\t\tbarycoord,\n\t\t\t\t\t\t\t\tfaceIndices.xyz\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t// some provided tangents can be malformed (0, 0, 0) causing the normal to be degenerate\n\t\t\t\t\t\t\t// resulting in NaNs and slow path tracing.\n\t\t\t\t\t\t\tif ( length( tangentSample.xyz ) > 0.0 ) {\n\n\t\t\t\t\t\t\t\tvec3 tangent = normalize( tangentSample.xyz );\n\t\t\t\t\t\t\t\tvec3 bitangent = normalize( cross( normal, tangent ) * tangentSample.w );\n\t\t\t\t\t\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\n\t\t\t\t\t\t\t\tvec3 uvPrime = material.normalMapTransform * vec3( uv, 1 );\n\t\t\t\t\t\t\t\tvec3 texNormal = texture2D( textures, vec3( uvPrime.xy, material.normalMap ) ).xyz * 2.0 - 1.0;\n\t\t\t\t\t\t\t\ttexNormal.xy *= material.normalScale;\n\t\t\t\t\t\t\t\tnormal = vTBN * texNormal;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnormal *= side;\n\n\t\t\t\t\t\t// clearcoat\n\t\t\t\t\t\tfloat clearcoat = material.clearcoat;\n\t\t\t\t\t\tif ( material.clearcoatMap != - 1 ) {\n\n\t\t\t\t\t\t\tvec3 uvPrime = material.clearcoatMapTransform * vec3( uv, 1 );\n\t\t\t\t\t\t\tclearcoat *= texture2D( textures, vec3( uvPrime.xy, material.clearcoatMap ) ).r;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// clearcoatRoughness\n\t\t\t\t\t\tfloat clearcoatRoughness = material.clearcoatRoughness;\n\t\t\t\t\t\tif ( material.clearcoatRoughnessMap != - 1 ) {\n\n\t\t\t\t\t\t\tvec3 uvPrime = material.clearcoatRoughnessMapTransform * vec3( uv, 1 );\n\t\t\t\t\t\t\tclearcoat *= texture2D( textures, vec3( uvPrime.xy, material.clearcoatRoughnessMap ) ).g;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// clearcoatNormal\n\t\t\t\t\t\tvec3 clearcoatNormal = baseNormal;\n\t\t\t\t\t\tif ( material.clearcoatNormalMap != - 1 ) {\n\n\t\t\t\t\t\t\tvec4 tangentSample = textureSampleBarycoord(\n\t\t\t\t\t\t\t\ttangentAttribute,\n\t\t\t\t\t\t\t\tbarycoord,\n\t\t\t\t\t\t\t\tfaceIndices.xyz\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t// some provided tangents can be malformed (0, 0, 0) causing the normal to be degenerate\n\t\t\t\t\t\t\t// resulting in NaNs and slow path tracing.\n\t\t\t\t\t\t\tif ( length( tangentSample.xyz ) > 0.0 ) {\n\n\t\t\t\t\t\t\t\tvec3 tangent = normalize( tangentSample.xyz );\n\t\t\t\t\t\t\t\tvec3 bitangent = normalize( cross( clearcoatNormal, tangent ) * tangentSample.w );\n\t\t\t\t\t\t\t\tmat3 vTBN = mat3( tangent, bitangent, clearcoatNormal );\n\n\t\t\t\t\t\t\t\tvec3 uvPrime = material.clearcoatNormalMapTransform * vec3( uv, 1 );\n\t\t\t\t\t\t\t\tvec3 texNormal = texture2D( textures, vec3( uvPrime.xy, material.clearcoatNormalMap ) ).xyz * 2.0 - 1.0;\n\t\t\t\t\t\t\t\ttexNormal.xy *= material.clearcoatNormalScale;\n\t\t\t\t\t\t\t\tclearcoatNormal = vTBN * texNormal;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tclearcoatNormal *= side;\n\n\t\t\t\t\t\t// sheenColor\n\t\t\t\t\t\tvec3 sheenColor = material.sheenColor;\n\t\t\t\t\t\tif ( material.sheenColorMap != - 1 ) {\n\n\t\t\t\t\t\t\tvec3 uvPrime = material.sheenColorMapTransform * vec3( uv, 1 );\n\t\t\t\t\t\t\tsheenColor *= texture2D( textures, vec3( uvPrime.xy, material.sheenColorMap ) ).rgb;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// sheenRoughness\n\t\t\t\t\t\tfloat sheenRoughness = material.sheenRoughness;\n\t\t\t\t\t\tif ( material.sheenRoughnessMap != - 1 ) {\n\n\t\t\t\t\t\t\tvec3 uvPrime = material.sheenRoughnessMapTransform * vec3( uv, 1 );\n\t\t\t\t\t\t\tsheenRoughness *= texture2D( textures, vec3( uvPrime.xy, material.sheenRoughnessMap ) ).a;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// iridescence\n\t\t\t\t\t\tfloat iridescence = material.iridescence;\n\t\t\t\t\t\tif ( material.iridescenceMap != - 1 ) {\n\n\t\t\t\t\t\t\tvec3 uvPrime = material.iridescenceMapTransform * vec3( uv, 1 );\n\t\t\t\t\t\t\tiridescence *= texture2D( textures, vec3( uvPrime.xy, material.iridescenceMap ) ).r;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// iridescence thickness\n\t\t\t\t\t\tfloat iridescenceThickness = material.iridescenceThicknessMaximum;\n\t\t\t\t\t\tif ( material.iridescenceThicknessMap != - 1 ) {\n\n\t\t\t\t\t\t\tvec3 uvPrime = material.iridescenceThicknessMapTransform * vec3( uv, 1 );\n\t\t\t\t\t\t\tfloat iridescenceThicknessSampled = texture2D( textures, vec3( uvPrime.xy, material.iridescenceThicknessMap ) ).g;\n\t\t\t\t\t\t\tiridescenceThickness = mix( material.iridescenceThicknessMinimum, material.iridescenceThicknessMaximum, iridescenceThicknessSampled );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tiridescence = iridescenceThickness == 0.0 ? 0.0 : iridescence;\n\n\t\t\t\t\t\t// specular color\n\t\t\t\t\t\tvec3 specularColor = material.specularColor;\n\t\t\t\t\t\tif ( material.specularColorMap != - 1 ) {\n\n\t\t\t\t\t\t\tvec3 uvPrime = material.specularColorMapTransform * vec3( uv, 1 );\n\t\t\t\t\t\t\tspecularColor *= texture2D( textures, vec3( uvPrime.xy, material.specularColorMap ) ).rgb;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// specular intensity\n\t\t\t\t\t\tfloat specularIntensity = material.specularIntensity;\n\t\t\t\t\t\tif ( material.specularIntensityMap != - 1 ) {\n\n\t\t\t\t\t\t\tvec3 uvPrime = material.specularIntensityMapTransform * vec3( uv, 1 );\n\t\t\t\t\t\t\tspecularIntensity *= texture2D( textures, vec3( uvPrime.xy, material.specularIntensityMap ) ).a;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tSurfaceRec surfaceRec;\n\t\t\t\t\t\tsurfaceRec.normal = normal;\n\t\t\t\t\t\tsurfaceRec.faceNormal = faceNormal;\n\t\t\t\t\t\tsurfaceRec.transmission = transmission;\n\t\t\t\t\t\tsurfaceRec.ior = material.ior;\n\t\t\t\t\t\tsurfaceRec.emission = emission;\n\t\t\t\t\t\tsurfaceRec.metalness = metalness;\n\t\t\t\t\t\tsurfaceRec.color = albedo.rgb;\n\t\t\t\t\t\tsurfaceRec.clearcoat = clearcoat;\n\t\t\t\t\t\tsurfaceRec.sheenColor = sheenColor;\n\t\t\t\t\t\tsurfaceRec.iridescence = iridescence;\n\t\t\t\t\t\tsurfaceRec.iridescenceIor = material.iridescenceIor;\n\t\t\t\t\t\tsurfaceRec.iridescenceThickness = iridescenceThickness;\n\t\t\t\t\t\tsurfaceRec.specularColor = specularColor;\n\t\t\t\t\t\tsurfaceRec.specularIntensity = specularIntensity;\n\t\t\t\t\t\tsurfaceRec.attenuationColor = material.attenuationColor;\n\t\t\t\t\t\tsurfaceRec.attenuationDistance = material.attenuationDistance;\n\n\t\t\t\t\t\t// apply perceptual roughness factor from gltf\n\t\t\t\t\t\t// https://registry.khronos.org/glTF/specs/2.0/glTF-2.0.html#microfacet-surfaces\n\t\t\t\t\t\tsurfaceRec.roughness = roughness * roughness;\n\t\t\t\t\t\tsurfaceRec.clearcoatRoughness = clearcoatRoughness * clearcoatRoughness;\n\t\t\t\t\t\tsurfaceRec.sheenRoughness = sheenRoughness * sheenRoughness;\n\n\t\t\t\t\t\t// frontFace is used to determine transmissive properties and PDF. If no transmission is used\n\t\t\t\t\t\t// then we can just always assume this is a front face.\n\t\t\t\t\t\tsurfaceRec.frontFace = side == 1.0 || transmission == 0.0;\n\t\t\t\t\t\tsurfaceRec.iorRatio = material.thinFilm || surfaceRec.frontFace ? 1.0 / material.ior : material.ior;\n\t\t\t\t\t\tsurfaceRec.thinFilm = material.thinFilm;\n\n\t\t\t\t\t\t// Compute the filtered roughness value to use during specular reflection computations.\n\t\t\t\t\t\t// The accumulated roughness value is scaled by a user setting and a "magic value" of 5.0.\n\t\t\t\t\t\t// If we're exiting something transmissive then scale the factor down significantly so we can retain\n\t\t\t\t\t\t// sharp internal reflections\n\t\t\t\t\t\tsurfaceRec.filteredRoughness = applyFilteredGlossy( surfaceRec.roughness, accumulatedRoughness );\n\t\t\t\t\t\tsurfaceRec.filteredClearcoatRoughness = applyFilteredGlossy( surfaceRec.clearcoatRoughness, accumulatedClearcoatRoughness );\n\n\t\t\t\t\t\tmat3 normalBasis = getBasisFromNormal( surfaceRec.normal );\n\t\t\t\t\t\tmat3 invBasis = inverse( normalBasis );\n\n\t\t\t\t\t\tmat3 clearcoatNormalBasis = getBasisFromNormal( clearcoatNormal );\n\t\t\t\t\t\tmat3 clearcoatInvBasis = inverse( clearcoatNormalBasis );\n\n\t\t\t\t\t\tvec3 outgoing = - normalize( invBasis * rayDirection );\n\t\t\t\t\t\tvec3 clearcoatOutgoing = - normalize( clearcoatInvBasis * rayDirection );\n\t\t\t\t\t\tsampleRec = bsdfSample( outgoing, clearcoatOutgoing, normalBasis, invBasis, clearcoatNormalBasis, clearcoatInvBasis, surfaceRec );\n\n\t\t\t\t\t\tisShadowRay = sampleRec.specularPdf < rand();\n\n\t\t\t\t\t\t// adjust the hit point by the surface normal by a factor of some offset and the\n\t\t\t\t\t\t// maximum component-wise value of the current point to accommodate floating point\n\t\t\t\t\t\t// error as values increase.\n\t\t\t\t\t\tvec3 point = rayOrigin + rayDirection * dist;\n\t\t\t\t\t\tvec3 absPoint = abs( point );\n\t\t\t\t\t\tfloat maxPoint = max( absPoint.x, max( absPoint.y, absPoint.z ) );\n\t\t\t\t\t\trayDirection = normalize( normalBasis * sampleRec.direction );\n\n\t\t\t\t\t\tbool isBelowSurface = dot( rayDirection, faceNormal ) < 0.0;\n\t\t\t\t\t\trayOrigin = point + faceNormal * ( maxPoint + 1.0 ) * ( isBelowSurface ? - RAY_OFFSET : RAY_OFFSET );\n\n\t\t\t\t\t\t// direct env map sampling\n\t\t\t\t\t\t#if FEATURE_MIS\n\n\t\t\t\t\t\t// uniformly pick a light or environment map\n\t\t\t\t\t\tif( rand() > 1.0 / float( lights.count + 1u ) ) {\n\n\t\t\t\t\t\t\t// sample a light or environment\n\t\t\t\t\t\t\tLightSampleRec lightSampleRec = randomLightSample( lights.tex, iesProfiles, lights.count, rayOrigin );\n\n\t\t\t\t\t\t\tbool isSampleBelowSurface = dot( faceNormal, lightSampleRec.direction ) < 0.0;\n\t\t\t\t\t\t\tif ( isSampleBelowSurface ) {\n\n\t\t\t\t\t\t\t\tlightSampleRec.pdf = 0.0;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// check if a ray could even reach the light area\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tlightSampleRec.pdf > 0.0 &&\n\t\t\t\t\t\t\t\tisDirectionValid( lightSampleRec.direction, normal, faceNormal ) &&\n\t\t\t\t\t\t\t\t! anyCloserHit( bvh, rayOrigin, lightSampleRec.direction, lightSampleRec.dist )\n\t\t\t\t\t\t\t) {\n\n\t\t\t\t\t\t\t\t// get the material pdf\n\t\t\t\t\t\t\t\tvec3 sampleColor;\n\t\t\t\t\t\t\t\tfloat lightMaterialPdf = bsdfResult( outgoing, clearcoatOutgoing, normalize( invBasis * lightSampleRec.direction ), normalize( clearcoatInvBasis * lightSampleRec.direction ), surfaceRec, sampleColor );\n\t\t\t\t\t\t\t\tbool isValidSampleColor = all( greaterThanEqual( sampleColor, vec3( 0.0 ) ) );\n\t\t\t\t\t\t\t\tif ( lightMaterialPdf > 0.0 && isValidSampleColor ) {\n\n\t\t\t\t\t\t\t\t\t// weight the direct light contribution\n\t\t\t\t\t\t\t\t\tfloat lightPdf = lightSampleRec.pdf / float( lights.count + 1u );\n\t\t\t\t\t\t\t\t\tfloat misWeight = misHeuristic( lightPdf, lightMaterialPdf );\n\t\t\t\t\t\t\t\t\tgl_FragColor.rgb += lightSampleRec.emission * throughputColor * sampleColor * misWeight / lightPdf;\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t// find a sample in the environment map to include in the contribution\n\t\t\t\t\t\t\tvec3 envColor, envDirection;\n\t\t\t\t\t\t\tfloat envPdf = randomEnvMapSample( envMapInfo, envColor, envDirection );\n\t\t\t\t\t\t\tenvDirection = invEnvironmentRotation * envDirection;\n\n\t\t\t\t\t\t\t// this env sampling is not set up for transmissive sampling and yields overly bright\n\t\t\t\t\t\t\t// results so we ignore the sample in this case.\n\t\t\t\t\t\t\t// TODO: this should be improved but how? The env samples could traverse a few layers?\n\t\t\t\t\t\t\tbool isSampleBelowSurface = dot( faceNormal, envDirection ) < 0.0;\n\t\t\t\t\t\t\tif ( isSampleBelowSurface ) {\n\n\t\t\t\t\t\t\t\tenvPdf = 0.0;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// check if a ray could even reach the surface\n\t\t\t\t\t\t\tvec3 attenuatedColor;\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tenvPdf > 0.0 &&\n\t\t\t\t\t\t\t\tisDirectionValid( envDirection, normal, faceNormal ) &&\n\t\t\t\t\t\t\t\t! attenuateHit( bvh, rayOrigin, envDirection, bounces - i, isShadowRay, attenuatedColor )\n\t\t\t\t\t\t\t) {\n\n\t\t\t\t\t\t\t\t// get the material pdf\n\t\t\t\t\t\t\t\tvec3 sampleColor;\n\t\t\t\t\t\t\t\tfloat envMaterialPdf = bsdfResult( outgoing, clearcoatOutgoing, normalize( invBasis * envDirection ), normalize( clearcoatInvBasis * envDirection ), surfaceRec, sampleColor );\n\t\t\t\t\t\t\t\tbool isValidSampleColor = all( greaterThanEqual( sampleColor, vec3( 0.0 ) ) );\n\t\t\t\t\t\t\t\tif ( envMaterialPdf > 0.0 && isValidSampleColor ) {\n\n\t\t\t\t\t\t\t\t\t// weight the direct light contribution\n\t\t\t\t\t\t\t\t\tenvPdf /= float( lights.count + 1u );\n\t\t\t\t\t\t\t\t\tfloat misWeight = misHeuristic( envPdf, envMaterialPdf );\n\t\t\t\t\t\t\t\t\tgl_FragColor.rgb += attenuatedColor * environmentIntensity * envColor * throughputColor * sampleColor * misWeight / envPdf;\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t// accumulate a roughness value to offset diffuse, specular, diffuse rays that have high contribution\n\t\t\t\t\t\t// to a single pixel resulting in fireflies\n\t\t\t\t\t\tif ( ! isBelowSurface ) {\n\n\t\t\t\t\t\t\t// determine if this is a rough normal or not by checking how far off straight up it is\n\t\t\t\t\t\t\tvec3 halfVector = normalize( outgoing + sampleRec.direction );\n\t\t\t\t\t\t\taccumulatedRoughness += sin( acosApprox( halfVector.z ) );\n\n\t\t\t\t\t\t\tvec3 clearcoatHalfVector = normalize( clearcoatOutgoing + sampleRec.clearcoatDirection );\n\t\t\t\t\t\t\taccumulatedClearcoatRoughness += sin( acosApprox( clearcoatHalfVector.z ) );\n\n\t\t\t\t\t\t\ttransmissiveRay = false;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// accumulate color\n\t\t\t\t\t\tgl_FragColor.rgb += ( emission * throughputColor );\n\n\t\t\t\t\t\t// skip the sample if our PDF or ray is impossible\n\t\t\t\t\t\tif ( sampleRec.pdf <= 0.0 || ! isDirectionValid( rayDirection, normal, faceNormal) ) {\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthroughputColor *= sampleRec.color / sampleRec.pdf;\n\n\t\t\t\t\t\t// attenuate the throughput color by the medium color\n\t\t\t\t\t\tif ( side == - 1.0 ) {\n\n\t\t\t\t\t\t\tthroughputColor *= transmissionAttenuation( dist, surfaceRec.attenuationColor, surfaceRec.attenuationDistance );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// discard the sample if there are any NaNs\n\t\t\t\t\t\tif ( any( isnan( throughputColor ) ) || any( isinf( throughputColor ) ) ) {\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tgl_FragColor.a *= opacity;\n\n\t\t\t\t}\n\n\t\t\t`}),this.setValues(e)}}var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ");class $7aa643e6dde9017b$export$d076a711b55c758a extends $4xklQ.DataTextureLoader{constructor(e){super(e),this.type=$4xklQ.HalfFloatType}parse(e){const t=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},i=function(e,t,i){t=t||1024;let r=e.pos,n=-1,o=0,a="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));for(;0>(n=s.indexOf("\n"))&&o<t&&r<e.byteLength;)a+=s,o+=s.length,r+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));return-1<n&&(!1!==i&&(e.pos+=o+n+1),a+s.slice(0,n))},r=function(e,t,i,r){const n=e[t+3],o=Math.pow(2,n-128)/255;i[r+0]=e[t+0]*o,i[r+1]=e[t+1]*o,i[r+2]=e[t+2]*o,i[r+3]=1},n=function(e,t,i,r){const n=e[t+3],o=Math.pow(2,n-128)/255;i[r+0]=$4xklQ.DataUtils.toHalfFloat(Math.min(e[t+0]*o,65504)),i[r+1]=$4xklQ.DataUtils.toHalfFloat(Math.min(e[t+1]*o,65504)),i[r+2]=$4xklQ.DataUtils.toHalfFloat(Math.min(e[t+2]*o,65504)),i[r+3]=$4xklQ.DataUtils.toHalfFloat(1)},o=new Uint8Array(e);o.pos=0;const a=function(e){const r=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,n=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*FORMAT=(\S+)\s*$/,a=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,s={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,c;if(e.pos>=e.byteLength||!(l=i(e)))return t(1,"no header found");if(!(c=l.match(/^#\?(\S+)/)))return t(3,"bad initial token");for(s.valid|=1,s.programtype=c[1],s.string+=l+"\n";l=i(e),!1!==l;)if(s.string+=l+"\n","#"!==l.charAt(0)){if((c=l.match(r))&&(s.gamma=parseFloat(c[1])),(c=l.match(n))&&(s.exposure=parseFloat(c[1])),(c=l.match(o))&&(s.valid|=2,s.format=c[1]),(c=l.match(a))&&(s.valid|=4,s.height=parseInt(c[1],10),s.width=parseInt(c[2],10)),2&s.valid&&4&s.valid)break}else s.comments+=l+"\n";return 2&s.valid?4&s.valid?s:t(3,"missing image size specifier"):t(3,"missing format specifier")}(o);if(-1!==a){const e=a.width,i=a.height,s=function(e,i,r){const n=i;if(n<8||n>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(n!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");const o=new Uint8Array(4*i*r);if(!o.length)return t(4,"unable to allocate buffer space");let a=0,s=0;const l=4*n,c=new Uint8Array(4),h=new Uint8Array(l);let d=r;for(;d>0&&s<e.byteLength;){if(s+4>e.byteLength)return t(1);if(c[0]=e[s++],c[1]=e[s++],c[2]=e[s++],c[3]=e[s++],2!=c[0]||2!=c[1]||(c[2]<<8|c[3])!=n)return t(3,"bad rgbe scanline format");let i,r=0;for(;r<l&&s<e.byteLength;){i=e[s++];const n=i>128;if(n&&(i-=128),0===i||r+i>l)return t(3,"bad scanline data");if(n){const t=e[s++];for(let e=0;e<i;e++)h[r++]=t}else h.set(e.subarray(s,s+i),r),r+=i,s+=i}const u=n;for(let e=0;e<u;e++){let t=0;o[a]=h[e+t],t+=n,o[a+1]=h[e+t],t+=n,o[a+2]=h[e+t],t+=n,o[a+3]=h[e+t],a+=4}d--}return o}(o.subarray(o.pos),e,i);if(-1!==s){let t,o,l;switch(this.type){case $4xklQ.FloatType:l=s.length/4;const e=new Float32Array(4*l);for(let t=0;t<l;t++)r(s,4*t,e,4*t);t=e,o=$4xklQ.FloatType;break;case $4xklQ.HalfFloatType:l=s.length/4;const i=new Uint16Array(4*l);for(let e=0;e<l;e++)n(s,4*e,i,4*e);t=i,o=$4xklQ.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:e,height:i,data:t,header:a.string,gamma:a.gamma,exposure:a.exposure,type:o}}}return null}setDataType(e){return this.type=e,this}load(e,t,i,r){return super.load(e,(function(e,i){switch(e.type){case $4xklQ.FloatType:case $4xklQ.HalfFloatType:e.encoding=$4xklQ.LinearEncoding,e.minFilter=$4xklQ.LinearFilter,e.magFilter=$4xklQ.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,i)}),i,r)}}var $hu0fb=parcelRequire("hu0fb"),$02720af05ebc5d11$export$1111800106ba519a=function(){var e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),t=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if("object"!=typeof WebAssembly)return{supported:!1};var i,r=WebAssembly.validate(e)?"b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb":"b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",n=WebAssembly.instantiate(o(r),{}).then((function(e){(i=e.instance).exports.__wasm_call_ctors()}));function o(e){for(var i=new Uint8Array(e.length),r=0;r<e.length;++r){var n=e.charCodeAt(r);i[r]=n>96?n-97:n>64?n-39:n+4}var o=0;for(r=0;r<e.length;++r)i[o++]=i[r]<60?t[i[r]]:64*(i[r]-60)+i[++r];return i.buffer.slice(0,o)}function a(e,t,r,n,o,a){var s=i.exports.sbrk,l=r+3&-4,c=s(l*n),h=s(o.length),d=new Uint8Array(i.exports.memory.buffer);d.set(o,h);var u=e(c,r,n,h,o.length);if(0==u&&a&&a(c,l,n),t.set(d.subarray(c,c+r*n)),s(c-s(0)),0!=u)throw new Error("Malformed buffer data: "+u)}var s={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},l={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},c=[],h=0;function d(e){var t={object:new Worker(e),pending:0,requests:{}};return t.object.onmessage=function(e){var i=e.data;t.pending-=i.count,t.requests[i.id][i.action](i.value),delete t.requests[i.id]},t}function u(e){for(var t="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(o(r))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+a.toString()+p.toString(),i=new Blob([t],{type:"text/javascript"}),n=URL.createObjectURL(i),s=0;s<e;++s)c[s]=d(n);URL.revokeObjectURL(n)}function p(e){n.then((function(){var t=e.data;try{var r=new Uint8Array(t.count*t.size);a(i.exports[t.mode],r,t.count,t.size,t.source,i.exports[t.filter]),self.postMessage({id:t.id,count:t.count,action:"resolve",value:r},[r.buffer])}catch(e){self.postMessage({id:t.id,count:t.count,action:"reject",value:e})}}))}return{ready:n,supported:!0,useWorkers:function(e){u(e)},decodeVertexBuffer:function(e,t,r,n,o){a(i.exports.meshopt_decodeVertexBuffer,e,t,r,n,i.exports[s[o]])},decodeIndexBuffer:function(e,t,r,n){a(i.exports.meshopt_decodeIndexBuffer,e,t,r,n)},decodeIndexSequence:function(e,t,r,n){a(i.exports.meshopt_decodeIndexSequence,e,t,r,n)},decodeGltfBuffer:function(e,t,r,n,o,c){a(i.exports[l[o]],e,t,r,n,i.exports[s[c]])},decodeGltfBufferAsync:function(e,t,r,o,d){return c.length>0?function(e,t,i,r,n){for(var o=c[0],a=1;a<c.length;++a)c[a].pending<o.pending&&(o=c[a]);return new Promise((function(a,s){var l=new Uint8Array(i),c=h++;o.pending+=e,o.requests[c]={resolve:a,reject:s},o.object.postMessage({id:c,count:e,size:t,source:l,mode:r,filter:n},[l.buffer])}))}(e,t,r,l[o],s[d]):n.then((function(){var n=new Uint8Array(e*t);return a(i.exports[l[o]],n,e,t,r,i.exports[s[d]]),n}))}}}(),$4xklQ=parcelRequire("4xklQ"),$8NtlR=parcelRequire("8NtlR"),$ckwVR=parcelRequire("ckwVR"),$1DCdP=parcelRequire("1DCdP"),$4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ");function $480f14906ebb9e14$export$15356c20484a5e31(){throw new Error("BufferGeometryUtils: computeTangents renamed to computeMikkTSpaceTangents.")}function $480f14906ebb9e14$export$676e3e70c930f774(e,t,i=!0){if(!t||!t.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!e.hasAttribute("position")||!e.hasAttribute("normal")||!e.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function r(e){if(e.normalized||e.isInterleavedBufferAttribute){const t=e.isInterleavedBufferAttribute?e.data.array:e.array,i=new Float32Array(e.getCount()*e.itemSize);for(let r=0,n=0;r<e.getCount();r++)i[n++]=$4xklQ.MathUtils.denormalize(e.getX(r),t),i[n++]=$4xklQ.MathUtils.denormalize(e.getY(r),t),e.itemSize>2&&(i[n++]=$4xklQ.MathUtils.denormalize(e.getZ(r),t));return i}return e.array instanceof Float32Array?e.array:new Float32Array(e.array)}const n=e.index?e.toNonIndexed():e,o=t.generateTangents(r(n.attributes.position),r(n.attributes.normal),r(n.attributes.uv));if(i)for(let e=3;e<o.length;e+=4)o[e]*=-1;return n.setAttribute("tangent",new(0,$4xklQ.BufferAttribute)(o,4)),e!==n&&e.copy(n),e}function $480f14906ebb9e14$export$728c051ccdf8a702(e,t=!1){const i=null!==e[0].index,r=new Set(Object.keys(e[0].attributes)),n=new Set(Object.keys(e[0].morphAttributes)),o={},a={},s=e[0].morphTargetsRelative,l=new(0,$4xklQ.BufferGeometry);let c=0;for(let h=0;h<e.length;++h){const d=e[h];let u=0;if(i!==(null!==d.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const e in d.attributes){if(!r.has(e))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+'. All geometries must have compatible attributes; make sure "'+e+'" attribute exists among all geometries, or in none of them.'),null;void 0===o[e]&&(o[e]=[]),o[e].push(d.attributes[e]),u++}if(u!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". Make sure all geometries have the same number of attributes."),null;if(s!==d.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const e in d.morphAttributes){if(!n.has(e))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===a[e]&&(a[e]=[]),a[e].push(d.morphAttributes[e])}if(l.userData.mergedUserData=l.userData.mergedUserData||[],l.userData.mergedUserData.push(d.userData),t){let e;if(i)e=d.index.count;else{if(void 0===d.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". The geometry must have either an index or a position attribute"),null;e=d.attributes.position.count}l.addGroup(c,e,h),c+=e}}if(i){let t=0;const i=[];for(let r=0;r<e.length;++r){const n=e[r].index;for(let e=0;e<n.count;++e)i.push(n.getX(e)+t);t+=e[r].attributes.position.count}l.setIndex(i)}for(const e in o){const t=$480f14906ebb9e14$export$c4eef4c1c9d34ea9(o[e]);if(!t)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+e+" attribute."),null;l.setAttribute(e,t)}for(const e in a){const t=a[e][0].length;if(0===t)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[e]=[];for(let i=0;i<t;++i){const t=[];for(let r=0;r<a[e].length;++r)t.push(a[e][r][i]);const r=$480f14906ebb9e14$export$c4eef4c1c9d34ea9(t);if(!r)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+e+" morphAttribute."),null;l.morphAttributes[e].push(r)}}return l}function $480f14906ebb9e14$export$c4eef4c1c9d34ea9(e){let t,i,r,n=0;for(let o=0;o<e.length;++o){const a=e[o];if(a.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===t&&(t=a.array.constructor),t!==a.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===i&&(i=a.itemSize),i!==a.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===r&&(r=a.normalized),r!==a.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;n+=a.array.length}const o=new t(n);let a=0;for(let t=0;t<e.length;++t)o.set(e[t].array,a),a+=e[t].array.length;return new(0,$4xklQ.BufferAttribute)(o,i,r)}function $480f14906ebb9e14$export$308f9509e428a845(e){let t,i=0,r=0;for(let n=0,o=e.length;n<o;++n){const o=e[n];if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;i+=o.array.length,r+=o.itemSize}const n=new(0,$4xklQ.InterleavedBuffer)(new t(i),r);let o=0;const a=[],s=["getX","getY","getZ","getW"],l=["setX","setY","setZ","setW"];for(let t=0,i=e.length;t<i;t++){const i=e[t],r=i.itemSize,c=i.count,h=new(0,$4xklQ.InterleavedBufferAttribute)(n,r,o,i.normalized);a.push(h),o+=r;for(let e=0;e<c;e++)for(let t=0;t<r;t++)h[l[t]](e,i[s[t]](e))}return a}function $480f14906ebb9e14$export$4b7aa2f2134b7e19(e){const t=e.data.array.constructor,i=e.count,r=e.itemSize,n=e.normalized,o=new t(i*r);let a;a=e.isInstancedInterleavedBufferAttribute?new(0,$4xklQ.InstancedBufferAttribute)(o,r,n,e.meshPerAttribute):new(0,$4xklQ.BufferAttribute)(o,r,n);for(let t=0;t<i;t++)a.setX(t,e.getX(t)),r>=2&&a.setY(t,e.getY(t)),r>=3&&a.setZ(t,e.getZ(t)),r>=4&&a.setW(t,e.getW(t));return a}function $480f14906ebb9e14$export$e7413b17bfaaa80b(e){const t=e.attributes,i=e.morphTargets,r=new Map;for(const e in t){const i=t[e];i.isInterleavedBufferAttribute&&(r.has(i)||r.set(i,$480f14906ebb9e14$export$4b7aa2f2134b7e19(i)),t[e]=r.get(i))}for(const e in i){const t=i[e];t.isInterleavedBufferAttribute&&(r.has(t)||r.set(t,$480f14906ebb9e14$export$4b7aa2f2134b7e19(t)),i[e]=r.get(t))}}function $480f14906ebb9e14$export$35bee7999e19754d(e){let t=0;for(const i in e.attributes){const r=e.getAttribute(i);t+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}const i=e.getIndex();return t+=i?i.count*i.itemSize*i.array.BYTES_PER_ELEMENT:0,t}function $480f14906ebb9e14$export$e36bb98c4c944f9(e,t=1e-4){t=Math.max(t,Number.EPSILON);const i={},r=e.getIndex(),n=e.getAttribute("position"),o=r?r.count:n.count;let a=0;const s=Object.keys(e.attributes),l={},c={},h=[],d=["getX","getY","getZ","getW"];for(let t=0,i=s.length;t<i;t++){const i=s[t];l[i]=[];const r=e.morphAttributes[i];r&&(c[i]=new Array(r.length).fill().map((()=>[])))}const u=Math.log10(1/t),p=Math.pow(10,u);for(let t=0;t<o;t++){const n=r?r.getX(t):t;let o="";for(let t=0,i=s.length;t<i;t++){const i=s[t],r=e.getAttribute(i),a=r.itemSize;for(let e=0;e<a;e++)o+=~~(r[d[e]](n)*p)+","}if(o in i)h.push(i[o]);else{for(let t=0,i=s.length;t<i;t++){const i=s[t],r=e.getAttribute(i),o=e.morphAttributes[i],a=r.itemSize,h=l[i],u=c[i];for(let e=0;e<a;e++){const t=d[e];if(h.push(r[t](n)),o)for(let e=0,i=o.length;e<i;e++)u[e].push(o[e][t](n))}}i[o]=a,h.push(a),a++}}const m=e.clone();for(let t=0,i=s.length;t<i;t++){const i=s[t],r=e.getAttribute(i),n=new r.array.constructor(l[i]),o=new(0,$4xklQ.BufferAttribute)(n,r.itemSize,r.normalized);if(m.setAttribute(i,o),i in c)for(let t=0;t<c[i].length;t++){const r=e.morphAttributes[i][t],n=new r.array.constructor(c[i][t]),o=new(0,$4xklQ.BufferAttribute)(n,r.itemSize,r.normalized);m.morphAttributes[i][t]=o}}return m.setIndex(h),m}function $480f14906ebb9e14$export$5492ca6e5c0c7aa0(e,t){if(t===$4xklQ.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===$4xklQ.TriangleFanDrawMode||t===$4xklQ.TriangleStripDrawMode){let i=e.getIndex();if(null===i){const t=[],r=e.getAttribute("position");if(void 0===r)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<r.count;e++)t.push(e);e.setIndex(t),i=e.getIndex()}const r=i.count-2,n=[];if(t===$4xklQ.TriangleFanDrawMode)for(let e=1;e<=r;e++)n.push(i.getX(0)),n.push(i.getX(e)),n.push(i.getX(e+1));else for(let e=0;e<r;e++)e%2==0?(n.push(i.getX(e)),n.push(i.getX(e+1)),n.push(i.getX(e+2))):(n.push(i.getX(e+2)),n.push(i.getX(e+1)),n.push(i.getX(e)));n.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=e.clone();return o.setIndex(n),o.clearGroups(),o}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}function $480f14906ebb9e14$export$29e54e2e4ab904e7(e){if(!0!==e.geometry.isBufferGeometry)return console.error("THREE.BufferGeometryUtils: Geometry is not of type BufferGeometry."),null;const t=new(0,$4xklQ.Vector3),i=new(0,$4xklQ.Vector3),r=new(0,$4xklQ.Vector3),n=new(0,$4xklQ.Vector3),o=new(0,$4xklQ.Vector3),a=new(0,$4xklQ.Vector3),s=new(0,$4xklQ.Vector3),l=new(0,$4xklQ.Vector3),c=new(0,$4xklQ.Vector3);function h(e,h,d,u,p,m,f,g){t.fromBufferAttribute(h,p),i.fromBufferAttribute(h,m),r.fromBufferAttribute(h,f);const x=e.morphTargetInfluences;if(d&&x){s.set(0,0,0),l.set(0,0,0),c.set(0,0,0);for(let e=0,h=d.length;e<h;e++){const h=x[e],g=d[e];0!==h&&(n.fromBufferAttribute(g,p),o.fromBufferAttribute(g,m),a.fromBufferAttribute(g,f),u?(s.addScaledVector(n,h),l.addScaledVector(o,h),c.addScaledVector(a,h)):(s.addScaledVector(n.sub(t),h),l.addScaledVector(o.sub(i),h),c.addScaledVector(a.sub(r),h)))}t.add(s),i.add(l),r.add(c)}e.isSkinnedMesh&&(e.boneTransform(p,t),e.boneTransform(m,i),e.boneTransform(f,r)),g[3*p+0]=t.x,g[3*p+1]=t.y,g[3*p+2]=t.z,g[3*m+0]=i.x,g[3*m+1]=i.y,g[3*m+2]=i.z,g[3*f+0]=r.x,g[3*f+1]=r.y,g[3*f+2]=r.z}const d=e.geometry,u=e.material;let p,m,f;const g=d.index,x=d.attributes.position,b=d.morphAttributes.position,y=d.morphTargetsRelative,w=d.attributes.normal,v=d.morphAttributes.position,$=d.groups,M=d.drawRange;let S,P,k,_,T,C,A;const D=new Float32Array(x.count*x.itemSize),R=new Float32Array(w.count*w.itemSize);if(null!==g)if(Array.isArray(u))for(S=0,k=$.length;S<k;S++)for(T=$[S],C=Math.max(T.start,M.start),A=Math.min(T.start+T.count,M.start+M.count),P=C,_=A;P<_;P+=3)p=g.getX(P),m=g.getX(P+1),f=g.getX(P+2),h(e,x,b,y,p,m,f,D),h(e,w,v,y,p,m,f,R);else for(C=Math.max(0,M.start),A=Math.min(g.count,M.start+M.count),S=C,k=A;S<k;S+=3)p=g.getX(S),m=g.getX(S+1),f=g.getX(S+2),h(e,x,b,y,p,m,f,D),h(e,w,v,y,p,m,f,R);else if(Array.isArray(u))for(S=0,k=$.length;S<k;S++)for(T=$[S],C=Math.max(T.start,M.start),A=Math.min(T.start+T.count,M.start+M.count),P=C,_=A;P<_;P+=3)p=P,m=P+1,f=P+2,h(e,x,b,y,p,m,f,D),h(e,w,v,y,p,m,f,R);else for(C=Math.max(0,M.start),A=Math.min(x.count,M.start+M.count),S=C,k=A;S<k;S+=3)p=S,m=S+1,f=S+2,h(e,x,b,y,p,m,f,D),h(e,w,v,y,p,m,f,R);return{positionAttribute:x,normalAttribute:w,morphedPositionAttribute:new(0,$4xklQ.Float32BufferAttribute)(D,3),morphedNormalAttribute:new(0,$4xklQ.Float32BufferAttribute)(R,3)}}function $480f14906ebb9e14$export$8babbf41197098b1(e){if(0===e.groups.length)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),e;let t=e.groups;if(t=t.sort(((e,t)=>e.materialIndex!==t.materialIndex?e.materialIndex-t.materialIndex:e.start-t.start)),null===e.getIndex()){const t=e.getAttribute("position"),i=[];for(let e=0;e<t.count;e+=3)i.push(e,e+1,e+2);e.setIndex(i)}const i=e.getIndex(),r=[];for(let e=0;e<t.length;e++){const n=t[e],o=n.start,a=o+n.count;for(let e=o;e<a;e++)r.push(i.getX(e))}e.dispose(),e.setIndex(r);let n=0;for(let e=0;e<t.length;e++){const i=t[e];i.start=n,n+=i.count}let o=t[0];e.groups=[o];for(let i=1;i<t.length;i++){const r=t[i];o.materialIndex===r.materialIndex?o.count+=r.count:(o=r,e.groups.push(o))}return e}function $84baa8ef6849c5a0$export$e1fb14b1a1f43331(e,t,i){const r=e.index,n=e.attributes.position.count,o=r?r.count:n;let a,s=e.groups;0===s.length&&(s=[{count:o,start:0,materialIndex:0}]),a=i.length<=255?new Uint8Array(n):new Uint16Array(n);for(let e=0;e<s.length;e++){const n=s[e],l=n.start,c=n.count,h=Math.min(c,o-l),d=Array.isArray(t)?t[n.materialIndex]:t,u=i.indexOf(d);for(let e=0;e<h;e++){let t=l+e;r&&(t=r.getX(t)),a[t]=u}}return new(0,$4xklQ.BufferAttribute)(a,1,!1)}function $84baa8ef6849c5a0$export$92ddca84bb382733(e,t){if(t)for(const i in e.attributes)t.includes(i)||e.deleteAttribute(i)}function $84baa8ef6849c5a0$export$f5a01205d395aca(e,t){const{attributes:i=[],normalMapRequired:r=!1}=t;if(!e.attributes.normal&&i&&i.includes("normal")&&e.computeVertexNormals(),!e.attributes.uv&&i&&i.includes("uv")){const t=e.attributes.position.count;e.setAttribute("uv",new(0,$4xklQ.BufferAttribute)(new Float32Array(2*t),2,!1))}if(!e.attributes.tangent&&i&&i.includes("tangent"))if(r)null===e.index&&(e=$480f14906ebb9e14$export$e36bb98c4c944f9(e)),e.computeTangents();else{const t=e.attributes.position.count;e.setAttribute("tangent",new(0,$4xklQ.BufferAttribute)(new Float32Array(4*t),4,!1))}if(!e.attributes.color&&i&&i.includes("color")){const t=e.attributes.position.count,i=new Float32Array(4*t);i.fill(1),e.setAttribute("color",new(0,$4xklQ.BufferAttribute)(i,4))}if(!e.index){const t=e.attributes.position.count,i=new Array(t);for(let e=0;e<t;e++)i[e]=e;e.setIndex(i)}}function $84baa8ef6849c5a0$export$a76c5b0332cb1f05(e,t={}){t={attributes:null,cloneGeometry:!0,...t};const i=[],r=new Set;for(let t=0,i=e.length;t<i;t++){const i=e[t];!1!==i.visible&&(Array.isArray(i.material)?i.material.forEach((e=>r.add(e))):r.add(i.material))}const n=Array.from(r);for(let r=0,o=e.length;r<o;r++){const o=e[r];if(!1===o.visible)continue;o.updateMatrixWorld();const a=e[r].geometry,s=t.cloneGeometry?a.clone():a;s.applyMatrix4(o.matrixWorld),$84baa8ef6849c5a0$export$f5a01205d395aca(s,{attributes:t.attributes,normalMapRequired:!!o.material.normalMap}),$84baa8ef6849c5a0$export$92ddca84bb382733(s,t.attributes);const l=$84baa8ef6849c5a0$export$e1fb14b1a1f43331(s,o.material,n);s.setAttribute("materialIndex",l),i.push(s)}const o=new Set;n.forEach((e=>{for(const t in e){const i=e[t];i&&i.isTexture&&o.add(i)}}));return{geometry:$480f14906ebb9e14$export$728c051ccdf8a702(i,!1),materials:n,textures:Array.from(o)}}class $ee4d6a6d20403ee8$export$245b5237bb7038ea{prepScene(e){e=Array.isArray(e)?e:[e];const t=[],i=[];for(let r=0,n=e.length;r<n;r++)e[r].traverse((e=>{if(e.isSkinnedMesh||e.isMesh&&e.morphTargetInfluences){const i=new(0,$8NtlR.StaticGeometryGenerator)(e);i.attributes=["position","color","normal","tangent","uv","uv2"],i.applyWorldTransforms=!1;const r=new(0,$4xklQ.Mesh)(i.generate(),e.material);r.matrixWorld.copy(e.matrixWorld),r.matrix.copy(e.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale),t.push(r)}else e.isMesh?t.push(e):(e.isRectAreaLight||e.isSpotLight)&&i.push(e)}));return{...$84baa8ef6849c5a0$export$a76c5b0332cb1f05(t,{attributes:["position","normal","tangent","uv","color"]}),lights:i}}generate(e,t={}){const{materials:i,textures:r,geometry:n,lights:o}=this.prepScene(e),a={strategy:$ckwVR.SAH,...t,maxLeafTris:1};return{scene:e,materials:i,textures:r,lights:o,bvh:new(0,$1DCdP.MeshBVH)(n,a)}}}var $ckwVR=parcelRequire("ckwVR"),$4xklQ=parcelRequire("4xklQ"),$1DCdP=parcelRequire("1DCdP"),$56aa41d9f63b1df2$exports={},$aeadd62233fa5a57$exports={};$aeadd62233fa5a57$exports=function(e,t,i){if(t===self.location.origin)return e;var r=i?"import "+JSON.stringify(e)+";":"importScripts("+JSON.stringify(e)+");";return URL.createObjectURL(new Blob([r],{type:"application/javascript"}))};let $56aa41d9f63b1df2$var$url=new URL(parcelRequire("dRo73").resolve("6lZac"),import.meta.url);$56aa41d9f63b1df2$exports=$aeadd62233fa5a57$exports($56aa41d9f63b1df2$var$url.toString(),$56aa41d9f63b1df2$var$url.origin,!0);class $c34d76d3d378ee14$export$426cc6213ad628cf{constructor(){this.running=!1,this.worker=new Worker($56aa41d9f63b1df2$exports),this.worker.onerror=e=>{throw e.message?new Error(`GenerateMeshBVHWorker: Could not create Web Worker with error "${e.message}"`):new Error("GenerateMeshBVHWorker: Could not create Web Worker.")}}generate(e,t={}){if(this.running)throw new Error("GenerateMeshBVHWorker: Already running job.");if(null===this.worker)throw new Error("GenerateMeshBVHWorker: Worker has been disposed.");const{worker:i}=this;return this.running=!0,new Promise(((r,n)=>{i.onerror=e=>{n(new Error(`GenerateMeshBVHWorker: ${e.message}`)),this.running=!1},i.onmessage=o=>{this.running=!1;const{data:a}=o;if(a.error)n(new Error(a.error)),i.onmessage=null;else if(a.serialized){const{serialized:n,position:o}=a,s=$1DCdP.MeshBVH.deserialize(n,e,{setIndex:!1}),l=Object.assign({setBoundingBox:!0},t);if(e.attributes.position.array=o,e.index)e.index.array=n.index;else{const t=new(0,$4xklQ.BufferAttribute)(n.index,1,!1);e.setIndex(t)}l.setBoundingBox&&(e.boundingBox=s.getBoundingBox(new(0,$4xklQ.Box3))),r(s),i.onmessage=null}else t.onProgress&&t.onProgress(a.progress)};const o=e.index?e.index.array:null,a=e.attributes.position.array;if(a.isInterleavedBufferAttribute||o&&o.isInterleavedBufferAttribute)throw new Error("GenerateMeshBVHWorker: InterleavedBufferAttribute are not supported for the geometry attributes.");const s=[a];o&&s.push(o),i.postMessage({index:o,position:a,options:{...t,onProgress:null,includedProgressCallback:Boolean(t.onProgress),groups:[...e.groups]}},s.map((e=>e.buffer)))}))}dispose(){this.worker.terminate(),this.worker=null}terminate(){console.warn('GenerateMeshBVHWorker: "terminate" is deprecated. Use "dispose" instead.'),this.dispose()}}class $675ad4be3c3f8bcc$export$5499aeafc5a5667b extends $ee4d6a6d20403ee8$export$245b5237bb7038ea{constructor(){super(),this.bvhGenerator=new $c34d76d3d378ee14$export$426cc6213ad628cf}generate(e,t={}){const{bvhGenerator:i}=this,{geometry:r,materials:n,textures:o,lights:a,spotLights:s}=this.prepScene(e),l={strategy:$ckwVR.SAH,...t,maxLeafTris:1};return i.generate(r,l).then((t=>({scene:e,materials:n,textures:o,lights:a,spotLights:s,bvh:t})))}dispose(){this.bvhGenerator.dispose()}}var $cc4Nq=parcelRequire("cc4Nq");class $50588171089be068$export$6a37e807469f37da{constructor(e){this.editor=e,this.editor.baseRender=this,this.maxSamples=300,this.material="Aluminum",this.denoiseEnabled=!0,this.denoiseSigma=1,this.denoiseThreshold=.1,this.denoiseKSigma=1,this.updateFlag=!1,$("#loading").length>0&&$("#loading").remove(),$("#samples").length>0&&$("#samples").remove();$("body").append("<div id= loading>正在加载</div>"),$("#loading").css({color:"#000",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)","font-weight":"bold","font-size":"32px"}),this.newMain()}generateRadialFloorTexture(e){const t=new Uint8Array(e*e*4);for(let i=0;i<e;i++)for(let r=0;r<e;r++){const n=2*(i/(e-1)-.5),o=2*(r/(e-1)-.5);let a=Math.max(Math.min(1-Math.sqrt(n**2+o**2),1),0);a=a**2,a*=1.5,a=Math.min(a,1);const s=r*e+i;t[4*s+0]=255,t[4*s+1]=255,t[4*s+2]=255,t[4*s+3]=255*a}const i=new $4xklQ.DataTexture(t,e,e);return i.format=$4xklQ.RGBAFormat,i.type=$4xklQ.UnsignedByteType,i.minFilter=$4xklQ.LinearFilter,i.magFilter=$4xklQ.LinearFilter,i.wrapS=$4xklQ.RepeatWrapping,i.wrapT=$4xklQ.RepeatWrapping,i.needsUpdate=!0,i}async newMain(){$(this.editor.dom).empty();let e=new $4xklQ.WebGLRenderer({antialias:!0});e.setSize(window.innerWidth,window.innerHeight),e.setClearColor(16777215,0),e.toneMapping=$4xklQ.ACESFilmicToneMapping,e.outputEncoding=$4xklQ.sRGBEncoding,e.setClearColor(0,0),this.editor.dom.appendChild(e.domElement),this.scene=new(0,$4xklQ.Scene);let t=new $2b66122c32049261$export$196da6cc71a4331(e),i=new $134dfafd06cc9b8a$export$746cbc9e65f5bcb8;t.setSize(window.innerWidth,window.innerHeight);let r="";for(const e in this.editor.cameras)"3dCamera"==this.editor.cameras[e].name&&(r=this.editor.cameras[e]);t.camera=r,t.material=i,t.alpha=!0,this.ptRenderer=t,this.fsQuad=new $0684d9623c4c8e37$export$3983474c8e6e978b(new $4xklQ.MeshBasicMaterial({map:t.target.texture,blending:$4xklQ.CustomBlending,premultipliedAlpha:e.getContextAttributes().premultipliedAlpha})),this.denoiseQuad=new $0684d9623c4c8e37$export$3983474c8e6e978b(new $2d12cfdcbb70f909$export$e6c92f54dc85f279({map:t.target.texture,blending:$4xklQ.CustomBlending,premultipliedAlpha:e.getContextAttributes().premultipliedAlpha})),this.editor.controlsArr[1].object=r,this.editor.controlsArr[1].update(),this.editor.controlsArr[1].addEventListener("change",(()=>{t.reset()})),this.editor.controlsArr[0].enabled=!1,this.editor.controlsArr[1].enabled=!0,this.envMapGenerator=new $510c5bcb198fe0d5$export$13ef63fd7e562136(e),this.renderer=e,this.camera=r;let n=new(0,$4xklQ.Scene);this.scene=n,this.envMapGenerator=new $510c5bcb198fe0d5$export$13ef63fd7e562136(e);const o=new $4xklQ.Group;let a=new(0,$4xklQ.Group);this.editor.wallGroup3D.children.slice(0).forEach((e=>{"3DWall"==e.modelType&&a.add(e.clone()),"CodeModel"==e.modelType&&a.add(this.editor.codeModelCopy(e))}));let s=this.editor.floorGroup.clone();s.children.slice(0).forEach((e=>{0==e.position.z&&e.parent.remove(e)})),o.add(a,this.editor.memberGroup3D.clone(),s,this.editor.model3D.clone()),this.materials=[];const l=new $675ad4be3c3f8bcc$export$5499aeafc5a5667b,c=await l.generate(o,{onProgress:e=>{let t=Math.floor(100*e);$("#loading").html("加载中 : "+t+"%"),100==t&&$("#loading").html("解析中...")}});c.scene.traverse((e=>{e.layers.set(2)})),this.scene.add(c.scene),this.result=c;const{bvh:h,textures:d,materials:u}=c,p=h.geometry,m=t.material;m.bvh.updateFrom(h),m.normalAttribute.updateFrom(p.attributes.normal),m.tangentAttribute.updateFrom(p.attributes.tangent),m.uvAttribute.updateFrom(p.attributes.uv),m.materialIndexAttribute.updateFrom(p.attributes.materialIndex),m.textures.setTextures(e,2048,2048,d),m.materials.updateFrom(u,d),l.dispose();let f=this;const g=new Promise((e=>{(new $7aa643e6dde9017b$export$d076a711b55c758a).load("https://rjhcdn.bsphpro.com/ocean/static/3d-demo-data/hdri/hilly_terrain_01_1k.hdr",(t=>{f.updateEnvBlur(t),f.ptRenderer.reset(),e()}))})),x=fetch("https://rjhcdn.bsphpro.com/ocean/static/3d-demo-data/materials/material.json").then((e=>e.json())).then((e=>{this.database={},e.forEach((e=>{this.database[e.name]=e}))}));await Promise.all([x,g]),$("#loading").html("解析中..."),$("#loading").html("Loading : 解析完成"),document.getElementById("loading").remove();const b=new(0,$cc4Nq.GUI),y=Object.keys(this.database);this.material=y[0];let w={"材质":this.material,"降噪":this.denoiseEnabled,"去噪Sigma":this.denoiseSigma,"去噪Threshold":this.denoiseThreshold,"去噪KSigma":this.denoiseKSigma,samples:this.maxSamples};b.add(w,"材质",y).onChange((e=>{this.material=e,f.ptRenderer.reset()})),b.add(w,"samples",50,2e3).step(1).onChange((e=>{this.maxSamples=e,this.updateFlag=!0}));const v=b.addFolder("Denoising");v.add(w,"降噪").onChange((e=>{this.denoiseEnabled=e,this.updateFlag=!0})),v.add(w,"去噪Sigma",.01,5).onChange((e=>{this.denoiseSigma=e,this.updateFlag=!0})),v.add(w,"去噪Threshold",.01,1).onChange((e=>{this.denoiseThreshold=e,this.updateFlag=!0})),v.add(w,"去噪KSigma",0,12).onChange((e=>{this.denoiseKSigma=e,this.updateFlag=!0})),$(".lil-gui.autoPlace").css({width:"13%",position:"fixed",right:"240px",top:"55px","z-index":"1001"}),$(".lil-gui .controller .widget").css({width:"48%","margin-left":"40px"}),b.open(),this.animate()}async main(){$(this.editor.dom).empty();let e=new $4xklQ.WebGLRenderer({antialias:!0});e.setSize(window.innerWidth,window.innerHeight),e.setClearColor(16777215,0),e.toneMapping=$4xklQ.ACESFilmicToneMapping,e.outputEncoding=$4xklQ.sRGBEncoding,e.setClearColor(0,0),this.editor.dom.appendChild(e.domElement),this.scene=new(0,$4xklQ.Scene);let t=new $2b66122c32049261$export$196da6cc71a4331(e),i=new $134dfafd06cc9b8a$export$746cbc9e65f5bcb8;t.setSize(window.innerWidth,window.innerHeight);let r=this.editor.camera;t.camera=r,t.material=i,t.alpha=!0,this.ptRenderer=t,this.fsQuad=new $0684d9623c4c8e37$export$3983474c8e6e978b(new $4xklQ.MeshBasicMaterial({map:t.target.texture,blending:$4xklQ.CustomBlending,premultipliedAlpha:e.getContextAttributes().premultipliedAlpha})),this.denoiseQuad=new $0684d9623c4c8e37$export$3983474c8e6e978b(new $2d12cfdcbb70f909$export$e6c92f54dc85f279({map:t.target.texture,blending:$4xklQ.CustomBlending,premultipliedAlpha:e.getContextAttributes().premultipliedAlpha})),this.editor.controlsArr[1].object=r,this.editor.controlsArr[1].update(),this.editor.controlsArr[1].addEventListener("change",(()=>{t.reset()})),this.envMapGenerator=new $510c5bcb198fe0d5$export$13ef63fd7e562136(e),this.renderer=e,this.camera=r;let n=new(0,$4xklQ.Scene);this.scene=n,this.envMapGenerator=new $510c5bcb198fe0d5$export$13ef63fd7e562136(e);let o=this;const a=new Promise((e=>{(new $7aa643e6dde9017b$export$d076a711b55c758a).load("https://rjhcdn.bsphpro.com/ocean/static/3d-demo-data/hdri/hilly_terrain_01_1k.hdr",(t=>{o.updateEnvBlur(t),o.ptRenderer.reset(),e()}))})),s=new $675ad4be3c3f8bcc$export$5499aeafc5a5667b,l=(new(0,$hu0fb.GLTFLoader)).setMeshoptDecoder($02720af05ebc5d11$export$1111800106ba519a).loadAsync("https://rjhcdn.bsphpro.com/ocean/static/3d-demo-data/models/material-balls/glass.glb").then((e=>{const t=new $4xklQ.Group;e.scene.scale.setScalar(.01),e.scene.updateMatrixWorld();const i=new $4xklQ.Box3;i.setFromObject(e.scene);const r=new $4xklQ.Mesh(new $4xklQ.CylinderBufferGeometry(3,3,.05,200),new $4xklQ.MeshPhysicalMaterial({color:16777215,roughness:0,metalness:.25}));r.geometry=r.geometry.toNonIndexed(),r.geometry.clearGroups(),r.position.y=i.min.y-.03;let n=this.editor.wallGroup3D.clone(),o=this.editor.wallGroup3D.children.slice(0),a=n.children,l=0;a.forEach((e=>{let t=o[l];if("CodeModel"==t.modelType){let i=e.children.slice(0),r=t.children.slice(0).length;e.children.splice(0,i.length-r)}l++}));let c=this.editor.floorGroup.clone();c.children.slice(0).forEach((e=>{0==e.position.z&&e.parent.remove(e)})),t.add(n,this.editor.memberGroup3D.clone(),c,this.editor.model3D.clone());const h=new $4xklQ.MeshPhysicalMaterial,d=new $4xklQ.MeshPhysicalMaterial;return e.scene.traverse((e=>{e.geometry&&e.geometry.computeVertexNormals(),"Sphere_1"===e.name?e.material=d:e.material=h,"subsphere_1"===e.name&&(e.material=d)})),this.materials=[h,d,r.material],s.generate(t,{onProgress:e=>{let t=Math.floor(100*e);$("#loading").html("加载中 : "+t+"%"),100==t&&$("#loading").html("解析中...")}})})).then((i=>{i.scene.traverse((e=>{e.layers.set(2)})),this.scene.add(i.scene),this.result=i;const{bvh:r,textures:n,materials:o}=i,a=r.geometry,l=t.material;l.bvh.updateFrom(r),l.normalAttribute.updateFrom(a.attributes.normal),l.tangentAttribute.updateFrom(a.attributes.tangent),l.uvAttribute.updateFrom(a.attributes.uv),l.materialIndexAttribute.updateFrom(a.attributes.materialIndex),l.textures.setTextures(e,2048,2048,n),l.materials.updateFrom(o,n),s.dispose()})),c=fetch("https://rjhcdn.bsphpro.com/ocean/static/3d-demo-data/materials/material.json").then((e=>e.json())).then((e=>{this.database={},e.forEach((e=>{this.database[e.name]=e}))}));await Promise.all([c,l,a]),$("#loading").html("解析中..."),$("#loading").html("Loading : 解析完成"),document.getElementById("loading").remove();const h=new(0,$cc4Nq.GUI),d=Object.keys(this.database);this.material=d[0];let u={"材质":this.material,"降噪":this.denoiseEnabled,"去噪Sigma":this.denoiseSigma,"去噪Threshold":this.denoiseThreshold,"去噪KSigma":this.denoiseKSigma,samples:this.maxSamples};h.add(u,"材质",d).onChange((e=>{this.material=e,o.ptRenderer.reset()})),h.add(u,"samples",50,2e3).step(1).onChange((e=>{this.maxSamples=e,this.updateFlag=!0}));const p=h.addFolder("Denoising");p.add(u,"降噪").onChange((e=>{this.denoiseEnabled=e,this.updateFlag=!0})),p.add(u,"去噪Sigma",.01,5).onChange((e=>{this.denoiseSigma=e,this.updateFlag=!0})),p.add(u,"去噪Threshold",.01,1).onChange((e=>{this.denoiseThreshold=e,this.updateFlag=!0})),p.add(u,"去噪KSigma",0,12).onChange((e=>{this.denoiseKSigma=e,this.updateFlag=!0})),$(".lil-gui.autoPlace").css({width:"13%",position:"fixed",right:"240px",top:"55px","z-index":"1001"}),$(".lil-gui .controller .widget").css({width:"48%","margin-left":"40px"}),h.open(),this.animate()}onkeydown(e){if([87,83,65,68,69,81].indexOf(1*e.keyCode)<0)return;var t=new $4xklQ.Vector3;this.camera.getWorldDirection(t);let i=.1,r=new(0,$4xklQ.Vector3)(t.z,t.y,-t.x),n=new(0,$4xklQ.Vector3)(0,1,0),o=this.camera.position.clone();"87"==e.keyCode?(this.camera.position.add(t.multiplyScalar(i)),this.camera.position.y=o.y):"83"==e.keyCode?(this.camera.position.add(t.multiplyScalar(-.1)),this.camera.position.y=o.y):"65"==e.keyCode?(this.camera.position.add(r.multiplyScalar(i)),this.camera.position.y=o.y):"68"==e.keyCode?(this.camera.position.add(r.multiplyScalar(-.1)),this.camera.position.y=o.y):"69"==e.keyCode?this.camera.position.add(n.multiplyScalar(i)):"81"==e.keyCode&&this.camera.position.add(n.multiplyScalar(-.1)),this.camera.updateProjectionMatrix(),this.ptRenderer.reset()}updateEnvBlur(e){const t=this.envMapGenerator.generate(e,0);this.ptRenderer.material.envMapInfo.updateFrom(t),this.scene.environment=t,this.scene.background=t}applyMaterialInfo(e,t){t.color.set(16777215),t.transmission=0,t.attenuationDistance=1/0,t.attenuationColor.set(16777215),t.specularColor.set(16777215),t.metalness=0,t.roughness=1,t.ior=1.5,t.thickness=1,e.specularColor&&t.specularColor.setRGB(...e.specularColor),"metalness"in e&&(t.metalness=e.metalness),"roughness"in e&&(t.roughness=e.roughness),"ior"in e&&(t.ior=e.ior),"transmission"in e&&(t.transmission=e.transmission),t.transmission?(e.color&&t.attenuationColor.setRGB(...e.color),t.attenuationDistance=200/e.density):e.color&&t.color.setRGB(...e.color)}animate(){if(!this.editor.baseRender)return;if(requestAnimationFrame(this.animate.bind(this)),this.ptRenderer.samples>this.maxSamples&&!this.updateFlag)return;if(0==$("#sampele").length){let e="<div id= sampele>sampeles:0</div>";$("body").append(e),$("#sampele").css({color:"#000",position:"absolute",top:"90%",left:"82%",transform:"translate(-50%, -50%)","font-size":"20px"})}$("#sampele").text("samples:"+this.ptRenderer.samples),this.updateFlag=!1,this.renderer.render(this.scene,this.camera);const e=this.database[this.material];if(this.materials.length>0){const[t,i]=this.materials;this.applyMaterialInfo(e,t),i.color.setRGB(.5,.5,.5).convertSRGBToLinear(),i.roughness=1,i.metalness=0}this.ptRenderer.material.materials.updateFrom(this.result.materials,this.result.textures),this.ptRenderer.material.filterGlossyFactor=.5,this.ptRenderer.material.environmentIntensity=1,this.ptRenderer.material.backgroundBlur=.1,this.ptRenderer.material.bounces=15,this.ptRenderer.material.physicalCamera.updateFrom(this.camera),this.camera.updateMatrixWorld(),this.scene.background=this.scene.environment,this.ptRenderer.update(),this.ptRenderer.samples<1&&this.renderer.render(this.scene,this.camera),this.denoiseQuad.material.sigma=this.denoiseSigma,this.denoiseQuad.material.threshold=this.denoiseThreshold,this.denoiseQuad.material.kSigma=this.denoiseKSigma;const t=this.denoiseEnabled?this.denoiseQuad:this.fsQuad;this.renderer.autoClear=!1,t.material.map=this.ptRenderer.target.texture,t.render(this.renderer),this.renderer.autoClear=!0}}var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ"),$90poP=parcelRequire("90poP"),$1cnge=parcelRequire("1cnge"),$9HO6e=parcelRequire("9HO6e"),$4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ");parcelRequire("9QhXH");class $e3212e52653b49d1$export$919db86739867624{static createCamera(e=!1){let t=new $4xklQ.Group;var{object:i,update:r}=$e3212e52653b49d1$export$919db86739867624.renderSVG('<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 28 28" id="camera-hover" width="28" height="28"><g fill="#675D50" fill-rule="evenodd" stroke="#FFF"><path d="M17.5 7A2.5 2.5 0 0015 4.5H7A2.5 2.5 0 004.5 7v14A2.5 2.5 0 007 23.5h8a2.5 2.5 0 002.5-2.5V7zM23.5 7.717a.5.5 0 00-.741-.438l-4.482 2.468a1.5 1.5 0 00-.777 1.314v5.888a1.5 1.5 0 00.777 1.314l4.482 2.468a.5.5 0 00.741-.438V7.717z"></path></g></svg>');i.scale.set(60,60,1);let n=(new $4xklQ.Box3).setFromObject(i).getSize(new $4xklQ.Vector3);i.position.x=n.x/2,i.position.y+=n.y/2+250,i.rotateZ(Math.PI),i.renderOrder=5,t.add(i),i.name="nosc",t.nosc=i;var{object:i,update:r}=$e3212e52653b49d1$export$919db86739867624.renderSVG('<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 28 28" id="camera-hover" width="28" height="28"><g fill="#338BFF" fill-rule="evenodd" stroke="#FFF"><path d="M17.5 7A2.5 2.5 0 0015 4.5H7A2.5 2.5 0 004.5 7v14A2.5 2.5 0 007 23.5h8a2.5 2.5 0 002.5-2.5V7zM23.5 7.717a.5.5 0 00-.741-.438l-4.482 2.468a1.5 1.5 0 00-.777 1.314v5.888a1.5 1.5 0 00.777 1.314l4.482 2.468a.5.5 0 00.741-.438V7.717z"></path></g></svg>');i.scale.set(60,60,1),i.position.x=n.x/2,i.position.y+=n.y/2+250,i.rotateZ(Math.PI),t.add(i),i.name="nosc_move",t.nosc_move=i,i.visible=!1,i.renderOrder=5;let o=4e3,a=150/180*Math.PI;e&&(a=.75*Math.PI);let s=new $4xklQ.Mesh(new $4xklQ.CircleGeometry(o,32,a,2*(Math.PI-a)),new $4xklQ.MeshBasicMaterial({color:"#305086",side:2,transparent:!0}));s.position.set(-n.x/2-200,0,0),t.add(s);let l=new $4xklQ.Mesh(new $4xklQ.CircleGeometry(o,32,a,2*(Math.PI-a)),new $4xklQ.MeshBasicMaterial({color:"#15171A",side:2,transparent:!0,opacity:.8}));l.name="circle",l.position.set(-n.x/2-200,0,0),t.add(l),t.circleMesh=l,l.visible=!1,e&&(s.visible=!1,s.name="circle_move",t.circle_move=s,l.visible=!0,s.material.opacity=.8);var{object:i,update:r}=$e3212e52653b49d1$export$919db86739867624.renderSVG('<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 60 132" id="rotate" width="100" height="150"><g fill="#1E2329" fill-opacity=".5" fill-rule="evenodd" stroke="#FFF" stroke-width="30" transform="rotate(90 28.5 28.5)"><path d="M129.384 26.898L103.5 45.11V8.872l25.884 18.026zM2.616 26.898L28.5 45.11V8.873L2.616 26.898z"></path><circle cx="66" cy="27" r="25.5"></circle></g></svg>');i.scale.x=15,i.scale.y=15,i.position.x=-5600,i.position.y-=900,i.name="nosr",t.add(i),t.nosr=i;var{object:i,update:r}=$e3212e52653b49d1$export$919db86739867624.renderSVG('<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 60 132" id="rotate" width="100" height="150"><g fill="#338BFF" fill-opacity=".5" fill-rule="evenodd" stroke="#FFF" stroke-width="30" transform="rotate(90 28.5 28.5)"><path d="M129.384 26.898L103.5 45.11V8.872l25.884 18.026zM2.616 26.898L28.5 45.11V8.873L2.616 26.898z"></path><circle cx="66" cy="27" r="25.5"></circle></g></svg>');return i.scale.x=15,i.scale.y=15,i.position.x=-5600,i.position.y-=900,i.name="nosr_move",i.visible=!1,t.nosr_move=i,t.add(i),t}static renderSVG(e){const t=(new $22831dcc74231be4$export$959ae9097e74a233).parse(e),i=new $4xklQ.Group,r=[],n=new $4xklQ.LineBasicMaterial({color:"#FFF",transparent:!0});return t.paths.forEach((e=>{const t=$22831dcc74231be4$export$959ae9097e74a233.createShapes(e),o=new $4xklQ.MeshBasicMaterial({color:e.color,transparent:!0,side:$4xklQ.DoubleSide});t.forEach((e=>{const t=new $4xklQ.ExtrudeBufferGeometry(e,{depth:1}),a=new $4xklQ.EdgesGeometry(t),s=new $4xklQ.Mesh(t,o),l=new $4xklQ.LineSegments(a,n);l.renderOrder=100,r.push({shape:e,mesh:s,lines:l}),i.add(s,l)}))})),i.applyMatrix4((new $4xklQ.Matrix4).makeScale(50,50,1)),{object:i,update(e){r.forEach((t=>{const i=new $4xklQ.ExtrudeBufferGeometry(t.shape,{depth:e,bevelEnabled:!1}),r=new $4xklQ.EdgesGeometry(i);t.mesh.geometry.dispose(),t.lines.geometry.dispose(),t.mesh.geometry=i,t.lines.geometry=r}))}}}}class $93515037b4aa0d1f$export$7da8f54b9c0f630c{constructor(e){this.container=e,this.floorHei=2800,this.width=240,this.height=216,this.uiPanelBox=new $2a0c8f99fe7360a8$export$ab8ce44154d5decc,this.uiPanelBox.setWidth(this.width+"px"),this.uiPanelBox.setHeight(this.height+"px"),this.container.appendChild(this.uiPanelBox.dom),this.camera=new(0,$4xklQ.OrthographicCamera)(-1e4,1e4,5e3,-5e3,0,1e3);let t=this.width/this.height,i=-5e3;this.camera.left=i*t,this.camera.right=-i*t,this.camera.top=-i,this.camera.bottom=i,this.camera.position.set(0,0,1e3),this.camera.lookAt(new(0,$1cnge.Vector3)(0,0,0)),this.raycaster=new $4xklQ.Raycaster,this.scene=new(0,$4xklQ.Scene),this.renderer="";const r=new(0,$4xklQ.PlaneGeometry)(2e5,2e5),n=new(0,$4xklQ.MeshBasicMaterial)({color:16777215,roughness:1,metalness:0,transparent:!0,opacity:0});this.floor=new(0,$4xklQ.Mesh)(r,n),this.scene.add(this.floor),this.createRenderer();let o=$e3212e52653b49d1$export$919db86739867624.createCamera();o.name="cameraGroup",o.position.x=4800,this.cameraGroup=o,editor.renderCameraGroup=o,this.scene.add(o);let a=new(0,$1cnge.Vector3)(0,4500,0),s=new(0,$1cnge.Vector3)(0,-4500,0),l=(new $d0f874000594cf7a$export$a955f3d6a39ce4b2).createLineDimensionsLine(a,s,!0,100,"#fff");l.position.x=4800,this.scene.add(l),$("#cemeraHeight").val(Math.round(1e3*editor.renderViewCamera.position.y)+"mm");let c=editor.getRenderCameraAngle();isNaN(c)||$("#cemeraAngle").val(c+"°");let h=new $2a0c8f99fe7360a8$export$3dc21c16dab61cf7("0mm",!1).setMarginTop(this.height-20+"px").setMarginLeft(this.width-60+"px").setFontSize("10px").setWidth("10px").setFontWeight("1"),d=new $2a0c8f99fe7360a8$export$3dc21c16dab61cf7(this.floorHei+"mm",!1).setMarginTop("5px").setMarginLeft(this.width-80+"px").setFontSize("10px").setWidth("10px").setFontWeight("1");this.uiPanelBox.add(h,d),this.camera.updateProjectionMatrix(),e.addEventListener("mousedown",this.onMouseDown.bind(this)),document.body.addEventListener("mouseup",this.onMouseUp.bind(this)),e.addEventListener("mousemove",this.mouseMove.bind(this))}onMouseDown(){let e=this.getObject(event);e.length>0&&(this.downSel=e[0].object.parent)}onMouseUp(){this.downSel=""}mouseMove(e){let t=this.getObject(e);if(t.length>0){let e=t[0].object.parent,r=this.cameraGroup[e.name+"_move"];if(r?r.visible=!0:this.cameraGroup.children.forEach((e=>{e.name.indexOf("_move")>=0&&(e.visible=!1)})),this.downSel){let e=t[0].point.clone();if("nosc"==this.downSel.name){e.y>4e3&&(e.y=4e3),e.y<-4e3&&(e.y=-4e3),this.cameraGroup.position.y=e.y;let t=Math.round(this.floorHei*(e.y+4e3)/8e3);editor.renderViewCamera.position.y=t/1e3,editor.renderViewControl.target.y=t/1e3;let i=Math.round(1e3*editor.renderViewCamera.position.y);$("#cemeraHeight").val()!=i+"mm"&&$("#cemeraHeight").val(i+"mm")}else if("nosr"==this.downSel.name){let t=this.cameraGroup.position.clone(),r=new(0,$90poP.Vector2)(e.x,e.y),n=new(0,$90poP.Vector2)(t.x,t.y),o=r.sub(n).angle();o-=Math.PI,o>Math.PI/2&&(o=Math.PI/2),o<-Math.PI/2&&(o=-Math.PI/2);var i=new $4xklQ.Vector3;editor.renderViewCamera.getWorldDirection(i);let a=-editor.renderViewCamera.position.clone().distanceTo(i)*Math.sin(o);editor.renderViewControl.target.set(i.x,i.y+a,i.z);let s=editor.getRenderCameraAngle();isNaN(s)||($("#cemeraAngle").val(s+"°"),s>=-5&&s<=5&&(editor.renderViewControl.target.y=editor.renderViewCamera.position.y))}editor.renderViewCamera.updateProjectionMatrix(),editor.renderViewControl.update()}}}createRenderer(){let e=new(0,$4xklQ.WebGLRenderer)({antialias:!0,preserveDrawingBuffer:!0});e.shadowMap.enabled=!0,e.shadowMap.type=$4xklQ.PCFSoftShadowMap,e.setPixelRatio(window.devicePixelRatio),e.setSize(this.width,this.height),e.setClearColor("#2A2E34"),e.xr.enabled=!0,e.outputEncoding=$4xklQ.sRGBEncoding,this.renderer=e,this.container.appendChild(this.renderer.domElement),this.animate()}animate(){this.renderer.setAnimationLoop(this.render.bind(this))}render(){if(this.renderer.render(this.scene,this.camera),!editor.renderViewCamera.isOrthographicCamera){let e=editor.renderViewControl.target.clone().sub(editor.renderViewCamera.position),t=$9HO6e.UtilCore.calculateAngleWithHorizontalPlane(e);if(isNaN(t))return;editor.renderViewCamera.position.y<editor.renderViewControl.target.y&&(t*=-1),t>=-5*Math.PI/180&&t<=5*Math.PI/180&&(t=0),this.cameraGroup.rotation.z=t,this.cameraGroup.position.y=8e6*editor.renderViewCamera.position.y/this.floorHei-4e3}}getScreen(e,t){let i=e.project(t),r=window.innerWidth/2,n=(window.innerHeight-52)/2;return[Math.round(i.x*r+r),Math.round(-i.y*n+n)]}getObject(e){let t=new(0,$1cnge.Vector3);this.domRect=this.container.getBoundingClientRect(),t.x=(e.clientX+17+this.width-window.innerWidth)/this.width*2-1,t.y=-(e.clientY-120-this.height)/this.height*2+1,t.z=0,this.raycaster.setFromCamera(t,this.camera);let i=[this.floor];return this.cameraGroup.children.forEach((e=>{"Group"==e.type&&e.visible&&i.push(e)})),this.raycaster.intersectObjects(i,!0)}}var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ"),$9HO6e=parcelRequire("9HO6e");const $dc94d71b7cc06198$var$_changeEvent={type:"change"},$dc94d71b7cc06198$var$_startEvent={type:"start"},$dc94d71b7cc06198$var$_endEvent={type:"end"};class $dc94d71b7cc06198$export$8ff7788029dfdf52 extends $4xklQ.EventDispatcher{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new(0,$4xklQ.Vector3),this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:$4xklQ.MOUSE.ROTATE,MIDDLE:$4xklQ.MOUSE.DOLLY,RIGHT:$4xklQ.MOUSE.PAN},this.touches={ONE:$4xklQ.TOUCH.ROTATE,TWO:$4xklQ.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",z),this._domElementKeyEvents=e},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent($dc94d71b7cc06198$var$_changeEvent),i.update(),n=r.NONE},this.update=function(){const t=new(0,$4xklQ.Vector3),d=(new(0,$4xklQ.Quaternion)).setFromUnitVectors(e.up,new(0,$4xklQ.Vector3)(0,1,0)),u=d.clone().invert(),p=new(0,$4xklQ.Vector3),m=new(0,$4xklQ.Quaternion),f=2*Math.PI;return function(){const e=i.object.position;t.copy(e).sub(i.target),t.applyQuaternion(d),a.setFromVector3(t),i.autoRotate&&n===r.NONE&&S(2*Math.PI/60/60*i.autoRotateSpeed),i.enableDamping?(a.theta+=s.theta*i.dampingFactor,a.phi+=s.phi*i.dampingFactor):(a.theta+=s.theta,a.phi+=s.phi);let g=i.minAzimuthAngle,x=i.maxAzimuthAngle;return isFinite(g)&&isFinite(x)&&(g<-Math.PI?g+=f:g>Math.PI&&(g-=f),x<-Math.PI?x+=f:x>Math.PI&&(x-=f),a.theta=g<=x?Math.max(g,Math.min(x,a.theta)):a.theta>(g+x)/2?Math.max(g,a.theta):Math.min(x,a.theta)),a.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=l,a.radius=Math.max(i.minDistance,Math.min(i.maxDistance,a.radius)),!0===i.enableDamping?i.target.addScaledVector(c,i.dampingFactor):i.target.add(c),t.setFromSpherical(a),t.applyQuaternion(u),e.copy(i.target).add(t),i.object.lookAt(i.target),!0===i.enableDamping?(s.theta*=1-i.dampingFactor,s.phi*=1-i.dampingFactor,c.multiplyScalar(1-i.dampingFactor)):(s.set(0,0,0),c.set(0,0,0)),l=1,!!(h||p.distanceToSquared(i.object.position)>o||8*(1-m.dot(i.object.quaternion))>o)&&(i.dispatchEvent($dc94d71b7cc06198$var$_changeEvent),p.copy(i.object.position),m.copy(i.object.quaternion),h=!1,!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",G),i.domElement.removeEventListener("pointerdown",O),i.domElement.removeEventListener("pointercancel",F),i.domElement.removeEventListener("wheel",Q),i.domElement.removeEventListener("pointermove",W),i.domElement.removeEventListener("pointerup",H),null!==i._domElementKeyEvents&&i._domElementKeyEvents.removeEventListener("keydown",z)};const i=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let n=r.NONE;const o=1e-6,a=new(0,$4xklQ.Spherical),s=new(0,$4xklQ.Spherical);let l=1;const c=new(0,$4xklQ.Vector3);let h=!1;const d=new(0,$4xklQ.Vector2),u=new(0,$4xklQ.Vector2),p=new(0,$4xklQ.Vector2),m=new(0,$4xklQ.Vector2),f=new(0,$4xklQ.Vector2),g=new(0,$4xklQ.Vector2),x=new(0,$4xklQ.Vector2),b=new(0,$4xklQ.Vector2),y=new(0,$4xklQ.Vector2),w=[],v={};function M(){return Math.pow(.95,i.zoomSpeed)}function S(e){s.theta-=e}const P=function(){const e=new(0,$4xklQ.Vector3);return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),c.add(e)}}(),k=function(){const e=new(0,$4xklQ.Vector3);return function(t,r){!0===i.screenSpacePanning?e.setFromMatrixColumn(r,1):(e.setFromMatrixColumn(r,0),e.crossVectors(i.object.up,e)),e.multiplyScalar(t),c.add(e)}}(),_=function(){const e=new(0,$4xklQ.Vector3);return function(t,r){const n=i.domElement;if(i.object.isPerspectiveCamera){const o=i.object.position;e.copy(o).sub(i.target);let a=e.length();a*=Math.tan(i.object.fov/2*Math.PI/180),P(2*t*a/n.clientHeight,i.object.matrix),k(2*r*a/n.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(P(t*(i.object.right-i.object.left)/i.object.zoom/n.clientWidth,i.object.matrix),k(r*(i.object.top-i.object.bottom)/i.object.zoom/n.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function T(e){i.object.isPerspectiveCamera?l/=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*e)),i.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function C(e){i.object.isPerspectiveCamera?l*=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/e)),i.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function A(e){d.set(e.clientX,e.clientY)}function D(e){m.set(e.clientX,e.clientY)}function R(){if(1===w.length)d.set(w[0].pageX,w[0].pageY);else{const e=.5*(w[0].pageX+w[1].pageX),t=.5*(w[0].pageY+w[1].pageY);d.set(e,t)}}function E(){if(1===w.length)m.set(w[0].pageX,w[0].pageY);else{const e=.5*(w[0].pageX+w[1].pageX),t=.5*(w[0].pageY+w[1].pageY);m.set(e,t)}}function L(){const e=w[0].pageX-w[1].pageX,t=w[0].pageY-w[1].pageY,i=Math.sqrt(e*e+t*t);x.set(0,i)}function I(e){if(1==w.length)u.set(e.pageX,e.pageY);else{const t=j(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);u.set(i,r)}p.subVectors(u,d).multiplyScalar(i.rotateSpeed);const t=i.domElement;var r;S(2*Math.PI*p.x/t.clientHeight),r=2*Math.PI*p.y/t.clientHeight,s.phi-=r,d.copy(u)}function B(e){if(1===w.length)f.set(e.pageX,e.pageY);else{const t=j(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);f.set(i,r)}g.subVectors(f,m).multiplyScalar(i.panSpeed),_(g.x,g.y),m.copy(f)}function V(e){const t=j(e),r=e.pageX-t.x,n=e.pageY-t.y,o=Math.sqrt(r*r+n*n);b.set(0,o),y.set(0,Math.pow(b.y/x.y,i.zoomSpeed)),T(y.y),x.copy(b)}function O(e){!1!==i.enabled&&(0===w.length&&(i.domElement.setPointerCapture(e.pointerId),i.domElement.addEventListener("pointermove",W),i.domElement.addEventListener("pointerup",H)),function(e){w.push(e)}(e),"touch"===e.pointerType?function(e){switch(U(e),w.length){case 1:switch(i.touches.ONE){case $4xklQ.TOUCH.ROTATE:if(!1===i.enableRotate)return;R(),n=r.TOUCH_ROTATE;break;case $4xklQ.TOUCH.PAN:if(!1===i.enablePan)return;E(),n=r.TOUCH_PAN;break;default:n=r.NONE}break;case 2:switch(i.touches.TWO){case $4xklQ.TOUCH.DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;i.enableZoom&&L(),i.enablePan&&E(),n=r.TOUCH_DOLLY_PAN;break;case $4xklQ.TOUCH.DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;i.enableZoom&&L(),i.enableRotate&&R(),n=r.TOUCH_DOLLY_ROTATE;break;default:n=r.NONE}break;default:n=r.NONE}n!==r.NONE&&i.dispatchEvent($dc94d71b7cc06198$var$_startEvent)}(e):function(e){let t,o=new(0,$4xklQ.Vector2)(editor.renderViewCamera.position.x,editor.renderViewCamera.position.z),a=new(0,$4xklQ.Vector2)(editor.renderViewControl.target.x,editor.renderViewControl.target.z),s=o.distanceTo(a);switch(editor.renderViewCamera.oldDis=s,e.button){case 0:t=i.mouseButtons.LEFT;break;case 1:t=i.mouseButtons.MIDDLE;break;case 2:t=i.mouseButtons.RIGHT;break;default:t=-1}switch(t){case $4xklQ.MOUSE.DOLLY:if(!1===i.enableZoom)return;!function(e){x.set(e.clientX,e.clientY)}(e),n=r.DOLLY;break;case $4xklQ.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enablePan)return;D(e),n=r.PAN}else{if(!1===i.enableRotate)return;A(e),n=r.ROTATE}break;case $4xklQ.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enableRotate)return;A(e),n=r.ROTATE}else{if(!1===i.enablePan)return;D(e),n=r.PAN}break;default:n=r.NONE}n!==r.NONE&&i.dispatchEvent($dc94d71b7cc06198$var$_startEvent)}(e))}function W(e){!1!==i.enabled&&("touch"===e.pointerType?function(e){switch(U(e),n){case r.TOUCH_ROTATE:if(!1===i.enableRotate)return;I(e),i.update();break;case r.TOUCH_PAN:if(!1===i.enablePan)return;B(e),i.update();break;case r.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;!function(e){i.enableZoom&&V(e),i.enablePan&&B(e)}(e),i.update();break;case r.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;!function(e){i.enableZoom&&V(e),i.enableRotate&&I(e)}(e),i.update();break;default:n=r.NONE}}(e):function(e){switch(n){case r.ROTATE:if(!1===i.enableRotate)return;!function(e){if(editor.list.horizontalLine.dispatch("#ff0000","red"),u.set(e.clientX,e.clientY),u.x==d.x&&u.y==d.y)return;p.subVectors(u,d).multiplyScalar(i.rotateSpeed),i.domElement;let t=!0,r=new(0,$4xklQ.Vector2)(editor.renderViewCamera.position.x,editor.renderViewCamera.position.z),n=new(0,$4xklQ.Vector2)(editor.renderViewControl.target.x,editor.renderViewControl.target.z),o=r.distanceTo(n);editor.renderViewCamera.oldDis&&(o=editor.renderViewCamera.oldDis);let a=1*Math.PI/180,s=o*Math.tan(a);u.y>d.y&&(s*=-1);let l=r.clone().add(n.clone().sub(r).setLength(o));if(u.x<d.x&&(a*=-1),l.rotateAround(r,a),Math.abs(d.x-u.x)>Math.abs(d.y-u.y))editor.renderViewControl.target.x=l.x,editor.renderViewControl.target.z=l.y;else{let e=editor.renderViewControl.target.clone().sub(editor.renderViewCamera.position),i=$9HO6e.UtilCore.calculateAngleWithHorizontalPlane(e);editor.renderViewCamera.position.y<editor.renderViewControl.target.y&&(i*=-1);let r=Math.round(180*i/Math.PI),n=4,a=r>=-n&&r<=n;editor.renderViewControl.target.y+=s;let l=editor.renderViewControl.target.clone().sub(editor.renderViewCamera.position),c=$9HO6e.UtilCore.calculateAngleWithHorizontalPlane(l);if(isNaN(c))return;editor.renderViewCamera.position.y<editor.renderViewControl.target.y&&(c*=-1);let h=Math.round(180*c/Math.PI),p=h>=-n&&h<=n,m=document.getElementById("white"),f=document.querySelector(".shot_box").clientHeight,g=m?m.offsetTop:f/2+7*h,x=5;s>0&&(x*=-1);let b=g+x;if(a)if(Math.abs(u.y-d.y)<n)editor.renderViewControl.target.y=editor.renderViewCamera.position.y,t=!1,b=f/2;else{let e=n*Math.PI/180,t=o*Math.tan(e);u.y>d.y&&(t*=-1),editor.renderViewControl.target.y+=t;let i=25;t>0&&(i*=-1),b+=i}!a&&p&&(editor.renderViewControl.target.y=editor.renderViewCamera.position.y,b=f/2);let y="#fff";b==f/2&&(y="#00ff00"),b>=0&&b<=f&&editor.list.horizontalLine.dispatch(y,"white",b);let w=editor.getRenderCameraAngle();isNaN(w)||$("#cemeraAngle").val(w+"°")}editor.renderViewCamera.lookAt(editor.renderViewControl.target),editor.renderViewCamera.updateProjectionMatrix(),editor.renderViewControl.update(),t&&d.copy(u)}(e);break;case r.DOLLY:if(!1===i.enableZoom)return;!function(e){b.set(e.clientX,e.clientY),y.subVectors(b,x),y.y>0?T(M()):y.y<0&&C(M()),x.copy(b),i.update()}(e);break;case r.PAN:if(!1===i.enablePan)return;!function(e){f.set(e.clientX,e.clientY),g.subVectors(f,m).multiplyScalar(i.panSpeed),_(g.x,0),m.copy(f),i.update()}(e)}}(e))}function H(e){editor.renderViewCamera.oldDis="",N(e),0===w.length&&(i.domElement.releasePointerCapture(e.pointerId),i.domElement.removeEventListener("pointermove",W),i.domElement.removeEventListener("pointerup",H)),i.dispatchEvent($dc94d71b7cc06198$var$_endEvent),n=r.NONE,setTimeout((()=>{editor.list.deleteLine.dispatch()}),500)}function F(e){N(e)}function Q(e){!1!==i.enabled&&!1!==i.enableZoom&&n===r.NONE&&(e.preventDefault(),i.dispatchEvent($dc94d71b7cc06198$var$_startEvent),function(e){e.deltaY<0?C(M()):e.deltaY>0&&T(M()),i.update()}(e),i.dispatchEvent($dc94d71b7cc06198$var$_endEvent))}function z(e){!1!==i.enabled&&!1!==i.enablePan&&function(e){let t=!1;switch(e.code){case i.keys.UP:_(0,i.keyPanSpeed),t=!0;break;case i.keys.BOTTOM:_(0,-i.keyPanSpeed),t=!0;break;case i.keys.LEFT:_(i.keyPanSpeed,0),t=!0;break;case i.keys.RIGHT:_(-i.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),i.update())}(e)}function G(e){!1!==i.enabled&&e.preventDefault()}function N(e){delete v[e.pointerId];for(let t=0;t<w.length;t++)if(w[t].pointerId==e.pointerId)return void w.splice(t,1)}function U(e){let t=v[e.pointerId];void 0===t&&(t=new(0,$4xklQ.Vector2),v[e.pointerId]=t),t.set(e.pageX,e.pageY)}function j(e){const t=e.pointerId===w[0].pointerId?w[1]:w[0];return v[t.pointerId]}i.domElement.addEventListener("contextmenu",G),i.domElement.addEventListener("pointerdown",O),i.domElement.addEventListener("pointercancel",F),i.domElement.addEventListener("wheel",Q,{passive:!1}),this.update()}}class $dc94d71b7cc06198$export$7628ccdac312035f extends $dc94d71b7cc06198$export$8ff7788029dfdf52{constructor(e,t){super(e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=$4xklQ.MOUSE.PAN,this.mouseButtons.RIGHT=$4xklQ.MOUSE.ROTATE,this.touches.ONE=$4xklQ.TOUCH.PAN,this.touches.TWO=$4xklQ.TOUCH.DOLLY_ROTATE}}class $7ed6d163147eea6e$export$267a13440f7c79db{constructor(e){editor.list.hiddenDialog.dispatch(),this.container=e,this.width=window.innerWidth,this.height=window.innerHeight,this.camera=new $4xklQ.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.01,8e4),this.camera.lookAt(new(0,$4xklQ.Vector3)(0,0,0)),this.camera.layers.set(1),this.camera.layers.enable(2),editor.renderViewCamera=this.camera;let t=new(0,$4xklQ.OrthographicCamera)(-100,100,50,-50,0,10),i=this.width/this.height,r=-50;t.left=r*i,t.right=50*i,t.top=50,t.bottom=r,t.position.set(0,0,10),t.lookAt(new(0,$4xklQ.Vector3)(0,0,0)),editor.renderMiniMapCamera=t;const n="static/assets/images/",o=".png",a=[n+"px"+o,n+"nx"+o,n+"py"+o,n+"ny"+o,n+"pz"+o,n+"nz"+o],s=(new $4xklQ.CubeTextureLoader).load(a);this.scene=new $4xklQ.Scene,editor.renderScene=this.scene,this.scene.background=s;const l=new(0,$4xklQ.PlaneGeometry)(2e5,2e5),c=new(0,$4xklQ.MeshBasicMaterial)({color:16777215,roughness:1,metalness:0,transparent:!0,opacity:0});this.floor=new(0,$4xklQ.Mesh)(l,c),editor.renderFloor2d=this.floor,this.scene.add(this.floor),new $4xklQ.AxesHelper(5e4).layers.set(2),this.createRenderer(),this.controls=new $dc94d71b7cc06198$export$8ff7788029dfdf52(this.camera,this.container),this.controls.target.set(0,0,0),editor.renderViewControl=this.controls;let h=new(0,$4xklQ.Group),d=new(0,$4xklQ.Group),u=new(0,$4xklQ.Group),p=new(0,$4xklQ.Group),m=new(0,$4xklQ.Group),f=new(0,$4xklQ.Group),g=new(0,$4xklQ.Group);editor.renderFloorGroup=m,editor.renderModel3dGroup=h,editor.renderWall3dGroup=p,editor.renderMember3dGroup=g;let x=new(0,$4xklQ.Group);editor.wallGroup3D.children.slice(0).forEach((e=>{if("3DWall"==e.modelType){let t=e.clone();t.modelType="3dWall",p.add(t)}if((e.type.indexOf("Door")>-1||e.type.indexOf("door")>-1)&&p.add(editor.codeModelCopy(e)),e.type.indexOf("Window")>-1||e.type.indexOf("window")>-1){let t=editor.codeModelCopy(e);t.name="window",p.add(t)}})),editor.scene.children.forEach((e=>{e.modelType&&x.add(e.clone())})),editor.floorGroup.children.forEach((e=>{m.add(e.clone())})),editor.floorGroup2d.children.forEach((e=>{f.add(e.clone())})),editor.memberGroup3D.children.forEach((e=>{g.add(e.clone())})),editor.model3D.children.forEach((e=>{h.add(e.clone())})),editor.model2D.children.forEach((e=>{d.add(e.clone())})),editor.wallGroup.children.forEach((e=>{u.add(e.clone())}));let b=[p,m,g],y=(new(0,$4xklQ.Matrix4)).makeScale(.001,.001,.001);b.forEach((e=>{e.rotation.x=-Math.PI/2,e.applyMatrix4(y),this.scene.add(e)})),this.scene.add(h);let w=[f,d,u,x],v=(new(0,$4xklQ.Matrix4)).makeScale(.01,.01,.01);w.forEach((e=>{e.applyMatrix4(v),this.scene.add(e)}));let $=(new $4xklQ.Box3).setFromObject(p).getCenter(new $4xklQ.Vector3),M=(new $4xklQ.Box3).setFromObject(p).getSize(new $4xklQ.Vector3);editor.renderSceneCenter=M.z,this.camera.position.x=$.x,this.camera.position.z=$.z+M.z,this.camera.position.y=$.y,this.controls.target.set($.x,$.y,$.z),console.log(editor.renderViewCamera.position.clone(),this.controls.target),this.camera.updateProjectionMatrix(),this.controls.update();let S=new(0,$4xklQ.PointLight)(10394523);S.position.set(0,700,0),S.layers.enableAll();let P=new(0,$4xklQ.AmbientLight)(10394523);P.intensity=1,P.layers.enableAll(),P.position.set(0,700,0),this.scene.add(S),this.scene.add(P)}createRenderer(){let e=new(0,$4xklQ.WebGLRenderer)({antialias:!0,preserveDrawingBuffer:!0});e.shadowMap.enabled=!0,e.shadowMap.type=$4xklQ.PCFSoftShadowMap,e.setPixelRatio(window.devicePixelRatio),e.setSize(window.innerWidth,window.innerHeight),e.xr.enabled=!0,e.outputEncoding=$4xklQ.sRGBEncoding,this.renderer=e,editor.RenderRend=this.renderer,this.container.appendChild(this.renderer.domElement),this.animate()}animate(){this.renderer.setAnimationLoop(this.render.bind(this))}render(){this.renderer.render(this.scene,this.camera)}}var $4xklQ=parcelRequire("4xklQ"),$4xklQ=parcelRequire("4xklQ");class $ad8bf51027a12264$export$10707adaaf0119d6{constructor(e){if(this.container=e,this.width=272,this.height=183,this.scene=editor.renderScene,this.camera=editor.renderMiniMapCamera,this.renderer="",this.createRenderer(),this.raycaster=new $4xklQ.Raycaster,this.controls=new $dc94d71b7cc06198$export$8ff7788029dfdf52(this.camera,this.container),this.controls.target.set(0,0,0),this.camera.isOrthographicCamera){this.controls.enableRotate=!1,this.controls.mouseButtons={LEFT:$4xklQ.MOUSE.PAN,RIGHT:$4xklQ.MOUSE.PAN,MIDDLE:$4xklQ.MOUSE.PAN};let e=this.width/this.height,t=-50;this.camera.left=t*e,this.camera.right=-t*e,this.camera.top=-t,this.camera.bottom=t}else this.controls.enableRotate=!0,this.camera.aspect=this.width/this.height,this.controls.mouseButtons={LEFT:$4xklQ.MOUSE.LEFT,RIGHT:$4xklQ.MOUSE.PAN};this.camera.updateProjectionMatrix();let t=$e3212e52653b49d1$export$919db86739867624.createCamera(!0);t.name="cameraGroup",t.position.z=10,t.rotation.z=this.camera.rotation.z-Math.PI/2,this.cameraGroup=t;let i=(new(0,$4xklQ.Matrix4)).makeScale(.01,.01,.01);this.cameraGroup.applyMatrix4(i),this.scene.add(t),e.addEventListener("mousedown",this.onMouseDown.bind(this)),e.addEventListener("mouseup",this.onMouseUp.bind(this)),e.addEventListener("mousemove",this.mouseMove.bind(this)),this.needUpdate=!0}onMouseDown(){let e=this.getObject(event);this.needUpdate=!1,e.length>0&&(this.downSel=e[0].object.parent,this.downPoint=e[0].point.clone(),this.oldPos=this.cameraGroup.position.clone(),"nosc"==this.downSel.name||"cameraGroup"==this.downSel.name||"nosr"==this.downSel.name?this.camera.isOrthographicCamera?this.controls.enablePan=!1:(this.controls.enablePan=!1,this.controls.enableRotate=!1):this.camera.isOrthographicCamera?this.controls.enablePan=!0:(this.controls.enablePan=!0,this.controls.enableRotate=!0))}onMouseUp(){this.downSel="",this.downPoint="",this.oldPos="",this.needUpdate=!0}mouseMove(e){let t=this.getObject(e);if(t.length>0){let e=t[0].object.parent,i=this.cameraGroup[e.name+"_move"];if(t[0].object.name.indexOf("circle")>=0&&(i=this.cameraGroup.circle_move),i?i.visible=!0:this.cameraGroup.children.forEach((e=>{e.name.indexOf("_move")>=0&&(e.visible=!1)})),this.downSel){let e=t[0].point.clone();if("nosc"==this.downSel.name||"cameraGroup"==this.downSel.name){let t=e.clone().sub(this.downPoint),i=this.oldPos.clone().add(t);this.cameraGroup.position.x=i.x,this.cameraGroup.position.y=i.y;let r=editor.renderViewCamera.position.clone();editor.renderViewCamera.position.x=this.cameraGroup.position.x/10,editor.renderViewCamera.position.z=-this.cameraGroup.position.y/10;let n=editor.renderViewCamera.position.clone().sub(r);editor.renderViewControl.target.add(n)}else if("nosr"==this.downSel.name){let t=this.cameraGroup.position.clone(),i=new(0,$4xklQ.Vector2)(e.x,e.y),r=new(0,$4xklQ.Vector2)(t.x,t.y),n=i.sub(r).angle();n-=Math.PI,this.cameraGroup.rotation.z=n;let o=editor.renderSceneCenter,a=-o*Math.cos(n),s=o*Math.sin(n);editor.renderViewControl.target.x=a,editor.renderViewControl.target.z=s}editor.renderViewCamera.updateProjectionMatrix(),editor.renderViewControl.update()}}}createRenderer(){let e=new(0,$4xklQ.WebGLRenderer)({antialias:!0,preserveDrawingBuffer:!0});e.shadowMap.enabled=!0,e.shadowMap.type=$4xklQ.PCFSoftShadowMap,e.setPixelRatio(window.devicePixelRatio),e.setSize(this.width,this.height),e.setClearColor("#2A2E34"),e.xr.enabled=!0,e.outputEncoding=$4xklQ.sRGBEncoding,this.renderer=e,this.container.appendChild(this.renderer.domElement),this.animate()}animate(){this.renderer.setAnimationLoop(this.render.bind(this))}render(){if(this.renderer.render(this.scene,this.camera),!editor.renderViewCamera.isOrthographicCamera&&this.needUpdate){this.cameraGroup.position.x=10*editor.renderViewCamera.position.x,this.cameraGroup.position.y=10*-editor.renderViewCamera.position.z;let e=new(0,$4xklQ.Vector2)(editor.renderViewCamera.position.x,editor.renderViewCamera.position.z),t=new(0,$4xklQ.Vector2)(editor.renderViewControl.target.x,editor.renderViewControl.target.z).clone().sub(e).angle();t-=Math.PI,this.cameraGroup.rotation.z=-t}}getObject(e){let t=new(0,$4xklQ.Vector3);this.domRect=this.container.getBoundingClientRect(),t.x=(e.clientX+this.width-window.innerWidth)/this.width*2-1,t.y=-(e.clientY+108-this.height)/this.height*2+1,t.z=0,this.raycaster.setFromCamera(t,this.camera);let i=[editor.renderFloor2d];return this.cameraGroup.children.forEach((e=>{e.visible&&i.push(e)})),this.raycaster.intersectObjects(i,!0)}}var $9decf90ebae5e35e$var$_DEFAULT_CAMERA=new(0,$4xklQ.PerspectiveCamera)(50,window.innerWidth/window.innerHeight,.01,1e3);$9decf90ebae5e35e$var$_DEFAULT_CAMERA.name="3dCamera",$9decf90ebae5e35e$var$_DEFAULT_CAMERA.sceneModel="3D",$9decf90ebae5e35e$var$_DEFAULT_CAMERA.position.set(-5,10,10),$9decf90ebae5e35e$var$_DEFAULT_CAMERA.lookAt(new(0,$4xklQ.Vector3)(0,0,0)),$9decf90ebae5e35e$var$_DEFAULT_CAMERA.layers.set(1),$9decf90ebae5e35e$var$_DEFAULT_CAMERA.layers.enable(2);var $9decf90ebae5e35e$var$_DEFAULT_ROMA_CAMERA=new(0,$4xklQ.PerspectiveCamera)(50,window.innerWidth/window.innerHeight,.01,1e3);$9decf90ebae5e35e$var$_DEFAULT_ROMA_CAMERA.name="3dRomaCamera",$9decf90ebae5e35e$var$_DEFAULT_ROMA_CAMERA.sceneModel="3D",$9decf90ebae5e35e$var$_DEFAULT_ROMA_CAMERA.position.set(0,0,0),$9decf90ebae5e35e$var$_DEFAULT_ROMA_CAMERA.lookAt(new(0,$4xklQ.Vector3)(0,0,-1.65)),$9decf90ebae5e35e$var$_DEFAULT_ROMA_CAMERA.layers.set(1),$9decf90ebae5e35e$var$_DEFAULT_ROMA_CAMERA.layers.enable(2);var $9decf90ebae5e35e$var$_DEFAULT_CAMERA1=new(0,$4xklQ.OrthographicCamera)(-1e4,1e4,5e3,-5e3,0,1e3);$9decf90ebae5e35e$var$_DEFAULT_CAMERA1.name="2dCamera",$9decf90ebae5e35e$var$_DEFAULT_CAMERA1.sceneModel="2D",$9decf90ebae5e35e$var$_DEFAULT_CAMERA1.position.set(0,0,1e3),$9decf90ebae5e35e$var$_DEFAULT_CAMERA1.lookAt(new(0,$4xklQ.Vector3)(0,0,0));let $9decf90ebae5e35e$var$k=window.innerWidth/window.innerHeight,$9decf90ebae5e35e$var$s=-5e3;$9decf90ebae5e35e$var$_DEFAULT_CAMERA1.left=$9decf90ebae5e35e$var$s*$9decf90ebae5e35e$var$k,$9decf90ebae5e35e$var$_DEFAULT_CAMERA1.right=-$9decf90ebae5e35e$var$s*$9decf90ebae5e35e$var$k,$9decf90ebae5e35e$var$_DEFAULT_CAMERA1.top=-$9decf90ebae5e35e$var$s,$9decf90ebae5e35e$var$_DEFAULT_CAMERA1.bottom=$9decf90ebae5e35e$var$s;class $9decf90ebae5e35e$export$8642042a8635463d{constructor(e){e.dataVersion="0.0.1",e.cacheJson="",e.currentCacheJson="",e.config=new $8b391c7d7cfc95c8$export$29cd7b75162a9425,e.progress=1,e.PolyK=PolyK,e.history=new $3fdc31d914635d41$export$84202caead5689ba(e),e.centerArea=e.config.centerArea,e.adsorbentModel=!0,e.orthogonalModel=!1,e.innerDraw=1,e.touchStart="",e.sceneActive=!1,e.copyFloorMaterial="",e.specialPointArr=[],e._DEFAULT_CAMERA=$9decf90ebae5e35e$var$_DEFAULT_CAMERA.clone(),e._DEFAULT_CAMERA1=$9decf90ebae5e35e$var$_DEFAULT_CAMERA1.clone(),e.camera=$9decf90ebae5e35e$var$_DEFAULT_CAMERA1.clone(),e.miniMapCamera=$9decf90ebae5e35e$var$_DEFAULT_CAMERA.clone(),e.wallDep=240,e.roomWallDep=240,e.scene=new(0,$4xklQ.Scene),e.cameraScene=new(0,$4xklQ.Scene),e.scene.name="Scene",e.floor="",e.themeColor="",e.gridProportion="",e.raycaster=new(0,$4xklQ.Raycaster),e.startPoint="",e.endPoint="",e.currentPoint="",e.currenDraw="",e.mouse=new(0,$4xklQ.Vector3)(0,0,0),e.helperGroup=new(0,$4xklQ.Group),e.helperGroup.name="helperGroup",e.doorHelperGroup=new(0,$4xklQ.Group),e.doorHelperGroup.name="doorHelperGroup",e.circlePoint="",e.pointHelperGroup=new(0,$4xklQ.Group),e.pointHelperGroup.name="pointHelper",e.pointHelpGroup=new(0,$4xklQ.Group),e.pointHelpGroup.name="pointHelp",e.uiPanelBox=new $2a0c8f99fe7360a8$export$ab8ce44154d5decc,e.uiPanelBox.setWidth(window.innerWidth+"px"),e.uiPanelBox.setHeight(window.innerHeight+"px"),e.statusJson=[],e.allWalls=[],e.otherMeshs=[],e.otherMember=[],e.wallGroup=new(0,$4xklQ.Group),e.wallGroup.name="2dwall",e.wallGroup3D=new(0,$4xklQ.Group),e.wallGroup3D.name="3dwall",e.memberGroup3D=new(0,$4xklQ.Group),e.memberGroup3D.name="3dMember",e.model3D=new(0,$4xklQ.Group),e.model3D.name="3dModel",e.model2D=new(0,$4xklQ.Group),e.model2D.position.z=.1,e.model2D.name="2dModel",e.modelHelperGroup=new(0,$4xklQ.Group),e.modelHelperGroup.name="3dModelSelectHelper",e.clickDepthMsg={},e.modelDotGroup=new(0,$4xklQ.Group),e.modelDotGroup.name="3dModelDotHelper",e.floorGroup=new(0,$4xklQ.Group),e.floorGroup.rotation.x=-Math.PI/2,e.floorGroup.name="floorGroup",e.doorHoleArr=[],e.wallGroup3D.rotation.x=-Math.PI/2,e.memberGroup3D.rotation.x=-Math.PI/2,e.cameras={},e.cameras[e.camera.uuid]=e.camera,e.cameras[$9decf90ebae5e35e$var$_DEFAULT_CAMERA.uuid]=$9decf90ebae5e35e$var$_DEFAULT_CAMERA,e.cameras[$9decf90ebae5e35e$var$_DEFAULT_ROMA_CAMERA.uuid]=$9decf90ebae5e35e$var$_DEFAULT_ROMA_CAMERA,e.lastCamera="3dCamera",e.toolType="free",e.chooseColor=new(0,$4xklQ.Color)("#4169BB"),e.cancelChooseColor=new(0,$4xklQ.Color)("rgb(144, 146, 146)"),e.cancelChooseShortColor=new(0,$4xklQ.Color)("rgb(255, 255, 255)"),e.cancelChooseHeavyColor=new(0,$4xklQ.Color)("rgb(0, 0, 0)"),e.boxLineMaterial=new $4xklQ.LineBasicMaterial({color:"#000000",transparent:!0,opacity:.4,depthWrite:!1,side:$4xklQ.DoubleSide}),e.selectObjArr=[],e.miniMapObj="",e.clickColor=new(0,$4xklQ.Color)("#3A5FFF"),e.moveDoorColor=new(0,$4xklQ.Color)("#00FFFF"),e.moveDoorOutColor=new(0,$4xklQ.Color)("#000000"),e.downPoint="",e.currentDownSelect="",e.currentMoveSelect="",e.mouseCoverObj="",e.startChooseWall="",e.clickSelect=[],e.currentDoor="",e.moveStartPosition=new(0,$4xklQ.Vector3)(0,0,0),e.allLinkWallByStartPoint=[],e.samePointWall=[],e.samePointByDrag="",e.menuSwitch=!1,e.viewportCamera=e.camera,e.globalControl="",e._scaleStart=new $4xklQ.Vector3(1,1,1),e._offsetStart="",e.doorDistance="",e.miniControls2d="",e.miniControls3d="",e.floorGroup2d=new(0,$4xklQ.Group),e.floorGroup2d.name="floorGroup2d",e.lineGroup3D=new(0,$4xklQ.Group),e.lineGroup3D.name="3dBoxLine",e.lineGroup3D.rotation.x=-Math.PI/2,e.lineGroup3D.visible=!1,e.cameraRenderer=new(0,$4xklQ.WebGLRenderer)({antialias:!0,preserveDrawingBuffer:!0}),e.cameraRenderer.shadowMap.enabled=!0,e.cameraRenderer.setPixelRatio(window.devicePixelRatio),e.cameraRenderer.xr.enabled=!0,e.cameraRenderer.outputEncoding=$4xklQ.sRGBEncoding,e.cameraRenderer.setSize(window.innerWidth,window.innerHeight),e.cameraRenderer.setClearColor(16777215,0),e.pngCamera=$9decf90ebae5e35e$var$_DEFAULT_CAMERA1.clone(),e.newRenderer=new(0,$4xklQ.WebGLRenderer)({antialias:!0}),e.newRenderer.setClearColor(15264748),e.newRenderer.setPixelRatio(window.devicePixelRatio),e.newRenderer.shadowMap.enabled=!0,e.newRenderer.xr.enabled=!0,e.allRoomCenterCamera=new(0,$4xklQ.Group),e.splitRoomLineGroup=new(0,$4xklQ.Group),e.splitRoomLineGroup.name="splitRoomHelperGroup",e.splitRoomLine=new(0,$4xklQ.Group),[e.splitRoomLineGroup,e.splitRoomLine,e.model3D,e.model2D,e.lineGroup3D,e.wallGroup,e.floorGroup,e.wallGroup3D,e.memberGroup3D,e.pointHelpGroup,e.helperGroup,e.pointHelperGroup,e.doorHelperGroup,e.floorGroup2d,e.modelHelperGroup,e.allRoomCenterCamera,e.modelDotGroup].forEach((t=>{e.scene.add(t)})),e.roomList=[[],[]],e.allGroup3d=[e.lineGroup3D,e.floorGroup,e.wallGroup3D,e.memberGroup3D];var t=new $4xklQ.MeshBasicMaterial({color:"#4169E1",side:$4xklQ.DoubleSide});e.wallTool=new(0,$5XTH3.DrawWallTool)(t);const i=new $9b1db6660d92c803$export$fd171b37577d7494(e);e.wallHelp=new $d0f874000594cf7a$export$a955f3d6a39ce4b2,e.wallHelper=new $002a82be864d68ed$export$a80d7a02e87abd45(e);const r=e;e.debug=!1,e.list.sceneInit.add((function(e){r.dom=e,new $19e26f6affaac76b$export$15d36fc1a69ab4a0(r,e)})),e.list.resetCamera.add((function(){r.globalControl&&(r.globalControl.reset(),r.globalControl.object.isPerspectiveCamera&&(r.globalControl.object.zoomNum=1),r.updateDom(),r.list.changeCameraSlider.dispatch("2d",1),$9HO6e.UtilCore.updateLineDimensionsLine(r),r.autoShowHidden(1),r.globalControl.object.isPerspectiveCamera&&r.switchHelperGroup("hidden"))})),e.list.splitTool.add((function(e){r.toolType="splitTool",r.splitType=e,r.list.setViewportCamera.dispatch("2D",r)})),e.list.changeTheme.add((function(e){if(""!=e){r.renderer.setClearColor(e),r.grid.children.concat(r.grid3d.children).forEach((e=>{"2dGrid1"!=e.name&&"3dGrid1"!=e.name||(e.material.color=new(0,$4xklQ.Color)(5263440)),"2dGrid2"!=e.name&&"3dGrid2"!=e.name||(e.material.color=new(0,$4xklQ.Color)(7894390))})),r.themeColor=e}else{r.renderer.setClearColor(15264748),r.grid.children.concat(r.grid3d.children).forEach((e=>{"2dGrid1"!=e.name&&"3dGrid1"!=e.name||(e.material.color=new(0,$4xklQ.Color)(16777215)),"2dGrid2"!=e.name&&"3dGrid2"!=e.name||(e.material.color=new(0,$4xklQ.Color)(16777215))})),r.themeColor=""}})),e.list.saveScene.add((function(e="cache"){"cache"==e?r.saveSceneJson():r.saveSceneJsonToFile()})),e.list.createMap.add((function(e,t){if(r.miniMapCamera.isOrthographicCamera){let i=e/t,n=-5e3;r.miniMapCamera.left=n*i,r.miniMapCamera.right=-n*i,r.miniMapCamera.top=-n,r.miniMapCamera.bottom=n}else r.miniMapCamera.aspect=e/t;if(r.newRenderer.setSize(e,t),r.miniMapCamera.updateProjectionMatrix(),r.roamTool){let i=e/(t+28),n=-5e3;r.miniCamera.camera.left=n*i,r.miniCamera.camera.right=-n*i,r.miniCamera.camera.top=-n,r.miniCamera.camera.bottom=n,r.miniCamera.renderer.setSize(e,t+28),r.miniCamera.camera.updateProjectionMatrix()}})),e.list.makeGroup.add((function(){let e=r.camera.isOrthographicCamera?"2d":"3d";r.makeGroup(e)})),e.list.explodeGroup.add((function(){let e=r.camera.isOrthographicCamera?"2d":"3d";r.explodeGroup(e)})),e.list.changeModel.add((function(e){r.grid3d.visible=!1,r.floorGroup.visible=!0;let t=r.model3D.children,i=!1,n=r.wallGroup3D.children;switch(n=n.concat(r.model3D.children),n=n.concat(r.floorGroup.children),n.forEach((e=>{e.traverse((function(e){e.isMesh&&e.oldColor&&(e.material=e.oldColor.clone())}))})),e){case"transparentModel":r.wallGroup3D.visible=!1,r.memberGroup3D.visible=!1,r.lineGroup3D.visible=!0,r.floorGroup.visible=!1,i=!0;break;case"materialModel":r.wallGroup3D.visible=!0,r.grid3d.visible=!0,r.memberGroup3D.visible=!0,r.lineGroup3D.visible=!1,i=!1;break;case"lineModel":r.wallGroup3D.visible=!1,r.memberGroup3D.visible=!1,r.lineGroup3D.visible=!0,i=!1;break;case"MLModel":r.wallGroup3D.visible=!0,r.memberGroup3D.visible=!0,r.lineGroup3D.visible=!0,i=!1;break;case"randomMaterialModel":let e={};n.forEach((t=>{t.traverse((function(t){t.isMesh&&(t.oldColor||(t.oldColor=t.material.clone()),setTimeout((()=>{let i=t.material.color.toArray(),r=i[0]+"-"+i[1]+"-"+i[2];if(e.hasOwnProperty(r))t.material=e[r].clone();else{let i=new(0,$4xklQ.MeshBasicMaterial);var n=new Float32Array([Math.random(),Math.random(),Math.random()]);i.color.fromArray(n),t.material=i,e[r]=t.material.clone()}}),100))}))})),i=!1}t.forEach((e=>{e.traverse((function(e){e.isMesh&&(e.material.emissive=new $4xklQ.Color(0),e.material.wireframe=i)}))}))})),e.list.removeAll.add((function(e="save",t=!0,i="all"){let n="清空画布",o="清空画布会清除当前全部设计";"lable"==i&&(n="清空标注",o="清空标注会清除当前全部标注"),t?r.list.dialog.dispatch(n,o,["remove",e,i]):r.removeScene(e,i)})),e.list.activeTool.add((function(e,t=!0){"close"!=e?(r.camera.isOrthographicCamera||r.list.setViewportCamera.dispatch("2D",r),r.exitTool(!0,!1),"wall"!=e&&"room"!=e||(r.dom.style.cursor="crosshair"),"figure"==e&&r.list.importMap.dispatch(),r.toolType=e):r.exitTool(t)})),e.list.importMap.add((function(){r.execute(),r.list.dialog.dispatch("清空提示","识别图片生成户型，将清空当前方案中所有设内容没确定继续？",["importMap"])})),e.list.doCallback.add((function(e){switch(e[0]){case"remove":r.removeScene(e[1],e[2]);break;case"importMap":r.removeScene(""),r.importMapMain();break;case"delMap":r.execute(),r.delMap()}})),e.list.setScaleTool.add((function(){r.cleanScaleTool(),r.allHelperForScaleTool(new(0,$4xklQ.Vector3)(-1e3,0,0),new(0,$4xklQ.Vector3)(1e3,0,0))})),e.list.hiddenMap.add((function(){r.scene.children.forEach((e=>{"mapImage"==e.useType&&(e.visible=!e.visible)}))})),e.list.delMap.add((function(){r.list.dialog.dispatch("删除底图","",["delMap"])})),e.list.showHiddenHelper.add((function(e,t,i=""){""==i&&(r.config.settingJsonCopy.hasOwnProperty(e)&&(r.config.settingJson[e]=t),i=r.config.settingJson),r.config.settingJson=i;let n=["roomName","roomArea","dimension"];for(const e in i)"only"==t&&n.indexOf(e)<0||r.showHiddenHelperMain(e,i[e])})),e.list.useModel.add((function(e,t,i,n=""){r.adsorbentModel=e,r.orthogonalModel=t,r.innerDraw=i,""!=n&&(r.wallDep=n)})),e.list.drawRoomChangeth.add((function(e){r.roomWallDep=1*e})),e.list.changeWallType.add((function(e){if(""==r.clickSelect||""==r.clickSelect[0].object)return;r.execute(),r.removeBSRHelper();let t=r.clickSelect[0].object;t.isArc==e?t.isArc=!1:t.isArc=e;let i=[];r.otherMeshs.forEach((e=>{e.wallId==t.wallID&&i.push(e)})),i.forEach((e=>{r.otherMeshs.splice(r.otherMeshs.indexOf(e),1),r.scene.remove(e)})),new $523a84362d27c3e8$export$b680ca477a72be07(r).wallToJson();let n=$9HO6e.UtilCore.getRealWallByPosition(t.startPoint,t.endPoint,r.allWalls);r.clickSelect[0].object=n,n.material.color=r.clickColor})),e.list.splitWall.add((function(){if(""==r.clickSelect||""==r.clickSelect[0].object)return;r.execute();let e=r.clickSelect[0].object,t=new $523a84362d27c3e8$export$b680ca477a72be07(r),i="",n=[];if(e.isArc){let t=new(0,$4xklQ.Vector2)(e.startPoint.x,e.startPoint.y),i=new(0,$4xklQ.Vector2)(e.endPoint.x,e.endPoint.y),o=i.clone().sub(t.clone()),a=new(0,$4xklQ.Vector2)(-o.y,o.x),s=new(0,$4xklQ.Vector2)(o.y,-o.x),l=t.clone().distanceTo(e.arcCenter.clone()),c=e.arcCenter.clone().add(a.setLength(l)),h=e.arcCenter.clone().add(s.setLength(l)),d=$9HO6e.UtilCore.getClockWise(t,e.cp,i),u="";u=d*$9HO6e.UtilCore.getClockWise(t,c,i)>0?c:h,e.endPoint=u.clone();let p=e.geometry.attributes.position.array,m=$9HO6e.UtilCore.getPointInArc(t,u,d,e.arcCenter.clone(),l);e.cp=m;let f=r.addArcWall(t,i,e.cp,e.isArc);p=f.geometry.attributes.position.array,f.startPoint=u.clone();let g=$9HO6e.UtilCore.getPointInArc(u,i,d,e.arcCenter.clone(),l);f.cp=g,n=[e,f]}else i=new(0,$4xklQ.Vector2)((e.startPoint.x+e.endPoint.x)/2,(e.startPoint.y+e.endPoint.y)/2),n=t.splitWall(e,i);t.wallToJson();let o=r.getDialogPosition(new(0,$4xklQ.Vector3)(n[0].startPoint.x,n[0].startPoint.y,0),new(0,$4xklQ.Vector3)(n[0].endPoint.x,n[0].endPoint.y,0)),a=Math.round(n[0].startPoint.clone().distanceTo(n[0].endPoint.clone())),s=$9HO6e.UtilCore.havePointWall(n[0].startPoint,r.allWalls).length>1,l=$9HO6e.UtilCore.havePointWall(n[0].endPoint,r.allWalls).length>1;r.list.showDialog.dispatch(0,"wall",o,[a,n[0].thickness,s,l]);let c=$9HO6e.UtilCore.getRealWallByPosition(n[0].startPoint,n[0].endPoint,r.allWalls);r.clickSelect[0].object=c,c.material.color=r.clickColor})),e.list.delWall.add((function(){if(r.execute(),""==r.clickSelect||""==r.clickSelect[0].object)return;let e=r.clickSelect[0].object,t=$9HO6e.UtilCore.havePointWall(e.startPoint,r.allWalls,e),i=$9HO6e.UtilCore.havePointWall(e.endPoint,r.allWalls,e);r.wallGroup.remove(e),r.allWalls.indexOf(e)>=0&&r.allWalls.splice(r.allWalls.indexOf(e),1),r.removeHelperByWall(e),2==t.length&&r.margeWall(t[0],t[1]),2==i.length&&r.margeWall(i[0],i[1]),new $523a84362d27c3e8$export$b680ca477a72be07(r).wallToJson();let n=r.getAllWindowInWall(e);n.length>0&&n.forEach((e=>{r.scene.remove(e),r.otherMeshs.indexOf(e)>=0&&r.otherMeshs.splice(r.otherMeshs.indexOf(e),1)})),r.list.hiddenDialog.dispatch()})),e.list.delSplitLine.add((function(){if(""==r.clickSelect||""==r.clickSelect[0].object)return;r.execute();let e=r.clickSelect[0].object;r.splitRoomLine.remove(e),r.splitRoomLineGroup.children=[],r.list.hiddenDialog.dispatch(),r.clickSelect="",new $523a84362d27c3e8$export$b680ca477a72be07(r).wallToJson()})),e.list.delDoor.add((function(){if(""==r.clickSelect||""==r.clickSelect[0].object)return;let e=r.clickSelect[0].object.parent;if(e.isLock)return void r.list.alert.dispatch("模型已锁定,请先解锁","warning");r.execute();let t=e.wallId?e.wallId:e.parameter.tdm.wallId,i=r.getWallById(t);r.removeDoor(e),r.doorHelperGroupClean(),r.list.hiddenDialog.dispatch(),r.clickSelect="",r.partRefreshWall(i)})),e.list.delMember.add((function(){if(""==r.clickSelect||""==r.clickSelect[0].object)return;let e=r.clickSelect[0].object.parent;r.camera.isOrthographicCamera||(e=r.clickSelect[0].object.twoD),e.isLock?r.list.alert.dispatch("模型已锁定,请先解锁","warning"):(r.execute(),r.removeMember(e),r.doorHelperGroupClean(),r.modelHelperGroup.children=[],r.list.hiddenDialog.dispatch(),r.clickSelect="")})),e.list.delModel.add((function(){if(""==r.clickSelect||""==r.clickSelect[0].object)return;let e=[];e=1==r.selectObjArr.length?[r.clickSelect[0].object]:r.selectObjArr,e.forEach((e=>{let t=r.getOuterParent(e);if(t.isLock)return void(1==r.selectObjArr.length&&r.list.alert.dispatch("模型已锁定,请先解锁","warning"));r.execute();let i=r.getOuterParent(t,t,"outer"),n=t.parent;if("2DModel"==t.modelType||"2dModelGroup"==t.modelType){t.parent.remove(t);let e=r.get3DModelBy2DModel(t);e.parent.remove(e)}else{let e=r.get2DModelBy3DModel(t);i=r.getOuterParent(e,e,"outer"),n=e.parent,t.parent.remove(t),e.parent.remove(e)}if(r.doorHelperGroupClean(),r.modelHelperGroup.children=[],r.list.hiddenDialog.dispatch(),r.clickSelect="",r.clickDepthMsg.uuid){r.modelDotGroup.children=[];let e=i.param[0];r.refreshRealSizeByBox(i,n),r.updateModelPosition(n,i),r.addDashBoxFor2dGroup(i),r.addDashBoxForGroup(e)}}))})),e.list.reverseDoor.add((function(){if(""==r.clickSelect||""==r.clickSelect[0].object)return;r.execute();let e=r.clickSelect[0].object.parent;if("LWindow"!=e.modelType&&"UWindow"!=e.modelType)if("door"==e.modelType||"childMotherDoor"==e.modelType)r.noHiddenDialog=!0,r.execute(new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(r,"door","end",[0,0,"angle"],!0,"click"),"翻转"),r.noHiddenDialog=!1;else{let t=e.parameter[0];e.rotation.z+=Math.PI,t.rotation.y+=Math.PI}})),e.list.replaceDoor.add((function(){if(""==r.clickSelect||""==r.clickSelect[0].object)return;r.execute();let e=r.clickSelect[0].object.parent;if(!e.modelPath)return;let t=e.modelPath,i="";if(t.indexOf("_replace")>=0)i=t.replace(/_replace/g,"");else{let e=t.split("."),r=e.pop();i=e.join()+"_replace."+r}e.modelPath=i})),e.list.copyDoor.add((function(){if(""==r.clickSelect||""==r.clickSelect[0].object)return;let e=r.clickSelect[0].object.parent;"3dMember"==e.name&&(e=r.clickSelect[0].object.twoD),r.list.setViewportCamera.dispatch("2D",r),r.copyDoor=e,r.toolType=r.config.toolTypeConfig[e.modelType]})),e.list.GPURender.add((function(){r.list.hiddenDialog.dispatch(),r.switchHelperGroup("hidden"),new $50588171089be068$export$6a37e807469f37da(r)})),e.list.createRoom.add((function(e){i.createRoom(e)})),e.list.setRoomType.add((function(e){if(""==r.clickSelect||""==r.clickSelect[0].object)return;let t=r.clickSelect[0].object;t.roomName=e;let i=($("#roomName"+t.uuid).attr("roomName")+"\n"+$("#roomName"+t.uuid).attr("roomArea")).split("\n");i[0]=e,$("#roomName"+t.uuid).attr("roomName",e),$("#roomName"+t.uuid).text(i.join("\n")),r.saveSceneJson()})),e.list.setViewportCamera.add(e.setViewportCamera),e.list.executeTool.add((function(e){new $5002053a529f5520$export$e0cf849ef0f13f5d(r,e).main()})),e.list.recoveryScene.add((function(e){r.list.alert.dispatch("正在加载户型"),r.removeScene(""),localStorage.setItem("sceneData",e),(e=JSON.parse(e)).cameraJson.sceneModel="2D",r.cacheJson=JSON.stringify(e),r.readCache(JSON.stringify(e)),r.miniMapObj=new $3c82f100e7ba0388$export$bc845c5c4f62a4a1(r,r.miniMapCamera,r.scene,r.newRenderer,r.miniDom,240,202),r.miniMapObj.main()})),e.list.saveWallModel.add((function(){r.camera.isOrthographicCamera||r.list.setViewportCamera.dispatch("2D",r);let e=new(0,$4xklQ.Group),t=["2dwall","floorGroup2d","flue","post","bridge"];r.scene.children.forEach((i=>{t.indexOf(i.name)>-1&&e.add(i.clone()),i.modelPath&&(i.modelPath.indexOf("door")>-1||i.modelPath.indexOf("window")>-1)&&e.add(i.clone())}));let i=r.getSceneAllJson();i.mapJson={},i=JSON.stringify(i);let n=r.getTextCanvas2("roomName");r.initCameraPngScene(e,"2D"),r.cameraScene.add(n),setTimeout((function(){let e=r.cameraRenderer.domElement.toDataURL("image/png");n.parent.remove(n),r.list.alert.dispatch("户型保存成功"),r.list.saveWallJson.dispatch(e,i)}),100)})),e.list.saveModel.add((function(){0!=r.selectObjArr.length&&(r.list.hiddenDialog.dispatch(),r.selectObjArr.forEach((e=>{let t="";t=r.camera.isOrthographicCamera?r.get3DModelBy2DModel(r.getOuterParent(e)):r.getOuterParent(e);let i="组合模型";if(t.imgPath){let e=t.imgPath.split("/");i=e[e.length-1].split("."),i.pop(),i=i.join("")}let n=t,o=t.clone();r.extendParam(n,o);var a=JSON.stringify(r.exportModelJson(o));r.initCameraPngScene(t),r.exportModelGlb(t),i||(i="默认模型"),setTimeout((function(){let e=r.cameraRenderer.domElement.toDataURL("image/png");r.list.popupSaveRecord.dispatch(e,a);var n=new Blob([a],{type:"text/plain"}),o=document.createElement("a");o.style.display="none",o.href=URL.createObjectURL(n),o.download=i+".json",o.click();var s=document.createElement("a");s.href=e,s.download=i+"iso.png",s.click(),r.initCameraPngScene(t,"top"),setTimeout((function(){let e=r.cameraRenderer.domElement.toDataURL("image/png");var n=document.createElement("a");n.href=e,n.download=i+".png",n.click(),r.initCameraPngScene(t,"right"),setTimeout((function(){let e=r.cameraRenderer.domElement.toDataURL("image/png");var t=document.createElement("a");t.href=e,t.download=i+"right.png",t.click()}))}),100)}),100)})))})),e.list.exportGLTF.add((function(e){"pdf"==e?r.exportPDF():r.exportGLTF(e)})),e.list.smartRoom.add((function(e){1e4!=e[0]?setTimeout((()=>{r.otherMeshs.length>0&&r.scene.remove(...r.otherMeshs),r.removeScene(""),r.camera.isOrthographicCamera||r.list.setViewportCamera.dispatch("2D",r);let t=(new $ca3cc62cb04c2488$export$9a58ef0d7ad3278c).getHome(e[0],e[1],e[2]);new $523a84362d27c3e8$export$b680ca477a72be07(r).wallToJson("2D",t[0]),r.scene.add(...t[1]),r.otherMeshs=t[1],r.doorHoleArr=t[2],r.doorHelperGroupClean(),r.pointHelperGroup.children=[],r.model2D.children=[],r.model3D.children=[],r.exitTool(!0),r.list.executeTool.dispatch("moveFree")}),100):r.testSmartRoom()})),e.list.changeCamera.add((function(e,t="",i=1){let n=.95*i,o=r.globalControl;(o.object.isPerspectiveCamera||o.object.isOrthographicCamera)&&(o.object.zoom="max"==t?Math.max(o.minZoom,Math.min(o.maxZoom,o.object.zoom/n)):Math.max(o.minZoom,Math.min(o.maxZoom,o.object.zoom*n))),o.object.updateProjectionMatrix(),r.globalControl.update(),r.updateDom()})),e.list.undo.add((function(){r.history.undo()})),e.list.redo.add((function(){r.history.redo()})),e.list.uploadFile.add((function(e,t,i=""){if(!(e.indexOf(".glb")<0||e.indexOf(".gltf")<0||e.indexOf(".json")<0))return;if(e&&r.list.progressOpen.dispatch(),e.indexOf(".json")>=0){var n=new FileReader;return n.onload=()=>{localStorage.setItem("sceneData",n.result),r.cacheJson=n.result,r.readCache(n.result),r.list.progressClose.dispatch()},n.readAsText(t),void r.list.progressChange.dispatch(100)}let o=r.config.maxWidth;const a=URL.createObjectURL(t);(new(0,$hu0fb.GLTFLoader)).load(a,(function(n){let a=n.scene;var s=new(0,$4xklQ.Box3);s.setFromObject(a);let l=1*(s.max.x-s.min.x).toFixed(2),c=1*(s.max.y-s.min.y).toFixed(2),h=1*(s.max.z-s.min.z).toFixed(2);if(Math.abs(s.min.y)>=0){let e=new(0,$4xklQ.Vector3);s.getCenter(e);let t=new(0,$4xklQ.Group);a.position.set(-e.x,-e.y,-e.z),t.add(a),a=t}l>o&&a.scale.set(o/l,o/l,o/l),a.position.set(0,c/2,0),a.traverse((function(e){e.layers.set(2)}));let d=e.split(".");d.pop();let u=d.join(".");a.name=u,a.modelType="3DModel",a.modelPosition="bottom",""!=i&&(a.position.set(i.location.x,i.location.y,i.location.z),a.rotation.y=i.rotation,i.rotate&&a.rotation.set(i.rotate.x,i.rotate.y,i.rotate.z),a.scale.set(i.width/l,i.height/c,i.depth/h),a.isLock=i.isLock,a.modelPosition=i.modelPosition,i.scale&&a.scale.copy(i.scale)),a.width=l,a.height=c,a.depth=h,a.imgPath="localPath",i?i.sliceArr&&(a.sliceArr=i.sliceArr):r.handleUpload(t,a),r.model3D.add(a),r.initCameraPngScene(a,"top"),setTimeout((function(){for(var e=r.cameraRenderer.domElement.toDataURL("image/png").split(","),t=e[0].match(/:(.*?);/)[1],n=atob(e[1]),o=n.length,s=new Uint8Array(o);o--;)s[o]=n.charCodeAt(o);var c=new Blob([s],{type:t});let d=new File([c],"upload.jpg",{type:"image/jpeg",lastModified:Date.now()}),u=new(0,$4xklQ.TextureLoader);u.setCrossOrigin("");let p=URL.createObjectURL(d);u.load(p,(e=>{let t=new(0,$4xklQ.Mesh)(new(0,$4xklQ.PlaneBufferGeometry)(1e3*l,1e3*h),new(0,$4xklQ.MeshBasicMaterial)({map:e,transparent:!0}));t.position.set(0,0,0),i.scale&&t.scale.set(i.scale.x,i.scale.z,i.scale.y),t.modelType="2DModel",r.model2D.add(t),t.modelId=a.uuid,t.param=[a],a.modelId=t.uuid,a.param=[t],t.name=a.name,t.modelPosition=a.modelPosition,""!=i||r.camera.isOrthographicCamera||(r.mouseCoverObj=a),""==i&&r.camera.isOrthographicCamera&&(r.mouseCoverObj=t),i&&("bottom"==a.modelPosition?a.visible=r.config.settingJson.showFloorFurniture:"top"==a.modelPosition?a.visible=r.config.settingJson.showCeilFurniture:a.visible=r.config.settingJson.showWallFurniture,t.visible=a.visible),r.synchroModel(a),r.list.progressClose.dispatch()}))}),100)}),(function(e){r.list.progressChange.dispatch(parseInt(e.loaded/e.total*100))}),(function(e){console.log(e)}))})),e.list.loadGLTFJson.add((function(e,t="load"){if(e.indexOf("modelPosition")<0){var i=new XMLHttpRequest;i.open("GET",e,!0),i.send(null),i.onreadystatechange=function(){if(4==i.readyState&&(200==i.status||0==i.status)){let e=JSON.parse(i.responseText);r.loadGLTFJsonCore(e,t)}}}else{let i=JSON.parse(e);r.loadGLTFJsonCore(i,t)}})),e.list.replaceGltf.add((function(e){let t=e[0];t.indexOf("modelPosition")>=0||t.indexOf(".json")>=0?r.list.loadGLTFJson.dispatch(e[0],"replace"):(r.list.loadGltf.dispatch(e,"",r.model3D,r.model2D,"replace"),window.intervalClear=setInterval((()=>{r.cleanInterval("replace")}),100))})),e.list.loadGltf.add((function(e,t="",i=r.model3D,n=r.model2D,o="load"){r.doorHelperGroupClean();let a="",s="",l="",c="",h="",d="",u="",p="";if(""!=t?(s=t.imgPath,a=t.modelPath,d=t.location,u=t.rotation,l=t.modelPosition,t.scale&&(p=t.scale)):(a=e[0],s=e[1],l=e[2]),!a)return;let m=r.config.maxWidth,f=s.split("/"),g=f[f.length-1].split(".");g.pop(),g=g.join(""),f.pop();let x=f.join("/");x+="/"+g+".json";var b=new XMLHttpRequest;b.open("GET",x,!0),b.send(null),b.onreadystatechange=function(){if(4==b.readyState)if(200==b.status||0==b.status){let e=JSON.parse(b.responseText),p=e.boundingBox.xLen/1e3,f=e.boundingBox.yLen/1e3,x=e.boundingBox.zLen/1e3;""!=t&&(p=t.width,f=t.height,x=t.depth);let y=r.wallHelp.obbBoxMain(1e3*p,1e3*x,0),w=r.wallHelp.obbBoxMain(p,f,x);w.name="model3dBox",y.name="model2dBox",t.scale&&y.scale.set(t.scale.x,t.scale.z,t.scale.y),w.layers.set(2),p>m&&(w.scale.set(m/p,m/p,m/p),y.scale.set(m/p,m/p,m/p)),i.add(w),n.add(y),w.modelId=y.uuid,w.param=[y],w.modelPosition=l,w.height=f,y.modelId=w.uuid,y.param=[w],r.camera.isOrthographicCamera&&""==t&&(r.mouseCoverObj=y),r.camera.isOrthographicCamera||""!=t||(r.mouseCoverObj=w),""!=t?(y.position.set(1e3*d.x,1e3*-d.z,0),t.imgLayer&&(y.position.z=t.imgLayer),y.rotation.z=u,w.position.set(d.x,d.y,d.z),w.rotation.y=u,t.rotate&&w.rotation.set(t.rotate.x,t.rotate.y,t.rotate.z),t.scale&&w.scale.copy(t.scale)):("top"==l?w.position.set(0,r.wallGroup3D.roomHeight/1e3-f/2,0):"bottom"==l?w.position.set(0,f/2,0):w.position.set(0,0,0),y.position.set(0,0,0),"load"!=o&&(y.position.set(9999,9999,9999),w.position.set(9999,9999,9999))),(new(0,$4xklQ.TextureLoader)).load(s,(e=>{c=new(0,$4xklQ.Mesh)(new(0,$4xklQ.PlaneBufferGeometry)(1e3*p,1e3*x),new(0,$4xklQ.MeshBasicMaterial)({map:e,depthWrite:!1,transparent:!0,opacity:1})),c.position.set(0,0,0),c.renderOrder=10,c.modelType="2DModel",""!=t&&(c.isLock=t.isLock,c.rotation.z=u,c.position.set(1e3*d.x,1e3*-d.z,0),t.imgLayer&&(c.position.z=t.imgLayer),t.scale&&c.scale.set(t.scale.x,t.scale.z,t.scale.y)),n.add(c),c.modelId=w.uuid,c.param=[w],"load"!=o&&c.position.set(9999,9999,9999),r.camera.isOrthographicCamera||""!=t||c.position.set(1e4,1e4,1e4),y.modelUUID=c.uuid,(new(0,$hu0fb.GLTFLoader)).load(a,(function(e){var n;h=e.scene,h.traverse((function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)})),h.position.set(1e4,1e4,1e4),h.modelType="3DModel",h.modelPosition=l,h.floorHei=0,(n=new(0,$4xklQ.Box3)).setFromObject(h),(n=new(0,$4xklQ.Box3)).setFromObject(h);let b=1*(n.max.x-n.min.x).toFixed(2),v=1*(n.max.y-n.min.y).toFixed(2),$=1*(n.max.z-n.min.z).toFixed(2);h.width=b,h.height=v,h.depth=$,h.name=g,c.name=g,h.modelId=c.uuid,h.param=[c],h.imgPath=s,h.modelPath=a,c.width=1e3*b,c.height=1e3*$,c.depth=1e3*v,c.imgPath=s,c.modelPath=a,w.modelUUID=h.uuid,h.visible=w.visible,c.visible=w.visible,i.add(h);let M=s.split("/"),S=M[M.length-2];if(c.modelRealType=S,h.modelRealType=S,r.camera.isOrthographicCamera||""!=t||(h.modelId=y.uuid,h.param=[y]),b>m&&(h.scale.set(m/b,m/b,m/b),c.scale.set(m/b,m/b,m/b)),""!=t){h.position.set(d.x,d.y,d.z),h.isLock=t.isLock,h.rotation.y=u,t.rotate&&h.rotation.set(t.rotate.x,t.rotate.y,t.rotate.z),c.modelId=h.uuid,c.param=[h];let e={x:p/b,y:x/$,z:f/v};c.geometry=new(0,$4xklQ.PlaneBufferGeometry)(p/e.x*1e3,x/e.y*1e3),c.scale.set(e.x,e.y,e.z),h.scale.set(e.x,e.z,e.y),t.scale&&(h.scale.copy(t.scale),c.scale.set(t.scale.x,t.scale.z,t.scale.y));let i=r.getOuterParent(c);r.synchroModel(i),w.parent.remove(w),y.parent.remove(y)}"load"!=o&&(r.mouseCoverObj="",h.position.set(9999,9999,9999),h.param=[c],c.param=[h],w.parent.remove(w),y.parent.remove(y))}))}))}else(new(0,$hu0fb.GLTFLoader)).load(a,(function(e){h=e.scene,h.traverse((function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)})),h.position.set(1e5,1e4,0),r.camera.isOrthographicCamera||""!=t||(r.mouseCoverObj=h),h.modelType="3DModel",h.modelPosition=l;var p=new(0,$4xklQ.Box3);p.setFromObject(h);let f=1*(p.max.x-p.min.x).toFixed(2),x=1*(p.max.y-p.min.y).toFixed(2),b=1*(p.max.z-p.min.z).toFixed(2);h.scale.set(1,1,1),f>m&&h.scale.set(m/f,m/f,m/f),h.width=f,h.height=x,h.depth=b,h.floorHei=0,""!=d&&(h.position.set(d.x,d.y,d.z),h.rotation.y=u,t.rotate&&h.rotation.set(t.rotate.x,t.rotate.y,t.rotate.z),h.scale.set(t.width/f,t.height/x,t.depth/b)),h.modelPath=a,""!=t&&(h.isLock=t.isLock,t.scale&&h.scale.copy(t.scale)),i.add(h),(new(0,$4xklQ.TextureLoader)).load(s,(e=>{if(f*=1e3,x=1e3*b,b=1e3*x,c=new(0,$4xklQ.Mesh)(new(0,$4xklQ.PlaneBufferGeometry)(f,x),new(0,$4xklQ.MeshBasicMaterial)({map:e,depthWrite:!1,transparent:!0,opacity:1})),c.position.set(1e5,1e4,0),c.renderOrder=10,r.camera.isOrthographicCamera&&""==t&&(r.mouseCoverObj=c),c.modelType="2DModel",c.width=1*f.toFixed(2),c.height=1*x.toFixed(2),c.depth=h.height,c.imgPath=s,c.modelPath=a,c.modelId=h.uuid,c.param=[h],h.modelId=c.uuid,h.param=[c],h.imgPath=s,h.name=g,c.name=g,n.add(c),""!=t){let e=new(0,$4xklQ.Vector3)(1e3*d.x,1e3*-d.z,0);c.position.set(e.x,e.y,e.z),t.imgLayer&&(c.position.z=t.imgLayer),c.isLock=t.isLock,t.scale&&c.scale.set(t.scale.x,t.scale.z,t.scale.y),"bottom"==h.modelPosition?h.visible=r.config.settingJson.showFloorFurniture:"top"==h.modelPosition?h.visible=r.config.settingJson.showCeilFurniture:h.visible=r.config.settingJson.showWallFurniture,c.visible=h.visible}let i=r.getOuterParent(h);r.synchroModel(i),"load"!=o&&(r.mouseCoverObj="",h.position.set(9999,9999,9999))}))}))}})),e.list.change2DWall.add((function(e){switch(e[0]){case"circle":case"bezier":r.list.changeWallType.dispatch(e[0]);break;case"split":r.list.splitWall.dispatch();break;case"del":r.list.delWall.dispatch()}})),e.list.changeWallParam.add((function(e,t,i=!1){if(""==r.clickSelect||""==r.clickSelect[0].object)return;let n=r.clickSelect[0].object;if(n.material.color=r.clickColor,"len"==e){let e=Math.round(n.startPoint.clone().distanceTo(n.endPoint.clone()));if(Math.abs(e-t)<1&&!i)return;let o=$9HO6e.UtilCore.havePointWall(n.endPoint,r.allWalls).length>1,a=r.getWallHelperByWall(n);a&&r.removeHelperByWall(a),o?r.changeWallLength(n,t,"end"):r.changeWallLength(n,t,"start")}else"depth"==e?n.thickness=1*t:"wallType"==e?(r.execute(),n.style=t,1==n.style?n.height=1200:n.height=window.storeyHei,n.material.color=r.getWallColor(n),i=!0):(r.execute(),n.height=1*t);if(!i)return;if(new $523a84362d27c3e8$export$b680ca477a72be07(r).wallToJson(),"depth"==e){let e=r.getAllWindowInWall(n);e.length>0&&e.forEach((e=>{r.currentDoor=e,r.currenDraw=e,new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(r,"door","end",[1*t,0,"depth"]).execute(),r.doorHelperGroupClean(),r.currentDoor=""}))}let o=$9HO6e.UtilCore.getRealWallByPosition(n.startPoint,n.endPoint,r.allWalls);r.clickSelect[0].object=o,r.allWalls.forEach((e=>{e.material.color=r.getWallColor(e)}))})),e.list.change2DFloor.add((function(e){switch(console.log(e),e){case"copy":let e=r.clickSelect[0].object;r.copyFloorMaterial=e.material;break;case"replaceOneself":r.execute(),r.list.replaceSelfMat.dispatch();break;case"replaceAll":r.execute(),r.list.replaceAllMat.dispatch()}})),e.list.replaceSelfMat.add((function(){e.selectObjArr.forEach((e=>{if(1==e.material.color.r)e.material=new $4xklQ.MeshBasicMaterial({color:15264748,side:$4xklQ.DoubleSide,transparent:e.material.transparent,opacity:e.material.opacity});else{let t=(new $4xklQ.TextureLoader).load("./static/assets/images/banner/floor.jpg");t.wrapS=$4xklQ.RepeatWrapping,t.wrapT=$4xklQ.RepeatWrapping,e.material=new $4xklQ.MeshBasicMaterial({map:t,transparent:e.material.transparent,opacity:e.material.opacity})}}))})),e.list.replaceAllMat.add((function(){e.floorGroup2d.children.forEach((e=>{if(1==e.material.color.r)e.material=new $4xklQ.MeshBasicMaterial({color:15264748,side:$4xklQ.DoubleSide,transparent:e.material.transparent,opacity:e.material.opacity});else{let t=(new $4xklQ.TextureLoader).load("./static/assets/images/banner/floor.jpg");t.wrapS=$4xklQ.RepeatWrapping,t.wrapT=$4xklQ.RepeatWrapping,e.material=new $4xklQ.MeshBasicMaterial({map:t,transparent:e.material.transparent,opacity:e.material.opacity})}}))})),e.list.change2DDoor.add((function(e){switch(e[0]){case"reverse":r.list.reverseDoor.dispatch();break;case"replace":r.list.replaceDoor.dispatch();break;case"copy":r.list.copyDoor.dispatch();break;case"lock":r.doorSetLock();break;case"del":r.list.delDoor.dispatch()}})),e.list.changeDoorParam.add((function(e,t,i=!1){if(""==r.clickSelect||""==r.clickSelect[0].object)return;if("depth"==e)return;r.removeInputByClassName(r.uiPanelBox.dom,"showDistance");let n="";if(r.camera.isOrthographicCamera)n=r.clickSelect[0].object.parent;else{let e=r.getOuterParent(r.clickSelect[0].object);e&&e.parameter?(n=e.parameter.tdm,r.clickSelect[0].object.parent=n):n=r.clickSelect[0].object.parent}if(r.currentDoor=n,"height"==e||"floorHei"==e?n[e]=1*t:r.execute(new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(r,"door","end",[t,0,e],!1,"click"),"改变门尺寸"),i){r.partRefreshWall(r.getWallById(n.wallId)),new $523a84362d27c3e8$export$b680ca477a72be07(r).wallToJson("3D");let e=r.get3DWindowBy2dWindow(n);if(e||(e=r.get3DWindowBy2dWindow(r.clickSelect[0].object.parent)),e){r.modelHelperGroup.children=[];let t=(new(0,$4xklQ.Box3)).setFromObject(e);const i=r.wallHelp.addOBBbox(e,1735416);if(i.name="modelBox",i.layers.set(2),r.modelHelperGroup.add(i),i.material.depthTest=!1,e.parameter.box=i,"UWindowMesh"==e.type&&(i.position.y+=(t.max.y-t.min.y)/2),"LWindowMesh"==e.type){let e=new(0,$4xklQ.Vector3);t.getCenter(e),i.position.copy(e.clone())}}}})),e.list.change2DMember.add((function(e){switch(e[0]){case"copy":r.list.copyDoor.dispatch();break;case"lock":r.memberSetLock();break;case"del":r.list.delMember.dispatch()}})),e.list.changeMemberParam.add((function(e,t,i=!1){if(""==r.clickSelect||""==r.clickSelect[0].object)return;let n=r.clickSelect[0].object.parent,o="";r.camera.isOrthographicCamera?(n=r.clickSelect[0].object.parent,o=r.clickSelect[0].object.parent.threeD):(n=r.clickSelect[0].object.twoD,o=r.clickSelect[0].object),r.doorHelperGroupClean();let a=0;if("depth"==e){if(a=n.depth/o.scale.z,n[e]=1*t,i&&r.camera.isOrthographicCamera)return void new $523a84362d27c3e8$export$b680ca477a72be07(r).wallToJson()}else if("width"==e){let e=t/(1*n.width);n.scale.x=e}else if("height"==e){let e=t/(1*n.height);n.scale.y=e}else"rotation"==e&&(n.rotation.z=Math.PI/180*t);if(r.addLineHelperForMember(n),r.camera.isOrthographicCamera)r.synchroModel(n);else{let i=1,s=0;r.wallGroup3D.roomHeight&&(s=r.wallGroup3D.roomHeight),"depth"==e&&(i=t/a,"beam"==n.modelType?o.position.z=s-a/2-(t-a)/2:o.position.z=a/2+(t-a)/2),o.scale.set(n.scale.x,n.scale.y,i),o.rotation.z=n.rotation.z,r.modelHelperGroup.children=[],r.addBoxForGroup(o)}})),e.list.change2DModel.add((function(e){if(""!=r.clickSelect&&""!=r.clickSelect[0].object)switch(e[0]){case"topFloat":case"bottomFloat":r.modelFloat(e[0]);break;case"frontBackTurn":case"aroundTurn":r.modelReverse(e[0]);break;case"replace":r.modelReplace();break;case"copy":r.modelCopy();break;case"hidden":r.modelHidden();break;case"lock":r.modelSetLock();break;case"collect":case"del":r.list.delModel.dispatch();break;case"upload":r.exportModelImg();break;case"save":r.list.saveModel.dispatch()}})),e.list.change2DModelParam.add((function(e,t,i=!1){if(""==r.clickSelect||""==r.clickSelect[0].object)return;let n=r.getOuterParent(r.clickSelect[0].object),o=r.getOuterParent(r.clickSelect[0].object,r.clickSelect[0].object,"outer"),a=o,s=n;"2dModel"==o.parent.name?(n=n.param[0],a=o.param[0]):s=n.param[0],n.updateMatrixWorld(!0,!0);let l=r.getRealSize(n);if("size"==e){let e=n.height*n.scale.y;e=l[1],n.updateMatrixWorld(!0,!0);let i=(new(0,$4xklQ.Vector3)).setFromMatrixScale(n.matrixWorld).clone().divide(n.scale),o=t[0]/n.width/1e3,a=t[2]/n.height/1e3,s=t[1]/n.depth/1e3;if(i=new(0,$4xklQ.Vector3)(o,a,s).divide(i),n.scale.copy(i),r.clickDepthMsg.uuid){let e=r.getOuterParent(n,n,"outer");r.refreshRealSizeByBox(e,n)}if(1!=a){let e=n.modelPosition;n.updateMatrixWorld(!0,!0);let t=r.getRealSize(n);n.updateMatrixWorld(!0,!0);let i=(new(0,$4xklQ.Vector3)).setFromMatrixScale(n.matrixWorld).clone().divide(n.scale),o=(t[1]-l[1])/2/i.y;"top"==e?n.position.y-=o:n.position.y+=o}r.synchroModel(n)}else if("floorHei"==e){let e=new(0,$4xklQ.Vector3)(0,l[1]/2+t/1e3,0);n.parent.worldToLocal(e),n.position.y=e.y,s.groundHei=t/1e3}else"rotation"==e&&(t[0]=Math.PI/180*(360-t[0]),t[1]=Math.PI/180*t[1],t[2]=Math.PI/180*t[2],n.rotation.set(t[0],t[2],t[1]),r.synchroModel(n));r.doorHelperGroupClean(),r.modelHelperGroup.children.forEach((e=>{"Line2"==e.type&&e.parent.remove(e)})),r.addBoxForGroup(n),r.addLineHelperForMember(s),r.refreshRealSizeByBox(a,n),r.updateModelPosition(n.parent,a)})),e.list.change3DDoor.add((function(e){if(""==r.clickSelect||""==r.clickSelect[0].object)return;let t=r.getOuterParent(r.clickSelect[0].object),i=t.parameter.tdm;switch(e[0]){case"reverse":if("LWindow"==i.modelType||"UWindow"==i.modelType)return;t.parameter.box.parent&&t.parameter.box.parent.remove(t.parameter.box),"door"==i.modelType||"childMotherDoor"==i.modelType?(r.currentDoor=i,r.noHiddenDialog=!0,r.execute(new $a9d7f9904bb6112a$export$6803bcffe5c71ec4(r,"door","end",[0,0,"angle"],!0,"click"),"翻转"),r.doorHelperGroupClean(),r.noHiddenDialog=!1,r.clickSelect[0].object=r.currentDoor.parameter[0],t=r.clickSelect[0].object):(t.rotation.y+=Math.PI,i.rotation.z+=Math.PI),r.transform3DTool.selectObj(t);break;case"lock":r.doorSetLock();break;case"replace":case"collect":default:break;case"copy":r.door3DCopy();break;case"del":if(t.isLock)return void r.list.alert.dispatch("模型已锁定,请先解锁","warning");r.execute(),t.parent.remove(t),r.removeDoor(i);let e=r.getWallById(i.wallId);r.partRefreshWall(e),r.removeInputByClassName(r.uiPanelBox.dom,"showDistance"),t.parameter.box&&t.parameter.box.parent.remove(t.parameter.box),r.list.hiddenDialog.dispatch()}})),e.list.change3DModel.add((function(e){switch(e[0]){case"scale":r.transform3DTool.useTranslate(!1).useScale(!0).useRotate(!1).switchMove(!1);break;case"moveAndRotation":r.transform3DTool.useScale(!1).useRotate(!0).useTranslate(!0).switchMove(!0);break;case"rotation":r.transform3DTool.useTranslate(!1).useScale(!1).switchRot(!0).switchMove(!1);break;case"move":case"replaceMaterial":case"array":case"collection":break;case"replace":r.modelReplace();break;case"frontBackTurn":case"aroundTurn":r.modelReverse(e[0]);break;case"copy":r.modelCopy();break;case"lock":r.modelSetLock();break;case"hidden":r.modelHidden();break;case"del":r.list.delModel.dispatch();break;case"makeGroup":r.list.makeGroup.dispatch();break;case"explodeGroup":r.list.explodeGroup.dispatch();break;case"upload":r.exportModelImg();break;case"save":r.list.saveModel.dispatch();break;case"frontAligning":case"rearAligning":case"leftAligning":case"rightAligning":case"topAligning":case"bottomAligning":case"frontAndBackAligning":case"leftRightAligning":case"topBottomAligning":r.execute();let t=[],i=r.selectObjArr.slice(0);r.camera.isOrthographicCamera?i.forEach((e=>{t.push(r.get3DModelBy2DModel(r.getOuterParent(e)))})):i.forEach((e=>{t.push(r.getOuterParent(e))})),r.modelAlign(e[0],t)}})),r.list.setRoomOpacity.add((e=>{"opacity"==e[0]?(window.roomOpacity=e[1]/100,r.floorGroup2d.children.forEach((e=>{e.material.transparent=!0,e.material.opacity=roomOpacity})),r.floorGroup.children.forEach((e=>{e.roomName&&(e.material.transparent=!0,e.material.opacity=roomOpacity)})),r.allWalls.forEach((e=>{e.material.transparent=!0,e.material.opacity=roomOpacity})),r.wallGroup3D.children.forEach((e=>{"3DWall"==e.modelType&&(e.material.transparent=!0,e.material.opacity=roomOpacity)}))):"floorHeight"==e[0]?(window.storeyHei=1*e[1],r.allWalls.forEach((e=>{e.height=window.storeyHei})),new $523a84362d27c3e8$export$b680ca477a72be07(r).wallToJson()):"levelPly"==e[0]&&(window.floorDep=1*e[1],r.floorGroup.children.forEach((e=>{e.roomName&&e.refresh()})))})),r.list.showRenderView.add((()=>{if(0==r.floorGroup.children.length){let e="温馨提示",t="请先绘制一个封闭户型";r.list.dialog.dispatch(e,t,[""])}else r.list.renderURL.dispatch()})),r.list.initRenderMain.add((e=>{new $7ed6d163147eea6e$export$267a13440f7c79db(e[0][0]),new $ad8bf51027a12264$export$10707adaaf0119d6(e[1][0]),new $93515037b4aa0d1f$export$7da8f54b9c0f630c(e[2])})),r.list.renderCameraSize.add((e=>{let t=window.innerHeight-110,i=t*e[0]/e[1],n=window.innerWidth/2-i/2,o=window.innerHeight/2-t/2;i>window.innerWidth-650&&(i=window.innerWidth-650,t=i*e[1]/e[0],n=window.innerWidth/2-i/2+30,o=window.innerHeight/2-t/2),r.list.cameraShot.dispatch(i,t,n,o,!0)})),r.list.changRenderCameraInput.add(((e,t)=>{if("height"==e)t=t.toString().replace("mm",""),r.renderViewCamera.position.y=t/1e3,r.renderViewControl.target.y=t/1e3;else{1*(t=t.toString().replace("°",""))>=-5&&1*t<=5&&(t=0);let e=t*Math.PI/180;e>Math.PI/2&&(e=Math.PI/2),e<-Math.PI/2&&(e=-Math.PI/2);let n=r.getRenderCameraAngle();if(isNaN(n))return;n*=Math.PI/180,e-=n;var i=new $4xklQ.Vector3;r.renderViewCamera.getWorldDirection(i);let o=-r.renderViewCamera.position.clone().distanceTo(i)*Math.sin(e);r.renderViewControl.target.y+=o}r.renderViewCamera.updateProjectionMatrix(),r.renderViewControl.update()}))}}const $17e0b9c8fbcffc37$var$Signal=signals.Signal;class $17e0b9c8fbcffc37$export$40d7e39b924588a0{constructor(){this.list={pluginList:new $17e0b9c8fbcffc37$var$Signal,activeTool:new $17e0b9c8fbcffc37$var$Signal,sceneInit:new $17e0b9c8fbcffc37$var$Signal,showDialog:new $17e0b9c8fbcffc37$var$Signal,hiddenDialog:new $17e0b9c8fbcffc37$var$Signal,importMap:new $17e0b9c8fbcffc37$var$Signal,changeWallType:new $17e0b9c8fbcffc37$var$Signal,splitWall:new $17e0b9c8fbcffc37$var$Signal,delWall:new $17e0b9c8fbcffc37$var$Signal,changeCameraSlider:new $17e0b9c8fbcffc37$var$Signal,changeWallParam:new $17e0b9c8fbcffc37$var$Signal,changeDoorParam:new $17e0b9c8fbcffc37$var$Signal,changeMemberParam:new $17e0b9c8fbcffc37$var$Signal,delDoor:new $17e0b9c8fbcffc37$var$Signal,delMember:new $17e0b9c8fbcffc37$var$Signal,delModel:new $17e0b9c8fbcffc37$var$Signal,reverseDoor:new $17e0b9c8fbcffc37$var$Signal,replaceDoor:new $17e0b9c8fbcffc37$var$Signal,copyDoor:new $17e0b9c8fbcffc37$var$Signal,changeCamera:new $17e0b9c8fbcffc37$var$Signal,createRoom:new $17e0b9c8fbcffc37$var$Signal,startPlayer:new $17e0b9c8fbcffc37$var$Signal,stopPlayer:new $17e0b9c8fbcffc37$var$Signal,setViewportCamera:new $17e0b9c8fbcffc37$var$Signal,viewportCameraChanged:new $17e0b9c8fbcffc37$var$Signal,executeTool:new $17e0b9c8fbcffc37$var$Signal,useModel:new $17e0b9c8fbcffc37$var$Signal,drawRoomChangeth:new $17e0b9c8fbcffc37$var$Signal,smartRoom:new $17e0b9c8fbcffc37$var$Signal,undo:new $17e0b9c8fbcffc37$var$Signal,redo:new $17e0b9c8fbcffc37$var$Signal,saveScene:new $17e0b9c8fbcffc37$var$Signal,saveEvent:new $17e0b9c8fbcffc37$var$Signal,removeAll:new $17e0b9c8fbcffc37$var$Signal,changeTheme:new $17e0b9c8fbcffc37$var$Signal,changeModel:new $17e0b9c8fbcffc37$var$Signal,createMap:new $17e0b9c8fbcffc37$var$Signal,exportGLTF:new $17e0b9c8fbcffc37$var$Signal,exitRomaScene:new $17e0b9c8fbcffc37$var$Signal,alert:new $17e0b9c8fbcffc37$var$Signal,loadGltf:new $17e0b9c8fbcffc37$var$Signal,default2D:new $17e0b9c8fbcffc37$var$Signal,resetCamera:new $17e0b9c8fbcffc37$var$Signal,splitTool:new $17e0b9c8fbcffc37$var$Signal,delSplitLine:new $17e0b9c8fbcffc37$var$Signal,dialog:new $17e0b9c8fbcffc37$var$Signal,blackBox:new $17e0b9c8fbcffc37$var$Signal,threeDimensions:new $17e0b9c8fbcffc37$var$Signal,setRoomType:new $17e0b9c8fbcffc37$var$Signal,switchBounced:new $17e0b9c8fbcffc37$var$Signal,footerView:new $17e0b9c8fbcffc37$var$Signal,makeGroup:new $17e0b9c8fbcffc37$var$Signal,explodeGroup:new $17e0b9c8fbcffc37$var$Signal,modelGroup3D:new $17e0b9c8fbcffc37$var$Signal,setScaleTool:new $17e0b9c8fbcffc37$var$Signal,hiddenMap:new $17e0b9c8fbcffc37$var$Signal,delMap:new $17e0b9c8fbcffc37$var$Signal,baseMap:new $17e0b9c8fbcffc37$var$Signal,doCallback:new $17e0b9c8fbcffc37$var$Signal,change2DWall:new $17e0b9c8fbcffc37$var$Signal,change2DModel:new $17e0b9c8fbcffc37$var$Signal,change3DModel:new $17e0b9c8fbcffc37$var$Signal,change2DMember:new $17e0b9c8fbcffc37$var$Signal,change2DModelParam:new $17e0b9c8fbcffc37$var$Signal,change2DDoor:new $17e0b9c8fbcffc37$var$Signal,change3DDoor:new $17e0b9c8fbcffc37$var$Signal,themeSwitch:new $17e0b9c8fbcffc37$var$Signal,exitTool:new $17e0b9c8fbcffc37$var$Signal,resetproperty:new $17e0b9c8fbcffc37$var$Signal,showHiddenHelper:new $17e0b9c8fbcffc37$var$Signal,getShowHiddenFlag:new $17e0b9c8fbcffc37$var$Signal,change2DFloor:new $17e0b9c8fbcffc37$var$Signal,replaceSelfMat:new $17e0b9c8fbcffc37$var$Signal,replaceAllMat:new $17e0b9c8fbcffc37$var$Signal,saveModel:new $17e0b9c8fbcffc37$var$Signal,uploadFile:new $17e0b9c8fbcffc37$var$Signal,saveModelRecord:new $17e0b9c8fbcffc37$var$Signal,loadGLTFJson:new $17e0b9c8fbcffc37$var$Signal,popupSaveRecord:new $17e0b9c8fbcffc37$var$Signal,modelReplace:new $17e0b9c8fbcffc37$var$Signal,replaceGltf:new $17e0b9c8fbcffc37$var$Signal,closeReplaceView:new $17e0b9c8fbcffc37$var$Signal,progressOpen:new $17e0b9c8fbcffc37$var$Signal,progressChange:new $17e0b9c8fbcffc37$var$Signal,progressClose:new $17e0b9c8fbcffc37$var$Signal,GPURender:new $17e0b9c8fbcffc37$var$Signal,saveWallModel:new $17e0b9c8fbcffc37$var$Signal,recoveryScene:new $17e0b9c8fbcffc37$var$Signal,saveWallJson:new $17e0b9c8fbcffc37$var$Signal,setRoomOpacity:new $17e0b9c8fbcffc37$var$Signal,viewRoomOpacity:new $17e0b9c8fbcffc37$var$Signal,setDefaultParams:new $17e0b9c8fbcffc37$var$Signal,uploadModelBar:new $17e0b9c8fbcffc37$var$Signal,changeBar:new $17e0b9c8fbcffc37$var$Signal,closeBar:new $17e0b9c8fbcffc37$var$Signal,cameraShot:new $17e0b9c8fbcffc37$var$Signal,closeCameraShot:new $17e0b9c8fbcffc37$var$Signal,initRenderMain:new $17e0b9c8fbcffc37$var$Signal,renderCameraSize:new $17e0b9c8fbcffc37$var$Signal,horizontalLine:new $17e0b9c8fbcffc37$var$Signal,deleteLine:new $17e0b9c8fbcffc37$var$Signal,renderURL:new $17e0b9c8fbcffc37$var$Signal,showRenderView:new $17e0b9c8fbcffc37$var$Signal,changRenderCameraInput:new $17e0b9c8fbcffc37$var$Signal,updateDialog:new $17e0b9c8fbcffc37$var$Signal}}}var $6145dfb1fc4f1219$exports={};$parcel$export($6145dfb1fc4f1219$exports,"MessageControl",(()=>$6145dfb1fc4f1219$export$a286e85c2650cc1c),(e=>$6145dfb1fc4f1219$export$a286e85c2650cc1c=e));const $6145dfb1fc4f1219$export$80edbf15fa61a4db={MESSAGE:"message",SUCCESS:"success",ERROR:"error",WARNING:"warning"},$6145dfb1fc4f1219$var$MessageIcon={MESSAGE:"icon-zhengque iconfont",SUCCESS:"icon-zhengque iconfont",ERROR:"icon-cuowu iconfont",WARNING:"icon-shizhi iconfont"},$6145dfb1fc4f1219$var$MessageTypeColor={MESSAGE:"#909399",SUCCESS:"#67c23a",ERROR:"#f56c6c",WARNING:"#e6a23c"},$6145dfb1fc4f1219$var$createDom=({isId:e=!1,name:t="",tag:i=""})=>{if(!i)return null;const r=document.createElement(i);return t&&(e?r.id=t:r.className=t),r},$6145dfb1fc4f1219$var$getTypeBGColor=e=>{let t="";switch(e){case $6145dfb1fc4f1219$export$80edbf15fa61a4db.SUCCESS:t="background-color:#f0f9eb";break;case $6145dfb1fc4f1219$export$80edbf15fa61a4db.ERROR:t="background-color:#fef0f0";break;case $6145dfb1fc4f1219$export$80edbf15fa61a4db.WARNING:t="background-color: #fdf6ec";break;default:t="background-color: #edf2fc"}return t},$6145dfb1fc4f1219$var$getTypeDomCss=e=>{let t="";switch(e){case $6145dfb1fc4f1219$export$80edbf15fa61a4db.SUCCESS:t=`${$6145dfb1fc4f1219$var$getTypeBGColor(e)};color: ${$6145dfb1fc4f1219$var$MessageTypeColor.SUCCESS};display:flex;`;break;case $6145dfb1fc4f1219$export$80edbf15fa61a4db.ERROR:t=`${$6145dfb1fc4f1219$var$getTypeBGColor(e)};color: ${$6145dfb1fc4f1219$var$MessageTypeColor.ERROR};display:flex;`;break;case $6145dfb1fc4f1219$export$80edbf15fa61a4db.WARNING:t=`${$6145dfb1fc4f1219$var$getTypeBGColor(e)};color: ${$6145dfb1fc4f1219$var$MessageTypeColor.WARNING};display:flex;`;break;default:t=`${$6145dfb1fc4f1219$var$getTypeBGColor(e)};color: ${$6145dfb1fc4f1219$var$MessageTypeColor.MESSAGE};display:flex;`}return t},$6145dfb1fc4f1219$var$getIconClass=e=>{let t="";switch(e){case $6145dfb1fc4f1219$export$80edbf15fa61a4db.SUCCESS:t=$6145dfb1fc4f1219$var$MessageIcon.SUCCESS;break;case $6145dfb1fc4f1219$export$80edbf15fa61a4db.ERROR:t=$6145dfb1fc4f1219$var$MessageIcon.ERROR;break;case $6145dfb1fc4f1219$export$80edbf15fa61a4db.WARNING:t=$6145dfb1fc4f1219$var$MessageIcon.WARNING;break;default:t=$6145dfb1fc4f1219$var$MessageIcon.MESSAGE}return t},$6145dfb1fc4f1219$var$getTypeIconCss=e=>{let t="";switch(e){case $6145dfb1fc4f1219$export$80edbf15fa61a4db.SUCCESS:t=`margin-right: 10px;font-size: 20px;color: ${$6145dfb1fc4f1219$var$MessageTypeColor.SUCCESS};`;break;case $6145dfb1fc4f1219$export$80edbf15fa61a4db.ERROR:t=`margin-right: 10px;font-size: 20px;color: ${$6145dfb1fc4f1219$var$MessageTypeColor.ERROR};`;break;case $6145dfb1fc4f1219$export$80edbf15fa61a4db.WARNING:t=`margin-right: 10px;font-size: 20px;color: ${$6145dfb1fc4f1219$var$MessageTypeColor.WARNING};`;break;default:t=`margin-right: 10px;font-size: 20px;color: ${$6145dfb1fc4f1219$var$MessageTypeColor.MESSAGE};`}return t},$6145dfb1fc4f1219$var$createMessage=({type:e,content:t,duration:i,delay:r,agaiBtn:n,minWidth:o,maxWidth:a},s)=>{if(!s)return void console.log("error!!!!");const l=Math.floor(89997*Math.random())+10002,c={isRemove:!1,type:e||$6145dfb1fc4f1219$export$80edbf15fa61a4db.MESSAGE,content:t||"",duration:i||3e3,delay:r||0,timeout:null,agaiBtn:n||!1},h=$6145dfb1fc4f1219$var$createDom({name:`message-${l}`,tag:"div"});h.style=`\n    min-width:${o}px;\n    max-width:${a}px;\n    padding:12px;\n    margin-top:-40px;\n    border-radius:4px;\n    box-shadow:-5px 5px 12px 0 rgba(204, 204, 204, 0.8);\n    ${$6145dfb1fc4f1219$var$getTypeBGColor(c.type)};\n  animation: all cubic-bezier(0.18, 0.89, 0.32, 1.28) 0.4s;\n  transition: all .4s;\n  pointer-events: auto;\n  overflow:hidden;\n    `;const d=$6145dfb1fc4f1219$var$createDom({tag:"div"});d.style=$6145dfb1fc4f1219$var$getTypeDomCss(c.type);const u=$6145dfb1fc4f1219$var$createDom({name:`${$6145dfb1fc4f1219$var$getIconClass(c.type)}`,tag:"div"});u.style=$6145dfb1fc4f1219$var$getTypeIconCss(c.type);const p=$6145dfb1fc4f1219$var$createDom({tag:"span"});if(p.style="font-size: 14px;line-height:20px;",p.innerHTML=c.content,d.appendChild(u),d.appendChild(p),h.appendChild(d),c.agaiBtn){const e=$6145dfb1fc4f1219$var$createDom({name:"message-again-btn",tag:"div"});e.style="margin-top: 5px;text-align:right;";const t=$6145dfb1fc4f1219$var$createDom({name:"message-again-text",tag:"span"});t.innerHTML="不再提示",t.style="\n        font-size: 12px;\n        color: rgb(204, 201, 201);\n        border-bottom: 1px solid rgb(204, 201, 201);\n        cursor: pointer;\n        ",t.onmouseover=()=>{t.style.color="#fdb906",t.style.borderBottom="1px solid #fdb906"},t.onmouseout=()=>{t.style.color="rgb(204, 201, 201)",t.style.borderBottom="1px solid rgb(204, 201, 201)"},e.appendChild(t),h.appendChild(e),c.elsAgainBtn=t}function m(){c.els=null,c.elsAgainBtn=null,c.destory=null}return s.appendChild(h),c.els=h,c.destory=function(e,t){if(!c.els||!e||c.isRemove)return;c.els.style.marginTop="-20px",c.els.style.opacity="0",c.isRemove=!0,t?(e.removeChild(h),$6145dfb1fc4f1219$var$_resetMianPosition(e),m()):setTimeout((()=>{e.removeChild(h),$6145dfb1fc4f1219$var$_resetMianPosition(e),m()}),400)}.bind(void 0),c};function $6145dfb1fc4f1219$var$_toBindEvents(e,t){e&&(e.agaiBtn&&e.elsAgainBtn&&(e.elsAgainBtn.onclick=()=>{clearTimeout(e.timeout);let i=sessionStorage.getItem("MESSAGE_DONT_REMIND_AGAIN"),r=i?JSON.parse(i):[],n=Array.isArray(r)?r:[];n.push(e.content),sessionStorage.setItem(t.sessionStorageName,JSON.stringify(n)),e.destory(t.mainContainer,!0)}),e.els.onmouseover=()=>{clearTimeout(e.timeout)},e.els.onmouseout=()=>{e.timeout=setTimeout((()=>{e.destory(t.mainContainer),clearTimeout(e.timeout)}),1e3)},e.timeout=setTimeout((()=>{e.destory(t.mainContainer),clearTimeout(e.timeout)}),e.duration))}function $6145dfb1fc4f1219$var$_resetMianPosition(e){e&&(e.style.left=`calc(50vw - ${e.scrollWidth/2}px)`)}class $6145dfb1fc4f1219$export$a286e85c2650cc1c{constructor(){this.minWidth=380,this.maxWidth=800,this.top=90,this.zIndex=999,this.mainContainerIdName="selfDefine-message-box",this.sessionStorageName="MESSAGE_DONT_REMIND_AGAIN";let e=document.getElementById(this.mainContainerIdName);e&&document.body.removeChild(e),this.mainContainer=$6145dfb1fc4f1219$var$createDom({isId:!0,name:this.mainContainerIdName,tag:"div"}),this.mainContainer.style=`\n      pointer-events:none;\n      position:fixed;\n      top:${this.top}px;\n      left:calc(50vw - ${this.minWidth/2}px);\n      z-index:${this.zIndex};\n      display: flex;\n      flex-direction: column;\n      align-items:center;\n      `,document.body.appendChild(this.mainContainer)}message(e={}){let t=sessionStorage.getItem(this.sessionStorageName),i=t?JSON.parse(t):null;if(e.againBtn&&e.content&&i&&Array.isArray(i)&&i.includes(e.content))return;const r=$6145dfb1fc4f1219$var$createMessage({type:e.type,content:e.content,duration:e.duration,delay:e.delay,againBtn:e.againBtn,minWidth:this.minWidth,maxWidth:this.maxWidth},this.mainContainer);this.mainContainer.appendChild(r.els),r.els.style.marginTop="20px",$6145dfb1fc4f1219$var$_resetMianPosition(this.mainContainer),$6145dfb1fc4f1219$var$_toBindEvents(r,this)}beforeDestory(){this.mainContainer&&this.mainContainer.remove?this.mainContainer.remove():document.body.removeChild(this.mainContainer),this.mainContainer=null}}class $2c167817c884d6ec$export$e02d10d50143e701{constructor(e){this.boxHtml=document.createElement("div"),this.boxHtml.className="black_box",this.boxHtml.style.display="none",e.uiPanelBox.dom.appendChild(this.boxHtml),this.editor=e}setVal(e){let t=document.getElementsByClassName("black_box")[0];t.style.display="block",t.style=`top:${e.top}px;left:${e.left}px;position:absolute;`,t.innerHTML=`<span>${"number"==typeof e.value?e.value+"°":e.value}</span>`}removeDom(){let e=document.getElementsByClassName("black_box")[0];e&&this.editor.uiPanelBox.dom.removeChild(e)}}var $hn8Wk=parcelRequire("hn8Wk"),$3YQYO=parcelRequire("3YQYO"),$huS6x=parcelRequire("huS6x"),$kjwe7=parcelRequire("kjwe7"),$4jMdz=parcelRequire("4jMdz"),$kOTLu=parcelRequire("kOTLu"),$hRcuq=parcelRequire("hRcuq");class $59ac0d6becd6e084$export$d981182684770f2a{constructor(e){this.opts=Object.assign({keys:"",title:"",extent:null,extentMax:null,width:null,widthMax:null,height:null,heightMax:null,takeOff:null,angle:null},e);const t=document.querySelectorAll(".public_property");for(let e=0;e<t.length;e++){const i=t[e];i.parentNode.removeChild(i)}const i=document.getElementsByClassName("property")[0];var r=document.createElement("div");r.setAttribute("id","bridge"),r.className="public_property",i.insertBefore(r,i.child),this.init()}init(){this.renderView(),this.event()}renderView(){$("#bridge").append(`<div class="header">\n          <svg\n            height="1em"\n            viewBox="0 0 5 14"\n            width="1em"\n            fill="currentColor"\n            aria-hidden="true"\n          >\n            <path\n              d="M1 2a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm3 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2zM1 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm3 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm-3 4a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm3 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm-3 4a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm3 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"\n              fill-rule="evenodd"\n            ></path>\n          </svg>\n          <span class='flag_keys' keys=${this.opts.keys}>${this.opts.title}</span>\n        </div>\n        <div class="propertycontent">\n        <div class="content_header" onclick = "runEffect('.bridgecontent_box')">\n          <div>基础参数</div>\n          <div>\n          <img src="./static/assets/images/property/pulldown.svg"/>\n      </div>\n        </div>\n        <div class="bridgecontent_box">\n        <div class="bridgelength">\n      </div>\n      <div class="bridgeply">\n      </div>\n      <div class="bridgeheight">\n      </div>\n      <div class="angle bridge_angle">\n      <span>角度</span>\n        <input value=${this.opts.angle} />\n        <span class='angle_unit'>°</span>\n      </div>\n        </div>\n      </div>\n        `),new(0,$hRcuq.Slider)({title:"长度",location:".bridgelength",unit:"mm",sliderVal:`${this.opts.extent}`,sliderMax:`${this.opts.extentMax}`,sliderMin:"1",valueId:"bridgeLenghtVal",sliderId:"bridgeLenght",numbertype:"width"}),new(0,$hRcuq.Slider)({title:"宽度",location:".bridgeply",unit:"mm",sliderVal:`${this.opts.width}`,sliderMax:`${this.opts.widthMax}`,sliderMin:"1",valueId:"bridgeHeightVal",sliderId:"bridgeHeight",numbertype:"height"}),new(0,$hRcuq.Slider)({title:"高度",location:".bridgeheight",unit:"mm",sliderVal:`${this.opts.height}`,sliderMax:`${this.opts.heightMax}`,sliderMin:"1",valueId:"bridgeWidthVal",sliderId:"bridgeWidth",numbertype:"depth"})}event(){const e=document.querySelector(".bridge_angle input");e.addEventListener("blur",(function(){editor.list.changeMemberParam.dispatch("rotation",e.value)})),e.onkeydown=t=>{13===t.keyCode&&editor.list.changeMemberParam.dispatch("rotation",e.value)}}}var $4sbRm=parcelRequire("4sbRm"),$hRcuq=parcelRequire("hRcuq");class $75791059b3ab27f7$export$cb4338d67ffa8a1d{constructor(e){this.opts=Object.assign({keys:"",extent:null,height:null,thickness:null},e);const t=document.querySelectorAll(".public_property");for(let e=0;e<t.length;e++){const i=t[e];i.parentNode.removeChild(i)}const i=document.getElementsByClassName("property")[0];var r=document.createElement("div");r.setAttribute("id","wall"),r.className="public_property",i.insertBefore(r,i.child),this.init()}init(){this.renderView(),this.event()}renderView(){$("#wall").append(` <div class="header">\n          <svg\n            height="1em"\n            viewBox="0 0 5 14"\n            width="1em"\n            fill="currentColor"\n            aria-hidden="true"\n          >\n            <path\n              d="M1 2a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm3 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2zM1 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm3 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm-3 4a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm3 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm-3 4a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm3 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"\n              fill-rule="evenodd"\n            ></path>\n          </svg>\n          <span class='flag_keys' keys=${this.opts.keys}>墙</span>\n        </div>\n          <div class="propertycontent ">\n          <div class="content_header" >\n          <div>基础参数</div>\n          <div>\n              <img src="./static/assets/images/property/pulldown.svg"/>\n          </div>\n        </div>\n        <div class="propertycontent_box_1">\n        <div class="btn_wall">\n            <button  id='commonWall'>普通墙</button>\n            <button  id='mainWall'>承重墙</button>\n            <button id='lowWall'>矮墙</button>\n        </div>\n        <div class="walllength">\n      </div>\n      <div class="wallheight">\n    \n      </div>\n      <div class="wallplay">\n      </div>\n          </div>\n        `),new(0,$hRcuq.Slider)({title:"长度",location:".walllength",unit:"mm",sliderVal:`${this.opts.extent}`,sliderMax:"10000",sliderMin:"1",valueId:"walllenghtValue",sliderId:"wallLenght",numbertype:"len"}),new(0,$hRcuq.Slider)({title:"高度",location:".wallheight",unit:"mm",sliderVal:`${this.opts.height}`,sliderMax:window.storeyHei,sliderMin:"1",valueId:"wallHeightValue",sliderId:"wallHeight",numbertype:"height"}),new(0,$hRcuq.Slider)({title:"厚度",location:".wallplay",unit:"mm",sliderVal:`${this.opts.thickness}`,sliderMax:"1000",sliderMin:"1",valueId:"wallplyValue",sliderId:"wallply",numbertype:"depth"})}event(){const e=$("#wall input[type = range]"),t=$("#wall .input_area"),i=$("#wall button");document.querySelector("#commonWall").addEventListener("click",(function(){t[1].classList.add("not_allowed"),i.removeClass("active_btn"),i[0].classList.add("active_btn"),e[1].disabled=!0,t[1].children[1].disabled=!0,$("#wallHeightValue").val(window.storeyHei),$("#wallHeight").val(window.storeyHei),editor.list.changeWallParam.dispatch("wallType",2)})),document.querySelector("#lowWall").addEventListener("click",(function(){i.removeClass("active_btn"),t[1].classList.remove("not_allowed"),i[2].classList.add("active_btn"),e[1].disabled=!1,t[1].children[1].disabled=!1,$("#wallHeightValue").val(1200),$("#wallHeight").val(1200),editor.list.changeWallParam.dispatch("wallType",1)})),document.querySelector("#mainWall").addEventListener("click",(function(){t[1].classList.add("not_allowed"),i.removeClass("active_btn"),i[1].classList.add("active_btn"),e[1].disabled=!0,t[1].children[1].disabled=!0,$("#wallHeightValue").val(window.storeyHei),$("#wallHeight").val(window.storeyHei),editor.list.changeWallParam.dispatch("wallType",0)}))}}var $hRcuq=parcelRequire("hRcuq");class $9b9eb4ffa840cd88$export$cec157cbbbaf65c9{constructor(e){this.opts=Object.assign({keys:"",width:null,height:null,depth:null,takeOff:null,disabledFlag:null},e);const t=document.querySelectorAll(".public_property");for(let e=0;e<t.length;e++){const i=t[e];i.parentNode.removeChild(i)}const i=document.getElementsByClassName("property")[0];var r=document.createElement("div");r.setAttribute("id","window"),r.className="public_property",i.insertBefore(r,i.child),this.init()}init(){this.renderView(),this.window()}renderView(){$("#window").append(`<div class="header">\n          <svg\n            height="1em"\n            viewBox="0 0 5 14"\n            width="1em"\n            fill="currentColor"\n            aria-hidden="true"\n          >\n            <path\n              d="M1 2a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm3 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2zM1 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm3 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm-3 4a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm3 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm-3 4a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm3 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"\n              fill-rule="evenodd"\n            ></path>\n          </svg>\n          <span class='flag_keys' keys=${this.opts.keys}>${this.opts.disabledFlag}</span>\n        </div>\n        <div class="propertycontent">\n        <div class="content_header">\n          <div>基础参数</div>\n          <div>\n          <img src="./static/assets/images/property/pulldown.svg"/>\n      </div>\n        </div>\n        <div class="windowcontent_box">\n          <div class="btn_door">\n            <button id='commonWindow' class="door-el-btn">窗</button>\n            <button id='frenchWindow' class="door-el-btn">落地窗</button>\n            <button id='bayWindow' class="door-el-btn">飘窗</button>\n          </div>\n          <div class="windowlength">\n       \n        </div>\n        <div class="windowHeight">\n      \n      </div>\n      <div class="windowply">\n     \n      </div>\n      <div class="windowlidi">\n    \n      </div>\n      <button class="recover_default">恢复默认</button>\n        </div>\n      </div>`);let e=null;e="L型窗"==this.opts.disabledFlag||"U型窗"==this.opts.disabledFlag,new(0,$hRcuq.Slider)({title:"宽度",location:".windowlength",unit:"mm",sliderVal:`${this.opts.width}`,sliderMax:"10000",sliderMin:"1",valueId:"windowLenghtVal",sliderId:"windowLenght",numbertype:"width",disabled:e}),new(0,$hRcuq.Slider)({title:"高度",location:".windowHeight",unit:"mm",sliderVal:`${this.opts.height}`,sliderMax:"2800",sliderMin:"1",valueId:"windowHeightVal",sliderId:"windowHeight",numbertype:"height"}),new(0,$hRcuq.Slider)({title:"深度",location:".windowply",unit:"mm",sliderVal:`${this.opts.depth}`,sliderMax:"240",sliderMin:"1",valueId:"windowPlyVal",sliderId:"windowPly",numbertype:"depth",disabled:e}),new(0,$hRcuq.Slider)({title:"离地",location:".windowlidi",unit:"mm",sliderVal:`${this.opts.takeOff}`,sliderMax:"2800",sliderMin:"1",valueId:"windowLiftoffVal",sliderId:"windowLiftoff",numbertype:"floorHei"})}window(){$("#commonWindow").click((()=>{console.log("普通窗")})),$("#frenchWindow").click((()=>{console.log("落地窗")})),$("#bayWindow").click((()=>{console.log("飘窗")}))}}var $hRcuq=parcelRequire("hRcuq");class $43001ecb7f19fac4$export$602193f4ae91c7b9{constructor(e){this.opts=Object.assign({keys:"",extent:null,height:null,ply:null,takeOff:null,modelName:null},e);const t=document.querySelectorAll(".public_property");for(let e=0;e<t.length;e++){const i=t[e];i.parentNode.removeChild(i)}const i=document.getElementsByClassName("property")[0];var r=document.createElement("div");r.setAttribute("id","door"),r.className="public_property",i.insertBefore(r,i.child),this.init()}init(){this.renderView(),this.commondoor()}renderView(){$("#door").append(`  <div class="header">\n          <svg\n            height="1em"\n            viewBox="0 0 5 14"\n            width="1em"\n            fill="currentColor"\n            aria-hidden="true"\n          >\n            <path\n              d="M1 2a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm3 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2zM1 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm3 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm-3 4a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm3 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm-3 4a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm3 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"\n              fill-rule="evenodd"\n            ></path>\n          </svg>\n          <span class='flag_keys' keys=${this.opts.keys}>${this.opts.modelName}</span>\n        </div>\n        <div class="propertycontent">\n        \x3c!-- 内容头部 --\x3e\n        <div class="content_header">\n          <div>基础参数</div>\n          <div>\n          <img src="./static/assets/images/property/pulldown.svg"/>\n      </div>\n        </div>\n        <div class="doorcontent_box">\n          <div class="btn_door">\n            <button id='commonDoor' class="door-el-btn">门</button>\n            <button id='doubleDoor' class="door-el-btn">双开门</button>\n            <button id='slidingDoor' class="door-el-btn">移门</button>\n          </div>\n          <div class="doorlength">\n        </div>\n        <div class="doorHeight">\n      </div>\n      <div class="doorply">\n      </div>\n      <div class="lidi">\n      </div>\n      <button class="recover_default">恢复默认</button>\n        </div>\n      </div>\n        `),new(0,$hRcuq.Slider)({title:"长度",location:".doorlength",unit:"mm",sliderVal:`${this.opts.extent}`,sliderMax:"2800",sliderMin:"1",valueId:"doorLenghtVal",sliderId:"doorLenght",numbertype:"width"}),new(0,$hRcuq.Slider)({title:"高度",location:".doorHeight",unit:"mm",sliderVal:`${this.opts.height}`,sliderMax:"20000",sliderMin:"1",valueId:"doorHeightVal",sliderId:"doorHeight",numbertype:"height"}),new(0,$hRcuq.Slider)({title:"厚度",location:".doorply",unit:"mm",sliderVal:`${this.opts.ply}`,sliderMax:"1500",sliderMin:"1",valueId:"doorPlyVal",sliderId:"doorPly",numbertype:"depth"}),new(0,$hRcuq.Slider)({title:"离地",location:".lidi",unit:"mm",sliderVal:`${this.opts.takeOff}`,sliderMax:"2800",sliderMin:"0",valueId:"doorLiftoffVal",sliderId:"doorLiftoff",numbertype:"floorHei"})}commondoor(){$("#commonDoor").click((()=>{console.log("普通门")})),$("#doubleDoor").click((()=>{console.log("双开门")})),$("#slidingDoor").click((()=>{console.log("移门")}))}}var $hRcuq=parcelRequire("hRcuq");class $2f4cd73062ed1d8f$export$4880b0ae5643c62b{static roomTypelist=[{name:"未命名"},{name:"门厅"},{name:"客厅"},{name:"餐厅"},{name:"阳台"},{name:"卧室"},{name:"主卧"},{name:"次卧"},{name:"儿童房"},{name:"老人房"},{name:"洗衣间"},{name:"卫生间"},{name:"走廊"},{name:"厨房"}];constructor(){const e=document.querySelectorAll(".public_property");for(let t=0;t<e.length;t++){const i=e[t];i.parentNode.removeChild(i)}const t=document.getElementsByClassName("property")[0];var i=document.createElement("div");i.setAttribute("id","floor"),i.className="public_property",t.insertBefore(i,t.child),this.init()}init(){this.renderView(),this.handover(),$2f4cd73062ed1d8f$export$4880b0ae5643c62b.roomSelect()}renderView(){$("#floor").append(` <div class="view_header">\n              <div class="header_icon1" >\n                  <svg height="1em" viewBox="0 0 5 14" width="1em" fill="currentColor" aria-hidden="true">\n                      <path\n                          d="M1 2a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm3 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2zM1 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm3 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm-3 4a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm3 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm-3 4a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm3 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"\n                          fill-rule="evenodd"></path>\n                  </svg>\n              </div>\n              <div class="header_title" id = "untitled">\n                  未命名\n              </div>\n              <div class="header_title" id="floorProperties">\n                  楼层属性\n              </div>\n          </div>\n          <div class="propertycontent_box_2" id="unnamed">\n          <div class="diban_content">\n          <div class="property_select">\n            <div class="room_property">\n              <span>房间类型</span>\n              <select id='roomtype' placeholder="自定义">\n                ${$2f4cd73062ed1d8f$export$4880b0ae5643c62b.roomTypelist.map((e=>"未命名"==e.name?`<option selected>${e.name}</option>`:`<option >${e.name}</option>`))}\n                <select>\n            </div>\n            <div class="room_property">\n              <span>房间名</span>\n              <input id='roomname' value='房间名'></input>\n            </div>\n          </div>\n          <div class="page_range">\n            <div class="title">\n              <span>区域设置</span>\n              <div class="el-icon-arrow-up"></div>\n            </div>\n            <div class="page_content">\n              <div class="page_btn">\n                <span>提供波打线、腰线、水刀等功能</span>\n                <button>\n                  <div class="el-icon-edit"></div>\n                  <span>铺贴编辑</span>\n                </button>\n              </div>\n              \x3c!-- 位置属性 --\x3e\n              <div class="location_title">\n                <span>位置属性</span>\n                <div class="el-icon-arrow-up"></div>\n              </div>\n              <div class="location_property">\n                \x3c!-- <el-select></el-select> --\x3e\n                <div class=""></div>\n              </div>\n            </div>\n          </div>\n          </div>\n          </div>\n          <div class="propertycontent_box_2" id="floorProperty" style="display: none;">\n          <div class= "content">\n          <div class="content_header">\n                <div>基础参数</div>\n                <div>\n                    <img src="./static/assets/images/property/pulldown.svg"/>\n                </div>\n              </div>\n          <div class="propertycontent_box_3">\n            <div class="addfloor">\n                <div>添加楼层</div>\n                  <div class="floor_icon">\n                    <div class="icon_box tooltips">\n                      <div class="center cursor">\n                        <img src="./static/assets/images/property/addfloor.svg"/>\n                      </div>\n                      <div class="tooltiptext tooltips_width_2 center">新建楼层</div>\n                    </div>\n                    <div class="icon_box tooltips">\n                    <div class="center cursor">\n                    <img src="./static/assets/images/property/addfloor.svg"/>\n                  </div>\n                  <div class="tooltiptext tooltips_width_3 center">新建地下室</div>\n                    </div>\n                  </div>\n            </div>\n            <div class="addfloor">\n            <div>当前楼层</div>\n            <div class="dangqian">\n              <select placeholder="1层">\n                <option label="1层"></option>\n              <select>\n            </div>\n          </div>\n          <div class="addfloor inside_space">\n          </div>\n          <div class="floorHeight">\n          </div>\n          <div class="floorPly">\n          </div>\n          </div>\n          </div>\n          `),new(0,$hRcuq.Slider)({title:"套内面积",location:".inside_space",unit:"mm",sliderVal:"200",sliderMax:"1500",sliderMin:"1"}),new(0,$hRcuq.Slider)({title:"层高",location:".floorHeight",unit:"mm",sliderVal:"200",sliderMax:"1500",sliderMin:"1"}),new(0,$hRcuq.Slider)({title:"地板厚度",location:".floorPly",unit:"mm",sliderVal:"200",sliderMax:"1500",sliderMin:"1"})}handover(){$("#untitled").click((function(){bar.openContent(event,"unnamed","propertycontent_box_2","header_title")})),$("#floorProperties").click((function(){bar.openContent(event,"floorProperty","propertycontent_box_2","header_title")}))}static roomSelect(){document.querySelector("#roomtype").addEventListener("change",(function(e){$("#roomname").val(e.target.value),editor.list.setRoomType.dispatch(e.target.value)}));const e=document.querySelector("#roomname");e.addEventListener("keydown",(function(e){$("#roomname").val(e.target.value),editor.list.setRoomType.dispatch(e.target.value)})),e.addEventListener("blur",(function(e){$("#roomname").val(e.target.value),editor.list.setRoomType.dispatch(e.target.value)}))}}var $9bipm=parcelRequire("9bipm"),$7tpVA=parcelRequire("7tpVA");class $5825b7c0f2e24f84$export$31709734768e711f{constructor(e){this.opts=Object.assign({title:"",viewList:[],replace:!0},e);const t=document.querySelectorAll(".replaceView");for(let e=0;e<t.length;e++){const i=t[e];i.parentNode.removeChild(i)}const i=document.querySelector(".hideBarleft"),r=document.createElement("div"),n=document.createElement("div");r.className="replaceView",n.className="tier replaceDom",i.appendChild(r),r.appendChild(n);const o=document.createElement("div");o.className="replaceHeader",n.appendChild(o);const a=document.createElement("div");a.className="replaceContent",n.appendChild(a),this.init()}init(){this.renderView()}renderView(){$(".replaceHeader").append(`<div class='public_title'><span>商品替换</span><div class="closeReplace cursor ">x</div></div>\n                  <div class='search_box'><span class='iconfont icon-yangbanjian-xiaosuo'></span><input placeholder='在“${this.opts.title}”下搜索' /><div class='spread cursor'><img src='./static/assets/images/zhankai.svg'/></div></div>`),$(".replaceContent").append("\n            <div class='public_view_content'>\n            <div class='public_view_content_item'>\n            <div class='type_box'>\n            <div class='iconfont icon-yangbanjian-baixu cursor'></div>\n            </div>\n            <div class='public_srcItem1'></div>\n            </div>\n            </div>"),$((function(){let e=new(0,$7tpVA.NewSelect)({height:"20px",width:"56px",title:"色系",location:".type_box"}),t=new(0,$7tpVA.NewSelect)({height:"20px",width:"56px",title:"风格",location:".type_box",list:[{value:"田园风",label:"1"},{value:"中式风格",label:"2"},{value:"欧式风格",label:"3"},{value:"日式风格",label:"4"}]}),i=new(0,$7tpVA.NewSelect)({height:"20px",width:"56px",title:"材质",location:".type_box",list:[{value:"田园风",label:"1"},{value:"中式风格",label:"2"},{value:"欧式风格",label:"3"},{value:"日式风格",label:"4"}]});e.open(),t.open(),i.open(),$(".closeReplace").click((function(){editor.list.closeReplaceView.dispatch()}))})),$(".public_srcItem1").append(`${this.opts.viewList[0].item.map((e=>`<div class='public_view_item1 cursor' data-type=${e.modelPosition}>\n                    <img  data-img='${e.src}'  src='${e.src}'/>\n                </div>`)).join("")}`);document.querySelectorAll(".public_view_item1").forEach(((e,t)=>{e.onclick=function(){const t=e.dataset.file,i=e.children[0].dataset.img;let r=i.replace(/iso.png/gi,"sim.glb");const n=i.replace(/iso.png/gi,".png"),o=e.dataset.type;"json"==t?(r=i.replace(/iso.png/gi,".json"),editor.list.replaceGltf.dispatch([r])):editor.list.replaceGltf.dispatch([r,n,o])}}))}}var $eBHx9=parcelRequire("eBHx9");class $9a6b61afc4a7067f$export$c17561cb55d4db30{constructor(){this.opts={pregressVal:0},this.init()}init(){this.createElement()}create(e,t){let i=document.createElement(e);return i.className=t,i}createElement(){this.$PROGRESSBAR=this.createBar(),this.$PROGRESSTITLE=this.createTitle(),this.$PROGRESSBOX=this.createProgressBar(),this.$PROGRESSBAR.appendChild(this.$PROGRESSTITLE),this.$PROGRESSBAR.appendChild(this.$PROGRESSBOX),document.body.appendChild(this.$PROGRESSBAR)}createBar(){return this.$BAR=this.create("div","progress_bar"),this.$BAR}createTitle(){return this.$TITLE=this.create("span","progress_bar_title"),this.$TITLE.innerHTML="上传中...",this.$TITLE}createProgressBar(){return this.$PROGRESS=this.create("div","progress_barbox"),this.$PROGRESSVAL=this.create("span","progress_val"),this.$PROGRESSVAL.innerHTML=`${this.opts.pregressVal}%`,this.$PROGRESS.appendChild(this.$PROGRESSVAL),this.$PROGRESS.style.width=this.opts.pregressVal+"%",console.log(this.opts.pregressVal),this.$PROGRESS}}var $6VBvh=parcelRequire("6VBvh");class $eeb2d6c356491192$export$f270d770ff78cf6f{constructor(e){this.options={value:0}}init(){this.createElement()}create(e,t){let i=document.createElement(e);return i.className=t,i}createElement(){this.$PROGRESSBAR=this.createBar(),this.$PROGRESSTITLE=this.createTitle(),this.$PROGRESSBOX=this.createProgressBar(),this.$PROGRESSBAR.appendChild(this.$PROGRESSTITLE),this.$PROGRESSBAR.appendChild(this.$PROGRESSBOX),document.body.appendChild(this.$PROGRESSBAR)}createBar(){return this.$BAR=this.create("div","uploading_dialog"),this.$BAR.id="upload_dialog_pop",this.$BAR.style="\n        height: 40px;\n        width: 200px;\n        position : absolute;\n        bottom: 50px;\n        right:0;\n        z-index: 9999;\n        background: #fff;\n        border: 1px solid #fff;\n        border-radius: 4px;\n        box-shadow: 0px 0px 30px -15px #7e7b7b;\n        ",this.$BAR}createTitle(){return this.$TITLE=this.create("span","uploading_dialog_title1"),this.$TITLE.style="\n        font-size:12px;\n        display: flex;\n        justify-content: center;\n        ",this.$TITLE.innerHTML="上传中...",this.$TITLE}createProgressBar(){return this.$PROGRESS=this.create("div","progress_barbox1"),this.$PROGRESSVAL=this.create("span","progress_val1"),this.$PROGRESSVAL.innerHTML=`${this.options.value}%`,this.$PROGRESS.appendChild(this.$PROGRESSVAL),this.$PROGRESS.style.width=this.options.value+"%",console.log(this.options.value),this.$PROGRESS}hide(){document.querySelector("#upload_dialog_pop").remove()}}class $e75d68308b9e99e6$export$15c5a38ef0258a50{constructor(){}init(e,t,i,r,n){n?(document.querySelector("#cameraShot_box")&&this.close(),this.createEle(e,t,i,r)):document.querySelector("#cameraShot_box")?this.close():this.createEle(e,t,i,r)}create(e,t){let i=document.createElement(e);return i.className=t,i}createEle(e,t,i,r){this.CAMERASHOT=this.createBox(),this.SHOTBOX=this.createShot(e,t,i,r),this.CAMERASHOT.appendChild(this.SHOTBOX),document.body.appendChild(this.CAMERASHOT)}createBox(){return this.$BOX=this.create("div","camera_shot"),this.$BOX.id="cameraShot_box",this.$BOX}createShot(e,t,i,r){return this.$SHOT=this.create("div","shot_box"),this.$SHOT.style=`\n            height:${t}px;\n            width:${e}px;\n            top:${r}px;\n            left:${i}px;\n        `,this.$SHOT}close(){document.querySelector("#cameraShot_box").remove()}}class $a968414a7e6fc1aa$export$a7746b673cb91227{constructor(e,t,i=""){const r=document.querySelector(`#${t}`);r&&r.remove(),this.id=t,this.LineBox=document.querySelector(".shot_box"),this.x=i||this.LineBox.clientHeight/2,this.color=e,this.renderView()}renderView(){this.LineBox.style.position="relative";const e=document.createElement("div");e.id=this.id,e.style=`\n        height:3px;\n        width:100%;\n        display:flex;\n        align-items: center;\n        justify-content: space-between;\n        position:absolute;\n        top:${this.x}px;\n        `,this.LineBox.appendChild(e);const t=document.createElement("div");t.style="width:80px;height:100%;";const i=document.createElement("div");i.style="width:80px;height:100%;",t.style.backgroundColor=this.color,i.style.backgroundColor=this.color,e.appendChild(t),e.appendChild(i)}}var $3gS3M=parcelRequire("3gS3M");class $db0b0a1e43bca88d$export$7cda8d932e2f33c0{constructor(){editor.list.default2D.add((function(){editor.roamTool&&editor.roamTool.deactive(),document.getElementById("two_D").childNodes[1].classList.add("active_view"),document.getElementById("three_D").childNodes[1].classList.remove("active_view")})),editor.list.changeCameraSlider.add((function(e,t){$("#footerView").val(parseInt(100*t))})),editor.list.alert.add((function(e,t="success"){editor.messageControl=new(0,$6145dfb1fc4f1219$exports.MessageControl),editor.messageControl.message({content:e,type:t})})),editor.list.dialog.add((function(e,t,i){new(0,$hn8Wk.Dialog)({title:e+"?",content:t,param:i}).open()})),editor.list.blackBox.add((function(e,t,i){editor.blackbox&&""!=editor.blackbox||(editor.blackbox=new $2c167817c884d6ec$export$e02d10d50143e701(editor)),editor.blackbox.setVal({top:t-20,left:e+20,value:i})})),editor.list.showDialog.add((function(e,t,i=[],r=[]){if((0,$3YQYO.PopupHandle)(e,i,editor,r),""!=e||0==e)switch(e){case 100:new(0,$4sbRm.Level)({});break;case 0:case 13:0!=r.length&&new $75791059b3ab27f7$export$cb4338d67ffa8a1d({keys:e,extent:r[0],height:r[5],thickness:r[1]}),$huS6x.propertyEvent.propertySwitch(r);break;case 1:case 15:new $9b9eb4ffa840cd88$export$cec157cbbbaf65c9({keys:e,disabledFlag:t,width:r[0],height:r[1],depth:r[2],takeOff:r[3]});break;case 2:case 12:new $43001ecb7f19fac4$export$602193f4ae91c7b9({keys:e,extent:r[0],height:r[1],ply:r[2],takeOff:r[3],modelName:t});break;case 3:new $2f4cd73062ed1d8f$export$4880b0ae5643c62b;let i=!1;$2f4cd73062ed1d8f$export$4880b0ae5643c62b.roomTypelist.forEach((e=>{e.name==r[0]&&(i=!0)})),i?($("#roomname").val(r[0]),$("#roomtype").val(r[0])):($("#roomname").val(r[0]),$("#roomtype").val("未命名"));break;case 4:new $59ac0d6becd6e084$export$d981182684770f2a({keys:e,title:"梁",extent:r[0],extentMax:12e3,width:r[1],widthMax:12e3,height:r[2],heightMax:900,angle:r[3]});break;case 5:new $59ac0d6becd6e084$export$d981182684770f2a({keys:e,title:"烟道",extent:r[0],extentMax:1800,width:r[1],widthMax:2400,height:r[2],heightMax:8400,angle:r[3]});break;case 6:new $59ac0d6becd6e084$export$d981182684770f2a({keys:e,title:"柱子",extent:r[0],extentMax:2400,width:r[1],widthMax:2400,height:r[2],heightMax:8400,angle:r[3]});break;case 8:case 10:case 11:case 14:new(0,$kOTLu.ModelProperty)({keys:e,title:t,extent:r[0].width,width:r[0].depth,height:r[0].height,oldExtent:r[0].oldWidth,oldWidth:r[0].oldDepth,oldHeight:r[0].oldHeight,takeOff:r[0].floorHei,x:r[0].rotation[0],y:r[0].rotation[1],z:r[0].rotation[2],oldFloorHei:r[0].oldFloorHei})}})),editor.list.updateDialog.add((function(e,t){const i=document.querySelector(".wall_pop");if(!i)return;const r=parseInt(i.style.left),n=parseInt(i.style.top);i.style.left=r+e+"px",i.style.top=n+t+"px"})),editor.list.hiddenDialog.add((function(){const e=document.querySelectorAll(".wall_pop");for(let t=0;t<e.length;t++){const i=e[t];i.parentNode.removeChild(i)}})),editor.list.exitRomaScene.add((function(){(new(0,$huS6x.navigationBar)).showBar()})),editor.list.threeDimensions.add((function(e){"2D"==e?($(".view_title").removeClass("active_view"),$(".view_title")[0].classList.add("active_view"),document.querySelector("#two_view").style.display="block",document.querySelector("#threed_view").style.visibility="hidden"):($(".view_title").removeClass("active_view"),$(".view_title")[1].classList.add("active_view"),document.querySelector("#two_view").style.display="none",document.querySelector("#threed_view").style.visibility="visible")})),editor.list.switchBounced.add((function(e){const t=document.querySelector(".wall_popup"),i=document.querySelector(".room_popup"),r=document.querySelector(".topbarContent_tool_bar");"wall"==e?(t.style.visibility="visible",i.style.visibility="hidden",r.style.visibility="hidden"):"room"==e?(t.style.visibility="hidden",i.style.visibility="visible",r.style.visibility="hidden"):(t.style.visibility="hidden",i.style.visibility="hidden",r.style.visibility="visible")})),editor.list.footerView.add((function(){return $("#footerView").val()})),editor.list.modelGroup3D.add((function(e,t,i=[],r={}){(0,$3YQYO.PopupHandle)(e,i,editor,r)})),editor.list.baseMap.add((function(e){const t=document.querySelector(".baseBtn");1==e?t.style.display="none":0==e&&(t.style.display="block")})),editor.list.themeSwitch.add((function(e){$kjwe7.Header.themeChange(e,!1)})),editor.list.resetproperty.add((function(e){new(0,$4sbRm.Level)({storeyHei:e.storeyHei,floorDep:e.floorDep,roomOpacity:e.roomOpacity});document.querySelectorAll(".item_box").forEach(((e,t)=>{e.classList.remove("active_type")}))})),editor.list.getShowHiddenFlag.add((function(e,t=!0){$4jMdz.HomepageBottom.getFlag(e,t)})),editor.list.popupSaveRecord.add((function(e,t){(new(0,$9bipm.saveGroupSelect)).main(e,t)})),editor.list.modelReplace.add((function(e){let t="";$eBHx9.ModelList.forEach((i=>{i.type==e&&(t=i)})),t&&new $5825b7c0f2e24f84$export$31709734768e711f({viewList:[t],replace:!0})})),editor.list.closeReplaceView.add((function(){let e=document.querySelector(".replaceDom");e&&(e.style.display="none")})),editor.list.progressOpen.add((function(e){new $9a6b61afc4a7067f$export$c17561cb55d4db30;const t=document.querySelector(".progress_bar_title");1==e&&(t.innerHTML="下载中...")})),editor.list.progressChange.add((function(e){const t=document.querySelector(".progress_barbox"),i=document.querySelector(".progress_bar_title"),r=document.querySelector(".progress_val");t&&(t.style.width=e+"%",r.innerHTML=e+"%",100==e&&(i.innerHTML="解析中..."))})),editor.list.progressClose.add((function(){$(".progress_bar").remove()})),editor.list.uploadModelBar.add((function(){(new $eeb2d6c356491192$export$f270d770ff78cf6f).init()})),editor.list.changeBar.add((function(e){const t=document.querySelector(".progress_barbox1"),i=document.querySelector(".progress_val1");t&&(t.style.width=e+"%",i.innerHTML=e+"%")})),editor.list.closeBar.add((function(){$("#upload_dialog_pop").remove()})),editor.list.saveWallJson.add((function(e,t){let i=new(0,$6145dfb1fc4f1219$exports.MessageControl);new(0,$hn8Wk.Dialog)({width:"20%",height:"200px",title:"保存户型",content:"<input value='' id='save_house_name' />",success(){let r=0;for(let e in window.localStorage)window.localStorage.hasOwnProperty(e)&&(r+=window.localStorage.getItem(e).length);if(r=(r/1024/1024).toFixed(2),r>=5)i.message({content:"浏览器缓存已达最大5M，无法保存。",type:"warning"});else{const i=document.querySelector("#save_house_name").value,r=JSON.parse(t);r.orderName=i;const n={base64:e,json:JSON.stringify(r)};window.schemeContentList.push(n),localStorage.setItem("schemeContentList",JSON.stringify(window.schemeContentList)),$(".model_solution").empty(),$6VBvh.Mine.renderView()}}}).open()})),editor.list.setDefaultParams.add((function(e){new(0,$4sbRm.Level)({storeyHei:e.storeyHei,floorDep:e.floorDep,roomOpacity:e.roomOpacity});const t=document.querySelectorAll(".base_map_item_box")[1];e.mapVisible?t.innerHTML="隐藏底图":t.innerHTML="显示底图"})),editor.list.cameraShot.add((function(e="400",t="200",i="0",r="0",n=!1){(new $e75d68308b9e99e6$export$15c5a38ef0258a50).init(e,t,i,r,n)})),editor.list.closeCameraShot.add((function(){(new $e75d68308b9e99e6$export$15c5a38ef0258a50).close()})),editor.list.horizontalLine.add((function(e,t,i=""){new $a968414a7e6fc1aa$export$a7746b673cb91227(e,t,i)})),editor.list.deleteLine.add((function(){const e=document.querySelector(".shot_box").children;let t=[];for(let i=0;i<e.length;i++)t.push(e[i]);t.forEach((e=>document.querySelector(".shot_box").removeChild(e)))})),editor.list.renderURL.add((function(){$("#renderDom").empty(),new(0,$3gS3M.renderHeader),$(".contentFlag").addClass("none"),$(".canvas").addClass("none"),$(".renderDom").removeClass("none"),document.documentElement.style.setProperty("--click-color","#F0A130")}))}}class $b4910821f3d67218$var$Main{constructor(){var e=new $17e0b9c8fbcffc37$export$40d7e39b924588a0;window.editor=e,e.list.pluginList.add((function(){let t=new $d7301d69748e22e3$export$dea64c44705995a5,i=Object.getPrototypeOf(t);for(const t of Object.getOwnPropertyNames(i).filter((e=>"constructor"!==e)))e[t]=i[t];new $db0b0a1e43bca88d$export$7cda8d932e2f33c0,new $9decf90ebae5e35e$export$8642042a8635463d(e),e.list.sceneInit.dispatch(document.getElementById("box")),console.log("编译日期："+new Date)}))}}new $b4910821f3d67218$var$Main;