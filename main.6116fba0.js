function $parcel$export(e,t,i,r){Object.defineProperty(e,t,{get:i,set:r,enumerable:!0,configurable:!0})}var $parcel$global="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},parcelRequire=$parcel$global.parcelRequire94c2;parcelRequire.register("fv9nZ",function(e,t){var i=parcelRequire("itriU"),r=parcelRequire("dyDlE");class n{constructor(){var e=window.editor;let t=Object.getPrototypeOf(new i.rjh_SignalMethods);for(let i of Object.getOwnPropertyNames(t).filter(e=>"constructor"!==e))e[i]=t[i];let n=navigator.userAgent.toLowerCase(),o=["android","iphone","ipod","ipad","windows phone"];var a=o.some(e=>-1!==n.indexOf(e));a&&0==e.list.sceneInit._bindings.length&&(new r.rjh_SignalCore(e),new r.rjh_MobileSignalCore(e)),e.list.pluginList.add(function(t){a?e.list.sceneInit.dispatch(document.getElementById("box"),"mobile",t):parcelRequire("ajbOv").then(({Editor:t})=>{new t,new r.rjh_SignalCore(e),e.list.sceneInit.dispatch(document.getElementById("box"))})})}}new n}),parcelRequire.register("itriU",function(e,t){$parcel$export(e.exports,"rjh_SignalMethods",()=>L);var i=parcelRequire("4xklQ"),r=parcelRequire("73HrS"),n=parcelRequire("5XTH3"),o=parcelRequire("9HO6e"),a=parcelRequire("hWloQ"),s=parcelRequire("3BPdS"),l=parcelRequire("hEK9V"),h=parcelRequire("dhh4v"),c=parcelRequire("5TtCd"),d=parcelRequire("9QhXH");parcelRequire("fHLr5");var u=parcelRequire("5sV3G"),p=parcelRequire("0SNMV"),m=parcelRequire("eCdUa"),f=parcelRequire("i1BGa"),g=parcelRequire("g4HAh"),y=parcelRequire("7WCxl"),x=parcelRequire("ia4Lh"),w=parcelRequire("1o48A"),b=parcelRequire("lcWY1"),v=parcelRequire("RhAiw"),M=parcelRequire("hrM0U"),S=parcelRequire("2S71M"),P=parcelRequire("2C75G"),T=parcelRequire("5c6ha"),_=parcelRequire("65FdD"),C=parcelRequire("eA4zA"),D=parcelRequire("9SxgN");parcelRequire("7UKlx");var A=parcelRequire("47Y2g"),E=parcelRequire("kLdsz");class L{updateModelProto(e){let t=this.getRealSize(e),r=1e3*t[0].toFixed(3),n=1e3*t[1].toFixed(3),o=1e3*t[2].toFixed(3),a=1e3*e.width.toFixed(3),s=1e3*e.height.toFixed(3),l=1e3*e.depth.toFixed(3),h=new i.Vector3(0,e.position.y,0);e.parent.localToWorld(h);let c=1e3*(h.y-t[1]/2).toFixed(3),d=0;if("top"==e.modelPosition){let t=window.storeyHei;this.wallGroup3D.roomHeight,(d=1e3*(t/1e3-e.height).toFixed(3))<10&&(d=0)}c<10&&(c=0);let u=360-Math.abs(parseInt(180/Math.PI*e.rotation.x)),p=parseInt(180/Math.PI*e.rotation.y),m=360-Math.abs(parseInt(180/Math.PI*e.rotation.z));p<0&&(p+=360),360==u&&(u=0),360==p&&(p=0),360==m&&(m=0);let f={isLock:e.isLock,width:r,height:n,depth:o,oldWidth:a,oldHeight:s,oldDepth:l,floorHei:c,rotation:[u,m,p],oldFloorHei:d};"2dModelGroup"==e.modelType?this.list.showDialog.dispatch(14,"组合模型",[],[f]):("{}"!=JSON.stringify(this.clickDepthMsg)&&(f.isGroupChild=!0),this.list.showDialog.dispatch(8,"单品模型",[],[f]))}checkModelIsInGroupModel(e){return!!e.parent&&"3dModel"!=e.name&&"2dModel"!=e.name&&!!this.clickDepthMsg.uuid&&(e.parent.uuid==this.clickDepthMsg.uuid||this.checkModelIsInGroupModel(e.parent))}createFileChunk(e,t=2097152){let i=[],r=0;for(;r<e.size;)i.push({file:e.slice(r,r+t)}),r+=t;return i}async handleUpload(e,t){let i=this.createFileChunk(e);console.log("切片数量"+i.length),this.list.alert.dispatch("正在同步模型到云端,请稍等"),this.list.uploadModelBar.dispatch();let r=i.map((t,i)=>({chunk:t,hash:e.name+"**"+i}));await this.uploadChunks(r,t,i.length)}async uploadChunks(e,t,i){let r=0,n=this;e.map((e,o)=>{setTimeout(()=>{let o=new FormData,a=new Date,s=a.getFullYear()+""+(a.getMonth()+1)+a.getDate()+Math.round(1e4*Math.random()+1)+".json";var l=new File([e.chunk.file],s,{type:"application/json"}),h=new FileReader;h.onload=()=>{let e=JSON.stringify({fileName:s,value:h.result}),t=new File([e],s,{type:"application/json"});o.append("file",t);let a=new XMLHttpRequest;a.open("POST",this.config.remoteCacheUrl,!0),a.onreadystatechange=()=>{if(4===a.readyState&&200===a.status){let e=parseInt(100*(++r/i).toFixed(2));n.list.changeBar.dispatch(e),r==i&&(n.list.alert.dispatch("模型云端同步完成"),n.list.closeBar.dispatch()),console.log("上传成功")}},a.send(o)},h.readAsDataURL(l);let c=e.hash.split("**");t.sliceArr?t.sliceArr.push(s+"**"+c[1]):t.sliceArr=[s+"**"+c[1]]},100)})}mergeFile(e,t){let i=Array(e.length),r=0,n=this;e.map(o=>{setTimeout(()=>{r++;let a=o.split("**"),s=new XMLHttpRequest;s.open("GET",n.config.remoteUrl+a[0],!1),s.onreadystatechange=()=>{if(4===s.readyState&&200===s.status){for(var o=JSON.parse(s.responseText).value.split(","),l=o[0].match(/:(.*?);/)[1],h=atob(o[1]),c=h.length,d=new Uint8Array(c);c--;)d[c]=h.charCodeAt(c);var u=new Blob([d],{type:l});i[1*a[1]]=u;let m=parseInt(100*(r/e.length).toFixed(2));if(n.list.progressChange.dispatch(m),r==e.length){let e=new Blob(i,{type:"application/octet-stream"});var p=new File([e],"aa.glb",{type:"application/octet-stream"});n.list.uploadFile.dispatch("",p,t),n.list.alert.dispatch("云端模型加载完成"),console.log("合并完成")}}},s.send(),r==e.length&&n.list.progressClose.dispatch()},100)});let o=new Blob(i,{type:"application/octet-stream"});return new File([o],"aa.glb",{type:"application/octet-stream"})}getNowTime(){let e=new Date;var t=String(e.getHours()).padStart(2,"0"),i=String(e.getMinutes()).padStart(2,"0"),r=String(e.getSeconds()).padStart(2,"0");return e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()+" "+t+":"+i+":"+r}saveJsonToSever(e,t,i=!1){console.log("保存服务器");let r=this,n=JSON.stringify(e),o=new File([n],t,{type:"application/json"}),a=new XMLHttpRequest;a.open("POST",this.config.remoteCacheUrl,!0),a.onreadystatechange=()=>{4===a.readyState&&200===a.status&&i&&(this.currentCacheJson=e.sceneJson,this.list.alert.dispatch("方案保存成功"))};let s=new FormData;s.append("file",o),a.send(s),"PC"!=this.deviceType&&(this.autoMakePhotoGroup(!0),setTimeout(()=>{e.imgBase64=btoa(r.cameraRenderer.domElement.toDataURL("image/jpeg")),$.ajax({type:"GET",url:this.config.remoteUrl+"orderList_"+this.userId+".json",async:!0,cache:!0,dataType:"text",success:function(t,i){let n=JSON.parse(t);n.orderTime=r.getNowTime();let o=n.data,a=0,s=-1;o.slice(0).forEach(t=>{if(t.orderId==e.orderId){s=a;return}a++}),s>-1&&(o[s]=e),s<0&&o.unshift(e),n.data=o,r.saveAllOrder(n),r.list.showToast.dispatch("方案保存成功","top")},error:function(t){404==t.status&&r.saveAllOrder({data:[e]})}})},100))}saveAllOrder(e){let t=new File([JSON.stringify(e)],"orderList_"+this.userId+".json",{type:"application/json"}),i=new FormData;i.append("file",t);let r=new XMLHttpRequest;r.open("POST",this.config.remoteCacheUrl,!0),r.onreadystatechange=()=>{4===r.readyState&&200===r.status&&console.log("订单列表更新成功")},r.send(i)}delCommonPoint(e){let t=(0,o.UtilCore).havePointWall(e,this.allWalls);if(2!=t.length||!(0,o.UtilCore).wallIsInLine(t[0],t[1])){this.list.alert.dispatch("只允许删除共线墙的公共端点","error");return}this.pointHelperGroup.children.slice(0).forEach(e=>{("clickPoint"==e.useType||"moveOuterPoint"==e.useType)&&e.parent.remove(e)}),this.execute(),this.margeWall(t[0],t[1]),new(0,r.WallCore)(this).wallToJson()}moveCurrentCamera(e){var t=new i.Vector3;let r=this.camera,n=this.controlsArr[1];r.isOrthographicCamera&&(n=this.controlsArr[0]),this.openRenderScene&&(r=this.renderViewCamera,n=this.renderViewControl),r.getWorldDirection(t);let o=100,a=new i.Vector3(t.z,t.y,-t.x),s=r.position.clone(),l=new i.Vector3(0,1,0);if("3dRomaCamera"!=r.name){if(r.isOrthographicCamera)"w"==e&&r.position.add(new(0,i.Vector3)(0,1,0).multiplyScalar(o)),"a"==e&&r.position.add(new(0,i.Vector3)(-1,0,0).multiplyScalar(o)),"s"==e&&r.position.add(new(0,i.Vector3)(0,-1,0).multiplyScalar(o)),"d"==e&&r.position.add(new(0,i.Vector3)(1,0,0).multiplyScalar(o)),r.position.z=s.z,n.target.copy(r.position);else{o=.1,"w"==e&&r.position.add(t.multiplyScalar(o)),"a"==e&&r.position.add(a.multiplyScalar(o)),"s"==e&&r.position.add(t.multiplyScalar(-o)),"d"==e&&r.position.add(a.multiplyScalar(-o)),"q"==e&&r.position.add(l.multiplyScalar(o)),"e"==e&&r.position.add(l.multiplyScalar(-o)),"q"!=e&&"e"!=e&&(r.position.y=s.y);let i=r.position.clone().sub(s),h=n.target.clone().add(i);n.target.copy(h)}r.updateProjectionMatrix()}}margeWall(e,t){if(!(0,o.UtilCore).wallIsInLine(e,t))return;this.removeHelperByWall(t),this.removeHelperByWall(e);let i=(0,o.UtilCore).getSamePointTwoWall(e,t),r=(0,o.UtilCore).getMeshOtherPoint(t,i);(0,o.UtilCore).isSameVector(i,e.startPoint)?e.startPoint=r:e.endPoint=r,this.getAllWindowInWall(t).forEach(t=>{t.wallId=e.wallID,t.wallStartPoint=e.startPoint,t.wallEndPoint=e.endPoint,t.wallDep=e.thickness}),this.removeWall(t)}addModelBox(e){let t=this.getOuterParent(e,e,"outer");console.log(t);let i=e,r=e.param[0];"2dModel"==t.parent.name&&(i=e.param[0],r=e),this.modelHelperGroup.children=[],this.doorHelperGroupClean(),this.addBoxForGroup(i),this.addBoxFor2dGroup(r),e.isLock||(this.addLineHelperForMember(r),new(0,w.Model3DHelper)(this).selectObj([i]))}getWallCenterLen(e,t){let r=e.geometry.attributes.position.array,n=new i.Vector3(r[3],r[4],0),o=new(0,i.Vector3)(r[12],r[13],0).sub(n),a=new(0,i.Vector3)(r[6],r[7],0).sub(n),s=o.angleTo(a);s>Math.PI/2&&(s=Math.PI-s);let l=e.thickness/2/Math.tan(s);return Math.round(t=o.angleTo(a)>Math.PI/2?t-l:t+l)}refreshRealSizeByBox(e,t){let r=t.parent;if(!e.parent||("2dModel"==e.parent.name&&(r=r.param[0],e=e.param[0]),!r))return;let n=r.rotation.x,o=r.rotation.y,a=r.rotation.z;r.rotation.set(0,0,0);let s=new(0,i.Box3)().setFromObject(r);r.rotation.set(n,o,a);let l=new(0,c.OBB)().fromBox3(s),h=new(0,i.Vector3)().setFromMatrixScale(r.matrixWorld),d=2*l.halfSize.x/h.x,u=2*l.halfSize.y/h.y,p=2*l.halfSize.z/h.z;r.width=d,r.height=u,r.depth=p,r.param&&(r.param[0].width=1e3*d,r.param[0].height=1e3*p,r.param[0].depth=1e3*u),r.uuid!=e.uuid&&this.refreshRealSizeByBox(e,r)}getRealSize(e){let t=e;("2dModelGroup"==e.modelType||"2DModel"==e.modelType)&&(t=e.param[0]),t.param[0],t.updateMatrixWorld();let r=new(0,i.Vector3)().setFromMatrixScale(t.matrixWorld);return[t.width*r.x,t.height*r.y,t.depth*r.z]}addBoxForGroup(e,t=2){let i=this.wallHelp.addOBBbox(e,this.config.boxColor);i.name="modelBox",i.layers.set(t),this.modelHelperGroup.add(i)}addDashBoxForGroup(e,t=2){let i=this.wallHelp.addOBBDotBox(e);i.name="modelBox",i.layers.set(t),this.modelDotGroup.add(i)}addDashBoxFor2dGroup(e){let t=this.wallHelp.getModelVertex(e,1.2),i=this.wallHelp.addBoxFor2dModel(t,this.config.boxLineColor,"dot");i.name="modelBox",this.modelDotGroup.add(i)}addBoxFor2dGroup(e,t=window.editor.config.boxLineColor){let i=this.wallHelp.getModelVertex(e),r=this.wallHelp.addBoxFor2dModel(i,t);this.doorHelperGroup.add(r)}getWallByMesh(e){let t=e.parameter.tdm.wallId;return this.getWallById(t)}getWallById(e){for(let t=0;t<this.allWalls.length;t++)if(this.allWalls[t].wallID==e)return this.allWalls[t];return!1}get3DWallByMesh(e){let t=e.parameter.tdm.wallId;return this.get3DWallById(t)}get3DWallById(e){for(let t=0;t<this.wallGroup3D.children.length;t++){let i=this.wallGroup3D.children[t];if("3DWall"==i.modelType&&i.wallID==e)return i}return!1}get3DWindowBy2dWindow(e){let t="";return this.wallGroup3D.children.forEach(i=>{i.parameter&&i.parameter.tdm.uuid==e.uuid&&(t=i)}),t}partRefreshWall(e){let t=[];this.otherMeshs.forEach(i=>{i.wallId==e.wallID&&t.push(i)});let i=[];this.wallGroup3D.children.forEach(t=>{"CodeModel"!=t.modelType||t.parameter&&t.parameter.tdm.wallId!=e.wallID||i.push(t)}),this.wallGroup3D.remove(...i),this.wallGroup3D.children.forEach(t=>{"3DWall"==t.modelType&&t.wallID==e.wallID&&this.wallGroup3D.remove(t)});let r=new(0,n.DrawWallTool)().switchTo3D([e]);this.wallGroup3D.add(...r);let o=(0,d.DM).getHoleJson(t,this);new(0,u.DigHole)(this).work(r,o),this.wallGroup3D.traverse(function(e){e.layers.set(1)})}btnSVGExportClick(){var e=new h.SVGRenderer;e.setSize(window.innerWidth,window.innerHeight),e.render(this.scene,this.camera),this.ExportToSVG(e,"test.svg")}ExportToSVG(e,t){var i=new XMLSerializer().serializeToString(e.domElement),r='<?xml version="1.0" standalone="no"?>\r\n',n=new Blob([r,i],{type:"image/svg+xml;charset=utf-8"}),o=URL.createObjectURL(n),a=document.createElement("a");a.href=o,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a)}exportModelGlb(e){this.camera.isOrthographicCamera&&(e=this.get3DModelBy2DModel(e));let t=e.clone();t.position.set(0,0,0);let i=new l.GLTFExporter,r={trs:!1,onlyVisible:!0,truncateDrawRange:!0,binary:!0,maxTextureSize:4096};i.parse([t],function(e){var t=JSON.stringify(e),i=new Blob([t],{type:"text/plain"});e instanceof ArrayBuffer&&(i=new Blob([e],{type:"application/octet-stream"}));var r=document.createElement("a");r.style.display="none",r.href=URL.createObjectURL(i),r.download="rjh_test_"+Date.parse(new Date)+".glb",r.click()},function(e){console.log("error",e)},r)}getScreen(e,t){let i=e.project(t),r=window.innerWidth/2,n=window.innerHeight/2;return[Math.round(i.x*r+r),Math.round(-i.y*n+n)]}exportAllScenePng(){this.list.setViewportCamera.dispatch("3D",this),this.grid3d.visible=!1;let e=this;setTimeout(function(){var t=document.createElement("a");let i=e.renderer.domElement.toDataURL("image/jpeg");t.href=i,t.download="rjh_test_"+Date.parse(new Date)+".jpg",t.click(),e.grid3d.visible=!0},100)}autoMakeRenderPng(){let e=document.getElementsByClassName("shot_box")[0].getBoundingClientRect(),t=editor.renderViewCamera.aspect;editor.RenderRend.setSize(e.width,e.height),editor.renderViewCamera.aspect=e.width/e.height,editor.renderViewCamera.updateProjectionMatrix(),setTimeout(function(){var e=document.createElement("a");let i=editor.RenderRend.domElement.toDataURL("image/jpeg"),r="testPng.json",n={pngBase64:i},o=editor.renderFloorGroup.children.concat(editor.renderModel3dGroup.children).concat(editor.renderWall3dGroup.children).concat(editor.renderMember3dGroup.children);editor.setRandomColor(o),setTimeout(()=>{let e=editor.RenderRend.domElement.toDataURL("image/jpeg");var i=document.createElement("a");i.href=e,i.download="rjh_test_"+Date.parse(new Date)+".jpg",n.randomBase64,editor.saveJsonToSever(n,r),editor.setRandomColor(o,!1),editor.renderViewCamera.aspect=t,editor.renderViewCamera.updateProjectionMatrix(),editor.RenderRend.setSize(window.innerWidth,window.innerHeight),editor.RenderRend.render(editor.renderScene,editor.renderViewCamera)},100),e.href=i,e.download="rjh_test_"+Date.parse(new Date)+".jpg"},100)}setRandomColor(e,t=!0){if(e.forEach(e=>{e.traverse(function(e){e.isMesh&&e.oldColor&&(e.material=e.oldColor.clone())})}),!t)return;let r={};e.forEach(e=>{e.traverse(function(e){if(e.isMesh&&"outlineMesh"!=e.name){e.oldColor||(e.oldColor=e.material.clone());let n=e.material.color.toArray(),o=n[0]+"-"+n[1]+"-"+n[2];if(e.modelType,r.hasOwnProperty(o))e.material=r[o].clone();else{let n=new i.MeshBasicMaterial;var t=new Float32Array([Math.random(),Math.random(),Math.random()]);n.color.fromArray(t),e.material=n,r[o]=e.material.clone()}}})})}initCameraPngScene(e,t="auto"){this.cameraScene.children=[];let r=new i.PointLight(10394523,6,1e4);r.position.set(0,600,0),r.layers.enableAll(),this.cameraScene.add(r);let n=new i.AmbientLight(10394523,2,1e4);n.layers.enableAll(),this.cameraScene.add(n);let o=e.clone();if(e.parent&&(this.pngCamera="2dModel"==e.parent.name?this._DEFAULT_CAMERA1.clone():this._DEFAULT_CAMERA.clone()),"top"==t){this.pngCamera=this._DEFAULT_CAMERA1.clone();let e=new(0,i.Matrix4)().makeScale(1e3,1e3,1e3);o.applyMatrix4(e),o.traverse(function(e){e.layers.set(0)}),o.rotation.x=Math.PI/2}"2D"==t&&(this.pngCamera=this._DEFAULT_CAMERA1.clone()),o.position.set(0,0,0);let a=new(0,i.Box3)().setFromObject(o),s=new i.Vector3;a.getCenter(s);let l=a.max.x-a.min.x,h=a.max.y-a.min.y;this.pngCamera.isOrthographicCamera||(h=a.max.z-a.min.z),("top"==t||"2D"==t)&&(h=a.max.y-a.min.y);let c=Math.round(this.getScreen(new i.Vector3(a.max.x,0,0),this.pngCamera)[0]-this.getScreen(new i.Vector3(a.min.x,0,0),this.pngCamera)[0]),d=Math.round(h*c/l);if(this.pngCamera.isOrthographicCamera)o.position.set(-s.x,-s.y,0),this.pngCamera.left=-(l/2),this.pngCamera.right=l/2,this.pngCamera.top=h/2,this.pngCamera.bottom=-(h/2),this.pngCamera.far=1e5,n.position.set(0,0,2*h),r.position.set(0,0,2*h),this.pngCamera.position.set(0,0,h/2);else{r.intensity=3,n.intensity=1,this.pngCamera.aspect=l/h;let e=new i.Box3;e.expandByObject(o);let s=new i.Vector3;e.getSize(s);let u=this.maxSize(s),p=a.max.y-a.min.y;if("right"==t){let e=this.getScreen(new i.Vector3(a.max.x,0,a.max.z),this.pngCamera),t=this.getScreen(new i.Vector3(a.min.x,0,a.min.z),this.pngCamera);d=Math.round(h*(c=new(0,i.Vector2)(e[0],e[1]).distanceTo(new i.Vector2(t[0],t[1])))/l),this.pngCamera.position.copy(new(0,i.Vector3)(0,0,0).addScalar(u)),this.pngCamera.position.y=p}else{let e=this.getScreen(new i.Vector3(a.max.x,0,a.max.z),this.pngCamera),t=this.getScreen(new i.Vector3(a.min.x,0,a.min.z),this.pngCamera);d=Math.round(h*(c=new(0,i.Vector2)(e[0],e[1]).distanceTo(new i.Vector2(t[0],t[1])))/l),this.pngCamera.position.copy(new(0,i.Vector3)(0,0,0).add(new i.Vector3(0,p/2,1.5*u)))}this.pngCamera.near=.1*u,this.pngCamera.far=300*u,this.pngCamera.lookAt(0,0,0)}this.pngCamera.updateProjectionMatrix(),this.cameraRenderer.setSize(c,d),this.cameraScene.add(o),this.pngCamera.zoom=1,"2D"==t&&(this.pngCamera.zoom=.4),this.pngCamera.updateProjectionMatrix()}maxSize(e){let t;return(t=e.x>e.y?e.x:e.y)>e.z||(t=e.z),t}exportModelImg(){if(""==editor.clickSelect||""==editor.clickSelect[0].object)return;let e=editor.clickSelect[0].object;e=this.getOuterParent(e),this.initCameraPngScene(e);let t=this;setTimeout(function(){var i=document.createElement("a");i.href=t.cameraRenderer.domElement.toDataURL("image/png"),i.download="rjh_test_"+Date.parse(new Date)+".png",i.click(),t.exportModelGlb(e)},100)}getPositionByScreen(e,t,r=this.camera){let n=new i.Vector3(e,t,.5),o=r;return r.isOrthographicCamera||(o=this.getOtherCamera(this.camera)),n.unproject(o)}getTextCanvas3(e=""){let t=document.createElement("canvas"),r=t.getContext("2d"),n=this.getPositionByScreen(-1,1,this.pngCamera),o=this.getPositionByScreen(1,1,this.pngCamera),a=this.getPositionByScreen(-1,-1,this.pngCamera),s=n.distanceTo(o),l=n.distanceTo(a),h=new i.Vector3(this.pngCamera.position.x,this.pngCamera.position.y,0),c=this.getScreenPosition(h,this.pngCamera);t.width=window.innerWidth,t.height=window.innerHeight,r.fillStyle="black";let d=15;if(r.font="normal "+d+"px Dengxian",r.translate(t.width/2,t.height/2),r.save(),"PC"!=this.deviceType){let e="-1px 0 #000, 0 1px #000, 1px 0 #000, 0 -1px #000",t=e.split(",").map(e=>e.trim().split(" "));r.shadowColor=t[0][2],r.shadowOffsetX=parseFloat(t[0][0]),r.shadowOffsetY=parseFloat(t[0][1]),r.shadowBlur=parseFloat(t[0][3])}let u=this.cameraScene.children[0];u.children.forEach(e=>{("helperGroup"==e.name||"floorGroup2d"==e.name)&&e.children.forEach(e=>{let t=new i.Box3().setFromObject(e),n=t.getCenter(new i.Vector3),o=this.getScreenPosition(n,this.pngCamera),a=0;e.fontAngle&&(a=e.fontAngle*Math.PI/180);let s=0,l=0;if(e.lineLength&&(s=e.lineLength.toString().length/4*d,l=e.lineLength,a-=u.rotation.z),a==Math.PI&&(a=0),e.area&&(s=e.area.length/4*d,l=e.area),0==l)return;let h=d,p=new i.Vector2(o.y-c.y,o.x-c.x);if(p.rotateAround(new i.Vector2(0,0),a),r.rotate(a),e.area){h=0;let e=l.split("\n");if(e.length>1){l=e[1];let t=20;r.font="bold "+t+"px Arial",r.fillText(e[0],p.y-s,p.x-h-2*t),r.font="normal "+d+"px Dengxian"}}e.lineLength&&0==a&&p.x>0&&(h=-(2*d)-10),r.fillText(l,p.y-s,p.x-h-10),r.rotate(-a)})});let p=t.toDataURL("image/png"),m=new i.TextureLoader().load(p),f=new i.PlaneGeometry(s,l),g=new i.MeshBasicMaterial({map:m,transparent:!0,opacity:1,depthTest:!1}),y=new i.Mesh(f,g);return y.renderOrder=50,y.position.set(this.pngCamera.position.x,this.pngCamera.position.y,1),y}getTextCanvas2(e=""){let t=document.createElement("canvas"),r=t.getContext("2d"),n=this.getPositionByScreen(-1,1),o=this.getPositionByScreen(1,1),a=this.getPositionByScreen(-1,-1),s=this.getPositionByScreen(window.innerWidth/2/window.innerWidth*2-1,-(2*(window.innerHeight/2/window.innerHeight))+1),l=n.distanceTo(o),h=n.distanceTo(a);if(t.width=window.innerWidth,t.height=window.innerHeight,r.fillStyle="black",r.font="normal 24px Arial","PC"!=this.deviceType){let e="-1px 0 #000, 0 1px #000, 1px 0 #000, 0 -1px #000",t=e.split(",").map(e=>e.trim().split(" "));r.shadowColor=t[0][2],r.shadowOffsetX=parseFloat(t[0][0]),r.shadowOffsetY=parseFloat(t[0][1]),r.shadowBlur=parseFloat(t[0][3])}let c=document.getElementsByClassName("Panel")[0].children;for(let t=0;t<c.length;t++)if(!(""!=e&&0>c[t].className.indexOf(e))&&c[t].getAttribute("worldPosition")){c[t].getAttribute("worldPosition").split("/");let e=getComputedStyle(c[t],null),i=1*e.marginTop.replace("px",""),n=1*e.marginLeft.replace("px",""),o=c[t].innerHTML.split("<br>"),a=0;o.forEach(e=>{r.fillText(e,n,i+20*a),a++})}let d=t.toDataURL("image/png"),u=new i.TextureLoader().load(d),p=new i.PlaneGeometry(l,h),m=new i.MeshBasicMaterial({map:u,transparent:!0,opacity:1,depthTest:!1}),f=new i.Mesh(p,m);return f.renderOrder=5,f.position.set(s.x,s.y,1),f}autoMakePhotoGroup(e=!1){let t=new i.Group;t.name="outerGroup";let r=["2dwall","2dDoor"];this.scene.children.forEach(n=>{if(r.indexOf(n.name)>-1&&t.add(n.clone()),"floorGroup2d"==n.name){let e=new i.Group;e.name="floorGroup2d",n.children.slice(0).forEach(t=>{let i=t.clone();i.area=t.area+"㎡",e.add(i)}),t.add(e)}if("helperGroup"==n.name&&!e){let e=new i.Group;e.name="helperGroup",n.children.slice(0).forEach(t=>{if("outerLine"==t.useType){let i=t.clone();i.lineLength=t.lineLength,i.fontAngle=t.fontAngle;let r=t.material.clone();r.color.set("#000000"),i.material=r,e.add(i)}}),t.add(e)}}),this.cameraScene.children=[],this.cameraScene.add(t),t.position.set(0,0,0),this.setCameraPosition(t,!e),this.cameraScene.children.slice(0).forEach(e=>{"Group"==e.type&&e.position.set(0,0,0)}),this.cameraRenderer.setClearColor(16777215)}setCameraPosition(e,t=!0){let r=new i.Box3().setFromObject(e),n=r.getSize(new i.Vector3);n.y>n.x&&t&&(e.rotation.z=Math.PI/2,n=(r=new i.Box3().setFromObject(e)).getSize(new i.Vector3));let o=r.getCenter(new i.Vector3);n.x+=1e3,n.y+=1e3;let a=Math.round(this.getScreen(new i.Vector3(r.max.x,0,0),this.pngCamera)[0]-this.getScreen(new i.Vector3(r.min.x,0,0),this.pngCamera)[0]),s=Math.round(n.y*a/n.x);this.cameraRenderer.setSize(a,s);let l=Math.max(n.x,n.y,n.z);0!=l&&(l*=-1,this.pngCamera=this._DEFAULT_CAMERA1.clone(),this.pngCamera.left=-(n.x/2),this.pngCamera.right=n.x/2,this.pngCamera.top=n.y/2,this.pngCamera.bottom=-n.y/2,this.pngCamera.position.z=1e3,this.pngCamera.position.x=o.x,this.pngCamera.position.y=o.y+100,this.pngCamera.updateProjectionMatrix(),this.controlsArr[0].update())}exportMobilePDF(){if(0==this.wallGroup.children.length){this.list.showToast.dispatch("请先绘制完整户型");return}window.innerWidth,window.innerHeight;var e=595.28;this.autoMakePhotoGroup();let t=this,i=this.getTextCanvas3();this.cameraScene.add(i);var r=new jsPDF("p","pt","a4");setTimeout(function(){let n=t.cameraRenderer.domElement.toDataURL("image/jpeg");i.parent.remove(i),r.addImage(n,"JPEG",0,0,e,e),r.save("download.pdf")},100)}exportJPG(){if(0==this.wallGroup.children.length){this.list.showToast.dispatch("请先绘制完整户型");return}this.autoMakePhotoGroup();let e=this.getTextCanvas3(),t=this;this.cameraScene.add(e),setTimeout(function(){var i=document.createElement("a");let r=t.cameraRenderer.domElement.toDataURL("image/jpeg");if(e.parent.remove(e),window.location.href.indexOf("wxmp")>=0){let e="/pages/web3dView/pay?type=upload&image="+encodeURIComponent(r.split(",")[1]);uni.navigateTo({url:e})}else i.href=r,i.download="rjh_test_"+Date.parse(new Date)+".jpeg",i.click()},100)}exportPDF(){this.camera.isOrthographicCamera||this.list.setViewportCamera.dispatch("2D",this);var e=window.innerWidth,t=window.innerHeight,i=595.28,r=592.28/e*t;let n=this.getTextCanvas2();this.scene.add(n),setTimeout(()=>{var e=this.renderer.domElement.toDataURL("image/jpeg",1);n.parent.remove(n);var t=new jsPDF("p","pt","a4");t.addImage(e,"JPEG",0,0,i,r),t.save("download.pdf")},500)}delMap(){this.scene.children.forEach(e=>{"mapImage"==e.useType&&this.scene.remove(e)}),this.list.baseMap.dispatch(1)}createMapMesh(e,t="",r="",n=!0){let o=new i.TextureLoader;o.setCrossOrigin("");let a=URL.createObjectURL(e);o.load(a,o=>{let a=10*o.image.width,s=10*o.image.height;""!=t&&(a=t,s=r);let l=new i.Mesh(new i.PlaneBufferGeometry(a,s),new i.MeshBasicMaterial({map:o,transparent:!0}));l.position.set(0,0,0),l.useType="mapImage",l.width=a,l.height=s,l.visible=n;var h=new FileReader;h.onload=()=>{l.imgUrl=h.result},h.readAsDataURL(e),this.scene.add(l),""==t&&this.allHelperForScaleTool(new i.Vector3(-1e3,0,0),new i.Vector3(1e3,0,0)),this.toolType="free",this.list.baseMap.dispatch(0)})}importMapMain(){this.scene.children.forEach(e=>{"mapImage"==e.useType&&this.scene.remove(e)}),this.list.removeAll.dispatch("save",!1);let e=document.createElement("form");e.style.display="none",document.body.appendChild(e);let t=document.createElement("input");t.type="file",t.accept="image/png, image/jpeg, image/jpg, image/gif",t.onchange=e=>{if(0===t.files.length)return;let i=e.target.files[0];this.createMapMesh(i)},e.appendChild(t),t.click()}getModelOuterParent(e){return e.param?e:this.getModelOuterParent(e.parent)}getOuterParent(e,t=e,i="auto"){return e&&e.parent?["3dwall","3dModel","2dModel"].indexOf(e.parent.name)>-1&&"Group"==e.parent.type?("auto"!=i||(this.clickDepthMsg.uuid==e.uuid||e.param&&this.clickDepthMsg.uuid==e.param[0].uuid)&&1==this.clickDepthMsg.depth&&(e=this.getModelOuterParent(t)),e):this.getOuterParent(e.parent,t,i):""}getTopModePosition(e,t,r){if("Mesh"!=e.type)e.children.slice(0).forEach(e=>{this.getTopModePosition(e,t,r)});else{let n=new i.Vector3;e.updateMatrixWorld(),e.getWorldPosition(n),t.updateMatrixWorld();let o=t.worldToLocal(n);o.z>r[0]&&(r[0]=o.z),o.z<r[1]&&(r[1]=o.z)}}getTopModePositionOld(e){let t=e.children.slice(0),i=0,r=0;return t.forEach(e=>{e.position.z>i&&(i=e.position.z),e.position.z<r&&(r=e.position.z)}),[i,r]}synchroModel(e){let t="",r=e.scale;if("3DModel"==e.modelType||"CodeModel"==e.modelType||"modelGroup"==e.modelType){if("CodeModel"==e.modelType){(t=e.parameter.tdm).position.x=e.position.x,t.position.y=e.position.y,t.center.x=e.position.x,t.center.y=e.position.y;return}if((t=this.get2DModelBy3DModel(e))||(t=this.get2DMemberBy3DMember(e)),!t)return;t.rotation.z=e.rotation.y;let n=new i.Vector3(1e3*e.position.x,-(1e3*e.position.z),0);t.position.x=n.x,t.position.y=n.y,t.scale.set(r.x,r.z,r.y),t.isLock=e.isLock}else{if((t=this.get3DModelBy2DModel(e))||(t=this.get3DMemberBy2DMember(e)),!t)return;let n=t.height,o=new i.Vector3(e.position.x/1e3,0,-e.position.y/1e3);if(t.modelPosition)t.rotation.y=e.rotation.z;else{if(1==this._scaleStart.x&&1==this._scaleStart.y&&1==this._scaleStart.z)t.scale.set(r.x,r.y,1);else{let e=r.x/this._scaleStart.x,i=r.y/this._scaleStart.y,n=r.z/this._scaleStart.z;t.scale.set(e,i,n)}t.rotation.z=e.rotation.z;let i=t.position;t.position.set(e.position.x,e.position.y,i.z),this.modelHelperGroup.children=[];return}if(t.position.set(o.x,t.position.y,o.z),e.groundHei){let i=t.position.y-n*r.z/2;t.position.y+=e.groundHei-i}t.scale.set(r.x,r.z,r.y),t.isLock=e.isLock,this.modelHelperGroup.children=[]}}get2DModelBy3DModel(e){return e.param?e.param[0]:""}get2DMemberBy3DMember(e){return e.twoD}get3DMemberBy2DMember(e){return e.threeD}get3DModelBy2DModel(e){return e.param?e.param[0]:""}createLine(e,t=0,i=1.5){var r=new(0,g.LineGeometry)().setPositions(e),n=new y.LineMaterial({color:t,linewidth:i});n.resolution.set(window.innerWidth,window.innerHeight);var o=new x.Line2(r,n);return o.renderOrder=1,o.computeLineDistances(),o}createGrid(e=14152177,t=16777215){let r=15e4,n=300;this.gridProportion=r/n;let o=new i.GridHelper(r,n,4473924,e);o.name="2dGrid1";let a=new i.GridHelper(r,n/5,4473924,t);a.name="2dGrid2";let s=new i.GridHelper(r/1e3,n,4473924,e);s.name="3dGrid1";let l=new i.GridHelper(r/1e3,n/5,4473924,t);l.name="3dGrid2";let h=new i.MeshBasicMaterial({color:"#ff0000"}),c=new i.MeshBasicMaterial({color:"#00ff00"});n=8e4;let d=new i.Line(new(0,i.BufferGeometry)().setFromPoints([new i.Vector3(-n,0,0),new i.Vector3(n,0,0)]),h),u=new i.Line(new(0,i.BufferGeometry)().setFromPoints([new i.Vector3(0,0,-n),new i.Vector3(0,0,n)]),c),p=0,m=this.createLine([-n,p,0,n,p,0],"#ff0000"),f=this.createLine([0,p,-n,0,p,n],"#00ff00");m.layers.set(1),f.layers.set(1),s.layers.set(1),l.layers.set(1),this.grid.add(o),this.grid.add(a),this.grid.add(d),this.grid.add(u),this.grid3d.add(s),this.grid3d.add(l),this.grid3d.add(m),this.grid3d.add(f),this.floorGroup2d.children.length>0&&(this.floorGroup2d.children.forEach(e=>{e.position.z=.1}),this.floorGroup.children.forEach(e=>{e.position.y=.1}))}removeScene(e,t="all"){if(this.specialPointArr=[],"all"==t){this.scene.children.slice(0).forEach(e=>{"Group"==e.type&&"3dGrid"!=e.name&&"2dGrid"!=e.name&&(e.children=[])});let e=this.uiPanelBox.dom;for(;e.hasChildNodes();)e.removeChild(e.firstChild);this.allWalls=[],this.otherMeshs=[],this.otherMember=[],this.doorHoleArr=[],this.splitRoomLine.children=[]}else"lable"==t&&this.removeAllHelper();"save"==e&&this.saveSceneJson()}removeAllHelper(){this.helperGroup.children=[],this.removeInputByClassName(this.uiPanelBox.dom)}testSmartRoom(){setInterval(()=>{let e=parseInt(3*Math.random()+1),t=parseInt(2*Math.random()+1),i=1;this.list.smartRoom.dispatch([e,t,i])},1e3)}addFloor(e,t,r,n,o=[]){this.floorGroup2d.add(...e.getFloor(n[0],n[1])),this.floorGroup2d.children.forEach(e=>{e.material.transparent=!0,e.material.opacity=roomOpacity}),this.floorGroup.add(...t),this.roomList=[[],[]],this.allRoomCenterCamera.children=[];let a=this.getDomsByClassName(this.uiPanelBox.dom,"roomName");this.removeInputByClassName(this.uiPanelBox.dom,"roomName");let l={};a.forEach(e=>{let t=e.getAttribute("center"),i=e.innerHTML.replace(/<br>/g,"\n");i=i.replace(/undefined/g,""),l[t]=i}),o.forEach(e=>{let t=e[1].replace(/<br>/g,"\n");t=t.replace(/undefined/g,""),l[e[0]]=t});let h=new i.MeshBasicMaterial({color:16711680,side:i.DoubleSide,transparent:!0,opacity:.2});for(let e=0;e<t.length;e++){this.debug&&(t[e].material.color=new i.Color(16777215*Math.random())),t[e].position.z=3;let n=Array.from(t[e].geometry.attributes.position.array),o=[],a=[];for(let e=0;e<n.length/3;e++)o.push(new i.Vector2(n[3*e],n[3*e+1])),a.push([n[3*e],n[3*e+1]]);let c=[],d=this.floorGroup2d.children[e],u=d.parameter.center;this.roomList[0].push(u);let p=new i.SphereGeometry(.05,32,16),m=new i.Mesh(p,h);m.position.set(u[0]/1e3,this.wallGroup3D.roomHeight/2e3,-u[1]/1e3),m.layers.set(2),m.name="camera_room"+e+"1",this.allRoomCenterCamera.add(m);for(let e=0;e<this.allWalls.length;e++){let t=this.allWalls[e];t.roomCenter||(t.roomCenter=[]);let r=Array.from(t.geometry.attributes.position.array),n=[];for(let e=0;e<r.length/3;e++)n.push(new i.Vector2(r[3*e],r[3*e+1]));for(let e=0,i=!1;e<n.length;e++){for(let r=0;r<o.length;r++)if(n[e].equals(o[r])){c.push(t),t.roomCenter.push(u),i=!0;break}if(i)break}}let f=d.parameter.area;this.roomList[1].push(f);let g="房间"+(e+1),y=u[0].toFixed(2)+"/"+u[1].toFixed(2);l.hasOwnProperty(y)&&(g=l[y].split("\n")[0]),this.floorGroup2d.children[e].roomName=g,this.floorGroup2d.children[e].roomCenter=[u[0].toFixed(2),u[1].toFixed(2)],t[e].roomName=g,t[e].roomCenter=u;let x=this.getScreenPosition(new i.Vector3(u[0],u[1],0)),w=new(0,s.UIText)(g+"\n"+f+"m\xb2").setId("roomName"+this.floorGroup2d.children[e].uuid).setClass("roomName").setStyle(["white-space"],["pre"]).setMarginTop(x.y+"px").setMarginLeft(x.x+"px");w.setAttribute("worldPosition",u[0]+"/"+u[1]+"/1"),w.setAttribute("roomName",g),w.setAttribute("roomArea",f+"m\xb2"),"2D"==r&&(this.uiPanelBox.add(w),w.setAttribute("center",u[0].toFixed(2)+"/"+u[1].toFixed(2)))}}autoShowHidden(e){"PC"==this.deviceType&&this.floorGroup2d.children.forEach(t=>{let i=document.getElementById("roomName"+t.uuid);if(!i)return;let r=parseFloat(i.innerHTML.split("<br>")["1"]),n=!0;r||(n=!1,r=i.getAttribute("roomArea"));let o=[];t.allPoints.forEach(e=>{o.push(e.x,e.y)}),parseInt(100*e)<=66-parseInt(10*r)?(i.style.display="none",this.helperGroup.children.forEach(e=>{if(!e.newStart)return;let t=this.PolyK.ContainsPoint(o,(e.newStart.x+e.newEnd.x)/2,(e.newStart.y+e.newEnd.y)/2),i=document.getElementsByClassName("showWallLength"+e.uuid)[0];t&&i&&(e.visible=!1,i.style.display="none")})):(n&&(i.style.display="block"),this.helperGroup.children.forEach(e=>{if(!e.newStart)return;let t=this.PolyK.ContainsPoint(o,(e.newStart.x+e.newEnd.x)/2,(e.newStart.y+e.newEnd.y)/2),i=document.getElementsByClassName("showWallLength"+e.uuid)[0];t&&i&&(e.visible=!0,this.config.settingJson.dimension&&(i.style.display="block"))}))})}eachShowHiddenModel(e,t,i){e.modelPosition&&(e.modelPosition==t&&(e.visible=i,e.param[0].visible=i),e.children.forEach(e=>{this.eachShowHiddenModel(e,t,i)}))}showHiddenHelperMain(e,t){switch(e){case"roomName":case"roomArea":if(!this.camera.isOrthographicCamera)return;let i=this.uiPanelBox.dom.children;for(let r=0;r<i.length;r++){let n=i[r];if("roomName"==n.className){let i=n.innerText.split("\n");t?("roomName"==e&&(i[0]=n.getAttribute("roomName")),"roomArea"==e&&(i[1]=n.getAttribute("roomArea"))):("roomName"==e&&(i[0]=""),"roomArea"==e&&(i[1]="")),i[0]=i[0].replace(/undefined/g,""),n.innerText=i[0]+"\n"+i[1]}}break;case"dimension":if(!this.camera.isOrthographicCamera)return;if(t)this.helperGroup.visible=!0,(0,o.UtilCore).updateLineDimensionsLine(this);else{this.helperGroup.visible=!1;let e=this.uiPanelBox.dom.children;if(0==e.length)return;for(let t=0;t<e.length;t++)e[t].className.indexOf("showWallLength")>=0&&(e[t].style.display="none")}break;case"showCeilFurniture":this.model3D.children.forEach(e=>{this.eachShowHiddenModel(e,"top",t)});break;case"showFloorFurniture":this.model3D.children.forEach(e=>{this.eachShowHiddenModel(e,"bottom",t)});break;case"showKitchen":case"showAllHouseFurniture":break;case"showWallFurniture":this.model3D.children.forEach(e=>{this.eachShowHiddenModel(e,"free",t)});break;case"showMember":this.otherMember.forEach(e=>{"beam"==e.modelType&&(e.visible=t,e.threeD.visible=t)})}}refreshDoorCamera(){this.allRoomCenterCamera.children.slice(0).forEach(e=>{e.name.indexOf("openDoorCtrl_")>=0&&e.parent&&e.parent.remove(e)});let e=(0,d.DM).getHoleJson(this.otherMeshs,this);this.createDoorCamera(e)}createDoorCamera(e){let t=new i.MeshBasicMaterial({color:65280,side:i.DoubleSide,transparent:!0,opacity:.2}),r=1;e.forEach(e=>{if(e.path&&e.path.indexOf("door")>=0){let h=this.getWallByWallId(e.wallID);if(!h)return;let c=h.endPoint.clone().sub(h.startPoint.clone()),d=new(0,i.Vector3)(-c.y,0,c.x).setLength(400);var n=new i.Vector3(e.location.x,e.location.z,-e.location.y);let u=n.clone().add(d),p=n.clone().add(d.negate()),m=.1;var o=new i.BoxGeometry(m,m,m),a=new i.BoxGeometry(m,m,m),s=new i.Mesh(o,t),l=new i.Mesh(a,t);s.position.set(u.x/1e3,m,u.z/1e3),l.position.set(p.x/1e3,m,p.z/1e3),s.layers.set(2),l.layers.set(2),s.name="openDoorCtrl_"+r,l.name="openDoorCtrl_"+(r+1),r+=2,this.allRoomCenterCamera.add(s),this.allRoomCenterCamera.add(l)}})}destroy3DModelHelper(){if(this.transform3DTool){let e=this.transform3DTool;this.dom.removeEventListener("pointermove",e.pointerMoveHandler),this.dom.removeEventListener("pointerdown",e.pointerDownHandler),this.dom.removeEventListener("pointerup",e.pointerUpHandler),this.dom.removeEventListener("dragstart",e.dragstartHandler),this.dom.removeEventListener("dragend",e.dragendHandler),this.transform3DTool.boxColor&&this.transform3DTool.detach()}}splitRoomByLine(){if(this.splitRoomLine.children.length>0){let e=[],t=[],r={};for(let n in this.allWalls.slice(0).forEach(n=>{let a=(0,o.UtilCore).getAllWallLine(n),s=new i.Vector3(a[0][0],a[0][1],0),l=new i.Vector3(a[1][0],a[1][1],0),h=new i.Vector3(a[2][0],a[2][1],0),c=new i.Vector3(a[3][0],a[3][1],0),d=(0,o.UtilCore).handleLineData(s,l),u=(0,o.UtilCore).handleLineData(h,c),p=[],m=[];this.splitRoomLine.children.forEach(e=>{let t=e.startPoint,i=e.endPoint,n=(0,o.UtilCore).handleLineData(t,i),a=(0,o.UtilCore).lineIsIntersection(d,n),f=(0,o.UtilCore).lineIsIntersection(u,n);if(a){let n=(0,o.UtilCore).pointIsInLine(a,t,i),h=(0,o.UtilCore).pointIsInLine(a,s,l);n&&h&&(p.push(a),r.hasOwnProperty(e.uuid)?(0,o.UtilCore).checkHasSameVec(r[e.uuid],a)||r[e.uuid].push(a):r[e.uuid]=[a])}if(f){let n=(0,o.UtilCore).pointIsInLine(f,t,i),a=(0,o.UtilCore).pointIsInLine(f,h,c);n&&a&&(m.push(f),r.hasOwnProperty(e.uuid)?(0,o.UtilCore).checkHasSameVec(r[e.uuid],f)||r[e.uuid].push(f):r[e.uuid]=[f])}});let f=[{x:s.x,y:s.y},{x:h.x,y:h.y},{x:l.x,y:l.y},{x:c.x,y:c.y}];if(p.length>0){let t=(0,o.UtilCore).sortPoint(p,s,l);for(let i=0;i<t.length-1;i++){0!=i&&f.push({x:t[i][0],y:t[i][1]});let r=t[i].concat(t[i+1]);e.push(r)}}else e.push([s.x,s.y,l.x,l.y]);if(m.length>0){let t=(0,o.UtilCore).sortPoint(m,h,c);for(let i=0;i<t.length-1;i++){let r=t[i].concat(t[i+1]);0!=i&&f.push({x:t[i][0],y:t[i][1]}),e.push(r)}}else e.push([h.x,h.y,c.x,c.y]);t.push(f)}),r){let t=(0,o.UtilCore).getSplitLineByUuid(this.splitRoomLine.children,n);if(""!=t){let i=(0,o.UtilCore).sortPoint(r[n],t.startPoint,t.endPoint);for(let t=0;t<i.length-1;t++){let r=i[t].concat(i[t+1]);e.push(r)}}}return[e,t]}return[!1,!1]}recoveModel(e,t=this.model3D,r=this.model2D){e.forEach(e=>{if(e.imgPath){if("localPath"==e.imgPath){if(e.sliceArr){console.log("开始合并"),this.list.alert.dispatch("正在加载云端模型,请稍等"),this.list.progressOpen.dispatch(1);let t=this;setTimeout(()=>{t.mergeFile(e.sliceArr,e)},100)}}else this.list.loadGltf.dispatch([],e,t,r)}else{let n=new i.Group,o=e.location;n.position.set(o.x,o.y,o.z),n.rotation.y=e.rotation,n.layers.set(2),e.rotate&&n.rotation.set(e.rotate.x,e.rotate.y,e.rotate.z),n.modelType=e.modelType,t.add(n);let a=new i.Group;e.scale&&(n.scale.copy(e.scale),a.scale.set(e.scale.x,e.scale.z,e.scale.y)),a.rotation.z=e.rotation,a.position.set(1e3*o.x,-(1e3*o.z),0),r.add(a),"modelGroup"==n.modelType&&(a.modelType="2dModelGroup"),n.modelId=a.uuid,n.param=[a],a.modelId=n.uuid,a.param=[n],n.isLock=e.isLock,a.isLock=e.isLock;let s="bottom";e.modelPosition&&(s=e.modelPosition),n.modelPosition=s,a.modelPosition=s,n&&(n.width=e.width,n.height=e.height,n.depth=e.depth,a.width=1e3*n.width,a.height=1e3*n.depth,a.depth=1e3*n.height),this.recoveModel(e.child,n,a)}})}loadRoom(e){let t=new E.Room(JSON.parse(e).roomArr),i=[t.floor].concat(t.baseWalls);i=(i=i.concat(t.floor3D)).concat(t.wall3Ds),this.moveRoomArr=i}readCache(e){if(this.list.removeAll.dispatch("noSave",!1),!e||(e=JSON.parse(e)).version!=this.dataVersion){document.getElementsByClassName("Panel")[0].style.display="block";return}e.roomOpacity&&(window.roomOpacity=e.roomOpacity),e.storeyHei&&(window.storeyHei=e.storeyHei),e.floorDep&&(window.floorDep=e.floorDep),e.wall.forEach(e=>{e.start.x/=100,e.start.y/=100,e.end.x/=100,e.end.y/=100});let t=new n.DrawWallTool().create2DWall(e.wall),a=t.pop();this.wallGroup.children=[],this.wallGroup3D.children=[],this.floorGroup.children=[],this.memberGroup3D.children=[],this.lineGroup3D.children=[],t.length>0&&this.wallGroup.add(...a,...t),this.allWalls=t,e.splitLine.forEach(e=>{this.addSplitLine(e.start,e.end,e.useType)}),e.member.forEach(e=>{let t,r=new i.Vector3(e.location.x,e.location.y,e.location.z);"beam"==e.type&&((t=(0,d.DM).createBeam(r,"beam",e.angle,e.height,e.depth,this.allWalls,e.width,"L")).rotation.z=e.rotation),"flue"==e.type&&(t=(0,d.DM).createFlue(r,e.width,e.height,e.rotation)),"pillars"==e.type&&(t=(0,d.DM).createBeam(r,"pillars",e.rotation,e.height,e.depth,this.allWalls,e.width)),t.isLock=e.isLock,this.otherMember.push(t)}),this.otherMember.length>0&&this.scene.add(...this.otherMember);let s=[],l=[];e.hole.forEach(e=>{let t,r,n=new i.Vector3(e.location.x,e.location.y,e.location.z);if(this.allWalls.forEach(i=>{if(i.wallID==e.wallID){t=i;return}}),!t)return;let a=t.startPoint,h=t.endPoint,c=new(0,i.Vector2)(h.x,h.y).sub(new i.Vector2(a.x,a.y)).angle();if(e.path){let u="outside";if(e.doorDir&&(u=e.doorDir),e.path.includes("baseDoor")&&(r=(0,d.DM).createBaseDoor(n,e.width,u,c,t.thickness,a,h)),e.path.includes("panoramicWindow")&&(r=(0,d.DM).createPanoramicWindow(n,e.width,c,t.thickness,a,h)),e.path.includes("frenchWindow")&&(r=(0,d.DM).createFrenchWindow(n,e.width,c,t.thickness,a,h)),e.path.includes("doubleOpenDoor")&&(r=(0,d.DM).createDODoor(n,e.width,c,t.thickness,a,h,u)),e.path.includes("slidingDoor")&&(r=(0,d.DM).createSlidingDoor(n,e.width,c,t.thickness,a,h,u)),e.path.includes("baseWindow")&&(r=(0,d.DM).createBaseWindow(n,e.width,c,t.thickness,a,h)),e.path.includes("sectorWindow")&&(r=(0,d.DM).createSectorWindow(n,e.width,c,t.thickness,a,h)),e.path.includes("lashDoor")&&(r=(0,d.DM).createLashDoor(n,e.width,c,t.thickness,a,h,u)),e.path.includes("pass")&&(r=(0,d.DM).createPass(n,e.width,c,t.thickness,a,h,u)),e.path.includes("sectorDoor")&&(r=(0,d.DM).createSectorDoor(n,e.width,c,t.thickness,a,h)),e.path.includes("arcWindow")&&(r=(0,d.DM).createArcBaseWindow(n,t.arcCenter,t.thickness,(e.endRadian-e.startRadian)/2)),e.path.includes("rightLWindow")&&(s[0]&&s[2]||(s[2]=t,s[3]=e.width),s[0]&&s[2]&&(n=(0,d.DM).getCommonPoint(s[0],s[2]),(r=(0,d.DM).createLWindowNew(n,s[0],s[2],s[1],s[3])).wallId=s[0].wallID,s=[])),e.path.includes("leftLWindow")&&(s[0]&&s[2]||(s[0]=t,s[1]=e.width),s[0]&&s[2]&&(n=(0,d.DM).getCommonPoint(s[0],s[2]),(r=(0,d.DM).createLWindowNew(n,s[0],s[2],s[1],s[3])).wallId=s[0].wallID,s=[])),e.path.includes("uWindow")&&(l.unshift(new i.Vector3(e.location.x,e.location.y,e.location.z)),l.unshift(t),l[0]&&l[2]&&l[4])){let a,s,h,c,u,p,m=(0,d.DM).getCommonPoint(l[0],l[2]);a=m.equals(l[0].startPoint)?l[0].endPoint:l[0].startPoint,s=m.equals(l[2].startPoint)?l[2].endPoint:l[2].startPoint,(0,o.UtilCore).getClockWise(a,m,s)>0?(h=l[2],c=l[3],u=l[4],p=l[5]):(u=l[2],p=l[3],h=l[4],c=l[5]),c=e.windowThickL,p=e.windowThickR;let f=(0,o.UtilCore).getSamePointWall(t,this.allWalls),g=t.startPoint,y=(0,o.UtilCore).getMeshOtherPoint(f[1],g);((0,o.UtilCore).isSameVector(f[0].startPoint,g)||(0,o.UtilCore).isSameVector(f[0].endPoint,g))&&(y=(0,o.UtilCore).getMeshOtherPoint(f[0],g));let x=y.clone().sub(g.clone()).setLength(480);n=new i.Vector2(l[1].x-x.x,l[1].y-x.y),r=(0,d.DM).createUWindow(n,h,t,u,c,p),l=[]}}else if("dooropen"==e.dir&&(r=(0,d.DM).createDoorHole(n,e.width,c,t.thickness,a,h)),"UWindow"==e.dir&&(l.push(t,e.windowThick),l[0]&&l[2]&&l[4])){let a,s,h,c,u,p,m=(0,d.DM).getCommonPoint(l[0],l[2]);a=m.equals(l[0].startPoint)?l[0].endPoint:l[0].startPoint,s=m.equals(l[2].startPoint)?l[2].endPoint:l[2].startPoint,(0,o.UtilCore).getClockWise(a,m,s)>0?(h=l[2],c=l[3],u=l[4],p=l[5]):(u=l[2],p=l[3],h=l[4],c=l[5]),c=e.windowThickL,p=e.windowThickR;let f=(0,o.UtilCore).getSamePointWall(t,this.allWalls),g=t.startPoint,y=(0,o.UtilCore).getMeshOtherPoint(f[1],g);((0,o.UtilCore).isSameVector(f[0].startPoint,g)||(0,o.UtilCore).isSameVector(f[0].endPoint,g))&&(y=(0,o.UtilCore).getMeshOtherPoint(f[0],g));let x=y.clone().sub(g.clone()).setLength(480);n=new i.Vector2(l[1].x-x.x,l[1].y-x.y),r=(0,d.DM).createUWindow(n,h,t,u,c,p),l=[]}r&&(e.height&&(r.height=e.height),e.floorHei&&(r.floorHei=e.floorHei),e.wallID&&(r.wallId=e.wallID),e.isLock&&(r.isLock=e.isLock),this.otherMeshs.push(r))}),this.otherMeshs.length>0&&this.scene.add(...this.otherMeshs),this.recoveModel(e.model);let h=e.mapJson,c=!0;if(h.width){h.hasOwnProperty("visible")&&(c=h.visible);let e=h.imgUrl;if(e){for(var u=e.split(","),p=u[0].match(/:(.*?);/)[1],m=atob(u[1]),f=m.length,g=new Uint8Array(f);f--;)g[f]=m.charCodeAt(f);var y=new Blob([g],{type:p});let t=new File([y],"upload.jpg",{type:"image/jpeg",lastModified:Date.now()});this.createMapMesh(t,h.width,h.height,c)}}this.list.setDefaultParams.dispatch({roomOpacity:100*window.roomOpacity,storeyHei:window.storeyHei,floorDep:window.floorDep,mapVisible:c});let x=e.cameraJson;if(new(0,r.WallCore)(this).wallToJson(),"{}"==JSON.stringify(e.cameraJson)){this.list.setViewportCamera.dispatch("2D",editor),document.getElementsByClassName("Panel")[0].style.display="block";return}this.setViewportCamera(x.sceneModel,this,!1),this.miniMapObj=new T.CreateMiniMap(this,this.miniMapCamera,this.scene,this.newRenderer,this.miniDom,240,202),this.miniMapObj.main(),this.list.changeTheme.dispatch(e.themeColor);let w=e.themeColor;""==w&&(w="1"),e.settingJson&&(this.config.settingJson=e.settingJson),this.config.settingJson.hasOwnProperty("showMember")||(this.config.settingJson.showMember=!0),this.config.settingJson.hasOwnProperty("showFloorFurniture")||(this.config.settingJson.showFloorFurniture=!0),this.config.settingJson.hasOwnProperty("showWallFurniture")||(this.config.settingJson.showWallFurniture=!0),this.config.settingJson.hasOwnProperty("showCeilFurniture")||(this.config.settingJson.showCeilFurniture=!0),this.config.settingJson.hasOwnProperty("showKitchen")||(this.config.settingJson.showKitchen=!0),this.config.settingJson.hasOwnProperty("showAllHouseFurniture")||(this.config.settingJson.showAllHouseFurniture=!0),setTimeout(()=>{this.list.getShowHiddenFlag.dispatch(JSON.stringify(this.config.settingJson)),this.list.themeSwitch.dispatch(w),this.list.threeDimensions.dispatch(x.sceneModel);let e=x.zoom;if(this.camera.isOrthographicCamera){let e=this.getOtherCamera(this.camera);e.zoomNum=x["3dVal"],e.position.copy(new i.Vector3(x["3dPosition"].x,x["3dPosition"].y,x["3dPosition"].z)),e.rotation.copy(new i.Vector3(x["3dRotation"].x,x["3dRotation"].y,x["3dRotation"].z)),e.lookAt(new i.Vector3(0,0,0)),this.camera.zoom=x.zoom,this.camera.position.copy(new i.Vector3(x.position.x,x.position.y,x.position.z)),this.camera.rotation.copy(new i.Vector3(x.rotation.x,x.rotation.y,x.rotation.z)),e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix()}else{"3dRomaCamera"==this.camera.name?this.roamTool.restore(x["3dPosition"],x["3dRotation"]):(this.camera.zoomNum=x["3dVal"],e=x["3dVal"],this.camera.position.copy(new i.Vector3(x["3dPosition"].x,x["3dPosition"].y,x["3dPosition"].z)),this.camera.rotation.copy(new i.Vector3(x["3dRotation"].x,x["3dRotation"].y,x["3dRotation"].z)),this.camera.lookAt(new i.Vector3(0,0,0))),this.camera.aspect=window.innerWidth/window.innerHeight;let t=this.getOtherCamera(this.camera);t.zoom=x.zoom,t.position.copy(new i.Vector3(x.position.x,x.position.y,x.position.z)),t.rotation.copy(new i.Vector3(x.rotation.x,x.rotation.y,x.rotation.z)),t.updateProjectionMatrix(),this.switchHelperGroup("hidden"),this.hiddenDomsByClassName(this.uiPanelBox.dom,"roomName")}this.controlsArr[0].target.copy(new i.Vector3(x.target.x,x.target.y,x.target.z)),this.controlsArr[1].target.copy(new i.Vector3(x["3dTarget"].x,x["3dTarget"].y,x["3dTarget"].z)),this.camera.updateProjectionMatrix(),this.controlsArr[0].update(),this.controlsArr[1].update(),this.list.executeTool.dispatch("moveFree"),this.list.changeCameraSlider.dispatch("2d",e),this.updateDom(),this.camera.updateProjectionMatrix(),this.specialPointArr=(0,o.UtilCore).getAllSpecialPoint(this),this.camera.isOrthographicCamera&&this.autoShowHidden(this.camera.zoom),document.getElementsByClassName("Panel")[0].style.display="block"},100)}readCacheOld(e){if(this.list.removeAll.dispatch("noSave",!1),!e||(e=JSON.parse(e)).version!=this.dataVersion)return;e.wall.forEach(e=>{e.start.x/=100,e.start.y/=100,e.end.x/=100,e.end.y/=100});let t=new n.DrawWallTool().create2DWall(e.wall),r=t.pop();this.wallGroup.children=[],this.wallGroup3D.children=[],this.floorGroup.children=[],this.memberGroup3D.children=[],this.lineGroup3D.children=[],t.length>0&&this.wallGroup.add(...r,...t),this.allWalls=t,e.splitLine.forEach(e=>{this.addSplitLine(e.start,e.end,e.useType)}),e.member.forEach(e=>{let t,r=new i.Vector3(e.location.x,e.location.y,e.location.z);"beam"==e.type&&((t=(0,d.DM).createBeam(r,"beam",e.angle,e.height,e.depth,this.allWalls)).rotation.z=e.rotation),"flue"==e.type&&(t=(0,d.DM).createFlue(r,e.width,e.height,e.rotation)),"pillars"==e.type&&(t=(0,d.DM).createBeam(r,"pillars",e.rotation,e.height,e.depth,this.allWalls,e.width)),this.otherMember.push(t)}),this.otherMember.length>0&&this.scene.add(...this.otherMember);let a=[],s=[];e.hole.forEach(e=>{let t,r,n=new i.Vector3(e.location.x,e.location.y,e.location.z);this.allWalls.forEach(i=>{if(i.wallID==e.wallID){t=i;return}});let l=t.startPoint,h=t.endPoint,c=new(0,i.Vector2)(h.x,h.y).sub(new i.Vector2(l.x,l.y)).angle();if(e.path){if(e.path.includes("baseDoor")&&(r=(0,d.DM).createBaseDoor(n,e.width,"outside",c,t.thickness,l,h)),e.path.includes("panoramicWindow")&&(r=(0,d.DM).createPanoramicWindow(n,e.width,c,t.thickness,l,h)),e.path.includes("frenchWindow")&&(r=(0,d.DM).createFrenchWindow(n,e.width,c,t.thickness,l,h)),e.path.includes("doubleOpenDoor")&&(r=(0,d.DM).createDODoor(n,e.width,c,t.thickness,l,h)),e.path.includes("slidingDoor")&&(r=(0,d.DM).createSlidingDoor(n,e.width,c,t.thickness,l,h)),e.path.includes("baseWindow")&&(r=(0,d.DM).createBaseWindow(n,e.width,c,t.thickness,l,h)),e.path.includes("sectorWindow")&&(r=(0,d.DM).createSectorWindow(n,e.width,c,t.thickness,l,h)),e.path.includes("lashDoor")&&(r=(0,d.DM).createLashDoor(n,e.width,c,t.thickness,l,h)),e.path.includes("pass")&&(r=(0,d.DM).createPass(n,e.width,c,t.thickness,l,h)),e.path.includes("sectorDoor")&&(r=(0,d.DM).createSectorDoor(n,e.width,c,t.thickness,l,h)),e.path.includes("arcWindow")&&(r=(0,d.DM).createArcBaseWindow(n,t.arcCenter,t.thickness,(e.endRadian-e.startRadian)/2)),e.path.includes("rightLWindow")&&(a[0]&&a[2]||(a[2]=t,a[3]=e.width-240),a[0]&&a[2]&&(n=(0,d.DM).getCommonPoint(a[0],a[2]),(r=(0,d.DM).createLWindowNew(n,a[0],a[2],a[1],a[3])).wallId=a[0].wallID,a=[])),e.path.includes("leftLWindow")&&(a[0]&&a[2]||(a[0]=t,a[1]=e.width-240),a[0]&&a[2]&&(n=(0,d.DM).getCommonPoint(a[0],a[2]),(r=(0,d.DM).createLWindowNew(n,a[0],a[2],a[1],a[3])).wallId=a[0].wallID,a=[])),e.path.includes("uWindow")&&(s.unshift(new i.Vector3(e.location.x,e.location.y,e.location.z)),s.unshift(t),s[0]&&s[2]&&s[4])){let e,a,l,h,c,u,p=(0,d.DM).getCommonPoint(s[0],s[2]);e=p.equals(s[0].startPoint)?s[0].endPoint:s[0].startPoint,a=p.equals(s[2].startPoint)?s[2].endPoint:s[2].startPoint,(0,o.UtilCore).getClockWise(e,p,a)>0?(l=s[2],h=s[3],c=s[4],u=s[5]):(c=s[2],u=s[3],l=s[4],h=s[5]);let m=(0,o.UtilCore).getSamePointWall(t,this.allWalls),f=t.startPoint,g=(0,o.UtilCore).getMeshOtherPoint(m[1],f);((0,o.UtilCore).isSameVector(m[0].startPoint,f)||(0,o.UtilCore).isSameVector(m[0].endPoint,f))&&(g=(0,o.UtilCore).getMeshOtherPoint(m[0],f));let y=g.clone().sub(f.clone()).setLength(480);n=new i.Vector2(s[1].x-y.x,s[1].y-y.y),r=(0,d.DM).createUWindow(n,l,t,c,h,u),s=[]}}else if("dooropen"==e.dir&&(r=(0,d.DM).createDoorHole(n,e.width,c,t.thickness,l,h)),"UWindow"==e.dir&&(s.push(t,e.height),s[0]&&s[2]&&s[4])){let e,a,l,h,c,u,p=(0,d.DM).getCommonPoint(s[0],s[2]);e=p.equals(s[0].startPoint)?s[0].endPoint:s[0].startPoint,a=p.equals(s[2].startPoint)?s[2].endPoint:s[2].startPoint,(0,o.UtilCore).getClockWise(e,p,a)>0?(l=s[2],h=s[3],c=s[4],u=s[5]):(c=s[2],u=s[3],l=s[4],h=s[5]);let m=(0,o.UtilCore).getSamePointWall(t,this.allWalls),f=t.startPoint,g=(0,o.UtilCore).getMeshOtherPoint(m[1],f);((0,o.UtilCore).isSameVector(m[0].startPoint,f)||(0,o.UtilCore).isSameVector(m[0].endPoint,f))&&(g=(0,o.UtilCore).getMeshOtherPoint(m[0],f));let y=g.clone().sub(f.clone()).setLength(480);n=new i.Vector2(s[1].x-y.x,s[1].y-y.y),r=(0,d.DM).createUWindow(n,l,t,c,h,u),s=[]}r&&(e.height&&(r.height=e.height),e.floorHei&&(r.floorHei=e.floorHei),e.wallID&&(r.wallId=e.wallID),this.otherMeshs.push(r))}),this.otherMeshs.length>0&&this.scene.add(...this.otherMeshs);let l=e.cameraJson;this.setViewportCamera(l.sceneModel,this),this.camera.zoom=l.zoom,this.camera.position.x=l.position.x,this.camera.position.y=l.position.y,this.camera.position.z=l.position.z,this.camera.rotation.x=l.rotation.x,this.camera.rotation.y=l.rotation.y,this.camera.rotation.z=l.rotation.z,this.globalControl.target.x=l.target.x,this.globalControl.target.y=l.target.y,this.globalControl.target.z=l.target.z,this.camera.updateProjectionMatrix(),this.list.executeTool.dispatch("moveFree"),setTimeout(()=>{this.list.threeDimensions.dispatch(l.sceneModel),this.updateDom()},100)}addSplitLine(e,t,r){let n=new i.Vector3(e.x,e.y,0),o=new i.Vector3(t.x,t.y,0),a=new i.Line(new(0,i.BufferGeometry)().setFromPoints([n,o]),this.config.drawDotMaterial);a.startPoint=n,a.endPoint=o,a.useType=r,a.computeLineDistances(),a.renderOrder=50,this.splitRoomLine.add(a)}execute(e="",t="",i=""){this.history.execute(e,t,i)}exportModelGlb(e){let t=e.clone();t.position.set(0,0,0);let i=new l.GLTFExporter,r={trs:!1,onlyVisible:!0,truncateDrawRange:!0,binary:!0,maxTextureSize:4096};i.parse([t],t=>{let i=new Blob([t],{type:"application/octet-stream"});var r=document.createElement("a");r.style.display="none",r.href=URL.createObjectURL(i);let n="模型";e.name&&(n=e.name),r.download=n+".glb",r.click()},e=>{console.log("error",e)},r)}codeModelCopy(e){let t=new i.Group;return e.children.slice(0).forEach(e=>{t.add(e.clone())}),t.position.copy(e.position),t.rotation.copy(e.rotation),t}exportGLTF(e="gltf"){this.saveSceneJson();let t=new l.GLTFExporter,r=!1;"glb"==e&&(r=!0);let n={trs:!1,onlyVisible:!0,truncateDrawRange:!0,binary:r,maxTextureSize:4096},o=new i.Group;o.name="roomCamera";let a=new i.Group;a.name="openDoorCtrl",this.allRoomCenterCamera.children.slice(0).forEach(e=>{if(e.name.indexOf("camera")>=0){var t=new i.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.01,1e3);t.name=e.name;let r=e.position;t.position.set(r.x,r.y,r.z),t.lookAt(new i.Vector3(r.x,r.y,r.z)),o.add(t)}else a.add(e)});let s=this.camera.clone();this.camera.isOrthographicCamera&&(s=this.getOtherCamera(s).clone());let h=new i.Group;h.name="3dFloor";let c=new i.Group;c.name="3dCeiling";let d=new(0,i.Matrix4)().makeScale(.001,.001,.001),u=new i.Group;u.name="3dWall";let p=new i.Group;p.name="3dDoor";let m=new i.Group;m.name="3dWindow",[u,p,m,h,c].forEach(e=>{e.rotation.x=-Math.PI/2,e.applyMatrix4(d)}),this.floorGroup.children.slice(0).forEach(t=>{if(t.roomName)h.add(t.clone());else{let r=t.clone();r.material=t.material.clone(),"gltf"==e&&(r.material.side=i.DoubleSide),c.add(r)}}),this.wallGroup3D.children.slice(0).forEach((e,t)=>{if("3DWall"==e.modelType&&u.add(e.clone()),e.type.indexOf("Door")>-1||e.type.indexOf("door")>-1||e.type.indexOf("PassMesh")>-1){let t=this.codeModelCopy(e);function i(){for(let i in t.children){let r=t.children[i];"DoorStone"==r.name&&(t.remove(r),r.applyMatrix4(e.matrix),h.add(r))}}p.add(t),"ue"==editor.urlParam.plat&&i(t)}if(e.type.indexOf("Window")>-1||e.type.indexOf("window")>-1){let i=this.codeModelCopy(e);function r(e){"Mesh"==e.type&&"glass"==e.name&&(e.material.opacity=.55),"Group"==e.type&&e.children.forEach(e=>{r(e)})}"ue"==editor.urlParam.plat&&r(i),i.name="window_"+t,m.add(i)}});let f=[u,p,m,this.memberGroup3D,h,c,this.model3D];if(console.log("同步su"),"obj"==e){let e=new i.Scene;f.forEach(t=>{e.add(t)});let t=new D.OBJExporter,r=t.parse(e);var g=document.createElement("a");g.style.display="none",g.href=URL.createObjectURL(new Blob([r],{type:"text/plain"})),g.download="scene.obj",g.click();return}t.parse(f,e=>{try{console.log("SU connect with JS, gltf is exporting..."+e);let t=JSON.stringify(e);sketchup.import_window("window",t)}catch(o){console.log("Not Su");var t=JSON.stringify(e),i=new Blob([t],{type:"text/plain"});e instanceof ArrayBuffer&&(i=new Blob([e],{type:"application/octet-stream"}));var r=document.createElement("a");r.style.display="none",r.href=URL.createObjectURL(i),n.binary?r.download="rjh_test_"+Date.parse(new Date)+".glb":(editor.saveSceneJsonToFile(),r.download="rjh_test_"+Date.parse(new Date)+".gltf"),r.click()}},e=>{console.log("error",e)},n)}undo(){this.history.undo()}redo(){this.history.redo()}initMiniMap(){if(this.miniDom){var e=document.createElement("div");e.className="miniMapDom",e.style.width=this.miniMapWidth+"px",e.style.height=this.miniMapHeight+"px",e.style.pointerEvents="none";var t=document.createElement("div");t.style.pointerEvents="all",t.className="miniBox";var i=document.createElement("div");i.className="miniMapMan",e.appendChild(i),e.appendChild(t);var r=document.createElement("span");r.className="miniMapIcom miniMapNorth",e.appendChild(r),this.miniDom.appendChild(e),e.classList.add("show")}}setViewportCamera(e,t,i=!0){let r=1;for(let n in t.cameras){if("2D"==e&&"2dCamera"==t.cameras[n].name)t.list.default2D.dispatch(),t.viewportCamera=t.cameras[n],r=t.viewportCamera.zoom;else if("3D"==e&&"3dCamera"==t.cameras[n].name){t.lastCamera="3dCamera";let e=t.viewportCamera.position.clone();e.x/=1e3,e.y/=1e3,e.z/=1e3,t.viewportCamera=t.cameras[n];let o=t.viewportCamera.position.clone();if(t.viewportCamera.position.copy(e),i){let i=new v.Tween({x:e.x,y:e.y,z:e.z});i.onUpdate(e=>{t.viewportCamera.position.set(e.x,e.y,e.z)});let r=e.distanceTo(o)/.2/3;i.to({x:o.x,y:o.y,z:o.z},10*r).start()}r=t.viewportCamera.zoomNum}else"3DRoam"==e&&"3dRomaCamera"==t.cameras[n].name&&(t.lastCamera="3dRomaCamera",t.viewportCamera=t.cameras[n],t.roamTool&&t.roamTool.active());t.viewportCamera.sceneModel=e}t.list.threeDimensions.dispatch(e),t.list.changeCameraSlider.dispatch("2d",r),t.miniMapCamera=t.getOtherCamera(t.viewportCamera).clone(),t.list.viewportCameraChanged.dispatch(t,i)}getOtherCamera(e){let t=this,i=e.name,r="";for(let e in t.cameras)"2dCamera"==i?"3dCamera"==t.cameras[e].name&&(r=t.cameras[e]):"2dCamera"==t.cameras[e].name&&(r=t.cameras[e]);return r}focus(e){void 0!==e&&this.signals.objectFocused.dispatch(e)}focusById(e){this.focus(this.scene.getObjectById(e))}select(e){if(this.selected!==e){var t=null;null!==e&&(t=e.uuid),this.selected=e,this.config.setKey("selected",t),this.signals.objectSelected.dispatch(e)}}selectById(e){if(e===this.camera.id){this.select(this.camera);return}this.select(this.scene.getObjectById(e))}getWorldPosition(e){let t=new i.Vector3(0,0,0);e.clientX||0==e.clientX?(t.x=e.clientX/window.innerWidth*2-1,t.y=-(2*(e.clientY/window.innerHeight))+1):(t.x=e.changedTouches[0].pageX/window.innerWidth*2-1,t.y=-(2*(e.changedTouches[0].pageY/window.innerHeight))+1);let r=[this.floor];r=(r=r.concat(this.wallGroup3D.children)).concat(this.floorGroup.children),this.raycaster.setFromCamera(t,this.camera);var n=this.raycaster.intersectObjects(r,!0);let o=new i.Vector3(0,0,0);return n.length>0&&(o=n[0].point),o}getWallColor(e){return 0==e.style?this.cancelChooseHeavyColor:1==e.style?this.cancelChooseShortColor:this.cancelChooseColor}getScreenPosition(e,t=this.camera){e=e.project(t);let i=window.innerWidth/2,r=window.innerHeight/2;return{x:Math.round(e.x*i+i)-22,y:Math.round(-e.y*r+r)-10}}getDomById(e,t){let i=e.children,r="";for(let e=0;e<i.length;e++)i[e].id==t&&(r=i[e]);return r}getDomsByClassName(e,t){let i=e.children,r=[];for(let e=0;e<i.length;e++)i[e].className==t&&r.push(i[e]);return r}hiddenDomsByClassName(e,t){let i=e.children,r=[];for(let e=0;e<i.length;e++)i[e].className==t&&(i[e].display="none");return r}checkHasCurrentInput(e,t){let i=e.children,r=-1;for(let e=0;e<i.length;e++)i[e].id==t&&(r=e);return r}removeInputByClassName(e,t=""){let i=e.children,r="",n=[];for(let e=0;e<i.length;e++)(i[e].className==t||""==t)&&n.push(r=i[e]);return n.forEach(t=>{e.removeChild(t)}),r}removeInputById(e,t){let i=e.children,r="",n=[];for(let e=0;e<i.length;e++)i[e].id==t&&n.push(r=i[e]);return n.forEach(t=>{e.removeChild(t)}),r}removeHelperByWallId(e){let t=this.helperGroup.children;for(let i=0;i<t.length;i++)t[i].wallId&&t[i].wallId==e&&this.helperGroup.remove(t[i])}removeHelperByModelId(e){let t=this.helperGroup.children;this.removeInputByClassName(this.uiPanelBox.dom,"showModelDis");for(let i=0;i<t.length;i++)t[i].modelId&&t[i].modelId==e&&this.helperGroup.remove(t[i])}cleanWallHelper(){this.helperGroup.children=[];let e=this.uiPanelBox.dom,t=e.children,i=[];for(let e=0;e<t.length;e++)"roomName"==t[e].className&&i.push(t[e]);for(;e.hasChildNodes();)e.removeChild(e.firstChild);for(let t=0;t<i.length;t++)e.appendChild(i[t])}cleanModelHelper(){this.helperGroup.children=[],this.removeInputByClassName(this.uiPanelBox.dom,"showModelDis")}removeCircleHelper(e){let t=e.startPoint,i=e.endPoint,r=this.helperGroup.children;for(let e=0;e<r.length;e++){let n=r[e].startPoint,a=r[e].endPoint,s=(0,o.UtilCore).isSameVector(t,n)||(0,o.UtilCore).isSameVector(t,a),l=(0,o.UtilCore).isSameVector(i,n)||(0,o.UtilCore).isSameVector(i,a);s&&l&&(this.removeInputByClassName(this.uiPanelBox.dom,"showAngle"),this.helperGroup.remove(r[e]))}}removeHelperByWall(e,t=!0){let i=this.helperGroup.children,r=e.startPoint,n=e.endPoint;for(let e=0;e<i.length;e++){let t=i[e].startPoint,a=i[e].endPoint;if(!t||!a)continue;let s=(0,o.UtilCore).isSameVector(r,t)||(0,o.UtilCore).isSameVector(r,a),l=(0,o.UtilCore).isSameVector(n,t)||(0,o.UtilCore).isSameVector(n,a);s&&l&&(this.removeInputByClassName(this.uiPanelBox.dom,"showWallLength"+i[e].uuid),this.helperGroup.remove(i[e])),i[e]&&"miniCircle"==i[e].name&&(this.removeInputByClassName(this.uiPanelBox.dom,"showAngle"),this.helperGroup.remove(i[e]))}this.removeInputByClassName(this.uiPanelBox.dom,"showAngle"),t&&this.pointHelperGroup.children.slice(0).forEach(e=>{"bseControl"==e.useType&&this.pointHelperGroup.remove(e),"Mesh"!=e.type&&e.center&&((0,o.UtilCore).isSameVector(r,e.center)&&this.pointHelperGroup.remove(e),(0,o.UtilCore).isSameVector(n,e.center)&&this.pointHelperGroup.remove(e))})}changeWallLength(e,t,r,n=""){let o=new i.Vector2(e.startPoint.x,e.startPoint.y),a=new i.Vector2(e.endPoint.x,e.endPoint.y);if("start"==r){let i=a.clone().sub(o.clone());a=o.clone().add(i.setLength(t)),""!=n?e.startPoint=n:e.endPoint=a}else{let i=o.clone().sub(a.clone());o=a.clone().add(i.setLength(t)),""!=n?e.endPoint=n:e.startPoint=o}}getWallHelperByWall(e){let t="",i=this.helperGroup.children,r=e.startPoint,n=e.endPoint;for(let e=0;e<i.length;e++){if(!i[e].startPoint)continue;let a=i[e].startPoint,s=i[e].endPoint,l=(0,o.UtilCore).isSameVector(r,a)||(0,o.UtilCore).isSameVector(r,s),h=(0,o.UtilCore).isSameVector(n,a)||(0,o.UtilCore).isSameVector(n,s);l&&h&&(t=i[e])}return t}removeBSRHelper(){this.pointHelperGroup.children.slice(0).forEach(e=>{"bseControl"==e.useType&&this.pointHelperGroup.remove(e)}),this.helperGroup.children.slice(0).forEach(e=>{"bseLine"==e.lineType&&this.helperGroup.remove(e)})}removeDoor(e){this.scene.remove(e),this.otherMeshs.indexOf(e)>=0&&this.otherMeshs.splice(this.otherMeshs.indexOf(e),1)}removeMember(e){this.scene.remove(e),this.otherMember.indexOf(e)>=0&&this.otherMember.splice(this.otherMember.indexOf(e),1),e.threeD.parent.remove(e.threeD)}removeWall(e){e.parent&&e.parent.remove(e),this.allWalls.indexOf(e)>=0&&this.allWalls.splice(this.allWalls.indexOf(e),1),this.removeHelperByWall(e)}addWall(e,t,i=240,n=!0){let o=new(0,r.WallCore)(this).createLineWall(e,t,i);return this.scene.add(o),this.allWalls.push(o),o.material.color=this.cancelChooseColor,this.addLineWallHelper(e,t,n),o}addArcWall(e,t,i,n){let o=new(0,r.WallCore)(this).createCircleWall(e,t,i,n);return this.scene.add(o),this.allWalls.push(o),o.material.color=this.cancelChooseColor,o}getAllWindowInWall(e){let t=[];return this.otherMeshs.forEach(i=>{i.wallId==e.wallID?t.push(i):i.leftWindow&&(i.leftWindow[0].wallID==e.wallID||i.rightWindow[0].wallID==e.wallID)&&t.push(i)}),t}cleanScaleTool(){this.helperGroup.children.slice(0).forEach(e=>{e.useType&&"scaleHelpTool"==e.useType&&(this.helperGroup.remove(e),this.removeInputByClassName(this.uiPanelBox.dom,"showScaleLength"+e.uuid))}),this.pointHelperGroup.children=[]}getMap(){let e="";return this.scene.children.forEach(t=>{"mapImage"==t.useType&&(e=t)}),e}allHelperForScaleTool(e,t){let i=new a.WallHelp,r=this.getMap(),n=(0,d.DM).createScaleTool(e,t);n.useType="scaleHelpTool",n.startPoint=e,n.endPoint=t;let o=i.createLineDimensionsLine(t,e,!1);o.useType="scaleHelpTool";let l=this.getScreenPosition(o.center.clone()),h=new(0,s.UIInput)("").setFontSize("15px").setWidth("70px").onKeyDown((function(e){if("Tab"==e.key&&e.preventDefault(),"13"==e.keyCode){let e=h.dom.value;if(!e)return;let t=e/o.lineLength;this.camera.zoom=t,this.camera.updateProjectionMatrix(),this.globalControl.update(),this.cleanScaleTool(),r.scale.set(t,t,1)}}).bind(this)).onBlur((function(e){let t=h.dom.value;if(!t||t==o.lineLength)return;let i=t/o.lineLength;this.camera.zoom=i,this.camera.updateProjectionMatrix(),this.globalControl.update(),this.cleanScaleTool(),r.scale.set(i,i,1)}).bind(this));h.setNumber();let c=new(0,s.UIText)("mm").setMarginLeft("80px").setStyle(["z-index"],[10]);c.dom.style.fontSize="14px",c.dom.style.color="#000",l.y+=20;let u=new(0,s.UIDiv)().setClass("showScaleLength"+o.uuid).setMarginTop(l.y+"px").setMarginLeft(l.x+"px"),p=o.center.x+"/"+o.center.y+"/"+o.center.z;u.setAttribute("worldPosition",p),u.add(c,h),this.uiPanelBox.add(u),this.helperGroup.add(o),this.pointHelperGroup.add(n);let m=i.createScaleToolPoint(e,"start"),f=i.createScaleToolPoint(t,"end");return m.useType="scaleRuleTool",m.otherPosition=t,f.useType="scaleRuleTool",f.otherPosition=e,this.pointHelperGroup.add(m),this.pointHelperGroup.add(f),n}addLineWallHelper(e,t,i=!0,r="",n="",o=160){let a="";return""==r?a=new(0,p.WallHelper)(this).addLineWallHelper(e,t):((a=new(0,p.WallHelper)(this).addLineWallHelper(r,n,o)).startPoint=e,a.endPoint=t,a.newStart=r,a.newEnd=n),i&&this.addArcPointHelper(e,t),a}addBSRWallHelper(e){new(0,p.WallHelper)(this).addBSRWallHelper(e)}getNWalls(e,t,i){let r=(0,P.WallCreator).findCrossWall(e.startPoint,e.endPoint,t);if(r[0].length>0||r[1].length>1){let e=[...r[0],...r[1]];i.push(...e),e.forEach(e=>{t.splice(t.indexOf(e),1)}),e.forEach(e=>{this.getNWalls(e,t,i)})}}getOuterMidPoints(e){let t=Array.from(this.allWalls);t.splice(t.indexOf(e),1);let r=[e];this.getNWalls(e,t,r);let n=[],o=[],a=[],s=[];r.forEach(e=>{let t=[e.parameter.points[0].x,e.parameter.points[0].y],i=[e.parameter.points[3].x,e.parameter.points[3].y],r=[e.parameter.points[2].x,e.parameter.points[2].y],a=[e.parameter.points[5].x,e.parameter.points[5].y];n.push(t,i,r,a),o.push([t,i],[r,a]),s.push(e.startPoint,e.endPoint)}),s=(0,M.CommonFunc).filterArray3(s);let l=new i.Box2().setFromPoints(s),h=[l.min.clone(),new i.Vector2(l.min.x,l.max.y),l.max.clone(),new i.Vector2(l.max.x,l.min.y)];n=(0,M.CommonFunc).filterArray2(n);let c=[];n.forEach(e=>{c.push({x:e[0],y:e[1],adj:[]})}),o.forEach(e=>{a.push([(0,M.CommonFunc).getIndex(n,e[0]),(0,M.CommonFunc).getIndex(n,e[1])])}),a.forEach(e=>{let t=c[e[0]],i=c[e[1]];t.adj.push(i),i.adj.push(t)});let d=(0,S.extract_cycles)(c),u=[];if(d.length>0){let e=d[0];for(let t=1;t<d.length;t++)d[t].length>e.length&&(e=d[t]);let t=[];e.forEach(e=>{t.push(new i.Vector2(e.x,e.y))});for(let e=0;e<t.length;e++){let i=e==t.length-1?0:e+1;r.forEach(r=>{if((0,M.CommonFunc).isInclude(r.parameter.points,t[e])&&(0,M.CommonFunc).isInclude(r.parameter.points,t[i])){u.push(r.startPoint,r.endPoint);return}})}}else r.forEach(e=>{u.push(e.startPoint,e.endPoint)});return[u=(0,M.CommonFunc).filterArray3(u),h,r]}getOrderPoints(e,t,i){let r=e.distanceTo(i[0])+t.distanceTo(i[0]),n=e.distanceTo(i[1])+t.distanceTo(i[1]),o=e.distanceTo(i[2])+t.distanceTo(i[2]),a=e.distanceTo(i[3])+t.distanceTo(i[3]),s=Math.min(r,n,o,a);return r==s?e.distanceTo(i[0])>t.distanceTo(i[0])?[e,t]:[t,e]:n==s?e.distanceTo(i[1])>t.distanceTo(i[1])?[e,t]:[t,e]:o==s?e.distanceTo(i[2])>t.distanceTo(i[2])?[e,t]:[t,e]:a==s?e.distanceTo(i[3])>t.distanceTo(i[3])?[e,t]:[t,e]:void 0}getCross(e,t){let i=[];return t.forEach(t=>{(t.startPoint.equals(e)||t.endPoint.equals(e))&&i.push(t)}),i}getFinalEquation(e,t,i,r){let n=e.distanceTo(t),o=t.clone().sub(e).normalize(),a=Math.asin(i/n),s=Math.tan("MORE"==r?o.angle()-a:o.angle()+a);return{slope:s,constant:t.y-s*t.x}}getRightWall(e,t,i){if(1==e.length){let i=e[0],r=i.startPoint.equals(t)?i.endPoint:i.startPoint;return[i,r,i,r]}let r=[],n=[];return 0==i||i==2*Math.PI?e.forEach(e=>{let i=e.startPoint.equals(t)?e.endPoint:e.startPoint,o=i.clone().sub(t).angle();0==r.length?r=[o,e,i]:o<r[0]&&(r=[o,e,i]),0==n.length?n=[o,e,i]:o>n[0]&&(n=[o,e,i])}):e.forEach(e=>{let o=e.startPoint.equals(t)?e.endPoint:e.startPoint,a=o.clone().sub(t).angle();a=0==a?2*Math.PI:a,0==r.length?r.push(a,e,o):a>i?(a<r[0]||r[0]<i)&&(r=[a,e,o]):r[0]<i&&a<r[0]&&(r=[a,e,o]),a=a==2*Math.PI?0:a,0==n.length?n.push(a,e,o):a<i?(a>n[0]||n[0]>i)&&(n=[a,e,o]):n[0]>i&&a>n[0]&&(n=[a,e,o])}),[r[1],r[2],n[1],n[2]]}inputChangeWall(e,t,i,a){let s=t.newStart||t.startPoint,l=t.newEnd||t.endPoint,h=e.getIndex(s),c=e.getIndex(l),[u,p,m]=this.getOuterMidPoints(e);(0,M.CommonFunc).isInclude(u,e.startPoint),(0,M.CommonFunc).isInclude(u,e.endPoint);let f=Math.round(s.distanceTo(l)),g=e.startPoint,y=e.endPoint,x=[[(0,o.UtilCore).getNewPoint(e),(0,o.UtilCore).getNewPoint(e,"end"),e]];if("start"==a||"center"==a){let t,r=y.clone().sub(g),n=Math.abs(i-f);"center"==a&&(n/=2),f<i&&r.negate();let d=(h>c?l:s).clone().add(r.setLength(n)),u=f<i?r.clone().negate().angle():r.angle(),p=this.getCross(g,m);if(p.splice(p.indexOf(e),1),p.forEach(e=>{x.push([(0,o.UtilCore).getNewPoint(e),(0,o.UtilCore).getNewPoint(e,"end"),e])}),p.length>0){let i,r,n;let o=this.getRightWall(p,g,u);[0,3].includes(h)?(i=o[0],r=o[1],n="MORE"):[2,5].includes(h)&&(i=o[2],r=o[3],n="LESS");let a=this.getFinalEquation(d,r,i.thickness/2,n);t=(0,M.CommonFunc).getIntersectPoint(e.parameter.middleLineEquation,a)}else t=g.clone().add(r.setLength(n));[...p,e].forEach(e=>{let i=this.getWallHelperByWall(e);i&&this.removeHelperByWall(i),e.startPoint.equals(g)?e.startPoint=t:e.endPoint=t})}if("end"==a||"center"==a){let t,r=g.clone().sub(y),n=Math.abs(i-f);"center"==a&&(n/=2),f<i&&r.negate();let d=(h>c?s:l).clone().add(r.setLength(n)),u=i>f?r.clone().negate().angle():r.angle(),p=this.getCross(y,m);if(p.splice(p.indexOf(e),1),p.forEach(e=>{x.push([(0,o.UtilCore).getNewPoint(e),(0,o.UtilCore).getNewPoint(e,"end"),e])}),p.length>0){let i,r,n;let o=this.getRightWall(p,y,u);[0,3].includes(h)?(i=o[2],r=o[3],n="LESS"):[2,5].includes(h)&&(i=o[0],r=o[1],n="MORE");let a=this.getFinalEquation(d,r,i.thickness/2,n);t=(0,M.CommonFunc).getIntersectPoint(e.parameter.middleLineEquation,a)}else t=y.clone().add(r.setLength(n));[...p,e].forEach(e=>{let i=this.getWallHelperByWall(e);i&&this.removeHelperByWall(i),e.startPoint.equals(y)?e.startPoint=t:e.endPoint=t})}let w=(0,d.DM).getWallJson(this.allWalls);this.allWalls=new(0,n.DrawWallTool)().create2DWall(w),this.allWalls.pop(),x.forEach(e=>{let t=this.getAllWindowInWall(e[2]),i=e[0].clone(),r=e[1].clone();if(0==t.length)return;let n=this.getWallByWallId(e[2].wallID),a=(0,o.UtilCore).getNewPoint(n),s=(0,o.UtilCore).getNewPoint(n,"end");t.forEach(t=>{let l=1*(0,o.UtilCore).toVector3(t.center).distanceTo((0,o.UtilCore).toVector3(i)),h=1*(0,o.UtilCore).toVector3(t.center).distanceTo((0,o.UtilCore).toVector3(r));""==this.doorDistance&&(this.doorDistance=l<h?[l,i,r,"start"]:[h,r,i,"end"]);let c=e[2].endPoint.clone().sub(e[2].startPoint.clone()),d=a.clone().add(c.setLength(this.doorDistance[0]));"end"==this.doorDistance[3]&&(c=e[2].startPoint.clone().sub(e[2].endPoint.clone()),d=s.clone().add(c.setLength(this.doorDistance[0]))),this.currentDoor=t,new(0,C.DrawCommand)(this,"door","end",[t,[d,n,n],"wall"]).execute(),this.doorHelperGroupClean(),this.currentDoor="",this.doorDistance=""})}),new(0,r.WallCore)(this).wallToJson()}inputChangeLinkWall(e,t,i,r,n,a,s){let l=a.clone(),h=(0,o.UtilCore).getRealWallByIntersection(e,t,i,a,r),c=a.clone().add(n),d=[];if(h){let i=(0,o.UtilCore).handleLineData(e.startPoint,e.endPoint),r=(0,o.UtilCore).moveLineToPoint(t,i.slice(0)),n=(0,o.UtilCore).handleLineData(h.startPoint,h.endPoint),a=(0,o.UtilCore).lineIsIntersection(r,n);a&&(c=a)}if(2==s.length)this.removeHelperByWall(i[0],!0),d.push([(0,o.UtilCore).getNewPoint(i[0]),(0,o.UtilCore).getNewPoint(i[0],"end"),i[0]]),(0,o.UtilCore).isSameVector(i[0].startPoint,l)?i[0].startPoint=c:i[0].endPoint=c;else if(s.length>2&&h&&!(0,o.UtilCore).pointIsInLine(c,h.startPoint,h.endPoint)){let t=!1;if(s.forEach(i=>{i.uuid!=e.uuid&&(0,o.UtilCore).checkWallContainPointNew(i.startPoint,i.endPoint,c)&&(t=!0)}),!t){let e=this.addWall(l,c,h.thickness,!1);e.style=h.style,e.height=h.height,e.thickness=h.thickness}}let u=[];return s.forEach(t=>{t.uuid!=e.uuid&&u.push(t)}),2==u.length&&(0,o.UtilCore).wallIsInLine(u[0],u[1])&&this.margeWall(u[0],u[1]),"end"==r?(e.startPoint=t,e.endPoint=c):(e.startPoint=c,e.endPoint=t),d}getNextWallInput(e){let t=this.uiPanelBox.dom.children,i=[],r=0,n=0;for(let o=0;o<t.length;o++)"INPUT"==t[o].tagName&&(t[o].className.indexOf("showWallLength")>=0||t[o].className.indexOf("showAngle")>=0)&&(i.push(t[o]),t[o].className==e.className&&(n=r),r++);return n==i.length-1?i[0]:i[n+1]}changTextToInput(e,t="",a="",l="",h="",c=""){let u=this.getWallHelperByWall(e),p=this.removeInputByClassName(this.uiPanelBox.dom,"showWallLength"+u.uuid);if(!p||""!=p&&"none"==p.style.display)return;let m=e.startPoint.clone().distanceTo(e.endPoint),f=(0,o.UtilCore).handleLineData(e.startPoint,e.endPoint),g=(0,o.UtilCore).smallDistanceByPointOnLine(f,this.currentPoint.clone()).clone().distanceTo(e.startPoint),y=m/this.config.wallNum,x="";g>=0&&g<=y&&(x="start"),g>y&&g<=y*(this.config.wallNum-1)&&(x="center"),g>y*(this.config.wallNum-1)&&g<=m&&(x="end");let w=new(0,s.UIInput)(p.textContent).setClass(p.className).setFontSize("15px").setWidth("40px").setId(p.className).setMarginTop(p.style.marginTop).setMarginLeft(p.style.marginLeft).onKeyDown((function(i){if("Tab"==i.key){let e=editor.getNextWallInput(w.dom);e.focus(),e.select(),i.preventDefault()}if("13"==i.keyCode){let i=w.dom.value;if(i<0)return;if(u&&this.removeHelperByWall(u),this.execute(),t){let s=[];t=t.clone();let u=(0,o.UtilCore).getMeshOtherPoint(e,t),m=this.clickSelect[0].object,f=(0,o.UtilCore).getNewPoint(m),g=(0,o.UtilCore).getNewPoint(m,"end"),y=u.clone().sub(t).setLength(1*p.textContent-1*i),x=t.clone().add(y),w=(0,o.UtilCore).isSameVector(t,m.startPoint)?"end":"start",b="start"==w?m.startPoint.clone():m.endPoint.clone();if(this.removeHelperByWall(m,!0),2==h.length)this.removeHelperByWall(a[0],!0),s.push([(0,o.UtilCore).getNewPoint(a[0]),(0,o.UtilCore).getNewPoint(a[0],"end"),a[0]]),(0,o.UtilCore).isSameVector(a[0].startPoint,t)?a[0].startPoint=x:a[0].endPoint=x;else if(h.length>2){if(!(0,o.UtilCore).pointIsInLine(x,e.startPoint,e.endPoint)){let i=!1;if(h.forEach(t=>{t.uuid!=e.uuid&&(0,o.UtilCore).checkWallContainPointNew(t.startPoint,t.endPoint,x)&&(i=!0)}),!i){let i=this.addWall(t,x,e.thickness,!1);i.style=e.style,i.height=e.height,i.thickness=e.thickness}}let i=[];h.forEach(e=>{e.uuid!=m.uuid&&i.push(e)}),2==i.length&&(0,o.UtilCore).wallIsInLine(i[0],i[1])&&this.margeWall(i[0],i[1])}let v=this.inputChangeLinkWall(m,x,l,w,y,b,c);s=s.concat(v);let M=new _.SplitWallCommand(this);this.currenDraw=m,M.splitMain();let S=(0,d.DM).getWallJson(this.allWalls),P=new n.DrawWallTool;this.allWalls=P.create2DWall(S),this.allWalls.pop(),s.forEach(e=>{let t=this.getAllWindowInWall(e[2]),i=e[0].clone(),r=e[1].clone();if(0==t.length)return;let n=this.getWallByWallId(e[2].wallID),a=(0,o.UtilCore).getNewPoint(n),s=(0,o.UtilCore).getNewPoint(n,"end");t.forEach(t=>{let l=1*(0,o.UtilCore).toVector3(t.center).distanceTo((0,o.UtilCore).toVector3(i)),h=1*(0,o.UtilCore).toVector3(t.center).distanceTo((0,o.UtilCore).toVector3(r));""==this.doorDistance&&(this.doorDistance=l<h?[l,i,r,"start"]:[h,r,i,"end"]);let c=e[2].endPoint.clone().sub(e[2].startPoint.clone()),d=a.clone().add(c.setLength(this.doorDistance[0]));"end"==this.doorDistance[3]&&(c=e[2].startPoint.clone().sub(e[2].endPoint.clone()),d=s.clone().add(c.setLength(this.doorDistance[0]))),this.currentDoor=t,new(0,C.DrawCommand)(this,"door","end",[t,[d,n,n],"wall"]).execute(),this.doorHelperGroupClean(),this.currentDoor="",this.doorDistance=""})});let T=this.getAllWindowInWall(m);if(T.length>0){let e=this.getWallByWallId(m.wallID),t=(0,o.UtilCore).getNewPoint(e),i=(0,o.UtilCore).getNewPoint(e,"end");T.forEach(r=>{if(!r.center)return;let n=1*(0,o.UtilCore).toVector3(r.center).distanceTo((0,o.UtilCore).toVector3(f)),a=1*(0,o.UtilCore).toVector3(r.center).distanceTo((0,o.UtilCore).toVector3(g));""==this.doorDistance&&(this.doorDistance=n<a?[n,f,g,"start"]:[a,g,f,"end"]);let s=e.endPoint.clone().sub(e.startPoint.clone()),l=t.clone().add(s.setLength(this.doorDistance[0]));"end"==this.doorDistance[3]&&(s=e.startPoint.clone().sub(e.endPoint.clone()),l=i.clone().add(s.setLength(this.doorDistance[0]))),this.currentDoor=r,new(0,C.DrawCommand)(this,"door","end",[r,[l,e,e],"wall"]).execute(),this.doorHelperGroupClean(),this.currentDoor="",this.doorDistance=""})}new(0,r.WallCore)(this).wallToJson();return}this.inputChangeWall(e,u,i,x)}}).bind(this));w.setAttribute("worldPosition",p.getAttribute("worldPosition")),w.setAttribute("angle",p.getAttribute("angle"));let b=(0,o.UtilCore).havePointWall(e.startPoint,this.allWalls),v=(0,o.UtilCore).havePointWall(e.endPoint,this.allWalls);if(!(b.length>1&&v.length>1)){let n=e.startPoint,a=b;1==b.length&&(n=e.endPoint,a=v);let l=[],h=(0,o.UtilCore).getMeshOtherPoint(e,n).clone().sub(n.clone());a.forEach(t=>{if(t.wallID==e.wallID)return;let i=(0,o.UtilCore).getMeshOtherPoint(t,n).clone().sub(n.clone()),r=(0,o.UtilCore).toVector3(i).angleTo((0,o.UtilCore).toVector3(h));r=Math.round(180/Math.PI*r),l.push(r)});let c=Math.min.apply(null,l),d=l.indexOf(c),u=[];if(a.forEach(t=>{t.wallID!=e.wallID&&u.push(t)}),d>=0&&!t){let t=u[d],a=this.wallHelp.createCircleLine(n,t,e);a.wallId=e.wallID,a.startPoint=e.startPoint,a.endPoint=e.endPoint,a.name="miniCircle",this.helperGroup.add(a);let l=this.getScreenPosition(a.center.clone()),h=new(0,s.UIInput)(a.realAngle).setClass("showAngle").setId("realAngleInput").setFontSize("15px").setWidth("40px").setMarginTop(l.y+"px").setMarginLeft(l.x+"px").setFocus().onKeyDown((function(s){if("Tab"==s.key){let e=editor.getNextWallInput(h.dom);e.focus(),e.select(),s.preventDefault()}if("Escape"==s.key&&this.exitTool(),"13"==s.keyCode){let s=(0,o.UtilCore).getMeshOtherPoint(t,n),l=(0,o.UtilCore).getMeshOtherPoint(e,n),c=(0,o.UtilCore).getClockWise(s,n,l);c=c>0?-1:1;let d=w.dom.value,u=h.dom.value;u=1*u.replace(/°/g,""),u=Math.PI/180*(Math.round(180/Math.PI*(0,o.UtilCore).toVector2(s.clone().sub(n.clone())).angle())+u*c);let p=new i.Vector3(1,0,0);p.applyEuler(new i.Euler(0,0,u,"XYZ")),this.removeHelperByWall(a),(0,o.UtilCore).isSameVector(n,e.startPoint)?(n=e.startPoint.clone().add(p.setLength(d)),e.endPoint=n):(n=e.endPoint.clone().add(p.setLength(d)),e.startPoint=n),new(0,r.WallCore)(this).wallToJson()}}).bind(this));h.dom.addEventListener("mousedown",(function(e){2==e.button&&this.camera.isOrthographicCamera&&this.editor.exitTool()}).bind(this)),this.uiPanelBox.add(h)}}this.uiPanelBox.add(w)}changInputToText(e){this.removeInputByClassName(this.uiPanelBox.dom,e.className);let t=new(0,s.UIText)(e.value).setClass(e.className).setFontSize("15px").setWidth("40px").setMarginTop(e.style.marginTop).setMarginLeft(e.style.marginLeft).setStyle(["transform"],["rotate("+e.getAttribute("angle")+"deg)"]);t.setAttribute("worldPosition",e.getAttribute("worldPosition")),t.setAttribute("angle",e.getAttribute("angle")),this.uiPanelBox.add(t)}changAllInputToText(){let e=this.uiPanelBox.dom.children;for(let t=0;t<e.length;t++)"INPUT"==e[t].tagName&&e[t].className.indexOf("showWallLength")>=0&&this.changInputToText(e[t])}getWallByWallId(e){let t="";return this.allWalls.forEach(i=>{i.wallID==e&&(t=i)}),t}get3dWallByWallId(e){let t="";return this.wallGroup3D.children.slice(0).forEach(i=>{i.wallID==e&&(t=i)}),t}changeClickColor(e){e&&e.children.forEach(e=>{("Line"==e.type||"Line2"==e.type||"DWHelper"==e.type)&&(e.material.color=this.clickColor)})}addLineHelperForDoor(e,t=!1){if(!e.wallId||!e.startPoint)return;let r=this.getWallByWallId(e.wallId);if(""==r)return;let n=new i.Vector3(r.startPoint.x,r.startPoint.y,0),o=new i.Vector3(r.endPoint.x,r.endPoint.y,0);if(10>n.clone().distanceTo(o.clone()))return;let a=new m.DoorHelper(this);"UWindow"==e.modelType?a.addUWindowHelper(r,e,t):"LWindow"==e.modelType?a.addLWindowHelper(e,t):"arcWindow"==e.modelType?a.addArcWindowHelper(e):a.addDoorHelper(r,e,t),this.changeClickColor(e)}addLineHelperForMember(e){this.cleanWallHelper(),this.doorHelperGroupClean(),this.changeClickColor(e);let t=new(0,f.MemberHelper)(this).addMemberHelper(e);this.pointHelperGroup.add(...t)}doorHelperGroupClean(){let e=this.pointHelperGroup.children.slice(0);e.forEach(e=>{e.useType&&("scaleTool"==e.useType||"rotateTool"==e.useType)&&this.pointHelperGroup.remove(e)}),e=this.helperGroup.children.slice(0),this.removeInputByClassName(this.uiPanelBox.dom,"showModelDis"),e.forEach(e=>{e.modelId&&this.helperGroup.remove(e)}),this.doorHelperGroup.children.forEach(e=>{this.removeInputByClassName(this.uiPanelBox.dom,"showDoorLength"+e.uuid)}),(e=this.pointHelperGroup.children.slice(0)).forEach(e=>{"Mesh"==e.type&&this.pointHelperGroup.remove(e)}),this.doorHelperGroup.children=[],this.otherMeshs.concat(this.otherMember).forEach(e=>{e.children.forEach(e=>{("Line"==e.type||"Line2"==e.type||"DWHelper"==e.type)&&(e.material.color=this.moveDoorOutColor)})})}addArcPointHelper(e,t){let i=new a.WallHelp,r=this.pointHelperGroup.children.slice(0),n=!0,s=!0;this.allWalls.forEach(i=>{let r=i.startPoint,a=i.endPoint,l=(0,o.UtilCore).isSameVector(e,r)||(0,o.UtilCore).isSameVector(e,a),h=(0,o.UtilCore).isSameVector(t,r)||(0,o.UtilCore).isSameVector(t,a);l&&h||(l&&(n=!1),h&&(s=!1))});let l=!1,h=!1;r.forEach(i=>{"Mesh"!=i.type&&i.center&&((0,o.UtilCore).isSameVector(e,i.center)&&(l=!0),(0,o.UtilCore).isSameVector(t,i.center)&&(h=!0),(0,o.UtilCore).isSameVector(e,i.center)&&!n&&this.pointHelperGroup.remove(i),(0,o.UtilCore).isSameVector(t,i.center)&&!s&&this.pointHelperGroup.remove(i))}),this.innerDraw,n&&!l&&this.pointHelperGroup.add(i.createPoint(e)),s&&!h&&this.pointHelperGroup.add(i.createPoint(t))}addIntersectPointHelper(){let e=new a.WallHelp,t=[];this.allWalls.forEach(e=>{let i=e.startPoint.clone(),r=e.endPoint.clone(),n=!1,a=!1;t.forEach(e=>{(0,o.UtilCore).isSameVector(e,i)&&(n=!0),(0,o.UtilCore).isSameVector(e,r)&&(a=!0)}),n||t.push(i),a||t.push(r)});let i=this.pointHelperGroup.children.slice(0);t.forEach(t=>{let r=0,n=[];this.allWalls.forEach(e=>{let i=e.startPoint.clone(),a=e.endPoint.clone();(0,o.UtilCore).isSameVector(t,i)&&r++,(0,o.UtilCore).isSameVector(t,a)&&r++,((0,o.UtilCore).isSameVector(t,i)||(0,o.UtilCore).isSameVector(t,a))&&n.push(1*e.thickness)});let a=Math.min.apply(null,n);if(r>1){let r=!1;i.forEach(e=>{if("Mesh"!=e.type&&e.center&&(0,o.UtilCore).isSameVector(t,e.center)){r=!0;return}}),r||this.pointHelperGroup.add(e.createDragPoint(t,"",a/3))}else if(1==r){let r=!1;i.forEach(e=>{if("Mesh"!=e.type&&e.center&&(0,o.UtilCore).isSameVector(t,e.center)){r=!0;return}}),r||this.pointHelperGroup.add(e.createPoint(t,"",a/3))}})}switchHelperGroup(e="show",t=!0){let i=this.uiPanelBox.dom.children;if(0!=i.length)for(let t=0;t<i.length;t++)"show"==e&&(i[t].className.indexOf("showWallLength")>=0?this.config.settingJson.dimension&&(i[t].style.display="block"):i[t].style.display="inline-block"),"hidden"==e&&(i[t].style.display="none")}updateDom(){let e=this.uiPanelBox.dom.children;if(0==e.length)return;for(let t=0;t<e.length;t++){if(!e[t].getAttribute("worldPosition"))continue;let r=e[t].getAttribute("worldPosition").split("/"),n=new i.Vector3(r[0],r[1],r[2]),o=this.getScreenPosition(n);e[t].className.indexOf("showScaleLength")>=0&&(o.y+=20),e[t].style.marginTop=o.y+"px",e[t].style.marginLeft=o.x+"px"}if("PC"==this.deviceType)return;let t=this.getPointScale();this.helperGroup.children.slice(0).forEach(e=>{("extremePoint"==e.useType||"centerPoint"==e.useType||"doorDragPoint"==e.useTYpe)&&e.scale.set(t,t,1)}),this.pointHelperGroup.children.slice(0).forEach(e=>{"wallExtremePoint"==e.useType&&e.scale.set(t,t,1)})}getDisByScreen(){return Math.round(this.getScreen(new i.Vector3(100,0,0),this.camera)[0]-this.getScreen(new i.Vector3(0,0,0),this.camera)[0])/20}getDialogPosition(e,t,i=""){let r=30,n="";n=""!=i?(0,o.UtilCore).toVector3(i).project(this.camera):e.x<t.x?t.clone().project(this.camera):e.clone().project(this.camera);let a=window.innerWidth/2,s=window.innerHeight/2,l=[Math.round(n.x*a+a),Math.round(-n.y*s+s)];return l[0]+=r,l[1]-=2*r,l}get3DModelDialogPosition(e,t=50){let r=new(0,i.Box3)().setFromObject(e),n=1*(r.max.y-r.min.y).toFixed(2)/2;e.height&&(n=1*e.height/2),e.updateMatrixWorld(!0);var o=new i.Vector3;e.getWorldPosition(o),o.y+=n;let a=o.project(this.camera),s=window.innerWidth/2,l=window.innerHeight/2,h=[Math.round(a.x*s+s),Math.round(-a.y*l+l)];return h[0]+=2*t,h[1]-=t,h}updateDialogPosition(e){if(!e.useType||!e.startPoint)return;let t=this.getDialogPosition(new i.Vector3(e.startPoint.x,e.startPoint.y,0),new i.Vector3(e.endPoint.x,e.endPoint.y,0));this.list.showDialog.dispatch(0,"wall",t,[])}addBoxForMesh(e,t){if(e.geometry){let t=new i.EdgesGeometry(e.geometry,4),r=new i.LineSegments(t,this.boxLineMaterial);e.updateWorldMatrix(!0);let n=e.position.clone();e.parent&&e.parent.localToWorld(n),this.lineGroup3D.updateWorldMatrix(!0),this.lineGroup3D.worldToLocal(n);let o=this.getOuterParent(e),a=o.rotation;"CodeModel"==o.modelType&&r.rotation.set(a.x,a.y,a.z),r.position.copy(n),this.lineGroup3D.add(r)}else e.children.forEach(e=>{this.addBoxForMesh(e,t)})}addPositionHelper(e,t=!1){let r,n,a,s,l=0,h=parseInt(180/Math.PI*(l=e.rotation.z));h<0&&(h+=360);let c=(0,o.UtilCore).getModelVertex(e);if(h>355||h<=5||h>85&&h<=95||h>175&&h<=185||h>265&&h<=275){let e=[c[4].x,c[5].x,c[6].x,c[7].x].sort(function(e,t){return e-t}),t=[c[4].y,c[5].y,c[6].y,c[7].y].sort(function(e,t){return e-t});for(let i=4;i<c.length;i++).01>Math.abs(c[i].y-t[t.length-1])&&(.01>Math.abs(c[i].x-e[1])||.01>Math.abs(c[i].x-e[2]))&&(r=c[i]),.01>Math.abs(c[i].y-t[0])&&(.01>Math.abs(c[i].x-e[1])||.01>Math.abs(c[i].x-e[2]))&&(n=c[i]),(.01>Math.abs(c[i].y-t[1])||.01>Math.abs(c[i].y-t[2]))&&.01>Math.abs(c[i].x-e[0])&&(a=c[i]),(.01>Math.abs(c[i].y-t[1])||.01>Math.abs(c[i].y-t[2]))&&.01>Math.abs(c[i].x-e[e.length-1])&&(s=c[i])}else{let e=[c[0].x,c[1].x,c[2].x,c[3].x],t=[c[0].y,c[1].y,c[2].y,c[3].y],i=e.indexOf(Math.min(...e)),o=e.indexOf(Math.max(...e)),l=t.indexOf(Math.min(...t));r=c[t.indexOf(Math.max(...t))],n=c[l],a=c[i],s=c[o]}let d=[[0,1],[0,-1],[-1,0],[1,0]];if(!(c=[r,n,a,s])[0])return;r=["Y","",c[0].x],n=["Y","",c[1].x],a=["X","",c[2].y],s=["X","",c[3].y];let u=[[],[],[],[]],p=[[],[],[],[]],m=this.allWalls.slice(0);(m=(m=m.concat(this.model2D.children)).concat(this.otherMember)).forEach(t=>{if(t.id==e.id)return;let r=[];if(t.geometry&&"2DModel"!=t.modelType){let e=t.geometry.attributes.position.array;r=[e[0],e[1],e[9],e[10],e[15],e[16],e[6],e[7]]}else{let e=(0,o.UtilCore).getModelVertex(t);r=[e[0].x,e[0].y,e[3].x,e[3].y,e[2].x,e[2].y,e[1].x,e[1].y]}for(let e=0;e<=3;e++){let t=d[e],n=PolyK.Raycast(r,c[e].x,c[e].y,t[0],t[1]);if(n){let r=c[e].clone().add(new(0,i.Vector3)(t[0],t[1],0).setLength(n.dist));u[e].push(r),p[e].push(n.dist)}}});let f=Math.min.apply(null,p[0]),g=Math.min.apply(null,p[1]),y=Math.min.apply(null,p[2]),x=Math.min.apply(null,p[3]);this.addMinDisInput(u[0],c[0],f,"top",e,t),this.addMinDisInput(u[1],c[1],g,"bot",e,t),this.addMinDisInput(u[2],c[2],y,"lef",e,t),this.addMinDisInput(u[3],c[3],x,"rig",e,t)}addMinDisInput(e,t,r,n,a,l){e.forEach(e=>{if(.01>Math.abs((0,o.UtilCore).toVector3(e).distanceTo((0,o.UtilCore).toVector3(t))-r)){let r=this.wallHelp.createLineDimensionsLine(t,e,!1,10);r.modelId=a.id;let h=new(0,i.Vector2)(e.x,e.y).sub(new i.Vector2(t.x,t.y)).angle();(h=180/Math.PI*h)>180&&h<270?h=360-h+180:h>90&&h<=180?(h*=-1,h+=180):h=360-h;let c=this.getScreenPosition(r.center.clone()),d=new(0,s.UIText)(r.lineLength).setClass("showModelDis").setFontSize("15px").setWidth("40px").setMarginTop(c.y+"px").setMarginLeft(c.x+"px").setStyle(["transform"],["rotate("+h+"deg)"]);if(l){let e=["top","rig","bot","lef"],t=e.indexOf(n),i="showModelDis"+(t==e.length-1?"top":e[t+1]),l="showModelDis"+n;d=new(0,s.UIInput)(r.lineLength).setClass("showModelDis").setFontSize("15px").setWidth("40px").setId(l).setMarginTop(c.y+"px").setMarginLeft(c.x+"px").onKeyDown((function(e){if("Tab"==e.key&&document.getElementById(i)&&(document.getElementById(i).focus(),document.getElementById(i).select(),e.preventDefault()),"13"==e.keyCode){this.pointHelperGroup.children.slice(0).forEach(e=>{("rotateTool"==e.useType||"scaleTool"==e.useType)&&this.pointHelperGroup.remove(e)}),this.cleanModelHelper();let e=d.dom.value,t=d.getAttribute("moveDir"),i=1*e-1*r.lineLength;"rig"==t&&(a.position.x-=i),"lef"==t&&(a.position.x+=i),"top"==t&&(a.position.y-=i),"bot"==t&&(a.position.y+=i),this.addLineHelperForMember(a),this.synchroModel(a),this.addPositionHelper(a,!0);let n=(0,o.UtilCore).toVector3(a.position.clone()).project(this.camera),s=window.innerWidth/2,l=window.innerHeight/2,h=[1*Math.round(n.x*s+s),1*Math.round(-n.y*l+l)];h[0]+=40,h[1]-=80,this.list.showDialog.dispatch("","",h)}}).bind(this))}let u=r.center.x+"/"+r.center.y+"/"+r.center.z;d.setAttribute("worldPosition",u),d.setAttribute("angle",h),d.setAttribute("moveDir",n),this.camera.isOrthographicCamera&&r.lineLength>10&&this.uiPanelBox.add(d),this.helperGroup.add(r);return}})}getWallNearModelSide(e,t,i,r,n,a,s,l){let h=(0,o.UtilCore).lineIsIntersection(t,i);if(!h)return;let c=(0,o.UtilCore).lineIsIntersection(r,i),d=(0,o.UtilCore).pointIsInLine(c,h,a);if(d||(c=(0,o.UtilCore).lineIsIntersection(n,i)),d){if(!(0,o.UtilCore).pointIsInLine(c,s[0],s[1]))return}else if(!(0,o.UtilCore).pointIsInLine(c,l[0],l[1]))return;if("top"==e&&c.y<=a.y||"bot"==e&&c.y>=a.y||"lef"==e&&c.x>=a.x||"rig"==e&&c.x<=a.x)return;let u=(0,o.UtilCore).toVector3(a).distanceTo((0,o.UtilCore).toVector3(c));return[(0,o.UtilCore).toVector3(c),u]}exitTool(e=!0,t=!0){if(this.startPoint="",this.copyDoor="",this.copyFloorMaterial="",this.splitRoomLineGroup.children=[],this.list.startPlayer.dispatch(),this.selectObjArr=[],this.doorHelperGroupClean(),this.clickSelect.length>0&&""!=this.clickSelect[0].object&&"wall"==this.clickSelect[0].object.useType&&(this.clickSelect[0].object.material.color=this.getWallColor(this.clickSelect[0].object)),this.list.resetproperty.dispatch({roomOpacity:100*window.roomOpacity,storeyHei:window.storeyHei,floorDep:window.floorDep}),this.list.hiddenDialog.dispatch(),this.modelHelperGroup.children=[],this.clickSelect=[],this.destroy3DModelHelper(),this.currenDraw&&""!=this.currenDraw?"Mesh"==this.currenDraw.type||"Group"==this.currenDraw.type||"Line"==this.currenDraw.type?("Group"==this.currenDraw.type&&(this.dom.style.cursor="default",this.toolType="free",this.doorHelperGroupClean()),this.scene.remove(this.currenDraw),this.removeHelperByWallId(this.currenDraw.id)):this.currenDraw.forEach(e=>{this.scene.remove(e),this.removeHelperByWallId(e.id)}):(this.dom.style.cursor="default",this.toolType="free",this.list.switchBounced.dispatch("")),this.removeInputByClassName(this.uiPanelBox.dom,"moveInput"),this.removeInputByClassName(this.uiPanelBox.dom,"moveInput"),""!=this.mouseCoverObj){if(this.viewportCamera.isOrthographicCamera){this.model2D.remove(this.mouseCoverObj);let e=this.get3DModelBy2DModel(this.mouseCoverObj);this.model3D.remove(e)}else{this.model3D.remove(this.mouseCoverObj);let e=editor.get2DModelBy3DModel(this.mouseCoverObj);this.model2D.remove(e)}this.mouseCoverObj=""}this.currenDraw="",""!=this.currentPoint&&(0,o.UtilCore).handleSpecialPoint(this.currentPoint.clone(),this.specialPointArr,this),this.pointHelpGroup.children=[],t&&e&&(this.viewportCamera.isOrthographicCamera?new(0,r.WallCore)(this).wallToJson():new(0,r.WallCore)(this).wallToJson("3D"))}getArcOtherPoint(e,t,r,n){let o=e.clone().distanceTo(r.arcCenter.clone()),a=new i.Vector2((e.x+n.x)/2,(e.y+n.y)/2),s=new i.Vector2((e.x+t.x)/2,(e.y+t.y)/2),l=e.clone().distanceTo(n.clone()),h=l/2/o,c=o*(e.clone().distanceTo(t.clone())/2)/(l/2),d=c*Math.sqrt(1-h*h),u=s.clone().add(r.arcCenter.clone().sub(a.clone()).setLength(d));return 1e-4>Math.abs(h-1)&&(u=s.clone()),u.clone().add(r.cp.clone().sub(r.arcCenter.clone()).setLength(c))}getSceneAllJson(e=!1){let t=(0,d.DM).getHoleJson(this.otherMeshs,this),i=(0,d.DM).memberJson(this.otherMember),r=(0,d.DM).getWallJson(this.allWalls),n=(0,d.DM).getModelJson(this.model3D.children,[],e),o=(0,d.DM).getSplitLineJson(this.splitRoomLine.children);r.forEach(e=>{e.start.x*=100,e.start.y*=100,e.end.x*=100,e.end.y*=100});let a=this.camera,s=this.camera.isOrthographicCamera?"2D":"3D";this.camera.isOrthographicCamera&&(a=this.getOtherCamera(a));let l=this.camera;this.camera.isOrthographicCamera||(l=this.getOtherCamera(l));let h=1;a.zoomNum&&(h=a.zoomNum);let c=[this.controlsArr[0].target.x,this.controlsArr[0].target.y,this.controlsArr[0].target.z],u=[0,0,0];2==this.controlsArr.length&&(u=[this.controlsArr[1].target.x,this.controlsArr[1].target.y,this.controlsArr[1].target.z]);let p={sceneModel:s,zoom:l.zoom,position:{x:l.position.x,y:l.position.y,z:l.position.z},rotation:{x:l.rotation.x,y:l.rotation.y,z:l.rotation.z},"3dPosition":{x:a.position.x,y:a.position.y,z:a.position.z},"3dRotation":{x:a.rotation.x,y:a.rotation.y,z:a.rotation.z},target:{x:c[0],y:c[1],z:c[2]},"3dTarget":{x:u[0],y:u[1],z:u[2]},"3dVal":h};"3dRomaCamera"==a.name&&(p["3dPosition"]={x:a.realPosition.x,y:a.realPosition.y,z:a.realPosition.z},p["3dRotation"]={x:"",y:a.realRotation[0].y,z:a.realRotation[1].z});let m=this.getDomsByClassName(this.uiPanelBox.dom,"roomName"),f=[],g=this.floorGroup2d.children;m.forEach(e=>{let t=e.getAttribute("center"),i=e.getAttribute("roomName")+"\n"+e.getAttribute("roomArea"),r=[t,i=(i=i.replace(/<br>/g,"\n")).replace(/undefined/g,"")];g.forEach(e=>{let i=e.roomCenter;if(!e.parameter)return;let n=e.parameter.points,o=[];n.forEach(e=>{o.push([e.x,e.y])}),t==i[0]+"/"+i[1]&&(r.push(1==e.material.color.r),r.push(o))}),f.push(r)});let y=[];this.allRoomCenterCamera.children.slice(0).forEach(e=>{if(e.name.indexOf("camera")>=0){let t=e.position,i={position:{x:1e3*t.x,y:window.storeyHei,z:1e3*t.z}};y.push(i)}});let x="";this.scene.children.forEach(e=>{"mapImage"==e.useType&&(x=e)});let w={};return""!=x&&(w={width:x.width*x.scale.x,height:x.height*x.scale.y,imgUrl:x.imgUrl,visible:x.visible}),{version:this.dataVersion,themeColor:this.themeColor,wall:r,hole:t,member:i,model:n,splitLine:o,cameraJson:p,roomJson:f,mapJson:w,settingJson:this.config.settingJson,roomOpacity:window.roomOpacity,storeyHei:window.storeyHei,floorDep:window.floorDep,allLightMsg:y}}saveSceneJsonToFile(){var e=JSON.stringify(this.getSceneAllJson(!0)),t=new Blob([e],{type:"text/json"}),i=document.createElement("a");i.style.display="none",i.href=URL.createObjectURL(t),i.download="rjh_scene.json",i.click()}getOrderId(){return new Date().getTime()}saveSceneJson(){console.log("自动保存");let e=this.getSceneAllJson(),t=new Date;"PC"!=this.deviceType&&(e=(0,A.MobileMain).getAllJson()),this.cacheJson=JSON.stringify(e);let i={sceneJson:e,orderTime:this.getNowTime(),orderId:this.orderId,orderName:"新方案"},r="";if(localStorage.getItem(this.storageName)){if((r=localStorage.getItem(this.storageName)).indexOf("version")>=0){if(JSON.stringify(e)==r)return;r=t.getFullYear()+""+(t.getMonth()+1)+t.getDate()+Math.round(1e4*Math.random()+1)+".json",localStorage.setItem(this.storageName,r),this.saveJsonToSever(i,r,!0)}else if(this.currentCacheJson){let t=this.currentCacheJson;if(JSON.stringify(e)==JSON.stringify(t))return;console.log("保存:"+r),localStorage.setItem(this.storageName,r),this.saveJsonToSever(i,r,!0)}else this.currentCacheJson=e}else{let e=new Date;r||(r=e.getFullYear()+""+(e.getMonth()+1)+e.getDate()+Math.round(1e4*Math.random()+1)+".json"),localStorage.setItem(this.storageName,r),this.saveJsonToSever(i,r,!0)}}isObj(e){return e&&"object"==typeof e&&"[object object]"==Object.prototype.toString.call(e).toLowerCase()}isArray(e){return e&&"object"==typeof e&&e.constructor==Array}getLength(e){var t=0;for(var i in e)t++;return t}CompareJsonObj(e,t){return!!(this.isObj(e)&&this.isObj(t))&&this.getLength(e)==this.getLength(t)&&this.CompareObj(e,t,!0)}CompareObj(e,t,i,r=["uuid"]){if(this.getLength(e)!=this.getLength(t))return!1;for(var n in e){if(!i)break;if(!t.hasOwnProperty(n)){i=!1;break}if("cameraJson"!=n){if(this.isArray(e[n])){if(!this.isArray(t[n])){i=!1;break}var o=e[n],a=t[n];if(o.length!=a.length){i=!1;break}for(var s in o){if(!i)break;i=this.CompareObj(o[s],a[s],i)}}else if(this.isObj(e[n])){if(this.isObj(t[n])){if(!i)break;i=this.CompareObj(e[n],t[n],i)}else{i=!1;break}}else{if(r.indexOf(n)>=0)continue;if(String(t[n])!=String(e[n])){i=!1;break}}}}return i}updateModel(e){if(this.clickDepthMsg.uuid){this.modelDotGroup.children=[];let t=this.getOuterParent(e,e,"outer"),i=t.param[0];this.refreshRealSizeByBox(t,e),this.updateModelPosition(e.parent,t),this.addDashBoxFor2dGroup(i),this.addDashBoxForGroup(t)}}updateModelPosition(e,t){if(!e||"3dModel"==e.name||"2dModel"==e.name)return;let r=e;"2dModel"==t.parent.name&&(r=e.param[0],t=t.param[0]),e.updateWorldMatrix(!0,!0);let n=[];e.children.forEach(t=>{let i=t.position.clone();i=e.localToWorld(i),n.push(i)});let o=new i.Vector3;this.getRealCenter(e).getCenter(o),e.parent.worldToLocal(o),e.position.set(o.x,o.y,o.z),this.synchroModel(e);let a=0;e.updateWorldMatrix(!0,!0),e.children.forEach(t=>{let i=n[a];e.worldToLocal(i),t.position.set(i.x,i.y,i.z),this.synchroModel(t),a++});let s=this.getRealCenter(r),l=new(0,c.OBB)().fromBox3(s);r.width=2*l.halfSize.x/r.scale.x,r.height=2*l.halfSize.y/r.scale.y,r.depth=2*l.halfSize.z/r.scale.z,r.param[0].width=1e3*r.width,r.param[0].height=1e3*r.depth,r.param[0].depth=1e3*r.height,this.updateModelPosition(e.parent,t)}getWorldRotation(e){let t=(e,t)=>new i.Vector3(e.x+t.x,e.y+t.y,e.z+t.z);return null===e?new i.Vector3:t(e.rotation,this.getWorldRotation(e.parent))}getRealCenter(e){let t=this.getWorldRotation(e);t.x=-t.x+e.rotation.x,t.y=-t.y+e.rotation.y,t.z=-t.z+e.rotation.z;let r=e.rotation.x,n=e.rotation.y,o=e.rotation.z;e.rotation.set(t.x,t.y,t.z);let a=new(0,i.Box3)().setFromObject(e);return e.rotation.set(r,n,o),a}makeGroup(e="3d"){this.execute(),this.doorHelperGroupClean();let t=new i.Group,r=this.selectObjArr.slice(0),n=new i.Group,o="",a="",s=[];r.forEach(i=>{let r=this.getOuterParent(i);if("3d"==e){let e=this.get2DModelBy3DModel(r);o=(a=r.parent).param?a.param[0]:this.model2D,n.add(e),t.add(r)}else{let e=this.get3DModelBy2DModel(r);a=(o=r.parent).param?o.param[0]:this.model3D,n.add(r),t.add(e)}r.modelPosition&&s.push(r.modelPosition),r.param[0].modelPosition&&s.push(r.param[0].modelPosition)}),0>s.indexOf("bottom")&&0>s.indexOf("free")?(t.modelPosition="top",n.modelPosition="top"):0>s.indexOf("bottom")&&0>s.indexOf("top")?(t.modelPosition="free",n.modelPosition="free"):(t.modelPosition="bottom",n.modelPosition="bottom"),a.add(t),o.add(n),t.updateWorldMatrix(!0,!1);let l=new(0,i.Box3)().setFromObject(t),h=new(0,c.OBB)().fromBox3(l);t.width=1*Math.abs(l.max.x-l.min.x).toFixed(2),t.height=1*Math.abs(l.max.y-l.min.y).toFixed(2),t.depth=1*Math.abs(l.max.z-l.min.z).toFixed(2),n.updateWorldMatrix();let d=new(0,i.Box3)().setFromObject(n),u=new(0,c.OBB)().fromBox3(d).center.clone();o.updateMatrixWorld(),o.worldToLocal(u),n.position.copy(u);let p=h.center.clone();a.updateMatrixWorld(),a.worldToLocal(p),t.position.copy(p),t.children.forEach(e=>{e.position.sub(p)}),n.children.forEach(e=>{e.position.sub(u)}),t.modelType="modelGroup",t.modelId=n.uuid,t.param=[n],n.modelId=t.uuid,n.param=[t],n.modelType="2dModelGroup",this.selectObjArr=this.camera.isOrthographicCamera?[n]:[t],this.modelHelperGroup.children=[],this.addBoxForGroup(t),this.addBoxFor2dGroup(n)}explodeGroup(e="3d",t=!0){if(1!=this.selectObjArr.length)return;t&&this.execute(),this.doorHelperGroupClean(),this.modelHelperGroup.children=[];let i=this.getOuterParent(this.selectObjArr[0]),r=i.parent,n=i.children.slice(0);n.forEach(t=>{t.matrixWorld.decompose(t.position,t.quaternion,t.scale),r.add(t),"3d"==e?this.addBoxForGroup(t):this.addBoxFor2dGroup(t)}),i.parent.remove(i);let o="3d"==e?this.get2DModelBy3DModel(i):this.get3DModelBy2DModel(i),a=o.parent;(n=o.children.slice(0)).forEach(t=>{t.matrixWorld.decompose(t.position,t.quaternion,t.scale),a.add(t),"3d"==e?this.addBoxForGroup(t):this.addBoxFor2dGroup(t)}),o.parent.remove(o),this.selectObjArr=[]}setLayers(e,t){e.layers.set(t),e.children&&e.children.slice(0).forEach(e=>{this.setLayers(e,t)})}extendParam(e,t,i=""){for(let i in e)t.hasOwnProperty(i)||(t[i]=e[i]&&e[i].isVector3?e[i].clone():e[i]);if(e.rotation.x!=t.rotation.x&&(t.rotation.x=e.rotation.x,t.rotation.y=e.rotation.y,t.rotation.z=e.rotation.z),""!=i&&(t.param=[i],i.param=[t]),!e.imgPath){let r=0,n=t.children;e.children.slice(0).forEach(e=>{let t="";""!=i&&i.children.forEach(i=>{i.param[0].uuid==e.uuid&&(t=i)}),this.extendParam(e,n[r],t),r++})}}modelCopy(){let e=this.camera.isOrthographicCamera?"2d":"3d";if(""==this.clickSelect||""==this.clickSelect[0].object)return;let t=this.getOuterParent(this.clickSelect[0].object),i=t.clone();if(this.extendParam(t,i),"2d"==e){let e=this.get3DModelBy2DModel(t),r=e.clone();this.extendParam(e,r,i),t.parent.add(i),e.parent.add(r)}else{let e=this.get2DModelBy3DModel(t),r=e.clone();this.extendParam(e,r,i),t.parent.add(i),e.parent.add(r)}this.mouseCoverObj=i}modelReverse(e){let t=this.camera.isOrthographicCamera?"2d":"3d";if(""==this.clickSelect||""==this.clickSelect[0].object)return;let i=this.getOuterParent(this.clickSelect[0].object);"2d"==t?"frontBackTurn"==e?i.scale.y*=-1:i.scale.x*=-1:"frontBackTurn"==e?i.scale.z*=-1:i.scale.x*=-1,this.getRealCenter(i),this.synchroModel(i)}doorSetLock(){if(""!=this.clickSelect&&""!=this.clickSelect[0].object){if("2d"==(this.camera.isOrthographicCamera?"2d":"3d")){let e=this.clickSelect[0].object.parent;e.isLock=!e.isLock,this.doorHelperGroupClean(),this.addLineHelperForDoor(e,!0);let t=this.getWallById(e.wallId);this.partRefreshWall(t)}else{let e=this.clickSelect[0].object,t=this.getOuterParent(e);t.isLock=!t.isLock,t.parameter.tdm.isLock=t.isLock}}}memberSetLock(){if(""!=this.clickSelect&&""!=this.clickSelect[0].object){if("2d"==(this.camera.isOrthographicCamera?"2d":"3d")){let e=this.clickSelect[0].object.parent;e.isLock=!e.isLock,this.doorHelperGroupClean(),e.isLock?this.addPositionHelper(e,!0):this.addLineHelperForMember(e),this.get3DMemberBy2DMember(e).isLock=e.isLock}else{let e=this.clickSelect[0].object;e.isLock=!e.isLock,this.get2DMemberBy3DMember(e).isLock=e.isLock}}}modelHidden(){if(""==this.clickSelect||""==this.clickSelect[0].object)return;this.doorHelperGroupClean(),this.list.hiddenDialog.dispatch(),this.modelHelperGroup.children=[];let e=[];e=1==this.selectObjArr.length?[this.clickSelect[0].object]:this.selectObjArr,this.execute(),e.forEach(e=>{let t=this.getOuterParent(e);if(t.isLock){1==this.selectObjArr.length&&this.list.alert.dispatch("模型已锁定,请先解锁","warning");return}t.visible=!1,t.param[0].visible=!1;let i=t.modelPosition;t.modelPosition||(i=t.param[0].modelPosition),"bottom"==i?this.config.settingJson.showFloorFurniture=!1:"top"==i?this.config.settingJson.showCeilFurniture=!1:this.config.settingJson.showWallFurniture=!1}),this.list.getShowHiddenFlag.dispatch(JSON.stringify(this.config.settingJson),!1)}modelSetLock(){if(""==this.selectObjArr||0==this.selectObjArr.length)return;let e=this.camera.isOrthographicCamera?"2d":"3d",t=!0;this.selectObjArr.forEach(e=>{this.getOuterParent(e).isLock||(t=!1)}),this.selectObjArr.forEach(i=>{let r=this.getOuterParent(i);r.isLock=!t,"2d"==e?(this.get3DModelBy2DModel(r).isLock=r.isLock,this.doorHelperGroupClean(),this.addPositionHelper(r,!0)):(this.get2DModelBy3DModel(r).isLock=r.isLock,new(0,w.Model3DHelper)(this).selectObj([r]))})}door3DCopy(){if(""==this.clickSelect||""==this.clickSelect[0].object)return;let e=this.getOuterParent(this.clickSelect[0].object),t=this.codeModelCopy(e),i=e.parameter.tdm,r=i.clone();for(let i in e)t.hasOwnProperty(i)||(t[i]=e[i]&&e[i].isVector3?e[i].clone():e[i]);for(let e in i)r.hasOwnProperty(e)||(r[e]=i[e]&&i[e].isVector3?i[e].clone():i[e]);r.name="copy",t.parameter.tdm=r,this.wallGroup3D.add(t),this.scene.add(r),this.otherMeshs.push(r),new(0,b.ThreeDimensionMoveHelper)(this,t).selectObj(this.clickSelect[0].object)}modelReplace(){if(""==this.clickSelect||""==this.clickSelect[0].object)return;let e=this.getOuterParent(this.clickSelect[0].object);if(e.modelRealType){let t=e.modelRealType;this.list.modelReplace.dispatch(t)}}modelFloat(e){if(""==this.clickSelect||""==this.clickSelect[0].object)return;let t=this.getOuterParent(this.clickSelect[0].object),i=[0,0];this.getTopModePosition(t.parent,t.parent,i);let r=.002;"topFloat"==e?t.position.z=i[0]+r:(t.position.z=i[1]-r,t.position.z<=-.1&&(t.position.z=-.1))}modelReplaceMain(e){if(""==this.clickSelect||""==this.clickSelect[0].object)return;let t=this.getOuterParent(this.clickSelect[0].object);this.modelReplaceCore(t,e);let i="",r="";this.camera.isOrthographicCamera?(i=this.get3DModelBy2DModel(t),r=this.get3DModelBy2DModel(e)):(i=this.get2DModelBy3DModel(t),r=this.get2DModelBy3DModel(e)),i&&r&&this.modelReplaceCore(i,r),this.clickSelect[0].object=e,this.camera.isOrthographicCamera?this.addLineHelperForMember(e):new(0,w.Model3DHelper)(this).selectObj([e]),this.updateModelPosition(e.parent,e)}modelReplaceCore(e,t,r="position"){for(let i in e.parent.add(t),e)t.hasOwnProperty(i)||(t[i]=e[i]&&e[i].isVector3?e[i].clone():e[i]);t.position.copy(e.position);var n=new i.Box3;n.setFromObject(t);let o=1*(n.max.x-n.min.x).toFixed(2),a=1*(n.max.y-n.min.y).toFixed(2),s=1*(n.max.z-n.min.z).toFixed(2);if("position"==r){if(0!=s){let i=t.modelPosition,r=a-e.height*e.scale.y;"top"==i?t.position.y-=r/2:t.position.y+=r/2}}else t.scale.set(e.width*e.scale.x/o,e.height*e.scale.y/a,e.depth*e.scale.z/s),0==s&&(t.scale.z=1);t.rotation.copy(e.rotation),e.parent.remove(e)}cleanInterval(e){let t="";if(editor.model3D.children.forEach(e=>{let i=e.position;9999==i.x&&9999==i.z&&(t=e)}),!t||!t.param&&"localPath"==t.imgPath||"Line2"==t.type)return;let i="";i=editor.camera.isOrthographicCamera?editor.get2DModelBy3DModel(t):t,"load"==e?editor.mouseCoverObj=i:this.camera.isOrthographicCamera?this.modelReplaceMain(this.get2DModelBy3DModel(t)):this.modelReplaceMain(t),clearInterval(window.intervalClear)}loadGLTFJsonCore(e,t){let i=e.Products;i[0].location={x:9999,y:9999,z:9999},editor.recoveModel(i),window.intervalClear=setInterval(()=>{this.cleanInterval(t)},100)}get3DModelPoint(e){let t=[new i.Vector3(0,0,e.depth/2),new i.Vector3(0,0,-e.depth/2),new i.Vector3(-e.width/2,0,0),new i.Vector3(e.width/2,0,0),new i.Vector3(0,e.height/2,0),new i.Vector3(0,-e.height/2,0)];e.updateWorldMatrix(!0,!1);for(let i=0;i<t.length;i++){let r=e.localToWorld(t[i]);t[i]=r}return t}getFinalPoint(e,t){let i=t[0];return t.forEach(t=>{"X"==e&&t.x>i.x&&(i=t),"-X"==e&&t.x<i.x&&(i=t),"Y"==e&&t.z>i.z&&(i=t),"-Y"==e&&t.z<i.z&&(i=t),"Z"==e&&t.y>i.y&&(i=t),"-Z"==e&&t.y<i.y&&(i=t)}),i}modelAlign(e,t){let r=t[0],n=new i.Vector3(0,0,r.depth/2),o=new i.Vector3(0,0,-r.depth/2),a=new i.Vector3(-r.width/2,0,0),s=new i.Vector3(r.width/2,0,0),l=new i.Vector3(0,r.height/2,0),h=new i.Vector3(0,-r.height/2,0);[n,o,a,s,l,h].forEach(e=>{r.localToWorld(e)});let c=new(0,i.Vector2)(n.x,n.z).sub(new i.Vector2(o.x,o.z)).angle(),d="";c>=0&&c<=Math.PI/4||c>7/4*Math.PI&&c<=2*Math.PI?d="X":c>Math.PI/4&&c<=3*Math.PI/4?d="Y":c>3*Math.PI/4&&c<=5*Math.PI/4?d="-X":c>5*Math.PI/4&&c<=7/4*Math.PI&&(d="-Y"),t.shift(),t.forEach(t=>{let c=t,u=this.get3DModelPoint(c),p="",m="",f="",g="";if("frontAligning"==e){p="X"==d||"-X"==d?"X":"Y",f=n;let e={X:"X","-X":"-X",Y:"Y","-Y":"-Y"};g=this.getFinalPoint(e[d],u)}else if("rearAligning"==e){p="X"==d||"-X"==d?"X":"Y",f=o;let e={X:"-X","-X":"X",Y:"-Y","-Y":"Y"};g=this.getFinalPoint(e[d],u)}else if("leftAligning"==e){f=a,p="X"==d||"-X"==d?"Y":"X";let e={X:"-Y","-X":"Y",Y:"-X","-Y":"X"};g=this.getFinalPoint(e[d],u)}else if("rightAligning"==e){f=s,p="X"==d||"-X"==d?"Y":"X";let e={X:"Y","-X":"-Y",Y:"X","-Y":"-X"};g=this.getFinalPoint(e[d],u)}else"topAligning"==e?(p="Z",g=this.getFinalPoint("Z",u),f=l):"bottomAligning"==e?(p="Z",g=this.getFinalPoint("-Z",u),f=h):"frontAndBackAligning"==e?(p="X"==d||"-X"==d?"X":"Y",f=r.position.clone(),g=c.position.clone()):"leftRightAligning"==e?(p="X"==d||"-X"==d?"Y":"X",f=r.position.clone(),g=c.position.clone()):"topBottomAligning"==e&&(p="Z",f=r.position.clone(),g=c.position.clone());c.updateMatrixWorld(!0);let y=new i.Vector3;c.getWorldPosition(y),"X"==p?(m=f.x-g.x,y.x+=m):"Y"==p?(m=f.z-g.z,y.z+=m):(m=f.y-g.y,y.y+=m),c.parent.worldToLocal(y),c.position.copy(y),this.synchroModel(c),this.updateModelPosition(c.param[0].parent,c.param[0])}),this.modelHelperGroup.children=[],this.doorHelperGroupClean(),t.push(r),t.forEach(e=>{let t=e,i=this.get2DModelBy3DModel(t);this.addBoxFor2dGroup(i);let r=this.wallHelp.addOBBbox(t,this.config.boxColor);r.name="modelBox",r.layers.set(2),this.modelHelperGroup.add(r)})}exportModelJson(e){return{meta:{version:"0.1",origin:"",magic:"",unit:"mm"},boundingBox:{xLen:1e3*(e.width*e.scale.x).toFixed(2),yLen:1e3*(e.height*e.scale.y).toFixed(2),zLen:1e3*(e.depth*e.scale.z).toFixed(2)},Products:(0,d.DM).getModelJson([e])}}getSceneCenter(){this.cameraScene.children=[];let e=new i.Group,t=new(0,i.Matrix4)().makeScale(.001,.001,.001),r=new i.Group;r.applyMatrix4(t);let n=new i.Group,o=new i.Group;o.applyMatrix4(t),e.add(r,n,o),this.wallGroup3D.children.slice(0).forEach(e=>{"3DWall"==e.modelType&&r.add(e.clone())}),r.rotation.x=-Math.PI/2,o.rotation.x=-Math.PI/2,this.model3D.children.slice(0).forEach(e=>{n.add(e.clone())}),this.memberGroup3D.children.slice(0).forEach(e=>{o.add(e.clone())});let a=new(0,i.Box3)().setFromObject(e);e.position.set(0,0,0);let s=new i.Vector3;a.getCenter(s);let l=a.max.x-a.min.x,h=a.max.y-a.min.y,c=a.max.z-a.min.z;return[s=new i.Vector3(1*s.x.toFixed(3),1*s.y.toFixed(3),1*s.z.toFixed(3)),l,h,c,a]}rotatePoint(e,t,i){var r=t.x,n=t.y,o=e.x,a=e.y;return{x:r+(o-r)*Math.cos(i*Math.PI/180)-(a-n)*Math.sin(i*Math.PI/180),y:n+(o-r)*Math.sin(i*Math.PI/180)+(a-n)*Math.cos(i*Math.PI/180)}}setCurrentCamera(e){"+"!=e&&"-"!=e&&"*"!=e&&"/"!=e&&(e*=1);let t=900,r=600,n=this.getSceneCenter(),o=n[0],a=this.camera.position.clone();a=new i.Vector3(1*a.x.toFixed(3),1*a.y.toFixed(3),1*a.z.toFixed(3));let s=this.camera.zoom;var l=new i.Vector3;this.camera.getWorldDirection(l);let h=10,c=Math.PI/180*15;switch(e){case 1:this.camera.position.set(o.x,o.y,h);break;case 2:case 8:h=a.distanceTo(o);let d=a.clone().sub(o),u=d.clone();u.y=0;let p=d.angleTo(u);o.y>a.y&&(p*=-1),this.camera.oldRotDir&&(p=this.camera.oldRotDir)<-(2*Math.PI)&&(p+=2*Math.PI),this.camera.oldRotDir=p-c;let m=h*Math.sin(p-c);m+=o.y;let f=h*Math.cos(p-c),g=new i.Vector2(o.x,o.z),y=new i.Vector2(a.x,a.z),x=y.clone().sub(g);0!=x.x||0!=x.y||this.camera.cameraRotDir||(x=y.clone().sub(new i.Vector2(o.x,o.z-10))),this.camera.cameraRotDir?x=this.camera.cameraRotDir.clone():this.camera.cameraRotDir=x.clone();let w=x.setLength(f);w.x+=o.x,w.y+=o.z,this.camera.position.set(w.x,m,w.y);break;case 3:let b=new(0,i.Vector2)(a.x,a.z).sub(new i.Vector2(o.x,o.z)).angle(),M=this.rotatePoint(new i.Vector2(a.x,a.z),new i.Vector2(o.x,o.z),-(180*b)/Math.PI);this.camera.position.set(M.x,a.y,M.y);break;case 4:let S=this.rotatePoint(new i.Vector2(a.x,a.z),new i.Vector2(o.x,o.z),10);this.camera.position.set(S.x,a.y,S.y);break;case 5:break;case 6:let P=this.rotatePoint(new i.Vector2(a.x,a.z),new i.Vector2(o.x,o.z),-10);this.camera.position.set(P.x,a.y,P.y);break;case 7:this.camera.position.set(o.x,h,o.z);break;case 9:let T=this.rotatePoint(new i.Vector2(a.x,a.z),new i.Vector2(o.x,o.z),180);this.camera.position.set(T.x,a.y,T.y);break;case 0:let _=new(0,i.Vector2)(o.x,o.z).add(new(0,i.Vector2)(1,1).setLength(15));document.querySelector("#cameraShot_box")?(this.camera.position.copy(this.camera.oldPos),this.grid3d.visible=!0):(this.camera.oldPos=this.camera.position.clone(),this.camera.position.set(_.x,o.y+15,_.y),this.grid3d.visible=!1);break;case"+":case"-":let C=.855,D=this.controlsArr[1];"+"==e?D.object.zoom=Math.max(D.minZoom,Math.min(D.maxZoom,D.object.zoom/C)):D.object.zoom=Math.max(D.minZoom,Math.min(D.maxZoom,D.object.zoom*C))}if(this.camera.lookAt(o),this.camera.aspect=window.innerWidth/window.innerHeight,"+"!=e&&"-"!=e&&(this.camera.zoom=s),1==e||3==e||7==e||9==e||0==e){let e=new v.Tween({x:a.x,y:a.y,z:a.z});e.onUpdate(e=>{this.camera.position.set(e.x,e.y,e.z)});let t=this.camera.position.clone(),i=a.distanceTo(t)/.2/3;e.to({x:t.x,y:t.y,z:t.z},10*i).start()}if(this.camera.updateProjectionMatrix(),this.controlsArr[1].target.copy(o),this.controlsArr[1].update(),0==e){if(document.querySelector("#cameraShot_box"))this.list.cameraShot.dispatch(t,r);else{let e=n[4],o=[new i.Vector3(e.min.x,0,e.max.z),new i.Vector3(e.max.x,0,e.max.z),new i.Vector3(e.max.x,0,e.min.z),new i.Vector3(e.min.x,0,e.min.z),new i.Vector3(e.min.x,n[2],e.max.z),new i.Vector3(e.max.x,n[2],e.max.z),new i.Vector3(e.max.x,n[2],e.min.z),new i.Vector3(e.min.x,n[2],e.min.z)],a=[],s=[];o.forEach(e=>{let t=this.getScreen(e,this.camera);a.push(t[0]),s.push(t[1])});let l=Math.min(...s),h=Math.max(...s),c=Math.min(...a),d=20,u=20;t=Math.max(...a)-c+20,r=h-l+u,this.list.cameraShot.dispatch(t,r,c-d/2,l-u/2)}}this.updateDom()}getRenderCameraAngle(){let e=editor.renderViewControl.target.clone().sub(editor.renderViewCamera.position),t=(0,o.UtilCore).calculateAngleWithHorizontalPlane(e);if(!isNaN(t))return this.renderViewCamera.position.y<editor.renderViewControl.target.y&&(t*=-1),t>=-5*Math.PI/180&&t<=5*Math.PI/180&&(t=0),Math.round(180*t/Math.PI)}add3DDoorDialog(e){let t=this.getOuterParent(e);this.transform3DTool&&"ThreeDimensionMoveHelper"==this.transform3DTool.name&&this.transform3DTool.removeEventListener(),this.transform3DTool=new b.ThreeDimensionMoveHelper(this),this.transform3DTool.selectObj(e);let i=t.parameter.tdm,r=this.get3DModelDialogPosition(t,30),n=[Math.abs(Math.round(i.doorWid*i.scale.x)),Math.round(i.height),Math.round(i.wallDep),i.floorHei,{isLock:i.isLock}],o=12;i.modelType.toLowerCase().indexOf("window")>=0&&(o=15);let a=this.config.modelTypeJson[i.modelType];this.list.showDialog.dispatch(o,a,r,n)}getPointScale(){let e=1;return(e=1-(this.camera.zoom-1)/5)<.25&&(e=.25),e}}}),parcelRequire.register("4xklQ",function(e,t){let i,r,n,o,a;$parcel$export(e.exports,"REVISION",()=>s),$parcel$export(e.exports,"MOUSE",()=>l),$parcel$export(e.exports,"TOUCH",()=>h),$parcel$export(e.exports,"CullFaceNone",()=>c),$parcel$export(e.exports,"CullFaceBack",()=>d),$parcel$export(e.exports,"CullFaceFront",()=>u),$parcel$export(e.exports,"CullFaceFrontBack",()=>p),$parcel$export(e.exports,"BasicShadowMap",()=>m),$parcel$export(e.exports,"PCFShadowMap",()=>f),$parcel$export(e.exports,"PCFSoftShadowMap",()=>g),$parcel$export(e.exports,"VSMShadowMap",()=>y),$parcel$export(e.exports,"FrontSide",()=>x),$parcel$export(e.exports,"BackSide",()=>w),$parcel$export(e.exports,"DoubleSide",()=>b),$parcel$export(e.exports,"NoBlending",()=>v),$parcel$export(e.exports,"NormalBlending",()=>M),$parcel$export(e.exports,"AdditiveBlending",()=>S),$parcel$export(e.exports,"SubtractiveBlending",()=>P),$parcel$export(e.exports,"MultiplyBlending",()=>T),$parcel$export(e.exports,"CustomBlending",()=>_),$parcel$export(e.exports,"AddEquation",()=>C),$parcel$export(e.exports,"SubtractEquation",()=>D),$parcel$export(e.exports,"ReverseSubtractEquation",()=>A),$parcel$export(e.exports,"MinEquation",()=>E),$parcel$export(e.exports,"MaxEquation",()=>L),$parcel$export(e.exports,"ZeroFactor",()=>I),$parcel$export(e.exports,"OneFactor",()=>R),$parcel$export(e.exports,"SrcColorFactor",()=>W),$parcel$export(e.exports,"OneMinusSrcColorFactor",()=>V),$parcel$export(e.exports,"SrcAlphaFactor",()=>k),$parcel$export(e.exports,"OneMinusSrcAlphaFactor",()=>B),$parcel$export(e.exports,"DstAlphaFactor",()=>O),$parcel$export(e.exports,"OneMinusDstAlphaFactor",()=>F),$parcel$export(e.exports,"DstColorFactor",()=>z),$parcel$export(e.exports,"OneMinusDstColorFactor",()=>U),$parcel$export(e.exports,"SrcAlphaSaturateFactor",()=>N),$parcel$export(e.exports,"NeverDepth",()=>G),$parcel$export(e.exports,"AlwaysDepth",()=>H),$parcel$export(e.exports,"LessDepth",()=>j),$parcel$export(e.exports,"LessEqualDepth",()=>q),$parcel$export(e.exports,"EqualDepth",()=>X),$parcel$export(e.exports,"GreaterEqualDepth",()=>Y),$parcel$export(e.exports,"GreaterDepth",()=>J),$parcel$export(e.exports,"NotEqualDepth",()=>Z),$parcel$export(e.exports,"MultiplyOperation",()=>Q),$parcel$export(e.exports,"MixOperation",()=>K),$parcel$export(e.exports,"AddOperation",()=>ee),$parcel$export(e.exports,"NoToneMapping",()=>et),$parcel$export(e.exports,"LinearToneMapping",()=>ei),$parcel$export(e.exports,"ReinhardToneMapping",()=>er),$parcel$export(e.exports,"CineonToneMapping",()=>en),$parcel$export(e.exports,"ACESFilmicToneMapping",()=>eo),$parcel$export(e.exports,"CustomToneMapping",()=>ea),$parcel$export(e.exports,"UVMapping",()=>es),$parcel$export(e.exports,"CubeReflectionMapping",()=>el),$parcel$export(e.exports,"CubeRefractionMapping",()=>eh),$parcel$export(e.exports,"EquirectangularReflectionMapping",()=>ec),$parcel$export(e.exports,"EquirectangularRefractionMapping",()=>ed),$parcel$export(e.exports,"CubeUVReflectionMapping",()=>eu),$parcel$export(e.exports,"RepeatWrapping",()=>ep),$parcel$export(e.exports,"ClampToEdgeWrapping",()=>em),$parcel$export(e.exports,"MirroredRepeatWrapping",()=>ef),$parcel$export(e.exports,"NearestFilter",()=>eg),$parcel$export(e.exports,"NearestMipmapNearestFilter",()=>ey),$parcel$export(e.exports,"NearestMipMapNearestFilter",()=>ex),$parcel$export(e.exports,"NearestMipmapLinearFilter",()=>ew),$parcel$export(e.exports,"NearestMipMapLinearFilter",()=>eb),$parcel$export(e.exports,"LinearFilter",()=>ev),$parcel$export(e.exports,"LinearMipmapNearestFilter",()=>eM),$parcel$export(e.exports,"LinearMipMapNearestFilter",()=>eS),$parcel$export(e.exports,"LinearMipmapLinearFilter",()=>eP),$parcel$export(e.exports,"LinearMipMapLinearFilter",()=>eT),$parcel$export(e.exports,"UnsignedByteType",()=>e_),$parcel$export(e.exports,"ByteType",()=>eC),$parcel$export(e.exports,"ShortType",()=>eD),$parcel$export(e.exports,"UnsignedShortType",()=>eA),$parcel$export(e.exports,"IntType",()=>eE),$parcel$export(e.exports,"UnsignedIntType",()=>eL),$parcel$export(e.exports,"FloatType",()=>eI),$parcel$export(e.exports,"HalfFloatType",()=>eR),$parcel$export(e.exports,"UnsignedShort4444Type",()=>eW),$parcel$export(e.exports,"UnsignedShort5551Type",()=>eV),$parcel$export(e.exports,"UnsignedInt248Type",()=>ek),$parcel$export(e.exports,"AlphaFormat",()=>eB),$parcel$export(e.exports,"RGBFormat",()=>eO),$parcel$export(e.exports,"RGBAFormat",()=>eF),$parcel$export(e.exports,"LuminanceFormat",()=>ez),$parcel$export(e.exports,"LuminanceAlphaFormat",()=>eU),$parcel$export(e.exports,"DepthFormat",()=>eN),$parcel$export(e.exports,"DepthStencilFormat",()=>eG),$parcel$export(e.exports,"RedFormat",()=>eH),$parcel$export(e.exports,"RedIntegerFormat",()=>ej),$parcel$export(e.exports,"RGFormat",()=>eq),$parcel$export(e.exports,"RGIntegerFormat",()=>eX),$parcel$export(e.exports,"RGBAIntegerFormat",()=>eY),$parcel$export(e.exports,"RGB_S3TC_DXT1_Format",()=>eJ),$parcel$export(e.exports,"RGBA_S3TC_DXT1_Format",()=>eZ),$parcel$export(e.exports,"RGBA_S3TC_DXT3_Format",()=>eQ),$parcel$export(e.exports,"RGBA_S3TC_DXT5_Format",()=>eK),$parcel$export(e.exports,"RGB_PVRTC_4BPPV1_Format",()=>e$),$parcel$export(e.exports,"RGB_PVRTC_2BPPV1_Format",()=>e0),$parcel$export(e.exports,"RGBA_PVRTC_4BPPV1_Format",()=>e1),$parcel$export(e.exports,"RGBA_PVRTC_2BPPV1_Format",()=>e2),$parcel$export(e.exports,"RGB_ETC1_Format",()=>e4),$parcel$export(e.exports,"RGB_ETC2_Format",()=>e5),$parcel$export(e.exports,"RGBA_ETC2_EAC_Format",()=>e6),$parcel$export(e.exports,"RGBA_ASTC_4x4_Format",()=>e9),$parcel$export(e.exports,"RGBA_ASTC_5x4_Format",()=>e8),$parcel$export(e.exports,"RGBA_ASTC_5x5_Format",()=>e7),$parcel$export(e.exports,"RGBA_ASTC_6x5_Format",()=>te),$parcel$export(e.exports,"RGBA_ASTC_6x6_Format",()=>tt),$parcel$export(e.exports,"RGBA_ASTC_8x5_Format",()=>ti),$parcel$export(e.exports,"RGBA_ASTC_8x6_Format",()=>tr),$parcel$export(e.exports,"RGBA_ASTC_8x8_Format",()=>tn),$parcel$export(e.exports,"RGBA_ASTC_10x5_Format",()=>to),$parcel$export(e.exports,"RGBA_ASTC_10x6_Format",()=>ta),$parcel$export(e.exports,"RGBA_ASTC_10x8_Format",()=>ts),$parcel$export(e.exports,"RGBA_ASTC_10x10_Format",()=>tl),$parcel$export(e.exports,"RGBA_ASTC_12x10_Format",()=>th),$parcel$export(e.exports,"RGBA_ASTC_12x12_Format",()=>tc),$parcel$export(e.exports,"RGBA_BPTC_Format",()=>td),$parcel$export(e.exports,"LoopOnce",()=>tu),$parcel$export(e.exports,"LoopRepeat",()=>tp),$parcel$export(e.exports,"LoopPingPong",()=>tm),$parcel$export(e.exports,"InterpolateDiscrete",()=>tf),$parcel$export(e.exports,"InterpolateLinear",()=>tg),$parcel$export(e.exports,"InterpolateSmooth",()=>ty),$parcel$export(e.exports,"ZeroCurvatureEnding",()=>tx),$parcel$export(e.exports,"ZeroSlopeEnding",()=>tw),$parcel$export(e.exports,"WrapAroundEnding",()=>tb),$parcel$export(e.exports,"NormalAnimationBlendMode",()=>tv),$parcel$export(e.exports,"AdditiveAnimationBlendMode",()=>tM),$parcel$export(e.exports,"TrianglesDrawMode",()=>tS),$parcel$export(e.exports,"TriangleStripDrawMode",()=>tP),$parcel$export(e.exports,"TriangleFanDrawMode",()=>tT),$parcel$export(e.exports,"LinearEncoding",()=>t_),$parcel$export(e.exports,"sRGBEncoding",()=>tC),$parcel$export(e.exports,"BasicDepthPacking",()=>tD),$parcel$export(e.exports,"RGBADepthPacking",()=>tA),$parcel$export(e.exports,"TangentSpaceNormalMap",()=>tE),$parcel$export(e.exports,"ObjectSpaceNormalMap",()=>tL),$parcel$export(e.exports,"NoColorSpace",()=>tI),$parcel$export(e.exports,"SRGBColorSpace",()=>tR),$parcel$export(e.exports,"LinearSRGBColorSpace",()=>tW),$parcel$export(e.exports,"ZeroStencilOp",()=>tV),$parcel$export(e.exports,"KeepStencilOp",()=>tk),$parcel$export(e.exports,"ReplaceStencilOp",()=>tB),$parcel$export(e.exports,"IncrementStencilOp",()=>tO),$parcel$export(e.exports,"DecrementStencilOp",()=>tF),$parcel$export(e.exports,"IncrementWrapStencilOp",()=>tz),$parcel$export(e.exports,"DecrementWrapStencilOp",()=>tU),$parcel$export(e.exports,"InvertStencilOp",()=>tN),$parcel$export(e.exports,"NeverStencilFunc",()=>tG),$parcel$export(e.exports,"LessStencilFunc",()=>tH),$parcel$export(e.exports,"EqualStencilFunc",()=>tj),$parcel$export(e.exports,"LessEqualStencilFunc",()=>tq),$parcel$export(e.exports,"GreaterStencilFunc",()=>tX),$parcel$export(e.exports,"NotEqualStencilFunc",()=>tY),$parcel$export(e.exports,"GreaterEqualStencilFunc",()=>tJ),$parcel$export(e.exports,"AlwaysStencilFunc",()=>tZ),$parcel$export(e.exports,"StaticDrawUsage",()=>tQ),$parcel$export(e.exports,"DynamicDrawUsage",()=>tK),$parcel$export(e.exports,"StreamDrawUsage",()=>t$),$parcel$export(e.exports,"StaticReadUsage",()=>t0),$parcel$export(e.exports,"DynamicReadUsage",()=>t1),$parcel$export(e.exports,"StreamReadUsage",()=>t2),$parcel$export(e.exports,"StaticCopyUsage",()=>t3),$parcel$export(e.exports,"DynamicCopyUsage",()=>t5),$parcel$export(e.exports,"StreamCopyUsage",()=>t6),$parcel$export(e.exports,"GLSL1",()=>t9),$parcel$export(e.exports,"GLSL3",()=>t8),$parcel$export(e.exports,"_SRGBAFormat",()=>t7),$parcel$export(e.exports,"EventDispatcher",()=>ie),$parcel$export(e.exports,"MathUtils",()=>ib),$parcel$export(e.exports,"Vector2",()=>iv),$parcel$export(e.exports,"Matrix3",()=>iM),$parcel$export(e.exports,"ColorManagement",()=>iE),$parcel$export(e.exports,"Color",()=>iB),$parcel$export(e.exports,"ImageUtils",()=>iO),$parcel$export(e.exports,"Source",()=>iF),$parcel$export(e.exports,"Texture",()=>iN),$parcel$export(e.exports,"Vector4",()=>iG),$parcel$export(e.exports,"WebGLRenderTarget",()=>iH),$parcel$export(e.exports,"DataArrayTexture",()=>ij),$parcel$export(e.exports,"WebGLArrayRenderTarget",()=>iq),$parcel$export(e.exports,"Data3DTexture",()=>iX),$parcel$export(e.exports,"WebGL3DRenderTarget",()=>iY),$parcel$export(e.exports,"WebGLMultipleRenderTargets",()=>iJ),$parcel$export(e.exports,"Quaternion",()=>iZ),$parcel$export(e.exports,"Vector3",()=>iQ),$parcel$export(e.exports,"Box3",()=>i0),$parcel$export(e.exports,"Sphere",()=>rc),$parcel$export(e.exports,"Ray",()=>rx),$parcel$export(e.exports,"Matrix4",()=>rw),$parcel$export(e.exports,"Euler",()=>rA),$parcel$export(e.exports,"Layers",()=>rE),$parcel$export(e.exports,"Object3D",()=>rH),$parcel$export(e.exports,"Triangle",()=>r1),$parcel$export(e.exports,"Material",()=>r3),$parcel$export(e.exports,"MeshBasicMaterial",()=>r4),$parcel$export(e.exports,"BufferAttribute",()=>r8),$parcel$export(e.exports,"Int8BufferAttribute",()=>r7),$parcel$export(e.exports,"Uint8BufferAttribute",()=>ne),$parcel$export(e.exports,"Uint8ClampedBufferAttribute",()=>nt),$parcel$export(e.exports,"Int16BufferAttribute",()=>ni),$parcel$export(e.exports,"Uint16BufferAttribute",()=>nr),$parcel$export(e.exports,"Int32BufferAttribute",()=>nn),$parcel$export(e.exports,"Uint32BufferAttribute",()=>no),$parcel$export(e.exports,"Float16BufferAttribute",()=>na),$parcel$export(e.exports,"Float32BufferAttribute",()=>ns),$parcel$export(e.exports,"Float64BufferAttribute",()=>nl),$parcel$export(e.exports,"BufferGeometry",()=>ng),$parcel$export(e.exports,"Mesh",()=>nW),$parcel$export(e.exports,"BoxGeometry",()=>nB),$parcel$export(e.exports,"UniformsUtils",()=>nU),$parcel$export(e.exports,"ShaderMaterial",()=>nH),$parcel$export(e.exports,"Camera",()=>nj),$parcel$export(e.exports,"PerspectiveCamera",()=>nq),$parcel$export(e.exports,"CubeCamera",()=>nJ),$parcel$export(e.exports,"CubeTexture",()=>nZ),$parcel$export(e.exports,"WebGLCubeRenderTarget",()=>nQ),$parcel$export(e.exports,"Plane",()=>n2),$parcel$export(e.exports,"Frustum",()=>n5),$parcel$export(e.exports,"PlaneGeometry",()=>n8),$parcel$export(e.exports,"ShaderChunk",()=>sd),$parcel$export(e.exports,"UniformsLib",()=>su),$parcel$export(e.exports,"ShaderLib",()=>sp),$parcel$export(e.exports,"OrthographicCamera",()=>sb),$parcel$export(e.exports,"PMREMGenerator",()=>sE),$parcel$export(e.exports,"MeshDepthMaterial",()=>hS),$parcel$export(e.exports,"MeshDistanceMaterial",()=>hP),$parcel$export(e.exports,"WebGLUtils",()=>hE),$parcel$export(e.exports,"ArrayCamera",()=>hL),$parcel$export(e.exports,"Group",()=>hI),$parcel$export(e.exports,"DepthTexture",()=>hV),$parcel$export(e.exports,"WebGLRenderer",()=>hz),$parcel$export(e.exports,"WebGL1Renderer",()=>hU),$parcel$export(e.exports,"FogExp2",()=>hN),$parcel$export(e.exports,"Fog",()=>hG),$parcel$export(e.exports,"Scene",()=>hH),$parcel$export(e.exports,"InterleavedBuffer",()=>hj),$parcel$export(e.exports,"InterleavedBufferAttribute",()=>hX),$parcel$export(e.exports,"SpriteMaterial",()=>hY),$parcel$export(e.exports,"Sprite",()=>h8),$parcel$export(e.exports,"LOD",()=>ci),$parcel$export(e.exports,"SkinnedMesh",()=>cl),$parcel$export(e.exports,"Bone",()=>ch),$parcel$export(e.exports,"DataTexture",()=>cc),$parcel$export(e.exports,"Skeleton",()=>cp),$parcel$export(e.exports,"InstancedBufferAttribute",()=>cm),$parcel$export(e.exports,"InstancedMesh",()=>cw),$parcel$export(e.exports,"LineBasicMaterial",()=>cb),$parcel$export(e.exports,"Line",()=>c_),$parcel$export(e.exports,"LineSegments",()=>cA),$parcel$export(e.exports,"LineLoop",()=>cE),$parcel$export(e.exports,"PointsMaterial",()=>cL),$parcel$export(e.exports,"Points",()=>ck),$parcel$export(e.exports,"VideoTexture",()=>cO),$parcel$export(e.exports,"FramebufferTexture",()=>cF),$parcel$export(e.exports,"CompressedTexture",()=>cz),$parcel$export(e.exports,"CanvasTexture",()=>cU),$parcel$export(e.exports,"Curve",()=>cN),$parcel$export(e.exports,"EllipseCurve",()=>cG),$parcel$export(e.exports,"ArcCurve",()=>cH),$parcel$export(e.exports,"CatmullRomCurve3",()=>cZ),$parcel$export(e.exports,"CubicBezierCurve",()=>c8),$parcel$export(e.exports,"CubicBezierCurve3",()=>c7),$parcel$export(e.exports,"LineCurve",()=>de),$parcel$export(e.exports,"LineCurve3",()=>dt),$parcel$export(e.exports,"QuadraticBezierCurve",()=>di),$parcel$export(e.exports,"QuadraticBezierCurve3",()=>dr),$parcel$export(e.exports,"SplineCurve",()=>dn),$parcel$export(e.exports,"CurvePath",()=>ds),$parcel$export(e.exports,"Path",()=>dl),$parcel$export(e.exports,"LatheGeometry",()=>dh),$parcel$export(e.exports,"CapsuleGeometry",()=>dc),$parcel$export(e.exports,"CircleGeometry",()=>dd),$parcel$export(e.exports,"CylinderGeometry",()=>du),$parcel$export(e.exports,"ConeGeometry",()=>dp),$parcel$export(e.exports,"PolyhedronGeometry",()=>dm),$parcel$export(e.exports,"DodecahedronGeometry",()=>df),$parcel$export(e.exports,"EdgesGeometry",()=>db),$parcel$export(e.exports,"Shape",()=>dv),$parcel$export(e.exports,"ShapeUtils",()=>d0),$parcel$export(e.exports,"ExtrudeGeometry",()=>d3),$parcel$export(e.exports,"IcosahedronGeometry",()=>d6),$parcel$export(e.exports,"OctahedronGeometry",()=>d9),$parcel$export(e.exports,"RingGeometry",()=>d8),$parcel$export(e.exports,"ShapeGeometry",()=>ue),$parcel$export(e.exports,"SphereGeometry",()=>ui),$parcel$export(e.exports,"TetrahedronGeometry",()=>ur),$parcel$export(e.exports,"TorusGeometry",()=>un),$parcel$export(e.exports,"TorusKnotGeometry",()=>uo),$parcel$export(e.exports,"TubeGeometry",()=>ua),$parcel$export(e.exports,"WireframeGeometry",()=>us),$parcel$export(e.exports,"ShadowMaterial",()=>uc),$parcel$export(e.exports,"RawShaderMaterial",()=>ud),$parcel$export(e.exports,"MeshStandardMaterial",()=>uu),$parcel$export(e.exports,"MeshPhysicalMaterial",()=>up),$parcel$export(e.exports,"MeshPhongMaterial",()=>um),$parcel$export(e.exports,"MeshToonMaterial",()=>uf),$parcel$export(e.exports,"MeshNormalMaterial",()=>ug),$parcel$export(e.exports,"MeshLambertMaterial",()=>uy),$parcel$export(e.exports,"MeshMatcapMaterial",()=>ux),$parcel$export(e.exports,"LineDashedMaterial",()=>uw),$parcel$export(e.exports,"AnimationUtils",()=>uD),$parcel$export(e.exports,"Interpolant",()=>uA),$parcel$export(e.exports,"CubicInterpolant",()=>uE),$parcel$export(e.exports,"LinearInterpolant",()=>uL),$parcel$export(e.exports,"DiscreteInterpolant",()=>uI),$parcel$export(e.exports,"KeyframeTrack",()=>uR),$parcel$export(e.exports,"BooleanKeyframeTrack",()=>uW),$parcel$export(e.exports,"ColorKeyframeTrack",()=>uV),$parcel$export(e.exports,"NumberKeyframeTrack",()=>uk),$parcel$export(e.exports,"QuaternionLinearInterpolant",()=>uB),$parcel$export(e.exports,"QuaternionKeyframeTrack",()=>uO),$parcel$export(e.exports,"StringKeyframeTrack",()=>uF),$parcel$export(e.exports,"VectorKeyframeTrack",()=>uz),$parcel$export(e.exports,"AnimationClip",()=>uU),$parcel$export(e.exports,"Cache",()=>uH),$parcel$export(e.exports,"LoadingManager",()=>uj),$parcel$export(e.exports,"DefaultLoadingManager",()=>uq),$parcel$export(e.exports,"Loader",()=>uX),$parcel$export(e.exports,"FileLoader",()=>uZ),$parcel$export(e.exports,"AnimationLoader",()=>uQ),$parcel$export(e.exports,"CompressedTextureLoader",()=>uK),$parcel$export(e.exports,"ImageLoader",()=>u$),$parcel$export(e.exports,"CubeTextureLoader",()=>u0),$parcel$export(e.exports,"DataTextureLoader",()=>u1),$parcel$export(e.exports,"TextureLoader",()=>u2),$parcel$export(e.exports,"Light",()=>u3),$parcel$export(e.exports,"HemisphereLight",()=>u5),$parcel$export(e.exports,"SpotLight",()=>pt),$parcel$export(e.exports,"PointLight",()=>pa),$parcel$export(e.exports,"DirectionalLight",()=>pl),$parcel$export(e.exports,"AmbientLight",()=>ph),$parcel$export(e.exports,"RectAreaLight",()=>pc),$parcel$export(e.exports,"SphericalHarmonics3",()=>pd),$parcel$export(e.exports,"LightProbe",()=>pu),$parcel$export(e.exports,"MaterialLoader",()=>pp),$parcel$export(e.exports,"LoaderUtils",()=>pm),$parcel$export(e.exports,"InstancedBufferGeometry",()=>pf),$parcel$export(e.exports,"BufferGeometryLoader",()=>pg),$parcel$export(e.exports,"ObjectLoader",()=>py),$parcel$export(e.exports,"ImageBitmapLoader",()=>pv),$parcel$export(e.exports,"AudioContext",()=>pM),$parcel$export(e.exports,"AudioLoader",()=>pS),$parcel$export(e.exports,"HemisphereLightProbe",()=>pP),$parcel$export(e.exports,"AmbientLightProbe",()=>pT),$parcel$export(e.exports,"StereoCamera",()=>pA),$parcel$export(e.exports,"Clock",()=>pE),$parcel$export(e.exports,"AudioListener",()=>pk),$parcel$export(e.exports,"Audio",()=>pB),$parcel$export(e.exports,"PositionalAudio",()=>pN),$parcel$export(e.exports,"AudioAnalyser",()=>pG),$parcel$export(e.exports,"PropertyMixer",()=>pH),$parcel$export(e.exports,"PropertyBinding",()=>p2),$parcel$export(e.exports,"AnimationObjectGroup",()=>p3),$parcel$export(e.exports,"AnimationMixer",()=>p6),$parcel$export(e.exports,"Uniform",()=>p9),$parcel$export(e.exports,"UniformsGroup",()=>p7),$parcel$export(e.exports,"InstancedInterleavedBuffer",()=>me),$parcel$export(e.exports,"GLBufferAttribute",()=>mt),$parcel$export(e.exports,"Raycaster",()=>mi),$parcel$export(e.exports,"Spherical",()=>mo),$parcel$export(e.exports,"Cylindrical",()=>ma),$parcel$export(e.exports,"Box2",()=>ml),$parcel$export(e.exports,"Line3",()=>md),$parcel$export(e.exports,"SpotLightHelper",()=>mp),$parcel$export(e.exports,"SkeletonHelper",()=>my),$parcel$export(e.exports,"PointLightHelper",()=>mw),$parcel$export(e.exports,"HemisphereLightHelper",()=>mS),$parcel$export(e.exports,"GridHelper",()=>mP),$parcel$export(e.exports,"PolarGridHelper",()=>mT),$parcel$export(e.exports,"DirectionalLightHelper",()=>mA),$parcel$export(e.exports,"CameraHelper",()=>mI),$parcel$export(e.exports,"BoxHelper",()=>mV),$parcel$export(e.exports,"Box3Helper",()=>mk),$parcel$export(e.exports,"PlaneHelper",()=>mB),$parcel$export(e.exports,"ArrowHelper",()=>mF),$parcel$export(e.exports,"AxesHelper",()=>mz),$parcel$export(e.exports,"ShapePath",()=>mU),$parcel$export(e.exports,"DataUtils",()=>mH),$parcel$export(e.exports,"ImmediateRenderObject",()=>mj),$parcel$export(e.exports,"WebGLMultisampleRenderTarget",()=>mq),$parcel$export(e.exports,"DataTexture2DArray",()=>mX),$parcel$export(e.exports,"DataTexture3D",()=>mY),$parcel$export(e.exports,"BoxBufferGeometry",()=>mJ),$parcel$export(e.exports,"CapsuleBufferGeometry",()=>mZ),$parcel$export(e.exports,"CircleBufferGeometry",()=>mQ),$parcel$export(e.exports,"ConeBufferGeometry",()=>mK),$parcel$export(e.exports,"CylinderBufferGeometry",()=>m$),$parcel$export(e.exports,"DodecahedronBufferGeometry",()=>m0),$parcel$export(e.exports,"ExtrudeBufferGeometry",()=>m1),$parcel$export(e.exports,"IcosahedronBufferGeometry",()=>m2),$parcel$export(e.exports,"LatheBufferGeometry",()=>m3),$parcel$export(e.exports,"OctahedronBufferGeometry",()=>m5),$parcel$export(e.exports,"PlaneBufferGeometry",()=>m6),$parcel$export(e.exports,"PolyhedronBufferGeometry",()=>m9),$parcel$export(e.exports,"RingBufferGeometry",()=>m8),$parcel$export(e.exports,"ShapeBufferGeometry",()=>m7),$parcel$export(e.exports,"SphereBufferGeometry",()=>fe),$parcel$export(e.exports,"TetrahedronBufferGeometry",()=>ft),$parcel$export(e.exports,"TorusBufferGeometry",()=>fi),$parcel$export(e.exports,"TorusKnotBufferGeometry",()=>fr),$parcel$export(e.exports,"TubeBufferGeometry",()=>fn);let s="144",l={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},h={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},c=0,d=1,u=2,p=3,m=0,f=1,g=2,y=3,x=0,w=1,b=2,v=0,M=1,S=2,P=3,T=4,_=5,C=100,D=101,A=102,E=103,L=104,I=200,R=201,W=202,V=203,k=204,B=205,O=206,F=207,z=208,U=209,N=210,G=0,H=1,j=2,q=3,X=4,Y=5,J=6,Z=7,Q=0,K=1,ee=2,et=0,ei=1,er=2,en=3,eo=4,ea=5,es=300,el=301,eh=302,ec=303,ed=304,eu=306,ep=1e3,em=1001,ef=1002,eg=1003,ey=1004,ex=1004,ew=1005,eb=1005,ev=1006,eM=1007,eS=1007,eP=1008,eT=1008,e_=1009,eC=1010,eD=1011,eA=1012,eE=1013,eL=1014,eI=1015,eR=1016,eW=1017,eV=1018,ek=1020,eB=1021,eO=1022,eF=1023,ez=1024,eU=1025,eN=1026,eG=1027,eH=1028,ej=1029,eq=1030,eX=1031,eY=1033,eJ=33776,eZ=33777,eQ=33778,eK=33779,e$=35840,e0=35841,e1=35842,e2=35843,e4=36196,e5=37492,e6=37496,e9=37808,e8=37809,e7=37810,te=37811,tt=37812,ti=37813,tr=37814,tn=37815,to=37816,ta=37817,ts=37818,tl=37819,th=37820,tc=37821,td=36492,tu=2200,tp=2201,tm=2202,tf=2300,tg=2301,ty=2302,tx=2400,tw=2401,tb=2402,tv=2500,tM=2501,tS=0,tP=1,tT=2,t_=3e3,tC=3001,tD=3200,tA=3201,tE=0,tL=1,tI="",tR="srgb",tW="srgb-linear",tV=0,tk=7680,tB=7681,tO=7682,tF=7683,tz=34055,tU=34056,tN=5386,tG=512,tH=513,tj=514,tq=515,tX=516,tY=517,tJ=518,tZ=519,tQ=35044,tK=35048,t$=35040,t0=35045,t1=35049,t2=35041,t3=35046,t5=35050,t6=35042,t9="100",t8="300 es",t7=1035;class ie{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});let i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;let i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;let i=this._listeners,r=i[e];if(void 0!==r){let e=r.indexOf(t);-1!==e&&r.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;let t=this._listeners,i=t[e.type];if(void 0!==i){e.target=this;let t=i.slice(0);for(let i=0,r=t.length;i<r;i++)t[i].call(this,e);e.target=null}}}let it=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],ii=1234567,ir=Math.PI/180,io=180/Math.PI;function ia(){let e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=it[255&e]+it[e>>8&255]+it[e>>16&255]+it[e>>24&255]+"-"+it[255&t]+it[t>>8&255]+"-"+it[t>>16&15|64]+it[t>>24&255]+"-"+it[63&i|128]+it[i>>8&255]+"-"+it[i>>16&255]+it[i>>24&255]+it[255&r]+it[r>>8&255]+it[r>>16&255]+it[r>>24&255];return n.toLowerCase()}function is(e,t,i){return Math.max(t,Math.min(i,e))}function il(e,t){return(e%t+t)%t}function ih(e,t,i){return(1-i)*e+i*t}function ic(e,t,i,r){return ih(e,t,1-Math.exp(-i*r))}function id(e,t=1){return t-Math.abs(il(e,2*t)-t)}function iu(e){return e*ir}function ip(e){return e*io}function im(e){return(e&e-1)==0&&0!==e}function ig(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function iy(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function ix(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw Error("Invalid component type.")}}function iw(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw Error("Invalid component type.")}}var ib=Object.freeze({__proto__:null,DEG2RAD:ir,RAD2DEG:io,generateUUID:ia,clamp:is,euclideanModulo:il,mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},inverseLerp:function(e,t,i){return e!==t?(i-e)/(t-e):0},lerp:ih,damp:ic,pingpong:id,smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(ii=e);let t=ii+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296},degToRad:iu,radToDeg:ip,isPowerOfTwo:im,ceilPowerOfTwo:ig,floorPowerOfTwo:iy,setQuaternionFromProperEuler:function(e,t,i,r,n){let o=Math.cos,a=Math.sin,s=o(i/2),l=a(i/2),h=o((t+r)/2),c=a((t+r)/2),d=o((t-r)/2),u=a((t-r)/2),p=o((r-t)/2),m=a((r-t)/2);switch(n){case"XYX":e.set(s*c,l*d,l*u,s*h);break;case"YZY":e.set(l*u,s*c,l*d,s*h);break;case"ZXZ":e.set(l*d,l*u,s*c,s*h);break;case"XZX":e.set(s*c,l*m,l*p,s*h);break;case"YXY":e.set(l*p,s*c,l*m,s*h);break;case"ZYZ":e.set(l*m,l*p,s*c,s*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}},normalize:iw,denormalize:ix});class iv{constructor(e=0,t=0){iv.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){let e=Math.atan2(-this.y,-this.x)+Math.PI;return e}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*i-o*r+e.x,this.y=n*r+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class iM{constructor(){iM.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,r,n,o,a,s,l){let h=this.elements;return h[0]=e,h[1]=r,h[2]=a,h[3]=t,h[4]=n,h[5]=s,h[6]=i,h[7]=o,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,n=this.elements,o=i[0],a=i[3],s=i[6],l=i[1],h=i[4],c=i[7],d=i[2],u=i[5],p=i[8],m=r[0],f=r[3],g=r[6],y=r[1],x=r[4],w=r[7],b=r[2],v=r[5],M=r[8];return n[0]=o*m+a*y+s*b,n[3]=o*f+a*x+s*v,n[6]=o*g+a*w+s*M,n[1]=l*m+h*y+c*b,n[4]=l*f+h*x+c*v,n[7]=l*g+h*w+c*M,n[2]=d*m+u*y+p*b,n[5]=d*f+u*x+p*v,n[8]=d*g+u*w+p*M,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],a=e[5],s=e[6],l=e[7],h=e[8];return t*o*h-t*a*l-i*n*h+i*a*s+r*n*l-r*o*s}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],a=e[5],s=e[6],l=e[7],h=e[8],c=h*o-a*l,d=a*s-h*n,u=l*n-o*s,p=t*c+i*d+r*u;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);let m=1/p;return e[0]=c*m,e[1]=(r*l-h*i)*m,e[2]=(a*i-r*o)*m,e[3]=d*m,e[4]=(h*t-r*s)*m,e[5]=(r*n-a*t)*m,e[6]=u*m,e[7]=(i*s-l*t)*m,e[8]=(o*t-i*n)*m,this}transpose(){let e;let t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,n,o,a){let s=Math.cos(n),l=Math.sin(n);return this.set(i*s,i*l,-i*(s*o+l*a)+o+e,-r*l,r*s,-r*(-l*o+s*a)+a+t,0,0,1),this}scale(e,t){let i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){let t=Math.cos(e),i=Math.sin(e),r=this.elements,n=r[0],o=r[3],a=r[6],s=r[1],l=r[4],h=r[7];return r[0]=t*n+i*s,r[3]=t*o+i*l,r[6]=t*a+i*h,r[1]=-i*n+t*s,r[4]=-i*o+t*l,r[7]=-i*a+t*h,this}translate(e,t){let i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){let t=this.elements,i=e.elements;for(let e=0;e<9;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}function iS(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}let iP={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function iT(e,t){return new iP[e](t)}function i_(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function iC(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function iD(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let iA={[tR]:{[tW]:iC},[tW]:{[tR]:iD}},iE={legacyMode:!0,get workingColorSpace(){return tW},set workingColorSpace(colorSpace){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,i){if(this.legacyMode||t===i||!t||!i)return e;if(iA[t]&&void 0!==iA[t][i]){let r=iA[t][i];return e.r=r(e.r),e.g=r(e.g),e.b=r(e.b),e}throw Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},iL={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},iI={r:0,g:0,b:0},iR={h:0,s:0,l:0},iW={h:0,s:0,l:0};function iV(e,t,i){return(i<0&&(i+=1),i>1&&(i-=1),i<1/6)?e+(t-e)*6*i:i<.5?t:i<2/3?e+(t-e)*6*(2/3-i):e}function ik(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}class iB{constructor(e,t,i){if(this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===i)return this.set(e);return this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=tR){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,iE.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=tW){return this.r=e,this.g=t,this.b=i,iE.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=tW){if(e=il(e,1),t=is(t,0,1),i=is(i,0,1),0===t)this.r=this.g=this.b=i;else{let r=i<=.5?i*(1+t):i+t-i*t,n=2*i-r;this.r=iV(n,r,e+1/3),this.g=iV(n,r,e),this.b=iV(n,r,e-1/3)}return iE.toWorkingColorSpace(this,r),this}setStyle(e,t=tR){let i;function r(t){void 0!==t&&1>parseFloat(t)&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;let n=i[1],o=i[2];switch(n){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,iE.toWorkingColorSpace(this,t),r(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,iE.toWorkingColorSpace(this,t),r(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){let i=parseFloat(e[1])/360,n=parseFloat(e[2])/100,o=parseFloat(e[3])/100;return r(e[4]),this.setHSL(i,n,o,t)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){let e=i[1],r=e.length;if(3===r)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,iE.toWorkingColorSpace(this,t),this;if(6===r)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,iE.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=tR){let i=iL[e.toLowerCase()];return void 0!==i?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=iC(e.r),this.g=iC(e.g),this.b=iC(e.b),this}copyLinearToSRGB(e){return this.r=iD(e.r),this.g=iD(e.g),this.b=iD(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=tR){return iE.fromWorkingColorSpace(ik(this,iI),e),is(255*iI.r,0,255)<<16^is(255*iI.g,0,255)<<8^is(255*iI.b,0,255)<<0}getHexString(e=tR){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=tW){let i,r;iE.fromWorkingColorSpace(ik(this,iI),t);let n=iI.r,o=iI.g,a=iI.b,s=Math.max(n,o,a),l=Math.min(n,o,a),h=(l+s)/2;if(l===s)i=0,r=0;else{let e=s-l;switch(r=h<=.5?e/(s+l):e/(2-s-l),s){case n:i=(o-a)/e+(o<a?6:0);break;case o:i=(a-n)/e+2;break;case a:i=(n-o)/e+4}i/=6}return e.h=i,e.s=r,e.l=h,e}getRGB(e,t=tW){return iE.fromWorkingColorSpace(ik(this,iI),t),e.r=iI.r,e.g=iI.g,e.b=iI.b,e}getStyle(e=tR){return(iE.fromWorkingColorSpace(ik(this,iI),e),e!==tR)?`color(${e} ${iI.r} ${iI.g} ${iI.b})`:`rgb(${255*iI.r|0},${255*iI.g|0},${255*iI.b|0})`}offsetHSL(e,t,i){return this.getHSL(iR),iR.h+=e,iR.s+=t,iR.l+=i,this.setHSL(iR.h,iR.s,iR.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(iR),e.getHSL(iW);let i=ih(iR.h,iW.h,t),r=ih(iR.s,iW.s,t),n=ih(iR.l,iW.l,t);return this.setHSL(i,r,n),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}iB.NAMES=iL;class iO{static getDataURL(e){let t;if(/^data:/i.test(e.src)||"undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===i&&(i=i_("canvas")),i.width=e.width,i.height=e.height;let r=i.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=i}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){let t=i_("canvas");t.width=e.width,t.height=e.height;let i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);let r=i.getImageData(0,0,e.width,e.height),n=r.data;for(let e=0;e<n.length;e++)n[e]=255*iC(n[e]/255);return i.putImageData(r,0,0),t}if(!e.data)return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e;{let t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*iC(t[e]/255)):t[e]=iC(t[e]);return{data:t,width:e.width,height:e.height}}}}class iF{constructor(e=null){this.isSource=!0,this.uuid=ia(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){let t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];let i={uuid:this.uuid,url:""},r=this.data;if(null!==r){let e;if(Array.isArray(r)){e=[];for(let t=0,i=r.length;t<i;t++)r[t].isDataTexture?e.push(iz(r[t].image)):e.push(iz(r[t]))}else e=iz(r);i.url=e}return t||(e.images[this.uuid]=i),i}}function iz(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?iO.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let iU=0;class iN extends ie{constructor(e=iN.DEFAULT_IMAGE,t=iN.DEFAULT_MAPPING,i=em,r=em,n=ev,o=eP,a=eF,s=e_,l=1,h=t_){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:iU++}),this.uuid=ia(),this.name="",this.source=new iF(e),this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=r,this.magFilter=n,this.minFilter=o,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=s,this.offset=new iv(0,0),this.repeat=new iv(1,1),this.center=new iv(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new iM,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];let i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==es)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ep:e.x=e.x-Math.floor(e.x);break;case em:e.x=e.x<0?0:1;break;case ef:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ep:e.y=e.y-Math.floor(e.y);break;case em:e.y=e.y<0?0:1;break;case ef:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}iN.DEFAULT_IMAGE=null,iN.DEFAULT_MAPPING=es;class iG{constructor(e=0,t=0,i=0,r=1){iG.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,n=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*n,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*n,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*n,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*n,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,n;let o=.01,a=.1,s=e.elements,l=s[0],h=s[4],c=s[8],d=s[1],u=s[5],p=s[9],m=s[2],f=s[6],g=s[10];if(Math.abs(h-d)<o&&Math.abs(c-m)<o&&Math.abs(p-f)<o){if(Math.abs(h+d)<a&&Math.abs(c+m)<a&&Math.abs(p+f)<a&&Math.abs(l+u+g-3)<a)return this.set(1,0,0,0),this;t=Math.PI;let e=(l+1)/2,s=(u+1)/2,y=(g+1)/2,x=(h+d)/4,w=(c+m)/4,b=(p+f)/4;return e>s&&e>y?e<o?(i=0,r=.707106781,n=.707106781):(r=x/(i=Math.sqrt(e)),n=w/i):s>y?s<o?(i=.707106781,r=0,n=.707106781):(i=x/(r=Math.sqrt(s)),n=b/r):y<o?(i=.707106781,r=.707106781,n=0):(i=w/(n=Math.sqrt(y)),r=b/n),this.set(i,r,n,t),this}let y=Math.sqrt((f-p)*(f-p)+(c-m)*(c-m)+(d-h)*(d-h));return .001>Math.abs(y)&&(y=1),this.x=(f-p)/y,this.y=(c-m)/y,this.z=(d-h)/y,this.w=Math.acos((l+u+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class iH extends ie{constructor(e,t,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new iG(0,0,e,t),this.scissorTest=!1,this.viewport=new iG(0,0,e,t);let r={width:e,height:t,depth:1};this.texture=new iN(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:ev,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;let t=Object.assign({},e.texture.image);return this.texture.source=new iF(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class ij extends iN{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=eg,this.minFilter=eg,this.wrapR=em,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class iq extends iH{constructor(e,t,i){super(e,t),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new ij(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class iX extends iN{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=eg,this.minFilter=eg,this.wrapR=em,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class iY extends iH{constructor(e,t,i){super(e,t),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new iX(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class iJ extends iH{constructor(e,t,i,r={}){super(e,t,r),this.isWebGLMultipleRenderTargets=!0;let n=this.texture;this.texture=[];for(let e=0;e<i;e++)this.texture[e]=n.clone(),this.texture[e].isRenderTargetTexture=!0}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,n=this.texture.length;r<n;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}class iZ{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,n,o,a){let s=i[r+0],l=i[r+1],h=i[r+2],c=i[r+3],d=n[o+0],u=n[o+1],p=n[o+2],m=n[o+3];if(0===a){e[t+0]=s,e[t+1]=l,e[t+2]=h,e[t+3]=c;return}if(1===a){e[t+0]=d,e[t+1]=u,e[t+2]=p,e[t+3]=m;return}if(c!==m||s!==d||l!==u||h!==p){let e=1-a,t=s*d+l*u+h*p+c*m,i=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){let n=Math.sqrt(r),o=Math.atan2(n,t*i);e=Math.sin(e*o)/n,a=Math.sin(a*o)/n}let n=a*i;if(s=s*e+d*n,l=l*e+u*n,h=h*e+p*n,c=c*e+m*n,e===1-a){let e=1/Math.sqrt(s*s+l*l+h*h+c*c);s*=e,l*=e,h*=e,c*=e}}e[t]=s,e[t+1]=l,e[t+2]=h,e[t+3]=c}static multiplyQuaternionsFlat(e,t,i,r,n,o){let a=i[r],s=i[r+1],l=i[r+2],h=i[r+3],c=n[o],d=n[o+1],u=n[o+2],p=n[o+3];return e[t]=a*p+h*c+s*u-l*d,e[t+1]=s*p+h*d+l*c-a*u,e[t+2]=l*p+h*u+a*d-s*c,e[t+3]=h*p-a*c-s*d-l*u,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){let i=e._x,r=e._y,n=e._z,o=e._order,a=Math.cos,s=Math.sin,l=a(i/2),h=a(r/2),c=a(n/2),d=s(i/2),u=s(r/2),p=s(n/2);switch(o){case"XYZ":this._x=d*h*c+l*u*p,this._y=l*u*c-d*h*p,this._z=l*h*p+d*u*c,this._w=l*h*c-d*u*p;break;case"YXZ":this._x=d*h*c+l*u*p,this._y=l*u*c-d*h*p,this._z=l*h*p-d*u*c,this._w=l*h*c+d*u*p;break;case"ZXY":this._x=d*h*c-l*u*p,this._y=l*u*c+d*h*p,this._z=l*h*p+d*u*c,this._w=l*h*c-d*u*p;break;case"ZYX":this._x=d*h*c-l*u*p,this._y=l*u*c+d*h*p,this._z=l*h*p-d*u*c,this._w=l*h*c+d*u*p;break;case"YZX":this._x=d*h*c+l*u*p,this._y=l*u*c+d*h*p,this._z=l*h*p-d*u*c,this._w=l*h*c-d*u*p;break;case"XZY":this._x=d*h*c-l*u*p,this._y=l*u*c-d*h*p,this._z=l*h*p+d*u*c,this._w=l*h*c+d*u*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,i=t[0],r=t[4],n=t[8],o=t[1],a=t[5],s=t[9],l=t[2],h=t[6],c=t[10],d=i+a+c;if(d>0){let e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(h-s)*e,this._y=(n-l)*e,this._z=(o-r)*e}else if(i>a&&i>c){let e=2*Math.sqrt(1+i-a-c);this._w=(h-s)/e,this._x=.25*e,this._y=(r+o)/e,this._z=(n+l)/e}else if(a>c){let e=2*Math.sqrt(1+a-i-c);this._w=(n-l)/e,this._x=(r+o)/e,this._y=.25*e,this._z=(s+h)/e}else{let e=2*Math.sqrt(1+c-i-a);this._w=(o-r)/e,this._x=(n+l)/e,this._y=(s+h)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0):(this._x=0,this._y=-e.z,this._z=e.y)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x),this._w=i,this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(is(this.dot(e),-1,1)))}rotateTowards(e,t){let i=this.angleTo(e);if(0===i)return this;let r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let i=e._x,r=e._y,n=e._z,o=e._w,a=t._x,s=t._y,l=t._z,h=t._w;return this._x=i*h+o*a+r*l-n*s,this._y=r*h+o*s+n*a-i*l,this._z=n*h+o*l+i*s-r*a,this._w=o*h-i*a-r*s-n*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);let i=this._x,r=this._y,n=this._z,o=this._w,a=o*e._w+i*e._x+r*e._y+n*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=n,this;let s=1-a*a;if(s<=Number.EPSILON){let e=1-t;return this._w=e*o+t*this._w,this._x=e*i+t*this._x,this._y=e*r+t*this._y,this._z=e*n+t*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(s),h=Math.atan2(l,a),c=Math.sin((1-t)*h)/l,d=Math.sin(t*h)/l;return this._w=o*c+this._w*d,this._x=i*c+this._x*d,this._y=r*c+this._y*d,this._z=n*c+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){let e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(n),i*Math.cos(n),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class iQ{constructor(e=0,t=0,i=0){iQ.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(i$.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(i$.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,n=e.elements,o=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*o,this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*o,this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*o,this}applyQuaternion(e){let t=this.x,i=this.y,r=this.z,n=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*r-a*i,h=s*i+a*t-n*r,c=s*r+n*i-o*t,d=-n*t-o*i-a*r;return this.x=l*s+-(d*n)+-(h*a)- -(c*o),this.y=h*s+-(d*o)+-(c*n)- -(l*a),this.z=c*s+-(d*a)+-(l*o)- -(h*n),this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let i=e.x,r=e.y,n=e.z,o=t.x,a=t.y,s=t.z;return this.x=r*s-n*a,this.y=n*o-i*s,this.z=i*a-r*o,this}projectOnVector(e){let t=e.lengthSq();if(0===t)return this.set(0,0,0);let i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return iK.copy(this).projectOnVector(e),this.sub(iK)}reflect(e){return this.sub(iK.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;let i=this.dot(e)/t;return Math.acos(is(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){let r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}let iK=new iQ,i$=new iZ;class i0{constructor(e=new iQ(1/0,1/0,1/0),t=new iQ(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,a=-1/0;for(let s=0,l=e.length;s<l;s+=3){let l=e[s],h=e[s+1],c=e[s+2];l<t&&(t=l),h<i&&(i=h),c<r&&(r=c),l>n&&(n=l),h>o&&(o=h),c>a&&(a=c)}return this.min.set(t,i,r),this.max.set(n,o,a),this}setFromBufferAttribute(e){let t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,a=-1/0;for(let s=0,l=e.count;s<l;s++){let l=e.getX(s),h=e.getY(s),c=e.getZ(s);l<t&&(t=l),h<i&&(i=h),c<r&&(r=c),l>n&&(n=l),h>o&&(o=h),c>a&&(a=c)}return this.min.set(t,i,r),this.max.set(n,o,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=i2.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let i=e.geometry;if(void 0!==i){if(t&&void 0!=i.attributes&&void 0!==i.attributes.position){let t=i.attributes.position;for(let i=0,r=t.count;i<r;i++)i2.fromBufferAttribute(t,i).applyMatrix4(e.matrixWorld),this.expandByPoint(i2)}else null===i.boundingBox&&i.computeBoundingBox(),i3.copy(i.boundingBox),i3.applyMatrix4(e.matrixWorld),this.union(i3)}let r=e.children;for(let e=0,i=r.length;e<i;e++)this.expandByObject(r[e],t);return this}containsPoint(e){return!(e.x<this.min.x)&&!(e.x>this.max.x)&&!(e.y<this.min.y)&&!(e.y>this.max.y)&&!(e.z<this.min.z)&&!(e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x)&&!(e.min.x>this.max.x)&&!(e.max.y<this.min.y)&&!(e.min.y>this.max.y)&&!(e.max.z<this.min.z)&&!(e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,i2),i2.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(rt),ri.subVectors(this.max,rt),i4.subVectors(e.a,rt),i6.subVectors(e.b,rt),i9.subVectors(e.c,rt),i8.subVectors(i6,i4),i7.subVectors(i9,i6),re.subVectors(i4,i9);let t=[0,-i8.z,i8.y,0,-i7.z,i7.y,0,-re.z,re.y,i8.z,0,-i8.x,i7.z,0,-i7.x,re.z,0,-re.x,-i8.y,i8.x,0,-i7.y,i7.x,0,-re.y,re.x,0];return!!(ro(t,i4,i6,i9,ri)&&ro(t=[1,0,0,0,1,0,0,0,1],i4,i6,i9,ri))&&(rr.crossVectors(i8,i7),ro(t=[rr.x,rr.y,rr.z],i4,i6,i9,ri))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){let t=i2.copy(e).clamp(this.min,this.max);return t.sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(i2).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(i1[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),i1[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),i1[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),i1[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),i1[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),i1[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),i1[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),i1[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(i1)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}let i1=[new iQ,new iQ,new iQ,new iQ,new iQ,new iQ,new iQ,new iQ],i2=new iQ,i3=new i0,i4=new iQ,i6=new iQ,i9=new iQ,i8=new iQ,i7=new iQ,re=new iQ,rt=new iQ,ri=new iQ,rr=new iQ,rn=new iQ;function ro(e,t,i,r,n){for(let o=0,a=e.length-3;o<=a;o+=3){rn.fromArray(e,o);let a=n.x*Math.abs(rn.x)+n.y*Math.abs(rn.y)+n.z*Math.abs(rn.z),s=t.dot(rn),l=i.dot(rn),h=r.dot(rn);if(Math.max(-Math.max(s,l,h),Math.min(s,l,h))>a)return!1}return!0}let ra=new i0,rs=new iQ,rl=new iQ,rh=new iQ;class rc{constructor(e=new iQ,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let i=this.center;void 0!==t?i.copy(t):ra.setFromPoints(e).getCenter(i);let r=0;for(let t=0,n=e.length;t<n;t++)r=Math.max(r,i.distanceToSquared(e[t]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?e.makeEmpty():(e.set(this.center,this.center),e.expandByScalar(this.radius)),e}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){rh.subVectors(e,this.center);let t=rh.lengthSq();if(t>this.radius*this.radius){let e=Math.sqrt(t),i=(e-this.radius)*.5;this.center.add(rh.multiplyScalar(i/e)),this.radius+=i}return this}union(e){return!0===this.center.equals(e.center)?rl.set(0,0,1).multiplyScalar(e.radius):rl.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(rs.copy(e.center).add(rl)),this.expandByPoint(rs.copy(e.center).sub(rl)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}let rd=new iQ,ru=new iQ,rp=new iQ,rm=new iQ,rf=new iQ,rg=new iQ,ry=new iQ;class rx{constructor(e=new iQ,t=new iQ(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,rd)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=rd.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(rd.copy(this.direction).multiplyScalar(t).add(this.origin),rd.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){let n,o,a,s;ru.copy(e).add(t).multiplyScalar(.5),rp.copy(t).sub(e).normalize(),rm.copy(this.origin).sub(ru);let l=.5*e.distanceTo(t),h=-this.direction.dot(rp),c=rm.dot(this.direction),d=-rm.dot(rp),u=rm.lengthSq(),p=Math.abs(1-h*h);if(p>0){if(n=h*d-c,o=h*c-d,s=l*p,n>=0){if(o>=-s){if(o<=s){let e=1/p;n*=e,o*=e,a=n*(n+h*o+2*c)+o*(h*n+o+2*d)+u}else a=-(n=Math.max(0,-(h*(o=l)+c)))*n+o*(o+2*d)+u}else a=-(n=Math.max(0,-(h*(o=-l)+c)))*n+o*(o+2*d)+u}else o<=-s?(o=(n=Math.max(0,-(-h*l+c)))>0?-l:Math.min(Math.max(-l,-d),l),a=-n*n+o*(o+2*d)+u):o<=s?(n=0,a=(o=Math.min(Math.max(-l,-d),l))*(o+2*d)+u):(o=(n=Math.max(0,-(h*l+c)))>0?l:Math.min(Math.max(-l,-d),l),a=-n*n+o*(o+2*d)+u)}else o=h>0?-l:l,a=-(n=Math.max(0,-(h*o+c)))*n+o*(o+2*d)+u;return i&&i.copy(this.direction).multiplyScalar(n).add(this.origin),r&&r.copy(rp).multiplyScalar(o).add(ru),a}intersectSphere(e,t){rd.subVectors(e.center,this.origin);let i=rd.dot(this.direction),r=rd.dot(rd)-i*i,n=e.radius*e.radius;if(r>n)return null;let o=Math.sqrt(n-r),a=i-o,s=i+o;return a<0&&s<0?null:a<0?this.at(s,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;let i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){let i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);if(0===t)return!0;let i=e.normal.dot(this.direction);return i*t<0}intersectBox(e,t){let i,r,n,o,a,s;let l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,d=this.origin;return(l>=0?(i=(e.min.x-d.x)*l,r=(e.max.x-d.x)*l):(i=(e.max.x-d.x)*l,r=(e.min.x-d.x)*l),h>=0?(n=(e.min.y-d.y)*h,o=(e.max.y-d.y)*h):(n=(e.max.y-d.y)*h,o=(e.min.y-d.y)*h),i>o||n>r)?null:((n>i||i!=i)&&(i=n),(o<r||r!=r)&&(r=o),c>=0?(a=(e.min.z-d.z)*c,s=(e.max.z-d.z)*c):(a=(e.max.z-d.z)*c,s=(e.min.z-d.z)*c),i>s||a>r)?null:((a>i||i!=i)&&(i=a),(s<r||r!=r)&&(r=s),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return null!==this.intersectBox(e,rd)}intersectTriangle(e,t,i,r,n){let o;rf.subVectors(t,e),rg.subVectors(i,e),ry.crossVectors(rf,rg);let a=this.direction.dot(ry);if(a>0){if(r)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}rm.subVectors(this.origin,e);let s=o*this.direction.dot(rg.crossVectors(rm,rg));if(s<0)return null;let l=o*this.direction.dot(rf.cross(rm));if(l<0||s+l>a)return null;let h=-o*rm.dot(ry);return h<0?null:this.at(h/a,n)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class rw{constructor(){rw.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,r,n,o,a,s,l,h,c,d,u,p,m,f){let g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=n,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=h,g[10]=c,g[14]=d,g[3]=u,g[7]=p,g[11]=m,g[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new rw().fromArray(this.elements)}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){let t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,i=e.elements,r=1/rb.setFromMatrixColumn(e,0).length(),n=1/rb.setFromMatrixColumn(e,1).length(),o=1/rb.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*n,t[5]=i[5]*n,t[6]=i[6]*n,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,i=e.x,r=e.y,n=e.z,o=Math.cos(i),a=Math.sin(i),s=Math.cos(r),l=Math.sin(r),h=Math.cos(n),c=Math.sin(n);if("XYZ"===e.order){let e=o*h,i=o*c,r=a*h,n=a*c;t[0]=s*h,t[4]=-s*c,t[8]=l,t[1]=i+r*l,t[5]=e-n*l,t[9]=-a*s,t[2]=n-e*l,t[6]=r+i*l,t[10]=o*s}else if("YXZ"===e.order){let e=s*h,i=s*c,r=l*h,n=l*c;t[0]=e+n*a,t[4]=r*a-i,t[8]=o*l,t[1]=o*c,t[5]=o*h,t[9]=-a,t[2]=i*a-r,t[6]=n+e*a,t[10]=o*s}else if("ZXY"===e.order){let e=s*h,i=s*c,r=l*h,n=l*c;t[0]=e-n*a,t[4]=-o*c,t[8]=r+i*a,t[1]=i+r*a,t[5]=o*h,t[9]=n-e*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){let e=o*h,i=o*c,r=a*h,n=a*c;t[0]=s*h,t[4]=r*l-i,t[8]=e*l+n,t[1]=s*c,t[5]=n*l+e,t[9]=i*l-r,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){let e=o*s,i=o*l,r=a*s,n=a*l;t[0]=s*h,t[4]=n-e*c,t[8]=r*c+i,t[1]=c,t[5]=o*h,t[9]=-a*h,t[2]=-l*h,t[6]=i*c+r,t[10]=e-n*c}else if("XZY"===e.order){let e=o*s,i=o*l,r=a*s,n=a*l;t[0]=s*h,t[4]=-c,t[8]=l*h,t[1]=e*c+n,t[5]=o*h,t[9]=i*c-r,t[2]=r*c-i,t[6]=a*h,t[10]=n*c+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(rM,e,rS)}lookAt(e,t,i){let r=this.elements;return r_.subVectors(e,t),0===r_.lengthSq()&&(r_.z=1),r_.normalize(),rP.crossVectors(i,r_),0===rP.lengthSq()&&(1===Math.abs(i.z)?r_.x+=1e-4:r_.z+=1e-4,r_.normalize(),rP.crossVectors(i,r_)),rP.normalize(),rT.crossVectors(r_,rP),r[0]=rP.x,r[4]=rT.x,r[8]=r_.x,r[1]=rP.y,r[5]=rT.y,r[9]=r_.y,r[2]=rP.z,r[6]=rT.z,r[10]=r_.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,n=this.elements,o=i[0],a=i[4],s=i[8],l=i[12],h=i[1],c=i[5],d=i[9],u=i[13],p=i[2],m=i[6],f=i[10],g=i[14],y=i[3],x=i[7],w=i[11],b=i[15],v=r[0],M=r[4],S=r[8],P=r[12],T=r[1],_=r[5],C=r[9],D=r[13],A=r[2],E=r[6],L=r[10],I=r[14],R=r[3],W=r[7],V=r[11],k=r[15];return n[0]=o*v+a*T+s*A+l*R,n[4]=o*M+a*_+s*E+l*W,n[8]=o*S+a*C+s*L+l*V,n[12]=o*P+a*D+s*I+l*k,n[1]=h*v+c*T+d*A+u*R,n[5]=h*M+c*_+d*E+u*W,n[9]=h*S+c*C+d*L+u*V,n[13]=h*P+c*D+d*I+u*k,n[2]=p*v+m*T+f*A+g*R,n[6]=p*M+m*_+f*E+g*W,n[10]=p*S+m*C+f*L+g*V,n[14]=p*P+m*D+f*I+g*k,n[3]=y*v+x*T+w*A+b*R,n[7]=y*M+x*_+w*E+b*W,n[11]=y*S+x*C+w*L+b*V,n[15]=y*P+x*D+w*I+b*k,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],o=e[1],a=e[5],s=e[9],l=e[13],h=e[2],c=e[6],d=e[10],u=e[14],p=e[3],m=e[7],f=e[11],g=e[15];return p*(+n*s*c-r*l*c-n*a*d+i*l*d+r*a*u-i*s*u)+m*(+t*s*u-t*l*d+n*o*d-r*o*u+r*l*h-n*s*h)+f*(+t*l*c-t*a*u-n*o*c+i*o*u+n*a*h-i*l*h)+g*(-r*a*h-t*s*c+t*a*d+r*o*c-i*o*d+i*s*h)}transpose(){let e;let t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(e,t,i){let r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],a=e[5],s=e[6],l=e[7],h=e[8],c=e[9],d=e[10],u=e[11],p=e[12],m=e[13],f=e[14],g=e[15],y=c*f*l-m*d*l+m*s*u-a*f*u-c*s*g+a*d*g,x=p*d*l-h*f*l-p*s*u+o*f*u+h*s*g-o*d*g,w=h*m*l-p*c*l+p*a*u-o*m*u-h*a*g+o*c*g,b=p*c*s-h*m*s-p*a*d+o*m*d+h*a*f-o*c*f,v=t*y+i*x+r*w+n*b;if(0===v)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let M=1/v;return e[0]=y*M,e[1]=(m*d*n-c*f*n-m*r*u+i*f*u+c*r*g-i*d*g)*M,e[2]=(a*f*n-m*s*n+m*r*l-i*f*l-a*r*g+i*s*g)*M,e[3]=(c*s*n-a*d*n-c*r*l+i*d*l+a*r*u-i*s*u)*M,e[4]=x*M,e[5]=(h*f*n-p*d*n+p*r*u-t*f*u-h*r*g+t*d*g)*M,e[6]=(p*s*n-o*f*n-p*r*l+t*f*l+o*r*g-t*s*g)*M,e[7]=(o*d*n-h*s*n+h*r*l-t*d*l-o*r*u+t*s*u)*M,e[8]=w*M,e[9]=(p*c*n-h*m*n-p*i*u+t*m*u+h*i*g-t*c*g)*M,e[10]=(o*m*n-p*a*n+p*i*l-t*m*l-o*i*g+t*a*g)*M,e[11]=(h*a*n-o*c*n-h*i*l+t*c*l+o*i*u-t*a*u)*M,e[12]=b*M,e[13]=(h*m*r-p*c*r+p*i*d-t*m*d-h*i*f+t*c*f)*M,e[14]=(p*a*r-o*m*r-p*i*s+t*m*s+o*i*f-t*a*f)*M,e[15]=(o*c*r-h*a*r+h*i*s-t*c*s-o*i*d+t*a*d)*M,this}scale(e){let t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let i=Math.cos(t),r=Math.sin(t),n=1-i,o=e.x,a=e.y,s=e.z,l=n*o,h=n*a;return this.set(l*o+i,l*a-r*s,l*s+r*a,0,l*a+r*s,h*a+i,h*s-r*o,0,l*s-r*a,h*s+r*o,n*s*s+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,n,o){return this.set(1,i,n,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){let r=this.elements,n=t._x,o=t._y,a=t._z,s=t._w,l=n+n,h=o+o,c=a+a,d=n*l,u=n*h,p=n*c,m=o*h,f=o*c,g=a*c,y=s*l,x=s*h,w=s*c,b=i.x,v=i.y,M=i.z;return r[0]=(1-(m+g))*b,r[1]=(u+w)*b,r[2]=(p-x)*b,r[3]=0,r[4]=(u-w)*v,r[5]=(1-(d+g))*v,r[6]=(f+y)*v,r[7]=0,r[8]=(p+x)*M,r[9]=(f-y)*M,r[10]=(1-(d+m))*M,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){let r=this.elements,n=rb.set(r[0],r[1],r[2]).length(),o=rb.set(r[4],r[5],r[6]).length(),a=rb.set(r[8],r[9],r[10]).length(),s=this.determinant();s<0&&(n=-n),e.x=r[12],e.y=r[13],e.z=r[14],rv.copy(this);let l=1/n,h=1/o,c=1/a;return rv.elements[0]*=l,rv.elements[1]*=l,rv.elements[2]*=l,rv.elements[4]*=h,rv.elements[5]*=h,rv.elements[6]*=h,rv.elements[8]*=c,rv.elements[9]*=c,rv.elements[10]*=c,t.setFromRotationMatrix(rv),i.x=n,i.y=o,i.z=a,this}makePerspective(e,t,i,r,n,o){let a=this.elements,s=2*n/(t-e),l=2*n/(i-r),h=(t+e)/(t-e),c=(i+r)/(i-r),d=-(o+n)/(o-n),u=-2*o*n/(o-n);return a[0]=s,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=l,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=u,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,i,r,n,o){let a=this.elements,s=1/(t-e),l=1/(i-r),h=1/(o-n),c=(t+e)*s,d=(i+r)*l,u=(o+n)*h;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=-2*h,a[14]=-u,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){let t=this.elements,i=e.elements;for(let e=0;e<16;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}let rb=new iQ,rv=new rw,rM=new iQ(0,0,0),rS=new iQ(1,1,1),rP=new iQ,rT=new iQ,r_=new iQ,rC=new rw,rD=new iZ;class rA{constructor(e=0,t=0,i=0,r=rA.DefaultOrder){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){let r=e.elements,n=r[0],o=r[4],a=r[8],s=r[1],l=r[5],h=r[9],c=r[2],d=r[6],u=r[10];switch(t){case"XYZ":this._y=Math.asin(is(a,-1,1)),.9999999>Math.abs(a)?(this._x=Math.atan2(-h,u),this._z=Math.atan2(-o,n)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-is(h,-1,1)),.9999999>Math.abs(h)?(this._y=Math.atan2(a,u),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-c,n),this._z=0);break;case"ZXY":this._x=Math.asin(is(d,-1,1)),.9999999>Math.abs(d)?(this._y=Math.atan2(-c,u),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(s,n));break;case"ZYX":this._y=Math.asin(-is(c,-1,1)),.9999999>Math.abs(c)?(this._x=Math.atan2(d,u),this._z=Math.atan2(s,n)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(is(s,-1,1)),.9999999>Math.abs(s)?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-c,n)):(this._x=0,this._y=Math.atan2(a,u));break;case"XZY":this._z=Math.asin(-is(o,-1,1)),.9999999>Math.abs(o)?(this._x=Math.atan2(d,l),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-h,u),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===i&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return rC.makeRotationFromQuaternion(e),this.setFromRotationMatrix(rC,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return rD.setFromEuler(this),this.setFromQuaternion(rD,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}rA.DefaultOrder="XYZ",rA.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class rE{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}isEnabled(e){return(this.mask&(1<<e|0))!=0}}let rL=0,rI=new iQ,rR=new iZ,rW=new rw,rV=new iQ,rk=new iQ,rB=new iQ,rO=new iZ,rF=new iQ(1,0,0),rz=new iQ(0,1,0),rU=new iQ(0,0,1),rN={type:"added"},rG={type:"removed"};class rH extends ie{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:rL++}),this.uuid=ia(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=rH.DefaultUp.clone();let e=new iQ,t=new rA,i=new iZ,r=new iQ(1,1,1);function n(){i.setFromEuler(t,!1)}function o(){t.setFromQuaternion(i,void 0,!1)}t._onChange(n),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new rw},normalMatrix:{value:new iM}}),this.matrix=new rw,this.matrixWorld=new rw,this.matrixAutoUpdate=rH.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=rH.DefaultMatrixWorldAutoUpdate,this.layers=new rE,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return rR.setFromAxisAngle(e,t),this.quaternion.multiply(rR),this}rotateOnWorldAxis(e,t){return rR.setFromAxisAngle(e,t),this.quaternion.premultiply(rR),this}rotateX(e){return this.rotateOnAxis(rF,e)}rotateY(e){return this.rotateOnAxis(rz,e)}rotateZ(e){return this.rotateOnAxis(rU,e)}translateOnAxis(e,t){return rI.copy(e).applyQuaternion(this.quaternion),this.position.add(rI.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(rF,e)}translateY(e){return this.translateOnAxis(rz,e)}translateZ(e){return this.translateOnAxis(rU,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(rW.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?rV.copy(e):rV.set(e,t,i);let r=this.parent;this.updateWorldMatrix(!0,!1),rk.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?rW.lookAt(rk,rV,this.up):rW.lookAt(rV,rk,this.up),this.quaternion.setFromRotationMatrix(rW),r&&(rW.extractRotation(r.matrixWorld),rR.setFromRotationMatrix(rW),this.quaternion.premultiply(rR.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",e):e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(rN)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}let t=this.children.indexOf(e);return -1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(rG)),this}removeFromParent(){let e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent(rG)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),rW.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),rW.multiply(e.parent.matrixWorld)),e.applyMatrix4(rW),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){let r=this.children[i],n=r.getObjectByProperty(e,t);if(void 0!==n)return n}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(rk,e,rB),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(rk,rO,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){let t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let i=0,r=t.length;i<r;i++){let r=t[i];(!0===r.matrixWorldAutoUpdate||!0===e)&&r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){let i=this.parent;if(!0===e&&null!==i&&!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){let e=this.children;for(let t=0,i=e.length;t<i;t++){let i=e[t];!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!1,!0)}}}toJSON(e){let t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let r={};function n(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=n(e.geometries,this.geometry);let t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){let i=t.shapes;if(Array.isArray(i))for(let t=0,r=i.length;t<r;t++){let r=i[t];n(e.shapes,r)}else n(e.shapes,i)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(n(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material){if(Array.isArray(this.material)){let t=[];for(let i=0,r=this.material.length;i<r;i++)t.push(n(e.materials,this.material[i]));r.material=t}else r.material=n(e.materials,this.material)}if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){let i=this.animations[t];r.animations.push(n(e.animations,i))}}if(t){let t=o(e.geometries),r=o(e.materials),n=o(e.textures),a=o(e.images),s=o(e.shapes),l=o(e.skeletons),h=o(e.animations),c=o(e.nodes);t.length>0&&(i.geometries=t),r.length>0&&(i.materials=r),n.length>0&&(i.textures=n),a.length>0&&(i.images=a),s.length>0&&(i.shapes=s),l.length>0&&(i.skeletons=l),h.length>0&&(i.animations=h),c.length>0&&(i.nodes=c)}return i.object=r,i;function o(e){let t=[];for(let i in e){let r=e[i];delete r.metadata,t.push(r)}return t}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){let i=e.children[t];this.add(i.clone())}return this}}rH.DefaultUp=new iQ(0,1,0),rH.DefaultMatrixAutoUpdate=!0,rH.DefaultMatrixWorldAutoUpdate=!0;let rj=new iQ,rq=new iQ,rX=new iQ,rY=new iQ,rJ=new iQ,rZ=new iQ,rQ=new iQ,rK=new iQ,r$=new iQ,r0=new iQ;class r1{constructor(e=new iQ,t=new iQ,i=new iQ){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),rj.subVectors(e,t),r.cross(rj);let n=r.lengthSq();return n>0?r.multiplyScalar(1/Math.sqrt(n)):r.set(0,0,0)}static getBarycoord(e,t,i,r,n){rj.subVectors(r,t),rq.subVectors(i,t),rX.subVectors(e,t);let o=rj.dot(rj),a=rj.dot(rq),s=rj.dot(rX),l=rq.dot(rq),h=rq.dot(rX),c=o*l-a*a;if(0===c)return n.set(-2,-1,-1);let d=1/c,u=(l*s-a*h)*d,p=(o*h-a*s)*d;return n.set(1-u-p,p,u)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,rY),rY.x>=0&&rY.y>=0&&rY.x+rY.y<=1}static getUV(e,t,i,r,n,o,a,s){return this.getBarycoord(e,t,i,r,rY),s.set(0,0),s.addScaledVector(n,rY.x),s.addScaledVector(o,rY.y),s.addScaledVector(a,rY.z),s}static isFrontFacing(e,t,i,r){return rj.subVectors(i,t),rq.subVectors(e,t),0>rj.cross(rq).dot(r)}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return rj.subVectors(this.c,this.b),rq.subVectors(this.a,this.b),.5*rj.cross(rq).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return r1.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return r1.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,n){return r1.getUV(e,this.a,this.b,this.c,t,i,r,n)}containsPoint(e){return r1.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return r1.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let i,r;let n=this.a,o=this.b,a=this.c;rJ.subVectors(o,n),rZ.subVectors(a,n),rK.subVectors(e,n);let s=rJ.dot(rK),l=rZ.dot(rK);if(s<=0&&l<=0)return t.copy(n);r$.subVectors(e,o);let h=rJ.dot(r$),c=rZ.dot(r$);if(h>=0&&c<=h)return t.copy(o);let d=s*c-h*l;if(d<=0&&s>=0&&h<=0)return i=s/(s-h),t.copy(n).addScaledVector(rJ,i);r0.subVectors(e,a);let u=rJ.dot(r0),p=rZ.dot(r0);if(p>=0&&u<=p)return t.copy(a);let m=u*l-s*p;if(m<=0&&l>=0&&p<=0)return r=l/(l-p),t.copy(n).addScaledVector(rZ,r);let f=h*p-u*c;if(f<=0&&c-h>=0&&u-p>=0)return rQ.subVectors(a,o),r=(c-h)/(c-h+(u-p)),t.copy(o).addScaledVector(rQ,r);let g=1/(f+m+d);return i=m*g,r=d*g,t.copy(n).addScaledVector(rJ,i).addScaledVector(rZ,r)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let r2=0;class r3 extends ie{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:r2++}),this.uuid=ia(),this.name="",this.type="Material",this.blending=M,this.side=x,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=k,this.blendDst=B,this.blendEquation=C,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=q,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=tZ,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=tk,this.stencilZFail=tk,this.stencilZPass=tk,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(let t in e){let i=e[t];if(void 0===i){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}let r=this[t];if(void 0===r){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){let t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});let i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){let t=[];for(let i in e){let r=e[i];delete r.metadata,t.push(r)}return t}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==M&&(i.blending=this.blending),this.side!==x&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t){let t=r(e.textures),n=r(e.images);t.length>0&&(i.textures=t),n.length>0&&(i.images=n)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,i=null;if(null!==t){let e=t.length;i=Array(e);for(let r=0;r!==e;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class r4 extends r3{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new iB(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Q,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}let r6=new iQ,r9=new iv;class r8{constructor(e,t,i){if(Array.isArray(e))throw TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.usage=tQ,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,n=this.itemSize;r<n;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)r9.fromBufferAttribute(this,t),r9.applyMatrix3(e),this.setXY(t,r9.x,r9.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)r6.fromBufferAttribute(this,t),r6.applyMatrix3(e),this.setXYZ(t,r6.x,r6.y,r6.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)r6.fromBufferAttribute(this,t),r6.applyMatrix4(e),this.setXYZ(t,r6.x,r6.y,r6.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)r6.fromBufferAttribute(this,t),r6.applyNormalMatrix(e),this.setXYZ(t,r6.x,r6.y,r6.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)r6.fromBufferAttribute(this,t),r6.transformDirection(e),this.setXYZ(t,r6.x,r6.y,r6.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=ix(t,this.array)),t}setX(e,t){return this.normalized&&(t=iw(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=ix(t,this.array)),t}setY(e,t){return this.normalized&&(t=iw(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=ix(t,this.array)),t}setZ(e,t){return this.normalized&&(t=iw(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=ix(t,this.array)),t}setW(e,t){return this.normalized&&(t=iw(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=iw(t,this.array),i=iw(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=iw(t,this.array),i=iw(i,this.array),r=iw(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,n){return e*=this.itemSize,this.normalized&&(t=iw(t,this.array),i=iw(i,this.array),r=iw(r,this.array),n=iw(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=n,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==tQ&&(e.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class r7 extends r8{constructor(e,t,i){super(new Int8Array(e),t,i)}}class ne extends r8{constructor(e,t,i){super(new Uint8Array(e),t,i)}}class nt extends r8{constructor(e,t,i){super(new Uint8ClampedArray(e),t,i)}}class ni extends r8{constructor(e,t,i){super(new Int16Array(e),t,i)}}class nr extends r8{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class nn extends r8{constructor(e,t,i){super(new Int32Array(e),t,i)}}class no extends r8{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class na extends r8{constructor(e,t,i){super(new Uint16Array(e),t,i),this.isFloat16BufferAttribute=!0}}class ns extends r8{constructor(e,t,i){super(new Float32Array(e),t,i)}}class nl extends r8{constructor(e,t,i){super(new Float64Array(e),t,i)}}let nh=0,nc=new rw,nd=new rH,nu=new iQ,np=new i0,nm=new i0,nf=new iQ;class ng extends ie{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:nh++}),this.uuid=ia(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(iS(e)?no:nr)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);let i=this.attributes.normal;if(void 0!==i){let t=new iM().getNormalMatrix(e);i.applyNormalMatrix(t),i.needsUpdate=!0}let r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return nc.makeRotationFromQuaternion(e),this.applyMatrix4(nc),this}rotateX(e){return nc.makeRotationX(e),this.applyMatrix4(nc),this}rotateY(e){return nc.makeRotationY(e),this.applyMatrix4(nc),this}rotateZ(e){return nc.makeRotationZ(e),this.applyMatrix4(nc),this}translate(e,t,i){return nc.makeTranslation(e,t,i),this.applyMatrix4(nc),this}scale(e,t,i){return nc.makeScale(e,t,i),this.applyMatrix4(nc),this}lookAt(e){return nd.lookAt(e),nd.updateMatrix(),this.applyMatrix4(nd.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(nu).negate(),this.translate(nu.x,nu.y,nu.z),this}setFromPoints(e){let t=[];for(let i=0,r=e.length;i<r;i++){let r=e[i];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new ns(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new i0);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new iQ(-1/0,-1/0,-1/0),new iQ(1/0,1/0,1/0));return}if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){let i=t[e];np.setFromBufferAttribute(i),this.morphTargetsRelative?(nf.addVectors(this.boundingBox.min,np.min),this.boundingBox.expandByPoint(nf),nf.addVectors(this.boundingBox.max,np.max),this.boundingBox.expandByPoint(nf)):(this.boundingBox.expandByPoint(np.min),this.boundingBox.expandByPoint(np.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new rc);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new iQ,1/0);return}if(e){let i=this.boundingSphere.center;if(np.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){let i=t[e];nm.setFromBufferAttribute(i),this.morphTargetsRelative?(nf.addVectors(np.min,nm.min),np.expandByPoint(nf),nf.addVectors(np.max,nm.max),np.expandByPoint(nf)):(np.expandByPoint(nm.min),np.expandByPoint(nm.max))}np.getCenter(i);let r=0;for(let t=0,n=e.count;t<n;t++)nf.fromBufferAttribute(e,t),r=Math.max(r,i.distanceToSquared(nf));if(t)for(let n=0,o=t.length;n<o;n++){let o=t[n],a=this.morphTargetsRelative;for(let t=0,n=o.count;t<n;t++)nf.fromBufferAttribute(o,t),a&&(nu.fromBufferAttribute(e,t),nf.add(nu)),r=Math.max(r,i.distanceToSquared(nf))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let i=e.array,r=t.position.array,n=t.normal.array,o=t.uv.array,a=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new r8(new Float32Array(4*a),4));let s=this.getAttribute("tangent").array,l=[],h=[];for(let e=0;e<a;e++)l[e]=new iQ,h[e]=new iQ;let c=new iQ,d=new iQ,u=new iQ,p=new iv,m=new iv,f=new iv,g=new iQ,y=new iQ;function x(e,t,i){c.fromArray(r,3*e),d.fromArray(r,3*t),u.fromArray(r,3*i),p.fromArray(o,2*e),m.fromArray(o,2*t),f.fromArray(o,2*i),d.sub(c),u.sub(c),m.sub(p),f.sub(p);let n=1/(m.x*f.y-f.x*m.y);isFinite(n)&&(g.copy(d).multiplyScalar(f.y).addScaledVector(u,-m.y).multiplyScalar(n),y.copy(u).multiplyScalar(m.x).addScaledVector(d,-f.x).multiplyScalar(n),l[e].add(g),l[t].add(g),l[i].add(g),h[e].add(y),h[t].add(y),h[i].add(y))}let w=this.groups;0===w.length&&(w=[{start:0,count:i.length}]);for(let e=0,t=w.length;e<t;++e){let t=w[e],r=t.start,n=t.count;for(let e=r,t=r+n;e<t;e+=3)x(i[e+0],i[e+1],i[e+2])}let b=new iQ,v=new iQ,M=new iQ,S=new iQ;function P(e){M.fromArray(n,3*e),S.copy(M);let t=l[e];b.copy(t),b.sub(M.multiplyScalar(M.dot(t))).normalize(),v.crossVectors(S,t);let i=v.dot(h[e]),r=i<0?-1:1;s[4*e]=b.x,s[4*e+1]=b.y,s[4*e+2]=b.z,s[4*e+3]=r}for(let e=0,t=w.length;e<t;++e){let t=w[e],r=t.start,n=t.count;for(let e=r,t=r+n;e<t;e+=3)P(i[e+0]),P(i[e+1]),P(i[e+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new r8(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let e=0,t=i.count;e<t;e++)i.setXYZ(e,0,0,0);let r=new iQ,n=new iQ,o=new iQ,a=new iQ,s=new iQ,l=new iQ,h=new iQ,c=new iQ;if(e)for(let d=0,u=e.count;d<u;d+=3){let u=e.getX(d+0),p=e.getX(d+1),m=e.getX(d+2);r.fromBufferAttribute(t,u),n.fromBufferAttribute(t,p),o.fromBufferAttribute(t,m),h.subVectors(o,n),c.subVectors(r,n),h.cross(c),a.fromBufferAttribute(i,u),s.fromBufferAttribute(i,p),l.fromBufferAttribute(i,m),a.add(h),s.add(h),l.add(h),i.setXYZ(u,a.x,a.y,a.z),i.setXYZ(p,s.x,s.y,s.z),i.setXYZ(m,l.x,l.y,l.z)}else for(let e=0,a=t.count;e<a;e+=3)r.fromBufferAttribute(t,e+0),n.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),h.subVectors(o,n),c.subVectors(r,n),h.cross(c),i.setXYZ(e+0,h.x,h.y,h.z),i.setXYZ(e+1,h.x,h.y,h.z),i.setXYZ(e+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)nf.fromBufferAttribute(e,t),nf.normalize(),e.setXYZ(t,nf.x,nf.y,nf.z)}toNonIndexed(){function e(e,t){let i=e.array,r=e.itemSize,n=e.normalized,o=new i.constructor(t.length*r),a=0,s=0;for(let n=0,l=t.length;n<l;n++){a=e.isInterleavedBufferAttribute?t[n]*e.data.stride+e.offset:t[n]*r;for(let e=0;e<r;e++)o[s++]=i[a++]}return new r8(o,r,n)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new ng,i=this.index.array,r=this.attributes;for(let n in r){let o=r[n],a=e(o,i);t.setAttribute(n,a)}let n=this.morphAttributes;for(let r in n){let o=[],a=n[r];for(let t=0,r=a.length;t<r;t++){let r=a[t],n=e(r,i);o.push(n)}t.morphAttributes[r]=o}t.morphTargetsRelative=this.morphTargetsRelative;let o=this.groups;for(let e=0,i=o.length;e<i;e++){let i=o[e];t.addGroup(i.start,i.count,i.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){let t=this.parameters;for(let i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};let t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let i=this.attributes;for(let t in i){let r=i[t];e.data.attributes[t]=r.toJSON(e.data)}let r={},n=!1;for(let t in this.morphAttributes){let i=this.morphAttributes[t],o=[];for(let t=0,r=i.length;t<r;t++){let r=i[t];o.push(r.toJSON(e.data))}o.length>0&&(r[t]=o,n=!0)}n&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);let o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));let a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let i=e.index;null!==i&&this.setIndex(i.clone(t));let r=e.attributes;for(let e in r){let i=r[e];this.setAttribute(e,i.clone(t))}let n=e.morphAttributes;for(let e in n){let i=[],r=n[e];for(let e=0,n=r.length;e<n;e++)i.push(r[e].clone(t));this.morphAttributes[e]=i}this.morphTargetsRelative=e.morphTargetsRelative;let o=e.groups;for(let e=0,t=o.length;e<t;e++){let t=o[e];this.addGroup(t.start,t.count,t.materialIndex)}let a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());let s=e.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}let ny=new rw,nx=new rx,nw=new rc,nb=new iQ,nv=new iQ,nM=new iQ,nS=new iQ,nP=new iQ,nT=new iQ,n_=new iQ,nC=new iQ,nD=new iQ,nA=new iv,nE=new iv,nL=new iv,nI=new iQ,nR=new iQ;class nW extends rH{constructor(e=new ng,t=new r4){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry,t=e.morphAttributes,i=Object.keys(t);if(i.length>0){let e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){let i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}raycast(e,t){let i;let r=this.geometry,n=this.material,o=this.matrixWorld;if(void 0===n||(null===r.boundingSphere&&r.computeBoundingSphere(),nw.copy(r.boundingSphere),nw.applyMatrix4(o),!1===e.ray.intersectsSphere(nw))||(ny.copy(o).invert(),nx.copy(e.ray).applyMatrix4(ny),null!==r.boundingBox&&!1===nx.intersectsBox(r.boundingBox)))return;let a=r.index,s=r.attributes.position,l=r.morphAttributes.position,h=r.morphTargetsRelative,c=r.attributes.uv,d=r.attributes.uv2,u=r.groups,p=r.drawRange;if(null!==a){if(Array.isArray(n))for(let r=0,o=u.length;r<o;r++){let o=u[r],m=n[o.materialIndex],f=Math.max(o.start,p.start),g=Math.min(a.count,Math.min(o.start+o.count,p.start+p.count));for(let r=f,n=g;r<n;r+=3){let n=a.getX(r),u=a.getX(r+1),p=a.getX(r+2);(i=nk(this,m,e,nx,s,l,h,c,d,n,u,p))&&(i.faceIndex=Math.floor(r/3),i.face.materialIndex=o.materialIndex,t.push(i))}}else{let r=Math.max(0,p.start),o=Math.min(a.count,p.start+p.count);for(let u=r,p=o;u<p;u+=3){let r=a.getX(u),o=a.getX(u+1),p=a.getX(u+2);(i=nk(this,n,e,nx,s,l,h,c,d,r,o,p))&&(i.faceIndex=Math.floor(u/3),t.push(i))}}}else if(void 0!==s){if(Array.isArray(n))for(let r=0,o=u.length;r<o;r++){let o=u[r],a=n[o.materialIndex],m=Math.max(o.start,p.start),f=Math.min(s.count,Math.min(o.start+o.count,p.start+p.count));for(let r=m,n=f;r<n;r+=3){let n=r,u=r+1,p=r+2;(i=nk(this,a,e,nx,s,l,h,c,d,n,u,p))&&(i.faceIndex=Math.floor(r/3),i.face.materialIndex=o.materialIndex,t.push(i))}}else{let r=Math.max(0,p.start),o=Math.min(s.count,p.start+p.count);for(let a=r,u=o;a<u;a+=3){let r=a,o=a+1,u=a+2;(i=nk(this,n,e,nx,s,l,h,c,d,r,o,u))&&(i.faceIndex=Math.floor(a/3),t.push(i))}}}}}function nV(e,t,i,r,n,o,a,s){let l;if(null===(l=t.side===w?r.intersectTriangle(a,o,n,!0,s):r.intersectTriangle(n,o,a,t.side!==b,s)))return null;nR.copy(s),nR.applyMatrix4(e.matrixWorld);let h=i.ray.origin.distanceTo(nR);return h<i.near||h>i.far?null:{distance:h,point:nR.clone(),object:e}}function nk(e,t,i,r,n,o,a,s,l,h,c,d){nb.fromBufferAttribute(n,h),nv.fromBufferAttribute(n,c),nM.fromBufferAttribute(n,d);let u=e.morphTargetInfluences;if(o&&u){n_.set(0,0,0),nC.set(0,0,0),nD.set(0,0,0);for(let e=0,t=o.length;e<t;e++){let t=u[e],i=o[e];0!==t&&(nS.fromBufferAttribute(i,h),nP.fromBufferAttribute(i,c),nT.fromBufferAttribute(i,d),a?(n_.addScaledVector(nS,t),nC.addScaledVector(nP,t),nD.addScaledVector(nT,t)):(n_.addScaledVector(nS.sub(nb),t),nC.addScaledVector(nP.sub(nv),t),nD.addScaledVector(nT.sub(nM),t)))}nb.add(n_),nv.add(nC),nM.add(nD)}e.isSkinnedMesh&&(e.boneTransform(h,nb),e.boneTransform(c,nv),e.boneTransform(d,nM));let p=nV(e,t,i,r,nb,nv,nM,nI);if(p){s&&(nA.fromBufferAttribute(s,h),nE.fromBufferAttribute(s,c),nL.fromBufferAttribute(s,d),p.uv=r1.getUV(nI,nb,nv,nM,nA,nE,nL,new iv)),l&&(nA.fromBufferAttribute(l,h),nE.fromBufferAttribute(l,c),nL.fromBufferAttribute(l,d),p.uv2=r1.getUV(nI,nb,nv,nM,nA,nE,nL,new iv));let e={a:h,b:c,c:d,normal:new iQ,materialIndex:0};r1.getNormal(nb,nv,nM,e.normal),p.face=e}return p}class nB extends ng{constructor(e=1,t=1,i=1,r=1,n=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:o};let a=this;r=Math.floor(r),n=Math.floor(n),o=Math.floor(o);let s=[],l=[],h=[],c=[],d=0,u=0;function p(e,t,i,r,n,o,p,m,f,g,y){let x=o/f,w=p/g,b=o/2,v=p/2,M=m/2,S=f+1,P=g+1,T=0,_=0,C=new iQ;for(let o=0;o<P;o++){let a=o*w-v;for(let s=0;s<S;s++){let d=s*x-b;C[e]=d*r,C[t]=a*n,C[i]=M,l.push(C.x,C.y,C.z),C[e]=0,C[t]=0,C[i]=m>0?1:-1,h.push(C.x,C.y,C.z),c.push(s/f),c.push(1-o/g),T+=1}}for(let e=0;e<g;e++)for(let t=0;t<f;t++){let i=d+t+S*e,r=d+t+S*(e+1),n=d+(t+1)+S*(e+1),o=d+(t+1)+S*e;s.push(i,r,o),s.push(r,n,o),_+=6}a.addGroup(u,_,y),u+=_,d+=T}p("z","y","x",-1,-1,i,t,e,o,n,0),p("z","y","x",1,-1,i,t,-e,o,n,1),p("x","z","y",1,1,e,i,t,r,o,2),p("x","z","y",1,-1,e,i,-t,r,o,3),p("x","y","z",1,-1,e,t,i,r,n,4),p("x","y","z",-1,-1,e,t,-i,r,n,5),this.setIndex(s),this.setAttribute("position",new ns(l,3)),this.setAttribute("normal",new ns(h,3)),this.setAttribute("uv",new ns(c,2))}static fromJSON(e){return new nB(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function nO(e){let t={};for(let i in e)for(let r in t[i]={},e[i]){let n=e[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}return t}function nF(e){let t={};for(let i=0;i<e.length;i++){let r=nO(e[i]);for(let e in r)t[e]=r[e]}return t}function nz(e){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}let nU={clone:nO,merge:nF};var nN="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",nG="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";class nH extends r3{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=nN,this.fragmentShader=nG,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=nO(e.uniforms),this.uniformsGroups=nz(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);for(let i in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){let r=this.uniforms[i],n=r.value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let i={};for(let e in this.extensions)!0===this.extensions[e]&&(i[e]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class nj extends rH{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new rw,this.projectionMatrix=new rw,this.projectionMatrixInverse=new rw}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class nq extends nj{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=2*io*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(.5*ir*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*io*Math.atan(Math.tan(.5*ir*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,n,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(.5*ir*this.fov)/this.zoom,i=2*t,r=this.aspect*i,n=-.5*r,o=this.view;if(null!==this.view&&this.view.enabled){let e=o.fullWidth,a=o.fullHeight;n+=o.offsetX*r/e,t-=o.offsetY*i/a,r*=o.width/e,i*=o.height/a}let a=this.filmOffset;0!==a&&(n+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}let nX=90,nY=1;class nJ extends rH{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;let r=new nq(nX,nY,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new iQ(1,0,0)),this.add(r);let n=new nq(nX,nY,e,t);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new iQ(-1,0,0)),this.add(n);let o=new nq(nX,nY,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new iQ(0,1,0)),this.add(o);let a=new nq(nX,nY,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new iQ(0,-1,0)),this.add(a);let s=new nq(nX,nY,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new iQ(0,0,1)),this.add(s);let l=new nq(nX,nY,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new iQ(0,0,-1)),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();let i=this.renderTarget,[r,n,o,a,s,l]=this.children,h=e.getRenderTarget(),c=e.toneMapping,d=e.xr.enabled;e.toneMapping=et,e.xr.enabled=!1;let u=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,n),e.setRenderTarget(i,2),e.render(t,o),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,s),i.texture.generateMipmaps=u,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(h),e.toneMapping=c,e.xr.enabled=d,i.texture.needsPMREMUpdate=!0}}class nZ extends iN{constructor(e,t,i,r,n,o,a,s,l,h){super(e=void 0!==e?e:[],t=void 0!==t?t:el,i,r,n,o,a,s,l,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class nQ extends iH{constructor(e,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;let i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new nZ(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:ev}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new nB(5,5,5),n=new nH({name:"CubemapFromEquirect",uniforms:nO(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:w,blending:v});n.uniforms.tEquirect.value=t;let o=new nW(r,n),a=t.minFilter;t.minFilter===eP&&(t.minFilter=ev);let s=new nJ(1,10,this);return s.update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,r){let n=e.getRenderTarget();for(let n=0;n<6;n++)e.setRenderTarget(this,n),e.clear(t,i,r);e.setRenderTarget(n)}}let nK=new iQ,n$=new iQ,n0=new iM;class n2{constructor(e=new iQ(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){let r=nK.subVectors(i,t).cross(n$.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let i=e.delta(nK),r=this.normal.dot(i);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;let n=-(e.start.dot(this.normal)+this.constant)/r;return n<0||n>1?null:t.copy(i).multiplyScalar(n).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let i=t||n0.getNormalMatrix(e),r=this.coplanarPoint(nK).applyMatrix4(e),n=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(n),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}let n3=new rc,n4=new iQ;class n5{constructor(e=new n2,t=new n2,i=new n2,r=new n2,n=new n2,o=new n2){this.planes=[e,t,i,r,n,o]}set(e,t,i,r,n,o){let a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(n),a[5].copy(o),this}copy(e){let t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){let t=this.planes,i=e.elements,r=i[0],n=i[1],o=i[2],a=i[3],s=i[4],l=i[5],h=i[6],c=i[7],d=i[8],u=i[9],p=i[10],m=i[11],f=i[12],g=i[13],y=i[14],x=i[15];return t[0].setComponents(a-r,c-s,m-d,x-f).normalize(),t[1].setComponents(a+r,c+s,m+d,x+f).normalize(),t[2].setComponents(a+n,c+l,m+u,x+g).normalize(),t[3].setComponents(a-n,c-l,m-u,x-g).normalize(),t[4].setComponents(a-o,c-h,m-p,x-y).normalize(),t[5].setComponents(a+o,c+h,m+p,x+y).normalize(),this}intersectsObject(e){let t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),n3.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(n3)}intersectsSprite(e){return n3.center.set(0,0,0),n3.radius=.7071067811865476,n3.applyMatrix4(e.matrixWorld),this.intersectsSphere(n3)}intersectsSphere(e){let t=this.planes,i=e.center,r=-e.radius;for(let e=0;e<6;e++){let n=t[e].distanceToPoint(i);if(n<r)return!1}return!0}intersectsBox(e){let t=this.planes;for(let i=0;i<6;i++){let r=t[i];if(n4.x=r.normal.x>0?e.max.x:e.min.x,n4.y=r.normal.y>0?e.max.y:e.min.y,n4.z=r.normal.z>0?e.max.z:e.min.z,0>r.distanceToPoint(n4))return!1}return!0}containsPoint(e){let t=this.planes;for(let i=0;i<6;i++)if(0>t[i].distanceToPoint(e))return!1;return!0}clone(){return new this.constructor().copy(this)}}function n6(){let e=null,t=!1,i=null,r=null;function n(t,o){i(t,o),r=e.requestAnimationFrame(n)}return{start:function(){!0!==t&&null!==i&&(r=e.requestAnimationFrame(n),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){i=e},setContext:function(t){e=t}}}function n9(e,t){let i=t.isWebGL2,r=new WeakMap;function n(t,r){let n;let o=t.array,a=t.usage,s=e.createBuffer();if(e.bindBuffer(r,s),e.bufferData(r,o,a),t.onUploadCallback(),o instanceof Float32Array)n=5126;else if(o instanceof Uint16Array){if(t.isFloat16BufferAttribute){if(i)n=5131;else throw Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.")}else n=5123}else if(o instanceof Int16Array)n=5122;else if(o instanceof Uint32Array)n=5125;else if(o instanceof Int32Array)n=5124;else if(o instanceof Int8Array)n=5120;else if(o instanceof Uint8Array)n=5121;else if(o instanceof Uint8ClampedArray)n=5121;else throw Error("THREE.WebGLAttributes: Unsupported buffer data format: "+o);return{buffer:s,type:n,bytesPerElement:o.BYTES_PER_ELEMENT,version:t.version}}function o(t,r,n){let o=r.array,a=r.updateRange;e.bindBuffer(n,t),-1===a.count?e.bufferSubData(n,0,o):(i?e.bufferSubData(n,a.offset*o.BYTES_PER_ELEMENT,o,a.offset,a.count):e.bufferSubData(n,a.offset*o.BYTES_PER_ELEMENT,o.subarray(a.offset,a.offset+a.count)),a.count=-1)}return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);let i=r.get(t);i&&(e.deleteBuffer(i.buffer),r.delete(t))},update:function(e,t){if(e.isGLBufferAttribute){let t=r.get(e);(!t||t.version<e.version)&&r.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version});return}e.isInterleavedBufferAttribute&&(e=e.data);let i=r.get(e);void 0===i?r.set(e,n(e,t)):i.version<e.version&&(o(i.buffer,e,t),i.version=e.version)}}}class n8 extends ng{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};let n=e/2,o=t/2,a=Math.floor(i),s=Math.floor(r),l=a+1,h=s+1,c=e/a,d=t/s,u=[],p=[],m=[],f=[];for(let e=0;e<h;e++){let t=e*d-o;for(let i=0;i<l;i++){let r=i*c-n;p.push(r,-t,0),m.push(0,0,1),f.push(i/a),f.push(1-e/s)}}for(let e=0;e<s;e++)for(let t=0;t<a;t++){let i=t+l*e,r=t+l*(e+1),n=t+1+l*(e+1),o=t+1+l*e;u.push(i,r,o),u.push(r,n,o)}this.setIndex(u),this.setAttribute("position",new ns(p,3)),this.setAttribute("normal",new ns(m,3)),this.setAttribute("uv",new ns(f,2))}static fromJSON(e){return new n8(e.width,e.height,e.widthSegments,e.heightSegments)}}var n7="#ifdef USE_ALPHAMAP\n	diffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",oe="#ifdef USE_ALPHAMAP\n	uniform sampler2D alphaMap;\n#endif",ot="#ifdef USE_ALPHATEST\n	if ( diffuseColor.a < alphaTest ) discard;\n#endif",oi="#ifdef USE_ALPHATEST\n	uniform float alphaTest;\n#endif",or="#ifdef USE_AOMAP\n	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n	reflectedLight.indirectDiffuse *= ambientOcclusion;\n	#if defined( USE_ENVMAP ) && defined( STANDARD )\n		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n	#endif\n#endif",on="#ifdef USE_AOMAP\n	uniform sampler2D aoMap;\n	uniform float aoMapIntensity;\n#endif",oo="vec3 transformed = vec3( position );",oa="vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n	vec3 objectTangent = vec3( tangent.xyz );\n#endif",os="vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n	return RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n	float a2 = pow2( alpha );\n	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n	return 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n	float a2 = pow2( alpha );\n	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n	return RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n	float alpha = pow2( roughness );\n	vec3 halfDir = normalize( lightDir + viewDir );\n	float dotNL = saturate( dot( normal, lightDir ) );\n	float dotNV = saturate( dot( normal, viewDir ) );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float dotVH = saturate( dot( viewDir, halfDir ) );\n	vec3 F = F_Schlick( f0, f90, dotVH );\n	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n	float D = D_GGX( alpha, dotNH );\n	return F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n		float alpha = pow2( roughness );\n		vec3 halfDir = normalize( lightDir + viewDir );\n		float dotNL = saturate( dot( normal, lightDir ) );\n		float dotNV = saturate( dot( normal, viewDir ) );\n		float dotNH = saturate( dot( normal, halfDir ) );\n		float dotVH = saturate( dot( viewDir, halfDir ) );\n		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n		float D = D_GGX( alpha, dotNH );\n		return F * ( V * D );\n	}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n	const float LUT_SIZE = 64.0;\n	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n	const float LUT_BIAS = 0.5 / LUT_SIZE;\n	float dotNV = saturate( dot( N, V ) );\n	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n	uv = uv * LUT_SCALE + LUT_BIAS;\n	return uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n	float l = length( f );\n	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n	float x = dot( v1, v2 );\n	float y = abs( x );\n	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n	float b = 3.4175940 + ( 4.1616724 + y ) * y;\n	float v = a / b;\n	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n	return cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n	vec3 lightNormal = cross( v1, v2 );\n	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n	vec3 T1, T2;\n	T1 = normalize( V - N * dot( V, N ) );\n	T2 = - cross( N, T1 );\n	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n	vec3 coords[ 4 ];\n	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n	coords[ 0 ] = normalize( coords[ 0 ] );\n	coords[ 1 ] = normalize( coords[ 1 ] );\n	coords[ 2 ] = normalize( coords[ 2 ] );\n	coords[ 3 ] = normalize( coords[ 3 ] );\n	vec3 vectorFormFactor = vec3( 0.0 );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n	return vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n	return 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n	vec3 halfDir = normalize( lightDir + viewDir );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float dotVH = saturate( dot( viewDir, halfDir ) );\n	vec3 F = F_Schlick( specularColor, 1.0, dotVH );\n	float G = G_BlinnPhong_Implicit( );\n	float D = D_BlinnPhong( shininess, dotNH );\n	return F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n	float alpha = pow2( roughness );\n	float invAlpha = 1.0 / alpha;\n	float cos2h = dotNH * dotNH;\n	float sin2h = max( 1.0 - cos2h, 0.0078125 );\n	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n	vec3 halfDir = normalize( lightDir + viewDir );\n	float dotNL = saturate( dot( normal, lightDir ) );\n	float dotNV = saturate( dot( normal, viewDir ) );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float D = D_Charlie( sheenRoughness, dotNH );\n	float V = V_Neubelt( dotNV, dotNL );\n	return sheenColor * ( D * V );\n}\n#endif",ol="#ifdef USE_IRIDESCENCE\n	const mat3 XYZ_TO_REC709 = mat3(\n		 3.2404542, -0.9692660,  0.0556434,\n		-1.5371385,  1.8760108, -0.2040259,\n		-0.4985314,  0.0415560,  1.0572252\n	);\n	vec3 Fresnel0ToIor( vec3 fresnel0 ) {\n		vec3 sqrtF0 = sqrt( fresnel0 );\n		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n	}\n	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n	}\n	float IorToFresnel0( float transmittedIor, float incidentIor ) {\n		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n	}\n	vec3 evalSensitivity( float OPD, vec3 shift ) {\n		float phase = 2.0 * PI * OPD * 1.0e-9;\n		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n		xyz /= 1.0685e-7;\n		vec3 rgb = XYZ_TO_REC709 * xyz;\n		return rgb;\n	}\n	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n		vec3 I;\n		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n		float cosTheta2Sq = 1.0 - sinTheta2Sq;\n		if ( cosTheta2Sq < 0.0 ) {\n			 return vec3( 1.0 );\n		}\n		float cosTheta2 = sqrt( cosTheta2Sq );\n		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n		float R12 = F_Schlick( R0, 1.0, cosTheta1 );\n		float R21 = R12;\n		float T121 = 1.0 - R12;\n		float phi12 = 0.0;\n		if ( iridescenceIOR < outsideIOR ) phi12 = PI;\n		float phi21 = PI - phi12;\n		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n		vec3 phi23 = vec3( 0.0 );\n		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n		vec3 phi = vec3( phi21 ) + phi23;\n		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n		vec3 r123 = sqrt( R123 );\n		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n		vec3 C0 = R12 + Rs;\n		I = C0;\n		vec3 Cm = Rs - T121;\n		for ( int m = 1; m <= 2; ++ m ) {\n			Cm *= r123;\n			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n			I += Cm * Sm;\n		}\n		return max( I, vec3( 0.0 ) );\n	}\n#endif",oh="#ifdef USE_BUMPMAP\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n	vec2 dHdxy_fwd() {\n		vec2 dSTdx = dFdx( vUv );\n		vec2 dSTdy = dFdy( vUv );\n		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n		return vec2( dBx, dBy );\n	}\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n		vec3 vSigmaX = dFdx( surf_pos.xyz );\n		vec3 vSigmaY = dFdy( surf_pos.xyz );\n		vec3 vN = surf_norm;\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n		float fDet = dot( vSigmaX, R1 ) * faceDirection;\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n	}\n#endif",oc="#if NUM_CLIPPING_PLANES > 0\n	vec4 plane;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n		plane = clippingPlanes[ i ];\n		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n	}\n	#pragma unroll_loop_end\n	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n		bool clipped = true;\n		#pragma unroll_loop_start\n		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n			plane = clippingPlanes[ i ];\n			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n		}\n		#pragma unroll_loop_end\n		if ( clipped ) discard;\n	#endif\n#endif",od="#if NUM_CLIPPING_PLANES > 0\n	varying vec3 vClipPosition;\n	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",ou="#if NUM_CLIPPING_PLANES > 0\n	varying vec3 vClipPosition;\n#endif",op="#if NUM_CLIPPING_PLANES > 0\n	vClipPosition = - mvPosition.xyz;\n#endif",om="#if defined( USE_COLOR_ALPHA )\n	diffuseColor *= vColor;\n#elif defined( USE_COLOR )\n	diffuseColor.rgb *= vColor;\n#endif",of="#if defined( USE_COLOR_ALPHA )\n	varying vec4 vColor;\n#elif defined( USE_COLOR )\n	varying vec3 vColor;\n#endif",og="#if defined( USE_COLOR_ALPHA )\n	varying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n	varying vec3 vColor;\n#endif",oy="#if defined( USE_COLOR_ALPHA )\n	vColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n	vColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n	vColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n	vColor.xyz *= instanceColor.xyz;\n#endif",ox="#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n	const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n	return fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n	float precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n	float precisionSafeLength( vec3 v ) {\n		float maxComponent = max3( abs( v ) );\n		return length( v / maxComponent ) * maxComponent;\n	}\n#endif\nstruct IncidentLight {\n	vec3 color;\n	vec3 direction;\n	bool visible;\n};\nstruct ReflectedLight {\n	vec3 directDiffuse;\n	vec3 directSpecular;\n	vec3 indirectDiffuse;\n	vec3 indirectSpecular;\n};\nstruct GeometricContext {\n	vec3 position;\n	vec3 normal;\n	vec3 viewDir;\n#ifdef USE_CLEARCOAT\n	vec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n	mat3 tmp;\n	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n	return tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n	return dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n	return m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n	return vec2( u, v );\n}",ow="#ifdef ENVMAP_TYPE_CUBE_UV\n	#define cubeUV_minMipLevel 4.0\n	#define cubeUV_minTileSize 16.0\n	float getFace( vec3 direction ) {\n		vec3 absDirection = abs( direction );\n		float face = - 1.0;\n		if ( absDirection.x > absDirection.z ) {\n			if ( absDirection.x > absDirection.y )\n				face = direction.x > 0.0 ? 0.0 : 3.0;\n			else\n				face = direction.y > 0.0 ? 1.0 : 4.0;\n		} else {\n			if ( absDirection.z > absDirection.y )\n				face = direction.z > 0.0 ? 2.0 : 5.0;\n			else\n				face = direction.y > 0.0 ? 1.0 : 4.0;\n		}\n		return face;\n	}\n	vec2 getUV( vec3 direction, float face ) {\n		vec2 uv;\n		if ( face == 0.0 ) {\n			uv = vec2( direction.z, direction.y ) / abs( direction.x );\n		} else if ( face == 1.0 ) {\n			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n		} else if ( face == 2.0 ) {\n			uv = vec2( - direction.x, direction.y ) / abs( direction.z );\n		} else if ( face == 3.0 ) {\n			uv = vec2( - direction.z, direction.y ) / abs( direction.x );\n		} else if ( face == 4.0 ) {\n			uv = vec2( - direction.x, direction.z ) / abs( direction.y );\n		} else {\n			uv = vec2( direction.x, direction.y ) / abs( direction.z );\n		}\n		return 0.5 * ( uv + 1.0 );\n	}\n	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n		float face = getFace( direction );\n		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n		mipInt = max( mipInt, cubeUV_minMipLevel );\n		float faceSize = exp2( mipInt );\n		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n		if ( face > 2.0 ) {\n			uv.y += faceSize;\n			face -= 3.0;\n		}\n		uv.x += face * faceSize;\n		uv.x += filterInt * 3.0 * cubeUV_minTileSize;\n		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n		uv.x *= CUBEUV_TEXEL_WIDTH;\n		uv.y *= CUBEUV_TEXEL_HEIGHT;\n		#ifdef texture2DGradEXT\n			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n		#else\n			return texture2D( envMap, uv ).rgb;\n		#endif\n	}\n	#define cubeUV_r0 1.0\n	#define cubeUV_v0 0.339\n	#define cubeUV_m0 - 2.0\n	#define cubeUV_r1 0.8\n	#define cubeUV_v1 0.276\n	#define cubeUV_m1 - 1.0\n	#define cubeUV_r4 0.4\n	#define cubeUV_v4 0.046\n	#define cubeUV_m4 2.0\n	#define cubeUV_r5 0.305\n	#define cubeUV_v5 0.016\n	#define cubeUV_m5 3.0\n	#define cubeUV_r6 0.21\n	#define cubeUV_v6 0.0038\n	#define cubeUV_m6 4.0\n	float roughnessToMip( float roughness ) {\n		float mip = 0.0;\n		if ( roughness >= cubeUV_r1 ) {\n			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n		} else if ( roughness >= cubeUV_r4 ) {\n			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n		} else if ( roughness >= cubeUV_r5 ) {\n			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n		} else if ( roughness >= cubeUV_r6 ) {\n			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n		} else {\n			mip = - 2.0 * log2( 1.16 * roughness );		}\n		return mip;\n	}\n	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n		float mipF = fract( mip );\n		float mipInt = floor( mip );\n		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n		if ( mipF == 0.0 ) {\n			return vec4( color0, 1.0 );\n		} else {\n			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n			return vec4( mix( color0, color1, mipF ), 1.0 );\n		}\n	}\n#endif",ob="vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n	mat3 m = mat3( instanceMatrix );\n	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n	transformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n	transformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n	#ifdef FLIP_SIDED\n		transformedTangent = - transformedTangent;\n	#endif\n#endif",ov="#ifdef USE_DISPLACEMENTMAP\n	uniform sampler2D displacementMap;\n	uniform float displacementScale;\n	uniform float displacementBias;\n#endif",oM="#ifdef USE_DISPLACEMENTMAP\n	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",oS="#ifdef USE_EMISSIVEMAP\n	vec4 emissiveColor = texture2D( emissiveMap, vUv );\n	totalEmissiveRadiance *= emissiveColor.rgb;\n#endif",oP="#ifdef USE_EMISSIVEMAP\n	uniform sampler2D emissiveMap;\n#endif",oT="gl_FragColor = linearToOutputTexel( gl_FragColor );",o_="vec4 LinearToLinear( in vec4 value ) {\n	return value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",oC="#ifdef USE_ENVMAP\n	#ifdef ENV_WORLDPOS\n		vec3 cameraToFrag;\n		if ( isOrthographic ) {\n			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n		} else {\n			cameraToFrag = normalize( vWorldPosition - cameraPosition );\n		}\n		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n		#ifdef ENVMAP_MODE_REFLECTION\n			vec3 reflectVec = reflect( cameraToFrag, worldNormal );\n		#else\n			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n		#endif\n	#else\n		vec3 reflectVec = vReflect;\n	#endif\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n	#elif defined( ENVMAP_TYPE_CUBE_UV )\n		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n	#else\n		vec4 envColor = vec4( 0.0 );\n	#endif\n	#ifdef ENVMAP_BLENDING_MULTIPLY\n		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n	#elif defined( ENVMAP_BLENDING_MIX )\n		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n	#elif defined( ENVMAP_BLENDING_ADD )\n		outgoingLight += envColor.xyz * specularStrength * reflectivity;\n	#endif\n#endif",oD="#ifdef USE_ENVMAP\n	uniform float envMapIntensity;\n	uniform float flipEnvMap;\n	#ifdef ENVMAP_TYPE_CUBE\n		uniform samplerCube envMap;\n	#else\n		uniform sampler2D envMap;\n	#endif\n	\n#endif",oA="#ifdef USE_ENVMAP\n	uniform float reflectivity;\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n		#define ENV_WORLDPOS\n	#endif\n	#ifdef ENV_WORLDPOS\n		varying vec3 vWorldPosition;\n		uniform float refractionRatio;\n	#else\n		varying vec3 vReflect;\n	#endif\n#endif",oE="#ifdef USE_ENVMAP\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n		#define ENV_WORLDPOS\n	#endif\n	#ifdef ENV_WORLDPOS\n		\n		varying vec3 vWorldPosition;\n	#else\n		varying vec3 vReflect;\n		uniform float refractionRatio;\n	#endif\n#endif",oL="#ifdef USE_ENVMAP\n	#ifdef ENV_WORLDPOS\n		vWorldPosition = worldPosition.xyz;\n	#else\n		vec3 cameraToVertex;\n		if ( isOrthographic ) {\n			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n		} else {\n			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n		}\n		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n		#ifdef ENVMAP_MODE_REFLECTION\n			vReflect = reflect( cameraToVertex, worldNormal );\n		#else\n			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n		#endif\n	#endif\n#endif",oI="#ifdef USE_FOG\n	vFogDepth = - mvPosition.z;\n#endif",oR="#ifdef USE_FOG\n	varying float vFogDepth;\n#endif",oW="#ifdef USE_FOG\n	#ifdef FOG_EXP2\n		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n	#else\n		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n	#endif\n	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",oV="#ifdef USE_FOG\n	uniform vec3 fogColor;\n	varying float vFogDepth;\n	#ifdef FOG_EXP2\n		uniform float fogDensity;\n	#else\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n#endif",ok="#ifdef USE_GRADIENTMAP\n	uniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n	float dotNL = dot( normal, lightDirection );\n	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n	#ifdef USE_GRADIENTMAP\n		return vec3( texture2D( gradientMap, coord ).r );\n	#else\n		vec2 fw = fwidth( coord ) * 0.5;\n		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n	#endif\n}",oB="#ifdef USE_LIGHTMAP\n	vec4 lightMapTexel = texture2D( lightMap, vUv2 );\n	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n	reflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",oO="#ifdef USE_LIGHTMAP\n	uniform sampler2D lightMap;\n	uniform float lightMapIntensity;\n#endif",oF="LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",oz="varying vec3 vViewPosition;\nstruct LambertMaterial {\n	vec3 diffuseColor;\n	float specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_Lambert\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert\n#define Material_LightProbeLOD( material )	(0)",oU="uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n	float x = normal.x, y = normal.y, z = normal.z;\n	vec3 result = shCoefficients[ 0 ] * 0.886227;\n	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n	return result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n	return irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n	vec3 irradiance = ambientLightColor;\n	return irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n	#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n		if ( cutoffDistance > 0.0 ) {\n			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n		}\n		return distanceFalloff;\n	#else\n		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n		}\n		return 1.0;\n	#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n	return smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n	struct DirectionalLight {\n		vec3 direction;\n		vec3 color;\n	};\n	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n		light.color = directionalLight.color;\n		light.direction = directionalLight.direction;\n		light.visible = true;\n	}\n#endif\n#if NUM_POINT_LIGHTS > 0\n	struct PointLight {\n		vec3 position;\n		vec3 color;\n		float distance;\n		float decay;\n	};\n	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n		vec3 lVector = pointLight.position - geometry.position;\n		light.direction = normalize( lVector );\n		float lightDistance = length( lVector );\n		light.color = pointLight.color;\n		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n		light.visible = ( light.color != vec3( 0.0 ) );\n	}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n	struct SpotLight {\n		vec3 position;\n		vec3 direction;\n		vec3 color;\n		float distance;\n		float decay;\n		float coneCos;\n		float penumbraCos;\n	};\n	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n		vec3 lVector = spotLight.position - geometry.position;\n		light.direction = normalize( lVector );\n		float angleCos = dot( light.direction, spotLight.direction );\n		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n		if ( spotAttenuation > 0.0 ) {\n			float lightDistance = length( lVector );\n			light.color = spotLight.color * spotAttenuation;\n			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n			light.visible = ( light.color != vec3( 0.0 ) );\n		} else {\n			light.color = vec3( 0.0 );\n			light.visible = false;\n		}\n	}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n	struct RectAreaLight {\n		vec3 color;\n		vec3 position;\n		vec3 halfWidth;\n		vec3 halfHeight;\n	};\n	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;\n	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n	struct HemisphereLight {\n		vec3 direction;\n		vec3 skyColor;\n		vec3 groundColor;\n	};\n	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n		float dotNL = dot( normal, hemiLight.direction );\n		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n		return irradiance;\n	}\n#endif",oN="#if defined( USE_ENVMAP )\n	vec3 getIBLIrradiance( const in vec3 normal ) {\n		#if defined( ENVMAP_TYPE_CUBE_UV )\n			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n			return PI * envMapColor.rgb * envMapIntensity;\n		#else\n			return vec3( 0.0 );\n		#endif\n	}\n	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n		#if defined( ENVMAP_TYPE_CUBE_UV )\n			vec3 reflectVec = reflect( - viewDir, normal );\n			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n			return envMapColor.rgb * envMapIntensity;\n		#else\n			return vec3( 0.0 );\n		#endif\n	}\n#endif",oG="ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",oH="varying vec3 vViewPosition;\nstruct ToonMaterial {\n	vec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_Toon\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )	(0)",oj="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",oq="varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n	vec3 diffuseColor;\n	vec3 specularColor;\n	float specularShininess;\n	float specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_BlinnPhong\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )	(0)",oX="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n	material.ior = ior;\n	#ifdef SPECULAR\n		float specularIntensityFactor = specularIntensity;\n		vec3 specularColorFactor = specularColor;\n		#ifdef USE_SPECULARINTENSITYMAP\n			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n		#endif\n		#ifdef USE_SPECULARCOLORMAP\n			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n		#endif\n		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n	#else\n		float specularIntensityFactor = 1.0;\n		vec3 specularColorFactor = vec3( 1.0 );\n		material.specularF90 = 1.0;\n	#endif\n	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n	material.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n	material.clearcoat = clearcoat;\n	material.clearcoatRoughness = clearcoatRoughness;\n	material.clearcoatF0 = vec3( 0.04 );\n	material.clearcoatF90 = 1.0;\n	#ifdef USE_CLEARCOATMAP\n		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n	#endif\n	#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n	#endif\n	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n	material.clearcoatRoughness += geometryRoughness;\n	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n	material.iridescence = iridescence;\n	material.iridescenceIOR = iridescenceIOR;\n	#ifdef USE_IRIDESCENCEMAP\n		material.iridescence *= texture2D( iridescenceMap, vUv ).r;\n	#endif\n	#ifdef USE_IRIDESCENCE_THICKNESSMAP\n		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n	#else\n		material.iridescenceThickness = iridescenceThicknessMaximum;\n	#endif\n#endif\n#ifdef USE_SHEEN\n	material.sheenColor = sheenColor;\n	#ifdef USE_SHEENCOLORMAP\n		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n	#endif\n	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n	#ifdef USE_SHEENROUGHNESSMAP\n		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n	#endif\n#endif",oY="struct PhysicalMaterial {\n	vec3 diffuseColor;\n	float roughness;\n	vec3 specularColor;\n	float specularF90;\n	#ifdef USE_CLEARCOAT\n		float clearcoat;\n		float clearcoatRoughness;\n		vec3 clearcoatF0;\n		float clearcoatF90;\n	#endif\n	#ifdef USE_IRIDESCENCE\n		float iridescence;\n		float iridescenceIOR;\n		float iridescenceThickness;\n		vec3 iridescenceFresnel;\n		vec3 iridescenceF0;\n	#endif\n	#ifdef USE_SHEEN\n		vec3 sheenColor;\n		float sheenRoughness;\n	#endif\n	#ifdef IOR\n		float ior;\n	#endif\n	#ifdef USE_TRANSMISSION\n		float transmission;\n		float transmissionAlpha;\n		float thickness;\n		float attenuationDistance;\n		vec3 attenuationColor;\n	#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n	float dotNV = saturate( dot( normal, viewDir ) );\n	float r2 = roughness * roughness;\n	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n	return saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n	float dotNV = saturate( dot( normal, viewDir ) );\n	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n	vec4 r = roughness * c0 + c1;\n	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n	return fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n	vec2 fab = DFGApprox( normal, viewDir, roughness );\n	return specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n	vec2 fab = DFGApprox( normal, viewDir, roughness );\n	#ifdef USE_IRIDESCENCE\n		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n	#else\n		vec3 Fr = specularColor;\n	#endif\n	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n	float Ess = fab.x + fab.y;\n	float Ems = 1.0 - Ess;\n	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n	singleScatter += FssEss;\n	multiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n		vec3 normal = geometry.normal;\n		vec3 viewDir = geometry.viewDir;\n		vec3 position = geometry.position;\n		vec3 lightPos = rectAreaLight.position;\n		vec3 halfWidth = rectAreaLight.halfWidth;\n		vec3 halfHeight = rectAreaLight.halfHeight;\n		vec3 lightColor = rectAreaLight.color;\n		float roughness = material.roughness;\n		vec3 rectCoords[ 4 ];\n		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n		vec2 uv = LTC_Uv( normal, viewDir, roughness );\n		vec4 t1 = texture2D( ltc_1, uv );\n		vec4 t2 = texture2D( ltc_2, uv );\n		mat3 mInv = mat3(\n			vec3( t1.x, 0, t1.y ),\n			vec3(    0, 1,    0 ),\n			vec3( t1.z, 0, t1.w )\n		);\n		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n	}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	#ifdef USE_CLEARCOAT\n		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n		vec3 ccIrradiance = dotNLcc * directLight.color;\n		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n	#endif\n	#ifdef USE_SHEEN\n		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n	#endif\n	#ifdef USE_IRIDESCENCE\n		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n	#else\n		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n	#endif\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n	#ifdef USE_CLEARCOAT\n		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n	#endif\n	#ifdef USE_SHEEN\n		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n	#endif\n	vec3 singleScattering = vec3( 0.0 );\n	vec3 multiScattering = vec3( 0.0 );\n	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n	#ifdef USE_IRIDESCENCE\n		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n	#else\n		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n	#endif\n	vec3 totalScattering = singleScattering + multiScattering;\n	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n	reflectedLight.indirectSpecular += radiance * singleScattering;\n	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct				RE_Direct_Physical\n#define RE_Direct_RectArea		RE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular		RE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",oJ="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n	geometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n	float dotNVi = saturate( dot( normal, geometry.viewDir ) );\n	if ( material.iridescenceThickness == 0.0 ) {\n		material.iridescence = 0.0;\n	} else {\n		material.iridescence = saturate( material.iridescence );\n	}\n	if ( material.iridescence > 0.0 ) {\n		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n	}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n	PointLight pointLight;\n	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n	PointLightShadow pointLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n		pointLight = pointLights[ i ];\n		getPointLightInfo( pointLight, geometry, directLight );\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n		pointLightShadow = pointLightShadows[ i ];\n		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometry, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n	SpotLight spotLight;\n	vec4 spotColor;\n	vec3 spotLightCoord;\n	bool inSpotLightMap;\n	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n	SpotLightShadow spotLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n		spotLight = spotLights[ i ];\n		getSpotLightInfo( spotLight, geometry, directLight );\n		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n		#else\n		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n		#endif\n		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n		#endif\n		#undef SPOT_LIGHT_MAP_INDEX\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n		spotLightShadow = spotLightShadows[ i ];\n		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometry, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n	DirectionalLight directionalLight;\n	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n	DirectionalLightShadow directionalLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n		directionalLight = directionalLights[ i ];\n		getDirectionalLightInfo( directionalLight, geometry, directLight );\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n		directionalLightShadow = directionalLightShadows[ i ];\n		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometry, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n	RectAreaLight rectAreaLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n		rectAreaLight = rectAreaLights[ i ];\n		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n	vec3 iblIrradiance = vec3( 0.0 );\n	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n	#if ( NUM_HEMI_LIGHTS > 0 )\n		#pragma unroll_loop_start\n		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n		}\n		#pragma unroll_loop_end\n	#endif\n#endif\n#if defined( RE_IndirectSpecular )\n	vec3 radiance = vec3( 0.0 );\n	vec3 clearcoatRadiance = vec3( 0.0 );\n#endif",oZ="#if defined( RE_IndirectDiffuse )\n	#ifdef USE_LIGHTMAP\n		vec4 lightMapTexel = texture2D( lightMap, vUv2 );\n		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n		irradiance += lightMapIrradiance;\n	#endif\n	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n		iblIrradiance += getIBLIrradiance( geometry.normal );\n	#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n	#ifdef USE_CLEARCOAT\n		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n	#endif\n#endif",oQ="#if defined( RE_IndirectDiffuse )\n	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",oK="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",o$="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n	uniform float logDepthBufFC;\n	varying float vFragDepth;\n	varying float vIsPerspective;\n#endif",o0="#ifdef USE_LOGDEPTHBUF\n	#ifdef USE_LOGDEPTHBUF_EXT\n		varying float vFragDepth;\n		varying float vIsPerspective;\n	#else\n		uniform float logDepthBufFC;\n	#endif\n#endif",o1="#ifdef USE_LOGDEPTHBUF\n	#ifdef USE_LOGDEPTHBUF_EXT\n		vFragDepth = 1.0 + gl_Position.w;\n		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n	#else\n		if ( isPerspectiveMatrix( projectionMatrix ) ) {\n			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n			gl_Position.z *= gl_Position.w;\n		}\n	#endif\n#endif",o2="#ifdef USE_MAP\n	vec4 sampledDiffuseColor = texture2D( map, vUv );\n	#ifdef DECODE_VIDEO_TEXTURE\n		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n	#endif\n	diffuseColor *= sampledDiffuseColor;\n#endif",o3="#ifdef USE_MAP\n	uniform sampler2D map;\n#endif",o4="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n	diffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n	diffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",o6="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n	uniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n	uniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n	uniform sampler2D alphaMap;\n#endif",o9="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n	vec4 texelMetalness = texture2D( metalnessMap, vUv );\n	metalnessFactor *= texelMetalness.b;\n#endif",o8="#ifdef USE_METALNESSMAP\n	uniform sampler2D metalnessMap;\n#endif",o7="#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n	vColor *= morphTargetBaseInfluence;\n	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n		#if defined( USE_COLOR_ALPHA )\n			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n		#elif defined( USE_COLOR )\n			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n		#endif\n	}\n#endif",ae="#ifdef USE_MORPHNORMALS\n	objectNormal *= morphTargetBaseInfluence;\n	#ifdef MORPHTARGETS_TEXTURE\n		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n		}\n	#else\n		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n	#endif\n#endif",at="#ifdef USE_MORPHTARGETS\n	uniform float morphTargetBaseInfluence;\n	#ifdef MORPHTARGETS_TEXTURE\n		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n		uniform sampler2DArray morphTargetsTexture;\n		uniform ivec2 morphTargetsTextureSize;\n		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n			int y = texelIndex / morphTargetsTextureSize.x;\n			int x = texelIndex - y * morphTargetsTextureSize.x;\n			ivec3 morphUV = ivec3( x, y, morphTargetIndex );\n			return texelFetch( morphTargetsTexture, morphUV, 0 );\n		}\n	#else\n		#ifndef USE_MORPHNORMALS\n			uniform float morphTargetInfluences[ 8 ];\n		#else\n			uniform float morphTargetInfluences[ 4 ];\n		#endif\n	#endif\n#endif",ai="#ifdef USE_MORPHTARGETS\n	transformed *= morphTargetBaseInfluence;\n	#ifdef MORPHTARGETS_TEXTURE\n		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n		}\n	#else\n		transformed += morphTarget0 * morphTargetInfluences[ 0 ];\n		transformed += morphTarget1 * morphTargetInfluences[ 1 ];\n		transformed += morphTarget2 * morphTargetInfluences[ 2 ];\n		transformed += morphTarget3 * morphTargetInfluences[ 3 ];\n		#ifndef USE_MORPHNORMALS\n			transformed += morphTarget4 * morphTargetInfluences[ 4 ];\n			transformed += morphTarget5 * morphTargetInfluences[ 5 ];\n			transformed += morphTarget6 * morphTargetInfluences[ 6 ];\n			transformed += morphTarget7 * morphTargetInfluences[ 7 ];\n		#endif\n	#endif\n#endif",ar="float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n	vec3 normal = normalize( cross( fdx, fdy ) );\n#else\n	vec3 normal = normalize( vNormal );\n	#ifdef DOUBLE_SIDED\n		normal = normal * faceDirection;\n	#endif\n	#ifdef USE_TANGENT\n		vec3 tangent = normalize( vTangent );\n		vec3 bitangent = normalize( vBitangent );\n		#ifdef DOUBLE_SIDED\n			tangent = tangent * faceDirection;\n			bitangent = bitangent * faceDirection;\n		#endif\n		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n			mat3 vTBN = mat3( tangent, bitangent, normal );\n		#endif\n	#endif\n#endif\nvec3 geometryNormal = normal;",an="#ifdef OBJECTSPACE_NORMALMAP\n	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n	#ifdef FLIP_SIDED\n		normal = - normal;\n	#endif\n	#ifdef DOUBLE_SIDED\n		normal = normal * faceDirection;\n	#endif\n	normal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n	mapN.xy *= normalScale;\n	#ifdef USE_TANGENT\n		normal = normalize( vTBN * mapN );\n	#else\n		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n	#endif\n#elif defined( USE_BUMPMAP )\n	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",ao="#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n	#ifdef USE_TANGENT\n		varying vec3 vTangent;\n		varying vec3 vBitangent;\n	#endif\n#endif",aa="#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n	#ifdef USE_TANGENT\n		varying vec3 vTangent;\n		varying vec3 vBitangent;\n	#endif\n#endif",as="#ifndef FLAT_SHADED\n	vNormal = normalize( transformedNormal );\n	#ifdef USE_TANGENT\n		vTangent = normalize( transformedTangent );\n		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n	#endif\n#endif",al="#ifdef USE_NORMALMAP\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n	uniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( vUv.st );\n		vec2 st1 = dFdy( vUv.st );\n		vec3 N = surf_norm;\n		vec3 q1perp = cross( q1, N );\n		vec3 q0perp = cross( N, q0 );\n		vec3 T = q1perp * st0.x + q0perp * st1.x;\n		vec3 B = q1perp * st0.y + q0perp * st1.y;\n		float det = max( dot( T, T ), dot( B, B ) );\n		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n	}\n#endif",ah="#ifdef USE_CLEARCOAT\n	vec3 clearcoatNormal = geometryNormal;\n#endif",ac="#ifdef USE_CLEARCOAT_NORMALMAP\n	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n	clearcoatMapN.xy *= clearcoatNormalScale;\n	#ifdef USE_TANGENT\n		clearcoatNormal = normalize( vTBN * clearcoatMapN );\n	#else\n		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n	#endif\n#endif",ad="#ifdef USE_CLEARCOATMAP\n	uniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	uniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	uniform sampler2D clearcoatNormalMap;\n	uniform vec2 clearcoatNormalScale;\n#endif",au="#ifdef USE_IRIDESCENCEMAP\n	uniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	uniform sampler2D iridescenceThicknessMap;\n#endif",ap="#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",am="vec3 packNormalToRGB( const in vec3 normal ) {\n	return normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n	return 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n	vec4 r = vec4( fract( v * PackFactors ), v );\n	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n	return dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n	return ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n	return linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n	return ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",af="#ifdef PREMULTIPLIED_ALPHA\n	gl_FragColor.rgb *= gl_FragColor.a;\n#endif",ag="vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n	mvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",ay="#ifdef DITHERING\n	gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",ax="#ifdef DITHERING\n	vec3 dithering( vec3 color ) {\n		float grid_position = rand( gl_FragCoord.xy );\n		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n		return color + dither_shift_RGB;\n	}\n#endif",aw="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n	vec4 texelRoughness = texture2D( roughnessMap, vUv );\n	roughnessFactor *= texelRoughness.g;\n#endif",ab="#ifdef USE_ROUGHNESSMAP\n	uniform sampler2D roughnessMap;\n#endif",av="#if NUM_SPOT_LIGHT_COORDS > 0\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n		struct DirectionalLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n		struct SpotLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n		struct PointLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n			float shadowCameraNear;\n			float shadowCameraFar;\n		};\n		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n	#endif\n	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n	}\n	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n		return unpackRGBATo2Half( texture2D( shadow, uv ) );\n	}\n	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n		float occlusion = 1.0;\n		vec2 distribution = texture2DDistribution( shadow, uv );\n		float hard_shadow = step( compare , distribution.x );\n		if (hard_shadow != 1.0 ) {\n			float distance = compare - distribution.x ;\n			float variance = max( 0.00000, distribution.y * distribution.y );\n			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n		}\n		return occlusion;\n	}\n	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n		float shadow = 1.0;\n		shadowCoord.xyz /= shadowCoord.w;\n		shadowCoord.z += shadowBias;\n		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n		bool inFrustum = all( inFrustumVec );\n		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n		bool frustumTest = all( frustumTestVec );\n		if ( frustumTest ) {\n		#if defined( SHADOWMAP_TYPE_PCF )\n			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n			float dx0 = - texelSize.x * shadowRadius;\n			float dy0 = - texelSize.y * shadowRadius;\n			float dx1 = + texelSize.x * shadowRadius;\n			float dy1 = + texelSize.y * shadowRadius;\n			float dx2 = dx0 / 2.0;\n			float dy2 = dy0 / 2.0;\n			float dx3 = dx1 / 2.0;\n			float dy3 = dy1 / 2.0;\n			shadow = (\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n			) * ( 1.0 / 17.0 );\n		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n			float dx = texelSize.x;\n			float dy = texelSize.y;\n			vec2 uv = shadowCoord.xy;\n			vec2 f = fract( uv * shadowMapSize + 0.5 );\n			uv -= f * texelSize;\n			shadow = (\n				texture2DCompare( shadowMap, uv, shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n					 f.x ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n					 f.x ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n					 f.y ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n					 f.y ) +\n				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n						  f.x ),\n					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n						  f.x ),\n					 f.y )\n			) * ( 1.0 / 9.0 );\n		#elif defined( SHADOWMAP_TYPE_VSM )\n			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n		#else\n			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n		#endif\n		}\n		return shadow;\n	}\n	vec2 cubeToUV( vec3 v, float texelSizeY ) {\n		vec3 absV = abs( v );\n		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n		absV *= scaleToCube;\n		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n		vec2 planar = v.xy;\n		float almostATexel = 1.5 * texelSizeY;\n		float almostOne = 1.0 - almostATexel;\n		if ( absV.z >= almostOne ) {\n			if ( v.z > 0.0 )\n				planar.x = 4.0 - v.x;\n		} else if ( absV.x >= almostOne ) {\n			float signX = sign( v.x );\n			planar.x = v.z * signX + 2.0 * signX;\n		} else if ( absV.y >= almostOne ) {\n			float signY = sign( v.y );\n			planar.x = v.x + 2.0 * signY + 2.0;\n			planar.y = v.z * signY - 2.0;\n		}\n		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n	}\n	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n		vec3 lightToPosition = shadowCoord.xyz;\n		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;\n		vec3 bd3D = normalize( lightToPosition );\n		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n			return (\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n			) * ( 1.0 / 9.0 );\n		#else\n			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n		#endif\n	}\n#endif",aM="#if NUM_SPOT_LIGHT_COORDS > 0\n  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n		struct DirectionalLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n		struct SpotLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n		struct PointLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n			float shadowCameraNear;\n			float shadowCameraFar;\n		};\n		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n	#endif\n#endif",aS="#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n		vec4 shadowWorldPosition;\n	#endif\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#if NUM_SPOT_LIGHT_COORDS > 0\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n		shadowWorldPosition = worldPosition;\n		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n		#endif\n		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n	}\n	#pragma unroll_loop_end\n	#endif\n#endif",aP="float getShadowMask() {\n	float shadow = 1.0;\n	#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n	DirectionalLightShadow directionalLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n		directionalLight = directionalLightShadows[ i ];\n		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n	SpotLightShadow spotLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n		spotLight = spotLightShadows[ i ];\n		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n	PointLightShadow pointLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n		pointLight = pointLightShadows[ i ];\n		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#endif\n	return shadow;\n}",aT="#ifdef USE_SKINNING\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",a_="#ifdef USE_SKINNING\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n	uniform highp sampler2D boneTexture;\n	uniform int boneTextureSize;\n	mat4 getBoneMatrix( const in float i ) {\n		float j = i * 4.0;\n		float x = mod( j, float( boneTextureSize ) );\n		float y = floor( j / float( boneTextureSize ) );\n		float dx = 1.0 / float( boneTextureSize );\n		float dy = 1.0 / float( boneTextureSize );\n		y = dy * ( y + 0.5 );\n		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n		mat4 bone = mat4( v1, v2, v3, v4 );\n		return bone;\n	}\n#endif",aC="#ifdef USE_SKINNING\n	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	transformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",aD="#ifdef USE_SKINNING\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n	#ifdef USE_TANGENT\n		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n	#endif\n#endif",aA="float specularStrength;\n#ifdef USE_SPECULARMAP\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	specularStrength = texelSpecular.r;\n#else\n	specularStrength = 1.0;\n#endif",aE="#ifdef USE_SPECULARMAP\n	uniform sampler2D specularMap;\n#endif",aL="#if defined( TONE_MAPPING )\n	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",aI="#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n	return toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n	color *= toneMappingExposure;\n	return saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n	color *= toneMappingExposure;\n	color = max( vec3( 0.0 ), color - 0.004 );\n	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n	return a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n	const mat3 ACESInputMat = mat3(\n		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),\n		vec3( 0.04823, 0.01566, 0.83777 )\n	);\n	const mat3 ACESOutputMat = mat3(\n		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),\n		vec3( -0.07367, -0.00605,  1.07602 )\n	);\n	color *= toneMappingExposure / 0.6;\n	color = ACESInputMat * color;\n	color = RRTAndODTFit( color );\n	color = ACESOutputMat * color;\n	return saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",aR="#ifdef USE_TRANSMISSION\n	material.transmission = transmission;\n	material.transmissionAlpha = 1.0;\n	material.thickness = thickness;\n	material.attenuationDistance = attenuationDistance;\n	material.attenuationColor = attenuationColor;\n	#ifdef USE_TRANSMISSIONMAP\n		material.transmission *= texture2D( transmissionMap, vUv ).r;\n	#endif\n	#ifdef USE_THICKNESSMAP\n		material.thickness *= texture2D( thicknessMap, vUv ).g;\n	#endif\n	vec3 pos = vWorldPosition;\n	vec3 v = normalize( cameraPosition - pos );\n	vec3 n = inverseTransformDirection( normal, viewMatrix );\n	vec4 transmission = getIBLVolumeRefraction(\n		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n		material.attenuationColor, material.attenuationDistance );\n	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",aW="#ifdef USE_TRANSMISSION\n	uniform float transmission;\n	uniform float thickness;\n	uniform float attenuationDistance;\n	uniform vec3 attenuationColor;\n	#ifdef USE_TRANSMISSIONMAP\n		uniform sampler2D transmissionMap;\n	#endif\n	#ifdef USE_THICKNESSMAP\n		uniform sampler2D thicknessMap;\n	#endif\n	uniform vec2 transmissionSamplerSize;\n	uniform sampler2D transmissionSamplerMap;\n	uniform mat4 modelMatrix;\n	uniform mat4 projectionMatrix;\n	varying vec3 vWorldPosition;\n	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n		vec3 modelScale;\n		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n		return normalize( refractionVector ) * thickness * modelScale;\n	}\n	float applyIorToRoughness( const in float roughness, const in float ior ) {\n		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n	}\n	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n		#ifdef texture2DLodEXT\n			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n		#else\n			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n		#endif\n	}\n	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n		if ( attenuationDistance == 0.0 ) {\n			return radiance;\n		} else {\n			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;\n		}\n	}\n	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n		const in vec3 attenuationColor, const in float attenuationDistance ) {\n		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n		vec3 refractedRayExit = position + transmissionRay;\n		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n		vec2 refractionCoords = ndcPos.xy / ndcPos.w;\n		refractionCoords += 1.0;\n		refractionCoords /= 2.0;\n		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n	}\n#endif",aV="#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n	varying vec2 vUv;\n#endif",ak="#ifdef USE_UV\n	#ifdef UVS_VERTEX_ONLY\n		vec2 vUv;\n	#else\n		varying vec2 vUv;\n	#endif\n	uniform mat3 uvTransform;\n#endif",aB="#ifdef USE_UV\n	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",aO="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n	varying vec2 vUv2;\n#endif",aF="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n	attribute vec2 uv2;\n	varying vec2 vUv2;\n	uniform mat3 uv2Transform;\n#endif",az="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",aU="#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n	vec4 worldPosition = vec4( transformed, 1.0 );\n	#ifdef USE_INSTANCING\n		worldPosition = instanceMatrix * worldPosition;\n	#endif\n	worldPosition = modelMatrix * worldPosition;\n#endif";let aN="varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n	gl_Position = vec4( position.xy, 1.0, 1.0 );\n}",aG="uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n	gl_FragColor = texture2D( t2D, vUv );\n	#ifdef DECODE_VIDEO_TEXTURE\n		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n	#endif\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n}",aH="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n	gl_Position.z = gl_Position.w;\n}",aj="#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n	vec3 vReflect = vWorldDirection;\n	#include <envmap_fragment>\n	gl_FragColor = envColor;\n	gl_FragColor.a *= opacity;\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n}",aq="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n	#include <uv_vertex>\n	#include <skinbase_vertex>\n	#ifdef USE_DISPLACEMENTMAP\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vHighPrecisionZW = gl_Position.zw;\n}",aX="#if DEPTH_PACKING == 3200\n	uniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( 1.0 );\n	#if DEPTH_PACKING == 3200\n		diffuseColor.a = opacity;\n	#endif\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <logdepthbuf_fragment>\n	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n	#if DEPTH_PACKING == 3200\n		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n	#elif DEPTH_PACKING == 3201\n		gl_FragColor = packDepthToRGBA( fragCoordZ );\n	#endif\n}",aY="#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <skinbase_vertex>\n	#ifdef USE_DISPLACEMENTMAP\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <worldpos_vertex>\n	#include <clipping_planes_vertex>\n	vWorldPosition = worldPosition.xyz;\n}",aJ="#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( 1.0 );\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	float dist = length( vWorldPosition - referencePosition );\n	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n	dist = saturate( dist );\n	gl_FragColor = packDepthToRGBA( dist );\n}",aZ="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n}",aQ="uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vec3 direction = normalize( vWorldDirection );\n	vec2 sampleUV = equirectUv( direction );\n	gl_FragColor = texture2D( tEquirect, sampleUV );\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n}",aK="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	vLineDistance = scale * lineDistance;\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n}",a$="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	if ( mod( vLineDistance, totalSize ) > dashSize ) {\n		discard;\n	}\n	vec3 outgoingLight = vec3( 0.0 );\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <logdepthbuf_fragment>\n	#include <color_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <output_fragment>\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n}",a0="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <uv2_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinbase_vertex>\n		#include <skinnormal_vertex>\n		#include <defaultnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <fog_vertex>\n}",a1="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <specularmap_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	#ifdef USE_LIGHTMAP\n		vec4 lightMapTexel = texture2D( lightMap, vUv2 );\n		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n	#else\n		reflectedLight.indirectDiffuse += vec3( 1.0 );\n	#endif\n	#include <aomap_fragment>\n	reflectedLight.indirectDiffuse *= diffuseColor.rgb;\n	vec3 outgoingLight = reflectedLight.indirectDiffuse;\n	#include <envmap_fragment>\n	#include <output_fragment>\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",a2="#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <uv2_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",a4="#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <specularmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_lambert_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n	#include <envmap_fragment>\n	#include <output_fragment>\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",a5="#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n	vViewPosition = - mvPosition.xyz;\n}",a6="#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	vec3 viewDir = normalize( vViewPosition );\n	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n	vec3 y = cross( viewDir, x );\n	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n	#ifdef USE_MATCAP\n		vec4 matcapColor = texture2D( matcap, uv );\n	#else\n		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n	#endif\n	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n	#include <output_fragment>\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",a9="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n	varying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n	vViewPosition = - mvPosition.xyz;\n#endif\n}",a8="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n	varying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	#include <logdepthbuf_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n	#ifdef OPAQUE\n		gl_FragColor.a = 1.0;\n	#endif\n}",a7="#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <uv2_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",se="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <specularmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_phong_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n	#include <envmap_fragment>\n	#include <output_fragment>\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",st="#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n	varying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <uv2_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n	vWorldPosition = worldPosition.xyz;\n#endif\n}",si="#define STANDARD\n#ifdef PHYSICAL\n	#define IOR\n	#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n	uniform float ior;\n#endif\n#ifdef SPECULAR\n	uniform float specularIntensity;\n	uniform vec3 specularColor;\n	#ifdef USE_SPECULARINTENSITYMAP\n		uniform sampler2D specularIntensityMap;\n	#endif\n	#ifdef USE_SPECULARCOLORMAP\n		uniform sampler2D specularColorMap;\n	#endif\n#endif\n#ifdef USE_CLEARCOAT\n	uniform float clearcoat;\n	uniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n	uniform float iridescence;\n	uniform float iridescenceIOR;\n	uniform float iridescenceThicknessMinimum;\n	uniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n	uniform vec3 sheenColor;\n	uniform float sheenRoughness;\n	#ifdef USE_SHEENCOLORMAP\n		uniform sampler2D sheenColorMap;\n	#endif\n	#ifdef USE_SHEENROUGHNESSMAP\n		uniform sampler2D sheenRoughnessMap;\n	#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <roughnessmap_fragment>\n	#include <metalnessmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <clearcoat_normal_fragment_begin>\n	#include <clearcoat_normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_physical_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n	#include <transmission_fragment>\n	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n	#ifdef USE_SHEEN\n		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n	#endif\n	#ifdef USE_CLEARCOAT\n		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n	#endif\n	#include <output_fragment>\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",sr="#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <uv2_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",sn="#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_toon_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n	#include <output_fragment>\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",so="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <project_vertex>\n	gl_PointSize = size;\n	#ifdef USE_SIZEATTENUATION\n		bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n	#endif\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <worldpos_vertex>\n	#include <fog_vertex>\n}",sa="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec3 outgoingLight = vec3( 0.0 );\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <logdepthbuf_fragment>\n	#include <map_particle_fragment>\n	#include <color_fragment>\n	#include <alphatest_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <output_fragment>\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n}",ss="#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <project_vertex>\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",sl="uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n	#include <fog_fragment>\n}",sh="uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n	vec2 scale;\n	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n	#ifndef USE_SIZEATTENUATION\n		bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n		if ( isPerspective ) scale *= - mvPosition.z;\n	#endif\n	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n	vec2 rotatedPosition;\n	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n	mvPosition.xy += rotatedPosition;\n	gl_Position = projectionMatrix * mvPosition;\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n}",sc="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec3 outgoingLight = vec3( 0.0 );\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <output_fragment>\n	#include <tonemapping_fragment>\n	#include <encodings_fragment>\n	#include <fog_fragment>\n}",sd={alphamap_fragment:n7,alphamap_pars_fragment:oe,alphatest_fragment:ot,alphatest_pars_fragment:oi,aomap_fragment:or,aomap_pars_fragment:on,begin_vertex:oo,beginnormal_vertex:oa,bsdfs:os,iridescence_fragment:ol,bumpmap_pars_fragment:oh,clipping_planes_fragment:oc,clipping_planes_pars_fragment:od,clipping_planes_pars_vertex:ou,clipping_planes_vertex:op,color_fragment:om,color_pars_fragment:of,color_pars_vertex:og,color_vertex:oy,common:ox,cube_uv_reflection_fragment:ow,defaultnormal_vertex:ob,displacementmap_pars_vertex:ov,displacementmap_vertex:oM,emissivemap_fragment:oS,emissivemap_pars_fragment:oP,encodings_fragment:oT,encodings_pars_fragment:o_,envmap_fragment:oC,envmap_common_pars_fragment:oD,envmap_pars_fragment:oA,envmap_pars_vertex:oE,envmap_physical_pars_fragment:oN,envmap_vertex:oL,fog_vertex:oI,fog_pars_vertex:oR,fog_fragment:oW,fog_pars_fragment:oV,gradientmap_pars_fragment:ok,lightmap_fragment:oB,lightmap_pars_fragment:oO,lights_lambert_fragment:oF,lights_lambert_pars_fragment:oz,lights_pars_begin:oU,lights_toon_fragment:oG,lights_toon_pars_fragment:oH,lights_phong_fragment:oj,lights_phong_pars_fragment:oq,lights_physical_fragment:oX,lights_physical_pars_fragment:oY,lights_fragment_begin:oJ,lights_fragment_maps:oZ,lights_fragment_end:oQ,logdepthbuf_fragment:oK,logdepthbuf_pars_fragment:o$,logdepthbuf_pars_vertex:o0,logdepthbuf_vertex:o1,map_fragment:o2,map_pars_fragment:o3,map_particle_fragment:o4,map_particle_pars_fragment:o6,metalnessmap_fragment:o9,metalnessmap_pars_fragment:o8,morphcolor_vertex:o7,morphnormal_vertex:ae,morphtarget_pars_vertex:at,morphtarget_vertex:ai,normal_fragment_begin:ar,normal_fragment_maps:an,normal_pars_fragment:ao,normal_pars_vertex:aa,normal_vertex:as,normalmap_pars_fragment:al,clearcoat_normal_fragment_begin:ah,clearcoat_normal_fragment_maps:ac,clearcoat_pars_fragment:ad,iridescence_pars_fragment:au,output_fragment:ap,packing:am,premultiplied_alpha_fragment:af,project_vertex:ag,dithering_fragment:ay,dithering_pars_fragment:ax,roughnessmap_fragment:aw,roughnessmap_pars_fragment:ab,shadowmap_pars_fragment:av,shadowmap_pars_vertex:aM,shadowmap_vertex:aS,shadowmask_pars_fragment:aP,skinbase_vertex:aT,skinning_pars_vertex:a_,skinning_vertex:aC,skinnormal_vertex:aD,specularmap_fragment:aA,specularmap_pars_fragment:aE,tonemapping_fragment:aL,tonemapping_pars_fragment:aI,transmission_fragment:aR,transmission_pars_fragment:aW,uv_pars_fragment:aV,uv_pars_vertex:ak,uv_vertex:aB,uv2_pars_fragment:aO,uv2_pars_vertex:aF,uv2_vertex:az,worldpos_vertex:aU,background_vert:aN,background_frag:aG,cube_vert:aH,cube_frag:aj,depth_vert:aq,depth_frag:aX,distanceRGBA_vert:aY,distanceRGBA_frag:aJ,equirect_vert:aZ,equirect_frag:aQ,linedashed_vert:aK,linedashed_frag:a$,meshbasic_vert:a0,meshbasic_frag:a1,meshlambert_vert:a2,meshlambert_frag:a4,meshmatcap_vert:a5,meshmatcap_frag:a6,meshnormal_vert:a9,meshnormal_frag:a8,meshphong_vert:a7,meshphong_frag:se,meshphysical_vert:st,meshphysical_frag:si,meshtoon_vert:sr,meshtoon_frag:sn,points_vert:so,points_frag:sa,shadow_vert:ss,shadow_frag:sl,sprite_vert:sh,sprite_frag:sc},su={common:{diffuse:{value:new iB(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new iM},uv2Transform:{value:new iM},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new iv(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new iB(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new iB(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new iM}},sprite:{diffuse:{value:new iB(16777215)},opacity:{value:1},center:{value:new iv(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new iM}}},sp={basic:{uniforms:nF([su.common,su.specularmap,su.envmap,su.aomap,su.lightmap,su.fog]),vertexShader:sd.meshbasic_vert,fragmentShader:sd.meshbasic_frag},lambert:{uniforms:nF([su.common,su.specularmap,su.envmap,su.aomap,su.lightmap,su.emissivemap,su.bumpmap,su.normalmap,su.displacementmap,su.fog,su.lights,{emissive:{value:new iB(0)}}]),vertexShader:sd.meshlambert_vert,fragmentShader:sd.meshlambert_frag},phong:{uniforms:nF([su.common,su.specularmap,su.envmap,su.aomap,su.lightmap,su.emissivemap,su.bumpmap,su.normalmap,su.displacementmap,su.fog,su.lights,{emissive:{value:new iB(0)},specular:{value:new iB(1118481)},shininess:{value:30}}]),vertexShader:sd.meshphong_vert,fragmentShader:sd.meshphong_frag},standard:{uniforms:nF([su.common,su.envmap,su.aomap,su.lightmap,su.emissivemap,su.bumpmap,su.normalmap,su.displacementmap,su.roughnessmap,su.metalnessmap,su.fog,su.lights,{emissive:{value:new iB(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:sd.meshphysical_vert,fragmentShader:sd.meshphysical_frag},toon:{uniforms:nF([su.common,su.aomap,su.lightmap,su.emissivemap,su.bumpmap,su.normalmap,su.displacementmap,su.gradientmap,su.fog,su.lights,{emissive:{value:new iB(0)}}]),vertexShader:sd.meshtoon_vert,fragmentShader:sd.meshtoon_frag},matcap:{uniforms:nF([su.common,su.bumpmap,su.normalmap,su.displacementmap,su.fog,{matcap:{value:null}}]),vertexShader:sd.meshmatcap_vert,fragmentShader:sd.meshmatcap_frag},points:{uniforms:nF([su.points,su.fog]),vertexShader:sd.points_vert,fragmentShader:sd.points_frag},dashed:{uniforms:nF([su.common,su.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:sd.linedashed_vert,fragmentShader:sd.linedashed_frag},depth:{uniforms:nF([su.common,su.displacementmap]),vertexShader:sd.depth_vert,fragmentShader:sd.depth_frag},normal:{uniforms:nF([su.common,su.bumpmap,su.normalmap,su.displacementmap,{opacity:{value:1}}]),vertexShader:sd.meshnormal_vert,fragmentShader:sd.meshnormal_frag},sprite:{uniforms:nF([su.sprite,su.fog]),vertexShader:sd.sprite_vert,fragmentShader:sd.sprite_frag},background:{uniforms:{uvTransform:{value:new iM},t2D:{value:null}},vertexShader:sd.background_vert,fragmentShader:sd.background_frag},cube:{uniforms:nF([su.envmap,{opacity:{value:1}}]),vertexShader:sd.cube_vert,fragmentShader:sd.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:sd.equirect_vert,fragmentShader:sd.equirect_frag},distanceRGBA:{uniforms:nF([su.common,su.displacementmap,{referencePosition:{value:new iQ},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:sd.distanceRGBA_vert,fragmentShader:sd.distanceRGBA_frag},shadow:{uniforms:nF([su.lights,su.fog,{color:{value:new iB(0)},opacity:{value:1}}]),vertexShader:sd.shadow_vert,fragmentShader:sd.shadow_frag}};function sm(e,t,i,r,n,o){let a,s;let l=new iB(0),h=!0===n?0:1,c=null,d=0,u=null;function p(e,t){i.buffers.color.setClear(e.r,e.g,e.b,t,o)}return{getClearColor:function(){return l},setClearColor:function(e,t=1){l.set(e),p(l,h=t)},getClearAlpha:function(){return h},setClearAlpha:function(e){p(l,h=e)},render:function(i,n){let o=!1,m=!0===n.isScene?n.background:null;m&&m.isTexture&&(m=t.get(m));let f=e.xr,g=f.getSession&&f.getSession();g&&"additive"===g.environmentBlendMode&&(m=null),null===m?p(l,h):m&&m.isColor&&(p(m,1),o=!0),(e.autoClear||o)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&(m.isCubeTexture||m.mapping===eu)?(void 0===s&&((s=new nW(new nB(1,1,1),new nH({name:"BackgroundCubeMaterial",uniforms:nO(sp.cube.uniforms),vertexShader:sp.cube.vertexShader,fragmentShader:sp.cube.fragmentShader,side:w,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),s.geometry.deleteAttribute("uv"),s.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(s.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(s)),s.material.uniforms.envMap.value=m,s.material.uniforms.flipEnvMap.value=m.isCubeTexture&&!1===m.isRenderTargetTexture?-1:1,(c!==m||d!==m.version||u!==e.toneMapping)&&(s.material.needsUpdate=!0,c=m,d=m.version,u=e.toneMapping),s.layers.enableAll(),i.unshift(s,s.geometry,s.material,0,0,null)):m&&m.isTexture&&(void 0===a&&((a=new nW(new n8(2,2),new nH({name:"BackgroundMaterial",uniforms:nO(sp.background.uniforms),vertexShader:sp.background.vertexShader,fragmentShader:sp.background.fragmentShader,side:x,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(a)),a.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),a.material.uniforms.uvTransform.value.copy(m.matrix),(c!==m||d!==m.version||u!==e.toneMapping)&&(a.material.needsUpdate=!0,c=m,d=m.version,u=e.toneMapping),a.layers.enableAll(),i.unshift(a,a.geometry,a.material,0,0,null))}}}function sf(e,t,i,r){let n=e.getParameter(34921),o=r.isWebGL2?null:t.get("OES_vertex_array_object"),a=r.isWebGL2||null!==o,s={},l=f(null),h=l,c=!1;function d(){return r.isWebGL2?e.createVertexArray():o.createVertexArrayOES()}function u(t){return r.isWebGL2?e.bindVertexArray(t):o.bindVertexArrayOES(t)}function p(t){return r.isWebGL2?e.deleteVertexArray(t):o.deleteVertexArrayOES(t)}function m(e,t,i){let r=!0===i.wireframe,n=s[e.id];void 0===n&&(n={},s[e.id]=n);let o=n[t.id];void 0===o&&(o={},n[t.id]=o);let a=o[r];return void 0===a&&(a=f(d()),o[r]=a),a}function f(e){let t=[],i=[],r=[];for(let e=0;e<n;e++)t[e]=0,i[e]=0,r[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:r,object:e,attributes:{},index:null}}function g(e,t,i,r){let n=h.attributes,o=t.attributes,a=0,s=i.getAttributes();for(let t in s){let i=s[t];if(i.location>=0){let i=n[t],r=o[t];if(void 0===r&&("instanceMatrix"===t&&e.instanceMatrix&&(r=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(r=e.instanceColor)),void 0===i||i.attribute!==r||r&&i.data!==r.data)return!0;a++}}return h.attributesNum!==a||h.index!==r}function y(e,t,i,r){let n={},o=t.attributes,a=0,s=i.getAttributes();for(let t in s){let i=s[t];if(i.location>=0){let i=o[t];void 0===i&&("instanceMatrix"===t&&e.instanceMatrix&&(i=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(i=e.instanceColor));let r={};r.attribute=i,i&&i.data&&(r.data=i.data),n[t]=r,a++}}h.attributes=n,h.attributesNum=a,h.index=r}function x(){let e=h.newAttributes;for(let t=0,i=e.length;t<i;t++)e[t]=0}function w(e){b(e,0)}function b(i,n){let o=h.newAttributes,a=h.enabledAttributes,s=h.attributeDivisors;if(o[i]=1,0===a[i]&&(e.enableVertexAttribArray(i),a[i]=1),s[i]!==n){let o=r.isWebGL2?e:t.get("ANGLE_instanced_arrays");o[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,n),s[i]=n}}function v(){let t=h.newAttributes,i=h.enabledAttributes;for(let r=0,n=i.length;r<n;r++)i[r]!==t[r]&&(e.disableVertexAttribArray(r),i[r]=0)}function M(t,i,n,o,a,s){!0===r.isWebGL2&&(5124===n||5125===n)?e.vertexAttribIPointer(t,i,n,a,s):e.vertexAttribPointer(t,i,n,o,a,s)}function S(n,o,a,s){if(!1===r.isWebGL2&&(n.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;x();let l=s.attributes,h=a.getAttributes(),c=o.defaultAttributeValues;for(let t in h){let r=h[t];if(r.location>=0){let o=l[t];if(void 0===o&&("instanceMatrix"===t&&n.instanceMatrix&&(o=n.instanceMatrix),"instanceColor"===t&&n.instanceColor&&(o=n.instanceColor)),void 0!==o){let t=o.normalized,a=o.itemSize,l=i.get(o);if(void 0===l)continue;let h=l.buffer,c=l.type,d=l.bytesPerElement;if(o.isInterleavedBufferAttribute){let i=o.data,l=i.stride,u=o.offset;if(i.isInstancedInterleavedBuffer){for(let e=0;e<r.locationSize;e++)b(r.location+e,i.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let e=0;e<r.locationSize;e++)w(r.location+e);e.bindBuffer(34962,h);for(let e=0;e<r.locationSize;e++)M(r.location+e,a/r.locationSize,c,t,l*d,(u+a/r.locationSize*e)*d)}else{if(o.isInstancedBufferAttribute){for(let e=0;e<r.locationSize;e++)b(r.location+e,o.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=o.meshPerAttribute*o.count)}else for(let e=0;e<r.locationSize;e++)w(r.location+e);e.bindBuffer(34962,h);for(let e=0;e<r.locationSize;e++)M(r.location+e,a/r.locationSize,c,t,a*d,a/r.locationSize*e*d)}}else if(void 0!==c){let i=c[t];if(void 0!==i)switch(i.length){case 2:e.vertexAttrib2fv(r.location,i);break;case 3:e.vertexAttrib3fv(r.location,i);break;case 4:e.vertexAttrib4fv(r.location,i);break;default:e.vertexAttrib1fv(r.location,i)}}}}v()}function P(){for(let e in T(),s){let t=s[e];for(let e in t){let i=t[e];for(let e in i)p(i[e].object),delete i[e];delete t[e]}delete s[e]}}function T(){_(),c=!0,h!==l&&u((h=l).object)}function _(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(t,r,n,o,s){let l=!1;if(a){let e=m(o,n,r);h!==e&&u((h=e).object),(l=g(t,o,n,s))&&y(t,o,n,s)}else{let e=!0===r.wireframe;(h.geometry!==o.id||h.program!==n.id||h.wireframe!==e)&&(h.geometry=o.id,h.program=n.id,h.wireframe=e,l=!0)}null!==s&&i.update(s,34963),(l||c)&&(c=!1,S(t,r,n,o),null!==s&&e.bindBuffer(34963,i.get(s).buffer))},reset:T,resetDefaultState:_,dispose:P,releaseStatesOfGeometry:function(e){if(void 0===s[e.id])return;let t=s[e.id];for(let e in t){let i=t[e];for(let e in i)p(i[e].object),delete i[e];delete t[e]}delete s[e.id]},releaseStatesOfProgram:function(e){for(let t in s){let i=s[t];if(void 0===i[e.id])continue;let r=i[e.id];for(let e in r)p(r[e].object),delete r[e];delete i[e.id]}},initAttributes:x,enableAttribute:w,disableUnusedAttributes:v}}function sg(e,t,i,r){let n;let o=r.isWebGL2;function a(e){n=e}function s(t,r){e.drawArrays(n,t,r),i.update(r,n,1)}function l(r,a,s){let l,h;if(0!==s){if(o)l=e,h="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),h="drawArraysInstancedANGLE",null===l){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}l[h](n,r,a,s),i.update(a,n,s)}}this.setMode=a,this.render=s,this.renderInstances=l}function sy(e,t,i){let r;function n(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){let i=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function o(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let a="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,s=void 0!==i.precision?i.precision:"highp",l=o(s);l!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",l,"instead."),s=l);let h=a||t.has("WEBGL_draw_buffers"),c=!0===i.logarithmicDepthBuffer,d=e.getParameter(34930),u=e.getParameter(35660),p=e.getParameter(3379),m=e.getParameter(34076),f=e.getParameter(34921),g=e.getParameter(36347),y=e.getParameter(36348),x=e.getParameter(36349),w=u>0,b=a||t.has("OES_texture_float"),v=w&&b,M=a?e.getParameter(36183):0;return{isWebGL2:a,drawBuffers:h,getMaxAnisotropy:n,getMaxPrecision:o,precision:s,logarithmicDepthBuffer:c,maxTextures:d,maxVertexTextures:u,maxTextureSize:p,maxCubemapSize:m,maxAttributes:f,maxVertexUniforms:g,maxVaryings:y,maxFragmentUniforms:x,vertexTextures:w,floatFragmentTextures:b,floatVertexTextures:v,maxSamples:M}}function sx(e){let t=this,i=null,r=0,n=!1,o=!1,a=new n2,s=new iM,l={value:null,needsUpdate:!1};function h(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function c(e,i,r,n){let o=null!==e?e.length:0,h=null;if(0!==o){if(h=l.value,!0!==n||null===h){let t=r+4*o,n=i.matrixWorldInverse;s.getNormalMatrix(n),(null===h||h.length<t)&&(h=new Float32Array(t));for(let t=0,i=r;t!==o;++t,i+=4)a.copy(e[t]).applyMatrix4(n,s),a.normal.toArray(h,i),h[i+3]=a.constant}l.value=h,l.needsUpdate=!0}return t.numPlanes=o,t.numIntersection=0,h}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,o){let a=0!==e.length||t||0!==r||n;return n=t,i=c(e,o,0),r=e.length,a},this.beginShadows=function(){o=!0,c(null)},this.endShadows=function(){o=!1,h()},this.setState=function(t,a,s){let d=t.clippingPlanes,u=t.clipIntersection,p=t.clipShadows,m=e.get(t);if(n&&null!==d&&0!==d.length&&(!o||p)){let e=o?0:r,t=4*e,n=m.clippingState||null;l.value=n,n=c(d,a,t,s);for(let e=0;e!==t;++e)n[e]=i[e];m.clippingState=n,this.numIntersection=u?this.numPlanes:0,this.numPlanes+=e}else o?c(null):h()}}function sw(e){let t=new WeakMap;function i(e,t){return t===ec?e.mapping=el:t===ed&&(e.mapping=eh),e}function r(e){let i=e.target;i.removeEventListener("dispose",r);let n=t.get(i);void 0!==n&&(t.delete(i),n.dispose())}return{get:function(n){if(n&&n.isTexture&&!1===n.isRenderTargetTexture){let o=n.mapping;if(o===ec||o===ed){if(t.has(n)){let e=t.get(n).texture;return i(e,n.mapping)}{let o=n.image;if(!o||!(o.height>0))return null;{let a=new nQ(o.height/2);return a.fromEquirectangularTexture(e,n),t.set(n,a),n.addEventListener("dispose",r),i(a.texture,n.mapping)}}}}return n},dispose:function(){t=new WeakMap}}}sp.physical={uniforms:nF([sp.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new iv(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new iB(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new iv},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new iB(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new iB(1,1,1)},specularColorMap:{value:null}}]),vertexShader:sd.meshphysical_vert,fragmentShader:sd.meshphysical_frag};class sb extends nj{constructor(e=-1,t=1,i=1,r=-1,n=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=n,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,n,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,n=i-e,o=i+e,a=r+t,s=r-t;if(null!==this.view&&this.view.enabled){let e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=e*this.view.offsetX,o=n+e*this.view.width,a-=t*this.view.offsetY,s=a-t*this.view.height}this.projectionMatrix.makeOrthographic(n,o,a,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}let sv=4,sM=[.125,.215,.35,.446,.526,.582],sS=20,sP=new sb,sT=new iB,s_=null,sC=(1+Math.sqrt(5))/2,sD=1/sC,sA=[new iQ(1,1,1),new iQ(-1,1,1),new iQ(1,1,-1),new iQ(-1,1,-1),new iQ(0,sC,sD),new iQ(0,sC,-sD),new iQ(sD,0,sC),new iQ(-sD,0,sC),new iQ(sC,sD,0),new iQ(-sC,sD,0)];class sE{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){s_=this._renderer.getRenderTarget(),this._setSize(256);let n=this._allocateTargets();return n.depthBuffer=!0,this._sceneToCubeUV(e,i,r,n),t>0&&this._blur(n,0,0,t),this._applyPMREM(n),this._cleanup(n),n}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=sk(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=sV(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(s_),e.scissorTest=!1,sR(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===el||e.mapping===eh?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),s_=this._renderer.getRenderTarget();let i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:ev,minFilter:ev,generateMipmaps:!1,type:eR,format:eF,encoding:t_,depthBuffer:!1},r=sI(e,t,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=sI(e,t,i);let{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=sL(r)),this._blurMaterial=sW(r,e,t)}return r}_compileMaterial(e){let t=new nW(this._lodPlanes[0],e);this._renderer.compile(t,sP)}_sceneToCubeUV(e,t,i,r){let n=90,o=1,a=new nq(n,o,t,i),s=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],h=this._renderer,c=h.autoClear,d=h.toneMapping;h.getClearColor(sT),h.toneMapping=et,h.autoClear=!1;let u=new r4({name:"PMREM.Background",side:w,depthWrite:!1,depthTest:!1}),p=new nW(new nB,u),m=!1,f=e.background;f?f.isColor&&(u.color.copy(f),e.background=null,m=!0):(u.color.copy(sT),m=!0);for(let t=0;t<6;t++){let i=t%3;0===i?(a.up.set(0,s[t],0),a.lookAt(l[t],0,0)):1===i?(a.up.set(0,0,s[t]),a.lookAt(0,l[t],0)):(a.up.set(0,s[t],0),a.lookAt(0,0,l[t]));let n=this._cubeSize;sR(r,i*n,t>2?n:0,n,n),h.setRenderTarget(r),m&&h.render(p,a),h.render(e,a)}p.geometry.dispose(),p.material.dispose(),h.toneMapping=d,h.autoClear=c,e.background=f}_textureToCubeUV(e,t){let i=this._renderer,r=e.mapping===el||e.mapping===eh;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=sk()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=sV());let n=r?this._cubemapMaterial:this._equirectMaterial,o=new nW(this._lodPlanes[0],n),a=n.uniforms;a.envMap.value=e;let s=this._cubeSize;sR(t,0,0,3*s,2*s),i.setRenderTarget(t),i.render(o,sP)}_applyPMREM(e){let t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let t=1;t<this._lodPlanes.length;t++){let i=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),r=sA[(t-1)%sA.length];this._blur(e,t-1,t,i,r)}t.autoClear=i}_blur(e,t,i,r,n){let o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,r,"latitudinal",n),this._halfBlur(o,e,i,i,r,"longitudinal",n)}_halfBlur(e,t,i,r,n,o,a){let s=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");let h=3,c=new nW(this._lodPlanes[r],l),d=l.uniforms,u=this._sizeLods[i]-1,p=isFinite(n)?Math.PI/(2*u):2*Math.PI/(2*sS-1),m=n/p,f=isFinite(n)?1+Math.floor(h*m):sS;f>sS&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${f} samples when the maximum is set to ${sS}`);let g=[],y=0;for(let e=0;e<sS;++e){let t=e/m,i=Math.exp(-t*t/2);g.push(i),0===e?y+=i:e<f&&(y+=2*i)}for(let e=0;e<g.length;e++)g[e]=g[e]/y;d.envMap.value=e.texture,d.samples.value=f,d.weights.value=g,d.latitudinal.value="latitudinal"===o,a&&(d.poleAxis.value=a);let{_lodMax:x}=this;d.dTheta.value=p,d.mipInt.value=x-i;let w=this._sizeLods[r],b=3*w*(r>x-sv?r-x+sv:0),v=4*(this._cubeSize-w);sR(t,b,v,3*w,2*w),s.setRenderTarget(t),s.render(c,sP)}}function sL(e){let t=[],i=[],r=[],n=e,o=e-sv+1+sM.length;for(let a=0;a<o;a++){let o=Math.pow(2,n);i.push(o);let s=1/o;a>e-sv?s=sM[a-e+sv-1]:0===a&&(s=0),r.push(s);let l=1/(o-2),h=-l,c=1+l,d=[h,h,c,h,c,c,h,h,c,c,h,c],u=6,p=6,m=3,f=2,g=1,y=new Float32Array(m*p*u),x=new Float32Array(f*p*u),w=new Float32Array(g*p*u);for(let e=0;e<u;e++){let t=e%3*2/3-1,i=e>2?0:-1,r=[t,i,0,t+2/3,i,0,t+2/3,i+1,0,t,i,0,t+2/3,i+1,0,t,i+1,0];y.set(r,m*p*e),x.set(d,f*p*e);let n=[e,e,e,e,e,e];w.set(n,g*p*e)}let b=new ng;b.setAttribute("position",new r8(y,m)),b.setAttribute("uv",new r8(x,f)),b.setAttribute("faceIndex",new r8(w,g)),t.push(b),n>sv&&n--}return{lodPlanes:t,sizeLods:i,sigmas:r}}function sI(e,t,i){let r=new iH(e,t,i);return r.texture.mapping=eu,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function sR(e,t,i,r,n){e.viewport.set(t,i,r,n),e.scissor.set(t,i,r,n)}function sW(e,t,i){let r=new Float32Array(sS),n=new iQ(0,1,0),o=new nH({name:"SphericalGaussianBlur",defines:{n:sS,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:sB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:v,depthTest:!1,depthWrite:!1});return o}function sV(){return new nH({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:sB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:v,depthTest:!1,depthWrite:!1})}function sk(){return new nH({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:sB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:v,depthTest:!1,depthWrite:!1})}function sB(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function sO(e){let t=new WeakMap,i=null;function r(e){let t=0,i=6;for(let r=0;r<i;r++)void 0!==e[r]&&t++;return t===i}function n(e){let i=e.target;i.removeEventListener("dispose",n);let r=t.get(i);void 0!==r&&(t.delete(i),r.dispose())}return{get:function(o){if(o&&o.isTexture){let a=o.mapping,s=a===ec||a===ed,l=a===el||a===eh;if(s||l){if(o.isRenderTargetTexture&&!0===o.needsPMREMUpdate){o.needsPMREMUpdate=!1;let r=t.get(o);return null===i&&(i=new sE(e)),r=s?i.fromEquirectangular(o,r):i.fromCubemap(o,r),t.set(o,r),r.texture}if(t.has(o))return t.get(o).texture;{let a=o.image;if(!(s&&a&&a.height>0||l&&a&&r(a)))return null;{null===i&&(i=new sE(e));let r=s?i.fromEquirectangular(o):i.fromCubemap(o);return t.set(o,r),o.addEventListener("dispose",n),r.texture}}}}return o},dispose:function(){t=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function sF(e){let t={};function i(i){let r;if(void 0!==t[i])return t[i];switch(i){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(i)}return t[i]=r,r}return{has:function(e){return null!==i(e)},init:function(e){e.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(e){let t=i(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function sz(e,t,i,r){let n={},o=new WeakMap;function a(e){let s=e.target;for(let e in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[e]);s.removeEventListener("dispose",a),delete n[s.id];let l=o.get(s);l&&(t.remove(l),o.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,i.memory.geometries--}function s(e){let i=[],r=e.index,n=e.attributes.position,a=0;if(null!==r){let e=r.array;a=r.version;for(let t=0,r=e.length;t<r;t+=3){let r=e[t+0],n=e[t+1],o=e[t+2];i.push(r,n,n,o,o,r)}}else{let e=n.array;a=n.version;for(let t=0,r=e.length/3-1;t<r;t+=3){let e=t+0,r=t+1,n=t+2;i.push(e,r,r,n,n,e)}}let s=new(iS(i)?no:nr)(i,1);s.version=a;let l=o.get(e);l&&t.remove(l),o.set(e,s)}return{get:function(e,t){return!0===n[t.id]||(t.addEventListener("dispose",a),n[t.id]=!0,i.memory.geometries++),t},update:function(e){let i=e.attributes;for(let e in i)t.update(i[e],34962);let r=e.morphAttributes;for(let e in r){let i=r[e];for(let e=0,r=i.length;e<r;e++)t.update(i[e],34962)}},getWireframeAttribute:function(e){let t=o.get(e);if(t){let i=e.index;null!==i&&t.version<i.version&&s(e)}else s(e);return o.get(e)}}}function sU(e,t,i,r){let n,o,a;let s=r.isWebGL2;function l(e){n=e}function h(e){o=e.type,a=e.bytesPerElement}function c(t,r){e.drawElements(n,r,o,t*a),i.update(r,n,1)}function d(r,l,h){let c,d;if(0!==h){if(s)c=e,d="drawElementsInstanced";else if(c=t.get("ANGLE_instanced_arrays"),d="drawElementsInstancedANGLE",null===c){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}c[d](n,l,o,r*a,h),i.update(l,n,h)}}this.setMode=l,this.setIndex=h,this.render=c,this.renderInstances=d}function sN(e){let t={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(e,t,r){switch(i.calls++,t){case 4:i.triangles+=r*(e/3);break;case 1:i.lines+=r*(e/2);break;case 3:i.lines+=r*(e-1);break;case 2:i.lines+=r*e;break;case 0:i.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",t)}}function n(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:t,render:i,programs:null,autoReset:!0,reset:n,update:r}}function sG(e,t){return e[0]-t[0]}function sH(e,t){return Math.abs(t[1])-Math.abs(e[1])}function sj(e,t,i){let r={},n=new Float32Array(8),o=new WeakMap,a=new iG,s=[];for(let e=0;e<8;e++)s[e]=[e,0];return{update:function(l,h,c,d){let u=l.morphTargetInfluences;if(!0===t.isWebGL2){let r=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,n=void 0!==r?r.length:0,s=o.get(h);if(void 0===s||s.count!==n){void 0!==s&&s.texture.dispose();let e=void 0!==h.morphAttributes.position,i=void 0!==h.morphAttributes.normal,r=void 0!==h.morphAttributes.color,l=h.morphAttributes.position||[],c=h.morphAttributes.normal||[],d=h.morphAttributes.color||[],u=0;!0===e&&(u=1),!0===i&&(u=2),!0===r&&(u=3);let m=h.attributes.position.count*u,f=1;m>t.maxTextureSize&&(f=Math.ceil(m/t.maxTextureSize),m=t.maxTextureSize);let g=new Float32Array(m*f*4*n),y=new ij(g,m,f,n);y.type=eI,y.needsUpdate=!0;let x=4*u;for(let t=0;t<n;t++){let n=l[t],o=c[t],s=d[t],h=m*f*4*t;for(let t=0;t<n.count;t++){let l=t*x;!0===e&&(a.fromBufferAttribute(n,t),g[h+l+0]=a.x,g[h+l+1]=a.y,g[h+l+2]=a.z,g[h+l+3]=0),!0===i&&(a.fromBufferAttribute(o,t),g[h+l+4]=a.x,g[h+l+5]=a.y,g[h+l+6]=a.z,g[h+l+7]=0),!0===r&&(a.fromBufferAttribute(s,t),g[h+l+8]=a.x,g[h+l+9]=a.y,g[h+l+10]=a.z,g[h+l+11]=4===s.itemSize?a.w:1)}}function p(){y.dispose(),o.delete(h),h.removeEventListener("dispose",p)}s={count:n,texture:y,size:new iv(m,f)},o.set(h,s),h.addEventListener("dispose",p)}let l=0;for(let e=0;e<u.length;e++)l+=u[e];let c=h.morphTargetsRelative?1:1-l;d.getUniforms().setValue(e,"morphTargetBaseInfluence",c),d.getUniforms().setValue(e,"morphTargetInfluences",u),d.getUniforms().setValue(e,"morphTargetsTexture",s.texture,i),d.getUniforms().setValue(e,"morphTargetsTextureSize",s.size)}else{let t=void 0===u?0:u.length,i=r[h.id];if(void 0===i||i.length!==t){i=[];for(let e=0;e<t;e++)i[e]=[e,0];r[h.id]=i}for(let e=0;e<t;e++){let t=i[e];t[0]=e,t[1]=u[e]}i.sort(sH);for(let e=0;e<8;e++)e<t&&i[e][1]?(s[e][0]=i[e][0],s[e][1]=i[e][1]):(s[e][0]=Number.MAX_SAFE_INTEGER,s[e][1]=0);s.sort(sG);let o=h.morphAttributes.position,a=h.morphAttributes.normal,l=0;for(let e=0;e<8;e++){let t=s[e],i=t[0],r=t[1];i!==Number.MAX_SAFE_INTEGER&&r?(o&&h.getAttribute("morphTarget"+e)!==o[i]&&h.setAttribute("morphTarget"+e,o[i]),a&&h.getAttribute("morphNormal"+e)!==a[i]&&h.setAttribute("morphNormal"+e,a[i]),n[e]=r,l+=r):(o&&!0===h.hasAttribute("morphTarget"+e)&&h.deleteAttribute("morphTarget"+e),a&&!0===h.hasAttribute("morphNormal"+e)&&h.deleteAttribute("morphNormal"+e),n[e]=0)}let c=h.morphTargetsRelative?1:1-l;d.getUniforms().setValue(e,"morphTargetBaseInfluence",c),d.getUniforms().setValue(e,"morphTargetInfluences",n)}}}}function sq(e,t,i,r){let n=new WeakMap;function o(e){let t=e.target;t.removeEventListener("dispose",o),i.remove(t.instanceMatrix),null!==t.instanceColor&&i.remove(t.instanceColor)}return{update:function(e){let a=r.render.frame,s=e.geometry,l=t.get(e,s);return n.get(l)!==a&&(t.update(l),n.set(l,a)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",o)&&e.addEventListener("dispose",o),i.update(e.instanceMatrix,34962),null!==e.instanceColor&&i.update(e.instanceColor,34962)),l},dispose:function(){n=new WeakMap}}}let sX=new iN,sY=new ij,sJ=new iX,sZ=new nZ,sQ=[],sK=[],s$=new Float32Array(16),s0=new Float32Array(9),s1=new Float32Array(4);function s2(e,t,i){let r=e[0];if(r<=0||r>0)return e;let n=t*i,o=sQ[n];if(void 0===o&&(o=new Float32Array(n),sQ[n]=o),0!==t){r.toArray(o,0);for(let r=1,n=0;r!==t;++r)n+=i,e[r].toArray(o,n)}return o}function s3(e,t){if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function s5(e,t){for(let i=0,r=t.length;i<r;i++)e[i]=t[i]}function s6(e,t){let i=sK[t];void 0===i&&(i=new Int32Array(t),sK[t]=i);for(let r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function s9(e,t){let i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function s8(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(s3(i,t))return;e.uniform2fv(this.addr,t),s5(i,t)}}function s7(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(s3(i,t))return;e.uniform3fv(this.addr,t),s5(i,t)}}function le(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(s3(i,t))return;e.uniform4fv(this.addr,t),s5(i,t)}}function lt(e,t){let i=this.cache,r=t.elements;if(void 0===r){if(s3(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),s5(i,t)}else{if(s3(i,r))return;s1.set(r),e.uniformMatrix2fv(this.addr,!1,s1),s5(i,r)}}function li(e,t){let i=this.cache,r=t.elements;if(void 0===r){if(s3(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),s5(i,t)}else{if(s3(i,r))return;s0.set(r),e.uniformMatrix3fv(this.addr,!1,s0),s5(i,r)}}function lr(e,t){let i=this.cache,r=t.elements;if(void 0===r){if(s3(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),s5(i,t)}else{if(s3(i,r))return;s$.set(r),e.uniformMatrix4fv(this.addr,!1,s$),s5(i,r)}}function ln(e,t){let i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function lo(e,t){let i=this.cache;s3(i,t)||(e.uniform2iv(this.addr,t),s5(i,t))}function la(e,t){let i=this.cache;s3(i,t)||(e.uniform3iv(this.addr,t),s5(i,t))}function ls(e,t){let i=this.cache;s3(i,t)||(e.uniform4iv(this.addr,t),s5(i,t))}function ll(e,t){let i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function lh(e,t){let i=this.cache;s3(i,t)||(e.uniform2uiv(this.addr,t),s5(i,t))}function lc(e,t){let i=this.cache;s3(i,t)||(e.uniform3uiv(this.addr,t),s5(i,t))}function ld(e,t){let i=this.cache;s3(i,t)||(e.uniform4uiv(this.addr,t),s5(i,t))}function lu(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2D(t||sX,n)}function lp(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(t||sJ,n)}function lm(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(t||sZ,n)}function lf(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(t||sY,n)}function lg(e){switch(e){case 5126:return s9;case 35664:return s8;case 35665:return s7;case 35666:return le;case 35674:return lt;case 35675:return li;case 35676:return lr;case 5124:case 35670:return ln;case 35667:case 35671:return lo;case 35668:case 35672:return la;case 35669:case 35673:return ls;case 5125:return ll;case 36294:return lh;case 36295:return lc;case 36296:return ld;case 35678:case 36198:case 36298:case 36306:case 35682:return lu;case 35679:case 36299:case 36307:return lp;case 35680:case 36300:case 36308:case 36293:return lm;case 36289:case 36303:case 36311:case 36292:return lf}}function ly(e,t){e.uniform1fv(this.addr,t)}function lx(e,t){let i=s2(t,this.size,2);e.uniform2fv(this.addr,i)}function lw(e,t){let i=s2(t,this.size,3);e.uniform3fv(this.addr,i)}function lb(e,t){let i=s2(t,this.size,4);e.uniform4fv(this.addr,i)}function lv(e,t){let i=s2(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function lM(e,t){let i=s2(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function lS(e,t){let i=s2(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function lP(e,t){e.uniform1iv(this.addr,t)}function lT(e,t){e.uniform2iv(this.addr,t)}function l_(e,t){e.uniform3iv(this.addr,t)}function lC(e,t){e.uniform4iv(this.addr,t)}function lD(e,t){e.uniform1uiv(this.addr,t)}function lA(e,t){e.uniform2uiv(this.addr,t)}function lE(e,t){e.uniform3uiv(this.addr,t)}function lL(e,t){e.uniform4uiv(this.addr,t)}function lI(e,t,i){let r=t.length,n=s6(i,r);e.uniform1iv(this.addr,n);for(let e=0;e!==r;++e)i.setTexture2D(t[e]||sX,n[e])}function lR(e,t,i){let r=t.length,n=s6(i,r);e.uniform1iv(this.addr,n);for(let e=0;e!==r;++e)i.setTexture3D(t[e]||sJ,n[e])}function lW(e,t,i){let r=t.length,n=s6(i,r);e.uniform1iv(this.addr,n);for(let e=0;e!==r;++e)i.setTextureCube(t[e]||sZ,n[e])}function lV(e,t,i){let r=t.length,n=s6(i,r);e.uniform1iv(this.addr,n);for(let e=0;e!==r;++e)i.setTexture2DArray(t[e]||sY,n[e])}function lk(e){switch(e){case 5126:return ly;case 35664:return lx;case 35665:return lw;case 35666:return lb;case 35674:return lv;case 35675:return lM;case 35676:return lS;case 5124:case 35670:return lP;case 35667:case 35671:return lT;case 35668:case 35672:return l_;case 35669:case 35673:return lC;case 5125:return lD;case 36294:return lA;case 36295:return lE;case 36296:return lL;case 35678:case 36198:case 36298:case 36306:case 35682:return lI;case 35679:case 36299:case 36307:return lR;case 35680:case 36300:case 36308:case 36293:return lW;case 36289:case 36303:case 36311:case 36292:return lV}}class lB{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=lg(t.type)}}class lO{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=lk(t.type)}}class lF{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){let r=this.seq;for(let n=0,o=r.length;n!==o;++n){let o=r[n];o.setValue(e,t[o.id],i)}}}let lz=/(\w+)(\])?(\[|\.)?/g;function lU(e,t){e.seq.push(t),e.map[t.id]=t}function lN(e,t,i){let r=e.name,n=r.length;for(lz.lastIndex=0;;){let o=lz.exec(r),a=lz.lastIndex,s=o[1],l="]"===o[2],h=o[3];if(l&&(s|=0),void 0===h||"["===h&&a+2===n){lU(i,void 0===h?new lB(s,e,t):new lO(s,e,t));break}{let e=i.map,t=e[s];void 0===t&&lU(i,t=new lF(s)),i=t}}}class lG{constructor(e,t){this.seq=[],this.map={};let i=e.getProgramParameter(t,35718);for(let r=0;r<i;++r){let i=e.getActiveUniform(t,r),n=e.getUniformLocation(t,i.name);lN(i,n,this)}}setValue(e,t,i,r){let n=this.map[t];void 0!==n&&n.setValue(e,i,r)}setOptional(e,t,i){let r=t[i];void 0!==r&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let n=0,o=t.length;n!==o;++n){let o=t[n],a=i[o.id];!1!==a.needsUpdate&&o.setValue(e,a.value,r)}}static seqWithValue(e,t){let i=[];for(let r=0,n=e.length;r!==n;++r){let n=e[r];n.id in t&&i.push(n)}return i}}function lH(e,t,i){let r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}let lj=0;function lq(e,t){let i=e.split("\n"),r=[],n=Math.max(t-6,0),o=Math.min(t+6,i.length);for(let e=n;e<o;e++){let n=e+1;r.push(`${n===t?">":" "} ${n}: ${i[e]}`)}return r.join("\n")}function lX(e){switch(e){case t_:return["Linear","( value )"];case tC:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function lY(e,t,i){let r=e.getShaderParameter(t,35713),n=e.getShaderInfoLog(t).trim();if(r&&""===n)return"";let o=/ERROR: 0:(\d+)/.exec(n);if(!o)return n;{let r=parseInt(o[1]);return i.toUpperCase()+"\n\n"+n+"\n\n"+lq(e.getShaderSource(t),r)}}function lJ(e,t){let i=lX(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function lZ(e,t){let i;switch(t){case ei:i="Linear";break;case er:i="Reinhard";break;case en:i="OptimizedCineon";break;case eo:i="ACESFilmic";break;case ea:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function lQ(e){let t=[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""];return t.filter(l0).join("\n")}function lK(e){let t=[];for(let i in e){let r=e[i];!1!==r&&t.push("#define "+i+" "+r)}return t.join("\n")}function l$(e,t){let i={},r=e.getProgramParameter(t,35721);for(let n=0;n<r;n++){let r=e.getActiveAttrib(t,n),o=r.name,a=1;35674===r.type&&(a=2),35675===r.type&&(a=3),35676===r.type&&(a=4),i[o]={type:r.type,location:e.getAttribLocation(t,o),locationSize:a}}return i}function l0(e){return""!==e}function l1(e,t){let i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function l2(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}let l4=/^[ \t]*#include +<([\w\d./]+)>/gm;function l5(e){return e.replace(l4,l6)}function l6(e,t){let i=sd[t];if(void 0===i)throw Error("Can not resolve #include <"+t+">");return l5(i)}let l9=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function l8(e){return e.replace(l9,l7)}function l7(e,t,i,r){let n="";for(let e=parseInt(t);e<parseInt(i);e++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return n}function he(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function ht(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===f?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===g?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===y&&(t="SHADOWMAP_TYPE_VSM"),t}function hi(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case el:case eh:t="ENVMAP_TYPE_CUBE";break;case eu:t="ENVMAP_TYPE_CUBE_UV"}return t}function hr(e){let t="ENVMAP_MODE_REFLECTION";return e.envMap&&e.envMapMode===eh&&(t="ENVMAP_MODE_REFRACTION"),t}function hn(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case Q:t="ENVMAP_BLENDING_MULTIPLY";break;case K:t="ENVMAP_BLENDING_MIX";break;case ee:t="ENVMAP_BLENDING_ADD"}return t}function ho(e){let t=e.envMapCubeUVHeight;if(null===t)return null;let i=Math.log2(t)-2,r=1/t,n=1/(3*Math.max(Math.pow(2,i),112));return{texelWidth:n,texelHeight:r,maxMip:i}}function ha(e,t,i,r){let n,o,a,s;let l=e.getContext(),h=i.defines,c=i.vertexShader,d=i.fragmentShader,u=ht(i),p=hi(i),m=hr(i),f=hn(i),g=ho(i),y=i.isWebGL2?"":lQ(i),x=lK(h),w=l.createProgram(),b=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?((n=[x].filter(l0).join("\n")).length>0&&(n+="\n"),(o=[y,x].filter(l0).join("\n")).length>0&&(o+="\n")):(n=[he(i),"#define SHADER_NAME "+i.shaderName,x,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+m:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+u:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif","\n"].filter(l0).join("\n"),o=[y,he(i),"#define SHADER_NAME "+i.shaderName,x,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+p:"",i.envMap?"#define "+m:"",i.envMap?"#define "+f:"",g?"#define CUBEUV_TEXEL_WIDTH "+g.texelWidth:"",g?"#define CUBEUV_TEXEL_HEIGHT "+g.texelHeight:"",g?"#define CUBEUV_MAX_MIP "+g.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+u:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==et?"#define TONE_MAPPING":"",i.toneMapping!==et?sd.tonemapping_pars_fragment:"",i.toneMapping!==et?lZ("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",sd.encodings_pars_fragment,lJ("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(l0).join("\n")),c=l2(c=l1(c=l5(c),i),i),d=l2(d=l1(d=l5(d),i),i),c=l8(c),d=l8(d),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(b="#version 300 es\n",n="precision mediump sampler2DArray;\n#define attribute in\n#define varying out\n#define texture2D texture\n"+n,o=["#define varying in",i.glslVersion===t8?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===t8?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+o);let v=b+n+c,M=b+o+d,S=lH(l,35633,v),P=lH(l,35632,M);if(l.attachShader(w,S),l.attachShader(w,P),void 0!==i.index0AttributeName?l.bindAttribLocation(w,0,i.index0AttributeName):!0===i.morphTargets&&l.bindAttribLocation(w,0,"position"),l.linkProgram(w),e.debug.checkShaderErrors){let e=l.getProgramInfoLog(w).trim(),t=l.getShaderInfoLog(S).trim(),i=l.getShaderInfoLog(P).trim(),r=!0,a=!0;if(!1===l.getProgramParameter(w,35714)){r=!1;let t=lY(l,S,"vertex"),i=lY(l,P,"fragment");console.error("THREE.WebGLProgram: Shader Error "+l.getError()+" - VALIDATE_STATUS "+l.getProgramParameter(w,35715)+"\n\nProgram Info Log: "+e+"\n"+t+"\n"+i)}else""!==e?console.warn("THREE.WebGLProgram: Program Info Log:",e):(""===t||""===i)&&(a=!1);a&&(this.diagnostics={runnable:r,programLog:e,vertexShader:{log:t,prefix:n},fragmentShader:{log:i,prefix:o}})}return l.deleteShader(S),l.deleteShader(P),this.getUniforms=function(){return void 0===a&&(a=new lG(l,w)),a},this.getAttributes=function(){return void 0===s&&(s=l$(l,w)),s},this.destroy=function(){r.releaseStatesOfProgram(this),l.deleteProgram(w),this.program=void 0},this.name=i.shaderName,this.id=lj++,this.cacheKey=t,this.usedTimes=1,this.program=w,this.vertexShader=S,this.fragmentShader=P,this}let hs=0;class hl{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),n=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return!1===o.has(r)&&(o.add(r),r.usedTimes++),!1===o.has(n)&&(o.add(n),n.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,i=t.get(e);return void 0===i&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){let t=this.shaderCache,i=t.get(e);return void 0===i&&(i=new hh(e),t.set(e,i)),i}}class hh{constructor(e){this.id=hs++,this.code=e,this.usedTimes=0}}function hc(e,t,i,r,n,o,a){let s=new rE,l=new hl,h=[],c=n.isWebGL2,d=n.logarithmicDepthBuffer,u=n.vertexTextures,p=n.precision,m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function f(e,t){e.push(t.precision),e.push(t.outputEncoding),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.combine),e.push(t.vertexUvs),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}function g(e,t){s.disableAll(),t.isWebGL2&&s.enable(0),t.supportsVertexTextures&&s.enable(1),t.instancing&&s.enable(2),t.instancingColor&&s.enable(3),t.map&&s.enable(4),t.matcap&&s.enable(5),t.envMap&&s.enable(6),t.lightMap&&s.enable(7),t.aoMap&&s.enable(8),t.emissiveMap&&s.enable(9),t.bumpMap&&s.enable(10),t.normalMap&&s.enable(11),t.objectSpaceNormalMap&&s.enable(12),t.tangentSpaceNormalMap&&s.enable(13),t.clearcoat&&s.enable(14),t.clearcoatMap&&s.enable(15),t.clearcoatRoughnessMap&&s.enable(16),t.clearcoatNormalMap&&s.enable(17),t.iridescence&&s.enable(18),t.iridescenceMap&&s.enable(19),t.iridescenceThicknessMap&&s.enable(20),t.displacementMap&&s.enable(21),t.specularMap&&s.enable(22),t.roughnessMap&&s.enable(23),t.metalnessMap&&s.enable(24),t.gradientMap&&s.enable(25),t.alphaMap&&s.enable(26),t.alphaTest&&s.enable(27),t.vertexColors&&s.enable(28),t.vertexAlphas&&s.enable(29),t.vertexUvs&&s.enable(30),t.vertexTangents&&s.enable(31),t.uvsVertexOnly&&s.enable(32),e.push(s.mask),s.disableAll(),t.fog&&s.enable(0),t.useFog&&s.enable(1),t.flatShading&&s.enable(2),t.logarithmicDepthBuffer&&s.enable(3),t.skinning&&s.enable(4),t.morphTargets&&s.enable(5),t.morphNormals&&s.enable(6),t.morphColors&&s.enable(7),t.premultipliedAlpha&&s.enable(8),t.shadowMapEnabled&&s.enable(9),t.physicallyCorrectLights&&s.enable(10),t.doubleSided&&s.enable(11),t.flipSided&&s.enable(12),t.useDepthPacking&&s.enable(13),t.dithering&&s.enable(14),t.specularIntensityMap&&s.enable(15),t.specularColorMap&&s.enable(16),t.transmission&&s.enable(17),t.transmissionMap&&s.enable(18),t.thicknessMap&&s.enable(19),t.sheen&&s.enable(20),t.sheenColorMap&&s.enable(21),t.sheenRoughnessMap&&s.enable(22),t.decodeVideoTexture&&s.enable(23),t.opaque&&s.enable(24),e.push(s.mask)}return{getParameters:function(o,s,h,f,g){let y,x,v,S;let P=f.fog,T=g.geometry,_=o.isMeshStandardMaterial?f.environment:null,C=(o.isMeshStandardMaterial?i:t).get(o.envMap||_),D=C&&C.mapping===eu?C.image.height:null,A=m[o.type];null!==o.precision&&(p=n.getMaxPrecision(o.precision))!==o.precision&&console.warn("THREE.WebGLProgram.getParameters:",o.precision,"not supported, using",p,"instead.");let E=T.morphAttributes.position||T.morphAttributes.normal||T.morphAttributes.color,L=void 0!==E?E.length:0,I=0;if(void 0!==T.morphAttributes.position&&(I=1),void 0!==T.morphAttributes.normal&&(I=2),void 0!==T.morphAttributes.color&&(I=3),A){let e=sp[A];y=e.vertexShader,x=e.fragmentShader}else y=o.vertexShader,x=o.fragmentShader,l.update(o),v=l.getVertexShaderID(o),S=l.getFragmentShaderID(o);let R=e.getRenderTarget(),W=o.alphaTest>0,V=o.clearcoat>0,k=o.iridescence>0,B={isWebGL2:c,shaderID:A,shaderName:o.type,vertexShader:y,fragmentShader:x,defines:o.defines,customVertexShaderID:v,customFragmentShaderID:S,isRawShaderMaterial:!0===o.isRawShaderMaterial,glslVersion:o.glslVersion,precision:p,instancing:!0===g.isInstancedMesh,instancingColor:!0===g.isInstancedMesh&&null!==g.instanceColor,supportsVertexTextures:u,outputEncoding:null===R?e.outputEncoding:!0===R.isXRRenderTarget?R.texture.encoding:t_,map:!!o.map,matcap:!!o.matcap,envMap:!!C,envMapMode:C&&C.mapping,envMapCubeUVHeight:D,lightMap:!!o.lightMap,aoMap:!!o.aoMap,emissiveMap:!!o.emissiveMap,bumpMap:!!o.bumpMap,normalMap:!!o.normalMap,objectSpaceNormalMap:o.normalMapType===tL,tangentSpaceNormalMap:o.normalMapType===tE,decodeVideoTexture:!!o.map&&!0===o.map.isVideoTexture&&o.map.encoding===tC,clearcoat:V,clearcoatMap:V&&!!o.clearcoatMap,clearcoatRoughnessMap:V&&!!o.clearcoatRoughnessMap,clearcoatNormalMap:V&&!!o.clearcoatNormalMap,iridescence:k,iridescenceMap:k&&!!o.iridescenceMap,iridescenceThicknessMap:k&&!!o.iridescenceThicknessMap,displacementMap:!!o.displacementMap,roughnessMap:!!o.roughnessMap,metalnessMap:!!o.metalnessMap,specularMap:!!o.specularMap,specularIntensityMap:!!o.specularIntensityMap,specularColorMap:!!o.specularColorMap,opaque:!1===o.transparent&&o.blending===M,alphaMap:!!o.alphaMap,alphaTest:W,gradientMap:!!o.gradientMap,sheen:o.sheen>0,sheenColorMap:!!o.sheenColorMap,sheenRoughnessMap:!!o.sheenRoughnessMap,transmission:o.transmission>0,transmissionMap:!!o.transmissionMap,thicknessMap:!!o.thicknessMap,combine:o.combine,vertexTangents:!!o.normalMap&&!!T.attributes.tangent,vertexColors:o.vertexColors,vertexAlphas:!0===o.vertexColors&&!!T.attributes.color&&4===T.attributes.color.itemSize,vertexUvs:!!o.map||!!o.bumpMap||!!o.normalMap||!!o.specularMap||!!o.alphaMap||!!o.emissiveMap||!!o.roughnessMap||!!o.metalnessMap||!!o.clearcoatMap||!!o.clearcoatRoughnessMap||!!o.clearcoatNormalMap||!!o.iridescenceMap||!!o.iridescenceThicknessMap||!!o.displacementMap||!!o.transmissionMap||!!o.thicknessMap||!!o.specularIntensityMap||!!o.specularColorMap||!!o.sheenColorMap||!!o.sheenRoughnessMap,uvsVertexOnly:!(o.map||o.bumpMap||o.normalMap||o.specularMap||o.alphaMap||o.emissiveMap||o.roughnessMap||o.metalnessMap||o.clearcoatNormalMap||o.iridescenceMap||o.iridescenceThicknessMap||o.transmission>0||o.transmissionMap||o.thicknessMap||o.specularIntensityMap||o.specularColorMap||o.sheen>0||o.sheenColorMap||o.sheenRoughnessMap)&&!!o.displacementMap,fog:!!P,useFog:!0===o.fog,fogExp2:P&&P.isFogExp2,flatShading:!!o.flatShading,sizeAttenuation:o.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===g.isSkinnedMesh,morphTargets:void 0!==T.morphAttributes.position,morphNormals:void 0!==T.morphAttributes.normal,morphColors:void 0!==T.morphAttributes.color,morphTargetsCount:L,morphTextureStride:I,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numSpotLightMaps:s.spotLightMap.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numSpotLightShadowsWithMaps:s.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:o.dithering,shadowMapEnabled:e.shadowMap.enabled&&h.length>0,shadowMapType:e.shadowMap.type,toneMapping:o.toneMapped?e.toneMapping:et,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:o.premultipliedAlpha,doubleSided:o.side===b,flipSided:o.side===w,useDepthPacking:!!o.depthPacking,depthPacking:o.depthPacking||0,index0AttributeName:o.index0AttributeName,extensionDerivatives:o.extensions&&o.extensions.derivatives,extensionFragDepth:o.extensions&&o.extensions.fragDepth,extensionDrawBuffers:o.extensions&&o.extensions.drawBuffers,extensionShaderTextureLOD:o.extensions&&o.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||r.has("EXT_shader_texture_lod"),customProgramCacheKey:o.customProgramCacheKey()};return B},getProgramCacheKey:function(t){let i=[];if(t.shaderID?i.push(t.shaderID):(i.push(t.customVertexShaderID),i.push(t.customFragmentShaderID)),void 0!==t.defines)for(let e in t.defines)i.push(e),i.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(f(i,t),g(i,t),i.push(e.outputEncoding)),i.push(t.customProgramCacheKey),i.join()},getUniforms:function(e){let t;let i=m[e.type];if(i){let e=sp[i];t=nU.clone(e.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,i){let r;for(let e=0,t=h.length;e<t;e++){let t=h[e];if(t.cacheKey===i){r=t,++r.usedTimes;break}}return void 0===r&&(r=new ha(e,i,t,o),h.push(r)),r},releaseProgram:function(e){if(0==--e.usedTimes){let t=h.indexOf(e);h[t]=h[h.length-1],h.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:h,dispose:function(){l.dispose()}}}function hd(){let e=new WeakMap;return{get:function(t){let i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i},remove:function(t){e.delete(t)},update:function(t,i,r){e.get(t)[i]=r},dispose:function(){e=new WeakMap}}}function hu(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function hp(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function hm(){let e=[],t=0,i=[],r=[],n=[];function o(){t=0,i.length=0,r.length=0,n.length=0}function a(i,r,n,o,a,s){let l=e[t];return void 0===l?(l={id:i.id,object:i,geometry:r,material:n,groupOrder:o,renderOrder:i.renderOrder,z:a,group:s},e[t]=l):(l.id=i.id,l.object=i,l.geometry=r,l.material=n,l.groupOrder=o,l.renderOrder=i.renderOrder,l.z=a,l.group=s),t++,l}function s(e,t,o,s,l,h){let c=a(e,t,o,s,l,h);o.transmission>0?r.push(c):!0===o.transparent?n.push(c):i.push(c)}function l(e,t,o,s,l,h){let c=a(e,t,o,s,l,h);o.transmission>0?r.unshift(c):!0===o.transparent?n.unshift(c):i.unshift(c)}function h(e,t){i.length>1&&i.sort(e||hu),r.length>1&&r.sort(t||hp),n.length>1&&n.sort(t||hp)}return{opaque:i,transmissive:r,transparent:n,init:o,push:s,unshift:l,finish:function(){for(let i=t,r=e.length;i<r;i++){let t=e[i];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:h}}function hf(){let e=new WeakMap;return{get:function(t,i){let r;let n=e.get(t);return void 0===n?(r=new hm,e.set(t,[r])):i>=n.length?(r=new hm,n.push(r)):r=n[i],r},dispose:function(){e=new WeakMap}}}function hg(){let e={};return{get:function(t){let i;if(void 0!==e[t.id])return e[t.id];switch(t.type){case"DirectionalLight":i={direction:new iQ,color:new iB};break;case"SpotLight":i={position:new iQ,direction:new iQ,color:new iB,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new iQ,color:new iB,distance:0,decay:0};break;case"HemisphereLight":i={direction:new iQ,skyColor:new iB,groundColor:new iB};break;case"RectAreaLight":i={color:new iB,position:new iQ,halfWidth:new iQ,halfHeight:new iQ}}return e[t.id]=i,i}}}function hy(){let e={};return{get:function(t){let i;if(void 0!==e[t.id])return e[t.id];switch(t.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new iv};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new iv,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=i,i}}}let hx=0;function hw(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function hb(e,t){let i=new hg,r=hy(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let e=0;e<9;e++)n.probe.push(new iQ);let o=new iQ,a=new rw,s=new rw;return{setup:function(o,a){let s=0,l=0,h=0;for(let e=0;e<9;e++)n.probe[e].set(0,0,0);let c=0,d=0,u=0,p=0,m=0,f=0,g=0,y=0,x=0,w=0;o.sort(hw);let b=!0!==a?Math.PI:1;for(let e=0,t=o.length;e<t;e++){let t=o[e],a=t.color,v=t.intensity,M=t.distance,S=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)s+=a.r*v*b,l+=a.g*v*b,h+=a.b*v*b;else if(t.isLightProbe)for(let e=0;e<9;e++)n.probe[e].addScaledVector(t.sh.coefficients[e],v);else if(t.isDirectionalLight){let e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*b),t.castShadow){let e=t.shadow,i=r.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,n.directionalShadow[c]=i,n.directionalShadowMap[c]=S,n.directionalShadowMatrix[c]=t.shadow.matrix,f++}n.directional[c]=e,c++}else if(t.isSpotLight){let e=i.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(a).multiplyScalar(v*b),e.distance=M,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,n.spot[u]=e;let o=t.shadow;if(t.map&&(n.spotLightMap[x]=t.map,x++,o.updateMatrices(t),t.castShadow&&w++),n.spotLightMatrix[u]=o.matrix,t.castShadow){let e=r.get(t);e.shadowBias=o.bias,e.shadowNormalBias=o.normalBias,e.shadowRadius=o.radius,e.shadowMapSize=o.mapSize,n.spotShadow[u]=e,n.spotShadowMap[u]=S,y++}u++}else if(t.isRectAreaLight){let e=i.get(t);e.color.copy(a).multiplyScalar(v),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),n.rectArea[p]=e,p++}else if(t.isPointLight){let e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*b),e.distance=t.distance,e.decay=t.decay,t.castShadow){let e=t.shadow,i=r.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,i.shadowCameraNear=e.camera.near,i.shadowCameraFar=e.camera.far,n.pointShadow[d]=i,n.pointShadowMap[d]=S,n.pointShadowMatrix[d]=t.shadow.matrix,g++}n.point[d]=e,d++}else if(t.isHemisphereLight){let e=i.get(t);e.skyColor.copy(t.color).multiplyScalar(v*b),e.groundColor.copy(t.groundColor).multiplyScalar(v*b),n.hemi[m]=e,m++}}p>0&&(t.isWebGL2?(n.rectAreaLTC1=su.LTC_FLOAT_1,n.rectAreaLTC2=su.LTC_FLOAT_2):!0===e.has("OES_texture_float_linear")?(n.rectAreaLTC1=su.LTC_FLOAT_1,n.rectAreaLTC2=su.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(n.rectAreaLTC1=su.LTC_HALF_1,n.rectAreaLTC2=su.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=s,n.ambient[1]=l,n.ambient[2]=h;let v=n.hash;(v.directionalLength!==c||v.pointLength!==d||v.spotLength!==u||v.rectAreaLength!==p||v.hemiLength!==m||v.numDirectionalShadows!==f||v.numPointShadows!==g||v.numSpotShadows!==y||v.numSpotMaps!==x)&&(n.directional.length=c,n.spot.length=u,n.rectArea.length=p,n.point.length=d,n.hemi.length=m,n.directionalShadow.length=f,n.directionalShadowMap.length=f,n.pointShadow.length=g,n.pointShadowMap.length=g,n.spotShadow.length=y,n.spotShadowMap.length=y,n.directionalShadowMatrix.length=f,n.pointShadowMatrix.length=g,n.spotLightMatrix.length=y+x-w,n.spotLightMap.length=x,n.numSpotLightShadowsWithMaps=w,v.directionalLength=c,v.pointLength=d,v.spotLength=u,v.rectAreaLength=p,v.hemiLength=m,v.numDirectionalShadows=f,v.numPointShadows=g,v.numSpotShadows=y,v.numSpotMaps=x,n.version=hx++)},setupView:function(e,t){let i=0,r=0,l=0,h=0,c=0,d=t.matrixWorldInverse;for(let t=0,u=e.length;t<u;t++){let u=e[t];if(u.isDirectionalLight){let e=n.directional[i];e.direction.setFromMatrixPosition(u.matrixWorld),o.setFromMatrixPosition(u.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(d),i++}else if(u.isSpotLight){let e=n.spot[l];e.position.setFromMatrixPosition(u.matrixWorld),e.position.applyMatrix4(d),e.direction.setFromMatrixPosition(u.matrixWorld),o.setFromMatrixPosition(u.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(d),l++}else if(u.isRectAreaLight){let e=n.rectArea[h];e.position.setFromMatrixPosition(u.matrixWorld),e.position.applyMatrix4(d),s.identity(),a.copy(u.matrixWorld),a.premultiply(d),s.extractRotation(a),e.halfWidth.set(.5*u.width,0,0),e.halfHeight.set(0,.5*u.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),h++}else if(u.isPointLight){let e=n.point[r];e.position.setFromMatrixPosition(u.matrixWorld),e.position.applyMatrix4(d),r++}else if(u.isHemisphereLight){let e=n.hemi[c];e.direction.setFromMatrixPosition(u.matrixWorld),e.direction.transformDirection(d),c++}}},state:n}}function hv(e,t){let i=new hb(e,t),r=[],n=[];function o(){r.length=0,n.length=0}function a(e){r.push(e)}function s(e){n.push(e)}function l(e){i.setup(r,e)}function h(e){i.setupView(r,e)}let c={lightsArray:r,shadowsArray:n,lights:i};return{init:o,state:c,setupLights:l,setupLightsView:h,pushLight:a,pushShadow:s}}function hM(e,t){let i=new WeakMap;return{get:function(r,n=0){let o;let a=i.get(r);return void 0===a?(o=new hv(e,t),i.set(r,[o])):n>=a.length?(o=new hv(e,t),a.push(o)):o=a[n],o},dispose:function(){i=new WeakMap}}}class hS extends r3{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=tD,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class hP extends r3{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new iQ,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}let hT="void main() {\n	gl_Position = vec4( position, 1.0 );\n}",h_="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n	const float samples = float( VSM_SAMPLES );\n	float mean = 0.0;\n	float squared_mean = 0.0;\n	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n	for ( float i = 0.0; i < samples; i ++ ) {\n		float uvOffset = uvStart + i * uvStride;\n		#ifdef HORIZONTAL_PASS\n			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n			mean += distribution.x;\n			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n		#else\n			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n			mean += depth;\n			squared_mean += depth * depth;\n		#endif\n	}\n	mean = mean / samples;\n	squared_mean = squared_mean / samples;\n	float std_dev = sqrt( squared_mean - mean * mean );\n	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function hC(e,t,i){let r=new n5,n=new iv,o=new iv,a=new iG,s=new hS({depthPacking:tA}),l=new hP,h={},c=i.maxTextureSize,d={0:w,1:x,2:b},u=new nH({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new iv},radius:{value:4}},vertexShader:hT,fragmentShader:h_}),p=u.clone();p.defines.HORIZONTAL_PASS=1;let m=new ng;m.setAttribute("position",new r8(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let g=new nW(m,u),M=this;function S(i,r){let o=t.update(g);u.defines.VSM_SAMPLES!==i.blurSamples&&(u.defines.VSM_SAMPLES=i.blurSamples,p.defines.VSM_SAMPLES=i.blurSamples,u.needsUpdate=!0,p.needsUpdate=!0),null===i.mapPass&&(i.mapPass=new iH(n.x,n.y)),u.uniforms.shadow_pass.value=i.map.texture,u.uniforms.resolution.value=i.mapSize,u.uniforms.radius.value=i.radius,e.setRenderTarget(i.mapPass),e.clear(),e.renderBufferDirect(r,null,o,u,g,null),p.uniforms.shadow_pass.value=i.mapPass.texture,p.uniforms.resolution.value=i.mapSize,p.uniforms.radius.value=i.radius,e.setRenderTarget(i.map),e.clear(),e.renderBufferDirect(r,null,o,p,g,null)}function P(t,i,r,n,o,a){let c=null,u=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(c=void 0!==u?u:!0===r.isPointLight?l:s,e.localClippingEnabled&&!0===i.clipShadows&&Array.isArray(i.clippingPlanes)&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0){let e=c.uuid,t=i.uuid,r=h[e];void 0===r&&(r={},h[e]=r);let n=r[t];void 0===n&&(n=c.clone(),r[t]=n),c=n}return c.visible=i.visible,c.wireframe=i.wireframe,a===y?c.side=null!==i.shadowSide?i.shadowSide:i.side:c.side=null!==i.shadowSide?i.shadowSide:d[i.side],c.alphaMap=i.alphaMap,c.alphaTest=i.alphaTest,c.clipShadows=i.clipShadows,c.clippingPlanes=i.clippingPlanes,c.clipIntersection=i.clipIntersection,c.displacementMap=i.displacementMap,c.displacementScale=i.displacementScale,c.displacementBias=i.displacementBias,c.wireframeLinewidth=i.wireframeLinewidth,c.linewidth=i.linewidth,!0===r.isPointLight&&!0===c.isMeshDistanceMaterial&&(c.referencePosition.setFromMatrixPosition(r.matrixWorld),c.nearDistance=n,c.farDistance=o),c}function T(i,n,o,a,s){if(!1===i.visible)return;let l=i.layers.test(n.layers);if(l&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&s===y)&&(!i.frustumCulled||r.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,i.matrixWorld);let r=t.update(i),n=i.material;if(Array.isArray(n)){let t=r.groups;for(let l=0,h=t.length;l<h;l++){let h=t[l],c=n[h.materialIndex];if(c&&c.visible){let t=P(i,c,a,o.near,o.far,s);e.renderBufferDirect(o,null,r,t,i,h)}}}else if(n.visible){let t=P(i,n,a,o.near,o.far,s);e.renderBufferDirect(o,null,r,t,i,null)}}let h=i.children;for(let e=0,t=h.length;e<t;e++)T(h[e],n,o,a,s)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=f,this.render=function(t,i,s){if(!1===M.enabled||!1===M.autoUpdate&&!1===M.needsUpdate||0===t.length)return;let l=e.getRenderTarget(),h=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),u=e.state;u.setBlending(v),u.buffers.color.setClear(1,1,1,1),u.buffers.depth.setTest(!0),u.setScissorTest(!1);for(let l=0,h=t.length;l<h;l++){let h=t[l],d=h.shadow;if(void 0===d){console.warn("THREE.WebGLShadowMap:",h,"has no shadow.");continue}if(!1===d.autoUpdate&&!1===d.needsUpdate)continue;n.copy(d.mapSize);let p=d.getFrameExtents();if(n.multiply(p),o.copy(d.mapSize),(n.x>c||n.y>c)&&(n.x>c&&(o.x=Math.floor(c/p.x),n.x=o.x*p.x,d.mapSize.x=o.x),n.y>c&&(o.y=Math.floor(c/p.y),n.y=o.y*p.y,d.mapSize.y=o.y)),null===d.map){let e=this.type!==y?{minFilter:eg,magFilter:eg}:{};d.map=new iH(n.x,n.y,e),d.map.texture.name=h.name+".shadowMap",d.camera.updateProjectionMatrix()}e.setRenderTarget(d.map),e.clear();let m=d.getViewportCount();for(let e=0;e<m;e++){let t=d.getViewport(e);a.set(o.x*t.x,o.y*t.y,o.x*t.z,o.y*t.w),u.viewport(a),d.updateMatrices(h,e),r=d.getFrustum(),T(i,s,d.camera,h,this.type)}!0!==d.isPointLightShadow&&this.type===y&&S(d,s),d.needsUpdate=!1}M.needsUpdate=!1,e.setRenderTarget(l,h,d)}}function hD(e,t,i){let r=i.isWebGL2;function n(){let t=!1,i=new iG,r=null,n=new iG(0,0,0,0);return{setMask:function(i){r===i||t||(e.colorMask(i,i,i,i),r=i)},setLocked:function(e){t=e},setClear:function(t,r,o,a,s){!0===s&&(t*=a,r*=a,o*=a),i.set(t,r,o,a),!1===n.equals(i)&&(e.clearColor(t,r,o,a),n.copy(i))},reset:function(){t=!1,r=null,n.set(-1,0,0,0)}}}function o(){let t=!1,i=null,r=null,n=null;return{setTest:function(e){e?eT(2929):e_(2929)},setMask:function(r){i===r||t||(e.depthMask(r),i=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case G:e.depthFunc(512);break;case H:e.depthFunc(519);break;case j:e.depthFunc(513);break;case q:e.depthFunc(515);break;case X:e.depthFunc(514);break;case Y:e.depthFunc(518);break;case J:e.depthFunc(516);break;case Z:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);r=t}},setLocked:function(e){t=e},setClear:function(t){n!==t&&(e.clearDepth(t),n=t)},reset:function(){t=!1,i=null,r=null,n=null}}}function a(){let t=!1,i=null,r=null,n=null,o=null,a=null,s=null,l=null,h=null;return{setTest:function(e){t||(e?eT(2960):e_(2960))},setMask:function(r){i===r||t||(e.stencilMask(r),i=r)},setFunc:function(t,i,a){(r!==t||n!==i||o!==a)&&(e.stencilFunc(t,i,a),r=t,n=i,o=a)},setOp:function(t,i,r){(a!==t||s!==i||l!==r)&&(e.stencilOp(t,i,r),a=t,s=i,l=r)},setLocked:function(e){t=e},setClear:function(t){h!==t&&(e.clearStencil(t),h=t)},reset:function(){t=!1,i=null,r=null,n=null,o=null,a=null,s=null,l=null,h=null}}}let s=new n,l=new o,h=new a,p=new WeakMap,m=new WeakMap,f={},g={},y=new WeakMap,x=[],Q=null,K=!1,ee=null,et=null,ei=null,er=null,en=null,eo=null,ea=null,es=!1,el=null,eh=null,ec=null,ed=null,eu=null,ep=e.getParameter(35661),em=!1,ef=0,eg=e.getParameter(7938);-1!==eg.indexOf("WebGL")?em=(ef=parseFloat(/^WebGL (\d)/.exec(eg)[1]))>=1:-1!==eg.indexOf("OpenGL ES")&&(em=(ef=parseFloat(/^OpenGL ES (\d)/.exec(eg)[1]))>=2);let ey=null,ex={},ew=e.getParameter(3088),eb=e.getParameter(2978),ev=new iG().fromArray(ew),eM=new iG().fromArray(eb);function eS(t,i,r){let n=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let t=0;t<r;t++)e.texImage2D(i+t,0,6408,1,1,0,6408,5121,n);return o}let eP={};function eT(t){!0!==f[t]&&(e.enable(t),f[t]=!0)}function e_(t){!1!==f[t]&&(e.disable(t),f[t]=!1)}function eC(t,i){return g[t]!==i&&(e.bindFramebuffer(t,i),g[t]=i,r&&(36009===t&&(g[36160]=i),36160===t&&(g[36009]=i)),!0)}function eD(r,n){let o=x,a=!1;if(r){if(void 0===(o=y.get(n))&&(o=[],y.set(n,o)),r.isWebGLMultipleRenderTargets){let e=r.texture;if(o.length!==e.length||36064!==o[0]){for(let t=0,i=e.length;t<i;t++)o[t]=36064+t;o.length=e.length,a=!0}}else 36064!==o[0]&&(o[0]=36064,a=!0)}else 1029!==o[0]&&(o[0]=1029,a=!0);a&&(i.isWebGL2?e.drawBuffers(o):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(o))}function eA(t){return Q!==t&&(e.useProgram(t),Q=t,!0)}eP[3553]=eS(3553,3553,1),eP[34067]=eS(34067,34069,6),s.setClear(0,0,0,1),l.setClear(1),h.setClear(0),eT(2929),l.setFunc(q),eW(!1),eV(d),eT(2884),eI(v);let eE={[C]:32774,[D]:32778,[A]:32779};if(r)eE[E]=32775,eE[L]=32776;else{let e=t.get("EXT_blend_minmax");null!==e&&(eE[E]=e.MIN_EXT,eE[L]=e.MAX_EXT)}let eL={[I]:0,[R]:1,[W]:768,[k]:770,[N]:776,[z]:774,[O]:772,[V]:769,[B]:771,[U]:775,[F]:773};function eI(t,i,r,n,o,a,s,l){if(t===v){!0===K&&(e_(3042),K=!1);return}if(!1===K&&(eT(3042),K=!0),t!==_){if(t!==ee||l!==es){if((et!==C||en!==C)&&(e.blendEquation(32774),et=C,en=C),l)switch(t){case M:e.blendFuncSeparate(1,771,1,771);break;case S:e.blendFunc(1,1);break;case P:e.blendFuncSeparate(0,769,0,1);break;case T:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case M:e.blendFuncSeparate(770,771,1,771);break;case S:e.blendFunc(770,1);break;case P:e.blendFuncSeparate(0,769,0,1);break;case T:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}ei=null,er=null,eo=null,ea=null,ee=t,es=l}return}o=o||i,a=a||r,s=s||n,(i!==et||o!==en)&&(e.blendEquationSeparate(eE[i],eE[o]),et=i,en=o),(r!==ei||n!==er||a!==eo||s!==ea)&&(e.blendFuncSeparate(eL[r],eL[n],eL[a],eL[s]),ei=r,er=n,eo=a,ea=s),ee=t,es=null}function eR(e,t){e.side===b?e_(2884):eT(2884);let i=e.side===w;t&&(i=!i),eW(i),e.blending===M&&!1===e.transparent?eI(v):eI(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),l.setFunc(e.depthFunc),l.setTest(e.depthTest),l.setMask(e.depthWrite),s.setMask(e.colorWrite);let r=e.stencilWrite;h.setTest(r),r&&(h.setMask(e.stencilWriteMask),h.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),h.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),ek(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?eT(32926):e_(32926)}function eW(t){el!==t&&(t?e.frontFace(2304):e.frontFace(2305),el=t)}function eV(t){t!==c?(eT(2884),t!==eh&&(t===d?e.cullFace(1029):t===u?e.cullFace(1028):e.cullFace(1032))):e_(2884),eh=t}function ek(t,i,r){t?(eT(32823),(ed!==i||eu!==r)&&(e.polygonOffset(i,r),ed=i,eu=r)):e_(32823)}function eB(e){e?eT(3089):e_(3089)}function eO(t){void 0===t&&(t=33984+ep-1),ey!==t&&(e.activeTexture(t),ey=t)}function eF(t,i){null===ey&&eO();let r=ex[ey];void 0===r&&(r={type:void 0,texture:void 0},ex[ey]=r),(r.type!==t||r.texture!==i)&&(e.bindTexture(t,i||eP[t]),r.type=t,r.texture=i)}function ez(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===r&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),f={},ey=null,ex={},g={},y=new WeakMap,x=[],Q=null,K=!1,ee=null,et=null,ei=null,er=null,en=null,eo=null,ea=null,es=!1,el=null,eh=null,ec=null,ed=null,eu=null,ev.set(0,0,e.canvas.width,e.canvas.height),eM.set(0,0,e.canvas.width,e.canvas.height),s.reset(),l.reset(),h.reset()}return{buffers:{color:s,depth:l,stencil:h},enable:eT,disable:e_,bindFramebuffer:eC,drawBuffers:eD,useProgram:eA,setBlending:eI,setMaterial:eR,setFlipSided:eW,setCullFace:eV,setLineWidth:function(t){t!==ec&&(em&&e.lineWidth(t),ec=t)},setPolygonOffset:ek,setScissorTest:eB,activeTexture:eO,bindTexture:eF,unbindTexture:function(){let t=ex[ey];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,i){let r=m.get(i);void 0===r&&(r=new WeakMap,m.set(i,r));let n=r.get(t);void 0===n&&(n=e.getUniformBlockIndex(i,t.name),r.set(t,n))},uniformBlockBinding:function(t,i){let r=m.get(i),n=r.get(t);p.get(t)!==n&&(e.uniformBlockBinding(i,n,t.__bindingPointIndex),p.set(t,n))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===ev.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),ev.copy(t))},viewport:function(t){!1===eM.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),eM.copy(t))},reset:ez}}function hA(e,t,i,r,n,o,a){let s;let l=n.isWebGL2,h=n.maxTextures,c=n.maxCubemapSize,d=n.maxTextureSize,u=n.maxSamples,p=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,m=/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap,g=new WeakMap,y=!1;try{y="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function x(e,t){return y?new OffscreenCanvas(e,t):i_("canvas")}function w(e,t,i,r){let n=1;if((e.width>r||e.height>r)&&(n=r/Math.max(e.width,e.height)),n<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){let r=t?iy:Math.floor,o=r(n*e.width),a=r(n*e.height);void 0===s&&(s=x(o,a));let l=i?x(o,a):s;l.width=o,l.height=a;let h=l.getContext("2d");return h.drawImage(e,0,0,o,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+a+")."),l}"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+").")}return e}function b(e){return im(e.width)&&im(e.height)}function v(e){return!l&&(e.wrapS!==em||e.wrapT!==em||e.minFilter!==eg&&e.minFilter!==ev)}function M(e,t){return e.generateMipmaps&&t&&e.minFilter!==eg&&e.minFilter!==ev}function S(t){e.generateMipmap(t)}function P(i,r,n,o,a=!1){if(!1===l)return r;if(null!==i){if(void 0!==e[i])return e[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let s=r;return 6403===r&&(5126===n&&(s=33326),5131===n&&(s=33325),5121===n&&(s=33321)),33319===r&&(5126===n&&(s=33328),5131===n&&(s=33327),5121===n&&(s=33323)),6408===r&&(5126===n&&(s=34836),5131===n&&(s=34842),5121===n&&(s=o===tC&&!1===a?35907:32856),32819===n&&(s=32854),32820===n&&(s=32855)),(33325===s||33326===s||33327===s||33328===s||34842===s||34836===s)&&t.get("EXT_color_buffer_float"),s}function T(e,t,i){return!0===M(e,i)||e.isFramebufferTexture&&e.minFilter!==eg&&e.minFilter!==ev?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function _(e){return e===eg||e===ey||e===ew?9728:9729}function C(e){let t=e.target;t.removeEventListener("dispose",C),A(t),t.isVideoTexture&&f.delete(t)}function D(e){let t=e.target;t.removeEventListener("dispose",D),L(t)}function A(e){let t=r.get(e);if(void 0===t.__webglInit)return;let i=e.source,n=g.get(i);if(n){let r=n[t.__cacheKey];r.usedTimes--,0===r.usedTimes&&E(e),0===Object.keys(n).length&&g.delete(i)}r.remove(e)}function E(t){let i=r.get(t);e.deleteTexture(i.__webglTexture);let n=t.source,o=g.get(n);delete o[i.__cacheKey],a.memory.textures--}function L(t){let i=t.texture,n=r.get(t),o=r.get(i);if(void 0!==o.__webglTexture&&(e.deleteTexture(o.__webglTexture),a.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[t]);else{if(e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let t=0;t<n.__webglColorRenderbuffer.length;t++)n.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[t]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let t=0,n=i.length;t<n;t++){let n=r.get(i[t]);n.__webglTexture&&(e.deleteTexture(n.__webglTexture),a.memory.textures--),r.remove(i[t])}r.remove(i),r.remove(t)}let I=0;function R(){I=0}function W(){let e=I;return e>=h&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+h),I+=1,e}function V(e){let t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.encoding),t.join()}function k(e,t){let n=r.get(e);if(e.isVideoTexture&&er(e),!1===e.isRenderTargetTexture&&e.version>0&&n.__version!==e.version){let i=e.image;if(null===i)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(!1===i.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{H(n,e,t);return}}i.activeTexture(33984+t),i.bindTexture(3553,n.__webglTexture)}function B(e,t){let n=r.get(e);if(e.version>0&&n.__version!==e.version){H(n,e,t);return}i.activeTexture(33984+t),i.bindTexture(35866,n.__webglTexture)}function O(e,t){let n=r.get(e);if(e.version>0&&n.__version!==e.version){H(n,e,t);return}i.activeTexture(33984+t),i.bindTexture(32879,n.__webglTexture)}function F(e,t){let n=r.get(e);if(e.version>0&&n.__version!==e.version){j(n,e,t);return}i.activeTexture(33984+t),i.bindTexture(34067,n.__webglTexture)}let z={[ep]:10497,[em]:33071,[ef]:33648},U={[eg]:9728,[ey]:9984,[ew]:9986,[ev]:9729,[eM]:9985,[eP]:9987};function N(i,o,a){if(a?(e.texParameteri(i,10242,z[o.wrapS]),e.texParameteri(i,10243,z[o.wrapT]),(32879===i||35866===i)&&e.texParameteri(i,32882,z[o.wrapR]),e.texParameteri(i,10240,U[o.magFilter]),e.texParameteri(i,10241,U[o.minFilter])):(e.texParameteri(i,10242,33071),e.texParameteri(i,10243,33071),(32879===i||35866===i)&&e.texParameteri(i,32882,33071),(o.wrapS!==em||o.wrapT!==em)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(i,10240,_(o.magFilter)),e.texParameteri(i,10241,_(o.minFilter)),o.minFilter!==eg&&o.minFilter!==ev&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){let a=t.get("EXT_texture_filter_anisotropic");(o.type!==eI||!1!==t.has("OES_texture_float_linear"))&&(!1!==l||o.type!==eR||!1!==t.has("OES_texture_half_float_linear"))&&(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(e.texParameterf(i,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,n.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function G(t,i){let r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",C));let n=i.source,o=g.get(n);void 0===o&&(o={},g.set(n,o));let s=V(i);if(s!==t.__cacheKey){void 0===o[s]&&(o[s]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,r=!0),o[s].usedTimes++;let n=o[t.__cacheKey];void 0!==n&&(o[t.__cacheKey].usedTimes--,0===n.usedTimes&&E(i)),t.__cacheKey=s,t.__webglTexture=o[s].texture}return r}function H(t,r,n){let a=3553;r.isDataArrayTexture&&(a=35866),r.isData3DTexture&&(a=32879);let s=G(t,r),h=r.source;if(i.activeTexture(33984+n),i.bindTexture(a,t.__webglTexture),h.version!==h.__currentVersion||!0===s){let t;e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);let n=v(r)&&!1===b(r.image),c=w(r.image,n,!1,d);c=en(r,c);let u=b(c)||l,p=o.convert(r.format,r.encoding),m=o.convert(r.type),f=P(r.internalFormat,p,m,r.encoding,r.isVideoTexture);N(a,r,u);let g=r.mipmaps,y=l&&!0!==r.isVideoTexture,x=void 0===h.__currentVersion||!0===s,_=T(r,c,u);if(r.isDepthTexture)f=6402,l?f=r.type===eI?36012:r.type===eL?33190:r.type===ek?35056:33189:r.type===eI&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===eN&&6402===f&&r.type!==eA&&r.type!==eL&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=eL,m=o.convert(r.type)),r.format===eG&&6402===f&&(f=34041,r.type!==ek&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=ek,m=o.convert(r.type))),x&&(y?i.texStorage2D(3553,1,f,c.width,c.height):i.texImage2D(3553,0,f,c.width,c.height,0,p,m,null));else if(r.isDataTexture){if(g.length>0&&u){y&&x&&i.texStorage2D(3553,_,f,g[0].width,g[0].height);for(let e=0,r=g.length;e<r;e++)t=g[e],y?i.texSubImage2D(3553,e,0,0,t.width,t.height,p,m,t.data):i.texImage2D(3553,e,f,t.width,t.height,0,p,m,t.data);r.generateMipmaps=!1}else y?(x&&i.texStorage2D(3553,_,f,c.width,c.height),i.texSubImage2D(3553,0,0,0,c.width,c.height,p,m,c.data)):i.texImage2D(3553,0,f,c.width,c.height,0,p,m,c.data)}else if(r.isCompressedTexture){y&&x&&i.texStorage2D(3553,_,f,g[0].width,g[0].height);for(let e=0,n=g.length;e<n;e++)t=g[e],r.format!==eF?null!==p?y?i.compressedTexSubImage2D(3553,e,0,0,t.width,t.height,p,t.data):i.compressedTexImage2D(3553,e,f,t.width,t.height,0,t.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):y?i.texSubImage2D(3553,e,0,0,t.width,t.height,p,m,t.data):i.texImage2D(3553,e,f,t.width,t.height,0,p,m,t.data)}else if(r.isDataArrayTexture)y?(x&&i.texStorage3D(35866,_,f,c.width,c.height,c.depth),i.texSubImage3D(35866,0,0,0,0,c.width,c.height,c.depth,p,m,c.data)):i.texImage3D(35866,0,f,c.width,c.height,c.depth,0,p,m,c.data);else if(r.isData3DTexture)y?(x&&i.texStorage3D(32879,_,f,c.width,c.height,c.depth),i.texSubImage3D(32879,0,0,0,0,c.width,c.height,c.depth,p,m,c.data)):i.texImage3D(32879,0,f,c.width,c.height,c.depth,0,p,m,c.data);else if(r.isFramebufferTexture){if(x){if(y)i.texStorage2D(3553,_,f,c.width,c.height);else{let e=c.width,t=c.height;for(let r=0;r<_;r++)i.texImage2D(3553,r,f,e,t,0,p,m,null),e>>=1,t>>=1}}}else if(g.length>0&&u){y&&x&&i.texStorage2D(3553,_,f,g[0].width,g[0].height);for(let e=0,r=g.length;e<r;e++)t=g[e],y?i.texSubImage2D(3553,e,0,0,p,m,t):i.texImage2D(3553,e,f,p,m,t);r.generateMipmaps=!1}else y?(x&&i.texStorage2D(3553,_,f,c.width,c.height),i.texSubImage2D(3553,0,0,0,p,m,c)):i.texImage2D(3553,0,f,p,m,c);M(r,u)&&S(a),h.__currentVersion=h.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}function j(t,r,n){if(6!==r.image.length)return;let a=G(t,r),s=r.source;if(i.activeTexture(33984+n),i.bindTexture(34067,t.__webglTexture),s.version!==s.__currentVersion||!0===a){let t;e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);let n=r.isCompressedTexture||r.image[0].isCompressedTexture,h=r.image[0]&&r.image[0].isDataTexture,d=[];for(let e=0;e<6;e++)n||h?d[e]=h?r.image[e].image:r.image[e]:d[e]=w(r.image[e],!1,!0,c),d[e]=en(r,d[e]);let u=d[0],p=b(u)||l,m=o.convert(r.format,r.encoding),f=o.convert(r.type),g=P(r.internalFormat,m,f,r.encoding),y=l&&!0!==r.isVideoTexture,x=void 0===s.__currentVersion||!0===a,v=T(r,u,p);if(N(34067,r,p),n){y&&x&&i.texStorage2D(34067,v,g,u.width,u.height);for(let e=0;e<6;e++){t=d[e].mipmaps;for(let n=0;n<t.length;n++){let o=t[n];r.format!==eF?null!==m?y?i.compressedTexSubImage2D(34069+e,n,0,0,o.width,o.height,m,o.data):i.compressedTexImage2D(34069+e,n,g,o.width,o.height,0,o.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):y?i.texSubImage2D(34069+e,n,0,0,o.width,o.height,m,f,o.data):i.texImage2D(34069+e,n,g,o.width,o.height,0,m,f,o.data)}}}else{t=r.mipmaps,y&&x&&(t.length>0&&v++,i.texStorage2D(34067,v,g,d[0].width,d[0].height));for(let e=0;e<6;e++)if(h){y?i.texSubImage2D(34069+e,0,0,0,d[e].width,d[e].height,m,f,d[e].data):i.texImage2D(34069+e,0,g,d[e].width,d[e].height,0,m,f,d[e].data);for(let r=0;r<t.length;r++){let n=t[r],o=n.image[e].image;y?i.texSubImage2D(34069+e,r+1,0,0,o.width,o.height,m,f,o.data):i.texImage2D(34069+e,r+1,g,o.width,o.height,0,m,f,o.data)}}else{y?i.texSubImage2D(34069+e,0,0,0,m,f,d[e]):i.texImage2D(34069+e,0,g,m,f,d[e]);for(let r=0;r<t.length;r++){let n=t[r];y?i.texSubImage2D(34069+e,r+1,0,0,m,f,n.image[e]):i.texImage2D(34069+e,r+1,g,m,f,n.image[e])}}}M(r,p)&&S(34067),s.__currentVersion=s.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}function q(t,n,a,s,l){let h=o.convert(a.format,a.encoding),c=o.convert(a.type),d=P(a.internalFormat,h,c,a.encoding),u=r.get(n);u.__hasExternalTextures||(32879===l||35866===l?i.texImage3D(l,0,d,n.width,n.height,n.depth,0,h,c,null):i.texImage2D(l,0,d,n.width,n.height,0,h,c,null)),i.bindFramebuffer(36160,t),ei(n)?p.framebufferTexture2DMultisampleEXT(36160,s,l,r.get(a).__webglTexture,0,et(n)):e.framebufferTexture2D(36160,s,l,r.get(a).__webglTexture,0),i.bindFramebuffer(36160,null)}function X(t,i,r){if(e.bindRenderbuffer(36161,t),i.depthBuffer&&!i.stencilBuffer){let n=33189;if(r||ei(i)){let t=i.depthTexture;t&&t.isDepthTexture&&(t.type===eI?n=36012:t.type===eL&&(n=33190));let r=et(i);ei(i)?p.renderbufferStorageMultisampleEXT(36161,r,n,i.width,i.height):e.renderbufferStorageMultisample(36161,r,n,i.width,i.height)}else e.renderbufferStorage(36161,n,i.width,i.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(i.depthBuffer&&i.stencilBuffer){let n=et(i);r&&!1===ei(i)?e.renderbufferStorageMultisample(36161,n,35056,i.width,i.height):ei(i)?p.renderbufferStorageMultisampleEXT(36161,n,35056,i.width,i.height):e.renderbufferStorage(36161,34041,i.width,i.height),e.framebufferRenderbuffer(36160,33306,36161,t)}else{let t=!0===i.isWebGLMultipleRenderTargets?i.texture:[i.texture];for(let n=0;n<t.length;n++){let a=t[n],s=o.convert(a.format,a.encoding),l=o.convert(a.type),h=P(a.internalFormat,s,l,a.encoding),c=et(i);r&&!1===ei(i)?e.renderbufferStorageMultisample(36161,c,h,i.width,i.height):ei(i)?p.renderbufferStorageMultisampleEXT(36161,c,h,i.width,i.height):e.renderbufferStorage(36161,h,i.width,i.height)}}e.bindRenderbuffer(36161,null)}function Y(t,n){let o=n&&n.isWebGLCubeRenderTarget;if(o)throw Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,t),!(n.depthTexture&&n.depthTexture.isDepthTexture))throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),k(n.depthTexture,0);let a=r.get(n.depthTexture).__webglTexture,s=et(n);if(n.depthTexture.format===eN)ei(n)?p.framebufferTexture2DMultisampleEXT(36160,36096,3553,a,0,s):e.framebufferTexture2D(36160,36096,3553,a,0);else if(n.depthTexture.format===eG)ei(n)?p.framebufferTexture2DMultisampleEXT(36160,33306,3553,a,0,s):e.framebufferTexture2D(36160,33306,3553,a,0);else throw Error("Unknown depthTexture format")}function J(t){let n=r.get(t),o=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!n.__autoAllocateDepthBuffer){if(o)throw Error("target.depthTexture not supported in Cube render targets");Y(n.__webglFramebuffer,t)}else if(o){n.__webglDepthbuffer=[];for(let r=0;r<6;r++)i.bindFramebuffer(36160,n.__webglFramebuffer[r]),n.__webglDepthbuffer[r]=e.createRenderbuffer(),X(n.__webglDepthbuffer[r],t,!1)}else i.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),X(n.__webglDepthbuffer,t,!1);i.bindFramebuffer(36160,null)}function Z(e,t,i){let n=r.get(e);void 0!==t&&q(n.__webglFramebuffer,e,e.texture,36064,3553),void 0!==i&&J(e)}function Q(t){let s=t.texture,h=r.get(t),c=r.get(s);t.addEventListener("dispose",D),!0!==t.isWebGLMultipleRenderTargets&&(void 0===c.__webglTexture&&(c.__webglTexture=e.createTexture()),c.__version=s.version,a.memory.textures++);let d=!0===t.isWebGLCubeRenderTarget,u=!0===t.isWebGLMultipleRenderTargets,p=b(t)||l;if(d){h.__webglFramebuffer=[];for(let t=0;t<6;t++)h.__webglFramebuffer[t]=e.createFramebuffer()}else{if(h.__webglFramebuffer=e.createFramebuffer(),u){if(n.drawBuffers){let i=t.texture;for(let t=0,n=i.length;t<n;t++){let n=r.get(i[t]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.")}if(l&&t.samples>0&&!1===ei(t)){let r=u?s:[s];h.__webglMultisampledFramebuffer=e.createFramebuffer(),h.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,h.__webglMultisampledFramebuffer);for(let i=0;i<r.length;i++){let n=r[i];h.__webglColorRenderbuffer[i]=e.createRenderbuffer(),e.bindRenderbuffer(36161,h.__webglColorRenderbuffer[i]);let a=o.convert(n.format,n.encoding),s=o.convert(n.type),l=P(n.internalFormat,a,s,n.encoding),c=et(t);e.renderbufferStorageMultisample(36161,c,l,t.width,t.height),e.framebufferRenderbuffer(36160,36064+i,36161,h.__webglColorRenderbuffer[i])}e.bindRenderbuffer(36161,null),t.depthBuffer&&(h.__webglDepthRenderbuffer=e.createRenderbuffer(),X(h.__webglDepthRenderbuffer,t,!0)),i.bindFramebuffer(36160,null)}}if(d){i.bindTexture(34067,c.__webglTexture),N(34067,s,p);for(let e=0;e<6;e++)q(h.__webglFramebuffer[e],t,s,36064,34069+e);M(s,p)&&S(34067),i.unbindTexture()}else if(u){let e=t.texture;for(let n=0,o=e.length;n<o;n++){let o=e[n],a=r.get(o);i.bindTexture(3553,a.__webglTexture),N(3553,o,p),q(h.__webglFramebuffer,t,o,36064+n,3553),M(o,p)&&S(3553)}i.unbindTexture()}else{let e=3553;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(l?e=t.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(e,c.__webglTexture),N(e,s,p),q(h.__webglFramebuffer,t,s,36064,e),M(s,p)&&S(e),i.unbindTexture()}t.depthBuffer&&J(t)}function K(e){let t=b(e)||l,n=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let o=0,a=n.length;o<a;o++){let a=n[o];if(M(a,t)){let t=e.isWebGLCubeRenderTarget?34067:3553,n=r.get(a).__webglTexture;i.bindTexture(t,n),S(t),i.unbindTexture()}}}function ee(t){if(l&&t.samples>0&&!1===ei(t)){let n=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],o=t.width,a=t.height,s=16384,l=[],h=t.stencilBuffer?33306:36096,c=r.get(t),d=!0===t.isWebGLMultipleRenderTargets;if(d)for(let t=0;t<n.length;t++)i.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+t,36161,null),i.bindFramebuffer(36160,c.__webglFramebuffer),e.framebufferTexture2D(36009,36064+t,3553,null,0);i.bindFramebuffer(36008,c.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,c.__webglFramebuffer);for(let i=0;i<n.length;i++){l.push(36064+i),t.depthBuffer&&l.push(h);let u=void 0!==c.__ignoreDepthValues&&c.__ignoreDepthValues;if(!1===u&&(t.depthBuffer&&(s|=256),t.stencilBuffer&&(s|=1024)),d&&e.framebufferRenderbuffer(36008,36064,36161,c.__webglColorRenderbuffer[i]),!0===u&&(e.invalidateFramebuffer(36008,[h]),e.invalidateFramebuffer(36009,[h])),d){let t=r.get(n[i]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,t,0)}e.blitFramebuffer(0,0,o,a,0,0,o,a,s,9728),m&&e.invalidateFramebuffer(36008,l)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),d)for(let t=0;t<n.length;t++){i.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+t,36161,c.__webglColorRenderbuffer[t]);let o=r.get(n[t]).__webglTexture;i.bindFramebuffer(36160,c.__webglFramebuffer),e.framebufferTexture2D(36009,36064+t,3553,o,0)}i.bindFramebuffer(36009,c.__webglMultisampledFramebuffer)}}function et(e){return Math.min(u,e.samples)}function ei(e){let i=r.get(e);return l&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==i.__useRenderToTexture}function er(e){let t=a.render.frame;f.get(e)!==t&&(f.set(e,t),e.update())}function en(e,i){let r=e.encoding,n=e.format,o=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===t7||r!==t_&&(r===tC?!1===l?!0===t.has("EXT_sRGB")&&n===eF?(e.format=t7,e.minFilter=ev,e.generateMipmaps=!1):i=iO.sRGBToLinear(i):(n!==eF||o!==e_)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",r)),i}this.allocateTextureUnit=W,this.resetTextureUnits=R,this.setTexture2D=k,this.setTexture2DArray=B,this.setTexture3D=O,this.setTextureCube=F,this.rebindTextures=Z,this.setupRenderTarget=Q,this.updateRenderTargetMipmap=K,this.updateMultisampleRenderTarget=ee,this.setupDepthRenderbuffer=J,this.setupFrameBufferTexture=q,this.useMultisampledRTT=ei}function hE(e,t,i){let r=i.isWebGL2;return{convert:function(i,n=null){let o;if(i===e_)return 5121;if(i===eW)return 32819;if(i===eV)return 32820;if(i===eC)return 5120;if(i===eD)return 5122;if(i===eA)return 5123;if(i===eE)return 5124;if(i===eL)return 5125;if(i===eI)return 5126;if(i===eR)return r?5131:null!==(o=t.get("OES_texture_half_float"))?o.HALF_FLOAT_OES:null;if(i===eB)return 6406;if(i===eF)return 6408;if(i===ez)return 6409;if(i===eU)return 6410;if(i===eN)return 6402;if(i===eG)return 34041;if(i===eH)return 6403;if(i===eO)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(i===t7)return null!==(o=t.get("EXT_sRGB"))?o.SRGB_ALPHA_EXT:null;if(i===ej)return 36244;if(i===eq)return 33319;if(i===eX)return 33320;if(i===eY)return 36249;if(i===eJ||i===eZ||i===eQ||i===eK){if(n===tC){if(null===(o=t.get("WEBGL_compressed_texture_s3tc_srgb")))return null;if(i===eJ)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===eZ)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===eQ)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===eK)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(o=t.get("WEBGL_compressed_texture_s3tc")))return null;if(i===eJ)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===eZ)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===eQ)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===eK)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}}if(i===e$||i===e0||i===e1||i===e2){if(null===(o=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(i===e$)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===e0)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===e1)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===e2)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(i===e4)return null!==(o=t.get("WEBGL_compressed_texture_etc1"))?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(i===e5||i===e6){if(null===(o=t.get("WEBGL_compressed_texture_etc")))return null;if(i===e5)return n===tC?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(i===e6)return n===tC?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}if(i===e9||i===e8||i===e7||i===te||i===tt||i===ti||i===tr||i===tn||i===to||i===ta||i===ts||i===tl||i===th||i===tc){if(null===(o=t.get("WEBGL_compressed_texture_astc")))return null;if(i===e9)return n===tC?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===e8)return n===tC?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===e7)return n===tC?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===te)return n===tC?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===tt)return n===tC?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===ti)return n===tC?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===tr)return n===tC?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===tn)return n===tC?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===to)return n===tC?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===ta)return n===tC?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===ts)return n===tC?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===tl)return n===tC?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===th)return n===tC?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===tc)return n===tC?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}if(i===td){if(null===(o=t.get("EXT_texture_compression_bptc")))return null;if(i===td)return n===tC?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}return i===ek?r?34042:null!==(o=t.get("WEBGL_depth_texture"))?o.UNSIGNED_INT_24_8_WEBGL:null:void 0!==e[i]?e[i]:null}}}class hL extends nq{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class hI extends rH{constructor(){super(),this.isGroup=!0,this.type="Group"}}let hR={type:"move"};class hW{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new hI,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new hI,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new iQ,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new iQ),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new hI,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new iQ,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new iQ),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let r=null,n=null,o=null,a=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){for(let r of(o=!0,e.hand.values())){let e=t.getJointPose(r,i);if(void 0===l.joints[r.jointName]){let e=new hI;e.matrixAutoUpdate=!1,e.visible=!1,l.joints[r.jointName]=e,l.add(e)}let n=l.joints[r.jointName];null!==e&&(n.matrix.fromArray(e.transform.matrix),n.matrix.decompose(n.position,n.rotation,n.scale),n.jointRadius=e.radius),n.visible=null!==e}let r=l.joints["index-finger-tip"],n=l.joints["thumb-tip"],a=r.position.distanceTo(n.position),s=.02,h=.005;l.inputState.pinching&&a>s+h?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&a<=s-h&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&null!==(n=t.getPose(e.gripSpace,i))&&(s.matrix.fromArray(n.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),n.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(n.linearVelocity)):s.hasLinearVelocity=!1,n.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(n.angularVelocity)):s.hasAngularVelocity=!1);null!==a&&(null===(r=t.getPose(e.targetRaySpace,i))&&null!==n&&(r=n),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(hR)))}return null!==a&&(a.visible=null!==r),null!==s&&(s.visible=null!==n),null!==l&&(l.visible=null!==o),this}}class hV extends iN{constructor(e,t,i,r,n,o,a,s,l,h){if((h=void 0!==h?h:eN)!==eN&&h!==eG)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&h===eN&&(i=eL),void 0===i&&h===eG&&(i=ek),super(null,r,n,o,a,s,h,i,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==a?a:eg,this.minFilter=void 0!==s?s:eg,this.flipY=!1,this.generateMipmaps=!1}}class hk extends ie{constructor(e,t){super();let i=this,r=null,n=1,o=null,a="local-floor",s=null,l=null,h=null,c=null,d=null,u=null,p=t.getContextAttributes(),m=null,f=null,g=[],y=[],x=new nq;x.layers.enable(1),x.viewport=new iG;let w=new nq;w.layers.enable(2),w.viewport=new iG;let b=[x,w],v=new hL;v.layers.enable(1),v.layers.enable(2);let M=null,S=null;function P(e){let t=y.indexOf(e.inputSource);if(-1===t)return;let i=g[t];void 0!==i&&i.dispatchEvent({type:e.type,data:e.inputSource})}function T(){r.removeEventListener("select",P),r.removeEventListener("selectstart",P),r.removeEventListener("selectend",P),r.removeEventListener("squeeze",P),r.removeEventListener("squeezestart",P),r.removeEventListener("squeezeend",P),r.removeEventListener("end",T),r.removeEventListener("inputsourceschange",_);for(let e=0;e<g.length;e++){let t=y[e];null!==t&&(y[e]=null,g[e].disconnect(t))}M=null,S=null,e.setRenderTarget(m),d=null,c=null,h=null,r=null,f=null,R.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function _(e){for(let t=0;t<e.removed.length;t++){let i=e.removed[t],r=y.indexOf(i);r>=0&&(y[r]=null,g[r].dispatchEvent({type:"disconnected",data:i}))}for(let t=0;t<e.added.length;t++){let i=e.added[t],r=y.indexOf(i);if(-1===r){for(let e=0;e<g.length;e++){if(e>=y.length){y.push(i),r=e;break}if(null===y[e]){y[e]=i,r=e;break}}if(-1===r)break}let n=g[r];n&&n.dispatchEvent({type:"connected",data:i})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=g[e];return void 0===t&&(t=new hW,g[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=g[e];return void 0===t&&(t=new hW,g[e]=t),t.getGripSpace()},this.getHand=function(e){let t=g[e];return void 0===t&&(t=new hW,g[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){n=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){a=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return s||o},this.setReferenceSpace=function(e){s=e},this.getBaseLayer=function(){return null!==c?c:d},this.getBinding=function(){return h},this.getFrame=function(){return u},this.getSession=function(){return r},this.setSession=async function(l){if(null!==(r=l)){if(m=e.getRenderTarget(),r.addEventListener("select",P),r.addEventListener("selectstart",P),r.addEventListener("selectend",P),r.addEventListener("squeeze",P),r.addEventListener("squeezestart",P),r.addEventListener("squeezeend",P),r.addEventListener("end",T),r.addEventListener("inputsourceschange",_),!0!==p.xrCompatible&&await t.makeXRCompatible(),void 0===r.renderState.layers||!1===e.capabilities.isWebGL2){let i={antialias:void 0!==r.renderState.layers||p.antialias,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:n};d=new XRWebGLLayer(r,t,i),r.updateRenderState({baseLayer:d}),f=new iH(d.framebufferWidth,d.framebufferHeight,{format:eF,type:e_,encoding:e.outputEncoding,stencilBuffer:p.stencil})}else{let i=null,o=null,a=null;p.depth&&(a=p.stencil?35056:33190,i=p.stencil?eG:eN,o=p.stencil?ek:eL);let s={colorFormat:32856,depthFormat:a,scaleFactor:n};c=(h=new XRWebGLBinding(r,t)).createProjectionLayer(s),r.updateRenderState({layers:[c]}),f=new iH(c.textureWidth,c.textureHeight,{format:eF,type:e_,depthTexture:new hV(c.textureWidth,c.textureHeight,o,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:p.stencil,encoding:e.outputEncoding,samples:p.antialias?4:0});let l=e.properties.get(f);l.__ignoreDepthValues=c.ignoreDepthValues}f.isXRRenderTarget=!0,this.setFoveation(1),s=null,o=await r.requestReferenceSpace(a),R.setContext(r),R.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};let C=new iQ,D=new iQ;function A(e,t,i){C.setFromMatrixPosition(t.matrixWorld),D.setFromMatrixPosition(i.matrixWorld);let r=C.distanceTo(D),n=t.projectionMatrix.elements,o=i.projectionMatrix.elements,a=n[14]/(n[10]-1),s=n[14]/(n[10]+1),l=(n[9]+1)/n[5],h=(n[9]-1)/n[5],c=(n[8]-1)/n[0],d=(o[8]+1)/o[0],u=a*c,p=a*d,m=r/(-c+d),f=-(m*c);t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(f),e.translateZ(m),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();let g=a+m,y=s+m,x=u-f,w=p+(r-f),b=l*s/y*g,v=h*s/y*g;e.projectionMatrix.makePerspective(x,w,b,v,g,y)}function E(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===r)return;v.near=w.near=x.near=e.near,v.far=w.far=x.far=e.far,(M!==v.near||S!==v.far)&&(r.updateRenderState({depthNear:v.near,depthFar:v.far}),M=v.near,S=v.far);let t=e.parent,i=v.cameras;E(v,t);for(let e=0;e<i.length;e++)E(i[e],t);v.matrixWorld.decompose(v.position,v.quaternion,v.scale),e.matrix.copy(v.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);let n=e.children;for(let e=0,t=n.length;e<t;e++)n[e].updateMatrixWorld(!0);2===i.length?A(v,x,w):v.projectionMatrix.copy(x.projectionMatrix)},this.getCamera=function(){return v},this.getFoveation=function(){return null!==c?c.fixedFoveation:null!==d?d.fixedFoveation:void 0},this.setFoveation=function(e){null!==c&&(c.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)};let L=null;function I(t,i){if(l=i.getViewerPose(s||o),u=i,null!==l){let t=l.views;null!==d&&(e.setRenderTargetFramebuffer(f,d.framebuffer),e.setRenderTarget(f));let i=!1;t.length!==v.cameras.length&&(v.cameras.length=0,i=!0);for(let r=0;r<t.length;r++){let n=t[r],o=null;if(null!==d)o=d.getViewport(n);else{let t=h.getViewSubImage(c,n);o=t.viewport,0===r&&(e.setRenderTargetTextures(f,t.colorTexture,c.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(f))}let a=b[r];void 0===a&&((a=new nq).layers.enable(r),a.viewport=new iG,b[r]=a),a.matrix.fromArray(n.transform.matrix),a.projectionMatrix.fromArray(n.projectionMatrix),a.viewport.set(o.x,o.y,o.width,o.height),0===r&&v.matrix.copy(a.matrix),!0===i&&v.cameras.push(a)}}for(let e=0;e<g.length;e++){let t=y[e],r=g[e];null!==t&&void 0!==r&&r.update(t,i,s||o)}L&&L(t,i),u=null}let R=new n6;R.setAnimationLoop(I),this.setAnimationLoop=function(e){L=e},this.dispose=function(){}}}function hB(e,t){function i(i,r){let n,o;i.opacity.value=r.opacity,r.color&&i.diffuse.value.copy(r.color),r.emissive&&i.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(i.map.value=r.map),r.alphaMap&&(i.alphaMap.value=r.alphaMap),r.bumpMap&&(i.bumpMap.value=r.bumpMap,i.bumpScale.value=r.bumpScale,r.side===w&&(i.bumpScale.value*=-1)),r.displacementMap&&(i.displacementMap.value=r.displacementMap,i.displacementScale.value=r.displacementScale,i.displacementBias.value=r.displacementBias),r.emissiveMap&&(i.emissiveMap.value=r.emissiveMap),r.normalMap&&(i.normalMap.value=r.normalMap,i.normalScale.value.copy(r.normalScale),r.side===w&&i.normalScale.value.negate()),r.specularMap&&(i.specularMap.value=r.specularMap),r.alphaTest>0&&(i.alphaTest.value=r.alphaTest);let a=t.get(r).envMap;if(a&&(i.envMap.value=a,i.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,i.reflectivity.value=r.reflectivity,i.ior.value=r.ior,i.refractionRatio.value=r.refractionRatio),r.lightMap){i.lightMap.value=r.lightMap;let t=!0!==e.physicallyCorrectLights?Math.PI:1;i.lightMapIntensity.value=r.lightMapIntensity*t}r.aoMap&&(i.aoMap.value=r.aoMap,i.aoMapIntensity.value=r.aoMapIntensity),r.map?n=r.map:r.specularMap?n=r.specularMap:r.displacementMap?n=r.displacementMap:r.normalMap?n=r.normalMap:r.bumpMap?n=r.bumpMap:r.roughnessMap?n=r.roughnessMap:r.metalnessMap?n=r.metalnessMap:r.alphaMap?n=r.alphaMap:r.emissiveMap?n=r.emissiveMap:r.clearcoatMap?n=r.clearcoatMap:r.clearcoatNormalMap?n=r.clearcoatNormalMap:r.clearcoatRoughnessMap?n=r.clearcoatRoughnessMap:r.iridescenceMap?n=r.iridescenceMap:r.iridescenceThicknessMap?n=r.iridescenceThicknessMap:r.specularIntensityMap?n=r.specularIntensityMap:r.specularColorMap?n=r.specularColorMap:r.transmissionMap?n=r.transmissionMap:r.thicknessMap?n=r.thicknessMap:r.sheenColorMap?n=r.sheenColorMap:r.sheenRoughnessMap&&(n=r.sheenRoughnessMap),void 0!==n&&(n.isWebGLRenderTarget&&(n=n.texture),!0===n.matrixAutoUpdate&&n.updateMatrix(),i.uvTransform.value.copy(n.matrix)),r.aoMap?o=r.aoMap:r.lightMap&&(o=r.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),i.uv2Transform.value.copy(o.matrix))}function r(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}function n(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function o(e,t,i,r){let n;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*r,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest),t.map?n=t.map:t.alphaMap&&(n=t.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}function a(e,t){let i;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest),t.map?i=t.map:t.alphaMap&&(i=t.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}function s(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}function l(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}function h(e,i){e.roughness.value=i.roughness,e.metalness.value=i.metalness,i.roughnessMap&&(e.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(e.metalnessMap.value=i.metalnessMap);let r=t.get(i).envMap;r&&(e.envMapIntensity.value=i.envMapIntensity)}function c(e,t,i){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap)),t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===w&&e.clearcoatNormalScale.value.negate())),t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap)),t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)),e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}function d(e,t){t.matcap&&(e.matcap.value=t.matcap)}function u(e,t){e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,t,p,m,f){t.isMeshBasicMaterial?i(e,t):t.isMeshLambertMaterial?i(e,t):t.isMeshToonMaterial?(i(e,t),l(e,t)):t.isMeshPhongMaterial?(i(e,t),s(e,t)):t.isMeshStandardMaterial?(i(e,t),h(e,t),t.isMeshPhysicalMaterial&&c(e,t,f)):t.isMeshMatcapMaterial?(i(e,t),d(e,t)):t.isMeshDepthMaterial?i(e,t):t.isMeshDistanceMaterial?(i(e,t),u(e,t)):t.isMeshNormalMaterial?i(e,t):t.isLineBasicMaterial?(r(e,t),t.isLineDashedMaterial&&n(e,t)):t.isPointsMaterial?o(e,t,p,m):t.isSpriteMaterial?a(e,t):t.isShadowMaterial?(e.color.value.copy(t.color),e.opacity.value=t.opacity):t.isShaderMaterial&&(t.uniformsNeedUpdate=!1)}}}function hO(e,t,i,r){let n={},o={},a=[],s=i.isWebGL2?e.getParameter(35375):0;function l(t){let i=h();t.__bindingPointIndex=i;let r=e.createBuffer(),n=t.__size,o=t.usage;return e.bindBuffer(35345,r),e.bufferData(35345,n,o),e.bindBuffer(35345,null),e.bindBufferBase(35345,i,r),r}function h(){for(let e=0;e<s;e++)if(-1===a.indexOf(e))return a.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function c(t){let i=n[t.id],r=t.uniforms,o=t.__cache;e.bindBuffer(35345,i);for(let t=0,i=r.length;t<i;t++){let i=r[t];if(!0===d(i,t,o)){let t=i.value,r=i.__offset;"number"==typeof t?i.__data[0]=t:i.value.isMatrix3?(i.__data[0]=i.value.elements[0],i.__data[1]=i.value.elements[1],i.__data[2]=i.value.elements[2],i.__data[3]=i.value.elements[0],i.__data[4]=i.value.elements[3],i.__data[5]=i.value.elements[4],i.__data[6]=i.value.elements[5],i.__data[7]=i.value.elements[0],i.__data[8]=i.value.elements[6],i.__data[9]=i.value.elements[7],i.__data[10]=i.value.elements[8],i.__data[11]=i.value.elements[0]):t.toArray(i.__data),e.bufferSubData(35345,r,i.__data)}}e.bindBuffer(35345,null)}function d(e,t,i){let r=e.value;if(void 0===i[t])return"number"==typeof r?i[t]=r:i[t]=r.clone(),!0;if("number"==typeof r){if(i[t]!==r)return i[t]=r,!0}else{let e=i[t];if(!1===e.equals(r))return e.copy(r),!0}return!1}function u(e){let t=e.uniforms,i=0,r=16,n=0;for(let e=0,o=t.length;e<o;e++){let o=t[e],a=p(o);if(o.__data=new Float32Array(a.storage/Float32Array.BYTES_PER_ELEMENT),o.__offset=i,e>0){n=i%r;let e=r-n;0!==n&&e-a.boundary<0&&(i+=r-n,o.__offset=i)}i+=a.storage}return(n=i%r)>0&&(i+=r-n),e.__size=i,e.__cache={},this}function p(e){let t=e.value,i={boundary:0,storage:0};return"number"==typeof t?(i.boundary=4,i.storage=4):t.isVector2?(i.boundary=8,i.storage=8):t.isVector3||t.isColor?(i.boundary=16,i.storage=12):t.isVector4?(i.boundary=16,i.storage=16):t.isMatrix3?(i.boundary=48,i.storage=48):t.isMatrix4?(i.boundary=64,i.storage=64):t.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",t),i}function m(t){let i=t.target;i.removeEventListener("dispose",m);let r=a.indexOf(i.__bindingPointIndex);a.splice(r,1),e.deleteBuffer(n[i.id]),delete n[i.id],delete o[i.id]}return{bind:function(e,t){let i=t.program;r.uniformBlockBinding(e,i)},update:function(e,i){let a=n[e.id];void 0===a&&(u(e),a=l(e),n[e.id]=a,e.addEventListener("dispose",m));let s=i.program;r.updateUBOMapping(e,s);let h=t.render.frame;o[e.id]!==h&&(c(e),o[e.id]=h)},dispose:function(){for(let t in n)e.deleteBuffer(n[t]);a=[],n={},o={}}}}function hF(){let e=i_("canvas");return e.style.display="block",e}function hz(e={}){let t,i,r,n,o,a,l,h,c,d,u,p,m,f,g,y,v,M,S,P,T,_,C,D,A;this.isWebGLRenderer=!0;let E=void 0!==e.canvas?e.canvas:hF(),L=void 0!==e.context?e.context:null,I=void 0===e.depth||e.depth,R=void 0===e.stencil||e.stencil,W=void 0!==e.antialias&&e.antialias,V=void 0===e.premultipliedAlpha||e.premultipliedAlpha,k=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,B=void 0!==e.powerPreference?e.powerPreference:"default",O=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;t=null!==L?L.getContextAttributes().alpha:void 0!==e.alpha&&e.alpha;let F=null,z=null,U=[],N=[];this.domElement=E,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=t_,this.physicallyCorrectLights=!1,this.toneMapping=et,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});let G=this,H=!1,j=0,q=0,X=null,Y=-1,J=null,Z=new iG,Q=new iG,K=null,ee=E.width,ei=E.height,er=1,en=null,eo=null,ea=new iG(0,0,ee,ei),es=new iG(0,0,ee,ei),el=!1,eh=new n5,ec=!1,ed=!1,eu=null,ep=new rw,em=new iv,ef=new iQ,eg={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ey(){return null===X?er:1}let ex=L;function ew(e,t){for(let i=0;i<e.length;i++){let r=e[i],n=E.getContext(r,t);if(null!==n)return n}return null}try{let e={alpha:!0,depth:I,stencil:R,antialias:W,premultipliedAlpha:V,preserveDrawingBuffer:k,powerPreference:B,failIfMajorPerformanceCaveat:O};if("setAttribute"in E&&E.setAttribute("data-engine",`three.js r${s}`),E.addEventListener("webglcontextlost",eM,!1),E.addEventListener("webglcontextrestored",eS,!1),E.addEventListener("webglcontextcreationerror",eT,!1),null===ex){let t=["webgl2","webgl","experimental-webgl"];if(!0===G.isWebGL1Renderer&&t.shift(),ex=ew(t,e),null===ex){if(ew(t))throw Error("Error creating WebGL context with your selected attributes.");throw Error("Error creating WebGL context.")}}void 0===ex.getShaderPrecisionFormat&&(ex.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function eb(){i=new sF(ex),r=new sy(ex,i,e),i.init(r),C=new hE(ex,i,r),n=new hD(ex,i,r),o=new sN,a=new hd,l=new hA(ex,i,n,a,r,C,o),h=new sw(G),c=new sO(G),d=new n9(ex,r),D=new sf(ex,i,d,r),u=new sz(ex,d,o,D),p=new sq(ex,u,d,o),P=new sj(ex,r,l),v=new sx(a),m=new hc(G,h,c,i,r,D,v),f=new hB(G,a),g=new hf,y=new hM(i,r),S=new sm(G,h,n,p,t,V),M=new hC(G,p,r),A=new hO(ex,o,r,n),T=new sg(ex,i,o,r),_=new sU(ex,i,o,r),o.programs=m.programs,G.capabilities=r,G.extensions=i,G.properties=a,G.renderLists=g,G.shadowMap=M,G.state=n,G.info=o}eb();let ev=new hk(G,ex);function eM(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),H=!0}function eS(){console.log("THREE.WebGLRenderer: Context Restored."),H=!1;let e=o.autoReset,t=M.enabled,i=M.autoUpdate,r=M.needsUpdate,n=M.type;eb(),o.autoReset=e,M.enabled=t,M.autoUpdate=i,M.needsUpdate=r,M.type=n}function eT(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function eC(e){let t=e.target;t.removeEventListener("dispose",eC),eD(t)}function eD(e){eA(e),a.remove(e)}function eA(e){let t=a.get(e).programs;void 0!==t&&(t.forEach(function(e){m.releaseProgram(e)}),e.isShaderMaterial&&m.releaseShaderCache(e))}this.xr=ev,this.getContext=function(){return ex},this.getContextAttributes=function(){return ex.getContextAttributes()},this.forceContextLoss=function(){let e=i.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){let e=i.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return er},this.setPixelRatio=function(e){void 0!==e&&(er=e,this.setSize(ee,ei,!1))},this.getSize=function(e){return e.set(ee,ei)},this.setSize=function(e,t,i){if(ev.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}ee=e,ei=t,E.width=Math.floor(e*er),E.height=Math.floor(t*er),!1!==i&&(E.style.width=e+"px",E.style.height=t+"px"),this.setViewport(0,0,e,t)},this.getDrawingBufferSize=function(e){return e.set(ee*er,ei*er).floor()},this.setDrawingBufferSize=function(e,t,i){ee=e,ei=t,er=i,E.width=Math.floor(e*i),E.height=Math.floor(t*i),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(Z)},this.getViewport=function(e){return e.copy(ea)},this.setViewport=function(e,t,i,r){e.isVector4?ea.set(e.x,e.y,e.z,e.w):ea.set(e,t,i,r),n.viewport(Z.copy(ea).multiplyScalar(er).floor())},this.getScissor=function(e){return e.copy(es)},this.setScissor=function(e,t,i,r){e.isVector4?es.set(e.x,e.y,e.z,e.w):es.set(e,t,i,r),n.scissor(Q.copy(es).multiplyScalar(er).floor())},this.getScissorTest=function(){return el},this.setScissorTest=function(e){n.setScissorTest(el=e)},this.setOpaqueSort=function(e){en=e},this.setTransparentSort=function(e){eo=e},this.getClearColor=function(e){return e.copy(S.getClearColor())},this.setClearColor=function(){S.setClearColor.apply(S,arguments)},this.getClearAlpha=function(){return S.getClearAlpha()},this.setClearAlpha=function(){S.setClearAlpha.apply(S,arguments)},this.clear=function(e=!0,t=!0,i=!0){let r=0;e&&(r|=16384),t&&(r|=256),i&&(r|=1024),ex.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){E.removeEventListener("webglcontextlost",eM,!1),E.removeEventListener("webglcontextrestored",eS,!1),E.removeEventListener("webglcontextcreationerror",eT,!1),g.dispose(),y.dispose(),a.dispose(),h.dispose(),c.dispose(),p.dispose(),D.dispose(),A.dispose(),m.dispose(),ev.dispose(),ev.removeEventListener("sessionstart",eW),ev.removeEventListener("sessionend",eV),eu&&(eu.dispose(),eu=null),ek.stop()},this.renderBufferDirect=function(e,t,i,r,o,a){let s;null===t&&(t=eg);let l=o.isMesh&&0>o.matrixWorld.determinant(),h=ej(e,t,i,r,o);n.setMaterial(r,l);let c=i.index,p=i.attributes.position;if(null===c){if(void 0===p||0===p.count)return}else if(0===c.count)return;let m=1;!0===r.wireframe&&(c=u.getWireframeAttribute(i),m=2),D.setup(o,r,h,i,c);let f=T;null!==c&&(s=d.get(c),(f=_).setIndex(s));let g=null!==c?c.count:p.count,y=i.drawRange.start*m,x=i.drawRange.count*m,w=null!==a?a.start*m:0,b=null!==a?a.count*m:1/0,v=Math.max(y,w),M=Math.min(g,y+x,w+b)-1,S=Math.max(0,M-v+1);if(0!==S){if(o.isMesh)!0===r.wireframe?(n.setLineWidth(r.wireframeLinewidth*ey()),f.setMode(1)):f.setMode(4);else if(o.isLine){let e=r.linewidth;void 0===e&&(e=1),n.setLineWidth(e*ey()),o.isLineSegments?f.setMode(1):o.isLineLoop?f.setMode(2):f.setMode(3)}else o.isPoints?f.setMode(0):o.isSprite&&f.setMode(4);if(o.isInstancedMesh)f.renderInstances(v,S,o.count);else if(i.isInstancedBufferGeometry){let e=Math.min(i.instanceCount,i._maxInstanceCount);f.renderInstances(v,S,e)}else f.render(v,S)}},this.compile=function(e,t){function i(e,t,i){!0===e.transparent&&e.side===b?(e.side=w,e.needsUpdate=!0,eG(e,t,i),e.side=x,e.needsUpdate=!0,eG(e,t,i),e.side=b):eG(e,t,i)}(z=y.get(e)).init(),N.push(z),e.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(z.pushLight(e),e.castShadow&&z.pushShadow(e))}),z.setupLights(G.physicallyCorrectLights),e.traverse(function(t){let r=t.material;if(r){if(Array.isArray(r))for(let n=0;n<r.length;n++){let o=r[n];i(o,e,t)}else i(r,e,t)}}),N.pop(),z=null};let eE=null;function eL(e){eE&&eE(e)}function eW(){ek.stop()}function eV(){ek.start()}let ek=new n6;function eB(e,t,i,r){if(!1===e.visible)return;let n=e.layers.test(t.layers);if(n){if(e.isGroup)i=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)z.pushLight(e),e.castShadow&&z.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||eh.intersectsSprite(e)){r&&ef.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ep);let t=p.update(e),n=e.material;n.visible&&F.push(e,t,n,i,ef.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==o.render.frame&&(e.skeleton.update(),e.skeleton.frame=o.render.frame),!e.frustumCulled||eh.intersectsObject(e))){r&&ef.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ep);let t=p.update(e),n=e.material;if(Array.isArray(n)){let r=t.groups;for(let o=0,a=r.length;o<a;o++){let a=r[o],s=n[a.materialIndex];s&&s.visible&&F.push(e,t,s,i,ef.z,a)}}else n.visible&&F.push(e,t,n,i,ef.z,null)}}let a=e.children;for(let e=0,n=a.length;e<n;e++)eB(a[e],t,i,r)}function eO(e,t,i,r){let o=e.opaque,a=e.transmissive,s=e.transparent;z.setupLightsView(i),a.length>0&&ez(o,t,i),r&&n.viewport(Z.copy(r)),o.length>0&&eU(o,t,i),a.length>0&&eU(a,t,i),s.length>0&&eU(s,t,i),n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),n.setPolygonOffset(!1)}function ez(e,t,n){let o=r.isWebGL2;null===eu&&(eu=new iH(1,1,{generateMipmaps:!0,type:i.has("EXT_color_buffer_half_float")?eR:e_,minFilter:eP,samples:o&&!0===W?4:0})),G.getDrawingBufferSize(em),o?eu.setSize(em.x,em.y):eu.setSize(iy(em.x),iy(em.y));let a=G.getRenderTarget();G.setRenderTarget(eu),G.clear();let s=G.toneMapping;G.toneMapping=et,eU(e,t,n),G.toneMapping=s,l.updateMultisampleRenderTarget(eu),l.updateRenderTargetMipmap(eu),G.setRenderTarget(a)}function eU(e,t,i){let r=!0===t.isScene?t.overrideMaterial:null;for(let n=0,o=e.length;n<o;n++){let o=e[n],a=o.object,s=o.geometry,l=null===r?o.material:r,h=o.group;a.layers.test(i.layers)&&eN(a,t,i,s,l,h)}}function eN(e,t,i,r,n,o){e.onBeforeRender(G,t,i,r,n,o),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),n.onBeforeRender(G,t,i,r,e,o),!0===n.transparent&&n.side===b?(n.side=w,n.needsUpdate=!0,G.renderBufferDirect(i,t,r,n,e,o),n.side=x,n.needsUpdate=!0,G.renderBufferDirect(i,t,r,n,e,o),n.side=b):G.renderBufferDirect(i,t,r,n,e,o),e.onAfterRender(G,t,i,r,n,o)}function eG(e,t,i){!0!==t.isScene&&(t=eg);let r=a.get(e),n=z.state.lights,o=z.state.shadowsArray,s=n.state.version,l=m.getParameters(e,n.state,o,t,i),d=m.getProgramCacheKey(l),u=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?c:h).get(e.envMap||r.environment),void 0===u&&(e.addEventListener("dispose",eC),u=new Map,r.programs=u);let p=u.get(d);if(void 0!==p){if(r.currentProgram===p&&r.lightsStateVersion===s)return eH(e,l),p}else l.uniforms=m.getUniforms(e),e.onBuild(i,l,G),e.onBeforeCompile(l,G),p=m.acquireProgram(l,d),u.set(d,p),r.uniforms=l.uniforms;let f=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(f.clippingPlanes=v.uniform),eH(e,l),r.needsLights=eX(e),r.lightsStateVersion=s,r.needsLights&&(f.ambientLightColor.value=n.state.ambient,f.lightProbe.value=n.state.probe,f.directionalLights.value=n.state.directional,f.directionalLightShadows.value=n.state.directionalShadow,f.spotLights.value=n.state.spot,f.spotLightShadows.value=n.state.spotShadow,f.rectAreaLights.value=n.state.rectArea,f.ltc_1.value=n.state.rectAreaLTC1,f.ltc_2.value=n.state.rectAreaLTC2,f.pointLights.value=n.state.point,f.pointLightShadows.value=n.state.pointShadow,f.hemisphereLights.value=n.state.hemi,f.directionalShadowMap.value=n.state.directionalShadowMap,f.directionalShadowMatrix.value=n.state.directionalShadowMatrix,f.spotShadowMap.value=n.state.spotShadowMap,f.spotLightMatrix.value=n.state.spotLightMatrix,f.spotLightMap.value=n.state.spotLightMap,f.pointShadowMap.value=n.state.pointShadowMap,f.pointShadowMatrix.value=n.state.pointShadowMatrix);let g=p.getUniforms(),y=lG.seqWithValue(g.seq,f);return r.currentProgram=p,r.uniformsList=y,p}function eH(e,t){let i=a.get(e);i.outputEncoding=t.outputEncoding,i.instancing=t.instancing,i.skinning=t.skinning,i.morphTargets=t.morphTargets,i.morphNormals=t.morphNormals,i.morphColors=t.morphColors,i.morphTargetsCount=t.morphTargetsCount,i.numClippingPlanes=t.numClippingPlanes,i.numIntersection=t.numClipIntersection,i.vertexAlphas=t.vertexAlphas,i.vertexTangents=t.vertexTangents,i.toneMapping=t.toneMapping}function ej(e,t,i,o,s){!0!==t.isScene&&(t=eg),l.resetTextureUnits();let d=t.fog,u=o.isMeshStandardMaterial?t.environment:null,p=null===X?G.outputEncoding:!0===X.isXRRenderTarget?X.texture.encoding:t_,m=(o.isMeshStandardMaterial?c:h).get(o.envMap||u),g=!0===o.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,y=!!o.normalMap&&!!i.attributes.tangent,x=!!i.morphAttributes.position,w=!!i.morphAttributes.normal,b=!!i.morphAttributes.color,M=o.toneMapped?G.toneMapping:et,S=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,T=void 0!==S?S.length:0,_=a.get(o),C=z.state.lights;if(!0===ec&&(!0===ed||e!==J)){let t=e===J&&o.id===Y;v.setState(o,e,t)}let D=!1;o.version===_.__version?_.needsLights&&_.lightsStateVersion!==C.state.version?D=!0:_.outputEncoding!==p?D=!0:s.isInstancedMesh&&!1===_.instancing?D=!0:s.isInstancedMesh||!0!==_.instancing?s.isSkinnedMesh&&!1===_.skinning?D=!0:s.isSkinnedMesh||!0!==_.skinning?_.envMap!==m?D=!0:!0===o.fog&&_.fog!==d?D=!0:void 0!==_.numClippingPlanes&&(_.numClippingPlanes!==v.numPlanes||_.numIntersection!==v.numIntersection)?D=!0:_.vertexAlphas!==g?D=!0:_.vertexTangents!==y?D=!0:_.morphTargets!==x?D=!0:_.morphNormals!==w?D=!0:_.morphColors!==b?D=!0:_.toneMapping!==M?D=!0:!0===r.isWebGL2&&_.morphTargetsCount!==T&&(D=!0):D=!0:D=!0:(D=!0,_.__version=o.version);let E=_.currentProgram;!0===D&&(E=eG(o,t,s));let L=!1,I=!1,R=!1,W=E.getUniforms(),V=_.uniforms;if(n.useProgram(E.program)&&(L=!0,I=!0,R=!0),o.id!==Y&&(Y=o.id,I=!0),L||J!==e){if(W.setValue(ex,"projectionMatrix",e.projectionMatrix),r.logarithmicDepthBuffer&&W.setValue(ex,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),J!==e&&(J=e,I=!0,R=!0),o.isShaderMaterial||o.isMeshPhongMaterial||o.isMeshToonMaterial||o.isMeshStandardMaterial||o.envMap){let t=W.map.cameraPosition;void 0!==t&&t.setValue(ex,ef.setFromMatrixPosition(e.matrixWorld))}(o.isMeshPhongMaterial||o.isMeshToonMaterial||o.isMeshLambertMaterial||o.isMeshBasicMaterial||o.isMeshStandardMaterial||o.isShaderMaterial)&&W.setValue(ex,"isOrthographic",!0===e.isOrthographicCamera),(o.isMeshPhongMaterial||o.isMeshToonMaterial||o.isMeshLambertMaterial||o.isMeshBasicMaterial||o.isMeshStandardMaterial||o.isShaderMaterial||o.isShadowMaterial||s.isSkinnedMesh)&&W.setValue(ex,"viewMatrix",e.matrixWorldInverse)}if(s.isSkinnedMesh){W.setOptional(ex,s,"bindMatrix"),W.setOptional(ex,s,"bindMatrixInverse");let e=s.skeleton;e&&(r.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),W.setValue(ex,"boneTexture",e.boneTexture,l),W.setValue(ex,"boneTextureSize",e.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let k=i.morphAttributes;if((void 0!==k.position||void 0!==k.normal||void 0!==k.color&&!0===r.isWebGL2)&&P.update(s,i,o,E),(I||_.receiveShadow!==s.receiveShadow)&&(_.receiveShadow=s.receiveShadow,W.setValue(ex,"receiveShadow",s.receiveShadow)),o.isMeshGouraudMaterial&&null!==o.envMap&&(V.envMap.value=m,V.flipEnvMap.value=m.isCubeTexture&&!1===m.isRenderTargetTexture?-1:1),I&&(W.setValue(ex,"toneMappingExposure",G.toneMappingExposure),_.needsLights&&eq(V,R),d&&!0===o.fog&&f.refreshFogUniforms(V,d),f.refreshMaterialUniforms(V,o,er,ei,eu),lG.upload(ex,_.uniformsList,V,l)),o.isShaderMaterial&&!0===o.uniformsNeedUpdate&&(lG.upload(ex,_.uniformsList,V,l),o.uniformsNeedUpdate=!1),o.isSpriteMaterial&&W.setValue(ex,"center",s.center),W.setValue(ex,"modelViewMatrix",s.modelViewMatrix),W.setValue(ex,"normalMatrix",s.normalMatrix),W.setValue(ex,"modelMatrix",s.matrixWorld),o.isShaderMaterial||o.isRawShaderMaterial){let e=o.uniformsGroups;for(let t=0,i=e.length;t<i;t++)if(r.isWebGL2){let i=e[t];A.update(i,E),A.bind(i,E)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return E}function eq(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}function eX(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}ek.setAnimationLoop(eL),"undefined"!=typeof self&&ek.setContext(self),this.setAnimationLoop=function(e){eE=e,ev.setAnimationLoop(e),null===e?ek.stop():ek.start()},ev.addEventListener("sessionstart",eW),ev.addEventListener("sessionend",eV),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(!0===H)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===ev.enabled&&!0===ev.isPresenting&&(!0===ev.cameraAutoUpdate&&ev.updateCamera(t),t=ev.getCamera()),!0===e.isScene&&e.onBeforeRender(G,e,t,X),(z=y.get(e,N.length)).init(),N.push(z),ep.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),eh.setFromProjectionMatrix(ep),ed=this.localClippingEnabled,ec=v.init(this.clippingPlanes,ed,t),(F=g.get(e,U.length)).init(),U.push(F),eB(e,t,0,G.sortObjects),F.finish(),!0===G.sortObjects&&F.sort(en,eo),!0===ec&&v.beginShadows();let i=z.state.shadowsArray;if(M.render(i,e,t),!0===ec&&v.endShadows(),!0===this.info.autoReset&&this.info.reset(),S.render(F,e),z.setupLights(G.physicallyCorrectLights),t.isArrayCamera){let i=t.cameras;for(let t=0,r=i.length;t<r;t++){let r=i[t];eO(F,e,r,r.viewport)}}else eO(F,e,t);null!==X&&(l.updateMultisampleRenderTarget(X),l.updateRenderTargetMipmap(X)),!0===e.isScene&&e.onAfterRender(G,e,t),D.resetDefaultState(),Y=-1,J=null,N.pop(),z=N.length>0?N[N.length-1]:null,U.pop(),F=U.length>0?U[U.length-1]:null},this.getActiveCubeFace=function(){return j},this.getActiveMipmapLevel=function(){return q},this.getRenderTarget=function(){return X},this.setRenderTargetTextures=function(e,t,r){a.get(e.texture).__webglTexture=t,a.get(e.depthTexture).__webglTexture=r;let n=a.get(e);n.__hasExternalTextures=!0,n.__hasExternalTextures&&(n.__autoAllocateDepthBuffer=void 0===r,n.__autoAllocateDepthBuffer||!0!==i.has("WEBGL_multisampled_render_to_texture")||(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),n.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){let i=a.get(e);i.__webglFramebuffer=t,i.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,i=0){X=e,j=t,q=i;let o=!0;if(e){let t=a.get(e);void 0!==t.__useDefaultFramebuffer?(n.bindFramebuffer(36160,null),o=!1):void 0===t.__webglFramebuffer?l.setupRenderTarget(e):t.__hasExternalTextures&&l.rebindTextures(e,a.get(e.texture).__webglTexture,a.get(e.depthTexture).__webglTexture)}let s=null,h=!1,c=!1;if(e){let i=e.texture;(i.isData3DTexture||i.isDataArrayTexture)&&(c=!0);let n=a.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(s=n[t],h=!0):s=r.isWebGL2&&e.samples>0&&!1===l.useMultisampledRTT(e)?a.get(e).__webglMultisampledFramebuffer:n,Z.copy(e.viewport),Q.copy(e.scissor),K=e.scissorTest}else Z.copy(ea).multiplyScalar(er).floor(),Q.copy(es).multiplyScalar(er).floor(),K=el;let d=n.bindFramebuffer(36160,s);if(d&&r.drawBuffers&&o&&n.drawBuffers(e,s),n.viewport(Z),n.scissor(Q),n.setScissorTest(K),h){let r=a.get(e.texture);ex.framebufferTexture2D(36160,36064,34069+t,r.__webglTexture,i)}else if(c){let r=a.get(e.texture),n=t||0;ex.framebufferTextureLayer(36160,36064,r.__webglTexture,i||0,n)}Y=-1},this.readRenderTargetPixels=function(e,t,o,s,l,h,c){if(!(e&&e.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let d=a.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==c&&(d=d[c]),d){n.bindFramebuffer(36160,d);try{let n=e.texture,a=n.format,c=n.type;if(a!==eF&&C.convert(a)!==ex.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let d=c===eR&&(i.has("EXT_color_buffer_half_float")||r.isWebGL2&&i.has("EXT_color_buffer_float"));if(c!==e_&&C.convert(c)!==ex.getParameter(35738)&&!(c===eI&&(r.isWebGL2||i.has("OES_texture_float")||i.has("WEBGL_color_buffer_float")))&&!d){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}t>=0&&t<=e.width-s&&o>=0&&o<=e.height-l&&ex.readPixels(t,o,s,l,C.convert(a),C.convert(c),h)}finally{let e=null!==X?a.get(X).__webglFramebuffer:null;n.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t,i=0){let r=Math.pow(2,-i),o=Math.floor(t.image.width*r),a=Math.floor(t.image.height*r);l.setTexture2D(t,0),ex.copyTexSubImage2D(3553,i,0,0,e.x,e.y,o,a),n.unbindTexture()},this.copyTextureToTexture=function(e,t,i,r=0){let o=t.image.width,a=t.image.height,s=C.convert(i.format),h=C.convert(i.type);l.setTexture2D(i,0),ex.pixelStorei(37440,i.flipY),ex.pixelStorei(37441,i.premultiplyAlpha),ex.pixelStorei(3317,i.unpackAlignment),t.isDataTexture?ex.texSubImage2D(3553,r,e.x,e.y,o,a,s,h,t.image.data):t.isCompressedTexture?ex.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,s,t.mipmaps[0].data):ex.texSubImage2D(3553,r,e.x,e.y,s,h,t.image),0===r&&i.generateMipmaps&&ex.generateMipmap(3553),n.unbindTexture()},this.copyTextureToTexture3D=function(e,t,i,r,o=0){let a;if(G.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let s=e.max.x-e.min.x+1,h=e.max.y-e.min.y+1,c=e.max.z-e.min.z+1,d=C.convert(r.format),u=C.convert(r.type);if(r.isData3DTexture)l.setTexture3D(r,0),a=32879;else if(r.isDataArrayTexture)l.setTexture2DArray(r,0),a=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}ex.pixelStorei(37440,r.flipY),ex.pixelStorei(37441,r.premultiplyAlpha),ex.pixelStorei(3317,r.unpackAlignment);let p=ex.getParameter(3314),m=ex.getParameter(32878),f=ex.getParameter(3316),g=ex.getParameter(3315),y=ex.getParameter(32877),x=i.isCompressedTexture?i.mipmaps[0]:i.image;ex.pixelStorei(3314,x.width),ex.pixelStorei(32878,x.height),ex.pixelStorei(3316,e.min.x),ex.pixelStorei(3315,e.min.y),ex.pixelStorei(32877,e.min.z),i.isDataTexture||i.isData3DTexture?ex.texSubImage3D(a,o,t.x,t.y,t.z,s,h,c,d,u,x.data):i.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ex.compressedTexSubImage3D(a,o,t.x,t.y,t.z,s,h,c,d,x.data)):ex.texSubImage3D(a,o,t.x,t.y,t.z,s,h,c,d,u,x),ex.pixelStorei(3314,p),ex.pixelStorei(32878,m),ex.pixelStorei(3316,f),ex.pixelStorei(3315,g),ex.pixelStorei(32877,y),0===o&&r.generateMipmaps&&ex.generateMipmap(a),n.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?l.setTextureCube(e,0):e.isData3DTexture?l.setTexture3D(e,0):e.isDataArrayTexture?l.setTexture2DArray(e,0):l.setTexture2D(e,0),n.unbindTexture()},this.resetState=function(){j=0,q=0,X=null,n.reset(),D.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class hU extends hz{}hU.prototype.isWebGL1Renderer=!0;class hN{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new iB(e),this.density=t}clone(){return new hN(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class hG{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new iB(e),this.near=t,this.far=i}clone(){return new hG(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class hH extends rH{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class hj{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=tQ,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ia()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,n=this.stride;r<n;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ia()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ia()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}let hq=new iQ;class hX{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)hq.fromBufferAttribute(this,t),hq.applyMatrix4(e),this.setXYZ(t,hq.x,hq.y,hq.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)hq.fromBufferAttribute(this,t),hq.applyNormalMatrix(e),this.setXYZ(t,hq.x,hq.y,hq.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)hq.fromBufferAttribute(this,t),hq.transformDirection(e),this.setXYZ(t,hq.x,hq.y,hq.z);return this}setX(e,t){return this.normalized&&(t=iw(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=iw(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=iw(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=iw(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=ix(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=ix(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=ix(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=ix(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=iw(t,this.array),i=iw(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=iw(t,this.array),i=iw(i,this.array),r=iw(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=iw(t,this.array),i=iw(i,this.array),r=iw(r,this.array),n=iw(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=n,this}clone(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new hX(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized);{console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");let e=[];for(let t=0;t<this.count;t++){let i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return new r8(new this.array.constructor(e),this.itemSize,this.normalized)}}toJSON(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized};{console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");let e=[];for(let t=0;t<this.count;t++){let i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}}}class hY extends r3{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new iB(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let hJ=new iQ,hZ=new iQ,hQ=new iQ,hK=new iv,h$=new iv,h0=new rw,h2=new iQ,h3=new iQ,h4=new iQ,h5=new iv,h6=new iv,h9=new iv;class h8 extends rH{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",void 0===r){r=new ng;let e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new hj(e,5);r.setIndex([0,1,2,0,2,3]),r.setAttribute("position",new hX(t,3,0,!1)),r.setAttribute("uv",new hX(t,2,3,!1))}this.geometry=r,this.material=void 0!==e?e:new hY,this.center=new iv(.5,.5)}raycast(e,t){let i,r;null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),hZ.setFromMatrixScale(this.matrixWorld),h0.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),hQ.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&hZ.multiplyScalar(-hQ.z);let n=this.material.rotation;0!==n&&(r=Math.cos(n),i=Math.sin(n));let o=this.center;h7(h2.set(-.5,-.5,0),hQ,o,hZ,i,r),h7(h3.set(.5,-.5,0),hQ,o,hZ,i,r),h7(h4.set(.5,.5,0),hQ,o,hZ,i,r),h5.set(0,0),h6.set(1,0),h9.set(1,1);let a=e.ray.intersectTriangle(h2,h3,h4,!1,hJ);if(null===a&&(h7(h3.set(-.5,.5,0),hQ,o,hZ,i,r),h6.set(0,1),null===(a=e.ray.intersectTriangle(h2,h4,h3,!1,hJ))))return;let s=e.ray.origin.distanceTo(hJ);s<e.near||s>e.far||t.push({distance:s,point:hJ.clone(),uv:r1.getUV(hJ,h2,h3,h4,h5,h6,h9,new iv),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function h7(e,t,i,r,n,o){hK.subVectors(e,i).addScalar(.5).multiply(r),void 0!==n?(h$.x=o*hK.x-n*hK.y,h$.y=n*hK.x+o*hK.y):h$.copy(hK),e.copy(t),e.x+=h$.x,e.y+=h$.y,e.applyMatrix4(h0)}let ce=new iQ,ct=new iQ;class ci extends rH{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);let t=e.levels;for(let e=0,i=t.length;e<i;e++){let i=t[e];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){let i;t=Math.abs(t);let r=this.levels;for(i=0;i<r.length&&!(t<r[i].distance);i++);return r.splice(i,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){let t=this.levels;if(t.length>0){let i,r;for(i=1,r=t.length;i<r&&!(e<t[i].distance);i++);return t[i-1].object}return null}raycast(e,t){let i=this.levels;if(i.length>0){ce.setFromMatrixPosition(this.matrixWorld);let i=e.ray.origin.distanceTo(ce);this.getObjectForDistance(i).raycast(e,t)}}update(e){let t=this.levels;if(t.length>1){let i,r;ce.setFromMatrixPosition(e.matrixWorld),ct.setFromMatrixPosition(this.matrixWorld);let n=ce.distanceTo(ct)/e.zoom;for(i=1,t[0].object.visible=!0,r=t.length;i<r&&n>=t[i].distance;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(this._currentLevel=i-1;i<r;i++)t[i].object.visible=!1}}toJSON(e){let t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];let i=this.levels;for(let e=0,r=i.length;e<r;e++){let r=i[e];t.object.levels.push({object:r.object.uuid,distance:r.distance})}return t}}let cr=new iQ,cn=new iG,co=new iG,ca=new iQ,cs=new rw;class cl extends nW{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new rw,this.bindMatrixInverse=new rw}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){let e=new iG,t=this.geometry.attributes.skinWeight;for(let i=0,r=t.count;i<r;i++){e.fromBufferAttribute(t,i);let r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){let i=this.skeleton,r=this.geometry;cn.fromBufferAttribute(r.attributes.skinIndex,e),co.fromBufferAttribute(r.attributes.skinWeight,e),cr.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){let r=co.getComponent(e);if(0!==r){let n=cn.getComponent(e);cs.multiplyMatrices(i.bones[n].matrixWorld,i.boneInverses[n]),t.addScaledVector(ca.copy(cr).applyMatrix4(cs),r)}}return t.applyMatrix4(this.bindMatrixInverse)}}class ch extends rH{constructor(){super(),this.isBone=!0,this.type="Bone"}}class cc extends iN{constructor(e=null,t=1,i=1,r,n,o,a,s,l=eg,h=eg,c,d){super(null,o,a,s,l,h,r,n,c,d),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}let cd=new rw,cu=new rw;class cp{constructor(e=[],t=[]){this.uuid=ia(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new rw)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let t=new rw;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){let e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let r=0,n=e.length;r<n;r++){let n=e[r]?e[r].matrixWorld:cu;cd.multiplyMatrices(n,t[r]),cd.toArray(i,16*r)}null!==r&&(r.needsUpdate=!0)}clone(){return new cp(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=Math.max(e=ig(e),4);let t=new Float32Array(e*e*4);t.set(this.boneMatrices);let i=new cc(t,e,e,eF,eI);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){let i=this.bones[t];if(i.name===e)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){let r=e.bones[i],n=t[r];void 0===n&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),n=new ch),this.bones.push(n),this.boneInverses.push(new rw().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){let e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,i=this.boneInverses;for(let r=0,n=t.length;r<n;r++){let n=t[r];e.bones.push(n.uuid);let o=i[r];e.boneInverses.push(o.toArray())}return e}}class cm extends r8{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}let cf=new rw,cg=new rw,cy=[],cx=new nW;class cw extends nW{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new cm(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){let i=this.matrixWorld,r=this.count;if(cx.geometry=this.geometry,cx.material=this.material,void 0!==cx.material)for(let n=0;n<r;n++){this.getMatrixAt(n,cf),cg.multiplyMatrices(i,cf),cx.matrixWorld=cg,cx.raycast(e,cy);for(let e=0,i=cy.length;e<i;e++){let i=cy[e];i.instanceId=n,i.object=this,t.push(i)}cy.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new cm(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class cb extends r3{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new iB(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}let cv=new iQ,cM=new iQ,cS=new rw,cP=new rx,cT=new rc;class c_ extends rH{constructor(e=new ng,t=new cb){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(null===e.index){let t=e.attributes.position,i=[0];for(let e=1,r=t.count;e<r;e++)cv.fromBufferAttribute(t,e-1),cM.fromBufferAttribute(t,e),i[e]=i[e-1],i[e]+=cv.distanceTo(cM);e.setAttribute("lineDistance",new ns(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let i=this.geometry,r=this.matrixWorld,n=e.params.Line.threshold,o=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),cT.copy(i.boundingSphere),cT.applyMatrix4(r),cT.radius+=n,!1===e.ray.intersectsSphere(cT))return;cS.copy(r).invert(),cP.copy(e.ray).applyMatrix4(cS);let a=n/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a,l=new iQ,h=new iQ,c=new iQ,d=new iQ,u=this.isLineSegments?2:1,p=i.index,m=i.attributes,f=m.position;if(null!==p){let i=Math.max(0,o.start),r=Math.min(p.count,o.start+o.count);for(let n=i,o=r-1;n<o;n+=u){let i=p.getX(n),r=p.getX(n+1);l.fromBufferAttribute(f,i),h.fromBufferAttribute(f,r);let o=cP.distanceSqToSegment(l,h,d,c);if(o>s)continue;d.applyMatrix4(this.matrixWorld);let a=e.ray.origin.distanceTo(d);a<e.near||a>e.far||t.push({distance:a,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else{let i=Math.max(0,o.start),r=Math.min(f.count,o.start+o.count);for(let n=i,o=r-1;n<o;n+=u){l.fromBufferAttribute(f,n),h.fromBufferAttribute(f,n+1);let i=cP.distanceSqToSegment(l,h,d,c);if(i>s)continue;d.applyMatrix4(this.matrixWorld);let r=e.ray.origin.distanceTo(d);r<e.near||r>e.far||t.push({distance:r,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let e=this.geometry,t=e.morphAttributes,i=Object.keys(t);if(i.length>0){let e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){let i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}}let cC=new iQ,cD=new iQ;class cA extends c_{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(null===e.index){let t=e.attributes.position,i=[];for(let e=0,r=t.count;e<r;e+=2)cC.fromBufferAttribute(t,e),cD.fromBufferAttribute(t,e+1),i[e]=0===e?0:i[e-1],i[e+1]=i[e]+cC.distanceTo(cD);e.setAttribute("lineDistance",new ns(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class cE extends c_{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class cL extends r3{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new iB(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let cI=new rw,cR=new rx,cW=new rc,cV=new iQ;class ck extends rH{constructor(e=new ng,t=new cL){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){let i=this.geometry,r=this.matrixWorld,n=e.params.Points.threshold,o=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),cW.copy(i.boundingSphere),cW.applyMatrix4(r),cW.radius+=n,!1===e.ray.intersectsSphere(cW))return;cI.copy(r).invert(),cR.copy(e.ray).applyMatrix4(cI);let a=n/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a,l=i.index,h=i.attributes,c=h.position;if(null!==l){let i=Math.max(0,o.start),n=Math.min(l.count,o.start+o.count);for(let o=i,a=n;o<a;o++){let i=l.getX(o);cV.fromBufferAttribute(c,i),cB(cV,i,s,r,e,t,this)}}else{let i=Math.max(0,o.start),n=Math.min(c.count,o.start+o.count);for(let o=i,a=n;o<a;o++)cV.fromBufferAttribute(c,o),cB(cV,o,s,r,e,t,this)}}updateMorphTargets(){let e=this.geometry,t=e.morphAttributes,i=Object.keys(t);if(i.length>0){let e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){let i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}}function cB(e,t,i,r,n,o,a){let s=cR.distanceSqToPoint(e);if(s<i){let i=new iQ;cR.closestPointToPoint(e,i),i.applyMatrix4(r);let l=n.ray.origin.distanceTo(i);if(l<n.near||l>n.far)return;o.push({distance:l,distanceToRay:Math.sqrt(s),point:i,index:t,face:null,object:a})}}class cO extends iN{constructor(e,t,i,r,n,o,a,s,l){super(e,t,i,r,n,o,a,s,l),this.isVideoTexture=!0,this.minFilter=void 0!==o?o:ev,this.magFilter=void 0!==n?n:ev,this.generateMipmaps=!1;let h=this;function c(){h.needsUpdate=!0,e.requestVideoFrameCallback(c)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(c)}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image,t="requestVideoFrameCallback"in e;!1===t&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class cF extends iN{constructor(e,t,i){super({width:e,height:t}),this.isFramebufferTexture=!0,this.format=i,this.magFilter=eg,this.minFilter=eg,this.generateMipmaps=!1,this.needsUpdate=!0}}class cz extends iN{constructor(e,t,i,r,n,o,a,s,l,h,c,d){super(null,o,a,s,l,h,r,n,c,d),this.isCompressedTexture=!0,this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class cU extends iN{constructor(e,t,i,r,n,o,a,s,l){super(e,t,i,r,n,o,a,s,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class cN{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],i,r=this.getPoint(0),n=0;t.push(0);for(let o=1;o<=e;o++)t.push(n+=(i=this.getPoint(o/e)).distanceTo(r)),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let i;let r=this.getLengths(),n=0,o=r.length;i=t||e*r[o-1];let a=0,s=o-1,l;for(;a<=s;)if((l=r[n=Math.floor(a+(s-a)/2)]-i)<0)a=n+1;else if(l>0)s=n-1;else{s=n;break}if(r[n=s]===i)return n/(o-1);let h=r[n],c=r[n+1],d=c-h,u=(i-h)/d,p=(n+u)/(o-1);return p}getTangent(e,t){let i=1e-4,r=e-i,n=e+i;r<0&&(r=0),n>1&&(n=1);let o=this.getPoint(r),a=this.getPoint(n),s=t||(o.isVector2?new iv:new iQ);return s.copy(a).sub(o).normalize(),s}getTangentAt(e,t){let i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){let i=new iQ,r=[],n=[],o=[],a=new iQ,s=new rw;for(let t=0;t<=e;t++){let i=t/e;r[t]=this.getTangentAt(i,new iQ)}n[0]=new iQ,o[0]=new iQ;let l=Number.MAX_VALUE,h=Math.abs(r[0].x),c=Math.abs(r[0].y),d=Math.abs(r[0].z);h<=l&&(l=h,i.set(1,0,0)),c<=l&&(l=c,i.set(0,1,0)),d<=l&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),n[0].crossVectors(r[0],a),o[0].crossVectors(r[0],n[0]);for(let t=1;t<=e;t++){if(n[t]=n[t-1].clone(),o[t]=o[t-1].clone(),a.crossVectors(r[t-1],r[t]),a.length()>Number.EPSILON){a.normalize();let e=Math.acos(is(r[t-1].dot(r[t]),-1,1));n[t].applyMatrix4(s.makeRotationAxis(a,e))}o[t].crossVectors(r[t],n[t])}if(!0===t){let t=Math.acos(is(n[0].dot(n[e]),-1,1));t/=e,r[0].dot(a.crossVectors(n[0],n[e]))>0&&(t=-t);for(let i=1;i<=e;i++)n[i].applyMatrix4(s.makeRotationAxis(r[i],t*i)),o[i].crossVectors(r[i],n[i])}return{tangents:r,normals:n,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class cG extends cN{constructor(e=0,t=0,i=1,r=1,n=0,o=2*Math.PI,a=!1,s=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=n,this.aEndAngle=o,this.aClockwise=a,this.aRotation=s}getPoint(e,t){let i=t||new iv,r=2*Math.PI,n=this.aEndAngle-this.aStartAngle,o=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(n=o?0:r),!0!==this.aClockwise||o||(n===r?n=-r:n-=r);let a=this.aStartAngle+e*n,s=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){let e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),i=s-this.aX,r=l-this.aY;s=i*e-r*t+this.aX,l=i*t+r*e+this.aY}return i.set(s,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class cH extends cG{constructor(e,t,i,r,n,o){super(e,t,i,i,r,n,o),this.isArcCurve=!0,this.type="ArcCurve"}}function cj(){let e=0,t=0,i=0,r=0;function n(n,o,a,s){e=n,t=a,i=-3*n+3*o-2*a-s,r=2*n-2*o+a+s}return{initCatmullRom:function(e,t,i,r,o){n(t,i,o*(i-e),o*(r-t))},initNonuniformCatmullRom:function(e,t,i,r,o,a,s){let l=(t-e)/o-(i-e)/(o+a)+(i-t)/a,h=(i-t)/a-(r-t)/(a+s)+(r-i)/s;n(t,i,l*=a,h*=a)},calc:function(n){let o=n*n,a=o*n;return e+t*n+i*o+r*a}}}let cq=new iQ,cX=new cj,cY=new cj,cJ=new cj;class cZ extends cN{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new iQ){let i,r;let n=t,o=this.points,a=o.length,s=(a-(this.closed?0:1))*e,l=Math.floor(s),h=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/a)+1)*a:0===h&&l===a-1&&(l=a-2,h=1),this.closed||l>0?i=o[(l-1)%a]:(cq.subVectors(o[0],o[1]).add(o[0]),i=cq);let c=o[l%a],d=o[(l+1)%a];if(this.closed||l+2<a?r=o[(l+2)%a]:(cq.subVectors(o[a-1],o[a-2]).add(o[a-1]),r=cq),"centripetal"===this.curveType||"chordal"===this.curveType){let e="chordal"===this.curveType?.5:.25,t=Math.pow(i.distanceToSquared(c),e),n=Math.pow(c.distanceToSquared(d),e),o=Math.pow(d.distanceToSquared(r),e);n<1e-4&&(n=1),t<1e-4&&(t=n),o<1e-4&&(o=n),cX.initNonuniformCatmullRom(i.x,c.x,d.x,r.x,t,n,o),cY.initNonuniformCatmullRom(i.y,c.y,d.y,r.y,t,n,o),cJ.initNonuniformCatmullRom(i.z,c.z,d.z,r.z,t,n,o)}else"catmullrom"===this.curveType&&(cX.initCatmullRom(i.x,c.x,d.x,r.x,this.tension),cY.initCatmullRom(i.y,c.y,d.y,r.y,this.tension),cJ.initCatmullRom(i.z,c.z,d.z,r.z,this.tension));return n.set(cX.calc(h),cY.calc(h),cJ.calc(h)),n}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let i=e.points[t];this.points.push(new iQ().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function cQ(e,t,i,r,n){let o=(r-t)*.5,a=(n-i)*.5,s=e*e,l=e*s;return(2*i-2*r+o+a)*l+(-3*i+3*r-2*o-a)*s+o*e+i}function cK(e,t){let i=1-e;return i*i*t}function c$(e,t){return 2*(1-e)*e*t}function c0(e,t){return e*e*t}function c1(e,t,i,r){return cK(e,t)+c$(e,i)+c0(e,r)}function c2(e,t){let i=1-e;return i*i*i*t}function c3(e,t){let i=1-e;return 3*i*i*e*t}function c5(e,t){return 3*(1-e)*e*e*t}function c6(e,t){return e*e*e*t}function c9(e,t,i,r,n){return c2(e,t)+c3(e,i)+c5(e,r)+c6(e,n)}class c8 extends cN{constructor(e=new iv,t=new iv,i=new iv,r=new iv){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new iv){let i=t,r=this.v0,n=this.v1,o=this.v2,a=this.v3;return i.set(c9(e,r.x,n.x,o.x,a.x),c9(e,r.y,n.y,o.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class c7 extends cN{constructor(e=new iQ,t=new iQ,i=new iQ,r=new iQ){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new iQ){let i=t,r=this.v0,n=this.v1,o=this.v2,a=this.v3;return i.set(c9(e,r.x,n.x,o.x,a.x),c9(e,r.y,n.y,o.y,a.y),c9(e,r.z,n.z,o.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class de extends cN{constructor(e=new iv,t=new iv){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new iv){let i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){let i=t||new iv;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class dt extends cN{constructor(e=new iQ,t=new iQ){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new iQ){let i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class di extends cN{constructor(e=new iv,t=new iv,i=new iv){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new iv){let i=t,r=this.v0,n=this.v1,o=this.v2;return i.set(c1(e,r.x,n.x,o.x),c1(e,r.y,n.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class dr extends cN{constructor(e=new iQ,t=new iQ,i=new iQ){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new iQ){let i=t,r=this.v0,n=this.v1,o=this.v2;return i.set(c1(e,r.x,n.x,o.x),c1(e,r.y,n.y,o.y),c1(e,r.z,n.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class dn extends cN{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new iv){let i=t,r=this.points,n=(r.length-1)*e,o=Math.floor(n),a=n-o,s=r[0===o?o:o-1],l=r[o],h=r[o>r.length-2?r.length-1:o+1],c=r[o>r.length-3?r.length-1:o+2];return i.set(cQ(a,s.x,l.x,h.x,c.x),cQ(a,s.y,l.y,h.y,c.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let i=e.points[t];this.points.push(i.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let i=e.points[t];this.points.push(new iv().fromArray(i))}return this}}var da=Object.freeze({__proto__:null,ArcCurve:cH,CatmullRomCurve3:cZ,CubicBezierCurve:c8,CubicBezierCurve3:c7,EllipseCurve:cG,LineCurve:de,LineCurve3:dt,QuadraticBezierCurve:di,QuadraticBezierCurve3:dr,SplineCurve:dn});class ds extends cN{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new de(t,e))}getPoint(e,t){let i=e*this.getLength(),r=this.getCurveLengths(),n=0;for(;n<r.length;){if(r[n]>=i){let e=r[n]-i,o=this.curves[n],a=o.getLength(),s=0===a?0:1-e/a;return o.getPointAt(s,t)}n++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let i=0,r=this.curves.length;i<r;i++)e.push(t+=this.curves[i].getLength());return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t;let i=[];for(let r=0,n=this.curves;r<n.length;r++){let o=n[r],a=o.isEllipseCurve?2*e:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,s=o.getPoints(a);for(let e=0;e<s.length;e++){let r=s[e];t&&t.equals(r)||(i.push(r),t=r)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){let i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let i=e.curves[t];this.curves.push(new da[i.type]().fromJSON(i))}return this}}class dl extends ds{constructor(e){super(),this.type="Path",this.currentPoint=new iv,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let i=new de(this.currentPoint.clone(),new iv(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){let n=new di(this.currentPoint.clone(),new iv(e,t),new iv(i,r));return this.curves.push(n),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,n,o){let a=new c8(this.currentPoint.clone(),new iv(e,t),new iv(i,r),new iv(n,o));return this.curves.push(a),this.currentPoint.set(n,o),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),i=new dn(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,n,o){let a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+a,t+s,i,r,n,o),this}absarc(e,t,i,r,n,o){return this.absellipse(e,t,i,i,r,n,o),this}ellipse(e,t,i,r,n,o,a,s){let l=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+l,t+h,i,r,n,o,a,s),this}absellipse(e,t,i,r,n,o,a,s){let l=new cG(e,t,i,r,n,o,a,s);if(this.curves.length>0){let e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);let h=l.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class dh extends ng{constructor(e=[new iv(0,-.5),new iv(.5,0),new iv(0,.5)],t=12,i=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t),r=is(r,0,2*Math.PI);let n=[],o=[],a=[],s=[],l=[],h=1/t,c=new iQ,d=new iv,u=new iQ,p=new iQ,m=new iQ,f=0,g=0;for(let t=0;t<=e.length-1;t++)switch(t){case 0:f=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,u.x=1*g,u.y=-f,u.z=0*g,m.copy(u),u.normalize(),s.push(u.x,u.y,u.z);break;case e.length-1:s.push(m.x,m.y,m.z);break;default:f=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,u.x=1*g,u.y=-f,u.z=0*g,p.copy(u),u.x+=m.x,u.y+=m.y,u.z+=m.z,u.normalize(),s.push(u.x,u.y,u.z),m.copy(p)}for(let n=0;n<=t;n++){let u=i+n*h*r,p=Math.sin(u),m=Math.cos(u);for(let i=0;i<=e.length-1;i++){c.x=e[i].x*p,c.y=e[i].y,c.z=e[i].x*m,o.push(c.x,c.y,c.z),d.x=n/t,d.y=i/(e.length-1),a.push(d.x,d.y);let r=s[3*i+0]*p,h=s[3*i+1],u=s[3*i+0]*m;l.push(r,h,u)}}for(let i=0;i<t;i++)for(let t=0;t<e.length-1;t++){let r=t+i*e.length,o=r,a=r+e.length,s=r+e.length+1,l=r+1;n.push(o,a,l),n.push(s,l,a)}this.setIndex(n),this.setAttribute("position",new ns(o,3)),this.setAttribute("uv",new ns(a,2)),this.setAttribute("normal",new ns(l,3))}static fromJSON(e){return new dh(e.points,e.segments,e.phiStart,e.phiLength)}}class dc extends dh{constructor(e=1,t=1,i=4,r=8){let n=new dl;n.absarc(0,-t/2,e,1.5*Math.PI,0),n.absarc(0,t/2,e,0,.5*Math.PI),super(n.getPoints(i),r),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:i,radialSegments:r}}static fromJSON(e){return new dc(e.radius,e.length,e.capSegments,e.radialSegments)}}class dd extends ng{constructor(e=1,t=8,i=0,r=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},t=Math.max(3,t);let n=[],o=[],a=[],s=[],l=new iQ,h=new iv;o.push(0,0,0),a.push(0,0,1),s.push(.5,.5);for(let n=0,c=3;n<=t;n++,c+=3){let d=i+n/t*r;l.x=e*Math.cos(d),l.y=e*Math.sin(d),o.push(l.x,l.y,l.z),a.push(0,0,1),h.x=(o[c]/e+1)/2,h.y=(o[c+1]/e+1)/2,s.push(h.x,h.y)}for(let e=1;e<=t;e++)n.push(e,e+1,0);this.setIndex(n),this.setAttribute("position",new ns(o,3)),this.setAttribute("normal",new ns(a,3)),this.setAttribute("uv",new ns(s,2))}static fromJSON(e){return new dd(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class du extends ng{constructor(e=1,t=1,i=1,r=8,n=1,o=!1,a=0,s=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:o,thetaStart:a,thetaLength:s};let l=this;r=Math.floor(r),n=Math.floor(n);let h=[],c=[],d=[],u=[],p=0,m=[],f=i/2,g=0;function y(i){let n=p,o=new iv,m=new iQ,y=0,x=!0===i?e:t,w=!0===i?1:-1;for(let e=1;e<=r;e++)c.push(0,f*w,0),d.push(0,w,0),u.push(.5,.5),p++;let b=p;for(let e=0;e<=r;e++){let t=e/r,i=t*s+a,n=Math.cos(i),l=Math.sin(i);m.x=x*l,m.y=f*w,m.z=x*n,c.push(m.x,m.y,m.z),d.push(0,w,0),o.x=.5*n+.5,o.y=.5*l*w+.5,u.push(o.x,o.y),p++}for(let e=0;e<r;e++){let t=n+e,r=b+e;!0===i?h.push(r,r+1,t):h.push(r+1,r,t),y+=3}l.addGroup(g,y,!0===i?1:2),g+=y}(function(){let o=new iQ,y=new iQ,x=0,w=(t-e)/i;for(let l=0;l<=n;l++){let h=[],g=l/n,x=g*(t-e)+e;for(let e=0;e<=r;e++){let t=e/r,n=t*s+a,l=Math.sin(n),m=Math.cos(n);y.x=x*l,y.y=-g*i+f,y.z=x*m,c.push(y.x,y.y,y.z),o.set(l,w,m).normalize(),d.push(o.x,o.y,o.z),u.push(t,1-g),h.push(p++)}m.push(h)}for(let e=0;e<r;e++)for(let t=0;t<n;t++){let i=m[t][e],r=m[t+1][e],n=m[t+1][e+1],o=m[t][e+1];h.push(i,r,o),h.push(r,n,o),x+=6}l.addGroup(g,x,0),g+=x})(),!1===o&&(e>0&&y(!0),t>0&&y(!1)),this.setIndex(h),this.setAttribute("position",new ns(c,3)),this.setAttribute("normal",new ns(d,3)),this.setAttribute("uv",new ns(u,2))}static fromJSON(e){return new du(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class dp extends du{constructor(e=1,t=1,i=8,r=1,n=!1,o=0,a=2*Math.PI){super(0,e,t,i,r,n,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:o,thetaLength:a}}static fromJSON(e){return new dp(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class dm extends ng{constructor(e=[],t=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r};let n=[],o=[];function a(e,t,i,r){let n=r+1,o=[];for(let r=0;r<=n;r++){o[r]=[];let a=e.clone().lerp(i,r/n),s=t.clone().lerp(i,r/n),l=n-r;for(let e=0;e<=l;e++)0===e&&r===n?o[r][e]=a:o[r][e]=a.clone().lerp(s,e/l)}for(let e=0;e<n;e++)for(let t=0;t<2*(n-e)-1;t++){let i=Math.floor(t/2);t%2==0?(c(o[e][i+1]),c(o[e+1][i]),c(o[e][i])):(c(o[e][i+1]),c(o[e+1][i+1]),c(o[e+1][i]))}}function s(e){let t=new iQ;for(let i=0;i<n.length;i+=3)t.x=n[i+0],t.y=n[i+1],t.z=n[i+2],t.normalize().multiplyScalar(e),n[i+0]=t.x,n[i+1]=t.y,n[i+2]=t.z}function l(){let e=new iQ;for(let t=0;t<n.length;t+=3){e.x=n[t+0],e.y=n[t+1],e.z=n[t+2];let i=m(e)/2/Math.PI+.5,r=f(e)/Math.PI+.5;o.push(i,1-r)}u(),h()}function h(){for(let e=0;e<o.length;e+=6){let t=o[e+0],i=o[e+2],r=o[e+4],n=Math.max(t,i,r),a=Math.min(t,i,r);n>.9&&a<.1&&(t<.2&&(o[e+0]+=1),i<.2&&(o[e+2]+=1),r<.2&&(o[e+4]+=1))}}function c(e){n.push(e.x,e.y,e.z)}function d(t,i){let r=3*t;i.x=e[r+0],i.y=e[r+1],i.z=e[r+2]}function u(){let e=new iQ,t=new iQ,i=new iQ,r=new iQ,a=new iv,s=new iv,l=new iv;for(let h=0,c=0;h<n.length;h+=9,c+=6){e.set(n[h+0],n[h+1],n[h+2]),t.set(n[h+3],n[h+4],n[h+5]),i.set(n[h+6],n[h+7],n[h+8]),a.set(o[c+0],o[c+1]),s.set(o[c+2],o[c+3]),l.set(o[c+4],o[c+5]),r.copy(e).add(t).add(i).divideScalar(3);let d=m(r);p(a,c+0,e,d),p(s,c+2,t,d),p(l,c+4,i,d)}}function p(e,t,i,r){r<0&&1===e.x&&(o[t]=e.x-1),0===i.x&&0===i.z&&(o[t]=r/2/Math.PI+.5)}function m(e){return Math.atan2(e.z,-e.x)}function f(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(function(e){let i=new iQ,r=new iQ,n=new iQ;for(let o=0;o<t.length;o+=3)d(t[o+0],i),d(t[o+1],r),d(t[o+2],n),a(i,r,n,e)})(r),s(i),l(),this.setAttribute("position",new ns(n,3)),this.setAttribute("normal",new ns(n.slice(),3)),this.setAttribute("uv",new ns(o,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new dm(e.vertices,e.indices,e.radius,e.details)}}class df extends dm{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,r=1/i,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(n,o,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new df(e.radius,e.detail)}}let dg=new iQ,dy=new iQ,dx=new iQ,dw=new r1;class db extends ng{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){let i=4,r=Math.pow(10,i),n=Math.cos(ir*t),o=e.getIndex(),a=e.getAttribute("position"),s=o?o.count:a.count,l=[0,0,0],h=["a","b","c"],c=[,,,],d={},u=[];for(let e=0;e<s;e+=3){o?(l[0]=o.getX(e),l[1]=o.getX(e+1),l[2]=o.getX(e+2)):(l[0]=e,l[1]=e+1,l[2]=e+2);let{a:t,b:i,c:s}=dw;if(t.fromBufferAttribute(a,l[0]),i.fromBufferAttribute(a,l[1]),s.fromBufferAttribute(a,l[2]),dw.getNormal(dx),c[0]=`${Math.round(t.x*r)},${Math.round(t.y*r)},${Math.round(t.z*r)}`,c[1]=`${Math.round(i.x*r)},${Math.round(i.y*r)},${Math.round(i.z*r)}`,c[2]=`${Math.round(s.x*r)},${Math.round(s.y*r)},${Math.round(s.z*r)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let e=0;e<3;e++){let t=(e+1)%3,i=c[e],r=c[t],o=dw[h[e]],a=dw[h[t]],s=`${i}_${r}`,p=`${r}_${i}`;p in d&&d[p]?(dx.dot(d[p].normal)<=n&&(u.push(o.x,o.y,o.z),u.push(a.x,a.y,a.z)),d[p]=null):s in d||(d[s]={index0:l[e],index1:l[t],normal:dx.clone()})}}for(let e in d)if(d[e]){let{index0:t,index1:i}=d[e];dg.fromBufferAttribute(a,t),dy.fromBufferAttribute(a,i),u.push(dg.x,dg.y,dg.z),u.push(dy.x,dy.y,dy.z)}this.setAttribute("position",new ns(u,3))}}}class dv extends dl{constructor(e){super(e),this.uuid=ia(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){let i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let i=e.holes[t];this.holes.push(new dl().fromJSON(i))}return this}}let dM={triangulate:function(e,t,i=2){let r,n,o,a,s,l,h;let c=t&&t.length,d=c?t[0]*i:e.length,u=dS(e,0,d,i,!0),p=[];if(!u||u.next===u.prev)return p;if(c&&(u=dE(e,t,u,i)),e.length>80*i){r=o=e[0],n=a=e[1];for(let t=i;t<d;t+=i)s=e[t],l=e[t+1],s<r&&(r=s),l<n&&(n=l),s>o&&(o=s),l>a&&(a=l);h=0!==(h=Math.max(o-r,a-n))?1/h:0}return dT(u,p,i,r,n,h),p}};function dS(e,t,i,r,n){let o,a;if(n===d$(e,t,i,r)>0)for(o=t;o<i;o+=r)a=dZ(o,e[o],e[o+1],a);else for(o=i-r;o>=t;o-=r)a=dZ(o,e[o],e[o+1],a);return a&&dN(a,a.next)&&(dQ(a),a=a.next),a}function dP(e,t){if(!e)return e;t||(t=e);let i=e,r;do if(r=!1,!i.steiner&&(dN(i,i.next)||0===dU(i.prev,i,i.next))){if(dQ(i),(i=t=i.prev)===i.next)break;r=!0}else i=i.next;while(r||i!==t)return t}function dT(e,t,i,r,n,o,a){if(!e)return;!a&&o&&dV(e,r,n,o);let s=e,l,h;for(;e.prev!==e.next;){if(l=e.prev,h=e.next,o?dC(e,r,n,o):d_(e)){t.push(l.i/i),t.push(e.i/i),t.push(h.i/i),dQ(e),e=h.next,s=h.next;continue}if((e=h)===s){a?1===a?dT(e=dD(dP(e),t,i),t,i,r,n,o,2):2===a&&dA(e,t,i,r,n,o):dT(dP(e),t,i,r,n,o,1);break}}}function d_(e){let t=e.prev,i=e,r=e.next;if(dU(t,i,r)>=0)return!1;let n=e.next.next;for(;n!==e.prev;){if(dF(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&dU(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function dC(e,t,i,r){let n=e.prev,o=e,a=e.next;if(dU(n,o,a)>=0)return!1;let s=n.x<o.x?n.x<a.x?n.x:a.x:o.x<a.x?o.x:a.x,l=n.y<o.y?n.y<a.y?n.y:a.y:o.y<a.y?o.y:a.y,h=n.x>o.x?n.x>a.x?n.x:a.x:o.x>a.x?o.x:a.x,c=n.y>o.y?n.y>a.y?n.y:a.y:o.y>a.y?o.y:a.y,d=dB(s,l,t,i,r),u=dB(h,c,t,i,r),p=e.prevZ,m=e.nextZ;for(;p&&p.z>=d&&m&&m.z<=u;){if(p!==e.prev&&p!==e.next&&dF(n.x,n.y,o.x,o.y,a.x,a.y,p.x,p.y)&&dU(p.prev,p,p.next)>=0||(p=p.prevZ,m!==e.prev&&m!==e.next&&dF(n.x,n.y,o.x,o.y,a.x,a.y,m.x,m.y)&&dU(m.prev,m,m.next)>=0))return!1;m=m.nextZ}for(;p&&p.z>=d;){if(p!==e.prev&&p!==e.next&&dF(n.x,n.y,o.x,o.y,a.x,a.y,p.x,p.y)&&dU(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=u;){if(m!==e.prev&&m!==e.next&&dF(n.x,n.y,o.x,o.y,a.x,a.y,m.x,m.y)&&dU(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function dD(e,t,i){let r=e;do{let n=r.prev,o=r.next.next;!dN(n,o)&&dG(n,r,r.next,o)&&dX(n,o)&&dX(o,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(o.i/i),dQ(r),dQ(r.next),r=e=o),r=r.next}while(r!==e)return dP(r)}function dA(e,t,i,r,n,o){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&dz(a,e)){let s=dJ(a,e);a=dP(a,a.next),s=dP(s,s.next),dT(a,t,i,r,n,o),dT(s,t,i,r,n,o);return}e=e.next}a=a.next}while(a!==e)}function dE(e,t,i,r){let n,o,a,s,l;let h=[];for(n=0,o=t.length;n<o;n++)a=t[n]*r,s=n<o-1?t[n+1]*r:e.length,(l=dS(e,a,s,r,!1))===l.next&&(l.steiner=!0),h.push(dO(l));for(h.sort(dL),n=0;n<h.length;n++)dI(h[n],i),i=dP(i,i.next);return i}function dL(e,t){return e.x-t.x}function dI(e,t){if(t=dR(e,t)){let i=dJ(t,e);dP(t,t.next),dP(i,i.next)}}function dR(e,t){let i=t,r=e.x,n=e.y,o=-1/0,a;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){let e=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=r&&e>o){if(o=e,e===r){if(n===i.y)return i;if(n===i.next.y)return i.next}a=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t)if(!a)return null;if(r===o)return a;let s=a,l=a.x,h=a.y,c=1/0,d;i=a;do r>=i.x&&i.x>=l&&r!==i.x&&dF(n<h?r:o,n,l,h,n<h?o:r,n,i.x,i.y)&&(d=Math.abs(n-i.y)/(r-i.x),dX(i,e)&&(d<c||d===c&&(i.x>a.x||i.x===a.x&&dW(a,i)))&&(a=i,c=d)),i=i.next;while(i!==s)return a}function dW(e,t){return 0>dU(e.prev,e,t.prev)&&0>dU(t.next,e,e.next)}function dV(e,t,i,r){let n=e;do null===n.z&&(n.z=dB(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e)n.prevZ.nextZ=null,n.prevZ=null,dk(n)}function dk(e){let t,i,r,n,o,a,s,l,h=1;do{for(i=e,e=null,o=null,a=0;i;){for(a++,r=i,s=0,t=0;t<h&&(s++,r=r.nextZ);t++);for(l=h;s>0||l>0&&r;)0!==s&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,s--):(n=r,r=r.nextZ,l--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=r}o.nextZ=null,h*=2}while(a>1)return e}function dB(e,t,i,r,n){return(e=((e=((e=((e=((e=32767*(e-i)*n)|e<<8)&16711935)|e<<4)&252645135)|e<<2)&858993459)|e<<1)&1431655765)|(t=((t=((t=((t=((t=32767*(t-r)*n)|t<<8)&16711935)|t<<4)&252645135)|t<<2)&858993459)|t<<1)&1431655765)<<1}function dO(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e)return i}function dF(e,t,i,r,n,o,a,s){return(n-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(r-s)-(i-a)*(t-s)>=0&&(i-a)*(o-s)-(n-a)*(r-s)>=0}function dz(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!dq(e,t)&&(dX(e,t)&&dX(t,e)&&dY(e,t)&&(dU(e.prev,e,t.prev)||dU(e,t.prev,t))||dN(e,t)&&dU(e.prev,e,e.next)>0&&dU(t.prev,t,t.next)>0)}function dU(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function dN(e,t){return e.x===t.x&&e.y===t.y}function dG(e,t,i,r){let n=dj(dU(e,t,i)),o=dj(dU(e,t,r)),a=dj(dU(i,r,e)),s=dj(dU(i,r,t));return!!(n!==o&&a!==s||0===n&&dH(e,i,t)||0===o&&dH(e,r,t)||0===a&&dH(i,e,r)||0===s&&dH(i,t,r))}function dH(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function dj(e){return e>0?1:e<0?-1:0}function dq(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&dG(i,i.next,e,t))return!0;i=i.next}while(i!==e)return!1}function dX(e,t){return 0>dU(e.prev,e,e.next)?dU(e,t,e.next)>=0&&dU(e,e.prev,t)>=0:0>dU(e,t,e.prev)||0>dU(e,e.next,t)}function dY(e,t){let i=e,r=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e)return r}function dJ(e,t){let i=new dK(e.i,e.x,e.y),r=new dK(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function dZ(e,t,i,r){let n=new dK(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function dQ(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function dK(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function d$(e,t,i,r){let n=0;for(let o=t,a=i-r;o<i;o+=r)n+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return n}class d0{static area(e){let t=e.length,i=0;for(let r=t-1,n=0;n<t;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return .5*i}static isClockWise(e){return 0>d0.area(e)}static triangulateShape(e,t){let i=[],r=[],n=[];d1(e),d2(i,e);let o=e.length;t.forEach(d1);for(let e=0;e<t.length;e++)r.push(o),o+=t[e].length,d2(i,t[e]);let a=dM.triangulate(i,r);for(let e=0;e<a.length;e+=3)n.push(a.slice(e,e+3));return n}}function d1(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function d2(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}class d3 extends ng{constructor(e=new dv([new iv(.5,.5),new iv(-.5,.5),new iv(-.5,-.5),new iv(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];let i=this,r=[],n=[];for(let t=0,i=e.length;t<i;t++){let i=e[t];o(i)}function o(e){let o,a,s,l;let h=[],c=void 0!==t.curveSegments?t.curveSegments:12,d=void 0!==t.steps?t.steps:1,u=void 0!==t.depth?t.depth:1,p=void 0===t.bevelEnabled||t.bevelEnabled,m=void 0!==t.bevelThickness?t.bevelThickness:.2,f=void 0!==t.bevelSize?t.bevelSize:m-.1,g=void 0!==t.bevelOffset?t.bevelOffset:0,y=void 0!==t.bevelSegments?t.bevelSegments:3,x=t.extrudePath,w=void 0!==t.UVGenerator?t.UVGenerator:d4,b,v=!1;x&&(b=x.getSpacedPoints(d),v=!0,p=!1,o=x.computeFrenetFrames(d,!1),a=new iQ,s=new iQ,l=new iQ),p||(y=0,m=0,f=0,g=0);let M=e.extractPoints(c),S=M.shape,P=M.holes,T=!d0.isClockWise(S);if(T){S=S.reverse();for(let e=0,t=P.length;e<t;e++){let t=P[e];d0.isClockWise(t)&&(P[e]=t.reverse())}}let _=d0.triangulateShape(S,P),C=S;for(let e=0,t=P.length;e<t;e++){let t=P[e];S=S.concat(t)}function D(e,t,i){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}let A=S.length,E=_.length;function L(e,t,i){let r,n,o;let a=e.x-t.x,s=e.y-t.y,l=i.x-e.x,h=i.y-e.y,c=a*a+s*s,d=a*h-s*l;if(Math.abs(d)>Number.EPSILON){let d=Math.sqrt(c),u=Math.sqrt(l*l+h*h),p=t.x-s/d,m=t.y+a/d,f=i.x-h/u,g=i.y+l/u,y=((f-p)*h-(g-m)*l)/(a*h-s*l);r=p+a*y-e.x,n=m+s*y-e.y;let x=r*r+n*n;if(x<=2)return new iv(r,n);o=Math.sqrt(x/2)}else{let e=!1;a>Number.EPSILON?l>Number.EPSILON&&(e=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(s)===Math.sign(h)&&(e=!0),e?(r=-s,n=a,o=Math.sqrt(c)):(r=a,n=s,o=Math.sqrt(c/2))}return new iv(r/o,n/o)}let I=[];for(let e=0,t=C.length,i=t-1,r=e+1;e<t;e++,i++,r++)i===t&&(i=0),r===t&&(r=0),I[e]=L(C[e],C[i],C[r]);let R=[],W,V=I.concat();for(let e=0,t=P.length;e<t;e++){let t=P[e];W=[];for(let e=0,i=t.length,r=i-1,n=e+1;e<i;e++,r++,n++)r===i&&(r=0),n===i&&(n=0),W[e]=L(t[e],t[r],t[n]);R.push(W),V=V.concat(W)}for(let e=0;e<y;e++){let t=e/y,i=m*Math.cos(t*Math.PI/2),r=f*Math.sin(t*Math.PI/2)+g;for(let e=0,t=C.length;e<t;e++){let t=D(C[e],I[e],r);F(t.x,t.y,-i)}for(let e=0,t=P.length;e<t;e++){let t=P[e];W=R[e];for(let e=0,n=t.length;e<n;e++){let n=D(t[e],W[e],r);F(n.x,n.y,-i)}}}let k=f+g;for(let e=0;e<A;e++){let t=p?D(S[e],V[e],k):S[e];v?(s.copy(o.normals[0]).multiplyScalar(t.x),a.copy(o.binormals[0]).multiplyScalar(t.y),l.copy(b[0]).add(s).add(a),F(l.x,l.y,l.z)):F(t.x,t.y,0)}for(let e=1;e<=d;e++)for(let t=0;t<A;t++){let i=p?D(S[t],V[t],k):S[t];v?(s.copy(o.normals[e]).multiplyScalar(i.x),a.copy(o.binormals[e]).multiplyScalar(i.y),l.copy(b[e]).add(s).add(a),F(l.x,l.y,l.z)):F(i.x,i.y,u/d*e)}for(let e=y-1;e>=0;e--){let t=e/y,i=m*Math.cos(t*Math.PI/2),r=f*Math.sin(t*Math.PI/2)+g;for(let e=0,t=C.length;e<t;e++){let t=D(C[e],I[e],r);F(t.x,t.y,u+i)}for(let e=0,t=P.length;e<t;e++){let t=P[e];W=R[e];for(let e=0,n=t.length;e<n;e++){let n=D(t[e],W[e],r);v?F(n.x,n.y+b[d-1].y,b[d-1].x+i):F(n.x,n.y,u+i)}}}function B(){let e=r.length/3,t=0;O(C,0),t+=C.length;for(let e=0,i=P.length;e<i;e++){let i=P[e];O(i,t),t+=i.length}i.addGroup(e,r.length/3-e,1)}function O(e,t){let i=e.length;for(;--i>=0;){let r=i,n=i-1;n<0&&(n=e.length-1);for(let e=0,i=d+2*y;e<i;e++){let i=A*e,o=A*(e+1),a=t+r+i,s=t+n+i,l=t+n+o,h=t+r+o;U(a,s,l,h)}}}function F(e,t,i){h.push(e),h.push(t),h.push(i)}function z(e,t,n){N(e),N(t),N(n);let o=r.length/3,a=w.generateTopUV(i,r,o-3,o-2,o-1);G(a[0]),G(a[1]),G(a[2])}function U(e,t,n,o){N(e),N(t),N(o),N(t),N(n),N(o);let a=r.length/3,s=w.generateSideWallUV(i,r,a-6,a-3,a-2,a-1);G(s[0]),G(s[1]),G(s[3]),G(s[1]),G(s[2]),G(s[3])}function N(e){r.push(h[3*e+0]),r.push(h[3*e+1]),r.push(h[3*e+2])}function G(e){n.push(e.x),n.push(e.y)}(function(){let e=r.length/3;if(p){let e=0,t=0*A;for(let e=0;e<E;e++){let i=_[e];z(i[2]+t,i[1]+t,i[0]+t)}t=A*(e=d+2*y);for(let e=0;e<E;e++){let i=_[e];z(i[0]+t,i[1]+t,i[2]+t)}}else{for(let e=0;e<E;e++){let t=_[e];z(t[2],t[1],t[0])}for(let e=0;e<E;e++){let t=_[e];z(t[0]+A*d,t[1]+A*d,t[2]+A*d)}}i.addGroup(e,r.length/3-e,0)})(),B()}this.setAttribute("position",new ns(r,3)),this.setAttribute("uv",new ns(n,2)),this.computeVertexNormals()}toJSON(){let e=super.toJSON(),t=this.parameters.shapes,i=this.parameters.options;return d5(t,i,e)}static fromJSON(e,t){let i=[];for(let r=0,n=e.shapes.length;r<n;r++){let n=t[e.shapes[r]];i.push(n)}let r=e.options.extrudePath;return void 0!==r&&(e.options.extrudePath=new da[r.type]().fromJSON(r)),new d3(i,e.options)}}let d4={generateTopUV:function(e,t,i,r,n){let o=t[3*i],a=t[3*i+1],s=t[3*r],l=t[3*r+1],h=t[3*n],c=t[3*n+1];return[new iv(o,a),new iv(s,l),new iv(h,c)]},generateSideWallUV:function(e,t,i,r,n,o){let a=t[3*i],s=t[3*i+1],l=t[3*i+2],h=t[3*r],c=t[3*r+1],d=t[3*r+2],u=t[3*n],p=t[3*n+1],m=t[3*n+2],f=t[3*o],g=t[3*o+1],y=t[3*o+2];return Math.abs(s-c)<Math.abs(a-h)?[new iv(a,1-l),new iv(h,1-d),new iv(u,1-m),new iv(f,1-y)]:[new iv(s,1-l),new iv(c,1-d),new iv(p,1-m),new iv(g,1-y)]}};function d5(e,t,i){if(i.shapes=[],Array.isArray(e))for(let t=0,r=e.length;t<r;t++){let r=e[t];i.shapes.push(r.uuid)}else i.shapes.push(e.uuid);return i.options=Object.assign({},t),void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON()),i}class d6 extends dm{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,n,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new d6(e.radius,e.detail)}}class d9 extends dm{constructor(e=1,t=0){let i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(i,r,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new d9(e.radius,e.detail)}}class d8 extends ng{constructor(e=.5,t=1,i=8,r=1,n=0,o=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:n,thetaLength:o},i=Math.max(3,i),r=Math.max(1,r);let a=[],s=[],l=[],h=[],c=e,d=(t-e)/r,u=new iQ,p=new iv;for(let e=0;e<=r;e++){for(let e=0;e<=i;e++){let r=n+e/i*o;u.x=c*Math.cos(r),u.y=c*Math.sin(r),s.push(u.x,u.y,u.z),l.push(0,0,1),p.x=(u.x/t+1)/2,p.y=(u.y/t+1)/2,h.push(p.x,p.y)}c+=d}for(let e=0;e<r;e++){let t=e*(i+1);for(let e=0;e<i;e++){let r=e+t,n=r,o=r+i+1,s=r+i+2,l=r+1;a.push(n,o,l),a.push(o,s,l)}}this.setIndex(a),this.setAttribute("position",new ns(s,3)),this.setAttribute("normal",new ns(l,3)),this.setAttribute("uv",new ns(h,2))}static fromJSON(e){return new d8(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class ue extends ng{constructor(e=new dv([new iv(0,.5),new iv(-.5,-.5),new iv(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};let i=[],r=[],n=[],o=[],a=0,s=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(a,s,t),a+=s,s=0;function l(e){let a=r.length/3,l=e.extractPoints(t),h=l.shape,c=l.holes;!1===d0.isClockWise(h)&&(h=h.reverse());for(let e=0,t=c.length;e<t;e++){let t=c[e];!0===d0.isClockWise(t)&&(c[e]=t.reverse())}let d=d0.triangulateShape(h,c);for(let e=0,t=c.length;e<t;e++){let t=c[e];h=h.concat(t)}for(let e=0,t=h.length;e<t;e++){let t=h[e];r.push(t.x,t.y,0),n.push(0,0,1),o.push(t.x,t.y)}for(let e=0,t=d.length;e<t;e++){let t=d[e],r=t[0]+a,n=t[1]+a,o=t[2]+a;i.push(r,n,o),s+=3}}this.setIndex(i),this.setAttribute("position",new ns(r,3)),this.setAttribute("normal",new ns(n,3)),this.setAttribute("uv",new ns(o,2))}toJSON(){let e=super.toJSON(),t=this.parameters.shapes;return ut(t,e)}static fromJSON(e,t){let i=[];for(let r=0,n=e.shapes.length;r<n;r++){let n=t[e.shapes[r]];i.push(n)}return new ue(i,e.curveSegments)}}function ut(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){let r=e[i];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}class ui extends ng{constructor(e=1,t=32,i=16,r=0,n=2*Math.PI,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));let s=Math.min(o+a,Math.PI),l=0,h=[],c=new iQ,d=new iQ,u=[],p=[],m=[],f=[];for(let u=0;u<=i;u++){let g=[],y=u/i,x=0;0==u&&0==o?x=.5/t:u==i&&s==Math.PI&&(x=-.5/t);for(let i=0;i<=t;i++){let s=i/t;c.x=-e*Math.cos(r+s*n)*Math.sin(o+y*a),c.y=e*Math.cos(o+y*a),c.z=e*Math.sin(r+s*n)*Math.sin(o+y*a),p.push(c.x,c.y,c.z),d.copy(c).normalize(),m.push(d.x,d.y,d.z),f.push(s+x,1-y),g.push(l++)}h.push(g)}for(let e=0;e<i;e++)for(let r=0;r<t;r++){let t=h[e][r+1],n=h[e][r],a=h[e+1][r],l=h[e+1][r+1];(0!==e||o>0)&&u.push(t,n,l),(e!==i-1||s<Math.PI)&&u.push(n,a,l)}this.setIndex(u),this.setAttribute("position",new ns(p,3)),this.setAttribute("normal",new ns(m,3)),this.setAttribute("uv",new ns(f,2))}static fromJSON(e){return new ui(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class ur extends dm{constructor(e=1,t=0){let i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];super(i,r,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ur(e.radius,e.detail)}}class un extends ng{constructor(e=1,t=.4,i=8,r=6,n=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n},i=Math.floor(i),r=Math.floor(r);let o=[],a=[],s=[],l=[],h=new iQ,c=new iQ,d=new iQ;for(let o=0;o<=i;o++)for(let u=0;u<=r;u++){let p=u/r*n,m=o/i*Math.PI*2;c.x=(e+t*Math.cos(m))*Math.cos(p),c.y=(e+t*Math.cos(m))*Math.sin(p),c.z=t*Math.sin(m),a.push(c.x,c.y,c.z),h.x=e*Math.cos(p),h.y=e*Math.sin(p),d.subVectors(c,h).normalize(),s.push(d.x,d.y,d.z),l.push(u/r),l.push(o/i)}for(let e=1;e<=i;e++)for(let t=1;t<=r;t++){let i=(r+1)*e+t-1,n=(r+1)*(e-1)+t-1,a=(r+1)*(e-1)+t,s=(r+1)*e+t;o.push(i,n,s),o.push(n,a,s)}this.setIndex(o),this.setAttribute("position",new ns(a,3)),this.setAttribute("normal",new ns(s,3)),this.setAttribute("uv",new ns(l,2))}static fromJSON(e){return new un(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class uo extends ng{constructor(e=1,t=.4,i=64,r=8,n=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:o},i=Math.floor(i),r=Math.floor(r);let a=[],s=[],l=[],h=[],c=new iQ,d=new iQ,u=new iQ,p=new iQ,m=new iQ,f=new iQ,g=new iQ;for(let a=0;a<=i;++a){let x=a/i*n*Math.PI*2;y(x,n,o,e,u),y(x+.01,n,o,e,p),f.subVectors(p,u),g.addVectors(p,u),m.crossVectors(f,g),g.crossVectors(m,f),m.normalize(),g.normalize();for(let e=0;e<=r;++e){let n=e/r*Math.PI*2,o=-t*Math.cos(n),p=t*Math.sin(n);c.x=u.x+(o*g.x+p*m.x),c.y=u.y+(o*g.y+p*m.y),c.z=u.z+(o*g.z+p*m.z),s.push(c.x,c.y,c.z),d.subVectors(c,u).normalize(),l.push(d.x,d.y,d.z),h.push(a/i),h.push(e/r)}}for(let e=1;e<=i;e++)for(let t=1;t<=r;t++){let i=(r+1)*(e-1)+(t-1),n=(r+1)*e+(t-1),o=(r+1)*e+t,s=(r+1)*(e-1)+t;a.push(i,n,s),a.push(n,o,s)}function y(e,t,i,r,n){let o=Math.cos(e),a=Math.sin(e),s=i/t*e,l=Math.cos(s);n.x=r*(2+l)*.5*o,n.y=r*(2+l)*a*.5,n.z=r*Math.sin(s)*.5}this.setIndex(a),this.setAttribute("position",new ns(s,3)),this.setAttribute("normal",new ns(l,3)),this.setAttribute("uv",new ns(h,2))}static fromJSON(e){return new uo(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class ua extends ng{constructor(e=new dr(new iQ(-1,-1,0),new iQ(-1,1,0),new iQ(1,1,0)),t=64,i=1,r=8,n=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:n};let o=e.computeFrenetFrames(t,n);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;let a=new iQ,s=new iQ,l=new iv,h=new iQ,c=[],d=[],u=[],p=[];function m(n){h=e.getPointAt(n/t,h);let l=o.normals[n],u=o.binormals[n];for(let e=0;e<=r;e++){let t=e/r*Math.PI*2,n=Math.sin(t),o=-Math.cos(t);s.x=o*l.x+n*u.x,s.y=o*l.y+n*u.y,s.z=o*l.z+n*u.z,s.normalize(),d.push(s.x,s.y,s.z),a.x=h.x+i*s.x,a.y=h.y+i*s.y,a.z=h.z+i*s.z,c.push(a.x,a.y,a.z)}}function f(){for(let e=1;e<=t;e++)for(let t=1;t<=r;t++){let i=(r+1)*(e-1)+(t-1),n=(r+1)*e+(t-1),o=(r+1)*e+t,a=(r+1)*(e-1)+t;p.push(i,n,a),p.push(n,o,a)}}function g(){for(let e=0;e<=t;e++)for(let i=0;i<=r;i++)l.x=e/t,l.y=i/r,u.push(l.x,l.y)}(function(){for(let e=0;e<t;e++)m(e);m(!1===n?t:0),g(),f()})(),this.setIndex(p),this.setAttribute("position",new ns(c,3)),this.setAttribute("normal",new ns(d,3)),this.setAttribute("uv",new ns(u,2))}toJSON(){let e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new ua(new da[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class us extends ng{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){let t=[],i=new Set,r=new iQ,n=new iQ;if(null!==e.index){let o=e.attributes.position,a=e.index,s=e.groups;0===s.length&&(s=[{start:0,count:a.count,materialIndex:0}]);for(let e=0,l=s.length;e<l;++e){let l=s[e],h=l.start,c=l.count;for(let e=h,s=h+c;e<s;e+=3)for(let s=0;s<3;s++){let l=a.getX(e+s),h=a.getX(e+(s+1)%3);r.fromBufferAttribute(o,l),n.fromBufferAttribute(o,h),!0===ul(r,n,i)&&(t.push(r.x,r.y,r.z),t.push(n.x,n.y,n.z))}}}else{let o=e.attributes.position;for(let e=0,a=o.count/3;e<a;e++)for(let a=0;a<3;a++){let s=3*e+a,l=3*e+(a+1)%3;r.fromBufferAttribute(o,s),n.fromBufferAttribute(o,l),!0===ul(r,n,i)&&(t.push(r.x,r.y,r.z),t.push(n.x,n.y,n.z))}}this.setAttribute("position",new ns(t,3))}}}function ul(e,t,i){let r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,n=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==i.has(r)&&!0!==i.has(n)&&(i.add(r),i.add(n),!0)}var uh=Object.freeze({__proto__:null,BoxGeometry:nB,CapsuleGeometry:dc,CircleGeometry:dd,ConeGeometry:dp,CylinderGeometry:du,DodecahedronGeometry:df,EdgesGeometry:db,ExtrudeGeometry:d3,IcosahedronGeometry:d6,LatheGeometry:dh,OctahedronGeometry:d9,PlaneGeometry:n8,PolyhedronGeometry:dm,RingGeometry:d8,ShapeGeometry:ue,SphereGeometry:ui,TetrahedronGeometry:ur,TorusGeometry:un,TorusKnotGeometry:uo,TubeGeometry:ua,WireframeGeometry:us});class uc extends r3{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new iB(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class ud extends nH{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class uu extends r3{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new iB(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new iB(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tE,this.normalScale=new iv(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class up extends uu{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new iv(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return is(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new iB(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new iB(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new iB(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class um extends r3{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new iB(16777215),this.specular=new iB(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new iB(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tE,this.normalScale=new iv(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Q,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class uf extends r3{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new iB(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new iB(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tE,this.normalScale=new iv(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class ug extends r3{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tE,this.normalScale=new iv(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class uy extends r3{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new iB(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new iB(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tE,this.normalScale=new iv(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Q,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class ux extends r3{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new iB(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tE,this.normalScale=new iv(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class uw extends cb{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function ub(e,t,i){return uM(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)}function uv(e,t,i){return e&&(i||e.constructor!==t)?"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e):e}function uM(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function uS(e){function t(t,i){return e[t]-e[i]}let i=e.length,r=Array(i);for(let e=0;e!==i;++e)r[e]=e;return r.sort(t),r}function uP(e,t,i){let r=e.length,n=new e.constructor(r);for(let o=0,a=0;a!==r;++o){let r=i[o]*t;for(let i=0;i!==t;++i)n[a++]=e[r+i]}return n}function uT(e,t,i,r){let n=1,o=e[0];for(;void 0!==o&&void 0===o[r];)o=e[n++];if(void 0===o)return;let a=o[r];if(void 0!==a){if(Array.isArray(a))do void 0!==(a=o[r])&&(t.push(o.time),i.push.apply(i,a)),o=e[n++];while(void 0!==o)else if(void 0!==a.toArray)do void 0!==(a=o[r])&&(t.push(o.time),a.toArray(i,i.length)),o=e[n++];while(void 0!==o)else do void 0!==(a=o[r])&&(t.push(o.time),i.push(a)),o=e[n++];while(void 0!==o)}}function u_(e,t,i,r,n=30){let o=e.clone();o.name=t;let a=[];for(let e=0;e<o.tracks.length;++e){let t=o.tracks[e],s=t.getValueSize(),l=[],h=[];for(let e=0;e<t.times.length;++e){let o=t.times[e]*n;if(!(o<i)&&!(o>=r)){l.push(t.times[e]);for(let i=0;i<s;++i)h.push(t.values[e*s+i])}}0!==l.length&&(t.times=uv(l,t.times.constructor),t.values=uv(h,t.values.constructor),a.push(t))}o.tracks=a;let s=1/0;for(let e=0;e<o.tracks.length;++e)s>o.tracks[e].times[0]&&(s=o.tracks[e].times[0]);for(let e=0;e<o.tracks.length;++e)o.tracks[e].shift(-1*s);return o.resetDuration(),o}function uC(e,t=0,i=e,r=30){r<=0&&(r=30);let n=i.tracks.length,o=t/r;for(let t=0;t<n;++t){let r;let n=i.tracks[t],a=n.ValueTypeName;if("bool"===a||"string"===a)continue;let s=e.tracks.find(function(e){return e.name===n.name&&e.ValueTypeName===a});if(void 0===s)continue;let l=0,h=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=h/3);let c=0,d=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=d/3);let u=n.times.length-1;if(o<=n.times[0]){let e=l,t=h-l;r=ub(n.values,e,t)}else if(o>=n.times[u]){let e=u*h+l,t=e+h-l;r=ub(n.values,e,t)}else{let e=n.createInterpolant(),t=l,i=h-l;e.evaluate(o),r=ub(e.resultBuffer,t,i)}if("quaternion"===a){let e=new iZ().fromArray(r).normalize().conjugate();e.toArray(r)}let p=s.times.length;for(let e=0;e<p;++e){let t=e*d+c;if("quaternion"===a)iZ.multiplyQuaternionsFlat(s.values,t,r,0,s.values,t);else{let e=d-2*c;for(let i=0;i<e;++i)s.values[t+i]-=r[i]}}}return e.blendMode=tM,e}var uD=Object.freeze({__proto__:null,arraySlice:ub,convertArray:uv,isTypedArray:uM,getKeyframeOrder:uS,sortedArray:uP,flattenJSON:uT,subclip:u_,makeClipAdditive:uC});class uA{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,i=this._cachedIndex,r=t[i],n=t[i-1];e:{t:{let o;i:{r:if(!(e<r)){for(let o=i+2;;){if(void 0===r){if(e<n)break r;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===o)break;if(n=r,e<(r=t[++i]))break t}o=t.length;break i}if(!(e>=n)){let a=t[1];e<a&&(i=2,n=a);for(let o=i-2;;){if(void 0===n)return this._cachedIndex=0,this.copySampleValue_(0);if(i===o)break;if(r=n,e>=(n=t[--i-1]))break t}o=i,i=0;break i}break e}for(;i<o;){let r=i+o>>>1;e<t[r]?o=r:i=r+1}if(r=t[i],void 0===(n=t[i-1]))return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r;for(let e=0;e!==r;++e)t[e]=i[n+e];return t}interpolate_(){throw Error("call to abstract method")}intervalChanged_(){}}class uE extends uA{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:tx,endingEnd:tx}}intervalChanged_(e,t,i){let r=this.parameterPositions,n=e-2,o=e+1,a=r[n],s=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case tw:n=e,a=2*t-i;break;case tb:n=r.length-2,a=t+r[n]-r[n+1];break;default:n=e,a=i}if(void 0===s)switch(this.getSettings_().endingEnd){case tw:o=e,s=2*i-t;break;case tb:o=1,s=i+r[1]-r[0];break;default:o=e-1,s=t}let l=(i-t)*.5,h=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(s-i),this._offsetPrev=n*h,this._offsetNext=o*h}interpolate_(e,t,i,r){let n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,h=this._offsetPrev,c=this._offsetNext,d=this._weightPrev,u=this._weightNext,p=(i-t)/(r-t),m=p*p,f=m*p,g=-d*f+2*d*m-d*p,y=(1+d)*f+(-1.5-2*d)*m+(-.5+d)*p+1,x=(-1-u)*f+(1.5+u)*m+.5*p,w=u*f-u*m;for(let e=0;e!==a;++e)n[e]=g*o[h+e]+y*o[l+e]+x*o[s+e]+w*o[c+e];return n}}class uL extends uA{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,h=(i-t)/(r-t),c=1-h;for(let e=0;e!==a;++e)n[e]=o[l+e]*c+o[s+e]*h;return n}}class uI extends uA{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class uR{constructor(e,t,i,r){if(void 0===e)throw Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=uv(t,this.TimeBufferType),this.values=uv(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){let t;let i=e.constructor;if(i.toJSON!==this.toJSON)t=i.toJSON(e);else{t={name:e.name,times:uv(e.times,Array),values:uv(e.values,Array)};let i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}InterpolantFactoryMethodDiscrete(e){return new uI(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new uL(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new uE(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case tf:t=this.InterpolantFactoryMethodDiscrete;break;case tg:t=this.InterpolantFactoryMethodLinear;break;case ty:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){let t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw Error(t)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return tf;case this.InterpolantFactoryMethodLinear:return tg;case this.InterpolantFactoryMethodSmooth:return ty}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(1!==e){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){let i=this.times,r=i.length,n=0,o=r-1;for(;n!==r&&i[n]<e;)++n;for(;-1!==o&&i[o]>t;)--o;if(++o,0!==n||o!==r){n>=o&&(n=(o=Math.max(o,1))-1);let e=this.getValueSize();this.times=ub(i,n,o),this.values=ub(this.values,n*e,o*e)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let i=this.times,r=this.values,n=i.length;0===n&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let t=0;t!==n;t++){let r=i[t];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,r),e=!1;break}if(null!==o&&o>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,r,o),e=!1;break}o=r}if(void 0!==r&&uM(r))for(let t=0,i=r.length;t!==i;++t){let i=r[t];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,i),e=!1;break}}return e}optimize(){let e=ub(this.times),t=ub(this.values),i=this.getValueSize(),r=this.getInterpolation()===ty,n=e.length-1,o=1;for(let a=1;a<n;++a){let n=!1,s=e[a],l=e[a+1];if(s!==l&&(1!==a||s!==e[0])){if(r)n=!0;else{let e=a*i,r=e-i,o=e+i;for(let a=0;a!==i;++a){let i=t[e+a];if(i!==t[r+a]||i!==t[o+a]){n=!0;break}}}}if(n){if(a!==o){e[o]=e[a];let r=a*i,n=o*i;for(let e=0;e!==i;++e)t[n+e]=t[r+e]}++o}}if(n>0){e[o]=e[n];for(let e=n*i,r=o*i,a=0;a!==i;++a)t[r+a]=t[e+a];++o}return o!==e.length?(this.times=ub(e,0,o),this.values=ub(t,0,o*i)):(this.times=e,this.values=t),this}clone(){let e=ub(this.times,0),t=ub(this.values,0),i=this.constructor,r=new i(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}uR.prototype.TimeBufferType=Float32Array,uR.prototype.ValueBufferType=Float32Array,uR.prototype.DefaultInterpolation=tg;class uW extends uR{}uW.prototype.ValueTypeName="bool",uW.prototype.ValueBufferType=Array,uW.prototype.DefaultInterpolation=tf,uW.prototype.InterpolantFactoryMethodLinear=void 0,uW.prototype.InterpolantFactoryMethodSmooth=void 0;class uV extends uR{}uV.prototype.ValueTypeName="color";class uk extends uR{}uk.prototype.ValueTypeName="number";class uB extends uA{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=(i-t)/(r-t),l=e*a;for(let e=l+a;l!==e;l+=4)iZ.slerpFlat(n,0,o,l-a,o,l,s);return n}}class uO extends uR{InterpolantFactoryMethodLinear(e){return new uB(this.times,this.values,this.getValueSize(),e)}}uO.prototype.ValueTypeName="quaternion",uO.prototype.DefaultInterpolation=tg,uO.prototype.InterpolantFactoryMethodSmooth=void 0;class uF extends uR{}uF.prototype.ValueTypeName="string",uF.prototype.ValueBufferType=Array,uF.prototype.DefaultInterpolation=tf,uF.prototype.InterpolantFactoryMethodLinear=void 0,uF.prototype.InterpolantFactoryMethodSmooth=void 0;class uz extends uR{}uz.prototype.ValueTypeName="vector";class uU{constructor(e,t=-1,i,r=tv){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=ia(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],i=e.tracks,r=1/(e.fps||1);for(let e=0,n=i.length;e!==n;++e)t.push(uG(i[e]).scale(r));let n=new this(e.name,e.duration,t,e.blendMode);return n.uuid=e.uuid,n}static toJSON(e){let t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,r=i.length;e!==r;++e)t.push(uR.toJSON(i[e]));return r}static CreateFromMorphTargetSequence(e,t,i,r){let n=t.length,o=[];for(let e=0;e<n;e++){let a=[],s=[];a.push((e+n-1)%n,e,(e+1)%n),s.push(0,1,0);let l=uS(a);a=uP(a,1,l),s=uP(s,1,l),r||0!==a[0]||(a.push(n),s.push(s[0])),o.push(new uk(".morphTargetInfluences["+t[e].name+"]",a,s).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let i=e;if(!Array.isArray(e)){let t=e;i=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<i.length;e++)if(i[e].name===t)return i[e];return null}static CreateClipsFromMorphTargetSequences(e,t,i){let r={},n=/^([\w-]*?)([\d]+)$/;for(let t=0,i=e.length;t<i;t++){let i=e[t],o=i.name.match(n);if(o&&o.length>1){let e=o[1],t=r[e];t||(r[e]=t=[]),t.push(i)}}let o=[];for(let e in r)o.push(this.CreateFromMorphTargetSequence(e,r[e],t,i));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(e,t,i,r,n){if(0!==i.length){let o=[],a=[];uT(i,o,a,r),0!==o.length&&n.push(new e(t,o,a))}},r=[],n=e.name||"default",o=e.fps||30,a=e.blendMode,s=e.length||-1,l=e.hierarchy||[];for(let e=0;e<l.length;e++){let n=l[e].keys;if(n&&0!==n.length){if(n[0].morphTargets){let e;let t={};for(e=0;e<n.length;e++)if(n[e].morphTargets)for(let i=0;i<n[e].morphTargets.length;i++)t[n[e].morphTargets[i]]=-1;for(let i in t){let t=[],o=[];for(let r=0;r!==n[e].morphTargets.length;++r){let r=n[e];t.push(r.time),o.push(r.morphTarget===i?1:0)}r.push(new uk(".morphTargetInfluence["+i+"]",t,o))}s=t.length*o}else{let o=".bones["+t[e].name+"]";i(uz,o+".position",n,"pos",r),i(uO,o+".quaternion",n,"rot",r),i(uz,o+".scale",n,"scl",r)}}}if(0===r.length)return null;let h=new this(n,s,r,a);return h}resetDuration(){let e=this.tracks,t=0;for(let i=0,r=e.length;i!==r;++i){let e=this.tracks[i];t=Math.max(t,e.times[e.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function uN(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return uk;case"vector":case"vector2":case"vector3":case"vector4":return uz;case"color":return uV;case"quaternion":return uO;case"bool":case"boolean":return uW;case"string":return uF}throw Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function uG(e){if(void 0===e.type)throw Error("THREE.KeyframeTrack: track type undefined, can not parse");let t=uN(e.type);if(void 0===e.times){let t=[],i=[];uT(e.keys,t,i,"value"),e.times=t,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}let uH={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class uj{constructor(e,t,i){let r;let n=this,o=!1,a=0,s=0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){s++,!1===o&&void 0!==n.onStart&&n.onStart(e,a,s),o=!0},this.itemEnd=function(e){a++,void 0!==n.onProgress&&n.onProgress(e,a,s),a===s&&(o=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){let t=l.indexOf(e);return -1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,i=l.length;t<i;t+=2){let i=l[t],r=l[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return r}return null}}}let uq=new uj;class uX{constructor(e){this.manager=void 0!==e?e:uq,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let i=this;return new Promise(function(r,n){i.load(e,r,t,n)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}let uY={};class uJ extends Error{constructor(e,t){super(e),this.response=t}}class uZ extends uX{constructor(e){super(e)}load(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let n=uH.get(e);if(void 0!==n)return this.manager.itemStart(e),setTimeout(()=>{t&&t(n),this.manager.itemEnd(e)},0),n;if(void 0!==uY[e]){uY[e].push({onLoad:t,onProgress:i,onError:r});return}uY[e]=[],uY[e].push({onLoad:t,onProgress:i,onError:r});let o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,s=this.responseType;fetch(o).then(t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;let i=uY[e],r=t.body.getReader(),n=t.headers.get("Content-Length"),o=n?parseInt(n):0,a=0!==o,s=0,l=new ReadableStream({start(e){t();function t(){r.read().then(({done:r,value:n})=>{if(r)e.close();else{s+=n.byteLength;let r=new ProgressEvent("progress",{lengthComputable:a,loaded:s,total:o});for(let e=0,t=i.length;e<t;e++){let t=i[e];t.onProgress&&t.onProgress(r)}e.enqueue(n),t()}})}}});return new Response(l)}throw new uJ(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)}).then(e=>{switch(s){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(e=>{let t=new DOMParser;return t.parseFromString(e,a)});case"json":return e.json();default:if(void 0===a)return e.text();{let t=/charset="?([^;"\s]*)"?/i,i=t.exec(a),r=i&&i[1]?i[1].toLowerCase():void 0,n=new TextDecoder(r);return e.arrayBuffer().then(e=>n.decode(e))}}}).then(t=>{uH.add(e,t);let i=uY[e];delete uY[e];for(let e=0,r=i.length;e<r;e++){let r=i[e];r.onLoad&&r.onLoad(t)}}).catch(t=>{let i=uY[e];if(void 0===i)throw this.manager.itemError(e),t;delete uY[e];for(let e=0,r=i.length;e<r;e++){let r=i[e];r.onError&&r.onError(t)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class uQ extends uX{constructor(e){super(e)}load(e,t,i,r){let n=this,o=new uZ(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(i){try{t(n.parse(JSON.parse(i)))}catch(t){r?r(t):console.error(t),n.manager.itemError(e)}},i,r)}parse(e){let t=[];for(let i=0;i<e.length;i++){let r=uU.parse(e[i]);t.push(r)}return t}}class uK extends uX{constructor(e){super(e)}load(e,t,i,r){let n=this,o=[],a=new cz,s=new uZ(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(n.withCredentials);let l=0;function h(h){s.load(e[h],function(e){let i=n.parse(e,!0);o[h]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},6===(l+=1)&&(1===i.mipmapCount&&(a.minFilter=ev),a.image=o,a.format=i.format,a.needsUpdate=!0,t&&t(a))},i,r)}if(Array.isArray(e))for(let t=0,i=e.length;t<i;++t)h(t);else s.load(e,function(e){let i=n.parse(e,!0);if(i.isCubemap){let e=i.mipmaps.length/i.mipmapCount;for(let t=0;t<e;t++){o[t]={mipmaps:[]};for(let e=0;e<i.mipmapCount;e++)o[t].mipmaps.push(i.mipmaps[t*i.mipmapCount+e]),o[t].format=i.format,o[t].width=i.width,o[t].height=i.height}a.image=o}else a.image.width=i.width,a.image.height=i.height,a.mipmaps=i.mipmaps;1===i.mipmapCount&&(a.minFilter=ev),a.format=i.format,a.needsUpdate=!0,t&&t(a)},i,r);return a}}class u$ extends uX{constructor(e){super(e)}load(e,t,i,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let n=this,o=uH.get(e);if(void 0!==o)return n.manager.itemStart(e),setTimeout(function(){t&&t(o),n.manager.itemEnd(e)},0),o;let a=i_("img");function s(){h(),uH.add(e,this),t&&t(this),n.manager.itemEnd(e)}function l(t){h(),r&&r(t),n.manager.itemError(e),n.manager.itemEnd(e)}function h(){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",s,!1),a.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),n.manager.itemStart(e),a.src=e,a}}class u0 extends uX{constructor(e){super(e)}load(e,t,i,r){let n=new nZ,o=new u$(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function s(i){o.load(e[i],function(e){n.images[i]=e,6==++a&&(n.needsUpdate=!0,t&&t(n))},void 0,r)}for(let t=0;t<e.length;++t)s(t);return n}}class u1 extends uX{constructor(e){super(e)}load(e,t,i,r){let n=this,o=new cc,a=new uZ(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(n.withCredentials),a.load(e,function(e){let i=n.parse(e);i&&(void 0!==i.image?o.image=i.image:void 0!==i.data&&(o.image.width=i.width,o.image.height=i.height,o.image.data=i.data),o.wrapS=void 0!==i.wrapS?i.wrapS:em,o.wrapT=void 0!==i.wrapT?i.wrapT:em,o.magFilter=void 0!==i.magFilter?i.magFilter:ev,o.minFilter=void 0!==i.minFilter?i.minFilter:ev,o.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.encoding&&(o.encoding=i.encoding),void 0!==i.flipY&&(o.flipY=i.flipY),void 0!==i.format&&(o.format=i.format),void 0!==i.type&&(o.type=i.type),void 0!==i.mipmaps&&(o.mipmaps=i.mipmaps,o.minFilter=eP),1===i.mipmapCount&&(o.minFilter=ev),void 0!==i.generateMipmaps&&(o.generateMipmaps=i.generateMipmaps),o.needsUpdate=!0,t&&t(o,i))},i,r),o}}class u2 extends uX{constructor(e){super(e)}load(e,t,i,r){let n=new iN,o=new u$(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(e){n.image=e,n.needsUpdate=!0,void 0!==t&&t(n)},i,r),n}}class u3 extends rH{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new iB(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}class u5 extends u3{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(rH.DefaultUp),this.updateMatrix(),this.groundColor=new iB(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}let u6=new rw,u9=new iQ,u8=new iQ;class u7{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new iv(512,512),this.map=null,this.mapPass=null,this.matrix=new rw,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new n5,this._frameExtents=new iv(1,1),this._viewportCount=1,this._viewports=[new iG(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,i=this.matrix;u9.setFromMatrixPosition(e.matrixWorld),t.position.copy(u9),u8.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(u8),t.updateMatrixWorld(),u6.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(u6),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class pe extends u7{constructor(){super(new nq(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let t=this.camera,i=2*io*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;(i!==t.fov||r!==t.aspect||n!==t.far)&&(t.fov=i,t.aspect=r,t.far=n,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class pt extends u3{constructor(e,t,i=0,r=Math.PI/3,n=0,o=1){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(rH.DefaultUp),this.updateMatrix(),this.target=new rH,this.distance=i,this.angle=r,this.penumbra=n,this.decay=o,this.map=null,this.shadow=new pe}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}let pi=new rw,pr=new iQ,pn=new iQ;class po extends u7{constructor(){super(new nq(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new iv(4,2),this._viewportCount=6,this._viewports=[new iG(2,1,1,1),new iG(0,1,1,1),new iG(3,1,1,1),new iG(1,1,1,1),new iG(3,0,1,1),new iG(1,0,1,1)],this._cubeDirections=[new iQ(1,0,0),new iQ(-1,0,0),new iQ(0,0,1),new iQ(0,0,-1),new iQ(0,1,0),new iQ(0,-1,0)],this._cubeUps=[new iQ(0,1,0),new iQ(0,1,0),new iQ(0,1,0),new iQ(0,1,0),new iQ(0,0,1),new iQ(0,0,-1)]}updateMatrices(e,t=0){let i=this.camera,r=this.matrix,n=e.distance||i.far;n!==i.far&&(i.far=n,i.updateProjectionMatrix()),pr.setFromMatrixPosition(e.matrixWorld),i.position.copy(pr),pn.copy(i.position),pn.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(pn),i.updateMatrixWorld(),r.makeTranslation(-pr.x,-pr.y,-pr.z),pi.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(pi)}}class pa extends u3{constructor(e,t,i=0,r=1){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new po}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class ps extends u7{constructor(){super(new sb(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class pl extends u3{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(rH.DefaultUp),this.updateMatrix(),this.target=new rH,this.shadow=new ps}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class ph extends u3{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class pc extends u3{constructor(e,t,i=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){let t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class pd{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new iQ)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){let i=e.x,r=e.y,n=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*n),t.addScaledVector(o[3],.488603*i),t.addScaledVector(o[4],1.092548*(i*r)),t.addScaledVector(o[5],1.092548*(r*n)),t.addScaledVector(o[6],.315392*(3*n*n-1)),t.addScaledVector(o[7],1.092548*(i*n)),t.addScaledVector(o[8],.546274*(i*i-r*r)),t}getIrradianceAt(e,t){let i=e.x,r=e.y,n=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],1.023328*r),t.addScaledVector(o[2],1.023328*n),t.addScaledVector(o[3],1.023328*i),t.addScaledVector(o[4],.858086*i*r),t.addScaledVector(o[5],.858086*r*n),t.addScaledVector(o[6],.743125*n*n-.247708),t.addScaledVector(o[7],.858086*i*n),t.addScaledVector(o[8],.429043*(i*i-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){let i=this.coefficients;for(let r=0;r<9;r++)i[r].fromArray(e,t+3*r);return this}toArray(e=[],t=0){let i=this.coefficients;for(let r=0;r<9;r++)i[r].toArray(e,t+3*r);return e}static getBasisAt(e,t){let i=e.x,r=e.y,n=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*n,t[3]=.488603*i,t[4]=1.092548*i*r,t[5]=1.092548*r*n,t[6]=.315392*(3*n*n-1),t[7]=1.092548*i*n,t[8]=.546274*(i*i-r*r)}}class pu extends u3{constructor(e=new pd,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){let t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class pp extends uX{constructor(e){super(e),this.textures={}}load(e,t,i,r){let n=this,o=new uZ(n.manager);o.setPath(n.path),o.setRequestHeader(n.requestHeader),o.setWithCredentials(n.withCredentials),o.load(e,function(i){try{t(n.parse(JSON.parse(i)))}catch(t){r?r(t):console.error(t),n.manager.itemError(e)}},i,r)}parse(e){let t=this.textures;function i(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}let r=pp.createMaterialFromType(e.type);if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=e.sheen),void 0!==e.sheenColor&&(r.sheenColor=new iB().setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(r.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.specularIntensity&&(r.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==r.specularColor&&r.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.iridescence&&(r.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(r.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.thickness&&(r.thickness=e.thickness),void 0!==e.attenuationDistance&&(r.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==r.attenuationColor&&r.attenuationColor.setHex(e.attenuationColor),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.shadowSide&&(r.shadowSide=e.shadowSide),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.alphaToCoverage&&(r.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(r.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(let t in e.uniforms){let n=e.uniforms[t];switch(r.uniforms[t]={},n.type){case"t":r.uniforms[t].value=i(n.value);break;case"c":r.uniforms[t].value=new iB().setHex(n.value);break;case"v2":r.uniforms[t].value=new iv().fromArray(n.value);break;case"v3":r.uniforms[t].value=new iQ().fromArray(n.value);break;case"v4":r.uniforms[t].value=new iG().fromArray(n.value);break;case"m3":r.uniforms[t].value=new iM().fromArray(n.value);break;case"m4":r.uniforms[t].value=new rw().fromArray(n.value);break;default:r.uniforms[t].value=n.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(r.glslVersion=e.glslVersion),void 0!==e.extensions)for(let t in e.extensions)r.extensions[t]=e.extensions[t];if(void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=i(e.map)),void 0!==e.matcap&&(r.matcap=i(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=i(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=i(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=i(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),r.normalScale=new iv().fromArray(t)}return void 0!==e.displacementMap&&(r.displacementMap=i(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=i(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=i(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=i(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=i(e.specularMap)),void 0!==e.specularIntensityMap&&(r.specularIntensityMap=i(e.specularIntensityMap)),void 0!==e.specularColorMap&&(r.specularColorMap=i(e.specularColorMap)),void 0!==e.envMap&&(r.envMap=i(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=i(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=i(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=i(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=i(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=i(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=new iv().fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(r.iridescenceMap=i(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(r.iridescenceThicknessMap=i(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(r.transmissionMap=i(e.transmissionMap)),void 0!==e.thicknessMap&&(r.thicknessMap=i(e.thicknessMap)),void 0!==e.sheenColorMap&&(r.sheenColorMap=i(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(r.sheenRoughnessMap=i(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){let t={ShadowMaterial:uc,SpriteMaterial:hY,RawShaderMaterial:ud,ShaderMaterial:nH,PointsMaterial:cL,MeshPhysicalMaterial:up,MeshStandardMaterial:uu,MeshPhongMaterial:um,MeshToonMaterial:uf,MeshNormalMaterial:ug,MeshLambertMaterial:uy,MeshDepthMaterial:hS,MeshDistanceMaterial:hP,MeshBasicMaterial:r4,MeshMatcapMaterial:ux,LineDashedMaterial:uw,LineBasicMaterial:cb,Material:r3};return new t[e]}}class pm{static decodeText(e){if("undefined"!=typeof TextDecoder)return new TextDecoder().decode(e);let t="";for(let i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){let t=e.lastIndexOf("/");return -1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e))?e:t+e}}class pf extends ng{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){let e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class pg extends uX{constructor(e){super(e)}load(e,t,i,r){let n=this,o=new uZ(n.manager);o.setPath(n.path),o.setRequestHeader(n.requestHeader),o.setWithCredentials(n.withCredentials),o.load(e,function(i){try{t(n.parse(JSON.parse(i)))}catch(t){r?r(t):console.error(t),n.manager.itemError(e)}},i,r)}parse(e){let t={},i={};function r(e,i){if(void 0!==t[i])return t[i];let r=e.interleavedBuffers,o=r[i],a=n(e,o.buffer),s=iT(o.type,a),l=new hj(s,o.stride);return l.uuid=o.uuid,t[i]=l,l}function n(e,t){if(void 0!==i[t])return i[t];let r=e.arrayBuffers,n=r[t],o=new Uint32Array(n).buffer;return i[t]=o,o}let o=e.isInstancedBufferGeometry?new pf:new ng,a=e.data.index;if(void 0!==a){let e=iT(a.type,a.array);o.setIndex(new r8(e,1))}let s=e.data.attributes;for(let t in s){let i;let n=s[t];if(n.isInterleavedBufferAttribute){let t=r(e.data,n.data);i=new hX(t,n.itemSize,n.offset,n.normalized)}else{let e=iT(n.type,n.array),t=n.isInstancedBufferAttribute?cm:r8;i=new t(e,n.itemSize,n.normalized)}void 0!==n.name&&(i.name=n.name),void 0!==n.usage&&i.setUsage(n.usage),void 0!==n.updateRange&&(i.updateRange.offset=n.updateRange.offset,i.updateRange.count=n.updateRange.count),o.setAttribute(t,i)}let l=e.data.morphAttributes;if(l)for(let t in l){let i=l[t],n=[];for(let t=0,o=i.length;t<o;t++){let o;let a=i[t];if(a.isInterleavedBufferAttribute){let t=r(e.data,a.data);o=new hX(t,a.itemSize,a.offset,a.normalized)}else{let e=iT(a.type,a.array);o=new r8(e,a.itemSize,a.normalized)}void 0!==a.name&&(o.name=a.name),n.push(o)}o.morphAttributes[t]=n}let h=e.data.morphTargetsRelative;h&&(o.morphTargetsRelative=!0);let c=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==c)for(let e=0,t=c.length;e!==t;++e){let t=c[e];o.addGroup(t.start,t.count,t.materialIndex)}let d=e.data.boundingSphere;if(void 0!==d){let e=new iQ;void 0!==d.center&&e.fromArray(d.center),o.boundingSphere=new rc(e,d.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class py extends uX{constructor(e){super(e)}load(e,t,i,r){let n=this,o=""===this.path?pm.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;let a=new uZ(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(i){let o=null;try{o=JSON.parse(i)}catch(t){void 0!==r&&r(t),console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message);return}let a=o.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase()){console.error("THREE.ObjectLoader: Can't load "+e);return}n.parse(o,t)},i,r)}async loadAsync(e,t){let i=this,r=""===this.path?pm.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;let n=new uZ(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials);let o=await n.loadAsync(e,t),a=JSON.parse(o),s=a.metadata;if(void 0===s||void 0===s.type||"geometry"===s.type.toLowerCase())throw Error("THREE.ObjectLoader: Can't load "+e);return await i.parseAsync(a)}parse(e,t){let i=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),n=this.parseGeometries(e.geometries,r),o=this.parseImages(e.images,function(){void 0!==t&&t(l)}),a=this.parseTextures(e.textures,o),s=this.parseMaterials(e.materials,a),l=this.parseObject(e.object,n,s,a,i),h=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,h),void 0!==t){let e=!1;for(let t in o)if(o[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){let t=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),n=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,n),a=this.parseMaterials(e.materials,o),s=this.parseObject(e.object,r,a,o,t),l=this.parseSkeletons(e.skeletons,s);return this.bindSkeletons(s,l),s}parseShapes(e){let t={};if(void 0!==e)for(let i=0,r=e.length;i<r;i++){let r=new dv().fromJSON(e[i]);t[r.uuid]=r}return t}parseSkeletons(e,t){let i={},r={};if(t.traverse(function(e){e.isBone&&(r[e.uuid]=e)}),void 0!==e)for(let t=0,n=e.length;t<n;t++){let n=new cp().fromJSON(e[t],r);i[n.uuid]=n}return i}parseGeometries(e,t){let i={};if(void 0!==e){let r=new pg;for(let n=0,o=e.length;n<o;n++){let o;let a=e[n];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":o=r.parse(a);break;default:a.type in uh?o=uh[a.type].fromJSON(a,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${a.type}"`)}o.uuid=a.uuid,void 0!==a.name&&(o.name=a.name),!0===o.isBufferGeometry&&void 0!==a.userData&&(o.userData=a.userData),i[a.uuid]=o}}return i}parseMaterials(e,t){let i={},r={};if(void 0!==e){let n=new pp;n.setTextures(t);for(let t=0,o=e.length;t<o;t++){let o=e[t];void 0===i[o.uuid]&&(i[o.uuid]=n.parse(o)),r[o.uuid]=i[o.uuid]}}return r}parseAnimations(e){let t={};if(void 0!==e)for(let i=0;i<e.length;i++){let r=e[i],n=uU.parse(r);t[n.uuid]=n}return t}parseImages(e,t){let i;let r=this,n={};function o(e){return r.manager.itemStart(e),i.load(e,function(){r.manager.itemEnd(e)},void 0,function(){r.manager.itemError(e),r.manager.itemEnd(e)})}function a(e){if("string"==typeof e){let t=e,i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:r.resourcePath+t;return o(i)}return e.data?{data:iT(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){let r=new uj(t);(i=new u$(r)).setCrossOrigin(this.crossOrigin);for(let t=0,i=e.length;t<i;t++){let i=e[t],r=i.url;if(Array.isArray(r)){let e=[];for(let t=0,i=r.length;t<i;t++){let i=r[t],n=a(i);null!==n&&(n instanceof HTMLImageElement?e.push(n):e.push(new cc(n.data,n.width,n.height)))}n[i.uuid]=new iF(e)}else{let e=a(i.url);n[i.uuid]=new iF(e)}}}return n}async parseImagesAsync(e){let t;let i=this,r={};async function n(e){if("string"==typeof e){let r=e,n=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(r)?r:i.resourcePath+r;return await t.loadAsync(n)}return e.data?{data:iT(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){(t=new u$(this.manager)).setCrossOrigin(this.crossOrigin);for(let t=0,i=e.length;t<i;t++){let i=e[t],o=i.url;if(Array.isArray(o)){let e=[];for(let t=0,i=o.length;t<i;t++){let i=o[t],r=await n(i);null!==r&&(r instanceof HTMLImageElement?e.push(r):e.push(new cc(r.data,r.width,r.height)))}r[i.uuid]=new iF(e)}else{let e=await n(i.url);r[i.uuid]=new iF(e)}}}return r}parseTextures(e,t){function i(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}let r={};if(void 0!==e)for(let n=0,o=e.length;n<o;n++){let o;let a=e[n];void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===t[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);let s=t[a.image],l=s.data;Array.isArray(l)?(o=new nZ,6===l.length&&(o.needsUpdate=!0)):(o=l&&l.data?new cc:new iN,l&&(o.needsUpdate=!0)),o.source=s,o.uuid=a.uuid,void 0!==a.name&&(o.name=a.name),void 0!==a.mapping&&(o.mapping=i(a.mapping,px)),void 0!==a.offset&&o.offset.fromArray(a.offset),void 0!==a.repeat&&o.repeat.fromArray(a.repeat),void 0!==a.center&&o.center.fromArray(a.center),void 0!==a.rotation&&(o.rotation=a.rotation),void 0!==a.wrap&&(o.wrapS=i(a.wrap[0],pw),o.wrapT=i(a.wrap[1],pw)),void 0!==a.format&&(o.format=a.format),void 0!==a.type&&(o.type=a.type),void 0!==a.encoding&&(o.encoding=a.encoding),void 0!==a.minFilter&&(o.minFilter=i(a.minFilter,pb)),void 0!==a.magFilter&&(o.magFilter=i(a.magFilter,pb)),void 0!==a.anisotropy&&(o.anisotropy=a.anisotropy),void 0!==a.flipY&&(o.flipY=a.flipY),void 0!==a.premultiplyAlpha&&(o.premultiplyAlpha=a.premultiplyAlpha),void 0!==a.unpackAlignment&&(o.unpackAlignment=a.unpackAlignment),void 0!==a.userData&&(o.userData=a.userData),r[a.uuid]=o}return r}parseObject(e,t,i,r,n){let o,a,s;function l(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function h(e){if(void 0!==e){if(Array.isArray(e)){let t=[];for(let r=0,n=e.length;r<n;r++){let n=e[r];void 0===i[n]&&console.warn("THREE.ObjectLoader: Undefined material",n),t.push(i[n])}return t}return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),i[e]}}function c(e){return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),r[e]}switch(e.type){case"Scene":o=new hH,void 0!==e.background&&(Number.isInteger(e.background)?o.background=new iB(e.background):o.background=c(e.background)),void 0!==e.environment&&(o.environment=c(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?o.fog=new hG(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(o.fog=new hN(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":o=new nq(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(o.focus=e.focus),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.filmGauge&&(o.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(o.filmOffset=e.filmOffset),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new sb(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new ph(e.color,e.intensity);break;case"DirectionalLight":o=new pl(e.color,e.intensity);break;case"PointLight":o=new pa(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new pc(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new pt(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new u5(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=new pu().fromJSON(e);break;case"SkinnedMesh":a=l(e.geometry),s=h(e.material),o=new cl(a,s),void 0!==e.bindMode&&(o.bindMode=e.bindMode),void 0!==e.bindMatrix&&o.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(o.skeleton=e.skeleton);break;case"Mesh":a=l(e.geometry),s=h(e.material),o=new nW(a,s);break;case"InstancedMesh":a=l(e.geometry),s=h(e.material);let d=e.count,u=e.instanceMatrix,p=e.instanceColor;(o=new cw(a,s,d)).instanceMatrix=new cm(new Float32Array(u.array),16),void 0!==p&&(o.instanceColor=new cm(new Float32Array(p.array),p.itemSize));break;case"LOD":o=new ci;break;case"Line":o=new c_(l(e.geometry),h(e.material));break;case"LineLoop":o=new cE(l(e.geometry),h(e.material));break;case"LineSegments":o=new cA(l(e.geometry),h(e.material));break;case"PointCloud":case"Points":o=new ck(l(e.geometry),h(e.material));break;case"Sprite":o=new h8(h(e.material));break;case"Group":o=new hI;break;case"Bone":o=new ch;break;default:o=new rH}if(o.uuid=e.uuid,void 0!==e.name&&(o.name=e.name),void 0!==e.matrix?(o.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(void 0!==e.position&&o.position.fromArray(e.position),void 0!==e.rotation&&o.rotation.fromArray(e.rotation),void 0!==e.quaternion&&o.quaternion.fromArray(e.quaternion),void 0!==e.scale&&o.scale.fromArray(e.scale)),void 0!==e.castShadow&&(o.castShadow=e.castShadow),void 0!==e.receiveShadow&&(o.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(o.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(o.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(o.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&o.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(o.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(o.visible=e.visible),void 0!==e.frustumCulled&&(o.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(o.renderOrder=e.renderOrder),void 0!==e.userData&&(o.userData=e.userData),void 0!==e.layers&&(o.layers.mask=e.layers),void 0!==e.children){let a=e.children;for(let e=0;e<a.length;e++)o.add(this.parseObject(a[e],t,i,r,n))}if(void 0!==e.animations){let t=e.animations;for(let e=0;e<t.length;e++){let i=t[e];o.animations.push(n[i])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(o.autoUpdate=e.autoUpdate);let t=e.levels;for(let e=0;e<t.length;e++){let i=t[e],r=o.getObjectByProperty("uuid",i.object);void 0!==r&&o.addLevel(r,i.distance)}}return o}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse(function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){let i=t[e.skeleton];void 0===i?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(i,e.bindMatrix)}})}}let px={UVMapping:es,CubeReflectionMapping:el,CubeRefractionMapping:eh,EquirectangularReflectionMapping:ec,EquirectangularRefractionMapping:ed,CubeUVReflectionMapping:eu},pw={RepeatWrapping:ep,ClampToEdgeWrapping:em,MirroredRepeatWrapping:ef},pb={NearestFilter:eg,NearestMipmapNearestFilter:ey,NearestMipmapLinearFilter:ew,LinearFilter:ev,LinearMipmapNearestFilter:eM,LinearMipmapLinearFilter:eP};class pv extends uX{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let n=this,o=uH.get(e);if(void 0!==o)return n.manager.itemStart(e),setTimeout(function(){t&&t(o),n.manager.itemEnd(e)},0),o;let a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(n.options,{colorSpaceConversion:"none"}))}).then(function(i){uH.add(e,i),t&&t(i),n.manager.itemEnd(e)}).catch(function(t){r&&r(t),n.manager.itemError(e),n.manager.itemEnd(e)}),n.manager.itemStart(e)}}let pM={getContext:function(){return void 0===n&&(n=new(window.AudioContext||window.webkitAudioContext)),n},setContext:function(e){n=e}};class pS extends uX{constructor(e){super(e)}load(e,t,i,r){let n=this,o=new uZ(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(i){try{let e=i.slice(0),r=pM.getContext();r.decodeAudioData(e,function(e){t(e)})}catch(t){r?r(t):console.error(t),n.manager.itemError(e)}},i,r)}}class pP extends pu{constructor(e,t,i=1){super(void 0,i),this.isHemisphereLightProbe=!0;let r=new iB().set(e),n=new iB().set(t),o=new iQ(r.r,r.g,r.b),a=new iQ(n.r,n.g,n.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(s),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(l)}}class pT extends pu{constructor(e,t=1){super(void 0,t),this.isAmbientLightProbe=!0;let i=new iB().set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}let p_=new rw,pC=new rw,pD=new rw;class pA{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new nq,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new nq,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){let t=this._cache,i=t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep;if(i){let i,r;t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,pD.copy(e.projectionMatrix);let n=t.eyeSep/2,o=n*t.near/t.focus,a=t.near*Math.tan(ir*t.fov*.5)/t.zoom;pC.elements[12]=-n,p_.elements[12]=n,i=-a*t.aspect+o,r=a*t.aspect+o,pD.elements[0]=2*t.near/(r-i),pD.elements[8]=(r+i)/(r-i),this.cameraL.projectionMatrix.copy(pD),i=-a*t.aspect-o,r=a*t.aspect-o,pD.elements[0]=2*t.near/(r-i),pD.elements[8]=(r+i)/(r-i),this.cameraR.projectionMatrix.copy(pD)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(pC),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(p_)}}class pE{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=pL(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=pL();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function pL(){return("undefined"==typeof performance?Date:performance).now()}let pI=new iQ,pR=new iZ,pW=new iQ,pV=new iQ;class pk extends rH{constructor(){super(),this.type="AudioListener",this.context=pM.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new pE}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);let t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(pI,pR,pW),pV.set(0,0,-1).applyQuaternion(pR),t.positionX){let e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(pI.x,e),t.positionY.linearRampToValueAtTime(pI.y,e),t.positionZ.linearRampToValueAtTime(pI.z,e),t.forwardX.linearRampToValueAtTime(pV.x,e),t.forwardY.linearRampToValueAtTime(pV.y,e),t.forwardZ.linearRampToValueAtTime(pV.z,e),t.upX.linearRampToValueAtTime(i.x,e),t.upY.linearRampToValueAtTime(i.y,e),t.upZ.linearRampToValueAtTime(i.z,e)}else t.setPosition(pI.x,pI.y,pI.z),t.setOrientation(pV.x,pV.y,pV.z,i.x,i.y,i.z)}}class pB extends rH{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying){console.warn("THREE.Audio: Audio is already playing.");return}if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;let t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}let pO=new iQ,pF=new iZ,pz=new iQ,pU=new iQ;class pN extends pB{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(pO,pF,pz),pU.set(0,0,1).applyQuaternion(pF);let t=this.panner;if(t.positionX){let e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(pO.x,e),t.positionY.linearRampToValueAtTime(pO.y,e),t.positionZ.linearRampToValueAtTime(pO.z,e),t.orientationX.linearRampToValueAtTime(pU.x,e),t.orientationY.linearRampToValueAtTime(pU.y,e),t.orientationZ.linearRampToValueAtTime(pU.z,e)}else t.setPosition(pO.x,pO.y,pO.z),t.setOrientation(pU.x,pU.y,pU.z)}}class pG{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0,t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}}class pH{constructor(e,t,i){let r,n,o;switch(this.binding=e,this.valueSize=i,t){case"quaternion":r=this._slerp,n=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":r=this._select,n=this._select,o=this._setAdditiveIdentityOther,this.buffer=Array(5*i);break;default:r=this._lerp,n=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=n,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let i=this.buffer,r=this.valueSize,n=e*r+r,o=this.cumulativeWeight;if(0===o){for(let e=0;e!==r;++e)i[n+e]=i[e];o=t}else{o+=t;let e=t/o;this._mixBufferRegion(i,n,0,e,r)}this.cumulativeWeight=o}accumulateAdditive(e){let t=this.buffer,i=this.valueSize,r=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,i=this.buffer,r=e*t+t,n=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,n<1){let e=t*this._origIndex;this._mixBufferRegion(i,r,e,1-n,t)}o>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(let e=t,n=t+t;e!==n;++e)if(i[e]!==i[e+t]){a.setValue(i,r);break}}saveOriginalState(){let e=this.binding,t=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(t,r);for(let e=i,n=r;e!==n;++e)t[e]=t[r+e%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,r,n){if(r>=.5)for(let r=0;r!==n;++r)e[t+r]=e[i+r]}_slerp(e,t,i,r){iZ.slerpFlat(e,t,e,t,e,i,r)}_slerpAdditive(e,t,i,r,n){let o=this._workIndex*n;iZ.multiplyQuaternionsFlat(e,o,e,t,e,i),iZ.slerpFlat(e,t,e,t,e,o,r)}_lerp(e,t,i,r,n){let o=1-r;for(let a=0;a!==n;++a){let n=t+a;e[n]=e[n]*o+e[i+a]*r}}_lerpAdditive(e,t,i,r,n){for(let o=0;o!==n;++o){let n=t+o;e[n]=e[n]+e[i+o]*r}}}let pj="\\[\\]\\.:\\/",pq=RegExp("["+pj+"]","g"),pX="[^"+pj+"]",pY="[^"+pj.replace("\\.","")+"]",pJ=/((?:WC+[\/:])*)/.source.replace("WC",pX),pZ=/(WCOD+)?/.source.replace("WCOD",pY),pQ=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",pX),pK=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",pX),p$=RegExp("^"+pJ+pZ+pQ+pK+"$"),p0=["material","materials","bones","map"];class p1{constructor(e,t,i){let r=i||p2.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();let i=this._targetGroup.nCachedObjects_,r=this._bindings[i];void 0!==r&&r.getValue(e,t)}setValue(e,t){let i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class p2{constructor(e,t,i){this.path=t,this.parsedPath=i||p2.parseTrackName(t),this.node=p2.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new p2.Composite(e,t,i):new p2(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(pq,"")}static parseTrackName(e){let t=p$.exec(e);if(null===t)throw Error("PropertyBinding: Cannot parse trackName: "+e);let i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){let e=i.nodeName.substring(r+1);-1!==p0.indexOf(e)&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=e)}if(null===i.propertyName||0===i.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){let i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){let i=function(e){for(let r=0;r<e.length;r++){let n=e[r];if(n.name===t||n.uuid===t)return n;let o=i(n.children);if(o)return o}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)e[t++]=i[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,i=t.objectName,r=t.propertyName,n=t.propertyIndex;if(e||(e=p2.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let r=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;case"map":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(void 0===e[i]){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(void 0!==r){if(void 0===e[r]){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[r]}}let o=e[r];if(void 0===o){let i=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+r+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==n){if("morphTargetInfluences"===r){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}void 0!==e.morphTargetDictionary[n]&&(n=e.morphTargetDictionary[n])}s=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=n}else void 0!==o.fromArray&&void 0!==o.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(s=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}p2.Composite=p1,p2.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},p2.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},p2.prototype.GetterByBindingType=[p2.prototype._getValue_direct,p2.prototype._getValue_array,p2.prototype._getValue_arrayElement,p2.prototype._getValue_toArray],p2.prototype.SetterByBindingTypeAndVersioning=[[p2.prototype._setValue_direct,p2.prototype._setValue_direct_setNeedsUpdate,p2.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[p2.prototype._setValue_array,p2.prototype._setValue_array_setNeedsUpdate,p2.prototype._setValue_array_setMatrixWorldNeedsUpdate],[p2.prototype._setValue_arrayElement,p2.prototype._setValue_arrayElement_setNeedsUpdate,p2.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[p2.prototype._setValue_fromArray,p2.prototype._setValue_fromArray_setNeedsUpdate,p2.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class p3{constructor(){this.isAnimationObjectGroup=!0,this.uuid=ia(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;let e={};this._indicesByUUID=e;for(let t=0,i=arguments.length;t!==i;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};let t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){let e=this._objects,t=this._indicesByUUID,i=this._paths,r=this._parsedPaths,n=this._bindings,o=n.length,a,s=e.length,l=this.nCachedObjects_;for(let h=0,c=arguments.length;h!==c;++h){let c=arguments[h],d=c.uuid,u=t[d];if(void 0===u){u=s++,t[d]=u,e.push(c);for(let e=0,t=o;e!==t;++e)n[e].push(new p2(c,i[e],r[e]))}else if(u<l){a=e[u];let s=--l,h=e[s];t[h.uuid]=u,e[u]=h,t[d]=s,e[s]=c;for(let e=0,t=o;e!==t;++e){let t=n[e],o=t[s],a=t[u];t[u]=o,void 0===a&&(a=new p2(c,i[e],r[e])),t[s]=a}}else e[u]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){let e=this._objects,t=this._indicesByUUID,i=this._bindings,r=i.length,n=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){let a=arguments[o],s=a.uuid,l=t[s];if(void 0!==l&&l>=n){let o=n++,h=e[o];t[h.uuid]=l,e[l]=h,t[s]=o,e[o]=a;for(let e=0,t=r;e!==t;++e){let t=i[e],r=t[o],n=t[l];t[l]=r,t[o]=n}}}this.nCachedObjects_=n}uncache(){let e=this._objects,t=this._indicesByUUID,i=this._bindings,r=i.length,n=this.nCachedObjects_,o=e.length;for(let a=0,s=arguments.length;a!==s;++a){let s=arguments[a],l=s.uuid,h=t[l];if(void 0!==h){if(delete t[l],h<n){let a=--n,s=e[a],l=--o,c=e[l];t[s.uuid]=h,e[h]=s,t[c.uuid]=a,e[a]=c,e.pop();for(let e=0,t=r;e!==t;++e){let t=i[e],r=t[a],n=t[l];t[h]=r,t[a]=n,t.pop()}}else{let n=--o,a=e[n];n>0&&(t[a.uuid]=h),e[h]=a,e.pop();for(let e=0,t=r;e!==t;++e){let t=i[e];t[h]=t[n],t.pop()}}}}this.nCachedObjects_=n}subscribe_(e,t){let i=this._bindingsIndicesByPath,r=i[e],n=this._bindings;if(void 0!==r)return n[r];let o=this._paths,a=this._parsedPaths,s=this._objects,l=s.length,h=this.nCachedObjects_,c=Array(l);r=n.length,i[e]=r,o.push(e),a.push(t),n.push(c);for(let i=h,r=s.length;i!==r;++i){let r=s[i];c[i]=new p2(r,e,t)}return c}unsubscribe_(e){let t=this._bindingsIndicesByPath,i=t[e];if(void 0!==i){let r=this._paths,n=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a],l=e[a];t[l]=i,o[i]=s,o.pop(),n[i]=n[a],n.pop(),r[i]=r[a],r.pop()}}}class p4{constructor(e,t,i=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=r;let n=t.tracks,o=n.length,a=Array(o),s={endingStart:tx,endingEnd:tx};for(let e=0;e!==o;++e){let t=n[e].createInterpolant(null);a[e]=t,t.settings=s}this._interpolantSettings=s,this._interpolants=a,this._propertyBindings=Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=tp,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){let i=this._clip.duration,r=e._clip.duration,n=r/i,o=i/r;e.warp(1,n,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){let e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){let r=this._mixer,n=r.time,o=this.timeScale,a=this._timeScaleInterpolant;null===a&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);let s=a.parameterPositions,l=a.sampleValues;return s[0]=n,s[1]=n+i,l[0]=e/o,l[1]=t/o,this}stopWarping(){let e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,r){if(!this.enabled){this._updateWeight(e);return}let n=this._startTime;if(null!==n){let r=(e-n)*i;r<0||0===i?t=0:(this._startTime=null,t=i*r)}t*=this._updateTimeScale(e);let o=this._updateTime(t),a=this._updateWeight(e);if(a>0){let e=this._interpolants,t=this._propertyBindings;if(this.blendMode===tM)for(let i=0,r=e.length;i!==r;++i)e[i].evaluate(o),t[i].accumulateAdditive(a);else for(let i=0,n=e.length;i!==n;++i)e[i].evaluate(o),t[i].accumulate(r,a)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let i=this._weightInterpolant;if(null!==i){let r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let i=this._timeScaleInterpolant;if(null!==i){let r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,i=this.loop,r=this.time+e,n=this._loopCount,o=i===tm;if(0===e)return -1===n?r:o&&(1&n)==1?t-r:r;if(i===tu){-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1));n:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break n}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===n&&(e>=0?(n=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r>=t||r<0){let i=Math.floor(r/t);r-=t*i,n+=Math.abs(i);let a=this.repetitions-n;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){let t=e<0;this._setEndings(t,!t,o)}else this._setEndings(!1,!1,o);this._loopCount=n,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=r;if(o&&(1&n)==1)return t-r}return r}_setEndings(e,t,i){let r=this._interpolantSettings;i?(r.endingStart=tw,r.endingEnd=tw):(e?r.endingStart=this.zeroSlopeAtStart?tw:tx:r.endingStart=tb,t?r.endingEnd=this.zeroSlopeAtEnd?tw:tx:r.endingEnd=tb)}_scheduleFading(e,t,i){let r=this._mixer,n=r.time,o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);let a=o.parameterPositions,s=o.sampleValues;return a[0]=n,s[0]=t,a[1]=n+e,s[1]=i,this}}let p5=new Float32Array(1);class p6 extends ie{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let i=e._localRoot||this._root,r=e._clip.tracks,n=r.length,o=e._propertyBindings,a=e._interpolants,s=i.uuid,l=this._bindingsByRootAndName,h=l[s];void 0===h&&(h={},l[s]=h);for(let e=0;e!==n;++e){let n=r[e],l=n.name,c=h[l];if(void 0!==c)++c.referenceCount,o[e]=c;else{if(void 0!==(c=o[e])){null===c._cacheIndex&&(++c.referenceCount,this._addInactiveBinding(c,s,l));continue}let r=t&&t._propertyBindings[e].binding.parsedPath;c=new pH(p2.create(i,l,r),n.ValueTypeName,n.getValueSize()),++c.referenceCount,this._addInactiveBinding(c,s,l),o[e]=c}a[e].resultBuffer=c.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){let t=(e._localRoot||this._root).uuid,i=e._clip.uuid,r=this._actionsByClip[i];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,i,t)}let t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){let i=t[e];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){let i=t[e];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,i){let r=this._actions,n=this._actionsByClip,o=n[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=o;else{let t=o.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[i]=e}_removeInactiveAction(e){let t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;let n=e._clip.uuid,o=this._actionsByClip,a=o[n],s=a.knownActions,l=s[s.length-1],h=e._byClipCacheIndex;l._byClipCacheIndex=h,s[h]=l,s.pop(),e._byClipCacheIndex=null;let c=(e._localRoot||this._root).uuid;delete a.actionByRoot[c],0===s.length&&delete o[n],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){let i=t[e];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(e){let t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_takeBackAction(e){let t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_addInactiveBinding(e,t,i){let r=this._bindingsByRootAndName,n=this._bindings,o=r[t];void 0===o&&(o={},r[t]=o),o[i]=e,e._cacheIndex=n.length,n.push(e)}_removeInactiveBinding(e){let t=this._bindings,i=e.binding,r=i.rootNode.uuid,n=i.path,o=this._bindingsByRootAndName,a=o[r],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete a[n],0===Object.keys(a).length&&delete o[r]}_lendBinding(e){let t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_takeBackBinding(e){let t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return void 0===i&&((i=new uL(new Float32Array(2),new Float32Array(2),1,p5)).__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){let t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,n=t[r];e.__cacheIndex=r,t[r]=e,n.__cacheIndex=i,t[i]=n}clipAction(e,t,i){let r=t||this._root,n=r.uuid,o="string"==typeof e?uU.findByName(r,e):e,a=null!==o?o.uuid:e,s=this._actionsByClip[a],l=null;if(void 0===i&&(i=null!==o?o.blendMode:tv),void 0!==s){let e=s.actionByRoot[n];if(void 0!==e&&e.blendMode===i)return e;l=s.knownActions[0],null===o&&(o=l._clip)}if(null===o)return null;let h=new p4(this,o,t,i);return this._bindAction(h,l),this._addInactiveAction(h,a,n),h}existingAction(e,t){let i=t||this._root,r=i.uuid,n="string"==typeof e?uU.findByName(i,e):e,o=n?n.uuid:e,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[r]||null}stopAllAction(){let e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;let t=this._actions,i=this._nActiveActions,r=this.time+=e,n=Math.sign(e),o=this._accuIndex^=1;for(let a=0;a!==i;++a){let i=t[a];i._update(r,e,n,o)}let a=this._bindings,s=this._nActiveBindings;for(let e=0;e!==s;++e)a[e].apply(o);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,i=e.uuid,r=this._actionsByClip,n=r[i];if(void 0!==n){let e=n.knownActions;for(let i=0,r=e.length;i!==r;++i){let r=e[i];this._deactivateAction(r);let n=r._cacheIndex,o=t[t.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,o._cacheIndex=n,t[n]=o,t.pop(),this._removeInactiveBindingsForAction(r)}delete r[i]}}uncacheRoot(e){let t=e.uuid,i=this._actionsByClip;for(let e in i){let r=i[e].actionByRoot,n=r[t];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}let r=this._bindingsByRootAndName[t];if(void 0!==r)for(let e in r){let t=r[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){let i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class p9{constructor(e){this.value=e}clone(){return new p9(void 0===this.value.clone?this.value:this.value.clone())}}let p8=0;class p7 extends ie{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:p8++}),this.name="",this.usage=tQ,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){let t=this.uniforms.indexOf(e);return -1!==t&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;let t=e.uniforms;this.uniforms.length=0;for(let e=0,i=t.length;e<i;e++)this.uniforms.push(t[e].clone());return this}clone(){return new this.constructor().copy(this)}}class me extends hj{constructor(e,t,i=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){let t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){let t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class mt{constructor(e,t,i,r,n){this.isGLBufferAttribute=!0,this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=r,this.count=n,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class mi{constructor(e,t,i=0,r=1/0){this.ray=new rx(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new rE,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return mn(e,this,i,t),i.sort(mr),i}intersectObjects(e,t=!0,i=[]){for(let r=0,n=e.length;r<n;r++)mn(e[r],this,i,t);return i.sort(mr),i}}function mr(e,t){return e.distance-t.distance}function mn(e,t,i,r){if(e.layers.test(t.layers)&&e.raycast(t,i),!0===r){let r=e.children;for(let e=0,n=r.length;e<n;e++)mn(r[e],t,i,!0)}}class mo{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){let e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(is(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class ma{constructor(e=1,t=0,i=0){return this.radius=e,this.theta=t,this.y=i,this}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}clone(){return new this.constructor().copy(this)}}let ms=new iv;class ml{constructor(e=new iv(1/0,1/0),t=new iv(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=ms.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x)&&!(e.x>this.max.x)&&!(e.y<this.min.y)&&!(e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x)&&!(e.min.x>this.max.x)&&!(e.max.y<this.min.y)&&!(e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){let t=ms.copy(e).clamp(this.min,this.max);return t.sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}let mh=new iQ,mc=new iQ;class md{constructor(e=new iQ,t=new iQ){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){mh.subVectors(e,this.start),mc.subVectors(this.end,this.start);let i=mc.dot(mc),r=mc.dot(mh),n=r/i;return t&&(n=is(n,0,1)),n}closestPointToPoint(e,t,i){let r=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}let mu=new iQ;class mp extends rH{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;let i=new ng,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,i=32;e<i;e++,t++){let n=e/i*Math.PI*2,o=t/i*Math.PI*2;r.push(Math.cos(n),Math.sin(n),1,Math.cos(o),Math.sin(o),1)}i.setAttribute("position",new ns(r,3));let n=new cb({fog:!1,toneMapped:!1});this.cone=new cA(i,n),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();let e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),mu.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(mu),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}let mm=new iQ,mf=new rw,mg=new rw;class my extends cA{constructor(e){let t=mx(e),i=new ng,r=[],n=[],o=new iB(0,0,1),a=new iB(0,1,0);for(let e=0;e<t.length;e++){let i=t[e];i.parent&&i.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),n.push(o.r,o.g,o.b),n.push(a.r,a.g,a.b))}i.setAttribute("position",new ns(r,3)),i.setAttribute("color",new ns(n,3));let s=new cb({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,s),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){let t=this.bones,i=this.geometry,r=i.getAttribute("position");mg.copy(this.root.matrixWorld).invert();for(let e=0,i=0;e<t.length;e++){let n=t[e];n.parent&&n.parent.isBone&&(mf.multiplyMatrices(mg,n.matrixWorld),mm.setFromMatrixPosition(mf),r.setXYZ(i,mm.x,mm.y,mm.z),mf.multiplyMatrices(mg,n.parent.matrixWorld),mm.setFromMatrixPosition(mf),r.setXYZ(i+1,mm.x,mm.y,mm.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function mx(e){let t=[];!0===e.isBone&&t.push(e);for(let i=0;i<e.children.length;i++)t.push.apply(t,mx(e.children[i]));return t}class mw extends nW{constructor(e,t,i){let r=new ui(t,4,2),n=new r4({wireframe:!0,fog:!1,toneMapped:!1});super(r,n),this.light=e,this.light.updateMatrixWorld(),this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}let mb=new iQ,mv=new iB,mM=new iB;class mS extends rH{constructor(e,t,i){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;let r=new d9(t);r.rotateY(.5*Math.PI),this.material=new r4({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);let n=r.getAttribute("position"),o=new Float32Array(3*n.count);r.setAttribute("color",new r8(o,3)),this.add(new nW(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){let e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{let t=e.geometry.getAttribute("color");mv.copy(this.light.color),mM.copy(this.light.groundColor);for(let e=0,i=t.count;e<i;e++){let r=e<i/2?mv:mM;t.setXYZ(e,r.r,r.g,r.b)}t.needsUpdate=!0}e.lookAt(mb.setFromMatrixPosition(this.light.matrixWorld).negate())}}class mP extends cA{constructor(e=10,t=10,i=4473924,r=8947848){i=new iB(i),r=new iB(r);let n=t/2,o=e/t,a=e/2,s=[],l=[];for(let e=0,h=0,c=-a;e<=t;e++,c+=o){s.push(-a,0,c,a,0,c),s.push(c,0,-a,c,0,a);let t=e===n?i:r;t.toArray(l,h),h+=3,t.toArray(l,h),h+=3,t.toArray(l,h),h+=3,t.toArray(l,h),h+=3}let h=new ng;h.setAttribute("position",new ns(s,3)),h.setAttribute("color",new ns(l,3));let c=new cb({vertexColors:!0,toneMapped:!1});super(h,c),this.type="GridHelper"}}class mT extends cA{constructor(e=10,t=16,i=8,r=64,n=4473924,o=8947848){n=new iB(n),o=new iB(o);let a=[],s=[];if(t>1)for(let i=0;i<t;i++){let r=i/t*(2*Math.PI),l=Math.sin(r)*e,h=Math.cos(r)*e;a.push(0,0,0),a.push(l,0,h);let c=1&i?n:o;s.push(c.r,c.g,c.b),s.push(c.r,c.g,c.b)}for(let t=0;t<i;t++){let l=1&t?n:o,h=e-e/i*t;for(let e=0;e<r;e++){let t=e/r*(2*Math.PI),i=Math.sin(t)*h,n=Math.cos(t)*h;a.push(i,0,n),s.push(l.r,l.g,l.b),i=Math.sin(t=(e+1)/r*(2*Math.PI))*h,n=Math.cos(t)*h,a.push(i,0,n),s.push(l.r,l.g,l.b)}}let l=new ng;l.setAttribute("position",new ns(a,3)),l.setAttribute("color",new ns(s,3));let h=new cb({vertexColors:!0,toneMapped:!1});super(l,h),this.type="PolarGridHelper"}}let m_=new iQ,mC=new iQ,mD=new iQ;class mA extends rH{constructor(e,t,i){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===t&&(t=1);let r=new ng;r.setAttribute("position",new ns([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));let n=new cb({fog:!1,toneMapped:!1});this.lightPlane=new c_(r,n),this.add(this.lightPlane),(r=new ng).setAttribute("position",new ns([0,0,0,0,0,1],3)),this.targetLine=new c_(r,n),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){m_.setFromMatrixPosition(this.light.matrixWorld),mC.setFromMatrixPosition(this.light.target.matrixWorld),mD.subVectors(mC,m_),this.lightPlane.lookAt(mC),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(mC),this.targetLine.scale.z=mD.length()}}let mE=new iQ,mL=new nj;class mI extends cA{constructor(e){let t=new ng,i=new cb({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],o={};function a(e,t){s(e),s(t)}function s(e){r.push(0,0,0),n.push(0,0,0),void 0===o[e]&&(o[e]=[]),o[e].push(r.length/3-1)}a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4"),t.setAttribute("position",new ns(r,3)),t.setAttribute("color",new ns(n,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();let l=new iB(16755200),h=new iB(16711680),c=new iB(43775),d=new iB(16777215),u=new iB(3355443);this.setColors(l,h,c,d,u)}setColors(e,t,i,r,n){let o=this.geometry,a=o.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,i.r,i.g,i.b),a.setXYZ(33,i.r,i.g,i.b),a.setXYZ(34,i.r,i.g,i.b),a.setXYZ(35,i.r,i.g,i.b),a.setXYZ(36,i.r,i.g,i.b),a.setXYZ(37,i.r,i.g,i.b),a.setXYZ(38,r.r,r.g,r.b),a.setXYZ(39,r.r,r.g,r.b),a.setXYZ(40,n.r,n.g,n.b),a.setXYZ(41,n.r,n.g,n.b),a.setXYZ(42,n.r,n.g,n.b),a.setXYZ(43,n.r,n.g,n.b),a.setXYZ(44,n.r,n.g,n.b),a.setXYZ(45,n.r,n.g,n.b),a.setXYZ(46,n.r,n.g,n.b),a.setXYZ(47,n.r,n.g,n.b),a.setXYZ(48,n.r,n.g,n.b),a.setXYZ(49,n.r,n.g,n.b),a.needsUpdate=!0}update(){let e=this.geometry,t=this.pointMap,i=1,r=1;mL.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),mR("c",t,e,mL,0,0,-1),mR("t",t,e,mL,0,0,1),mR("n1",t,e,mL,-i,-r,-1),mR("n2",t,e,mL,i,-r,-1),mR("n3",t,e,mL,-i,r,-1),mR("n4",t,e,mL,i,r,-1),mR("f1",t,e,mL,-i,-r,1),mR("f2",t,e,mL,i,-r,1),mR("f3",t,e,mL,-i,r,1),mR("f4",t,e,mL,i,r,1),mR("u1",t,e,mL,.7*i,1.1*r,-1),mR("u2",t,e,mL,-(.7*i),1.1*r,-1),mR("u3",t,e,mL,0,2*r,-1),mR("cf1",t,e,mL,-i,0,1),mR("cf2",t,e,mL,i,0,1),mR("cf3",t,e,mL,0,-r,1),mR("cf4",t,e,mL,0,r,1),mR("cn1",t,e,mL,-i,0,-1),mR("cn2",t,e,mL,i,0,-1),mR("cn3",t,e,mL,0,-r,-1),mR("cn4",t,e,mL,0,r,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function mR(e,t,i,r,n,o,a){mE.set(n,o,a).unproject(r);let s=t[e];if(void 0!==s){let e=i.getAttribute("position");for(let t=0,i=s.length;t<i;t++)e.setXYZ(s[t],mE.x,mE.y,mE.z)}}let mW=new i0;class mV extends cA{constructor(e,t=16776960){let i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),n=new ng;n.setIndex(new r8(i,1)),n.setAttribute("position",new r8(r,3)),super(n,new cb({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&mW.setFromObject(this.object),mW.isEmpty())return;let t=mW.min,i=mW.max,r=this.geometry.attributes.position,n=r.array;n[0]=i.x,n[1]=i.y,n[2]=i.z,n[3]=t.x,n[4]=i.y,n[5]=i.z,n[6]=t.x,n[7]=t.y,n[8]=i.z,n[9]=i.x,n[10]=t.y,n[11]=i.z,n[12]=i.x,n[13]=i.y,n[14]=t.z,n[15]=t.x,n[16]=i.y,n[17]=t.z,n[18]=t.x,n[19]=t.y,n[20]=t.z,n[21]=i.x,n[22]=t.y,n[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}}class mk extends cA{constructor(e,t=16776960){let i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],n=new ng;n.setIndex(new r8(i,1)),n.setAttribute("position",new ns(r,3)),super(n,new cb({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}class mB extends c_{constructor(e,t=1,i=16776960){let r=i,n=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],o=new ng;o.setAttribute("position",new ns(n,3)),o.computeBoundingSphere(),super(o,new cb({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;let a=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],s=new ng;s.setAttribute("position",new ns(a,3)),s.computeBoundingSphere(),this.add(new nW(s,new r4({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}}let mO=new iQ;class mF extends rH{constructor(e=new iQ(0,0,1),t=new iQ(0,0,0),i=1,r=16776960,n=.2*i,s=.2*n){super(),this.type="ArrowHelper",void 0===o&&((o=new ng).setAttribute("position",new ns([0,0,0,0,1,0],3)),(a=new du(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new c_(o,new cb({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new nW(a,new r4({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,n,s)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{mO.set(e.z,0,-e.x).normalize();let t=Math.acos(e.y);this.quaternion.setFromAxisAngle(mO,t)}}setLength(e,t=.2*e,i=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}class mz extends cA{constructor(e=1){let t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new ng;r.setAttribute("position",new ns(t,3)),r.setAttribute("color",new ns(i,3));let n=new cb({vertexColors:!0,toneMapped:!1});super(r,n),this.type="AxesHelper"}setColors(e,t,i){let r=new iB,n=this.geometry.attributes.color.array;return r.set(e),r.toArray(n,0),r.toArray(n,3),r.set(t),r.toArray(n,6),r.toArray(n,9),r.set(i),r.toArray(n,12),r.toArray(n,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class mU{constructor(){this.type="ShapePath",this.color=new iB,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new dl,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,i,r){return this.currentPath.quadraticCurveTo(e,t,i,r),this}bezierCurveTo(e,t,i,r,n,o){return this.currentPath.bezierCurveTo(e,t,i,r,n,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){let t,i,r,n,o;function a(e){let t=[];for(let i=0,r=e.length;i<r;i++){let r=e[i],n=new dv;n.curves=r.curves,t.push(n)}return t}function s(e,t){let i=t.length,r=!1;for(let n=i-1,o=0;o<i;n=o++){let i=t[n],a=t[o],s=a.x-i.x,l=a.y-i.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(i=t[o],s=-s,a=t[n],l=-l),e.y<i.y||e.y>a.y)continue;if(e.y===i.y){if(e.x===i.x)return!0}else{let t=l*(e.x-i.x)-s*(e.y-i.y);if(0===t)return!0;if(t<0)continue;r=!r}}else{if(e.y!==i.y)continue;if(a.x<=e.x&&e.x<=i.x||i.x<=e.x&&e.x<=a.x)return!0}}return r}let l=d0.isClockWise,h=this.subPaths;if(0===h.length)return[];let c=[];if(1===h.length)return i=h[0],(r=new dv).curves=i.curves,c.push(r),c;let d=!l(h[0].getPoints());d=e?!d:d;let u=[],p=[],m=[],f=0;p[0]=void 0,m[f]=[];for(let r=0,o=h.length;r<o;r++)t=l(n=(i=h[r]).getPoints()),(t=e?!t:t)?(!d&&p[f]&&f++,p[f]={s:new dv,p:n},p[f].s.curves=i.curves,d&&f++,m[f]=[]):m[f].push({h:i,p:n[0]});if(!p[0])return a(h);if(p.length>1){let e=!1,t=0;for(let e=0,t=p.length;e<t;e++)u[e]=[];for(let i=0,r=p.length;i<r;i++){let r=m[i];for(let n=0;n<r.length;n++){let o=r[n],a=!0;for(let r=0;r<p.length;r++)s(o.p,p[r].p)&&(i!==r&&t++,a?(a=!1,u[r].push(o)):e=!0);a&&u[i].push(o)}}t>0&&!1===e&&(m=u)}for(let e=0,t=p.length;e<t;e++){r=p[e].s,c.push(r),o=m[e];for(let e=0,t=o.length;e<t;e++)r.holes.push(o[e].h)}return c}}let mN=mG();function mG(){let e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),r=new Uint32Array(512),n=new Uint32Array(512);for(let e=0;e<256;++e){let t=e-127;t<-27?(r[e]=0,r[256|e]=32768,n[e]=24,n[256|e]=24):t<-14?(r[e]=1024>>-t-14,r[256|e]=1024>>-t-14|32768,n[e]=-t-1,n[256|e]=-t-1):t<=15?(r[e]=t+15<<10,r[256|e]=t+15<<10|32768,n[e]=13,n[256|e]=13):t<128?(r[e]=31744,r[256|e]=64512,n[e]=24,n[256|e]=24):(r[e]=31744,r[256|e]=64512,n[e]=13,n[256|e]=13)}let o=new Uint32Array(2048),a=new Uint32Array(64),s=new Uint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,i=0;for(;(8388608&t)==0;)t<<=1,i-=8388608;t&=-8388609,i+=947912704,o[e]=t|i}for(let e=1024;e<2048;++e)o[e]=939524096+(e-1024<<13);for(let e=1;e<31;++e)a[e]=e<<23;a[31]=1199570944,a[32]=2147483648;for(let e=33;e<63;++e)a[e]=2147483648+(e-32<<23);a[63]=3347054592;for(let e=1;e<64;++e)32!==e&&(s[e]=1024);return{floatView:t,uint32View:i,baseTable:r,shiftTable:n,mantissaTable:o,exponentTable:a,offsetTable:s}}var mH=Object.freeze({__proto__:null,toHalfFloat:function(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=is(e,-65504,65504),mN.floatView[0]=e;let t=mN.uint32View[0],i=t>>23&511;return mN.baseTable[i]+((8388607&t)>>mN.shiftTable[i])},fromHalfFloat:function(e){let t=e>>10;return mN.uint32View[0]=mN.mantissaTable[mN.offsetTable[t]+(1023&e)]+mN.exponentTable[t],mN.floatView[0]}});function mj(){console.error("THREE.ImmediateRenderObject has been removed.")}class mq extends iH{constructor(e,t,i){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),super(e,t,i),this.samples=4}}class mX extends ij{constructor(e,t,i,r){console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),super(e,t,i,r)}}class mY extends iX{constructor(e,t,i,r){console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),super(e,t,i,r)}}class mJ extends nB{constructor(e,t,i,r,n,o){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(e,t,i,r,n,o)}}class mZ extends dc{constructor(e,t,i,r){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(e,t,i,r)}}class mQ extends dd{constructor(e,t,i,r){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(e,t,i,r)}}class mK extends dp{constructor(e,t,i,r,n,o,a){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(e,t,i,r,n,o,a)}}class m$ extends du{constructor(e,t,i,r,n,o,a,s){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(e,t,i,r,n,o,a,s)}}class m0 extends df{constructor(e,t){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(e,t)}}class m1 extends d3{constructor(e,t){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(e,t)}}class m2 extends d6{constructor(e,t){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(e,t)}}class m3 extends dh{constructor(e,t,i,r){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(e,t,i,r)}}class m5 extends d9{constructor(e,t){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(e,t)}}class m6 extends n8{constructor(e,t,i,r){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(e,t,i,r)}}class m9 extends dm{constructor(e,t,i,r){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(e,t,i,r)}}class m8 extends d8{constructor(e,t,i,r,n,o){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(e,t,i,r,n,o)}}class m7 extends ue{constructor(e,t){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(e,t)}}class fe extends ui{constructor(e,t,i,r,n,o,a){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(e,t,i,r,n,o,a)}}class ft extends ur{constructor(e,t){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(e,t)}}class fi extends un{constructor(e,t,i,r,n){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(e,t,i,r,n)}}class fr extends uo{constructor(e,t,i,r,n,o){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(e,t,i,r,n,o)}}class fn extends ua{constructor(e,t,i,r,n){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(e,t,i,r,n)}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:s}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=s)}),parcelRequire.register("73HrS",function(e,t){$parcel$export(e.exports,"WallCore",()=>d),$parcel$export(e.exports,"RoomCore",()=>u);var i=parcelRequire("4xklQ"),r=parcelRequire("1kqdl");parcelRequire("hWloQ");var n=parcelRequire("5XTH3"),o=parcelRequire("7UKlx"),a=parcelRequire("5sV3G"),s=parcelRequire("9HO6e"),l=parcelRequire("9QhXH"),h=parcelRequire("fAsY2");parcelRequire("fHLr5"),parcelRequire("3BPdS");var c=parcelRequire("5c6ha");class d{constructor(e="",t=""){this.stroke=(0,r.Stroke)({thickness:240,cap:"butt"}),this.editor=e,this.object=t}createLineWall(e,t,r=240){if(2==this.editor.innerDraw&&"wall"==this.editor.toolType){let n=t.clone().sub(e.clone()),o=new(0,i.Vector2)(-n.y,n.x).setLength(r/2);e=e.clone().add(o),t=t.clone().add(o)}let n=e.clone(),o=t.clone(),a={start:{x:n.x,y:n.y,z:0},end:{x:o.x,y:o.y,z:0},style:2,line:0,isArc:!1,thickness:r,height:window.storeyHei,direction:"",offsetXY:100};return this.makeLineWallByJson(a)}makeLineWallByJson(e){let t=new i.Vector2(e.start.x,e.start.y),r=new i.Vector2(e.end.x,e.end.y),n=this.editor.wallTool.createBottomFace(t,r,e.line,e.thickness);return n.startPoint=t,n.endPoint=r,n.useType="wall",this.editor.wallTool.recordInfo(n,e),n}wallToJson(e="2D",t=[],r="hole"){let h=(0,l.DM).getWallJson(this.editor.allWalls),d=(0,l.DM).getHoleJson(this.editor.otherMeshs,this.editor),u=(0,l.DM).memberJson(this.editor.otherMember);0!=t.length&&(h=t,this.editor.cleanWallHelper());let p=new n.DrawWallTool,m=p.create2DWall(h),f=m.pop(),g=this.editor.floorGroup2d.children;this.editor.floorGroup.children,this.editor.wallGroup.children=[],this.editor.wallGroup3D.children=[],this.editor.floorGroup.children=[],this.editor.memberGroup3D.children=[],this.editor.lineGroup3D.children=[],this.editor.floorGroup2d.children=[],f.length>0&&this.editor.wallGroup.add(...f),this.editor.allWalls=m;let y=this.editor.splitRoomByLine(),x=new o.Floor(m,this.editor),w=x.getFloor(y[0],y[1],"3D");if(this.editor.allWalls.forEach(e=>{e.material.color=this.editor.getWallColor(e),e.roomCenter=[]}),w.length>0){let e=this.editor.cacheJson,t=[];e?(e=JSON.parse(e),this.editor.addFloor(x,w,"2D",y,e.roomJson),t=e.roomJson):(this.editor.addFloor(x,w,"2D",y),g.forEach(e=>{let i=Number(e.roomCenter[0]).toFixed(2)+"/"+Number(e.roomCenter[1]).toFixed(2);t.push([i,1,1==e.material.color.r])})),this.editor.floorGroup2d.children.forEach(e=>{let r=e.roomCenter,n=r[0]+"/"+r[1];t&&t.forEach(t=>{n!=t[0]||t[2]||(e.material=new i.MeshBasicMaterial({color:15264748,side:i.DoubleSide,transparent:e.material.transparent,opacity:e.material.opacity}))})})}else this.editor.removeInputByClassName(this.editor.uiPanelBox.dom,"roomName");if(m.length>0&&"hole"==r){this.editor.wallGroup.add(...m);let e=p.switchTo3D(m);this.editor.wallGroup3D.add(...e),this.editor.createDoorCamera(d),d.length>0&&new(0,a.DigHole)(this.editor).work(e,d)}let b=[];this.editor.wallGroup3D.children.forEach(e=>{e.height&&b.push(e.height),this.editor.addBoxForMesh(e,[])});let v=Math.max.apply(null,b);0==b.length&&(v=window.storeyHei),this.editor.wallGroup3D.roomHeight=v;let M=x.getBeamNew(u,this.editor.otherMember);M.forEach(e=>{this.editor.addBoxForMesh(e,[])}),M.length>0&&this.editor.memberGroup3D.add(...M);let S=x.getCeiling();S.length>0&&this.editor.floorGroup.add(...S);let P=new(0,i.Matrix4)().makeScale(.001,.001,.001);1==this.editor.wallGroup3D.scale.x&&(this.editor.wallGroup3D.applyMatrix4(P),this.editor.lineGroup3D.applyMatrix4(P),this.editor.memberGroup3D.applyMatrix4(P),this.editor.floorGroup.applyMatrix4(P)),this.editor.list.showHiddenHelper.dispatch("","only",this.editor.config.settingJson),"3D"==e?(this.editor.toolType="free",this.editor.switchHelperGroup("hidden"),this.editor.hiddenDomsByClassName(this.editor.uiPanelBox.dom,"roomName")):(this.editor.addIntersectPointHelper(),this.editor.switchHelperGroup("show"),(0,s.UtilCore).updateLineDimensionsLine(this.editor)),this.editor.allGroup3d.forEach(e=>{e.traverse(function(e){e.layers.set(1)})}),this.editor.scene.children.slice(0).forEach(e=>{e.startPoint&&"wall"==e.useType&&this.editor.scene.remove(e)}),this.editor.splitRoomLineGroup.children.slice(0).forEach(e=>{"splitOuterLine"==e.useType&&this.editor.splitRoomLineGroup.remove(e)}),this.editor.miniDom=document.getElementById("scrollviewcontent");let T=document.getElementsByClassName("view_box")[0].clientWidth,_=document.getElementsByClassName("view_box")[0].clientHeight;this.editor.miniMapObj=new c.CreateMiniMap(this.editor,this.editor.miniMapCamera,this.editor.scene,this.editor.newRenderer,this.editor.miniDom,T,_-28),this.editor.miniMapObj.main()}createCurveWall(e,t,r="",n=!1,o=240){this.stroke.thickness=o,""==r&&(r=d.initControlPoint(e,t)),n&&(r=autoHandlePoint(e,t,r));var a=new i.QuadraticBezierCurve3(e,r,t).getPoints(50),s=[];a.forEach(function(e){s.push([e.x,e.y])});var l=this.stroke.build(s);l=d.process(s,l);var h=[];l.positions.forEach(function(e){h.push(e[0],e[1],0)});var c=[];l.cells.forEach(function(e){c.push(e[0],e[1],e[2])});var u=new i.BufferGeometry;u.attributes.position=new i.BufferAttribute(new Float32Array(h),3),u.index=new i.BufferAttribute(new Uint16Array(c),1);var p=new i.MeshBasicMaterial({color:"#4169E1",side:i.DoubleSide}),l=new i.Mesh(u,p);return l.controlPoint=r,l.startPoint=e,l.endPoint=t,l.useType="wall",l.wallType="rectangleWall",l}createCircleWall(e,t,i,r,n=240){let o={start:{x:e.x,y:e.y,z:0},end:{x:t.x,y:t.y,z:0},style:2,line:0,cp:{x:i.x,y:i.y,z:0},isArc:r,thickness:n,height:window.storeyHei,direction:"",offsetXY:100};var a=this.editor.wallTool.create2DWall([o]);return a.pop(),a[0]}splitWall(e,t){let i=e.startPoint,r=e.endPoint,n=.1>Math.abs(i.x-t.x)&&.1>Math.abs(i.y-t.y),o=.1>Math.abs(r.x-t.x)&&.1>Math.abs(r.y-t.y);if(n||o)return n&&(e.startPoint=t),o&&(e.endPoint=t),0>this.editor.allWalls.indexOf(e)&&this.editor.allWalls.push(e),[e];this.editor.removeWall(e);let a=this.editor.addWall(i,t),l=this.editor.addWall(t,r);return a.wallID=e.wallID,a.style=e.style,l.style=e.style,a.height=e.height,l.height=e.height,a.thickness=e.thickness,l.thickness=e.thickness,a.material.color=this.editor.getWallColor(a),l.material.color=this.editor.getWallColor(l),this.editor.getAllWindowInWall(e).forEach(n=>{(0,s.UtilCore).pointIsInLine(n.center,i,t)?n.wallId=e.wallID:(n.wallId="",n.wallPoint=[t,r])}),[a,l]}static makeControlPoint(e){var t=new i.BufferGeometry;let r=80;var n=new Float32Array([e.x-r,e.y-r,0,e.x+r,e.y-r,0,e.x+r,e.y+r,0,e.x-r,e.y+r,0]);t.attributes.position=new i.BufferAttribute(n,3);var o=new Uint16Array([0,1,2,0,2,3]);t.index=new i.BufferAttribute(o,1);var a=new i.MeshBasicMaterial({color:"#4169E1",side:i.DoubleSide,transparent:!0}),s=new i.Mesh(t,a);return s.useType="controlPoint",s}static process(e,t,r=[]){return t.innner=[],t.outter=[],e.forEach(function(e){r.push(new i.Vector2(e[0],e[1]))}),t.clock=(0,h.ShapeUtils).isClockWise(r),t.positions.forEach(function(e,i){i%2==0?t.clock?t.innner.push(e):t.outter.push(e):t.clock?t.outter.push(e):t.innner.push(e)}),t}static initControlPoint(e,t,r=2e3){let n=(e.x+t.x)/2,o=(e.y+t.y)/2,a=new i.Vector3(n,o,0);var s=new(0,i.Vector3)().subVectors(t,e),l=new i.Vector3(-s.y,s.x,0);return l.setLength(r),new(0,i.Vector3)().addVectors(a,l)}}class u{constructor(e="",t=""){this.editor=e,this.object=t}createRoom(e,t,r=240){let n=new i.Vector3(t.x,e.y,0),o=new i.Vector3(e.x,t.y,0),a=t.x>e.x?t.x+r/2:t.x-r/2,s=t.y>n.y?t.y+r/2:t.y-r/2,l=o.x<t.x?o.x-r/2:o.x+r/2,h=e.y>o.y?e.y+r/2:e.y-r/2,c=new i.Vector3(a,e.y,0),u=new i.Vector3(t.x,s,0),p=new i.Vector3(l,t.y,0),m=new i.Vector3(e.x,h,0),f=new d(this.editor),g=f.createLineWall(e,c,r),y=f.createLineWall(n,u,r),x=f.createLineWall(t,p,r),w=f.createLineWall(o,m,r);return g.startPoint=e,g.endPoint=n,y.startPoint=n,y.endPoint=t,x.startPoint=t,x.endPoint=o,w.startPoint=o,w.endPoint=e,[g,y,x,w]}createRectangle(e,t,r){let n=new i.Vector3((e[0].x+e[1].x)/2,(e[0].y+e[1].y)/2,0),o=new i.PlaneGeometry(t,r),a=new i.MeshLambertMaterial({color:16776960,side:i.DoubleSide}),s=new i.Mesh(o,a);return s.position.x=n.x,s.position.y=n.y,s}}}),parcelRequire.register("1kqdl",function(e,t){$parcel$export(e.exports,"Stroke",()=>h);var i=parcelRequire("4xklQ"),r=new i.Vector2,n=new i.Vector2,o=new i.Vector2,a=new i.Vector2,s=new i.Vector2,l=new i.Vector2;function h(e){if(!(this instanceof h))return new h(e);e=e||{},this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||20,this.thickrules=e.thickrules||[],this.join=e.join||"miter",this.cap=e.cap||"butt",this._normal=null,this._lastFlip=-1,this._started=!1}function c(e,t,i,n,o,a){p(r,n,o,-a),e.push(r.clone().toArray()),i.push(r.clone().toArray()),p(r,n,o,a),e.push(r.clone().toArray()),t.push(r.clone().toArray())}function d(e,t,r){var n=new i.Vector2(t[0],t[1]),o=new i.Vector2(r[0],r[1]);return e.subVectors(n,o).normalize(),e}function u(e,t){return e.set(-t.y,t.x),e}function p(e,t,r,n){var o=new i.Vector2(t[0],t[1]),a=r.clone().setLength(n);return e.addVectors(o,a)}function m(e,t,r,n,o,a){var s=new(0,i.Vector2)(-n.y,n.x).normalize(),l=a/r.dot(s),h=r.clone().setLength(l),c=new(0,i.Vector2)(-r.y,r.x).normalize(),d=o/n.clone().negate().dot(c),u=n.clone().negate().setLength(d);return t.addVectors(h,u),t.length()}h.prototype.mapThickness=function(e,t,i){var r=null;return this.thickrules.forEach(function(e){t>=e[0]&&t<=e[1]&&(r=e[2])}),null!=r?r:this.thickness},h.prototype.clockwise=function(e){return e},h.prototype.build=function(e){var t={positions:[],cells:[],outter:[],innner:[]};if(e.length<=1)return t;var i=e.length;this._lastFlip=-1,this._started=!1,this._normal=null;for(var r=1,n=0;r<i;r++){var o=e[r-1],a=e[r],s=r<e.length-1?e[r+1]:null,l=this.mapThickness(a,r,e),h=this.mapThickness(s,r+1,e),c=this._seg(t,n,o,a,s,l/2,h/2);n+=c}return this.clockwise(t)},h.prototype._seg=function(e,t,r,h,f,g,y){var x=0,w=e.cells,b=e.positions,v=e.outter,M=e.innner,S="square"===this.cap,P="bevel"===this.join;if(d(o,h,r),this._normal||(this._normal=new i.Vector2,u(this._normal,o)),this._started||(this._started=!0,S&&(p(n,r,o,-g),r=n.toArray()),c(b,v,M,r,this._normal,g)),w.push([t+0,t+1,t+2]),f){d(a,f,h);var T=m(s,l,o,a,g,y),_=0>s.dot(this._normal)?-1:1,C=P;!C&&"miter"===this.join&&T/g>this.miterLimit&&(C=!0),C||(c(b,v,M,h,l,T),w.push(1===this._lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3]),_=-1,this.normal=l.clone(),x+=2),this._lastFlip=_}else u(this._normal,o),S&&(p(n,h,o,g),h=n.toArray()),c(b,v,M,h,this._normal,g),w.push(1===this._lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3]),x+=2;return x}}),parcelRequire.register("hWloQ",function(e,t){$parcel$export(e.exports,"WallHelp",()=>d);var i=parcelRequire("4xklQ"),r=parcelRequire("73HrS"),n=parcelRequire("1kqdl"),o=parcelRequire("fAsY2"),a=parcelRequire("9HO6e"),s=parcelRequire("5TtCd"),l=parcelRequire("g4HAh"),h=parcelRequire("7WCxl"),c=parcelRequire("ia4Lh");class d{drawWallHelp(e,t,r=400){let n=this.createLineDimensionsLine(e,t,!0,r),o=this.createCircleDimensionsLine(e,t),a=.1>Math.abs(e.x-t.x)||.1>Math.abs(e.x-t.y),s=.1>Math.abs(e.y-t.x)||.1>Math.abs(e.y-t.y),l=new i.Group;return l.add(n),l.lineLength=n.lineLength,l.lineCenter=n.center,a||s?(l.realAngle="",l.arcCenter=""):(l.add(o[0]),l.add(o[1]),l.add(o[2]),l.add(o[3]),l.realAngle=o[0].realAngle,l.arcCenter=o[0].center),l}createSplitWallMesh(e,t){var r=[];e.forEach(function(e){r.push(e.x,e.y,-1)});var n=[0,1,2,2,1,3],o=new i.BufferGeometry;return o.attributes.position=new i.BufferAttribute(new Float32Array(r),3),o.index=new i.BufferAttribute(new Uint16Array(n),1),new i.Mesh(o,t)}createCurveHelp(e,t,n){let o=new i.Group,a=(0,r.WallCore).makeControlPoint(n);var s=new(0,i.BufferGeometry)().setFromPoints([e,n,t]),l=new i.Line(s,new i.MeshBasicMaterial({color:"#1E90FF",side:i.DoubleSide,transparent:!0}));return o.add(a),o.add(l),o.useType="arcHelper",o.controlMesh=a,o}createLineDimensionsLine(e,t,r=!0,n=280,o="#000000",a=6){e=new i.Vector3(e.x,e.y,0),t=new i.Vector3(t.x,t.y,0);let s=new(0,i.Vector3)().subVectors(t,e),l=new i.Vector3(-s.y,s.x,0);r&&(l=l.negate()),l.setLength(n);let h=e.clone().add(l),c=t.clone().add(l),d=new i.MeshBasicMaterial({color:o,side:i.DoubleSide,depthTest:!1,transparent:!0}),u=[h,c];u=(u=this.createEndpoint(h,l).concat(u)).concat(this.createEndpoint(c,l));let p=new i.Line(new(0,i.BufferGeometry)().setFromPoints(u),d);p.renderOrder=a;let m=new i.Vector3((h.x+c.x)/2,(h.y+c.y)/2,0),f=Math.round(e.clone().distanceTo(t.clone()));return p.center=m,p.lineLength=f,p.startPoint=e,p.endPoint=t,p}createDimensionsLineForDoor(e,t,r,n=280){e=new i.Vector3(e.x,e.y,0),t=new i.Vector3(t.x,t.y,0);let o=new(0,i.Vector3)().subVectors(t,e),a=new(0,i.Vector3)(-o.y,o.x,0).negate();a.setLength(n);let s=e.clone().add(a.setLength(n)),l=t.clone().add(a.setLength(n)),h=new i.MeshBasicMaterial({color:"#000000",side:i.DoubleSide,depthTest:!1,transparent:!0}),c=[s,l];c=(c=this.createEndpoint(s,a,80).concat(c)).concat(this.createEndpoint(l,a,80));let d=new i.Line(new(0,i.BufferGeometry)().setFromPoints(c),h);d.renderOrder=400;let u=new i.Vector3((s.x+l.x)/2,(s.y+l.y)/2,0),p=Math.round(e.clone().distanceTo(t.clone()));return d.center=u,d.startPoint=e,d.endPoint=t,d.lineLength=p,d}createCircleLine(e,t,r,n=3){let o=(0,a.UtilCore).getMeshOtherPoint(t,e),s=t.startPoint.clone().distanceTo(t.endPoint.clone()),l=r.startPoint.clone().distanceTo(r.endPoint.clone()),h=s<l?s:l,c=o.clone().sub(e.clone()),d=(0,a.UtilCore).getMeshOtherPoint(r,e).clone().sub(e.clone()),u=(0,a.UtilCore).toVector3(c).angleTo((0,a.UtilCore).toVector3(d));u=Math.round(180/Math.PI*u);let p=(0,a.UtilCore).toVector2(c).angle(),m=(0,a.UtilCore).getMeshOtherPoint(r,e),f=m.clone().sub(e.clone()),g=(0,a.UtilCore).toVector2(f).angle(),y=(0,a.UtilCore).getClockWise(o,e,m);y=y>0;let x=new i.MeshBasicMaterial({color:"#1C1C1C",side:i.DoubleSide,transparent:!0}),w=new i.EllipseCurve(e.x,e.y,h/n,h/n,p,g,y).getPoints(50),b=new i.Line(new(0,i.BufferGeometry)().setFromPoints(w),x),v=w[Math.round(w.length/2)];return b.renderOrder=6,b.realAngle=u+"\xb0",b.center=new i.Vector3(v.x,v.y,0),b}createCircleDimensionsLine(e,t,r=600){e=new i.Vector3(e.x,e.y,0),t=new i.Vector3(t.x,t.y,0);let n=e.distanceTo(t)+r,o=new i.Vector3(1,0,0),a=new(0,i.Vector3)().subVectors(t,e).angleTo(o),s=!1,l=0,h=180/Math.PI*a,c=new i.LineDashedMaterial({color:"#1C1C1C",dashSize:3,gapSize:3}),d=new i.MeshBasicMaterial({color:"#1C1C1C",side:i.DoubleSide,transparent:!0});e.x<t.x&&e.y>t.y&&(s=!0,a*=-1),e.x>t.x&&e.y<t.y&&(l=Math.PI,s=!0,h=180/Math.PI*(Math.PI-a)),e.x>t.x&&e.y>t.y&&(l=Math.PI,s=!1,h=180/Math.PI*(Math.PI-a),a*=-1);let u=new i.EllipseCurve(e.x,e.y,n/10,n/10,l,a,s).getPoints(50),p=new i.Line(new(0,i.BufferGeometry)().setFromPoints(u),c);var m=new i.EllipseCurve(e.x,e.y,n,n,l,a,s).getPoints(50);let f=new i.Line(new(0,i.BufferGeometry)().setFromPoints([e,m[0]]),c),g=new i.Line(new(0,i.BufferGeometry)().setFromPoints([e,m[m.length-1]]),c);f.computeLineDistances(),g.computeLineDistances();let y=new(0,i.Vector3)().subVectors(e.clone(),m[0].clone()),x=new(0,i.Vector3)().subVectors(e.clone(),m[m.length-1].clone());y.z=0,x.z=0,m=(m=this.createEndpoint(m[0],y).concat(m)).concat(this.createEndpoint(m[m.length-1],x));let w=new i.Line(new(0,i.BufferGeometry)().setFromPoints(m),d),b=m[Math.round(m.length/2)];return w.realAngle=Math.round(h)+"\xb0",w.center=new i.Vector3(b.x,b.y,0),[w,f,g,p]}createCircleAngleLine(e,t,r,n,o){let a=new i.MeshBasicMaterial({color:"#1C1C1C",side:i.DoubleSide,transparent:!0}),s=new i.EllipseCurve(e.x,e.y,t/2,t/2,r,n,o).getPoints(50),l=new i.Line(new(0,i.BufferGeometry)().setFromPoints(s),a),h=s[Math.round(s.length/2)];return l.center=new i.Vector3(h.x,h.y,0),l}createEndpoint(e,t,r=100){let n=t.clone().setLength(r),o=t.clone().negate().setLength(r),a=n.clone().applyAxisAngle(new i.Vector3(0,0,1),70),s=a.clone().negate().setLength(r),l=e.clone().add(n),h=e.clone().add(o),c=e.clone().add(a),d=e.clone().add(s);return[l,h,e,c,d]}createPoint(e,t="",r=80){let n=new i.Group;""==t&&(t=e);var o=new i.CircleGeometry(r/3,32),a=new i.MeshBasicMaterial({color:"#363636",transparent:!0}),s=new i.CircleGeometry(r,32),l=new i.MeshBasicMaterial({color:"#FFFF00",depthTest:!1,transparent:!0}),h=new i.Mesh(o,a),c=new i.Mesh(s,l);return h.position.set(e.x,e.y,10),c.position.set(e.x,e.y,10),h.renderOrder=5,c.renderOrder=4,n.add(h),n.add(c),n.center=t,h.useType="dragPoint",c.useType="dragPoint",n.radio=r,n}createDragPoint(e,t="",r=80){let n=new i.Group;""==t&&(t=e);var o=new i.CircleGeometry(r,32),a=new i.MeshBasicMaterial({color:"#ffffff",transparent:!0,opacity:.4}),s=new i.Mesh(o,a);return s.renderOrder=6,n.add(s),n.center=t,n.radio=r,n.position.set(e.x,e.y,10),s.useType="dragPoint",n}createScaleToolPoint(e,t,r=60){var n=new i.CircleGeometry(r,32),o=new i.MeshBasicMaterial({color:"rgb(f,f,f)",depthTest:!1,transparent:!0,opacity:.8,side:i.DoubleSide}),a=new i.Mesh(n,o);return a.position.set(e.x,e.y,10),a.renderOrder=100,a.useType="movePoint",a.positionType=t,a.positionCenter=e,a}createDoorPoint(e,t,r=60){var n=new i.CircleGeometry(r,32),o=new i.MeshBasicMaterial({color:"rgb(62, 130, 247)",depthTest:!1,transparent:!0,opacity:.8}),a=new i.Mesh(n,o);return a.position.set(e.x,e.y,100),a.renderOrder=6,a.useType="movePoint",a.positionType=t,a.positionCenter=e,a}createNormalPoint(e,t=60){var r=new i.CircleGeometry(t,32),n=new i.MeshBasicMaterial({color:"#FFFF00",depthTest:!1,transparent:!0,opacity:.8}),o=new i.Mesh(r,n);return o.position.set(e.x,e.y,10),o.renderOrder=6,o}createDoorOuterPoint(e,t=100,r="rgb(255, 255, 255)",n=0){var o=new i.CircleGeometry(t,32),a=new i.MeshBasicMaterial({color:r,depthTest:!1,transparent:!0}),s=new i.Mesh(o,a);return s.position.set(e.x,e.y,n),s.renderOrder=5,s.useType="moveOuterPoint",s.positionCenter=e,s}createHelperForMumber(e,t=60){let i="";e.children.forEach(e=>{if("Mesh"==e.type){i=e;return}}),e.modelType&&e.modelType.indexOf("Model")>=0&&(i=e);let r=this.addScaleTool(i),n=0;return n=e.rotation.z,[r,this.addAngleTool(i,1500,n-Math.PI/8,n+Math.PI/8)]}addAngleTool(e,t,i,r,n="rgb(153,193,244)"){let o=100,a=this.getMeshCenter(e),s=this.makeRotateToolGem(a,i,r,t,n,o,!0);return s.currentModel=e,s}getMeshCenter(e){let t=new i.Vector3;return e.updateWorldMatrix(),e.getWorldPosition(t),t}addBoxFor2dModel(e,t=window.editor.config.boxLineColor,r="line"){let n=[e[0],e[1],e[2],e[3],e[0]],o=[];n.forEach(e=>{o.push(e.x,e.y,e.z)});var a=new(0,l.LineGeometry)().setPositions(o),s=new h.LineMaterial({color:t,linewidth:window.editor.config.boxLineWidth,side:i.DoubleSide});"line"!=r&&(s=new h.LineMaterial({color:0,dashScale:20,side:i.DoubleSide,dashed:!0})),s.resolution.set(window.innerWidth,window.innerHeight);var d=new c.Line2(a,s);return d.computeLineDistances(),d.renderOrder=100,d}addScaleTool(e,t=60){let r=this.getModelVertex(e),n=new i.Group;for(let e=0;e<r.length;e++){var o=new i.CircleGeometry(t,32),a=new i.MeshBasicMaterial({color:"rgb(26, 122, 251)",depthTest:!1,transparent:!0,opacity:.8}),s=new i.Mesh(o,a);s.position.set(r[e].x,r[e].y,10),s.renderOrder=10,s.useType="scalePoint",s.arcCenter=new i.Vector3(r[e].x,r[e].y,0),0==e&&(s.scaleDir="-XY",s.linePoint=[r[0],r[2]]),2==e&&(s.scaleDir="X-Y",s.linePoint=[r[0],r[2]]),1==e&&(s.scaleDir="-X-Y",s.linePoint=[r[1],r[3]]),3==e&&(s.scaleDir="XY",s.linePoint=[r[1],r[3]]),4==e&&(s.scaleDir="-X",s.linePoint=[r[4],r[7]]),7==e&&(s.scaleDir="X",s.linePoint=[r[4],r[7]]),5==e&&(s.scaleDir="-Y",s.linePoint=[r[5],r[6]]),6==e&&(s.scaleDir="Y",s.linePoint=[r[5],r[6]]),n.add(s)}"2dModelGroup"==e.modelType&&(n=new i.Group),n.useType="scaleTool",n.currentModel=e;let l=this.addBoxFor2dModel(r);return n.add(l),n}getWorldRotation(e){let t=(e,t)=>new i.Vector3(e.x+t.x,e.y+t.y,e.z+t.z);return null===e?new i.Vector3:t(e.rotation,this.getWorldRotation(e.parent))}addOBB2DBox(e,t=window.editor.config.boxLineColor){let r=1e3*e.width/2,n=1e3*e.depth/2,o=new i.Vector3(-r,n,0),a=new i.Vector3(-r,-n,0),s=new i.Vector3(r,-n,0),l=new i.Vector3(r,n,0),h=e.position.clone(),c=e.rot,d=this.addBoxFor2dModel([o,a,s,l,o],t);return h.x*=1e3,h.y=-1e3*h.z,h.z=.1,d.rotation.set(c.x,0,c.y),d.position.set(h.x,h.y,h.z),d}addOBBbox(e,t=window.editor.config.boxLineColor){var r="";if("Mesh"==e.type&&"pillars"!=e.modeType&&"beam"!=e.modeType&&e.parent&&"3dwall"!=e.parent.name){let n=new i.EdgesGeometry(e.geometry,4);(r=new i.LineSegments(n,new i.LineBasicMaterial({color:t}))).position.set(e.position.x,e.position.z,-e.position.y),r.rotation.x=-Math.PI/2,r.rotation.z=e.rotation.z,r.scale.copy(e.scale);let o=new(0,i.Matrix4)().makeScale(.001,.001,.001);r.applyMatrix4(o)}else{let n=e.rotation.x,o=e.rotation.y,a=e.rotation.z,l=this.getWorldRotation(e);e.rotation.set(0,0,0);let h=new i.Vector3;e.updateWorldMatrix(!0),e.getWorldPosition(h);let c=new i.Box3,d=new s.OBB,u=c.setFromObject(e);e.rotation.set(n,o,a);let p=d.fromBox3(u),m=2*p.halfSize.x,f=2*p.halfSize.y,g=2*p.halfSize.z;if("CodeModel"!=e.modelType){let t=e.clone(),r=new(0,i.Vector3)().setFromMatrixScale(e.matrixWorld);t.scale.copy(r),t.rotation.set(0,0,0);let n=c.setFromObject(t),o=d.fromBox3(n);m=2*o.halfSize.x,f=2*o.halfSize.y,g=2*o.halfSize.z}if((r=this.obbBoxMain(m,f,g,t)).position.set(h.x,h.y+.01,h.z),"CodeModel"==e.modelType){if(r.rotation.set(n,a,Math.PI-o),r.position.y=e.position.z/1e3+.01,"PanoramicWindowMesh"==e.type){let t=new i.Vector3(0,1,0);t.applyEuler(new i.Euler(e.rotation.x,0,0,"XYZ")),t.applyEuler(new i.Euler(0,e.rotation.y,0,"XYZ")),t.applyEuler(new i.Euler(0,0,e.rotation.z,"XYZ")),t.setLength(-g/4),r.position.add(t)}}else r.rotation.set(l.x,l.y,l.z);r.width=m,r.height=f,r.depth=g,r.rot=l}return r}addOBBDotBox(e,t=window.editor.config.boxLineColor){let r=e.rotation.x,n=e.rotation.y,o=e.rotation.z;e.rotation.set(0,0,0);let a=new(0,i.Box3)().setFromObject(e);e.rotation.set(r,n,o);let l=new(0,s.OBB)().fromBox3(a),h=this.obbBoxMain(2.5*l.halfSize.x,2.5*l.halfSize.y,2.5*l.halfSize.z,t,"dash");return h.position.set(l.center.x,l.center.y+.01,l.center.z),h.rotation.set(r,n,o),h}obbBoxMain(e,t,r,n=window.editor.config.boxLineColor,o="line"){let a=new i.Vector3(e/2,-t/2,-r/2),s=new i.Vector3(e/2,-t/2,r/2),d=new i.Vector3(-e/2,-t/2,r/2),u=new i.Vector3(-e/2,-t/2,-r/2),p=new i.Vector3(e/2,t/2,-r/2),m=new i.Vector3(e/2,t/2,r/2),f=new i.Vector3(-e/2,t/2,r/2),g=new i.Vector3(-e/2,t/2,-r/2),y=[];[a,s,d,u,a,p,m,s,m,f,d,f,g,u,g,p].forEach(e=>{y.push(e.x,e.y,e.z)});var x=new(0,l.LineGeometry)().setPositions(y),w=new h.LineMaterial({color:n,linewidth:window.editor.config.boxLineWidth,side:i.DoubleSide});"line"!=o&&(w=new h.LineMaterial({color:0,dashScale:20,side:i.DoubleSide,dashed:!0})),w.resolution.set(window.innerWidth,window.innerHeight);var b=new c.Line2(x,w);return b.computeLineDistances(),b.renderOrder=100,b}addRotateTool(e,t=1500){let r=0,n=0,o="#6495ED",a=new i.Group,s=this.getMeshCenter(e),l=100;for(;r<8;){let e=this.makeRotateToolGem(s,n+Math.PI/180,2*Math.PI/8*(r+1),t,o,l);n=2*Math.PI/8*(r+1),r++,a.add(e)}return a.useType="rotateClock",a.arcCenter=s,a.arcRadio=t,a}makeRotateToolGem(e,t,r,o,a,s,l=!1){let h=(0,n.Stroke)({thickness:140});var c=new i.EllipseCurve(e.x,e.y,o,o,t,r,!1,0).getPoints(50),d=[];c.forEach(function(e){d.push([e.x,e.y])});var u=h.build(d);u=this.process(d,u);var p=[];u.positions.forEach(function(e){p.push(e[0],e[1],0)});var m=[];u.cells.forEach(function(e){m.push(e[0],e[1],e[2])});var f=new i.BufferGeometry;f.attributes.position=new i.BufferAttribute(new Float32Array(p),3),f.index=new i.BufferAttribute(new Uint16Array(m),1);var g=new i.MeshBasicMaterial({color:a,side:i.DoubleSide,depthTest:!1,transparent:!0,opacity:1}),u=new i.Mesh(f,g);u.position.z=20,u.renderOrder=99;let y=new i.Group;if(y.add(u),l){u.useType="rotateTool",y.useType="rotateTool";var x=new i.Vector3(d[0][0],d[0][1],0),w=new i.Vector3(d[1][0],d[1][1],0);let e=x.clone().sub(w.clone());e.normalize();var b=200,v=new i.ArrowHelper(e,x,b,a,2.5*s,2.5*s),M=new i.Vector3(d[d.length-1][0],d[d.length-1][1],0),S=new i.Vector3(d[d.length-2][0],d[d.length-2][1],0);let t=M.clone().sub(S.clone());t.normalize();var P=new i.ArrowHelper(t,M,b,a,2.5*s,2.5*s);v.position.z=10,P.position.z=10,y.add(v),y.add(P)}return y.startAngle=t,y.endAngle=r,y.arcCenter=e,y.arcRadio=o,y}process(e,t,r=[]){return t.innner=[],t.outter=[],e.forEach(function(e){r.push(new i.Vector2(e[0],e[1]))}),t.clock=(0,o.ShapeUtils).isClockWise(r),t.positions.forEach(function(e,i){i%2==0?t.clock?t.innner.push(e):t.outter.push(e):t.clock?t.outter.push(e):t.innner.push(e)}),t}getModelVertex(e,t=1){let r=e.parent;e.modelType&&e.modelType.indexOf("Model")>=0&&(r=e),r.updateWorldMatrix(!0,!0);let n=r.clone();n.scale.set(1,1,1),n.rotation.set(0,0,0);let o=new(0,i.Box3)().setFromObject(n),a=new(0,s.OBB)().fromBox3(o),l=1*a.halfSize.x.toFixed(2)*t,h=1*a.halfSize.y.toFixed(2)*t;r.width&&(l=1*r.width/2*t,h=1*r.height/2*t),r.realWidth&&(l=1*r.realWidth/2);let c=[new i.Vector3(-l,h,0),new i.Vector3(-l,-h,0),new i.Vector3(l,-h,0),new i.Vector3(l,h,0),new i.Vector3(-l,0,0),new i.Vector3(0,-h,0),new i.Vector3(0,h,0),new i.Vector3(l,0,0)],d=e.parent;e.modelType&&e.modelType.indexOf("Model")>=0&&(d=e),d.updateWorldMatrix(!0,!1);for(let e=0;e<c.length;e++){let t=d.localToWorld(c[e]);t.z=.1,c[e]=t}return c}}}),parcelRequire.register("fAsY2",function(e,t){$parcel$export(e.exports,"ShapeUtils",()=>r);var i=parcelRequire("erc0q");class r{static area(e){let t=e.length,i=0;for(let r=t-1,n=0;n<t;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return .5*i}static isClockWise(e){return 0>r.area(e)}static triangulateShape(e,t){let r=[],a=[],s=[];n(e),o(r,e);let l=e.length;t.forEach(n);for(let e=0;e<t.length;e++)a.push(l),l+=t[e].length,o(r,t[e]);let h=(0,i.Earcut).triangulate(r,a);for(let e=0;e<h.length;e+=3)s.push(h.slice(e,e+3));return s}}function n(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function o(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}}),parcelRequire.register("erc0q",function(e,t){$parcel$export(e.exports,"Earcut",()=>i);let i={triangulate:function(e,t,i=2){let n,a,s,l,h,d,u;let p=t&&t.length,m=p?t[0]*i:e.length,f=r(e,0,m,i,!0),g=[];if(!f||f.next===f.prev)return g;if(p&&(f=c(e,t,f,i)),e.length>80*i){n=s=e[0],a=l=e[1];for(let t=i;t<m;t+=i)h=e[t],d=e[t+1],h<n&&(n=h),d<a&&(a=d),h>s&&(s=h),d>l&&(l=d);u=0!==(u=Math.max(s-n,l-a))?1/u:0}return o(f,g,i,n,a,u),g}};function r(e,t,i,r,n){let o,a;if(n===R(e,t,i,r)>0)for(o=t;o<i;o+=r)a=E(o,e[o],e[o+1],a);else for(o=i-r;o>=t;o-=r)a=E(o,e[o],e[o+1],a);return a&&M(a,a.next)&&(L(a),a=a.next),a}function n(e,t){if(!e)return e;t||(t=e);let i=e,r;do if(r=!1,!i.steiner&&(M(i,i.next)||0===v(i.prev,i,i.next))){if(L(i),(i=t=i.prev)===i.next)break;r=!0}else i=i.next;while(r||i!==t)return t}function o(e,t,i,r,c,d,u){if(!e)return;!u&&d&&f(e,r,c,d);let p=e,m,g;for(;e.prev!==e.next;){if(m=e.prev,g=e.next,d?s(e,r,c,d):a(e)){t.push(m.i/i),t.push(e.i/i),t.push(g.i/i),L(e),e=g.next,p=g.next;continue}if((e=g)===p){u?1===u?o(e=l(n(e),t,i),t,i,r,c,d,2):2===u&&h(e,t,i,r,c,d):o(n(e),t,i,r,c,d,1);break}}}function a(e){let t=e.prev,i=e,r=e.next;if(v(t,i,r)>=0)return!1;let n=e.next.next;for(;n!==e.prev;){if(w(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&v(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function s(e,t,i,r){let n=e.prev,o=e,a=e.next;if(v(n,o,a)>=0)return!1;let s=n.x<o.x?n.x<a.x?n.x:a.x:o.x<a.x?o.x:a.x,l=n.y<o.y?n.y<a.y?n.y:a.y:o.y<a.y?o.y:a.y,h=n.x>o.x?n.x>a.x?n.x:a.x:o.x>a.x?o.x:a.x,c=n.y>o.y?n.y>a.y?n.y:a.y:o.y>a.y?o.y:a.y,d=y(s,l,t,i,r),u=y(h,c,t,i,r),p=e.prevZ,m=e.nextZ;for(;p&&p.z>=d&&m&&m.z<=u;){if(p!==e.prev&&p!==e.next&&w(n.x,n.y,o.x,o.y,a.x,a.y,p.x,p.y)&&v(p.prev,p,p.next)>=0||(p=p.prevZ,m!==e.prev&&m!==e.next&&w(n.x,n.y,o.x,o.y,a.x,a.y,m.x,m.y)&&v(m.prev,m,m.next)>=0))return!1;m=m.nextZ}for(;p&&p.z>=d;){if(p!==e.prev&&p!==e.next&&w(n.x,n.y,o.x,o.y,a.x,a.y,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=u;){if(m!==e.prev&&m!==e.next&&w(n.x,n.y,o.x,o.y,a.x,a.y,m.x,m.y)&&v(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function l(e,t,i){let r=e;do{let n=r.prev,o=r.next.next;!M(n,o)&&S(n,r,r.next,o)&&C(n,o)&&C(o,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(o.i/i),L(r),L(r.next),r=e=o),r=r.next}while(r!==e)return n(r)}function h(e,t,i,r,a,s){let l=e;do{let e=l.next.next;for(;e!==l.prev;){if(l.i!==e.i&&b(l,e)){let h=A(l,e);l=n(l,l.next),h=n(h,h.next),o(l,t,i,r,a,s),o(h,t,i,r,a,s);return}e=e.next}l=l.next}while(l!==e)}function c(e,t,i,o){let a,s,l,h,c;let p=[];for(a=0,s=t.length;a<s;a++)l=t[a]*o,h=a<s-1?t[a+1]*o:e.length,(c=r(e,l,h,o,!1))===c.next&&(c.steiner=!0),p.push(x(c));for(p.sort(d),a=0;a<p.length;a++)u(p[a],i),i=n(i,i.next);return i}function d(e,t){return e.x-t.x}function u(e,t){if(t=p(e,t)){let i=A(t,e);n(t,t.next),n(i,i.next)}}function p(e,t){let i=t,r=e.x,n=e.y,o=-1/0,a;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){let e=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=r&&e>o){if(o=e,e===r){if(n===i.y)return i;if(n===i.next.y)return i.next}a=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t)if(!a)return null;if(r===o)return a;let s=a,l=a.x,h=a.y,c=1/0,d;i=a;do r>=i.x&&i.x>=l&&r!==i.x&&w(n<h?r:o,n,l,h,n<h?o:r,n,i.x,i.y)&&(d=Math.abs(n-i.y)/(r-i.x),C(i,e)&&(d<c||d===c&&(i.x>a.x||i.x===a.x&&m(a,i)))&&(a=i,c=d)),i=i.next;while(i!==s)return a}function m(e,t){return 0>v(e.prev,e,t.prev)&&0>v(t.next,e,e.next)}function f(e,t,i,r){let n=e;do null===n.z&&(n.z=y(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e)n.prevZ.nextZ=null,n.prevZ=null,g(n)}function g(e){let t,i,r,n,o,a,s,l,h=1;do{for(i=e,e=null,o=null,a=0;i;){for(a++,r=i,s=0,t=0;t<h&&(s++,r=r.nextZ);t++);for(l=h;s>0||l>0&&r;)0!==s&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,s--):(n=r,r=r.nextZ,l--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=r}o.nextZ=null,h*=2}while(a>1)return e}function y(e,t,i,r,n){return(e=((e=((e=((e=((e=32767*(e-i)*n)|e<<8)&16711935)|e<<4)&252645135)|e<<2)&858993459)|e<<1)&1431655765)|(t=((t=((t=((t=((t=32767*(t-r)*n)|t<<8)&16711935)|t<<4)&252645135)|t<<2)&858993459)|t<<1)&1431655765)<<1}function x(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e)return i}function w(e,t,i,r,n,o,a,s){return(n-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(r-s)-(i-a)*(t-s)>=0&&(i-a)*(o-s)-(n-a)*(r-s)>=0}function b(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!_(e,t)&&(C(e,t)&&C(t,e)&&D(e,t)&&(v(e.prev,e,t.prev)||v(e,t.prev,t))||M(e,t)&&v(e.prev,e,e.next)>0&&v(t.prev,t,t.next)>0)}function v(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function M(e,t){return e.x===t.x&&e.y===t.y}function S(e,t,i,r){let n=T(v(e,t,i)),o=T(v(e,t,r)),a=T(v(i,r,e)),s=T(v(i,r,t));return!!(n!==o&&a!==s||0===n&&P(e,i,t)||0===o&&P(e,r,t)||0===a&&P(i,e,r)||0===s&&P(i,t,r))}function P(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function T(e){return e>0?1:e<0?-1:0}function _(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&S(i,i.next,e,t))return!0;i=i.next}while(i!==e)return!1}function C(e,t){return 0>v(e.prev,e,e.next)?v(e,t,e.next)>=0&&v(e,e.prev,t)>=0:0>v(e,t,e.prev)||0>v(e,e.next,t)}function D(e,t){let i=e,r=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e)return r}function A(e,t){let i=new I(e.i,e.x,e.y),r=new I(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function E(e,t,i,r){let n=new I(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function L(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function I(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function R(e,t,i,r){let n=0;for(let o=t,a=i-r;o<i;o+=r)n+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return n}}),parcelRequire.register("9HO6e",function(e,t){$parcel$export(e.exports,"UtilCore",()=>r);var i=parcelRequire("4xklQ");class r{static createCenterLine(e,t){var r=new i.LineBasicMaterial({color:"#00FFFF",depthTest:!1}),n=new i.BufferGeometry;n.setFromPoints([new i.Vector3(t.x,t.y,0),new i.Vector3(e.x,e.y,0)]);var o=new i.Line(n,r);return o.renderOrder=4,o}static createPointHelper(e,t){let n=80,o=new i.Group;var a=new i.CircleGeometry(n,32),s=new i.MeshBasicMaterial({color:"#27408B",transparent:!0}),l=new i.CircleGeometry(n+10,32),h=new i.MeshBasicMaterial({color:16777215,depthTest:!1,transparent:!0}),c=new i.Mesh(a,s),d=new i.Mesh(l,h);return c.position.set(e.x,e.y,20),d.position.set(e.x,e.y,20),c.renderOrder=8,d.renderOrder=7,o.add(c),o.add(d),t&&o.add(r.createCenterLine(e,t)),o}static smallDistanceByPointOnLine(e,t){if("X"==e[0])return new i.Vector2(t.x,e[2]);{if("Y"==e[0])return new i.Vector2(e[2],t.y);let r=-1/e[1],n=t.y-r*t.x,o=(n-e[2])/(e[1]-r),a=r*o+n;return new i.Vector2(o,a)}}static get3dWallDistance(e,t){let n=r.handleLineData(t.startPoint,t.endPoint),o=new i.Vector3(e.x,-e.z,e.y),a=r.smallDistanceByPointOnLine(n,o);return r.pointIsInLine(a,t.startPoint,t.endPoint)?[a.clone().distanceTo(o.clone()),a=new i.Vector3(a.x,e.y,-a.y)]:[]}static getAllSpecialPoint(e){let t=[],i=e.allWalls;return(i=i.concat(e.splitRoomLineGroup.children)).forEach(e=>{e.startPoint&&t.push([e.startPoint,e.endPoint])}),t}static getCurrentArea(e,t,i){let r,n,o=e.x;return"y"==i&&(o=e.y),o>=0?o<t?(r=0,n=t):(r=parseInt(o/t)*t,n=parseInt(o/t)*t+t):o<0&&(Math.abs(o)<t?(r=-t,n=0):(r=parseInt(o/t)*t-t,n=parseInt(o/t)*t)),[r,n]}static handleOrthogonalPoint(e,t){return Math.abs(e.x-t.x)>=Math.abs(e.y-t.y)?t.y=e.y:t.x=e.x,t}static handleSpecialPoint(e,t,n){if(n.pointHelpGroup.children=[],!n.adsorbentModel)return e;let o="";if("free"!=n.toolType||n.currentDownSelect.length>0){let t=r.getCurrentArea(e,n.gridProportion,"x"),a=r.getCurrentArea(e,n.gridProportion,"y"),s=new i.Vector2(e.x,e.y),l=[new i.Vector2(t[0],a[0]),new i.Vector2(t[1],a[0]),new i.Vector2(t[1],a[1]),new i.Vector2(t[0],a[1])],h=[];l.forEach(e=>{h.push(s.clone().distanceTo(e.clone()))}),50>=Math.min.apply(null,h)&&(o=l[h.indexOf(Math.min.apply(null,h))])}let a=e.clone();if(0==t.length){""!=o&&(a=o),Math.abs(a.x-n.startPoint.x)<n.config.pointArea-90&&(a.x=n.startPoint.x),Math.abs(a.y-n.startPoint.y)<n.config.pointArea-90&&(a.y=n.startPoint.y);let e=r.createPointHelper(a,n.startPoint);return n.pointHelpGroup.add(e),a}let s={center:[],points:[],isCenter:!1,alreadyPoint:[]};""!=o&&(s.isCenter=!0,s.center[0]=o);let l=!1,h=!1;if(t.forEach(t=>{let c=r.handleLineData(t[0],t[1]),d=r.smallDistanceByPointOnLine(c,e.clone()),u=d.clone().distanceTo(e.clone());if(h)return;let p=r.toVector3(t[0]).distanceTo(e.clone()),m=r.toVector3(t[1]).distanceTo(e.clone()),f="";if(p<240&&(f=t[0].clone()),m<240&&(f=t[1].clone()),""!=f){a=f.clone(),s.isCenter=!0,s.center[0]=a,h=!0;return}if(""!=o)return;let g=[];if(u<n.config.pointArea){a=d;let e=t[0].clone().distanceTo(a.clone()),r=t[1].clone().distanceTo(a.clone());(e<n.config.pointArea||r<n.config.pointArea)&&(e<n.config.pointArea&&(a=t[0].clone()),r<n.config.pointArea&&(a=t[1].clone())),g[0]=t[0],e>r&&(g[0]=t[1]),80>=Math.abs(e-r)&&(a=new i.Vector2((t[0].x+t[1].x)/2,(t[0].y+t[1].y)/2),s.isCenter=!0),s.center[0]=a,l=!0,s.alreadyPoint.push(t[0]),s.alreadyPoint.push(t[1])}else{let e=[],o=!0,h=!0;s.alreadyPoint.forEach(e=>{r.isSameVector(t[0],e)&&(o=!1),r.isSameVector(t[1],e)&&(h=!1)}),Math.abs(t[0].x-a.x)<n.config.pointArea-90&&o&&(a.x=t[0].x,e=["x",t[0].x]),Math.abs(t[0].y-a.y)<n.config.pointArea-90&&o&&(a.y=t[0].y,e=["y",t[0].y]),Math.abs(t[1].x-a.x)<n.config.pointArea-90&&h&&(a.x=t[1].x,e=["x",t[1].x]),Math.abs(t[1].y-a.y)<n.config.pointArea-90&&h&&(a.y=t[1].y,e=["y",t[1].y]),(.1>Math.abs(t[0].x-a.x)&&o||.1>Math.abs(t[0].y-a.y)&&o)&&g.push(t[0]),(.1>Math.abs(t[1].x-a.x)&&h||.1>Math.abs(t[1].y-a.y)&&h)&&g.push(t[1]),a=new i.Vector2(a.x,a.y),l?0!=e.length&&("x"==e[0]&&(s.center[0].x=e[1]),"y"==e[0]&&(s.center[0].y=e[1])):s.center[0]=a}r.isSameVector(a,e)||g.forEach(e=>{let t=!0,i=0;s.points.forEach(n=>{let o=r.handleLineData(s.center[0],n),a=r.handleLineData(s.center[0],e);if(o[0]==a[0]&&o[1]==a[1]&&o[2]==a[2]){let r=s.center[0].clone().distanceTo(n.clone());s.center[0].clone().distanceTo(e.clone())<r&&(s.points[i]=e),t=!1}i++}),t&&s.points.push(e)})}),"free"!=n.toolType){if(s.isCenter){let e=r.createPointHelper(s.center[0],"");n.pointHelpGroup.add(e)}else s.points.forEach(e=>{let t=r.createPointHelper(s.center[0],e);n.pointHelpGroup.add(t)})}return a}static handleLineData(e,t){let i="",r="",n="";return 1>Math.abs(e.x-t.x)?(i="Y",n=e.x):1>Math.abs(e.y-t.y)?(i="X",n=e.y):(i="XY",r=(t.y-e.y)/(t.x-e.x),n=t.y-r*t.x),[i,r,n]}static lineIsIntersection(e,t){if("X"==e[0]){if("X"==t[0])return!1;{if("Y"==t[0])return new i.Vector2(t[2],e[2]);let r=(e[2]-t[2])/t[1];return new i.Vector2(r,e[2])}}if("Y"==e[0]){if("X"==t[0])return new i.Vector2(e[2],t[2]);{if("Y"==t[0])return!1;let r=t[1]*e[2]+t[2];return new i.Vector2(e[2],r)}}if("X"==t[0])return new i.Vector2((t[2]-e[2])/e[1],t[2]);{if("Y"==t[0])return new i.Vector2(t[2],t[2]*e[1]+e[2]);if(.01>Math.abs(e[1]-t[1]))return!1;let r=(t[2]-e[2])/(e[1]-t[1]),n=e[1]*r+e[2];return new i.Vector2(r,n)}}static pointInLine(e,t){let i=!1;if("X"==t[0])i=.1>Math.abs(e.y-t[2]);else if("Y"==t[0])i=.1>Math.abs(e.x-t[2]);else{let r=t[1]*e.x+t[2];i=.1>Math.abs(e.y-r)}return i}static pointIsInLine(e,t,i,r=1){let n=1*Math.min(t.x,i.x).toFixed(2),o=1*Math.min(t.y,i.y).toFixed(2),a=1*Math.max(t.x,i.x).toFixed(2),s=1*Math.max(t.y,i.y).toFixed(2),l=1*e.x.toFixed(2)>=n-r,h=1*e.x.toFixed(2)<=a+r,c=1*e.y.toFixed(2)>=o-r,d=1*e.y.toFixed(2)<=s+r;return l&&h&&c&&d}static getLinkRealWall(e,t,i){let n=i.clone().sub(t).angle(),o="",a="",s="",l="";return(e.forEach(e=>{if(r.checkSameWallByPoint(t,i,e.startPoint,e.endPoint))return;let h=r.getMeshOtherPoint(e,t),c=h.clone().sub(t).angle(),d=r.getClockWise(i,t,h),u=Math.abs(n-c);d<0?""==o?(a=u,o=e):u<a&&(a=u,o=e):""==s?(l=u,s=e):u<l&&(l=u,s=e)}),o||s)?o&&!s?[o]:!o&&s?[s]:o&&s?[o,s]:void 0:[]}static checkPointIsInLine(e,t,i){let n=r.handleLineData(t,i);return r.pointInLine(e,n)}static getRealWallByIntersection(e,t,n,o,a){let s=e.endPoint.clone().sub(e.startPoint.clone());"end"==a&&(s=e.startPoint.clone().sub(e.endPoint.clone()));let l=new i.Vector3(s.x,s.y,0),h=[],c=[],d=r.getMeshOtherPoint(e,o),u=r.getClockWise(d,o,t);r.pointMoveDir(t,e.startPoint,e.endPoint);let p=r.handleLineData(e.startPoint,e.endPoint);return(n.forEach(e=>{let t=r.getMeshOtherPoint(e,o);!(r.getClockWise(d,o,t)*u<0)&&(r.pointInLine(t,p)||c.push(e))}),0==c.length)?(n.forEach(e=>{let t=r.getMeshOtherPoint(e,o).clone().sub(o.clone()),n=new i.Vector3(t.x,t.y,0),a=l.angleTo(n);h.push(a)}),n[h.indexOf(Math.min.apply(null,h))]):(c.forEach(e=>{let t=r.getMeshOtherPoint(e,o).clone().sub(o.clone()),n=new i.Vector3(t.x,t.y,0),a=l.angleTo(n);h.push(a)}),c[h.indexOf(Math.min.apply(null,h))])}static getRealWallByPosition(e,t,i){let n="";return i.forEach(i=>{let o=r.isSameVector(e,i.startPoint)||r.isSameVector(e,i.endPoint),a=r.isSameVector(t,i.startPoint)||r.isSameVector(t,i.endPoint);o&&a&&(n=i)}),n}static toVector3(e){return new i.Vector3(e.x,e.y,0)}static toVector2(e){return new i.Vector2(e.x,e.y)}static getMeshOtherPoint(e,t){let i=e.startPoint;return 20>Math.abs(t.x-e.startPoint.x)&&20>Math.abs(t.y-e.startPoint.y)&&(i=e.endPoint),i}static pointMoveDir(e,t,i){let n=r.handleLineData(t,i),o="";if("X"==n[0])o=e.y>=n[2]?"Y":"-Y";else if("Y"==n[0])o=e.x>=n[2]?"X":"-X";else{let t=n[1]*e.x+n[2];o=e.y>=t?"Y":"-Y"}return o}static getDistanceLine(e,t){return"X"==e[0]||"Y"==e[0]?Math.abs(e[2]-t[2]):Math.abs(e[2]-t[2])/Math.sqrt(e[1]*e[1]+1)}static checkHaveSameVertex(e,t){let i=e.startPoint,n=e.endPoint,o=t.startPoint,a=t.endPoint,s=r.isSameVector(i,o)||r.isSameVector(i,a),l=r.isSameVector(n,o)||r.isSameVector(n,a);return s||l}static getSamePointTwoWall(e,t){let i=t.startPoint,n=t.endPoint,o=e.startPoint,a=e.endPoint,s=r.isSameVector(i,o),l=r.isSameVector(i,a),h=r.isSameVector(n,o),c=r.isSameVector(n,a);return(!!s||!!l||!!h||!!c)&&(s||l?i:h||c?n:void 0)}static getSamePointWall(e,t){let i=[];return t.forEach(t=>{e.wallID!=t.wallID&&t.startPoint&&r.checkHaveSameVertex(e,t)&&i.push(t)}),i}static checkSameWall(e,t){let i=e.startPoint,n=e.endPoint,o=t.startPoint,a=t.endPoint,s=r.isSameVector(i,o)||r.isSameVector(i,a),l=r.isSameVector(n,o)||r.isSameVector(n,a);return s&&l}static checkSameWallByPoint(e,t,i,n){let o=r.isSameVector(e,i)||r.isSameVector(e,n),a=r.isSameVector(t,i)||r.isSameVector(t,n);return o&&a}static wallIsInLine(e,t){let i=r.getSamePointTwoWall(e,t);if(!i)return!1;let n=r.getMeshOtherPoint(e,i),o=r.getMeshOtherPoint(t,i);return r.checkWallContainPoint(i.x,i.y,n.x,n.y,o.x,o.y)}static checkContainWall(e,t,i,n){let o=r.handleLineData(e,t),a=r.handleLineData(i,n);if(o[0]==a[0]&&.1>Math.abs(o[1]-a[1])&&.1>Math.abs(o[2]-a[2])){let o=r.isSameVector(e,i),a=r.isSameVector(e,n),s=r.isSameVector(t,i),l=r.isSameVector(t,n);if((o||s)&&r.pointIsInLine(n,e,t)||(a||l)&&r.pointIsInLine(i,e,t))return!0}return!1}static getSamePositionWall(e,t){let i=[];return t.forEach(t=>{r.checkSameWall(e,t)&&i.push(t)}),i}static havePointWall(e,t,i=""){let n=[];return t.forEach(t=>{if(""!=i&&t.uuid==i.uuid)return;let o=r.isSameVector(e,t.startPoint),a=r.isSameVector(e,t.endPoint);(o||a)&&n.push(t)}),n}static getWallMoveRule(e,t,i){let n=r.havePointWall(e.startPoint,t,e),o=r.havePointWall(e.endPoint,t,e),a=r.getRealWallByIntersection(e,i.currentPoint.clone(),n,e.startPoint,"start"),s=r.getRealWallByIntersection(e,i.currentPoint.clone(),o,e.endPoint,"end"),l="",h="";a&&(l=r.getSamePointTwoWall(e,a)),s&&(h=r.getSamePointTwoWall(e,s));let c=e.clone();return c.startPoint=e.startPoint.clone(),c.endPoint=e.endPoint.clone(),[a,s,n,o,l,h,c]}static checkWallContainPoint(e,t,n,o,a,s){if(e<Math.min(n,a)||e>Math.max(n,a)||t<Math.min(o,s)||t>Math.max(o,s))return!1;let l=new i.Vector3(e,t,0),h=new i.Vector3(n,o,0),c=new i.Vector3(a,s,0),d=h.distanceTo(c),u=h.distanceTo(l),p=c.distanceTo(l);return!(r.isSameVector(l,h)||r.isSameVector(l,c))&&.01>Math.abs(d-(u+p))}static checkWallContainPointNew(e,t,i){let n=r.handleLineData(e,t),o=r.pointInLine(i,n),a=r.pointIsInLine(i,e,t);return o&&a}static getAllIntersectionWall(e,t,i,n){let o=e.startPoint,a=e.endPoint,s=n.currentPoint,l=r.handleLineData(o,a),h=[[],[],"","",!1,!1],c="",d="",u=[],p=[];t.forEach(e=>{let t=e.startPoint,n=e.endPoint;if(r.isSameVector(t,o)&&r.isSameVector(n,a))return;let s=r.handleLineData(t,n),h=r.lineIsIntersection(l,s);if(!h){let e=r.isSameVector(o,t)||o.clone().distanceTo(t.clone())<i,s=r.isSameVector(o,n)||o.clone().distanceTo(n.clone())<i,l=r.isSameVector(a,t)||a.clone().distanceTo(t.clone())<i,h=r.isSameVector(a,n)||a.clone().distanceTo(n.clone())<i;if(!(e||s||l||h))return;e&&(c=t),s&&(c=n),l&&(d=t),h&&(d=n);return}let m=r.isSameVector(h,o),f=r.isSameVector(h,a);if(!(m||f))return;m&&u.push(e),f&&p.push(e);let g=h.clone().distanceTo(t.clone()),y=h.clone().distanceTo(n.clone());if(g<i+2||y<i+2){let t=e.startPoint;y<g&&(t=e.endPoint);let r=[e.startPoint,e.endPoint],n=[g,y],s=Math.max.apply(null,n);s<i+10&&(t=r[n.indexOf(s)]);let l=t.clone().distanceTo(o.clone()),h=t.clone().distanceTo(a.clone());l<h&&(c=t),l>h&&(d=t)}});let m=r.moveLineToPoint(s,l.slice(0));if(u.length>=1){let t="";if(u.forEach(i=>{r.pointInLine(e.startPoint,r.handleLineData(i.startPoint,i.endPoint))&&r.pointIsInLine(e.startPoint,i.startPoint,i.endPoint)&&(t=i)}),""!=t){let i=t.startPoint,o=t.endPoint,a=r.handleLineData(i,o),s=r.lineIsIntersection(a,m);if(s&&!r.pointIsInLine(s,i,o)){let a=s.clone().distanceTo(i.clone())<s.clone().distanceTo(o.clone())?i:o;if(""!=c&&r.isSameVector(a,c))c=a;else{c=a;let i=t.parent;i&&r.checkHaveSameVertex(t,e)&&(i.remove(t),n.removeHelperByWall(t),n.allWalls.indexOf(t)>=0&&n.allWalls.splice(n.allWalls.indexOf(t),1))}}}}if(p.length>=1){let t="";if(p.forEach(i=>{r.pointInLine(e.endPoint,r.handleLineData(i.startPoint,i.endPoint))&&r.pointIsInLine(e.endPoint,i.startPoint,i.endPoint)&&(t=i)}),""!=t){let i=t.startPoint,o=t.endPoint,a=r.handleLineData(i,o),s=r.lineIsIntersection(a,m);if(s&&!r.pointIsInLine(s,i,o)){let a=s.clone().distanceTo(i.clone())<s.clone().distanceTo(o.clone())?i:o;if(""!=d&&r.isSameVector(a,d))d=a;else{d=a;let i=t.parent;i&&r.checkHaveSameVertex(t,e)&&(i.remove(t),n.removeHelperByWall(t),n.allWalls.indexOf(t)>=0&&n.allWalls.splice(n.allWalls.indexOf(t),1))}}}}return t.forEach(e=>{let t=e.startPoint,i=e.endPoint;if(o!=t||a!=i){if(c){let n=r.isSameVector(c,t),o=r.isSameVector(c,i);(n||o)&&h[0].push(e)}if(d){let n=r.isSameVector(d,t),o=r.isSameVector(d,i);(n||o)&&h[1].push(e)}if(!c||!d){let n=r.handleLineData(t,i),s=r.lineIsIntersection(l,n);if(s&&r.pointIsInLine(s,t,i)){let t=r.isSameVector(s,o),i=r.isSameVector(s,a);t&&!c&&(h[0].push(e),h[2]=s),i&&!d&&(h[1].push(e),h[3]=s)}}}}),c&&(h[2]=c,h[4]=!0),d&&(h[3]=d,h[5]=!0),h}static isSameVector(e,t){return 1>Math.abs(e.x-t.x)&&1>Math.abs(e.y-t.y)}static isMobileSameVector(e,t,i=!0){return i?.1>Math.abs(e.x-t.x)&&.1>Math.abs(e.y-t.y):.1>Math.abs(Math.abs(e.x)-Math.abs(t.x))&&.1>Math.abs(Math.abs(e.y)-Math.abs(t.y))}static moveLineToPoint(e,t){return"X"==t[0]?t[2]=e.y:"Y"==t[0]?t[2]=e.x:t[2]=e.y-t[1]*e.x,t}static getModelVertex(e){let t=new(0,i.Box3)().setFromObject(e),r=1*(t.max.x-t.min.x).toFixed(2)/2,n=1*(t.max.y-t.min.y).toFixed(2)/2;e.width&&(r=1*e.width/2,n=1*e.height/2);let o=[new i.Vector3(-r,n,0),new i.Vector3(-r,-n,0),new i.Vector3(r,-n,0),new i.Vector3(r,n,0),new i.Vector3(-r,0,0),new i.Vector3(0,-n,0),new i.Vector3(0,n,0),new i.Vector3(r,0,0)];e.updateWorldMatrix(!0,!1);for(let t=0;t<o.length;t++){let i=e.localToWorld(o[t]);o[t]=i}return o}static updateLineDimensionsLine(e){if(!e.config.settingJson.dimension)return;let t=e.allWalls.slice(0),n=[],o=[];if(t.forEach(t=>{let a=t.geometry.attributes.position.array,s=new i.Vector2(a[0],a[1]),l=new i.Vector2(a[9],a[10]),h=t.startPoint,c=t.endPoint,d=Math.round(h.clone().distanceTo(c.clone())),u=Math.round(s.clone().distanceTo(l.clone()));if(0>n.indexOf(t.startPoint.x)&&n.push(t.startPoint.x),0>n.indexOf(t.endPoint.x)&&n.push(t.endPoint.x),0>o.indexOf(t.startPoint.y)&&o.push(t.startPoint.y),0>o.indexOf(t.endPoint.y)&&o.push(t.endPoint.y),t.isArc){e.removeHelperByWall(t,!1);return}if(0!=t.roomCenter){let n=new i.Vector2(a[0],a[1]),o=new i.Vector2(a[6],a[7]),s=new i.Vector2(a[9],a[10]),l=new i.Vector2(a[15],a[16]);t.roomCenter.forEach(a=>{let d=new i.Vector2(a[0],a[1]),u=r.handleLineData(n,s),p=r.smallDistanceByPointOnLine(u,d.clone()),m=r.handleLineData(o,l),f=r.smallDistanceByPointOnLine(m,d.clone()),g=p.clone().distanceTo(d.clone()),y=f.clone().distanceTo(d.clone()),x=n,w=s,b=160;g>y&&(x=o,w=l,b=-160),e.removeHelperByWall(t,!1),e.addLineWallHelper(h,c,!1,x,w,b)});return}if(Math.abs(d-u)>.1)e.removeHelperByWall(t,!1),e.addLineWallHelper(h,c,!1,s,l);else{let i=e.getWallHelperByWall(t);i&&Math.abs(i.lineLength-d)>.1&&(e.removeHelperByWall(t,!1),e.addLineWallHelper(h,c)),i||e.addLineWallHelper(h,c)}}),0==n.length||0==e.floorGroup2d.children.length)return;let a=Math.min.apply(null,n),s=Math.max.apply(null,n),l=Math.min.apply(null,o),h=Math.max.apply(null,o),c=1500,d=e.helperGroup.children.slice(0);d.forEach(t=>{"outerLine"==t.useType&&(e.removeInputByClassName(e.uiPanelBox.dom,"showWallLength"+t.uuid),e.helperGroup.remove(t))}),(d=[e.addLineWallHelper(new i.Vector2(a-c,h),new i.Vector2(a-c,l),!1),e.addLineWallHelper(new i.Vector2(a,l-c),new i.Vector2(s,l-c),!1),e.addLineWallHelper(new i.Vector2(s+c,l),new i.Vector2(s+c,h),!1),e.addLineWallHelper(new i.Vector2(a,h+c/2),new i.Vector2(s,h+c/2),!1)]).forEach(e=>{e.useType="outerLine"}),e.camera.isOrthographicCamera&&e.autoShowHidden(e.camera.zoom)}static getLineData(e,t,r){let n,o;e.x==t.x?(n="X",o=e.x):e.y==t.y?(n="Y",o=e.y):(n=(e.y-t.y)/(e.x-t.x),o=e.y-n*e.x);let a=new(0,i.Vector2)(t.x,t.y).sub(new i.Vector2(e.x,e.y));return 0!=Math.abs(Number(Math.cos(a.angle())).toFixed(11))&&1!=Math.abs(Number(Math.cos(a.angle())).toFixed(11))?o-=r/Number(Math.cos(a.angle())).toFixed(11):(180*a.angle()/Math.PI==0&&(o-=r),180*a.angle()/Math.PI==90&&(o+=r),180*a.angle()/Math.PI==180&&(o+=r),180*a.angle()/Math.PI==270&&(o-=r)),[n,o]}static getCursorByWall(e){let t=e.startPoint,r=e.endPoint.clone().sub(t.clone()),n=new(0,i.Vector2)(r.x,r.y).angle(),o=30;return(n=180/Math.PI*n)>=90-o&&n<=90+o||n<=270+o&&n>=270-o?"w-resize":n>=0&&n<=o||n<=180&&n>=180-o||n<=360&&n>=360-o?"s-resize":n>o&&n<90-o||n>180+o&&n<270-o?"nw-resize":n>90+o&&n<180-o||n>270+o&&n<360-o?"ne-resize":void 0}static getCursorByScaleTool(e,t){let r=t.clone().sub(e.clone()),n=new(0,i.Vector2)(r.x,r.y).angle(),o=30;return(n=180/Math.PI*n)>=90-o&&n<=90+o||n<=270+o&&n>=270-o?"s-resize":n>=0&&n<=o||n<=180&&n>=180-o||n<=360&&n>=360-o?"w-resize":n>o&&n<90-o||n>180+o&&n<270-o?"ne-resize":n>90+o&&n<180-o||n>270+o&&n<360-o?"nw-resize":void 0}static getClockWise(e,t,i){let r=e.x,n=e.y,o=t.x,a=t.y,s=i.x;return(o-r)*(i.y-a)-(a-n)*(s-o)}static getMinEdge(e){let t=e.geometry.attributes.position.array,n=r.handleLineData(e.startPoint,e.endPoint),o=r.smallDistanceByPointOnLine(n,new i.Vector2(t[0],t[1])),a=r.smallDistanceByPointOnLine(n,new i.Vector2(t[6],t[7])),s=r.smallDistanceByPointOnLine(n,new i.Vector2(t[9],t[10])),l=r.smallDistanceByPointOnLine(n,new i.Vector2(t[15],t[16])),h=o.clone().distanceTo(e.endPoint),c=a.clone().distanceTo(e.endPoint),d=s.clone().distanceTo(e.startPoint)<l.clone().distanceTo(e.startPoint)?s:l;return(h<c?o:a).distanceTo(d)}static getCenterNormalLine(e,t){let i=t;return"X"==t[0]?(i[0]="Y",i[2]=e.x):"Y"==t[0]?(i[0]="X",i[2]=e.y):(i[1]=-1/i[1],i=r.moveLineToPoint(e,i)),i}static getArcCenter(e,t,i){let n=r.handleLineData(e,t),o=r.handleLineData(e,i),a=r.getPointsCenter(e,t),s=r.getPointsCenter(e,i),l=r.getCenterNormalLine(a,n),h=r.getCenterNormalLine(s,o),c=r.lineIsIntersection(l,h);if(!c)return[];let d=c.clone().distanceTo(e.clone());if(c)return[c,d]}static getPointsCenter(e,t){return new i.Vector3((e.x+t.x)/2,(e.y+t.y)/2,0)}static getPointInArc(e,t,r,n,o){let a=new i.Vector3(e.x,e.y,0),s=new i.Vector3(t.x,t.y,0),l=a.angleTo(s)/2;return r>0?e.clone().rotateAround(n,l):e.clone().rotateAround(n,-l)}static extendParamWall(e,t){t.wallID=e.wallID,t.style=e.style,t.height=e.height,t.thickness=e.thickness,t.isArc=e.isArc}static getAllWallLine(e){let t=Array.from(e.geometry.attributes.position.array),i=[];for(let e=0;e<t.length/9-1;e++)i.push([t[9*e],t[9*e+1]],[t[(e+1)*9],t[(e+1)*9+1]],[t[(3*e+2)*3],t[(3*e+2)*3+1]],[t[((e+1)*3+2)*3],t[((e+1)*3+2)*3+1]]);return i}static getArrayIndex(e,t,i){let r=[];for(let n=0;n<e.length;n++)t[0]==e[n][0]&&t[1]==e[n][1]&&(0==n?r.push(e[n]):r.push(e[n-1])),i[0]==e[n][0]&&i[1]==e[n][1]&&(n==e.length-1?r.push(e[n]):r.push(e[n+1]));return r}static getNewPoint(e,t="start"){let n=e.geometry.attributes.position.array,o=r.handleLineData(e.startPoint,e.endPoint),a=new i.Vector2(n[0],n[1]),s=new i.Vector2(n[6],n[7]),l=e.endPoint.clone();"end"==t&&(a=new i.Vector2(n[9],n[10]),s=new i.Vector2(n[15],n[16]),l=e.startPoint.clone());let h=r.smallDistanceByPointOnLine(o,a),c=r.smallDistanceByPointOnLine(o,s);return h.clone().distanceTo(l)<=c.clone().distanceTo(l)?h:c}static sortPoint(e,t,i){let n=[],o=[[t.x,t.y]];return e.forEach(e=>{let i=t.clone().distanceTo(r.toVector3(e));n.push(i)}),n.slice(0).sort(function(e,t){return e-t}).forEach(t=>{let i=e[n.indexOf(t)];o.push([i.x,i.y])}),o.push([i.x,i.y]),o}static checkHasSameVec(e,t){let i=!1;return e.forEach(e=>{r.isSameVector(e,t)&&(i=!0)}),i}static getSplitLineByUuid(e,t){let i="";return e.forEach(e=>{e.uuid==t&&(i=e)}),i}static getWallLen(e){let t=e.geometry.attributes.position.array,r=new i.Vector2(t[6],t[7]),n=new i.Vector2(t[15],t[16]),o=new i.Vector2(t[0],t[1]),a=new i.Vector2(t[9],t[10]),s=new i.Vector2(t[3],t[4]),l=new i.Vector2(t[12],t[13]),h=s.distanceTo(l),c=o.distanceTo(a);return[r.distanceTo(n),h,c]}static calculateAngleWithHorizontalPlane(e){let t={x:e.x,y:0,z:e.z},i=Math.sqrt(e.x**2+e.y**2+e.z**2),r=Math.sqrt(t.x**2+t.z**2),n=(e.x*t.x+0*e.y+e.z*t.z)/(i*r);return isNaN(n)?NaN:Math.acos(n)}}}),parcelRequire.register("5TtCd",function(e,t){$parcel$export(e.exports,"OBB",()=>w);var i=parcelRequire("4xklQ");let r={c:null,u:[new i.Vector3,new i.Vector3,new i.Vector3],e:[]},n={c:null,u:[new i.Vector3,new i.Vector3,new i.Vector3],e:[]},o=[[],[],[]],a=[[],[],[]],s=[],l=new i.Vector3,h=new i.Vector3,c=new i.Vector3,d=new i.Vector3,u=new i.Vector3,p=new i.Vector3,m=new i.Matrix3,f=new i.Box3,g=new i.Matrix4,y=new i.Matrix4,x=new i.Ray;class w{constructor(e=new i.Vector3,t=new i.Vector3,r=new i.Matrix3){this.center=e,this.halfSize=t,this.rotation=r}set(e,t,i){return this.center=e,this.halfSize=t,this.rotation=i,this}copy(e){return this.center.copy(e.center),this.halfSize.copy(e.halfSize),this.rotation.copy(e.rotation),this}clone(){return new this.constructor().copy(this)}getSize(e){return e.copy(this.halfSize).multiplyScalar(2)}clampPoint(e,t){let r=this.halfSize;d.subVectors(e,this.center),this.rotation.extractBasis(l,h,c),t.copy(this.center);let n=(0,i.MathUtils).clamp(d.dot(l),-r.x,r.x);t.add(l.multiplyScalar(n));let o=(0,i.MathUtils).clamp(d.dot(h),-r.y,r.y);t.add(h.multiplyScalar(o));let a=(0,i.MathUtils).clamp(d.dot(c),-r.z,r.z);return t.add(c.multiplyScalar(a)),t}containsPoint(e){return d.subVectors(e,this.center),this.rotation.extractBasis(l,h,c),Math.abs(d.dot(l))<=this.halfSize.x&&Math.abs(d.dot(h))<=this.halfSize.y&&Math.abs(d.dot(c))<=this.halfSize.z}intersectsBox3(e){return this.intersectsOBB(b.fromBox3(e))}intersectsSphere(e){return this.clampPoint(e.center,p),p.distanceToSquared(e.center)<=e.radius*e.radius}intersectsOBB(e,t=Number.EPSILON){let i,l;r.c=this.center,r.e[0]=this.halfSize.x,r.e[1]=this.halfSize.y,r.e[2]=this.halfSize.z,this.rotation.extractBasis(r.u[0],r.u[1],r.u[2]),n.c=e.center,n.e[0]=e.halfSize.x,n.e[1]=e.halfSize.y,n.e[2]=e.halfSize.z,e.rotation.extractBasis(n.u[0],n.u[1],n.u[2]);for(let e=0;e<3;e++)for(let t=0;t<3;t++)o[e][t]=r.u[e].dot(n.u[t]);d.subVectors(n.c,r.c),s[0]=d.dot(r.u[0]),s[1]=d.dot(r.u[1]),s[2]=d.dot(r.u[2]);for(let e=0;e<3;e++)for(let i=0;i<3;i++)a[e][i]=Math.abs(o[e][i])+t;for(let e=0;e<3;e++)if(i=r.e[e],l=n.e[0]*a[e][0]+n.e[1]*a[e][1]+n.e[2]*a[e][2],Math.abs(s[e])>i+l)return!1;for(let e=0;e<3;e++)if(i=r.e[0]*a[0][e]+r.e[1]*a[1][e]+r.e[2]*a[2][e],l=n.e[e],Math.abs(s[0]*o[0][e]+s[1]*o[1][e]+s[2]*o[2][e])>i+l)return!1;return i=r.e[1]*a[2][0]+r.e[2]*a[1][0],l=n.e[1]*a[0][2]+n.e[2]*a[0][1],!(Math.abs(s[2]*o[1][0]-s[1]*o[2][0])>i+l)&&(i=r.e[1]*a[2][1]+r.e[2]*a[1][1],l=n.e[0]*a[0][2]+n.e[2]*a[0][0],!(Math.abs(s[2]*o[1][1]-s[1]*o[2][1])>i+l)&&(i=r.e[1]*a[2][2]+r.e[2]*a[1][2],l=n.e[0]*a[0][1]+n.e[1]*a[0][0],!(Math.abs(s[2]*o[1][2]-s[1]*o[2][2])>i+l)&&(i=r.e[0]*a[2][0]+r.e[2]*a[0][0],l=n.e[1]*a[1][2]+n.e[2]*a[1][1],!(Math.abs(s[0]*o[2][0]-s[2]*o[0][0])>i+l)&&(i=r.e[0]*a[2][1]+r.e[2]*a[0][1],l=n.e[0]*a[1][2]+n.e[2]*a[1][0],!(Math.abs(s[0]*o[2][1]-s[2]*o[0][1])>i+l)&&(i=r.e[0]*a[2][2]+r.e[2]*a[0][2],l=n.e[0]*a[1][1]+n.e[1]*a[1][0],!(Math.abs(s[0]*o[2][2]-s[2]*o[0][2])>i+l)&&(i=r.e[0]*a[1][0]+r.e[1]*a[0][0],l=n.e[1]*a[2][2]+n.e[2]*a[2][1],!(Math.abs(s[1]*o[0][0]-s[0]*o[1][0])>i+l)&&(i=r.e[0]*a[1][1]+r.e[1]*a[0][1],l=n.e[0]*a[2][2]+n.e[2]*a[2][0],!(Math.abs(s[1]*o[0][1]-s[0]*o[1][1])>i+l)&&(i=r.e[0]*a[1][2]+r.e[1]*a[0][2],l=n.e[0]*a[2][1]+n.e[1]*a[2][0],!(Math.abs(s[1]*o[0][2]-s[0]*o[1][2])>i+l)))))))))}intersectsPlane(e){this.rotation.extractBasis(l,h,c);let t=this.halfSize.x*Math.abs(e.normal.dot(l))+this.halfSize.y*Math.abs(e.normal.dot(h))+this.halfSize.z*Math.abs(e.normal.dot(c)),i=e.normal.dot(this.center)-e.constant;return Math.abs(i)<=t}intersectRay(e,t){return(this.getSize(u),f.setFromCenterAndSize(d.set(0,0,0),u),g.setFromMatrix3(this.rotation),g.setPosition(this.center),y.copy(g).invert(),x.copy(e).applyMatrix4(y),x.intersectBox(f,t))?t.applyMatrix4(g):null}intersectsRay(e){return null!==this.intersectRay(e,d)}fromBox3(e){return e.getCenter(this.center),e.getSize(this.halfSize).multiplyScalar(.5),this.rotation.identity(),this}equals(e){return e.center.equals(this.center)&&e.halfSize.equals(this.halfSize)&&e.rotation.equals(this.rotation)}applyMatrix4(e){let t=e.elements,i=d.set(t[0],t[1],t[2]).length(),r=d.set(t[4],t[5],t[6]).length(),n=d.set(t[8],t[9],t[10]).length(),o=e.determinant();o<0&&(i=-i),m.setFromMatrix4(e);let a=1/i,s=1/r,l=1/n;return m.elements[0]*=a,m.elements[1]*=a,m.elements[2]*=a,m.elements[3]*=s,m.elements[4]*=s,m.elements[5]*=s,m.elements[6]*=l,m.elements[7]*=l,m.elements[8]*=l,this.rotation.multiply(m),this.halfSize.x*=i,this.halfSize.y*=r,this.halfSize.z*=n,d.setFromMatrixPosition(e),this.center.add(d),this}}let b=new w}),parcelRequire.register("g4HAh",function(e,t){$parcel$export(e.exports,"LineGeometry",()=>r);var i=parcelRequire("bnZk5");class r extends i.LineSegmentsGeometry{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){let t=e.length-3,i=new Float32Array(2*t);for(let r=0;r<t;r+=3)i[2*r]=e[r],i[2*r+1]=e[r+1],i[2*r+2]=e[r+2],i[2*r+3]=e[r+3],i[2*r+4]=e[r+4],i[2*r+5]=e[r+5];return super.setPositions(i),this}setColors(e){let t=e.length-3,i=new Float32Array(2*t);for(let r=0;r<t;r+=3)i[2*r]=e[r],i[2*r+1]=e[r+1],i[2*r+2]=e[r+2],i[2*r+3]=e[r+3],i[2*r+4]=e[r+4],i[2*r+5]=e[r+5];return super.setColors(i),this}fromLine(e){let t=e.geometry;return this.setPositions(t.attributes.position.array),this}}}),parcelRequire.register("bnZk5",function(e,t){$parcel$export(e.exports,"LineSegmentsGeometry",()=>o);var i=parcelRequire("4xklQ");let r=new i.Box3,n=new i.Vector3;class o extends i.InstancedBufferGeometry{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";let e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],r=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(r),this.setAttribute("position",new i.Float32BufferAttribute(e,3)),this.setAttribute("uv",new i.Float32BufferAttribute(t,2))}applyMatrix4(e){let t=this.attributes.instanceStart,i=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),i.applyMatrix4(e),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));let r=new i.InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceStart",new i.InterleavedBufferAttribute(r,3,0)),this.setAttribute("instanceEnd",new i.InterleavedBufferAttribute(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));let r=new i.InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceColorStart",new i.InterleavedBufferAttribute(r,3,0)),this.setAttribute("instanceColorEnd",new i.InterleavedBufferAttribute(r,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new i.WireframeGeometry(e.geometry)),this}fromLineSegments(e){let t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new i.Box3);let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),r.setFromBufferAttribute(t),this.boundingBox.union(r))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new i.Sphere),null===this.boundingBox&&this.computeBoundingBox();let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){let i=this.boundingSphere.center;this.boundingBox.getCenter(i);let r=0;for(let o=0,a=e.count;o<a;o++)n.fromBufferAttribute(e,o),r=Math.max(r,i.distanceToSquared(n)),n.fromBufferAttribute(t,o),r=Math.max(r,i.distanceToSquared(n));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}}),parcelRequire.register("7WCxl",function(e,t){$parcel$export(e.exports,"LineMaterial",()=>r);var i=parcelRequire("4xklQ");i.UniformsLib.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new i.Vector2(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},i.ShaderLib.line={uniforms:(0,i.UniformsUtils).merge([i.UniformsLib.common,i.UniformsLib.fog,i.UniformsLib.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class r extends i.ShaderMaterial{constructor(e){super({type:"LineMaterial",uniforms:(0,i.UniformsUtils).clone(i.ShaderLib.line.uniforms),vertexShader:i.ShaderLib.line.vertexShader,fragmentShader:i.ShaderLib.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(e){!0===e?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(e){!!e!="USE_DASH"in this.defines&&(this.needsUpdate=!0),!0===e?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(e){!!e!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),!0===e?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}}),parcelRequire.register("ia4Lh",function(e,t){$parcel$export(e.exports,"Line2",()=>o);var i=parcelRequire("3KKM9"),r=parcelRequire("g4HAh"),n=parcelRequire("7WCxl");class o extends i.LineSegments2{constructor(e=new r.LineGeometry,t=new n.LineMaterial({color:16777215*Math.random()})){super(e,t),this.isLine2=!0,this.type="Line2"}}}),parcelRequire.register("3KKM9",function(e,t){let i,r,n,o;$parcel$export(e.exports,"LineSegments2",()=>P);var a=parcelRequire("4xklQ"),s=parcelRequire("bnZk5"),l=parcelRequire("7WCxl");let h=new a.Vector3,c=new a.Vector3,d=new a.Vector4,u=new a.Vector4,p=new a.Vector4,m=new a.Vector3,f=new a.Matrix4,g=new a.Line3,y=new a.Vector3,x=new a.Box3,w=new a.Sphere,b=new a.Vector4;function v(e,t,i){return b.set(0,0,-t,1).applyMatrix4(e.projectionMatrix),b.multiplyScalar(1/b.w),b.x=o/i.width,b.y=o/i.height,b.applyMatrix4(e.projectionMatrixInverse),b.multiplyScalar(1/b.w),Math.abs(Math.max(b.x,b.y))}function M(e,t){for(let s=0,l=r.count;s<l;s++){g.start.fromBufferAttribute(r,s),g.end.fromBufferAttribute(n,s);let l=new a.Vector3,h=new a.Vector3;i.distanceSqToSegment(g.start,g.end,h,l);let c=h.distanceTo(l)<.5*o;c&&t.push({point:h,pointOnLine:l,distance:i.origin.distanceTo(h),object:e,face:null,faceIndex:s,uv:null,uv2:null})}}function S(e,t,r){let n=t.projectionMatrix,s=e.material,l=s.resolution,h=e.matrixWorld,c=e.geometry,x=c.attributes.instanceStart,w=c.attributes.instanceEnd,b=-t.near;i.at(1,p),p.w=1,p.applyMatrix4(t.matrixWorldInverse),p.applyMatrix4(n),p.multiplyScalar(1/p.w),p.x*=l.x/2,p.y*=l.y/2,p.z=0,m.copy(p),f.multiplyMatrices(t.matrixWorldInverse,h);for(let t=0,s=x.count;t<s;t++){d.fromBufferAttribute(x,t),u.fromBufferAttribute(w,t),d.w=1,u.w=1,d.applyMatrix4(f),u.applyMatrix4(f);let s=d.z>b&&u.z>b;if(s)continue;if(d.z>b){let e=d.z-u.z,t=(d.z-b)/e;d.lerp(u,t)}else if(u.z>b){let e=u.z-d.z,t=(u.z-b)/e;u.lerp(d,t)}d.applyMatrix4(n),u.applyMatrix4(n),d.multiplyScalar(1/d.w),u.multiplyScalar(1/u.w),d.x*=l.x/2,d.y*=l.y/2,u.x*=l.x/2,u.y*=l.y/2,g.start.copy(d),g.start.z=0,g.end.copy(u),g.end.z=0;let c=g.closestPointToPointParameter(m,!0);g.at(c,y);let p=(0,a.MathUtils).lerp(d.z,u.z,c),v=p>=-1&&p<=1,M=m.distanceTo(y)<.5*o;if(v&&M){g.start.fromBufferAttribute(x,t),g.end.fromBufferAttribute(w,t),g.start.applyMatrix4(h),g.end.applyMatrix4(h);let n=new a.Vector3,o=new a.Vector3;i.distanceSqToSegment(g.start,g.end,o,n),r.push({point:o,pointOnLine:n,distance:i.origin.distanceTo(o),object:e,face:null,faceIndex:t,uv:null,uv2:null})}}}class P extends a.Mesh{constructor(e=new s.LineSegmentsGeometry,t=new l.LineMaterial({color:16777215*Math.random()})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){let e=this.geometry,t=e.attributes.instanceStart,i=e.attributes.instanceEnd,r=new Float32Array(2*t.count);for(let e=0,n=0,o=t.count;e<o;e++,n+=2)h.fromBufferAttribute(t,e),c.fromBufferAttribute(i,e),r[n]=0===n?0:r[n-1],r[n+1]=r[n]+h.distanceTo(c);let n=new a.InstancedInterleavedBuffer(r,2,1);return e.setAttribute("instanceDistanceStart",new a.InterleavedBufferAttribute(n,1,0)),e.setAttribute("instanceDistanceEnd",new a.InterleavedBufferAttribute(n,1,1)),this}raycast(e,t){let a,s;let l=this.material.worldUnits,h=e.camera;null!==h||l||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');let c=void 0!==e.params.Line2&&e.params.Line2.threshold||0;i=e.ray;let d=this.matrixWorld,u=this.geometry,p=this.material;if(o=p.linewidth+c,r=u.attributes.instanceStart,n=u.attributes.instanceEnd,null===u.boundingSphere&&u.computeBoundingSphere(),w.copy(u.boundingSphere).applyMatrix4(d),l)a=.5*o;else{let e=Math.max(h.near,w.distanceToPoint(i.origin));a=v(h,e,p.resolution)}if(w.radius+=a,!1!==i.intersectsSphere(w)){if(null===u.boundingBox&&u.computeBoundingBox(),x.copy(u.boundingBox).applyMatrix4(d),l)s=.5*o;else{let e=Math.max(h.near,x.distanceToPoint(i.origin));s=v(h,e,p.resolution)}x.expandByScalar(s),!1!==i.intersectsBox(x)&&(l?M(this,t):S(this,h,t))}}}}),parcelRequire.register("5XTH3",function(module,exports){$parcel$export(module.exports,"DrawWallTool",()=>DrawWallTool);var $4xklQ=parcelRequire("4xklQ"),$9HO6e=parcelRequire("9HO6e"),$ia4Lh=parcelRequire("ia4Lh"),$7WCxl=parcelRequire("7WCxl"),$g4HAh=parcelRequire("g4HAh"),$6Hryq=parcelRequire("6Hryq"),$2C75G=parcelRequire("2C75G");parcelRequire("hrM0U");class DrawWallTool{constructor(e=""){this.btmFaceList=[],this.imagePath="./assets/img/banner/uvGrid.jpg",this.imagePath="../../../../static/assets/images/banner/uvGrid.jpg",this.material=""==e?new $4xklQ.MeshBasicMaterial({color:"#363636",side:$4xklQ.DoubleSide,transparent:!0,opacity:.8}):e,this.reset()}create2DWallAAA(e,t=[]){this.btmFaceList=t;let i=[];for(let t=0;t<e.length;t++){let r,n=e[t],o=new $4xklQ.Vector2(n.start.x,n.start.y),a=new $4xklQ.Vector2(n.end.x,n.end.y);if(n.isArc){let e,t,r=o.clone().add(a).divideScalar(2),s=o.distanceTo(r);this.findCrossFace2(o,a);let l=new $4xklQ.Vector2(o.x,o.y),h=new $4xklQ.Vector2(a.x,a.y),c=l.clone().sub(r).angle(),d=h.clone().sub(r).angle();"down"==n.direction?l.x>=h.x?(e=d,t=c):(e=c,t=d):l.x<=h.x?(e=d,t=c):(e=c,t=d);let u=new $4xklQ.Path;u.arc(r.x,r.y,s,e,t,!1);let p=Math.round(Math.PI/Math.asin(n.thickness/2/(s+n.thickness/2))/2),m=u.getPoints(p),f=[];for(let e=0;e<m.length-1;e++){let t=new $4xklQ.Vector2(parseFloat(Number(m[e].x).toFixed(10)),parseFloat(Number(m[e].y).toFixed(10))),i=new $4xklQ.Vector2(parseFloat(Number(m[e+1].x).toFixed(10)),parseFloat(Number(m[e+1].y).toFixed(10))),r=this.createBottomFace(t,i,n.line,n.thickness);r.startPoint=t,r.endPoint=i,r.direction=n.direction,r.useType="wall",this.recordInfo(r,n),f.push(r),this.btmFaceList.push(r),this.handleIntersect2(r)}i.push(f)}else(r=this.createBottomFace(o.clone(),a.clone(),n.line,n.thickness)).startPoint=o,r.endPoint=a,r.useType="wall",this.recordInfo(r,n),this.handleIntersectNew(r),this.btmFaceList.push(r)}for(let e=0;e<i.length;e++){let t=i[e],r=this.mergeArcFace(t);this.btmFaceList.splice(this.btmFaceList.indexOf(t[0]),t.length),this.btmFaceList.push(r)}return this.btmFaceList}createCircle(e){let t=new $4xklQ.SphereGeometry(50),i=new $4xklQ.Mesh(t,new $4xklQ.MeshBasicMaterial({color:16711680}));return i.position.copy(e),i}create2DWall(e,t=[],i=!1){return window.performance.now(),this.btmFaceList=t,this.btmFaceList=(0,$2C75G.WallCreator).create2DWallNew(e),this.stroke(),this.btmFaceList}stroke(){let e=[];for(let t=0;t<this.btmFaceList.length;t++){this.btmFaceList[t].origin2DWall=this.btmFaceList[t].clone();let i=new $4xklQ.Group,r=Array.from(this.btmFaceList[t].geometry.attributes.position.array),n=[],o=[];for(let e=0;e<r.length/9;e++)n.push(new $4xklQ.Vector2(r[9*e],r[9*e+1])),o.push(new $4xklQ.Vector2(r[(3*e+2)*3],r[(3*e+2)*3+1]));let a=this.createLine(n,0),s=this.createLine(o,0);i.add(a,s),i.wallID=this.btmFaceList[t].wallID,e.push(i)}this.btmFaceList.push(e)}createLine(e,t=0,i=!1){let r=[];e.forEach(e=>{r.push(e.x,e.y,0)});var n=new(0,$g4HAh.LineGeometry)().setPositions(r),o=new $7WCxl.LineMaterial({color:t,linewidth:1,dashed:i,transparent:!0});o.resolution.set(window.innerWidth,window.innerHeight);var a=new $ia4Lh.Line2(n,o);return a.renderOrder=100,a.computeLineDistances(),a}itemInArr(e,t){let i=new $4xklQ.Vector2(e.start.x,e.start.y),r=new $4xklQ.Vector2(e.end.x,e.end.y);for(let e=0;e<t.length;e++)if(i.equals(t[e])||r.equals(t[e]))return!0}removeSingleLine(e){let t=[];for(let i=0;i<e.length;i++){let r=0,n=0,o=new $4xklQ.Vector2(e[i].start.x,e[i].start.y),a=new $4xklQ.Vector2(e[i].end.x,e[i].end.y);for(let t=0;t<e.length;t++)if(i!==t){let i=new $4xklQ.Vector2(e[t].start.x,e[t].start.y),s=new $4xklQ.Vector2(e[t].end.x,e[t].end.y);(o.equals(i)||o.equals(s))&&r++,(a.equals(i)||a.equals(s))&&n++}(0==r||0==n)&&t.push(e[i])}for(let i=0;i<t.length;i++)this.delete(e,t[i])}detectClosedGraph(e){for(let t=0;t<e.length;t++){e[t].startPoint;let i=e[t].endPoint,r=[e[t]];this.getNextLine(i,r,e)}}getIntersectLine(e,t){let i=[],r=[];for(let n=0;n<t.length;n++){let o=t[n];if(o.startPoint.equals(e)){i.push(o);let t=o.endPoint.clone().sub(e).angle();r.push(t)}if(o.endPoint.equals(e)){i.push(o);let t=o.startPoint.clone().sub(e).angle();r.push(t)}}return[i,r]}getNextLine(e,t,i){let r=t[t.length-1],n=this.getIntersectLine(e,i),o=n[0],a=n[1],s=this.getLineAngle(e,r)[0];this.delete(o,r),this.delete(a,s);for(let e=0;e<a.length;e++)s>a[e]&&(a[e]+=2*Math.PI);for(let i=0;i<o.length;i++){let r=o[i],n=this.getLineAngle(e,r),l=n[0],h=n[1];l<s&&(l+=2*Math.PI);let c=this.checkBetweenAngle(a,s,l,"inner");Math.abd(l-s)>=Math.PI?this.checkBetweenAngle(a,s,l,"outer"):!c&&(t.push(r),t.length>2&&h.equals(t[0].startPoint)&&this.graphArr.push(t))}}getLineAngle(e,t){let i=e.equals(t.startPoint)?t.endPoint:t.startPoint;return[i.clone().sub(e).angle(),i]}getNextLine2(e,t,i,r){let n=t[t.length-1],o,a=t[0].startPoint;i.equals(n.startPoint)?o=n.endPoint.clone().sub(i).angle():i.equals(n.endPoint)&&(o=n.startPoint.clone().sub(i).angle());let s,l=!1,h=[];for(let t=0;t<e.length;t++){let r,n=e[t];i.equals(n.startPoint)?((r=n.endPoint.clone().sub(i).angle())<o&&(r+=2*Math.PI),this.checkBetweenAngle(h,o,r,"inner")||(s=n,l=n.endPoint)):i.equals(n.endPoint)&&((r=n.startPoint.clone().sub(i).angle())<o&&(r+=2*Math.PI),this.checkBetweenAngle(h,o,r,"inner")||(s=n,l=n.startPoint)),h.push(r)}return!!l&&(l.equals(a)?t:(t.push(s),[t,l]))}mergeArcFace(e){let t=[],i=[];for(let r=0;r<e.length;r++){let n=Array.from(e[r].geometry.attributes.position.array);for(let e=0;e<9;e++)t.push(n[e]);if(r==e.length-1)for(let e=9;e<18;e++)t.push(n[e]);i.push(3*r,3*r+3,3*r+4,3*r+1,3*r,3*r+4,3*r+1,3*r+4,3*r+5,3*r+2,3*r+1,3*r+5)}let r=this.createMesh(t,i,e[0].material);return this.recordInfo(r,e[0]),r.wallID=e[0].wallID,r.arcCenter=e[0].arcCenter,r.cp=e[0].cp,r}getFacePoints(e){e.updateWorldMatrix(!0,!1);let t=e.geometry.attributes.position.array,i=[];for(let r=0;r<t.length/3;r++)i.push(e.localToWorld(new $4xklQ.Vector3(t[3*r],t[3*r+1],t[3*r+2])));return i}handleIntersect(e){let t=e.startPoint,i=e.endPoint,r=this.findCrossFaceByPoint(t,i),n=r[0],o=r[1];console.log("cross - start - end",n,o);let a=this.getLineData(this.facePoints[0],this.facePoints[3]),s=this.getLineData(this.facePoints[2],this.facePoints[5]);if(n.length>0){let r=[];if(n.length>1)for(let e=0;e<n.length;e++){let i=n[e].startPoint,o=n[e].endPoint,a;i.equals(t)?a=o.clone().sub(t):o.equals(t)&&(a=i.clone().sub(t)),r.push(a.angle())}if(r.length>1){let o=i.clone().sub(t).angle();for(let i=0;i<n.length;i++){let l,h,c,d,u,p,m,f,g,y,x;let w=n[i],b=w.startPoint,v=w.endPoint,M=this.getAllPoints(w),S=this.getLineData(M[0],M[3]),P=this.getLineData(M[2],M[5]);if(b.equals(t)?(l=v.clone().sub(t).angle(),d=a,u=P,f=0,g=2,p=s,m=S,y=2,x=0):v.equals(t)&&(l=b.clone().sub(t).angle(),h=this.checkBetweenAngle(r,o,l,"inner"),c=this.checkBetweenAngle(r,o,l,"outer"),d=a,u=S,f=0,g=3,p=s,m=P,y=2,x=5),h=this.checkBetweenAngle(r,o,l,"inner"),c=this.checkBetweenAngle(r,o,l,"outer"),o<l){if(h){if(!c){let i=this.computeIntersectPoint(p,m,t);i&&2e3>i.distanceTo(t)&&this.updateVertex(e,y,i),i&&2e3>i.distanceTo(t)&&this.updateVertex(w,x,i)}}else{let i=this.computeIntersectPoint(d,u,t);i&&2e3>i.distanceTo(t)&&this.updateVertex(e,f,i),i&&2e3>i.distanceTo(t)&&this.updateVertex(w,g,i)}}else if(h){if(!c){let i=this.computeIntersectPoint(d,u,t);i&&2e3>i.distanceTo(t)&&this.updateVertex(e,f,i),i&&2e3>i.distanceTo(t)&&this.updateVertex(w,g,i)}}else{let i=this.computeIntersectPoint(p,m,t);i&&2e3>i.distanceTo(t)&&this.updateVertex(e,y,i),i&&2e3>i.distanceTo(t)&&this.updateVertex(w,x,i)}}}else{let r,o,l=n[0],h=l.startPoint,c=l.endPoint,d=this.getAllPoints(l);if(e.isArc&&!l.isArc){let r=i.clone().sub(t).angle(),n;if(h.equals(t)){if(Math.abs(r-(n=c.clone().sub(t).angle()))<Math.PI/2){this.updateVertex(e,0,d[0]),this.updateVertex(e,2,d[2]);return}}else if(c.equals(t)&&Math.abs(r-(n=h.clone().sub(t).angle()))<Math.PI/2){this.updateVertex(e,0,d[5]),this.updateVertex(e,2,d[3]);return}}let u=this.getLineData(d[0],d[3]),p=this.getLineData(d[2],d[5]);h.equals(t)?(r=this.computeIntersectPoint(a,p,t),o=this.computeIntersectPoint(s,u,t),r&&2e3>r.distanceTo(t)&&this.updateVertex(l,2,r),o&&2e3>o.distanceTo(t)&&this.updateVertex(l,0,o)):c.equals(t)&&(r=this.computeIntersectPoint(a,u,t),o=this.computeIntersectPoint(s,p,t),r&&2e3>r.distanceTo(t)&&this.updateVertex(l,3,r),o&&2e3>o.distanceTo(t)&&this.updateVertex(l,5,o)),r&&2e3>r.distanceTo(t)&&this.updateVertex(e,0,r),o&&2e3>o.distanceTo(t)&&this.updateVertex(e,2,o)}}if(o.length>0){let r=[];if(o.length>1)for(let e=0;e<o.length;e++){let t=o[e].startPoint,n=o[e].endPoint,a;t.equals(i)?a=n.clone().sub(i):n.equals(i)&&(a=t.clone().sub(i)),r.push(a.angle())}if(r.length>1){let n=t.clone().sub(i).angle();for(let t=0;t<o.length;t++){let l,h,c,d,u,p,m,f,g,y,x;let w=o[t],b=w.startPoint,v=w.endPoint,M=this.getAllPoints(w),S=this.getLineData(M[0],M[3]),P=this.getLineData(M[2],M[5]);if(b.equals(i)?(l=v.clone().sub(i).angle(),d=s,u=P,f=5,g=2,p=a,m=S,y=3,x=0):v.equals(i)&&(l=b.clone().sub(i).angle(),d=s,u=S,f=5,g=3,p=a,m=P,y=3,x=5),h=this.checkBetweenAngle(r,n,l,"inner"),c=this.checkBetweenAngle(r,n,l,"outer"),n<l){if(h){if(!c){let t=this.computeIntersectPoint(p,m,i);t&&2e3>t.distanceTo(i)&&this.updateVertex(e,y,t),t&&2e3>t.distanceTo(i)&&this.updateVertex(w,x,t)}}else{let t=this.computeIntersectPoint(d,u,i);t&&2e3>t.distanceTo(i)&&this.updateVertex(e,f,t),t&&2e3>t.distanceTo(i)&&this.updateVertex(w,g,t)}}else if(h){if(!c){let t=this.computeIntersectPoint(d,u,i);t&&2e3>t.distanceTo(i)&&this.updateVertex(e,f,t),t&&2e3>t.distanceTo(i)&&this.updateVertex(w,g,t)}}else{let t=this.computeIntersectPoint(p,m,i);t&&2e3>t.distanceTo(i)&&this.updateVertex(e,y,t),t&&2e3>t.distanceTo(i)&&this.updateVertex(w,x,t)}}}else{let r,n,l=o[0],h=l.startPoint,c=l.endPoint,d=this.getAllPoints(l);if(e.isArc&&!l.isArc){console.log("endCross - btm arc");let r=t.clone().sub(i).angle(),n;if(h.equals(i)){if(Math.abs(r-(n=c.clone().sub(i).angle()))<Math.PI/2){this.updateVertex(e,5,d[0]),this.updateVertex(e,3,d[2]);return}}else if(c.equals(i)&&Math.abs(r-(n=h.clone().sub(i).angle()))<Math.PI/2){this.updateVertex(e,5,d[5]),this.updateVertex(e,3,d[3]);return}}let u=this.getLineData(d[0],d[3]),p=this.getLineData(d[2],d[5]);h.equals(i)?(r=this.computeIntersectPoint(a,u,i),n=this.computeIntersectPoint(s,p,i),r&&2e3>r.distanceTo(i)&&this.updateVertex(l,0,r),n&&2e3>n.distanceTo(i)&&this.updateVertex(l,2,n)):c.equals(i)&&(r=this.computeIntersectPoint(a,p,i),n=this.computeIntersectPoint(s,u,i),r&&2e3>r.distanceTo(i)&&this.updateVertex(l,5,r),n&&2e3>n.distanceTo(i)&&this.updateVertex(l,3,n)),r&&2e3>r.distanceTo(i)&&this.updateVertex(e,3,r),n&&2e3>n.distanceTo(i)&&this.updateVertex(e,5,n)}}}handleIntersectNew(e){let t=this.findCrossFace(e);if(t.length>0){let i=e.startPoint,r=e.endPoint,n=this.getLineData(this.facePoints[0],this.facePoints[3]);this.getLineData(this.facePoints[1],this.facePoints[4]);let o=this.getLineData(this.facePoints[2],this.facePoints[5]);for(let a=0;a<t.length;a++){let s,l,h,c,d,u,p,m,f,g,y,x=t[a],w=x.startPoint,b=x.endPoint,v=!1,M=[];for(let e=0;e<t.length;e++)if(x!==t[e]&&this.whetherCross(w,b,t[e])){let n=this.whetherCross2(w,b,t[e]),o=this.whetherCross2(i,r,t[e]);if(n.equals(o)){let i;v=!0,n.equals(t[e].startPoint)?i=t[e].endPoint.clone().sub(n):n.equals(t[e].endPoint)&&(i=t[e].startPoint.clone().sub(n)),M.push(i.angle())}}let S=this.getFacePoints(x),P=this.getLineData(S[0],S[3]);this.getLineData(S[1],S[4]);let T=this.getLineData(S[2],S[5]);i.equals(b)?(g=r.clone().sub(i),y=w.clone().sub(b),s=i,l=n,h=P,c=0,d=3,u=o,p=T,m=2,f=5):i.equals(w)?(g=r.clone().sub(i),y=b.clone().sub(w),s=i,l=n,h=T,c=0,d=2,u=o,p=P,m=2,f=0):r.equals(b)?(g=i.clone().sub(r),y=w.clone().sub(b),s=r,l=o,h=P,c=5,d=3,u=n,p=T,m=3,f=5):r.equals(w)&&(g=i.clone().sub(r),y=b.clone().sub(w),s=r,l=o,h=T,c=5,d=2,u=n,p=P,m=3,f=0);let _=g.angle(),C=y.angle();if(v){let t=this.checkBetweenAngle(M,_,C,"inner"),i=this.checkBetweenAngle(M,_,C,"outer");if(_<C){if(t){if(!i){let t=this.computeIntersectPoint(u,p,s);this.updateVertex(e,m,t),this.updateVertex(x,f,t)}}else{let t=this.computeIntersectPoint(l,h,s);this.updateVertex(e,c,t),this.updateVertex(x,d,t)}}else if(t){if(!i){let t=this.computeIntersectPoint(l,h,s);this.updateVertex(e,c,t),this.updateVertex(x,d,t)}}else{let t=this.computeIntersectPoint(u,p,s);this.updateVertex(e,m,t),this.updateVertex(x,f,t)}}else{let t=this.computeIntersectPoint(l,h,s);this.updateVertex(e,c,t),this.updateVertex(x,d,t);let i=this.computeIntersectPoint(u,p,s);this.updateVertex(e,m,i),this.updateVertex(x,f,i)}}}}checkBetweenAngle(e,t,i,r){let n=Math.min(t,i),o=Math.max(t,i);for(let t=0;t<e.length;t++)if("inner"==r&&e[t]>n&&e[t]<o||"outer"==r&&(e[t]<n||e[t]>o))return!0;return!1}checkAndUpdate(e,t,i,r,n,o,a){let s=this.getFacePoints(a);e?this.checkLegitimacy(t,s[i],s[i+3])&&(this.updateVertex(a,r,t),this.updateVertex(o,n,t)):(this.updateVertex(a,r,t),this.updateVertex(o,n,t))}checkAndUpdate2(e,t,i,r,n,o,a,s=!1){let l=this.getFacePoints(a);if(s){let s=this.checkLegitimacy(e,l[t],l[t+3]),h=this.checkLegitimacy(e,this.facePoints[i],this.facePoints[i+3]);s&&h&&(this.updateVertex(a,r,e),this.updateVertex(o,n,e))}else this.updateVertex(a,r,e),this.updateVertex(o,n,e)}handleIntersect2(e){let t=e.startPoint,i=e.endPoint,r=this.findCrossFace2(t,i);if(r.splice(r.indexOf(e),1),r.length>0)for(let n=0;n<r.length;n++){let o,a,s,l=r[n],h=l.startPoint,c=l.endPoint,d=this.getFacePoints(l),u=!1;for(let e=0;e<r.length;e++)if(l!==r[e]&&this.whetherCross(h,c,r[e])){u=!0;break}if(t.equals(c)){o=h,a=t,s=i;let r=this.computeMiter(o,a,s,l.thickness/2,e.thickness/2),n=a.clone().add(r),c=a.clone().add(r.clone().negate());if(u){let t=this.checkLegitimacy(n,d[0],d[3]),i=this.checkLegitimacy(n,d[2],d[5]),r=this.checkLegitimacy(c,d[0],d[3]),o=this.checkLegitimacy(c,d[2],d[5]);(t||i)&&(this.updateVertex(l,3,n),this.updateVertex(e,0,n)),(r||o)&&(this.updateVertex(l,5,c),this.updateVertex(e,2,c))}else this.updateVertex(l,3,n),this.updateVertex(e,0,n),this.updateVertex(l,5,c),this.updateVertex(e,2,c)}else if(i.equals(h)){o=t,a=i,s=c;let r=this.computeMiter(o,a,s,l.thickness/2,e.thickness/2),n=a.clone().add(r),h=a.clone().add(r.clone().negate());if(u){let t=this.checkLegitimacy(n,d[0],d[3]),i=this.checkLegitimacy(n,d[2],d[5]),r=this.checkLegitimacy(h,d[0],d[3]),o=this.checkLegitimacy(h,d[2],d[5]);(t||i)&&(this.updateVertex(l,0,n),this.updateVertex(e,3,n)),(r||o)&&(this.updateVertex(l,2,h),this.updateVertex(e,5,h))}else this.updateVertex(l,0,n),this.updateVertex(e,3,n),this.updateVertex(l,2,h),this.updateVertex(e,5,h)}else if(t.equals(h)){o=c,a=t,s=i;let r=this.computeMiter(o,a,s,l.thickness/2,e.thickness/2),n=a.clone().add(r),h=a.clone().add(r.clone().negate());if(u){let t=this.checkLegitimacy(n,d[0],d[3]),i=this.checkLegitimacy(n,d[2],d[5]),r=this.checkLegitimacy(h,d[0],d[3]),o=this.checkLegitimacy(h,d[2],d[5]);(t||i)&&(this.updateVertex(l,2,n),this.updateVertex(e,0,n)),(r||o)&&(this.updateVertex(l,0,h),this.updateVertex(e,2,h))}else this.updateVertex(l,2,n),this.updateVertex(e,0,n),this.updateVertex(l,0,h),this.updateVertex(e,2,h)}else if(i.equals(c)){o=t,a=i,s=h;let r=this.computeMiter(o,a,s,l.thickness/2,e.thickness/2),n=a.clone().add(r),c=a.clone().add(r.clone().negate());if(u){let t=this.checkLegitimacy(n,d[0],d[3]),i=this.checkLegitimacy(n,d[2],d[5]),r=this.checkLegitimacy(c,d[0],d[3]),o=this.checkLegitimacy(c,d[2],d[5]);(t||i)&&(this.updateVertex(l,5,n),this.updateVertex(e,3,n)),(r||o)&&(this.updateVertex(l,3,c),this.updateVertex(e,5,c))}else this.updateVertex(l,5,n),this.updateVertex(e,3,n),this.updateVertex(l,3,c),this.updateVertex(e,5,c)}}}findCrossFace(e){let t=[];for(let i=0;i<this.btmFaceList.length;i++)this.whetherCross(e.startPoint,e.endPoint,this.btmFaceList[i])&&t.push(this.btmFaceList[i]);return t}findCrossFace2(e,t){let i=[];for(let r=0;r<this.btmFaceList.length;r++)this.whetherCross(e,t,this.btmFaceList[r])&&i.push(this.btmFaceList[r]);return i}whetherCross(e,t,i){let r=i.startPoint,n=i.endPoint;return e.equals(r)||e.equals(n)||t.equals(r)||t.equals(n)}whetherCross2(e,t,i){let r=i.startPoint,n=i.endPoint;return(0,$9HO6e.UtilCore).isSameVector(e,r)||(0,$9HO6e.UtilCore).isSameVector(e,n)?e:!!((0,$9HO6e.UtilCore).isSameVector(t,r)||(0,$9HO6e.UtilCore).isSameVector(t,n))&&t}checkLegitimacy(e,t,i){let r=Math.min(t.x,i.x),n=Math.min(t.y,i.y),o=Math.max(t.x,i.x),a=Math.max(t.y,i.y),s=e.x>=r,l=e.x<=o,h=e.y>=n,c=e.y<=a;return s&&l&&h&&c}createBottomFace(e,t,i,r){let n=this.getLineData(e,t,r/2);switch(i){case 0:var o=e.clone().add(n[2].clone().negate()),a=e,s=e.clone().add(n[2]),l=t.clone().add(n[2].clone().negate()),h=t,c=t.clone().add(n[2]);break;case 1:var d=n[2].negate(),s=e,a=s.clone().add(d),o=a.clone().add(d),c=t,h=c.clone().add(d),l=h.clone().add(d);break;case 2:var o=e,a=o.clone().add(n[2]),s=a.clone().add(n[2]),l=t,h=l.clone().add(n[2]),c=h.clone().add(n[2])}this.facePoints=[o,a,s,l,h,c];var u=[];this.facePoints.forEach(function(e){u.push(e.x,e.y,0)});var p=[0,3,4,1,0,4,1,4,5,2,1,5];let m=this.material.clone();return m.transparent=!0,m.opacity=roomOpacity,this.createMesh(u,p,m)}createMesh(e,t,i,r=[]){var n=new $4xklQ.BufferGeometry;n.attributes.position=new $4xklQ.BufferAttribute(new Float32Array(e),3),r.length>1&&(n.attributes.normal=new $4xklQ.BufferAttribute(new Float32Array(r),3)),n.index=new $4xklQ.BufferAttribute(new Uint16Array(t),1);var o=new $4xklQ.Mesh(n,i);return o.renderOrder=2,o}getLineData(e,t,i=1){if(e.x==t.x)var r="X",n=e.x;else if(e.y==t.y)var r="Y",n=e.y;else{var r=(e.y-t.y)/(e.x-t.x);r=Math.round(100*r)/100;var n=e.y-r*e.x}n=Math.round(100*n)/100;var o=new $4xklQ.Vector2().subVectors(e,t);return o=new $4xklQ.Vector2(-o.y,o.x).normalize(),1!=i&&o.setLength(i),[r,n,o]}computeIntersectPoint(e,t,i){if("X"==e[0]){if("X"==t[0])return e[1]==t[1]&&new $4xklQ.Vector2(e[1],i.y);if("Y"==t[0])return new $4xklQ.Vector2(e[1],t[1]);var r=t[0]*e[1]+t[1];return new $4xklQ.Vector2(e[1],r)}if("Y"==e[0]){if("X"==t[0])return new $4xklQ.Vector2(t[1],e[1]);if("Y"==t[0])return e[1]==t[1]&&new $4xklQ.Vector2(i.x,e[1]);var n=(e[1]-t[1])/t[0];return new $4xklQ.Vector2(n,e[1])}if("X"==t[0]){var r=Math.round((e[0]*t[1]+e[1])*100)/100;return new $4xklQ.Vector2(t[1],r)}if("Y"==t[0]){var n=Math.round((t[1]-e[1])/e[0]*100)/100;return new $4xklQ.Vector2(n,t[1])}if(e[0]==t[0])return!1;var n=Math.round((t[1]-e[1])/(e[0]-t[0])*100)/100,r=Math.round((e[0]*n+e[1])*100)/100;return new $4xklQ.Vector2(n,r)}updateVertex(e,t,i){let r=e.geometry.attributes.position.array;r[3*t]=i.x,r[3*t+1]=i.y,e.geometry.attributes.position=new $4xklQ.BufferAttribute(new Float32Array(r),3),e.updateMatrix()}checkWhetherLegitimacy(e,t,i,r,n,o){return"X"==e[0]?i.y>t.y?o.y>t.y&&(faceVertices[1]=o.y):o.y<t.y&&(faceVertices[1]=o.y):"Y"==e[0]?i.x>t.x?o.x>t.x&&(faceVertices[0]=o.x):o.x<t.x&&(faceVertices[0]=o.x):i.x>t.x?o.x>t.x&&(r[3*n]=o.x,r[3*n+1]=o.y):o.x<t.x&&(r[3*n]=o.x,r[3*n+1]=o.y),r}recordInfo(e,t){e.line=t.line,e.style=t.style,e.thickness=t.thickness,e.height=t.height,e.wallID=t.id,e.name=t.id,e.offsetXY=t.offsetXY,e.isArc=t.isArc,e.useType="wall"}computeMiter(e,t,i,r,n){let o=new $4xklQ.Vector2().subVectors(t,e).normalize(),a=new $4xklQ.Vector2().subVectors(i,t).normalize(),s=new $4xklQ.Vector2(-a.y,a.x).normalize(),l=n/o.dot(s),h=o.clone().setLength(l),c=new $4xklQ.Vector2(-o.y,o.x).normalize(),d=r/a.clone().negate().dot(c),u=a.clone().negate().setLength(d);return h.add(u)}unique(e){for(var t=[],i=0;i<e.length-1;i++){for(var r=!1,n=0;n<t.length;n++)if(e[i].equals(t[n])){r=!0;break}r||t.push(e[i])}return t}delete(e,t){let i=e.indexOf(t);-1!=t&&e.splice(i,1)}reset(){this._lastPoint=!1,this._currentPoint=!1,this._nextPoint=!1,this._lastWall=!1,this.firstPoint=!1,this.firstWall=!1,this.facePoints=!1,this.arcFace=[],this.N=1e5,this.graph=Array.from(Array(this.N),()=>[]),this.cycles=Array.from(Array(this.N),()=>[])}switchTo3D(e){window.performance.now();let t=[],i={steps:2,depth:2800,bevelEnabled:!0,bevelThickness:0,bevelSize:0,bevelSegments:1};for(let a=0;a<e.length;a++){let s=e[a];i.depth=s.height;let l=Array.from(s.geometry.attributes.position.array),h=[];if(s.isArc){let e=[],t=[];for(let i=0;i<l.length/9;i++)e.push(new $4xklQ.Vector2(l[9*i],l[9*i+1])),t.push(new $4xklQ.Vector2(l[(3*i+2)*3],l[(3*i+2)*3+1]));e.unshift(new $4xklQ.Vector2(l[3],l[4])),e.push(new $4xklQ.Vector2(l[((l.length/9-1)*3+1)*3],l[((l.length/9-1)*3+1)*3+1])),h=e.concat(t.reverse())}else[0,1,2,5,4,3].forEach(e=>{h.push(new $4xklQ.Vector2(l[3*e],l[3*e+1]))});h.push(h[0]);let c=new $4xklQ.Shape;c.moveTo(h[0].x,h[0].y);for(let e=1;e<h.length;e++)c.lineTo(h[e].x,h[e].y);new $4xklQ.ExtrudeGeometry(c,i);let d=new $2C75G.Wall3DGeometry(s),u=new $4xklQ.Mesh(d,new $4xklQ.MeshStandardMaterial({color:16777215}));u.geometry.computeBoundingBox();var r,n,o=u.geometry.boundingBox.min,r=u.geometry.boundingBox.max,n=o.clone().add(r).divideScalar(2);u.geometry.center(),u.position.set(n.x,n.y,n.z),u.arcCenter=s.arcCenter,this.paramInherit(u,s),u.geometry.computeVertexNormals(),u.updateMatrix(),u.modelType="3DWall",u.startPoint=new $4xklQ.Vector2(u.startPoint.x/1e3,u.startPoint.y/1e3),u.endPoint=new $4xklQ.Vector2(u.endPoint.x/1e3,u.endPoint.y/1e3),u.thickness=u.thickness/1e3,t.push(u)}return t.forEach(e=>{let t=new $6Hryq.Brush(e.geometry,e.material);e.geometry=t.geometry,e.material=t.material,e.origin3DWall=e.clone()}),t}computeFaceUVs(e,t,i){e.geometry.computeBoundingBox();let r=e.geometry.boundingBox.min,n=e.geometry.boundingBox.max,o=[],a=Array.from(e.geometry.attributes.position.array);var s=new $4xklQ.TextureLoader().load(this.imagePath);if(s.wrapS=$4xklQ.RepeatWrapping,s.wrapT=$4xklQ.RepeatWrapping,r.z==n.z){let e=new $4xklQ.Vector2(a[3],a[4]),i=new $4xklQ.Vector2(a[a.length-6],a[a.length-5]),s=i.clone().sub(e).angle(),c=e.distanceTo(i),d=n.y-r.y,u=new $4xklQ.MeshStandardMaterial({color:"#9e9b9b",side:$4xklQ.DoubleSide});t.push(u);let p=[r.x,r.y];for(var l=0;l<a.length/3;l++){var h=[a[3*l],a[3*l+1]];o.push(...[(h[0]-p[0])/c,(h[1]-p[1])/d])}let m=new $4xklQ.Matrix3().setUvTransform(0,0,c/1024,d/1024,s,0,0),f=new $4xklQ.BufferAttribute(new Float32Array(o),2);f.applyMatrix3(m),o=Array.from(f.array)}else{let e=n.z-r.z,s,h;if(i){let e=new $4xklQ.Vector2(a[0],a[1]),t=new $4xklQ.Vector2(a[a.length-3],a[a.length-2]);s=Math.PI*(e.distanceTo(t)/2)}else s=((n.x-r.x)**2+(n.y-r.y)**2)**.5;let c=new $4xklQ.MeshStandardMaterial({color:"#9e9b9b",side:$4xklQ.DoubleSide});t.push(c);let d=2;(5==t.length||6==t.length)&&(d=3);for(let t=0;t<a.length/3;t+=d)if(0==t){h=[a[0],a[1],a[2]];for(let i=0;i<d;i++){let r=[a[(t+i)*3],a[(t+i)*3+1],a[(t+i)*3+2]],n=((r[0]-h[0])**2+(r[1]-h[1])**2)**.5;o.push(...[n/s,(r[2]-h[2])/e])}}else{h=[a[(t-d)*3],a[(t-d)*3+1],a[(t-d)*3+2]];for(let i=0;i<d;i++){let r=[a[(t+i)*3],a[(t+i)*3+1],a[(t+i)*3+2]],n=((r[0]-h[0])**2+(r[1]-h[1])**2)**.5;o.push(...[n/s+o[(t-d)*2],(r[2]-h[2])/e+o[(t-d)*2+1]])}}if(-1!=[3].indexOf(t.length))for(var l=0;l<o.length;l+=2)o[l]=-o[l]}return o}createTopFace(e,t){let i=[];for(let r=0,n=0;r<e.length/3;r++)i.push(e[n],e[n+1],t),n+=3;let r=[];for(let e=0,t=0;e<i.length/9-1;e++)r.push(t,t+1,t+3,t+1,t+4,t+3,t+1,t+2,t+4,t+2,t+5,t+4),t+=3;return[i,r]}createInnerOuterFace(e,t){let i=[],r=[];for(let n=0,o=0;n<e.length/3-1;n++)i=(i=(i=(i=i.concat(e[o])).concat(t[o])).concat(e[o+3])).concat(t[o+3]),r=(r=(r=(r=r.concat(e[o+2])).concat(t[o+2])).concat(e[o+5])).concat(t[o+5]),o+=3;let n=[],o=[];for(let e=0,t=0;e<i.length/12;e++)n.push(t,t+1,t+2,t+1,t+3,t+2),o.push(t+1,t,t+3,t,t+2,t+3),t+=4;return[[i,n],[r,o]]}createLeftRightFace(e,t){var i=e.slice(0,3).concat(t.slice(0,3)),r=[];i.forEach(function(e){r.push(e[0],e[1],e[2])});var n=[3,0,1,1,4,3,4,1,2,2,5,4],o=e.length,a=e.slice(o-3,o).concat(t.slice(o-3,o)),s=[];return a.forEach(function(e){s.push(e[0],e[1],e[2])}),[[r,n],[s,[0,3,4,4,1,0,1,4,5,5,2,1]]]}createFullWall(e,t,i){let r=[],n=[];for(let t=0;t<e.length;t++){let i=r.length/3;r=r.concat(e[t][0]),e[t][1].forEach(function(e){n.push(e+i)})}let o=this.createMesh(r,n,t);return this.paramInherit(o,i),o}paramInherit(target,origin){["line","name","style","isArc","height","wallID","offsetXY","thickness","startPoint","endPoint"].forEach(function(item){eval("target."+item+"= origin."+item)})}handleIntersectNew3(e,t){let i=[e,[]],r=this.getFacePoints(e);if(t.length>0){let n=e.startPoint,o=e.endPoint,a=this.getLineData(r[0],r[3]),s=this.getLineData(r[2],r[5]);for(let r=0;r<t.length;r++){let l,h,c,d,u,p,m,f,g,y,x,w=t[r].clone();w.line=t[r].line,w.style=t[r].style,w.thickness=t[r].thickness,w.height=t[r].height,w.offsetXY=t[r].offsetXY,w.isArc=t[r].isArc,w.startPoint=t[r].startPoint,w.endPoint=t[r].endPoint,w.useType=t[r].useType;let b=w.startPoint,v=w.endPoint,M=!1,S=[];for(let e=0;e<t.length;e++)if(w!==t[e]&&this.whetherCross(b,v,t[e])){let i=this.whetherCross2(b,v,t[e]),r=this.whetherCross2(n,o,t[e]);if(i.equals(r)){let r;M=!0,i.equals(t[e].startPoint)?r=t[e].endPoint.clone().sub(i):i.equals(t[e].endPoint)&&(r=t[e].startPoint.clone().sub(i)),S.push(r.angle())}}let P=this.getFacePoints(w),T=this.getLineData(P[0],P[3]);this.getLineData(P[1],P[4]);let _=this.getLineData(P[2],P[5]);(0,$9HO6e.UtilCore).isSameVector(n,v)?(y=o.clone().sub(n),x=b.clone().sub(v),l=n,h=a,c=T,d=0,u=3,p=s,m=_,f=2,g=5):(0,$9HO6e.UtilCore).isSameVector(n,b)?(y=o.clone().sub(n),x=v.clone().sub(b),l=n,h=a,c=_,d=0,u=2,p=s,m=T,f=2,g=0):(0,$9HO6e.UtilCore).isSameVector(o,v)?(y=n.clone().sub(o),x=b.clone().sub(v),l=o,h=s,c=T,d=5,u=3,p=a,m=_,f=3,g=5):(0,$9HO6e.UtilCore).isSameVector(o,b)&&(y=n.clone().sub(o),x=v.clone().sub(b),l=o,h=s,c=_,d=5,u=2,p=a,m=T,f=3,g=0);let C=y.angle(),D=x.angle();if(M){let t=this.checkBetweenAngle(S,C,D,"inner"),i=this.checkBetweenAngle(S,C,D,"outer");if(C<D){if(t){if(!i){let t=this.computeIntersectPoint(p,m,l);this.updateVertex(e,f,t),this.updateVertex(w,g,t)}}else{let t=this.computeIntersectPoint(h,c,l);this.updateVertex(e,d,t),this.updateVertex(w,u,t)}}else if(t){if(!i){let t=this.computeIntersectPoint(h,c,l);this.updateVertex(e,d,t),this.updateVertex(w,u,t)}}else{let t=this.computeIntersectPoint(p,m,l);this.updateVertex(e,f,t),this.updateVertex(w,g,t)}}else{let t=this.computeIntersectPoint(h,c,l);this.updateVertex(e,d,t),this.updateVertex(w,u,t);let i=this.computeIntersectPoint(p,m,l);this.updateVertex(e,f,i),this.updateVertex(w,g,i)}i[1].push(w)}}return i}findCrossFaceByPoint(e,t){let i=[],r=[];for(let n=0;n<this.btmFaceList.length;n++)this.whetherCross3(e,this.btmFaceList[n])&&i.push(this.btmFaceList[n]),this.whetherCross3(t,this.btmFaceList[n])&&r.push(this.btmFaceList[n]);return[i,r]}whetherCross3(e,t){let i=t.startPoint,r=t.endPoint;return e.equals(i)||e.equals(r)}getAllPoints(e){let t=Array.from(e.geometry.attributes.position.array),i=[];for(let e=0;e<t.length/3;e++)i.push(new $4xklQ.Vector2(t[3*e],t[3*e+1]));return i}}}),parcelRequire.register("6Hryq",function(e,t){$parcel$export(e.exports,"Brush",()=>a);var i=parcelRequire("4xklQ"),r=parcelRequire("1DCdP"),n=parcelRequire("cy3as"),o=parcelRequire("14bAY");class a extends i.Mesh{constructor(...e){super(...e),this.isBrush=!0,this._previousMatrix=new i.Matrix4,this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){let{matrix:e,_previousMatrix:t}=this,i=e.elements,r=t.elements;for(let e=0;e<16;e++)if(i[e]!==r[e])return!0;return!1}prepareGeometry(){let e=this.geometry,t=e.attributes;if((0,o.areSharedArrayBuffersSupported)())for(let e in t){let i=t[e];if(i.isInterleavedBufferAttribute)throw Error("Brush: InterleavedBufferAttributes are not supported.");i.array=(0,o.convertToSharedArrayBuffer)(i.array)}if(!e.boundsTree&&(e.boundsTree=new r.MeshBVH(e,{maxLeafTris:3}),e.halfEdges&&e.halfEdges.updateFrom(e)),e.halfEdges||(e.halfEdges=new n.HalfEdgeMap(e)),!e.groupIndices){let t=e.index.count/3,i=new Uint16Array(t),r=e.groups;for(let e=0,t=r.length;e<t;e++){let{start:t,count:n}=r[e];for(let r=t/3,o=(t+n)/3;r<o;r++)i[r]=e}e.groupIndices=i}}disposeCacheData(){let{geometry:e}=this;e.halfEdges=null,e.boundsTree=null,e.groupIndices=null}}}),parcelRequire.register("1DCdP",function(e,t){$parcel$export(e.exports,"MeshBVH",()=>P);var i=parcelRequire("4xklQ"),r=parcelRequire("ckwVR"),n=parcelRequire("IWLEN"),o=parcelRequire("iR33e"),a=parcelRequire("8YY3V"),s=parcelRequire("57zgU"),l=parcelRequire("f8eJn"),h=parcelRequire("fcnhI"),c=parcelRequire("bNX9f");let d=Symbol("skip tree generation"),u=new i.Box3,p=new i.Box3,m=new i.Matrix4,f=new a.OrientedBox,g=new a.OrientedBox,y=new i.Vector3,x=new i.Vector3,w=new i.Vector3,b=new i.Vector3,v=new i.Vector3,M=new i.Box3,S=new l.PrimitivePool(()=>new s.ExtendedTriangle);class P{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),P.serialize(arguments[0],{cloneBuffers:void 0===arguments[2]||arguments[2]});t={cloneBuffers:!0,...t};let i=e.geometry,r=e._roots,n=i.getIndex();return t.cloneBuffers?{roots:r.map(e=>e.slice()),index:n.array.slice()}:{roots:r,index:n.array}}static deserialize(e,t,r={}){if("boolean"==typeof r)return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),P.deserialize(arguments[0],arguments[1],{setIndex:void 0===arguments[2]||arguments[2]});r={setIndex:!0,...r};let{index:n,roots:o}=e,a=new P(t,{...r,[d]:!0});if(a._roots=o,r.setIndex){let r=t.getIndex();if(null===r){let r=new i.BufferAttribute(e.index,1,!1);t.setIndex(r)}else r.array!==n&&(r.array.set(n),r.needsUpdate=!0)}return a}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw Error("MeshBVH: Only BufferGeometries are supported.");if((t=Object.assign({strategy:r.CENTER,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[d]:!1},t)).useSharedArrayBuffer&&"undefined"==typeof SharedArrayBuffer)throw Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[d]||(this._roots=(0,n.buildPackedTree)(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new i.Box3))),this.geometry=e}refit(e=null){let t,i,n,o;e&&Array.isArray(e)&&(e=new Set(e));let a=this.geometry,s=a.index.array,l=a.attributes.position,h=0,c=this._roots;for(let e=0,r=c.length;e<r;e++)t=c[e],i=new Uint32Array(t),n=new Uint16Array(t),o=new Float32Array(t),d(0,h),h+=t.byteLength;function d(t,a,h=!1){let c=2*t,u=n[c+15]===r.IS_LEAFNODE_FLAG;if(u){let e=i[t+6],r=n[c+14],a=1/0,h=1/0,d=1/0,u=-1/0,p=-1/0,m=-1/0;for(let t=3*e,i=3*(e+r);t<i;t++){let e=s[t],i=l.getX(e),r=l.getY(e),n=l.getZ(e);i<a&&(a=i),i>u&&(u=i),r<h&&(h=r),r>p&&(p=r),n<d&&(d=n),n>m&&(m=n)}return(o[t+0]!==a||o[t+1]!==h||o[t+2]!==d||o[t+3]!==u||o[t+4]!==p||o[t+5]!==m)&&(o[t+0]=a,o[t+1]=h,o[t+2]=d,o[t+3]=u,o[t+4]=p,o[t+5]=m,!0)}{let r=t+8,n=i[t+6],s=r+a,l=n+a,c=h,u=!1,p=!1;e?c||(u=e.has(s),p=e.has(l),c=!u&&!p):(u=!0,p=!0);let m=c||u,f=c||p,g=!1;m&&(g=d(r,a,c));let y=!1;f&&(y=d(n,a,c));let x=g||y;if(x)for(let e=0;e<3;e++){let i=r+e,a=n+e,s=o[i],l=o[i+3],h=o[a],c=o[a+3];o[t+e]=s<h?s:h,o[t+e+3]=l>c?l:c}return x}}}traverse(e,t=0){let i=this._roots[t],n=new Uint32Array(i),o=new Uint16Array(i);function a(t,s=0){let l=2*t,h=o[l+15]===r.IS_LEAFNODE_FLAG;if(h){let r=n[t+6],a=o[l+14];e(s,h,new Float32Array(i,4*t,6),r,a)}else{let o=t+r.BYTES_PER_NODE/4,l=n[t+6],c=n[t+7],d=e(s,h,new Float32Array(i,4*t,6),c);d||(a(o,s+1),a(l,s+1))}}a(0)}raycast(e,t=i.FrontSide){let r=this._roots,n=this.geometry,a=[],s=t.isMaterial,l=Array.isArray(t),h=n.groups,c=s?t.side:t;for(let i=0,s=r.length;i<s;i++){let s=l?t[h[i].materialIndex].side:c,d=a.length;if((0,o.setBuffer)(r[i]),(0,o.raycast)(0,n,s,e,a),(0,o.clearBuffer)(),l){let e=h[i].materialIndex;for(let t=d,i=a.length;t<i;t++)a[t].face.materialIndex=e}}return a}raycastFirst(e,t=i.FrontSide){let r=this._roots,n=this.geometry,a=t.isMaterial,s=Array.isArray(t),l=null,h=n.groups,c=a?t.side:t;for(let i=0,a=r.length;i<a;i++){let a=s?t[h[i].materialIndex].side:c;(0,o.setBuffer)(r[i]);let d=(0,o.raycastFirst)(0,n,a,e);(0,o.clearBuffer)(),null!=d&&(null==l||d.distance<l.distance)&&(l=d,s&&(d.face.materialIndex=h[i].materialIndex))}return l}intersectsGeometry(e,t){let i=this.geometry,r=!1;for(let n of this._roots)if((0,o.setBuffer)(n),r=(0,o.intersectsGeometry)(0,i,e,t),(0,o.clearBuffer)(),r)break;return r}shapecast(e,t,i){let r=this.geometry;if(e instanceof Function){if(t){let e=t;t=(t,i,r,n)=>{let o=3*i;return e(t,o,o+1,o+2,r,n)}}e={boundsTraverseOrder:i,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let n=S.getPrimitive(),{boundsTraverseOrder:a,intersectsBounds:s,intersectsRange:l,intersectsTriangle:h}=e;if(l&&h){let e=l;l=(t,i,o,a,s)=>!!e(t,i,o,a,s)||(0,c.iterateOverTriangles)(t,i,r,h,o,a,n)}else l||(l=h?(e,t,i,o)=>(0,c.iterateOverTriangles)(e,t,r,h,i,o,n):(e,t,i)=>i);let d=!1,u=0;for(let e of this._roots){if((0,o.setBuffer)(e),d=(0,o.shapecast)(0,r,s,l,a,u),(0,o.clearBuffer)(),d)break;u+=e.byteLength}return S.releasePrimitive(n),d}bvhcast(e,t,i){let{intersectsRanges:r,intersectsTriangles:n}=i,o=this.geometry.index,a=this.geometry.attributes.position,s=e.geometry.index,l=e.geometry.attributes.position;m.copy(t).invert();let h=S.getPrimitive(),d=S.getPrimitive();if(n){function f(e,i,r,u,p,m,f,g){for(let y=r,x=r+u;y<x;y++){(0,c.setTriangle)(d,3*y,s,l),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let t=e,r=e+i;t<r;t++)if((0,c.setTriangle)(h,3*t,o,a),h.needsUpdate=!0,n(h,d,t,y,p,m,f,g))return!0}return!1}if(r){let e=r;r=function(t,i,r,n,o,a,s,l){return!!e(t,i,r,n,o,a,s,l)||f(t,i,r,n,o,a,s,l)}}else r=f}e.getBoundingBox(p),p.applyMatrix4(t);let g=this.shapecast({intersectsBounds:e=>p.intersectsBox(e),intersectsRange:(t,i,n,o,a,s)=>(u.copy(s),u.applyMatrix4(m),e.shapecast({intersectsBounds:e=>u.intersectsBox(e),intersectsRange:(e,n,s,l,h)=>r(t,i,e,n,o,a,l,h)}))});return S.releasePrimitive(h),S.releasePrimitive(d),g}intersectsBox(e,t){return f.set(e.min,e.max,t),f.needsUpdate=!0,this.shapecast({intersectsBounds:e=>f.intersectsBox(e),intersectsTriangle:e=>f.intersectsTriangle(e)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},r={},n=0,o=1/0){e.boundingBox||e.computeBoundingBox(),f.set(e.boundingBox.min,e.boundingBox.max,t),f.needsUpdate=!0;let a=this.geometry,s=a.attributes.position,l=a.index,h=e.attributes.position,d=e.index,u=S.getPrimitive(),p=S.getPrimitive(),y=x,M=w,P=null,T=null;r&&(P=b,T=v);let _=1/0,C=null,D=null;return(m.copy(t).invert(),g.matrix.copy(m),this.shapecast({boundsTraverseOrder:e=>f.distanceToBox(e),intersectsBounds:(e,t,i)=>i<_&&i<o&&(t&&(g.min.copy(e.min),g.max.copy(e.max),g.needsUpdate=!0),!0),intersectsRange:(i,r)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:e=>g.distanceToBox(e),intersectsBounds:(e,t,i)=>i<_&&i<o,intersectsRange:(e,o)=>{for(let a=3*e,m=(e+o)*3;a<m;a+=3){(0,c.setTriangle)(p,a,d,h),p.a.applyMatrix4(t),p.b.applyMatrix4(t),p.c.applyMatrix4(t),p.needsUpdate=!0;for(let e=3*i,t=(i+r)*3;e<t;e+=3){(0,c.setTriangle)(u,e,l,s),u.needsUpdate=!0;let t=u.distanceToTriangle(p,y,P);if(t<_&&(M.copy(y),T&&T.copy(P),_=t,C=e/3,D=a/3),t<n)return!0}}}});{let e=d?d.count:h.count;for(let o=0,a=e;o<a;o+=3){(0,c.setTriangle)(p,o,d,h),p.a.applyMatrix4(t),p.b.applyMatrix4(t),p.c.applyMatrix4(t),p.needsUpdate=!0;for(let e=3*i,t=(i+r)*3;e<t;e+=3){(0,c.setTriangle)(u,e,l,s),u.needsUpdate=!0;let t=u.distanceToTriangle(p,y,P);if(t<_&&(M.copy(y),T&&T.copy(P),_=t,C=e/3,D=o/3),t<n)return!0}}}}}),S.releasePrimitive(u),S.releasePrimitive(p),_===1/0)?null:(i.point?i.point.copy(M):i.point=M.clone(),i.distance=_,i.faceIndex=C,r&&(r.point?r.point.copy(T):r.point=T.clone(),r.point.applyMatrix4(m),M.applyMatrix4(m),r.distance=M.sub(r.point).length(),r.faceIndex=D),i)}closestPointToPoint(e,t={},i=0,r=1/0){let n=i*i,o=r*r,a=1/0,s=null;if(this.shapecast({boundsTraverseOrder:t=>(y.copy(e).clamp(t.min,t.max),y.distanceToSquared(e)),intersectsBounds:(e,t,i)=>i<a&&i<o,intersectsTriangle:(t,i)=>{t.closestPointToPoint(e,y);let r=e.distanceToSquared(y);return r<a&&(x.copy(y),a=r,s=i),r<n}}),a===1/0)return null;let l=Math.sqrt(a);return t.point?t.point.copy(x):t.point=x.clone(),t.distance=l,t.faceIndex=s,t}getBoundingBox(e){e.makeEmpty();let t=this._roots;return t.forEach(t=>{(0,h.arrayToBox)(0,new Float32Array(t),M),e.union(M)}),e}}}),parcelRequire.register("ckwVR",function(e,t){$parcel$export(e.exports,"CENTER",()=>i),$parcel$export(e.exports,"AVERAGE",()=>r),$parcel$export(e.exports,"SAH",()=>n),$parcel$export(e.exports,"CONTAINED",()=>o),$parcel$export(e.exports,"TRIANGLE_INTERSECT_COST",()=>a),$parcel$export(e.exports,"TRAVERSAL_COST",()=>s),$parcel$export(e.exports,"BYTES_PER_NODE",()=>l),$parcel$export(e.exports,"IS_LEAFNODE_FLAG",()=>h),$parcel$export(e.exports,"FLOAT32_EPSILON",()=>c);let i=0,r=1,n=2,o=2,a=1.25,s=1,l=32,h=65535,c=5960464477539063e-23}),parcelRequire.register("IWLEN",function(e,t){$parcel$export(e.exports,"buildPackedTree",()=>w);var i=parcelRequire("4xklQ"),r=parcelRequire("2tMyf"),n=parcelRequire("fcnhI"),o=parcelRequire("ckwVR");function a(e,t){if(!e.index){let r;let n=e.attributes.position.count,o=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;r=n>65535?new Uint32Array(new o(4*n)):new Uint16Array(new o(2*n)),e.setIndex(new i.BufferAttribute(r,1));for(let e=0;e<n;e++)r[e]=e}}function s(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];let t=[],i=new Set;for(let t of e.groups)i.add(t.start),i.add(t.start+t.count);let r=Array.from(i.values()).sort((e,t)=>e-t);for(let e=0;e<r.length-1;e++){let i=r[e],n=r[e+1];t.push({offset:i/3,count:(n-i)/3})}return t}function l(e,t,i,r,n=null){let o=1/0,a=1/0,s=1/0,l=-1/0,h=-1/0,c=-1/0,d=1/0,u=1/0,p=1/0,m=-1/0,f=-1/0,g=-1/0,y=null!==n;for(let r=6*t,n=(t+i)*6;r<n;r+=6){let t=e[r+0],i=e[r+1],n=t-i,x=t+i;n<o&&(o=n),x>l&&(l=x),y&&t<d&&(d=t),y&&t>m&&(m=t);let w=e[r+2],b=e[r+3],v=w-b,M=w+b;v<a&&(a=v),M>h&&(h=M),y&&w<u&&(u=w),y&&w>f&&(f=w);let S=e[r+4],P=e[r+5],T=S-P,_=S+P;T<s&&(s=T),_>c&&(c=_),y&&S<p&&(p=S),y&&S>g&&(g=S)}r[0]=o,r[1]=a,r[2]=s,r[3]=l,r[4]=h,r[5]=c,y&&(n[0]=d,n[1]=u,n[2]=p,n[3]=m,n[4]=f,n[5]=g)}function h(e,t,i,r){let n=1/0,o=1/0,a=1/0,s=-1/0,l=-1/0,h=-1/0;for(let r=6*t,c=(t+i)*6;r<c;r+=6){let t=e[r+0];t<n&&(n=t),t>s&&(s=t);let i=e[r+2];i<o&&(o=i),i>l&&(l=i);let c=e[r+4];c<a&&(a=c),c>h&&(h=c)}r[0]=n,r[1]=o,r[2]=a,r[3]=s,r[4]=l,r[5]=h}function c(e,t,i,r,n){let o=i,a=i+r-1,s=n.pos,l=2*n.axis;for(;;){for(;o<=a&&t[6*o+l]<s;)o++;for(;o<=a&&t[6*a+l]>=s;)a--;if(!(o<a))return o;for(let i=0;i<3;i++){let r=e[3*o+i];e[3*o+i]=e[3*a+i],e[3*a+i]=r;let n=t[6*o+2*i+0];t[6*o+2*i+0]=t[6*a+2*i+0],t[6*a+2*i+0]=n;let s=t[6*o+2*i+1];t[6*o+2*i+1]=t[6*a+2*i+1],t[6*a+2*i+1]=s}o++,a--}}let d=32,u=(e,t)=>e.candidate-t.candidate,p=Array(d).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),m=new Float32Array(6);function f(e,t,i,r,a,s){let l=-1,h=0;if(s===o.CENTER)-1!==(l=(0,n.getLongestEdgeIndex)(t))&&(h=(t[l]+t[l+3])/2);else if(s===o.AVERAGE)-1!==(l=(0,n.getLongestEdgeIndex)(e))&&(h=g(i,r,a,l));else if(s===o.SAH){let s=(0,n.computeSurfaceArea)(e),c=o.TRIANGLE_INTERSECT_COST*a,f=6*r,g=(r+a)*6;for(let e=0;e<3;e++){let r=t[e],y=t[e+3],x=y-r,w=x/d;if(a<d/4){let t=[...p];t.length=a;let r=0;for(let o=f;o<g;o+=6,r++){let a=t[r];a.candidate=i[o+2*e],a.count=0;let{bounds:s,leftCacheBounds:l,rightCacheBounds:h}=a;for(let e=0;e<3;e++)h[e]=1/0,h[e+3]=-1/0,l[e]=1/0,l[e+3]=-1/0,s[e]=1/0,s[e+3]=-1/0;(0,n.expandByTriangleBounds)(o,i,s)}t.sort(u);let d=a;for(let e=0;e<d;e++){let i=t[e];for(;e+1<d&&t[e+1].candidate===i.candidate;)t.splice(e+1,1),d--}for(let r=f;r<g;r+=6){let o=i[r+2*e];for(let e=0;e<d;e++){let a=t[e];o>=a.candidate?(0,n.expandByTriangleBounds)(r,i,a.rightCacheBounds):((0,n.expandByTriangleBounds)(r,i,a.leftCacheBounds),a.count++)}}for(let i=0;i<d;i++){let r=t[i],d=r.count,u=a-r.count,p=r.leftCacheBounds,m=r.rightCacheBounds,f=0;0!==d&&(f=(0,n.computeSurfaceArea)(p)/s);let g=0;0!==u&&(g=(0,n.computeSurfaceArea)(m)/s);let y=o.TRAVERSAL_COST+o.TRIANGLE_INTERSECT_COST*(f*d+g*u);y<c&&(l=e,c=y,h=r.candidate)}}else{for(let e=0;e<d;e++){let t=p[e];t.count=0,t.candidate=r+w+e*w;let i=t.bounds;for(let e=0;e<3;e++)i[e]=1/0,i[e+3]=-1/0}for(let t=f;t<g;t+=6){let o=i[t+2*e],a=o-r,s=~~(a/w);s>=d&&(s=d-1);let l=p[s];l.count++,(0,n.expandByTriangleBounds)(t,i,l.bounds)}let t=p[d-1];(0,n.copyBounds)(t.bounds,t.rightCacheBounds);for(let e=d-2;e>=0;e--){let t=p[e],i=p[e+1];(0,n.unionBounds)(t.bounds,i.rightCacheBounds,t.rightCacheBounds)}let u=0;for(let t=0;t<d-1;t++){let i=p[t],r=i.count,d=i.bounds,f=p[t+1],g=f.rightCacheBounds;0!==r&&(0===u?(0,n.copyBounds)(d,m):(0,n.unionBounds)(d,m,m));let y=0,x=0;0!==(u+=r)&&(y=(0,n.computeSurfaceArea)(m)/s);let w=a-u;0!==w&&(x=(0,n.computeSurfaceArea)(g)/s);let b=o.TRAVERSAL_COST+o.TRIANGLE_INTERSECT_COST*(y*u+x*w);b<c&&(l=e,c=b,h=i.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:l,pos:h}}function g(e,t,i,r){let n=0;for(let o=t,a=t+i;o<a;o++)n+=e[6*o+2*r];return n/i}function y(e,t){let i=e.attributes.position,r=e.index.array,n=r.length/3,a=new Float32Array(6*n),s=i.normalized,l=i.array,h=i.offset||0,c=3;i.isInterleavedBufferAttribute&&(c=i.data.stride);let d=["getX","getY","getZ"];for(let e=0;e<n;e++){let n,u,p;let m=3*e,f=6*e;s?(n=r[m+0],u=r[m+1],p=r[m+2]):(n=r[m+0]*c+h,u=r[m+1]*c+h,p=r[m+2]*c+h);for(let e=0;e<3;e++){let r,h,c;s?(r=i[d[e]](n),h=i[d[e]](u),c=i[d[e]](p)):(r=l[n+e],h=l[u+e],c=l[p+e]);let m=r;h<m&&(m=h),c<m&&(m=c);let g=r;h>g&&(g=h),c>g&&(g=c);let y=(g-m)/2,x=2*e;a[f+x+0]=m+y,a[f+x+1]=y+(Math.abs(m)+y)*o.FLOAT32_EPSILON,m<t[e]&&(t[e]=m),g>t[e+3]&&(t[e+3]=g)}}return a}function x(e,t){function i(e){b&&b(e/v)}function n(t,o,a,s=null,h=0){if(!M&&h>=m&&(M=!0,g&&(console.warn(`MeshBVH: Max depth of ${m} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),a<=x||h>=m)return i(o+a),t.offset=o,t.count=a,t;let y=f(t.boundingData,s,u,o,a,w);if(-1===y.axis)return i(o+a),t.offset=o,t.count=a,t;let b=c(p,u,o,a,y);if(b===o||b===o+a)i(o+a),t.offset=o,t.count=a;else{t.splitAxis=y.axis;let e=new r.MeshBVHNode,i=o,s=b-o;t.left=e,e.boundingData=new Float32Array(6),l(u,i,s,e.boundingData,d),n(e,i,s,d,h+1);let c=new r.MeshBVHNode,p=b,m=a-s;t.right=c,c.boundingData=new Float32Array(6),l(u,p,m,c.boundingData,d),n(c,p,m,d,h+1)}return t}a(e,t);let o=new Float32Array(6),d=new Float32Array(6),u=y(e,o),p=e.index.array,m=t.maxDepth,g=t.verbose,x=t.maxLeafTris,w=t.strategy,b=t.onProgress,v=e.index.count/3,M=!1,S=[],P=s(e);if(1===P.length){let e=P[0],t=new r.MeshBVHNode;t.boundingData=o,h(u,e.offset,e.count,d),n(t,e.offset,e.count,d),S.push(t)}else for(let e of P){let t=new r.MeshBVHNode;t.boundingData=new Float32Array(6),l(u,e.offset,e.count,t.boundingData,d),n(t,e.offset,e.count,d),S.push(t)}return S}function w(e,t){let i,r,n;let a=x(e,t),s=[],l=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let e=0;e<a.length;e++){let t=a[e],d=h(t),u=new l(o.BYTES_PER_NODE*d);i=new Float32Array(u),r=new Uint32Array(u),n=new Uint16Array(u),c(0,t),s.push(u)}return s;function h(e){return e.count?1:1+h(e.left)+h(e.right)}function c(e,t){let a=e/4,s=e/2,l=!!t.count,h=t.boundingData;for(let e=0;e<6;e++)i[a+e]=h[e];if(l){let i=t.offset,l=t.count;return r[a+6]=i,n[s+14]=l,n[s+15]=o.IS_LEAFNODE_FLAG,e+o.BYTES_PER_NODE}{let i;let n=t.left,s=t.right,l=t.splitAxis;if((i=c(e+o.BYTES_PER_NODE,n))/4>4294967296)throw Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return r[a+6]=i/4,i=c(i,s),r[a+7]=l,i}}}}),parcelRequire.register("2tMyf",function(e,t){$parcel$export(e.exports,"MeshBVHNode",()=>i);class i{constructor(){}}}),parcelRequire.register("fcnhI",function(e,t){function i(e,t,i){return i.min.x=t[e],i.min.y=t[e+1],i.min.z=t[e+2],i.max.x=t[e+3],i.max.y=t[e+4],i.max.z=t[e+5],i}function r(e){let t=-1,i=-1/0;for(let r=0;r<3;r++){let n=e[r+3]-e[r];n>i&&(i=n,t=r)}return t}function n(e,t){t.set(e)}function o(e,t,i){let r,n;for(let o=0;o<3;o++){let a=o+3;r=e[o],n=t[o],i[o]=r<n?r:n,r=e[a],n=t[a],i[a]=r>n?r:n}}function a(e,t,i){for(let r=0;r<3;r++){let n=t[e+2*r],o=t[e+2*r+1],a=n-o,s=n+o;a<i[r]&&(i[r]=a),s>i[r+3]&&(i[r+3]=s)}}function s(e){let t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2];return 2*(t*i+i*r+r*t)}$parcel$export(e.exports,"arrayToBox",()=>i),$parcel$export(e.exports,"getLongestEdgeIndex",()=>r),$parcel$export(e.exports,"copyBounds",()=>n),$parcel$export(e.exports,"unionBounds",()=>o),$parcel$export(e.exports,"expandByTriangleBounds",()=>a),$parcel$export(e.exports,"computeSurfaceArea",()=>s)}),parcelRequire.register("iR33e",function(e,t){let i,r,n,o;$parcel$export(e.exports,"raycast",()=>x),$parcel$export(e.exports,"raycastFirst",()=>w),$parcel$export(e.exports,"shapecast",()=>b),$parcel$export(e.exports,"intersectsGeometry",()=>v),$parcel$export(e.exports,"setBuffer",()=>P),$parcel$export(e.exports,"clearBuffer",()=>T);var a=parcelRequire("4xklQ"),s=parcelRequire("ckwVR"),l=parcelRequire("8YY3V"),h=parcelRequire("57zgU"),c=parcelRequire("2nenX"),d=parcelRequire("bNX9f"),u=parcelRequire("fcnhI"),p=parcelRequire("f8eJn"),m=parcelRequire("kBHG0");let f=new a.Box3,g=new a.Vector3,y=["x","y","z"];function x(e,t,i,a,s){let l=2*e,h=r,d=n,u=o,p=(0,m.IS_LEAF)(l,d);if(p){let r=(0,m.OFFSET)(e,u),n=(0,m.COUNT)(l,d);(0,c.intersectTris)(t,i,a,r,n,s)}else{let r=(0,m.LEFT_NODE)(e);M(r,h,a,g)&&x(r,t,i,a,s);let n=(0,m.RIGHT_NODE)(e,u);M(n,h,a,g)&&x(n,t,i,a,s)}}function w(e,t,i,a){let s=2*e,l=r,h=n,d=o,u=(0,m.IS_LEAF)(s,h);if(u){let r=(0,m.OFFSET)(e,d),n=(0,m.COUNT)(s,h);return(0,c.intersectClosestTri)(t,i,a,r,n)}{let r,n;let o=(0,m.SPLIT_AXIS)(e,d),s=y[o],h=a.direction[s],c=h>=0;c?(r=(0,m.LEFT_NODE)(e),n=(0,m.RIGHT_NODE)(e,d)):(r=(0,m.RIGHT_NODE)(e,d),n=(0,m.LEFT_NODE)(e));let u=M(r,l,a,g),p=u?w(r,t,i,a):null;if(p){let e=p.point[s],t=c?e<=l[n+o]:e>=l[n+o+3];if(t)return p}let f=M(n,l,a,g),x=f?w(n,t,i,a):null;return p&&x?p.distance<=x.distance?p:x:p||x||null}}let b=function(){let e,t;let i=[],l=new p.PrimitivePool(()=>new a.Box3);return function(...r){e=l.getPrimitive(),t=l.getPrimitive(),i.push(e,t);let n=h(...r);l.releasePrimitive(e),l.releasePrimitive(t),i.pop(),i.pop();let o=i.length;return o>0&&(t=i[o-1],e=i[o-2]),n};function h(i,a,l,c,d=null,p=0,f=0){function g(e){let t=2*e,i=n,r=o;for(;!(0,m.IS_LEAF)(t,i);)t=2*(e=(0,m.LEFT_NODE)(e));return(0,m.OFFSET)(e,r)}function y(e){let t=2*e,i=n,r=o;for(;!(0,m.IS_LEAF)(t,i);)t=2*(e=(0,m.RIGHT_NODE)(e,r));return(0,m.OFFSET)(e,r)+(0,m.COUNT)(t,i)}let x=2*i,w=r,b=n,v=o,M=(0,m.IS_LEAF)(x,b);if(M){let t=(0,m.OFFSET)(i,v),r=(0,m.COUNT)(x,b);return(0,u.arrayToBox)((0,m.BOUNDING_DATA_INDEX)(i),w,e),c(t,r,!1,f,p+i,e)}{let r,n,o,x,M,S;let P=(0,m.LEFT_NODE)(i),T=(0,m.RIGHT_NODE)(i,v),_=P,C=T;if(d&&(o=e,x=t,(0,u.arrayToBox)((0,m.BOUNDING_DATA_INDEX)(_),w,o),(0,u.arrayToBox)((0,m.BOUNDING_DATA_INDEX)(C),w,x),r=d(o),(n=d(x))<r)){_=T,C=P;let e=r;r=n,n=e,o=x}o||(o=e,(0,u.arrayToBox)((0,m.BOUNDING_DATA_INDEX)(_),w,o));let D=(0,m.IS_LEAF)(2*_,b),A=l(o,D,r,f+1,p+_);if(A===s.CONTAINED){let e=g(_),t=y(_),i=t-e;M=c(e,i,!0,f+1,p+_,o)}else M=A&&h(_,a,l,c,d,p,f+1);if(M)return!0;x=t,(0,u.arrayToBox)((0,m.BOUNDING_DATA_INDEX)(C),w,x);let E=(0,m.IS_LEAF)(2*C,b),L=l(x,E,n,f+1,p+C);if(L===s.CONTAINED){let e=g(C),t=y(C),i=t-e;S=c(e,i,!0,f+1,p+C,x)}else S=L&&h(C,a,l,c,d,p,f+1);return!!S}}}(),v=function(){let e=new h.ExtendedTriangle,t=new h.ExtendedTriangle,i=new a.Matrix4,s=new l.OrientedBox,c=new l.OrientedBox;return function a(l,h,p,g,y=null){let x=2*l,w=r,b=n,v=o;null===y&&(p.boundingBox||p.computeBoundingBox(),s.set(p.boundingBox.min,p.boundingBox.max,g),y=s);let M=(0,m.IS_LEAF)(x,b);if(M){let r=h,n=r.index,o=r.attributes.position,a=p.index,s=p.attributes.position,f=(0,m.OFFSET)(l,v),y=(0,m.COUNT)(x,b);if(i.copy(g).invert(),p.boundsTree){(0,u.arrayToBox)((0,m.BOUNDING_DATA_INDEX)(l),w,c),c.matrix.copy(i),c.needsUpdate=!0;let e=p.boundsTree.shapecast({intersectsBounds:e=>c.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(g),e.b.applyMatrix4(g),e.c.applyMatrix4(g),e.needsUpdate=!0;for(let i=3*f,r=(y+f)*3;i<r;i+=3)if((0,d.setTriangle)(t,i,n,o),t.needsUpdate=!0,e.intersectsTriangle(t))return!0;return!1}});return e}for(let r=3*f,l=y+3*f;r<l;r+=3){(0,d.setTriangle)(e,r,n,o),e.a.applyMatrix4(i),e.b.applyMatrix4(i),e.c.applyMatrix4(i),e.needsUpdate=!0;for(let i=0,r=a.count;i<r;i+=3)if((0,d.setTriangle)(t,i,a,s),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}else{let e=l+8,t=v[l+6];(0,u.arrayToBox)((0,m.BOUNDING_DATA_INDEX)(e),w,f);let i=y.intersectsBox(f)&&a(e,h,p,g,y);if(i)return!0;(0,u.arrayToBox)((0,m.BOUNDING_DATA_INDEX)(t),w,f);let r=y.intersectsBox(f)&&a(t,h,p,g,y);return!!r}}}();function M(e,t,i,r){return(0,u.arrayToBox)(e,t,f),i.intersectBox(f,r)}let S=[];function P(e){i&&S.push(i),i=e,r=new Float32Array(e),n=new Uint16Array(e),o=new Uint32Array(e)}function T(){i=null,r=null,n=null,o=null,S.length&&P(S.pop())}}),parcelRequire.register("8YY3V",function(e,t){$parcel$export(e.exports,"OrientedBox",()=>a);var i=parcelRequire("4xklQ"),r=parcelRequire("OS03B"),n=parcelRequire("57zgU"),o=parcelRequire("3jQfW");class a{constructor(e,t,n){this.isOrientedBox=!0,this.min=new i.Vector3,this.max=new i.Vector3,this.matrix=new i.Matrix4,this.invMatrix=new i.Matrix4,this.points=Array(8).fill().map(()=>new i.Vector3),this.satAxes=[,,,].fill().map(()=>new i.Vector3),this.satBounds=[,,,].fill().map(()=>new r.SeparatingAxisBounds),this.alignedSatBounds=[,,,].fill().map(()=>new r.SeparatingAxisBounds),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),n&&this.matrix.copy(n)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}a.prototype.update=function(){return function(){let e=this.matrix,t=this.min,i=this.max,r=this.points;for(let n=0;n<=1;n++)for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){let s=1*n|2*o|4*a,l=r[s];l.x=n?i.x:t.x,l.y=o?i.y:t.y,l.z=a?i.z:t.z,l.applyMatrix4(e)}let n=this.satBounds,o=this.satAxes,a=r[0];for(let e=0;e<3;e++){let t=o[e],i=n[e],s=1<<e,l=r[s];t.subVectors(a,l),i.setFromPoints(t,r)}let s=this.alignedSatBounds;s[0].setFromPointsField(r,"x"),s[1].setFromPointsField(r,"y"),s[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}(),a.prototype.intersectsBox=function(){let e=new r.SeparatingAxisBounds;return function(t){this.needsUpdate&&this.update();let i=t.min,r=t.max,n=this.satBounds,o=this.satAxes,a=this.alignedSatBounds;if(e.min=i.x,e.max=r.x,a[0].isSeparated(e)||(e.min=i.y,e.max=r.y,a[1].isSeparated(e))||(e.min=i.z,e.max=r.z,a[2].isSeparated(e)))return!1;for(let i=0;i<3;i++){let r=o[i],a=n[i];if(e.setFromBox(r,t),a.isSeparated(e))return!1}return!0}}(),a.prototype.intersectsTriangle=function(){let e=new n.ExtendedTriangle,t=[,,,],o=new r.SeparatingAxisBounds,a=new r.SeparatingAxisBounds,s=new i.Vector3;return function(i){this.needsUpdate&&this.update(),i.isExtendedTriangle?i.needsUpdate&&i.update():(e.copy(i),e.update(),i=e);let r=this.satBounds,n=this.satAxes;t[0]=i.a,t[1]=i.b,t[2]=i.c;for(let e=0;e<3;e++){let i=r[e],a=n[e];if(o.setFromPoints(a,t),i.isSeparated(o))return!1}let l=i.satBounds,h=i.satAxes,c=this.points;for(let e=0;e<3;e++){let t=l[e],i=h[e];if(o.setFromPoints(i,c),t.isSeparated(o))return!1}for(let e=0;e<3;e++){let i=n[e];for(let e=0;e<4;e++){let r=h[e];if(s.crossVectors(i,r),o.setFromPoints(s,t),a.setFromPoints(s,c),o.isSeparated(a))return!1}}return!0}}(),a.prototype.closestPointToPoint=function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}(),a.prototype.distanceToPoint=function(){let e=new i.Vector3;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),a.prototype.distanceToBox=function(){let e=["x","y","z"],t=Array(12).fill().map(()=>new i.Line3),r=Array(12).fill().map(()=>new i.Line3),n=new i.Vector3,a=new i.Vector3;return function(i,s=0,l=null,h=null){if(this.needsUpdate&&this.update(),this.intersectsBox(i))return(l||h)&&(i.getCenter(a),this.closestPointToPoint(a,n),i.closestPointToPoint(n,a),l&&l.copy(n),h&&h.copy(a)),0;let c=s*s,d=i.min,u=i.max,p=this.points,m=1/0;for(let e=0;e<8;e++){let t=p[e];a.copy(t).clamp(d,u);let i=t.distanceToSquared(a);if(i<m&&(m=i,l&&l.copy(t),h&&h.copy(a),i<c))return Math.sqrt(i)}let f=0;for(let i=0;i<3;i++)for(let n=0;n<=1;n++)for(let o=0;o<=1;o++){let a=(i+1)%3,s=(i+2)%3,l=n<<a|o<<s,h=1<<i|n<<a|o<<s,c=p[l],m=p[h],g=t[f];g.set(c,m);let y=e[i],x=e[a],w=e[s],b=r[f],v=b.start,M=b.end;v[y]=d[y],v[x]=n?d[x]:u[x],v[w]=o?d[w]:u[x],M[y]=u[y],M[x]=n?d[x]:u[x],M[w]=o?d[w]:u[x],f++}for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let i=0;i<=1;i++){a.x=e?u.x:d.x,a.y=t?u.y:d.y,a.z=i?u.z:d.z,this.closestPointToPoint(a,n);let r=a.distanceToSquared(n);if(r<m&&(m=r,l&&l.copy(n),h&&h.copy(a),r<c))return Math.sqrt(r)}for(let e=0;e<12;e++){let i=t[e];for(let e=0;e<12;e++){let t=r[e];(0,o.closestPointsSegmentToSegment)(i,t,n,a);let s=n.distanceToSquared(a);if(s<m&&(m=s,l&&l.copy(n),h&&h.copy(a),s<c))return Math.sqrt(s)}}return Math.sqrt(m)}}()}),parcelRequire.register("OS03B",function(e,t){$parcel$export(e.exports,"SeparatingAxisBounds",()=>r);var i=parcelRequire("4xklQ");class r{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,r=-1/0;for(let n=0,o=e.length;n<o;n++){let o=e[n],a=o[t];i=a<i?a:i,r=a>r?a:r}this.min=i,this.max=r}setFromPoints(e,t){let i=1/0,r=-1/0;for(let n=0,o=t.length;n<o;n++){let o=t[n],a=e.dot(o);i=a<i?a:i,r=a>r?a:r}this.min=i,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}}r.prototype.setFromBox=function(){let e=new i.Vector3;return function(t,i){let r=i.min,n=i.max,o=1/0,a=-1/0;for(let i=0;i<=1;i++)for(let s=0;s<=1;s++)for(let l=0;l<=1;l++){e.x=r.x*i+n.x*(1-i),e.y=r.y*s+n.y*(1-s),e.z=r.z*l+n.z*(1-l);let h=t.dot(e);o=Math.min(h,o),a=Math.max(h,a)}this.min=o,this.max=a}}(),function(){new r}()}),parcelRequire.register("57zgU",function(e,t){$parcel$export(e.exports,"ExtendedTriangle",()=>s);var i=parcelRequire("4xklQ"),r=parcelRequire("OS03B"),n=parcelRequire("3jQfW");let o=1e-15;function a(e){return Math.abs(e)<o}class s extends i.Triangle{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=[,,,,].fill().map(()=>new i.Vector3),this.satBounds=[,,,,].fill().map(()=>new r.SeparatingAxisBounds),this.points=[this.a,this.b,this.c],this.sphere=new i.Sphere,this.plane=new i.Plane,this.needsUpdate=!0}intersectsSphere(e){return(0,n.sphereIntersectTriangle)(e,this)}update(){let e=this.a,t=this.b,i=this.c,r=this.points,n=this.satAxes,o=this.satBounds,a=n[0],s=o[0];this.getNormal(a),s.setFromPoints(a,r);let l=n[1],h=o[1];l.subVectors(e,t),h.setFromPoints(l,r);let c=n[2],d=o[2];c.subVectors(t,i),d.setFromPoints(c,r);let u=n[3],p=o[3];u.subVectors(i,e),p.setFromPoints(u,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}}s.prototype.closestPointToSegment=function(){let e=new i.Vector3,t=new i.Vector3,r=new i.Line3;return function(i,o=null,a=null){let s;let{start:l,end:h}=i,c=this.points,d=1/0;for(let l=0;l<3;l++){let h=(l+1)%3;r.start.copy(c[l]),r.end.copy(c[h]),(0,n.closestPointsSegmentToSegment)(r,i,e,t),(s=e.distanceToSquared(t))<d&&(d=s,o&&o.copy(e),a&&a.copy(t))}return this.closestPointToPoint(l,e),(s=l.distanceToSquared(e))<d&&(d=s,o&&o.copy(e),a&&a.copy(l)),this.closestPointToPoint(h,e),(s=h.distanceToSquared(e))<d&&(d=s,o&&o.copy(e),a&&a.copy(h)),Math.sqrt(d)}}(),s.prototype.intersectsTriangle=function(){let e=new s,t=[,,,],n=[,,,],o=new r.SeparatingAxisBounds,l=new r.SeparatingAxisBounds,h=new i.Vector3,c=new i.Vector3,d=new i.Vector3,u=new i.Vector3,p=new i.Line3,m=new i.Line3,f=new i.Line3;return function(i,r=null,s=!1){this.needsUpdate&&this.update(),i.isExtendedTriangle?i.needsUpdate&&i.update():(e.copy(i),e.update(),i=e);let g=this.plane,y=i.plane;if(Math.abs(g.normal.dot(y.normal))>1-1e-10){let e=this.satBounds,a=this.satAxes;n[0]=i.a,n[1]=i.b,n[2]=i.c;for(let t=0;t<4;t++){let i=e[t],r=a[t];if(o.setFromPoints(r,n),i.isSeparated(o))return!1}let c=i.satBounds,d=i.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let e=0;e<4;e++){let i=c[e],r=d[e];if(o.setFromPoints(r,t),i.isSeparated(o))return!1}for(let e=0;e<4;e++){let i=a[e];for(let e=0;e<4;e++){let r=d[e];if(h.crossVectors(i,r),o.setFromPoints(h,t),l.setFromPoints(h,n),o.isSeparated(l))return!1}}return r&&(s||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),r.start.set(0,0,0),r.end.set(0,0,0)),!0}{let e=this.points,t=!1,n=0;for(let i=0;i<3;i++){let r=e[i],o=e[(i+1)%3];p.start.copy(r),p.end.copy(o),p.delta(c);let s=t?m.start:m.end,l=a(y.distanceToPoint(r));if(a(y.normal.dot(c))&&l){m.copy(p),n=2;break}let h=y.intersectLine(p,s)||l;if(h&&!a(s.distanceTo(o))){if(n++,t)break;t=!0}}if(1===n&&i.containsPoint(m.end))return r&&(r.start.copy(m.end),r.end.copy(m.end)),!0;if(2!==n)return!1;let o=i.points,s=!1,l=0;for(let e=0;e<3;e++){let t=o[e],i=o[(e+1)%3];p.start.copy(t),p.end.copy(i),p.delta(d);let r=s?f.start:f.end,n=a(g.distanceToPoint(t));if(a(g.normal.dot(d))&&n){f.copy(p),l=2;break}let h=g.intersectLine(p,r)||n;if(h&&!a(r.distanceTo(i))){if(l++,s)break;s=!0}}if(1===l&&this.containsPoint(f.end))return r&&(r.start.copy(f.end),r.end.copy(f.end)),!0;if(2!==l)return!1;if(m.delta(c),f.delta(d),0>c.dot(d)){let e=f.start;f.start=f.end,f.end=e}let h=m.start.dot(c),x=m.end.dot(c),w=f.start.dot(c),b=f.end.dot(c),v=x<w,M=h<b;return(h===b||w===x||v!==M)&&(r&&(u.subVectors(m.start,f.start),u.dot(c)>0?r.start.copy(m.start):r.start.copy(f.start),u.subVectors(m.end,f.end),0>u.dot(c)?r.end.copy(m.end):r.end.copy(f.end)),!0)}}}(),s.prototype.distanceToPoint=function(){let e=new i.Vector3;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),s.prototype.distanceToTriangle=function(){let e=new i.Vector3,t=new i.Vector3,r=["a","b","c"],o=new i.Line3,a=new i.Line3;return function(i,s=null,l=null){let h=s||l?o:null;if(this.intersectsTriangle(i,h))return(s||l)&&(s&&h.getCenter(s),l&&h.getCenter(l)),0;let c=1/0;for(let t=0;t<3;t++){let n;let o=r[t],a=i[o];this.closestPointToPoint(a,e),(n=a.distanceToSquared(e))<c&&(c=n,s&&s.copy(e),l&&l.copy(a));let h=this[o];i.closestPointToPoint(h,e),(n=h.distanceToSquared(e))<c&&(c=n,s&&s.copy(h),l&&l.copy(e))}for(let h=0;h<3;h++){let d=r[h],u=r[(h+1)%3];o.set(this[d],this[u]);for(let h=0;h<3;h++){let d=r[h],u=r[(h+1)%3];a.set(i[d],i[u]),(0,n.closestPointsSegmentToSegment)(o,a,e,t);let p=e.distanceToSquared(t);p<c&&(c=p,s&&s.copy(e),l&&l.copy(t))}}return Math.sqrt(c)}}()}),parcelRequire.register("3jQfW",function(e,t){$parcel$export(e.exports,"closestPointsSegmentToSegment",()=>n),$parcel$export(e.exports,"sphereIntersectTriangle",()=>o);var i=parcelRequire("4xklQ");let r=function(){let e=new i.Vector3,t=new i.Vector3,r=new i.Vector3;return function(i,n,o){let a,s;let l=i.start,h=e,c=n.start,d=t;r.subVectors(l,c),e.subVectors(i.end,i.start),t.subVectors(n.end,n.start);let u=r.dot(d),p=d.dot(h),m=d.dot(d),f=r.dot(h),g=h.dot(h),y=g*m-p*p;a=0!==y?(u*p-f*m)/y:0,s=(u+a*p)/m,o.x=a,o.y=s}}(),n=function(){let e=new i.Vector2,t=new i.Vector3,n=new i.Vector3;return function(i,o,a,s){r(i,o,e);let l=e.x,h=e.y;if(l>=0&&l<=1&&h>=0&&h<=1){i.at(l,a),o.at(h,s);return}if(l>=0&&l<=1){h<0?o.at(0,s):o.at(1,s),i.closestPointToPoint(s,!0,a);return}if(h>=0&&h<=1){l<0?i.at(0,a):i.at(1,a),o.closestPointToPoint(a,!0,s);return}{let e,r;e=l<0?i.start:i.end,r=h<0?o.start:o.end;let c=t,d=n;if(i.closestPointToPoint(r,!0,t),o.closestPointToPoint(e,!0,n),c.distanceToSquared(r)<=d.distanceToSquared(e)){a.copy(c),s.copy(r);return}a.copy(e),s.copy(d);return}}}(),o=function(){let e=new i.Vector3,t=new i.Vector3,r=new i.Plane,n=new i.Line3;return function(i,o){let{radius:a,center:s}=i,{a:l,b:h,c:c}=o;n.start=l,n.end=h;let d=n.closestPointToPoint(s,!0,e);if(d.distanceTo(s)<=a)return!0;n.start=l,n.end=c;let u=n.closestPointToPoint(s,!0,e);if(u.distanceTo(s)<=a)return!0;n.start=h,n.end=c;let p=n.closestPointToPoint(s,!0,e);if(p.distanceTo(s)<=a)return!0;let m=o.getPlane(r),f=Math.abs(m.distanceToPoint(s));if(f<=a){let e=m.projectPoint(s,t),i=o.containsPoint(e);if(i)return!0}return!1}}()}),parcelRequire.register("2nenX",function(e,t){$parcel$export(e.exports,"intersectTris",()=>r),$parcel$export(e.exports,"intersectClosestTri",()=>n),$parcel$export(e.exports,"convertRaycastIntersect",()=>o);var i=parcelRequire("4tjWS");function r(e,t,r,n,o,a){for(let s=n,l=n+o;s<l;s++)(0,i.intersectTri)(e,t,r,s,a)}function n(e,t,r,n,o){let a=1/0,s=null;for(let l=n,h=n+o;l<h;l++){let n=(0,i.intersectTri)(e,t,r,l);n&&n.distance<a&&(s=n,a=n.distance)}return s}function o(e,t,i){return null===e?null:(e.point.applyMatrix4(t.matrixWorld),e.distance=e.point.distanceTo(i.ray.origin),e.object=t,e.distance<i.near||e.distance>i.far)?null:e}}),parcelRequire.register("4tjWS",function(e,t){$parcel$export(e.exports,"intersectTri",()=>u);var i=parcelRequire("4xklQ");let r=new i.Vector3,n=new i.Vector3,o=new i.Vector3,a=new i.Vector2,s=new i.Vector2,l=new i.Vector2,h=new i.Vector3;function c(e,t,r,n,o,a){let s;if(null===(s=a===i.BackSide?e.intersectTriangle(n,r,t,!0,o):e.intersectTriangle(t,r,n,a!==i.DoubleSide,o)))return null;let l=e.origin.distanceTo(o);return{distance:l,point:o.clone()}}function d(e,t,d,u,p,m,f){r.fromBufferAttribute(t,u),n.fromBufferAttribute(t,p),o.fromBufferAttribute(t,m);let g=c(e,r,n,o,h,f);if(g){d&&(a.fromBufferAttribute(d,u),s.fromBufferAttribute(d,p),l.fromBufferAttribute(d,m),g.uv=(0,i.Triangle).getUV(h,r,n,o,a,s,l,new i.Vector2));let e={a:u,b:p,c:m,normal:new i.Vector3,materialIndex:0};(0,i.Triangle).getNormal(r,n,o,e.normal),g.face=e,g.faceIndex=u}return g}function u(e,t,i,r,n){let o=3*r,a=e.index.getX(o),s=e.index.getX(o+1),l=e.index.getX(o+2),h=d(i,e.attributes.position,e.attributes.uv,a,s,l,t);return h?(h.faceIndex=r,n&&n.push(h),h):null}}),parcelRequire.register("bNX9f",function(e,t){function i(e,t,i,r){let n=e.a,o=e.b,a=e.c,s=t,l=t+1,h=t+2;i&&(s=i.getX(t),l=i.getX(t+1),h=i.getX(t+2)),n.x=r.getX(s),n.y=r.getY(s),n.z=r.getZ(s),o.x=r.getX(l),o.y=r.getY(l),o.z=r.getZ(l),a.x=r.getX(h),a.y=r.getY(h),a.z=r.getZ(h)}function r(e,t,r,n,o,a,s){let l=r.index,h=r.attributes.position;for(let r=e,c=t+e;r<c;r++)if(i(s,3*r,l,h),s.needsUpdate=!0,n(s,r,o,a))return!0;return!1}$parcel$export(e.exports,"setTriangle",()=>i),$parcel$export(e.exports,"iterateOverTriangles",()=>r),parcelRequire("4xklQ")}),parcelRequire.register("f8eJn",function(e,t){$parcel$export(e.exports,"PrimitivePool",()=>i);class i{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}}),parcelRequire.register("kBHG0",function(e,t){function i(e,t){return 65535===t[e+15]}function r(e,t){return t[e+6]}function n(e,t){return t[e+14]}function o(e){return e+8}function a(e,t){return t[e+6]}function s(e,t){return t[e+7]}function l(e){return e}$parcel$export(e.exports,"IS_LEAF",()=>i),$parcel$export(e.exports,"OFFSET",()=>r),$parcel$export(e.exports,"COUNT",()=>n),$parcel$export(e.exports,"LEFT_NODE",()=>o),$parcel$export(e.exports,"RIGHT_NODE",()=>a),$parcel$export(e.exports,"SPLIT_AXIS",()=>s),$parcel$export(e.exports,"BOUNDING_DATA_INDEX",()=>l)}),parcelRequire.register("cy3as",function(e,t){$parcel$export(e.exports,"HalfEdgeMap",()=>a);var i=parcelRequire("4xklQ");let r=[new i.Vector3,new i.Vector3,new i.Vector3];function n(e){return~~(1e4*e)}function o(e){return`${n(e.x)},${n(e.y)},${n(e.z)}`}class a{constructor(e=null){this.data=null,this.unmatchedEdges=null,this.matchedEdges=null,this.useDrawRange=!0,e&&this.updateFrom(e)}getSiblingTriangleIndex(e,t){let i=this.data[3*e+t];return -1===i?-1:~~(i/3)}getSiblingEdgeIndex(e,t){let i=this.data[3*e+t];return -1===i?-1:i%3}updateFrom(e){let t=new Map,{attributes:i}=e,n=e.index,a=i.position,s=n?n.count/3:a.count/3,l=s,h=0;this.useDrawRange&&(h=e.drawRange.start,e.drawRange.count!==1/0&&(s=~~(e.drawRange.count/3)));let c=this.data;(!c||c.length<3*l)&&(c=new Int32Array(3*l)),c.fill(-1);let d=0,u=0;for(let e=0;e<s;e++){let i=3*e+h;for(let e=0;e<3;e++){let t=i+e;n&&(t=n.getX(t)),r[e].fromBufferAttribute(a,t)}for(let e=0;e<3;e++){let n=(e+1)%3,a=r[e],s=r[n],l=o(a),h=o(s),p=`${h}_${l}`;if(t.has(p)){let r=t.get(p);c[i+e]=r,c[r]=i+e,t.delete(p),d--,u++}else{let r=`${l}_${h}`;t.set(r,i+e),d++}}}this.matchedEdges=u,this.unmatchedEdges=d,this.data=c}}}),parcelRequire.register("14bAY",function(e,t){function i(){return"undefined"!=typeof SharedArrayBuffer}function r(e){if(e.buffer instanceof SharedArrayBuffer)return e;let t=e.constructor,i=e.buffer,r=new SharedArrayBuffer(i.byteLength),n=new Uint8Array(i),o=new Uint8Array(r);return o.set(n,0),new t(r)}$parcel$export(e.exports,"areSharedArrayBuffersSupported",()=>i),$parcel$export(e.exports,"convertToSharedArrayBuffer",()=>r)}),parcelRequire.register("2C75G",function(e,t){$parcel$export(e.exports,"WallCreator",()=>l),$parcel$export(e.exports,"Wall3DGeometry",()=>h);var i=parcelRequire("4xklQ"),r=parcelRequire("hrM0U"),n=parcelRequire("gDTsF");class o extends i.Mesh{constructor(e,t){super(e,t),this.useType="wall",this.parameter={}}computeVertices(){let e=Array.from(this.geometry.attributes.position.array),t=[];for(let r=0;r<e.length;r+=3)t.push(new i.Vector2(e[r],e[r+1]));this.parameter.points=t}computeLineEquation(){this.isArc,!1==this.isArc&&(this.parameter.innerLineEquation=(0,r.CommonFunc).getLineEquation(this.parameter.points[0],this.parameter.points[3]),this.parameter.middleLineEquation=(0,r.CommonFunc).getLineEquation(this.parameter.points[1],this.parameter.points[4]),this.parameter.outerLineEquation=(0,r.CommonFunc).getLineEquation(this.parameter.points[2],this.parameter.points[5])),this.isArc}updateVertex(e,t){let r=this.geometry.attributes.position.array;r[3*e]=t.x,r[3*e+1]=t.y,this.geometry.attributes.position=new i.BufferAttribute(new Float32Array(r),3);let n=this.geometry.attributes.position.array;this.parameter.points[e]=new i.Vector2(n[3*e],n[3*e+1]),this.updateMatrix()}updateVertex2(e,t){this.parameter.points.forEach(e=>{e.equals()})}getIndex(e){for(let t=0;t<this.parameter.points.length;t++)if(this.parameter.points[t].equals(e))return t}}class a{constructor(e){this.start=new i.Vector2(e.start.x,e.start.y),this.end=new i.Vector2(e.end.x,e.end.y),this.thickness=e.thickness,this.line=e.line,this.getNormalVec(),this.generateVertices(),this.generateLine()}generateVertices(){switch(this.vertices=Array(6),this.line){case 0:this.vertices[0]=this.start.clone().add(this.normalVec.clone().negate()),this.vertices[1]=this.start.clone(),this.vertices[2]=this.start.clone().add(this.normalVec.clone()),this.vertices[3]=this.end.clone().add(this.normalVec.clone().negate()),this.vertices[4]=this.end.clone(),this.vertices[5]=this.end.clone().add(this.normalVec.clone());break;case 1:let e=this.normalVec.clone().negate();this.vertices[2]=this.start.clone(),this.vertices[1]=this.vertices[2].clone().add(e.clone()),this.vertices[0]=this.vertices[1].clone().add(e.clone()),this.vertices[5]=this.end.clone(),this.vertices[4]=this.vertices[5].clone().add(e.clone()),this.vertices[3]=this.vertices[4].clone().add(e.clone());break;case 2:this.vertices[0]=this.start.clone(),this.vertices[1]=this.vertices[0].clone().add(this.normalVec.clone()),this.vertices[2]=this.vertices[1].clone().add(this.normalVec.clone()),this.vertices[3]=this.end.clone(),this.vertices[4]=this.vertices[3].clone().add(this.normalVec.clone()),this.vertices[5]=this.vertices[4].clone().add(this.normalVec.clone())}this.points=this.vertices.map(e=>new n.Point(e.x,e.y))}getVertex(e){return this.vertices[e]}getPoint(e){return this.points[e]}updateVertex(e,t){this.vertices[e]=new i.Vector2(t.x,t.y),this.points[e]=t}generateLine(){this.innerLine=new n.Line(this.points[0],this.points[3]),this.middleLine=new n.Line(this.points[1],this.points[4]),this.outerLine=new n.Line(this.points[2],this.points[5])}getNormalVec(){let e=new(0,i.Vector2)().subVectors(this.start,this.end);this.normalVec=new(0,i.Vector2)(-e.y,e.x).normalize().setLength(this.thickness/2)}}class s{constructor(e,t=!1){if(this.start=new i.Vector2(e.start.x,e.start.y),this.end=new i.Vector2(e.end.x,e.end.y),this.style=e.style,this.thickness=e.thickness,this.height=e.height,this.isArc=e.isArc,this.line=e.line,e.id&&(this.id=e.id),this.walls=[],this.computeWallS,this.computeWallE,"circle"==e.isArc){let n,o,s=!0,l;if(e.cp)l=new i.Vector2(e.cp.x,e.cp.y),o=(n=(0,r.CommonFunc).getCircleCenter(l,this.start,this.end)).distanceTo(this.start),s=(0,r.CommonFunc).getClockWise(this.start,l,this.end);else{n=this.start.clone().add(this.end).divideScalar(2),o=this.start.distanceTo(n),s=this.getArcClockwise(t);let e=this.start.clone().sub(n);l=s?new i.Vector2(n.x+e.y,n.y-e.x):new i.Vector2(n.x-e.y,n.y+e.x)}this.arcCenter=n,this.cp=l;let h=this.getArcPoints({type:"circle",center:n,radius:o,clockWise:s,controlP:l});for(let t=1;t<h.length;t++){let i=new a({start:h[t-1],end:h[t],thickness:e.thickness,line:e.line});1==t&&(this.computeWallS=i),t==h.length-1&&(this.computeWallE=i),this.walls.push(i)}}else if("bezier"==e.isArc);else{let t=new a({start:e.start,end:e.end,thickness:e.thickness,line:e.line});this.walls.push(t),this.computeWallS=t,this.computeWallE=t}this.clockWiseST=2*Math.PI,this.clockWiseSF=2*Math.PI,this.clockWiseET=2*Math.PI,this.clockWiseEF=2*Math.PI}getArcClockwise(e){let t=0,i=0;for(let n=0;n<e.length;n++){let o=e[n];if(o.start.equals(this.start)||o.start.equals(this.end)||o.end.equals(this.start)||o.end.equals(this.end)){let e=o.start.clone().add(o.end).divideScalar(2);(0,r.CommonFunc).getClockWise(this.start,e,this.end)?i++:t++}}return!(t<i)}getArcPointNum(e){let t=Math.round(Math.PI/Math.asin(this.thickness/2/(e+this.thickness/2))/2);return t>100?100:t}getArcPoints(e){let t;if("circle"==e.type){let r=new i.Path,n=this.start.clone().sub(e.center).angle(),o=this.end.clone().sub(e.center).angle();r.arc(e.center.x,e.center.y,e.radius,n,o,e.clockWise),t=r.getPoints(this.getArcPointNum(e.radius))}return"bezier"===e.type&&(t=new i.QuadraticBezierCurve3(e.start,e.controlP,e.end).getPoints(e.pointNum)),t}getRelativePosition(e){switch(e.line){case 0:this.middleLinePosition(e);break;case 1:this.innerLinePosition(e);break;case 2:this.outerLinePosition(e)}}innerLinePosition(e){}middleLinePosition(e){let t,o,a,s,l,h,c=new i.Vector2,d=new i.Vector2;if(1==this.walls.length){let t=this.walls[0];l=t,h=t,a=this.sameVertex(e.start,t),s=this.sameVertex(e.end,t)}else{let t=this.sameVertex(e.start,this.computeWallS),i=this.sameVertex(e.start,this.computeWallE),r=this.sameVertex(e.end,this.computeWallS),n=this.sameVertex(e.end,this.computeWallE);t||0===t?(a=t,l=this.computeWallS):i||0===i?(a=i,l=this.computeWallE):a=!1,r||0===r?(s=r,h=this.computeWallS):n||0===n?(s=n,h=this.computeWallE):s=!1}function u(e){let t,i,o=new n.Point(e.arcCenter.x,e.arcCenter.y),a=(0,r.CommonFunc).getClockWise(e.start,e.cp,e.end);a?(t=e.start.distanceTo(e.arcCenter)+e.thickness/2,i=e.start.distanceTo(e.arcCenter)-e.thickness/2):(t=e.start.distanceTo(e.arcCenter)-e.thickness/2,i=e.start.distanceTo(e.arcCenter)+e.thickness/2);let s=e.start.clone().sub(o).angle(),l=e.end.clone().sub(o).angle();return[new n.Arc(o,t,s,l,!a),new n.Arc(o,i,s,l,!a),t,i,s,l,a]}if(this.isArc){let t=u(this),i=t[0],r=t[1];if(t[2],t[3],t[4],t[5],t[6],e.isArc){let t=u(e),n=t[0],o=t[1];t[2],t[3],t[4],t[5],t[6];let a=i.intersect(n),s=i.intersect(o),l=r.intersect(n),h=r.intersect(o);a.length&&(this.iiInter=a,e.iiInter=a),s.length&&(this.ioInter=s,e.oiInter=s),l.length&&(this.oiInter=l,e.ioInter=l),h.length&&(this.ooInter=h,e.ooInter=h)}else{let t=i.intersect(e.computeWallS.innerLine),n=i.intersect(e.computeWallS.outerLine),o=r.intersect(e.computeWallS.innerLine),a=r.intersect(e.computeWallS.outerLine);t.length&&(this.iiInter=t,e.iiInter=t),n.length&&(this.ioInter=n,e.ioInter=n),o.length&&(this.oiInter=o,e.oiInter=o),a.length&&(this.ooInter=a,e.ooInter=a)}}else if(e.isArc){let t=u(e),i=t[0],r=t[1];t[2],t[3],t[4],t[5],t[6];let n=l.innerLine.intersect(i),o=l.innerLine.intersect(r),a=l.outerLine.intersect(i),s=l.outerLine.intersect(r);n.length&&(this.iiInter=n,e.iiInter=n),o.length&&(this.ioInter=o,e.oiInter=o),a.length&&(this.oiInter=a,e.ioInter=a),s.length&&(this.ooInter=s,e.ooInter=s)}(a||0===a)&&(d.subVectors(e.computeWallS.end,e.computeWallS.start),1==a&&(c.subVectors(l.end,l.start),o=2*Math.PI-(t=this.getIncludeAngle(c,d)),t<this.clockWiseST&&(this.clockWiseST=t,this.clockWiseSTW=e,this.clockWiseSTT="SS",e.clockWiseSF=t),o<this.clockWiseSF&&(this.clockWiseSF=o,this.clockWiseSFW=e,this.clockWiseSFT="SS",e.clockWiseST=o)),-2==a&&(c.subVectors(l.start,l.end),o=2*Math.PI-(t=this.getIncludeAngle(c,d)),t<this.clockWiseET&&(this.clockWiseET=t,this.clockWiseETW=e,this.clockWiseETT="ES",e.clockWiseSF=t),o<this.clockWiseEF&&(this.clockWiseEF=o,this.clockWiseEFW=e,this.clockWiseEFT="ES",e.clockWiseST=o))),(s||0===s)&&(d.subVectors(e.computeWallE.start,e.computeWallE.end),1==s&&(c.subVectors(h.end,h.start),o=2*Math.PI-(t=this.getIncludeAngle(c,d)),t<this.clockWiseST&&(this.clockWiseST=t,this.clockWiseSTW=e,this.clockWiseSTT="SE",e.clockWiseEF=t),o<this.clockWiseSF&&(this.clockWiseSF=o,this.clockWiseSFW=e,this.clockWiseSFT="SE",e.clockWiseET=o)),-2==s&&(c.subVectors(h.start,h.end),o=2*Math.PI-(t=this.getIncludeAngle(c,d)),t<this.clockWiseET&&(this.clockWiseET=t,this.clockWiseETW=e,this.clockWiseETT="EE",e.clockWiseEF=t),o<this.clockWiseEF&&(this.clockWiseEF=o,this.clockWiseEFW=e,this.clockWiseEFT="EE",e.clockWiseET=o)))}middleLinePositionOld(e){let t,r,n=new i.Vector2,o=new i.Vector2;for(let i in this.vertices){let i=this.sameVertex(e.start),a=this.sameVertex(e.end);console.log("startRes - endRes - ",i,a),i||0==i?(o.subVectors(e.end,e.start),1==i&&(n.subVectors(this.end,this.start),r=2*Math.PI-(t=this.getIncludeAngle(n,o)),t<this.clockWiseST&&(this.clockWiseST=t,this.clockWiseSTW=e,this.clockWiseSTT="SS",e.clockWiseSF=t,e.clockWiseSFW=this,e.clockWiseSFT="SS"),r<this.clockWiseSF&&(this.clockWiseSF=r,this.clockWiseSFW=e,this.clockWiseSFT="SS",e.clockWiseST=r,e.clockWiseSTW=this,e.clockWiseSTT="SS")),-2==i&&(n.subVectors(this.start,this.end),r=2*Math.PI-(t=this.getIncludeAngle(n,o)),t<this.clockWiseET&&(this.clockWiseET=t,this.clockWiseETW=e,this.clockWiseETT="ES",e.clockWiseSF=t,e.clockWiseSFW=this,e.clockWiseSFT="SE"),r<this.clockWiseEF&&(this.clockWiseEF=r,this.clockWiseEFW=e,this.clockWiseEFT="ES",e.clockWiseST=r,e.clockWiseSTW=this,e.clockWiseSTT="SE"))):(a||0==a)&&(o.subVectors(e.start,e.end),1==a&&(n.subVectors(this.end,this.start),r=2*Math.PI-(t=this.getIncludeAngle(n,o)),t<this.clockWiseST&&(this.clockWiseST=t,this.clockWiseSTW=e,this.clockWiseSTT="SE",e.clockWiseEF=t,e.clockWiseEFW=this,e.clockWiseEFT="ES"),r<this.clockWiseSF&&(this.clockWiseSF=r,this.clockWiseSFW=e,this.clockWiseSFT="SE",e.clockWiseET=r,e.clockWiseETW=this,e.clockWiseETT="ES")),-2==a&&(n.subVectors(this.start,this.end),r=2*Math.PI-(t=this.getIncludeAngle(n,o)),t<this.clockWiseET&&(this.clockWiseET=t,this.clockWiseETW=e,this.clockWiseETT="EE",e.clockWiseEF=t,e.clockWiseEFW=this,e.clockWiseEFT="EE"),r<this.clockWiseEF&&(this.clockWiseEF=r,this.clockWiseEFW=e,this.clockWiseEFT="EE",e.clockWiseET=r,e.clockWiseETW=this,e.clockWiseETT="EE")))}}outerLinePosition(e){}sameVertex(e,t){for(let i in t.vertices)if(e.equals(t.vertices[i])||.01>e.distanceTo(t.vertices[i]))return i<3?i:i-t.vertices.length;return!1}getIncludeAngle(e,t){let i=Math.atan2(e.y,e.x)-Math.atan2(t.y,t.x);return i<0&&(i=2*Math.PI+i),i}updateByHandle(){if(this.clockWiseSTW){let e=new n.Point(this.start.x,this.start.y),t=this.computeWallS.outerLine,i=this.computeWallS.getVertex(5);if("SS"==this.clockWiseSTT){let r=this.clockWiseSTW.computeWallS.innerLine,n;if(t.parallelTo(r))n=e.projectionOn(t),this.computeWallS.updateVertex(2,n),n=e.projectionOn(r),this.clockWiseSTW.computeWallS.updateVertex(0,n);else{if(n=t.intersect(r)[0],this.isArc||this.clockWiseSTW.isArc){let e=this.computeWallS.getPoint(1).distanceTo(n)[0];(this.oiInter?this.computeWallS.getPoint(1).distanceTo(this.oiInter[0])[0]:1/0)<e&&(n=this.oiInter[0])}this.checkVertex(n,i,this.computeWallS.getVertex(2))&&this.computeWallS.updateVertex(5,n),this.computeWallS.updateVertex(2,n);let e=this.clockWiseSTW.computeWallS.getVertex(3);this.checkVertex(n,e,this.clockWiseSTW.computeWallS.getVertex(0))&&this.clockWiseSTW.computeWallS.updateVertex(3,n),this.clockWiseSTW.computeWallS.updateVertex(0,n)}}if("SE"==this.clockWiseSTT){let r=this.clockWiseSTW.computeWallE.outerLine,n;if(t.parallelTo(r))n=e.projectionOn(t),this.computeWallS.updateVertex(2,n),n=e.projectionOn(r),this.clockWiseSTW.computeWallE.updateVertex(5,n);else{if(n=t.intersect(r)[0],this.isArc||this.clockWiseSTW.isArc){let e=this.computeWallS.getPoint(1).distanceTo(n)[0];(this.ooInter?this.computeWallS.getPoint(1).distanceTo(this.ooInter[0])[0]:1/0)<e&&(n=this.ooInter[0])}this.checkVertex(n,i,this.computeWallS.getVertex(2))&&this.computeWallS.updateVertex(5,n),this.computeWallS.updateVertex(2,n);let e=this.clockWiseSTW.computeWallE.getVertex(2);this.checkVertex(n,e,this.clockWiseSTW.computeWallE.getVertex(5))&&this.clockWiseSTW.computeWallE.updateVertex(2,n),this.clockWiseSTW.computeWallE.updateVertex(5,n)}}}if(this.clockWiseSFW){let e=new n.Point(this.start.x,this.start.y),t=this.computeWallS.innerLine,i=this.computeWallS.getVertex(3);if("SS"==this.clockWiseSFT){let r=this.clockWiseSFW.computeWallS.outerLine,n;if(t.parallelTo(r))n=e.projectionOn(t),this.computeWallS.updateVertex(0,n),n=e.projectionOn(r),this.clockWiseSFW.computeWallS.updateVertex(2,n);else{if(n=t.intersect(r)[0],this.isArc||this.clockWiseSFW.isArc){let e=this.computeWallS.getPoint(1).distanceTo(n)[0];(this.ioInter?this.computeWallS.getPoint(1).distanceTo(this.ioInter[0])[0]:1/0)<e&&(n=this.ioInter[0])}this.checkVertex(n,i,this.computeWallS.getVertex(0))&&this.computeWallS.updateVertex(3,n),this.computeWallS.updateVertex(0,n);let e=this.clockWiseSFW.computeWallS.getVertex(5);this.checkVertex(n,e,this.clockWiseSFW.computeWallS.getVertex(2))&&this.clockWiseSFW.computeWallS.updateVertex(5,n),this.clockWiseSFW.computeWallS.updateVertex(2,n)}}if("SE"==this.clockWiseSFT){let r=this.clockWiseSFW.computeWallE.innerLine,n;if(t.parallelTo(r))n=e.projectionOn(t),this.computeWallS.updateVertex(0,n),n=e.projectionOn(r),this.clockWiseSFW.computeWallE.updateVertex(3,n);else{if(n=t.intersect(r)[0],this.isArc||this.clockWiseSF.isArc){let e=this.computeWallS.getPoint(1).distanceTo(n)[0];(this.iiInter?this.computeWallS.getPoint(1).distanceTo(this.iiInter[0])[0]:1/0)<e&&(n=this.iiInter[0])}this.checkVertex(n,i,this.computeWallS.getVertex(0))&&this.computeWallS.updateVertex(3,n),this.computeWallS.updateVertex(0,n);let e=this.clockWiseSFW.computeWallS.getVertex(0);this.checkVertex(n,e,this.clockWiseSFW.computeWallE.getVertex(3))&&this.clockWiseSFW.computeWallE.updateVertex(0,n),this.clockWiseSFW.computeWallE.updateVertex(3,n)}}}if(this.clockWiseETW){let e=new n.Point(this.end.x,this.end.y),t=this.computeWallE.innerLine,i=this.computeWallE.getVertex(0);if("ES"==this.clockWiseETT){let r=this.clockWiseETW.computeWallS.innerLine,n;if(t.parallelTo(r))n=e.projectionOn(t),this.computeWallE.updateVertex(3,n),n=e.projectionOn(r),this.clockWiseETW.computeWallS.updateVertex(0,n);else{if(n=t.intersect(r)[0],this.isArc||this.clockWiseETW.isArc){let e=this.computeWallE.getPoint(4).distanceTo(n)[0];(this.iiInter?this.computeWallE.getPoint(4).distanceTo(this.iiInter[0])[0]:1/0)<e&&(n=this.iiInter[0])}this.checkVertex(n,i,this.computeWallE.getVertex(3))&&this.computeWallE.updateVertex(0,n),this.computeWallE.updateVertex(3,n);let e=this.clockWiseETW.computeWallS.getVertex(3);this.checkVertex(n,e,this.clockWiseETW.computeWallS.getVertex(0))&&this.clockWiseETW.computeWallS.updateVertex(3,n),this.clockWiseETW.computeWallS.updateVertex(0,n)}}if("EE"==this.clockWiseETT){let r=this.clockWiseETW.computeWallE.outerLine,n;if(t.parallelTo(r))n=e.projectionOn(t),this.computeWallE.updateVertex(3,n),n=e.projectionOn(r),this.clockWiseETW.computeWallE.updateVertex(5,n);else{if(n=t.intersect(r)[0],this.isArc||this.clockWiseETW.isArc){let e=this.computeWallE.getPoint(4).distanceTo(n)[0];(this.ioInter?this.computeWallE.getPoint(4).distanceTo(this.ioInter[0])[0]:1/0)<e&&(n=this.ioInter[0])}this.checkVertex(n,i,this.computeWallE.getVertex(3))&&this.computeWallE.updateVertex(0,n),this.computeWallE.updateVertex(3,n);let e=this.clockWiseETW.computeWallE.getVertex(2);this.checkVertex(n,e,this.clockWiseETW.computeWallE.getVertex(5))&&this.clockWiseETW.computeWallE.updateVertex(2,n),this.clockWiseETW.computeWallE.updateVertex(5,n)}}}if(this.clockWiseEFW){let e=new n.Point(this.end.x,this.end.y),t=this.computeWallE.outerLine,i=this.computeWallE.getVertex(2);if("ES"==this.clockWiseEFT){let r=this.clockWiseEFW.computeWallS.outerLine,n;if(t.parallelTo(r))n=e.projectionOn(t),this.computeWallE.updateVertex(5,n),n=e.projectionOn(r),this.clockWiseEFW.computeWallS.updateVertex(2,n);else{if(n=t.intersect(r)[0],this.isArc||this.clockWiseEFW.computeWallS.isArc){let e=this.computeWallE.getPoint(4).distanceTo(n)[0];(this.ooInter?this.computeWallE.getPoint(4).distanceTo(this.ooInter[0])[0]:1/0)<e&&(n=this.ooInter[0])}this.checkVertex(n,i,this.computeWallE.getVertex(5))&&this.computeWallE.updateVertex(2,n),this.computeWallE.updateVertex(5,n);let e=this.clockWiseEFW.computeWallS.getVertex(5);this.checkVertex(n,e,this.clockWiseEFW.computeWallS.getVertex(2))&&this.clockWiseEFW.computeWallS.updateVertex(5,n),this.clockWiseEFW.computeWallS.updateVertex(2,n)}}if("EE"==this.clockWiseEFT){let r=this.clockWiseEFW.computeWallE.innerLine,n;if(t.parallelTo(r))n=e.projectionOn(t),this.computeWallE.updateVertex(5,n),n=e.projectionOn(r),this.clockWiseEFW.computeWallE.updateVertex(3,n);else{if(n=t.intersect(r)[0],this.isArc||this.clockWiseEFW.computeWallS.isArc){let e=this.computeWallE.getPoint(4).distanceTo(n)[0];(this.oiInter?this.computeWallE.getPoint(4).distanceTo(this.oiInter[0])[0]:1/0)<e&&(n=this.oiInter[0])}this.checkVertex(n,i,this.computeWallE.getVertex(5))&&this.computeWallE.updateVertex(2,n),this.computeWallE.updateVertex(5,n);let e=this.clockWiseEFW.computeWallE.getVertex(0);this.checkVertex(n,e,this.clockWiseEFW.computeWallE.getVertex(3))&&this.clockWiseEFW.computeWallE.updateVertex(0,n),this.clockWiseEFW.computeWallE.updateVertex(3,n)}}}}checkVertex(e,t,i){if(e.x==t.x&&e.y==t.y||i.x==t.x&&i.y==t.y)return!1;let r=new n.Vector(e.x-t.x,e.y-t.y),o=new n.Vector(i.x-t.x,i.y-t.y),a=r.angleTo(o);return a>=2*Math.PI&&(a-=2*Math.PI),!(a<Math.PI/2)}getFinalVertices(){if(this.vertices=[],1==this.walls.length)this.vertices.push(...this.walls[0].vertices);else{let e=this.walls.length,t=Array.from(this.walls),i=t.splice(parseInt(e/2));t.push(i[0]),i.reverse();for(let e=1;e<t.length;e++){let i=t[e-1],r=t[e],o=i.vertices[0],a=i.vertices[3],s=i.vertices[2],l=i.vertices[5];if(o.equals(a)){let e=r.vertices[0],t=r.vertices[3],a=e.clone().sub(t),s=o.clone().sub(t),l=new n.Vector(a.x,a.y),h=new n.Vector(s.x,s.y).angleTo(l);r.updateVertex(0,i.points[0]),h>=Math.PI/2&&h<=3*Math.PI/2&&r.updateVertex(3,i.points[0])}else{let e=r.innerLine.intersect(i.innerLine)[0];r.updateVertex(0,e),i.updateVertex(3,e)}if(s.equals(l)){let e=r.vertices[2],t=r.vertices[5],o=e.clone().sub(t),a=s.clone().sub(t),l=new n.Vector(o.x,o.y),h=new n.Vector(a.x,a.y).angleTo(l);r.updateVertex(2,i.points[2]),h>=Math.PI/2&&h<=3*Math.PI/2&&r.updateVertex(5,i.points[2])}else{let e=r.outerLine.intersect(i.outerLine)[0];r.updateVertex(2,e),i.updateVertex(5,e)}}for(let e=1;e<i.length;e++){let t=i[e-1],r=i[e],o=t.vertices[0],a=t.vertices[3],s=t.vertices[2],l=t.vertices[5];if(o.equals(a)){let e=r.vertices[0],i=r.vertices[3].sub(e),a=o.sub(e),s=new n.Vector(i.x,i.y),l=new n.Vector(a.x,a.y).angleTo(s);r.updateVertex(3,t.points[0]),l>=Math.PI/2&&l<=3*Math.PI/2&&r.updateVertex(0,t.points[0])}else{let e=r.innerLine.intersect(t.innerLine)[0];r.updateVertex(3,e),t.updateVertex(0,e)}if(s.equals(l)){let e=r.vertices[2],i=r.vertices[5].sub(e),o=s.sub(e),a=new n.Vector(i.x,i.y),l=new n.Vector(o.x,o.y).angleTo(a);r.updateVertex(5,t.points[2]),l>=Math.PI/2&&l<=3*Math.PI/2&&r.updateVertex(2,t.points[2])}else{let e=r.outerLine.intersect(t.outerLine)[0];r.updateVertex(5,e),t.updateVertex(2,e)}}for(let e in this.walls)0==e?this.vertices.push(...this.walls[e].vertices):this.vertices.push(this.walls[e].vertices[3],this.walls[e].vertices[4],this.walls[e].vertices[5])}}updateVertex(e,t){this.vertices[e]=t}circleCircle(){}circleLine(){}lineLine(){}}class l{static wallList2D=[];static wallList3D=[];static create2DWall(e){let t=[];for(let i=0;i<e.length;i++)if(e[i].isArc)t.push(e[i]);else{let t=this.create2D(e[i]);this.recordInfo(t,e[i]),t.computeLineEquation(),this.handleIntersection(t),this.wallList2D.push(t)}let n=[];this.wallList2D.forEach(e=>{n.push(e.startPoint,e.endPoint)});let o=[];for(;t.length>0;){let e=this.getLinkArcJson(n,t);e||(e=t.splice(0,1)[0],n.push(new i.Vector2(e.start.x,e.start.y),new i.Vector2(e.end.x,e.end.y)));let a=new i.Vector2(e.start.x,e.start.y),s=new i.Vector2(e.end.x,e.end.y),l,h,c=!0,d;if(e.cp)d=new i.Vector2(e.cp.x,e.cp.y),h=(l=(0,r.CommonFunc).getCircleCenter(d,a,s)).distanceTo(a),c=(0,r.CommonFunc).getClockWise(a,d,s);else{l=a.clone().add(s).divideScalar(2),h=a.distanceTo(l),c=this.getArcClockwise(a,s);let e=a.clone().sub(l);d=c?new i.Vector2(l.x+e.y,l.y-e.x):new i.Vector2(l.x-e.y,l.y+e.x)}let u=a.clone().sub(l).angle(),p=s.clone().sub(l).angle();e.thickness,e.thickness;let m=Math.round(Math.PI/Math.asin(e.thickness/2/(h+e.thickness/2))/2);m=m>100?100:m;let f=this.getArcPoints({type:e.isArc,center:l,radius:h,beginAngle:u,endAngle:p,clockWise:c,pointNum:m,start:a,end:s,controlP:d}),g=[],y=Object.assign({},e);y.start={x:e.start.x,y:e.start.y,z:0},y.end={x:e.end.x,y:e.end.y,z:0},y.isArc=!1;for(let t=0;t<f.length-1;t++){let n=new i.Vector2((0,r.CommonFunc).keepDecimalRound(f[t].x,2),(0,r.CommonFunc).keepDecimalRound(f[t].y,2)),o=new i.Vector2((0,r.CommonFunc).keepDecimalRound(f[t+1].x,2),(0,r.CommonFunc).keepDecimalRound(f[t+1].y,2));y.start.x=n.x,y.start.y=n.y,y.end.x=o.x,y.end.y=o.y;let a=this.create2D(y);a.isArc=!1,a.arcCenter=l,a.cp=d,a.computeLineEquation(),this.recordInfo(a,e),this.handleIntersection(a),this.wallList2D.push(a),g.push(a)}g.push(a,s),o.push(g)}return this.unionArcWall(o),this.resetWallList2D(this.wallList2D)}static create2DWallNew(e){let t=[],r=[],n=[],o=[];function a(e,t){for(let i=0;i<2;i++)for(let r=0;r<e-1;r++){let e=3*r+i,n=3*r+i+1,o=3*r+i+3,a=3*r+i+4;t.push(e,n,a),t.push(o,e,a)}}return e.forEach(e=>{e.isArc?n.push(e):o.push(e)}),o.map(e=>{let t=new s(e);this.recordInfo(t,e),r.push(t)}),n.map(e=>{let t=new s(e,r);this.recordInfo(t,e),r.push(t)}),r.forEach((e,n)=>{r.forEach((t,i)=>{i>n&&e.getRelativePosition(t)}),e.updateByHandle(),e.getFinalVertices();let o=[],s=[];for(let t of(a(e.vertices.length/3,s),e.vertices))o.push(...t.toArray(),0);let l=new i.BufferGeometry;l.setAttribute("position",new i.Float32BufferAttribute(o,3)),l.setIndex(s),l.translate(0,0,2);let h=new i.Mesh(l,new i.MeshBasicMaterial({color:3552822,side:i.DoubleSide,transparent:!0,opacity:.8}));h.startPoint=e.start,h.endPoint=e.end,h.useType="wall",e.arcCenter&&(h.arcCenter=e.arcCenter),e.cp&&(h.cp=e.cp),h.parameter={points:e.vertices},this.recordInfo(h,e),t.push(h)}),t}static resetWallList2D(){let e=Array.from(this.wallList2D);return this.wallList2D=[],e}static getLinkArcJson(e,t){let r;for(let n=0;n<t.length;n++)if(this.whetherCrossWall(t[n],e)){r=t.splice(n,1)[0],e.push(new i.Vector2(r.start.x,r.start.y),new i.Vector2(r.end.x,r.end.y));break}return r}static getArcClockwise(e,t){let i=this.findCrossWall(e,t);i=[...i[0],...i[1]];let n=0,o=0;for(let a=0;a<i.length;a++){let s=i[a],l=s.startPoint.clone().add(s.endPoint).divideScalar(2);(0,r.CommonFunc).getClockWise(e,l,t)?o++:n++}return!(n<o)}static getArcPoints(e){let t;if("circle"==e.type){let r=new i.Path;r.arc(e.center.x,e.center.y,e.radius,e.beginAngle,e.endAngle,e.clockWise),t=r.getPoints(e.pointNum)}return"bezier"===e.type&&(t=new i.QuadraticBezierCurve3(e.start,e.controlP,e.end).getPoints(e.pointNum)),t}static unionArcWall(e){for(let t=0;t<e.length;t++){let i=e[t].pop(),r=e[t].pop(),n=[],o=[];for(let i=0;i<e[t].length;i++){let r=Array.from(e[t][i].geometry.attributes.position.array);for(let e=0;e<9;e++)n.push(r[e]);if(i==e[t].length-1)for(let e=9;e<18;e++)n.push(r[e]);o.push(3*i,3*i+3,3*i+4,3*i+1,3*i,3*i+4,3*i+1,3*i+4,3*i+5,3*i+2,3*i+1,3*i+5)}let a=this.createMesh(n,o,e[t][0].material);this.recordInfo(a,e[t][0]),a.wallID=e[t][0].wallID,a.arcCenter=e[t][0].arcCenter,a.cp=e[t][0].cp,a.startPoint=r,a.endPoint=i,this.wallList2D.splice(this.wallList2D.indexOf(e[t][0]),e[t].length),this.wallList2D.push(a)}}static create2D(e){let t=new i.Vector2(e.start.x,e.start.y),r=new i.Vector2(e.end.x,e.end.y);var n=new(0,i.Vector2)().subVectors(t,r);switch(n=new(0,i.Vector2)(-n.y,n.x).normalize().setLength(e.thickness/2),e.line){case 0:var o=t.clone().add(n.clone().negate()),a=t.clone(),s=t.clone().add(n.clone()),l=r.clone().add(n.clone().negate()),h=r.clone(),c=r.clone().add(n.clone());break;case 1:var n=n.clone().negate(),s=t.clone(),a=s.clone().add(n.clone()),o=a.clone().add(n.clone()),c=r.clone(),h=c.clone().add(n.clone()),l=h.clone().add(n.clone());break;case 2:var o=t.clone(),a=o.clone().add(n.clone()),s=a.clone().add(n.clone()),l=r.clone(),h=l.clone().add(n.clone()),c=h.clone().add(n.clone())}let d=[];[o,a,s,l,h,c].forEach(e=>{d.push(e.x,e.y,0)});let u=[0,3,4,1,0,4,1,4,5,2,1,5],p=new i.MeshBasicMaterial({color:3552822,side:i.DoubleSide,transparent:!0,opacity:.8}),m=this.createMesh(d,u,p);return m.position.z=1,m.startPoint=t,m.endPoint=r,m}static createMesh(e,t,r){let n=new i.BufferGeometry;n.attributes.position=new i.BufferAttribute(new Float32Array(e),3),n.index=new i.BufferAttribute(new Uint16Array(t),1);let a=new o(n,r);return a.computeVertices(),a.renderOrder=2,a}static recordInfo(e,t){e.line=t.line,e.style=t.style,e.thickness=t.thickness,e.height=t.height,e.wallID=t.id,e.name=t.id,e.offsetXY=t.offsetXY,e.isArc=t.isArc}static handleIntersection(e){let t=e.startPoint.clone(),i=e.endPoint.clone(),[n,o]=this.findCrossWall(t,i);if(n.length>0){let o=[];if(n.length>1&&this.getIntersectAngle(n,t,o),o.length>1){let a=i.clone().sub(t).angle();for(let i=0;i<n.length;i++){let s,l=0,h,c=2,d,u=e.parameter.innerLineEquation,p,m=e.parameter.outerLineEquation,f,g=n[i],[y,x]=[g.startPoint,g.endPoint];y.equals(t)?(s=x.clone().sub(t).angle(),p=g.parameter.outerLineEquation,f=g.parameter.innerLineEquation,h=2,d=0):x.equals(t)&&(s=y.clone().sub(t).angle(),p=g.parameter.innerLineEquation,f=g.parameter.outerLineEquation,h=3,d=5);let[w,b]=this.checkBetweenAngle(o,a,s);if(a<s){if(w){if(!b){let i=(0,r.CommonFunc).getIntersectPoint(m,f,t);this.checkIntersect(i)&&(e.updateVertex(c,i),g.updateVertex(d,i))}}else{let i=(0,r.CommonFunc).getIntersectPoint(u,p,t);this.checkIntersect(i)&&(e.updateVertex(l,i),g.updateVertex(h,i))}}else if(w){if(!b){let i=(0,r.CommonFunc).getIntersectPoint(u,p,t);this.checkIntersect(i)&&(e.updateVertex(l,i),g.updateVertex(h,i))}}else{let i=(0,r.CommonFunc).getIntersectPoint(m,f,t);this.checkIntersect(i)&&(e.updateVertex(c,i),g.updateVertex(d,i))}}}else{let i=n[0],[o,a]=[i.startPoint,i.endPoint],s,l;if(e.isArc){if(i.isArc)e.updateVertex(0,i.parameter.points[3]),e.updateVertex(2,i.parameter.points[5]);else{let n,s;o.equals(t)?(n=(0,r.CommonFunc).getIntersectPoint(e.parameter.innerLineEquation,i.parameter.outerLineEquation),s=(0,r.CommonFunc).getIntersectPoint(e.parameter.outerLineEquation,i.parameter.innerLineEquation),this.checkIntersect(n)&&i.updateVertex(2,n),this.checkIntersect(s)&&i.updateVertex(0,s)):a.equals(t)&&(n=(0,r.CommonFunc).getIntersectPoint(e.parameter.innerLineEquation,i.parameter.innerLineEquation),s=(0,r.CommonFunc).getIntersectPoint(e.parameter.outerLineEquation,i.parameter.outerLineEquation),this.checkIntersect(n)&&i.updateVertex(3,n),this.checkIntersect(s)&&i.updateVertex(5,s)),this.checkAndUpdate(e,3,0,n),this.checkAndUpdate(e,5,2,s)}}else o.equals(t)?(s=(0,r.CommonFunc).getIntersectPoint(e.parameter.innerLineEquation,i.parameter.outerLineEquation),l=(0,r.CommonFunc).getIntersectPoint(e.parameter.outerLineEquation,i.parameter.innerLineEquation),this.checkIntersect(s)&&i.updateVertex(2,s),this.checkIntersect(l)&&i.updateVertex(0,l)):a.equals(t)&&(s=(0,r.CommonFunc).getIntersectPoint(e.parameter.innerLineEquation,i.parameter.innerLineEquation),l=(0,r.CommonFunc).getIntersectPoint(e.parameter.outerLineEquation,i.parameter.outerLineEquation),this.checkIntersect(s)&&i.updateVertex(3,s),this.checkIntersect(l)&&i.updateVertex(5,l)),this.checkIntersect(s)&&e.updateVertex(0,s),this.checkIntersect(l)&&e.updateVertex(2,l)}}if(o.length>0){let n=[];if(o.length>1&&this.getIntersectAngle(o,i,n),n.length>1){let a=t.clone().sub(i).angle();for(let t=0;t<o.length;t++){let s,l=5,h,c=3,d,u=e.parameter.outerLineEquation,p,m=e.parameter.innerLineEquation,f,g=o[t],[y,x]=[g.startPoint,g.endPoint];y.equals(i)?(s=x.clone().sub(i).angle(),p=g.parameter.outerLineEquation,f=g.parameter.innerLineEquation,h=2,d=0):x.equals(i)&&(s=y.clone().sub(i).angle(),p=g.parameter.innerLineEquation,f=g.parameter.outerLineEquation,h=3,d=5);let[w,b]=this.checkBetweenAngle(n,a,s);if(a<s){if(w){if(!b){let t=(0,r.CommonFunc).getIntersectPoint(m,f,i);this.checkIntersect(t)&&(e.updateVertex(c,t),g.updateVertex(d,t))}}else{let t=(0,r.CommonFunc).getIntersectPoint(u,p,i);this.checkIntersect(t)&&(e.updateVertex(l,t),g.updateVertex(h,t))}}else if(w){if(!b){let t=(0,r.CommonFunc).getIntersectPoint(u,p,i);this.checkIntersect(t)&&(e.updateVertex(l,t),g.updateVertex(h,t))}}else{let t=(0,r.CommonFunc).getIntersectPoint(m,f,i);this.checkIntersect(t)&&(e.updateVertex(c,t),g.updateVertex(d,t))}}}else{let t=o[0],[n,a]=[t.startPoint,t.endPoint],s,l;if(e.isArc){if(t.isArc)console.log("arc with arc");else{let o,s;n.equals(i)?(o=(0,r.CommonFunc).getIntersectPoint(e.parameter.innerLineEquation,t.parameter.innerLineEquation),s=(0,r.CommonFunc).getIntersectPoint(e.parameter.outerLineEquation,t.parameter.outerLineEquation),this.checkIntersect(o)&&t.updateVertex(0,o),this.checkIntersect(s)&&t.updateVertex(2,s)):a.equals(i)&&(o=(0,r.CommonFunc).getIntersectPoint(e.parameter.innerLineEquation,t.parameter.outerLineEquation),s=(0,r.CommonFunc).getIntersectPoint(e.parameter.outerLineEquation,t.parameter.innerLineEquation),this.checkIntersect(o)&&t.updateVertex(5,o),this.checkIntersect(s)&&t.updateVertex(3,s)),this.checkAndUpdate(e,0,3,o),this.checkAndUpdate(e,2,5,s);return}}n.equals(i)?(s=(0,r.CommonFunc).getIntersectPoint(e.parameter.innerLineEquation,t.parameter.innerLineEquation),l=(0,r.CommonFunc).getIntersectPoint(e.parameter.outerLineEquation,t.parameter.outerLineEquation),this.checkIntersect(s)&&t.updateVertex(0,s),this.checkIntersect(l)&&t.updateVertex(2,l)):a.equals(i)&&(s=(0,r.CommonFunc).getIntersectPoint(e.parameter.innerLineEquation,t.parameter.outerLineEquation),l=(0,r.CommonFunc).getIntersectPoint(e.parameter.outerLineEquation,t.parameter.innerLineEquation),this.checkIntersect(s)&&t.updateVertex(5,s),this.checkIntersect(l)&&t.updateVertex(3,l)),this.checkIntersect(s)&&e.updateVertex(3,s),this.checkIntersect(l)&&e.updateVertex(5,l)}}}static getIntersectAngle(e,t,i=[]){for(let r=0;r<e.length;r++){let n=e[r].startPoint,o=e[r].endPoint,a=n.equals(t)?o.clone().sub(t):n.clone().sub(t);i.push(a.angle())}return i}static checkBetweenAngle(e,t,i){let r=Math.min(t,i),n=Math.max(t,i),o=!1,a=!1;for(let t=0;t<e.length;t++)e[t]>r&&e[t]<n&&(o=!0),(e[t]<r||e[t]>n)&&(a=!0);return[o,a]}static checkIntersect(e){return!1!=e&&"whole"!=e}static checkAndUpdate(e,t,i,r){if(!1==r||"whole"==r)return;let n=e.parameter.points[t],o=e.parameter.points[i];e.updateVertex(i,r),n.y==o.y?n.x>o.x?r.x>n.x&&e.updateVertex(t,r):r.x<n.x&&e.updateVertex(t,r):n.y>o.y?r.y>n.y&&e.updateVertex(t,r):r.y<n.y&&e.updateVertex(t,r)}static findCrossWall(e,t,i=this.wallList2D){let r=[],n=[];for(let o=0;o<i.length;o++)this.whetherCross(e,i[o])&&r.push(i[o]),this.whetherCross(t,i[o])&&n.push(i[o]);return[r,n]}static whetherCross(e,t){let i=t.startPoint,r=t.endPoint;return e.equals(i)||e.equals(r)}static whetherCrossWall(e,t){let r=new i.Vector2(e.start.x,e.start.y),n=new i.Vector2(e.end.x,e.end.y);for(let e=0;e<t.length;e++)if(r.equals(t[e])||n.equals(t[e]))return!0}}class h extends i.BufferGeometry{constructor(e){let t,r;super(),this.type="Wall3DGeometry";let n=e.geometry.attributes.position,o=this,a=[],s=[],l=[],h=[],c=0,d=0,u=new i.Vector3(0,0,1);if("circle"==e.isArc){t=e.arcCenter?e.arcCenter.distanceTo(e.endPoint):e.startPoint.distanceTo(e.endPoint)/2;let i=e.startPoint.clone().sub(e.arcCenter),n=e.endPoint.clone().sub(e.arcCenter);r=this.getIncludeAngle(i,n)}function p(p){let m,f,g=[],y=n.count;if(0==p&&g.push(y-1,y-2,y-3),1==p&&g.push(0,1,2),2==p||3==p){let e=2==p?2:0;for(let t=0;t<y/3;t++)g.push(e+3*t);3==p&&g.reverse()}let x=0,w=0,b=o.getPoint(n,g[0]),v=o.getPoint(n,g[g.length-1]).clone().sub(b),M=new i.Vector3(v.y,-v.x,0),S=[];g.forEach(t=>{let i=(t=o.getPoint(n,t)).clone();i.z=e.height,S.push(t,i)});let P=new(0,i.Box3)().setFromPoints(S),T=P.max.clone().sub(P.min),_=T.angleTo(u),C=(m=e.isArc&&[2,3].includes(p)?t*r:T.length()*Math.sin(_))>(f=T.length()*Math.cos(_))?m:f,D=o.getPoint(n,g[g.length-1]);D.z=e.height;let A=1,E=1;for(let t=0;t<g.length;t++)for(let i=0;i<2;i++){let r=o.getPoint(n,g[t]).clone();0==i&&(r.z=e.height),s.push(...r.toArray()),l.push(...M.toArray());let a=D.clone().sub(r),c=a.angleTo(u),d=a.length()*Math.sin(c),p=a.length()*Math.cos(c),m=A+d/C,f=E+p/C;h.push(m,-f),D=r,A=m,E=f,x+=1}for(let e=0;e<g.length-1;e++)for(let t=0;t<1;t++){let i=c+t+2*e,r=c+t+2*(e+1),n=c+(t+1)+2*(e+1),o=c+(t+1)+2*e;a.push(o,r,i),a.push(o,n,r),w+=6}o.addGroup(d,w,p),d+=w,c+=x}function m(t,i,r){t=[];for(let e=0;e<n.count/3;e++)t.push([3*e,3*e+1,3*e+2]);if(5==i)for(let e=0;e<t.length;e++)t[e].reverse();let u=0,p=0;for(let i=0;i<t.length;i++)for(let a=0;a<t[i].length;a++){let c=o.getPoint(n,t[i][a]);s.push(c.x,c.y,"top"==r?e.height:0),l.push(0,0,"btm"==r?-1:1),h.push(a/(t[i].length-1),1-i),u+=1}for(let e=0;e<t.length-1;e++)for(let i=0;i<t[e].length-1;i++){let r=c+i+t[e].length*e,n=c+i+t[e].length*(e+1),o=c+(i+1)+t[e].length*(e+1),s=c+(i+1)+t[e].length*e;a.push(s,n,r),a.push(s,o,n),p+=6}o.addGroup(d,p,i),d+=p,c+=u}p(0),p(1),p(2),p(3),m([[0,1,2],[3,4,5]],4,"top"),m([[2,1,0],[5,4,3]],5,"btm"),this.setIndex(a),this.setAttribute("position",new i.Float32BufferAttribute(s,3)),this.setAttribute("normal",new i.Float32BufferAttribute(l,3)),this.setAttribute("uv",new i.Float32BufferAttribute(h,2))}getPoint(e,t){let r=e.getX(t),n=e.getY(t);if(2==e.itemSize)return new i.Vector2(r,n);if(3==e.itemSize){let o=e.getZ(t);return new i.Vector3(r,n,o)}}getIncludeAngle(e,t){let i=Math.atan2(e.y,e.x)-Math.atan2(t.y,t.x);return i<0&&(i=2*Math.PI+i),i}}}),parcelRequire.register("hrM0U",function(e,t){$parcel$export(e.exports,"CommonFunc",()=>d);var i=parcelRequire("4xklQ"),r=parcelRequire("ia4Lh"),n=parcelRequire("g4HAh"),o=parcelRequire("7WCxl"),a=parcelRequire("7BJhL"),s=parcelRequire("6Hryq"),l=parcelRequire("94t2y"),h=parcelRequire("ckwVR"),c=parcelRequire("jDRRp");class d{constructor(){this.getMiddlePoint=d.getMiddlePoint.bind(this),this.getLineEquation=d.getLineEquation.bind(this),this.getVerticalLineEquation=d.getVerticalLineEquation.bind(this),this.getVecByEquation=d.getVecByEquation.bind(this),this.getProjectVecByEquation=d.getProjectVecByEquation.bind(this),this.getIntersectPoint=d.getIntersectPoint.bind(this),this.getProjectPoint=d.getProjectPoint.bind(this),this.createThreeDimensionLabel=d.createThreeDimensionLabel.bind(this),this.getRandomNum=d.getRandomNum.bind(this),this.arrayTransformToVector=d.arrayTransformToVector.bind(this),this.vectorTransformToArray=d.vectorTransformToArray.bind(this),this.vectorTransformToObject=d.vectorTransformToObject.bind(this),this.filterArray=d.filterArray.bind(this),this.filterObjArray=d.filterObjArray.bind(this),this.removeItemFromArr=d.removeItemFromArr.bind(this),this.keepDecimalRound=d.keepDecimalRound.bind(this),this.isParallel2=d.isParallel2.bind(this),this.isSameDirection2=d.isSameDirection2.bind(this),this.includeUndefined=d.includeUndefined.bind(this),this.transToVector2=d.transToVector2.bind(this),this.transToVector3=d.transToVector3.bind(this),this.findNewItem=d.findNewItem.bind(this),this.isCollinear=d.isCollinear.bind(this),this.getClockWise=d.getClockWise.bind(this),this.getCircleCenter=d.getCircleCenter.bind(this),this.createPoint=d.createPoint.bind(this),this.createLine=d.createLine.bind(this),this.createShapeByPoints=d.createShapeByPoints.bind(this),this.createShape=d.createShape.bind(this)}static boolean(e,t,r="subtract"){"subtract"==r&&(r=a.SUBTRACTION),"union"==r&&(r=a.ADDITION),"intersect"==r&&(r=a.INTERSECTION),e.updateMatrixWorld(!0);let n=new s.Brush(e.geometry,e.material),o=new s.Brush(t.geometry,t.material);n.applyMatrix4(e.matrix),o.applyMatrix4(t.matrix),n.updateMatrixWorld(),o.updateMatrixWorld(),n.geometry.computeBoundsTree({maxLeafTris:5,strategy:parseFloat(h.CENTER)}),n.geometry.boundsTree.splitStrategy=h.CENTER,o.geometry.computeBoundsTree({maxLeafTris:5,strategy:parseFloat(h.CENTER)}),o.geometry.boundsTree.splitStrategy=h.CENTER;let c=new l.Evaluator;if(c.attributes=["position","normal"],c.debug.enabled=!0,c.useGroups=!0,r==a.ADDITION||r==a.INTERSECTION)return c.evaluate(n,o,r);if(r==a.SUBTRACTION){let t=new i.Mesh(new i.BufferGeometry,new i.MeshStandardMaterial({color:16711680,flatShading:!1,polygonOffset:!0,polygonOffsetUnits:.1,polygonOffsetFactor:.1}));return t.castShadow=!0,t.receiveShadow=!0,c.evaluate(n,o,r,t),t.geometry.computeBoundingBox(),t.geometry.center(),t.applyMatrix4(e.matrix),t}}static getMiddlePoint(e,t){if((!e.isVector2||t.isVector2)&&(!e.isVector3||t.isVector3)&&(!e.isVector4||t.isVector4))return e.clone().add(t).divideScalar(2)}static getLineEquation(e,t){let i,r;return Array.isArray(e)&&(e=this.arrayTransformToVector(e)),Array.isArray(t)&&(t=this.arrayTransformToVector(t)),e.x==t.x?(i="X",r=e.x):e.y==t.y?(i="Y",r=e.y):(i=(e.y-t.y)/(e.x-t.x),r=e.y-i*e.x),{slope:i,constant:r}}static getCircleEquation(e,t){return{a:e.x,b:e.y,r:t}}static getNormalVecOffset(e,t,r){var n=new(0,i.Vector2)().subVectors(t,e);n=new(0,i.Vector2)(-n.y,n.x).normalize().setLength(r);let o=e.clone().add(n),a=t.clone().add(n);return[o.x,o.y,a.x,a.y]}static getVerticalLineEquation(e,t=new i.Vector2){let r,n;return"X"==e.slope?(r="Y",n=t.y):"Y"==e.slope?(r="X",n=t.x):(r=-1/e.slope,n=t.y-r*t.x),{slope:r,constant:n}}static getVecByEquation(e,t=1){return"X"==e.slope?new i.Vector2(0,t):"Y"==e.slope?new i.Vector2(t,0):new(0,i.Vector2)(1,e.slope+e.constant).setLength(t)}static getProjectVecByEquation(e,t=1){let r=this.getVecByEquation(e);return new(0,i.Vector2)(-r.y,r.x).setLength(t)}static getIntersectPoint(e,t,r=!1){let n;if(e.slope==t.slope){if(e.constant!=t.constant){if(!(1>Math.abs(e.constant-t.constant)))return!1;{let t=this.getVerticalLineEquation(e,r);return this.getIntersectPoint(t,e)}}if(!r)return"whole";{let t=this.getVerticalLineEquation(e,r);return this.getIntersectPoint(t,e)}}if("X"==e.slope)n="Y"==t.slope?new i.Vector2(e.constant,t.constant):new i.Vector2(e.constant,t.slope*e.constant+t.constant);else if("Y"==e.slope)n="X"==t.slope?new i.Vector2(t.constant,e.constant):new i.Vector2((e.constant-t.constant)/t.slope,e.constant);else if("X"==t.slope)n=new i.Vector2(t.constant,e.slope*t.constant+e.constant);else if("Y"==t.slope)n=new i.Vector2((t.constant-e.constant)/e.slope,t.constant);else{let r=(t.constant-e.constant)/(e.slope-t.slope),o=e.slope*r+e.constant;t.slope,t.constant,n=new i.Vector2(r,o)}return n}static getIntersectPoint2(e,t){let r=Object.assign({},e);r.slope="Y"==e.slope?0:"X"==e.slope?1/0:e.slope;let n=-2*(r.slope*r.constant-r.slope*t.b-t.a),o=(2*(r.slope*r.constant-r.slope*t.b-t.a))**2-4*(1+r.slope**2)*(t.a**2+(r.constant-t.b)**2-t.r**2),a=2*(1+r.slope**2),s=(n+o**.5)/a,l=(n-o**.5)/a;return[new i.Vector2(s,r.slope*s+r.constant),new i.Vector2(l,r.slope*l+r.constant)]}static getProjectPoint(e,t){let r;if(e.r){let n=new i.Vector2(e.a,e.b),o=new i.Vector2(t.x,t.y),a=d.getLineEquation(n,o);n.distanceTo(o),e.r;let s=this.getIntersectPoint2(a,e);console.log("res",s),r=o.distanceTo(s[0])<o.distanceTo(s[1])?s[0]:s[1]}else{let i=this.getVerticalLineEquation(e,t);r=this.getIntersectPoint(e,i)}return r}static createThreeDimensionLabel(e,t,r=0){e=new i.Vector3(e.x,e.y,e.z),t=new i.Vector3(t.x,t.y,t.z);let n=.1,o=this.getLineEquation(e,t),a=this.getVerticalLineEquation(o,t),s="X"==a.slope?0:"Y"==a.slope?1/0:a.slope,l=new i.Vector3(Math.sin(Math.atan(s))*n/2,Math.cos(Math.atan(s))*n/2),h=t.clone().add(l),c=t.clone().add(l.negate()),d=new i.LineSegments(new(0,i.BufferGeometry)().setFromPoints([e,t,h,c]),new i.MeshBasicMaterial({color:r,side:i.DoubleSide,depthTest:!1}));return d.name="label",d.labelLength=e.distanceTo(t),d.center=e.clone().add(t).divideScalar(2),d}static getRandomNum(e,t){return Math.floor(Math.random()*(t-e+1))+e}static arrayTransformToVector(e){return 2==e.length?new i.Vector2(e[0],e[1]):3==e.length?new i.Vector3(e[0],e[1],e[2]):4==e.length?new i.Vector4(e[0],e[1],e[2],e[3]):void console.log("Check Array length again.")}static vectorTransformToArray(e,t=3){if(e.isVector2){if(2==t)return[e.x,e.y];if(3==t)return[e.x,e.y,0];if(4==t)return[e.x,e.y,0,0]}if(e.isVector3){if(2==t)return[e.x,e.y];if(3==t)return[e.x,e.y,e.z];if(4==t)return[e.x,e.y,e.z,0]}if(e.isVector4){if(2==t)return[e.x,e.y];if(3==t)return[e.x,e.y,e.z];if(4==t)return[e.x,e.y,e.z,e.w]}if(Array.isArray(e)){let i=[];return e.forEach(e=>{i.push(...this.vectorTransformToArray(e,t))}),i}}static vectorTransformToObject(e,t=!1,i=!0){let r={};return e.isVector2&&(i&&(r.x=e.x,r.y=e.y),t&&(r.X=e.x,r.Y=e.y)),e.isVector3&&(i&&(r.x=e.x,r.y=e.y,r.z=e.z),t&&(r.X=e.x,r.Y=e.y,r.Z=e.z)),e.isVector4&&(i&&(r.x=e.x,r.y=e.y,r.z=e.z,r.w=e.w),t&&(r.X=e.x,r.Y=e.y,r.Z=e.z,r.W=e.w)),r}static filterArray(e){let t=[];return e.forEach(e=>{let i=!0;t.forEach(r=>{r?e[0]===r[0]&&e[1]===r[1]&&(i=!1):t.push(e)}),i&&t.push(e)}),t}static filterArray2(e){let t=[];return e.forEach(e=>{let i=!0;t.forEach(r=>{r?(e[0]===r[0]&&e[1]===r[1]&&(i=!1),e[0]===r[1]&&e[1]===r[0]&&(i=!1)):t.push(e)}),i&&t.push(e)}),t}static isInclude(e,t){for(let i=0;i<e.length;i++)if(e[i].equals(t))return!0;return!1}static filterArray3(e){let t=[];return e.forEach(e=>{let i=!0;t.forEach(r=>{r?e.equals(r)&&(i=!1):t.push(e)}),i&&t.push(e)}),t}static getIndex(e,t){for(let i=0;i<e.length;i++)if(t[0]==e[i][0]&&t[1]==e[i][1])return i;return!1}static filterObjArray(e){let t=[],i={};for(let r of e)i[r]||(t.push(r),i[r]=1);return t}static isEqualArray(e,t){if(e.length!=t.length)return!1;let i=Array.from(e),r=0;for(var n of t)if(Array.isArray(n)){for(let e of t)if(e.length==n.length){let t=!0;for(let i=0;i<e.length;i++)-1==n.indexOf(e[i])&&(t=!1);t&&r++}}else i.includes(n)&&r++;return r==i.length}static whetherSameItemExist(e,t){for(let i=0;i<e.length;i++){let r=e[i];for(let e=0;e<t.length;e++){let n=t[e];if(r.x==n.x&&r.y==n.y)return[i,e]}}return!1}static compareArray(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!=t[i])return!1;return!0}static removeItemFromArr(e,t){e.splice(e.indexOf(t),1)}static keepDecimalRound(e,t){return Math.round(e*10**t)/10**t}static isParallel2(e,t){return e.angle()%Math.PI==t.angle()%Math.PI}static isSameDirection2(e,t){return e.angle()%(2*Math.PI)==t.angle()%(2*Math.PI)}static isParallel3(){}static includeUndefined(e){for(let t=0;t<e.length;t++)if(Array.isArray(e[t])){let i=this.includeUndefined(e[t]);if(i)return i}else if(void 0==e[t])return!0;return!1}static transToVector2(e){return new i.Vector2(e.x,e.y)}static transToVector3(e){return e.isVector2?new i.Vector3(e.x,e.y,0):e.isVector3?e:new i.Vector3(e.x,e.y,e.y)}static findNewItem(e,t){for(let i=0;i<e.length;i++)if(-1==t.indexOf(e[i]))return e[i]}static isCollinear(e,t,i){e=this.transToVector2(e.clone()),t=this.transToVector2(t.clone()),i=this.transToVector2(i.clone());let r=this.getLineEquation(e,t),n=this.getLineEquation(t,i);return r.slope==n.slope&&r.constant==n.constant}static getClockWise(e,t,i){e=this.transToVector2(e.clone()),t=this.transToVector2(t.clone()),i=this.transToVector2(i.clone());let r=(t.x-e.x)*(i.y-t.y)-(t.y-e.y)*(i.x-t.x);return 0==r?0:r<0}static getCircleCenter(e,t,i){if(this.isCollinear(e,t,i))return;let r=this.getVerticalLineEquation(this.getLineEquation(e,t),this.getMiddlePoint(e,t)),n=this.getVerticalLineEquation(this.getLineEquation(t,i),this.getMiddlePoint(t,i));return this.getIntersectPoint(r,n)}static createFloor3D(e,t){let r=new i.Shape;r.moveTo(e[0].x,e[0].y);for(let t=1;t<e.length;t++)r.lineTo(e[t].x,e[t].y);if(r.lineTo(e[0].x,e[0].y),0==window.floorDep){let n=new i.ShapeGeometry(r),o=new i.MeshStandardMaterial({map:t});this.recomputeUV(n);let a=new c.Floor3D(n,o);return a.allPoints=e,a}let n={steps:2,depth:window.floorDep,bevelEnabled:!1},o=new i.ExtrudeGeometry(r,n),a=new i.MeshStandardMaterial({map:t});this.recomputeUV(o);let s=new c.Floor3D(o,a);return s.geometry.translate(0,0,-window.floorDep),s.allPoints=e,s}static recomputeUV(e){let t=e.attributes.position.array,r=e.attributes.normal.array,n=e.attributes.uv,o={};for(let e=0;e<r.length;e+=3){let n=`${r[e]}_${r[e+1]}_${r[e+2]}`,a=new i.Vector3(t[e],t[e+1],t[e+2]);o[n]?o[n].push({index:e/3,vertex:a}):o[n]=[{index:e/3,vertex:a}]}let a=new i.Vector3(1,0,0),s=new i.Vector3(0,0,1);for(let e in o){let t,r,l=e.split("_").map(e=>parseFloat(e)),h=new(0,i.Vector3)().fromArray(l),c=[];for(let t=0;t<o[e].length;t++)c.push(o[e][t].vertex);let d=new(0,i.Box3)().setFromPoints(c),u=Math.PI/2-d.max.clone().sub(d.min).angleTo(s),p=this.getOriginP(c,h);for(let i=0;i<o[e].length;i++){let l=o[e][i],h=l.vertex.clone().sub(p),c=0==u?h.angleTo(a):Math.PI/2-h.angleTo(s);t=h.length()*Math.cos(c),r=h.length()*Math.sin(c),n.setXY(l.index,t/960,r/960)}}}static getOriginP(e,t){let r=new i.Vector3,n=new(0,i.Box3)().setFromPoints(e),o=new i.Vector3(1,0,0),a=new i.Vector3(0,1,0),s=new i.Vector3(0,0,1);if(t.equals(s))r=n.min;else if(t.equals(s.negate()))r=n.max;else if(t.equals(o))r=n.min;else if(t.equals(o.negate()))r=new i.Vector3(n.max.x,n.max.y,n.min.z);else if(t.equals(a))r=new i.Vector3(n.max.x,n.max.y,n.min.z);else if(t.equals(a.negate()))r=n.min;else{let e=t.angleTo(o),s=t.angleTo(a);console.log("normal - angleX - angleY - ",t,e,s),e<Math.PI/2&&s<Math.PI/2&&(r=new i.Vector3(n.min.x,n.max.y,n.min.z)),e<Math.PI/2&&s>Math.PI/2&&(r=n.max),e>Math.PI/2&&s<Math.PI/2&&(r=n.min),e>Math.PI/2&&s>Math.PI/2&&(r=new i.Vector3(n.max.x,n.min.y,n.min.y))}return r}static between(e,t,i){let r,n;return t>i?(r=t,n=i):(r=i,n=t),e<=r&&e>=n}static createPoint(e={},t,r){let n=e.radius||10,o=new i.SphereGeometry(n),a=new i.Mesh(o,r);return a.position.set(t.x,t.y,t.z),a}static createLine(e,t={}){t.color=t.color||0,t.linewidth=t.linewidth||1.5,t.dashed=t.dashed||!1;let i=[];e.forEach(e=>{i.push(...d.transToVector3(e).toArray())});let a=new(0,n.LineGeometry)().setPositions(i),s=new o.LineMaterial(t);s.resolution.set(window.innerWidth,window.innerHeight);let l=new r.Line2(a,s);return l.computeLineDistances(),l}static createShapeByPoints(e,t=!1){let r=new i.Shape;if(r.moveTo(e[e.length-1].x,e[e.length-1].y),e.forEach(e=>{r.lineTo(e.x,e.y)}),!t)return r;let n=new i.ShapeGeometry(r);return new i.Mesh(n,t)}static createShape(e,t,r){let n=new i.BufferGeometry;return n.attributes.position=new i.BufferAttribute(new Float32Array(e),3),n.index=new i.BufferAttribute(new Uint16Array(t),1),new i.Mesh(n,r)}static createCone(e={},t=0){e.radius||=1,e.height||=1,e.radialSegments||=8,e.heightSegments||=1,e.openEnded||=!1,e.thetaStart||=0,e.thetaLength||=2*Math.PI;let r=new i.ConeGeometry(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength),n=new i.MeshBasicMaterial({color:t});return new i.Mesh(r,n)}static getJsonLength(e){let t=0;for(let i in e)t++;return t}static contrastVec(e,t){return this.getJsonLength(e)==this.getJsonLength(t)&&2==this.getJsonLength(e)?e.x==t.x&&e.y==t.y:this.getJsonLength(e)==this.getJsonLength(t)&&3==this.getJsonLength(e)?e.x==t.x&&e.y==t.y&&e.z==t.z:void 0}}}),parcelRequire.register("7BJhL",function(e,t){$parcel$export(e.exports,"ADDITION",()=>i),$parcel$export(e.exports,"SUBTRACTION",()=>r),$parcel$export(e.exports,"DIFFERENCE",()=>n),$parcel$export(e.exports,"INTERSECTION",()=>o);let i=0,r=1,n=3,o=4}),parcelRequire.register("94t2y",function(e,t){$parcel$export(e.exports,"Evaluator",()=>d);var i=parcelRequire("4xklQ"),r=parcelRequire("6dW4N"),n=parcelRequire("kY0n3"),o=parcelRequire("9EDRu"),a=parcelRequire("lIlSF"),s=parcelRequire("gKQJE"),l=parcelRequire("6Hryq");function h(e,t,r,n){let o=!1,a=-1,s=n.groupCount,l=e.attributes,h=n.groupAttributes[0];for(let r in h){let c=n.getTotalLength(r,s),d=h[r].type,u=l[r];if(!u||u.array.length<c){let n=t.attributes[r];u=new i.BufferAttribute(new d(c),n.itemSize,n.normalized),e.setAttribute(r,u),o=!0}let p=0;for(let e=0;e<s;e++){let{array:t,type:i,length:o}=n.groupAttributes[e][r],a=new i(t.buffer,0,o);u.array.set(a,p),p+=a.length}u.needsUpdate=!0,a=c/u.itemSize}e.setDrawRange(0,a),e.clearGroups();let c=0;for(let t=0;t<s;t++){let i=n.getGroupArray("position",t).length/3;if(0!==i){let n=r[t];e.addGroup(c,i,n.materialIndex),c+=i}}if(e.index){let t=e.index.array;if(t.length<a)e.index=null,o=!0;else for(let e=0,i=t.length;e<i;e++)t[e]=e}return e.boundsTree=null,o&&e.dispose(),e}function c(e,t){let i=t;return Array.isArray(t)||(i=[],e.forEach(e=>{i[e.materialIndex]=t})),i}class d{constructor(){this.triangleSplitter=new r.TriangleSplitter,this.attributeData=new n.TypedAttributeData,this.attributes=["position","uv","normal"],this.useGroups=!0,this.debug=new o.OperationDebugData}evaluate(e,t,i,r=new l.Brush){e.prepareGeometry(),t.prepareGeometry();let{triangleSplitter:n,attributeData:o,attributes:d,useGroups:u,debug:p}=this,m=r.geometry,f=e.geometry.attributes;for(let e=0,t=d.length;e<t;e++){let t=d[e],i=f[t];o.initializeArray(t,i.array.constructor)}for(let e in o.attributes)d.includes(e)||o.delete(e);for(let e in m.attributes)d.includes(e)||(m.deleteAttribute(e),m.dispose());o.clear(),p.enabled&&(p.reset(),(0,s.setDebugContext)(p)),(0,a.performOperation)(e,t,i,n,o,{useGroups:u}),p.enabled&&(0,s.setDebugContext)(null);let g=u&&0!==e.geometry.groups.length?e.geometry.groups.map(e=>({...e})):[{start:0,count:1/0,materialIndex:0}],y=u&&0!==t.geometry.groups.length?t.geometry.groups.map(e=>({...e})):[{start:0,count:1/0,materialIndex:0}],x=c(g,e.material),w=c(y,t.material);y.forEach(e=>{e.materialIndex+=x.length}),h(m,e.geometry,[...g,...y],o);let b=m.groups;if(u){let e=new Map,t=[...x,...w],i=0;for(let r=0,n=t.length;r<n;r++){let n=!!b.find(e=>e.materialIndex===r);n?(e.set(r,i),i++):t[r]=null}for(let t=0,i=b.length;t<i;t++){let i=b[t];i.materialIndex=e.get(i.materialIndex)}r.material=t.filter(e=>e)}return r}evaluateHierarchy(e,t=new l.Brush){e.updateMatrixWorld(!0);let i=(e,t)=>{let r=e.children;for(let e=0,n=r.length;e<n;e++){let n=r[e];n.isOperationGroup?i(n,t):t(n)}},r=e=>{let t=e.children,n=!1;for(let e=0,i=t.length;e<i;e++){let i=t[e];n=r(i)||n}let o=e.isDirty();if(o&&e.markUpdated(),!n||e.isOperationGroup)return n||o;{let t;return i(e,i=>{t=t?this.evaluate(t,i,i.operation):this.evaluate(e,i,i.operation)}),e._cachedGeometry=t.geometry,e._cachedMaterials=t.material,!0}};return r(e),t.geometry=e._cachedGeometry,t.material=e._cachedMaterials,t}reset(){this.triangleSplitter.reset()}}}),parcelRequire.register("6dW4N",function(e,t){$parcel$export(e.exports,"TriangleSplitter",()=>g);var i=parcelRequire("4xklQ"),r=parcelRequire("57zgU"),n=parcelRequire("gKQJE");let o=1e-14,a=1e-7,s=new i.Line3,l=new i.Line3,h=new i.Vector3,c=new i.Vector3,d=new i.Plane,u=new r.ExtendedTriangle;function p(e){return e.a.distanceToSquared(e.b)<o||e.a.distanceToSquared(e.c)<o||e.b.distanceToSquared(e.c)<o}class m extends i.Triangle{constructor(...e){super(...e),this.side=null,this.originalSide=null,this.coplanarCount=0}init(){this.side=null,this.originalSide=null,this.coplanarCount=0}initFrom(e){this.side=e.side,this.originalSide=e.originalSide,this.coplanarCount=e.coplanarCount}updateSide(e,t=null,i=-1){if(null!==this.originalSide&&null===this.side)return;h.copy(this.a).add(this.b).add(this.c).multiplyScalar(1/3);let r=0>e.distanceToPoint(h)?n.BACK_SIDE:n.FRONT_SIDE;t&&-1!==i?r===n.FRONT_SIDE&&(this.coplanarCount++,3===this.coplanarCount&&(this.side=n.COPLANAR)):(null===this.originalSide&&(this.originalSide=r,this.side=r),r!==this.side&&(this.side=null))}}class f{constructor(){this._pool=[],this._index=0}getTriangle(){this._index>=this._pool.length&&this._pool.push(new m);let e=this._pool[this._index++];return e.init(),e}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class g{constructor(){this.trianglePool=new f,this.triangles=[],this.normal=new i.Vector3}initialize(e){let{triangles:t,trianglePool:i,normal:r}=this;if(t.length=0,i.clear(),Array.isArray(e))for(let n=0,a=e.length;n<a;n++){let a=e[n];if(0===n)a.getNormal(r);else if(Math.abs(1-a.getNormal(h).dot(r))>o)throw Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");let s=i.getTriangle();s.copy(a),t.push(s)}else{e.getNormal(r);let n=i.getTriangle();n.copy(e),t.push(n)}}splitByTriangle(e){let{normal:t,triangles:i}=this;if(e.getPlane(d),Math.abs(1-Math.abs(d.normal.dot(t)))<a){let r=[e.a,e.b,e.c];for(let i=0;i<3;i++){let n=(i+1)%3,o=r[i],a=r[n];h.subVectors(a,o).normalize(),c.crossVectors(t,h),d.setFromNormalAndCoplanarPoint(c,o),this.splitByPlane(d,e,i)}for(let e=0,t=i.length;e<t;e++){let t=i[e];t.coplanarCount=0}}else this.splitByPlane(d,e)}splitByPlane(e,t=null,i=-1){let{triangles:r,trianglePool:n}=this,c=null;null!==t&&((c=u).copy(t),c.needsUpdate=!0);for(let t=0,d=r.length;t<d;t++){let u=r[t],{a:m,b:f,c:g}=u;if(c&&(!c.intersectsTriangle(u,s)||1e-5>s.distance())){u.updateSide(e,c,i),u.side=null;continue}let y=0,x=-1,w=0,b=0,v=!1,M=[m,f,g];for(let t=0;t<3;t++){let i=(t+1)%3;s.start.copy(M[t]),s.end.copy(M[i]);let r=e.distanceToPoint(s.start),n=e.distanceToPoint(s.end);Math.abs(r)<o?b++:r>0&&w++,Math.abs(r)<a&&Math.abs(n)<a&&(v=!0);let c=!!e.intersectLine(s,h);!c&&Math.abs(n)<o&&(h.copy(s.end),c=!0),c&&!(h.distanceTo(s.start)<o)&&(h.distanceTo(s.end)<o&&(x=t),0===y?l.start.copy(h):l.end.copy(h),y++)}if(!v&&b<2&&2===y&&l.distance()>a){if(-1!==x){let o=0;0==(x=(x+1)%3)&&(o=(o+1)%3);let a=o+1;a===x&&(a=(a+1)%3);let s=n.getTriangle();s.a.copy(M[a]),s.b.copy(l.end),s.c.copy(l.start),p(s)||(r.push(s),s.initFrom(u),s.updateSide(e,c,i)),u.a.copy(M[o]),u.b.copy(l.start),u.c.copy(l.end),p(u)?(r.splice(t,1),t--,d--):u.updateSide(e,c,i)}else{let o=M.findIndex(t=>w>=2?0>e.distanceToPoint(t):e.distanceToPoint(t)>0);if(0===o){let e=l.start;l.start=l.end,l.end=e}else if(-1===o)continue;let a=(o+1)%3,s=(o+2)%3,h=n.getTriangle(),m=n.getTriangle();M[a].distanceToSquared(l.start)<M[s].distanceToSquared(l.end)?(h.a.copy(M[a]),h.b.copy(l.start),h.c.copy(l.end),m.a.copy(M[a]),m.b.copy(M[s]),m.c.copy(l.start)):(h.a.copy(M[s]),h.b.copy(l.start),h.c.copy(l.end),m.a.copy(M[a]),m.b.copy(M[s]),m.c.copy(l.end)),u.a.copy(M[o]),u.b.copy(l.end),u.c.copy(l.start),p(h)||(r.push(h),h.initFrom(u),h.updateSide(e,c,i)),p(m)||(r.push(m),m.initFrom(u),m.updateSide(e,c,i)),p(u)?(r.splice(t,1),t--,d--):u.updateSide(e,c,i)}}else 3===y&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0}}}),parcelRequire.register("gKQJE",function(e,t){$parcel$export(e.exports,"COPLANAR",()=>y),$parcel$export(e.exports,"BACK_SIDE",()=>x),$parcel$export(e.exports,"FRONT_SIDE",()=>w),$parcel$export(e.exports,"INVERT_TRI",()=>b),$parcel$export(e.exports,"ADD_TRI",()=>v),$parcel$export(e.exports,"SKIP_TRI",()=>M),$parcel$export(e.exports,"setDebugContext",()=>P),$parcel$export(e.exports,"getHitSide",()=>T),$parcel$export(e.exports,"collectIntersectingTriangles",()=>_),$parcel$export(e.exports,"appendAttributeFromTriangle",()=>C),$parcel$export(e.exports,"appendAttributesFromIndices",()=>D),$parcel$export(e.exports,"getOperationAction",()=>A);var i=parcelRequire("4xklQ"),r=parcelRequire("iaU8k"),n=parcelRequire("7BJhL");let o=new i.Ray,a=new i.Matrix4,s=new i.Triangle,l=new i.Vector3,h=new i.Vector4,c=new i.Vector4,d=new i.Vector4,u=new i.Vector4,p=new i.Vector4,m=new i.Vector4,f=new i.Line3,g=1e-8,y=0,x=-1,w=1,b=0,v=1,M=2,S=null;function P(e){S=e}function T(e,t){function r(){return Math.random()-.5}o.origin.copy(e.a).add(e.b).add(e.c).multiplyScalar(1/3),e.getNormal(o.direction);let n=3,a=0,s=1/0;for(let e=0;e<n;e++){o.direction.x+=r()*g,o.direction.y+=r()*g,o.direction.z+=r()*g;let l=t.raycastFirst(o,i.DoubleSide);if(l&&o.direction.dot(l.face.normal)>0&&a++,null!==l&&(s=Math.min(s,l.distance)),0===s||a/n>.5||(e-a+1)/n>.5)break}return 0===s?y:a/n>.5?x:w}function _(e,t){let i=new r.IntersectionMap,n=new r.IntersectionMap;return a.copy(e.matrixWorld).invert().multiply(t.matrixWorld),e.geometry.boundsTree.bvhcast(t.geometry.boundsTree,a,{intersectsTriangles:(e,t,r,o)=>(e.intersectsTriangle(t,f)&&f.distance()>1e-5&&(i.add(r,o),n.add(o,r),S&&(S.addEdge(f),S.addIntersectingTriangles(r,e,o,t))),!1)}),{aIntersections:i,bIntersections:n}}function C(e,t,i,r,n,o,a=!1){let l=i.attributes,u=i.index,p=3*e,m=u.getX(p+0),f=u.getX(p+1),g=u.getX(p+2);for(let e in o){let i=l[e],u=o[e];if(!(e in l))throw Error(`CSG Operations: Attribute ${e} not available on geometry.`);let p=i.itemSize;"position"===e?(s.a.fromBufferAttribute(i,m).applyMatrix4(r),s.b.fromBufferAttribute(i,f).applyMatrix4(r),s.c.fromBufferAttribute(i,g).applyMatrix4(r),E(s.a,s.b,s.c,t,3,u,a)):"normal"===e?(s.a.fromBufferAttribute(i,m).applyNormalMatrix(n),s.b.fromBufferAttribute(i,f).applyNormalMatrix(n),s.c.fromBufferAttribute(i,g).applyNormalMatrix(n),a&&(s.a.multiplyScalar(-1),s.b.multiplyScalar(-1),s.c.multiplyScalar(-1)),E(s.a,s.b,s.c,t,3,u,a,!0)):(h.fromBufferAttribute(i,m),c.fromBufferAttribute(i,f),d.fromBufferAttribute(i,g),E(h,c,d,t,p,u,a))}}function D(e,t,i,r,n,o,a,s=!1){L(e,r,n,o,a,s),L(t,r,n,o,a,s),L(i,r,n,o,a,s)}function A(e,t,i=!1){switch(e){case n.ADDITION:if(t===w||t===y&&i)return v;break;case n.SUBTRACTION:if(i){if(t===x)return b}else if(t===w)return v;break;case n.DIFFERENCE:if(t===x)return b;if(t===w)return v;case n.INTERSECTION:if(t===x||t===y&&i)return v;break;default:throw Error(`Unrecognized CSG operation enum "${e}".`)}return M}function E(e,t,i,r,n,o,a=!1,s=!1){let l=e=>{o.push(e.x),n>1&&o.push(e.y),n>2&&o.push(e.z),n>3&&o.push(e.w)};u.set(0,0,0,0).addScaledVector(e,r.a.x).addScaledVector(t,r.a.y).addScaledVector(i,r.a.z),p.set(0,0,0,0).addScaledVector(e,r.b.x).addScaledVector(t,r.b.y).addScaledVector(i,r.b.z),m.set(0,0,0,0).addScaledVector(e,r.c.x).addScaledVector(t,r.c.y).addScaledVector(i,r.c.z),s&&(u.normalize(),p.normalize(),m.normalize()),l(u),a?(l(m),l(p)):(l(p),l(m))}function L(e,t,i,r,n,o=!1){for(let a in n){let s=t[a],h=n[a];if(!(a in t))throw Error(`CSG Operations: Attribute ${a} no available on geometry.`);let c=s.itemSize;"position"===a?(l.fromBufferAttribute(s,e).applyMatrix4(i),h.push(l.x,l.y,l.z)):"normal"===a?(l.fromBufferAttribute(s,e).applyNormalMatrix(r),o&&l.multiplyScalar(-1),h.push(l.x,l.y,l.z)):(h.push(s.getX(e)),c>1&&h.push(s.getY(e)),c>2&&h.push(s.getZ(e)),c>3&&h.push(s.getW(e)))}}}),parcelRequire.register("iaU8k",function(e,t){$parcel$export(e.exports,"IntersectionMap",()=>i);class i{constructor(){this.intersectionSet={},this.ids=[]}add(e,t){let{intersectionSet:i,ids:r}=this;i[e]||(i[e]=[],r.push(e)),i[e].push(t)}}}),parcelRequire.register("kY0n3",function(e,t){$parcel$export(e.exports,"TypedAttributeData",()=>r);var i=parcelRequire("84u5U");class r{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(e){return this.groupAttributes[0][e].type}getTotalLength(e){let{groupCount:t,groupAttributes:i}=this,r=0;for(let n=0;n<t;n++){let t=i[n];r+=t[e].length}return r}getGroupSet(e=0){let{groupAttributes:t}=this;if(t[e])return this.groupCount=Math.max(this.groupCount,e+1),t[e];let r=t[0];for(this.groupCount=Math.max(this.groupCount,e+1);e>=t.length;){let e={};for(let n in t.push(e),r)e[n]=new i.TypeBackedArray(r[n].type)}return t[e]}getGroupArray(e,t=0){let{groupAttributes:i}=this,r=i[0][e];if(!r)throw Error(`TypedAttributeData: Attribute with "${e}" has not been initialized`);return this.getGroupSet(t)[e]}initializeArray(e,t){let{groupAttributes:r}=this,n=r[0][e];if(n){if(n.type!==t)throw Error(`TypedAttributeData: Array ${e} already initialized with a different type.`)}else for(let n=0,o=r.length;n<o;n++)r[n][e]=new i.TypeBackedArray(t)}clear(){this.groupCount=0;let{groupAttributes:e}=this;e.forEach(e=>{for(let t in e)e[t].clear()})}delete(e){this.groupAttributes.forEach(t=>{delete t[e]})}reset(){this.groupAttributes=[]}}}),parcelRequire.register("84u5U",function(e,t){$parcel$export(e.exports,"TypeBackedArray",()=>r);var i=parcelRequire("14bAY");class r{constructor(e,t=500){let r=(0,i.areSharedArrayBuffersSupported)()?SharedArrayBuffer:ArrayBuffer;this.expansionFactor=1.5,this.type=e,this.array=new e(new r(t*e.BYTES_PER_ELEMENT)),this.length=0}expand(e=null){let{type:t,array:i,expansionFactor:r}=this;null===e&&(e=~~(i.length*r));let n=new t(e);n.set(i,0),this.array=n}push(...e){let{array:t,length:i}=this;i+e.length>t.length&&(this.expand(),t=this.array);for(let r=0,n=e.length;r<n;r++)t[i+r]=e[r];this.length+=e.length}clear(){this.length=0}}}),parcelRequire.register("9EDRu",function(e,t){$parcel$export(e.exports,"OperationDebugData",()=>o);var i=parcelRequire("4xklQ");class r{constructor(e){this.triangle=new(0,i.Triangle)().copy(e),this.intersects={}}addTriangle(e,t){this.intersects[e]=new(0,i.Triangle)().copy(t)}getIntersectArray(){let e=[],{intersects:t}=this;for(let i in t)e.push(t[i]);return e}}class n{constructor(){this.data={}}addTriangleIntersection(e,t,i,n){let{data:o}=this;o[e]||(o[e]=new r(t)),o[e].addTriangle(i,n)}getTrianglesAsArray(e=null){let{data:t}=this,i=[];if(null!==e)e in t&&i.push(t[e].triangle);else for(let e in t)i.push(t[e].triangle);return i}getTriangleIndices(){return Object.keys(this.data).map(e=>parseInt(e))}getIntersectionIndices(e){let{data:t}=this;return t[e]?Object.keys(t[e].intersects).map(e=>parseInt(e)):[]}getIntersectionsAsArray(e=null,t=null){let{data:i}=this,r=new Set,n=[],o=e=>{if(i[e]){if(null!==t)i[e].intersects[t]&&n.push(i[e].intersects[t]);else{let t=i[e].intersects;for(let e in t)r.has(e)||(r.add(e),n.push(t[e]))}}};if(null!==e)o(e);else for(let e in i)o(e);return n}reset(){this.data={}}}class o{constructor(){this.enabled=!1,this.triangleIntersectsA=new n,this.triangleIntersectsB=new n,this.intersectionEdges=[]}addIntersectingTriangles(e,t,i,r){let{triangleIntersectsA:n,triangleIntersectsB:o}=this;n.addTriangleIntersection(e,t,i,r),o.addTriangleIntersection(i,r,e,t)}addEdge(e){this.intersectionEdges.push(e.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}}}),parcelRequire.register("lIlSF",function(e,t){$parcel$export(e.exports,"performOperation",()=>d);var i=parcelRequire("4xklQ"),r=parcelRequire("gKQJE");let n=new i.Matrix4,o=new i.Matrix3,a=new i.Triangle,s=new i.Triangle,l=new i.Triangle,h=new i.Triangle;function c(e){for(let t of e)return t}function d(e,t,i,n,o,a){let s;let{useGroups:l=!0}=a,{aIntersections:h,bIntersections:c}=(0,r.collectIntersectingTriangles)(e,t),d=[],m=null;return p(e,t,h,i,!1,o,s=l?0:-1),u(e,t,h,i,!1,n,o,s),s=l?e.geometry.groups.length||1:-1,p(t,e,c,i,!0,o,s),u(t,e,c,i,!0,n,o,s),{groups:d,materials:m}}function u(e,t,i,l,c,d,u,p=0){n.copy(t.matrixWorld).invert().multiply(e.matrixWorld),o.getNormalMatrix(e.matrixWorld);let m=e.geometry.groupIndices,f=e.geometry.index,g=e.geometry.attributes.position,y=t.geometry.boundsTree,x=t.geometry.index,w=t.geometry.attributes.position,b=i.ids,v=i.intersectionSet;for(let t=0,i=b.length;t<i;t++){let i=b[t],M=-1===p?0:m[i]+p,S=u.getGroupSet(M),P=3*i,T=f.getX(P+0),_=f.getX(P+1),C=f.getX(P+2);a.a.fromBufferAttribute(g,T).applyMatrix4(n),a.b.fromBufferAttribute(g,_).applyMatrix4(n),a.c.fromBufferAttribute(g,C).applyMatrix4(n),d.initialize(a);let D=v[i];for(let e=0,t=D.length;e<t;e++){let t=3*D[e],i=x.getX(t+0),r=x.getX(t+1),n=x.getX(t+2);s.a.fromBufferAttribute(w,i),s.b.fromBufferAttribute(w,r),s.c.fromBufferAttribute(w,n),d.splitByTriangle(s)}let A=d.triangles;for(let t=0,n=A.length;t<n;t++){let n=A[t],s=(0,r.getHitSide)(n,y),d=(0,r.getOperationAction)(l,s,c);if(d!==r.SKIP_TRI)switch(a.getBarycoord(n.a,h.a),a.getBarycoord(n.b,h.b),a.getBarycoord(n.c,h.c),d){case r.ADD_TRI:(0,r.appendAttributeFromTriangle)(i,h,e.geometry,e.matrixWorld,o,S);break;case r.INVERT_TRI:(0,r.appendAttributeFromTriangle)(i,h,e.geometry,e.matrixWorld,o,S,!0)}}}return b.length}function p(e,t,i,a,s,h,d=0){n.copy(t.matrixWorld).invert().multiply(e.matrixWorld),o.getNormalMatrix(e.matrixWorld);let u=t.geometry.boundsTree,p=e.geometry.groupIndices,m=e.geometry.index,f=e.geometry.attributes,g=f.position,y=[],x=e.geometry.halfEdges,w=new Set;for(let e=0,t=m.count/3;e<t;e++)e in i.intersectionSet||w.add(e);for(;w.size>0;){let t=c(w);w.delete(t),y.push(t);let i=3*t,b=m.getX(i+0),v=m.getX(i+1),M=m.getX(i+2);l.a.fromBufferAttribute(g,b).applyMatrix4(n),l.b.fromBufferAttribute(g,v).applyMatrix4(n),l.c.fromBufferAttribute(g,M).applyMatrix4(n);let S=(0,r.getHitSide)(l,u),P=(0,r.getOperationAction)(a,S,s);for(;y.length>0;){let t=y.pop(),i=-1===d?0:p[t]+d,n=h.getGroupSet(i);for(let e=0;e<3;e++){let i=x.getSiblingTriangleIndex(t,e);-1!==i&&w.has(i)&&(y.push(i),w.delete(i))}let a=3*t,l=m.getX(a+0),c=m.getX(a+1),u=m.getX(a+2);switch(P){case r.ADD_TRI:(0,r.appendAttributesFromIndices)(l,c,u,f,e.matrixWorld,o,n);break;case r.INVERT_TRI:(0,r.appendAttributesFromIndices)(u,c,l,f,e.matrixWorld,o,n,s)}}}}}),parcelRequire.register("jDRRp",function(e,t){$parcel$export(e.exports,"Floor3D",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("hrM0U");class n extends i.Mesh{constructor(e,t){super(e,t),this.type="Floor3D"}refresh(){let e=Object.assign({},this.geometry.parameters.options);this.geometry.parameters.shapes,e.depth=window.floorDep,this.geometry.dispose();let t=(0,r.CommonFunc).createFloor3D(this.allPoints,this.material.map);this.geometry=t.geometry.clone(),t.geometry.dispose()}computeUVs(){}changeMaterial(){}}}),parcelRequire.register("gDTsF",function(e,t){$parcel$export(e.exports,"Point",()=>tg),$parcel$export(e.exports,"point",()=>ty),$parcel$export(e.exports,"Vector",()=>tx),$parcel$export(e.exports,"vector",()=>tw),$parcel$export(e.exports,"Segment",()=>tb),$parcel$export(e.exports,"segment",()=>tv),$parcel$export(e.exports,"Line",()=>tS),$parcel$export(e.exports,"Arc",()=>tC),$parcel$export(e.exports,"Ray",()=>tW),$parcel$export(e.exports,"ray",()=>tV),$parcel$export(e.exports,"Polygon",()=>tk);let i=!0,r=!1,n={CCW:-1,CW:1,NOT_ORIENTABLE:0},o=2*Math.PI,a=1,s=0,l=2,h=3,c=4,d=1,u=2,p=0,m=1,f=2;var g=Object.freeze({__proto__:null,BOUNDARY:l,CCW:i,CONTAINS:h,CW:r,END_VERTEX:f,INSIDE:a,INTERLACE:c,NOT_VERTEX:p,ORIENTATION:n,OUTSIDE:s,OVERLAP_OPPOSITE:u,OVERLAP_SAME:d,PIx2:o,START_VERTEX:m});let y=1e-6;function x(e){y=e}function w(){return y}let b=3;function v(e){return e<y&&e>-y}function M(e,t){return e-t<y&&e-t>-y}function S(e,t){return e-t>y}function P(e,t){return e-t<-y}var T=Object.freeze({__proto__:null,DECIMALS:b,EQ:M,EQ_0:v,GE:function(e,t){return e-t>-y},GT:S,LE:function(e,t){return e-t<y},LT:P,getTolerance:w,setTolerance:x});class _{static get ILLEGAL_PARAMETERS(){return ReferenceError("Illegal Parameters")}static get ZERO_DIVISION(){return Error("Zero division")}static get UNRESOLVED_BOUNDARY_CONFLICT(){return Error("Unresolved boundary conflict in boolean operation")}static get INFINITE_LOOP(){return Error("Infinite loop")}}let C={Utils:T,Errors:_,Matrix:void 0,Planar_set:void 0,Point:void 0,Vector:void 0,Line:void 0,Circle:void 0,Segment:void 0,Arc:void 0,Box:void 0,Edge:void 0,Face:void 0,Ray:void 0,Ray_shooting:void 0,Multiline:void 0,Polygon:void 0,Distance:void 0,Inversion:void 0};for(let e in g)C[e]=g[e];Object.defineProperty(C,"DP_TOL",{get:function(){return w()},set:function(e){x(e)}});class D{constructor(e,t){this.first=e,this.last=t||this.first}[Symbol.iterator](){let e;return{next:()=>({value:e=e?e.next:this.first,done:void 0===e})}}get size(){let e=0;for(let t of this)e++;return e}toArray(e,t){let i=[],r=e||this.first,n=t||this.last,o=r;if(void 0===o)return i;do i.push(o),o=o.next;while(o!==n.next)return i}append(e){return this.isEmpty()?this.first=e:(e.prev=this.last,this.last.next=e),this.last=e,this.last.next=void 0,this.first.prev=void 0,this}insert(e,t){if(this.isEmpty())this.first=e,this.last=e;else if(null==t)e.next=this.first,this.first.prev=e,this.first=e;else{let i=t.next;t.next=e,i&&(i.prev=e),e.prev=t,e.next=i,this.last===t&&(this.last=e)}return this.last.next=void 0,this.first.prev=void 0,this}remove(e){return e===this.first&&e===this.last?(this.first=void 0,this.last=void 0):(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e===this.first&&(this.first=e.next),e===this.last&&(this.last=e.prev)),this}isEmpty(){return void 0===this.first}static testInfiniteLoop(e){let t=e,i=e;do{if(t!=e&&t===i)throw C.Errors.INFINITE_LOOP;t=t.next,i=i.next.next}while(t!=e)}}function A(e,t,i){let r=i.length,n=e.shape.split(t);if(0===n.length)return;let o=0;o=null===n[0]?0:null===n[1]?e.shape.length:n[0].length;let a=p;M(o,0)&&(a|=m),M(o,e.shape.length)&&(a|=f);let s=a&f&&0===e.next.arc_length?0:e.arc_length+o;i.push({id:r,pt:t,arc_length:s,edge_before:e,edge_after:void 0,face:e.face,is_vertex:a})}function E(e){e.int_points1_sorted=L(e.int_points1),e.int_points2_sorted=L(e.int_points2)}function L(e){let t=new Map,i=0;for(let r of e)!t.has(r.face)&&(t.set(r.face,i),i++);for(let i of e)i.faceId=t.get(i.face);return e.slice().sort(I)}function I(e,t){return e.faceId<t.faceId?-1:e.faceId>t.faceId?1:e.arc_length<t.arc_length?-1:e.arc_length>t.arc_length?1:0}function R(e,t){return t.slice().sort((t,i)=>e.coord(t.pt)<e.coord(i.pt)?-1:e.coord(t.pt)>e.coord(i.pt)?1:0)}function W(e){let t,i,r,n;if(e.int_points1.length<2)return;let o=!1;for(let a=0;a<e.int_points1_sorted.length;a++)if(-1!==e.int_points1_sorted[a].id){t=e.int_points1_sorted[a],i=e.int_points2[t.id];for(let s=a+1;s<e.int_points1_sorted.length&&M((r=e.int_points1_sorted[s]).arc_length,t.arc_length);s++)-1!==r.id&&-1!==(n=e.int_points2[r.id]).id&&r.edge_before===t.edge_before&&r.edge_after===t.edge_after&&n.edge_before===i.edge_before&&n.edge_after===i.edge_after&&(r.id=-1,n.id=-1,o=!0)}i=e.int_points2_sorted[0],t=e.int_points1[i.id];for(let r=1;r<e.int_points2_sorted.length;r++){let n=e.int_points2_sorted[r];if(-1==n.id)continue;if(-1==i.id||!M(n.arc_length,i.arc_length)){i=n,t=e.int_points1[i.id];continue}let a=e.int_points1[n.id];a.edge_before===t.edge_before&&a.edge_after===t.edge_after&&n.edge_before===i.edge_before&&n.edge_after===i.edge_after&&(a.id=-1,n.id=-1,o=!0)}o&&(e.int_points1=e.int_points1.filter(e=>e.id>=0),e.int_points2=e.int_points2.filter(e=>e.id>=0),e.int_points1.forEach((e,t)=>e.id=t),e.int_points2.forEach((e,t)=>e.id=t))}function V(e){for(let t of e)t.edge_before.bvStart=void 0,t.edge_before.bvEnd=void 0,t.edge_before.bv=void 0,t.edge_before.overlap=void 0,t.edge_after.bvStart=void 0,t.edge_after.bvEnd=void 0,t.edge_after.bv=void 0,t.edge_after.overlap=void 0;for(let t of e)t.edge_before.bvEnd=l,t.edge_after.bvStart=l}function k(e,t){for(let i of e)i.edge_before.setInclusion(t),i.edge_after.setInclusion(t)}function B(e){let t,i,r;let n=e.int_points1.length;for(let o=0;o<n;o++){let a,s=e.int_points1_sorted[o];s.face!==t&&(i=o,t=s.face);let h=o,c=O(e.int_points1_sorted,o,t);a=h+c<n&&e.int_points1_sorted[h+c].face===t?h+c:i;let d=O(e.int_points1_sorted,a,t);r=null;for(let i=a;i<a+d;i++){let n=e.int_points1_sorted[i];if(n.face===t&&e.int_points2[n.id].face===e.int_points2[s.id].face){r=n;break}}if(null===r)continue;let u=s.edge_after,p=r.edge_before;if(!(u.bv===l&&p.bv===l)||u!==p)continue;let m=e.int_points2[s.id],f=e.int_points2[r.id],g=m.edge_after,y=f.edge_before;g.bv===l&&y.bv===l&&g===y||(m=e.int_points2[r.id],f=e.int_points2[s.id],g=m.edge_after,y=f.edge_before),g.bv===l&&y.bv===l&&g===y&&u.setOverlap(g)}}function O(e,t,i){let r,n;let o=1;if(1==e.length)return 1;r=e[t];for(let a=t+1;a<e.length&&r.face==i&&(n=e[a]).pt.equalTo(r.pt)&&n.edge_before===r.edge_before&&n.edge_after===r.edge_after;a++)o++;return o}function F(e,t){if(t){for(let i of t){let t=i.edge_before;if(i.is_vertex=p,t.shape.start&&t.shape.start.equalTo(i.pt)&&(i.is_vertex|=m),t.shape.end&&t.shape.end.equalTo(i.pt)&&(i.is_vertex|=f),i.is_vertex&m){i.edge_before=t.prev,i.is_vertex=f;continue}if(i.is_vertex&f)continue;let r=e.addVertex(i.pt,t);i.edge_before=r}for(let e of t)e.edge_after=e.edge_before.next}}function z(e,t,i){let r=e.edge_before,n=t.edge_after;r.next=i,i.prev=r,i.next=n,n.prev=i}let{INSIDE:U,OUTSIDE:N,BOUNDARY:G,OVERLAP_SAME:H,OVERLAP_OPPOSITE:j}=g,{NOT_VERTEX:q,START_VERTEX:X,END_VERTEX:Y}=g,J=1,Z=2,Q=3;function K(e,t){let[i,r]=es(e,t,J,!0);return i}function ee(e,t){let[i,r]=es(e,t.clone().reverse(),Q,!0);return i}function et(e,t){let[i,r]=es(e,t,Z,!0);return i}function ei(e,t){let[i,r]=es(e,t,Z,!1),n=[];for(let e of i.faces)n=[...n,...[...e.edges].map(e=>e.shape)];let o=[];for(let e of r.faces)o=[...o,...[...e.edges].map(e=>e.shape)];return[n,o]}function er(e,t){let[i,r]=es(e,t,Q,!1),n=[];for(let e of i.faces)n=[...n,...[...e.edges].map(e=>e.shape)];return n}function en(e,t){let i=e.clone(),r=t.clone(),n=el(i,r);return E(n),F(i,n.int_points1_sorted),F(r,n.int_points2_sorted),W(n),E(n),[n.int_points1_sorted.map(e=>e.pt),n.int_points2_sorted.map(e=>e.pt)]}function eo(e,t,i,r){let n=eh(e,i.int_points1),o=eh(t,i.int_points2);for(ec(n,t),ec(o,e),V(i.int_points1),V(i.int_points2),k(i.int_points1,t),k(i.int_points2,e);ed(e,t,i.int_points1,i.int_points1_sorted,i.int_points2,i););B(i),eu(e,r,i.int_points1_sorted,!0),eu(t,r,i.int_points2_sorted,!1),ey(e,n,r,!0),ey(t,o,r,!1)}function ea(e,t,i,r){ep(e,t,r,i.int_points2),em(e,t,i),ef(e,i.int_points1),ef(t,i.int_points2),eg(e,i.int_points1,i.int_points2),eg(e,i.int_points2,i.int_points1)}function es(e,t,i,r){let n=e.clone(),o=t.clone(),a=el(n,o);return E(a),F(n,a.int_points1_sorted),F(o,a.int_points2_sorted),W(a),E(a),eo(n,o,a,i),r&&ea(n,o,a,i),[n,o]}function el(e,t){let i={int_points1:[],int_points2:[]};for(let r of e.edges)for(let e of t.edges.search(r.box))for(let t of r.shape.intersect(e.shape))A(r,t,i.int_points1),A(e,t,i.int_points2);return i}function eh(e,t){let i=[];for(let r of e.faces)t.find(e=>e.face===r)||i.push(r);return i}function ec(e,t){for(let i of e)i.first.bv=i.first.bvStart=i.first.bvEnd=void 0,i.first.setInclusion(t)}function ed(e,t,i,r,n,o){let a,s,l;let h=r.length,c=!1;for(let d=0;d<h;d++){let u,p=r[d];p.face!==a&&(s=d,a=p.face);let m=d,f=O(r,d,a);u=m+f<h&&r[m+f].face===a?m+f:s;let g=O(r,u,a);l=null;for(let e=u;e<u+g;e++){let t=r[e];if(t.face===a&&n[t.id].face===n[p.id].face){l=t;break}}if(null===l)continue;let y=p.edge_after,x=l.edge_before;if(y.bv===G&&x.bv!=G){y.bv=x.bv;continue}if(y.bv!=G&&x.bv===G){x.bv=y.bv;continue}if(y.bv===G&&x.bv===G&&y!=x||y.bv===U&&x.bv===N||y.bv===N&&x.bv===U){let e=y.next;for(;e!=x;)e.bvStart=void 0,e.bvEnd=void 0,e.bv=void 0,e.setInclusion(t),e=e.next}if(y.bv===G&&x.bv===G&&y!=x){let e,t=y.next;for(;t!=x;){if(t.bv!=G){if(void 0===e)e=t.bv;else if(t.bv!=e)throw _.UNRESOLVED_BOUNDARY_CONFLICT}t=t.next}void 0!=e&&(y.bv=e,x.bv=e);continue}if(y.bv===U&&x.bv===N||y.bv===N&&x.bv===U){let r=y;for(;r!=x;){if(r.bvStart===y.bv&&r.bvEnd===x.bv){let[a,s]=r.shape.distanceTo(t);if(a<10*C.DP_TOL){A(r,s.ps,i);let a=i[i.length-1];if(a.is_vertex&X)a.edge_after=r,a.edge_before=r.prev,r.bvStart=G,r.bv=void 0,r.setInclusion(t);else if(a.is_vertex&Y)a.edge_after=r.next,r.bvEnd=G,r.bv=void 0,r.setInclusion(t);else{let e=t.addVertex(a.pt,r);a.edge_before=e,a.edge_after=e.next,e.setInclusion(t),e.next.bvStart=G,e.next.bvEnd=void 0,e.next.bv=void 0,e.next.setInclusion(t)}let l=t.findEdgeByPoint(s.pe);A(l,s.pe,n);let h=n[n.length-1];if(h.is_vertex&X)h.edge_after=l,h.edge_before=l.prev;else if(h.is_vertex&Y)h.edge_after=l.next;else{let i=n.find(e=>e.edge_after===l),r=t.addVertex(h.pt,l);h.edge_before=r,h.edge_after=r.next,i&&(i.edge_after=r),r.bvStart=void 0,r.bvEnd=G,r.bv=void 0,r.setInclusion(e),r.next.bvStart=G,r.next.bvEnd=void 0,r.next.bv=void 0,r.next.setInclusion(e)}E(o),c=!0;break}}r=r.next}if(c)break;throw _.UNRESOLVED_BOUNDARY_CONFLICT}}return c}function eu(e,t,i,r){let n,o,a,s;if(i)for(let l=0;l<i.length;l++){let h;if((n=i[l]).face!==a&&(s=l,a=n.face),a.isEmpty())continue;let c=l,d=O(i,l,a);h=c+d<i.length&&i[c+d].face===n.face?c+d:s,o=i[h];let u=h,p=O(i,u,a),m=n.edge_after,f=o.edge_before;if(m.bv===U&&f.bv===U&&t===J||m.bv===N&&f.bv===N&&t===Z||(m.bv===N||f.bv===N)&&t===Q&&!r||(m.bv===U||f.bv===U)&&t===Q&&r||m.bv===G&&f.bv===G&&m.overlap&H&&r||m.bv===G&&f.bv===G&&m.overlap&j){e.removeChain(a,m,f);for(let e=c;e<c+d;e++)i[e].edge_after=void 0;for(let e=u;e<u+p;e++)i[e].edge_before=void 0}l+=d-1}}function ep(e,t,i,r){for(let i of t.faces){for(let t of i)e.edges.add(t);void 0===r.find(e=>e.face===i)&&e.addFace(i.first,i.last)}}function em(e,t,i){if(0!==i.int_points1.length)for(let e=0;e<i.int_points1.length;e++){let t=i.int_points1[e],r=i.int_points2[e];if(void 0!==t.edge_before&&void 0===t.edge_after&&void 0===r.edge_before&&void 0!==r.edge_after&&(t.edge_before.next=r.edge_after,r.edge_after.prev=t.edge_before,t.edge_after=r.edge_after,r.edge_before=t.edge_before),void 0!==r.edge_before&&void 0===r.edge_after&&void 0===t.edge_before&&void 0!==t.edge_after&&(r.edge_before.next=t.edge_after,t.edge_after.prev=r.edge_before,r.edge_after=t.edge_after,t.edge_before=r.edge_before),void 0!==t.edge_before&&void 0===t.edge_after)for(let e of i.int_points1_sorted)e!==t&&void 0===e.edge_before&&void 0!==e.edge_after&&e.pt.equalTo(t.pt)&&(t.edge_before.next=e.edge_after,e.edge_after.prev=t.edge_before,t.edge_after=e.edge_after,e.edge_before=t.edge_before);if(void 0!==r.edge_before&&void 0===r.edge_after)for(let e of i.int_points2_sorted)e!==r&&void 0===e.edge_before&&void 0!==e.edge_after&&e.pt.equalTo(r.pt)&&(r.edge_before.next=e.edge_after,e.edge_after.prev=r.edge_before,r.edge_after=e.edge_after,e.edge_before=r.edge_before)}}function ef(e,t){for(let i of t)e.faces.delete(i.face),i.face=void 0,i.edge_before&&(i.edge_before.face=void 0),i.edge_after&&(i.edge_after.face=void 0)}function eg(e,t,i){for(let r of t){if(void 0===r.edge_before||void 0===r.edge_after||r.face||r.edge_after.face||r.edge_before.face)continue;let n=r.edge_after,o=r.edge_before;D.testInfiniteLoop(n);let a=e.addFace(n,o);for(let e of t)e.edge_before&&e.edge_after&&e.edge_before.face===a&&e.edge_after.face===a&&(e.face=a);for(let e of i)e.edge_before&&e.edge_after&&e.edge_before.face===a&&e.edge_after.face===a&&(e.face=a)}}function ey(e,t,i,r){for(let n of t){let t=n.first.bv;(i===J&&t===U||i===Q&&t===U&&r||i===Q&&t===N&&!r||i===Z&&t===N)&&e.deleteFace(n)}}var ex=Object.freeze({__proto__:null,BOOLEAN_INTERSECT:Z,BOOLEAN_SUBTRACT:Q,BOOLEAN_UNION:J,calculateIntersections:en,innerClip:ei,intersect:et,outerClip:er,removeNotRelevantChains:eu,removeOldFaces:ef,restoreFaces:eg,subtract:ee,unify:K});let ew=RegExp("T.F..FFF.|T.F...F.."),eb=RegExp("T........|.T.......|...T.....|....T...."),ev=RegExp("FT.......|F..T.....|F...T...."),eM=RegExp("T.F..F..."),eS=RegExp("T.F..F...|.TF..F...|..FT.F...|..F.TF...");class eP{constructor(){this.m=Array(9).fill(void 0)}get I2I(){return this.m[0]}set I2I(e){this.m[0]=e}get I2B(){return this.m[1]}set I2B(e){this.m[1]=e}get I2E(){return this.m[2]}set I2E(e){this.m[2]=e}get B2I(){return this.m[3]}set B2I(e){this.m[3]=e}get B2B(){return this.m[4]}set B2B(e){this.m[4]=e}get B2E(){return this.m[5]}set B2E(e){this.m[5]=e}get E2I(){return this.m[6]}set E2I(e){this.m[6]=e}get E2B(){return this.m[7]}set E2B(e){this.m[7]=e}get E2E(){return this.m[8]}set E2E(e){this.m[8]=e}toString(){return this.m.map(e=>e instanceof Array&&e.length>0?"T":e instanceof Array&&0===e.length?"F":"*").join("")}equal(){return ew.test(this.toString())}intersect(){return eb.test(this.toString())}touch(){return ev.test(this.toString())}inside(){return eM.test(this.toString())}covered(){return eS.test(this.toString())}}function eT(e,t){let i=[],[r,n,o]=e.standard,[a,s,l]=t.standard,h=r*s-n*a,c=o*s-n*l,d=r*l-o*a;if(!C.Utils.EQ_0(h)){let e,t;0===n?(e=o/r,t=d/h):0===s?(e=l/a,t=d/h):0===r?(e=c/h,t=o/n):0===a?(e=c/h,t=l/s):(e=c/h,t=d/h),i.push(new C.Point(e,t))}return i}function e_(e,t){let i=[],r=t.pc.projectionOn(e),n=t.pc.distanceTo(r)[0];if(C.Utils.EQ(n,t.r))i.push(r);else if(C.Utils.LT(n,t.r)){let o,a,s=Math.sqrt(t.r*t.r-n*n);o=e.norm.rotate90CCW().multiply(s),a=r.translate(o),i.push(a),o=e.norm.rotate90CW().multiply(s),a=r.translate(o),i.push(a)}return i}function eC(e,t){let i=[];for(let r of t.toSegments())for(let t of eA(r,e))eQ(t,i)||i.push(t);return i}function eD(e,t){let i=[];if(0===eC(e,t.box).length)return i;for(let r of e_(e,new C.Circle(t.pc,t.r)))r.on(t)&&i.push(r);return i}function eA(e,t){let i=[];return(e.ps.on(t)&&i.push(e.ps),e.pe.on(t)&&!e.isZeroLength()&&i.push(e.pe),i.length>0||e.isZeroLength()||e.ps.leftTo(t)&&e.pe.leftTo(t)||!e.ps.leftTo(t)&&!e.pe.leftTo(t))?i:eT(new C.Line(e.ps,e.pe),t)}function eE(e,t){let i=[];if(e.box.not_intersect(t.box))return i;if(e.isZeroLength())return e.ps.on(t)&&i.push(e.ps),i;if(t.isZeroLength())return t.ps.on(e)&&i.push(t.ps),i;let r=new C.Line(e.ps,e.pe),n=new C.Line(t.ps,t.pe);if(r.incidentTo(n))e.ps.on(t)&&i.push(e.ps),e.pe.on(t)&&i.push(e.pe),!t.ps.on(e)||t.ps.equalTo(e.ps)||t.ps.equalTo(e.pe)||i.push(t.ps),!t.pe.on(e)||t.pe.equalTo(e.ps)||t.pe.equalTo(e.pe)||i.push(t.pe);else{let o=eT(r,n);o.length>0&&o[0].on(e)&&o[0].on(t)&&i.push(o[0])}return i}function eL(e,t){let i=[];if(e.box.not_intersect(t.box))return i;if(e.isZeroLength()){let[r,n]=e.ps.distanceTo(t.pc);return C.Utils.EQ(r,t.r)&&i.push(e.ps),i}for(let r of e_(new C.Line(e.ps,e.pe),t))r.on(e)&&i.push(r);return i}function eI(e,t){let i=[];if(e.box.not_intersect(t.box))return i;if(e.isZeroLength())return e.ps.on(t)&&i.push(e.ps),i;for(let r of e_(new C.Line(e.ps,e.pe),new C.Circle(t.pc,t.r)))r.on(e)&&r.on(t)&&i.push(r);return i}function eR(e,t){let i=[];for(let r of t.toSegments())for(let t of eE(r,e))i.push(t);return i}function eW(e,t){let i,r=[];if(e.box.not_intersect(t.box))return r;let n=new C.Vector(e.pc,t.pc),o=e.r,a=t.r;if(C.Utils.EQ_0(o)||C.Utils.EQ_0(a))return r;if(C.Utils.EQ_0(n.x)&&C.Utils.EQ_0(n.y)&&C.Utils.EQ(o,a))return r.push(e.pc.translate(-o,0)),r;let s=e.pc.distanceTo(t.pc)[0];if(C.Utils.GT(s,o+a)||C.Utils.LT(s,Math.abs(o-a)))return r;if(n.x/=s,n.y/=s,C.Utils.EQ(s,o+a)||C.Utils.EQ(s,Math.abs(o-a)))return r.push(i=e.pc.translate(o*n.x,o*n.y)),r;let l=o*o/(2*s)-a*a/(2*s)+s/2,h=e.pc.translate(l*n.x,l*n.y),c=Math.sqrt(o*o-l*l);return r.push(i=h.translate(n.rotate90CCW().multiply(c))),r.push(i=h.translate(n.rotate90CW().multiply(c))),r}function eV(e,t){let i=[];for(let r of t.toSegments())for(let t of eL(r,e))i.push(t);return i}function ek(e,t){var i=[];if(e.box.not_intersect(t.box))return i;if(e.pc.equalTo(t.pc)&&C.Utils.EQ(e.r,t.r)){let r;return(r=e.start).on(t)&&i.push(r),(r=e.end).on(t)&&i.push(r),(r=t.start).on(e)&&i.push(r),(r=t.end).on(e)&&i.push(r),i}let r=new C.Circle(e.pc,e.r),n=new C.Circle(t.pc,t.r);for(let o of r.intersect(n))o.on(e)&&o.on(t)&&i.push(o);return i}function eB(e,t){let i=[];if(e.box.not_intersect(t.box))return i;if(t.pc.equalTo(e.pc)&&C.Utils.EQ(t.r,e.r))return i.push(e.start),i.push(e.end),i;for(let r of eW(t,new C.Circle(e.pc,e.r)))r.on(e)&&i.push(r);return i}function eO(e,t){let i=[];for(let r of t.toSegments())for(let t of eI(r,e))i.push(t);return i}function eF(e,t){return e.isSegment()?eE(e.shape,t):eI(t,e.shape)}function ez(e,t){return e.isSegment()?eI(e.shape,t):ek(e.shape,t)}function eU(e,t){return e.isSegment()?eA(e.shape,t):eD(t,e.shape)}function eN(e,t){return e.isSegment()?eL(e.shape,t):eB(e.shape,t)}function eG(e,t){let i=[];for(let r of t.edges)for(let t of eF(r,e))i.push(t);return i}function eH(e,t){let i=[];for(let r of t.edges)for(let t of ez(r,e))i.push(t);return i}function ej(e,t){let i=[];if(t.isEmpty())return i;for(let r of t.edges)for(let t of eU(r,e))eQ(t,i)||i.push(t);return e.sortPoints(i)}function eq(e,t){let i=[];if(t.isEmpty())return i;for(let r of t.edges)for(let t of eN(r,e))i.push(t);return i}function eX(e,t){let i=e.shape,r=t.shape;return e.isSegment()?t.isSegment()?eE(i,r):eI(i,r):t.isSegment()?eI(r,i):ek(i,r)}function eY(e,t){let i=[];if(t.isEmpty()||e.shape.box.not_intersect(t.box))return i;for(let r of t.edges.search(e.shape.box))for(let t of eX(e,r))i.push(t);return i}function eJ(e,t){let i=[];if(e.isEmpty()||t.isEmpty()||e.box.not_intersect(t.box))return i;for(let r of e.edges)for(let e of eY(r,t))i.push(e);return i}function eZ(e,t){return e instanceof C.Line?ej(e,t):e instanceof C.Segment?eG(e,t):e instanceof C.Arc?eH(e,t):[]}function eQ(e,t){return t.some(t=>t.equalTo(e))}let eK={stroke:"black"};class e${constructor(e=eK){for(let t in e)this[t]=e[t];this.stroke=e.stroke??eK.stroke}toAttributesString(){return Object.keys(this).reduce((e,t)=>e+(void 0!==this[t]?this.toAttrString(t,this[t]):""),"")}toAttrString(e,t){let i="className"===e?"class":this.convertCamelToKebabCase(e);return null===t?`${i} `:`${i}="${t.toString()}" `}convertCamelToKebabCase(e){return e.match(/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g).join("-").toLowerCase()}}function e0(e){return new e$(e).toAttributesString()}class e1 extends D{constructor(...e){if(super(),0===e.length)return;if(1==e.length&&e[0]instanceof Array){let t=e[0];if(0==t.length)return;for(let e of(t.every(e=>e instanceof C.Segment||e instanceof C.Arc||e instanceof C.Ray||e instanceof C.Line),t)){let t=new C.Edge(e);this.append(t)}}}get edges(){return[...this]}get box(){return this.edges.reduce((e,t)=>e=e.merge(t.box),new C.Box)}get vertices(){let e=this.edges.map(e=>e.start);return e.push(this.last.end),e}clone(){return new e1(this.toShapes())}addVertex(e,t){let i=t.shape.split(e);if(null===i[0])return t.prev;if(null===i[1])return t;let r=new C.Edge(i[0]),n=t.prev;return this.insert(r,n),t.shape=i[1],r}split(e){for(let t of e){let e=this.findEdgeByPoint(t);this.addVertex(t,e)}return this}findEdgeByPoint(e){let t;for(let i of this)if(i.shape.contains(e)){t=i;break}return t}translate(e){return new e1(this.edges.map(t=>t.shape.translate(e)))}rotate(e=0,t=new C.Point){return new e1(this.edges.map(i=>i.shape.rotate(e,t)))}transform(e=new C.Matrix){return new e1(this.edges.map(t=>t.shape.transform(e)))}toShapes(){return this.edges.map(e=>e.shape.clone())}toJSON(){return this.edges.map(e=>e.toJSON())}svg(e={}){let t=`
<path ${e0({fill:"none",...e})} d="`;for(let e of(t+=`
M${this.first.start.x},${this.first.start.y}`,this))t+=e.svg();return t+`" >
</path>`}}C.Multiline=e1;let e2=(...e)=>new C.Multiline(...e);function e4(e,t){let i=new C.Ray(t),r=new C.Line(i.pt,i.norm),n=new C.Box(i.box.xmin-C.DP_TOL,i.box.ymin-C.DP_TOL,i.box.xmax,i.box.ymax+C.DP_TOL);if(e.box.not_intersect(n))return C.OUTSIDE;let o=e.edges.search(n);if(0==o.length)return C.OUTSIDE;for(let e of o)if(e.shape.contains(t))return C.BOUNDARY;let l=[];for(let e of o)for(let r of i.intersect(e.shape)){if(r.equalTo(t))return C.BOUNDARY;l.push({pt:r,edge:e})}l.sort((e,t)=>P(e.pt.x,t.pt.x)?-1:S(e.pt.x,t.pt.x)?1:0);let h=0;for(let e=0;e<l.length;e++){let t=l[e];if(t.pt.equalTo(t.edge.shape.start)){if(e>0&&t.pt.equalTo(l[e-1].pt)&&t.edge.prev===l[e-1].edge)continue;let i=t.edge.prev;for(;v(i.length);)i=i.prev;let n=i.shape.tangentInEnd(),o=t.pt.translate(n),a=t.edge.shape.tangentInStart(),s=t.pt.translate(a),c=o.leftTo(r),d=s.leftTo(r);(c&&!d||!c&&d)&&h++}else if(t.pt.equalTo(t.edge.shape.end)){if(e>0&&t.pt.equalTo(l[e-1].pt)&&t.edge.next===l[e-1].edge)continue;let i=t.edge.next;for(;v(i.length);)i=i.next;let n=i.shape.tangentInStart(),o=t.pt.translate(n),a=t.edge.shape.tangentInEnd(),s=t.pt.translate(a),c=o.leftTo(r),d=s.leftTo(r);(c&&!d||!c&&d)&&h++}else if(t.edge.shape instanceof C.Segment)h++;else{let e=t.edge.shape.box;!(M(t.pt.y,e.ymin)||M(t.pt.y,e.ymax))&&h++}}return h%2==1?a:s}function e5(e,t){return te(e,t).intersect()}function e6(e,t){return te(e,t).touch()}function e9(e,t){return te(e,t).inside()}function e8(e,t){return te(e,t).covered()}function e7(e,t){return e8(t,e)}function te(e,t){if(e instanceof C.Line&&t instanceof C.Line)return tt(e,t);if(e instanceof C.Line&&t instanceof C.Circle)return ti(e,t);if(e instanceof C.Line&&t instanceof C.Box)return tr(e,t);if(e instanceof C.Line&&t instanceof C.Polygon)return tn(e,t);if((e instanceof C.Segment||e instanceof C.Arc)&&t instanceof C.Polygon)return to(e,t);if((e instanceof C.Segment||e instanceof C.Arc)&&(t instanceof C.Circle||t instanceof C.Box))return to(e,new C.Polygon(t));if(e instanceof C.Polygon&&t instanceof C.Polygon)return ta(e,t);else if((e instanceof C.Circle||e instanceof C.Box)&&(t instanceof C.Circle||t instanceof C.Box))return ta(new C.Polygon(e),new C.Polygon(t));else if((e instanceof C.Circle||e instanceof C.Box)&&t instanceof C.Polygon)return ta(new C.Polygon(e),t);else if(e instanceof C.Polygon&&(t instanceof C.Circle||t instanceof C.Box))return ta(e,new C.Polygon(t))}function tt(e,t){let i=new eP,r=eT(e,t);return 0===r.length?e.contains(t.pt)&&t.contains(e.pt)?(i.I2I=[e],i.I2E=[],i.E2I=[]):(i.I2I=[],i.I2E=[e],i.E2I=[t]):(i.I2I=r,i.I2E=e.split(r),i.E2I=t.split(r)),i}function ti(e,t){let i=new eP,r=e_(e,t);if(0===r.length)i.I2I=[],i.I2B=[],i.I2E=[e],i.E2I=[t];else if(1===r.length)i.I2I=[],i.I2B=r,i.I2E=e.split(r),i.E2I=[t];else{let n=new e1([e]),o=e.sortPoints(r);n.split(o);let a=n.toShapes();i.I2I=[a[1]],i.I2B=o,i.I2E=[a[0],a[2]],i.E2I=new C.Polygon([t.toArc()]).cut(n)}return i}function tr(e,t){let i=new eP,r=eC(e,t);if(0===r.length)i.I2I=[],i.I2B=[],i.I2E=[e],i.E2I=[t];else if(1===r.length)i.I2I=[],i.I2B=r,i.I2E=e.split(r),i.E2I=[t];else{let n=new e1([e]),o=e.sortPoints(r);n.split(o);let a=n.toShapes();t.toSegments().some(e=>e.contains(r[0])&&e.contains(r[1]))?(i.I2I=[],i.I2B=[a[1]],i.I2E=[a[0],a[2]],i.E2I=[t]):(i.I2I=[a[1]],i.I2B=o,i.I2E=[a[0],a[2]],i.E2I=new C.Polygon(t.toSegments()).cut(n))}return i}function tn(e,t){let i=new eP,r=ej(e,t),n=new e1([e]),o=r.length>0?r.slice():e.sortPoints(r);return n.split(o),[...n].forEach(e=>e.setInclusion(t)),i.I2I=[...n].filter(e=>e.bv===C.INSIDE).map(e=>e.shape),i.I2B=[...n].slice(1).map(e=>e.bv===C.BOUNDARY?e.shape:e.shape.start),i.I2E=[...n].filter(e=>e.bv===C.OUTSIDE).map(e=>e.shape),i.E2I=t.cut(n),i}function to(e,t){let i=new eP,r=eZ(e,t),n=r.length>0?r.slice():e.sortPoints(r),o=new e1([e]);for(let r of(o.split(n),[...o].forEach(e=>e.setInclusion(t)),i.I2I=[...o].filter(e=>e.bv===C.INSIDE).map(e=>e.shape),i.I2B=[...o].slice(1).map(e=>e.bv===C.BOUNDARY?e.shape:e.shape.start),i.I2E=[...o].filter(e=>e.bv===C.OUTSIDE).map(e=>e.shape),i.B2I=[],i.B2B=[],i.B2E=[],[e.start,e.end]))switch(e4(t,r)){case C.INSIDE:i.B2I.push(r);break;case C.BOUNDARY:i.B2B.push(r);break;case C.OUTSIDE:i.B2E.push(r)}return i}function ta(e,t){let i=new eP,[r,n]=en(e,t),o=et(e,t),a=ee(e,t),s=ee(t,e),[l,h]=ei(e,t),c=er(e,t),d=er(t,e);return i.I2I=o.isEmpty()?[]:[o],i.I2B=h,i.I2E=a.isEmpty()?[]:[a],i.B2I=l,i.B2B=r,i.B2E=c,i.E2I=s.isEmpty()?[]:[s],i.E2B=d,i}C.multiline=e2;var ts=Object.freeze({__proto__:null,contain:function(e,t){return e9(t,e)},cover:e7,covered:e8,disjoint:function(e,t){return!e5(e,t)},equal:function(e,t){return te(e,t).equal()},inside:e9,intersect:e5,relate:te,touch:e6});class tl{constructor(e=1,t=0,i=0,r=1,n=0,o=0){this.a=e,this.b=t,this.c=i,this.d=r,this.tx=n,this.ty=o}clone(){return new tl(this.a,this.b,this.c,this.d,this.tx,this.ty)}transform(e){return[e[0]*this.a+e[1]*this.c+this.tx,e[0]*this.b+e[1]*this.d+this.ty]}multiply(e){return new tl(this.a*e.a+this.c*e.b,this.b*e.a+this.d*e.b,this.a*e.c+this.c*e.d,this.b*e.c+this.d*e.d,this.a*e.tx+this.c*e.ty+this.tx,this.b*e.tx+this.d*e.ty+this.ty)}translate(...e){let t,i;if(1==e.length&&e[0]instanceof C.Vector)t=e[0].x,i=e[0].y;else if(2==e.length&&"number"==typeof e[0]&&"number"==typeof e[1])t=e[0],i=e[1];else throw C.Errors.ILLEGAL_PARAMETERS;return this.multiply(new tl(1,0,0,1,t,i))}rotate(e){let t=Math.cos(e),i=Math.sin(e);return this.multiply(new tl(t,i,-i,t,0,0))}scale(e,t){return this.multiply(new tl(e,0,0,t,0,0))}equalTo(e){return!!(C.Utils.EQ(this.tx,e.tx)&&C.Utils.EQ(this.ty,e.ty)&&C.Utils.EQ(this.a,e.a)&&C.Utils.EQ(this.b,e.b)&&C.Utils.EQ(this.c,e.c)&&C.Utils.EQ(this.d,e.d))}}C.Matrix=tl;let th=(...e)=>new C.Matrix(...e);C.matrix=th;let tc=class e{constructor(e,t){this.low=e,this.high=t}clone(){return new e(this.low,this.high)}get max(){return this.clone()}less_than(e){return this.low<e.low||this.low==e.low&&this.high<e.high}equal_to(e){return this.low==e.low&&this.high==e.high}intersect(e){return!this.not_intersect(e)}not_intersect(e){return this.high<e.low||e.high<this.low}merge(t){return new e(void 0===this.low?t.low:Math.min(this.low,t.low),void 0===this.high?t.high:Math.max(this.high,t.high))}output(){return[this.low,this.high]}static comparable_max(e,t){return e.merge(t)}static comparable_less_than(e,t){return e<t}},td=0,tu=1;class tp{constructor(e,t,i=null,r=null,n=null,o=tu){this.left=i,this.right=r,this.parent=n,this.color=o,this.item={key:e,value:t},e&&e instanceof Array&&2==e.length&&!Number.isNaN(e[0])&&!Number.isNaN(e[1])&&(this.item.key=new tc(Math.min(e[0],e[1]),Math.max(e[0],e[1]))),this.max=this.item.key?this.item.key.max:void 0}isNil(){return void 0===this.item.key&&void 0===this.item.value&&null===this.left&&null===this.right&&this.color===tu}less_than(e){if(this.item.value===this.item.key&&e.item.value===e.item.key)return this.item.key.less_than(e.item.key);{let t=this.item.value&&e.item.value&&this.item.value.less_than?this.item.value.less_than(e.item.value):this.item.value<e.item.value;return this.item.key.less_than(e.item.key)||this.item.key.equal_to(e.item.key)&&t}}equal_to(e){if(this.item.value===this.item.key&&e.item.value===e.item.key)return this.item.key.equal_to(e.item.key);{let t=this.item.value&&e.item.value&&this.item.value.equal_to?this.item.value.equal_to(e.item.value):this.item.value==e.item.value;return this.item.key.equal_to(e.item.key)&&t}}intersect(e){return this.item.key.intersect(e.item.key)}copy_data(e){this.item.key=e.item.key,this.item.value=e.item.value}update_max(){if(this.max=this.item.key?this.item.key.max:void 0,this.right&&this.right.max){let e=this.item.key.constructor.comparable_max;this.max=e(this.max,this.right.max)}if(this.left&&this.left.max){let e=this.item.key.constructor.comparable_max;this.max=e(this.max,this.left.max)}}not_intersect_left_subtree(e){let t=this.item.key.constructor.comparable_less_than;return t(void 0!==this.left.max.high?this.left.max.high:this.left.max,e.item.key.low)}not_intersect_right_subtree(e){let t=this.item.key.constructor.comparable_less_than,i=void 0!==this.right.max.low?this.right.max.low:this.right.item.key.low;return t(e.item.key.high,i)}}class tm{constructor(){this.root=null,this.nil_node=new tp}get size(){let e=0;return this.tree_walk(this.root,()=>e++),e}get keys(){let e=[];return this.tree_walk(this.root,t=>e.push(t.item.key.output?t.item.key.output():t.item.key)),e}get values(){let e=[];return this.tree_walk(this.root,t=>e.push(t.item.value)),e}get items(){let e=[];return this.tree_walk(this.root,t=>e.push({key:t.item.key.output?t.item.key.output():t.item.key,value:t.item.value})),e}isEmpty(){return null==this.root||this.root==this.nil_node}clear(){this.root=null}insert(e,t=e){if(void 0===e)return;let i=new tp(e,t,this.nil_node,this.nil_node,null,td);return this.tree_insert(i),this.recalc_max(i),i}exist(e,t=e){let i=new tp(e,t);return!!this.tree_search(this.root,i)}remove(e,t=e){let i=new tp(e,t),r=this.tree_search(this.root,i);return r&&this.tree_delete(r),r}search(e,t=(e,t)=>e===t?t.output():e){let i=new tp(e),r=[];return this.tree_search_interval(this.root,i,r),r.map(e=>t(e.item.value,e.item.key))}intersect_any(e){let t=new tp(e);return this.tree_find_any_interval(this.root,t)}forEach(e){this.tree_walk(this.root,t=>e(t.item.key,t.item.value))}map(e){let t=new tm;return this.tree_walk(this.root,i=>t.insert(i.item.key,e(i.item.value,i.item.key))),t}recalc_max(e){let t=e;for(;null!=t.parent;)t.parent.update_max(),t=t.parent}tree_insert(e){let t=this.root,i=null;if(null==this.root||this.root==this.nil_node)this.root=e;else{for(;t!=this.nil_node;)i=t,t=e.less_than(t)?t.left:t.right;e.parent=i,e.less_than(i)?i.left=e:i.right=e}this.insert_fixup(e)}insert_fixup(e){let t,i;for(t=e;t!=this.root&&t.parent.color==td;)t.parent==t.parent.parent.left?(i=t.parent.parent.right).color==td?(t.parent.color=tu,i.color=tu,t.parent.parent.color=td,t=t.parent.parent):(t==t.parent.right&&(t=t.parent,this.rotate_left(t)),t.parent.color=tu,t.parent.parent.color=td,this.rotate_right(t.parent.parent)):(i=t.parent.parent.left).color==td?(t.parent.color=tu,i.color=tu,t.parent.parent.color=td,t=t.parent.parent):(t==t.parent.left&&(t=t.parent,this.rotate_right(t)),t.parent.color=tu,t.parent.parent.color=td,this.rotate_left(t.parent.parent));this.root.color=tu}tree_delete(e){let t,i;(i=(t=e.left==this.nil_node||e.right==this.nil_node?e:this.tree_successor(e)).left!=this.nil_node?t.left:t.right).parent=t.parent,t==this.root?this.root=i:(t==t.parent.left?t.parent.left=i:t.parent.right=i,t.parent.update_max()),this.recalc_max(i),t!=e&&(e.copy_data(t),e.update_max(),this.recalc_max(e)),t.color==tu&&this.delete_fixup(i)}delete_fixup(e){let t,i=e;for(;i!=this.root&&null!=i.parent&&i.color==tu;)i==i.parent.left?((t=i.parent.right).color==td&&(t.color=tu,i.parent.color=td,this.rotate_left(i.parent),t=i.parent.right),t.left.color==tu&&t.right.color==tu?(t.color=td,i=i.parent):(t.right.color==tu&&(t.color=td,t.left.color=tu,this.rotate_right(t),t=i.parent.right),t.color=i.parent.color,i.parent.color=tu,t.right.color=tu,this.rotate_left(i.parent),i=this.root)):((t=i.parent.left).color==td&&(t.color=tu,i.parent.color=td,this.rotate_right(i.parent),t=i.parent.left),t.left.color==tu&&t.right.color==tu?(t.color=td,i=i.parent):(t.left.color==tu&&(t.color=td,t.right.color=tu,this.rotate_left(t),t=i.parent.left),t.color=i.parent.color,i.parent.color=tu,t.left.color=tu,this.rotate_right(i.parent),i=this.root));i.color=tu}tree_search(e,t){if(null!=e&&e!=this.nil_node)return t.equal_to(e)?e:t.less_than(e)?this.tree_search(e.left,t):this.tree_search(e.right,t)}tree_search_interval(e,t,i){null==e||e==this.nil_node||(e.left==this.nil_node||e.not_intersect_left_subtree(t)||this.tree_search_interval(e.left,t,i),e.intersect(t)&&i.push(e),e.right==this.nil_node||e.not_intersect_right_subtree(t)||this.tree_search_interval(e.right,t,i))}tree_find_any_interval(e,t){let i=!1;return null==e||e==this.nil_node||(e.left==this.nil_node||e.not_intersect_left_subtree(t)||(i=this.tree_find_any_interval(e.left,t)),i||(i=e.intersect(t)),i||e.right==this.nil_node||e.not_intersect_right_subtree(t)||(i=this.tree_find_any_interval(e.right,t))),i}local_minimum(e){let t=e;for(;null!=t.left&&t.left!=this.nil_node;)t=t.left;return t}local_maximum(e){let t=e;for(;null!=t.right&&t.right!=this.nil_node;)t=t.right;return t}tree_successor(e){let t,i,r;if(e.right!=this.nil_node)t=this.local_minimum(e.right);else{for(i=e,r=e.parent;null!=r&&r.right==i;)i=r,r=r.parent;t=r}return t}rotate_left(e){let t=e.right;e.right=t.left,t.left!=this.nil_node&&(t.left.parent=e),t.parent=e.parent,e==this.root?this.root=t:e==e.parent.left?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t,null!=e&&e!=this.nil_node&&e.update_max(),null!=(t=e.parent)&&t!=this.nil_node&&t.update_max()}rotate_right(e){let t=e.left;e.left=t.right,t.right!=this.nil_node&&(t.right.parent=e),t.parent=e.parent,e==this.root?this.root=t:e==e.parent.left?e.parent.left=t:e.parent.right=t,t.right=e,e.parent=t,null!=e&&e!=this.nil_node&&e.update_max(),null!=(t=e.parent)&&t!=this.nil_node&&t.update_max()}tree_walk(e,t){null!=e&&e!=this.nil_node&&(this.tree_walk(e.left,t),t(e),this.tree_walk(e.right,t))}testRedBlackProperty(){let e=!0;return this.tree_walk(this.root,function(t){t.color!=td||t.left.color==tu&&t.right.color==tu||(e=!1)}),e}testBlackHeightProperty(e){let t=0,i=0,r=0;if(e.color==tu&&t++,(i=e.left!=this.nil_node?this.testBlackHeightProperty(e.left):1)!=(r=e.right!=this.nil_node?this.testBlackHeightProperty(e.right):1))throw Error("Red-black height property violated");return t+i}}class tf extends Set{constructor(e){super(e),this.index=new tm,this.forEach(e=>this.index.insert(e))}add(e){let t=this.size;return super.add(e),this.size>t&&this.index.insert(e.box,e),this}delete(e){let t=super.delete(e);return t&&this.index.remove(e.box,e),t}clear(){super.clear(),this.index=new tm}search(e){return this.index.search(e)}hit(e){let t=new C.Box(e.x-1,e.y-1,e.x+1,e.y+1);return this.index.search(t).filter(t=>e.on(t))}svg(){return[...this].reduce((e,t)=>e+t.svg(),"")}}C.PlanarSet=tf;let tg=class e{constructor(...e){if(this.x=0,this.y=0,0===e.length)return;if(1===e.length&&e[0]instanceof Array&&2===e[0].length){let t=e[0];if("number"==typeof t[0]&&"number"==typeof t[1]){this.x=t[0],this.y=t[1];return}}if(1===e.length&&e[0]instanceof Object&&"point"===e[0].name){let{x:t,y:i}=e[0];this.x=t,this.y=i;return}if(2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]){this.x=e[0],this.y=e[1];return}throw C.Errors.ILLEGAL_PARAMETERS}get box(){return new C.Box(this.x,this.y,this.x,this.y)}clone(){return new C.Point(this.x,this.y)}get vertices(){return[this.clone()]}equalTo(e){return C.Utils.EQ(this.x,e.x)&&C.Utils.EQ(this.y,e.y)}lessThan(e){return!!(C.Utils.LT(this.y,e.y)||C.Utils.EQ(this.y,e.y)&&C.Utils.LT(this.x,e.x))}rotate(e,t={x:0,y:0}){var i=t.x+(this.x-t.x)*Math.cos(e)-(this.y-t.y)*Math.sin(e),r=t.y+(this.x-t.x)*Math.sin(e)+(this.y-t.y)*Math.cos(e);return new C.Point(i,r)}translate(...e){if(1==e.length&&(e[0]instanceof C.Vector||!isNaN(e[0].x)&&!isNaN(e[0].y)))return new C.Point(this.x+e[0].x,this.y+e[0].y);if(2==e.length&&"number"==typeof e[0]&&"number"==typeof e[1])return new C.Point(this.x+e[0],this.y+e[1]);throw C.Errors.ILLEGAL_PARAMETERS}transform(e){return new C.Point(e.transform([this.x,this.y]))}projectionOn(e){if(this.equalTo(e.pt))return this.clone();let t=new C.Vector(this,e.pt);if(C.Utils.EQ_0(t.cross(e.norm)))return e.pt.clone();let i=t.dot(e.norm),r=e.norm.multiply(i);return this.translate(r)}leftTo(e){let t=new C.Vector(e.pt,this);return C.Utils.GT(t.dot(e.norm),0)}distanceTo(t){if(t instanceof e){let e=t.x-this.x,i=t.y-this.y;return[Math.sqrt(e*e+i*i),new C.Segment(this,t)]}return t instanceof C.Line?C.Distance.point2line(this,t):t instanceof C.Circle?C.Distance.point2circle(this,t):t instanceof C.Segment?C.Distance.point2segment(this,t):t instanceof C.Arc?C.Distance.point2arc(this,t):t instanceof C.Polygon?C.Distance.point2polygon(this,t):t instanceof C.PlanarSet?C.Distance.shape2planarSet(this,t):void 0}on(e){return e instanceof C.Point?this.equalTo(e):e instanceof C.Line||e instanceof C.Circle||e instanceof C.Segment||e instanceof C.Arc||e instanceof C.Polygon?e.contains(this):void 0}toJSON(){return Object.assign({},this,{name:"point"})}svg(e={}){let t=e.r??3;return`
<circle cx="${this.x}" cy="${this.y}" r="${t}"
            ${e0({fill:"red",...e})} />`}};C.Point=tg;let ty=(...e)=>new C.Point(...e);C.point=ty;let tx=class{constructor(...e){if(this.x=0,this.y=0,0===e.length)return;if(1===e.length&&e[0]instanceof Array&&2===e[0].length){let t=e[0];if("number"==typeof t[0]&&"number"==typeof t[1]){this.x=t[0],this.y=t[1];return}}if(1===e.length&&e[0]instanceof Object&&"vector"===e[0].name){let{x:t,y:i}=e[0];this.x=t,this.y=i;return}if(2===e.length){let t=e[0],i=e[1];if("number"==typeof t&&"number"==typeof i){this.x=t,this.y=i;return}if(t instanceof C.Point&&i instanceof C.Point){this.x=i.x-t.x,this.y=i.y-t.y;return}}throw C.Errors.ILLEGAL_PARAMETERS}clone(){return new C.Vector(this.x,this.y)}get slope(){let e=Math.atan2(this.y,this.x);return e<0&&(e=2*Math.PI+e),e}get length(){return Math.sqrt(this.dot(this))}equalTo(e){return C.Utils.EQ(this.x,e.x)&&C.Utils.EQ(this.y,e.y)}multiply(e){return new C.Vector(e*this.x,e*this.y)}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}normalize(){if(!C.Utils.EQ_0(this.length))return new C.Vector(this.x/this.length,this.y/this.length);throw C.Errors.ZERO_DIVISION}rotate(e){let t=new C.Point(this.x,this.y).rotate(e);return new C.Vector(t.x,t.y)}rotate90CCW(){return new C.Vector(-this.y,this.x)}rotate90CW(){return new C.Vector(this.y,-this.x)}invert(){return new C.Vector(-this.x,-this.y)}add(e){return new C.Vector(this.x+e.x,this.y+e.y)}subtract(e){return new C.Vector(this.x-e.x,this.y-e.y)}angleTo(e){let t=this.normalize(),i=e.normalize(),r=Math.atan2(t.cross(i),t.dot(i));return r<0&&(r+=2*Math.PI),r}projectionOn(e){let t=e.normalize(),i=this.dot(t);return t.multiply(i)}toJSON(){return Object.assign({},this,{name:"vector"})}};C.Vector=tx;let tw=(...e)=>new C.Vector(...e);C.vector=tw;class tb{constructor(...e){if(this.ps=new C.Point,this.pe=new C.Point,0===e.length)return;if(1===e.length&&e[0]instanceof Array&&4===e[0].length){let t=e[0];this.ps=new C.Point(t[0],t[1]),this.pe=new C.Point(t[2],t[3]);return}if(1===e.length&&e[0]instanceof Object&&"segment"===e[0].name){let{ps:t,pe:i}=e[0];this.ps=new C.Point(t.x,t.y),this.pe=new C.Point(i.x,i.y);return}if(1===e.length&&e[0]instanceof C.Point){this.ps=e[0].clone();return}if(2===e.length&&e[0]instanceof C.Point&&e[1]instanceof C.Point){this.ps=e[0].clone(),this.pe=e[1].clone();return}if(4===e.length){this.ps=new C.Point(e[0],e[1]),this.pe=new C.Point(e[2],e[3]);return}throw C.Errors.ILLEGAL_PARAMETERS}clone(){return new C.Segment(this.start,this.end)}get start(){return this.ps}get end(){return this.pe}get vertices(){return[this.ps.clone(),this.pe.clone()]}get length(){return this.start.distanceTo(this.end)[0]}get slope(){return new C.Vector(this.start,this.end).slope}get box(){return new C.Box(Math.min(this.start.x,this.end.x),Math.min(this.start.y,this.end.y),Math.max(this.start.x,this.end.x),Math.max(this.start.y,this.end.y))}equalTo(e){return this.ps.equalTo(e.ps)&&this.pe.equalTo(e.pe)}contains(e){return C.Utils.EQ_0(this.distanceToPoint(e))}intersect(e){return e instanceof C.Point?this.contains(e)?[e]:[]:e instanceof C.Line?eA(this,e):e instanceof C.Segment?eE(this,e):e instanceof C.Circle?eL(this,e):e instanceof C.Box?eR(this,e):e instanceof C.Arc?eI(this,e):e instanceof C.Polygon?eG(this,e):void 0}distanceTo(e){if(e instanceof C.Point){let[t,i]=C.Distance.point2segment(e,this);return[t,i=i.reverse()]}if(e instanceof C.Circle){let[t,i]=C.Distance.segment2circle(this,e);return[t,i]}if(e instanceof C.Line){let[t,i]=C.Distance.segment2line(this,e);return[t,i]}if(e instanceof C.Segment){let[t,i]=C.Distance.segment2segment(this,e);return[t,i]}if(e instanceof C.Arc){let[t,i]=C.Distance.segment2arc(this,e);return[t,i]}if(e instanceof C.Polygon){let[t,i]=C.Distance.shape2polygon(this,e);return[t,i]}if(e instanceof C.PlanarSet){let[t,i]=C.Distance.shape2planarSet(this,e);return[t,i]}}tangentInStart(){return new C.Vector(this.start,this.end).normalize()}tangentInEnd(){return new C.Vector(this.end,this.start).normalize()}reverse(){return new tb(this.end,this.start)}split(e){return this.start.equalTo(e)?[null,this.clone()]:this.end.equalTo(e)?[this.clone(),null]:[new C.Segment(this.start,e),new C.Segment(e,this.end)]}middle(){return new C.Point((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)}pointAtLength(e){if(e>this.length||e<0)return null;if(0==e)return this.start;if(e==this.length)return this.end;let t=e/this.length;return new C.Point((this.end.x-this.start.x)*t+this.start.x,(this.end.y-this.start.y)*t+this.start.y)}distanceToPoint(e){let[t,...i]=C.Distance.point2segment(e,this);return t}definiteIntegral(e=0){return(this.end.x-this.start.x)*(this.start.y-e+(this.end.y-e))/2}translate(...e){return new tb(this.ps.translate(...e),this.pe.translate(...e))}rotate(e=0,t=new C.Point){let i=new C.Matrix;return i=i.translate(t.x,t.y).rotate(e).translate(-t.x,-t.y),this.transform(i)}transform(e=new C.Matrix){return new tb(this.ps.transform(e),this.pe.transform(e))}isZeroLength(){return this.ps.equalTo(this.pe)}sortPoints(e){return new C.Line(this.start,this.end).sortPoints(e)}toJSON(){return Object.assign({},this,{name:"segment"})}svg(e={}){return`
<line x1="${this.start.x}" y1="${this.start.y}" x2="${this.end.x}" y2="${this.end.y}" ${e0(e)} />`}}C.Segment=tb;let tv=(...e)=>new C.Segment(...e);C.segment=tv;let{vector:tM}=C,tS=class e{constructor(...t){if(this.pt=new C.Point,this.norm=new C.Vector(0,1),0==t.length)return;if(1==t.length&&t[0]instanceof Object&&"line"===t[0].name){let{pt:e,norm:i}=t[0];this.pt=new C.Point(e),this.norm=new C.Vector(i);return}if(2==t.length){let i=t[0],r=t[1];if(i instanceof C.Point&&r instanceof C.Point){this.pt=i,this.norm=e.points2norm(i,r),this.norm.dot(tM(this.pt.x,this.pt.y))>=0&&this.norm.invert();return}if(i instanceof C.Point&&r instanceof C.Vector){if(C.Utils.EQ_0(r.x)&&C.Utils.EQ_0(r.y))throw C.Errors.ILLEGAL_PARAMETERS;this.pt=i.clone(),this.norm=r.clone(),this.norm=this.norm.normalize(),this.norm.dot(tM(this.pt.x,this.pt.y))>=0&&this.norm.invert();return}if(i instanceof C.Vector&&r instanceof C.Point){if(C.Utils.EQ_0(i.x)&&C.Utils.EQ_0(i.y))throw C.Errors.ILLEGAL_PARAMETERS;this.pt=r.clone(),this.norm=i.clone(),this.norm=this.norm.normalize(),this.norm.dot(tM(this.pt.x,this.pt.y))>=0&&this.norm.invert();return}}throw C.Errors.ILLEGAL_PARAMETERS}clone(){return new C.Line(this.pt,this.norm)}get start(){}get end(){}get length(){return Number.POSITIVE_INFINITY}get box(){return new C.Box(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY)}get middle(){}get slope(){return new C.Vector(this.norm.y,-this.norm.x).slope}get standard(){return[this.norm.x,this.norm.y,this.norm.dot(this.pt)]}parallelTo(e){return C.Utils.EQ_0(this.norm.cross(e.norm))}incidentTo(e){return this.parallelTo(e)&&this.pt.on(e)}contains(e){if(this.pt.equalTo(e))return!0;let t=new C.Vector(this.pt,e);return C.Utils.EQ_0(this.norm.dot(t))}coord(e){return tM(e.x,e.y).cross(this.norm)}intersect(e){return e instanceof C.Point?this.contains(e)?[e]:[]:e instanceof C.Line?eT(this,e):e instanceof C.Circle?e_(this,e):e instanceof C.Box?eC(this,e):e instanceof C.Segment?eA(e,this):e instanceof C.Arc?eD(this,e):e instanceof C.Polygon?ej(this,e):void 0}distanceTo(e){if(e instanceof C.Point){let[t,i]=C.Distance.point2line(e,this);return[t,i=i.reverse()]}if(e instanceof C.Circle){let[t,i]=C.Distance.circle2line(e,this);return[t,i=i.reverse()]}if(e instanceof C.Segment){let[t,i]=C.Distance.segment2line(e,this);return[t,i.reverse()]}if(e instanceof C.Arc){let[t,i]=C.Distance.arc2line(e,this);return[t,i.reverse()]}if(e instanceof C.Polygon){let[t,i]=C.Distance.shape2polygon(this,e);return[t,i]}}split(e){if(e instanceof C.Point)return[new C.Ray(e,this.norm.invert()),new C.Ray(e,this.norm)];{let t=new C.Multiline([this]),i=this.sortPoints(e);return t.split(i),t.toShapes()}}sortPoints(e){return e.slice().sort((e,t)=>this.coord(e)<this.coord(t)?-1:this.coord(e)>this.coord(t)?1:0)}toJSON(){return Object.assign({},this,{name:"line"})}svg(e,t={}){let i=eC(this,e);if(0===i.length)return"";let r=i[0],n=2==i.length?i[1]:i.find(e=>!e.equalTo(r));return void 0===n&&(n=r),new C.Segment(r,n).svg(t)}static points2norm(e,t){if(e.equalTo(t))throw C.Errors.ILLEGAL_PARAMETERS;return new C.Vector(e,t).normalize().rotate90CCW()}};C.Line=tS;let tP=(...e)=>new C.Line(...e);C.line=tP;let tT=class{constructor(...e){if(this.pc=new C.Point,this.r=1,1==e.length&&e[0]instanceof Object&&"circle"===e[0].name){let{pc:t,r:i}=e[0];this.pc=new C.Point(t),this.r=i;return}{let[t,i]=[...e];t&&t instanceof C.Point&&(this.pc=t.clone()),void 0!==i&&(this.r=i);return}}clone(){return new C.Circle(this.pc.clone(),this.r)}get center(){return this.pc}get box(){return new C.Box(this.pc.x-this.r,this.pc.y-this.r,this.pc.x+this.r,this.pc.y+this.r)}contains(e){return e instanceof C.Point?C.Utils.LE(e.distanceTo(this.center)[0],this.r):e instanceof C.Segment?C.Utils.LE(e.start.distanceTo(this.center)[0],this.r)&&C.Utils.LE(e.end.distanceTo(this.center)[0],this.r):e instanceof C.Arc?0===this.intersect(e).length&&C.Utils.LE(e.start.distanceTo(this.center)[0],this.r)&&C.Utils.LE(e.end.distanceTo(this.center)[0],this.r):e instanceof C.Circle?0===this.intersect(e).length&&C.Utils.LE(e.r,this.r)&&C.Utils.LE(e.center.distanceTo(this.center)[0],this.r):void 0}toArc(e=!0){return new C.Arc(this.center,this.r,Math.PI,-Math.PI,e)}intersect(e){return e instanceof C.Point?this.contains(e)?[e]:[]:e instanceof C.Line?e_(e,this):e instanceof C.Segment?eL(e,this):e instanceof C.Circle?eW(e,this):e instanceof C.Box?eV(this,e):e instanceof C.Arc?eB(e,this):e instanceof C.Polygon?eq(this,e):void 0}distanceTo(e){if(e instanceof C.Point){let[t,i]=C.Distance.point2circle(e,this);return[t,i=i.reverse()]}if(e instanceof C.Circle){let[t,i]=C.Distance.circle2circle(this,e);return[t,i]}if(e instanceof C.Line){let[t,i]=C.Distance.circle2line(this,e);return[t,i]}if(e instanceof C.Segment){let[t,i]=C.Distance.segment2circle(e,this);return[t,i=i.reverse()]}if(e instanceof C.Arc){let[t,i]=C.Distance.arc2circle(e,this);return[t,i=i.reverse()]}if(e instanceof C.Polygon){let[t,i]=C.Distance.shape2polygon(this,e);return[t,i]}if(e instanceof C.PlanarSet){let[t,i]=C.Distance.shape2planarSet(this,e);return[t,i]}}toJSON(){return Object.assign({},this,{name:"circle"})}svg(e={}){return`
<circle cx="${this.pc.x}" cy="${this.pc.y}" r="${this.r}"
                ${e0({fill:"none",...e})} />`}};C.Circle=tT;let t_=(...e)=>new C.Circle(...e);C.circle=t_;class tC{constructor(...e){if(this.pc=new C.Point,this.r=1,this.startAngle=0,this.endAngle=2*Math.PI,this.counterClockwise=C.CCW,0==e.length)return;if(1==e.length&&e[0]instanceof Object&&"arc"===e[0].name){let{pc:t,r:i,startAngle:r,endAngle:n,counterClockwise:o}=e[0];this.pc=new C.Point(t.x,t.y),this.r=i,this.startAngle=r,this.endAngle=n,this.counterClockwise=o;return}{let[t,i,r,n,o]=[...e];t&&t instanceof C.Point&&(this.pc=t.clone()),void 0!==i&&(this.r=i),void 0!==r&&(this.startAngle=r),void 0!==n&&(this.endAngle=n),void 0!==o&&(this.counterClockwise=o);return}}clone(){return new C.Arc(this.pc.clone(),this.r,this.startAngle,this.endAngle,this.counterClockwise)}get sweep(){let e;return C.Utils.EQ(this.startAngle,this.endAngle)?0:C.Utils.EQ(Math.abs(this.startAngle-this.endAngle),C.PIx2)?C.PIx2:(e=this.counterClockwise?C.Utils.GT(this.endAngle,this.startAngle)?this.endAngle-this.startAngle:this.endAngle-this.startAngle+C.PIx2:C.Utils.GT(this.startAngle,this.endAngle)?this.startAngle-this.endAngle:this.startAngle-this.endAngle+C.PIx2,C.Utils.GT(e,C.PIx2)&&(e-=C.PIx2),C.Utils.LT(e,0)&&(e+=C.PIx2),e)}get start(){return new C.Point(this.pc.x+this.r,this.pc.y).rotate(this.startAngle,this.pc)}get end(){return new C.Point(this.pc.x+this.r,this.pc.y).rotate(this.endAngle,this.pc)}get center(){return this.pc.clone()}get vertices(){return[this.start.clone(),this.end.clone()]}get length(){return Math.abs(this.sweep*this.r)}get box(){return this.breakToFunctional().reduce((e,t)=>e.merge(t.start.box),new C.Box).merge(this.end.box)}contains(e){if(!C.Utils.EQ(this.pc.distanceTo(e)[0],this.r))return!1;if(e.equalTo(this.start))return!0;let t=new C.Vector(this.pc,e).slope,i=new C.Arc(this.pc,this.r,this.startAngle,t,this.counterClockwise);return C.Utils.LE(i.length,this.length)}split(e){if(this.start.equalTo(e))return[null,this.clone()];if(this.end.equalTo(e))return[this.clone(),null];let t=new C.Vector(this.pc,e).slope;return[new C.Arc(this.pc,this.r,this.startAngle,t,this.counterClockwise),new C.Arc(this.pc,this.r,t,this.endAngle,this.counterClockwise)]}middle(){let e=this.counterClockwise?this.startAngle+this.sweep/2:this.startAngle-this.sweep/2;return new C.Arc(this.pc,this.r,this.startAngle,e,this.counterClockwise).end}pointAtLength(e){if(e>this.length||e<0)return null;if(0==e)return this.start;if(e==this.length)return this.end;let t=e/this.length,i=this.counterClockwise?this.startAngle+this.sweep*t:this.startAngle-this.sweep*t;return new C.Arc(this.pc,this.r,this.startAngle,i,this.counterClockwise).end}chordHeight(){return(1-Math.cos(Math.abs(this.sweep/2)))*this.r}intersect(e){return e instanceof C.Point?this.contains(e)?[e]:[]:e instanceof C.Line?eD(e,this):e instanceof C.Circle?eB(this,e):e instanceof C.Segment?eI(e,this):e instanceof C.Box?eO(this,e):e instanceof C.Arc?ek(this,e):e instanceof C.Polygon?eH(this,e):void 0}distanceTo(e){if(e instanceof C.Point){let[t,i]=C.Distance.point2arc(e,this);return[t,i=i.reverse()]}if(e instanceof C.Circle){let[t,i]=C.Distance.arc2circle(this,e);return[t,i]}if(e instanceof C.Line){let[t,i]=C.Distance.arc2line(this,e);return[t,i]}if(e instanceof C.Segment){let[t,i]=C.Distance.segment2arc(e,this);return[t,i=i.reverse()]}if(e instanceof C.Arc){let[t,i]=C.Distance.arc2arc(this,e);return[t,i]}if(e instanceof C.Polygon){let[t,i]=C.Distance.shape2polygon(this,e);return[t,i]}if(e instanceof C.PlanarSet){let[t,i]=C.Distance.shape2planarSet(this,e);return[t,i]}}breakToFunctional(){let e=[],t=[0,Math.PI/2,2*Math.PI/2,3*Math.PI/2],i=[this.pc.translate(this.r,0),this.pc.translate(0,this.r),this.pc.translate(-this.r,0),this.pc.translate(0,-this.r)],r=[];for(let e=0;e<4;e++)i[e].on(this)&&r.push(new C.Arc(this.pc,this.r,this.startAngle,t[e],this.counterClockwise));if(0==r.length)e.push(this.clone());else{let t;r.sort((e,t)=>e.length-t.length);for(let t=0;t<r.length;t++){let i,n=e.length>0?e[e.length-1]:void 0;i=n?new C.Arc(this.pc,this.r,n.endAngle,r[t].endAngle,this.counterClockwise):new C.Arc(this.pc,this.r,this.startAngle,r[t].endAngle,this.counterClockwise),C.Utils.EQ_0(i.length)||e.push(i.clone())}let i=e.length>0?e[e.length-1]:void 0;t=i?new C.Arc(this.pc,this.r,i.endAngle,this.endAngle,this.counterClockwise):new C.Arc(this.pc,this.r,this.startAngle,this.endAngle,this.counterClockwise),C.Utils.EQ_0(t.length)||C.Utils.EQ(t.sweep,2*Math.PI)||e.push(t.clone())}return e}tangentInStart(){let e=new C.Vector(this.pc,this.start),t=this.counterClockwise?Math.PI/2:-Math.PI/2;return e.rotate(t).normalize()}tangentInEnd(){let e=new C.Vector(this.pc,this.end),t=this.counterClockwise?-Math.PI/2:Math.PI/2;return e.rotate(t).normalize()}reverse(){return new C.Arc(this.pc,this.r,this.endAngle,this.startAngle,!this.counterClockwise)}translate(...e){let t=this.clone();return t.pc=this.pc.translate(...e),t}rotate(e=0,t=new C.Point){let i=new C.Matrix;return i=i.translate(t.x,t.y).rotate(e).translate(-t.x,-t.y),this.transform(i)}scale(e=1,t=1){let i=new C.Matrix;return i=i.scale(e,t),this.transform(i)}transform(e=new C.Matrix){let t=this.start.transform(e),i=this.end.transform(e),r=this.pc.transform(e),n=this.counterClockwise;return e.a*e.d<0&&(n=!n),C.Arc.arcSE(r,t,i,n)}static arcSE(e,t,i,r){let{vector:n}=C,o=n(e,t).slope,a=n(e,i).slope;C.Utils.EQ(o,a)&&(a+=2*Math.PI,r=!0);let s=n(e,t).length;return new C.Arc(e,s,o,a,r)}definiteIntegral(e=0){return this.breakToFunctional().reduce((t,i)=>t+i.circularSegmentDefiniteIntegral(e),0)}circularSegmentDefiniteIntegral(e){let t=new C.Line(this.start,this.end),i=this.pc.leftTo(t),r=new C.Segment(this.start,this.end).definiteIntegral(e),n=this.circularSegmentArea();return i?r-n:r+n}circularSegmentArea(){return .5*this.r*this.r*(this.sweep-Math.sin(this.sweep))}sortPoints(e){let{vector:t}=C;return e.slice().sort((e,i)=>{let r=t(this.pc,e).slope,n=t(this.pc,i).slope;return r<n?-1:r>n?1:0})}toJSON(){return Object.assign({},this,{name:"arc"})}svg(e={}){let t=this.sweep<=Math.PI?"0":"1",i=this.counterClockwise?"1":"0";return C.Utils.EQ(this.sweep,2*Math.PI)?new C.Circle(this.pc,this.r).svg(e):`
<path d="M${this.start.x},${this.start.y}
                             A${this.r},${this.r} 0 ${t},${i} ${this.end.x},${this.end.y}"
                    ${e0({fill:"none",...e})} />`}}C.Arc=tC;let tD=(...e)=>new C.Arc(...e);C.arc=tD;class tA{constructor(e,t,i,r){this.xmin=e,this.ymin=t,this.xmax=i,this.ymax=r}clone(){return new tA(this.xmin,this.ymin,this.xmax,this.ymax)}get low(){return new C.Point(this.xmin,this.ymin)}get high(){return new C.Point(this.xmax,this.ymax)}get max(){return this.clone()}get center(){return new C.Point((this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)}get width(){return Math.abs(this.xmax-this.xmin)}get height(){return Math.abs(this.ymax-this.ymin)}get box(){return this.clone()}not_intersect(e){return this.xmax<e.xmin||this.xmin>e.xmax||this.ymax<e.ymin||this.ymin>e.ymax}intersect(e){return!this.not_intersect(e)}merge(e){return new tA(void 0===this.xmin?e.xmin:Math.min(this.xmin,e.xmin),void 0===this.ymin?e.ymin:Math.min(this.ymin,e.ymin),void 0===this.xmax?e.xmax:Math.max(this.xmax,e.xmax),void 0===this.ymax?e.ymax:Math.max(this.ymax,e.ymax))}less_than(e){return!!(this.low.lessThan(e.low)||this.low.equalTo(e.low)&&this.high.lessThan(e.high))}equal_to(e){return this.low.equalTo(e.low)&&this.high.equalTo(e.high)}output(){return this.clone()}static comparable_max(e,t){return e.merge(t)}static comparable_less_than(e,t){return e.lessThan(t)}set(e,t,i,r){this.xmin=e,this.ymin=t,this.xmax=i,this.ymax=r}toPoints(){return[new C.Point(this.xmin,this.ymin),new C.Point(this.xmax,this.ymin),new C.Point(this.xmax,this.ymax),new C.Point(this.xmin,this.ymax)]}toSegments(){let e=this.toPoints();return[new C.Segment(e[0],e[1]),new C.Segment(e[1],e[2]),new C.Segment(e[2],e[3]),new C.Segment(e[3],e[0])]}svg(e={}){let t=this.xmax-this.xmin,i=this.ymax-this.ymin;return`
<rect x="${this.xmin}" y="${this.ymin}" width=${t} height=${i}
                ${e0({fill:"none",...e})} />`}}C.Box=tA;let tE=(...e)=>new C.Box(...e);C.box=tE;class tL{constructor(e){this.shape=e,this.next=void 0,this.prev=void 0,this.face=void 0,this.arc_length=0,this.bvStart=void 0,this.bvEnd=void 0,this.bv=void 0,this.overlap=void 0}get start(){return this.shape.start}get end(){return this.shape.end}get length(){return this.shape.length}get box(){return this.shape.box}isSegment(){return this.shape instanceof C.Segment}isArc(){return this.shape instanceof C.Arc}middle(){return this.shape.middle()}pointAtLength(e){return this.shape.pointAtLength(e)}contains(e){return this.shape.contains(e)}setInclusion(e){if(void 0!==this.bv)return this.bv;if(this.shape instanceof C.Line||this.shape instanceof C.Ray)return this.bv=C.OUTSIDE,this.bv;if(void 0===this.bvStart&&(this.bvStart=e4(e,this.start)),void 0===this.bvEnd&&(this.bvEnd=e4(e,this.end)),this.bvStart===C.OUTSIDE||this.bvEnd==C.OUTSIDE)this.bv=C.OUTSIDE;else if(this.bvStart===C.INSIDE||this.bvEnd==C.INSIDE)this.bv=C.INSIDE;else{let t=e4(e,this.middle());this.bv=t}return this.bv}setOverlap(e){let t;let i=this.shape,r=e.shape;i instanceof C.Segment&&r instanceof C.Segment?i.start.equalTo(r.start)&&i.end.equalTo(r.end)?t=C.OVERLAP_SAME:i.start.equalTo(r.end)&&i.end.equalTo(r.start)&&(t=C.OVERLAP_OPPOSITE):i instanceof C.Arc&&r instanceof C.Arc?i.start.equalTo(r.start)&&i.end.equalTo(r.end)&&i.middle().equalTo(r.middle())?t=C.OVERLAP_SAME:i.start.equalTo(r.end)&&i.end.equalTo(r.start)&&i.middle().equalTo(r.middle())&&(t=C.OVERLAP_OPPOSITE):(i instanceof C.Segment&&r instanceof C.Arc||i instanceof C.Arc&&r instanceof C.Segment)&&(i.start.equalTo(r.start)&&i.end.equalTo(r.end)&&i.middle().equalTo(r.middle())?t=C.OVERLAP_SAME:i.start.equalTo(r.end)&&i.end.equalTo(r.start)&&i.middle().equalTo(r.middle())&&(t=C.OVERLAP_OPPOSITE)),void 0===this.overlap&&(this.overlap=t),void 0===e.overlap&&(e.overlap=t)}svg(){if(this.shape instanceof C.Segment)return` L${this.shape.end.x},${this.shape.end.y}`;if(this.shape instanceof C.Arc){let e,t=this.shape,i=t.counterClockwise?"1":"0";if(!C.Utils.EQ(t.sweep,2*Math.PI))return` A${t.r},${t.r} 0 ${e=t.sweep<=Math.PI?"0":"1"},${i} ${t.end.x},${t.end.y}`;{let r=t.counterClockwise?1:-1,n=new C.Arc(t.pc,t.r,t.startAngle,t.startAngle+r*Math.PI,t.counterClockwise),o=new C.Arc(t.pc,t.r,t.startAngle+r*Math.PI,t.endAngle,t.counterClockwise);return e="0",` A${n.r},${n.r} 0 ${e},${i} ${n.end.x},${n.end.y}
                    A${o.r},${o.r} 0 ${e},${i} ${o.end.x},${o.end.y}`}}}toJSON(){return this.shape.toJSON()}}C.Edge=tL;class tI extends D{constructor(e,t){super(e,t),this.setCircularLinks()}setCircularLinks(){this.isEmpty()||(this.last.next=this.first,this.first.prev=this.last)}[Symbol.iterator](){let e;return{next:()=>{let t=e||this.first,i=!this.first||!!e&&e===this.first;return e=t?t.next:void 0,{value:t,done:i}}}}append(e){return super.append(e),this.setCircularLinks(),this}insert(e,t){return super.insert(e,t),this.setCircularLinks(),this}remove(e){return super.remove(e),this}}class tR extends tI{constructor(e,...t){if(super(),this._box=void 0,this._orientation=void 0,0==t.length)return;if(1==t.length){if(t[0]instanceof Array){let i=t[0];if(0==i.length)return;if(i.every(e=>e instanceof C.Point)){let t=tR.points2segments(i);this.shapes2face(e.edges,t)}else if(i.every(e=>e instanceof Array&&2===e.length)){let t=i.map(e=>new C.Point(e[0],e[1])),r=tR.points2segments(t);this.shapes2face(e.edges,r)}else if(i.every(e=>e instanceof C.Segment||e instanceof C.Arc))this.shapes2face(e.edges,i);else if(i.every(e=>"segment"===e.name||"arc"===e.name)){let t=[];for(let e of i){let i;i="segment"===e.name?new C.Segment(e):new C.Arc(e),t.push(i)}this.shapes2face(e.edges,t)}}else if(t[0]instanceof tR){let i=t[0];for(let t of(this.first=i.first,this.last=i.last,i))e.edges.add(t)}else if(t[0]instanceof C.Circle)this.shapes2face(e.edges,[t[0].toArc(C.CCW)]);else if(t[0]instanceof C.Box){let i=t[0];this.shapes2face(e.edges,[new C.Segment(new C.Point(i.xmin,i.ymin),new C.Point(i.xmax,i.ymin)),new C.Segment(new C.Point(i.xmax,i.ymin),new C.Point(i.xmax,i.ymax)),new C.Segment(new C.Point(i.xmax,i.ymax),new C.Point(i.xmin,i.ymax)),new C.Segment(new C.Point(i.xmin,i.ymax),new C.Point(i.xmin,i.ymin))])}}2==t.length&&t[0]instanceof C.Edge&&t[1]instanceof C.Edge&&(this.first=t[0],this.last=t[1],this.last.next=this.first,this.first.prev=this.last,this.setArcLength())}get edges(){return this.toArray()}get shapes(){return this.edges.map(e=>e.shape.clone())}get box(){if(void 0===this._box){let e=new C.Box;for(let t of this)e=e.merge(t.box);this._box=e}return this._box}get perimeter(){return this.last.arc_length+this.last.length}pointAtLength(e){if(e>this.perimeter||e<0)return null;let t=null;for(let i of this)if(e>=i.arc_length&&(i===this.last||e<i.next.arc_length)){t=i.pointAtLength(e-i.arc_length);break}return t}static points2segments(e){let t=[];for(let i=0;i<e.length;i++)e[i].equalTo(e[(i+1)%e.length])||t.push(new C.Segment(e[i],e[(i+1)%e.length]));return t}shapes2face(e,t){for(let i of t){let t=new C.Edge(i);this.append(t),e.add(t)}}append(e){return super.append(e),this.setOneEdgeArcLength(e),e.face=this,this}insert(e,t){return super.insert(e,t),this.setOneEdgeArcLength(e),e.face=this,this}remove(e){return super.remove(e),this.setArcLength(),this}reverse(){let e=[],t=this.last;do t.shape=t.shape.reverse(),e.push(t),t=t.prev;while(t!==this.last)for(let t of(this.first=void 0,this.last=void 0,e))void 0===this.first?(t.prev=t,t.next=t,this.first=t,this.last=t):(t.prev=this.last,this.last.next=t,this.last=t,this.last.next=this.first,this.first.prev=this.last),this.setOneEdgeArcLength(t);void 0!==this._orientation&&(this._orientation=void 0,this._orientation=this.orientation())}setArcLength(){for(let e of this)this.setOneEdgeArcLength(e),e.face=this}setOneEdgeArcLength(e){e===this.first?e.arc_length=0:e.arc_length=e.prev.arc_length+e.prev.length}area(){return Math.abs(this.signedArea())}signedArea(){let e=0,t=this.box.ymin;for(let i of this)e+=i.shape.definiteIntegral(t);return e}orientation(){if(void 0===this._orientation){let e=this.signedArea();C.Utils.EQ_0(e)?this._orientation=C.ORIENTATION.NOT_ORIENTABLE:C.Utils.LT(e,0)?this._orientation=C.ORIENTATION.CCW:this._orientation=C.ORIENTATION.CW}return this._orientation}isSimple(e){return 0==tR.getSelfIntersections(this,e,!0).length}static getSelfIntersections(e,t,i=!1){let r=[];for(let n of e){for(let o of t.search(n.box))if(n!==o&&o.face===e&&(!(n.shape instanceof C.Segment)||!(o.shape instanceof C.Segment)||n.next!==o&&n.prev!==o)){for(let e of n.shape.intersect(o.shape))if((!(e.equalTo(n.start)&&e.equalTo(o.end))||o!==n.prev)&&(!(e.equalTo(n.end)&&e.equalTo(o.start))||o!==n.next)&&(r.push(e),i))break;if(r.length>0&&i)break}if(r.length>0&&i)break}return r}findEdgeByPoint(e){let t;for(let i of this)if(i.shape.contains(e)){t=i;break}return t}toPolygon(){return new C.Polygon(this.shapes)}toJSON(){return this.edges.map(e=>e.toJSON())}svg(){let e=`
M${this.first.start.x},${this.first.start.y}`;for(let t of this)e+=t.svg();return e+" z"}}C.Face=tR;class tW{constructor(...e){if(this.pt=new C.Point,this.norm=new C.Vector(0,1),0==e.length||(e.length>=1&&e[0]instanceof C.Point&&(this.pt=e[0].clone()),1===e.length))return;if(2===e.length&&e[1]instanceof C.Vector){this.norm=e[1].clone();return}throw C.Errors.ILLEGAL_PARAMETERS}clone(){return new tW(this.pt,this.norm)}get slope(){return new C.Vector(this.norm.y,-this.norm.x).slope}get box(){let e=this.slope;return new C.Box(e>Math.PI/2&&e<3*Math.PI/2?Number.NEGATIVE_INFINITY:this.pt.x,e>=0&&e<=Math.PI?this.pt.y:Number.NEGATIVE_INFINITY,e>=Math.PI/2&&e<=3*Math.PI/2?this.pt.x:Number.POSITIVE_INFINITY,e>=Math.PI&&e<=2*Math.PI||0==e?this.pt.y:Number.POSITIVE_INFINITY)}get start(){return this.pt}get end(){}get length(){return Number.POSITIVE_INFINITY}contains(e){if(this.pt.equalTo(e))return!0;let t=new C.Vector(this.pt,e);return C.Utils.EQ_0(this.norm.dot(t))&&C.Utils.GE(t.cross(this.norm),0)}split(e){return this.contains(e)?this.pt.equalTo(e)?[this]:[new C.Segment(this.pt,e),new C.Ray(e,this.norm)]:[]}intersect(e){return e instanceof C.Segment?this.intersectRay2Segment(this,e):e instanceof C.Arc?this.intersectRay2Arc(this,e):void 0}intersectRay2Segment(e,t){let i=[],r=new C.Line(e.start,e.norm),n=r.intersect(t);for(let t of n)e.contains(t)&&i.push(t);return 2==n.length&&1==i.length&&e.start.on(r)&&i.push(e.start),i}intersectRay2Arc(e,t){let i=[];for(let r of new C.Line(e.start,e.norm).intersect(t))e.contains(r)&&i.push(r);return i}svg(e,t={}){let i=eC(new C.Line(this.pt,this.norm),e);return 0===(i=i.filter(e=>this.contains(e))).length||2===i.length?"":new C.Segment(this.pt,i[0]).svg(t)}}C.Ray=tW;let tV=(...e)=>new C.Ray(...e);C.ray=tV;class tk{constructor(){this.faces=new C.PlanarSet,this.edges=new C.PlanarSet;let e=[...arguments];if(1===e.length&&(e[0]instanceof Array&&e[0].length>0||e[0]instanceof C.Circle||e[0]instanceof C.Box)){let t=e[0];if(e[0]instanceof Array&&e[0].every(e=>e instanceof Array)){if(t.every(e=>e instanceof Array&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]))this.faces.add(new C.Face(this,t));else for(let e of t)if(e instanceof Array&&e[0]instanceof Array&&e[0].every(e=>e instanceof Array&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]))for(let t of e)this.faces.add(new C.Face(this,t));else this.faces.add(new C.Face(this,e))}else this.faces.add(new C.Face(this,t))}}get box(){return[...this.faces].reduce((e,t)=>e.merge(t.box),new C.Box)}get vertices(){return[...this.edges].map(e=>e.start)}clone(){let e=new tk;for(let t of this.faces)e.addFace(t.shapes);return e}isEmpty(){return 0===this.edges.size}isValid(){let e=!0;for(let t of this.faces)if(!t.isSimple(this.edges)){e=!1;break}return e}area(){return Math.abs([...this.faces].reduce((e,t)=>e+t.signedArea(),0))}addFace(...e){let t=new C.Face(this,...e);return this.faces.add(t),t}deleteFace(e){for(let t of e)this.edges.delete(t);return this.faces.delete(e)}recreateFaces(){let e;for(let e of(this.faces.clear(),this.edges))e.face=null;let t=!0;for(;t;){for(let i of(t=!1,this.edges))if(null===i.face){e=i,t=!0;break}if(t){let t=e;do t=t.next;while(t.next!==e)this.addFace(e,t)}}}removeChain(e,t,i){if(i.next===t){this.deleteFace(e);return}for(let r=t;r!==i.next;r=r.next)if(e.remove(r),this.edges.delete(r),e.isEmpty()){this.deleteFace(e);break}}addVertex(e,t){let i=t.shape.split(e);if(null===i[0])return t.prev;if(null===i[1])return t;let r=new C.Edge(i[0]),n=t.prev;return t.face.insert(r,n),this.edges.delete(t),this.edges.add(r),t.shape=i[1],this.edges.add(t),r}cut(e){let t=[this.clone()];for(let i of e){if(i.setInclusion(this)!==a)continue;let e=i.shape.start,r=i.shape.end,n=[];for(let i of t)if(void 0===i.findEdgeByPoint(e))n.push(i);else{let[t,o]=i.cutFace(e,r);n.push(t,o)}t=n}return t}cutFace(e,t){let i=this.findEdgeByPoint(e),r=this.findEdgeByPoint(t);if(i.face!==r.face)return[];let n=this.addVertex(e,i);r=this.findEdgeByPoint(t);let o=this.addVertex(t,r),a=n.face,s=new C.Edge(new C.Segment(n.end,o.end)),l=new C.Edge(new C.Segment(o.end,n.end));n.next.prev=l,l.next=n.next,n.next=s,s.prev=n,o.next.prev=s,s.next=o.next,o.next=l,l.prev=o,this.edges.add(s),this.edges.add(l);let h=this.addFace(s,n),c=this.addFace(l,o);return this.faces.delete(a),[h.toPolygon(),c.toPolygon()]}cutWithLine(e){let t,i=this.clone(),r=new e1([e]),n={int_points1:[],int_points2:[],int_points1_sorted:[],int_points2_sorted:[]};for(let t of i.edges)for(let i of eU(t,e))A(r.first,i,n.int_points1),A(t,i,n.int_points2);if(0===n.int_points1.length)return i;for(let t of(n.int_points1_sorted=R(e,n.int_points1),n.int_points2_sorted=L(n.int_points2),F(r,n.int_points1_sorted),F(i,n.int_points2_sorted),W(n),n.int_points1_sorted=R(e,n.int_points1),n.int_points2_sorted=L(n.int_points2),V(n.int_points1),k(n.int_points1,i),n.int_points1_sorted))t.edge_before.bv===t.edge_after.bv&&(n.int_points2[t.id]=-1,t.id=-1);if(n.int_points1=n.int_points1.filter(e=>e.id>=0),n.int_points2=n.int_points2.filter(e=>e.id>=0),0===n.int_points1.length)return i;n.int_points1_sorted=R(e,n.int_points1),n.int_points2_sorted=L(n.int_points2);let o=n.int_points1[0];for(let e of n.int_points1_sorted)e.edge_before.bv===a&&(t=new C.Edge(new C.Segment(o.pt,e.pt)),z(n.int_points2[o.id],n.int_points2[e.id],t),i.edges.add(t),t=new C.Edge(new C.Segment(e.pt,o.pt)),z(n.int_points2[e.id],n.int_points2[o.id],t),i.edges.add(t)),o=e;return i.recreateFaces(),i}findEdgeByPoint(e){let t;for(let i of this.faces)if(void 0!==(t=i.findEdgeByPoint(e)))break;return t}splitToIslands(){if(this.isEmpty())return[];let e=this.toArray();e.sort((e,t)=>t.area()-e.area());let t=[...e[0].faces][0].orientation(),i=e.filter(e=>[...e.faces][0].orientation()===t);for(let r of e){let e=[...r.faces][0];if(e.orientation()!==t){for(let t of i)if(e.shapes.every(e=>t.contains(e))){t.addFace(e.shapes);break}}}return i}reverse(){for(let e of this.faces)e.reverse();return this}contains(e){if(!(e instanceof C.Point))return e7(this,e);{let t=e4(this,e);return t===a||t===l}}distanceTo(e){if(e instanceof C.Point){let[t,i]=C.Distance.point2polygon(e,this);return[t,i=i.reverse()]}if(e instanceof C.Circle||e instanceof C.Line||e instanceof C.Segment||e instanceof C.Arc){let[t,i]=C.Distance.shape2polygon(e,this);return[t,i=i.reverse()]}if(e instanceof C.Polygon){let t,i,r=[Number.POSITIVE_INFINITY,new C.Segment];for(let n of this.edges){let o=r[0];[t,i]=C.Distance.shape2planarSet(n.shape,e.edges,o),C.Utils.LT(t,o)&&(r=[t,i])}return r}}intersect(e){return e instanceof C.Point?this.contains(e)?[e]:[]:e instanceof C.Line?ej(e,this):e instanceof C.Circle?eq(e,this):e instanceof C.Segment?eG(e,this):e instanceof C.Arc?eH(e,this):e instanceof C.Polygon?eJ(e,this):void 0}translate(e){let t=new tk;for(let i of this.faces)t.addFace(i.shapes.map(t=>t.translate(e)));return t}rotate(e=0,t=new C.Point){let i=new tk;for(let r of this.faces)i.addFace(r.shapes.map(i=>i.rotate(e,t)));return i}transform(e=new C.Matrix){let t=new tk;for(let i of this.faces)t.addFace(i.shapes.map(t=>t.transform(e)));return t}toJSON(){return[...this.faces].map(e=>e.toJSON())}toArray(){return[...this.faces].map(e=>e.toPolygon())}svg(e={}){let t=`
<path ${e0({fillRule:"evenodd",fill:"lightcyan",...e})} d="`;for(let e of this.faces)t+=e.svg();return t+`" >
</path>`}}C.Polygon=tk;let tB=(...e)=>new C.Polygon(...e);C.polygon=tB;let{Circle:tO,Line:tF,Point:tz,Vector:tU,Utils:tN}=C;class tG{constructor(e){this.circle=e}get inversion_circle(){return this.circle}static inversePoint(e,t){let i=new tU(e.pc,t),r=e.r*e.r,n=i.dot(i),o=tN.EQ_0(n)?new tz(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY):e.pc.translate(i.multiply(r/n));return o}static inverseCircle(e,t){let i=e.pc.distanceTo(t.pc)[0];if(tN.EQ(i,t.r)){let i=e.r*e.r/(2*t.r),r=new tU(e.pc,t.pc);r=r.normalize();let n=e.pc.translate(r.multiply(i));return new tF(n,r)}{let i=new tU(e.pc,t.pc),r=e.r*e.r/(i.dot(i)-t.r*t.r),n=e.pc.translate(i.multiply(r)),o=Math.abs(r)*t.r;return new tO(n,o)}}static inverseLine(e,t){let[i,r]=e.pc.distanceTo(t);if(tN.EQ_0(i))return t.clone();{let t=e.r*e.r/(2*i),n=new tU(e.pc,r.end);return n=n.multiply(t/i),new tO(e.pc.translate(n),t)}}inverse(e){return e instanceof tz?tG.inversePoint(this.circle,e):e instanceof tO?tG.inverseCircle(this.circle,e):e instanceof tF?tG.inverseLine(this.circle,e):void 0}}C.Inversion=tG;let tH=e=>new C.Inversion(e);C.inversion=tH;class tj{static point2point(e,t){return e.distanceTo(t)}static point2line(e,t){let i=e.projectionOn(t);return[new C.Vector(e,i).length,new C.Segment(e,i)]}static point2circle(e,t){let[i,r]=e.distanceTo(t.center);if(C.Utils.EQ_0(i))return[t.r,new C.Segment(e,t.toArc().start)];{let r=Math.abs(i-t.r),n=new C.Vector(t.pc,e).normalize().multiply(t.r),o=t.pc.translate(n);return[r,new C.Segment(e,o)]}}static point2segment(e,t){let i,r;if(t.start.equalTo(t.end))return tj.point2point(e,t.start);let n=new C.Vector(t.start,t.end),o=new C.Vector(t.start,e),a=new C.Vector(t.end,e),s=n.dot(o),l=-n.dot(a);if(C.Utils.GE(s,0)&&C.Utils.GE(l,0)){let n=t.tangentInStart();return i=Math.abs(n.cross(o)),r=t.start.translate(n.multiply(n.dot(o))),[i,new C.Segment(e,r)]}return s<0?e.distanceTo(t.start):e.distanceTo(t.end)}static point2arc(e,t){let i,r,n=new C.Circle(t.pc,t.r),o=[];return[i,r]=tj.point2circle(e,n),r.end.on(t)&&o.push(tj.point2circle(e,n)),o.push(tj.point2point(e,t.start)),o.push(tj.point2point(e,t.end)),tj.sort(o),o[0]}static segment2line(e,t){let i=e.intersect(t);if(i.length>0)return[0,new C.Segment(i[0],i[0])];let r=[];return r.push(tj.point2line(e.start,t)),r.push(tj.point2line(e.end,t)),tj.sort(r),r[0]}static segment2segment(e,t){let i,r,n=eE(e,t);if(n.length>0)return[0,new C.Segment(n[0],n[0])];let o=[];return[i,r]=tj.point2segment(t.start,e),o.push([i,r.reverse()]),[i,r]=tj.point2segment(t.end,e),o.push([i,r.reverse()]),o.push(tj.point2segment(e.start,t)),o.push(tj.point2segment(e.end,t)),tj.sort(o),o[0]}static segment2circle(e,t){let i=e.intersect(t);if(i.length>0)return[0,new C.Segment(i[0],i[0])];let r=new C.Line(e.ps,e.pe),[n,o]=tj.point2line(t.center,r);if(C.Utils.GE(n,t.r)&&o.end.on(e))return tj.point2circle(o.end,t);{let[i,r]=tj.point2circle(e.start,t),[n,o]=tj.point2circle(e.end,t);return C.Utils.LT(i,n)?[i,r]:[n,o]}}static segment2arc(e,t){let i,r,n=e.intersect(t);if(n.length>0)return[0,new C.Segment(n[0],n[0])];let o=new C.Line(e.ps,e.pe),a=new C.Circle(t.pc,t.r),[s,l]=tj.point2line(a.center,o);if(C.Utils.GE(s,a.r)&&l.end.on(e)){let[e,i]=tj.point2circle(l.end,a);if(i.end.on(t))return[e,i]}let h=[];return h.push(tj.point2arc(e.start,t)),h.push(tj.point2arc(e.end,t)),[i,r]=tj.point2segment(t.start,e),h.push([i,r.reverse()]),[i,r]=tj.point2segment(t.end,e),h.push([i,r.reverse()]),tj.sort(h),h[0]}static circle2circle(e,t){let i=e.intersect(t);if(i.length>0)return[0,new C.Segment(i[0],i[0])];if(e.center.equalTo(t.center)){let i=e.toArc(),r=t.toArc();return tj.point2point(i.start,r.start)}{let i=new C.Line(e.center,t.center),r=i.intersect(e),n=i.intersect(t),o=[];return o.push(tj.point2point(r[0],n[0])),o.push(tj.point2point(r[0],n[1])),o.push(tj.point2point(r[1],n[0])),o.push(tj.point2point(r[1],n[1])),tj.sort(o),o[0]}}static circle2line(e,t){let i=e.intersect(t);if(i.length>0)return[0,new C.Segment(i[0],i[0])];let[r,n]=tj.point2line(e.center,t),[o,a]=tj.point2circle(n.end,e);return[o,a=a.reverse()]}static arc2line(e,t){let i=t.intersect(e);if(i.length>0)return[0,new C.Segment(i[0],i[0])];let r=new C.Circle(e.center,e.r),[n,o]=tj.point2line(r.center,t);if(C.Utils.GE(n,r.r)){let[t,i]=tj.point2circle(o.end,r);if(i.end.on(e))return[t,i]}else{let i=[];return i.push(tj.point2line(e.start,t)),i.push(tj.point2line(e.end,t)),tj.sort(i),i[0]}}static arc2circle(e,t){let i=e.intersect(t);if(i.length>0)return[0,new C.Segment(i[0],i[0])];let r=new C.Circle(e.center,e.r),[n,o]=tj.circle2circle(r,t);if(o.start.on(e))return[n,o];{let i=[];return i.push(tj.point2circle(e.start,t)),i.push(tj.point2circle(e.end,t)),tj.sort(i),i[0]}}static arc2arc(e,t){let i=e.intersect(t);if(i.length>0)return[0,new C.Segment(i[0],i[0])];let r=new C.Circle(e.center,e.r),n=new C.Circle(t.center,t.r),[o,a]=tj.circle2circle(r,n);if(a.start.on(e)&&a.end.on(t))return[o,a];{let i,r,n=[];return[i,r]=tj.point2arc(e.start,t),r.end.on(t)&&n.push([i,r]),[i,r]=tj.point2arc(e.end,t),r.end.on(t)&&n.push([i,r]),[i,r]=tj.point2arc(t.start,e),r.end.on(e)&&n.push([i,r.reverse()]),[i,r]=tj.point2arc(t.end,e),r.end.on(e)&&n.push([i,r.reverse()]),[i,r]=tj.point2point(e.start,t.start),n.push([i,r]),[i,r]=tj.point2point(e.start,t.end),n.push([i,r]),[i,r]=tj.point2point(e.end,t.start),n.push([i,r]),[i,r]=tj.point2point(e.end,t.end),n.push([i,r]),tj.sort(n),n[0]}}static point2polygon(e,t){let i=[Number.POSITIVE_INFINITY,new C.Segment];for(let r of t.edges){let[t,n]=r.shape instanceof C.Segment?tj.point2segment(e,r.shape):tj.point2arc(e,r.shape);C.Utils.LT(t,i[0])&&(i=[t,n])}return i}static shape2polygon(e,t){let i=[Number.POSITIVE_INFINITY,new C.Segment];for(let r of t.edges){let[t,n]=e.distanceTo(r.shape);C.Utils.LT(t,i[0])&&(i=[t,n])}return i}static polygon2polygon(e,t){let i=[Number.POSITIVE_INFINITY,new C.Segment];for(let r of e.edges)for(let e of t.edges){let[t,n]=r.shape.distanceTo(e.shape);C.Utils.LT(t,i[0])&&(i=[t,n])}return i}static box2box_minmax(e,t){let i=Math.max(Math.max(e.xmin-t.xmax,0),Math.max(t.xmin-e.xmax,0)),r=Math.max(Math.max(e.ymin-t.ymax,0),Math.max(t.ymin-e.ymax,0)),n=i*i+r*r,o=e.merge(t),a=o.xmax-o.xmin,s=o.ymax-o.ymin;return[n,a*a+s*s]}static minmax_tree_process_level(e,t,i,r){let n,o;for(let a of t)[n,o]=tj.box2box_minmax(e.box,a.item.key),a.item.value instanceof C.Edge?r.insert([n,o],a.item.value.shape):r.insert([n,o],a.item.value),C.Utils.LT(o,i)&&(i=o);if(0===t.length)return i;let a=[...t.map(e=>e.left.isNil()?void 0:e.left).filter(e=>void 0!==e),...t.map(e=>e.right.isNil()?void 0:e.right).filter(e=>void 0!==e)].filter(t=>{let[r,n]=tj.box2box_minmax(e.box,t.max);return C.Utils.LE(r,i)});return i=tj.minmax_tree_process_level(e,a,i,r)}static minmax_tree(e,t,i){let r=new tm,n=[t.index.root],o=i<Number.POSITIVE_INFINITY?i*i:Number.POSITIVE_INFINITY;return o=tj.minmax_tree_process_level(e,n,o,r),r}static minmax_tree_calc_distance(e,t,i){let r,n;if(null!=t&&!t.isNil()){if([r,n]=tj.minmax_tree_calc_distance(e,t.left,i),n)return[r,n];if(C.Utils.LT(r[0],Math.sqrt(t.item.key.low)))return[r,!0];let[o,a]=tj.distance(e,t.item.value);return C.Utils.LT(o,r[0])&&(r=[o,a]),[r,n]=tj.minmax_tree_calc_distance(e,t.right,r),[r,n]}return[i,!1]}static shape2planarSet(e,t,i=Number.POSITIVE_INFINITY){let r=[i,new C.Segment],n=!1;if(t instanceof C.PlanarSet){let o=tj.minmax_tree(e,t,i);[r,n]=tj.minmax_tree_calc_distance(e,o.root,r)}return r}static sort(e){e.sort((e,t)=>C.Utils.LT(e[0],t[0])?-1:C.Utils.GT(e[0],t[0])?1:0)}static distance(e,t){return e.distanceTo(t)}}C.Distance=tj,C.BooleanOperations=ex,C.Relations=ts}),parcelRequire.register("7UKlx",function(e,t){$parcel$export(e.exports,"Floor",()=>y);var i=parcelRequire("2S71M"),r=parcelRequire("4xklQ"),n=parcelRequire("fAsY2"),o=parcelRequire("5XTH3"),a=parcelRequire("9QhXH"),s=parcelRequire("edxTF"),l=parcelRequire("hrM0U"),h=parcelRequire("4RBS5");parcelRequire("jDRRp");var c=parcelRequire("fTgj6"),d=parcelRequire("gDTsF");let{unify:u,subtract:p,intersect:m,innerClip:f,outerClip:g}=parcelRequire("eTLBN");class y{constructor(e,t){this.wallList=e,this.editor=t,this.texture=this.editor.config.floorTexture,this.texture.wrapS=r.RepeatWrapping,this.texture.wrapT=r.RepeatWrapping,this.beamMaterial=new r.MeshStandardMaterial({color:10394523,side:r.DoubleSide}),this.pillarsMaterial=new r.MeshStandardMaterial({color:10394523,side:r.DoubleSide})}getFloorOld(){let e=this.getAllVertex(),t=this.getIndexArr(e),r=this.transformVertex(e);if(this.transformAdj(t,r),r.length<3)return[];(0,i.extract_cycles)(r);let n=[];return this.getAllLines(e,n),n}getFloor2D(e="2D"){let t=[],i=this.preLoad();var n=MiniCycles.getResult(i.newVertices,i.allIndex);0==n.length&&console.log("is planar cycle",MiniCycles.is_planar(i.newVertices,i.allIndex));let o=this.getWallIndexes(i.wallPoints,i.allVertices,i.change);return this.removeWallCycle(n,o).forEach(n=>{let o=[];n.forEach(e=>{o.push(new r.Vector3(i.allVertices[e][0],i.allVertices[e][1],20))});let a="2D"==e?this.createMesh(o):this.createFloor3D(o);a.useType="floor",t.push(a)}),t}createFloor3D(e){return(0,l.CommonFunc).createFloor3D(e,this.texture)}preLoad(){let e=[],t=this.getAllPoints(e),i=this.getAllIndex(t),r=0,n=0;t.forEach(e=>{e[0]<r&&(r=e[0]),e[1]<n&&(n=e[1])});let o=[];t.forEach(e=>{o.push([e[0]+Math.abs(r),e[1]+Math.abs(n)])});let a=[];for(let e=0;e<o.length;e++){let t=[];i.forEach(i=>{i.includes(e)&&t.push(i)});for(let e=0;e<t.length-1;e++){let i=(0,l.CommonFunc).getLineEquation(o[t[e][0]],o[t[e][1]]);for(let r=e+1;r<t.length;r++){let n=(0,l.CommonFunc).getLineEquation(o[t[r][0]],o[t[r][1]]),s=(0,l.CommonFunc).getIntersectPoint(i,n),h=[...t[e],...t[r]],c=!0;a.forEach(e=>{if((0,l.CommonFunc).isEqualArray(e,h)){c=!1;return}}),"whole"==s&&c&&a.push(h)}}}let s=[];return a.forEach(e=>{let t,i,r,n,a,l,h,c;e.forEach(n=>{e.indexOf(n)!=e.lastIndexOf(n)?t=n:i||0==i?r=n:i=n}),c=o[i][0]==o[r][0]?1:0,n=Math.min(o[i][c],o[t][c],o[r][c]),a=Math.max(o[i][c],o[t][c],o[r][c]),o[i][c]<a&&o[i][c]>n&&(l=i,h=r),o[r][c]<a&&o[r][c]>n&&(l=r,h=i),(n==o[t][c]||a==o[t][c])&&s.push([[t,h],l])}),s.forEach(e=>{i.forEach((t,r)=>{if((0,l.CommonFunc).isEqualArray(t,e[0])){i[r][i[r].indexOf(e[0][0])]=e[1];return}})}),{allVertices:t,newVertices:o,allIndex:i,change:s,wallPoints:e}}getWallIndexes(e,t,i){let r=[];return e.forEach(e=>{let n=this.transToIndex(e,t);for(let e=0;e<n.length;e++){let t=e==n.length-1?0:e+1;i.forEach(i=>{(i[0][0]==n[e]&&i[0][1]==n[t]||i[0][0]==n[t]&&i[0][1]==n[e])&&n.push(i[1])})}r.push(n)}),r}removeWallCycle(e,t){let i=[];return e.forEach(e=>{if(e.pop(),0==e.length)return;let r=!0;t.forEach(t=>{(0,l.CommonFunc).isEqualArray(e,t)&&(r=!1)}),r&&i.push(e)}),i}getFloor(e=!1,t=!1,i="2D"){window.performance.now();let r=[];return(this.editor,e&&t)?(this.getVertexAdjByEdges(e,t,r),r):this.getFloorFunc(i)}getFloorFunc(e="2D"){let t=[],n=this.getAllPoints(),o=this.getAllIndex(n),a=0,s=0;n.forEach(e=>{e[0]<a&&(a=e[0]),e[1]<s&&(s=e[1])});let l=[];n.forEach(e=>{l.push([e[0]+Math.abs(a),e[1]+Math.abs(s)])});let h=this.transformVertex(l),c=Array.from(h);this.transformAdj(o,h);let u=[];for(let e of h)0==e.adj.length&&u.push(e);for(let e of u)h.splice(h.indexOf(e),1);let p=(0,i.extract_cycles)(h),m=[];function f(e){let t=[],i=[];for(let r in e){let n=new d.Point(e[r].x,e[r].y);if(t.push(n),0!=r){let o=new d.Segment(t[r-1],n);if(i.push(o),r==e.length-1){let e=new d.Segment(n,t[0]);i.push(e)}}}return i}for(let e of this.wallList){let t,i=e.geometry.attributes.position,r=[],o=[];for(let e=0;e<i.count/3;e++){let t=this.getIndex(n,[i.getX(3*e),i.getY(3*e)]),a=this.getIndex(n,[i.getX(3*e+1),i.getY(3*e+1)]),s=this.getIndex(n,[i.getX(3*e+2),i.getY(3*e+2)]);0==e||e==i.count/3-1?(t!=a&&o.push([t,a]),a!=s&&o.push([a,s]),e==i.count/3-1&&(r[0]!=t&&o.push([r[0],t]),r[2]!=s&&o.push([r[2],s]))):(r[0]!=t&&o.push([r[0],t]),r[2]!=s&&o.push([r[2],s])),r=[t,a,s]}let a=[];for(let e of o)a.push(...e);for(let e of(a=Array.from(new Set(a)),p)){let i=!0;if(e.length==a.length){for(let t of a){let r=c[t];if(-1==e.indexOf(r)){i=!1;break}}if(i){t=e;break}}}t&&(p.splice(p.indexOf(t),1),m.push(f(t)))}return p.forEach(i=>{let n=[];i.forEach(e=>{n.push(new r.Vector3(e.x-Math.abs(a),e.y-Math.abs(s),20))});let o="2D"==e?this.createMesh(n):this.createFloor3D(n);o.useType="floor",t.push(o)}),t}getFloorFunc2(e="2D"){let t=this.getAllPoints(),i=this.getAllIndex(t),r=0,n=0;t.forEach(e=>{e[0]<r&&(r=e[0]),e[1]<n&&(n=e[1])});let o=[];t.forEach(e=>{o.push([e[0]+Math.abs(r),e[1]+Math.abs(n)])}),MiniCycles.getResult(o,i)}getMiniCycleTree(e,t){e.forEach(e=>{0==e.children.length?t.push(e.cycle):this.getMiniCycleTree(e.children,t)})}getAllPoints(e=[]){let t=[];for(let i of this.wallList){let r=i.geometry.attributes.position,n=[];for(let e=0;e<r.count;e++)e%3==1?(1==e||e==r.count-2)&&n.push([r.getX(e),r.getY(e)]):n.push([r.getX(e),r.getY(e)]),t.push([r.getX(e),r.getY(e)]);e.push(n)}return this.filterArray(t)}getAllIndex(e){let t=[],i=[];for(let e of this.wallList){let t=e.geometry.attributes.position,r=[];for(let e=0;e<t.count/3;e++)0==r.length||e==t.count/3-1?(e==t.count/3-1&&i.push([r[0],[t.getX(3*e),t.getY(3*e)]],[r[2],[t.getX(3*e+2),t.getY(3*e+2)]]),i.push([[t.getX(3*e),t.getY(3*e)],[t.getX(3*e+1),t.getY(3*e+1)]],[[t.getX(3*e+1),t.getY(3*e+1)],[t.getX(3*e+2),t.getY(3*e+2)]])):i.push([r[0],[t.getX(3*e),t.getY(3*e)]],[r[2],[t.getX(3*e+2),t.getY(3*e+2)]]),r=[[t.getX(3*e),t.getY(3*e)],[t.getX(3*e+1),t.getY(3*e+1)],[t.getX(3*e+2),t.getY(3*e+2)]]}for(let r of i){let i=this.getIndex(e,r[0]),n=this.getIndex(e,r[1]);i!=n&&t.push([i,n])}return this.filterArray(t)}createCircle(e){let t=new r.SphereGeometry(50),i=new r.Mesh(t,new r.MeshBasicMaterial({color:16711680}));return i.position.copy(e),i}transToIndex(e,t){let i=[];return e.forEach(e=>{i.push(this.getIndex(t,e))}),i}transformVertex(e){let t=[];return e.forEach(function(e){t.push({x:e[0],y:e[1],adj:[]})}),t}transformAdj(e,t){e.forEach(function(e){let i=t[e[0]],r=t[e[1]];i.adj.push(r),r.adj.push(i)})}getAllLines(e,t){let n=Array(e.length).fill(0);this.wallList.forEach(t=>{let i=[t.startPoint.x,t.startPoint.y],r=[t.endPoint.x,t.endPoint.y];n[this.getIndex(e,i)]++,n[this.getIndex(e,r)]++});let o=[],a=this.getAllVertices(o),s=[];this.wallList.forEach(t=>{let i=Array.from(t.geometry.attributes.position.array);if(18==i.length){let r=[i[0],i[1]],o=[i[9],i[10]],l=[i[6],i[7]],h=[i[15],i[16]];s.push([this.getIndex(a,r),this.getIndex(a,o)],[this.getIndex(a,l),this.getIndex(a,h)]),1==n[this.getIndex(e,[t.startPoint.x,t.startPoint.y])]&&s.push([this.getIndex(a,r),this.getIndex(a,l)]),1==n[this.getIndex(e,[t.endPoint.x,t.endPoint.y])]&&s.push([this.getIndex(a,o),this.getIndex(a,h)])}else{for(let e=0;e<i.length/9-1;e++){let t=[i[9*e],i[9*e+1]],r=[i[(e+1)*9],i[(e+1)*9+1]],n=[i[(3*e+2)*3],i[(3*e+2)*3+1]],o=[i[((e+1)*3+2)*3],i[((e+1)*3+2)*3+1]];s.push([this.getIndex(a,t),this.getIndex(a,r)],[this.getIndex(a,n),this.getIndex(a,o)])}if(1==n[this.getIndex(e,[t.startPoint.x,t.startPoint.y])]){let e=[i[0],i[1]],t=[i[6],i[7]];s.push([this.getIndex(a,e),this.getIndex(a,t)])}if(1==n[this.getIndex(e,[t.endPoint.x,t.endPoint.y])]){let e=[i[i.length-3],i[i.length-2]],t=[i[i.length-9],i[i.length-8]];s.push([this.getIndex(a,e),this.getIndex(a,t)])}}});let l=this.transformVertex(a);this.transformAdj(s,l);let h=(0,i.extract_cycles)(l),c=[];h.forEach(e=>{let t=[];e.forEach(e=>{t.push(e.x,e.y)}),c.push(t)});let d=this.getRoom(c,t);(d=this.deleteWallCircle(d,o)).forEach(e=>{let i=[];for(let t=0;t<e.length/2;t++)i.push(new r.Vector2(e[2*t],e[2*t+1]));let n=this.createMesh(i);n.useType="floor",t.push(n)})}getVertexAdjByEdges(e,t,n){let o=[];e.forEach(e=>{let t=[e[0],e[1]],i=[e[2],e[3]];o.push(t,i)}),o=this.filterArray(o);let a=[];e.forEach(e=>{let t=[e[0],e[1]],i=[e[2],e[3]];new r.Vector2(e[0],e[1]),new r.Vector2(e[2],e[3]),a.push([this.getIndex(o,t),this.getIndex(o,i)])});let s=this.transformVertex(o);this.transformAdj(a,s);let l=(0,i.extract_cycles)(s),h=[];l.forEach(e=>{let t=[];e.forEach(e=>{t.push(e.x,e.y)}),h.push(t)});let c=this.getRoom(h,n);(c=this.deleteWallCircle(c,t)).forEach(e=>{let t=[];for(let i=0;i<e.length/2;i++)t.push(new r.Vector2(e[2*i],e[2*i+1]));let i=this.createMesh(t);i.useType="floor",n.push(i)})}getAllVertices(e){let t=[];return this.wallList.forEach(i=>{let r=[],n=Array.from(i.geometry.attributes.position.array);for(let e=0;e<n.length/9-1;e++)r.push([n[9*e],n[9*e+1]],[n[(e+1)*9],n[(e+1)*9+1]],[n[(3*e+2)*3],n[(3*e+2)*3+1]],[n[((e+1)*3+2)*3],n[((e+1)*3+2)*3+1]]),t.push([n[9*e],n[9*e+1]],[n[(e+1)*9],n[(e+1)*9+1]],[n[(3*e+2)*3],n[(3*e+2)*3+1]],[n[((e+1)*3+2)*3],n[((e+1)*3+2)*3+1]]);let o=[];this.filterArray(r).forEach(e=>{o.push({x:e[0],y:e[1]})}),e.push(o)}),this.filterArray(t)}handleIndex(e,t,i=0){console.log(t[e[i][0]],t[e[i][1]])}getRoom(e,t){let i=Array(e.length);for(let e=0;e<i.length;e++)i[e]=[,,].fill(0);for(let t=0;t<e.length-1;t++)for(let r=t+1;r<e.length;r++){let n=e[r].length/2,o=0,a=0;for(let i=0;i<n;i++)(0,s.pointInPolygon)([e[r][2*i],e[r][2*i+1]],e[t])?o++:a++;if(o===n)i[t][0]++,i[r][1]++;else{let n=0;for(let i=0;i<e[t].length/2;i++)(0,s.pointInPolygon)([e[t][2*i],e[t][2*i+1]],e[r])?o++:a++;n==e[t].length/2&&(i[t][1]++,i[r][0]++)}}return i.reverse().forEach((t,r)=>{0==t[1]&&0!=t[0]&&e.splice(i.length-1-r,1)}),e}deleteWallCircle(e,t){let i=[];for(let r=0;r<e.length;r++){let n=e[r],o=this.findWallByVertex(t,n),a=[];o.forEach(e=>{a.push(...t[e])});let s=[];a.forEach(e=>{s.push([e.x,e.y])}),s=this.filterArray(s);let l=[];for(let e=0;e<n.length/2;e++)l.push([n[2*e],n[2*e+1]]);l=this.filterArray(l),this.isEqual(s,l)&&i.push(r)}return i.reverse().forEach(t=>{e.splice(t,1)}),e}findWallByVertex(e,t){let i=Array(t.length/2);for(let e=0;e<i.length;e++)i[e]=[];for(let r=0;r<e.length;r++)for(let n=0;n<e[r].length;n++)for(let o=0;o<t.length/2;o++)e[r][n].x==t[2*o]&&e[r][n].y==t[2*o+1]&&i[o].push(r);let r=[];return i.forEach(e=>{r.push(...e)}),Array.from(new Set(r))}isEqual(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++){let r=!1;for(let n=0;n<t.length;n++)if(!r){if(e[i][0]==t[n][0]&&e[i][1]==t[n][1]){r=!0;continue}if(n==t.length-1)return!1}}for(let i=0;i<t.length;i++){let r=!1;for(let n=0;n<e.length;n++)if(!r){if(t[i][0]==e[n][0]&&t[i][1]==e[n][1]){r=!0;continue}if(n==e.length-1)return!1}}return!0}isInPoly(e,t){for(let i=0;i<e.length/2;i++)if(!PolyK.ContainsPoint(t,e[2*i],e[2*i+1]))return!1;return!0}getCeiling(){let e=this.getFloor(),t=[];this.wallList.forEach(e=>{t.push(e.height)});let i=Math.max(...t),n=[];for(let t=0;t<e.length;t++){let o=e[t].geometry.clone(),a=Array.from(o.attributes.position.array);for(let e=0;e<a.length/3;e++)a[3*e+2]=i;o.attributes.position=new r.BufferAttribute(new Float32Array(a),3);let s=Array.from(o.index.array);for(let e=0;e<s.length/3;e++){let t=s[3*e];s[3*e]=s[3*e+2],s[3*e+2]=t}o.index=new r.BufferAttribute(new Uint16Array(s),1),o.computeVertexNormals();let l=new r.Mesh(o,new r.MeshStandardMaterial({color:10394523}));n.push(l)}return n}getBeam(e,t){let i=[],n=new o.DrawWallTool;for(let o=0;o<e.length;o++){if("beam"==e[o].type){let a=this.getShape(e[o],t,n),s={steps:2,depth:e[o].depth,bevelEnabled:!1,bevelThickness:1,bevelSize:1,bevelSegments:1},l=new r.ExtrudeGeometry(a,s);l.computeBoundingBox();let h=l.boundingBox.min.clone().add(l.boundingBox.max).divideScalar(2);l.center();let c=new r.Mesh(l,this.beamMaterial);c.name="beam",c.position.set(h.x,h.y,e[o].location.z),i.push(c)}if("pillars"==e[o].type||"flue"==e[o].type){let t=this.createPillars(e[o]),n={steps:2,depth:e[o].depth,bevelEnabled:!1,bevelThickness:1,bevelSize:1,bevelSegments:1},a=new r.ExtrudeGeometry(t,n);a.computeBoundingBox();let s=a.boundingBox.min.clone().add(a.boundingBox.max).divideScalar(2);a.center();let l=new r.Mesh(a,this.pillarsMaterial);l.name=e[o].type,l.position.set(s.x,s.y,e[o].location.z),i.push(l)}}return console.log(i),i}getBeamNew(e,t){let i=[];for(let n=0;n<e.length;n++){let o={steps:2,depth:e[n].depth,bevelEnabled:!1,bevelThickness:1,bevelSize:1,bevelSegments:1},a=new r.Shape,s;t[n].children.forEach(e=>{"Mesh"==e.type&&(s=e.geometry)});let l=Array.from(s.attributes.position.array),h=[];for(let e=0;e<l.length/3;e++)h.push(new r.Vector2(l[3*e]*t[n].scale.x,l[3*e+1]*t[n].scale.y));a.moveTo(h[0].x,h[0].y);for(let e=1;e<h.length;e++)a.lineTo(h[e].x,h[e].y);a.lineTo(h[0].x,h[0].y);let d=new r.ExtrudeGeometry(a,o);d.computeBoundingBox(),d.center();let u=t[n].position;if("beam"==e[n].type){let o=new r.Mesh(d,this.beamMaterial);o.name="beam",o.modeType=e[n].type,o.rotation.z=t[n].rotation.z,o.position.set(u.x,u.y,e[n].location.z),o.model2DId=e[n].id,t[n].threeD=o,o.twoD=t[n],i.push(o)}if("pillars"==e[n].type||"flue"==e[n].type){let o="flue"==e[n].type?new c.FlueMesh(d,this.pillarsMaterial):new r.Mesh(d,this.pillarsMaterial);"flue"==e[n].type&&o.hollow(),o.name=e[n].type,o.modeType=e[n].type,o.position.set(u.x,u.y,e[n].location.z),o.rotation.z=t[n].rotation.z,o.model2DId=e[n].id,t[n].threeD=o,o.twoD=t[n],i.push(o)}}return i}getShape(e,t,i){let n,o;let s=new r.Vector2(e.location.x,e.location.y),l=s.clone(),h=s.clone();e.rotation%Math.PI==0?(n="Y",o=s.y):e.rotation%(Math.PI/2)==0?(n="X",o=s.x):(n=Math.round(1e3*Math.tan(e.rotation))/1e3,o=s.y-n*s.x);let c="X"==n||"Y"==n?e.height/2:e.height/2/Math.cos(e.rotation);"X"==n?(l.x+=c,h.x-=c):(l.y+=c,h.y-=c);let d=(0,a.DM).getIntersect(l,n,o+c,t,i),u=(0,a.DM).getIntersect(s,n,o,t,i),p=(0,a.DM).getIntersect(h,n,o-c,t,i),m=new r.Shape;return m.moveTo(d[0].x,d[0].y),m.lineTo(u[0].x,u[0].y),m.lineTo(p[0].x,p[0].y),m.lineTo(p[1].x,p[1].y),m.lineTo(u[1].x,u[1].y),m.lineTo(d[1].x,d[1].y),m.lineTo(d[0].x,d[0].y),m}createPillars(e){let t=new r.Vector2(e.location.x,e.location.y),i=t.clone().add(new r.Vector2(-e.width/2,0)).add(new r.Vector2(0,e.height/2)),n=t.clone().add(new r.Vector2(e.width/2,0)).add(new r.Vector2(0,e.height/2)),o=t.clone().add(new r.Vector2(e.width/2,0)).add(new r.Vector2(0,-e.height/2)),a=t.clone().add(new r.Vector2(-e.width/2,0)).add(new r.Vector2(0,-e.height/2)),s=new r.Shape;return s.moveTo(i.x,i.y),s.lineTo(n.x,n.y),s.lineTo(o.x,o.y),s.lineTo(a.x,a.y),s.lineTo(i.x,i.y),s}getAllVertex(){let e=[];return this.wallList.forEach(function(t){let i=[t.startPoint.x,t.startPoint.y],r=[t.endPoint.x,t.endPoint.y];e.push(i,r)}),this.filterArray(e)}checkNum(e,t){let i=0;for(let r=0;r<e.length;r++){let n=e[r].startPoint,o=e[r].endPoint;if(n.x==t.x&&n.y==t.y&&i++,o.x==t.x&&o.y==t.y&&i++,i>1)return!0}return!1}filterArray(e){let t=[];return e.forEach(e=>{let i=!0;t.forEach(t=>{e[0]===t[0]&&e[1]===t[1]&&(i=!1),e[0]===t[1]&&e[1]===t[0]&&(i=!1)}),i&&t.push(e)}),t}getIndexArr(e){let t=[];for(let i=0;i<this.wallList.length;i++){let r=this.wallList[i],n=[r.startPoint.x,r.startPoint.y],o=[r.endPoint.x,r.endPoint.y];t.push([this.getIndex(e,n),this.getIndex(e,o)])}return t}getIndexArr2(e,t){let i=[];for(let r=0;r<t.length;r++){let n=t[r],o=Array.from(n.geometry.attributes.position.array);for(let t=0;t<o.length/9-1;t++){let r=[o[9*t],o[9*t+1]],n=[o[(t+1)*9],o[(t+1)*9+1]],a=[o[(3*t+2)*3],o[(3*t+2)*3+1]],s=[o[((t+1)*3+2)*3],o[((t+1)*3+2)*3+1]];i.push([this.getIndex(e,r),this.getIndex(e,n)],[this.getIndex(e,a),this.getIndex(e,s)])}if(this.checkNum(t,n.startPoint)){if(!this.checkNum(t,n.endPoint)){let t=[o[(o.length/3-1)*3],o[(o.length/3-1)*3+1]],r=[o[(o.length/3-3)*3],o[(o.length/3-3)*3+1]];i.push([this.getIndex(e,t),this.getIndex(e,r)])}}else{let t=[o[0],o[1]],r=[o[6],o[7]];i.push([this.getIndex(e,t),this.getIndex(e,r)])}}return i}getIndex(e,t){for(let i=0;i<e.length;i++)if(t[0]==e[i][0]&&t[1]==e[i][1])return i;return!1}createFloor(e){let t=[];for(let i=0;i<e.length;i++){let o=[],a=[],s=e[i],l=[];for(let e=0;e<s.length;e++){let t=s[e],i=e,r=i==s.length-1?s[0]:s[i+1],n=this.getWall(t,r);l.push(n);let a=this.getLineData(t,r,n.thickness/2);n.isRoomInnerWall=a,o.push(a)}let h=[],c=[],d=!1;for(let e=0;e<l.length;e++)if(l[e].isArc){let t=Array.from(l[e].geometry.attributes.position.array);for(let e=0;e<t.length/9;e++){let i=[t[9*e],t[9*e+1]],r=[t[9*e+6],t[9*e+7]],n=[t[9*e+9],t[9*e+10]],o=[t[9*e+15],t[9*e+16]];c.push([i,n],[r,o])}d=!0}else{let t=Array.from(l[e].geometry.attributes.position.array),i=[t[0],t[1]],r=[t[6],t[7]],n=[t[9],t[10]],o=[t[15],t[16]];h.push(i,r,n,o),c.push([i,n],[r,o])}if(d){for(let e=0;e<l.length;e++)if(!l[e].isArc){let i=Array.from(l[e].geometry.attributes.position.array),o=[i[0],i[1]],a=[i[6],i[7]],s=[i[9],i[10]],h=[i[15],i[16]],d=this.getCycle([o,s],c),u=this.getCycle([a,h],c),p=[],m=[];d&&(p.push(...d[0]),d.shift(),p=this.getPoints(p[1],d,p)),u&&(m.push(...u[0]),u.shift(),m=this.getPoints(m[1],u,m));let f=[],g=[];if(p.forEach(function(e){f.push(new r.Vector2(e[0],e[1]))}),m.forEach(function(e){g.push(new r.Vector2(e[0],e[1]))}),p.length>0&&m.length>0){let e=Math.abs((0,n.ShapeUtils).area(f))>Math.abs((0,n.ShapeUtils).area(g))?this.createMesh(g):this.createMesh(f);t.push(e)}if(p.length>0&&0==m.length){let e=this.createMesh(f);t.push(e)}if(0==p.length&&m.length>0){let e=this.createMesh(g);t.push(e)}break}continue}for(let e=0;e<o.length;e++){let t=o[e],i=e,r=i==o.length-1?o[0]:o[i+1],n=i==o.length-1?s[0]:s[i+1];0==i?s[i+1]:s[i-1];let h=l[i],c=i==o.length-1?l[0]:l[i+1];if(h.isArc)console.log("当前墙是弧线墙");else if(c.isArc);else{let e=this.getIntersectPoint(t,r,n);a.push(e)}}let u=this.createMesh(a);t.push(u)}return t}createFloorNew(e){let t=[];return e.forEach(e=>{let o=[],a=[],s=[];for(let t=0;t<e.length;t++)for(let i=0;i<this.wallList.length;i++){let r=this.wallList[i],n=r.startPoint,o=r.endPoint;if(n.x==e[t].x&&n.y==e[t].y||o.x==e[t].x&&o.y==e[t].y){-1==s.indexOf(r)&&s.push(r);let e=Array.from(r.geometry.attributes.position.array);for(let t=0;t<e.length/9-1;t++)a.push([e[9*t],e[9*t+1]],[e[(t+1)*9],e[(t+1)*9+1]],[e[(3*t+2)*3],e[(3*t+2)*3+1]],[e[((t+1)*3+2)*3],e[((t+1)*3+2)*3+1]])}}a=this.filterArray(a);let l=this.getIndexArr2(a,s),h=this.transformVertex(a);this.transformAdj(l,h);let c=(0,i.extract_cycles)(h),d=0,u;c.forEach(e=>{let t=[];e.forEach(e=>{t.push(new r.Vector2(e.x,e.y))});let i=this.createMesh(t);i.useType="floor";let a=Math.round(100*Math.abs((0,n.ShapeUtils).area(t)/1e6))/100;a>d&&(d=a,u=i),o.push(i)}),o.splice(o.indexOf(u),1),1==o.length&&t.push(...o)}),t}createMesh(e){let t=new r.Shape;t.moveTo(e[0].x,e[0].y);for(let i=1;i<e.length;i++)t.lineTo(e[i].x,e[i].y);t.lineTo(e[0].x,e[0].y);let i=new r.ShapeGeometry(t),n=i.attributes.position.array;i.computeBoundingBox();let o=i.boundingBox.min,a=i.boundingBox.max,s=a.x-o.x,l=a.y-o.y,c=[o.x,o.y],d=[];for(let e=0;e<n.length/3;e++){let t=[n[3*e],n[3*e+1]];d.push(...[(t[0]-c[0])/s,(t[1]-c[1])/l])}let u=new r.Matrix3().setUvTransform(0,0,s/1920,l/1920,0,0,0),p=new r.BufferAttribute(new Float32Array(d),2);p.applyMatrix3(u),d=Array.from(p.array),i.attributes.uv=new r.BufferAttribute(new Float32Array(d),2);let m=new h.Room(i,new r.MeshStandardMaterial({map:this.texture}));return m.initParams(this.wallList),m.allPoints=e,m}getPoints(e,t,i){let r=i[0],n=i[1];for(let o=0;o<t.length;o++){let a=t[o][0],s=t[o][1],l=r[0]==a[0]&&r[1]==a[1],h=r[0]==s[0]&&r[1]==s[1],c=n[0]==a[0]&&n[1]==a[1],d=n[0]==s[0]&&n[1]==s[1];if((!l||!d)&&(!h||!c)){if(a[0]==e[0]&&a[1]==e[1])return i.push(s),t.splice(o,1),this.getPoints(s,t,i);if(s[0]==e[0]&&s[1]==e[1])return i.push(a),t.splice(o,1),this.getPoints(a,t,i)}}return i}getWall(e,t){let i=[];for(let r=0;r<this.wallList.length;r++){let n=this.wallList[r],o=e.x==n.startPoint.x&&e.y==n.startPoint.y,a=e.x==n.endPoint.x&&e.y==n.endPoint.y,s=t.x==n.startPoint.x&&t.y==n.startPoint.y,l=t.x==n.endPoint.x&&t.y==n.endPoint.y;if(o){if(l)i.push(n);else{let e=!0;for(let t=0;t<this.wallList.length;t++)if(r!=t){let i=this.wallList[t].startPoint.x==n.endPoint.x&&this.wallList[t].startPoint.y==n.endPoint.y,r=this.wallList[t].endPoint.x==n.endPoint.x&&this.wallList[t].endPoint.y==n.endPoint.y;(i||r)&&(e=!1)}e&&i.push(n)}}else if(a){if(s)i.push(n);else{let e=!0;for(let t=0;t<this.wallList.length;t++)if(r!=t){let i=this.wallList[t].startPoint.x==n.startPoint.x&&this.wallList[t].startPoint.y==n.startPoint.y,r=this.wallList[t].endPoint.x==n.startPoint.x&&this.wallList[t].endPoint.y==n.startPoint.y;(i||r)&&(e=!1)}e&&i.push(n)}}}return i}getLineData(e,t,i){let n,o;e.x==t.x?(n="X",o=e.x):e.y==t.y?(n="Y",o=e.y):(n=(e.y-t.y)/(e.x-t.x),o=e.y-n*e.x);let a=new r.Vector2(t.x,t.y).sub(new r.Vector2(e.x,e.y));return 0!=Math.abs(Number(Math.cos(a.angle())).toFixed(11))&&1!=Math.abs(Number(Math.cos(a.angle())).toFixed(11))?o-=i/Number(Math.cos(a.angle())).toFixed(11):(180*a.angle()/Math.PI==0&&(o-=i),180*a.angle()/Math.PI==90&&(o+=i),180*a.angle()/Math.PI==180&&(o+=i),180*a.angle()/Math.PI==270&&(o-=i)),[n,o]}getIntersectPoint(e,t,i){if("X"==e[0]){if("X"==t[0])return e[1]==t[1]&&new r.Vector2(e[1],i.y);if("Y"==t[0])return new r.Vector2(e[1],t[1]);var n=t[0]*e[1]+t[1];return new r.Vector2(e[1],n)}if("Y"==e[0]){if("X"==t[0])return new r.Vector2(t[1],e[1]);if("Y"==t[0])return e[1]==t[1]&&new r.Vector2(i.x,e[1]);var o=(e[1]-t[1])/t[0];return new r.Vector2(o,e[1])}if("X"==t[0]){var n=e[0]*t[1]+e[1];return new r.Vector2(t[1],n)}if("Y"==t[0]){var o=(t[1]-e[1])/e[0];return new r.Vector2(o,t[1])}if(e[0]==t[0]){let t=-1/e[0],n=i.y-t*i.x,o=(n-e[1])/(e[0]-t),a=t*o+n;return new r.Vector2(o,a)}var o=(t[1]-e[1])/(e[0]-t[0]),n=e[0]*o+e[1];return new r.Vector2(o,n)}}}),parcelRequire.register("2S71M",function(e,t){function i(e,t){let i=[];for(;e.length>0;){let t=o(n(r(e)));t.length>2&&i.push(t),s(t[0],t[1]),e=l(t[0],e),e=l(t[1],e)}return i}function r(e){return e.reduce((e,t)=>{let i=t.x-e.x;return i<0?t:i>0?e:t.y-e.y<0?e:t})}function n(e){let t=[],i=e,r;do t.push(i),[i,r]=h(i,r);while(i!==e)return t}function o(e){for(let t=1;t<e.length;t++){let i=e.lastIndexOf(e[t]);i>t&&e.splice(t+1,i-t)}return e}function a(e,t){return t.filter(t=>t!==e)}function s(e,t){e.adj=a(t,e.adj),t.adj=a(e,t.adj)}function l(e,t){let i=e,r;for(;i&&i.adj.length<2;)t=a(i,t),(r=i.adj[0])&&s(i,r),i=r;return t}function h(e,t){return[1==e.adj.length?e.adj[0]:c(t,e,t?"ccw":"cw"),e]}function c(e,t,i){let r,n=t.adj;return e?(r=u(t,e),n=a(e,n)):r={x:0,y:-1},n.reduce((e,n)=>d(n,e,t,r,i))}function d(e,t,i,r,n){let o=u(e,i),a=u(t,i),s=p(a,r)>0,l=p(r,o),h=p(a,o),c;return(c="cw"==n?s&&(l>=0||h>=0)||!s&&l>=0&&h>=0:!s&&(l<0||h<0)||s&&l<0&&h<0)?e:t}function u(e,t){return{x:e.x-t.x,y:e.y-t.y}}function p(e,t){return e.x*t.y-t.x*e.y}$parcel$export(e.exports,"extract_cycles",()=>i)}),parcelRequire.register("9QhXH",function(e,t){$parcel$export(e.exports,"DM",()=>S);var i=parcelRequire("4xklQ"),r=parcelRequire("ia4Lh"),n=parcelRequire("7WCxl"),o=parcelRequire("g4HAh"),a=parcelRequire("5XTH3"),s=parcelRequire("9HO6e"),l=parcelRequire("jizqJ"),h=parcelRequire("9f3nc"),c=parcelRequire("5HP0C"),d=parcelRequire("kHWob"),u=parcelRequire("xl6VI"),p=parcelRequire("gMe2U"),m=parcelRequire("lUO0N"),f=parcelRequire("arwMC"),g=parcelRequire("8C2VU"),y=parcelRequire("1Wv1c"),x=parcelRequire("eZ4ri"),w=parcelRequire("bWffP"),b=parcelRequire("lDEcB"),v=parcelRequire("kKNer"),M=parcelRequire("iDVm9");parcelRequire("hrM0U");class S{static thickness=240;static lineRenderOrder=100;static shapeRenderOrder=90;static componentZ=10;static cornerWindowWidth=500;static doubleSlidingDoorLimit=2e3;static tripleSlidingDoorLimit=2500;static tool=new a.DrawWallTool;static addDoorParam(e,t,r,n,o,a,s,l,h=""){e.updateMatrixWorld(),e.doorWid=t,e.wallDep=r,""!=n&&(e.wallStartPoint=n),""!=o&&(e.wallEndPoint=o),e.center=a,e.startPoint=e.localToWorld(new i.Vector3(-t/2,0,0)),e.endPoint=e.localToWorld(new i.Vector3(t/2,0,0)),e.angle=s,e.modelType=l,e.doorDir=h,e.height=2100,e.floorHei=500,(l.includes("Door")||l.includes("door"))&&(e.height=2300,e.floorHei=0),"frenchwindows"==l&&(e.floorHei=0),"leftSide"==h&&(e.scale.x=-1),"inside"==h&&(e.scale.y=-1),"rightSide"==h&&(e.scale.x=-1,e.scale.y=-1)}static addMemberParam(e,t,i,r,n,o,a){e.angle=t,i&&(e.width=i),e.height=r,e.depth=n,e.center=o,e.modelType=a}static createScaleTool(e,t){let r=240,n=e.clone().distanceTo(t.clone()),o=(0,s.UtilCore).getPointsCenter(e,t),a=new i.Group,l=new i.Vector2(-n/2,-r/2),h=new i.Vector2(-n/2,r/2),c=new i.Vector2(n/2,r/2),d=new i.Vector2(n/2,-r/2),u=this.createShapeByPointArr([l,h,c,d],"mesh","rgb(57,110,254)");u.useType="scaleHelpTool";let p=50,m=0;for(let e=0;e<parseInt(n/p);e++){m+=p;let t=new i.Vector2(-n/2+m,r/2-20),o=new i.Vector2(-n/2+m,0);(e+1)%5==0&&(o.y=-r/4);let s=this.createLine([t,o],16777215);s.useType="scaleHelpTool",a.add(s)}l.y=-r,h.y=r,c.y=r,d.y=-r;let f=this.createLine([l,h],"rgb(57,110,254)"),g=this.createLine([c,d],"rgb(57,110,254)");f.useType="scaleHelpTool",g.useType="scaleHelpTool",a.position.set(o.x,o.y,this.componentZ),a.add(u,f,g);let y=new i.Vector2(t.x,t.y).sub(new i.Vector2(e.x,e.y)).angle();return a.rotation.z=y,a}static createBaseDoor(e,t,r="outside",n=0,o=this.thickness,a="",s=""){let l=new i.Group,h=new i.Vector2(-t/2,-o/2),c=new i.Vector2(-t/2,o/2),d=new i.Vector2(t/2,o/2),u=new i.Vector2(t/2,-o/2),p=this.createShapeByPointArr([h,c,d,u]),m=new i.Vector2(o/2-t/2,o/2),f=new i.Vector2(-t/2,0),g=new i.Vector2(-t/2,f.y+t),y=new i.Vector2(g.x+o/2,g.y),x=new i.Vector2(y.x,f.y),w=this.createShapeByPointArr([c,g,y,m]),b=this.createLine([h,g,y,x,f]),v=this.createLine([d,u]),M=this.createArc(m,t-o/2,0,Math.PI/2,14145753),P=this.createArc(m,t-o/2,0,Math.PI/2,16777215,!0);P.push(m);let T=this.createShapeByPointArr(P,"mesh",16185336);return l.add(p,w,b,v,M,T),"inside"==r&&(l.scale.y=-1),l.rotation.z=n,l.position.set(e.x,e.y,this.componentZ),S.addDoorParam(l,t,o,a,s,e,n,"door",r),l.modelPath=url+"/assets/model/door/baseDoor/baseDoor.glb",l}static createSectorDoor(e,t,r=0,n=this.thickness,o="",a="",s=""){let l=new i.Group,h=new i.Vector2(-t/2,-n/2),c=new i.Vector2(-t/2,n/2),d=new i.Vector2(t/2,n/2),u=new i.Vector2(t/2,-n/2),p=c.clone().add(d).divideScalar(2),m=c.distanceTo(d)/2;s||(s=m);let f=c.clone().sub(p).angle(),g=d.clone().sub(p).angle(),y=this.createArc(p,m,g,f,16777215,!0),x=this.createShapeByPointArr([...y,h,u]),w=this.createLine([u,...y,h]);return l.add(x,w),l.rotation.z=r,l.position.set(e.x,e.y,this.componentZ),S.addDoorParam(l,t,n,o,a,e,r,"archDoor"),l.modelPath=url+"/assets/model/door/sectorDoor/sectorDoor.glb",l.arcHei=s,l}static createSectorWindow(e,t,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=new i.Vector2(-t/2,-n/2),h=new i.Vector2(-t/2,n/2),c=new i.Vector2(t/2,n/2),d=new i.Vector2(t/2,-n/2),u=l.clone().add(d).divideScalar(2),p=h.clone().add(c).divideScalar(2),m=h.distanceTo(c)/2,f=h.clone().sub(p).angle(),g=c.clone().sub(p).angle(),y=this.createArc(p,m,g,f,16777215,!0),x=this.createShapeByPointArr([...y,l,d]),w=this.createLine([d,...y,l]),b=this.createLine([c,h]),v=this.createLine([p,u]);return s.add(x,w,b,v),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),S.addDoorParam(s,t,n,o,a,e,r,"archWindow"),s.modelPath=url+"/assets/model/window/sectorWindow/sectorWindow.glb",s}static createDODoor(e,t,r=0,n=this.thickness,o="",a="",s="outside"){let l=new i.Group,h=new i.Vector2(-t/2,-n/2),c=new i.Vector2(-t/2,n/2),d=new i.Vector2(t/2,n/2),u=new i.Vector2(t/2,-n/2),p=this.createShapeByPointArr([c,d,u,h]),m=new i.Vector2(-t/2,0),f=new i.Vector2(m.x,m.y+t/2),g=new i.Vector2(f.x+n/2,f.y),y=new i.Vector2(g.x,g.y-t/2),x=new i.Vector2(y.x,y.y+n/2),w=this.createArc(x,(t-n)/2,0,Math.PI/2,14145753),b=this.createShapeByPointArr([f,g,y,m]),v=this.createLine([h,f,g,y,m]),M=new i.Vector2(-m.x,m.y),P=new i.Vector2(-f.x,f.y),T=new i.Vector2(-g.x,g.y),_=new i.Vector2(-y.x,y.y),C=new i.Vector2(-x.x,x.y),D=this.createArc(C,(t-n)/2,Math.PI/2,Math.PI,14145753),A=this.createShapeByPointArr([P,T,_,M]),E=this.createLine([u,P,T,_,M]);return l.add(p,b,v,A,E,w,D),l.rotation.z=r,l.position.set(e.x,e.y,this.componentZ),S.addDoorParam(l,t,n,o,a,e,r,"doubledoor",s),l.modelPath=url+"/assets/model/door/doubleOpenDoor/doubleOpenDoor.glb",l}static createLashDoor(e,t=1450,r=0,n=this.thickness,o="",a="",s="outside"){let l=new i.Group,h=new i.Vector2(-t/2,-n/2),c=new i.Vector2(-t/2,n/2),d=new i.Vector2(t/2,n/2),u=new i.Vector2(t/2,-n/2),p=this.createShapeByPointArr([h,c,d,u]),m=this.createLine([h,c,d,u,h]),f=new i.Vector2(-t/2,-n/6),g=new i.Vector2(-t/2,n/6),y=new i.Vector2(t/2,n/6),x=new i.Vector2(t/2,-n/6),w=new i.Vector2(t/4,n/6),b=new i.Vector2(t/4,-n/6),v=this.createLine([f,x]),M=this.createLine([g,y]),P=this.createLine([w,b]);return l.add(p,m,v,M,P),l.rotation.z=r,l.position.set(e.x,e.y,this.componentZ),S.addDoorParam(l,t,n,o,a,e,r,"childMotherDoor",s),l.modelPath=url+"/assets/model/door/lashDoor/lashDoor.glb",l}static createSlidingDoor(e,t,r=0,n=this.thickness,o="",a="",s="outside"){let l=new i.Group,h=10,c=new i.Vector2(-t/2,-n/2),d=new i.Vector2(-t/2,n/2),u=new i.Vector2(t/2,n/2),p=new i.Vector2(t/2,-n/2),m=this.createShapeByPointArr([d,u,p,c]),f=this.createLine([c,d,u,p,c]);if(t<=this.doubleSlidingDoorLimit){let e=2*t/3,r=new i.Vector2(h-t/2,0),o=new i.Vector2(r.x,r.y+n/4),a=new i.Vector2(o.x+e,o.y),s=new i.Vector2(a.x,a.y-n/4),c=this.createLine([r,o,a,s,r]),d=new i.Vector2(-r.x,-r.y),u=new i.Vector2(-o.x,-o.y),p=new i.Vector2(-a.x,-a.y),m=new i.Vector2(-s.x,-s.y),f=this.createLine([d,u,p,m,d]);l.add(c,f)}else if(t<=this.tripleSlidingDoorLimit){let e=2*t/5,r=new i.Vector2(h-t/2,-n/4),o=new i.Vector2(r.x,r.y+n/4),a=new i.Vector2(o.x+e,o.y),s=new i.Vector2(a.x,a.y-n/4),c=this.createLine([r,o,a,s,r]),d=new i.Vector2(-s.x,s.y),u=new i.Vector2(-a.x,a.y),p=new i.Vector2(-o.x,o.y),m=new i.Vector2(-r.x,r.y),f=this.createLine([d,u,p,m,d]),g=new i.Vector2(-e/2,0),y=new i.Vector2(g.x,g.y+n/4),x=new i.Vector2(y.x+e,y.y),w=new i.Vector2(x.x,x.y-n/4),b=this.createLine([g,y,x,w,g]);l.add(c,f,b)}else{let e=t/4,r=new i.Vector2(h-t/2,n/4),o=new i.Vector2(r.x,r.y-n/4),a=new i.Vector2(o.x+e,o.y),s=new i.Vector2(a.x,a.y+n/4),c=this.createLine([r,o,a,s,r]),d=new i.Vector2(a.x-e/4,a.y),u=new i.Vector2(d.x,d.y-n/4),p=new i.Vector2(u.x+e,u.y),m=new i.Vector2(p.x,p.y+n/4),f=this.createLine([d,u,p,m,d]),g=new i.Vector2(-r.x,r.y),y=new i.Vector2(-o.x,o.y),x=new i.Vector2(-a.x,a.y),w=new i.Vector2(-s.x,s.y),b=this.createLine([g,y,x,w,g]),v=new i.Vector2(-d.x,d.y),M=new i.Vector2(-u.x,u.y),S=new i.Vector2(-p.x,p.y),P=new i.Vector2(-m.x,m.y),T=this.createLine([v,M,S,P,v]);l.add(c,f,b,T)}return l.add(m,f),l.rotation.z=r,l.position.set(e.x,e.y,this.componentZ),S.addDoorParam(l,t,n,o,a,e,r,"slidingdoor",s),l.modelPath=url+"/assets/model/door/slidingDoor/slidingDoor.glb",l}static createPass(e,t,r=0,n=this.thickness,o="",a="",s="outside"){let l=new i.Group,h=new i.Vector2(-t/2,n/2),c=new i.Vector2(t/2,n/2),d=new i.Vector2(t/2,n/6),u=new i.Vector2(-t/2,n/6),p=new i.Vector2(-t/2,-n/6),m=new i.Vector2(t/2,-n/6),f=new i.Vector2(t/2,-n/2),g=new i.Vector2(-t/2,-n/2),y=this.createShapeByPointArr([h,c,f,g]),x=this.createLine([h,c,d,u,h]),w=this.createLine([p,m,f,g,p]);return l.add(y,x,w),l.rotation.z=r,l.position.set(e.x,e.y,this.componentZ),S.addDoorParam(l,t,n,o,a,e,r,"passDoor",s),l.modelPath=url+"/assets/model/door/pass/pass1.glb",l}static createLWindow(e,t,r,n=1200,o=1200){let a=0,s=new i.Group,l=new i.Vector2(-t/2,-r/2-o),h=new i.Vector2(-t/2,r/2),c=new i.Vector2(h.x+t+n,r/2),d=new i.Vector2(c.x,c.y-r),u=new i.Vector2(t/2,-r/2),p=new i.Vector2(l.x+t,l.y),m=this.createShapeByPointArr([l,h,c,d,u,p]),f=this.createLine([l,h,c,d,u,p,l]),g=new i.Vector2(0,-r/2-o),y=new i.Vector2(t/2+n,0),x=this.createLine([g,new i.Vector2,y]);return s.add(m,f,x),s.rotation.z=a,s.position.set(e.x,e.y,this.componentZ),S.addDoorParam(s,n,r,0,0,e,a,"LWindow"),s}static createLWindowNew(e,t,r,n=1200,o=1200){let a,s,l,h,c,d,u,p=new i.Group,m=new b.LWindowGeometry(t,r,n,o),g=new i.Mesh(m,new i.MeshBasicMaterial({color:16777215})),y=new(0,f.DWHelper)().active(g);p.add(g,y);let x="",w="";if(t&&r){let p,m;let f=this.getCommonPoint(t,r);d=t.startPoint.x==f.x&&t.startPoint.y==f.y?(p=new i.Vector2(t.endPoint.x,t.endPoint.y)).clone().sub(t.startPoint):(p=new i.Vector2(t.startPoint.x,t.startPoint.y)).clone().sub(t.endPoint),u=r.startPoint.x==f.x&&r.startPoint.y==f.y?(m=new i.Vector2(r.endPoint.x,r.endPoint.y)).clone().sub(r.startPoint):(m=new i.Vector2(r.startPoint.x,r.startPoint.y)).clone().sub(r.endPoint),s=d.angle(),l=u.angle(),a=this.tool.computeMiter(p,f,m,t.thickness,r.thickness).angle(),h=t.thickness,c=r.thickness,x=e.clone().add(d.clone().setLength(n+r.thickness/2)),w=e.clone().add(u.clone().setLength(o+t.thickness/2))}else h=this.thickness,c=this.thickness,d=new i.Vector2(0,-1),u=new i.Vector2(1,0),a=((s=d.angle())+(l=u.angle()))/2;let v=Math.abs(c/2/Math.tan(a>l?a-l:a+2*Math.PI-l)),M=Math.abs(h/2/Math.tan(a<s?Math.PI-s+a:a-s-Math.PI)),P=e.clone().add(d.clone().setLength(n/2)),T=e.clone().add(u.clone().setLength(o/2));p.position.set(e.x,e.y,this.componentZ),p.leftWindow=[t,n,P,url+"/assets/model/window/LWindow/leftLWindow.glb",M,x],p.rightWindow=[r,o,T,url+"/assets/model/window/LWindow/rightLWindow.glb",v,w];let _=n+c,C=o+h;return S.addDoorParam(p,_,C,"","",e,"","LWindow"),p}static getCommonPoint(e,t){let r=new i.Vector2(e.startPoint.x,e.startPoint.y),n=new i.Vector2(e.endPoint.x,e.endPoint.y),o=new i.Vector2(t.startPoint.x,t.startPoint.y),a=new i.Vector2(t.endPoint.x,t.endPoint.y);return r.equals(o)||r.equals(a)?r:n.equals(o)||n.equals(a)?n:void 0}static createBaseWindow(e,t,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=new i.Vector2().add(new i.Vector2(-t/2,n/2)),h=new i.Vector2().add(new i.Vector2(-t/2,0)),c=new i.Vector2().add(new i.Vector2(-t/2,-n/2)),d=new i.Vector2().add(new i.Vector2(t/2,n/2)),u=new i.Vector2().add(new i.Vector2(t/2,0)),p=new i.Vector2().add(new i.Vector2(t/2,-n/2)),m=this.createShapeByPointArr([l,c,p,d]),f=this.createLine([h,c,p,d,l,h,u]);return s.add(m,f),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),S.addDoorParam(s,t,n,o,a,e,r,"window"),s.modelPath=url+"/assets/model/window/baseWindow/baseWindow.glb",s}static createArcBaseWindow(e,t=!1,r=this.thickness,n=Math.PI/12){let o=new i.Group,a,s,l=1500;if(e=new i.Vector2(e.x,e.y),t){let r=e.clone().sub(t);l=r.length();let o=new i.Vector2(r.x,r.y).angle();a=o-n,s=o+n}else t=new i.Vector2(e.x,e.y).add(new i.Vector2(0,-1).setLength(l)),a=5*Math.PI/12,s=7*Math.PI/12;let h=this.createArc(t,l+r/2,a,s,16777215,!0),c=this.createArc(t,l,a,s,16777215,!0),d=this.createArc(t,l-r/2,a,s,16777215,!0);h.unshift(d[0]),d.reverse().forEach(e=>{h.push(e)});let u=this.createLine(h),p=this.createLine(c);h.shift();let m=this.createShapeByPointArr(h);return m.geometry.computeBoundingBox(),o.add(u,p,m),S.addDoorParam(o,1e3,r,c[0],c[c.length-1],e,n,"arcWindow"),o.startPoint=c[0],o.endPoint=c[c.length-1],o.arcCenter=t,o.position.z=this.componentZ,o.modelPath=url+"/assets/model/window/05/arcWindow.glb",o}static createLWaveWindow(e,t,r,n,o,a=0,s=500,l=500){let h=new i.Group,c=new i.Vector2(n/2,o/2-r),d=new i.Vector2(c.x-n-s,c.y),u=new i.Vector2(d.x,d.y+r+l),p=new i.Vector2(u.x+s+t,u.y),m=new i.Vector2(p.x,p.y-l-o),f=new i.Vector2(n/2,-o/2),g=this.createShapeByPointArr([c,d,u,p,m,f],"mesh",13421772),y=this.createLine([c,d,u,p,m,f,c]),x=new i.Vector2(-n/2,o/2-r-this.thickness/2),w=new i.Vector2(x.x-s-this.thickness/2,x.y),b=new i.Vector2(w.x,w.y+this.thickness+r+l),v=new i.Vector2(b.x+this.thickness+t+s,b.y),M=new i.Vector2(v.x,v.y-this.thickness/2-l),S=new i.Vector2(c.x-n,c.y),P=new i.Vector2(m.x,m.y+o),T=[S,x,w,b,v,M,P,p,u,d],_=this.createShapeByPointArr(T),C=this.createLine([S,x,w,b,v,M,P]),D=new i.Vector2(S.x,S.y-this.thickness/4),A=new i.Vector2(D.x-s-this.thickness/4,D.y),E=new i.Vector2(A.x,A.y+this.thickness/2+r+l),L=new i.Vector2(E.x+this.thickness/2+t+s,E.y),I=new i.Vector2(L.x,L.y-this.thickness/4-l),R=this.createLine([D,A,E,L,I]);return h.add(g,y,_,C,R),h.rotation.z=a,h.position.set(e.x,e.y,this.componentZ),h}static createUWindow(e,t,r,n,o=1200,a=1200){let l=new i.Group,h=240,c=240,d=240,u=0,p=2500,m="",f="";if(t&&r&&n){let e,i;h=t.thickness,c=r.thickness,d=n.thickness,p=r.startPoint.distanceTo(r.endPoint)-h/2-d/2,"mobile"==editor.deviceType&&(p+=h/2+d/2);let l=r.startPoint,g=r.endPoint,y=t.startPoint,x=t.endPoint,w=n.startPoint,b=n.endPoint;l.equals(y)||l.equals(x)?e=l:(g.equals(y)||g.equals(x))&&(e=g),l.equals(w)||l.equals(b)?i=l:(g.equals(w)||g.equals(b))&&(i=g);let v=(0,s.UtilCore).getMeshOtherPoint(t,e),M=(0,s.UtilCore).getMeshOtherPoint(n,i);m=e.clone().add(v.clone().sub(e).setLength(o+c/2)),f=i.clone().add(M.clone().sub(i).setLength(a+c/2)),e&&i&&(u=i.clone().sub(e).angle())}let g=new i.Vector2(-p/2,-o-c/2),y=new i.Vector2(g.x-h,g.y),x=new i.Vector2(y.x,y.y+o+c),w=new i.Vector2(x.x+h+p+d,x.y),b=new i.Vector2(w.x,w.y-c-a),v=new i.Vector2(b.x-d,b.y),M=new i.Vector2(v.x,v.y+a),P=new i.Vector2(M.x-p,M.y),T=this.createShapeByPointArr([g,y,x,w,b,v,M,P]),_=this.createLine([g,y,x,w,b,v,M,P,g]),C=new i.Vector2(g.x-h/2,g.y),D=new i.Vector2(C.x,0),A=new i.Vector2(p/2+d/2,D.y),E=new i.Vector2(A.x,A.y-c/2-a),L=this.createLine([C,D,A,E]);l.add(T,_,L),l.rotation.z=u,l.position.set(e.x,e.y,this.componentZ),l.leftWindow=[t,o,m],l.rightWindow=[n,a,f];let I=o+c;return a>o&&(I=a+c),S.addDoorParam(l,p+h+d,I,"","",e,u,"UWindow"),l.modelPath=url+"/assets/model/window/uWindow/uWindow.glb",l}static createUWindowOld(e,t,r,n,o,a=0,s=1200,l=1200){let h=new i.Group,c=new i.Vector2(-o/2,-s-r/2),d=new i.Vector2(c.x-t,c.y),u=new i.Vector2(d.x,d.y+s+r),p=new i.Vector2(u.x+t+o+n,u.y),m=new i.Vector2(p.x,p.y-r-l),f=new i.Vector2(m.x-n,m.y),g=new i.Vector2(f.x,f.y+l),y=new i.Vector2(g.x-o,g.y),x=this.createShapeByPointArr([c,d,u,p,m,f,g,y]),w=this.createLine([c,d,u,p,m,f,g,y,c]),b=new i.Vector2(c.x-t/2,c.y),v=new i.Vector2(b.x,0),M=new i.Vector2(o/2+n/2,v.y),P=new i.Vector2(M.x,M.y-r/2-l),T=this.createLine([b,v,M,P]);return h.add(x,w,T),h.rotation.z=a,h.position.set(e.x,e.y,this.componentZ),S.addDoorParam(h,o+t+n,r,"","",e,a,"UWindow"),h.modelPath=url+"/assets/model/window/uWindow/uWindow.glb",h}static createUWaveWindow(e,t,r,n,o,a=0,s=1e3,l=500,h=500,c=500){let d=new i.Group,u=new i.Vector2(-t/2,-n/2-s),p=new i.Vector2(u.x-r-l,u.y),m=new i.Vector2(p.x,n/2+h),f=new i.Vector2(t/2+o+c,m.y),g=new i.Vector2(f.x,u.y),y=new i.Vector2(t/2,g.y),x=new i.Vector2(y.x,-n/2),w=new i.Vector2(-t/2,x.y),b=this.createShapeByPointArr([u,p,m,f,g,y,x,w],"mesh",13421772),v=this.createLine([u,p,m,f,g,y,x,w,u]),M=new i.Vector2(-t/2-r,u.y),S=new i.Vector2(M.x,M.y-this.thickness/2),P=new i.Vector2(S.x-l-this.thickness/2,S.y),T=new i.Vector2(P.x,m.y+this.thickness/2),_=new i.Vector2(f.x+this.thickness/2,T.y),C=new i.Vector2(_.x,g.y-this.thickness/2),D=new i.Vector2(t/2+o,C.y),A=new i.Vector2(D.x,D.y+this.thickness/2),E=this.createShapeByPointArr([M,S,P,T,_,C,D,A,g,f,m,p]),L=this.createLine([M,S,P,T,_,C,D,A]),I=new i.Vector2(M.x,M.y-this.thickness/4),R=new i.Vector2(p.x-this.thickness/4,I.y),W=new i.Vector2(R.x,m.y+this.thickness/4),V=new i.Vector2(f.x+this.thickness/4,W.y),k=new i.Vector2(V.x,g.y-this.thickness/4),B=new i.Vector2(A.x,k.y),O=this.createLine([I,R,W,V,k,B]);return d.add(b,v,E,L,O),d.rotation.z=a,d.position.set(e.x,e.y,this.componentZ),d.modelPath=url+"/assets/model/window/waveWindow/waveWindow.glb",d}static createFrenchWindow(e,t,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=new i.Vector2(-t/2,-n/2),h=new i.Vector2(-t/2,n/2),c=new i.Vector2(t/2,n/2),d=new i.Vector2(t/2,-n/2),u=this.createShapeByPointArr([h,c,d,l]),p=this.createLine([l,h,c,d,l]),m=new i.Vector2(-t/2,-n/6),f=new i.Vector2(t/2,-n/6),g=new i.Vector2(-t/2,0),y=new i.Vector2(t/2,0),x=new i.Vector2(-t/2,n/6),w=new i.Vector2(t/2,n/6),b=new i.Vector2(0,n/6),v=new i.Vector2(0,-n/6),M=this.createLine([m,f]),P=this.createLine([g,y]),T=this.createLine([x,w]),_=this.createLine([b,v]);return s.add(u,p,M,P,T,_),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),S.addDoorParam(s,t,n,o,a,e,r,"frenchwindows"),s.modelPath=url+"/assets/model/window/frenchWindow/frenchWindow.glb",s}static createPanoramicWindow(e,t,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=t-n,h=new i.Vector2(-l/2,-n/2),c=new i.Vector2(h.x,h.y+this.cornerWindowWidth),d=new i.Vector2(c.x+l,c.y),u=new i.Vector2(l/2,-n/2),p=this.createShapeByPointArr([c,d,u,h],"mesh",13421772),m=this.createLine([h,c,d,u,h]),f=new i.Vector2(-l/2,n/2),g=new i.Vector2(f.x-n,f.y),y=new i.Vector2(g.x,g.y+this.cornerWindowWidth),x=new i.Vector2(y.x+t+n,y.y),w=new i.Vector2(x.x,x.y-this.cornerWindowWidth),b=new i.Vector2(w.x-n,w.y),v=new i.Vector2(f.x-n/2,f.y),M=new i.Vector2(v.x,v.y+this.cornerWindowWidth-n/2),P=new i.Vector2(M.x+l+n,M.y),T=new i.Vector2(P.x,P.y-this.cornerWindowWidth+n/2),_=this.createShapeByPointArr([g,y,x,w,b,d,c,f]),C=this.createLine([f,g,y,x,w,b]),D=this.createLine([v,M,P,T]);return s.add(p,m,_,C,D),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),S.addDoorParam(s,t,this.cornerWindowWidth+n,o,a,e,r,"straightBayWindow"),s.modelPath=url+"/assets/model/window/panoramicWindow/panoramicWindow.glb",s}static createBeam(e,t,r=0,n=400,o=400,a=!1,s=!1,l="R"){let h,c,d=new i.Group;if("beam"==t){let t=new M.BeamMesh({position:e,rotation:r,thickness:n,depth:o,wallList:a,width:s,model:l});return t.create(),S.addMemberParam(t,r,t.parameter.width,n,o,e,"beam"),t.name="bridge",t}if("pillars"==t){let t=new i.Vector2(-s/2,-n/2),a=new i.Vector2(s/2,-n/2),l=new i.Vector2(s/2,n/2),u=new i.Vector2(-s/2,n/2);c=this.createShapeByPointArr([a,l,u,t],"mesh",0),h=this.createLine([t,a,l,u,t]),d.add(c,h),d.rotation.z=r,d.position.set(e.x,e.y,this.componentZ),d.name="post",S.addMemberParam(d,r,s,n,o,e,"pillars")}return c.position.z=5,d}static getIntersect(e,t,r,n,o){let a=[],s=[],l=[],h=[],c="",d="";for(let c=0;c<n.length;c++){let d=Array.from(n[c].geometry.attributes.position.array),u=new i.Vector2(d[0],d[1]),p=new i.Vector2(d[6],d[7]),m=new i.Vector2(d[9],d[10]),f=new i.Vector2(d[15],d[16]),g=this.getAndCheck(u,m,[t,r],o),y=this.getAndCheck(p,f,[t,r],o);if(g&&y){let t=e.distanceTo(g)>e.distanceTo(y)?y:g;t.x>e.x?(a.push(t),l.push(n[c])):t.x<e.x?(s.push(t),h.push(n[c])):t.y>e.y?(a.push(t),l.push(n[c])):(s.push(t),h.push(n[c]))}}return a.length>1?a.forEach(t=>{if(""==c)c=t;else{let i=e.distanceTo(c);e.distanceTo(t)<i&&(c=t)}}):(c=a[0])&&(c.wall=l[0]),s.length>1?s.forEach(t=>{if(""==d)d=t;else{let i=e.distanceTo(d);e.distanceTo(t)<i&&(d=t)}}):(d=s[0])&&(d.wall=h[0]),[d,c]}static getAndCheck(e,t,r,n){let o=n.getLineData(e,t),a=n.computeIntersectPoint(o,r,new i.Vector2(0,0)),s=Math.min(Math.round(1e3*e.x)/1e3,Math.round(1e3*t.x)/1e3),l=Math.max(Math.round(1e3*e.x)/1e3,Math.round(1e3*t.x)/1e3),h=Math.min(Math.round(1e3*e.y)/1e3,Math.round(1e3*t.y)/1e3),c=Math.max(Math.round(1e3*e.y)/1e3,Math.round(1e3*t.y)/1e3);if(!a)return!1;{let e=a.x>=s&&a.x<=l,t=a.y>=h&&a.y<=c;return!!e&&!!t&&a}}static createFlue(e,t=650,r=650,n=0){let o=500/650,a=155/650,s=new i.Group,l=new i.Vector2(-t/2,r/2),h=new i.Vector2(t/2,r/2),c=new i.Vector2(t/2,-r/2),d=new i.Vector2(-t/2,-r/2),u=new i.Vector2(l.x+40,l.y-40),p=new i.Vector2(h.x-40,h.y-40),m=new i.Vector2(c.x-40,c.y+40),f=new i.Vector2(d.x+40,d.y+40),g=new i.Vector2(t*o-t/2,r/2-r*a),y=this.createShapeByPointArr([l,h,c,d]),x=this.createLine([l,h,c,d,l]),w=this.createLine([u,p,m,f,u,g,m]);return s.add(y,x,w),s.position.set(e.x,e.y,this.componentZ),s.rotation.z=n,S.addMemberParam(s,n,t,r,window.storeyHei,e,"flue"),s.name="flue",s}static createDoorHole(e,t,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=new i.Vector2(-t/2,n/2),h=new i.Vector2(t/2,n/2),c=new i.Vector2(t/2,-n/2),d=new i.Vector2(-t/2,-n/2),u=this.createShapeByPointArr([l,h,c,d]),p=this.createLine([l,h],0,!0),m=this.createLine([h,c]),f=this.createLine([c,d],0,!0),g=this.createLine([d,l]);return s.add(u,p,m,f,g),s.position.set(e.x,e.y,this.componentZ),s.rotation.z=r,S.addDoorParam(s,t,n,o,a,e,r,"dooropen"),s}static createLine(e,t=0,a=!1,s=1.5){let l=[];e.forEach(e=>{l.push(e.x,e.y,0)});var h=new(0,o.LineGeometry)().setPositions(l),c=new n.LineMaterial({color:t,linewidth:s,dashed:a,transparent:!0,side:i.DoubleSide});c.resolution.set(window.innerWidth,window.innerHeight);var d=new r.Line2(h,c);return d.renderOrder=this.lineRenderOrder,d.computeLineDistances(),d}static createShapeByPointArr(e,t="mesh",r=16777215){let n=new i.Shape;if(n.moveTo(e[e.length-1].x,e[e.length-1].y),e.forEach(e=>{n.lineTo(e.x,e.y)}),"shape"==t)return n;let o=new i.ShapeGeometry(n),a=new i.Mesh(o,new i.MeshBasicMaterial({color:r}));return a.renderOrder=this.shapeRenderOrder,a.position.z=-5,a}static createArc(e,t,r,n,o=0,a=!1){let s=new i.Path().arc(e.x,e.y,t,r,n,!1).getPoints();if(a)return s;let l=new i.BufferGeometry().setFromPoints(s),h=new i.Line(l,new i.LineBasicMaterial({color:o}));return h.renderOrder=this.lineRenderOrder,h}static createBaseDoorNew(e,t,r="outside",n="left",o=0,a=this.thickness,s="",h=""){let c=new i.Group,d=new l.BaseDoorGeometry(t,a,r,n),u=new i.Mesh(d,new i.MeshBasicMaterial({color:16777215})),p=new(0,f.DWHelper)().active(u);return c.add(u,p),c.rotation.z=o,c.position.set(e.x,e.y,this.componentZ),S.addDoorParam(c,t,a,s,h,e,o,"door",r),c.modelPath=url+"/assets/model/door/baseDoor/baseDoor.glb",c}static createDODoorNew(e,t,r="outside",n=0,o=this.thickness,a="",s=""){let l=new i.Group,c=new h.DoubleOpenDoorGeometry(t,o,r),d=new i.Mesh(c,new i.MeshBasicMaterial({color:16777215})),u=new(0,f.DWHelper)().active(d);return l.add(d,u),l.rotation.z=n,l.position.set(e.x,e.y,this.componentZ),S.addDoorParam(l,t,o,a,s,e,n,"doubledoor"),l.modelPath=url+"/assets/model/door/doubleOpenDoor/doubleOpenDoor.glb",l}static createSlidingDoorNew(e,t,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=new c.SlidingDoorGeometry(t,n),h=new i.Mesh(l,new i.MeshBasicMaterial({color:16777215})),d=new(0,f.DWHelper)().active(h);return s.add(h,d),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),S.addDoorParam(s,t,n,o,a,e,r,"slidingdoor"),s.modelPath=url+"/assets/model/door/slidingDoor/slidingDoor.glb",s}static createBaseWindowNew(e,t,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=new d.BaseWindowGeometry(t,n),h=new i.Mesh(l,new i.MeshPhongMaterial({color:16777215})),c=new(0,f.DWHelper)().active(h);return s.add(h,c),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),S.addDoorParam(s,t,n,o,a,e,r,"window"),s.modelPath=url+"/assets/model/window/baseWindow/baseWindow.glb",s}static createPanoramicWindowNew(e,t,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=new u.PanoramicWindowGeometry(t,n);console.log(l);let h=new i.Mesh(l,[new i.MeshBasicMaterial({color:13421772}),new i.MeshBasicMaterial({color:16777215})]),c=new(0,f.DWHelper)().active(h);return s.add(h,c),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),S.addDoorParam(s,t,n,o,a,e,r,"straightBayWindow"),s.modelPath=url+"/assets/model/window/panoramicWindow/panoramicWindow.glb",s}static createFrenchWindowNew(e,t,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=new p.FrenchWindowGeometry(t,n),h=new i.Mesh(l,new i.MeshBasicMaterial({color:16777215})),c=new(0,f.DWHelper)().active(h);return s.add(h,c),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),S.addDoorParam(s,t,n,o,a,e,r,"frenchwindows"),s.modelPath=url+"/assets/model/window/frenchWindow/frenchWindow.glb",s}static createLashDoorNew(e,t=1450,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=new m.LashDoorGeometry(t,n),h=new i.Mesh(l,new i.MeshBasicMaterial({color:16777215})),c=new(0,f.DWHelper)().active(h);return s.add(h,c),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),S.addDoorParam(s,t,n,o,a,e,r,"childMotherDoor"),s.modelPath=url+"/assets/model/door/lashDoor/lashDoor.glb",s}static createPassNew(e,t,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=new g.PassGeometry(t,n),h=new i.Mesh(l,new i.MeshBasicMaterial({color:16777215})),c=new(0,f.DWHelper)().active(h);return s.add(h,c),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),S.addDoorParam(s,t,n,o,a,e,r,"passDoor"),s.modelPath=url+"/assets/model/door/pass/pass1.glb",s}static createSectorDoorNew(e,t,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=new y.SectorDoorGeometry(t,n),h=new i.Mesh(l,new i.MeshBasicMaterial({color:16777215})),c=new(0,f.DWHelper)().active(h);return s.add(h,c),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),S.addDoorParam(s,t,n,o,a,e,r,"archDoor"),s.modelPath=url+"/assets/model/door/sectorDoor/sectorDoor.glb",s}static createSectorWindowNew(e,t,r=0,n=this.thickness,o="",a=""){let s=new i.Group,l=new x.SectorWindowGeometry(t,n),h=new i.Mesh(l,new i.MeshBasicMaterial({color:16777215})),c=new(0,f.DWHelper)().active(h);return s.add(h,c),s.rotation.z=r,s.position.set(e.x,e.y,this.componentZ),S.addDoorParam(s,t,n,o,a,e,r,"archWindow"),s.modelPath=url+"/assets/model/window/sectorWindow/sectorWindow.glb",s}static createArcBaseWindowNew(e,t=!1,r=this.thickness,n=Math.PI/12){let o=new i.Group,a,s,l=1500;if(e=new i.Vector2(e.x,e.y),t){let r=e.clone().sub(t);l=r.length();let o=new i.Vector2(r.x,r.y).angle();a=o-n,s=o+n}else t=new i.Vector2(e.x,e.y).add(new i.Vector2(0,-1).setLength(l)),a=5*Math.PI/12,s=7*Math.PI/12;let h=this.createArc(t,l,a,s,16777215,!0),c=new w.ArcBaseWindowGeometry(t,l,r,a,s),d=new i.Mesh(c,new i.MeshBasicMaterial({color:16777215})),u=new(0,f.DWHelper)().active(d);return o.add(d,u),S.addDoorParam(o,1e3,r,h[0],h[h.length-1],e,n,"arcWindow"),o.startPoint=h[0],o.endPoint=h[h.length-1],o.arcCenter=t,o.position.z=this.componentZ,o.modelPath=url+"/assets/model/window/05/arcWindow.glb",o}static createUWindowNew(e,t,r,n,o=1200,a=1200){let s=new i.Group,l=240,h=240,c=240,d=0,u=2500;if(t&&r&&n){let e,i;l=t.thickness,h=r.thickness,c=n.thickness,u=r.startPoint.distanceTo(r.endPoint)-l/2-c/2;let o=r.startPoint,a=r.endPoint,s=t.startPoint,p=t.endPoint,m=n.startPoint,f=n.endPoint;o.equals(s)||o.equals(p)?e=o:(a.equals(s)||a.equals(p))&&(e=a),o.equals(m)||o.equals(f)?i=o:(a.equals(m)||a.equals(f))&&(i=a),e&&i&&(d=i.clone().sub(e).angle())}let p=new v.UWindowGeometry(u,o,a,l,h,c),m=new i.Mesh(p,new i.MeshBasicMaterial({color:16777215})),g=new(0,f.DWHelper)().active(m);return s.add(m,g),s.rotation.z=d,s.position.set(e.x,e.y,this.componentZ),s.leftWindow=[t,o],s.rightWindow=[n,a],S.addDoorParam(s,u+l+c,h,"","",e,d,"UWindow"),s.modelPath=url+"/assets/model/window/uWindow/uWindow.glb",s}static getHoleJson(e,t){let i=[];return e.forEach(e=>{let r=e.modelType;if(!r)return;let n=e.center,o=e.doorWid,a=e.wallId,l="",h=e.wallDep,c=1*e.floorHei,d=1*e.height;if(r.includes("Door")||r.includes("door"))l={location:{x:n.x,y:n.y,z:d/2+c},width:o,height:d,withSector:!1,offsetXY:0,wallID:a,windowThick:h},e.doorDir&&(l.doorDir=e.doorDir),"archDoor"==r&&(l.withSector=!0),"dooropen"==r&&(l.dir=r);else if(r.includes("Window")||r.includes("window")){if(l={location:{x:n.x,y:n.y,z:d/2+c},width:o,height:d,withSector:!1,offsetXY:0,wallID:a,windowThick:h},"UWindow"==r&&(l.windowThickL=e.leftWindow[1],l.windowThickR=e.rightWindow[1]),"waveWindow"==r&&(l.windowThick+=500),"straightBayWindow"==r&&(l.masterAngle=e.rotation.z,l.windowThick+=500),"archWindow"==r&&(l.withSector=!0),"arcWindow"==r){l.isArc=!0;let t=e.center.clone().sub(e.arcCenter.clone()).angle();l.startRadian=t-e.angle,l.endRadian=t+e.angle,l.positionZ=d/2+c}}else l={location:{x:n.x,y:n.y,z:d/2+c},width:o,height:d,withSector:!1,offsetXY:0,wallID:a,windowThick:h};if("LWindow"==r){let t=e.leftWindow,r=e.rightWindow;l.commonPoint=l.location,l.location={x:t[2].x,y:t[2].y,z:d/2+c},l.width=t[1],l.wallID=t[0].wallID,l.windowThick=t[0].thickness,l.path=t[3],l.diff=t[4];let n=JSON.parse(JSON.stringify(l));n.location={x:r[2].x,y:r[2].y,z:d/2+c},n.width=r[1],n.wallID=r[0].wallID,n.windowThick=r[0].thickness,n.path=r[3],n.diff=r[4],n.uuid=e.uuid,i.push(n)}if("UWindow"==r){let r=t.getWallByWallId(l.wallID),o=(0,s.UtilCore).getSamePointWall(r,t.allWalls),a=r.startPoint,h=(0,s.UtilCore).getMeshOtherPoint(o[1],a);((0,s.UtilCore).isSameVector(o[0].startPoint,a)||(0,s.UtilCore).isSameVector(o[0].endPoint,a))&&(h=(0,s.UtilCore).getMeshOtherPoint(o[0],a));let c=h.clone().sub(a.clone()).setLength(480);l.location.x=n.x+c.x,l.location.y=n.y+c.y;let d=JSON.parse(JSON.stringify(l));d.masterAngle=e.angle,d.width+=1,d.wallID=o[0].wallID,d.dir="UWindow";let u=JSON.parse(JSON.stringify(l));u.wallID=o[1].wallID,u.masterAngle=e.angle,u.width+=1,u.dir="UWindow",i.push(d),i.push(u)}e.modelPath&&(l.path=e.modelPath),e.arcHei&&(l.arcHei=e.arcHei),l.isLock=!!e.isLock,l.uuid=e.uuid,i.push(l)}),i}static memberJson(e){let t=[];return e.forEach(e=>{let i=e.position,r={location:{x:i.x,y:i.y,z:e.depth/2},height:Math.round(e.height*e.scale.y),depth:e.depth,rotation:e.rotation.z,angle:e.angle,type:e.modelType,id:e.id,isLock:!!e.isLock};"beam"==e.modelType&&(r.location.z=window.storeyHei-e.depth/2),"flue"==e.modelType&&(r.location.z=window.storeyHei/2),e.width&&(r.width=Math.round(e.width*e.scale.x)),t.push(r)}),t}static getWallJson(e){let t=[],r=0,n=this.getWallId(e);return 0!=n.length&&(r=Math.max(...n)),e.forEach(e=>{if((0,s.UtilCore).isSameVector(e.startPoint,e.endPoint)||"remove"==e.status)return;e.wallID||(r+=1),t.forEach(t=>{let r=(0,s.UtilCore).handleLineData(t.start,t.end);if(!(0,s.UtilCore).pointInLine(e.startPoint,r))return;let n=new i.Vector2(t.start.x,t.start.y),o=new i.Vector2(t.end.x,t.end.y),a=n.clone().distanceTo(e.startPoint.clone()),l=n.clone().distanceTo(e.endPoint.clone()),h=o.clone().distanceTo(e.startPoint.clone()),c=o.clone().distanceTo(e.endPoint.clone()),d=30;a<=30&&(e.startPoint=n.clone()),l<=d&&(e.endPoint=n.clone()),h<=d&&(e.startPoint=o.clone()),c<=d&&(e.endPoint=o.clone())});let n={start:{x:e.startPoint.x,y:e.startPoint.y,z:0},end:{x:e.endPoint.x,y:e.endPoint.y,z:0},id:e.wallID?e.wallID:r,style:e.style,line:e.line,isArc:e.isArc,thickness:e.thickness,height:e.height,offsetXY:100};e.isArc&&e.cp&&(n.cp={x:1*e.cp.x.toFixed(2),y:1*e.cp.y.toFixed(2),z:0}),t.push(n)}),t}static getModelJson(e,t=[],i=!1){return e.forEach(e=>{let r={},n=editor.getRealSize(e);if(e.imgPath){r={imgPath:e.imgPath,modelPath:e.modelPath,width:n[0]/e.scale.x,height:n[1]/e.scale.y,depth:n[2]/e.scale.z,rotation:e.rotation.y,modelPosition:e.modelPosition,location:{x:e.position.x,y:e.position.y,z:e.position.z},rotate:{x:e.rotation.x,y:e.rotation.y,z:e.rotation.z},scale:{x:e.scale.x,y:e.scale.y,z:e.scale.z},imgLayer:e.param[0].position.z},e.param[0].position.z<=-.1&&(r.imgLayer=-.1),r.isLock=!!e.isLock,t.push(r),e.sliceArr&&(r.sliceArr=e.sliceArr);return}r.child=S.getModelJson(e.children,[],i),r.modelType=e.modelType,r.location={x:e.position.x,y:e.position.y,z:e.position.z},r.isLock=!!e.isLock,r.rotation=e.rotation.y,r.rotate={x:e.rotation.x,y:e.rotation.y,z:e.rotation.z},r.scale={x:e.scale.x,y:e.scale.y,z:e.scale.z},r.width=n[0]/e.scale.x,r.height=n[1]/e.scale.y,r.depth=n[2]/e.scale.z,t.push(r)}),t}static getSplitLineJson(e){let t=[];return e.forEach(e=>{let i={start:{x:1*e.startPoint.x.toFixed(2),y:1*e.startPoint.y.toFixed(2),z:0},end:{x:1*e.endPoint.x.toFixed(2),y:1*e.endPoint.y.toFixed(2),z:0},useType:e.useType};t.push(i)}),t}static getWallId(e){let t=[];return e.forEach(e=>{e.wallID&&t.push(e.wallID)}),t}}}),parcelRequire.register("jizqJ",function(e,t){$parcel$export(e.exports,"BaseDoorGeometry",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class n extends i.BufferGeometry{constructor(e,t,n,o){super(),this.type="BaseDoorGeometry",this.parameters={width:e,height:t,openType:n,openDirection:o};let a=[],s=[],l=[],h=[];function c(e,t,i){return"outside"==t?"right"==i&&(e.x=-e.x):"inside"==t&&("left"==i?e.y=-e.y:"right"==i&&(e.x=-e.x,e.y=-e.y)),e}(function(e,t,r,n){let o=new i.Shape,d=new i.Vector2(e/2,t/2),u=new i.Vector2(e/2,-t/2),p=new i.Vector2(-e/2,-t/2),m=new i.Vector2(-e/2,e),f=new i.Vector2(-e/2+t/2,e),g=new i.Vector2(-e/2+t/2,t/2);[d,u,p,m,f,g].forEach(e=>{e=c(e,r,n)}),o.moveTo(g.x,g.y),[d,u,p,m,f,g].forEach(e=>{o.lineTo(e.x,e.y)});let y=new i.ShapeGeometry(o);a.push(...Array.from(y.index.array)),s.push(...Array.from(y.attributes.position.array)),l.push(...Array.from(y.attributes.normal.array)),h.push(...Array.from(y.attributes.uv.array))})(e,t,n,o),this.setIndex(a),this.setAttribute("position",new r.Float32BufferAttribute(s,3)),this.setAttribute("normal",new r.Float32BufferAttribute(l,3)),this.setAttribute("uv",new r.Float32BufferAttribute(h,2))}}}),parcelRequire.register("7UrFP",function(e,t){$parcel$export(e.exports,"Float32BufferAttribute",()=>h);var i=parcelRequire("1cnge"),r=parcelRequire("90poP"),n=parcelRequire("lYiBp"),o=parcelRequire("fpCf6");let a=new i.Vector3,s=new r.Vector2;class l{constructor(e,t,i){if(Array.isArray(e))throw TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.usage=o.StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,n=this.itemSize;r<n;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)s.fromBufferAttribute(this,t),s.applyMatrix3(e),this.setXY(t,s.x,s.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)a.fromBufferAttribute(this,t),a.applyMatrix3(e),this.setXYZ(t,a.x,a.y,a.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)a.fromBufferAttribute(this,t),a.applyMatrix4(e),this.setXYZ(t,a.x,a.y,a.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)a.fromBufferAttribute(this,t),a.applyNormalMatrix(e),this.setXYZ(t,a.x,a.y,a.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)a.fromBufferAttribute(this,t),a.transformDirection(e),this.setXYZ(t,a.x,a.y,a.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=(0,n.denormalize)(t,this.array)),t}setX(e,t){return this.normalized&&(t=(0,n.normalize)(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=(0,n.denormalize)(t,this.array)),t}setY(e,t){return this.normalized&&(t=(0,n.normalize)(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=(0,n.denormalize)(t,this.array)),t}setZ(e,t){return this.normalized&&(t=(0,n.normalize)(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=(0,n.denormalize)(t,this.array)),t}setW(e,t){return this.normalized&&(t=(0,n.normalize)(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=(0,n.normalize)(t,this.array),i=(0,n.normalize)(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=(0,n.normalize)(t,this.array),i=(0,n.normalize)(i,this.array),r=(0,n.normalize)(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,o){return e*=this.itemSize,this.normalized&&(t=(0,n.normalize)(t,this.array),i=(0,n.normalize)(i,this.array),r=(0,n.normalize)(r,this.array),o=(0,n.normalize)(o,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==o.StaticDrawUsage&&(e.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class h extends l{constructor(e,t,i){super(new Float32Array(e),t,i)}}}),parcelRequire.register("1cnge",function(e,t){$parcel$export(e.exports,"Vector3",()=>n);var i=parcelRequire("lYiBp"),r=parcelRequire("deibi");class n{constructor(e=0,t=0,i=0){n.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(a.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(a.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,n=e.elements,o=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*o,this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*o,this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*o,this}applyQuaternion(e){let t=this.x,i=this.y,r=this.z,n=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*r-a*i,h=s*i+a*t-n*r,c=s*r+n*i-o*t,d=-n*t-o*i-a*r;return this.x=l*s+-(d*n)+-(h*a)- -(c*o),this.y=h*s+-(d*o)+-(c*n)- -(l*a),this.z=c*s+-(d*a)+-(l*o)- -(h*n),this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let i=e.x,r=e.y,n=e.z,o=t.x,a=t.y,s=t.z;return this.x=r*s-n*a,this.y=n*o-i*s,this.z=i*a-r*o,this}projectOnVector(e){let t=e.lengthSq();if(0===t)return this.set(0,0,0);let i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return o.copy(this).projectOnVector(e),this.sub(o)}reflect(e){return this.sub(o.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;let r=this.dot(e)/t;return Math.acos(i.clamp(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){let r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}let o=new n,a=new r.Quaternion}),parcelRequire.register("lYiBp",function(e,t){function i(e,t,i){return Math.max(t,Math.min(i,e))}function r(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw Error("Invalid component type.")}}function n(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw Error("Invalid component type.")}}$parcel$export(e.exports,"clamp",()=>i),$parcel$export(e.exports,"denormalize",()=>r),$parcel$export(e.exports,"normalize",()=>n)}),parcelRequire.register("deibi",function(e,t){$parcel$export(e.exports,"Quaternion",()=>r);var i=parcelRequire("lYiBp");class r{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,n,o,a){let s=i[r+0],l=i[r+1],h=i[r+2],c=i[r+3],d=n[o+0],u=n[o+1],p=n[o+2],m=n[o+3];if(0===a){e[t+0]=s,e[t+1]=l,e[t+2]=h,e[t+3]=c;return}if(1===a){e[t+0]=d,e[t+1]=u,e[t+2]=p,e[t+3]=m;return}if(c!==m||s!==d||l!==u||h!==p){let e=1-a,t=s*d+l*u+h*p+c*m,i=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){let n=Math.sqrt(r),o=Math.atan2(n,t*i);e=Math.sin(e*o)/n,a=Math.sin(a*o)/n}let n=a*i;if(s=s*e+d*n,l=l*e+u*n,h=h*e+p*n,c=c*e+m*n,e===1-a){let e=1/Math.sqrt(s*s+l*l+h*h+c*c);s*=e,l*=e,h*=e,c*=e}}e[t]=s,e[t+1]=l,e[t+2]=h,e[t+3]=c}static multiplyQuaternionsFlat(e,t,i,r,n,o){let a=i[r],s=i[r+1],l=i[r+2],h=i[r+3],c=n[o],d=n[o+1],u=n[o+2],p=n[o+3];return e[t]=a*p+h*c+s*u-l*d,e[t+1]=s*p+h*d+l*c-a*u,e[t+2]=l*p+h*u+a*d-s*c,e[t+3]=h*p-a*c-s*d-l*u,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){let i=e._x,r=e._y,n=e._z,o=e._order,a=Math.cos,s=Math.sin,l=a(i/2),h=a(r/2),c=a(n/2),d=s(i/2),u=s(r/2),p=s(n/2);switch(o){case"XYZ":this._x=d*h*c+l*u*p,this._y=l*u*c-d*h*p,this._z=l*h*p+d*u*c,this._w=l*h*c-d*u*p;break;case"YXZ":this._x=d*h*c+l*u*p,this._y=l*u*c-d*h*p,this._z=l*h*p-d*u*c,this._w=l*h*c+d*u*p;break;case"ZXY":this._x=d*h*c-l*u*p,this._y=l*u*c+d*h*p,this._z=l*h*p+d*u*c,this._w=l*h*c-d*u*p;break;case"ZYX":this._x=d*h*c-l*u*p,this._y=l*u*c+d*h*p,this._z=l*h*p-d*u*c,this._w=l*h*c+d*u*p;break;case"YZX":this._x=d*h*c+l*u*p,this._y=l*u*c+d*h*p,this._z=l*h*p-d*u*c,this._w=l*h*c-d*u*p;break;case"XZY":this._x=d*h*c-l*u*p,this._y=l*u*c-d*h*p,this._z=l*h*p+d*u*c,this._w=l*h*c+d*u*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,i=t[0],r=t[4],n=t[8],o=t[1],a=t[5],s=t[9],l=t[2],h=t[6],c=t[10],d=i+a+c;if(d>0){let e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(h-s)*e,this._y=(n-l)*e,this._z=(o-r)*e}else if(i>a&&i>c){let e=2*Math.sqrt(1+i-a-c);this._w=(h-s)/e,this._x=.25*e,this._y=(r+o)/e,this._z=(n+l)/e}else if(a>c){let e=2*Math.sqrt(1+a-i-c);this._w=(n-l)/e,this._x=(r+o)/e,this._y=.25*e,this._z=(s+h)/e}else{let e=2*Math.sqrt(1+c-i-a);this._w=(o-r)/e,this._x=(n+l)/e,this._y=(s+h)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0):(this._x=0,this._y=-e.z,this._z=e.y)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x),this._w=i,this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(i.clamp(this.dot(e),-1,1)))}rotateTowards(e,t){let i=this.angleTo(e);if(0===i)return this;let r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let i=e._x,r=e._y,n=e._z,o=e._w,a=t._x,s=t._y,l=t._z,h=t._w;return this._x=i*h+o*a+r*l-n*s,this._y=r*h+o*s+n*a-i*l,this._z=n*h+o*l+i*s-r*a,this._w=o*h-i*a-r*s-n*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);let i=this._x,r=this._y,n=this._z,o=this._w,a=o*e._w+i*e._x+r*e._y+n*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=n,this;let s=1-a*a;if(s<=Number.EPSILON){let e=1-t;return this._w=e*o+t*this._w,this._x=e*i+t*this._x,this._y=e*r+t*this._y,this._z=e*n+t*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(s),h=Math.atan2(l,a),c=Math.sin((1-t)*h)/l,d=Math.sin(t*h)/l;return this._w=o*c+this._w*d,this._x=i*c+this._x*d,this._y=r*c+this._y*d,this._z=n*c+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){let e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(n),i*Math.cos(n),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}}),parcelRequire.register("90poP",function(e,t){$parcel$export(e.exports,"Vector2",()=>i);class i{constructor(e=0,t=0){i.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){let e=Math.atan2(-this.y,-this.x)+Math.PI;return e}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*i-o*r+e.x,this.y=n*r+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}}),parcelRequire.register("fpCf6",function(e,t){$parcel$export(e.exports,"StaticDrawUsage",()=>i);let i=35044}),parcelRequire.register("9f3nc",function(e,t){$parcel$export(e.exports,"DoubleOpenDoorGeometry",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class n extends i.BufferGeometry{constructor(e,t,n){super(),this.type="DoubleOpenDoorGeometry",this.parameters={width:e,height:t,openType:n};let o=[],a=[],s=[],l=[];(function(e,t,r){let n=new i.Shape,h=new i.Vector2(e/2-t/2,t/2),c=new i.Vector2(e/2-t/2,e/2),d=new i.Vector2(e/2,e/2),u=new i.Vector2(e/2,-t/2),p=new i.Vector2(-h.x,h.y),m=new i.Vector2(-c.x,c.y),f=new i.Vector2(-d.x,d.y),g=new i.Vector2(-u.x,u.y);"inside"==r&&[h,c,d,u,g,f,m,p].forEach(e=>{e.y=-e.y}),n.moveTo(p.x,p.y),[h,c,d,u,g,f,m,p].forEach(e=>{n.lineTo(e.x,e.y)});let y=new i.ShapeGeometry(n);o.push(...Array.from(y.index.array)),a.push(...Array.from(y.attributes.position.array)),s.push(...Array.from(y.attributes.normal.array)),l.push(...Array.from(y.attributes.uv.array))})(e,t,n),this.setIndex(o),this.setAttribute("position",new r.Float32BufferAttribute(a,3)),this.setAttribute("normal",new r.Float32BufferAttribute(s,3)),this.setAttribute("uv",new r.Float32BufferAttribute(l,2))}}}),parcelRequire.register("5HP0C",function(e,t){$parcel$export(e.exports,"SlidingDoorGeometry",()=>r);var i=parcelRequire("lmKU8");class r extends i.RectangularGeometry{constructor(e,t){super(e,t),this.type="SlidingDoorGeometry",this.parameters={width:e,height:t}}}}),parcelRequire.register("lmKU8",function(e,t){$parcel$export(e.exports,"RectangularGeometry",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class n extends i.BufferGeometry{constructor(e,t){super(),this.parameters={width:e,height:t};let n=[],o=[],a=[],s=[];(function(e,t){let r=new i.Shape,l=new i.Vector2(e/2,t/2),h=new i.Vector2(e/2,-t/2),c=new i.Vector2(-e/2,-t/2),d=new i.Vector2(-e/2,t/2);r.moveTo(d.x,d.y),[l,h,c,d].forEach(e=>{r.lineTo(e.x,e.y)});let u=new i.ShapeGeometry(r);n.push(...Array.from(u.index.array)),o.push(...Array.from(u.attributes.position.array)),a.push(...Array.from(u.attributes.normal.array)),s.push(...Array.from(u.attributes.uv.array))})(e,t),this.setIndex(n),this.setAttribute("position",new r.Float32BufferAttribute(o,3)),this.setAttribute("normal",new r.Float32BufferAttribute(a,3)),this.setAttribute("uv",new r.Float32BufferAttribute(s,2))}}}),parcelRequire.register("kHWob",function(e,t){$parcel$export(e.exports,"BaseWindowGeometry",()=>r);var i=parcelRequire("lmKU8");class r extends i.RectangularGeometry{constructor(e,t){super(e,t),this.type="BaseWindowGeometry",this.parameters={width:e,height:t}}}}),parcelRequire.register("xl6VI",function(e,t){$parcel$export(e.exports,"PanoramicWindowGeometry",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class n extends i.BufferGeometry{constructor(e,t,n=500){super(),this.type="PanoramicWindowGeometry",this.parameters={width:e,thickness:t,platHeight:n};let o=[],a=[],s=[],l=[],h=[];(function(e,t,r){let n=e-t,c=new i.Shape,d=new i.Vector2(-n/2,-t/2),u=new i.Vector2(-n/2,d.y+r),p=new i.Vector2(n/2,u.y),m=new i.Vector2(n/2,-t/2);c.moveTo(m.x,m.y),[d,u,p,m].forEach(e=>{c.lineTo(e.x,e.y)});let f=new i.ShapeGeometry(c);o.push(...Array.from(f.index.array)),a.push(...Array.from(f.attributes.position.array)),s.push(...Array.from(f.attributes.normal.array)),l.push(...Array.from(f.attributes.uv.array)),h.push({start:0,count:f.index.array.length,materialIndex:0});let g=new i.Shape,y=new i.Vector2(-n/2,t/2),x=new i.Vector2(-e/2-t/2,t/2),w=new i.Vector2(-e/2-t/2,t/2+r),b=new i.Vector2(e/2+t/2,t/2+r),v=new i.Vector2(e/2+t/2,t/2),M=new i.Vector2(n/2,t/2);g.moveTo(u.x,u.y),[y,x,w,b,v,M,p,u].forEach(e=>{g.lineTo(e.x,e.y)});let S=new i.ShapeGeometry(g),P=Array.from(S.index.array);for(let e=0;e<P.length;e++)P[e]+=f.attributes.position.array.length/3;o.push(...P),a.push(...Array.from(S.attributes.position.array)),s.push(...Array.from(S.attributes.normal.array)),l.push(...Array.from(S.attributes.uv.array)),h.push({start:f.index.array.length,count:S.index.array.length,materialIndex:1})})(e,t,n),this.setIndex(o),this.setAttribute("position",new r.Float32BufferAttribute(a,3)),this.setAttribute("normal",new r.Float32BufferAttribute(s,3)),this.setAttribute("uv",new r.Float32BufferAttribute(l,2)),this.groups=h}}}),parcelRequire.register("gMe2U",function(e,t){$parcel$export(e.exports,"FrenchWindowGeometry",()=>r);var i=parcelRequire("lmKU8");class r extends i.RectangularGeometry{constructor(e,t){super(e,t),this.type="FrenchWindowGeometry",this.parameters={width:e,height:t}}}}),parcelRequire.register("lUO0N",function(e,t){$parcel$export(e.exports,"LashDoorGeometry",()=>r);var i=parcelRequire("lmKU8");class r extends i.RectangularGeometry{constructor(e,t){super(e,t),this.type="LashDoorGeometry",this.parameters={width:e,height:t}}}}),parcelRequire.register("arwMC",function(e,t){$parcel$export(e.exports,"DWHelper",()=>a);var i=parcelRequire("4xklQ"),r=parcelRequire("7WCxl"),n=parcelRequire("3KKM9"),o=parcelRequire("bnZk5");class a extends n.LineSegments2{constructor(e=new o.LineSegmentsGeometry,t=new r.LineMaterial({color:16777215*Math.random()})){super(e,t),this.type="DWHelper",this.matrixAutoUpdate=!1}active(e,t=0){let i,n;this.object=e;let a=[];switch(this.vertices=a,"BaseDoorGeometry"==e.geometry.type&&(i=.0015,n=!1,this.getBaseDoorVertices(e)),e.geometry.type){case"BaseDoorGeometry":i=.0015,n=!1,this.getBaseDoorVertices(e);break;case"DoubleOpenDoorGeometry":i=.0015,n=!1,this.getDoubleOpenDoorVertices(e);break;case"SlidingDoorGeometry":i=.0015,n=!1,this.getSlidingDoorVertices(e);break;case"BaseWindowGeometry":i=.0015,n=!1,this.getBaseWindowVertices(e);break;case"PanoramicWindowGeometry":i=.001,n=!1,this.getPanoramicWindowVertices(e);break;case"FrenchWindowGeometry":i=.001,n=!1,this.getFrenchWindowVertices(e);break;case"LashDoorGeometry":i=.001,n=!1,this.getLashDoorVertices(e);break;case"PassGeometry":i=.001,n=!1,this.getPassVertices(e);break;case"SectorDoorGeometry":i=.001,n=!1,this.getSectorDoorVertices(e);break;case"SectorWindowGeometry":i=.001,n=!1,this.getSectorWindowVertices(e);break;case"ArcBaseWindowGeometry":i=.001,n=!1,this.getArcBaseWindowVertices(e);break;case"LWindowGeometry":i=.001,n=!1,this.getLWindowVertices(e);break;case"UWindowGeometry":i=.001,n=!1,this.getUWindowVertices(e)}let s=new(0,o.LineSegmentsGeometry)().setPositions(a);return this.geometry.dispose(),this.geometry=s,this.material=new r.LineMaterial({color:t,linewidth:i,dashed:n}),this}getBaseDoorVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,n=e.geometry.parameters.openType,o=e.geometry.parameters.openDirection,a=new i.Vector2(t/2,r/2),s=new i.Vector2(t/2,-r/2),l=new i.Vector2(-t/2,-r/2),h=new i.Vector2(-t/2,t),c=new i.Vector2(-t/2+r/2,t),d=new i.Vector2(-t/2+r/2,0),u=new i.Vector2(-t/2,0);[a,s,l,h,c,d,u].forEach(e=>{e=getNewPoint(e,n,o)}),[a,s,l,h,h,c,c,d,d,u].forEach(e=>{vertices.push(e.x,e.y,0)});let p=getAngle(n,o,"start"),m=getAngle(n,o,"end"),f=new(0,i.Path)().arc(u.x,u.y,t,p,m).getPoints();f.forEach((e,t)=>{t!=f.length-1&&(vertices.push(e.x,e.y,0),vertices.push(f[t+1].x,f[t+1].y,0))})}getNewPoint(e,t,i){return"outside"==t?"right"==i&&(e.x=-e.x):"inside"==t&&("left"==i?e.y=-e.y:"right"==i&&(e.x=-e.x,e.y=-e.y)),e}getAngle(e,t,i){if("outside"==e){if("left"==t){if("start"==i)return 0;if("end"==i)return Math.PI/2}if("right"==t){if("start"==i)return Math.PI/2;if("end"==i)return Math.PI}}if("inside"==e){if("left"==t){if("start"==i)return 3*Math.PI/2;if("end"==i)return 0}if("right"==t){if("start"==i)return Math.PI;if("end"==i)return 3*Math.PI/2}}}getDoubleOpenDoorVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,n=e.geometry.parameters.openType,o=new i.Vector2(t/2,-r/2),a=new i.Vector2(t/2,t/2),s=new i.Vector2(t/2-r/2,t/2),l=new i.Vector2(t/2-r/2,0),h=new i.Vector2(t/2,0),c=new i.Vector2(-o.x,o.y),d=new i.Vector2(-a.x,a.y),u=new i.Vector2(-s.x,s.y),p=new i.Vector2(-l.x,l.y),m=new i.Vector2(-h.x,h.y);"inside"==n&&[o,a,s,l,h,c,d,u,p,m].forEach(e=>{e.y=-e.y}),[o,a,a,s,s,l,l,h].forEach(e=>{vertices.push(e.x,e.y,0)}),[c,d,d,u,u,p,p,m].forEach(e=>{vertices.push(e.x,e.y,0)});let f=m,g=h,y=0,x=Math.PI/2,w=Math.PI;"inside"==n&&(f=h,g=m,y=Math.PI,x=3*Math.PI/2,w=0);let b=new(0,i.Path)().arc(f.x,f.y,t/2,y,x).getPoints();b.forEach((e,t)=>{t!=b.length-1&&(vertices.push(e.x,e.y,0),vertices.push(b[t+1].x,b[t+1].y,0))});let v=new(0,i.Path)().arc(g.x,g.y,t/2,x,w).getPoints();v.forEach((e,t)=>{t!=b.length-1&&(vertices.push(e.x,e.y,0),vertices.push(v[t+1].x,v[t+1].y,0))})}getSlidingDoorVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,n=10,o=2e3,a=2500,s=new i.Vector2(t/2,-r/2),l=new i.Vector2(t/2,r/2),h=new i.Vector2(-t/2,r/2),c=new i.Vector2(-t/2,-r/2);if([s,l,l,h,h,c,c,s].forEach(e=>{vertices.push(e.x,e.y,0)}),t<=o){let e=2*t/3,o=new i.Vector2(n-t/2,0),a=new i.Vector2(o.x,o.y+r/4),s=new i.Vector2(a.x+e,a.y),l=new i.Vector2(s.x,s.y-r/4);[o,a,a,s,s,l,l,o].forEach(e=>{vertices.push(e.x,e.y,0)});let h=new i.Vector2(-o.x,-o.y),c=new i.Vector2(-a.x,-a.y),d=new i.Vector2(-s.x,-s.y),u=new i.Vector2(-l.x,-l.y);[h,c,c,d,d,u,u,h].forEach(e=>{vertices.push(e.x,e.y,0)})}else if(t<=a){let e=2*t/5,o=new i.Vector2(n-t/2,-r/4),a=new i.Vector2(o.x,o.y+r/4),s=new i.Vector2(a.x+e,a.y),l=new i.Vector2(s.x,s.y-r/4);[o,a,a,s,s,l,l,o].forEach(e=>{vertices.push(e.x,e.y,0)});let h=new i.Vector2(-l.x,l.y),c=new i.Vector2(-s.x,s.y),d=new i.Vector2(-a.x,a.y),u=new i.Vector2(-o.x,o.y);[h,c,c,d,d,u,u,h].forEach(e=>{vertices.push(e.x,e.y,0)});let p=new i.Vector2(-e/2,0),m=new i.Vector2(p.x,p.y+r/4),f=new i.Vector2(m.x+e,m.y),g=new i.Vector2(f.x,f.y-r/4);[p,m,m,f,f,g,g,p].forEach(e=>{vertices.push(e.x,e.y,0)})}else{let e=t/4,o=new i.Vector2(n-t/2,-r/4),a=new i.Vector2(o.x,o.y+r/4),s=new i.Vector2(a.x+e,a.y),l=new i.Vector2(s.x,s.y-r/4);[o,a,a,s,s,l,l,o].forEach(e=>{vertices.push(e.x,e.y,0)});let h=new i.Vector2(s.x-e/4,s.y),c=new i.Vector2(h.x,h.y+r/4),d=new i.Vector2(c.x+e,c.y),u=new i.Vector2(d.x,d.y-r/4);[h,c,c,d,d,u,u,h].forEach(e=>{vertices.push(e.x,e.y,0)});let p=new i.Vector2(-o.x,o.y),m=new i.Vector2(-a.x,a.y),f=new i.Vector2(-s.x,s.y),g=new i.Vector2(-l.x,l.y);[p,m,m,f,f,g,g,p].forEach(e=>{vertices.push(e.x,e.y,0)});let y=new i.Vector2(-h.x,h.y),x=new i.Vector2(-c.x,c.y),w=new i.Vector2(-d.x,d.y),b=new i.Vector2(-u.x,u.y);[y,x,x,w,w,b,b,y].forEach(e=>{vertices.push(e.x,e.y,0)})}}getBaseWindowVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,n=new i.Vector2(t/2,0),o=new i.Vector2(t/2,-r/2),a=new i.Vector2(-t/2,-r/2),s=new i.Vector2(-t/2,0),l=[n,o,a,s,new i.Vector2(-t/2,r/2),new i.Vector2(t/2,r/2),n,s];this.getContinuousLine(l)}getPanoramicWindowVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.thickness,n=t-r,o=e.geometry.parameters.platHeight,a=new i.Vector2(-t/2-r/2,r/2),s=new i.Vector2(-t/2-r/2,r/2+o),l=new i.Vector2(t/2+r/2,r/2+o),h=new i.Vector2(t/2+r/2,r/2),c=new i.Vector2(t/2,r/2),d=new i.Vector2(t/2,o),u=new i.Vector2(-t/2,o),p=new i.Vector2(-t/2,r/2),m=new i.Vector2(-n/2,r/2),f=new i.Vector2(-n/2,o-r/2),g=new i.Vector2(n/2,o-r/2),y=new i.Vector2(n/2,r/2),x=new i.Vector2(n/2,-r/2),w=new i.Vector2(-n/2,-r/2),b=[a,s,l,h,c,d,u,p,m,f,g,y,x,w];this.getContinuousLine(b),this.getContinuousLine([a,p]),this.getContinuousLine([c,y]),this.getContinuousLine([m,w])}getFrenchWindowVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,n=new i.Vector2(-t/2,r/2),o=new i.Vector2(t/2,r/2),a=new i.Vector2(t/2,-r/2),s=new i.Vector2(-t/2,-r/2);this.getContinuousLine([n,o,a,s,n]);let l=new i.Vector2(-t/2,r/6),h=new i.Vector2(t/2,r/6);this.getContinuousLine([l,h]);let c=new i.Vector2(-t/2,0),d=new i.Vector2(t/2,0);this.getContinuousLine([c,d]);let u=new i.Vector2(-t/2,-r/6),p=new i.Vector2(t/2,-r/6);this.getContinuousLine([u,p]);let m=new i.Vector2(0,r/6),f=new i.Vector2(0,-r/6);this.getContinuousLine([m,f])}getLashDoorVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,n=new i.Vector2(-t/2,-r/2),o=new i.Vector2(-t/2,r/2),a=new i.Vector2(t/2,r/2),s=new i.Vector2(t/2,-r/2);this.getContinuousLine([n,o,a,s,n]);let l=new i.Vector2(-t/2,-r/6),h=new i.Vector2(-t/2,r/6),c=new i.Vector2(t/2,r/6),d=new i.Vector2(t/2,-r/6),u=new i.Vector2(-t/4,r/6),p=new i.Vector2(-t/4,-r/6);this.getContinuousLine([l,d]),this.getContinuousLine([h,c]),this.getContinuousLine([u,p])}getPassVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,n=new i.Vector2(-t/2,r/2),o=new i.Vector2(t/2,r/2),a=new i.Vector2(t/2,r/6),s=new i.Vector2(-t/2,r/6),l=new i.Vector2(-t/2,-r/6),h=new i.Vector2(t/2,-r/6),c=new i.Vector2(t/2,-r/2),d=new i.Vector2(-t/2,-r/2);this.getContinuousLine([n,o,a,s,n]),this.getContinuousLine([l,h,c,d,l])}getSectorDoorVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,n=new i.Vector2(-t/2,-r/2),o=new i.Vector2(-t/2,r/2),a=new i.Vector2(t/2,r/2),s=new i.Vector2(t/2,-r/2),l=o.clone().add(a).divideScalar(2),h=o.distanceTo(a)/2,c=o.clone().sub(l).angle(),d=a.clone().sub(l).angle(),u=[s,...new(0,i.Path)().arc(l.x,l.y,h,d,c,!1).getPoints(),n];this.getContinuousLine(u)}getSectorWindowVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.height,n=new i.Vector2(-t/2,-r/2),o=new i.Vector2(-t/2,r/2),a=new i.Vector2(t/2,r/2),s=new i.Vector2(t/2,-r/2),l=n.clone().add(s).divideScalar(2),h=o.clone().add(a).divideScalar(2),c=o.distanceTo(a)/2,d=o.clone().sub(h).angle(),u=a.clone().sub(h).angle(),p=[s,...new(0,i.Path)().arc(h.x,h.y,c,u,d,!1).getPoints(),n];this.getContinuousLine(p),this.getContinuousLine([a,o]),this.getContinuousLine([h,l])}getArcBaseWindowVertices(e){let t=e.geometry.parameters.center,r=e.geometry.parameters.radius,n=e.geometry.parameters.thickness,o=e.geometry.parameters.startAngle,a=e.geometry.parameters.endAngle,s=r+n/2,l=r-n/2,h=new(0,i.Path)().arc(t.x,t.y,s,o,a,!1).getPoints(),c=new(0,i.Path)().arc(t.x,t.y,r,o,a,!1).getPoints(),d=new(0,i.Path)().arc(t.x,t.y,l,o,a,!1).getPoints();this.getContinuousLine(h),this.getContinuousLine(c),this.getContinuousLine(d),this.getContinuousLine([d[0],h[0]]),this.getContinuousLine([d[d.length-1],h[h.length-1]])}getLWindowVertices(e){let t=e.geometry.parameters.rightDiff,r=e.geometry.parameters.leftDiff,n=e.geometry.parameters.thicknessR,o=e.geometry.parameters.thicknessL,a=e.geometry.parameters.rightAngle,s=e.geometry.parameters.leftAngle,l=e.geometry.parameters.widthR,h=e.geometry.parameters.widthL,c=new i.Vector3,d=new i.Vector3(-t,n/2,0),u=new i.Vector3(l+t,n/2,0),p=new i.Vector3(l+t,0,0),m=new i.Vector3(l+t,-n/2,0),f=new i.Vector3(t,-n/2,0);[d,u,p,m,f,c].forEach(e=>{e.applyAxisAngle(new i.Vector3(0,0,1),a)}),this.getContinuousLine([d,u,m,f]),this.getContinuousLine([p,c]);let g=new i.Vector3(r,o/2,0),y=new i.Vector3(h+r,o/2,0),x=new i.Vector3(h+r,0,0),w=new i.Vector3(h+r,-o/2,0),b=new i.Vector3(-r,-o/2,0);[g,y,x,w,b].forEach(e=>{e.applyAxisAngle(new i.Vector3(0,0,1),s)}),this.getContinuousLine([g,y,w,b]),this.getContinuousLine([x,c])}getUWindowVertices(e){let t=e.geometry.parameters.width,r=e.geometry.parameters.heightL,n=e.geometry.parameters.heightR,o=e.geometry.parameters.thicknessL,a=e.geometry.parameters.thicknessM,s=e.geometry.parameters.thicknessR,l=new i.Vector2(-t/2,-r-a/2),h=new i.Vector2(l.x-o,l.y),c=new i.Vector2(h.x,h.y+r+a),d=new i.Vector2(c.x+o+t+s,c.y),u=new i.Vector2(d.x,d.y-a-n),p=new i.Vector2(u.x-s,u.y),m=new i.Vector2(p.x,p.y+n),f=new i.Vector2(m.x-t,m.y);this.getContinuousLine([l,h,c,d,u,p,m,f,l]);let g=new i.Vector2(l.x-o/2,l.y),y=new i.Vector2(g.x,0),x=new i.Vector2(t/2+s/2,y.y),w=new i.Vector2(x.x,x.y-a/2-n);this.getContinuousLine([g,y,x,w])}getContinuousLine(e){for(let t=0;t<e.length-1;t++)this.vertices.push(e[t].x,e[t].y,0),this.vertices.push(e[t+1].x,e[t+1].y,0)}}}),parcelRequire.register("8C2VU",function(e,t){$parcel$export(e.exports,"PassGeometry",()=>r);var i=parcelRequire("lmKU8");class r extends i.RectangularGeometry{constructor(e,t){super(e,t),this.type="PassGeometry",this.parameters={width:e,height:t}}}}),parcelRequire.register("1Wv1c",function(e,t){$parcel$export(e.exports,"SectorDoorGeometry",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class n extends i.BufferGeometry{constructor(e,t){super(),this.type="SectorDoorGeometry",this.parameters={width:e,height:t};let n=[],o=[],a=[],s=[];(function(e,t){let r=new i.Shape,l=new i.Vector2(-e/2,-t/2),h=new i.Vector2(-e/2,t/2),c=new i.Vector2(e/2,t/2),d=new i.Vector2(e/2,-t/2),u=h.clone().add(c).divideScalar(2),p=h.distanceTo(c)/2,m=h.clone().sub(u).angle(),f=c.clone().sub(u).angle(),g=[...new(0,i.Path)().arc(u.x,u.y,p,f,m,!1).getPoints(),l,d];r.moveTo(d.x,d.y),g.forEach(e=>{r.lineTo(e.x,e.y)});let y=new i.ShapeGeometry(r);n.push(...Array.from(y.index.array)),o.push(...Array.from(y.attributes.position.array)),a.push(...Array.from(y.attributes.normal.array)),s.push(...Array.from(y.attributes.uv.array))})(e,t),this.setIndex(n),this.setAttribute("position",new r.Float32BufferAttribute(o,3)),this.setAttribute("normal",new r.Float32BufferAttribute(a,3)),this.setAttribute("uv",new r.Float32BufferAttribute(s,2))}}}),parcelRequire.register("eZ4ri",function(e,t){$parcel$export(e.exports,"SectorWindowGeometry",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class n extends i.BufferGeometry{constructor(e,t){super(),this.type="SectorWindowGeometry",this.parameters={width:e,height:t};let n=[],o=[],a=[],s=[];(function(e,t){let r=new i.Shape,l=new i.Vector2(-e/2,-t/2),h=new i.Vector2(-e/2,t/2),c=new i.Vector2(e/2,t/2),d=new i.Vector2(e/2,-t/2),u=h.clone().add(c).divideScalar(2),p=h.distanceTo(c)/2,m=h.clone().sub(u).angle(),f=c.clone().sub(u).angle(),g=[...new(0,i.Path)().arc(u.x,u.y,p,f,m,!1).getPoints(),l,d];r.moveTo(d.x,d.y),g.forEach(e=>{r.lineTo(e.x,e.y)});let y=new i.ShapeGeometry(r);n.push(...Array.from(y.index.array)),o.push(...Array.from(y.attributes.position.array)),a.push(...Array.from(y.attributes.normal.array)),s.push(...Array.from(y.attributes.uv.array))})(e,t),this.setIndex(n),this.setAttribute("position",new r.Float32BufferAttribute(o,3)),this.setAttribute("normal",new r.Float32BufferAttribute(a,3)),this.setAttribute("uv",new r.Float32BufferAttribute(s,2))}}}),parcelRequire.register("bWffP",function(e,t){$parcel$export(e.exports,"ArcBaseWindowGeometry",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class n extends i.BufferGeometry{constructor(e,t,n,o,a){super(),this.type="ArcBaseWindowGeometry",this.parameters={center:e,radius:t,thickness:n,startAngle:o,endAngle:a};let s=[],l=[],h=[],c=[];(function(e,t,r,n,o){let a=t+r/2,d=t-r/2,u=new(0,i.Path)().arc(e.x,e.y,a,n,o,!1).getPoints(),p=new(0,i.Path)().arc(e.x,e.y,d,n,o,!1).getPoints(),m=new i.Shape;m.moveTo(p[0].x,p[0].y),p.reverse().forEach(e=>{u.push(e)}),u.forEach(e=>{m.lineTo(e.x,e.y)});let f=new i.ShapeGeometry(m);s.push(...Array.from(f.index.array)),l.push(...Array.from(f.attributes.position.array)),h.push(...Array.from(f.attributes.normal.array)),c.push(...Array.from(f.attributes.uv.array))})(e,t,n,o,a),this.setIndex(s),this.setAttribute("position",new r.Float32BufferAttribute(l,3)),this.setAttribute("normal",new r.Float32BufferAttribute(h,3)),this.setAttribute("uv",new r.Float32BufferAttribute(c,2))}}}),parcelRequire.register("lDEcB",function(e,t){$parcel$export(e.exports,"LWindowGeometry",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class n extends i.BufferGeometry{constructor(e,t,n,o){super(),this.type="LWindowGeometry",this.parameters={leftWall:e,widthL:n,rightWall:t,widthR:o};let a=this,s=[],l=[],h=[],c=[];function d(e,t){let r=new i.Vector2(e.startPoint.x,e.startPoint.y),n=new i.Vector2(e.endPoint.x,e.endPoint.y),o=new i.Vector2(t.startPoint.x,t.startPoint.y),a=new i.Vector2(t.endPoint.x,t.endPoint.y);return r.equals(o)||r.equals(a)?r:n.equals(o)||n.equals(a)?n:void 0}function u(e,t,r,n,o){let a=new(0,i.Vector2)().subVectors(t,e).normalize(),s=new(0,i.Vector2)().subVectors(r,t).normalize(),l=new(0,i.Vector2)(-s.y,s.x).normalize(),h=o/a.dot(l),c=a.clone().setLength(h),d=new(0,i.Vector2)(-a.y,a.x).normalize(),u=n/s.clone().negate().dot(d),p=s.clone().negate().setLength(u);return c.add(p)}(function(e,t,r,n){let o,p,m,f,g,y,x;if(e&&t){let r,n;let a=d(e,t);y=e.startPoint.x==a.x&&e.startPoint.y==a.y?(r=new i.Vector2(e.endPoint.x,e.endPoint.y)).clone().sub(e.startPoint):(r=new i.Vector2(e.startPoint.x,e.startPoint.y)).clone().sub(e.endPoint),x=t.startPoint.x==a.x&&t.startPoint.y==a.y?(n=new i.Vector2(t.endPoint.x,t.endPoint.y)).clone().sub(t.startPoint):(n=new i.Vector2(t.startPoint.x,t.startPoint.y)).clone().sub(t.endPoint),p=y.angle(),m=x.angle(),o=u(r,a,n,e.thickness,t.thickness).angle(),f=e.thickness,g=t.thickness}else f=240,g=240,y=new i.Vector2(0,-1),x=new i.Vector2(1,0),o=((p=y.angle())+(m=x.angle()))/2;let w=Math.abs(g/2/Math.tan(o>m?o-m:o+2*Math.PI-m)),b=Math.abs(f/2/Math.tan(o<p?Math.PI-p+o:o-p-Math.PI));a.parameters.rightDiff=w,a.parameters.leftDiff=b,a.parameters.thicknessR=g,a.parameters.thicknessL=f,a.parameters.rightAngle=m,a.parameters.leftAngle=p,a.parameters.widthR=n,a.parameters.widthL=r;let v=new i.Vector3(-w,g/2,0),M=new i.Vector3(n+w,g/2,0),S=new i.Vector3(n+w,-g/2,0),P=new i.Vector3(w,-g/2,0),T=new i.Shape,_=P.clone().applyAxisAngle(new i.Vector3(0,0,1),m);T.moveTo(_.x,_.y),[v,M,S,P].forEach(e=>{let t=e.clone().applyAxisAngle(new i.Vector3(0,0,1),m);T.lineTo(t.x,t.y)});let C=new i.ShapeGeometry(T);s.push(...Array.from(C.index.array)),l.push(...Array.from(C.attributes.position.array)),h.push(...Array.from(C.attributes.normal.array)),c.push(...Array.from(C.attributes.uv.array));let D=new i.Vector3(b,f/2,0),A=new i.Vector3(r+b,f/2,0),E=new i.Vector3(r+b,-f/2,0),L=new i.Vector3(-b,-f/2,0),I=new i.Shape,R=L.clone().applyAxisAngle(new i.Vector3(0,0,1),p);I.moveTo(R.x,R.y),[D,A,E,L].forEach(e=>{let t=e.clone().applyAxisAngle(new i.Vector3(0,0,1),p);I.lineTo(t.x,t.y)});let W=new i.ShapeGeometry(I),V=Array.from(W.index.array);for(let e=0;e<V.length;e++)V[e]+=C.attributes.position.array.length/3;s.push(...V),l.push(...Array.from(W.attributes.position.array)),h.push(...Array.from(W.attributes.normal.array)),c.push(...Array.from(W.attributes.uv.array))})(e,t,n,o),this.setIndex(s),this.setAttribute("position",new r.Float32BufferAttribute(l,3)),this.setAttribute("normal",new r.Float32BufferAttribute(h,3)),this.setAttribute("uv",new r.Float32BufferAttribute(c,2))}}}),parcelRequire.register("kKNer",function(e,t){$parcel$export(e.exports,"UWindowGeometry",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("7UrFP");class n extends i.BufferGeometry{constructor(e,t,n,o,a,s){super(),this.type="UWindowGeometry",this.parameters={width:e,heightL:t,heightR:n,thicknessL:o,thicknessM:a,thicknessR:s};let l=[],h=[],c=[],d=[];(function(e,t,r,n,o,a){let s=new i.Vector2(-e/2,-t-o/2),u=new i.Vector2(s.x-n,s.y),p=new i.Vector2(u.x,u.y+t+o),m=new i.Vector2(p.x+n+e+a,p.y),f=new i.Vector2(m.x,m.y-o-r),g=new i.Vector2(f.x-a,f.y),y=new i.Vector2(g.x,g.y+r),x=new i.Vector2(y.x-e,y.y),w=new i.Shape;w.moveTo(x.x,x.y),[s,u,p,m,f,g,y,x].forEach(e=>{w.lineTo(e.x,e.y)});let b=new i.ShapeGeometry(w);l.push(...Array.from(b.index.array)),h.push(...Array.from(b.attributes.position.array)),c.push(...Array.from(b.attributes.normal.array)),d.push(...Array.from(b.attributes.uv.array))})(e,t,n,o,a,s),this.setIndex(l),this.setAttribute("position",new r.Float32BufferAttribute(h,3)),this.setAttribute("normal",new r.Float32BufferAttribute(c,3)),this.setAttribute("uv",new r.Float32BufferAttribute(d,2))}}}),parcelRequire.register("iDVm9",function(e,t){$parcel$export(e.exports,"BeamMesh",()=>o);var i=parcelRequire("9vZPJ"),r=parcelRequire("4xklQ"),n=parcelRequire("hrM0U");class o extends i.Base3DMesh{constructor(e={}){super(),this.type="Group",e.position=e.position?new r.Vector2((0,n.CommonFunc).keepDecimalRound(e.position.x,3),(0,n.CommonFunc).keepDecimalRound(e.position.y,3)):new r.Vector2,e.center=e.position,e.rotation=e.rotation||0,e.thickness=e.thickness||400,e.depth=e.depth||400,e.wallList=e.wallList||[],e.width=e.width||!1,e.model=e.model||"R",e.material=e.material||new r.MeshBasicMaterial({color:16777215}),this.parameter=e,this.parameter.leftWall=[],this.parameter.rightWall=[]}create(){this.getLineData();let e={slope:this.parameter.equation.slope,constant:this.parameter.upConstant},t=this.getIntersectPoint(this.parameter.locationUp,this.parameter.rotationVec,e),i=this.getIntersectPoint(this.parameter.position,this.parameter.rotationVec,this.parameter.equation),o={slope:this.parameter.equation.slope,constant:this.parameter.downConstant},a=this.getIntersectPoint(this.parameter.locationDown,this.parameter.rotationVec,o),s=(0,n.CommonFunc).includeUndefined(t),l=(0,n.CommonFunc).includeUndefined(i),h=(0,n.CommonFunc).includeUndefined(a);if(s||l||h||(this.parameter.leftWall=(0,n.CommonFunc).filterObjArray([t[0].wall.wallID,i[0].wall.wallID,a[0].wall.wallID]),this.parameter.rightWall=(0,n.CommonFunc).filterObjArray([t[1].wall.wallID,i[1].wall.wallID,a[1].wall.wallID])),s||l||h||"R"!=this.parameter.model){let e=new r.Vector2(-this.parameter.width/2,-this.parameter.thickness/2),t=[new r.Vector2(this.parameter.width/2,-this.parameter.thickness/2),new r.Vector2(this.parameter.width/2,this.parameter.thickness/2),new r.Vector2(-this.parameter.width/2,this.parameter.thickness/2),e],i=(0,n.CommonFunc).createShapeByPoints(t,this.parameter.material);i.position.z=10;let o=(0,n.CommonFunc).createLine([...t,t[0]]);this.add(i,o),this.parameter.model="L"}else{let e=[],o=i[0].clone().add(i[1]).multiplyScalar(.5);[t[0],i[0],...a,i[1],t[1]].forEach(t=>{let i=t.clone().sub(o),n=new(0,r.Vector3)(i.x,i.y,0).applyMatrix4(new(0,r.Matrix4)().makeRotationZ(-this.parameter.rotation));e.push(new r.Vector2(n.x,n.y))});let s=(0,n.CommonFunc).createShapeByPoints(e,this.parameter.material);s.position.z=10;let l=(0,n.CommonFunc).createLine([...e,e[0]]);this.add(s,l),this.parameter.center=o,this.parameter.width=parseInt(i[0].distanceTo(i[1]))}this.position.set(this.parameter.center.x,this.parameter.center.y,10),this.rotation.z=this.parameter.rotation}getLineData(){let e=this.parameter.rotation%(2*Math.PI);0==e||e==Math.PI?(this.parameter.equation={slope:"Y",constant:this.parameter.position.y},0==e&&(this.parameter.rotationVec=new r.Vector2(1,0)),e==Math.PI&&(this.parameter.rotationVec=new r.Vector2(-1,0))):e==Math.PI/2||e==3*Math.PI/2?(this.parameter.equation={slope:"X",constant:this.parameter.position.x},e==Math.PI/2&&(this.parameter.rotationVec=new r.Vector2(0,1)),e==3*Math.PI/2&&(this.parameter.rotationVec=new r.Vector2(0,-1))):(this.parameter.equation={slope:Math.round(1e3*Math.tan(this.parameter.rotation))/1e3},this.parameter.equation.constant=this.parameter.position.y-this.parameter.equation.slope*this.parameter.position.x,this.parameter.rotationVec=new r.Vector2(1,this.parameter.equation.slope));let t=new r.Vector2(-this.parameter.rotationVec.y,this.parameter.rotationVec.x);this.parameter.locationUp=this.parameter.position.clone().add(t.setLength(this.parameter.thickness/2)),this.parameter.locationDown=this.parameter.position.clone().add(t.clone().negate()),"X"==this.parameter.equation.slope?(this.parameter.upConstant=this.parameter.locationUp.x,this.parameter.downConstant=this.parameter.locationDown.x):"Y"==this.parameter.equation.slope?(this.parameter.upConstant=this.parameter.locationUp.y,this.parameter.downConstant=this.parameter.locationDown.y):(this.parameter.upConstant=this.parameter.locationUp.y-this.parameter.equation.slope*this.parameter.locationUp.x,this.parameter.downConstant=this.parameter.locationDown.y-this.parameter.equation.slope*this.parameter.locationDown.x)}getIntersectPoint(e,t,i){let o=[],a=[],s,l,h=[],c=[];for(let s=0;s<this.parameter.wallList.length;s++){let l,d=this.parameter.wallList[s],u=Array.from(d.geometry.attributes.position.array),p=new r.Vector2(u[0],u[1]),m=new r.Vector2(u[6],u[7]),f=new r.Vector2(u[9],u[10]),g=new r.Vector2(u[15],u[16]),y=this.getAndCheck(p,f,i),x=this.getAndCheck(m,g,i);if(y&&x?l=e.distanceTo(y)>e.distanceTo(x)?x:y:(y&&(l=y),x&&(l=x)),l){let i=l.clone().sub(e);(0,n.CommonFunc).isSameDirection2(i,t)?(a.push(l),c.push(d)):(o.push(l),h.push(d))}}if(a.length>0){(l=a[0]).wall=c[0];for(let t=1;t<a.length;t++)l.distanceTo(e)>a[t].distanceTo(e)&&((l=a[t]).wall=c[t])}if(o.length>0){(s=o[0]).wall=h[0];for(let t=1;t<o.length;t++)s.distanceTo(e)>o[t].distanceTo(e)&&((s=o[t]).wall=h[t])}return[s,l]}getAndCheck(e,t,i){let r=(0,n.CommonFunc).getLineEquation(e,t),o=(0,n.CommonFunc).getIntersectPoint(i,r);if(o){let i=Math.min(e.x,t.x),r=Math.max(e.x,t.x),n=Math.min(e.y,t.y),a=Math.max(e.y,t.y),s=o.x>=i&&o.x<=r,l=o.y>=n&&o.y<=a;return!!s&&!!l&&o}return!1}setModel(e,t=!1){this.parameter.model=e,t&&this.refresh()}refresh(e={}){e.position&&(this.parameter.position=e.position,this.parameter.center=e.position),e.rotation&&(this.parameter.rotation=e.rotation),e.thickness&&(this.parameter.thickness=e.thickness),e.depth&&(this.parameter.rotation=e.rotation),e.wallList&&(this.parameter.wallList=e.wallList),e.width&&(this.parameter.width=e.width),e.model&&(this.parameter.model=e.model),e.material&&(this.parameter.material=e.material),console.log("refresh",this.angle,this.rotation.z,this.angle!=this.rotation.z,this.parameter.rotation),this.angle!=this.rotation.z&&console.log(this.angle,this.rotation.z,this.parameter.rotation),this.children=[],this.create(),console.log("refresh finish",this.rotation.z)}}}),parcelRequire.register("9vZPJ",function(e,t){$parcel$export(e.exports,"Base3DMesh",()=>o);var i=parcelRequire("4xklQ");parcelRequire("jPMpS");var r=parcelRequire("cTA6h"),n=parcelRequire("9QhXH");class o extends i.Object3D{constructor(){super(),this.type="Base3DMesh"}createLine(e,t=0){this.add((0,n.DM).createLine(e,t))}createBox(e){let t=e.width,r=e.height,n=e.depth,o=new i.BoxGeometry(t,r,n);o.computeBoundingBox();let a=e.material?e.material:new i.MeshStandardMaterial({color:0}),s=o.attributes.position,l=o.attributes.uv,h=o.attributes.normal,c=new i.Vector3(0,0,1),d=new i.Vector3(0,1,0),u=new i.Vector3(1,0,0);for(let e=0;e<s.count;e++){let o=new i.Vector3(h.getX(e),h.getY(e),h.getZ(e));(o.equals(u)||o.equals(u.clone().negate()))&&l.setX(e,l.getX(e)*n/r),(o.equals(c)||o.equals(c.clone().negate()))&&l.setX(e,l.getX(e)*t/r),(o.equals(d)||o.equals(d.clone().negate()))&&(l.setY(e,l.getY(e)*n/t*t/r),l.setX(e,l.getX(e)*t/r))}return new i.Mesh(o,a)}createArchBox(e){let t=e.width,r=e.height+e.width/2,n=e.depth,o=t>r?t:r>n?r:n,a=new i.Shape,s=new i.Vector2(-e.width/2,-e.height/2),l=new i.Vector2(-e.width/2,e.height/2),h=new i.Vector2(e.width/2,-e.height/2),c=new i.Vector2(0,e.height/2);a.moveTo(s.x,s.y),a.lineTo(l.x,l.y),a.absarc(c.x,c.y,e.width/2,Math.PI,0,!0),a.lineTo(h.x,h.y);let d={steps:2,depth:e.depth,bevelEnabled:!0,bevelThickness:0,bevelSize:0,bevelSegments:1},u=new i.ExtrudeGeometry(a,d);u.translate(0,0,-e.depth/2);let p=u.attributes.uv;for(let e=0;e<p.count;e++)p.setX(e,p.getX(e)/o),p.setY(e,p.getY(e)/o);return new i.Mesh(u,e.material)}createDoorstone(){this.parameter.width,this.parameter.depth,this.parameter.width,this.parameter.depth,this.parameter.width,this.parameter.depth,this.parameter.width,this.parameter.depth;let e=new i.PlaneGeometry(this.parameter.width,this.parameter.depth),t=e.attributes.uv;for(let e=0;e<t.count;e++)t.setY(e,t.getY(e)*this.parameter.depth/this.parameter.width*this.parameter.width/this.parameter.height),t.setX(e,t.getX(e)*this.parameter.width/this.parameter.height);let r=this.parameter.editor.config.marbleTexture;r.wrapS=i.RepeatWrapping,r.wrapT=i.RepeatWrapping;let n=new i.MeshStandardMaterial({map:r,side:i.DoubleSide}),o=new i.Mesh(e,n);return o.name="DoorStone",o.rotation.x=-Math.PI/2,o.position.y=-this.parameter.height/2+3,o}createBox_Back(e){let t=e.width/1e3,r=e.height/1e3,n=e.depth/1e3,o=new i.BoxGeometry(t,r,n);o.computeBoundingBox();let a=e.material?e.material:new i.MeshBasicMaterial({color:0});return new i.Mesh(o,a)}createSingleWindow(e,t,r,n){let o={width:e/2+r/2,height:t,depth:n,material:this.parameter.windowTexture||this.parameter.frameTexture},a={width:o.width-2*r,height:o.height-2*r,depth:o.depth,material:this.parameter.mirrorTexture},s=new i.Group,l=this.createBox(o),h=this.createBox(a);l=this.boolean(l,h),a.depth/=4;let c=this.createBox(a);return c.name="glass",c.position.add(new i.Vector3(0,0,-(o.depth-a.depth)/2)),s.add(l,c),s}createTriangle(e){let t=e.width/1e3,r=e.height/1e3,n=e.depth/1e3,o=new i.Vector2(-t/2,-r/2),a=new i.Vector2(t/2,-r/2),s=new i.Vector2(0,r/2),l=new i.Shape;l.moveTo(o.x,o.y),[a,s,o].forEach(e=>{l.lineTo(e.x,e.y)});let h={steps:2,depth:n,bevelEnabled:!1,bevelThickness:1,bevelSize:1,bevelSegments:1},c=new i.ExtrudeGeometry(l,h),d=e.mat?e.mat:16711680,u=new i.Mesh(c,new i.MeshBasicMaterial({color:d}));return u.rotation.x=Math.PI/2,u.position.add(new i.Vector3(0,n/2,0)),u}createShapeOrStereoscopic(e,t,r){let n=e.shift(),o=new i.Shape,a;if(o.moveTo(n.x,n.y),e.forEach(function(e){o.lineTo(e.x,e.y)}),o.lineTo(n.x,n.y),1*t!=0){let e={steps:2,depth:t,bevelEnabled:!1,bevelThickness:1,bevelSize:1,bevelSegments:1},n=new i.ExtrudeGeometry(o,e),s=n.attributes.uv;for(let e=0;e<s.count;e++)s.setX(e,s.getX(e)/t),s.setY(e,s.getY(e)/t);a=new i.Mesh(n,r)}else{let e=new i.ShapeGeometry(o);a=new i.Mesh(e,r)}return a.rotation.x=-Math.PI/2,a}createStyle(e){console.log("Base3DMesh.createStyle")}boolean(e,t,i="subtract"){var n;e.updateMatrix(),t.updateMatrix();let o=(0,r.CSG).fromMesh(e),a=(0,r.CSG).fromMesh(t);if("union"==i)n=o.union(a);else{if(0==o.intersect(a).polygons.length)return!1;"subtract"==i&&(n=o.subtract(a)),"intersect"==i&&(n=o.intersect(a))}return(0,r.CSG).toMesh(n,e.matrix,e.material)}create(){console.log("暂时不支持创建。")}destroy(){this.parent?this.parent.remove(this):console.log("无法删除，没有父级。")}update(){0==this.children.length?console.log("子数组为空，不支持更新。"):(this.children=[],this.create(),this.inheritLayers(this.layers.mask))}setParameter(e,t,i=!1){this.parameter[e]?(this.parameter[e]=t,i&&this.update()):console.log("参数不存在，请检查参数名称。")}setLayers(e,t=this){t.layers.set(e),t.children.forEach(t=>{"Group"==t.type?this.setLayers(e,t):this.setLayer(t,e)})}setLayer(e,t){e.layers.set(t)}enableLayers(e,t=this){t.layers.enable(e),t.children.forEach(t=>{"Group"==t.type?this.enableLayers(e,t):this.enableLayer(t,e)})}enableLayer(e,t){e.layers.enable(t)}inheritLayers(e,t=this){t.layers.mask=e,t.children.forEach(t=>{"Group"==t.type?this.inheritLayers(e,t):this.inheritLayer(t,e)})}inheritLayer(e,t){e.layers.mask=t}setWidth(e,t=!1){this.setParameter("width",e,t)}getWidth(){return this.parameter.width}setHeight(e,t=!1){this.setParameter("height",e,t)}getHeight(){return this.parameter.height}setDepth(e,t=!1){this.setParameter("depth",e,t)}getDepth(){return this.parameter.depth}}}),parcelRequire.register("jPMpS",function(e,t){$parcel$export(e.exports,"CSG",()=>parcelRequire("cTA6h").CSG);var i=parcelRequire("4xklQ"),r=parcelRequire("cTA6h");parcelRequire("i56yD");let{BufferGeometry:n,Vector3:o,Vector2:a}=i;r.CSG.fromGeometry=function(e,t){let i=[];if(e.isGeometry){let n=e.faces,o=e.vertices,a=["a","b","c"];for(let s=0;s<n.length;s++){let l=n[s],h=[];for(let t=0;t<3;t++)h.push(new r.Vertex(o[l[a[t]]],l.vertexNormals[t],e.faceVertexUvs[0][s][t]));i.push(new r.Polygon(h,t))}}else if(e.isBufferGeometry){let n,o=e.attributes.position,a=e.attributes.normal,s=e.attributes.uv,l=e.attributes.color;if(e.index)n=e.index.array;else{n=Array(o.array.length/o.itemSize|0);for(let e=0;e<n.length;e++)n[e]=e}i=Array(n.length/3|0);for(let e=0,h=0,c=n.length;e<c;e+=3,h++){let c=[,,,];for(let t=0;t<3;t++){let i=n[e+t],h=3*i,d=2*i,u=o.array[h],p=o.array[h+1],m=o.array[h+2],f=a.array[h],g=a.array[h+1],y=a.array[h+2];c[t]=new r.Vertex({x:u,y:p,z:m},{x:f,y:g,z:y},s&&{x:s.array[d],y:s.array[d+1],z:0},l&&{x:l.array[d],y:l.array[d+1],z:l.array[d+2]})}i[h]=new r.Polygon(c,t)}}else console.error("Unsupported CSG input type:"+e.type);return(0,r.CSG).fromPolygons(i)};let s=new i.Vector3,l=new i.Matrix3;r.CSG.fromMesh=function(e,t){e.geometry.computeVertexNormals();let i=(0,r.CSG).fromGeometry(e.geometry,t);l.getNormalMatrix(e.matrix);for(let t=0;t<i.polygons.length;t++){let r=i.polygons[t];for(let t=0;t<r.vertices.length;t++){let i=r.vertices[t];i.pos.copy(s.copy(i.pos).applyMatrix4(e.matrix)),i.normal.copy(s.copy(i.normal).applyMatrix3(l))}}return i};let h=e=>({top:0,array:new Float32Array(e),write:function(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y,this.array[this.top++]=e.z}}),c=e=>({top:0,array:new Float32Array(e),write:function(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y}});r.CSG.toGeometry=function(e,t=!0){let r,n=e.polygons;if(t){let e,t,o=0;n.forEach(e=>o+=e.vertices.length-2),r=new i.BufferGeometry;let a=h(9*o),s=h(9*o),l=[];if(n.forEach(i=>{let r=i.vertices,n=r.length;void 0===i.shared||l[i.shared]||(l[i.shared]=[]),n&&(void 0===r[0].color||t||(t=h(9*o)),void 0===r[0].uv||e||(e=c(6*o)));for(let o=3;o<=n;o++)void 0!==i.shared&&l[i.shared].push(a.top/3,a.top/3+1,a.top/3+2),a.write(r[0].pos),a.write(r[o-2].pos),a.write(r[o-1].pos),s.write(r[0].normal),s.write(r[o-2].normal),s.write(r[o-1].normal),e&&r[0].uv&&(e.write(r[0].uv)||e.write(r[o-2].uv)||e.write(r[o-1].uv)),t&&(t.write(r[0].color)||t.write(r[o-2].color)||t.write(r[o-1].color))}),r.setAttribute("position",new i.BufferAttribute(a.array,3)),r.setAttribute("normal",new i.BufferAttribute(s.array,3)),e&&r.setAttribute("uv",new i.BufferAttribute(e.array,2)),t&&r.setAttribute("color",new i.BufferAttribute(t.array,3)),l.length){let e=[],t=0;for(let i=0;i<l.length;i++)r.addGroup(t,l[i].length,i),t+=l[i].length,e=e.concat(l[i]);r.setIndex(e)}}else{let e=(r=new Geometry).vertices,t=r.faceVertexUvs[0];for(let o=0;o<n.length;o++){let a=n[o],s=a.vertices,l=e.length,h=s.length;for(let t=0;t<h;t++)e.push(new i.Vector3().copy(s[t].pos));for(let e=3;e<=h;e++){let n=new i.Face3,o=[];t.push(o);let h=n.vertexNormals;n.a=l,n.b=l+e-2,n.c=l+e-1,h.push(new i.Vector3().copy(s[0].normal)),h.push(new i.Vector3().copy(s[e-2].normal)),h.push(new i.Vector3().copy(s[e-1].normal)),o.push(new i.Vector3().copy(s[0].uv)),o.push(new i.Vector3().copy(s[e-2].uv)),o.push(new i.Vector3().copy(s[e-1].uv)),n.normal=new i.Vector3().copy(a.plane.normal),r.faces.push(n)}}(r=new i.BufferGeometry().fromGeometry(r)).verticesNeedUpdate=r.elementsNeedUpdate=r.normalsNeedUpdate=!0}return r},r.CSG.toMesh=function(e,t,n){let o=(0,r.CSG).toGeometry(e),a=new i.Matrix4().copy(t).invert();o.applyMatrix4(a),o.computeBoundingSphere(),o.computeBoundingBox();let s=new i.Mesh(o,n);return s.matrix.copy(t),s.matrix.decompose(s.position,s.quaternion,s.scale),s.rotation.setFromQuaternion(s.quaternion),s.updateMatrixWorld(),s.castShadow=s.receiveShadow=!0,s}}),parcelRequire.register("cTA6h",function(e,t){$parcel$export(e.exports,"CSG",()=>i),$parcel$export(e.exports,"Vertex",()=>a),$parcel$export(e.exports,"Polygon",()=>l);class i{constructor(){this.polygons=[]}clone(){let e=new i;return e.polygons=this.polygons.map(e=>e.clone()),e}toPolygons(){return this.polygons}union(e){let t=new h(this.clone().polygons),r=new h(e.clone().polygons);return t.clipTo(r),r.clipTo(t),r.invert(),r.clipTo(t),r.invert(),t.build(r.allPolygons()),i.fromPolygons(t.allPolygons())}subtract(e){let t=new h(this.clone().polygons),r=new h(e.clone().polygons);return t.invert(),t.clipTo(r),r.clipTo(t),r.invert(),r.clipTo(t),r.invert(),t.build(r.allPolygons()),t.invert(),i.fromPolygons(t.allPolygons())}intersect(e){let t=new h(this.clone().polygons),r=new h(e.clone().polygons);return t.invert(),r.clipTo(t),r.invert(),t.clipTo(r),r.clipTo(t),t.build(r.allPolygons()),t.invert(),i.fromPolygons(t.allPolygons())}inverse(){let e=this.clone();return e.polygons.forEach(e=>e.flip()),e}}i.fromPolygons=function(e){let t=new i;return t.polygons=e,t};class r{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new r(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}times(e){return this.x*=e,this.y*=e,this.z*=e,this}dividedBy(e){return this.x/=e,this.y/=e,this.z/=e,this}lerp(e,t){return this.add(n.copy(e).sub(this).times(t))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(this.x**2+this.y**2+this.z**2)}normalize(){return this.unit()}cross(e){let t=this,i=t.x,r=t.y,n=t.z,o=e.x,a=e.y,s=e.z;return this.x=r*s-n*a,this.y=n*o-i*s,this.z=i*a-r*o,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}}let n=new r,o=new r;class a{constructor(e,t,i,n){this.pos=new r().copy(e),this.normal=new r().copy(t),i&&(this.uv=new r().copy(i))&&(this.uv.z=0),n&&(this.color=new r().copy(n))}clone(){return new a(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(e,t){return new a(this.pos.clone().lerp(e.pos,t),this.normal.clone().lerp(e.normal,t),this.uv&&e.uv&&this.uv.clone().lerp(e.uv,t),this.color&&e.color&&this.color.clone().lerp(e.color,t))}}class s{constructor(e,t){this.normal=e,this.w=t}clone(){return new s(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(e,t,i,r,o){let a=0,h=1,c=2,d=3,u=0,p=[];for(let t=0;t<e.vertices.length;t++){let i=this.normal.dot(e.vertices[t].pos)-this.w,r=i<-s.EPSILON?c:i>s.EPSILON?h:a;u|=r,p.push(r)}switch(u){case a:(this.normal.dot(e.plane.normal)>0?t:i).push(e);break;case h:r.push(e);break;case c:o.push(e);break;case d:let m=[],f=[];for(let t=0;t<e.vertices.length;t++){let i=(t+1)%e.vertices.length,r=p[t],o=p[i],a=e.vertices[t],s=e.vertices[i];if(r!=c&&m.push(a),r!=h&&f.push(r!=c?a.clone():a),(r|o)==d){let e=(this.w-this.normal.dot(a.pos))/this.normal.dot(n.copy(s.pos).sub(a.pos)),t=a.interpolate(s,e);m.push(t),f.push(t.clone())}}m.length>=3&&r.push(new l(m,e.shared)),f.length>=3&&o.push(new l(f,e.shared))}}}s.EPSILON=1e-5,s.fromPoints=function(e,t,i){let r=n.copy(t).sub(e).cross(o.copy(i).sub(e)).normalize();return new s(r.clone(),r.dot(e))};class l{constructor(e,t){this.vertices=e,this.shared=t,this.plane=s.fromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){return new l(this.vertices.map(e=>e.clone()),this.shared)}flip(){this.vertices.reverse().forEach(e=>e.flip()),this.plane.flip()}}class h{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)}clone(){let e=new h;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map(e=>e.clone()),e}invert(){for(let e=0;e<this.polygons.length;e++)this.polygons[e].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();let e=this.front;this.front=this.back,this.back=e}clipPolygons(e){if(!this.plane)return e.slice();let t=[],i=[];for(let r=0;r<e.length;r++)this.plane.splitPolygon(e[r],t,i,t,i);return this.front&&(t=this.front.clipPolygons(t)),i=this.back?this.back.clipPolygons(i):[],t.concat(i)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}build(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());let t=[],i=[];for(let r=0;r<e.length;r++)this.plane.splitPolygon(e[r],this.polygons,this.polygons,t,i);t.length&&(this.front||(this.front=new h),this.front.build(t)),i.length&&(this.back||(this.back=new h),this.back.build(i))}}i.fromJSON=function(e){return i.fromPolygons(e.polygons.map(e=>new l(e.vertices.map(e=>new a(e.pos,e.normal,e.uv)),e.shared)))}}),parcelRequire.register("i56yD",function(e,t){let i,r;var n=parcelRequire("cTA6h");let o=!1,a=0,s={},l=()=>{let e=new Worker(r);return e.onmessage=function(e){let t=JSON.parse(e.data),r=s[t.taskId];delete s[t.taskId],r.resolve((0,n.CSG).fromJSON(t.result)),i.busy=!1},i={worker:e,busy:!1}},h=()=>o?i&&!i.busy?(i.busy=!0,{then:e=>e(i)}):{then:function(){return this}}:(o=!0,fetch("../csg-lib.js").then(function(e){return e.text().then(function(e){e=e.slice(0,e.lastIndexOf("export"));let t=e+`
                    self.onmessage=(message)=>{
                    let task = JSON.parse(message.data)
                    //console.log("Got task:"+task.op+' '+task.taskId)
                    postMessage(JSON.stringify({
                        taskId:task.taskId,
                        result : CSG.fromJSON(task.a)[task.op](CSG.fromJSON(task.b))
                    }))
                }
                console.log('CSG worker started!')`,i=new Blob([t],{type:"application/javascript"});r=URL.createObjectURL(i)}).then(()=>l())}));n.CSG.doAsync=(e,t,i)=>h().then(r=>{let n={a:e,op:t,b:i,taskId:a};return s[a]=n,a++,n.result=new Promise((e,t)=>{n.resolve=e,r.busy=!0,r.worker.postMessage(JSON.stringify(n))}),n.result})}),parcelRequire.register("edxTF",function(e,t){$parcel$export(e.exports,"pointInPolygon",()=>n);var i=parcelRequire("cYynU"),r=parcelRequire("gLMkr");function n(e,t,n,o){return t.length>0&&Array.isArray(t[0])?(0,r.pointInPolygonNested)(e,t,n,o):(0,i.pointInPolygonFlat)(e,t,n,o)}}),parcelRequire.register("cYynU",function(e,t){$parcel$export(e.exports,"pointInPolygonFlat",()=>i);function i(e,t,i,r){var n=e[0],o=e[1],a=!1;void 0===i&&(i=0),void 0===r&&(r=t.length);for(var s=(r-i)/2,l=0,h=s-1;l<s;h=l++){var c=t[i+2*l+0],d=t[i+2*l+1],u=t[i+2*h+0],p=t[i+2*h+1];d>o!=p>o&&n<(u-c)*(o-d)/(p-d)+c&&(a=!a)}return a}}),parcelRequire.register("gLMkr",function(e,t){$parcel$export(e.exports,"pointInPolygonNested",()=>i);function i(e,t,i,r){var n=e[0],o=e[1],a=!1;void 0===i&&(i=0),void 0===r&&(r=t.length);for(var s=r-i,l=0,h=s-1;l<s;h=l++){var c=t[l+i][0],d=t[l+i][1],u=t[h+i][0],p=t[h+i][1];d>o!=p>o&&n<(u-c)*(o-d)/(p-d)+c&&(a=!a)}return a}}),parcelRequire.register("4RBS5",function(e,t){$parcel$export(e.exports,"Room",()=>a);var i=parcelRequire("4xklQ"),r=parcelRequire("fAsY2"),n=parcelRequire("hrM0U"),o=parcelRequire("fHLr5");class a extends i.Mesh{constructor(e,t){super(e,t),this.useType="room",this.parameter={}}initParams(e=[]){this.computeVertices(),this.computeArea(),this.computeCenter(),this.computeWalls(e)}setName(e){this.parameter.name=e}getName(){return this.parameter.name}computeVertices(){let e=Array.from(this.geometry.attributes.position.array);this.parameter.points=[];for(let t=0;t<e.length;t+=3)this.parameter.points.push(new i.Vector2((0,n.CommonFunc).keepDecimalRound(e[t],2),(0,n.CommonFunc).keepDecimalRound(e[t+1],2)))}computeArea(){this.parameter.area=Math.abs((0,r.ShapeUtils).area(this.parameter.points)/1e6),this.parameter.area=(0,n.CommonFunc).keepDecimalRound(this.parameter.area,2)}computeCenter(){let e=[];this.parameter.points.forEach(t=>{e.push((0,n.CommonFunc).vectorTransformToArray(t,2))}),this.parameter.center=(0,o.polylabel)([e],1)}computeWalls(e){this.parameter.walls=[];for(let t=0;t<this.parameter.points.length;t++){let i=t==this.parameter.points.length-1?0:t+1;e.forEach(e=>{this.vecIsIn(this.parameter.points[t],this.parameter.points[i],e.parameter.points)&&this.parameter.walls.push(e)})}}vecIsIn(e,t,i){let r=!1,n=!1;for(let o=0;o<i.length;o++)e.equals(i[o])&&(r=!0),t.equals(i[o])&&(n=!0);return r&&n}updateVertex(){}}}),parcelRequire.register("fHLr5",function(e,t){$parcel$export(e.exports,"polylabel",()=>r);var i=parcelRequire("imCu5").TinyQueue;function r(e,t,r){t=t||1;for(var a,l,h,c,d=0;d<e[0].length;d++){var u=e[0][d];(!d||u[0]<a)&&(a=u[0]),(!d||u[1]<l)&&(l=u[1]),(!d||u[0]>h)&&(h=u[0]),(!d||u[1]>c)&&(c=u[1])}var p=h-a,m=c-l,f=Math.min(p,m),g=f/2;if(0===f){var y=[a,l];return y.distance=0,y}for(var x=new i(void 0,n),w=a;w<h;w+=f)for(var b=l;b<c;b+=f)x.push(new o(w+g,b+g,g,e));var v=s(e),M=new o(a+p/2,l+m/2,0,e);M.d>v.d&&(v=M);for(var S=x.length;x.length;){var P=x.pop();P.d>v.d&&(v=P,r&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,S)),P.max-v.d<=t||(g=P.h/2,x.push(new o(P.x-g,P.y-g,g,e)),x.push(new o(P.x+g,P.y-g,g,e)),x.push(new o(P.x-g,P.y+g,g,e)),x.push(new o(P.x+g,P.y+g,g,e)),S+=4)}r&&(console.log("num probes: "+S),console.log("best distance: "+v.d));var T=[v.x,v.y];return T.distance=v.d,T}function n(e,t){return t.max-e.max}function o(e,t,i,r){this.x=e,this.y=t,this.h=i,this.d=a(e,t,r),this.max=this.d+this.h*Math.SQRT2}function a(e,t,i){for(var r=!1,n=1/0,o=0;o<i.length;o++)for(var a=i[o],s=0,h=a.length,c=h-1;s<h;c=s++){var d=a[s],u=a[c];d[1]>t!=u[1]>t&&e<(u[0]-d[0])*(t-d[1])/(u[1]-d[1])+d[0]&&(r=!r),n=Math.min(n,l(e,t,d,u))}return 0===n?0:(r?1:-1)*Math.sqrt(n)}function s(e){for(var t=0,i=0,r=0,n=e[0],a=0,s=n.length,l=s-1;a<s;l=a++){var h=n[a],c=n[l],d=h[0]*c[1]-c[0]*h[1];i+=(h[0]+c[0])*d,r+=(h[1]+c[1])*d,t+=3*d}return 0===t?new o(n[0][0],n[0][1],0,e):new o(i/t,r/t,0,e)}function l(e,t,i,r){var n=i[0],o=i[1],a=r[0]-n,s=r[1]-o;if(0!==a||0!==s){var l=((e-n)*a+(t-o)*s)/(a*a+s*s);l>1?(n=r[0],o=r[1]):l>0&&(n+=a*l,o+=s*l)}return(a=e-n)*a+(s=t-o)*s}i.default&&(i=i.default)}),parcelRequire.register("imCu5",function(e,t){$parcel$export(e.exports,"TinyQueue",()=>i);class i{constructor(e=[],t=r){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;let e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:t,compare:i}=this,r=t[e];for(;e>0;){let n=e-1>>1,o=t[n];if(i(r,o)>=0)break;t[e]=o,e=n}t[e]=r}_down(e){let{data:t,compare:i}=this,r=this.length>>1,n=t[e];for(;e<r;){let r=(e<<1)+1,o=t[r],a=r+1;if(a<this.length&&0>i(t[a],o)&&(r=a,o=t[a]),i(o,n)>=0)break;t[e]=o,e=r}t[e]=n}}function r(e,t){return e<t?-1:e>t?1:0}}),parcelRequire.register("fTgj6",function(e,t){$parcel$export(e.exports,"FlueMesh",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("hrM0U");class n extends i.Mesh{constructor(e,t){super(e,t),this.type="FlueMesh"}hollow(){let e=this.geometry.clone();e.scale(.618,.618,1);let t=new i.Mesh(e,this.material),n=(0,r.CommonFunc).boolean(this,t);this.geometry=n.geometry}}}),parcelRequire.register("eTLBN",function(e,t){$parcel$export(e.exports,"BOOLEAN_UNION",()=>f),$parcel$export(e.exports,"BOOLEAN_INTERSECT",()=>g),$parcel$export(e.exports,"BOOLEAN_SUBTRACT",()=>y),$parcel$export(e.exports,"unify",()=>x),$parcel$export(e.exports,"subtract",()=>w),$parcel$export(e.exports,"intersect",()=>b),$parcel$export(e.exports,"innerClip",()=>v),$parcel$export(e.exports,"outerClip",()=>M),$parcel$export(e.exports,"calculateIntersections",()=>S),$parcel$export(e.exports,"removeNotRelevantChains",()=>L),$parcel$export(e.exports,"removeOldFaces",()=>W),$parcel$export(e.exports,"restoreFaces",()=>V);var i=parcelRequire("74DoM"),r=parcelRequire("6hnWE"),n=parcelRequire("dO5eK"),o=parcelRequire("h7REi"),a=parcelRequire("9PYw6");let{INSIDE:s,OUTSIDE:l,BOUNDARY:h,OVERLAP_SAME:c,OVERLAP_OPPOSITE:d}=n,{NOT_VERTEX:u,START_VERTEX:p,END_VERTEX:m}=n,f=1,g=2,y=3;function x(e,t){let[i,r]=_(e,t,f,!0);return i}function w(e,t){let[i,r]=_(e,t.clone().reverse(),y,!0);return i}function b(e,t){let[i,r]=_(e,t,g,!0);return i}function v(e,t){let[i,r]=_(e,t,g,!1),n=[];for(let e of i.faces)n=[...n,...[...e.edges].map(e=>e.shape)];let o=[];for(let e of r.faces)o=[...o,...[...e.edges].map(e=>e.shape)];return[n,o]}function M(e,t){let[i,r]=_(e,t,y,!1),n=[];for(let e of i.faces)n=[...n,...[...e.edges].map(e=>e.shape)];return n}function S(e,t){let i=e.clone(),r=t.clone(),n=C(i,r);return(0,a.sortIntersections)(n),(0,a.splitByIntersections)(i,n.int_points1_sorted),(0,a.splitByIntersections)(r,n.int_points2_sorted),(0,a.filterDuplicatedIntersections)(n),(0,a.sortIntersections)(n),[n.int_points1_sorted.map(e=>e.pt),n.int_points2_sorted.map(e=>e.pt)]}function P(e,t,i,r){let n=D(e,i.int_points1),o=D(t,i.int_points2);for(A(n,t),A(o,e),(0,a.initializeInclusionFlags)(i.int_points1),(0,a.initializeInclusionFlags)(i.int_points2),(0,a.calculateInclusionFlags)(i.int_points1,t),(0,a.calculateInclusionFlags)(i.int_points2,e);E(e,t,i.int_points1,i.int_points1_sorted,i.int_points2,i););(0,a.setOverlappingFlags)(i),L(e,r,i.int_points1_sorted,!0),L(t,r,i.int_points2_sorted,!1),k(e,n,r,!0),k(t,o,r,!1)}function T(e,t,i,r){I(e,t,r,i.int_points2),R(e,t,i),W(e,i.int_points1),W(t,i.int_points2),V(e,i.int_points1,i.int_points2),V(e,i.int_points2,i.int_points1)}function _(e,t,i,r){let n=e.clone(),o=t.clone(),s=C(n,o);return(0,a.sortIntersections)(s),(0,a.splitByIntersections)(n,s.int_points1_sorted),(0,a.splitByIntersections)(o,s.int_points2_sorted),(0,a.filterDuplicatedIntersections)(s),(0,a.sortIntersections)(s),P(n,o,s,i),r&&T(n,o,s,i),[n,o]}function C(e,t){let i={int_points1:[],int_points2:[]};for(let r of e.edges)for(let e of t.edges.search(r.box))for(let t of r.shape.intersect(e.shape))(0,a.addToIntPoints)(r,t,i.int_points1),(0,a.addToIntPoints)(e,t,i.int_points2);return i}function D(e,t){let i=[];for(let r of e.faces)t.find(e=>e.face===r)||i.push(r);return i}function A(e,t){for(let i of e)i.first.bv=i.first.bvStart=i.first.bvEnd=void 0,i.first.setInclusion(t)}function E(e,t,n,o,c,d){let u,f,g;let y=o.length,x=!1;for(let w=0;w<y;w++){let b,v=o[w];v.face!==u&&(f=w,u=v.face);let M=w,S=(0,a.intPointsPoolCount)(o,w,u);b=M+S<y&&o[M+S].face===u?M+S:f;let P=(0,a.intPointsPoolCount)(o,b,u);g=null;for(let e=b;e<b+P;e++){let t=o[e];if(t.face===u&&c[t.id].face===c[v.id].face){g=t;break}}if(null===g)continue;let T=v.edge_after,_=g.edge_before;if(T.bv===h&&_.bv!=h){T.bv=_.bv;continue}if(T.bv!=h&&_.bv===h){_.bv=T.bv;continue}if(T.bv===h&&_.bv===h&&T!=_||T.bv===s&&_.bv===l||T.bv===l&&_.bv===s){let e=T.next;for(;e!=_;)e.bvStart=void 0,e.bvEnd=void 0,e.bv=void 0,e.setInclusion(t),e=e.next}if(T.bv===h&&_.bv===h&&T!=_){let e,t=T.next;for(;t!=_;){if(t.bv!=h){if(void 0===e)e=t.bv;else if(t.bv!=e)throw r.default.UNRESOLVED_BOUNDARY_CONFLICT}t=t.next}void 0!=e&&(T.bv=e,_.bv=e);continue}if(T.bv===s&&_.bv===l||T.bv===l&&_.bv===s){let o=T;for(;o!=_;){if(o.bvStart===T.bv&&o.bvEnd===_.bv){let[r,s]=o.shape.distanceTo(t);if(r<10*i.default.DP_TOL){(0,a.addToIntPoints)(o,s.ps,n);let i=n[n.length-1];if(i.is_vertex&p)i.edge_after=o,i.edge_before=o.prev,o.bvStart=h,o.bv=void 0,o.setInclusion(t);else if(i.is_vertex&m)i.edge_after=o.next,o.bvEnd=h,o.bv=void 0,o.setInclusion(t);else{let e=t.addVertex(i.pt,o);i.edge_before=e,i.edge_after=e.next,e.setInclusion(t),e.next.bvStart=h,e.next.bvEnd=void 0,e.next.bv=void 0,e.next.setInclusion(t)}let r=t.findEdgeByPoint(s.pe);(0,a.addToIntPoints)(r,s.pe,c);let l=c[c.length-1];if(l.is_vertex&p)l.edge_after=r,l.edge_before=r.prev;else if(l.is_vertex&m)l.edge_after=r.next;else{let i=c.find(e=>e.edge_after===r),n=t.addVertex(l.pt,r);l.edge_before=n,l.edge_after=n.next,i&&(i.edge_after=n),n.bvStart=void 0,n.bvEnd=h,n.bv=void 0,n.setInclusion(e),n.next.bvStart=h,n.next.bvEnd=void 0,n.next.bv=void 0,n.next.setInclusion(e)}(0,a.sortIntersections)(d),x=!0;break}}o=o.next}if(x)break;throw r.default.UNRESOLVED_BOUNDARY_CONFLICT}}return x}function L(e,t,i,r){let n,o,u,p;if(i)for(let m=0;m<i.length;m++){let x;if((n=i[m]).face!==u&&(p=m,u=n.face),u.isEmpty())continue;let w=m,b=(0,a.intPointsPoolCount)(i,m,u);x=w+b<i.length&&i[w+b].face===n.face?w+b:p,o=i[x];let v=x,M=(0,a.intPointsPoolCount)(i,v,u),S=n.edge_after,P=o.edge_before;if(S.bv===s&&P.bv===s&&t===f||S.bv===l&&P.bv===l&&t===g||(S.bv===l||P.bv===l)&&t===y&&!r||(S.bv===s||P.bv===s)&&t===y&&r||S.bv===h&&P.bv===h&&S.overlap&c&&r||S.bv===h&&P.bv===h&&S.overlap&d){e.removeChain(u,S,P);for(let e=w;e<w+b;e++)i[e].edge_after=void 0;for(let e=v;e<v+M;e++)i[e].edge_before=void 0}m+=b-1}}function I(e,t,i,r){for(let i of t.faces){for(let t of i)e.edges.add(t);void 0===r.find(e=>e.face===i)&&e.addFace(i.first,i.last)}}function R(e,t,i){if(0!==i.int_points1.length)for(let e=0;e<i.int_points1.length;e++){let t=i.int_points1[e],r=i.int_points2[e];if(void 0!==t.edge_before&&void 0===t.edge_after&&void 0===r.edge_before&&void 0!==r.edge_after&&(t.edge_before.next=r.edge_after,r.edge_after.prev=t.edge_before,t.edge_after=r.edge_after,r.edge_before=t.edge_before),void 0!==r.edge_before&&void 0===r.edge_after&&void 0===t.edge_before&&void 0!==t.edge_after&&(r.edge_before.next=t.edge_after,t.edge_after.prev=r.edge_before,r.edge_after=t.edge_after,t.edge_before=r.edge_before),void 0!==t.edge_before&&void 0===t.edge_after)for(let e of i.int_points1_sorted)e!==t&&void 0===e.edge_before&&void 0!==e.edge_after&&e.pt.equalTo(t.pt)&&(t.edge_before.next=e.edge_after,e.edge_after.prev=t.edge_before,t.edge_after=e.edge_after,e.edge_before=t.edge_before);if(void 0!==r.edge_before&&void 0===r.edge_after)for(let e of i.int_points2_sorted)e!==r&&void 0===e.edge_before&&void 0!==e.edge_after&&e.pt.equalTo(r.pt)&&(r.edge_before.next=e.edge_after,e.edge_after.prev=r.edge_before,r.edge_after=e.edge_after,e.edge_before=r.edge_before)}}function W(e,t){for(let i of t)e.faces.delete(i.face),i.face=void 0,i.edge_before&&(i.edge_before.face=void 0),i.edge_after&&(i.edge_after.face=void 0)}function V(e,t,i){for(let r of t){if(void 0===r.edge_before||void 0===r.edge_after||r.face||r.edge_after.face||r.edge_before.face)continue;let n=r.edge_after,a=r.edge_before;(0,o.default).testInfiniteLoop(n);let s=e.addFace(n,a);for(let e of t)e.edge_before&&e.edge_after&&e.edge_before.face===s&&e.edge_after.face===s&&(e.face=s);for(let e of i)e.edge_before&&e.edge_after&&e.edge_before.face===s&&e.edge_after.face===s&&(e.face=s)}}function k(e,t,i,r){for(let n of t){let t=n.first.bv;(i===f&&t===s||i===y&&t===s&&r||i===y&&t===l&&!r||i===g&&t===l)&&e.deleteFace(n)}}}),parcelRequire.register("74DoM",function(e,t){$parcel$export(e.exports,"default",()=>o);var i=parcelRequire("dO5eK"),r=parcelRequire("iuBjM");let n={Utils:r,Errors:parcelRequire("6hnWE").default,Matrix:void 0,Planar_set:void 0,Point:void 0,Vector:void 0,Line:void 0,Circle:void 0,Segment:void 0,Arc:void 0,Box:void 0,Edge:void 0,Face:void 0,Ray:void 0,Ray_shooting:void 0,Multiline:void 0,Polygon:void 0,Distance:void 0,Inversion:void 0};for(let e in i)n[e]=i[e];Object.defineProperty(n,"DP_TOL",{get:function(){return r.getTolerance()},set:function(e){r.setTolerance(e)}});var o=n}),parcelRequire.register("dO5eK",function(e,t){$parcel$export(e.exports,"CCW",()=>i),$parcel$export(e.exports,"CW",()=>r),$parcel$export(e.exports,"ORIENTATION",()=>n),$parcel$export(e.exports,"PIx2",()=>o),$parcel$export(e.exports,"INSIDE",()=>a),$parcel$export(e.exports,"OUTSIDE",()=>s),$parcel$export(e.exports,"BOUNDARY",()=>l),$parcel$export(e.exports,"CONTAINS",()=>h),$parcel$export(e.exports,"INTERLACE",()=>c),$parcel$export(e.exports,"OVERLAP_SAME",()=>d),$parcel$export(e.exports,"OVERLAP_OPPOSITE",()=>u),$parcel$export(e.exports,"NOT_VERTEX",()=>p),$parcel$export(e.exports,"START_VERTEX",()=>m),$parcel$export(e.exports,"END_VERTEX",()=>f);let i=!0,r=!1,n={CCW:-1,CW:1,NOT_ORIENTABLE:0},o=2*Math.PI,a=1,s=0,l=2,h=3,c=4,d=1,u=2,p=0,m=1,f=2}),parcelRequire.register("iuBjM",function(e,t){$parcel$export(e.exports,"setTolerance",()=>r),$parcel$export(e.exports,"getTolerance",()=>n),$parcel$export(e.exports,"DECIMALS",()=>o),$parcel$export(e.exports,"EQ_0",()=>a),$parcel$export(e.exports,"EQ",()=>s),$parcel$export(e.exports,"GT",()=>l),$parcel$export(e.exports,"GE",()=>h),$parcel$export(e.exports,"LT",()=>c),$parcel$export(e.exports,"LE",()=>d);let i=1e-6;function r(e){i=e}function n(){return i}let o=3;function a(e){return e<i&&e>-i}function s(e,t){return e-t<i&&e-t>-i}function l(e,t){return e-t>i}function h(e,t){return e-t>-i}function c(e,t){return e-t<-i}function d(e,t){return e-t<i}}),parcelRequire.register("6hnWE",function(e,t){$parcel$export(e.exports,"default",()=>r);class i{static get ILLEGAL_PARAMETERS(){return ReferenceError("Illegal Parameters")}static get ZERO_DIVISION(){return Error("Zero division")}static get UNRESOLVED_BOUNDARY_CONFLICT(){return Error("Unresolved boundary conflict in boolean operation")}static get INFINITE_LOOP(){return Error("Infinite loop")}}var r=i}),parcelRequire.register("h7REi",function(e,t){$parcel$export(e.exports,"default",()=>n);var i=parcelRequire("74DoM");class r{constructor(e,t){this.first=e,this.last=t||this.first}[Symbol.iterator](){let e;return{next:()=>({value:e=e?e.next:this.first,done:void 0===e})}}get size(){let e=0;for(let t of this)e++;return e}toArray(e,t){let i=[],r=e||this.first,n=t||this.last,o=r;if(void 0===o)return i;do i.push(o),o=o.next;while(o!==n.next)return i}append(e){return this.isEmpty()?this.first=e:(e.prev=this.last,this.last.next=e),this.last=e,this.last.next=void 0,this.first.prev=void 0,this}insert(e,t){if(this.isEmpty())this.first=e,this.last=e;else if(null==t)e.next=this.first,this.first.prev=e,this.first=e;else{let i=t.next;t.next=e,i&&(i.prev=e),e.prev=t,e.next=i,this.last===t&&(this.last=e)}return this.last.next=void 0,this.first.prev=void 0,this}remove(e){return e===this.first&&e===this.last?(this.first=void 0,this.last=void 0):(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e===this.first&&(this.first=e.next),e===this.last&&(this.last=e.prev)),this}isEmpty(){return void 0===this.first}static testInfiniteLoop(e){let t=e,r=e;do{if(t!=e&&t===r)throw i.default.Errors.INFINITE_LOOP;t=t.next,r=r.next.next}while(t!=e)}}var n=r}),parcelRequire.register("9PYw6",function(e,t){$parcel$export(e.exports,"addToIntPoints",()=>n),$parcel$export(e.exports,"sortIntersections",()=>o),$parcel$export(e.exports,"filterDuplicatedIntersections",()=>l),$parcel$export(e.exports,"initializeInclusionFlags",()=>h),$parcel$export(e.exports,"calculateInclusionFlags",()=>c),$parcel$export(e.exports,"setOverlappingFlags",()=>d),$parcel$export(e.exports,"intPointsPoolCount",()=>u),$parcel$export(e.exports,"splitByIntersections",()=>p);var i=parcelRequire("iuBjM"),r=parcelRequire("dO5eK");function n(e,t,n){let o=n.length,a=e.shape.split(t);if(0===a.length)return;let s=0;s=null===a[0]?0:null===a[1]?e.shape.length:a[0].length;let l=r.NOT_VERTEX;i.EQ(s,0)&&(l|=r.START_VERTEX),i.EQ(s,e.shape.length)&&(l|=r.END_VERTEX);let h=l&r.END_VERTEX&&0===e.next.arc_length?0:e.arc_length+s;n.push({id:o,pt:t,arc_length:h,edge_before:e,edge_after:void 0,face:e.face,is_vertex:l})}function o(e){e.int_points1_sorted=a(e.int_points1),e.int_points2_sorted=a(e.int_points2)}function a(e){let t=new Map,i=0;for(let r of e)!t.has(r.face)&&(t.set(r.face,i),i++);for(let i of e)i.faceId=t.get(i.face);return e.slice().sort(s)}function s(e,t){return e.faceId<t.faceId?-1:e.faceId>t.faceId?1:e.arc_length<t.arc_length?-1:e.arc_length>t.arc_length?1:0}function l(e){let t,r,n,o;if(e.int_points1.length<2)return;let a=!1;for(let s=0;s<e.int_points1_sorted.length;s++)if(-1!==e.int_points1_sorted[s].id){t=e.int_points1_sorted[s],r=e.int_points2[t.id];for(let l=s+1;l<e.int_points1_sorted.length&&(n=e.int_points1_sorted[l],i.EQ(n.arc_length,t.arc_length));l++)-1!==n.id&&-1!==(o=e.int_points2[n.id]).id&&n.edge_before===t.edge_before&&n.edge_after===t.edge_after&&o.edge_before===r.edge_before&&o.edge_after===r.edge_after&&(n.id=-1,o.id=-1,a=!0)}r=e.int_points2_sorted[0],t=e.int_points1[r.id];for(let n=1;n<e.int_points2_sorted.length;n++){let o=e.int_points2_sorted[n];if(-1==o.id)continue;if(-1==r.id||!i.EQ(o.arc_length,r.arc_length)){r=o,t=e.int_points1[r.id];continue}let s=e.int_points1[o.id];s.edge_before===t.edge_before&&s.edge_after===t.edge_after&&o.edge_before===r.edge_before&&o.edge_after===r.edge_after&&(s.id=-1,o.id=-1,a=!0)}a&&(e.int_points1=e.int_points1.filter(e=>e.id>=0),e.int_points2=e.int_points2.filter(e=>e.id>=0),e.int_points1.forEach((e,t)=>e.id=t),e.int_points2.forEach((e,t)=>e.id=t))}function h(e){for(let t of e)t.edge_before.bvStart=void 0,t.edge_before.bvEnd=void 0,t.edge_before.bv=void 0,t.edge_before.overlap=void 0,t.edge_after.bvStart=void 0,t.edge_after.bvEnd=void 0,t.edge_after.bv=void 0,t.edge_after.overlap=void 0;for(let t of e)t.edge_before.bvEnd=r.BOUNDARY,t.edge_after.bvStart=r.BOUNDARY}function c(e,t){for(let i of e)i.edge_before.setInclusion(t),i.edge_after.setInclusion(t)}function d(e){let t,i,n;let o=e.int_points1.length;for(let a=0;a<o;a++){let s,l=e.int_points1_sorted[a];l.face!==t&&(i=a,t=l.face);let h=a,c=u(e.int_points1_sorted,a,t);s=h+c<o&&e.int_points1_sorted[h+c].face===t?h+c:i;let d=u(e.int_points1_sorted,s,t);n=null;for(let i=s;i<s+d;i++){let r=e.int_points1_sorted[i];if(r.face===t&&e.int_points2[r.id].face===e.int_points2[l.id].face){n=r;break}}if(null===n)continue;let p=l.edge_after,m=n.edge_before;if(!(p.bv===r.BOUNDARY&&m.bv===r.BOUNDARY)||p!==m)continue;let f=e.int_points2[l.id],g=e.int_points2[n.id],y=f.edge_after,x=g.edge_before;y.bv===r.BOUNDARY&&x.bv===r.BOUNDARY&&y===x||(f=e.int_points2[n.id],g=e.int_points2[l.id],y=f.edge_after,x=g.edge_before),y.bv===r.BOUNDARY&&x.bv===r.BOUNDARY&&y===x&&p.setOverlap(y)}}function u(e,t,i){let r,n;let o=1;if(1==e.length)return 1;r=e[t];for(let a=t+1;a<e.length&&r.face==i&&(n=e[a]).pt.equalTo(r.pt)&&n.edge_before===r.edge_before&&n.edge_after===r.edge_after;a++)o++;return o}function p(e,t){if(t){for(let i of t){let t=i.edge_before;if(i.is_vertex=r.NOT_VERTEX,t.shape.start&&t.shape.start.equalTo(i.pt)&&(i.is_vertex|=r.START_VERTEX),t.shape.end&&t.shape.end.equalTo(i.pt)&&(i.is_vertex|=r.END_VERTEX),i.is_vertex&r.START_VERTEX){i.edge_before=t.prev,i.is_vertex=r.END_VERTEX;continue}if(i.is_vertex&r.END_VERTEX)continue;let n=e.addVertex(i.pt,t);i.edge_before=n}for(let e of t)e.edge_after=e.edge_before.next}}}),parcelRequire.register("5sV3G",function(module,exports){$parcel$export(module.exports,"DigHole",()=>DigHole);var $4xklQ=parcelRequire("4xklQ");parcelRequire("jPMpS");var $cTA6h=parcelRequire("cTA6h"),$hu0fb=parcelRequire("hu0fb"),$9QhXH=parcelRequire("9QhXH"),$4xgHd=parcelRequire("4xgHd"),$7BJhL=parcelRequire("7BJhL"),$6Hryq=parcelRequire("6Hryq"),$94t2y=parcelRequire("94t2y"),$ckwVR=parcelRequire("ckwVR"),$4J2OP=parcelRequire("4J2OP");$4xklQ.BufferGeometry.prototype.computeBoundsTree=$4J2OP.computeBoundsTree,$4xklQ.BufferGeometry.prototype.disposeBoundsTree=$4J2OP.disposeBoundsTree;class DigHole{constructor(e){this.scene=e.wallGroup3D,this.editor=e;let t=this.editor.config.uvGridTexture;t.wrapS=$4xklQ.RepeatWrapping,t.wrapT=$4xklQ.RepeatWrapping,this.material=new $4xklQ.MeshBasicMaterial({map:t}),this.resultObject=new $4xklQ.Mesh(new $4xklQ.BufferGeometry,new $4xklQ.MeshStandardMaterial({color:16711680,flatShading:!1,polygonOffset:!0,polygonOffsetUnits:.1,polygonOffsetFactor:.1})),this.resultObject.castShadow=!0,this.resultObject.receiveShadow=!0,this.tmpM=new $4xklQ.Mesh(new $4xklQ.BoxGeometry(1,1,1),new $4xklQ.MeshBasicMaterial({color:16711680})),this.tmpM.position.set(-1,-1,-1)}resetResultObj(){this.resultObject.geometry=new $4xklQ.BufferGeometry}workOld(e,t){let i=[];for(let r=0;r<t.length;r++){let n,o,a,s=t[r];if(e.forEach(function(e,t){e.wallID==s.wallID&&(n=e,o=t)}),n){let e=n.startPoint,t=n.endPoint;if(s.isArc){let i,r,o=e.clone().add(t).divideScalar(2),l=o.distanceTo(n.startPoint);switch(n.line){case 0:i=l-n.thickness/2-1,r=l+n.thickness/2+1;break;case 1:i=l-1,r=l+n.thickness+1;break;case 2:i=l-n.thickness-1,r=l+1}let h=this.createArcMesh(o,i,r,s.startRadian,s.endRadian,s.height,s.positionZ);a=this.boolean(n,h),s.path&&this.createArcWindow(i,r,n,s)}else{let i=e.clone().add(t).divideScalar(2);i=new $4xklQ.Vector3(i.x,i.y,n.height/2);let r=t.clone().sub(e).angle(),o=new $4xklQ.Vector3(s.location.x,s.location.y,s.location.z),l=this.createBooleanMesh(s.width,s.height,s.windowThick+2,s.withSector,r);l.position.set(o.x,o.y,o.z),a=this.boolean(n,l),s.path&&a&&this.placeWindow(this.scene,s,n,o,r)}a&&(this.paramInherit(a,n),this.recomputeUVs(a),i.push(a))}}return this.scene}work(e,t){let i=[],r=[];for(let i=0;i<t.length;i++){let n=t[i];for(let t=0;t<e.length;t++)if(e[t].wallID==n.wallID){r[t]?r[t].push(n):r[t]=[n];break}}for(let t=0;t<e.length;t++){let n=[],o=e[t];if(r[t]){let e=o.startPoint,a=o.endPoint;if(o.isArc)for(let e=0;e<r[t].length;e++){let i,a,s=r[t][e],l=o.arcCenter,h=Math.round(100*l.distanceTo(new $4xklQ.Vector2(1e3*o.startPoint.x,1e3*o.startPoint.y)))/100;switch(o.line){case 0:i=h-1e3*o.thickness/2-1,a=h+1e3*o.thickness/2+1;break;case 1:i=h-1,a=h+1e3*o.thickness+1;break;case 2:i=h-1e3*o.thickness-1,a=h+1}let c=this.createArcMesh(l,i-1,a+1,s.startRadian,s.endRadian,s.height,s.positionZ);c.updateMatrix(),n.push(c),this.place3DWindow(this.scene,s,o)}else for(let i=0;i<r[t].length;i++){let s,l=r[t][i],h=a.clone().sub(e).angle();(l.masterAngle||0==l.masterAngle)&&(h=l.masterAngle);let c=new $4xklQ.Vector3(l.location.x,l.location.y,l.location.z);"UWindow"==l.dir&&(l.path="uWindow"),"dooropen"==l.dir&&(l.path="dooropen"),l.path&&(l.path.includes("LWindow")&&(l.width+=2*l.diff),this.place3DWindow(this.scene,l,o,c,h)),("UWindow"==l.dir||l.path)&&(l.windowThick+=1e3*o.thickness,l.windowThickL+=1e3*o.thickness,l.windowThickR+=1e3*o.thickness),l.path.includes("uWindow")?(s=this.createUWindowBooleanMesh(l,h,c)).geometry.translate(0,-(l.windowThickL-1200)/2,0):s=this.createBooleanMesh(l.width,l.height,l.windowThick+2,l.withSector,h),s.position.add(c),s.updateMatrix(),n.push(s)}let s=n[0];1==n.length&&(s=this.boolean(s,this.tmpM,"union"));for(let e=1;e<n.length;e++)s=this.boolean(s,n[e],"union");let l=this.boolean(o,s);this.scene.add(l),l?(this.paramInherit(l,o),i.push(l)):console.log("boolean error",r[t],o)}}return this.scene}place3DWindow(e,t,i,r,n){let o,a=new $4xklQ.Group;if(t.path.includes("baseDoor")&&(a=(0,$4xgHd.Entry3D).createBaseDoor({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:n,editor:this.editor}),("rightSide"==t.doorDir||"leftSide"==t.doorDir)&&(a.rotation.y+=Math.PI)),t.path.includes("doubleOpenDoor")&&(a=(0,$4xgHd.Entry3D).createDoubleOpenDoor({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:n,editor:this.editor})),t.path.includes("slidingDoor")&&(a=(0,$4xgHd.Entry3D).createSlidingDoor({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:n,editor:this.editor})),t.path.includes("baseWindow")&&(a=(0,$4xgHd.Entry3D).createBaseWindow({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:n,style:1,editor:this.editor})),t.path.includes("frenchWindow")&&(a=(0,$4xgHd.Entry3D).createFrenchWindow({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:n,editor:this.editor})),t.path.includes("lashDoor")&&(a=(0,$4xgHd.Entry3D).createLashDoor({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:n,editor:this.editor}),("rightSide"==t.doorDir||"leftSide"==t.doorDir)&&(a.rotation.y+=Math.PI)),t.path.includes("pass")&&(a=(0,$4xgHd.Entry3D).createPass({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:n,editor:this.editor})),t.path.includes("sectorDoor")&&(a=(0,$4xgHd.Entry3D).createSectorDoor({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:n,editor:this.editor,arcHei:t.arcHei})),t.path.includes("sectorWindow")&&(a=(0,$4xgHd.Entry3D).createSectorWindow({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:n,editor:this.editor})),t.path.includes("arcWindow")&&(a=(0,$4xgHd.Entry3D).createArcWindow({hole:t,wall:i,editor:this.editor})),t.path.includes("LWindow")){if(this.info=this.info||[],t.path.includes("left")){if(0==this.info.length)this.info.push({leftWidth:t.width-t.diff,leftDepth:i.thickness/2*1e3,leftSP:new $4xklQ.Vector2(1e3*i.startPoint.x,1e3*i.startPoint.y),leftEP:new $4xklQ.Vector2(1e3*i.endPoint.x,1e3*i.endPoint.y),commonPoint:t.commonPoint});else{let e=!0;for(let r=0;r<this.info.length;r++)if(this.info[r].commonPoint.x==t.commonPoint.x&&this.info[r].commonPoint.y==t.commonPoint.y&&this.info[r].commonPoint.z==t.commonPoint.z){let n=new $4xklQ.Vector2(1e3*i.startPoint.x,1e3*i.startPoint.y),o=new $4xklQ.Vector2(1e3*i.endPoint.x,1e3*i.endPoint.y);e=!1,this.info[r].leftWidth=t.width-t.diff,this.info[r].leftDepth=i.thickness/2*1e3,this.info[r].leftSP=n,this.info[r].leftEP=o}e&&this.info.push({leftWidth:t.width-t.diff,leftDepth:i.thickness/2*1e3,leftSP:new $4xklQ.Vector2(1e3*i.startPoint.x,1e3*i.startPoint.y),leftEP:new $4xklQ.Vector2(1e3*i.endPoint.x,1e3*i.endPoint.y),commonPoint:t.commonPoint})}}if(t.path.includes("right")){if(0==this.info.length)this.info.push({rightWidth:t.width-t.diff,rightDepth:i.thickness/2*1e3,rightSP:new $4xklQ.Vector2(1e3*i.startPoint.x,1e3*i.startPoint.y),rightEP:new $4xklQ.Vector2(1e3*i.endPoint.x,1e3*i.endPoint.y),commonPoint:t.commonPoint});else{let e=!0;for(let r=0;r<this.info.length;r++)if(this.info[r].commonPoint.x==t.commonPoint.x&&this.info[r].commonPoint.y==t.commonPoint.y&&this.info[r].commonPoint.z==t.commonPoint.z){let n=new $4xklQ.Vector2(1e3*i.startPoint.x,1e3*i.startPoint.y),o=new $4xklQ.Vector2(1e3*i.endPoint.x,1e3*i.endPoint.y);e=!1,this.info[r].rightWidth=t.width-t.diff,this.info[r].rightDepth=i.thickness/2*1e3,this.info[r].rightSP=n,this.info[r].rightEP=o}e&&this.info.push({rightWidth:t.width-t.diff,rightDepth:i.thickness/2*1e3,rightSP:new $4xklQ.Vector2(1e3*i.startPoint.x,1e3*i.startPoint.y),rightEP:new $4xklQ.Vector2(1e3*i.endPoint.x,1e3*i.endPoint.y),commonPoint:t.commonPoint})}}let e=[];for(let i=0;i<this.info.length;i++){let n=this.info[i];n.leftSP&&n.rightSP&&(n.leftSP.equals(n.rightSP)||n.leftSP.equals(n.rightEP)?(n.commonPoint=n.leftSP,n.leftVec=n.leftEP.clone().sub(n.leftSP).normalize(),n.leftSP.equals(n.rightSP)?n.rightVec=n.rightEP.clone().sub(n.leftSP).normalize():n.rightVec=n.leftSP.clone().sub(n.rightEP).normalize()):(n.commonPoint=n.leftEP,n.leftVec=n.leftSP.clone().sub(n.leftEP).normalize(),n.leftEP.equals(n.rightSP)?n.rightVec=n.rightEP.clone().sub(n.rightSP).normalize():n.rightVec=n.rightSP.clone().sub(n.rightEP).normalize()),a=(0,$4xgHd.Entry3D).createLWindow({leftPoint:n.commonPoint.clone().add(n.leftVec.setLength(n.leftWidth)),rightPoint:n.commonPoint.clone().add(n.rightVec.setLength(n.rightWidth)),commonPoint:n.commonPoint,height:t.height,leftDepth:n.leftDepth,rightDepth:n.rightDepth,position:r,editor:this.editor}),e.push(n))}e.forEach(e=>{this.info.splice(this.info.indexOf(e),1)})}if(t.path.includes("panoramicWindow")&&(a=(0,$4xgHd.Entry3D).createPanoramicWindow({width:t.width,height:t.height,position:r,thickness:1e3*i.thickness,rotAngle:n,editor:this.editor})),(t.path.includes("uWindow")||"UWindow"==t.dir)&&(this.uwInfo=this.uwInfo||{wallArr:[],wallList:[],editor:this.editor},this.uwInfo.wallArr.push(t.wallID),t.path.includes("uWindow")&&!t.dir?this.uwInfo.middleWall=i:this.uwInfo.wallList.push(i),this.uwInfo.width||(this.uwInfo.width=t.width,this.uwInfo.height=t.height,this.uwInfo.windowThick=t.windowThick,this.uwInfo.windowThickL=t.windowThickL,this.uwInfo.windowThickR=t.windowThickR,this.uwInfo.rotAngle=n,this.uwInfo.position=r),t.uuid&&(this.uwInfo.uuid=t.uuid),3==this.uwInfo.wallArr.length&&(a=(0,$4xgHd.Entry3D).createUWindow(this.uwInfo),t.uuid=this.uwInfo.uuid,delete this.uwInfo)),"dooropen"==t.path&&(a=(0,$4xgHd.Entry3D).createDooropen({width:t.width,height:t.height,thickness:1e3*i.thickness,position:r,rotAngle:n,editor:this.editor})),a.parameter){for(let e=0;e<this.editor.otherMeshs.length;e++)if(this.editor.otherMeshs[e].uuid==t.uuid){o=this.editor.otherMeshs[e];break}o&&a.parameter&&(a.parameter.tdm=o),o&&(o.parameter=[a]),a.modelType="CodeModel",a.modelPath=t.path,a.isLock=t.isLock,e.add(a)}}createBooleanMesh(e,t,i,r,n){r&&(t-=e/2);let o=new $4xklQ.MeshBasicMaterial({color:255,side:$4xklQ.DoubleSide}),a=new $4xklQ.Mesh(new $4xklQ.BoxGeometry(e,i,t),o);if(r){var s=new $4xklQ.Mesh(new $4xklQ.CylinderGeometry(e/2,e/2,i,50),o);s.position.add(new $4xklQ.Vector3(0,0,t/2)),s.updateMatrix(),a.material=new $4xklQ.MeshBasicMaterial({color:65520,side:$4xklQ.DoubleSide}),a=this.boolean(a,s,"union")}return a.geometry.computeBoundingBox(),a.geometry.center(),a.rotateZ(n),a}createUWindowBooleanMesh(e,t,i){let r=new $4xklQ.MeshBasicMaterial({color:16711680,side:$4xklQ.DoubleSide}),n=new $4xklQ.MeshBasicMaterial({color:65280,side:$4xklQ.DoubleSide}),o=10,a=new $4xklQ.Mesh(new $4xklQ.BoxGeometry(e.width/2+1,e.windowThickL+o,e.height),r);a.geometry.translate(-e.width/4,-(e.windowThickL-1200)/2,0);let s=new $4xklQ.Mesh(new $4xklQ.BoxGeometry(e.width/2+1,e.windowThickR+o,e.height),n);s.geometry.translate(e.width/4,-(e.windowThickR-1200)/2,0);let l=this.boolean(a,s,"union");return l.geometry.computeBoundingBox(),l.geometry.center(),l.geometry.translate(0,o,0),l.rotateZ(t),l}createArcMesh(e,t,i,r,n,o,a){var s=new $4xklQ.Path;s.arc(e.x,e.y,t,r,n,!1);let l=Math.round(Math.PI/Math.asin(120/(t+120))/2);l=l>100?100:l;var h=s.getPoints(l),c=new $4xklQ.Path;c.arc(e.x,e.y,i,r,n,!1);let d=Math.round(Math.PI/Math.asin(120/(t+120))/2);d=d>100?100:d;var u=c.getPoints(d),p=h.concat(u.reverse()),m=p.shift(),f=new $4xklQ.Shape;f.moveTo(m.x,m.y),p.forEach(function(e){f.lineTo(e.x,e.y)}),f.lineTo(m.x,m.y);var g={steps:2,depth:o,bevelEnabled:!1,bevelThickness:1,bevelSize:1,bevelSegments:1},y=new $4xklQ.ExtrudeGeometry(f,g),x=new $4xklQ.MeshBasicMaterial({color:16777215*Math.random()}),w=new $4xklQ.Mesh(y,x);w.geometry.computeBoundingBox();var b=w.geometry.boundingBox.min,v=w.geometry.boundingBox.max,M=b.clone().add(v).divideScalar(2);return w.geometry.center(),w.position.set(M.x,M.y,a-1e-5),w}booleanBack(e,t,i="subtract"){var r;e.updateMatrix(),t.updateMatrix();let n=(0,$cTA6h.CSG).fromMesh(e),o=(0,$cTA6h.CSG).fromMesh(t);if("union"==i)r=n.union(o);else{if(0==n.intersect(o).polygons.length)return!1;"subtract"==i&&(r=n.subtract(o)),"intersect"==i&&(r=n.intersect(o))}let a=(0,$cTA6h.CSG).toMesh(r,e.matrix,e.material);return this.scene.remove(e),a}boolean(e,t,i="subtract"){"subtract"==i&&(i=$7BJhL.SUBTRACTION),"union"==i&&(i=$7BJhL.ADDITION),"intersect"==i&&(i=$7BJhL.INTERSECTION),e.updateMatrixWorld(!0);let r=new $6Hryq.Brush(e.geometry,e.material),n=new $6Hryq.Brush(t.geometry,t.material);r.applyMatrix4(e.matrix),n.applyMatrix4(t.matrix),r.updateMatrixWorld(),n.updateMatrixWorld(),r.geometry.computeBoundsTree({maxLeafTris:5,strategy:parseFloat($ckwVR.CENTER)}),r.geometry.boundsTree.splitStrategy=$ckwVR.CENTER,n.geometry.computeBoundsTree({maxLeafTris:5,strategy:parseFloat($ckwVR.CENTER)}),n.geometry.boundsTree.splitStrategy=$ckwVR.CENTER,this.scene.remove(e);let o=new $94t2y.Evaluator;if(o.attributes=["position","normal"],o.debug.enabled=!0,o.useGroups=!0,i==$7BJhL.ADDITION||i==$7BJhL.INTERSECTION)return o.evaluate(r,n,i);if(i==$7BJhL.SUBTRACTION){let t=new $4xklQ.Mesh(new $4xklQ.BufferGeometry,new $4xklQ.MeshStandardMaterial({color:16711680,flatShading:!1,polygonOffset:!0,polygonOffsetUnits:.1,polygonOffsetFactor:.1}));return t.castShadow=!0,t.receiveShadow=!0,o.evaluate(r,n,i,t),t.geometry.computeBoundingBox(),t.geometry.center(),t.applyMatrix4(e.matrix),t}}paramInherit(target,origin){target.layers.mask=origin.layers.mask,["line","name","style","isArc","height","wallID","offsetXY","thickness","startPoint","endPoint","modelType","arcCenter","origin3DWall"].forEach(function(item){eval("target."+item+"= origin."+item)})}placeWindow(e,t,i,r,n){if(t.path.includes("LWindow")){this.createLWindow(e,t,i,r,n);return}let o=this.editor;new(0,$hu0fb.GLTFLoader)().load(t.path,function(a){let s;var l=a.scene,h=new $4xklQ.Box3().setFromObject(l),c=h.max.x-h.min.x,d=h.max.y-h.min.y,u=h.max.z-h.min.z,p=t.width,m=t.height,f=t.windowThick;if(t.withSector&&(m+=p/2),-1!=t.path.indexOf("WaveWindow")){f=3*i.thickness;var g=new $4xklQ.Vector3(vector.y,-vector.x,0).setLength(i.thickness);l.position.add(g);var y=p;if(-1!=t.path.indexOf("leftLWaveWindow")){var g=vector.negate();p=(p-i.thickness)*2e3/1420,g=new $4xklQ.Vector3(g.x,g.y,0).setLength((p-y)/2),l.position.add(g)}-1!=t.path.indexOf("rightLWaveWindow")&&(p=(p-i.thickness)*2e3/1420,g=new $4xklQ.Vector3(vector.x,vector.y,0).setLength((p-y)/2),l.position.add(g))}if(l.scale.set(p/c,m/d,f/u),l.rotateX(Math.PI/2),l.rotateY(n),-1!=t.path.indexOf("panoramicWindow")){let e=new $4xklQ.Vector3(0,(f-i.thickness)/2,0),t=new $4xklQ.Matrix4().makeRotationZ(n);l.position.add(e.applyMatrix4(t))}l.position.add(r),o.addBoxForMesh(l,[]),l.layers.set(2),l.traverse(function(e){e.layers.set(2)}),l.modelPath=t.path;for(let e=0;e<o.otherMeshs.length;e++)if(o.otherMeshs[e].uuid==t.uuid){s=o.otherMeshs[e];break}s&&(l.parameter={tdm:s},l.isLock=!1,s.isLock&&(l.isLock=s.isLock)),l.modelType="CodeModel",e.add(l)})}createArcWindow(e,t,i,r){let n=i.arcCenter;var o=(e+t)/2,a=o-i.thickness/4,s=o+i.thickness/4,l=this.createArcMesh(n,a,s,r.startRadian,r.endRadian,r.height,r.positionZ);l.material=new $4xklQ.MeshStandardMaterial({color:new $4xklQ.Color(.0385,.0385,.0385),roughness:.9,metalness:.1,normalScale:new $4xklQ.Vector2(1,-1)}),this.scene.add(l);var h=50,c=50/a,d=r.startRadian+c,u=r.endRadian-c,p=r.height-2*h,m=this.createArcMesh(n,a-1,s+1,d,u,p,r.positionZ);let f=this.boolean(l,m);this.scene.add(f),h-=1,c=h/a,d=r.startRadian+c,u=r.endRadian-c,p=r.height-2*h;var g=o-i.thickness/8,y=o+i.thickness/8,x=this.createArcMesh(n,g,y,d,u,p,r.positionZ);x.material=new $4xklQ.MeshStandardMaterial({color:new $4xklQ.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new $4xklQ.Vector2(1,-1),side:2,transparent:!0,opacity:.64,roughness:.9}),this.scene.add(x)}createLWindow(e,t,i,r,n){let o,a,s,l=50,h=10;if(t.path.includes("leftLWindow")){let e=new $4xklQ.Vector2(-t.width/2,i.thickness/2),r=new $4xklQ.Vector2(t.width/2,i.thickness/2),n=new $4xklQ.Vector2(t.width/2-t.diff,0),c=new $4xklQ.Vector2(-t.width/2,0);o=(0,$9QhXH.DM).createShapeByPointArr([e,r,n,c],"shape");let d=new $4xklQ.Vector2(-t.width/2+l,i.thickness/2),u=new $4xklQ.Vector2(t.width/2-t.diff,i.thickness/2),p=new $4xklQ.Vector2(t.width/2-t.diff,0),m=new $4xklQ.Vector2(-t.width/2+l,0);a=(0,$9QhXH.DM).createShapeByPointArr([d,u,p,m],"shape");let f=new $4xklQ.Vector2(-t.width/2+l-h,3*i.thickness/8),g=new $4xklQ.Vector2(t.width/2-t.diff/4,3*i.thickness/8),y=new $4xklQ.Vector2(t.width/2-3*t.diff/4,i.thickness/8),x=new $4xklQ.Vector2(-t.width/2+l-h,i.thickness/8);s=(0,$9QhXH.DM).createShapeByPointArr([f,g,y,x],"shape")}if(t.path.includes("rightLWindow")){let e=new $4xklQ.Vector2(-t.width/2,i.thickness/2),r=new $4xklQ.Vector2(t.width/2,i.thickness/2),n=new $4xklQ.Vector2(t.width/2,0),c=new $4xklQ.Vector2(-t.width/2+t.diff,0);o=(0,$9QhXH.DM).createShapeByPointArr([e,r,n,c],"shape");let d=new $4xklQ.Vector2(-t.width/2+t.diff,i.thickness/2),u=new $4xklQ.Vector2(t.width/2-l,i.thickness/2),p=new $4xklQ.Vector2(t.width/2-l,0),m=new $4xklQ.Vector2(-t.width/2+t.diff,0);a=(0,$9QhXH.DM).createShapeByPointArr([d,u,p,m],"shape");let f=new $4xklQ.Vector2(-t.width/2+t.diff/4,3*i.thickness/8),g=new $4xklQ.Vector2(t.width/2-l+h,3*i.thickness/8),y=new $4xklQ.Vector2(t.width/2-l+h,i.thickness/8),x=new $4xklQ.Vector2(-t.width/2+3*t.diff/4,i.thickness/8);s=(0,$9QhXH.DM).createShapeByPointArr([f,g,y,x],"shape")}let c=new $4xklQ.MeshStandardMaterial({color:new $4xklQ.Color(.0385,.0385,.0385),roughness:.9,metalness:.1,normalScale:new $4xklQ.Vector2(1,-1)}),d=this.createMeshByParam(t.height,o,c);d.position.set(r.x,r.y,r.z-t.height/2),d.rotation.z=n,e.add(d);let u=this.createMeshByParam(t.height-2*l,a,c);u.position.set(r.x,r.y,r.z-(t.height-2*l)/2),u.rotation.z=n;let p=this.boolean(d,u);e.add(p);let m=new $4xklQ.MeshStandardMaterial({color:new $4xklQ.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new $4xklQ.Vector2(1,-1),side:2,transparent:!0,opacity:.64,roughness:.9}),f=t.height-2*l+2*h,g=this.createMeshByParam(f,s,m);g.position.set(r.x,r.y,r.z-f/2),g.rotation.z=n,e.add(g)}createMeshByParam(e,t,i){let r={steps:2,depth:e,bevelEnabled:!1,bevelThickness:1,bevelSize:1,bevelSegments:1},n=new $4xklQ.ExtrudeGeometry(t,r);return new $4xklQ.Mesh(n,i)}recomputeUVs(e){let t=e.startPoint,i=e.endPoint,r=Array.from(e.geometry.attributes.position.array),n=[],o=[];for(let e=0;e<r.length/3;e++)n.push(new $4xklQ.Vector3(r[3*e],r[3*e+1],r[3*e+2]));for(let e=0;e<n.length/3;e++)o.push([n[3*e],n[3*e+1],n[3*e+2]]);let a=[],s=[];if(e.isArc){let r=t.clone().add(i).divideScalar(2);r=new $4xklQ.Vector2(1e3*r.x,1e3*r.y);let n=t.distanceTo(i)/2*Math.PI,l=new $4xklQ.Matrix3().setUvTransform(0,0,n/1024,e.height/1024,0,0,0);e.geometry.attributes.uv.applyMatrix3(l),o.forEach(function(t){var i=t[0],n=t[1],o=t[2];i.applyMatrix4(e.matrixWorld),n.applyMatrix4(e.matrixWorld),o.applyMatrix4(e.matrixWorld);var l=new $4xklQ.Vector3(r.x,r.y,n.z).sub(n),h=l.clone().negate(),c=o.clone().sub(n),d=i.clone().sub(n),u=c.cross(d).normalize(),p=180*u.angleTo(l)/Math.PI,m=180*u.angleTo(h)/Math.PI;p<6&&a.push(...t),m<6&&s.push(...t)})}else{let r=t.distanceTo(i),n=new $4xklQ.Matrix3().setUvTransform(0,0,r/1024,e.height/1024,0,0,0);e.geometry.attributes.uv.applyMatrix3(n);let l=i.clone().sub(t).normalize(),h=new $4xklQ.Vector3;0==l.y?h.x=0:h.x=-Math.round(1e3*l.y)/1e3,0==l.x?h.y=0:h.y=Math.round(1e3*l.x)/1e3;let c=h.clone().negate();for(let t=0;t<o.length;t++){let i=o[t][0],r=o[t][1],n=o[t][2];i.applyMatrix4(e.matrixWorld),r.applyMatrix4(e.matrixWorld),n.applyMatrix4(e.matrixWorld);let l=n.clone().sub(r),d=i.clone().sub(r),u=l.cross(d).normalize();0==u.x?u.x=0:u.x=Math.round(1e3*u.x)/1e3,0==u.y?u.y=0:u.y=Math.round(1e3*u.y)/1e3,0==u.z?u.z=0:u.z=Math.round(1e3*u.z)/1e3,u.equals(h)&&a.push(...o[t]),u.equals(c)&&s.push(...o[t])}}let l=[],h=[];a.forEach(function(e){l.push(n.indexOf(e))}),s.forEach(function(e){h.push(n.indexOf(e))});var c=[],d=Math.min(...l),u=Math.max(...h);let p=new $4xklQ.MeshStandardMaterial({color:"#9e9b9b"}),m=[p,p,p];0!=d&&c.push({start:0,count:d,materialIndex:0});for(var f=l[0],g=l[0],y=[],x=1,w=1;x<l.length;x++)l[x]-g==1?w++:(y.push({start:f,count:w,materialIndex:1}),y.push({start:l[x-1]+1,count:l[x]-l[x-1]-1,materialIndex:0}),f=l[x],w=1),g=l[x],x==l.length-1&&y.push({start:f,count:w,materialIndex:1});c.push(...y);for(var f=h[0],g=h[0],b=[],x=1,w=1;x<h.length;x++)h[x]-g==1?w++:(b.push({start:f,count:w,materialIndex:2}),b.push({start:h[x-1]+1,count:h[x]-h[x-1]-1,materialIndex:0}),f=h[x],w=1),g=h[x],x==h.length-1&&b.push({start:f,count:w,materialIndex:2});c.push(...b),c.push({start:u+1,count:r.length/3-u-1,materialIndex:0}),e.geometry.groups=c,e.material=m}}DigHole.prototype.boolean=DigHole.prototype.booleanBack}),parcelRequire.register("hu0fb",function(e,t){$parcel$export(e.exports,"GLTFLoader",()=>r);var i=parcelRequire("4xklQ");class r extends i.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new h(e)}),this.register(function(e){return new g(e)}),this.register(function(e){return new y(e)}),this.register(function(e){return new d(e)}),this.register(function(e){return new u(e)}),this.register(function(e){return new p(e)}),this.register(function(e){return new m(e)}),this.register(function(e){return new l(e)}),this.register(function(e){return new f(e)}),this.register(function(e){return new c(e)}),this.register(function(e){return new a(e)}),this.register(function(e){return new x(e)})}load(e,t,r,n){let o;let a=this;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:(0,i.LoaderUtils).extractUrlBase(e),this.manager.itemStart(e);let s=function(t){n?n(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},l=new i.FileLoader(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(i){try{a.parse(i,o,function(i){t(i),a.manager.itemEnd(e)},s)}catch(e){s(e)}},r,s)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return -1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return -1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,n){let a;let l={},h={};if("string"==typeof e)a=e;else{let t=(0,i.LoaderUtils).decodeText(new Uint8Array(e,0,4));if(t===w){try{l[o.KHR_BINARY_GLTF]=new M(e)}catch(e){n&&n(e);return}a=l[o.KHR_BINARY_GLTF].content}else a=(0,i.LoaderUtils).decodeText(new Uint8Array(e))}let c=JSON.parse(a);if(void 0===c.asset||c.asset.version[0]<2){n&&n(Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let d=new J(c,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});d.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){let t=this.pluginCallbacks[e](d);h[t.name]=t,l[t.name]=!0}if(c.extensionsUsed)for(let e=0;e<c.extensionsUsed.length;++e){let t=c.extensionsUsed[e],i=c.extensionsRequired||[];switch(t){case o.KHR_MATERIALS_UNLIT:l[t]=new s;break;case o.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:l[t]=new _;break;case o.KHR_DRACO_MESH_COMPRESSION:l[t]=new S(c,this.dracoLoader);break;case o.KHR_TEXTURE_TRANSFORM:l[t]=new P;break;case o.KHR_MESH_QUANTIZATION:l[t]=new C;break;default:i.indexOf(t)>=0&&void 0===h[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}d.setExtensions(l),d.setPlugins(h),d.parse(r,n)}parseAsync(e,t){let i=this;return new Promise(function(r,n){i.parse(e,t,r,n)})}}function n(){let e={};return{get:function(t){return e[t]},add:function(t,i){e[t]=i},remove:function(t){delete e[t]},removeAll:function(){e={}}}}let o={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class a{constructor(e){this.parser=e,this.name=o.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let e=this.parser,t=this.parser.json.nodes||[];for(let i=0,r=t.length;i<r;i++){let r=t[i];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){let t;let r=this.parser,n="light:"+e,o=r.cache.get(n);if(o)return o;let a=r.json,s=a.extensions&&a.extensions[this.name]||{},l=s.lights||[],h=l[e],c=new i.Color(16777215);void 0!==h.color&&c.fromArray(h.color);let d=void 0!==h.range?h.range:0;switch(h.type){case"directional":(t=new i.DirectionalLight(c)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new i.PointLight(c)).distance=d;break;case"spot":(t=new i.SpotLight(c)).distance=d,h.spot=h.spot||{},h.spot.innerConeAngle=void 0!==h.spot.innerConeAngle?h.spot.innerConeAngle:0,h.spot.outerConeAngle=void 0!==h.spot.outerConeAngle?h.spot.outerConeAngle:Math.PI/4,t.angle=h.spot.outerConeAngle,t.penumbra=1-h.spot.innerConeAngle/h.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw Error("THREE.GLTFLoader: Unexpected light type: "+h.type)}return t.position.set(0,0,0),t.decay=2,void 0!==h.intensity&&(t.intensity=h.intensity),t.name=r.createUniqueName(h.name||"light_"+e),o=Promise.resolve(t),r.cache.add(n,o),o}createNodeAttachment(e){let t=this,i=this.parser,r=i.json,n=r.nodes[e],o=n.extensions&&n.extensions[this.name]||{},a=o.light;return void 0===a?null:this._loadLight(a).then(function(e){return i._getNodeRef(t.cache,a,e)})}}class s{constructor(){this.name=o.KHR_MATERIALS_UNLIT}getMaterialType(){return i.MeshBasicMaterial}extendParams(e,t,r){let n=[];e.color=new i.Color(1,1,1),e.opacity=1;let o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){let t=o.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==o.baseColorTexture&&n.push(r.assignTexture(e,"map",o.baseColorTexture,i.sRGBEncoding))}return Promise.all(n)}}class l{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){let i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let n=r.extensions[this.name].emissiveStrength;return void 0!==n&&(t.emissiveIntensity=n),Promise.resolve()}}class h{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){let t=this.parser,r=t.json.materials[e];return r.extensions&&r.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let o=[],a=n.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&o.push(r.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&o.push(r.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(o.push(r.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){let e=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new i.Vector2(e,e)}return Promise.all(o)}}class c{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){let t=this.parser,r=t.json.materials[e];return r.extensions&&r.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let n=[],o=r.extensions[this.name];return void 0!==o.iridescenceFactor&&(t.iridescence=o.iridescenceFactor),void 0!==o.iridescenceTexture&&n.push(i.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),void 0!==o.iridescenceIor&&(t.iridescenceIOR=o.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==o.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),void 0!==o.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),void 0!==o.iridescenceThicknessTexture&&n.push(i.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(n)}}class d{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_SHEEN}getMaterialType(e){let t=this.parser,r=t.json.materials[e];return r.extensions&&r.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let o=[];t.sheenColor=new i.Color(0,0,0),t.sheenRoughness=0,t.sheen=1;let a=n.extensions[this.name];return void 0!==a.sheenColorFactor&&t.sheenColor.fromArray(a.sheenColorFactor),void 0!==a.sheenRoughnessFactor&&(t.sheenRoughness=a.sheenRoughnessFactor),void 0!==a.sheenColorTexture&&o.push(r.assignTexture(t,"sheenColorMap",a.sheenColorTexture,i.sRGBEncoding)),void 0!==a.sheenRoughnessTexture&&o.push(r.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(o)}}class u{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){let t=this.parser,r=t.json.materials[e];return r.extensions&&r.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let n=[],o=r.extensions[this.name];return void 0!==o.transmissionFactor&&(t.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&n.push(i.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(n)}}class p{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_VOLUME}getMaterialType(e){let t=this.parser,r=t.json.materials[e];return r.extensions&&r.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let o=[],a=n.extensions[this.name];t.thickness=void 0!==a.thicknessFactor?a.thicknessFactor:0,void 0!==a.thicknessTexture&&o.push(r.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||0;let s=a.attenuationColor||[1,1,1];return t.attenuationColor=new i.Color(s[0],s[1],s[2]),Promise.all(o)}}class m{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_IOR}getMaterialType(e){let t=this.parser,r=t.json.materials[e];return r.extensions&&r.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let n=r.extensions[this.name];return t.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class f{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_SPECULAR}getMaterialType(e){let t=this.parser,r=t.json.materials[e];return r.extensions&&r.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let o=[],a=n.extensions[this.name];t.specularIntensity=void 0!==a.specularFactor?a.specularFactor:1,void 0!==a.specularTexture&&o.push(r.assignTexture(t,"specularIntensityMap",a.specularTexture));let s=a.specularColorFactor||[1,1,1];return t.specularColor=new i.Color(s[0],s[1],s[2]),void 0!==a.specularColorTexture&&o.push(r.assignTexture(t,"specularColorMap",a.specularColorTexture,i.sRGBEncoding)),Promise.all(o)}}class g{constructor(e){this.parser=e,this.name=o.KHR_TEXTURE_BASISU}loadTexture(e){let t=this.parser,i=t.json,r=i.textures[e];if(!r.extensions||!r.extensions[this.name])return null;let n=r.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(!(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures")}return t.loadTextureImage(e,n.source,o)}}class y{constructor(e){this.parser=e,this.name=o.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){let t=this.name,i=this.parser,r=i.json,n=r.textures[e];if(!n.extensions||!n.extensions[t])return null;let o=n.extensions[t],a=r.images[o.source],s=i.textureLoader;if(a.uri){let e=i.options.manager.getHandler(a.uri);null!==e&&(s=e)}return this.detectSupport().then(function(n){if(n)return i.loadTextureImage(e,o.source,s);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class x{constructor(e){this.name=o.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){let t=this.parser.json,i=t.bufferViews[e];if(!i.extensions||!i.extensions[this.name])return null;{let e=i.extensions[this.name],r=this.parser.getDependency("buffer",e.buffer),n=this.parser.options.meshoptDecoder;if(!n||!n.supported){if(!(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files")}return r.then(function(t){let i=e.byteOffset||0,r=e.byteLength||0,o=e.count,a=e.byteStride,s=new Uint8Array(t,i,r);return n.decodeGltfBufferAsync?n.decodeGltfBufferAsync(o,a,s,e.mode,e.filter).then(function(e){return e.buffer}):n.ready.then(function(){let t=new ArrayBuffer(o*a);return n.decodeGltfBuffer(new Uint8Array(t),o,a,s,e.mode,e.filter),t})})}}}let w="glTF",b=12,v={JSON:1313821514,BIN:5130562};class M{constructor(e){this.name=o.KHR_BINARY_GLTF,this.content=null,this.body=null;let t=new DataView(e,0,b);if(this.header={magic:(0,i.LoaderUtils).decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==w)throw Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw Error("THREE.GLTFLoader: Legacy binary file detected.");let r=this.header.length-b,n=new DataView(e,b),a=0;for(;a<r;){let t=n.getUint32(a,!0);a+=4;let r=n.getUint32(a,!0);if(a+=4,r===v.JSON){let r=new Uint8Array(e,b+a,t);this.content=(0,i.LoaderUtils).decodeText(r)}else if(r===v.BIN){let i=b+a;this.body=e.slice(i,i+t)}a+=t}if(null===this.content)throw Error("THREE.GLTFLoader: JSON content not found.")}}class S{constructor(e,t){if(!t)throw Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=o.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){let i=this.json,r=this.dracoLoader,n=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},s={},l={};for(let e in o){let t=k[e]||e.toLowerCase();a[t]=o[e]}for(let t in e.attributes){let r=k[t]||t.toLowerCase();if(void 0!==o[t]){let n=i.accessors[e.attributes[t]],o=I[n.componentType];l[r]=o.name,s[r]=!0===n.normalized}}return t.getDependency("bufferView",n).then(function(e){return new Promise(function(t){r.decodeDracoFile(e,function(e){for(let t in e.attributes){let i=e.attributes[t],r=s[t];void 0!==r&&(i.normalized=r)}t(e)},a,l)})})}}class P{constructor(){this.name=o.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class T extends i.MeshStandardMaterial{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;let t="#ifdef USE_SPECULARMAP\n	uniform sampler2D specularMap;\n#endif",r="#ifdef USE_GLOSSINESSMAP\n	uniform sampler2D glossinessMap;\n#endif",n="vec3 specularFactor = specular;\n#ifdef USE_SPECULARMAP\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture\n	specularFactor *= texelSpecular.rgb;\n#endif",o="float glossinessFactor = glossiness;\n#ifdef USE_GLOSSINESSMAP\n	vec4 texelGlossiness = texture2D( glossinessMap, vUv );\n	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture\n	glossinessFactor *= texelGlossiness.a;\n#endif",a="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.\nmaterial.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\nmaterial.specularColor = specularFactor;",s={specular:{value:new(0,i.Color)().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=s,this.onBeforeCompile=function(e){for(let t in s)e.uniforms[t]=s[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",r).replace("#include <roughnessmap_fragment>",n).replace("#include <metalnessmap_fragment>",o).replace("#include <lights_physical_fragment>",a)},Object.defineProperties(this,{specular:{get:function(){return s.specular.value},set:function(e){s.specular.value=e}},specularMap:{get:function(){return s.specularMap.value},set:function(e){s.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return s.glossiness.value},set:function(e){s.glossiness.value=e}},glossinessMap:{get:function(){return s.glossinessMap.value},set:function(e){s.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class _{constructor(){this.name=o.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return T}extendParams(e,t,r){let n=t.extensions[this.name];e.color=new i.Color(1,1,1),e.opacity=1;let o=[];if(Array.isArray(n.diffuseFactor)){let t=n.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==n.diffuseTexture&&o.push(r.assignTexture(e,"map",n.diffuseTexture,i.sRGBEncoding)),e.emissive=new i.Color(0,0,0),e.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,e.specular=new i.Color(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){let t=n.specularGlossinessTexture;o.push(r.assignTexture(e,"glossinessMap",t)),o.push(r.assignTexture(e,"specularMap",t,i.sRGBEncoding))}return Promise.all(o)}createMaterial(e){let t=new T(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=void 0===e.emissiveIntensity?1:e.emissiveIntensity,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=i.TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t}}class C{constructor(){this.name=o.KHR_MESH_QUANTIZATION}}class D extends i.Interpolant{constructor(e,t,i,r){super(e,t,i,r)}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r*3+r;for(let e=0;e!==r;e++)t[e]=i[n+e];return t}interpolate_(e,t,i,r){let n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=2*a,l=3*a,h=r-t,c=(i-t)/h,d=c*c,u=d*c,p=e*l,m=p-l,f=-2*u+3*d,g=u-d,y=1-f,x=g-d+c;for(let e=0;e!==a;e++){let t=o[m+e+a],i=o[m+e+s]*h,r=o[p+e+a],l=o[p+e]*h;n[e]=y*t+x*i+f*r+g*l}return n}}let A=new i.Quaternion;class E extends D{interpolate_(e,t,i,r){let n=super.interpolate_(e,t,i,r);return A.fromArray(n).normalize().toArray(n),n}}let L={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},I={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},R={9728:i.NearestFilter,9729:i.LinearFilter,9984:i.NearestMipmapNearestFilter,9985:i.LinearMipmapNearestFilter,9986:i.NearestMipmapLinearFilter,9987:i.LinearMipmapLinearFilter},W={33071:i.ClampToEdgeWrapping,33648:i.MirroredRepeatWrapping,10497:i.RepeatWrapping},V={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},k={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},B={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},O={CUBICSPLINE:void 0,LINEAR:i.InterpolateLinear,STEP:i.InterpolateDiscrete},F={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function z(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new i.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:i.FrontSide})),e.DefaultMaterial}function U(e,t,i){for(let r in i.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=i.extensions[r])}function N(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function G(e,t,i){let r=!1,n=!1,o=!1;for(let e=0,i=t.length;e<i;e++){let i=t[e];if(void 0!==i.POSITION&&(r=!0),void 0!==i.NORMAL&&(n=!0),void 0!==i.COLOR_0&&(o=!0),r&&n&&o)break}if(!r&&!n&&!o)return Promise.resolve(e);let a=[],s=[],l=[];for(let h=0,c=t.length;h<c;h++){let c=t[h];if(r){let t=void 0!==c.POSITION?i.getDependency("accessor",c.POSITION):e.attributes.position;a.push(t)}if(n){let t=void 0!==c.NORMAL?i.getDependency("accessor",c.NORMAL):e.attributes.normal;s.push(t)}if(o){let t=void 0!==c.COLOR_0?i.getDependency("accessor",c.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(a),Promise.all(s),Promise.all(l)]).then(function(t){let i=t[0],a=t[1],s=t[2];return r&&(e.morphAttributes.position=i),n&&(e.morphAttributes.normal=a),o&&(e.morphAttributes.color=s),e.morphTargetsRelative=!0,e})}function H(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let i=0,r=t.weights.length;i<r;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){let i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(let t=0,r=i.length;t<r;t++)e.morphTargetDictionary[i[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function j(e){let t=e.extensions&&e.extensions[o.KHR_DRACO_MESH_COMPRESSION];return t?"draco:"+t.bufferView+":"+t.indices+":"+q(t.attributes):e.indices+":"+q(e.attributes)+":"+e.mode}function q(e){let t="",i=Object.keys(e).sort();for(let r=0,n=i.length;r<n;r++)t+=i[r]+":"+e[i[r]]+";";return t}function X(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Y(e){return e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/)?"image/jpeg":e.search(/\.webp($|\?)/i)>0||0===e.search(/^data\:image\/webp/)?"image/webp":"image/png"}class J{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new n,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),o=navigator.userAgent.indexOf("Firefox")>-1,a=o?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;"undefined"==typeof createImageBitmap||r||o&&a<98?this.textureLoader=new i.TextureLoader(this.options.manager):this.textureLoader=new i.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new i.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){let i=this,r=this.json,n=this.extensions;this.cache.removeAll(),this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(t){let o={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:i,userData:{}};U(n,o,r),N(o,r),Promise.all(i._invokeAll(function(e){return e.afterRoot&&e.afterRoot(o)})).then(function(){e(o)})}).catch(t)}_markDefs(){let e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let i=0,r=t.length;i<r;i++){let r=t[i].joints;for(let t=0,i=r.length;t<i;t++)e[r[t]].isBone=!0}for(let t=0,r=e.length;t<r;t++){let r=e[t];void 0!==r.mesh&&(this._addNodeRef(this.meshCache,r.mesh),void 0!==r.skin&&(i[r.mesh].isSkinnedMesh=!0)),void 0!==r.camera&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;let r=i.clone(),n=(e,t)=>{let i=this.associations.get(e);for(let[r,o]of(null!=i&&this.associations.set(t,i),e.children.entries()))n(o,t.children[r])};return n(i,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){let t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){let r=e(t[i]);if(r)return r}return null}_invokeAll(e){let t=Object.values(this.plugins);t.unshift(this);let i=[];for(let r=0;r<t.length;r++){let n=e(t[r]);n&&i.push(n)}return i}getDependency(e,t){let i=e+":"+t,r=this.cache.get(i);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:throw Error("Unknown type: "+e)}this.cache.add(i,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){let i=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map(function(t,r){return i.getDependency(e,r)})),this.cache.add(e,t)}return t}loadBuffer(e){let t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[o.KHR_BINARY_GLTF].body);let n=this.options;return new Promise(function(e,o){r.load((0,i.LoaderUtils).resolveURL(t.uri,n.path),e,void 0,function(){o(Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){let t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){let i=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+i)})}loadAccessor(e){let t=this,r=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);let o=[];return void 0!==n.bufferView?o.push(this.getDependency("bufferView",n.bufferView)):o.push(null),void 0!==n.sparse&&(o.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(o).then(function(e){let o,a;let s=e[0],l=V[n.type],h=I[n.componentType],c=h.BYTES_PER_ELEMENT,d=c*l,u=n.byteOffset||0,p=void 0!==n.bufferView?r.bufferViews[n.bufferView].byteStride:void 0,m=!0===n.normalized;if(p&&p!==d){let e=Math.floor(u/p),r="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+e+":"+n.count,d=t.cache.get(r);d||(o=new h(s,e*p,n.count*p/c),d=new i.InterleavedBuffer(o,p/c),t.cache.add(r,d)),a=new i.InterleavedBufferAttribute(d,l,u%p/c,m)}else o=null===s?new h(n.count*l):new h(s,u,n.count*l),a=new i.BufferAttribute(o,l,m);if(void 0!==n.sparse){let t=V.SCALAR,r=I[n.sparse.indices.componentType],o=n.sparse.indices.byteOffset||0,c=n.sparse.values.byteOffset||0,d=new r(e[1],o,n.sparse.count*t),u=new h(e[2],c,n.sparse.count*l);null!==s&&(a=new i.BufferAttribute(a.array.slice(),a.itemSize,a.normalized));for(let e=0,t=d.length;e<t;e++){let t=d[e];if(a.setX(t,u[e*l]),l>=2&&a.setY(t,u[e*l+1]),l>=3&&a.setZ(t,u[e*l+2]),l>=4&&a.setW(t,u[e*l+3]),l>=5)throw Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return a})}loadTexture(e){let t=this.json,i=this.options,r=t.textures[e],n=r.source,o=t.images[n],a=this.textureLoader;if(o.uri){let e=i.manager.getHandler(o.uri);null!==e&&(a=e)}return this.loadTextureImage(e,n,a)}loadTextureImage(e,t,r){let n=this,o=this.json,a=o.textures[e],s=o.images[t],l=(s.uri||s.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];let h=this.loadImageSource(t,r).then(function(t){t.flipY=!1,a.name&&(t.name=a.name);let r=o.samplers||{},s=r[a.sampler]||{};return t.magFilter=R[s.magFilter]||i.LinearFilter,t.minFilter=R[s.minFilter]||i.LinearMipmapLinearFilter,t.wrapS=W[s.wrapS]||i.RepeatWrapping,t.wrapT=W[s.wrapT]||i.RepeatWrapping,n.associations.set(t,{textures:e}),t}).catch(function(){return null});return this.textureCache[l]=h,h}loadImageSource(e,t){let r=this,n=this.json,o=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());let a=n.images[e],s=self.URL||self.webkitURL,l=a.uri||"",h=!1;if(void 0!==a.bufferView)l=r.getDependency("bufferView",a.bufferView).then(function(e){h=!0;let t=new Blob([e],{type:a.mimeType});return l=s.createObjectURL(t)});else if(void 0===a.uri)throw Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");let c=Promise.resolve(l).then(function(e){return new Promise(function(r,n){let a=r;!0===t.isImageBitmapLoader&&(a=function(e){let t=new i.Texture(e);t.needsUpdate=!0,r(t)}),t.load((0,i.LoaderUtils).resolveURL(e,o.path),a,void 0,n)})}).then(function(e){return!0===h&&s.revokeObjectURL(l),e.userData.mimeType=a.mimeType||Y(a.uri),e}).catch(function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),e});return this.sourceCache[e]=c,c}assignTexture(e,t,i,r){let n=this;return this.getDependency("texture",i.index).then(function(a){if(void 0===i.texCoord||0==i.texCoord||"aoMap"===t&&1==i.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+t+" not yet supported."),n.extensions[o.KHR_TEXTURE_TRANSFORM]){let e=void 0!==i.extensions?i.extensions[o.KHR_TEXTURE_TRANSFORM]:void 0;if(e){let t=n.associations.get(a);a=n.extensions[o.KHR_TEXTURE_TRANSFORM].extendTexture(a,e),n.associations.set(a,t)}}return void 0!==r&&(a.encoding=r),e[t]=a,a})}assignFinalMaterial(e){let t=e.geometry,r=e.material,n=void 0===t.attributes.tangent,o=void 0!==t.attributes.color,a=void 0===t.attributes.normal;if(e.isPoints){let e="PointsMaterial:"+r.uuid,t=this.cache.get(e);t||(t=new i.PointsMaterial,(0,i.Material).prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,t.sizeAttenuation=!1,this.cache.add(e,t)),r=t}else if(e.isLine){let e="LineBasicMaterial:"+r.uuid,t=this.cache.get(e);t||(t=new i.LineBasicMaterial,(0,i.Material).prototype.copy.call(t,r),t.color.copy(r.color),this.cache.add(e,t)),r=t}if(n||o||a){let e="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),n&&(e+="derivative-tangents:"),o&&(e+="vertex-colors:"),a&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=r.clone(),o&&(t.vertexColors=!0),a&&(t.flatShading=!0),n&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(r))),r=t}r.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=r}getMaterialType(){return i.MeshStandardMaterial}loadMaterial(e){let t;let r=this,n=this.json,a=this.extensions,s=n.materials[e],l={},h=s.extensions||{},c=[];if(h[o.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){let e=a[o.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=e.getMaterialType(),c.push(e.extendParams(l,s,r))}else if(h[o.KHR_MATERIALS_UNLIT]){let e=a[o.KHR_MATERIALS_UNLIT];t=e.getMaterialType(),c.push(e.extendParams(l,s,r))}else{let n=s.pbrMetallicRoughness||{};if(l.color=new i.Color(1,1,1),l.opacity=1,Array.isArray(n.baseColorFactor)){let e=n.baseColorFactor;l.color.fromArray(e),l.opacity=e[3]}void 0!==n.baseColorTexture&&c.push(r.assignTexture(l,"map",n.baseColorTexture,i.sRGBEncoding)),l.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,l.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(c.push(r.assignTexture(l,"metalnessMap",n.metallicRoughnessTexture)),c.push(r.assignTexture(l,"roughnessMap",n.metallicRoughnessTexture))),t=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,l)})))}!0===s.doubleSided&&(l.side=i.DoubleSide);let d=s.alphaMode||F.OPAQUE;if(d===F.BLEND?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,d===F.MASK&&(l.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&t!==i.MeshBasicMaterial&&(c.push(r.assignTexture(l,"normalMap",s.normalTexture)),l.normalScale=new i.Vector2(1,1),void 0!==s.normalTexture.scale)){let e=s.normalTexture.scale;l.normalScale.set(e,e)}return void 0!==s.occlusionTexture&&t!==i.MeshBasicMaterial&&(c.push(r.assignTexture(l,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(l.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&t!==i.MeshBasicMaterial&&(l.emissive=new(0,i.Color)().fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&t!==i.MeshBasicMaterial&&c.push(r.assignTexture(l,"emissiveMap",s.emissiveTexture,i.sRGBEncoding)),Promise.all(c).then(function(){let i;return i=t===T?a[o.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(l):new t(l),s.name&&(i.name=s.name),N(i,s),r.associations.set(i,{materials:e}),s.extensions&&U(a,i,s),i})}createUniqueName(e){let t=(0,i.PropertyBinding).sanitizeNodeName(e||""),r=t;for(let e=1;this.nodeNamesUsed[r];++e)r=t+"_"+e;return this.nodeNamesUsed[r]=!0,r}loadGeometries(e){let t=this,r=this.extensions,n=this.primitiveCache;function a(e){return r[o.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(i){return K(i,e,t)})}let s=[];for(let r=0,l=e.length;r<l;r++){let l=e[r],h=j(l),c=n[h];if(c)s.push(c.promise);else{let e;e=l.extensions&&l.extensions[o.KHR_DRACO_MESH_COMPRESSION]?a(l):K(new i.BufferGeometry,l,t),n[h]={primitive:l,promise:e},s.push(e)}}return Promise.all(s)}loadMesh(e){let t=this,r=this.json,n=this.extensions,o=r.meshes[e],a=o.primitives,s=[];for(let e=0,t=a.length;e<t;e++){let t=void 0===a[e].material?z(this.cache):this.getDependency("material",a[e].material);s.push(t)}return s.push(t.loadGeometries(a)),Promise.all(s).then(function(r){let s=r.slice(0,r.length-1),l=r[r.length-1],h=[];for(let r=0,c=l.length;r<c;r++){let c;let d=l[r],u=a[r],p=s[r];if(u.mode===L.TRIANGLES||u.mode===L.TRIANGLE_STRIP||u.mode===L.TRIANGLE_FAN||void 0===u.mode)!0!==(c=!0===o.isSkinnedMesh?new i.SkinnedMesh(d,p):new i.Mesh(d,p)).isSkinnedMesh||c.geometry.attributes.skinWeight.normalized||c.normalizeSkinWeights(),u.mode===L.TRIANGLE_STRIP?c.geometry=ee(c.geometry,i.TriangleStripDrawMode):u.mode===L.TRIANGLE_FAN&&(c.geometry=ee(c.geometry,i.TriangleFanDrawMode));else if(u.mode===L.LINES)c=new i.LineSegments(d,p);else if(u.mode===L.LINE_STRIP)c=new i.Line(d,p);else if(u.mode===L.LINE_LOOP)c=new i.LineLoop(d,p);else if(u.mode===L.POINTS)c=new i.Points(d,p);else throw Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);Object.keys(c.geometry.morphAttributes).length>0&&H(c,o),c.name=t.createUniqueName(o.name||"mesh_"+e),N(c,o),u.extensions&&U(n,c,u),t.assignFinalMaterial(c),h.push(c)}for(let i=0,r=h.length;i<r;i++)t.associations.set(h[i],{meshes:e,primitives:i});if(1===h.length)return h[0];let c=new i.Group;t.associations.set(c,{meshes:e});for(let e=0,t=h.length;e<t;e++)c.add(h[e]);return c})}loadCamera(e){let t;let r=this.json.cameras[e],n=r[r.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return"perspective"===r.type?t=new i.PerspectiveCamera((0,i.MathUtils).radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===r.type&&(t=new i.OrthographicCamera(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),N(t,r),Promise.resolve(t)}loadSkin(e){let t=this.json.skins[e],i={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(i):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return i.inverseBindMatrices=e,i})}loadAnimation(e){let t=this.json,r=t.animations[e],n=[],o=[],a=[],s=[],l=[];for(let e=0,t=r.channels.length;e<t;e++){let t=r.channels[e],i=r.samplers[t.sampler],h=t.target,c=h.node,d=void 0!==r.parameters?r.parameters[i.input]:i.input,u=void 0!==r.parameters?r.parameters[i.output]:i.output;n.push(this.getDependency("node",c)),o.push(this.getDependency("accessor",d)),a.push(this.getDependency("accessor",u)),s.push(i),l.push(h)}return Promise.all([Promise.all(n),Promise.all(o),Promise.all(a),Promise.all(s),Promise.all(l)]).then(function(t){let n=t[0],o=t[1],a=t[2],s=t[3],l=t[4],h=[];for(let e=0,t=n.length;e<t;e++){let t;let r=n[e],c=o[e],d=a[e],u=s[e],p=l[e];if(void 0===r)continue;switch(r.updateMatrix(),B[p.path]){case B.weights:t=i.NumberKeyframeTrack;break;case B.rotation:t=i.QuaternionKeyframeTrack;break;case B.position:case B.scale:default:t=i.VectorKeyframeTrack}let m=r.name?r.name:r.uuid,f=void 0!==u.interpolation?O[u.interpolation]:i.InterpolateLinear,g=[];B[p.path]===B.weights?r.traverse(function(e){e.morphTargetInfluences&&g.push(e.name?e.name:e.uuid)}):g.push(m);let y=d.array;if(d.normalized){let e=X(y.constructor),t=new Float32Array(y.length);for(let i=0,r=y.length;i<r;i++)t[i]=y[i]*e;y=t}for(let e=0,r=g.length;e<r;e++){let r=new t(g[e]+"."+B[p.path],c.array,y,f);"CUBICSPLINE"===u.interpolation&&(r.createInterpolant=function(e){let t=this instanceof i.QuaternionKeyframeTrack?E:D;return new t(this.times,this.values,this.getValueSize()/3,e)},r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),h.push(r)}}let c=r.name?r.name:"animation_"+e;return new i.AnimationClip(c,void 0,h)})}createNodeMesh(e){let t=this.json,i=this,r=t.nodes[e];return void 0===r.mesh?null:i.getDependency("mesh",r.mesh).then(function(e){let t=i._getNodeRef(i.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,i=r.weights.length;t<i;t++)e.morphTargetInfluences[t]=r.weights[t]}),t})}loadNode(e){let t=this.json,r=this.extensions,n=this,o=t.nodes[e],a=o.name?n.createUniqueName(o.name):"";return(function(){let t=[],i=n._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return i&&t.push(i),void 0!==o.camera&&t.push(n.getDependency("camera",o.camera).then(function(e){return n._getNodeRef(n.cameraCache,o.camera,e)})),n._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){t.push(e)}),Promise.all(t)})().then(function(t){let s;if((s=!0===o.isBone?new i.Bone:t.length>1?new i.Group:1===t.length?t[0]:new i.Object3D)!==t[0])for(let e=0,i=t.length;e<i;e++)s.add(t[e]);if(o.name&&(s.userData.name=o.name,s.name=a),N(s,o),o.extensions&&U(r,s,o),void 0!==o.matrix){let e=new i.Matrix4;e.fromArray(o.matrix),s.applyMatrix4(e)}else void 0!==o.translation&&s.position.fromArray(o.translation),void 0!==o.rotation&&s.quaternion.fromArray(o.rotation),void 0!==o.scale&&s.scale.fromArray(o.scale);return n.associations.has(s)||n.associations.set(s,{}),n.associations.get(s).nodes=e,s})}loadScene(e){let t=this.json,r=this.extensions,n=this.json.scenes[e],o=this,a=new i.Group;n.name&&(a.name=o.createUniqueName(n.name)),N(a,n),n.extensions&&U(r,a,n);let s=n.nodes||[],l=[];for(let e=0,i=s.length;e<i;e++)l.push(Z(s[e],a,t,o));return Promise.all(l).then(function(){let e=e=>{let t=new Map;for(let[e,r]of o.associations)(e instanceof i.Material||e instanceof i.Texture)&&t.set(e,r);return e.traverse(e=>{let i=o.associations.get(e);null!=i&&t.set(e,i)}),t};return o.associations=e(a),a})}}function Z(e,t,r,n){let o=r.nodes[e];return n.getDependency("node",e).then(function(e){let t;return void 0===o.skin?e:n.getDependency("skin",o.skin).then(function(e){t=e;let i=[];for(let e=0,r=t.joints.length;e<r;e++)i.push(n.getDependency("node",t.joints[e]));return Promise.all(i)}).then(function(r){return e.traverse(function(e){if(!e.isMesh)return;let n=[],o=[];for(let e=0,a=r.length;e<a;e++){let a=r[e];if(a){n.push(a);let r=new i.Matrix4;void 0!==t.inverseBindMatrices&&r.fromArray(t.inverseBindMatrices.array,16*e),o.push(r)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}e.bind(new i.Skeleton(n,o),e.matrixWorld)}),e})}).then(function(e){t.add(e);let i=[];if(o.children){let t=o.children;for(let o=0,a=t.length;o<a;o++){let a=t[o];i.push(Z(a,e,r,n))}}return Promise.all(i)})}function Q(e,t,r){let n=t.attributes,o=new i.Box3;if(void 0===n.POSITION)return;{let e=r.json.accessors[n.POSITION],t=e.min,a=e.max;if(void 0!==t&&void 0!==a){if(o.set(new i.Vector3(t[0],t[1],t[2]),new i.Vector3(a[0],a[1],a[2])),e.normalized){let t=X(I[e.componentType]);o.min.multiplyScalar(t),o.max.multiplyScalar(t)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}let a=t.targets;if(void 0!==a){let e=new i.Vector3,t=new i.Vector3;for(let i=0,n=a.length;i<n;i++){let n=a[i];if(void 0!==n.POSITION){let i=r.json.accessors[n.POSITION],o=i.min,a=i.max;if(void 0!==o&&void 0!==a){if(t.setX(Math.max(Math.abs(o[0]),Math.abs(a[0]))),t.setY(Math.max(Math.abs(o[1]),Math.abs(a[1]))),t.setZ(Math.max(Math.abs(o[2]),Math.abs(a[2]))),i.normalized){let e=X(I[i.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(e)}e.boundingBox=o;let s=new i.Sphere;o.getCenter(s.center),s.radius=o.min.distanceTo(o.max)/2,e.boundingSphere=s}function K(e,t,i){let r=t.attributes,n=[];function o(t,r){return i.getDependency("accessor",t).then(function(t){e.setAttribute(r,t)})}for(let t in r){let i=k[t]||t.toLowerCase();i in e.attributes||n.push(o(r[t],i))}if(void 0!==t.indices&&!e.index){let r=i.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});n.push(r)}return N(e,t),Q(e,t,i),Promise.all(n).then(function(){return void 0!==t.targets?G(e,t.targets,i):e})}function ee(e,t){let r=e.getIndex();if(null===r){let t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),r=e.getIndex()}let n=r.count-2,o=[];if(t===i.TriangleFanDrawMode)for(let e=1;e<=n;e++)o.push(r.getX(0)),o.push(r.getX(e)),o.push(r.getX(e+1));else for(let e=0;e<n;e++)e%2==0?(o.push(r.getX(e)),o.push(r.getX(e+1)),o.push(r.getX(e+2))):(o.push(r.getX(e+2)),o.push(r.getX(e+1)),o.push(r.getX(e)));o.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let a=e.clone();return a.setIndex(o),a}}),parcelRequire.register("4xgHd",function(e,t){$parcel$export(e.exports,"Entry3D",()=>y);var i=parcelRequire("4xklQ"),r=parcelRequire("evkYu"),n=parcelRequire("5L0a9"),o=parcelRequire("8y3mE"),a=parcelRequire("4cEbr"),s=parcelRequire("eDeYG"),l=parcelRequire("b4XIY"),h=parcelRequire("gKzkd"),c=parcelRequire("7T7Cq"),d=parcelRequire("fxI5g"),u=parcelRequire("eiZ6q"),p=parcelRequire("heK7I"),m=parcelRequire("3tFct"),f=parcelRequire("dFygm"),g=parcelRequire("k63JT");class y{static createBaseDoor(e){let t=new r.BaseDoorMesh({width:e.width,height:e.height,depth:e.thickness,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.copy(e.position),t.rotation.y=e.rotAngle,t}static createDoubleOpenDoor(e){let t=new n.DoubleOpenDoorMesh({width:e.width,height:e.height,depth:e.thickness,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.copy(e.position),t.rotation.y=e.rotAngle,t}static createSlidingDoor(e){let t=new o.SlidingDoorMesh({width:e.width,height:e.height,depth:e.thickness,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.copy(e.position),t.rotation.y=e.rotAngle,t}static createBaseWindow(e){let t=new a.BaseWindowMesh({width:e.width,height:e.height,depth:e.thickness,heightFromGround:e.position.z-e.height/2,style:e.style,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.copy(e.position),t.rotation.y=e.rotAngle,t}static createFrenchWindow(e){let t=new s.FrenchWindowMesh({width:e.width,height:e.height,depth:e.thickness,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.copy(e.position),t.rotation.y=e.rotAngle,t}static createLashDoor(e){let t=new l.LashDoorMesh({width:e.width,height:e.height,depth:e.thickness,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.copy(e.position),t.rotation.y=e.rotAngle,t}static createPass(e){let t=new h.PassMesh({width:e.width,height:e.height,depth:e.thickness,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.copy(e.position),t.rotation.y=e.rotAngle,t}static createDooropen(e){let t=new g.DooropenMesh({width:e.width,height:e.height,depth:e.thickness,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.copy(e.position),t.rotation.y=e.rotAngle,t}static createSectorDoor(e){let t=new c.SectorDoorMesh({width:e.width,height:e.height-e.width/2,depth:e.thickness,editor:e.editor,arcHei:e.arcHei});return t.create(),t.rotation.x=Math.PI/2,t.position.set(e.position.x,e.position.y,e.position.z-e.width/4),t.rotation.y=e.rotAngle,t}static createSectorWindow(e){let t=new d.SectorWindowMesh({width:e.width,height:e.height-e.width/2,depth:e.thickness,editor:e.editor});return t.create(),t.rotation.x=Math.PI/2,t.position.set(e.position.x,e.position.y,e.position.z-e.width/4),t.rotation.y=e.rotAngle,t}static createArcWindow(e){let t=e.hole,r=e.wall,n=new i.Vector2(1e3*r.startPoint.x,1e3*r.startPoint.y);new i.Vector2(1e3*r.endPoint.x,1e3*r.endPoint.y);let o=r.arcCenter.distanceTo(n);console.log(t,r,t.startRadian,t.endRadian,o);let a=new u.ArcBaseWindowMesh({height:t.height,startAngle:t.startRadian,endAngle:t.endRadian,radius:o,thickness:1e3*r.thickness,editor:e.editor});return a.create(),console.log(a),a.position.set(r.arcCenter.x,r.arcCenter.y,t.positionZ-t.height/2),a.rotation.x=Math.PI/2,a}static createLWindow(e){let t=new p.LWindowMesh(e);return t.create(),t.rotation.x=Math.PI/2,t.position.z=e.position.z-e.height/2,t}static createPanoramicWindow(e){let t=new m.PanoramicWindowMesh(e);return t.create(),t.rotation.x=Math.PI/2,t.position.set(e.position.x,e.position.y,e.position.z),t.rotation.y=e.rotAngle,t}static createUWindow(e){let t=new f.UWindowMesh(e);return t.create(),t.rotation.x=Math.PI/2,t.children.forEach(e=>{e.geometry.translate(0,480,0)}),t.position.set(e.position.x,e.position.y,e.position.z-e.height/2),t.rotation.y=e.rotAngle,t}}}),parcelRequire.register("evkYu",function(e,t){$parcel$export(e.exports,"BaseDoorMesh",()=>o);var i=parcelRequire("9vZPJ"),r=parcelRequire("4xklQ"),n=parcelRequire("hu0fb");class o extends i.Base3DMesh{constructor(e={}){if(super(),this.type="BaseDoorMesh",e.width=e.width||900,e.height=e.height||2200,e.depth=e.depth||150,e.doorDep=e.doorDep||50,e.frameBorder=e.frameBorder||38,e.handleEdge=e.handleEdge||50,e.handleBtm=e.handleBtm||1e3,!e.frameTexture){let t=e.editor.config.baseDoorFrame;t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,e.frameTexture=new r.MeshStandardMaterial({map:t})}if(!e.doorTexture){let t=e.editor.config.baseDoorFace;t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,e.doorTexture=new r.MeshStandardMaterial({map:t})}this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.frameTexture},t=this.createBox(e),i={width:this.parameter.width-2*this.parameter.frameBorder,height:this.parameter.height-this.parameter.frameBorder,depth:this.parameter.depth,material:new r.MeshBasicMaterial({color:16711680})},n=this.createBox(i);n.position.add(new r.Vector3(0,-this.parameter.frameBorder/2,0)),t=this.boolean(t,n);let o={width:this.parameter.width-2*this.parameter.frameBorder,height:this.parameter.height-this.parameter.frameBorder,depth:this.parameter.doorDep,material:this.parameter.doorTexture},a=this.createBox(o);a.position.add(new r.Vector3(0,-this.parameter.frameBorder/2,0));let s=this.createDoorstone();this.addHandle(),this.add(t,a,s)}addHandle(){let e=new n.GLTFLoader,t=this;e.load(window.url+"/assets/component/outerHandle.glb",function(e){let i=e.scene.children[0];i.applyMatrix4(new(0,r.Matrix4)().makeScale(-1e3,1e3,1e3)),e.scene.traverse(function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)});let n=new r.Box3().setFromObject(i);i.translateX(t.parameter.width/2-n.max.x-t.parameter.frameBorder-t.parameter.handleEdge),i.translateY(n.max.y-t.parameter.height/2+t.parameter.handleBtm),i.translateZ(-(n.max.z+t.parameter.doorDep/2)),t.add(i)}),e.load(window.url+"/assets/component/innerHandle.glb",function(e){let i=e.scene.children[0];i.applyMatrix4(new(0,r.Matrix4)().makeScale(-1e3,1e3,1e3)),e.scene.traverse(function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)});let n=new r.Box3().setFromObject(i);i.translateX(t.parameter.width/2-n.max.x-t.parameter.frameBorder-t.parameter.handleEdge),i.translateY(n.max.y-t.parameter.height/2+t.parameter.handleBtm-59.08065149103135),i.translateZ(n.max.z+t.parameter.doorDep/2),t.add(i)})}}}),parcelRequire.register("5L0a9",function(e,t){$parcel$export(e.exports,"DoubleOpenDoorMesh",()=>o);var i=parcelRequire("4xklQ"),r=parcelRequire("9vZPJ"),n=parcelRequire("hu0fb");class o extends r.Base3DMesh{constructor(e={}){if(super(),this.type="DoubleOpenDoorMesh",e.width=e.width||1500,e.height=e.height||2200,e.depth=e.depth||150,e.frameBorder=e.frameBorder||38,e.doorDep=e.doorDep||50,e.handleEdge=e.handleEdge||50,e.handleBtm=e.handleBtm||1e3,!e.frameTexture){let t=e.editor.config.baseDoorFrame;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.frameTexture=new i.MeshStandardMaterial({map:t})}if(!e.doorTexture){let t=e.editor.config.baseDoorFace;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.doorTexture=new i.MeshStandardMaterial({map:t})}this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.frameTexture},t=this.createBox(e),r={width:this.parameter.width-2*this.parameter.frameBorder,height:this.parameter.height-this.parameter.frameBorder,depth:this.parameter.depth},n=this.createBox(r);n.position.add(new i.Vector3(0,-this.parameter.frameBorder/2,0)),t=this.boolean(t,n),this.add(t);let o={width:this.parameter.width/2-this.parameter.frameBorder,height:this.parameter.height-this.parameter.frameBorder,depth:this.parameter.doorDep,material:this.parameter.doorTexture},a=this.createBox(o);a.position.add(new i.Vector3(-o.width/2,-this.parameter.frameBorder/2,0));let s=this.createBox(o);s.position.add(new i.Vector3(o.width/2,-this.parameter.frameBorder/2,0));let l=this.createDoorstone();this.addHandle(o.width/2),this.add(a,s,l)}addHandle(e){let t=new n.GLTFLoader,r=this;t.load(window.url+"/assets/component/outerHandle.glb",function(e){let t=e.scene.children[0];t.applyMatrix4(new(0,i.Matrix4)().makeScale(-1e3,1e3,1e3)),e.scene.traverse(function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)});let n=new i.Box3().setFromObject(t);t.translateX(-n.max.x-r.parameter.handleEdge),t.translateY(n.max.y-r.parameter.height/2+r.parameter.handleBtm),t.translateZ(-(n.max.z+r.parameter.doorDep/2)),r.add(t)}),t.load(window.url+"/assets/component/innerHandle.glb",function(e){let t=e.scene.children[0];t.applyMatrix4(new(0,i.Matrix4)().makeScale(-1e3,1e3,1e3)),e.scene.traverse(function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)});let n=new i.Box3().setFromObject(t);t.translateX(-n.max.x-r.parameter.handleEdge),t.translateY(n.max.y-r.parameter.height/2+r.parameter.handleBtm-59.08065149103135),t.translateZ(n.max.z+r.parameter.doorDep/2),r.add(t)}),t.load(window.url+"/assets/component/outerHandle.glb",function(e){let t=e.scene.children[0];t.applyMatrix4(new(0,i.Matrix4)().makeScale(1e3,1e3,1e3)),e.scene.traverse(function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)});let n=new i.Box3().setFromObject(t);t.translateX(n.max.x+r.parameter.handleEdge),t.translateY(n.max.y-r.parameter.height/2+r.parameter.handleBtm),t.translateZ(-(n.max.z+r.parameter.doorDep/2)),r.add(t)}),t.load(window.url+"/assets/component/innerHandle.glb",function(e){let t=e.scene.children[0];t.applyMatrix4(new(0,i.Matrix4)().makeScale(1e3,1e3,1e3)),e.scene.traverse(function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)});let n=new i.Box3().setFromObject(t);t.translateX(n.max.x+r.parameter.handleEdge),t.translateY(n.max.y-r.parameter.height/2+r.parameter.handleBtm-59.08065149103135),t.translateZ(n.max.z+r.parameter.doorDep/2),r.add(t)})}}}),parcelRequire.register("8y3mE",function(e,t){$parcel$export(e.exports,"SlidingDoorMesh",()=>n);var i=parcelRequire("9vZPJ"),r=parcelRequire("4xklQ");class n extends i.Base3DMesh{constructor(e={}){if(super(),this.type="SlidingDoorMesh",e.width=e.width||1660,e.height=e.height||2200,e.depth=e.depth||100,e.doorDepth=e.doorDepth||35,e.frameBorder=e.frameBorder||30,e.doorNum=e.doorNum||t(e.width),e.doorCoincide=e.doorCoincide||18,e.doorBorder=e.doorBorder||150,e.doorGap=e.doorGap||2,!e.frameTexture){let t=e.editor.config.slidingDoorframe;t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,e.frameTexture=new r.MeshStandardMaterial({map:t})}if(!e.doorTexture){let t=e.editor.config.slidingDoorFace;t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,e.doorTexture=new r.MeshStandardMaterial({map:t})}function t(e){return e<=2e3?2:e<2500?3:4}this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.frameTexture},t=this.createBox(e),i=this.parameter.width-2*this.parameter.frameBorder,n=this.parameter.height-this.parameter.frameBorder,o={width:i,height:n,depth:this.parameter.depth},a=this.createBox(o);a.position.add(new r.Vector3(0,-this.parameter.frameBorder/2,0));let s=this.boolean(t,a),l={width:i/this.parameter.doorNum+this.parameter.doorCoincide,height:n,depth:this.parameter.doorDepth,material:this.parameter.doorTexture},h={width:l.width-2*this.parameter.doorBorder,height:l.height-2*this.parameter.doorBorder,depth:l.depth,material:new r.MeshStandardMaterial({color:new r.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new r.Vector2(1,-1),side:2,transparent:!0,opacity:.1,roughness:.1})};if(2===this.parameter.doorNum){let e=this.createDoor(l,h),t=e.clone();e.position.add(new r.Vector3(-(i-l.width)/2,0,-(l.depth+this.parameter.doorGap)/2)),t.position.add(new r.Vector3((i-l.width)/2,0,(l.depth+this.parameter.doorGap)/2)),this.add(e,t)}if(3===this.parameter.doorNum){let e=this.createDoor(l,h),t=e.clone(),n=e.clone();e.position.add(new r.Vector3(-(i-l.width)/2,0,(l.depth+this.parameter.doorGap)/2)),t.position.add(new r.Vector3(0,0,-(l.depth+this.parameter.doorGap)/2)),n.position.add(new r.Vector3((i-l.width)/2,0,(l.depth+this.parameter.doorGap)/2)),this.add(e,t,n)}if(4===this.parameter.doorNum){let e=this.createDoor(l,h),t=e.clone(),n=e.clone(),o=e.clone();e.position.add(new r.Vector3(-(i-l.width)/2,0,-(l.depth+this.parameter.doorGap)/2)),t.position.add(new r.Vector3(-l.width/2,0,(l.depth+this.parameter.doorGap)/2)),n.position.add(new r.Vector3(l.width/2,0,(l.depth+this.parameter.doorGap)/2)),o.position.add(new r.Vector3((i-l.width)/2,0,-(l.depth+this.parameter.doorGap)/2)),this.add(e,t,n,o)}let c=this.createDoorstone();this.add(s,c)}createDoor(e,t){let i=new r.Group,n=this.createBox(e),o=this.createBox(t);n=this.boolean(n,o),t.depth/=3;let a=this.createBox(t);return i.add(n,a),i}setFrameBorder(e,t=!1){this.setParameter("frameBorder",e,t)}getFrameBorder(){return this.parameter.frameBorder}setDoorDepth(e,t=!1){this.setParameter("doorDepth",e,t)}getDoorDepth(){return this.parameter.doorDepth}setDoorNum(e,t=!1){this.setParameter("doorNum",e,t)}getDoorNum(){return this.parameter.doorNum}setDoorCoincide(e,t=!1){this.setParameter("doorCoincide",e,t)}getDoorCoincide(){return this.parameter.doorCoincide}setFrameTexture(e,t=!1){this.setParameter("frameTexture",e,t)}getFrameTexture(){return this.parameter.frameTexture}setDoorTexture(e,t=!1){this.setParameter("doorTexture",e,t)}getDoorTexture(){return this.parameter.doorTexture}setDoorBorder(e,t=!1){this.setParameter("doorBorder",e,t)}getDoorBorder(){return this.parameter.doorBorder}setDoorGap(e,t=!1){this.setParameter("doorGap",e,t)}getDoorGap(){return this.parameter.doorGap}}}),parcelRequire.register("4cEbr",function(e,t){$parcel$export(e.exports,"BaseWindowMesh",()=>n);var i=parcelRequire("9vZPJ"),r=parcelRequire("4xklQ");class n extends i.Base3DMesh{constructor(e={}){if(super(),this.type="BaseWindowMesh",e.style=e.style||1,e.width=e.width||1600,e.height=e.height||1200,e.depth=e.depth||100,e.frameBorder=e.frameBorder||50,e.windowDepth=e.windowDepth||40,e.windowBorder=e.windowBorder||50,e.windowCoincide=e.windowCoincide||50,e.heightFromGround=e.heightFromGround||500,2==e.style&&(e.height=e.height||1500,e.top=e.top||"double",e.bottom=e.bottom||"double",e.rungPosition=e.rungPosition||"top|"+(e.height-3*e.frameBorder)/4,e.rungHeight=e.rungHeight||50),!e.frameTexture){let t=e.editor.config.baseWindowFrame;t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,e.frameTexture=new r.MeshStandardMaterial({map:t})}if(!e.windowTexture){let t=e.editor.config.baseWindowFace;t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,e.windowTexture=new r.MeshStandardMaterial({map:t})}e.mirrorTexture=new r.MeshStandardMaterial({color:new r.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new r.Vector2(1,-1),side:2,transparent:!0,opacity:.1,roughness:.1}),this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.frameTexture},t=this.createBox(e);1==this.parameter.style&&this.createStyle1(t),2==this.parameter.style&&this.createStyle2(t)}createStyle1(e){let t=this.parameter.width-2*this.parameter.frameBorder,i=this.parameter.height-2*this.parameter.frameBorder,n={width:t,height:i,depth:this.parameter.depth},o=this.createBox(n),a=this.boolean(e,o),s=this.createSingleWindow(t,i,this.parameter.windowBorder,this.parameter.windowDepth),l=t/2+this.parameter.windowBorder/2,h=s.clone();s.position.add(new r.Vector3((this.parameter.windowBorder-l)/2,0,this.parameter.windowDepth/2)),h.position.add(new r.Vector3(-(this.parameter.windowBorder-l)/2,0,-this.parameter.windowDepth/2)),this.add(a,s,h)}createStyle2(e){let t,i=this.parameter.width-2*this.parameter.frameBorder,n=this.parameter.height-2*this.parameter.frameBorder,o=this.parameter.rungPosition.split("|"),a=parseFloat(o[1]);if(a>n-this.parameter.rungHeight){console.log("数据不合法，请检查参数。");return}console.log(o);let s=this.getFinalFrame(e,o[0],a,i,n);this.add(s);let l={width:i,depth:this.parameter.windowDepth/4,material:new r.MeshBasicMaterial({color:16711680,transparent:!0,opacity:.5})},h=i/2+this.parameter.windowBorder/2;if("single"==this.parameter.top){"top"==o[0]&&(l.height=a),"bottom"==o[0]&&(l.height=n-a-this.parameter.rungHeight);let e=this.createBox(l);e.position.add(new r.Vector3(0,(n-l.height)/2,0)),this.add(e)}else if("double"==this.parameter.top){"top"==o[0]&&(t=a),"bottom"==o[0]&&(t=n-a-this.parameter.rungHeight);let e=this.createSingleWindow(i,t,this.parameter.windowBorder,this.parameter.windowDepth);e.position.add(new r.Vector3((this.parameter.windowBorder-h)/2,(n-t)/2,this.parameter.windowDepth/2));let s=this.createSingleWindow(i,t,this.parameter.windowBorder,this.parameter.windowDepth);s.position.add(new r.Vector3(-(this.parameter.windowBorder-h)/2,(n-t)/2,-this.parameter.windowDepth/2)),this.add(e,s)}if("single"==this.parameter.bottom){"top"==o[0]&&(l.height=n-a-this.parameter.rungHeight),"bottom"==o[0]&&(l.height=a);let e=this.createBox(l);e.position.add(new r.Vector3(0,-(n-l.height)/2,0)),this.add(e)}else if("double"==this.parameter.bottom){"top"==o[0]&&(t=n-a-this.parameter.rungHeight),"bottom"==o[0]&&(t=a);let e=this.createSingleWindow(i,t,this.parameter.windowBorder,this.parameter.windowDepth);e.position.add(new r.Vector3((this.parameter.windowBorder-h)/2,-(n-t)/2,this.parameter.windowDepth/2));let s=this.createSingleWindow(i,t,this.parameter.windowBorder,this.parameter.windowDepth);s.position.add(new r.Vector3(-(this.parameter.windowBorder-h)/2,-(n-t)/2,-this.parameter.windowDepth/2)),this.add(e,s)}}getFinalFrame(e,t,i,n,o){let a,s;if("top"==t){let e={width:n,height:i,depth:this.parameter.depth,material:new r.MeshBasicMaterial({color:65280})};(a=this.createBox(e)).position.add(new r.Vector3(0,(o-i)/2,0));let t={width:n,height:o-i-this.parameter.rungHeight,depth:this.parameter.depth,material:new r.MeshBasicMaterial({color:16711680})};(s=this.createBox(t)).position.add(new r.Vector3(0,(t.height-o)/2,0))}if("bottom"==t){let e={width:n,height:i,depth:this.parameter.depth,material:new r.MeshBasicMaterial({color:16711680})};(s=this.createBox(e)).position.add(new r.Vector3(0,-(o-i)/2,0));let t={width:n,height:o-i-this.parameter.rungHeight,depth:this.parameter.depth,material:new r.MeshBasicMaterial({color:65280})};(a=this.createBox(t)).position.add(new r.Vector3(0,(o-t.height)/2,0))}let l=this.boolean(a,s,"union");return e=this.boolean(e,l)}setFrameBorder(e,t=!1){this.setParameter("frameBorder",e,t)}getFrameBorder(){return this.parameter.frameBorder}setWindowDepth(e,t=!1){this.setParameter("windowDepth",e,t)}getWindowDepth(){return this.parameter.windowDepth}setWindowBorder(e,t=!1){this.setParameter("windowBorder",e,t)}getWindowBorder(){return this.parameter.windowBorder}setWindowCoincide(e,t=!1){this.setParameter("windowCoincide",e,t)}getWindowCoincide(){return this.parameter.windowCoincide}setFrameTexture(e,t=!1){this.setParameter("frameTexture",e,t)}getFrameTexture(){return this.parameter.frameTexture}}}),parcelRequire.register("eDeYG",function(e,t){$parcel$export(e.exports,"FrenchWindowMesh",()=>n);var i=parcelRequire("9vZPJ"),r=parcelRequire("4xklQ");class n extends i.Base3DMesh{constructor(e={}){super(),this.type="FrenchWindowMesh",e.style=e.style||1,e.width=e.width||2e3,e.height=e.height||1800,e.depth=e.depth||80,e.frameBorder=e.frameBorder||50,e.middleRatio=e.middleRatio||750/1800,e.gap=e.gap||15,e.bulge=e.bulge||5;let t=e.editor.config.baseWindowFrame;t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,e.frameTexture=new r.MeshStandardMaterial({map:t});let i=e.editor.config.baseWindowFace;i.wrapS=r.RepeatWrapping,i.wrapT=r.RepeatWrapping,e.windowTexture=new r.MeshStandardMaterial({map:i}),e.mirrorTexture=new r.MeshStandardMaterial({color:new r.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new r.Vector2(1,-1),side:2,transparent:!0,opacity:.1,roughness:.1}),this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.frameTexture},t=this.createBox(e);1==this.parameter.style&&this.createStyle1(t),2==this.parameter.style&&this.createStyle2(t)}createStyle1(e){let t=this.parameter.width-4*this.parameter.frameBorder,i=this.parameter.height-3*this.parameter.frameBorder,n=this.getStyle1Hole(t,i),o=this.boolean(e,n);this.add(o);let a={width:t*this.parameter.middleRatio,height:.75*i,depth:this.parameter.depth/8,material:this.parameter.mirrorTexture},s=this.createBox(a);s.name="glass",s.position.add(new r.Vector3(0,(i-a.height)/2,0));let l={width:(t+this.parameter.frameBorder)/2,height:.25*i,depth:this.parameter.depth/8,material:this.parameter.mirrorTexture},h=this.createBox(l);h.name="glass",h.position.add(new r.Vector3(-(t+2*this.parameter.frameBorder-l.width)/2,(l.height-(i+this.parameter.frameBorder))/2,0));let c=this.createBox(l);c.name="glass",c.position.add(new r.Vector3((t+2*this.parameter.frameBorder-l.width)/2,(l.height-(i+this.parameter.frameBorder))/2,0)),this.add(s,h,c);let d=this.createTuWindow(t,i);d.position.add(new r.Vector3(-((t-t*(1-this.parameter.middleRatio)/2-this.parameter.gap)/2+this.parameter.frameBorder),.25*i/2,this.parameter.depth/4+this.parameter.bulge));let u=this.createTuWindow(t,i);u.position.add(new r.Vector3((t-t*(1-this.parameter.middleRatio)/2-this.parameter.gap)/2+this.parameter.frameBorder,.25*i/2,this.parameter.depth/4+this.parameter.bulge)),this.add(d,u)}createTuWindow(e,t){let i=new r.Group,n={width:e*(1-this.parameter.middleRatio)/2+this.parameter.gap,height:.75*t+2*this.parameter.gap,depth:this.parameter.depth/2,material:this.parameter.windowTexture},o=this.createBox(n),a={width:n.width,height:this.parameter.gap,depth:n.depth-this.parameter.bulge,material:new r.MeshBasicMaterial({color:16711680})},s={width:this.parameter.gap/2,height:n.height,depth:n.depth-this.parameter.bulge,material:new r.MeshBasicMaterial({color:16711680})},l=this.createBox(a);l.position.add(new r.Vector3(0,(n.height-a.height)/2,-this.parameter.bulge/1));let h=this.createBox(a);h.position.add(new r.Vector3(0,(a.height-n.height)/2,-this.parameter.bulge/1));let c=this.createBox(s);c.position.add(new r.Vector3(-(s.width-n.width)/2,0,-this.parameter.bulge/1));let d=this.createBox(s);d.position.add(new r.Vector3((s.width-n.width)/2,0,-this.parameter.bulge/1));let u={width:n.width-2*this.parameter.frameBorder,height:n.height-2*this.parameter.frameBorder,depth:n.depth,material:this.parameter.mirrorTexture},p=this.createBox(u);[l,h,c,d].forEach(e=>{p=this.boolean(p,e,"union")}),o=this.boolean(o,p);let m=this.createBox(u);return m.name="glass",i.add(o,m),i}getStyle1Hole(e,t){let i={width:e*(1-this.parameter.middleRatio)/2,height:.75*t,depth:this.parameter.depth},n={width:e*this.parameter.middleRatio,height:.75*t,depth:this.parameter.depth},o={width:(e+this.parameter.frameBorder)/2,height:.25*t,depth:this.parameter.depth},a=this.createBox(i);a.position.add(new r.Vector3(-((e-i.width)/2+this.parameter.frameBorder)/1,(t-i.height)/2,0));let s=this.createBox(i);s.position.add(new r.Vector3(((e-i.width)/2+this.parameter.frameBorder)/1,(t-i.height)/2,0));let l=this.createBox(n);l.position.add(new r.Vector3(0,(t-n.height)/2,0));let h=this.createBox(o);h.position.add(new r.Vector3(-(e+2*this.parameter.frameBorder-o.width)/2,(o.height-(t+this.parameter.frameBorder))/2,0));let c=this.createBox(o);c.position.add(new r.Vector3((e+2*this.parameter.frameBorder-o.width)/2,(o.height-(t+this.parameter.frameBorder))/2,0));let d=a;return[s,l,h,c].forEach(e=>{d=this.boolean(d,e,"union")}),d}createStyle2(e){}}}),parcelRequire.register("b4XIY",function(e,t){$parcel$export(e.exports,"LashDoorMesh",()=>o);var i=parcelRequire("4xklQ"),r=parcelRequire("9vZPJ"),n=parcelRequire("hu0fb");class o extends r.Base3DMesh{constructor(e={}){if(super(),this.type="LashDoorMesh",e.style=e.style||1,e.width=e.width||1100,e.height=e.height||2200,e.depth=e.depth||240,e.frameBorder=e.frameBorder||10,e.coincide=e.coincide||3,e.doorDep=e.doorDep||50,e.handleEdge=e.handleEdge||50,e.handleBtm=e.handleBtm||1e3,!e.frameTexture){let t=e.editor.config.baseDoorFrame;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.frameTexture=new i.MeshStandardMaterial({map:t})}if(!e.doorTexture){let t=e.editor.config.baseDoorFace;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.doorTexture=new i.MeshStandardMaterial({map:t})}if(!e.partitionTexture){let t=e.editor.config.lashDoorPartition;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.partitionTexture=new i.MeshStandardMaterial({map:t})}this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.frameTexture},t=this.createBox(e);1==this.parameter.style&&this.createStyle1(t),2==this.parameter.style&&this.createStyle2(t);let i=this.createDoorstone();this.add(i)}createStyle1(e){let t=this.parameter.width-2*this.parameter.frameBorder,r=this.parameter.height-this.parameter.frameBorder,n={width:t,height:r,depth:this.parameter.depth},o=this.createBox(n);o.position.set(0,-this.parameter.frameBorder/2,0);let a=this.boolean(e,o);this.add(a);let s={width:.33*t-this.parameter.coincide/2,height:r,depth:this.parameter.doorDep,material:this.parameter.doorTexture},l=this.createBox(s);l.position.add(new i.Vector3((t-s.width+this.parameter.coincide/2)/2,-this.parameter.frameBorder/2,0)),console.log("partition - ",this.parameter.coincide);let h={width:this.parameter.coincide,height:r,depth:this.parameter.doorDep,material:this.parameter.partitionTexture},c=this.createBox(h);c.translateX(.17*t),c.translateY(-this.parameter.frameBorder/2),this.add(c);let d={width:.67*t-this.parameter.coincide/2,height:r,depth:this.parameter.doorDep,material:this.parameter.doorTexture},u=this.createBox(d);return u.position.add(new i.Vector3(-(t-d.width+this.parameter.coincide/2)/2,-this.parameter.frameBorder/2,0)),this.add(l,u),this.addHandle(),this}createStyle2(e){}addHandle(){let e=new n.GLTFLoader,t=this;e.load(window.url+"/assets/component/outerHandle.glb",function(e){let r=e.scene.children[0];r.applyMatrix4(new(0,i.Matrix4)().makeScale(-1e3,1e3,1e3)),e.scene.traverse(function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)});let n=new i.Box3().setFromObject(r);r.translateX(.17*t.parameter.width-n.max.x-t.parameter.handleEdge),r.translateY(n.max.y-t.parameter.height/2+t.parameter.handleBtm),r.translateZ(-(n.max.z+t.parameter.doorDep/2)),t.add(r)}),e.load(window.url+"/assets/component/innerHandle.glb",function(e){let r=e.scene.children[0];r.applyMatrix4(new(0,i.Matrix4)().makeScale(-1e3,1e3,1e3)),e.scene.traverse(function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)});let n=new i.Box3().setFromObject(r);r.translateX(.17*t.parameter.width-n.max.x-t.parameter.handleEdge),r.translateY(n.max.y-t.parameter.height/2+t.parameter.handleBtm-59.08065149103135),r.translateZ(n.max.z+t.parameter.doorDep/2),t.add(r)})}}}),parcelRequire.register("gKzkd",function(e,t){$parcel$export(e.exports,"PassMesh",()=>n);var i=parcelRequire("9vZPJ"),r=parcelRequire("4xklQ");class n extends i.Base3DMesh{constructor(e={}){if(super(),this.type="PassDoorMesh",e.width=e.width||900,e.height=e.height||2250,e.depth=e.depth||100,e.frameBorder=e.frameBorder||50,!e.frameTexture){let t=e.editor.config.passMeshTexture;t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,e.frameTexture=new r.MeshStandardMaterial({map:t})}this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.frameTexture},t=this.createBox(e),i={width:this.parameter.width-2*this.parameter.frameBorder,height:this.parameter.height-this.parameter.frameBorder,depth:this.parameter.depth},r=this.createBox(i);r.position.set(0,-this.parameter.frameBorder,0);let n=this.boolean(t,r),o=this.createDoorstone();this.add(n,o)}}}),parcelRequire.register("7T7Cq",function(e,t){$parcel$export(e.exports,"SectorDoorMesh",()=>o);var i=parcelRequire("4xklQ"),r=parcelRequire("9vZPJ"),n=parcelRequire("hu0fb");class o extends r.Base3DMesh{constructor(e={}){if(super(),this.type="SectorDoorMesh",e.width=e.width||860,e.height=e.height||2e3,e.depth=e.depth||65,e.frameBorder=e.frameBorder||38,e.doorDep=e.doorDep||50,e.handleEdge=e.handleEdge||50,e.handleBtm=e.handleBtm||1e3,!e.frameTexture){let t=e.editor.config.baseDoorFrame;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.frameTexture=new i.MeshStandardMaterial({map:t})}if(!e.texture){let t=e.editor.config.sectorDoorTexture;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.texture=new i.MeshStandardMaterial({map:t})}this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.frameTexture},t=this.createArchBox(e),i={width:this.parameter.width-2*this.parameter.frameBorder,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.texture},r=this.createArchBox(i);t=this.boolean(t,r),i.depth=this.parameter.doorDep;let n=this.createArchBox(i),o=this.createDoorstone();this.add(t,n,o),this.addHandle()}addHandle(){let e=new n.GLTFLoader,t=this;e.load(window.url+"/assets/component/outerHandle.glb",function(e){let r=e.scene.children[0];r.applyMatrix4(new(0,i.Matrix4)().makeScale(-1e3,1e3,1e3)),e.scene.traverse(function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)});let n=new i.Box3().setFromObject(r);r.translateX(t.parameter.width/2-n.max.x-t.parameter.frameBorder-t.parameter.handleEdge),r.translateY(n.max.y-t.parameter.height/2+t.parameter.handleBtm),r.translateZ(-(n.max.z+t.parameter.doorDep/2)),t.add(r)}),e.load(window.url+"/assets/component/innerHandle.glb",function(e){let r=e.scene.children[0];r.applyMatrix4(new(0,i.Matrix4)().makeScale(-1e3,1e3,1e3)),e.scene.traverse(function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)});let n=new i.Box3().setFromObject(r);r.translateX(t.parameter.width/2-n.max.x-t.parameter.frameBorder-t.parameter.handleEdge),r.translateY(n.max.y-t.parameter.height/2+t.parameter.handleBtm-59.08065149103135),r.translateZ(n.max.z+t.parameter.doorDep/2),t.add(r)})}}}),parcelRequire.register("fxI5g",function(e,t){$parcel$export(e.exports,"SectorWindowMesh",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("9vZPJ");class n extends r.Base3DMesh{constructor(e={}){if(super(),this.type="SectorWindowMesh",e.style=e.style||1,e.width=e.width||1600,e.height=e.height||1600,e.depth=e.depth||100,e.frameBorder=e.frameBorder||50,!e.texture){let t=e.editor.config.baseWindowFrame;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.texture=new i.MeshStandardMaterial({map:t})}if(!e.windowTexture){let t=e.editor.config.baseWindowFace;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.windowTexture=new i.MeshStandardMaterial({map:t})}e.mirrorTexture=new i.MeshStandardMaterial({color:new i.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new i.Vector2(1,-1),side:2,transparent:!0,opacity:.1,roughness:.1}),this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:this.parameter.texture},t=this.createBox(e),r={width:this.parameter.width-2*this.parameter.frameBorder,height:this.parameter.height-2*this.parameter.frameBorder,depth:this.parameter.depth,material:new i.MeshBasicMaterial({color:16711680})},n=this.createBox(r),o=this.boolean(t,n);this.add(o);let a=new i.CylinderGeometry(this.parameter.width/2,this.parameter.width/2,this.parameter.depth/1,32),s=new i.Mesh(a,this.parameter.texture);s.position.y=this.parameter.height/2/1,s.rotation.x=Math.PI/2,s=this.boolean(s,t);let l=(this.parameter.width-2*this.parameter.frameBorder)/2,h=new i.CylinderGeometry(l,l,this.parameter.depth/1,32),c=new i.Mesh(h,new i.MeshBasicMaterial({color:16711680}));c.position.y=this.parameter.height/2/1,c.rotation.x=Math.PI/2,c=this.boolean(c,t),s=this.boolean(s,c),this.add(s);let d=new i.CylinderGeometry(l,l,this.parameter.depth/10,32),u=new i.Mesh(d,this.parameter.mirrorTexture);u.position.y=this.parameter.height/2/1,u.rotation.x=Math.PI/2,(u=this.boolean(u,t)).name="glass",this.add(u),1==this.parameter.style&&this.createStyle1(),2==this.parameter.style&&this.createStyle2()}createStyle1(){let e=40,t=this.parameter.width-2*this.parameter.frameBorder,r=this.parameter.height-2*this.parameter.frameBorder,n=this.createSingleWindow(t,r,this.parameter.frameBorder,e);n.position.add(new i.Vector3((-t/2+this.parameter.frameBorder/2)/2,0,e/2));let o=this.createSingleWindow(t,r,this.parameter.frameBorder,e);o.position.add(new i.Vector3((t/2-this.parameter.frameBorder/2)/2,0,-e/2)),this.add(n,o)}createStyle2(){let e={width:this.parameter.width-2*this.parameter.frameBorder,height:this.parameter.height-2*this.parameter.frameBorder,depth:this.parameter.depth/10,material:this.parameter.mirrorTexture},t=this.createBox(e);this.add(t)}}}),parcelRequire.register("eiZ6q",function(e,t){$parcel$export(e.exports,"ArcBaseWindowMesh",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("9vZPJ");class n extends r.Base3DMesh{constructor(e={}){if(super(),this.type="ArcBaseWindowMesh",e.height=e.height||1600,e.startAngle=e.startAngle||Math.PI/4,e.endAngle=e.endAngle||.75*Math.PI,e.radius=e.radius||2e3,e.thickness=e.thickness||120,e.frameBorder=e.frameBorder||50,!e.texture){let t=e.editor.config.baseWindowFrame;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.texture=new i.MeshStandardMaterial({map:t})}this.mirrorTexture=new i.MeshStandardMaterial({color:new i.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new i.Vector2(1,-1),side:2,transparent:!0,opacity:.1,roughness:.1}),this.parameter=e}create(){console.log(this.parameter.radius,this.parameter.thickness);let e=this.parameter.radius+this.parameter.thickness/2,t=this.parameter.radius-this.parameter.thickness/2,r=Math.round(Math.PI/Math.asin(this.parameter.thickness/(e+this.parameter.thickness))/2);r=r>100?100:r;let n=this.getArcPath(e,this.parameter.startAngle,this.parameter.endAngle,r,!0),o=this.getArcPath(t,this.parameter.startAngle,this.parameter.endAngle,r,!0),a=n.concat(o.reverse()),s=this.createShapeOrStereoscopic(a,this.parameter.height,this.parameter.texture),l=this.parameter.frameBorder/t,h=this.parameter.startAngle+l,c=this.parameter.endAngle-l,d=this.parameter.height-2*this.parameter.frameBorder,u=this.getArcPath(e+1,h,c,r,!0),p=this.getArcPath(t-1,h,c,r,!0),m=u.concat(p.reverse()),f=this.createShapeOrStereoscopic(m,d,new i.MeshBasicMaterial({color:16711680}));f.position.y=this.parameter.frameBorder;let g=this.boolean(s,f);this.add(g);let y=this.parameter.radius+this.parameter.thickness/4,x=this.parameter.radius-this.parameter.thickness/4,w=this.getArcPath(y,h,c,r,!0),b=this.getArcPath(x,h,c,r,!0),v=w.concat(b.reverse()),M=this.createShapeOrStereoscopic(v,d,this.mirrorTexture);M.position.y=this.parameter.frameBorder,M.name="glass",this.add(M)}getArcPath(e,t,r,n,o=!1){let a=new i.Path;return a.arc(0,0,e,t,r,!1),o?a.getPoints(n):a}}}),parcelRequire.register("heK7I",function(e,t){$parcel$export(e.exports,"LWindowMesh",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("9vZPJ");class n extends r.Base3DMesh{constructor(e={}){if(super(),this.type="LWindowMesh",e.style=e.style||1,e.leftPoint=e.leftPoint||new i.Vector2(0,-1320),e.commonPoint=e.commonPoint||new i.Vector2,e.rightPoint=e.rightPoint||new i.Vector2(1320,0),e.height=e.height||1600,e.leftDepth=e.leftDepth||120,e.rightDepth=e.rightDepth||120,e.frameBorder=e.frameBorder||50,!e.texture){let t=e.editor.config.baseWindowFrame;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.texture=new i.MeshStandardMaterial({map:t})}function t(e,t,r,n,o){let a=new(0,i.Vector2)().subVectors(t,e).normalize(),s=new(0,i.Vector2)().subVectors(r,t).normalize(),l=new(0,i.Vector2)(-s.y,s.x).normalize(),h=o/a.dot(l),c=a.clone().setLength(h),d=new(0,i.Vector2)(-a.y,a.x).normalize(),u=n/s.clone().negate().dot(d),p=s.clone().negate().setLength(u);return c.add(p)}this.mirrorTexture=new i.MeshStandardMaterial({color:new i.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new i.Vector2(1,-1),side:2,transparent:!0,opacity:.1,roughness:.1}),function(e){let i=t(e.leftPoint,e.commonPoint,e.rightPoint,e.leftDepth/2,e.rightDepth/2),r=i.angle(),n=e.leftPoint.clone().sub(e.commonPoint).angle(),o=e.rightPoint.clone().sub(e.commonPoint).angle(),a=r>o?r-o:r+2*Math.PI-o,s=r<n?Math.PI-n+r:r-n-Math.PI,l=Math.abs(e.rightDepth/2/Math.tan(a)),h=Math.abs(e.leftDepth/2/Math.tan(s));e.miter=i,e.leftDiff=Math.round(100*h)/100,e.rightDiff=Math.round(100*l)/100}(e),this.parameter=e}create(){let e=this.parameter.commonPoint.clone().add(this.parameter.miter),t=e.clone().add(this.parameter.miter),r=e.clone().add(this.parameter.commonPoint).divideScalar(2),n=e.clone().add(t).divideScalar(2),o=this.parameter.leftPoint.clone().sub(this.parameter.commonPoint),a=this.parameter.leftPoint.clone().distanceTo(this.parameter.commonPoint)+2*this.parameter.leftDiff,s=t.clone().add(o.clone().setLength(a)),l=[this.parameter.commonPoint,this.parameter.leftPoint,s,t],h=this.createShapeOrStereoscopic(l,this.parameter.height,this.parameter.texture),c=this.parameter.leftPoint.clone().add(o.clone().negate().setLength(this.parameter.frameBorder)),d=s.clone().add(o.clone().negate().setLength(this.parameter.frameBorder)),u=10,p=this.parameter.commonPoint.clone().add(this.parameter.commonPoint.clone().sub(t).setLength(u));p=p.clone().add(p.clone().sub(c).setLength(u));let m=t.clone().add(t.clone().sub(this.parameter.commonPoint).setLength(u));m=m.clone().add(m.clone().sub(d).setLength(u));let f=c.clone().add(c.clone().sub(d).setLength(u)),g=d.clone().add(d.clone().sub(c).setLength(u)),y=[p,f,g,m],x=this.createShapeOrStereoscopic(y,this.parameter.height-2*this.parameter.frameBorder,new i.MeshBasicMaterial({color:65280}));x.position.y=this.parameter.frameBorder,h=this.boolean(h,x);let w=r.clone().add(o.clone().setLength(o.length()-this.parameter.frameBorder+this.parameter.leftDiff/2)),b=n.clone().add(o.clone().setLength(o.length()-this.parameter.frameBorder+3*this.parameter.leftDiff/2)),v=[r,w,b,n],M=this.createShapeOrStereoscopic(v,this.parameter.height-2*this.parameter.frameBorder,this.mirrorTexture);M.position.y=this.parameter.frameBorder,M.name="glass";let S=this.parameter.rightPoint.clone().sub(this.parameter.commonPoint),P=this.parameter.rightPoint.clone().distanceTo(this.parameter.commonPoint)+2*this.parameter.rightDiff,T=t.clone().add(S.clone().setLength(P)),_=[this.parameter.commonPoint,this.parameter.rightPoint,T,t],C=this.createShapeOrStereoscopic(_,this.parameter.height,this.parameter.texture),D=this.parameter.rightPoint.clone().add(S.clone().negate().setLength(this.parameter.frameBorder)),A=T.clone().add(S.clone().negate().setLength(this.parameter.frameBorder));p=(p=this.parameter.commonPoint.clone().add(this.parameter.commonPoint.clone().sub(t).setLength(u))).clone().add(p.clone().sub(D).setLength(u)),m=(m=t.clone().add(t.clone().sub(this.parameter.commonPoint).setLength(u))).clone().add(m.clone().sub(A).setLength(u));let E=[p,f=D.clone().add(D.clone().sub(A).setLength(u)),g=A.clone().add(A.clone().sub(D).setLength(u)),m],L=this.createShapeOrStereoscopic(E,this.parameter.height-2*this.parameter.frameBorder,new i.MeshBasicMaterial({color:255}));L.position.y=this.parameter.frameBorder,C=this.boolean(C,L);let I=r.clone().add(S.clone().setLength(S.length()-this.parameter.frameBorder+this.parameter.rightDiff/2)),R=n.clone().add(S.clone().setLength(S.length()-this.parameter.frameBorder+3*this.parameter.rightDiff/2)),W=[r,I,R,n],V=this.createShapeOrStereoscopic(W,this.parameter.height-2*this.parameter.frameBorder,this.mirrorTexture);V.position.y=this.parameter.frameBorder,V.name="glass";let k=[w,b,n,R,I,r],B=this.createShapeOrStereoscopic(k,this.parameter.height-2*this.parameter.frameBorder,this.mirrorTexture);B.position.y=this.parameter.frameBorder,B.name="glass",this.add(h,C),this.add(B)}}}),parcelRequire.register("3tFct",function(e,t){$parcel$export(e.exports,"PanoramicWindowMesh",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("9vZPJ");class n extends r.Base3DMesh{constructor(e={}){if(super(),this.type="PanoramicWindowMesh",e.width=e.width||2e3,e.height=e.height||2e3,e.depth=e.depth||1e3,e.platformBorder=e.platformBorder||100,e.windowFrameBorder=e.windowFrameBorder||50,e.thickness=e.thickness||240,e.top=e.top||"double",e.bottom=e.bottom||"double",e.rungPosition=e.rungPosition||"bottom|"+(e.height-3*e.windowFrameBorder)/4,!e.texture){let t=e.editor.config.baseWindowFrame;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.texture=new i.MeshStandardMaterial({map:t})}e.mirrorTexture=new i.MeshStandardMaterial({color:new i.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new i.Vector2(1,-1),side:2,transparent:!0,opacity:.1,roughness:.1}),this.parameter=e}create(){let e={width:this.parameter.width,height:this.parameter.height,depth:this.parameter.depth,material:new i.MeshStandardMaterial({color:16777215})},t=this.createBox(e),r={width:this.parameter.width-2*this.parameter.platformBorder,height:this.parameter.height-2*this.parameter.platformBorder,depth:this.parameter.depth},n=this.createBox(r);(t=this.boolean(t,n)).position.add(new i.Vector3(0,0,this.parameter.thickness/2-e.depth/2)),this.createWindow(),this.add(t)}createWindow(){let e=this.parameter.width-2*this.parameter.platformBorder-2*this.parameter.windowFrameBorder,t=this.parameter.height-2*this.parameter.platformBorder-2*this.parameter.windowFrameBorder,i=this.parameter.rungPosition.split("|"),r=parseFloat(i[1]);if(r>t-this.parameter.windowFrameBorder){console.log("数据不合法，请检查参数。");return}this.getFinalWindow(i[0],r,e,t)}getFinalWindow(e,t,r,n){let o,a,s=new i.Group,l=100,h={width:this.parameter.width-2*this.parameter.platformBorder,height:this.parameter.height-2*this.parameter.platformBorder,depth:l,material:this.parameter.texture},c=this.createBox(h);if("top"==e){if("single"==this.parameter.top){let e={width:r,height:t,depth:100,material:new i.MeshBasicMaterial({color:65280})};(o=this.createBox(e)).position.add(new i.Vector3(0,(n-t)/2,0)),e.depth/=2,e.material=this.parameter.mirrorTexture;let a=this.createBox(e);a.position.add(new i.Vector3(0,(n-t)/2,0)),a.name="glass",s.add(a)}else if("double"==this.parameter.top){let e={width:(r-this.parameter.windowFrameBorder)/2,height:t,depth:100,material:new i.MeshBasicMaterial({color:65280})},a=this.createBox(e),l=a.clone();a.position.add(new i.Vector3(-(r+this.parameter.windowFrameBorder)/4,(n-t)/2,0)),l.position.add(new i.Vector3((r+this.parameter.windowFrameBorder)/4,(n-t)/2,0)),o=this.boolean(a,l,"union"),e.depth/=2,e.material=this.parameter.mirrorTexture;let h=this.createBox(e),c=h.clone();h.position.add(new i.Vector3(-(r+this.parameter.windowFrameBorder)/4,(n-t)/2,0)),c.position.add(new i.Vector3((r+this.parameter.windowFrameBorder)/4,(n-t)/2,0)),h.name="glass",c.name="glass",s.add(h,c)}if("single"==this.parameter.bottom){let e={width:r,height:n-t-this.parameter.windowFrameBorder,depth:100,material:new i.MeshBasicMaterial({color:16711680})};(a=this.createBox(e)).position.add(new i.Vector3(0,(e.height-n)/2,0)),e.depth/=2,e.material=this.parameter.mirrorTexture;let o=this.createBox(e);o.position.add(new i.Vector3(0,(e.height-n)/2,0)),o.name="glass",s.add(o)}else if("double"==this.parameter.bottom){let e={width:(r-this.parameter.windowFrameBorder)/2,height:n-t-this.parameter.windowFrameBorder,depth:100,material:new i.MeshBasicMaterial({color:16711680})},o=this.createBox(e),l=o.clone();o.position.add(new i.Vector3(-(r+this.parameter.windowFrameBorder)/4,(e.height-n)/2,0)),l.position.add(new i.Vector3((r+this.parameter.windowFrameBorder)/4,(e.height-n)/2,0)),a=this.boolean(o,l,"union"),e.depth/=2,e.material=this.parameter.mirrorTexture;let h=this.createBox(e),c=h.clone();h.position.add(new i.Vector3(-(r+this.parameter.windowFrameBorder)/4,(e.height-n)/2,0)),c.position.add(new i.Vector3((r+this.parameter.windowFrameBorder)/4,(e.height-n)/2,0)),h.name="glass",c.name="glass",s.add(h,c)}}else if("bottom"==e){if("single"==this.parameter.top){let e={width:r,height:n-t-this.parameter.windowFrameBorder,depth:100,material:new i.MeshBasicMaterial({color:65280})};(o=this.createBox(e)).position.add(new i.Vector3(0,(n-e.height)/2,0)),e.depth/=2,e.material=this.parameter.mirrorTexture;let a=this.createBox(e);a.position.add(new i.Vector3(0,(n-e.height)/2,0)),a.name="glass",s.add(a)}else if("double"==this.parameter.top){let e={width:(r-this.parameter.windowFrameBorder)/2,height:n-t-this.parameter.windowFrameBorder,depth:100,material:new i.MeshBasicMaterial({color:65280})},a=this.createBox(e),l=a.clone();a.position.add(new i.Vector3(-(r+this.parameter.windowFrameBorder)/4,(n-e.height)/2,0)),l.position.add(new i.Vector3((r+this.parameter.windowFrameBorder)/4,(n-e.height)/2,0)),o=this.boolean(a,l,"union"),e.depth/=2,e.material=this.parameter.mirrorTexture;let h=this.createBox(e),c=h.clone();h.position.add(new i.Vector3(-(r+this.parameter.windowFrameBorder)/4,(n-e.height)/2,0)),c.position.add(new i.Vector3((r+this.parameter.windowFrameBorder)/4,(n-e.height)/2,0)),h.name="glass",c.name="glass",s.add(h,c)}if("single"==this.parameter.bottom){let e={width:r,height:t,depth:100,material:new i.MeshBasicMaterial({color:16711680})};(a=this.createBox(e)).position.add(new i.Vector3(0,-(n-t)/2,0)),e.depth/=2,e.material=this.parameter.mirrorTexture;let o=this.createBox(e);o.position.add(new i.Vector3(0,-(n-t)/2,0)),o.name="glass",s.add(o)}else if("double"==this.parameter.bottom){let e={width:(r-this.parameter.windowFrameBorder)/2,height:t,depth:100,material:new i.MeshBasicMaterial({color:16711680})},o=this.createBox(e),l=o.clone();o.position.add(new i.Vector3(-(r+this.parameter.windowFrameBorder)/4,-(n-t)/2,0)),l.position.add(new i.Vector3((r+this.parameter.windowFrameBorder)/4,-(n-t)/2,0)),a=this.boolean(o,l,"union"),e.depth/=2,e.material=this.parameter.mirrorTexture;let h=this.createBox(e),c=h.clone();h.position.add(new i.Vector3(-(r+this.parameter.windowFrameBorder)/4,-(n-t)/2,0)),c.position.add(new i.Vector3((r+this.parameter.windowFrameBorder)/4,-(n-t)/2,0)),h.name="glass",c.name="glass",s.add(h,c)}}let d=this.boolean(o,a,"union");c=this.boolean(c,d),s.add(c),s.position.add(new i.Vector3(0,0,-this.parameter.depth+this.parameter.thickness/2+l/2)),this.add(s)}}}),parcelRequire.register("dFygm",function(e,t){$parcel$export(e.exports,"UWindowMesh",()=>o);var i=parcelRequire("4xklQ"),r=parcelRequire("9vZPJ"),n=parcelRequire("hrM0U");class o extends r.Base3DMesh{constructor(e={}){super(),this.type="UWindowMesh";let t=e.wallList[0].position,r=e.wallList[1].position;if((0,n.CommonFunc).getClockWise(t,e.middleWall.position,r)?(e.leftWall=e.wallList[1],e.rightWall=e.wallList[0]):(e.leftWall=e.wallList[0],e.rightWall=e.wallList[1]),e.leftPoint=new i.Vector2(-(e.width/2-3e3*e.leftWall.thickness/4),-(250*e.middleWall.thickness)),e.leftBPoint=new i.Vector2(e.leftPoint.x,-(e.windowThickL+500*e.middleWall.thickness)),e.rightPoint=new i.Vector2(e.width/2-3e3*e.rightWall.thickness/4,-(250*e.middleWall.thickness)),e.rightBPoint=new i.Vector2(e.rightPoint.x,-(e.windowThickR+500*e.middleWall.thickness)),e.frameBorer=e.frameBorer||50,!e.texture){let t=e.editor.config.baseWindowFrame;t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.texture=new i.MeshStandardMaterial({map:t})}this.mirrorTexture=new i.MeshStandardMaterial({color:new i.Color(.1275,.3066,.8513),depthWrite:!1,metalness:.1,normalScale:new i.Vector2(1,-1),side:2,transparent:!0,opacity:.1,roughness:.1}),this.parameter=e}create(){let e=this.parameter.leftPoint.clone().sub(this.parameter.leftBPoint),t=this.parameter.rightPoint.clone().sub(this.parameter.leftPoint),r=t.clone().negate().setLength(500*this.parameter.leftWall.thickness),n=this.parameter.leftBPoint.clone().add(r),o=this.parameter.leftPoint.clone().add(r),a=e.clone().setLength(500*this.parameter.middleWall.thickness),s=this.parameter.leftPoint.clone().add(a);this.parameter.rightPoint.clone().add(a);let l=t.clone().setLength(500*this.parameter.rightWall.thickness),h=this.parameter.rightPoint.clone().add(l),c=this.parameter.rightBPoint.clone().add(l),d=new(0,i.Path)().arc(this.parameter.leftPoint.x,this.parameter.leftPoint.y,500*this.parameter.leftWall.thickness,Math.PI,Math.PI/2,!0).getPoints(),u=new(0,i.Path)().arc(this.parameter.rightPoint.x,this.parameter.rightPoint.y,500*this.parameter.rightWall.thickness,Math.PI/2,0,!0).getPoints(),p=[this.parameter.leftBPoint,n,...d,...u,c,this.parameter.rightBPoint,this.parameter.rightPoint,this.parameter.leftPoint],m=this.createShapeOrStereoscopic(p,this.parameter.height,this.parameter.texture),f=e.clone().setLength(this.parameter.frameBorer),g=this.parameter.leftBPoint.clone().add(f),y=n.clone().add(f),x=o.clone().add(a),w=h.clone().add(a),b=c.clone().add(f),v=this.parameter.rightBPoint.clone().add(f),M=[g,y,x,w,b,v,this.parameter.rightPoint,this.parameter.leftPoint],S=this.createShapeOrStereoscopic(M,this.parameter.height-2*this.parameter.frameBorer,new i.MeshBasicMaterial({color:16711680}));S.position.y+=this.parameter.frameBorer,m=this.boolean(m,S);let P=g.clone().add(t.clone().negate().setLength(125*this.parameter.leftWall.thickness)),T=y.clone().add(t.clone().setLength(125*this.parameter.leftWall.thickness)),_=s.clone().add(e.clone().negate().setLength(125*this.parameter.middleWall.thickness)),C=new i.Vector2(T.x,_.y),D=h.clone().add(t.clone().negate().setLength(125*this.parameter.rightWall.thickness)),A=new i.Vector2(D.x,C.y),E=b.clone().add(t.clone().negate().setLength(125*this.parameter.rightWall.thickness)),L=v.clone().add(t.clone().setLength(125*this.parameter.rightWall.thickness)),I=h.clone().add(e.clone().setLength(125*this.parameter.middleWall.thickness)),R=new i.Vector2(L.x,I.y),W=new i.Vector2(P.x,R.y),V=[P,T,C,A,E,L,R,W],k=this.createShapeOrStereoscopic(V,this.parameter.height-2*this.parameter.frameBorer,this.mirrorTexture);k.name="glass",k.position.y+=this.parameter.frameBorer,this.add(m,k)}}}),parcelRequire.register("k63JT",function(e,t){$parcel$export(e.exports,"DooropenMesh",()=>r);var i=parcelRequire("9vZPJ");class r extends i.Base3DMesh{constructor(e={}){super(),this.type="PassMesh",this.parameter=e}create(){let e=this.createDoorstone();this.add(e)}}}),parcelRequire.register("4J2OP",function(e,t){$parcel$export(e.exports,"computeBoundsTree",()=>n),$parcel$export(e.exports,"disposeBoundsTree",()=>o);var i=parcelRequire("4xklQ");parcelRequire("2nenX");var r=parcelRequire("1DCdP");function n(e){return this.boundsTree=new r.MeshBVH(this,e),this.boundsTree}function o(){this.boundsTree=null}i.Mesh.prototype.raycast}),parcelRequire.register("3BPdS",function(e,t){$parcel$export(e.exports,"UIDiv",()=>a),$parcel$export(e.exports,"UIPanel",()=>s),$parcel$export(e.exports,"UIText",()=>l),$parcel$export(e.exports,"UIInput",()=>h);class i{constructor(e){this.dom=e}add(){for(let e=0;e<arguments.length;e++){let t=arguments[e];t instanceof i?this.dom.appendChild(t.dom):console.error("UIElement:",t,"is not an instance of UIElement.")}return this}remove(){for(let e=0;e<arguments.length;e++){let t=arguments[e];t instanceof i?this.dom.removeChild(t.dom):console.error("UIElement:",t,"is not an instance of UIElement.")}return this}clear(){for(;this.dom.children.length;)this.dom.removeChild(this.dom.lastChild)}setId(e){return this.dom.id=e,this}getId(){return this.dom.id}setClass(e){return this.dom.className=e,"mobile"==editor.deviceType&&e.indexOf("roomName")>=0&&(this.dom.style.fontSize="10px"),this}addClass(e){return this.dom.classList.add(e),this}removeClass(e){return this.dom.classList.remove(e),this}setStyle(e,t){for(let i=0;i<t.length;i++)this.dom.style[e]=t[i];return this}setDisabled(e){return this.dom.disabled=e,this}setTextContent(e){return this.dom.textContent=e,this}setInnerHTML(e){this.dom.innerHTML=e}getIndexOfChild(e){return Array.prototype.indexOf.call(this.dom.children,e.dom)}cleanChildByClassName(e){for(let t=0;t<this.dom.children.length;t++)this.dom.children[t].className==e&&this.dom.removeChild(this.dom.children[t]);return this}setAttribute(e,t){this.dom.setAttribute(e,t)}getAttribute(e){return this.dom.getAttribute(e)}}let r=["position","left","top","right","bottom","width","height","border","borderLeft","borderTop","borderRight","borderBottom","borderColor","display","overflow","margin","marginLeft","marginTop","marginRight","marginBottom","padding","paddingLeft","paddingTop","paddingRight","paddingBottom","verticalAlign","color","background","backgroundColor","opacity","fontSize","fontWeight","textAlign","textDecoration","textTransform","cursor","zIndex"];r.forEach(function(e){let t="set"+e.substr(0,1).toUpperCase()+e.substr(1,e.length);i.prototype[t]=function(){return this.setStyle(e,arguments),this}});let n=["KeyUp","KeyDown","MouseOver","MouseOut","Click","DblClick","Change","Input","Blur"];n.forEach(function(e){let t="on"+e;i.prototype[t]=function(t){return this.dom.addEventListener(e.toLowerCase(),t.bind(this)),this}});class o extends i{constructor(){super(document.createElement("span"))}}class a extends i{constructor(){super(document.createElement("div")),this.dom.style.position="absolute"}}class s extends a{constructor(){super(),this.dom.className="Panel",this.dom.style.position="absolute",this.dom.style.top="0"}}class l extends o{constructor(e,t=!0){super(),this.dom.className="Text",this.dom.style.cursor="default",this.dom.style.display="inline-block",this.dom.style.position="absolute",this.dom.style.fontWeight="550",t&&(this.dom.style.textShadow="-1px 0 #fff, 0 1px #fff, 1px 0 #fff, 0 -1px #fff"),"mobile"==editor.deviceType&&(this.dom.style.color="white",this.dom.style.textShadow="-1px 0 #000, 0 1px #000, 1px 0 #000, 0 -1px #000",this.dom.style.fontSize="7px"),this.setValue(e)}getValue(){return this.dom.textContent}setValue(e){return void 0!==e&&(this.dom.textContent=e),this}}class h extends i{constructor(e){super(document.createElement("input")),this.dom.className="Input",this.dom.style.padding="2px",this.dom.style.border="1px solid transparent",this.dom.style.pointerEvents="auto",this.dom.style.textAlign="center",this.dom.style.position="absolute",this.dom.style.fontSize="12px",this.dom.style.fontWeight="550",this.dom.style.textShadow="-1px 0 #fff, 0 1px #fff, 1px 0 #fff, 0 -1px #fff",this.dom.setAttribute("autocomplete","off"),this.dom.addEventListener("keydown",function(e){e.stopPropagation()}),this.setValue(e)}getValue(){return this.dom.value}setValue(e){return this.dom.value=e,this}setFocus(){return this.dom.focus(),this.dom.setSelectionRange(0,this.dom.value.length),this}setBlur(){return this.dom.blur(),this}setNumber(){this.dom.type="Number"}}}),parcelRequire.register("5c6ha",function(e,t){$parcel$export(e.exports,"CreateMiniMap",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("eiQg5");class n{constructor(e,t,i,r,n,o,a){this.editor=e,this.newCamera=t,this.scene=i,this.newRenderer=r,this.box=n,this.miniMapWidth=o,this.miniMapHeight=a}main(){let e=document.getElementsByClassName("miniBox")[0];for(var t=e.firstElementChild;t;)t.remove(),t=e.firstElementChild;if(this.newCamera.isOrthographicCamera&&this.newCamera.position.set(0,0,1e3),e.appendChild(this.newRenderer.domElement),this.newCamera.isOrthographicCamera){let e=this.miniMapWidth/this.miniMapHeight,t=-5e3;this.newCamera.left=t*e,this.newCamera.right=-t*e,this.newCamera.top=-t,this.newCamera.bottom=t}else this.newCamera.aspect=this.miniMapWidth/this.miniMapHeight;this.newCamera.updateProjectionMatrix(),this.newRenderer.setSize(this.miniMapWidth,this.miniMapHeight),this.newCamera.updateProjectionMatrix(),""!=this.editor.miniControls2d&&(this.editor.miniControls2d.enabled=!1),""!=this.editor.miniControls3d&&(this.editor.miniControls3d.enabled=!1),this.newCamera.isOrthographicCamera?(this.editor.miniControls2d=new r.OrbitControls(this.newCamera,e,this.editor),this.editor.miniControls2d.enableRotate=!1):this.editor.miniControls3d=new r.OrbitControls(this.newCamera,e,this.editor),this.updateMapMan()}updateMapMan(){var e=document.querySelector(".miniMapMan"),t=this.computeDeg();if(e.style.transform="rotateZ(".concat(t,"deg)"),this.editor.miniMapCamera.isOrthographicCamera){let t=this.getScreenPosition();e.style.left=t.x+"px",e.style.top=t.y+"px"}}getScreenPosition(){var e=document.querySelector(".miniMapDom");let t=this.editor.viewportCamera.position.clone(),r=300;"3dRomaCamera"==this.editor.viewportCamera.name&&(t=this.editor.viewportCamera.realPosition.clone(),r=1e3);let n=new i.Vector3(t.x*r,t.z*r,t.y*r);n=n.project(this.editor.miniMapCamera);let o=e.offsetWidth/2,a=e.offsetHeight/2;return{x:Math.round(n.x*o+o),y:Math.round(n.y*a+a)}}computeDeg=function(){var e=new i.Vector3(0,0,-1),t=new i.Vector3(-1,0,0),r=this.editor.camera.getWorldDirection(new i.Vector3).normalize();r.setY(0);var n=r.angleTo(e),o=r.angleTo(t),a=i.MathUtils.radToDeg(n),s=i.MathUtils.radToDeg(o),l=0;return(l=s>=90?a:180+(180-a))+180}}}),parcelRequire.register("eiQg5",function(e,t){$parcel$export(e.exports,"OrbitControls",()=>a);var i=parcelRequire("4xklQ");let r={type:"change"},n={type:"start"},o={type:"end"};class a extends i.EventDispatcher{constructor(e,t,a){super(),void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new i.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:i.MOUSE.ROTATE,MIDDLE:i.MOUSE.DOLLY,RIGHT:i.MOUSE.PAN},this.touches={ONE:i.TOUCH.ROTATE,TWO:i.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return d.phi},this.getAzimuthalAngle=function(){return d.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",el),this._domElementKeyEvents=e},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(r),s.update(),h=l.NONE},this.update=function(){let t=new i.Vector3,n=new(0,i.Quaternion)().setFromUnitVectors(e.up,new i.Vector3(0,1,0)),o=n.clone().invert(),a=new i.Vector3,g=new i.Quaternion,y=2*Math.PI;return function(){let e=s.object.position;t.copy(e).sub(s.target),t.applyQuaternion(n),d.setFromVector3(t),s.autoRotate&&h===l.NONE&&A(C()),s.enableDamping?(d.theta+=u.theta*s.dampingFactor,d.phi+=u.phi*s.dampingFactor):(d.theta+=u.theta,d.phi+=u.phi);let i=s.minAzimuthAngle,x=s.maxAzimuthAngle;return isFinite(i)&&isFinite(x)&&(i<-Math.PI?i+=y:i>Math.PI&&(i-=y),x<-Math.PI?x+=y:x>Math.PI&&(x-=y),i<=x?d.theta=Math.max(i,Math.min(x,d.theta)):d.theta=d.theta>(i+x)/2?Math.max(i,d.theta):Math.min(x,d.theta)),d.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,d.phi)),d.makeSafe(),d.radius*=p,d.radius=Math.max(s.minDistance,Math.min(s.maxDistance,d.radius)),!0===s.enableDamping?s.target.addScaledVector(m,s.dampingFactor):s.target.add(m),t.setFromSpherical(d),t.applyQuaternion(o),e.copy(s.target).add(t),s.object.lookAt(s.target),!0===s.enableDamping?(u.theta*=1-s.dampingFactor,u.phi*=1-s.dampingFactor,m.multiplyScalar(1-s.dampingFactor)):(u.set(0,0,0),m.set(0,0,0)),p=1,!!(f||a.distanceToSquared(s.object.position)>c||8*(1-g.dot(s.object.quaternion))>c)&&(s.dispatchEvent(r),a.copy(s.object.position),g.copy(s.object.quaternion),f=!1,!0)}}(),this.dispose=function(){s.domElement.removeEventListener("contextmenu",ed),s.domElement.removeEventListener("pointerdown",et),s.domElement.removeEventListener("pointercancel",en),s.domElement.removeEventListener("wheel",es),s.domElement.removeEventListener("pointermove",ei),s.domElement.removeEventListener("pointerup",er),null!==s._domElementKeyEvents&&s._domElementKeyEvents.removeEventListener("keydown",el)};let s=this,l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},h=l.NONE,c=1e-6,d=new i.Spherical,u=new i.Spherical,p=1,m=new i.Vector3,f=!1,g=new i.Vector2,y=new i.Vector2,x=new i.Vector2,w=new i.Vector2,b=new i.Vector2,v=new i.Vector2,M=new i.Vector2,S=new i.Vector2,P=new i.Vector2,T=[],_={};function C(){return 2*Math.PI/60/60*s.autoRotateSpeed}function D(){return Math.pow(.95,s.zoomSpeed)}function A(e){u.theta-=e}function E(e){u.phi-=e}let L=function(){let e=new i.Vector3;return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),m.add(e)}}(),I=function(){let e=new i.Vector3;return function(t,i){!0===s.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(s.object.up,e)),e.multiplyScalar(t),m.add(e)}}(),R=function(){let e=new i.Vector3;return function(t,i){let r=s.domElement;if(s.object.isPerspectiveCamera){let n=s.object.position;e.copy(n).sub(s.target);let o=e.length();L(2*t*(o*=Math.tan(s.object.fov/2*Math.PI/180))/r.clientHeight,s.object.matrix),I(2*i*o/r.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(L(t*(s.object.right-s.object.left)/s.object.zoom/r.clientWidth,s.object.matrix),I(i*(s.object.top-s.object.bottom)/s.object.zoom/r.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function W(e){if(s.object.isPerspectiveCamera){let t=1500/d.radius/100;t<.11&&(t=.1,d.radius=150),s.object.zoomNum=t,a.list.changeCameraSlider.dispatch("2d",t),t>.11&&(p/=e)}else if(s.object.isOrthographicCamera){let t=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*e));t<.11&&(t=.1),s.object.zoom=t,a.autoShowHidden(t),a.list.changeCameraSlider.dispatch("2d",t),s.object.updateProjectionMatrix(),f=!0}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1;a.updateDom()}function V(e){if(s.object.isPerspectiveCamera){p*=e;let t=1500/d.radius/100;s.object.zoomNum=t,a.list.changeCameraSlider.dispatch("2d",t)}else if(s.object.isOrthographicCamera){s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/e));let t=s.object.zoom;a.autoShowHidden(t),a.list.changeCameraSlider.dispatch("2d",s.object.zoom),s.object.updateProjectionMatrix(),f=!0}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1;a.updateDom()}function k(e){g.set(e.clientX,e.clientY)}function B(e){M.set(e.clientX,e.clientY)}function O(e){w.set(e.clientX,e.clientY)}function F(e){y.set(e.clientX,e.clientY),x.subVectors(y,g).multiplyScalar(s.rotateSpeed);let t=s.domElement;A(2*Math.PI*x.x/t.clientHeight),E(2*Math.PI*x.y/t.clientHeight),g.copy(y),s.update()}function z(e){S.set(e.clientX,e.clientY),P.subVectors(S,M),P.y>0?W(D()):P.y<0&&V(D()),M.copy(S),s.update()}function U(e){b.set(e.clientX,e.clientY),v.subVectors(b,w).multiplyScalar(s.panSpeed),R(v.x,v.y),w.copy(b),s.update()}function N(e){if("PC"!=a.deviceType&&(a.list.getDomByPoint.dispatch(e.clientX,e.clientY,"touchStart"),a.currentDom)){let t=30;e.deltaY<0&&(t*=-1);let i=document.querySelector(".e-r-bottom");i&&(i.scrollTop+=2*t);return}e.deltaY<0?V(D()):e.deltaY>0&&W(D()),s.update()}function G(e){let t=!1;switch(e.code){case s.keys.UP:R(0,s.keyPanSpeed),t=!0;break;case s.keys.BOTTOM:R(0,-s.keyPanSpeed),t=!0;break;case s.keys.LEFT:R(s.keyPanSpeed,0),t=!0;break;case s.keys.RIGHT:R(-s.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),s.update())}function H(){if(1===T.length)g.set(T[0].pageX,T[0].pageY);else{let e=.5*(T[0].pageX+T[1].pageX),t=.5*(T[0].pageY+T[1].pageY);g.set(e,t)}}function j(){if(1===T.length)w.set(T[0].pageX,T[0].pageY);else{let e=.5*(T[0].pageX+T[1].pageX),t=.5*(T[0].pageY+T[1].pageY);w.set(e,t)}}function q(){let e=T[0].pageX-T[1].pageX,t=T[0].pageY-T[1].pageY,i=Math.sqrt(e*e+t*t);M.set(0,i)}function X(){s.enableZoom&&q(),s.enablePan&&j()}function Y(){s.enableZoom&&q(),s.enableRotate&&H()}function J(e){if(1==T.length)y.set(e.pageX,e.pageY);else{let t=ef(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);y.set(i,r)}x.subVectors(y,g).multiplyScalar(s.rotateSpeed);let t=s.domElement;A(2*Math.PI*x.x/t.clientHeight),E(2*Math.PI*x.y/t.clientHeight),g.copy(y)}function Z(e){if(1===T.length)b.set(e.pageX,e.pageY);else{let t=ef(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);b.set(i,r)}v.subVectors(b,w).multiplyScalar(s.panSpeed),R(v.x,v.y),w.copy(b)}function Q(e){let t=ef(e),i=e.pageX-t.x,r=e.pageY-t.y,n=Math.sqrt(i*i+r*r);S.set(0,n),P.set(0,Math.pow(S.y/M.y,s.zoomSpeed)),W(P.y),M.copy(S)}function K(e){a.allowDraw=!1,s.enableZoom&&Q(e),s.enablePan&&Z(e)}function ee(e){s.enableZoom&&Q(e),s.enableRotate&&J(e)}function et(e){!1!==s.enabled&&(0===T.length&&(s.domElement.setPointerCapture(e.pointerId),s.domElement.addEventListener("pointermove",ei),s.domElement.addEventListener("pointerup",er)),eu(e),"touch"===e.pointerType?eh(e):eo(e))}function ei(e){!1!==s.enabled&&("touch"===e.pointerType?ec(e):ea(e))}function er(e){ep(e),0===T.length&&(s.domElement.releasePointerCapture(e.pointerId),s.domElement.removeEventListener("pointermove",ei),s.domElement.removeEventListener("pointerup",er)),s.dispatchEvent(o),h=l.NONE}function en(e){ep(e)}function eo(e){let t;switch(e.button){case 0:t=s.mouseButtons.LEFT;break;case 1:t=s.mouseButtons.MIDDLE;break;case 2:t=s.mouseButtons.RIGHT;break;default:t=-1}switch(t){case i.MOUSE.DOLLY:if(!1===s.enableZoom)return;B(e),h=l.DOLLY;break;case i.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===s.enablePan)return;O(e),h=l.PAN}else{if(!1===s.enableRotate)return;k(e),h=l.ROTATE}break;case i.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===s.enableRotate)return;k(e),h=l.ROTATE}else{if(!1===s.enablePan)return;O(e),h=l.PAN}break;default:h=l.NONE}h!==l.NONE&&s.dispatchEvent(n)}function ea(e){if(!1!==s.enabled)switch(h){case l.ROTATE:if(!1===s.enableRotate)return;F(e);break;case l.DOLLY:if(!1===s.enableZoom)return;z(e);break;case l.PAN:if(!1===s.enablePan)return;U(e),a.updateDom()}}function es(e){!1!==s.enabled&&!1!==s.enableZoom&&h===l.NONE&&(e.preventDefault(),s.dispatchEvent(n),N(e),s.dispatchEvent(o))}function el(e){!1!==s.enabled&&!1!==s.enablePan&&G(e)}function eh(e){switch(a.allowDraw=!0,em(e),T.length){case 1:switch(s.touches.ONE){case i.TOUCH.ROTATE:if(!1===s.enableRotate)return;H(),h=l.TOUCH_ROTATE;break;case i.TOUCH.PAN:if(!1===s.enablePan)return;j(),h=l.TOUCH_PAN;break;default:h=l.NONE}break;case 2:switch(s.touches.TWO){case i.TOUCH.DOLLY_PAN:if(!1===s.enableZoom&&!1===s.enablePan)return;X(),h=l.TOUCH_DOLLY_PAN;break;case i.TOUCH.DOLLY_ROTATE:if(!1===s.enableZoom&&!1===s.enableRotate)return;Y(),h=l.TOUCH_DOLLY_ROTATE;break;default:h=l.NONE}break;default:a.allowDraw=!1,h=l.NONE}h!==l.NONE&&s.dispatchEvent(n)}function ec(e){switch(em(e),h){case l.TOUCH_ROTATE:if(!1===s.enableRotate)return;J(e),s.update();break;case l.TOUCH_PAN:if(!1===s.enablePan)return;Z(e),s.update(),a.updateDom();break;case l.TOUCH_DOLLY_PAN:if(!1===s.enableZoom&&!1===s.enablePan)return;K(e),s.update();break;case l.TOUCH_DOLLY_ROTATE:if(!1===s.enableZoom&&!1===s.enableRotate)return;ee(e),s.update();break;default:h=l.NONE}}function ed(e){!1!==s.enabled&&e.preventDefault()}function eu(e){T.push(e)}function ep(e){delete _[e.pointerId];for(let t=0;t<T.length;t++)if(T[t].pointerId==e.pointerId){T.splice(t,1);return}}function em(e){let t=_[e.pointerId];void 0===t&&(t=new i.Vector2,_[e.pointerId]=t),t.set(e.pageX,e.pageY)}function ef(e){let t=e.pointerId===T[0].pointerId?T[1]:T[0];return _[t.pointerId]}s.domElement.addEventListener("contextmenu",ed),s.domElement.addEventListener("pointerdown",et),s.domElement.addEventListener("pointercancel",en),s.domElement.addEventListener("wheel",es,{passive:!1}),this.update()}}}),parcelRequire.register("hEK9V",function(e,t){$parcel$export(e.exports,"GLTFExporter",()=>r);var i=parcelRequire("4xklQ");class r{constructor(){this.pluginCallbacks=[],this.register(function(e){return new M(e)}),this.register(function(e){return new S(e)}),this.register(function(e){return new P(e)}),this.register(function(e){return new C(e)}),this.register(function(e){return new D(e)}),this.register(function(e){return new T(e)}),this.register(function(e){return new _(e)})}register(e){return -1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return -1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,r){let n=new v,o=[];for(let e=0,t=this.pluginCallbacks.length;e<t;e++)o.push(this.pluginCallbacks[e](n));n.setPlugins(o),n.write(e,t,r).catch(i)}parseAsync(e,t){let i=this;return new Promise(function(r,n){i.parse(e,r,n,t)})}}let n={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},o={};o[i.NearestFilter]=n.NEAREST,o[i.NearestMipmapNearestFilter]=n.NEAREST_MIPMAP_NEAREST,o[i.NearestMipmapLinearFilter]=n.NEAREST_MIPMAP_LINEAR,o[i.LinearFilter]=n.LINEAR,o[i.LinearMipmapNearestFilter]=n.LINEAR_MIPMAP_NEAREST,o[i.LinearMipmapLinearFilter]=n.LINEAR_MIPMAP_LINEAR,o[i.ClampToEdgeWrapping]=n.CLAMP_TO_EDGE,o[i.RepeatWrapping]=n.REPEAT,o[i.MirroredRepeatWrapping]=n.MIRRORED_REPEAT;let a={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},s=12,l=1179937895,h=2,c=8,d=1313821514,u=5130562;function p(e,t){return e.length===t.length&&e.every(function(e,i){return e===t[i]})}function m(e){return new TextEncoder().encode(e).buffer}function f(e){return p(e.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function g(e,t,i){let r={min:Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let n=t;n<t+i;n++)for(let t=0;t<e.itemSize;t++){let i;e.itemSize>4?i=e.array[n*e.itemSize+t]:0===t?i=e.getX(n):1===t?i=e.getY(n):2===t?i=e.getZ(n):3===t&&(i=e.getW(n)),r.min[t]=Math.min(r.min[t],i),r.max[t]=Math.max(r.max[t],i)}return r}function y(e){return 4*Math.ceil(e/4)}function x(e,t=0){let i=y(e.byteLength);if(i!==e.byteLength){let r=new Uint8Array(i);if(r.set(new Uint8Array(e)),0!==t)for(let n=e.byteLength;n<i;n++)r[n]=t;return r.buffer}return e}function w(){return"undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function b(e,t){let i;return void 0!==e.toBlob?new Promise(i=>e.toBlob(i,t)):("image/jpeg"===t?i=.92:"image/webp"===t&&(i=.8),e.convertToBlob({type:t,quality:i}))}class v{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,i){this.options=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);let r=this,n=r.buffers,o=r.json;i=r.options;let a=r.extensionsUsed,p=new Blob(n,{type:"application/octet-stream"}),f=Object.keys(a);if(f.length>0&&(o.extensionsUsed=f),o.buffers&&o.buffers.length>0&&(o.buffers[0].byteLength=p.size),!0===i.binary){let e=new FileReader;e.readAsArrayBuffer(p),e.onloadend=function(){let i=x(e.result),r=new DataView(new ArrayBuffer(c));r.setUint32(0,i.byteLength,!0),r.setUint32(4,u,!0);let n=x(m(JSON.stringify(o)),32),a=new DataView(new ArrayBuffer(c));a.setUint32(0,n.byteLength,!0),a.setUint32(4,d,!0);let p=new ArrayBuffer(s),f=new DataView(p);f.setUint32(0,l,!0),f.setUint32(4,h,!0);let g=s+a.byteLength+n.byteLength+r.byteLength+i.byteLength;f.setUint32(8,g,!0);let y=new Blob([p,a,n,r,i],{type:"application/octet-stream"}),w=new FileReader;w.readAsArrayBuffer(y),w.onloadend=function(){t(w.result)}}}else if(o.buffers&&o.buffers.length>0){let e=new FileReader;e.readAsDataURL(p),e.onloadend=function(){let i=e.result;o.buffers[0].uri=i,t(o)}}else t(o)}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;let i=this.options,r=this.extensionsUsed;try{let n=JSON.parse(JSON.stringify(e.userData));if(i.includeCustomExtensions&&n.gltfExtensions){for(let e in void 0===t.extensions&&(t.extensions={}),n.gltfExtensions)t.extensions[e]=n.gltfExtensions[e],r[e]=!0;delete n.gltfExtensions}Object.keys(n).length>0&&(t.extras=n)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}getUID(e,t=!1){if(!1===this.uids.has(e)){let t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}let i=this.uids.get(e);return i.get(t)}isNormalizedNormalAttribute(e){let t=this.cache;if(t.attributesNormalized.has(e))return!1;let r=new i.Vector3;for(let t=0,i=e.count;t<i;t++)if(Math.abs(r.fromBufferAttribute(e,t).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){let t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);let r=e.clone(),n=new i.Vector3;for(let e=0,t=r.count;e<t;e++)n.fromBufferAttribute(r,e),0===n.x&&0===n.y&&0===n.z?n.setX(1):n.normalize(),r.setXYZ(e,n.x,n.y,n.z);return t.attributesNormalized.set(e,r),r}applyTextureTransform(e,t){let i=!1,r={};(0!==t.offset.x||0!==t.offset.y)&&(r.offset=t.offset.toArray(),i=!0),0!==t.rotation&&(r.rotation=t.rotation,i=!0),(1!==t.repeat.x||1!==t.repeat.y)&&(r.scale=t.repeat.toArray(),i=!0),i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=r,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function r(e){return e.encoding===i.sRGBEncoding?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");let n=e?.image,o=t?.image,a=Math.max(n?.width||0,o?.width||0),s=Math.max(n?.height||0,o?.height||0),l=w();l.width=a,l.height=s;let h=l.getContext("2d");h.fillStyle="#00ffff",h.fillRect(0,0,a,s);let c=h.getImageData(0,0,a,s);if(n){h.drawImage(n,0,0,a,s);let t=r(e),i=h.getImageData(0,0,a,s).data;for(let e=2;e<i.length;e+=4)c.data[e]=256*t(i[e]/256)}if(o){h.drawImage(o,0,0,a,s);let e=r(t),i=h.getImageData(0,0,a,s).data;for(let t=1;t<i.length;t+=4)c.data[t]=256*e(i[t]/256)}h.putImageData(c,0,0);let d=e||t,u=d.clone();return u.source=new i.Source(l),u.encoding=i.LinearEncoding,u}processBuffer(e){let t=this.json,i=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),i.push(e),0}processBufferView(e,t,i,r,o){let a;let s=this.json;s.bufferViews||(s.bufferViews=[]),a=t===n.UNSIGNED_BYTE?1:t===n.UNSIGNED_SHORT?2:4;let l=y(r*e.itemSize*a),h=new DataView(new ArrayBuffer(l)),c=0;for(let o=i;o<i+r;o++)for(let i=0;i<e.itemSize;i++){let r;e.itemSize>4?r=e.array[o*e.itemSize+i]:0===i?r=e.getX(o):1===i?r=e.getY(o):2===i?r=e.getZ(o):3===i&&(r=e.getW(o)),t===n.FLOAT?h.setFloat32(c,r,!0):t===n.UNSIGNED_INT?h.setUint32(c,r,!0):t===n.UNSIGNED_SHORT?h.setUint16(c,r,!0):t===n.UNSIGNED_BYTE&&h.setUint8(c,r),c+=a}let d={buffer:this.processBuffer(h.buffer),byteOffset:this.byteOffset,byteLength:l};void 0!==o&&(d.target=o),o===n.ARRAY_BUFFER&&(d.byteStride=e.itemSize*a),this.byteOffset+=l,s.bufferViews.push(d);let u={id:s.bufferViews.length-1,byteLength:0};return u}processBufferViewImage(e){let t=this,i=t.json;return i.bufferViews||(i.bufferViews=[]),new Promise(function(r){let n=new FileReader;n.readAsArrayBuffer(e),n.onloadend=function(){let e=x(n.result),o={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,r(i.bufferViews.push(o)-1)}})}processAccessor(e,t,i,r){let o,a;let s=this.options,l=this.json,h={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"};if(e.array.constructor===Float32Array)o=n.FLOAT;else if(e.array.constructor===Uint32Array)o=n.UNSIGNED_INT;else if(e.array.constructor===Uint16Array)o=n.UNSIGNED_SHORT;else if(e.array.constructor===Uint8Array)o=n.UNSIGNED_BYTE;else throw Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");if(void 0===i&&(i=0),void 0===r&&(r=e.count),s.truncateDrawRange&&void 0!==t&&null===t.index){let n=i+r,o=t.drawRange.count===1/0?e.count:t.drawRange.start+t.drawRange.count;(r=Math.min(n,o)-(i=Math.max(i,t.drawRange.start)))<0&&(r=0)}if(0===r)return null;let c=g(e,i,r);void 0!==t&&(a=e===t.index?n.ELEMENT_ARRAY_BUFFER:n.ARRAY_BUFFER);let d=this.processBufferView(e,o,i,r,a),u={bufferView:d.id,byteOffset:d.byteOffset,componentType:o,count:r,max:c.max,min:c.min,type:h[e.itemSize]};return!0===e.normalized&&(u.normalized=!0),l.accessors||(l.accessors=[]),l.accessors.push(u)-1}processImage(e,t,r,n="image/png"){let o=this,a=o.cache,s=o.json,l=o.options,h=o.pending;a.images.has(e)||a.images.set(e,{});let c=a.images.get(e),d=n+":flipY/"+r.toString();if(void 0!==c[d])return c[d];s.images||(s.images=[]);let u={mimeType:n},p=w();p.width=Math.min(e.width,l.maxTextureSize),p.height=Math.min(e.height,l.maxTextureSize);let m=p.getContext("2d");if(!0===r&&(m.translate(0,p.height),m.scale(1,-1)),void 0!==e.data){t!==i.RGBAFormat&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>l.maxTextureSize||e.height>l.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);let r=new Uint8ClampedArray(e.height*e.width*4);for(let t=0;t<r.length;t+=4)r[t+0]=e.data[t+0],r[t+1]=e.data[t+1],r[t+2]=e.data[t+2],r[t+3]=e.data[t+3];m.putImageData(new ImageData(r,e.width,e.height),0,0)}else m.drawImage(e,0,0,p.width,p.height);!0===l.binary?h.push(b(p,n).then(e=>o.processBufferViewImage(e)).then(e=>{u.bufferView=e})):void 0!==p.toDataURL?u.uri=p.toDataURL(n):h.push(b(p,n).then(e=>new FileReader().readAsDataURL(e)).then(e=>{u.uri=e}));let f=s.images.push(u)-1;return c[d]=f,f}processSampler(e){let t=this.json;t.samplers||(t.samplers=[]);let i={magFilter:o[e.magFilter],minFilter:o[e.minFilter],wrapS:o[e.wrapS],wrapT:o[e.wrapT]};return t.samplers.push(i)-1}processTexture(e){let t=this.cache,i=this.json;if(t.textures.has(e))return t.textures.get(e);i.textures||(i.textures=[]);let r=e.userData.mimeType;"image/webp"===r&&(r="image/png");let n={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,r)};e.name&&(n.name=e.name),this._invokeAll(function(t){t.writeTexture&&t.writeTexture(e,n)});let o=i.textures.push(n)-1;return t.textures.set(e,o),o}processMaterial(e){let t=this.cache,r=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;r.materials||(r.materials=[]);let n={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");let o=e.color.toArray().concat([e.opacity]);if(p(o,[1,1,1,1])||(n.pbrMetallicRoughness.baseColorFactor=o),e.isMeshStandardMaterial?(n.pbrMetallicRoughness.metallicFactor=e.metalness,n.pbrMetallicRoughness.roughnessFactor=e.roughness):(n.pbrMetallicRoughness.metallicFactor=.5,n.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){let t=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),i={index:this.processTexture(t)};this.applyTextureTransform(i,t),n.pbrMetallicRoughness.metallicRoughnessTexture=i}if(e.map){let t={index:this.processTexture(e.map)};this.applyTextureTransform(t,e.map),n.pbrMetallicRoughness.baseColorTexture=t}if(e.emissive){let t=e.emissive.clone().multiplyScalar(e.emissiveIntensity),i=Math.max(t.r,t.g,t.b);if(i>1&&(t.multiplyScalar(1/i),console.warn("THREE.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),i>0&&(n.emissiveFactor=t.toArray()),e.emissiveMap){let t={index:this.processTexture(e.emissiveMap)};this.applyTextureTransform(t,e.emissiveMap),n.emissiveTexture=t}}if(e.normalMap){let t={index:this.processTexture(e.normalMap)};e.normalScale&&1!==e.normalScale.x&&(t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),n.normalTexture=t}if(e.aoMap){let t={index:this.processTexture(e.aoMap),texCoord:1};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),n.occlusionTexture=t}e.transparent?n.alphaMode="BLEND":e.alphaTest>0&&(n.alphaMode="MASK",n.alphaCutoff=e.alphaTest),e.side===i.DoubleSide&&(n.doubleSided=!0),""!==e.name&&(n.name=e.name),this.serializeUserData(e,n),this._invokeAll(function(t){t.writeMaterial&&t.writeMaterial(e,n)});let a=r.materials.push(n)-1;return t.materials.set(e,a),a}processMesh(e){let t;let r=this.cache,o=this.json,a=[e.geometry.uuid];if(Array.isArray(e.material))for(let t=0,i=e.material.length;t<i;t++)a.push(e.material[t].uuid);else a.push(e.material.uuid);let s=a.join(":");if(r.meshes.has(s))return r.meshes.get(s);let l=e.geometry;t=e.isLineSegments?n.LINES:e.isLineLoop?n.LINE_LOOP:e.isLine?n.LINE_STRIP:e.isPoints?n.POINTS:e.material.wireframe?n.LINES:n.TRIANGLES;let h={},c={},d=[],u=[],p={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},m=l.getAttribute("normal");void 0===m||this.isNormalizedNormalAttribute(m)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),l.setAttribute("normal",this.createNormalizedNormalAttribute(m)));let f=null;for(let e in l.attributes){if("morph"===e.slice(0,5))continue;let t=l.attributes[e];e=p[e]||e.toUpperCase();let n=/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/;if(n.test(e)||(e="_"+e),r.attributes.has(this.getUID(t))){c[e]=r.attributes.get(this.getUID(t));continue}f=null;let o=t.array;"JOINTS_0"!==e||o instanceof Uint16Array||o instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),f=new i.BufferAttribute(new Uint16Array(o),t.itemSize,t.normalized));let a=this.processAccessor(f||t,l);null!==a&&(c[e]=a,r.attributes.set(this.getUID(t),a))}if(void 0!==m&&l.setAttribute("normal",m),0===Object.keys(c).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){let t=[],i=[],n={};if(void 0!==e.morphTargetDictionary)for(let t in e.morphTargetDictionary)n[e.morphTargetDictionary[t]]=t;for(let o=0;o<e.morphTargetInfluences.length;++o){let a={},s=!1;for(let e in l.morphAttributes){if("position"!==e&&"normal"!==e){s||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),s=!0);continue}let t=l.morphAttributes[e][o],i=e.toUpperCase(),n=l.attributes[e];if(r.attributes.has(this.getUID(t,!0))){a[i]=r.attributes.get(this.getUID(t,!0));continue}let h=t.clone();if(!l.morphTargetsRelative)for(let e=0,i=t.count;e<i;e++)h.setXYZ(e,t.getX(e)-n.getX(e),t.getY(e)-n.getY(e),t.getZ(e)-n.getZ(e));a[i]=this.processAccessor(h,l),r.attributes.set(this.getUID(n,!0),a[i])}u.push(a),t.push(e.morphTargetInfluences[o]),void 0!==e.morphTargetDictionary&&i.push(n[o])}h.weights=t,i.length>0&&(h.extras={},h.extras.targetNames=i)}let g=Array.isArray(e.material);if(g&&0===l.groups.length)return null;let y=g?e.material:[e.material],x=g?l.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let e=0,i=x.length;e<i;e++){let i={mode:t,attributes:c};if(this.serializeUserData(l,i),u.length>0&&(i.targets=u),null!==l.index){let t=this.getUID(l.index);(void 0!==x[e].start||void 0!==x[e].count)&&(t+=":"+x[e].start+":"+x[e].count),r.attributes.has(t)?i.indices=r.attributes.get(t):(i.indices=this.processAccessor(l.index,l,x[e].start,x[e].count),r.attributes.set(t,i.indices)),null===i.indices&&delete i.indices}let n=this.processMaterial(y[x[e].materialIndex]);null!==n&&(i.material=n),d.push(i)}h.primitives=d,o.meshes||(o.meshes=[]),this._invokeAll(function(t){t.writeMesh&&t.writeMesh(e,h)});let w=o.meshes.push(h)-1;return r.meshes.set(s,w),w}processCamera(e){let t=this.json;t.cameras||(t.cameras=[]);let r=e.isOrthographicCamera,n={type:r?"orthographic":"perspective"};return r?n.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:n.perspective={aspectRatio:e.aspect,yfov:(0,i.MathUtils).degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(n.name=e.type),t.cameras.push(n)-1}processAnimation(e,t){let n=this.json,o=this.nodeMap;n.animations||(n.animations=[]),e=r.Utils.mergeMorphTargetTracks(e.clone(),t);let s=e.tracks,l=[],h=[];for(let e=0;e<s.length;++e){let r;let n=s[e],c=(0,i.PropertyBinding).parseTrackName(n.name),d=(0,i.PropertyBinding).findNode(t,c.nodeName),u=a[c.propertyName];if("bones"===c.objectName&&(d=!0===d.isSkinnedMesh?d.skeleton.getBoneByName(c.objectIndex):void 0),!d||!u)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',n.name),null;let p=1,m=n.values.length/n.times.length;u===a.morphTargetInfluences&&(m/=d.morphTargetInfluences.length),!0===n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(r="CUBICSPLINE",m/=3):r=n.getInterpolation()===i.InterpolateDiscrete?"STEP":"LINEAR",h.push({input:this.processAccessor(new i.BufferAttribute(n.times,p)),output:this.processAccessor(new i.BufferAttribute(n.values,m)),interpolation:r}),l.push({sampler:h.length-1,target:{node:o.get(d),path:u}})}return n.animations.push({name:e.name||"clip_"+n.animations.length,samplers:h,channels:l}),n.animations.length-1}processSkin(e){let t=this.json,r=this.nodeMap,n=t.nodes[r.get(e)],o=e.skeleton;if(void 0===o)return null;let a=e.skeleton.bones[0];if(void 0===a)return null;let s=[],l=new Float32Array(16*o.bones.length),h=new i.Matrix4;for(let t=0;t<o.bones.length;++t)s.push(r.get(o.bones[t])),h.copy(o.boneInverses[t]),h.multiply(e.bindMatrix).toArray(l,16*t);void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new i.BufferAttribute(l,16)),joints:s,skeleton:r.get(a)});let c=n.skin=t.skins.length-1;return c}processNode(e){let t=this.json,i=this.options,r=this.nodeMap;t.nodes||(t.nodes=[]);let n={};if(i.trs){let t=e.quaternion.toArray(),i=e.position.toArray(),r=e.scale.toArray();p(t,[0,0,0,1])||(n.rotation=t),p(i,[0,0,0])||(n.translation=i),p(r,[1,1,1])||(n.scale=r)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===f(e.matrix)&&(n.matrix=e.matrix.elements);if(""!==e.name&&(n.name=String(e.name)),this.serializeUserData(e,n),e.isMesh||e.isLine||e.isPoints){let t=this.processMesh(e);null!==t&&(n.mesh=t)}else e.isCamera&&(n.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){let t=[];for(let r=0,n=e.children.length;r<n;r++){let n=e.children[r];if(n.visible||!1===i.onlyVisible){let e=this.processNode(n);null!==e&&t.push(e)}}t.length>0&&(n.children=t)}this._invokeAll(function(t){t.writeNode&&t.writeNode(e,n)});let o=t.nodes.push(n)-1;return r.set(e,o),o}processScene(e){let t=this.json,i=this.options;t.scenes||(t.scenes=[],t.scene=0);let r={};""!==e.name&&(r.name=e.name),t.scenes.push(r);let n=[];for(let t=0,r=e.children.length;t<r;t++){let r=e.children[t];if(r.visible||!1===i.onlyVisible){let e=this.processNode(r);null!==e&&n.push(e)}}n.length>0&&(r.nodes=n),this.serializeUserData(e,r)}processObjects(e){let t=new i.Scene;t.name="AuxScene";for(let i=0;i<e.length;i++)t.children.push(e[i]);this.processScene(t)}processInput(e){let t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(t){t.beforeParse&&t.beforeParse(e)});let r=[];for(let t=0;t<e.length;t++)e[t]instanceof i.Scene?this.processScene(e[t]):r.push(e[t]);r.length>0&&this.processObjects(r);for(let e=0;e<this.skins.length;++e)this.processSkin(this.skins[e]);for(let i=0;i<t.animations.length;++i)this.processAnimation(t.animations[i],e[0]);this._invokeAll(function(t){t.afterParse&&t.afterParse(e)})}_invokeAll(e){for(let t=0,i=this.plugins.length;t<i;t++)e(this.plugins[t])}}class M{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}let i=this.writer,r=i.json,n=i.extensionsUsed,o={};e.name&&(o.name=e.name),o.color=e.color.toArray(),o.intensity=e.intensity,e.isDirectionalLight?o.type="directional":e.isPointLight?(o.type="point",e.distance>0&&(o.range=e.distance)):e.isSpotLight&&(o.type="spot",e.distance>0&&(o.range=e.distance),o.spot={},o.spot.innerConeAngle=-((e.penumbra-1)*e.angle*1),o.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||0!==e.target.position.x||0!==e.target.position.y||-1!==e.target.position.z)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),n[this.name]||(r.extensions=r.extensions||{},r.extensions[this.name]={lights:[]},n[this.name]=!0);let a=r.extensions[this.name].lights;a.push(o),t.extensions=t.extensions||{},t.extensions[this.name]={light:a.length-1}}}class S{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;let i=this.writer,r=i.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},r[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class P{constructor(e){this.writer=e,this.name="KHR_materials_pbrSpecularGlossiness"}writeMaterial(e,t){if(!e.isGLTFSpecularGlossinessMaterial)return;let i=this.writer,r=i.extensionsUsed,n={};t.pbrMetallicRoughness.baseColorFactor&&(n.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor);let o=[1,1,1];if(e.specular.toArray(o,0),n.specularFactor=o,n.glossinessFactor=e.glossiness,t.pbrMetallicRoughness.baseColorTexture&&(n.diffuseTexture=t.pbrMetallicRoughness.baseColorTexture),e.specularMap){let t={index:i.processTexture(e.specularMap)};i.applyTextureTransform(t,e.specularMap),n.specularGlossinessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,r[this.name]=!0}}class T{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;let i=this.writer,r=i.extensionsUsed,n={};if(n.clearcoatFactor=e.clearcoat,e.clearcoatMap){let t={index:i.processTexture(e.clearcoatMap)};i.applyTextureTransform(t,e.clearcoatMap),n.clearcoatTexture=t}if(n.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){let t={index:i.processTexture(e.clearcoatRoughnessMap)};i.applyTextureTransform(t,e.clearcoatRoughnessMap),n.clearcoatRoughnessTexture=t}if(e.clearcoatNormalMap){let t={index:i.processTexture(e.clearcoatNormalMap)};i.applyTextureTransform(t,e.clearcoatNormalMap),n.clearcoatNormalTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,r[this.name]=!0}}class _{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;let i=this.writer,r=i.extensionsUsed,n={};if(n.iridescenceFactor=e.iridescence,e.iridescenceMap){let t={index:i.processTexture(e.iridescenceMap)};i.applyTextureTransform(t,e.iridescenceMap),n.iridescenceTexture=t}if(n.iridescenceIor=e.iridescenceIOR,n.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],n.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){let t={index:i.processTexture(e.iridescenceThicknessMap)};i.applyTextureTransform(t,e.iridescenceThicknessMap),n.iridescenceThicknessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,r[this.name]=!0}}class C{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;let i=this.writer,r=i.extensionsUsed,n={};if(n.transmissionFactor=e.transmission,e.transmissionMap){let t={index:i.processTexture(e.transmissionMap)};i.applyTextureTransform(t,e.transmissionMap),n.transmissionTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,r[this.name]=!0}}class D{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;let i=this.writer,r=i.extensionsUsed,n={};if(n.thicknessFactor=e.thickness,e.thicknessMap){let t={index:i.processTexture(e.thicknessMap)};i.applyTextureTransform(t,e.thicknessMap),n.thicknessTexture=t}n.attenuationDistance=e.attenuationDistance,n.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,r[this.name]=!0}}r.Utils={insertKeyframe:function(e,t){let i;let r=.001,n=e.getValueSize(),o=new e.TimeBufferType(e.times.length+1),a=new e.ValueBufferType(e.values.length+n),s=e.createInterpolant(new e.ValueBufferType(n));if(0===e.times.length){o[0]=t;for(let e=0;e<n;e++)a[e]=0;i=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<r)return 0;o[0]=t,o.set(e.times,1),a.set(s.evaluate(t),0),a.set(e.values,n),i=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<r)return e.times.length-1;o[o.length-1]=t,o.set(e.times,0),a.set(e.values,0),a.set(s.evaluate(t),e.values.length),i=o.length-1}else for(let l=0;l<e.times.length;l++){if(Math.abs(e.times[l]-t)<r)return l;if(e.times[l]<t&&e.times[l+1]>t){o.set(e.times.slice(0,l+1),0),o[l+1]=t,o.set(e.times.slice(l+1),l+2),a.set(e.values.slice(0,(l+1)*n),0),a.set(s.evaluate(t),(l+1)*n),a.set(e.values.slice((l+1)*n),(l+2)*n),i=l+1;break}}return e.times=o,e.values=a,i},mergeMorphTargetTracks:function(e,t){let r=[],n={},o=e.tracks;for(let e=0;e<o.length;++e){let a,s=o[e],l=(0,i.PropertyBinding).parseTrackName(s.name),h=(0,i.PropertyBinding).findNode(t,l.nodeName);if("morphTargetInfluences"!==l.propertyName||void 0===l.propertyIndex){r.push(s);continue}if(s.createInterpolant!==s.InterpolantFactoryMethodDiscrete&&s.createInterpolant!==s.InterpolantFactoryMethodLinear){if(s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),(s=s.clone()).setInterpolation(i.InterpolateLinear)}let c=h.morphTargetInfluences.length,d=h.morphTargetDictionary[l.propertyIndex];if(void 0===d)throw Error("THREE.GLTFExporter: Morph target name not found: "+l.propertyIndex);if(void 0===n[h.uuid]){a=s.clone();let e=new a.ValueBufferType(c*a.times.length);for(let t=0;t<a.times.length;t++)e[t*c+d]=a.values[t];a.name=(l.nodeName||"")+".morphTargetInfluences",a.values=e,n[h.uuid]=a,r.push(a);continue}let u=s.createInterpolant(new s.ValueBufferType(1));a=n[h.uuid];for(let e=0;e<a.times.length;e++)a.values[e*c+d]=u.evaluate(a.times[e]);for(let e=0;e<s.times.length;e++){let t=this.insertKeyframe(a,s.times[e]);a.values[t*c+d]=s.values[e]}}return e.tracks=r,e}}}),parcelRequire.register("dhh4v",function(e,t){$parcel$export(e.exports,"SVGRenderer",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("cRAlE");class n{constructor(){let e,t,n,o,a,s,l,h,c,d,u,p=0,m=null,f=1,g,y,x=this,w=new i.Box2,b=new i.Box2,v=new i.Color,M=new i.Color,S=new i.Color,P=new i.Color,T=new i.Color,_=new i.Color,C=new i.Vector3,D=new i.Vector3,A=new i.Vector3,E=new i.Matrix3,L=new i.Matrix4,I=new i.Matrix4,R=[],W=new r.Projector,V=document.createElementNS("http://www.w3.org/2000/svg","svg");function k(){for(p=0;V.childNodes.length>0;)V.removeChild(V.childNodes[0])}function B(e){return null!==m?e.toFixed(m):e}function O(e){S.setRGB(0,0,0),P.setRGB(0,0,0),T.setRGB(0,0,0);for(let t=0,i=e.length;t<i;t++){let i=e[t],r=i.color;i.isAmbientLight?(S.r+=r.r,S.g+=r.g,S.b+=r.b):i.isDirectionalLight?(P.r+=r.r,P.g+=r.g,P.b+=r.b):i.isPointLight&&(T.r+=r.r,T.g+=r.g,T.b+=r.b)}}function F(e,t,i,r){for(let n=0,o=e.length;n<o;n++){let o=e[n],a=o.color;if(o.isDirectionalLight){let e=C.setFromMatrixPosition(o.matrixWorld).normalize(),t=i.dot(e);if(t<=0)continue;t*=o.intensity,r.r+=a.r*t,r.g+=a.g*t,r.b+=a.b*t}else if(o.isPointLight){let e=C.setFromMatrixPosition(o.matrixWorld),n=i.dot(C.subVectors(e,t).normalize());if(n<=0||0==(n*=0==o.distance?1:1-Math.min(t.distanceTo(e)/o.distance,1)))continue;n*=o.intensity,r.r+=a.r*n,r.g+=a.g*n,r.b+=a.b*n}}}function z(e,t,i){let r=t.scale.x*s,n=t.scale.y*l;i.isPointsMaterial&&(r*=i.size,n*=i.size);let o="M"+B(e.x-.5*r)+","+B(e.y-.5*n)+"h"+B(r)+"v"+B(n)+"h"+B(-r)+"z",a="";(i.isSpriteMaterial||i.isPointsMaterial)&&(a="fill:"+i.color.getStyle()+";fill-opacity:"+i.opacity),H(a,o)}function U(e,t,i){let r="M"+B(e.positionScreen.x)+","+B(e.positionScreen.y)+"L"+B(t.positionScreen.x)+","+B(t.positionScreen.y);if(i.isLineBasicMaterial){let e="fill:none;stroke:"+i.color.getStyle()+";stroke-opacity:"+i.opacity+";stroke-width:"+i.linewidth+";stroke-linecap:"+i.linecap;i.isLineDashedMaterial&&(e=e+";stroke-dasharray:"+i.dashSize+","+i.gapSize),H(e,r)}}function N(e,t,i,r,o){x.info.render.vertices+=3,x.info.render.faces++;let a="M"+B(e.positionScreen.x)+","+B(e.positionScreen.y)+"L"+B(t.positionScreen.x)+","+B(t.positionScreen.y)+"L"+B(i.positionScreen.x)+","+B(i.positionScreen.y)+"z",s="";o.isMeshBasicMaterial?(v.copy(o.color),o.vertexColors&&v.multiply(r.color)):o.isMeshLambertMaterial||o.isMeshPhongMaterial||o.isMeshStandardMaterial?(M.copy(o.color),o.vertexColors&&M.multiply(r.color),v.copy(S),D.copy(e.positionWorld).add(t.positionWorld).add(i.positionWorld).divideScalar(3),F(n,D,r.normalModel,v),v.multiply(M).add(o.emissive)):o.isMeshNormalMaterial&&(A.copy(r.normalModel).applyMatrix3(E).normalize(),v.setRGB(A.x,A.y,A.z).multiplyScalar(.5).addScalar(.5)),H(s=o.wireframe?"fill:none;stroke:"+v.getStyle()+";stroke-opacity:"+o.opacity+";stroke-width:"+o.wireframeLinewidth+";stroke-linecap:"+o.wireframeLinecap+";stroke-linejoin:"+o.wireframeLinejoin:"fill:"+v.getStyle()+";fill-opacity:"+o.opacity,a)}function G(e,t,i){let r=t.x-e.x,n=t.y-e.y,o=r*r+n*n;if(0===o)return;let a=i/Math.sqrt(o);r*=a,n*=a,t.x+=r,t.y+=n,e.x-=r,e.y-=n}function H(e,t){y===e?g+=t:(j(),y=e,g=t)}function j(){g&&((u=q(p++)).setAttribute("d",g),u.setAttribute("style",y),V.appendChild(u)),g="",y=""}function q(e){return null==R[e]&&(R[e]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==f&&R[e].setAttribute("shape-rendering","crispEdges")),R[e]}this.domElement=V,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.overdraw=.5,this.info={render:{vertices:0,faces:0}},this.setQuality=function(e){switch(e){case"high":f=1;break;case"low":f=0}},this.setClearColor=function(e){_.set(e)},this.setPixelRatio=function(){},this.setSize=function(e,t){o=e,a=t,s=o/2,l=a/2,V.setAttribute("viewBox",-s+" "+-l+" "+o+" "+a),V.setAttribute("width",o),V.setAttribute("height",a),w.min.set(-s,-l),w.max.set(s,l)},this.getSize=function(){return{width:o,height:a}},this.setPrecision=function(e){m=e},this.clear=function(){k(),V.style.backgroundColor=_.getStyle()},this.render=function(o,a){if(a instanceof i.Camera==!1){console.error("THREE.SVGRenderer.render: camera is not an instance of Camera.");return}let u=o.background;u&&u.isColor?(k(),V.style.backgroundColor=u.getStyle()):!0===this.autoClear&&this.clear(),x.info.render.vertices=0,x.info.render.faces=0,L.copy(a.matrixWorldInverse),I.multiplyMatrices(a.projectionMatrix,L),t=(e=W.projectScene(o,a,this.sortObjects,this.sortElements)).elements,n=e.lights,E.getNormalMatrix(a.matrixWorldInverse),O(n),g="",y="";for(let e=0,i=t.length;e<i;e++){let i=t[e],n=i.material;if(void 0!==n&&0!==n.opacity){if(b.makeEmpty(),i instanceof r.RenderableSprite)h=i,h.x*=s,h.y*=-l,z(h,i,n);else if(i instanceof r.RenderableLine)h=i.v1,c=i.v2,h.positionScreen.x*=s,h.positionScreen.y*=-l,c.positionScreen.x*=s,c.positionScreen.y*=-l,b.setFromPoints([h.positionScreen,c.positionScreen]),!0===w.intersectsBox(b)&&U(h,c,n);else if(i instanceof r.RenderableFace){if(h=i.v1,c=i.v2,d=i.v3,h.positionScreen.z<-1||h.positionScreen.z>1||c.positionScreen.z<-1||c.positionScreen.z>1||d.positionScreen.z<-1||d.positionScreen.z>1)continue;h.positionScreen.x*=s,h.positionScreen.y*=-l,c.positionScreen.x*=s,c.positionScreen.y*=-l,d.positionScreen.x*=s,d.positionScreen.y*=-l,this.overdraw>0&&(G(h.positionScreen,c.positionScreen,this.overdraw),G(c.positionScreen,d.positionScreen,this.overdraw),G(d.positionScreen,h.positionScreen,this.overdraw)),b.setFromPoints([h.positionScreen,c.positionScreen,d.positionScreen]),!0===w.intersectsBox(b)&&N(h,c,d,i,n)}}}j(),o.traverseVisible(function(e){if(e.isSVGObject){if(C.setFromMatrixPosition(e.matrixWorld),C.applyMatrix4(I),C.z<-1||C.z>1)return;let t=C.x*s,i=-C.y*l,r=e.node;r.setAttribute("transform","translate("+t+","+i+")"),V.appendChild(r)}})}}}}),parcelRequire.register("cRAlE",function(e,t){$parcel$export(e.exports,"RenderableFace",()=>n),$parcel$export(e.exports,"RenderableLine",()=>a),$parcel$export(e.exports,"RenderableSprite",()=>s),$parcel$export(e.exports,"Projector",()=>l);var i=parcelRequire("4xklQ");class r{constructor(){this.id=0,this.object=null,this.z=0,this.renderOrder=0}}class n{constructor(){this.id=0,this.v1=new o,this.v2=new o,this.v3=new o,this.normalModel=new i.Vector3,this.vertexNormalsModel=[new i.Vector3,new i.Vector3,new i.Vector3],this.vertexNormalsLength=0,this.color=new i.Color,this.material=null,this.uvs=[new i.Vector2,new i.Vector2,new i.Vector2],this.z=0,this.renderOrder=0}}class o{constructor(){this.position=new i.Vector3,this.positionWorld=new i.Vector3,this.positionScreen=new i.Vector4,this.visible=!0}copy(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)}}class a{constructor(){this.id=0,this.v1=new o,this.v2=new o,this.vertexColors=[new i.Color,new i.Color],this.material=null,this.z=0,this.renderOrder=0}}class s{constructor(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new i.Vector2,this.material=null,this.renderOrder=0}}class l{constructor(){let e,t,l=0,h,c,d=0,u,p,m=0,f,g,y=0,x,w,b=0,v,M={objects:[],lights:[],elements:[]},S=new i.Vector3,P=new i.Vector4,T=new i.Box3(new i.Vector3(-1,-1,-1),new i.Vector3(1,1,1)),_=new i.Box3,C=[,,,],D=new i.Matrix4,A=new i.Matrix4,E=new i.Matrix4,L=new i.Frustum,I=[],R=[],W=[],V=[],k=[];function B(){let e=[],t=[],r=[],n=null,o=new i.Matrix3;function a(e){let t=e.position,i=e.positionWorld,r=e.positionScreen;i.copy(t).applyMatrix4(v),r.copy(i).applyMatrix4(A);let n=1/r.w;r.x*=n,r.y*=n,r.z*=n,e.visible=r.x>=-1&&r.x<=1&&r.y>=-1&&r.y<=1&&r.z>=-1&&r.z<=1}function s(e,t,i){(h=G()).position.set(e,t,i),a(h)}function l(e,t,i){return!0===e.visible||!0===t.visible||!0===i.visible||(C[0]=e.positionScreen,C[1]=t.positionScreen,C[2]=i.positionScreen,T.intersectsBox(_.setFromPoints(C)))}function c(e,t,i){return(i.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(i.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0}function d(a,s,h,d){let p=R[a],m=R[s],f=R[h];if(!1!==l(p,m,f)&&(d.side===i.DoubleSide||!0===c(p,m,f))){(u=H()).id=n.id,u.v1.copy(p),u.v2.copy(m),u.v3.copy(f),u.z=(p.positionScreen.z+m.positionScreen.z+f.positionScreen.z)/3,u.renderOrder=n.renderOrder,S.subVectors(f.position,m.position),P.subVectors(p.position,m.position),S.cross(P),u.normalModel.copy(S),u.normalModel.applyMatrix3(o).normalize();for(let t=0;t<3;t++){let i=u.vertexNormalsModel[t];i.fromArray(e,3*arguments[t]),i.applyMatrix3(o).normalize();let n=u.uvs[t];n.fromArray(r,2*arguments[t])}u.vertexNormalsLength=3,u.material=d,d.vertexColors&&u.color.fromArray(t,3*a),M.elements.push(u)}}return{setObject:function(i){n=i,o.getNormalMatrix(n.matrixWorld),e.length=0,t.length=0,r.length=0},projectVertex:a,checkTriangleVisibility:l,checkBackfaceCulling:c,pushVertex:s,pushNormal:function(t,i,r){e.push(t,i,r)},pushColor:function(e,i,r){t.push(e,i,r)},pushUv:function(e,t){r.push(e,t)},pushLine:function(e,i){let r=R[e],o=R[i];r.positionScreen.copy(r.position).applyMatrix4(E),o.positionScreen.copy(o.position).applyMatrix4(E),!0===Y(r.positionScreen,o.positionScreen)&&(r.positionScreen.multiplyScalar(1/r.positionScreen.w),o.positionScreen.multiplyScalar(1/o.positionScreen.w),(f=j()).id=n.id,f.v1.copy(r),f.v2.copy(o),f.z=Math.max(r.positionScreen.z,o.positionScreen.z),f.renderOrder=n.renderOrder,f.material=n.material,n.material.vertexColors&&(f.vertexColors[0].fromArray(t,3*e),f.vertexColors[1].fromArray(t,3*i)),M.elements.push(f))},pushTriangle:d}}let O=new B;function F(e){if(!1===e.visible)return;if(e.isLight)M.lights.push(e);else if(e.isMesh||e.isLine||e.isPoints){if(!1===e.material.visible||!0===e.frustumCulled&&!1===L.intersectsObject(e))return;z(e)}else if(e.isSprite){if(!1===e.material.visible||!0===e.frustumCulled&&!1===L.intersectsSprite(e))return;z(e)}let t=e.children;for(let e=0,i=t.length;e<i;e++)F(t[e])}function z(t){(e=N()).id=t.id,e.object=t,S.setFromMatrixPosition(t.matrixWorld),S.applyMatrix4(A),e.z=S.z,e.renderOrder=t.renderOrder,M.objects.push(e)}function U(e,t,i){let r=1/e.w;e.z*=r,e.z>=-1&&e.z<=1&&((x=q()).id=t.id,x.x=e.x*r,x.y=e.y*r,x.z=e.z,x.renderOrder=t.renderOrder,x.object=t,x.rotation=t.rotation,x.scale.x=t.scale.x*Math.abs(x.x-(e.x+i.projectionMatrix.elements[0])/(e.w+i.projectionMatrix.elements[12])),x.scale.y=t.scale.y*Math.abs(x.y-(e.y+i.projectionMatrix.elements[5])/(e.w+i.projectionMatrix.elements[13])),x.material=t.material,M.elements.push(x))}function N(){if(t===l){let e=new r;return I.push(e),l++,t++,e}return I[t++]}function G(){if(c===d){let e=new o;return R.push(e),d++,c++,e}return R[c++]}function H(){if(p===m){let e=new n;return W.push(e),m++,p++,e}return W[p++]}function j(){if(g===y){let e=new a;return V.push(e),y++,g++,e}return V[g++]}function q(){if(w===b){let e=new s;return k.push(e),b++,w++,e}return k[w++]}function X(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function Y(e,t){let i=0,r=1,n=e.z+e.w,o=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return n>=0&&o>=0&&a>=0&&s>=0||(!(n<0)||!(o<0))&&(!(a<0)||!(s<0))&&(n<0?i=Math.max(i,n/(n-o)):o<0&&(r=Math.min(r,n/(n-o))),a<0?i=Math.max(i,a/(a-s)):s<0&&(r=Math.min(r,a/(a-s))),!(r<i)&&(e.lerp(t,i),t.lerp(e,1-r),!0))}this.projectScene=function(e,i,r,n){p=0,g=0,w=0,M.elements.length=0,!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===i.parent&&!0===i.matrixWorldAutoUpdate&&i.updateMatrixWorld(),D.copy(i.matrixWorldInverse),A.multiplyMatrices(i.projectionMatrix,D),L.setFromProjectionMatrix(A),t=0,M.objects.length=0,M.lights.length=0,F(e),!0===r&&M.objects.sort(X);let o=M.objects;for(let e=0,t=o.length;e<t;e++){let t=o[e].object,r=t.geometry;if(O.setObject(t),v=t.matrixWorld,c=0,t.isMesh){let e=t.material,i=Array.isArray(e),n=r.attributes,o=r.groups;if(void 0===n.position)continue;let a=n.position.array;for(let e=0,i=a.length;e<i;e+=3){let i=a[e],n=a[e+1],o=a[e+2],s=r.morphAttributes.position;if(void 0!==s){let l=r.morphTargetsRelative,h=t.morphTargetInfluences;for(let t=0,r=s.length;t<r;t++){let r=h[t];if(0===r)continue;let c=s[t];l?(i+=c.getX(e/3)*r,n+=c.getY(e/3)*r,o+=c.getZ(e/3)*r):(i+=(c.getX(e/3)-a[e])*r,n+=(c.getY(e/3)-a[e+1])*r,o+=(c.getZ(e/3)-a[e+2])*r)}}O.pushVertex(i,n,o)}if(void 0!==n.normal){let e=n.normal.array;for(let t=0,i=e.length;t<i;t+=3)O.pushNormal(e[t],e[t+1],e[t+2])}if(void 0!==n.color){let e=n.color.array;for(let t=0,i=e.length;t<i;t+=3)O.pushColor(e[t],e[t+1],e[t+2])}if(void 0!==n.uv){let e=n.uv.array;for(let t=0,i=e.length;t<i;t+=2)O.pushUv(e[t],e[t+1])}if(null!==r.index){let n=r.index.array;if(o.length>0)for(let r=0;r<o.length;r++){let a=o[r];if(void 0!==(e=!0===i?t.material[a.materialIndex]:t.material))for(let t=a.start,i=a.start+a.count;t<i;t+=3)O.pushTriangle(n[t],n[t+1],n[t+2],e)}else for(let t=0,i=n.length;t<i;t+=3)O.pushTriangle(n[t],n[t+1],n[t+2],e)}else if(o.length>0)for(let r=0;r<o.length;r++){let n=o[r];if(void 0!==(e=!0===i?t.material[n.materialIndex]:t.material))for(let t=n.start,i=n.start+n.count;t<i;t+=3)O.pushTriangle(t,t+1,t+2,e)}else for(let t=0,i=a.length/3;t<i;t+=3)O.pushTriangle(t,t+1,t+2,e)}else if(t.isLine){E.multiplyMatrices(A,v);let e=r.attributes;if(void 0!==e.position){let i=e.position.array;for(let e=0,t=i.length;e<t;e+=3)O.pushVertex(i[e],i[e+1],i[e+2]);if(void 0!==e.color){let t=e.color.array;for(let e=0,i=t.length;e<i;e+=3)O.pushColor(t[e],t[e+1],t[e+2])}if(null!==r.index){let e=r.index.array;for(let t=0,i=e.length;t<i;t+=2)O.pushLine(e[t],e[t+1])}else{let e=t.isLineSegments?2:1;for(let t=0,r=i.length/3-1;t<r;t+=e)O.pushLine(t,t+1)}}}else if(t.isPoints){E.multiplyMatrices(A,v);let e=r.attributes;if(void 0!==e.position){let r=e.position.array;for(let e=0,n=r.length;e<n;e+=3)P.set(r[e],r[e+1],r[e+2],1),P.applyMatrix4(E),U(P,t,i)}}else t.isSprite&&(t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),P.set(v.elements[12],v.elements[13],v.elements[14],1),P.applyMatrix4(A),U(P,t,i))}return!0===n&&M.elements.sort(X),M}}}}),parcelRequire.register("0SNMV",function(e,t){$parcel$export(e.exports,"WallHelper",()=>l);var i=parcelRequire("4xklQ"),r=parcelRequire("3BPdS"),n=parcelRequire("lYvzi"),o=parcelRequire("fcFxQ"),a=parcelRequire("6JsYu"),s=parcelRequire("73HrS");class l{constructor(e,t="wall"){this.editor=e,this.tool=t}drawingWallHelper(e,t,i=280){let n=this.editor.wallHelp.drawWallHelp(e.clone(),t.clone(),i);if(""!=n.realAngle){let e=this.editor.checkHasCurrentInput(this.editor.uiPanelBox.dom,"angleInput"),t=this.editor.getScreenPosition(n.arcCenter.clone());if(e>=0){let e=document.getElementById("angleInput");e.style.marginLeft=t.x+"px",e.style.marginTop=t.y+"px",e.value=n.realAngle}else{let e=new(0,r.UIInput)(n.realAngle).setClass("moveInput").setId("angleInput").setFocus().setFontSize("15px").setWidth("40px").setMarginTop(t.y+"px").setMarginLeft(t.x+"px").onKeyDown((function(e){if("Tab"==e.key&&(document.getElementById("realAngleInput")?(document.getElementById("realAngleInput").focus(),document.getElementById("realAngleInput").select()):(document.getElementById("lengthInput").focus(),document.getElementById("lengthInput").select()),e.preventDefault()),"Escape"==e.key&&this.editor.exitTool(),"13"==e.keyCode){let e=document.getElementById("angleInput").value,t=document.getElementById("lengthInput").value,i="";if(document.getElementById("realAngleInput")&&((i=document.getElementById("realAngleInput").value).replace(/°/g,"")==n.wallRealAngle.replace(/°/g,"")&&(i=""),""!=i)){i=i.replace(/°/g,"");let e=this.editor.getDomById(this.editor.uiPanelBox.dom,"realAngleInput");e&&(i=1*e.getAttribute("wallAngle")+i*e.getAttribute("clockWise")*1)}let r=[t,e,i];this.editor.list.startPlayer.dispatch(),"wall"==this.tool?this.editor.execute(new a.WallCommand(this.editor,r),"画墙"):this.editor.execute(new o.SplitToolCommand(this.editor,r),"分割墙")}}).bind(this));e.dom.addEventListener("mousedown",(function(e){2==e.button&&this.editor.camera.isOrthographicCamera&&this.editor.exitTool()}).bind(this)),e.setAttribute("tabInput",0),this.editor.uiPanelBox.add(e)}}else document.getElementById("angleInput")&&this.editor.uiPanelBox.dom.removeChild(document.getElementById("angleInput"));let s=this.editor.checkHasCurrentInput(this.editor.uiPanelBox.dom,"lengthInput"),l=this.editor.getScreenPosition(n.lineCenter.clone());if(s>=0){let e=document.getElementById("lengthInput");e.style.marginLeft=l.x+"px",e.style.marginTop=l.y+"px",e.value=n.lineLength,e.focus(),e.select()}else{let e=new(0,r.UIInput)(n.lineLength).setClass("moveInput").setId("lengthInput").setFontSize("15px").setWidth("40px").setMarginTop(l.y+"px").setMarginLeft(l.x+"px").setFocus().onKeyDown((function(e){if("Tab"==e.key&&document.getElementById("angleInput")&&(document.getElementById("angleInput").focus(),document.getElementById("angleInput").select(),e.preventDefault()),"Escape"==e.key&&this.editor.exitTool(),"13"==e.keyCode){let e="";document.getElementById("angleInput")&&(e=document.getElementById("angleInput").value).replace(/°/g,"")==n.realAngle.replace(/°/g,"")&&(e="");let t=document.getElementById("lengthInput").value,i="";if(document.getElementById("realAngleInput")&&((i=document.getElementById("realAngleInput").value).replace(/°/g,"")==n.wallRealAngle.replace(/°/g,"")&&(i=""),""!=i)){i=i.replace(/°/g,"");let e=this.editor.getDomById(this.editor.uiPanelBox.dom,"realAngleInput");e&&(i=1*e.getAttribute("wallAngle")+i*e.getAttribute("clockWise")*1)}let r=[t,e,i];this.editor.list.startPlayer.dispatch(),"wall"==this.tool?this.editor.execute(new a.WallCommand(this.editor,r),"画墙"):this.editor.execute(new o.SplitToolCommand(this.editor,r),"分割墙")}}).bind(this));e.dom.addEventListener("mousedown",(function(e){2==e.button&&this.editor.camera.isOrthographicCamera&&this.editor.exitTool()}).bind(this)),e.setAttribute("tabInput",0),this.editor.uiPanelBox.add(e),document.getElementById("lengthInput").focus()}return this.editor.helperGroup.add(n),n}addLineWallHelper(e,t,n=""){let o="";o=""==n?this.editor.wallHelp.createLineDimensionsLine(e,t,!1):this.editor.wallHelp.createLineDimensionsLine(e,t,!1,n);let a=new(0,i.Vector2)(t.x,t.y).sub(new i.Vector2(e.x,e.y)).angle();(a=180/Math.PI*a)>180&&a<270?a=360-a+180:a>90&&a<=180?(a*=-1,a+=180):a=360-a;let s=this.editor.getScreenPosition(o.center.clone()),l=new(0,r.UIText)(o.lineLength).setClass("showWallLength"+o.uuid).setFontSize("15px").setWidth("40px").setMarginTop(s.y+"px").setMarginLeft(s.x+"px").setStyle(["transform"],["rotate("+a+"deg)"]),h=o.center.x+"/"+o.center.y+"/"+o.center.z;return l.setAttribute("worldPosition",h),l.setAttribute("angle",a),0!=o.lineLength&&this.editor.uiPanelBox.add(l),this.editor.helperGroup.add(o),o}addArcWallHelper(){}addBSRWallHelper(e){let t=e.cp,r=e.startPoint,n=e.endPoint,o=(0,s.WallCore).makeControlPoint(t);o.useType="bseControl",o.wall=e;var a=new(0,i.BufferGeometry)().setFromPoints([r,t,n]),l=new i.Line(a,new i.MeshBasicMaterial({color:"#1E90FF",side:i.DoubleSide,transparent:!0}));l.startPoint=e.startPoint,l.endPoint=e.endPoint,this.editor.pointHelperGroup.add(o),l.lineType="bseLine",this.editor.helperGroup.add(l)}drawingRoomHelper(e,t,o,a=240){let s=new i.Vector3(e.x+a/2,e.y-a/2,0),l=new i.Vector3(t.x-a/2,t.y-a/2,0),h=new i.Vector3(o.x+a/2,o.y+a/2,0),c=this.editor.wallHelp.createLineDimensionsLine(l,s,!1),d=this.editor.wallHelp.createLineDimensionsLine(s,h,!1),u=this.editor.getScreenPosition(c.center.clone()),p=this.editor.getScreenPosition(d.center.clone()),m=this.editor.checkHasCurrentInput(this.editor.uiPanelBox.dom,"topInput"),f=this.editor.checkHasCurrentInput(this.editor.uiPanelBox.dom,"leftInput");if(m>=0){let e=document.getElementById("topInput");e.style.marginLeft=u.x+"px",e.style.marginTop=u.y+"px",e.value=c.lineLength,e.focus(),e.select()}else{let e=new(0,r.UIInput)(c.lineLength).setClass("moveInput").setId("topInput").setFontSize("15px").setWidth("40px").setMarginTop(u.y+"px").setMarginLeft(u.x+"px").setFocus().onKeyDown((function(t){let i=document.getElementById("leftInput");if("Tab"==t.key&&i&&(i.focus(),i.select(),t.preventDefault()),"Escape"==t.key&&this.editor.exitTool(),"13"==t.keyCode){let t=1*e.dom.value,r=1*i.value;new(0,n.RoomCommand)(this.editor,[t,r]).execute()}}).bind(this));this.editor.uiPanelBox.add(e)}if(f>=0){let e=document.getElementById("leftInput");e.style.marginLeft=p.x+"px",e.style.marginTop=p.y+"px",e.value=d.lineLength}else{let e=new(0,r.UIInput)(d.lineLength).setClass("moveInput").setId("leftInput").setFontSize("15px").setWidth("40px").setMarginTop(p.y+"px").setMarginLeft(p.x+"px").setFocus().onKeyDown((function(t){let i=document.getElementById("topInput");if("Tab"==t.key&&i&&(i.focus(),i.select(),t.preventDefault()),"Escape"==t.key&&this.editor.exitTool(),"13"==t.keyCode){let t=1*i.value,r=1*e.dom.value;new(0,n.RoomCommand)(this.editor,[t,r]).execute()}}).bind(this));this.editor.uiPanelBox.add(e)}return[c,d]}}}),parcelRequire.register("lYvzi",function(e,t){$parcel$export(e.exports,"RoomCommand",()=>a);var i=parcelRequire("4xklQ"),r=parcelRequire("9HO6e"),n=parcelRequire("73HrS"),o=parcelRequire("65FdD");class a{constructor(e,t=[]){this.editor=e,this.param=t}drawMain(){if(("Mesh"==this.editor.currenDraw.type||"Group"==this.editor.currenDraw.type)&&(this.editor.currenDraw=""),""!=this.editor.currenDraw&&this.editor.currenDraw.forEach(e=>{this.editor.scene.remove(e),this.editor.removeHelperByWallId(e.id)}),0!=this.param.length){let e=(0,r.UtilCore).toVector3(this.editor.startPoint),t=new(0,i.Vector3)(this.editor.currentPoint.x,e.y,0).sub(e.clone()),o=new(0,i.Vector3)(e.x,this.editor.currentPoint.y,0).sub(e.clone()),a=e.clone().add(t.setLength(this.param[0]+this.editor.wallDep)),s=e.clone().add(o.setLength(this.param[1]+this.editor.wallDep)),l=new i.Vector3(a.x,s.y,0);this.editor.currenDraw=new(0,n.RoomCore)(this.editor).createRoom(e,l,this.editor.roomWallDep),this.editor.startPoint=""}else this.editor.currenDraw=new(0,n.RoomCore)(this.editor).createRoom(this.editor.startPoint,this.editor.currentPoint,this.editor.roomWallDep);this.editor.currenDraw.forEach(e=>{this.editor.scene.add(e)});let e=[this.editor.startPoint.x,this.editor.currentPoint.x],t=[this.editor.startPoint.y,this.editor.currentPoint.y],o=Math.min.apply(null,e),a=Math.max.apply(null,e),s=Math.min.apply(null,t),l=Math.max.apply(null,t),h=new i.Vector3(o,l,0),c=new i.Vector3(a,l,0),d=new i.Vector3(o,s,0),u=this.editor.wallHelper.drawingRoomHelper(h,c,d,this.editor.wallDep);u[0].wallId=this.editor.currenDraw[0].id,u[1].wallId=this.editor.currenDraw[3].id,this.editor.helperGroup.add(...u)}execute(){this.drawMain(),this.editor.currenDraw.forEach(e=>{this.editor.removeHelperByWallId(e.id),e.material.color=this.editor.cancelChooseColor,this.editor.allWalls.push(e)}),this.editor.removeInputByClassName(this.editor.uiPanelBox.dom,"moveInput"),this.splitWallCommand=new o.SplitWallCommand(this.editor),this.editor.currenDraw.forEach(e=>{this.editor.currenDraw=e,this.splitWallCommand.splitMain()}),this.editor.currenDraw="";let e=this.editor.allWalls.slice(0);e.forEach(t=>{let i=(0,r.UtilCore).getSamePositionWall(t,e);if(i.length>1){let e=i.pop();(0,r.UtilCore).extendParamWall(t,e),i.forEach(e=>{this.editor.removeWall(e)})}}),new(0,n.WallCore)(this.editor).wallToJson()}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}}}),parcelRequire.register("65FdD",function(e,t){$parcel$export(e.exports,"SplitWallCommand",()=>n);var i=parcelRequire("73HrS"),r=parcelRequire("9HO6e");class n{constructor(e){this.editor=e,this.currenObj={}}splitMain(){this.currenObj.main={startPoint:this.editor.currenDraw.startPoint,endPoint:this.editor.currenDraw.endPoint,mesh:[]},this.currenObj.other=[];let e=this.currenObj.main.startPoint,t=this.currenObj.main.endPoint,n=(0,r.UtilCore).handleLineData(e,t);if(this.editor.allWalls.length>0){let a=[],s=[];if(this.editor.allWalls.slice(0).forEach(o=>{if("remove"==o.status)return;let l=o.startPoint,h=o.endPoint,c=(0,r.UtilCore).handleLineData(l,h),d=(0,r.UtilCore).isSameVector(e,l),u=(0,r.UtilCore).isSameVector(e,h),p=(0,r.UtilCore).isSameVector(t,l),m=(0,r.UtilCore).isSameVector(t,h);if(""==this.editor.currenDraw||(0,r.UtilCore).checkSameWall(o,this.editor.currenDraw))return;let f="";(d||u)&&(f=(0,r.UtilCore).getMeshOtherPoint(this.editor.currenDraw,e)),(p||m)&&(f=(0,r.UtilCore).getMeshOtherPoint(this.editor.currenDraw,t));let g=!1;if(""!=f&&(0,r.UtilCore).pointInLine(f,c)&&(0,r.UtilCore).pointIsInLine(f,l,h)&&(g=!0),(d||u||p||m)&&!g)return;if(g){let e=new(0,i.WallCore)(this.editor).splitWall(o,f),t={startPoint:o.startPoint,endPoint:o.endPoint,mesh:e};this.currenObj.other.push(t),this.editor.removeWall(this.editor.currenDraw),this.editor.currenDraw="";return}let y=(0,r.UtilCore).lineIsIntersection(n,c);if(y){let n=(0,r.UtilCore).pointIsInLine(y,e,t),c=(0,r.UtilCore).pointIsInLine(y,l,h);if(!(n&&c))return;a.push(y),s.push(y.clone().distanceTo(e));let d=new(0,i.WallCore)(this.editor).splitWall(o,y),u={startPoint:o.startPoint,endPoint:o.endPoint,mesh:d};this.currenObj.other.push(u)}}),s.length>0){var o=s.slice(0);o.sort(function(e,t){return e-t});let e=this.editor.currenDraw;o.forEach(t=>{let r=s.indexOf(t),n=new(0,i.WallCore)(this.editor).splitWall(e,a[r]);this.currenObj.main.mesh.push(n[0]),n.length>1&&(o.indexOf(t)==o.length-1&&this.currenObj.main.mesh.push(n[1]),e=n[1])})}else{if(""==this.editor.currenDraw)return;0>this.editor.allWalls.indexOf(this.editor.currenDraw)&&this.editor.allWalls.push(this.editor.currenDraw),this.currenObj.main.mesh.push(this.editor.currenDraw)}}else this.currenObj.main.mesh.push(this.editor.currenDraw),this.editor.allWalls.push(this.editor.currenDraw)}undoSplit(){let e=[];var t=this.editor.allWalls.slice(0);this.currenObj.main.mesh.forEach(e=>{t.forEach(t=>{if((0,r.UtilCore).isSameVector(e.startPoint,t.startPoint)&&(0,r.UtilCore).isSameVector(e.endPoint,t.endPoint)){this.editor.wallGroup.remove(t),this.editor.removeHelperByWall(t),this.editor.allWalls.indexOf(t)>=0&&this.editor.allWalls.splice(this.editor.allWalls.indexOf(t),1);return}})}),this.editor.allWalls.slice(0).forEach(t=>{let i=(0,r.UtilCore).isSameVector(this.currenObj.main.startPoint,t.startPoint)||(0,r.UtilCore).isSameVector(this.currenObj.main.startPoint,t.endPoint),n=(0,r.UtilCore).isSameVector(this.currenObj.main.endPoint,t.startPoint)||(0,r.UtilCore).isSameVector(this.currenObj.main.endPoint,t.endPoint);(i||n)&&e.push(t)}),e.forEach(e=>{this.editor.addArcPointHelper(e.startPoint,e.endPoint)}),this.currenObj.other.reverse().forEach(e=>{let t="";e.mesh.forEach(e=>{this.editor.allWalls.slice(0).forEach(i=>{if((0,r.UtilCore).isSameVector(e.startPoint,i.startPoint)&&(0,r.UtilCore).isSameVector(e.endPoint,i.endPoint)){this.editor.wallGroup.remove(i),t=i,this.editor.removeHelperByWall(i),this.editor.allWalls.indexOf(i)>=0&&this.editor.allWalls.splice(this.editor.allWalls.indexOf(i),1);return}})});let n=new(0,i.WallCore)(this.editor).createLineWall(e.startPoint,e.endPoint);this.editor.addLineWallHelper(e.startPoint,e.endPoint),n.material.color=this.editor.getWallColor(n),""!=t&&(n.style=t.style,n.height=t.height,n.thickness=t.thickness),this.editor.scene.add(n),this.editor.allWalls.push(n)})}}}),parcelRequire.register("fcFxQ",function(e,t){$parcel$export(e.exports,"SplitToolCommand",()=>o);var i=parcelRequire("4xklQ"),r=parcelRequire("0SNMV"),n=parcelRequire("73HrS");class o{constructor(e,t=[]){this.editor=e,this.param=t}drawMain(){this.editor.currenDraw&&(this.editor.scene.remove(this.editor.currenDraw),this.editor.removeHelperByWallId(this.editor.currenDraw.id),this.editor.removeInputByClassName(this.editor.uiPanelBox.dom,"moveInput"));let e=this.editor.startPoint,t=this.editor.endPoint,n=t.clone().sub(e.clone());if(0!=this.param.length){let r=this.param[0],o=this.param[1],a=this.param[2],s=new i.Vector3(1,0,0);if(""!=o&&""==a){o=1*o.replace(/°/g,"");let n="";t.x>e.x&&t.y>e.y?n=Math.PI/180*o:t.x<e.x&&t.y>e.y?n=Math.PI-Math.PI/180*o:t.x<e.x&&t.y<e.y?n=Math.PI+Math.PI/180*o:t.x>e.x&&t.y<e.y&&(n=2*Math.PI-Math.PI/180*o),s.applyEuler(new i.Euler(0,0,n,"XYZ")),t=e.clone().add(s.setLength(r))}else if(""==o&&""!=a||""!=o&&""!=a){let n=Math.PI/180*a;s.applyEuler(new i.Euler(0,0,n,"XYZ")),t=e.clone().add(s.setLength(r))}else t=e.clone().add(n.setLength(r));this.editor.startPoint=t}this.editor.currenDraw=new i.Line(new(0,i.BufferGeometry)().setFromPoints([e,t]),this.editor.config.drawDotMaterial),this.editor.currenDraw.startPoint=e,this.editor.currenDraw.endPoint=t,this.editor.currenDraw.useType="splitLine",this.editor.currenDraw.computeLineDistances(),this.editor.currenDraw.renderOrder=50,this.editor.scene.add(this.editor.currenDraw),new(0,r.WallHelper)(this.editor,"sliptRoom").drawingWallHelper(e.clone(),t.clone()).wallId=this.editor.currenDraw.id}execute(){this.drawMain(),this.editor.currenDraw.material=this.editor.config.dotMaterial,this.editor.currenDraw.useType=this.editor.splitType,this.editor.splitRoomLine.add(this.editor.currenDraw),this.editor.removeHelperByWallId(this.editor.currenDraw.id),this.editor.removeInputByClassName(this.editor.uiPanelBox.dom,"moveInput"),this.editor.currenDraw="",new(0,n.WallCore)(this.editor).wallToJson()}undo(){}}}),parcelRequire.register("6JsYu",function(e,t){$parcel$export(e.exports,"WallCommand",()=>s);var i=parcelRequire("73HrS"),r=parcelRequire("9HO6e"),n=parcelRequire("65FdD"),o=parcelRequire("4xklQ");parcelRequire("0SNMV");var a=parcelRequire("3BPdS");class s{constructor(e,t=[]){this.editor=e,this.splitWallCommand="",this.param=t}drawMain(e="",t=""){""!=this.editor.currenDraw&&(this.editor.scene.remove(this.editor.currenDraw),this.editor.removeHelperByWallId(this.editor.currenDraw.id));let n=this.editor.startPoint,l=this.editor.endPoint;""!=this.splitWallCommand&&"{}"!=JSON.stringify(this.splitWallCommand.currenObj)&&(n=this.splitWallCommand.currenObj.main.startPoint,l=this.splitWallCommand.currenObj.main.endPoint);let h=new o.Vector2(l.x,l.y);if(l=this.handleEndPoint(n,l),(0,r.UtilCore).isSameVector(n,l))return;let c=l.clone().sub(n.clone());if(0!=this.param.length){let e=this.param[0],t=this.param[1],i=this.param[2],r=new o.Vector3(1,0,0);if(""!=t&&""==i){t=1*t.replace(/°/g,"");let i="";l.x>n.x&&l.y>n.y?i=Math.PI/180*t:l.x<n.x&&l.y>n.y?i=Math.PI-Math.PI/180*t:l.x<n.x&&l.y<n.y?i=Math.PI+Math.PI/180*t:l.x>n.x&&l.y<n.y&&(i=2*Math.PI-Math.PI/180*t),r.applyEuler(new o.Euler(0,0,i,"XYZ")),l=n.clone().add(r.setLength(e))}else if(""==t&&""!=i||""!=t&&""!=i){let t=Math.PI/180*i;r.applyEuler(new o.Euler(0,0,t,"XYZ")),l=n.clone().add(r.setLength(e))}else l=n.clone().add(c.setLength(e));n=new o.Vector2(1*n.x.toFixed(2),1*n.y.toFixed(2)),l=new o.Vector2(1*l.x.toFixed(2),1*l.y.toFixed(2)),this.editor.startPoint=l}this.editor.currenDraw=new(0,i.WallCore)(this.editor).createLineWall(n,l,this.editor.wallDep),2==this.editor.innerDraw&&(this.editor.currenDraw.realStart=n.clone(),this.editor.currenDraw.realEnd=l.clone()),this.editor.scene.add(this.editor.currenDraw);let d=this.editor.wallHelper.drawingWallHelper(n.clone(),l.clone()),u=(0,r.UtilCore).havePointWall(n,this.editor.allWalls),p=[];u.forEach(e=>{let t=(0,r.UtilCore).getMeshOtherPoint(e,n).clone().sub(n.clone()),i=(0,r.UtilCore).toVector3(t).angleTo((0,r.UtilCore).toVector3(c));i=Math.round(180/Math.PI*i),p.push(i)});let m=Math.min.apply(null,p),f=p.indexOf(m);if(f>=0){let e=u[f],t=(0,r.UtilCore).getMeshOtherPoint(e,n),i=Math.round(180/Math.PI*(0,r.UtilCore).toVector2(t.clone().sub(n.clone())).angle()),o=this.editor.wallHelp.createCircleLine(n,e,this.editor.currenDraw),h=(0,r.UtilCore).getClockWise(t,n,l);h=h>0?-1:1,d.wallRealAngle=o.realAngle,d.add(o);let c=this.editor.getScreenPosition(o.center.clone());if(this.editor.checkHasCurrentInput(this.editor.uiPanelBox.dom,"realAngleInput")>=0){let e=document.getElementById("realAngleInput");e.style.marginLeft=c.x+"px",e.style.marginTop=c.y+"px",e.value=o.realAngle}else{let e=new(0,a.UIInput)(o.realAngle).setClass("moveInput").setId("realAngleInput").setFontSize("15px").setWidth("40px").setMarginTop(c.y+"px").setMarginLeft(c.x+"px").setFocus().onKeyDown((function(e){if("Tab"==e.key&&(document.getElementById("lengthInput").focus(),document.getElementById("lengthInput").select(),e.preventDefault()),"Escape"==e.key&&this.editor.exitTool(),"13"==e.keyCode){let e="";document.getElementById("angleInput")&&(e=document.getElementById("angleInput").value).replace(/°/g,"")==d.realAngle.replace(/°/g,"")&&(e="");let t=[document.getElementById("lengthInput").value,e,i+1*document.getElementById("realAngleInput").value*h];this.editor.list.startPlayer.dispatch(),this.editor.execute(new s(this.editor,t),"画墙")}}).bind(this));e.dom.addEventListener("mousedown",(function(e){2==e.button&&this.editor.camera.isOrthographicCamera&&this.editor.exitTool()}).bind(this)),e.setAttribute("wallAngle",i),e.setAttribute("clockWise",h),e.setAttribute("tabInput",0),this.editor.uiPanelBox.add(e)}}d.wallId=this.editor.currenDraw.id;let g=!0;this.editor.allLinkWallByStartPoint.forEach(e=>{let t=(0,r.UtilCore).handleLineData(e.startPoint,e.endPoint);(0,r.UtilCore).pointInLine(h,t)&&(g=!1)}),g&&""==this.splitWallCommand&&this.editor.wallTool.handleIntersectNew3(this.editor.currenDraw,this.editor.allLinkWallByStartPoint)}execute(e="",t=""){if(this.drawMain(e,t),!this.editor.currenDraw)return;if(2==this.editor.innerDraw&&"wall"==this.editor.toolType){let e=this.editor.currenDraw.geometry.attributes.position.array,t=new o.Vector2(e[6],e[7]),i=new o.Vector2(e[15],e[16]),n=new o.Vector2(e[0],e[1]),a=new o.Vector2(e[9],e[10]),s=this.editor.allWalls.slice(0),l=(0,r.UtilCore).handleLineData(this.editor.currenDraw.startPoint,this.editor.currenDraw.endPoint),h=[[],[]];s.forEach(e=>{if(!e.wallID)return;let s=e.geometry.attributes.position.array,c=[new o.Vector2(s[9],s[10]),new o.Vector2(s[12],s[13]),new o.Vector2(s[15],s[16]),new o.Vector2(s[0],s[1]),new o.Vector2(s[3],s[4]),new o.Vector2(s[6],s[7])],d=-1,u=-1,p=0;if(c.forEach(e=>{p++,((0,r.UtilCore).isSameVector(t,e)||(0,r.UtilCore).isSameVector(n,e))&&(d=p),((0,r.UtilCore).isSameVector(i,e)||(0,r.UtilCore).isSameVector(a,e))&&(u=p)}),-1==d&&-1==u)return;let m=(0,r.UtilCore).handleLineData(e.startPoint,e.endPoint),f=(0,r.UtilCore).lineIsIntersection(l,m),g=1==d||2==d||3==d||1==u||2==u||3==u,y=4==d||5==d||6==d||4==u||5==u||6==u;!f&&(g&&(f=e.endPoint.clone()),y&&(f=e.startPoint.clone()));let x=[e,f,"",""];g&&(x[2]="end",x[3]=e.endPoint.clone()),y&&(x[2]="start",x[3]=e.startPoint.clone()),-1!=d&&h[0].push(x),-1!=u&&h[1].push(x)});let c=h[0],d=h[1];if(1==c.length){let e=c[0][0];this.editor.removeHelperByWall(e),"end"==c[0][2]?e.endPoint=c[0][1]:e.startPoint=c[0][1],this.editor.currenDraw.startPoint=c[0][1]}else c.length>1&&(this.editor.currenDraw.startPoint=c[0][3],0==d.length&&(this.editor.currenDraw.endPoint=this.editor.currenDraw.realEnd.clone()));if(1==d.length){let e=d[0][0];this.editor.removeHelperByWall(e),"end"==d[0][2]?e.endPoint=d[0][1]:e.startPoint=d[0][1],this.editor.currenDraw.endPoint=d[0][1]}else d.length>1&&(this.editor.currenDraw.endPoint=d[0][3],0==c.length&&(this.editor.currenDraw.startPoint=this.editor.currenDraw.realStart.clone()))}this.editor.removeHelperByWallId(this.editor.currenDraw.id),this.editor.removeInputByClassName(this.editor.uiPanelBox.dom,"moveInput"),this.editor.addLineWallHelper(this.editor.currenDraw.startPoint,this.editor.currenDraw.endPoint),this.editor.currenDraw.material.color=this.editor.cancelChooseColor,this.splitWallCommand=new n.SplitWallCommand(this.editor),this.splitWallCommand.splitMain(),this.editor.currenDraw="";let a=this.editor.floorGroup2d.children.length;new(0,i.WallCore)(this.editor).wallToJson(),a!=this.editor.floorGroup2d.children.length&&this.editor.exitTool(),0!=this.param.length&&(this.editor.allLinkWallByStartPoint=[],this.editor.allLinkWallByStartPoint=(0,r.UtilCore).havePointWall(this.editor.startPoint,this.editor.allWalls)),this.editor.otherMeshs.forEach(e=>{if(""==e.wallId&&e.wallPoint){let t=(0,r.UtilCore).getRealWallByPosition(e.wallPoint[0],e.wallPoint[1],this.editor.allWalls);t&&(e.wallId=t.wallID)}})}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}handleEndPoint(e,t){return 150>Math.abs(e.x-t.x)&&(t.x=e.x),150>Math.abs(e.y-t.y)&&(t.y=e.y),t}toJson(){let e=[];this.editor.allWalls.forEach(t=>{let i={start:{x:1*t.startPoint.x.toFixed(2),y:1*t.startPoint.y.toFixed(2),z:0},end:{x:1*t.endPoint.x.toFixed(2),y:1*t.endPoint.y.toFixed(2),z:0},style:0,line:0,isArc:!1,thickness:240,height:280,direction:"",offsetXY:100};e.push(i)})}}}),parcelRequire.register("eCdUa",function(e,t){$parcel$export(e.exports,"DoorHelper",()=>s);var i=parcelRequire("4xklQ"),r=parcelRequire("3BPdS"),n=parcelRequire("eA4zA"),o=parcelRequire("9HO6e"),a=parcelRequire("hWloQ");class s{constructor(e){this.editor=e}addLineDoorHelper(e,t,i,o,s=!0,l=280){let h=new(0,a.WallHelp)().createDimensionsLineForDoor(e,t,i,l);this.editor.doorHelperGroup.add(h);let c=this.editor.getScreenPosition(h.center.clone()),d=new(0,r.UIInput)(h.lineLength).setClass("showDoorLength"+h.uuid).setId("showDoorLength_"+o).setFontSize("15px").setWidth("40px").setMarginTop(c.y+"px").setFocus().setMarginLeft(c.x+"px").onKeyDown((function(e){if("Tab"==e.key){let t="";(t="start"==o?document.getElementById("showDoorLength_width"):"width"==o?document.getElementById("showDoorLength_end"):document.getElementById("showDoorLength_start")).focus(),t.select(),e.preventDefault()}if("13"==e.keyCode){let e=document.getElementsByClassName("showDoorLength"+h.uuid)[0].value;this.editor.list.startPlayer.dispatch(),this.editor.currenDraw&&(this.editor.currentDoor=this.editor.currenDraw),this.editor.execute(new n.DrawCommand(this.editor,"door","end",[e,1*e-h.lineLength,o]),"改变门尺寸")}}).bind(this)),u=h.center.x+"/"+h.center.y+"/"+h.center.z;return s||d.setDisabled(!0),d.setAttribute("worldPosition",u),this.editor.uiPanelBox.add(d),h}addDoorHelper(e,t,r){let n=(0,o.UtilCore).getNewPoint(e),s=(0,o.UtilCore).getNewPoint(e,"end"),l=t.startPoint.clone(),h=t.endPoint.clone(),c=this.editor.getDisByScreen();this.addLineDoorHelper(l,h,t.wallDep,"width",!t.isLock,240/c);let d=(0,o.UtilCore).pointIsInLine(l,h,n),u=this.editor.getAllWindowInWall(e),p=[];u.forEach(i=>{i.uuid!=t.uuid&&("LWindow"==i.modelType?(i.leftWindow[0].wallID==e.wallID&&p.push(i.leftWindow[5]),i.rightWindow[0].wallID==e.wallID&&p.push(i.rightWindow[5])):"UWindow"==i.modelType?(i.leftWindow[0].wallID==e.wallID&&p.push(i.leftWindow[2]),i.rightWindow[0].wallID==e.wallID&&p.push(i.rightWindow[2])):p.push(i.startPoint.clone(),i.endPoint.clone()))}),p.push(t.startPoint.clone(),t.endPoint.clone());let m=(0,o.UtilCore).sortPoint(p,n,s);d||m.reverse();let f=[l.x,l.y],g=[h.x,h.y],y=(0,o.UtilCore).getArrayIndex(m,f,g),x=new i.Vector3(y[0][0],y[0][1]),w=new i.Vector3(y[1][0],y[1][1]);if(this.addLineDoorHelper(x,l,t.wallDep,"start",!t.isLock,240/c),this.addLineDoorHelper(h,w,t.wallDep,"end",!t.isLock,240/c),r&&!t.isLock){let e=new a.WallHelp;this.editor.pointHelperGroup.add(e.createDoorPoint(l,"start")),this.editor.pointHelperGroup.add(e.createDoorPoint(h,"end"))}}addUWindowHelper(e,t,i){let r=(0,o.UtilCore).getNewPoint(e),n=(0,o.UtilCore).getNewPoint(e,"end");if(this.addLineDoorHelper(r,n,t.wallDep,"width",!1),t.leftWindow){let r=t.leftWindow[0],n=t.leftWindow[1],s=t.rightWindow[0],l=t.rightWindow[1],h=(0,o.UtilCore).getSamePointTwoWall(e,r).clone(),c=(0,o.UtilCore).getSamePointTwoWall(e,s).clone(),d=(0,o.UtilCore).getMeshOtherPoint(r,h),u=(0,o.UtilCore).getMeshOtherPoint(s,c);h.add(d.clone().sub(h.clone()).setLength(e.thickness/2)),c.add(u.clone().sub(c.clone()).setLength(e.thickness/2));let p=h.clone().add(d.clone().sub(h.clone()).setLength(n)),m=c.clone().add(u.clone().sub(c.clone()).setLength(l));if(this.addLineDoorHelper(p,h,t.wallDep,"left",!t.isLock),this.addLineDoorHelper(c,m,t.wallDep,"right",!t.isLock),i){let e=new a.WallHelp;this.editor.pointHelperGroup.add(e.createDoorPoint(p,"left")),this.editor.pointHelperGroup.add(e.createDoorPoint(m,"right"))}}}addLWindowHelper(e,t){if(e.leftWindow){let i=e.leftWindow[0],r=e.leftWindow[1],n=e.rightWindow[0],s=e.rightWindow[1],l=e.center.clone(),h=e.center.clone(),c=(0,o.UtilCore).getMeshOtherPoint(i,l),d=(0,o.UtilCore).getMeshOtherPoint(n,h);l.add(c.clone().sub(l.clone()).setLength(e.leftWindow[4])),h.add(d.clone().sub(h.clone()).setLength(e.rightWindow[4]));let u=l.clone().add(c.clone().sub(l.clone()).setLength(r)),p=h.clone().add(d.clone().sub(h.clone()).setLength(s));if(this.addLineDoorHelper(l,u,e.wallDep,"left",!e.isLock),this.addLineDoorHelper(p,h,e.wallDep,"right",!e.isLock),t){let e=new a.WallHelp;this.editor.pointHelperGroup.add(e.createDoorPoint(u,"left")),this.editor.pointHelperGroup.add(e.createDoorPoint(p,"right"))}}}addArcWindowHelper(e){let t=new a.WallHelp;this.addLineDoorHelper(e.arcCenter,e.wallStartPoint,e.wallDep,"start",!1,0),this.addLineDoorHelper(e.wallEndPoint,e.arcCenter,e.wallDep,"end",!1,0),this.addArcLineHelper(e);let i=(0,o.UtilCore).getClockWise(e.wallStartPoint,e.center,e.wallEndPoint),r="arcStart",n="arcEnd";i<0&&(r="arcEnd",n="arcStart"),this.editor.pointHelperGroup.add(t.createDoorPoint(e.wallStartPoint,r)),this.editor.pointHelperGroup.add(t.createDoorPoint(e.wallEndPoint,n))}addArcLineHelper(e){let t=new a.WallHelp,i=e.center.clone().sub(e.arcCenter.clone()).angle(),o=i-e.angle,s=i+e.angle,l=e.arcCenter.distanceTo(e.startPoint),h=t.createCircleAngleLine(e.arcCenter,l,o,s,!1);this.editor.doorHelperGroup.add(h);let c=this.editor.getScreenPosition(h.center.clone()),d=Math.round(180/Math.PI*(2*e.angle))+"\xb0",u=new(0,r.UIInput)(d).setClass("showDoorLength"+h.uuid).setFontSize("15px").setWidth("40px").setMarginTop(c.y+"px").setFocus().setMarginLeft(c.x+"px").onKeyDown((function(t){if("13"==t.keyCode){let t=document.getElementsByClassName("showDoorLength"+h.uuid)[0].value;t=t.replace(/°/g,""),this.editor.execute(new n.DrawCommand(this.editor,"door","end",[1*t,e,"arcAngle"]),"改变圆弧门角度尺寸")}}).bind(this)),p=h.center.x+"/"+h.center.y+"/"+h.center.z;return u.setAttribute("worldPosition",p),this.editor.uiPanelBox.add(u),h}}}),parcelRequire.register("eA4zA",function(e,t){$parcel$export(e.exports,"DrawCommand",()=>a);var i=parcelRequire("9HO6e"),r=parcelRequire("4xklQ"),n=parcelRequire("9QhXH"),o=parcelRequire("73HrS");class a{constructor(e,t="",i="",r=[],n=!0,o=""){this.editor=e,this.redrew=n,this.type=t,this.changeWall=i,this.doorWid=this.editor.config.doorWidth;let a=["doubledoor","slidingdoor","baywindow","frenchwindows","singleDoubleDoor"];this.toolType=this.editor.toolType,this.wallDepth=240,a.indexOf(this.editor.toolType)>=0&&(this.doorWid=2*this.editor.config.doorWidth),""!=t&&this.editor.currentDoor&&(this.doorWid=this.editor.currentDoor.doorWid),this.res=[],this.param=r,"straightWindow"==this.toolType&&(this.doorWid=1200),"straightBayWindow"==this.toolType&&(this.doorWid=3e3),("UWindow"==this.toolType||"UBayWindow"==this.toolType)&&(this.doorWid=2e3),this.LWidth=1200,this.RWidth=1200,this.leftWall="",this.rightWall="",this.centerWall="",this.arcWindowAngle=Math.PI/4,this.arcCenter=!1,this.extendClick=o,this.editor.copyDoor&&(this.doorWid=this.editor.copyDoor.doorWid)}drawMain(){this.editor.cleanWallHelper();let e=this.toolType;this.editor.blackbox&&this.editor.blackbox.removeDom(),this.editor.blackbox="",""!=this.type&&(e=this.editor.currentDoor.modelType),this.toolType=e;let t="outside";this.editor.copyDoor&&this.editor.copyDoor.doorDir&&(t=this.editor.copyDoor.doorDir);let o=this.editor.currentPoint.clone(),a="";if(""==this.changeWall)"LWindow"==e||"UWindow"==e?("LWindow"==e&&(a=this.getNearWallForLWindow(this.editor.currentPoint,2),this.leftWall=a[3],this.rightWall=a[4]),"UWindow"==e&&(a=this.getNearWallForUWindow(this.editor.currentPoint,2),this.leftWall=a[4],this.rightWall=a[5],this.centerWall=a[3]),this.editor.currentDoor.leftWindow&&(this.LWidth=this.editor.currentDoor.leftWindow[1],this.RWidth=this.editor.currentDoor.rightWindow[1]),this.editor.currentDoor.leftWindow&&0==a.length&&(this.leftWall=this.editor.currentDoor.leftWindow[0],this.rightWall=this.editor.currentDoor.rightWindow[0])):"arcWindow"==e?a=this.getNearWallForArcWindow(this.editor.currentPoint,2):(a=this.getNearWallByPoint(this.editor.currentPoint),this.editor.currentDoor&&"arcWindow"==this.editor.currentDoor.modelType&&(a=this.getNearWallForArcWindow(this.editor.currentPoint,2)),this.editor.currentDownSelect.length>0&&this.editor.currentDoor&&!this.editor.currentDownSelect[0].object.useType&&("LWindow"==this.editor.currentDoor.modelType&&(a=this.getNearWallForLWindow(this.editor.currentPoint,2)),"UWindow"==this.editor.currentDoor.modelType&&(a=this.getNearWallForUWindow(this.editor.currentPoint,2))));else{if(!this.editor.currentDoor.wallId)return;let t=this.editor.currentDoor.wallId;("LWindow"==e||"UWindow"==e)&&(t=this.editor.currentDoor.leftWindow[0].wallID,"right"==this.changeWall&&(t=this.editor.currentDoor.rightWindow[0].wallID)),a="arcWindow"==e?this.getNearWallForArcWindowForChange(this.editor.currentPoint,t):this.getNearWallByPointForChange(this.editor.currentPoint,t)}this.res=a;let s=new r.Vector2(1,0),l=new r.Vector2(2,0);if(1==a.length)return;let h=0,c="",d="";if(""!=this.type){if(!this.editor.currentDoor)return;if(h=this.editor.currentDoor.angle,c=this.editor.currentDoor.height,d=this.editor.currentDoor.floorHei,this.editor.currentDoor){let e=this.editor.currentDoor;this.editor.scene.remove(e),this.editor.otherMeshs.indexOf(e)>=0&&this.editor.otherMeshs.splice(this.editor.otherMeshs.indexOf(e),1)}}if(""!=this.editor.currenDraw&&(this.editor.scene.remove(this.editor.currenDraw),this.editor.otherMeshs.indexOf(this.editor.currenDraw)>=0&&this.editor.otherMeshs.splice(this.editor.otherMeshs.indexOf(this.editor.currenDraw),1)),this.editor.pointHelpGroup.children=[],a.length>=3){o=a[0],s=a[1],l=a[2],o=new r.Vector3(o.x,o.y,0),this.wallDepth=1*a[3].thickness;let t=(0,i.UtilCore).getMinEdge(a[3]);t<=this.doorWid&&(this.doorWid=t),h=new(0,r.Vector2)(l.x,l.y).sub(new r.Vector2(s.x,s.y)).angle();let n=(0,i.UtilCore).createCenterLine(a[3].startPoint,a[3].endPoint);if(this.editor.pointHelpGroup.add(n),a[3].arcCenter&&(this.arcCenter=a[3].arcCenter.clone()),"arcWindow"==e&&this.editor.currentDoor){let e=this.editor.currentDoor;this.arcCenter=e.arcCenter,this.wallDepth=e.wallDep,this.arcWindowAngle=e.angle}}else h=0;if(""!=this.changeWall){let n=this.editor.currentDoor;this.editor.scene.remove(n),this.editor.otherMeshs.indexOf(n)>=0&&this.editor.otherMeshs.splice(this.editor.otherMeshs.indexOf(n),1);let s="start"==this.changeWall?n.endPoint:n.startPoint,l=new r.Vector3((s.x+o.x)/2,(s.y+o.y)/2,0);if(this.doorWid=1*s.clone().distanceTo(o.clone()),o=l,("LWindow"==e||"UWindow"==e)&&a.length>0){let t=new r.Vector3(n.center.x,n.center.y,0),s=1*t.clone().distanceTo(new r.Vector3(a[0].x,a[0].y,0));if(this.leftWall=n.leftWindow[0],this.rightWall=n.rightWindow[0],this.LWidth=n.leftWindow[1],this.RWidth=n.rightWindow[1],o=t,"UWindow"==e){this.centerWall=this.editor.getWallByWallId(n.wallId);let e="";if(e="left"==this.changeWall?(0,i.UtilCore).getSamePointTwoWall(this.leftWall,this.centerWall):(0,i.UtilCore).getSamePointTwoWall(this.rightWall,this.centerWall)){s=1*e.clone().distanceTo(new r.Vector3(a[0].x,a[0].y,0));let t=this.centerWall.startPoint,i=this.centerWall.endPoint;o=new r.Vector3((t.x+i.x)/2,(t.y+i.y)/2,0)}}"left"==this.changeWall?this.LWidth=s:this.RWidth=s}if("arcWindow"==e){this.arcCenter=n.arcCenter,this.wallDepth=n.wallDep;let e=this.arcCenter.clone().distanceTo(n.center.clone()),t=0==a.length?n.endPoint.clone():a[0].clone(),s=n.startPoint.clone();"arcStart"==this.changeWall&&(s=n.endPoint.clone());let l=new r.Vector2((t.x+s.x)/2,(t.y+s.y)/2);o=this.arcCenter.clone().add(l.clone().sub(this.arcCenter.clone()).setLength(e)),this.arcWindowAngle=(0,i.UtilCore).toVector3(o.clone().sub(this.arcCenter.clone())).angleTo((0,i.UtilCore).toVector3(s.clone().sub(this.arcCenter.clone())))}""!=n.doorDir&&(t=n.doorDir)}if(this.editor.doorHelperGroupClean(),s=new r.Vector3(s.x,s.y,0),l=new r.Vector3(l.x,l.y,0),0!=this.param.length){let n=this.editor.currentDoor,a=this.editor.currentDoor.center;if(this.doorWid=1*this.editor.currentDoor.doorWid,"width"==this.param[2]&&(this.doorWid=1*this.param[0],o=a),"depth"==this.param[2]&&(this.wallDepth=1*this.param[0],o=a,("LWindow"==n.modelType||"UWindow"==n.modelType)&&(this.LWidth=n.leftWindow[1],this.RWidth=n.rightWindow[1],this.leftWall=this.editor.getWallByWallId(n.leftWindow[0].wallID),this.rightWall=this.editor.getWallByWallId(n.rightWindow[0].wallID),"UWindow"==n.modelType&&(this.centerWall=this.editor.getWallByWallId(n.wallId)))),"start"==this.param[2]){let e=n.endPoint.clone().sub(n.startPoint.clone()).setLength(this.param[1]);o=a.add(e)}if("end"==this.param[2]){let e=n.startPoint.clone().sub(n.endPoint.clone()).setLength(this.param[1]);o=a.add(e)}if("angle"==this.param[2]){h=n.angle;let i=["outside","leftSide","rightSide","inside"],r=i.indexOf(t);r==i.length-1&&(r=-1),t=i[r+1],o=a,(e.indexOf("Window")>=0||e.indexOf("window")>=0)&&(h+=Math.PI)}if("left"==this.param[2]||"right"==this.param[2]){let t=1*this.param[0];this.leftWall=n.leftWindow[0],this.rightWall=n.rightWindow[0],this.LWidth=n.leftWindow[1],this.RWidth=n.rightWindow[1],"UWindow"==e&&(this.centerWall=this.editor.getWallByWallId(n.wallId)),"left"==this.param[2]?this.LWidth=t:this.RWidth=t}if("center"==this.param[2]){if(o=this.param[1][0],h=this.param[0].angle,this.doorWid=this.param[0].doorWid,this.wallDepth=this.param[0].wallDep,s=this.param[1][1],l=this.param[1][2],"LWindow"==this.param[0].modelType||"UWindow"==this.param[0].modelType){let e=this.param[0];if(this.leftWall=this.editor.getWallByWallId(e.leftWindow[0].wallID),this.rightWall=this.editor.getWallByWallId(e.rightWindow[0].wallID),this.LWidth=e.leftWindow[1],this.RWidth=e.rightWindow[1],o=(0,i.UtilCore).getSamePointTwoWall(this.leftWall,this.rightWall),"UWindow"==this.param[0].modelType){this.centerWall=this.editor.getWallByWallId(e.wallId);let t=this.centerWall.startPoint,i=this.centerWall.endPoint;o=new r.Vector3((t.x+i.x)/2,(t.y+i.y)/2,0)}}if("arcWindow"==this.param[0].modelType){let e=this.param[0];this.arcCenter=this.param[1][3].clone(),this.wallDepth=e.wallDep,this.arcWindowAngle=e.angle}}if("wall"==this.param[2]){let e=this.param[1][1];if(o=this.param[1][0],s=e.startPoint,l=e.endPoint,o=new r.Vector3(o.x,o.y,0),this.wallDepth=1*e.thickness,h=new(0,r.Vector2)(l.x,l.y,0).sub(new r.Vector2(s.x,s.y,0)).angle(),"LWindow"==this.param[0].modelType){let e=this.param[0];this.leftWall=this.editor.getWallByWallId(e.leftWindow[0].wallID),this.rightWall=this.editor.getWallByWallId(e.rightWindow[0].wallID),this.LWidth=e.leftWindow[1],this.RWidth=e.rightWindow[1],o=(0,i.UtilCore).getSamePointTwoWall(this.leftWall,this.rightWall)}if("arcWindow"==this.param[0].modelType){let e=this.param[0],t=this.param[1][2];this.arcCenter=t.arcCenter,this.wallDepth=t.wallDep,this.arcWindowAngle=e.angle;let i=e.center.clone().sub(e.arcCenter.clone()),r=t.cp.distanceTo(t.arcCenter);o=t.arcCenter.clone().add(i.setLength(r))}}if("arcAngle"==this.param[2]){let e=this.param[1];this.arcCenter=e.arcCenter,this.wallDepth=e.wallDep,this.arcWindowAngle=Math.PI/180*(this.param[0]/2),o=e.center}}if("doubledoor"==e)this.editor.currenDraw=(0,n.DM).createDODoor(o,this.doorWid,h,this.wallDepth,s,l,t);else if("door"==e)this.editor.currenDraw=(0,n.DM).createBaseDoor(o,this.doorWid,t,h,this.wallDepth,s,l);else if("slidingdoor"==e)this.editor.currenDraw=(0,n.DM).createSlidingDoor(o,this.doorWid,h,this.wallDepth,s,l,t);else if("window"==e)this.editor.currenDraw=(0,n.DM).createBaseWindow(o,this.doorWid,h,this.wallDepth,s,l);else if("baywindow"==e){let e=this.wallDepth;e>=500&&(e=this.wallDepth-500),this.editor.currenDraw=(0,n.DM).createPanoramicWindow(o,this.doorWid,h,e,s,l)}else if("frenchwindows"==e)this.editor.currenDraw=(0,n.DM).createFrenchWindow(o,this.doorWid,h,this.wallDepth,s,l);else if("singledoor"==e)this.editor.currenDraw=(0,n.DM).createBaseDoor(o,this.doorWid,t,h,this.wallDepth,s,l);else if("singleDoubleDoor"==e)this.editor.currenDraw=(0,n.DM).createDODoor(o,this.doorWid,h,this.wallDepth,s,l,t);else if("childMotherDoor"==e)this.editor.currenDraw=(0,n.DM).createLashDoor(o,this.doorWid,h,this.wallDepth,s,l,t);else if("moveDoor"==e)this.editor.currenDraw=(0,n.DM).createSlidingDoor(o,this.doorWid,h,this.wallDepth,s,l,t);else if("pass"==e||"passDoor"==e)this.editor.currenDraw=(0,n.DM).createPass(o,this.doorWid,h,this.wallDepth,s,l,t);else if("straightWindow"==e)this.editor.currenDraw=(0,n.DM).createBaseWindow(o,this.doorWid,h,this.wallDepth,s,l);else if("straightBayWindow"==e){let e=this.wallDepth;e>=500&&(e=this.wallDepth-500),this.editor.currenDraw=(0,n.DM).createPanoramicWindow(o,this.doorWid,h,e,s,l)}else"LWindow"==e?this.editor.currenDraw=(0,n.DM).createLWindowNew(o,this.leftWall,this.rightWall,this.LWidth,this.RWidth):"LBayWindow"==e||("UWindow"==e?this.editor.currenDraw=(0,n.DM).createUWindow(o,this.leftWall,this.centerWall,this.rightWall,this.LWidth,this.RWidth):"UBayWindow"==e||("dooropen"==e?this.editor.currenDraw=(0,n.DM).createDoorHole(o,this.doorWid,h,this.wallDepth,s,l):"archDoor"==e?this.editor.currenDraw=(0,n.DM).createSectorDoor(o,this.doorWid,h,this.wallDepth,s,l):"archWindow"==e?(this.doorWid==this.editor.config.doorWidth&&(this.doorWid+=583),this.editor.currenDraw=(0,n.DM).createSectorWindow(o,this.doorWid,h,this.wallDepth,s,l)):"arcDoor"==e||"arcWindow"==e&&(this.editor.currenDraw=(0,n.DM).createArcBaseWindow(o,this.arcCenter,this.wallDepth,this.arcWindowAngle))));""!=this.editor.currenDraw&&(""!=c&&(this.editor.currenDraw.height=c),""!=d&&(this.editor.currenDraw.floorHei=d),this.editor.scene.add(this.editor.currenDraw),a.length>=3&&"free"!=e&&(this.editor.currenDraw.wallId=a[3].wallID),0!=this.param.length&&"center"==this.param[2]&&(this.editor.currenDraw.wallId=this.param[0].wallId),"UWindow"==e&&this.centerWall&&(this.editor.currenDraw.wallId=this.centerWall.wallID),this.editor.addLineHelperForDoor(this.editor.currenDraw),0!=this.param.length&&(this.editor.currentDoor=this.editor.currenDraw,"number"!=typeof this.param[0]&&(this.editor.currentDoor.isLock=this.param[0].isLock),this.editor.clickSelect.length>0&&(this.editor.clickSelect[0].object.parent=this.editor.currenDraw)),this.editor.copyDoor&&(this.editor.currenDraw.height=this.editor.copyDoor.height,this.editor.currenDraw.floorHei=this.editor.copyDoor.floorHei))}execute(){if(this.drawMain(),0==this.res.length&&""!=this.editor.currenDraw&&!this.editor.currentDoor){this.editor.scene.remove(this.editor.currenDraw);return}0==this.res.length&&""!=this.editor.currenDraw&&this.editor.currentDoor&&(this.editor.scene.remove(this.editor.currenDraw),this.editor.currentPoint=this.editor.currentDoor.center.clone(),new a(this.editor,"door").drawMain(),this.editor.currenDraw.wallId=this.editor.currentDoor.wallId,this.editor.clickSelect.length>0&&(this.editor.clickSelect[0].object.parent=this.editor.currenDraw),this.editor.currentDownSelect.length>0&&(this.editor.currentDownSelect[0].object.parent=this.editor.currenDraw),this.editor.currentDoor=this.editor.currenDraw),this.editor.doorHelperGroupClean(),this.editor.pointHelpGroup.children=[],""!=this.editor.currenDraw&&this.editor.otherMeshs.push(this.editor.currenDraw),""!=this.extendClick&&(this.editor.clickSelect[0].object.parent=this.editor.currenDraw),this.editor.currentDoor=this.editor.currenDraw,this.redrew&&new(0,o.WallCore)(this.editor).wallToJson(),this.editor.cleanWallHelper(),(""!=this.type||""!=this.changeWall||this.editor.currentDoor)&&this.editor.addLineHelperForDoor(this.editor.currenDraw,!0);let e=this.editor.currenDraw.modelType,t=this.param.length>0&&"noUpdate"==this.param[3];if(e&&!t){let t=this.editor.config.modelTypeJson[e],i=this.editor.currenDraw,r=this.editor.getWallByWallId(i.wallId),n=Math.abs(Math.round(i.doorWid*i.scale.x));e.includes("Door")||e.includes("door")?this.editor.list.showDialog.dispatch(2,t,[],[n,i.height,Math.round(i.wallDep),i.floorHei,r.height,{isLock:i.isLock}]):(e.includes("Window")||e.includes("window"))&&this.editor.list.showDialog.dispatch(1,t,[],[n,i.height,Math.round(i.wallDep),i.floorHei,r.height,{isLock:i.isLock}])}this.editor.currenDraw=""}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}getNearWallForArcWindowForChange(e,t){let r=[];return e=(0,i.UtilCore).toVector2(e),this.editor.allWalls.forEach(n=>{if(n.wallID!=t)return;let o=(0,i.UtilCore).toVector2(n.arcCenter),a=(0,i.UtilCore).toVector2(n.startPoint),s=(0,i.UtilCore).toVector2(n.endPoint),l=o.distanceTo(a),h=o.clone().add(e.clone().sub(o.clone()).setLength(l)),c=e.distanceTo(o)-l,d=(0,i.UtilCore).getClockWise(a,n.cp,s),u=(0,i.UtilCore).getClockWise(a,h,s);this.editor.config.drawDoorArea>=Math.abs(c)&&d*u>0&&(r=[h,n.startPoint,n.endPoint,n])}),r}getNearWallForArcWindow(e){let t=[];e=(0,i.UtilCore).toVector2(e);let r="";if(this.editor.allWalls.forEach(n=>{if("circle"==n.isArc){let r=(0,i.UtilCore).toVector2(n.arcCenter),o=(0,i.UtilCore).toVector2(n.startPoint),a=(0,i.UtilCore).toVector2(n.endPoint),s=r.distanceTo(o),l=r.clone().add(e.clone().sub(r.clone()).setLength(s)),h=e.distanceTo(r)-s,c=(0,i.UtilCore).getClockWise(o,n.cp,a),d=(0,i.UtilCore).getClockWise(o,l,a);this.editor.config.drawDoorArea>=Math.abs(h)&&c*d>0&&(t=[l,n.startPoint,n.endPoint,n])}else{let t=(0,i.UtilCore).handleLineData(n.startPoint,n.endPoint),o=(0,i.UtilCore).smallDistanceByPointOnLine(t,e.clone());if(!(0,i.UtilCore).pointIsInLine(o,n.startPoint,n.endPoint))return;let a=o.clone().distanceTo(e.clone());this.editor.config.drawDoorArea>=a&&(r=n)}}),r){let e=this.editor.getScreenPosition(this.editor.currentPoint.clone());this.editor.list.blackBox.dispatch(e.x,e.y,"弧形窗只支持在弧形墙上面放置")}return t}getNearWallByPoint(e){let t=[],r="",n="";return this.editor.allWalls.forEach(o=>{let a=(0,i.UtilCore).handleLineData(o.startPoint,o.endPoint),s=(0,i.UtilCore).smallDistanceByPointOnLine(a,e.clone()),l=s.clone().distanceTo(e.clone());if(this.editor.config.drawDoorArea>=l){if(""!=r&&l>=r)return;let e=(0,i.UtilCore).getNewPoint(o),a=(0,i.UtilCore).getNewPoint(o,"end"),h=Math.round(s.clone().distanceTo(e.clone())),c=Math.round(s.clone().distanceTo(a.clone())),d=o.endPoint.clone().sub(o.startPoint.clone()),u=(0,i.UtilCore).getMinEdge(o);if(u>=this.doorWid&&(u=this.doorWid),(0,i.UtilCore).pointIsInLine(s,o.startPoint,o.endPoint)){n=!0;let i=30;if(h-u/2<30){t=[s=e.clone().add(d.clone().setLength(u/2)),o.startPoint,o.endPoint,o];return}if(c-u/2<i){t=[s=a.clone().add(d.clone().negate().setLength(u/2)),o.startPoint,o.endPoint,o];return}if(h<=u/2||c<=u/2){t=["notAllowMove1"];return}}else{if(n)return;if(h<=this.editor.config.drawDoorArea){t=[s=e.clone().add(d.clone().setLength(u/2)),o.startPoint,o.endPoint,o];return}if(c<=this.editor.config.drawDoorArea){t=[s=a.clone().add(d.clone().negate().setLength(u/2)),o.startPoint,o.endPoint,o];return}if(h>this.editor.config.drawDoorArea&&c>this.editor.config.drawDoorArea)return;if(h<=u/2||c<=u/2){t=["notAllowMove"];return}}0==t.length&&(t=[s,o.startPoint,o.endPoint,o]);return}}),t}getNearWallByPointForChange(e,t){let r=[];return this.editor.allWalls.forEach(n=>{if(n.wallID!=t)return;let o=(0,i.UtilCore).handleLineData(n.startPoint,n.endPoint),a=(0,i.UtilCore).smallDistanceByPointOnLine(o,e.clone());r=(0,i.UtilCore).pointIsInLine(a,n.startPoint,n.endPoint)?[a,n.startPoint,n.endPoint,n]:a.clone().distanceTo(n.startPoint.clone())<a.clone().distanceTo(n.endPoint.clone())?[n.startPoint,n.startPoint,n.endPoint,n]:[n.endPoint,n.startPoint,n.endPoint,n]}),r}getNearWallByPointForLWindow(e){let t=this.editor.currentDoor.leftWindow[0].wallID;"right"==this.changeWall&&(t=this.editor.currentDoor.rightWindow[0].wallID);let r=[];return this.editor.allWalls.forEach(n=>{if(n.wallID!=t)return;let o=(0,i.UtilCore).handleLineData(n.startPoint,n.endPoint),a=(0,i.UtilCore).smallDistanceByPointOnLine(o,e.clone());r=(0,i.UtilCore).pointIsInLine(a,n.startPoint,n.endPoint)?[a,n.startPoint,n.endPoint,n]:a.clone().distanceTo(n.startPoint.clone())<a.clone().distanceTo(n.endPoint.clone())?[n.startPoint,n.startPoint,n.endPoint,n]:[n.endPoint,n.startPoint,n.endPoint,n]}),r}getNearWallForLWindow(e,t){let n=[];return this.editor.allWalls.forEach(o=>{let a=o.startPoint,s=o.endPoint,l="";if((0,i.UtilCore).toVector3(a).distanceTo(e)<=this.editor.config.drawDoorArea&&(l=a),(0,i.UtilCore).toVector3(s).distanceTo(e)<=this.editor.config.drawDoorArea&&(l=s),""==l)return;let h=(0,i.UtilCore).havePointWall(l,this.editor.allWalls);if(h.length!=t||1!=o.roomCenter.length)return;let c=o.roomCenter[0];(c=new r.Vector3(c[0],c[1],0)).clone().sub(l.clone()).setLength(1e5);let d=(0,i.UtilCore).getMeshOtherPoint(h[0],l),u=(0,i.UtilCore).getMeshOtherPoint(h[1],l);d.clone().sub(l.clone()).setLength(100),u.clone().sub(l.clone()).setLength(100);let p=(0,i.UtilCore).getClockWise(d,l,u);p<0&&(n=[l,h[0].startPoint,h[0].endPoint,h[0],h[1],o.roomCenter]),p>0&&(n=[l,h[1].startPoint,h[1].endPoint,h[1],h[0],o.roomCenter])}),n}getNearWallForUWindow(e){let t=[];return this.editor.allWalls.forEach(n=>{let o=(0,i.UtilCore).handleLineData(n.startPoint,n.endPoint),a=(0,i.UtilCore).smallDistanceByPointOnLine(o,e.clone()),s=a.clone().distanceTo(e.clone()),l=(0,i.UtilCore).pointIsInLine(a,n.startPoint,n.endPoint);if(this.editor.config.drawDoorArea>=s&&l){let e=n.startPoint,o=n.endPoint,s=(0,i.UtilCore).havePointWall(e,this.editor.allWalls),l=(0,i.UtilCore).havePointWall(o,this.editor.allWalls);if(2!=s.length||2!=l.length||1!=n.roomCenter.length)return;let h="";s.forEach(e=>{e.wallID!=n.wallID&&(h=e)});let c="";l.forEach(e=>{e.wallID!=n.wallID&&(c=e)});let d=(0,i.UtilCore).getMeshOtherPoint(h,e),u=(0,i.UtilCore).getMeshOtherPoint(c,o),p=(0,i.UtilCore).handleLineData(e,o),m=!1;if("X"==p[0])(d.y>p[2]&&u.y>p[2]||d.y<p[2]&&u.y<p[2])&&(m=!0);else if("Y"==p[0])(d.x>p[2]&&u.x>p[2]||d.x<p[2]&&u.x<p[2])&&(m=!0);else{let e=p[1],t=p[2];(d.y-e*d.x-t)*(u.y-e*u.x-t)>0&&(m=!0)}if(!m)return;let f=o.clone().sub(e.clone()),g=d.clone().sub(e.clone()),y=u.clone().sub(o.clone());if(!(0==f.dot(g)&&0==f.dot(y)))return;let x=n.roomCenter[0];x=new r.Vector3(x[0],x[1],0);let w=new r.Vector3((e.x+o.x)/2,(e.y+o.y)/2,0),b=x.clone().sub(w.clone()).setLength(1e5),v=d.clone().sub(a.clone()).setLength(100),M=u.clone().sub(a.clone()).setLength(100),S=(0,i.UtilCore).getClockWise(v,b,M);S<0&&(t=[w,e,o,n,c,h,n.roomCenter]),S>0&&(t=[w,e,o,n,h,c,n.roomCenter])}}),t}}}),parcelRequire.register("i1BGa",function(e,t){$parcel$export(e.exports,"MemberHelper",()=>i);class i{constructor(e){this.editor=e}addMemberHelper(e){let t="";e.children.forEach(e=>{if("Mesh"==e.type){t=e;return}}),e.modelType&&e.modelType.indexOf("Model")>=0&&(t=e);let i=this.editor.wallHelp.addScaleTool(t),r=e.rotation.z-Math.PI/2,n=this.editor.wallHelp.addAngleTool(t,1500,r-Math.PI/8,r+Math.PI/8);return this.editor.addPositionHelper(e,!0),[i,n]}}}),parcelRequire.register("1o48A",function(e,t){$parcel$export(e.exports,"Model3DHelper",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("FwZIR");class n{constructor(e){this.editor=e,this.boxColor=this.editor.config.boxColor}selectObj(e){if(this.editor.modelHelperGroup.children=[],this.editor.doorHelperGroupClean(),e.length>1){let t=!1;e.forEach(e=>{let i=this.editor.getOuterParent(e),r=this.editor.wallHelp.addOBBbox(i,this.editor.config.boxColor);r.name="modelBox",r.layers.set(2),this.editor.modelHelperGroup.add(r),t=i.isLock,this.editor.addBoxFor2dGroup(i.param[0])});let i=this.editor.get3DModelDialogPosition(this.editor.getOuterParent(e[e.length-1]));this.editor.list.modelGroup3D.dispatch(9,"3D多选模型",i,[{isLock:t}])}else{let t=e[0],r=this.editor.getOuterParent(t);if(""==r&&"Mesh"!=t.type||"3DWall"==t.modelType||"3dwall"==r.parent.name||"Line2"==r.type)return;let n=this.editor.get3DModelDialogPosition(r),o=this.editor.getRealSize(r),a=Math.round(1e3*o[0].toFixed(3)),s=Math.round(1e3*o[1].toFixed(3)),l=Math.round(1e3*o[2].toFixed(3)),h=1e3*Math.round(r.width).toFixed(3),c=1e3*Math.round(r.height).toFixed(3),d=1e3*Math.round(r.depth).toFixed(3),u=new i.Vector3(0,r.position.y,0);r.parent.localToWorld(u);let p=Math.round(1e3*(u.y-o[1]/2).toFixed(3)),m=0;if("top"==r.modelPosition){let e=window.storeyHei;this.editor.wallGroup3D.roomHeight,(m=Math.round(1e3*(e/1e3-r.height).toFixed(3)))<10&&(m=0)}p<10&&(p=0);let f=360-Math.abs(parseInt(180/Math.PI*r.rotation.x)),g=parseInt(180/Math.PI*r.rotation.y),y=360-Math.abs(parseInt(180/Math.PI*r.rotation.z));360==f&&(f=0),360==g&&(g=0),360==y&&(y=0);let x={isLock:r.isLock,width:a,height:s,depth:l,oldWidth:h,oldHeight:c,oldDepth:d,floorHei:p,rotation:[f,y,g],oldFloorHei:m};"modelGroup"==r.modelType?(r.children.slice(0).forEach(e=>{let t=this.editor.wallHelp.addOBBbox(e,this.editor.config.boxColor);t.name="modelBox",t.layers.set(2),this.editor.modelHelperGroup.add(t);let i=this.editor.wallHelp.addOBB2DBox(t,this.editor.config.boxColor);this.editor.modelHelperGroup.add(i)}),this.editor.camera.isOrthographicCamera?this.editor.list.showDialog.dispatch(14,"组合模型",n,[x]):this.editor.list.showDialog.dispatch(10,"组合模型",n,[x])):this.editor.camera.isOrthographicCamera?this.editor.list.showDialog.dispatch(8,"单品模型",n,[x]):this.editor.list.showDialog.dispatch(11,"单品模型",n,[x]),this.main(r)}}main(e){if(e.isLock){let t=this.editor.wallHelp.addOBBbox(e,this.editor.config.boxColor);if(t.name="modelBox",t.layers.set(2),this.editor.modelHelperGroup.add(t),this.editor.transform3DTool&&"ThreeDimensionMoveHelper"!=this.editor.transform3DTool.name){let e=this.editor.transform3DTool;this.editor.dom.removeEventListener("pointermove",e.pointerMoveHandler),this.editor.dom.removeEventListener("pointerdown",e.pointerDownHandler),this.editor.dom.removeEventListener("pointerup",e.pointerUpHandler),this.editor.dom.removeEventListener("dragstart",e.dragstartHandler),this.editor.dom.removeEventListener("dragend",e.dragendHandler),this.editor.transform3DTool.detach()}this.editor.addPositionHelper(e.param[0],!0),this.editor.addBoxFor2dGroup(e.param[0]);return}this.editor.addLineHelperForMember(e.param[0]),this.editor.camera.isOrthographicCamera?this.editor.transform3DTool=new r.Manipulator3D(this.editor.scene,this.editor.miniMapCamera,this.editor,this.editor.newRenderer):this.editor.transform3DTool=new r.Manipulator3D(this.editor.scene,this.editor.camera,this.editor,this.editor.renderer),this.editor.transform3DTool.setActive(!0),this.editor.transform3DTool.attach(e),this.editor.transform3DTool.useRotate(!0).useScale(!1).useTranslate(!0)}}}),parcelRequire.register("FwZIR",function(e,t){$parcel$export(e.exports,"Manipulator3D",()=>s);var i=parcelRequire("4xklQ"),r=parcelRequire("hnYik"),n=parcelRequire("bTXeb"),o=parcelRequire("kiVmp"),a=parcelRequire("9HBIH");class s{mesh=null;data=null;attachedObject=null;_camera=null;_renderer=null;_caster=new i.Raycaster;_ray=new r.Ray;_scaleStep=.1;_rotateStep=10*Math.PI/180;_intersectOffset=[0,0,0];_initDragPosition=[0,0,0];_initDragQuaternion=[0,0,0,1];_initDragScale=[0,0,0];_3jsVec=new i.Vector3;_3jsQuat=new i.Quaternion;constructor(e,t,i,r=null,a=!1){this.data=new n.ManipulatorData,this._camera=t,this.editor=i,a||(this.mesh=new o.ManipulatorMesh(this.data),this.mesh.layers.set(2),this.mesh.name="modelAxisHelper",this.editor.modelHelperGroup.add(this.mesh)),this.clickEventHandler=this.clickEvent.bind(this),this.pointerMoveHandler=this.pointermove.bind(this),this.pointerDownHandler=this.pointerdown.bind(this),this.pointerUpHandler=this.pointerup.bind(this),this.dragstartHandler=this.dragstart.bind(this),this.dragendHandler=this.dragend.bind(this),this.boxColor=this.editor.config.boxColor,this.data.onDragStart=()=>this._onDragStart(),this.data.onDragEnd=()=>this._onDragEnd(),this.data.onTranslate=e=>this._onTranslate(e),this.data.onRotate=(e,t)=>this._onRotate(e,t),this.data.onScale=(e,t)=>this._onScale(e,t),this.stopClick=!1,r&&this.setRenderer(r),this.update(!0)}clickEvent(e){this.stopClick&&(e.stopImmediatePropagation(),this.stopClick=!1)}pointermove(e){if(!this.editor.camera.isOrthographicCamera){if(this.update(),this._updateRaycaster(e),this.data.isDragging){if(this.data.onRayMove(this._ray),this.editor.dom.setPointerCapture(e.pointerId),e.preventDefault(),e.stopPropagation(),2==this.data.activeMode){let e=this.attachedObject,t=e.modelPosition;e.updateMatrixWorld(!0,!0);let r=this.editor.getRealSize(e);e.updateMatrixWorld(!0,!0);let n=new(0,i.Vector3)().setFromMatrixScale(e.matrixWorld).clone().divide(e.scale),o=(r[1]-e.oldFloor)/2/n.y;"top"==t?e.position.y-=o:e.position.y+=o,this.attachedObject.oldFloor=r[1]}if(this.editor.synchroModel(this.attachedObject),this.editor.clickDepthMsg.uuid){this.editor.modelDotGroup.children=[];let e=this.editor.getOuterParent(this.attachedObject,this.attachedObject,"outer");this.editor.addDashBoxForGroup(e),this.editor.addDashBoxFor2dGroup(e.param[0])}this.editor.modelHelperGroup.children.slice(0).forEach(e=>{"modelBox"==e.name&&this.editor.modelHelperGroup.remove(e)}),this.editor.addBoxForGroup(this.attachedObject),this.editor.doorHelperGroupClean(),this.editor.addLineHelperForMember(this.attachedObject.param[0]),this.editor.updateModelProto(this.attachedObject)}else this.data.onRayHover(this._ray)}}pointerdown(e){if(this.editor.downPoint=this.editor.getWorldPosition(e),this._updateRaycaster(e),this.data.onRayDown(this._ray)){this.startPoint=[e.offsetX,e.offsetY],this.startJson=this.editor.getSceneAllJson(),e.preventDefault(),e.stopPropagation(),this.stopClick=!0,this.attachedObject.updateMatrixWorld(!0,!0);let t=this.editor.getRealSize(this.attachedObject);this.attachedObject.oldFloor=t[1]}}pointerup(e){if(this.editor.currentPoint=this.editor.getWorldPosition(e),this.data.isDragging){if("CodeModel"==this.attachedObject.modelType&&this.attachedObject.parent){let e=this.editor.getWallByMesh(this.attachedObject);this.editor.partRefreshWall(e,this.attachedObject)}e.offsetX==this.startPoint[0]&&e.offsetY==this.startPoint[1]||this.editor.execute("","",this.startJson),this.data.stopDrag(),this.editor.dom.releasePointerCapture(e.pointerId)}this.attachedObject.oldFloor&&delete this.attachedObject.oldFloor}dragstart(e){""!=this.editor.globalControl&&(this.editor.globalControl.enabled=!1)}dragend(e){""!=this.editor.globalControl&&(this.editor.globalControl.enabled=!0)}setRenderer(e){let t=this.editor.dom;if(this._renderer=e,this.editor.transform3DTool){let e=this.editor.transform3DTool;t.removeEventListener("pointermove",e.pointerMoveHandler),t.removeEventListener("pointerdown",e.pointerDownHandler),t.removeEventListener("pointerup",e.pointerUpHandler),t.removeEventListener("dragstart",e.dragstartHandler),t.removeEventListener("dragend",e.dragendHandler)}this.editor.camera.isOrthographicCamera||(t.addEventListener("click",this.clickEventHandler),t.addEventListener("pointermove",this.pointerMoveHandler),t.addEventListener("pointerdown",this.pointerDownHandler),t.addEventListener("pointerup",this.pointerUpHandler),t.addEventListener("dragstart",this.dragstartHandler),t.addEventListener("dragend",this.dragendHandler))}rayHover(e){return this.update(),this._ray.fromCaster(e),this.data.onRayHover(this._ray)}rayMove(e){return this.update(),this._ray.fromCaster(e),this.data.onRayMove(this._ray)}rayDown(e){return this._ray.fromCaster(e),this.data.onRayDown(this._ray)}rayUp(){this.data.isDragging&&this.data.stopDrag()}isDragging(){return this.data.isDragging}isActive(){return this.data.isActive}setActive(e){return this.data.isActive=e,this.mesh&&(this.mesh.visible=e),e&&this.updateStateFromCamera(),this}useTranslate(e){return this.data.useTranslate=e,this.mesh.updateLook(this.data),this}useRotate(e){return this.data.useRotate=e,this.mesh.updateLook(this.data),this}useScale(e){return this.data.useScale=e,this.mesh.updateLook(this.data),this}setTraceLineStepDistance(e){return this.data.traceStep=e,this}setScaleStep(e){return this._scaleStep=e,this}setRotationStep(e){return this._rotateStep=e*Math.PI/180,this}setScaleFactor(e){return this.data.scaleFactor=e,this}attach(e){if(!this.data.isActive)return;this.attachedObject=e;var t=new i.Vector3;e.getWorldPosition(t),this.data.setPosition(t.toArray()),this.data.calcAxesPosition(),this.update(!0);let r=this.editor.wallHelp.addOBBbox(e,this.boxColor);r.name="modelBox",r.layers.set(2),this.editor.modelHelperGroup.add(r)}switchRot(e){return this.mesh.axisArcs.forEach(t=>{""!=t.name&&(t.visible=e)}),this}switchMove(e){return this.mesh.axisLines.forEach(t=>{t.visible=e}),this}detach(){this.attachedObject=null}update(e=!1){return(!!this.data.isActive||!!e)&&(this.updateStateFromCamera(e),(!!this.data.hasUpdated||!!this.data.hasHit)&&!!this.mesh&&(this.mesh.update(this.data),this.data.hasUpdated=!1,this.data.hasHit=!1,!0))}updateStateFromCamera(e=!1){this._camera.getWorldPosition(this._3jsVec),this._camera.getWorldQuaternion(this._3jsQuat),this.data.updateFromCamera(this._3jsVec.toArray(),this._3jsQuat.toArray(),e)}isDragging(){return this.data.isDragging}_screenToNDCCoord(e){let t=this.editor.dom,i=t.getBoundingClientRect(),r=e.clientX-i.x,n=e.clientY-i.y;return{x:r/i.width*2-1,y:-(2*(n/i.height))+1}}_updateRaycaster(e){this._caster.setFromCamera(this._screenToNDCCoord(e),this._camera),this._ray.fromCaster(this._caster)}_onDragStart(){(0,a.vec3_copy)(this._initDragPosition,this.attachedObject.position.toArray()),(0,a.vec3_copy)(this._initDragScale,this.attachedObject.scale.toArray()),(0,a.quat_copy)(this._initDragQuaternion,this.attachedObject.quaternion.toArray()),(0,a.vec3_sub)(this._intersectOffset,this.data.position,this.data.intersectPos),this.data.activeMode,n.ManipulatorMode.Translate,this.data.hasUpdated=!0,this._emit("dragstart")}_onDragEnd(){this.data.calcAxesPosition(),this.data.resetState(),this.mesh.showGizmo();let e=this.editor.getOuterParent(this.attachedObject,this.attachedObject,"outer");if(this.editor.refreshRealSizeByBox(e,this.attachedObject),this.editor.updateModelPosition(this.attachedObject.parent,e),this.editor.clickDepthMsg.uuid){this.editor.modelDotGroup.children=[];let e=this.editor.getOuterParent(this.attachedObject,this.attachedObject,"outer");this.editor.addDashBoxForGroup(e),this.editor.addDashBoxFor2dGroup(e.param[0])}this._emit("dragend")}_onTranslate(e){let t=(0,a.vec3_add)([0,0,0],e,this._intersectOffset);if(this.data.setPosition(t),this.attachedObject.parent){if("Scene"!=this.attachedObject.parent.type){this.attachedObject.parent.updateWorldMatrix(!0,!1);let e=new i.Vector3(t[0],t[1],t[2]),r=this.attachedObject.parent.worldToLocal(e);t=[r.x,r.y,r.z]}this.attachedObject.position.fromArray(t),this._emit("translate",t)}}_onRotate(e,t){if(!this.mesh.axisArcs[0].visible&&1!=t)return;let i=1===t?1:-Math.sign(this.data.scale[t]);2==t&&(e*=-1);let r=Math.round(180/Math.PI*e);r>0&&(r-=360*parseInt(r/360)),r<0&&(r+=360*Math.abs(parseInt(r/360))),r<0&&(r+=360);let n=8;r>=-8&&r<=n&&(r=0),r>=37&&r<=45+n&&(r=45),r>=82&&r<=90+n&&(r=90),r>=127&&r<=135+n&&(r=135),r>=172&&r<=180+n&&(r=180),r>=217&&r<=225+n&&(r=225),r>=262&&r<=270+n&&(r=270),r>=307&&r<=315+n&&(r=315),r>=352&&r<=360+n&&(r=360),e=Math.PI/180*r;let o=(0,a.quat_setAxisAngle)([0,0,0,1],this.data.axes[t].dir,this._rotateStep*e*i);(0,a.quat_mul)(o,o,this._initDragQuaternion),(0,a.quat_normalize)(o,o),0==t&&(this.attachedObject.rotation.x=e),1==t&&(this.attachedObject.rotation.y=e),2==t&&(this.attachedObject.rotation.z=e),this._emit("rotate",o)}_onScale(e,t){let i=this._initDragScale.slice(0),r=e*this._scaleStep;null===t?(i[0]+=r,i[1]+=r,i[2]+=r):i[t]+=r*Math.sign(this.data.scale[t]),this.attachedObject.scale.fromArray(i),this._emit("scale",i)}on(e,t){this.editor.dom.addEventListener(e,t)}_emit(e,t=null){this.editor.dom.dispatchEvent(new CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0,composed:!1}))}}}),parcelRequire.register("hnYik",function(e,t){$parcel$export(e.exports,"Ray",()=>r),$parcel$export(e.exports,"intersectSphere",()=>n),$parcel$export(e.exports,"intersectPlane",()=>o),$parcel$export(e.exports,"intersectTri",()=>a),$parcel$export(e.exports,"nearPoint",()=>s),$parcel$export(e.exports,"NearSegmentResult",()=>l),$parcel$export(e.exports,"nearSegment",()=>h);var i=parcelRequire("9HBIH");class r{posStart=[0,0,0];posEnd=[0,0,0];direction=[0,0,0];vecLength=[0,0,0];posAt(e,t){return(t=t||[0,0,0])[0]=this.vecLength[0]*e+this.posStart[0],t[1]=this.vecLength[1]*e+this.posStart[1],t[2]=this.vecLength[2]*e+this.posStart[2],t}directionAt(e,t){return(t=t||[0,0,0])[0]=this.direction[0]*e+this.posStart[0],t[1]=this.direction[1]*e+this.posStart[1],t[2]=this.direction[2]*e+this.posStart[2],t}fromCaster(e){(0,i.vec3_copy)(this.posStart,e.ray.origin.toArray()),(0,i.vec3_copy)(this.direction,e.ray.direction.toArray());let t=e.far==1/0?1e3:e.far;(0,i.vec3_scale)(this.vecLength,this.direction,t),(0,i.vec3_add)(this.posEnd,this.posStart,this.vecLength)}}function n(e,t,r){let n=r*r,o=(0,i.vec3_sub)([0,0,0],t,e.posStart),a=(0,i.vec3_dot)(o,e.direction),s=(0,i.vec3_sqrLen)(o)-a*a;return!(s>n)}function o(e,t,r){let n=(0,i.vec3_dot)(e.vecLength,r);if(n<=1e-6&&n>=-.000001)return null;let o=(0,i.vec3_dot)((0,i.vec3_sub)([0,0,0],t,e.posStart),r)/n;return o>=0?o:null}function a(e,t,r,n,o,a=!0){let s=(0,i.vec3_sub)([0,0,0],r,t),l=(0,i.vec3_sub)([0,0,0],n,t),h=(0,i.vec3_cross)([0,0,0],e.direction,l),c=(0,i.vec3_dot)(s,h);if(a&&c<1e-6)return!1;let d=1/c,u=(0,i.vec3_sub)([0,0,0],e.posStart,t),p=(0,i.vec3_dot)(u,h)*d;if(p<0||p>1)return!1;let m=(0,i.vec3_cross)([0,0,0],u,s),f=(0,i.vec3_dot)(e.direction,m)*d;if(f<0||p+f>1)return!1;if(o){let t=(0,i.vec3_dot)(l,m)*d;e.directionAt(t,o)}return!0}function s(e,t,r=.1){let n=(0,i.vec3_sub)([0,0,0],t,e.posStart);(0,i.vec3_mul)(n,n,e.vecLength);let o=(n[0]+n[1]+n[2])/(0,i.vec3_sqrLen)(e.vecLength);if(o<0||o>1)return null;let a=(0,i.vec3_sqrLen)(e.posAt(o,n),t);return a<=r*r?o:null}class l{segPosition=[0,0,0];rayPosition=[0,0,0];distanceSq=0;distance=0}function h(e,t,r,n=null){let o=(0,i.vec3_sub)([0,0,0],r,t),a=e.vecLength,s=(0,i.vec3_sub)([0,0,0],t,e.posStart),l=(0,i.vec3_dot)(o,o),h=(0,i.vec3_dot)(o,a),c=(0,i.vec3_dot)(a,a),d=(0,i.vec3_dot)(o,s),u=(0,i.vec3_dot)(a,s),p=l*c-h*h,m=0,f=0;return p<1e-6?(m=0,f=h>c?d/h:u/c):(m=(h*u-c*d)/p,f=(l*u-h*d)/p),!(m<0)&&!(m>1)&&!(f<0)&&!(f>1)&&(n&&((0,i.vec3_lerp)(n.rayPosition,e.posStart,e.posEnd,f),(0,i.vec3_lerp)(n.segPosition,t,r,m),n.distance=(0,i.vec3_len)(n.segPosition,n.rayPosition)),!0)}}),parcelRequire.register("9HBIH",function(e,t){function i(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function r(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function n(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function o(e,t,i){let r=t[0],n=t[1],o=t[2],a=i[0],s=i[1],l=i[2];return e[0]=n*l-o*s,e[1]=o*a-r*l,e[2]=r*s-n*a,e}function a(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function s(e,t,i,r){return e[0]=i[0]*r+t[0],e[1]=i[1]*r+t[1],e[2]=i[2]*r+t[2],e}function l(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function h(e,t){let i=Math.sqrt(t[0]**2+t[1]**2+t[2]**2);return 0!=i&&(i=1/i,e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i),e}function c(e,t,i){let r=i[0],n=i[1],o=i[2],a=i[3],s=t[0],l=t[1],h=t[2],c=n*h-o*l,d=o*s-r*h,u=r*l-n*s,p=a*c+n*u-o*d,m=a*d+o*c-r*u,f=a*u+r*d-n*c;return e[0]=s+2*p,e[1]=l+2*m,e[2]=h+2*f,e}function d(e,t){return void 0===t?e[0]**2+e[1]**2+e[2]**2:(e[0]-t[0])**2+(e[1]-t[1])**2+(e[2]-t[2])**2}function u(e,t){return void 0===t?Math.sqrt(e[0]**2+e[1]**2+e[2]**2):Math.sqrt((e[0]-t[0])**2+(e[1]-t[1])**2+(e[2]-t[2])**2)}function p(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function m(e,t,i,r){let n=1-r;return e[0]=t[0]*n+i[0]*r,e[1]=t[1]*n+i[1]*r,e[2]=t[2]*n+i[2]*r,e}function f(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function g(e,t,i){let r=t[0],n=t[1],o=t[2],a=t[3],s=i[0],l=i[1],h=i[2],c=i[3];return e[0]=r*c+a*s+n*h-o*l,e[1]=n*c+a*l+o*s-r*h,e[2]=o*c+a*h+r*l-n*s,e[3]=a*c-r*s-n*l-o*h,e}function y(e,t){let i=t[0]**2+t[1]**2+t[2]**2+t[3]**2;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i),e}function x(e,t,i){let r=.5*i,n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function w(e,t){return void 0===t?e[0]**2+e[1]**2+e[2]**2+e[3]**2:(e[0]-t[0])**2+(e[1]-t[1])**2+(e[2]-t[2])**2+(e[3]-t[3])**2}$parcel$export(e.exports,"vec3_copy",()=>i),$parcel$export(e.exports,"vec3_add",()=>r),$parcel$export(e.exports,"vec3_sub",()=>n),$parcel$export(e.exports,"vec3_cross",()=>o),$parcel$export(e.exports,"vec3_dot",()=>a),$parcel$export(e.exports,"vec3_scaleAndAdd",()=>s),$parcel$export(e.exports,"vec3_scale",()=>l),$parcel$export(e.exports,"vec3_norm",()=>h),$parcel$export(e.exports,"vec3_transformQuat",()=>c),$parcel$export(e.exports,"vec3_sqrLen",()=>d),$parcel$export(e.exports,"vec3_len",()=>u),$parcel$export(e.exports,"vec3_mul",()=>p),$parcel$export(e.exports,"vec3_lerp",()=>m),$parcel$export(e.exports,"quat_copy",()=>f),$parcel$export(e.exports,"quat_mul",()=>g),$parcel$export(e.exports,"quat_normalize",()=>y),$parcel$export(e.exports,"quat_setAxisAngle",()=>x),$parcel$export(e.exports,"quat_sqrLen",()=>w)}),parcelRequire.register("bTXeb",function(e,t){$parcel$export(e.exports,"ManipulatorMode",()=>n),$parcel$export(e.exports,"ManipulatorData",()=>o);var i=parcelRequire("9HBIH"),r=parcelRequire("hnYik");let n=Object.freeze({Translate:0,Rotate:1,Scale:2});class o{scaleFactor=10;minFlipAdjust=-.02;minHitDistance=.1;minPntDistance=.1;minArcDistance=.1;lastCamPos=[0,0,0];lastCamRot=[0,0,0,1];hasHit=!1;hasUpdated=!0;isDragging=!1;isActive=!1;intersectPos=[0,0,0];position=[0,0,0];scale=[1,1,1];infoScale=1;arcRadius=1;axisLen=1;midPointLen=.55;sclPointLen=1.1;useTranslate=!0;useScale=!0;useRotate=!0;axes=[{dir:[1,0,0],endPos:[1,0,0],midPos:[0,0,0],sclPos:[0,0,0]},{dir:[0,1,0],endPos:[0,1,0],midPos:[0,0,0],sclPos:[0,0,0]},{dir:[0,0,1],endPos:[0,0,1],midPos:[0,0,0],sclPos:[0,0,0]}];traceStep=.5;traceLine={isActive:!1,hitPos:[0,0,0],origin:[0,0,0],a:[0,0,0],b:[0,0,0],dir:[0,0,0]};activeMode=n.Translate;activeAxis=-1;activePlane=-1;onDragStart=null;onDragEnd=null;onTranslate=null;onRotate=null;onScale=null;setPosition(e,t,i){return 3===e.length?(this.position[0]=e[0],this.position[1]=e[1],this.position[2]=e[2]):(this.position[0]=e,this.position[1]=t,this.position[2]=i),this.hasUpdated=!0,this}updateFromCamera(e,t,r=!1){return(this.isDragging||1e-6>=Math.abs((0,i.vec3_sqrLen)(e,this.lastCamPos))&&1e-6>=Math.abs((0,i.quat_sqrLen)(t,this.lastCamRot)))&&!r||((0,i.vec3_copy)(this.lastCamPos,e),(0,i.quat_copy)(this.lastCamRot,t),this._calcCameraScale()),this}resetState(){this.traceLine.isActive=!1,this.activeMode=n.Translate,this.activeAxis=-1,this.activePlane=-1}startDrag(){this.isDragging=!0,this.onDragStart&&this.onDragStart()}stopDrag(){this.isDragging=!1,this.onDragEnd&&this.onDragEnd()}_movePlane(e,t){let i=this.axes[t].dir,n=(0,r.intersectPlane)(e,this.position,i);return null!=n&&(e.posAt(n,this.position),this.calcAxesPosition(),this.onTranslate&&this.onTranslate(this.position.slice(0)),!0)}_moveTrace(e){let t=new r.NearSegmentResult;if((0,r.nearSegment)(e,this.traceLine.a,this.traceLine.b,t)){switch((0,i.vec3_copy)(this.traceLine.hitPos,t.segPosition),this.activeMode){case n.Translate:(0,i.vec3_copy)(this.position,t.segPosition),this.calcAxesPosition(),this.onTranslate&&this.onTranslate(t.segPosition.slice(0));break;case n.Rotate:case n.Scale:let e=(0,i.vec3_sub)([0,0,0],t.segPosition,this.traceLine.origin),r=(0,i.vec3_len)(e),o=Math.sign((0,i.vec3_dot)(e,this.traceLine.dir)),a=r/this.traceStep*o;this.onRotate&&this.activeMode===n.Rotate&&this.onRotate(a,this.activeAxis),this.onScale&&this.activeMode===n.Scale&&this.onScale(a,this.activeAxis>=0?this.activeAxis:null)}return!0}return!1}onRayDown(e){return!!(this.isActive&&this._rayIntersect(e))&&(this.startDrag(),!0)}onRayHover(e){return!!this.isActive&&!this.isDragging&&this._rayIntersect(e)}onRayMove(e){if(this.isActive&&!this.isDragging)return!1;if(-1!=this.activeAxis)this._moveTrace(e);else if(-1!=this.activePlane)return this._movePlane(e,this.activePlane);return!1}_setTraceLine(e,t=-1){this.traceLine.isActive=!0,(0,i.vec3_copy)(this.traceLine.origin,e),(0,i.vec3_copy)(this.traceLine.hitPos,e),-1==t?(0,i.vec3_transformQuat)(this.traceLine.dir,[1,0,0],this.lastCamRot):(0,i.vec3_copy)(this.traceLine.dir,this.axes[t].dir),(0,i.vec3_scaleAndAdd)(this.traceLine.a,e,this.traceLine.dir,-1e3),(0,i.vec3_scaleAndAdd)(this.traceLine.b,e,this.traceLine.dir,1e3)}_calcCameraScale(){let e=(0,i.vec3_sub)([0,0,0],this.lastCamPos,this.position),t=(0,i.vec3_len)(e);this.infoScale=t/this.scaleFactor,(0,i.vec3_norm)(e,e),(0,i.vec3_scale)(this.scale,[1,1,1],this.infoScale),(0,i.vec3_dot)(e,[1,0,0])<this.minFlipAdjust&&(this.scale[0]=-this.scale[0]),(0,i.vec3_dot)(e,[0,1,0])<this.minFlipAdjust&&(this.scale[1]=-this.scale[1]),(0,i.vec3_dot)(e,[0,0,1])<this.minFlipAdjust&&(this.scale[2]=-this.scale[2]),this.calcAxesPosition()}calcAxesPosition(){let e=this.axes;for(let t=0;t<3;t++)(0,i.vec3_scaleAndAdd)(e[t].endPos,this.position,e[t].dir,this.scale[t]*this.axisLen),(0,i.vec3_scaleAndAdd)(e[t].midPos,this.position,e[t].dir,this.scale[t]*this.midPointLen),(0,i.vec3_scaleAndAdd)(e[t].sclPos,this.position,e[t].dir,this.scale[t]*this.sclPointLen);this.hasUpdated=!0}_rayIntersect(e){if(!this._testSphere(e))return!1;let t=this.activeAxis;this.resetState();let i=this.useScale&&this._testPoints(e);return i=(i=i||this.useTranslate&&this._testAxis(e))||this.useRotate&&this._testArc(e),t!==this.activeAxis&&(this.hasUpdated=!0),this.hasHit=i,i}_testSphere(e){return(0,r.intersectSphere)(e,this.position,(this.sclPointLen+this.minPntDistance)*this.infoScale)}_testPlanes(e){let t,i;let n=this.axes;for(t=0;t<3;t++)if(i=(t+1)%3,(0,r.intersectTri)(e,n[t].midPos,n[i].midPos,this.position,this.intersectPos,!1))return this.activePlane=(t+2)%3,!0;return!1}_testArc(e){let t,o,a,s;let l=this.infoScale*this.minArcDistance,h=this.axes,c=[0,0,0],d=[0,0,0],u=[0,0,0],p=this.arcRadius*this.infoScale;for(o=0;o<3;o++)if(null!==(t=(0,r.intersectPlane)(e,this.position,h[o].dir))&&(e.posAt(t,c),Math.abs((0,i.vec3_len)(this.position,c)-p)<=l&&(a=(o+1)%3,(0,i.vec3_sub)(d,c,this.position),(0,i.vec3_scale)(u,h[a].dir,Math.sign(this.scale[a])),(0,i.vec3_dot)(d,u)>=0&&(s=(o+2)%3,(0,i.vec3_scale)(u,h[s].dir,Math.sign(this.scale[s])),(0,i.vec3_dot)(d,u)>=0))))return this.activeAxis=o,this.activeMode=n.Rotate,this._setTraceLine(c),(0,i.vec3_copy)(this.intersectPos,c),!0;return!1}_testAxis(e){let t;let n=this.infoScale*this.minHitDistance,o=new r.NearSegmentResult,a=[0,0,0],s=1/0,l=-1;for(let h=0;h<3;h++)t=this.axes[h],(0,r.nearSegment)(e,this.position,t.endPos,o)&&o.distance<=n&&o.distance<s&&(s=o.distance,l=h,(0,i.vec3_copy)(a,o.segPosition));return -1!==l&&(this.activeAxis=l,this._setTraceLine(a,l),(0,i.vec3_copy)(this.intersectPos,a),!0)}_testPoints(e){let t=this.infoScale*this.minPntDistance,o=(0,r.nearPoint)(e,this.position,t);if(null!==o)return this._setTraceLine(this.position),this.activeMode=n.Scale,this.activeAxis=-2,!0;for(let a=0;a<3;a++)if(null!==(o=(0,r.nearPoint)(e,this.axes[a].sclPos,t)))return this._setTraceLine(this.axes[a].sclPos,a),this.activeAxis=a,this.activeMode=n.Scale,(0,i.vec3_copy)(this.intersectPos,this.axes[a].sclPos),!0;return!1}}}),parcelRequire.register("kiVmp",function(e,t){$parcel$export(e.exports,"ManipulatorMesh",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("bTXeb");class n extends i.Group{axisColors=[16216426,7186922,8509299];axisLines=[];axisArcs=[];axisPoints=[];axisTris=[];grpCtrl=new i.Group;meshTracePnt=null;meshTraceLine=null;colSelect=16777215;colOrigin=16776960;constructor(e){super();let t=.5*Math.PI,r=.03,n=e.arcRadius,o=.03,a=e.sclPointLen;this.visible=!1;let s=new i.MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0,side:i.DoubleSide,opacity:1,color:16777215}),l=new i.LineBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0,color:9474192}),h=new i.BufferGeometry;h.setAttribute("position",new i.Float32BufferAttribute([0,0,0,0,100,0],3));let c=new i.BufferGeometry;c.setAttribute("position",new i.Float32BufferAttribute([0,0,0,e.midPointLen,0,0,0,e.midPointLen,0],3));let d=new i.SphereGeometry(.1,8,8),u=new i.TorusGeometry(n,o,3,10,t),p=new i.CylinderGeometry(r,r,e.axisLen,3);p.translate(0,.5*e.axisLen,0);let m=new i.Mesh(p,s.clone());this.grpCtrl.add(m);let f=new i.Mesh(p,s.clone());f.rotation.x=t,this.grpCtrl.add(f);let g=new i.Mesh(p,s.clone());g.rotation.z=-t,this.grpCtrl.add(g),this.axisLines.push(g,m,f);let y=new i.Mesh(u,s.clone());y.name="ZAXIS",this.grpCtrl.add(y);let x=new i.Mesh(u,s.clone());x.name="XAXIS",x.rotation.y=-t,this.grpCtrl.add(x);let w=new i.Mesh(u,s.clone());w.rotation.x=t,this.grpCtrl.add(w),this.axisArcs.push(x,w,y);let b=new i.Mesh(d,s.clone());b.position.z=a,this.grpCtrl.add(b);let v=new i.Mesh(d,s.clone());v.position.x=a,this.grpCtrl.add(v);let M=new i.Mesh(d,s.clone());M.position.y=a,this.grpCtrl.add(M),this.axisPoints.push(v,M,b);let S=new i.Mesh(c,s.clone()),P=new i.Mesh(c,s.clone());P.rotation.x=t;let T=new i.Mesh(c,s.clone());T.rotation.y=-t,this.axisTris.push(T,P,S),this.meshTraceLine=new i.Line(h,l),this.meshTraceLine.visible=!1,this.meshTraceLine.layers.set(2),this.add(this.meshTraceLine),this.meshTracePnt=new i.Mesh(d,s.clone()),this.meshTracePnt.visible=!1,this.meshTraceLine.layers.set(2),this.add(this.meshTracePnt),this.origin=new i.Mesh(d,s.clone()),this.grpCtrl.add(this.origin),this.grpCtrl.traverse(function(e){e.layers.set(2)}),this.add(this.grpCtrl)}showGizmo(){this.grpCtrl.visible=!0}hideGizmo(){this.grpCtrl.visible=!1}updateLook(e){let t;for(t of this.axisArcs)t.visible=e.useRotate;for(t of(this.origin.visible=e.useScale,this.axisPoints))t.visible=e.useScale;for(t of this.axisTris)t.visible=e.useTranslate}update(e){if(e.hasUpdated||e.hasHit){this.grpCtrl.scale.fromArray(e.scale),this.grpCtrl.position.fromArray(e.position),-2===e.activeAxis&&e.activeMode===r.ManipulatorMode.Scale?this.origin.material.color.setHex(this.colSelect):this.origin.material.color.setHex(this.colOrigin);for(let t=0;t<3;t++){if(this.axisLines[t].material.color.setHex(this.axisColors[t]),this.axisArcs[t].material.color.setHex(this.axisColors[t]),this.axisPoints[t].material.color.setHex(this.axisColors[t]),this.axisTris[t].material.color.setHex(this.axisColors[t]),t===e.activeAxis)switch(e.activeMode){case r.ManipulatorMode.Translate:this.axisLines[t].material.color.setHex(this.colSelect);break;case r.ManipulatorMode.Rotate:this.axisArcs[t].material.color.setHex(this.colSelect);break;case r.ManipulatorMode.Scale:this.axisPoints[t].material.color.setHex(this.colSelect)}t===e.activePlane&&this.axisTris[t].material.color.setHex(16777215)}if(e.traceLine.isActive){let t=Math.abs(e.scale[2]);this.meshTracePnt.visible=!0,this.meshTracePnt.scale.set(t,t,t),this.meshTracePnt.position.fromArray(e.traceLine.origin),this.meshTraceLine.visible=!0,this.meshTraceLine.geometry.attributes.position.needsUpdate=!0;let i=this.meshTraceLine.geometry.attributes.position.array;i[0]=e.traceLine.a[0],i[1]=e.traceLine.a[1],i[2]=e.traceLine.a[2],i[3]=e.traceLine.b[0],i[4]=e.traceLine.b[1],i[5]=e.traceLine.b[2]}else this.meshTraceLine.visible=!1,this.meshTracePnt.visible=!1}}}}),parcelRequire.register("lcWY1",function(e,t){$parcel$export(e.exports,"ThreeDimensionMoveHelper",()=>s);var i=parcelRequire("4xklQ");parcelRequire("5XTH3");var r=parcelRequire("hrM0U"),n=parcelRequire("3BPdS"),o=parcelRequire("5sV3G"),a=parcelRequire("9HO6e");class s{constructor(e,t=""){this.name="ThreeDimensionMoveHelper",this.editor=e,this.camera=e.camera,this.dom=e.dom,this._caster=new i.Raycaster,this._caster.layers.mask=6,this.ray=new i.Ray,this.mouse=new i.Vector2,this.selected=void 0,this.isDragging=!1,this.hiddenLabel=!1,this.currentObj=t,this.labelTextArr=[],this.pointerMoveHandler=this.pointermove.bind(this),this.pointerDownHandler=this.pointerdown.bind(this),this.pointerUpHandler=this.pointerup.bind(this),this.addEventListener(),this.digHole=new o.DigHole(e),this.tmpBox=new i.Mesh(new i.BoxGeometry(1,1,1),new i.MeshBasicMaterial({color:16711680}))}addEventListener(){let e=this.editor.dom;e.addEventListener("pointermove",this.pointerMoveHandler),e.addEventListener("pointerdown",this.pointerDownHandler),e.addEventListener("pointerup",this.pointerUpHandler)}removeEventListener(){let e=this.editor.dom;e.removeEventListener("pointermove",this.pointerMoveHandler),e.removeEventListener("pointerdown",this.pointerDownHandler),e.removeEventListener("pointerup",this.pointerUpHandler),this.removeBox()}selectObj(e){this.editor.modelHelperGroup.children=[],this.editor.clickSelect[0].object=e;let t=this.editor.getOuterParent(e);if(""!=this.currentObj&&(t=this.currentObj),""==t&&"Mesh"!=e.type||"3DWall"==e.modelType||"ArcBaseWindowMesh"==t.type)return;this.selected=t,this.addBox(t),this.editor.doorHelperGroupClean();let r=this.editor.getWallByMesh(this.selected),n;this.editor.wallGroup3D.children.forEach(e=>{e.wallID==r.wallID&&(n=e)});let o=n.endPoint.clone().sub(n.startPoint).angle(),a=this.selected.parameter.tdm;this.editor.addLineHelperForDoor(a,!0);let s="archDoor"==a.modelType||"archWindow"==a.modelType,l=this.digHole.createBooleanMesh(a.doorWid,a.height,a.wallDep+2,s,o);l.position.add(new i.Vector3(a.center.x,a.center.y,a.height/2+a.floorHei)),l.updateMatrix(),this.selectedBM=l,this._lastWall=t.parameter.tdm.wallId,this._currentWallHole=this.getHoleByWallID(this._lastWall),this._currentWall=n,""!=this.currentObj&&(this.isDragging=!0,this._lastWall=this.selected.parameter.tdm.wallId),this._lastPosition=t.position.clone(),this._lastRotation=t.rotation.z,this.editor.wallGroup3D.children.forEach(e=>{if(e.wallID==t.parameter.tdm.wallId){this._lastRotation=this.getRotation(e);return}}),this.originPosition=this.selected.position.clone()}pointermove(e){if(this.mouse.x=e.clientX/window.innerWidth*2-1,this.mouse.y=-(2*(e.clientY/window.innerHeight))+1,this.hiddenLabel&&this.removeLabel(),this.isDragging){if(this.selected.isLock){let e=this.editor.getScreenPosition(this.editor.currentPoint.clone());this.editor.list.blackBox.dispatch(e.x,e.y,"该模型已锁定,请先解锁");return}if(this.removeBox(),this.syncPosition1(),"CodeModel"==this.selected.modelType&&this.selected.parent){let e,t=this.editor.getWallByMesh(this.selected);this.editor.wallGroup3D.children.forEach(i=>{i.wallID==t.wallID&&(e=i)});let i=this._currentWallHole?this.digHole.boolean(this.selectedBM,this._currentWallHole,"union"):this.digHole.boolean(this.selectedBM,this.tmpBox,"union");this.partRefresh(e,i)}this.dragstart(),this.editor.dom.setPointerCapture(e.pointerId),e.preventDefault(),e.stopPropagation()}}syncPosition1(){let e=this.getObject(!0),t=this.getPosition(),r,n=0,o;t?"3DWall"==(o=t[0].object).modelType?(n=this.getRotation(o),r=this.getProjectPoint(o,t[0].point.clone())):r=new i.Vector2(1e3*e.point.x,-(1e3*e.point.z)):e?r=new i.Vector2(1e3*e.point.x,-(1e3*e.point.z)):(r=this._lastPosition,n=this._lastRotation),this.selected.position.x=r.x,this.selected.position.y=r.y,this.selected.rotation.y=n,this._lastPosition=this.selected.position.clone(),this._lastRotation=this.selected.rotation.y,this.selectedBM.position.x=r.x,this.selectedBM.position.y=r.y,this.selectedBM.rotation.z=n,this.editor.modelHelperGroup.remove(this.selected.parameter.box),this.disposeGeom(this.selected.parameter.box),this.addBox(this.selected),this.syncPosition2(o)}syncPosition2(e){let t=this.selected.parameter.tdm;if(t.position.x=this.selected.position.x,t.position.y=this.selected.position.y,t.center.x=this.selected.position.x,t.center.y=this.selected.position.y,t.updateWorldMatrix(!0,!1),t.startPoint=t.localToWorld(new i.Vector3(-t.doorWid/2,0,0)),t.endPoint=t.localToWorld(new i.Vector3(t.doorWid/2,0,0)),e){let i=this.getRotation(e);if(t.rotation.z=i,t.wallId!=e.wallID){let i;this.editor.wallGroup3D.children.forEach(e=>{e.wallID==t.wallId&&(i=e)}),this.partRefresh(i,this._currentWallHole),t.wallId=e.wallID,this._lastWall=e.wallID,this._lastPosition=this.selected.position.clone(),this._lastRotation=this.selected.rotation.y,this._currentWallHole=this.getHoleByWallID(t.wallId)}}else t.wallId=this._lastWall}partRefresh(e,t){if(void 0==t){e.geometry.dispose(),e.geometry=e.origin3DWall.geometry,e.material=e.origin3DWall.material,e.updateMatrix();return}let i=this.digHole.boolean(e.origin3DWall,t);e.geometry.dispose(),e.geometry=i.geometry,e.material=i.material,e.updateMatrix()}pointerdown(e){""==this.currentObj&&(this.editor.downEvent=e,e.preventDefault(),e.stopPropagation(),this.mouse.x=e.clientX/window.innerWidth*2-1,this.mouse.y=-(2*(e.clientY/window.innerHeight))+1,this.hiddenLabel=!0,this.getObject()==this.selected&&(this.isDragging=!0,this._lastWall=this.selected.parameter.tdm.wallId,this.editor.execute()))}pointerup(e){this.editor.blackbox&&this.editor.blackbox.removeDom(),this.editor.blackbox="",this.mouse.x=e.clientX/window.innerWidth*2-1,this.mouse.y=-(2*(e.clientY/window.innerHeight))+1,this.selected&&this.editor.modelHelperGroup.remove(this.selected.parameter.box),this.isDragging=!1,this.hiddenLabel=!1,this.dragend()}getObject(e=!1){this._caster.setFromCamera(this.mouse,this.camera);let t=this.editor.pointHelperGroup.children.concat(this.editor.otherMeshs);t=(t=t.concat(this.editor.wallGroup3D.children)).concat(this.editor.floor),e&&t.splice(t.indexOf(this.selected),1);let i=this._caster.intersectObjects(t,!0);if(i.length>0)return e?i[0]:this.editor.getOuterParent(i[0].object)}getPosition(){this._caster.setFromCamera(this.mouse,this.camera),this.intersects=Array.from(this.editor.wallGroup3D.children);let e=this.createTmpBox(this.intersects);this.editor.scene.add(e),this.intersects.push(e),this.intersects=[e];let t=this._caster.intersectObjects(this.intersects,!1);if(this.editor.scene.remove(e),e.geometry.dispose(),e.material.dispose(),t.length>0)return t;let i=this._caster.intersectObjects(this.editor.wallGroup3D.children,!1);if(i.length>0)return i}dragstart(e){""!=this.editor.globalControl&&(this.editor.globalControl.enabled=!1)}dragend(e){""!=this.editor.globalControl&&(this.editor.globalControl.enabled=!0),this.removeBox()}addBox(e){let t=new i.Group;e.children.forEach(e=>{t.add(e.clone())}),t.applyMatrix4(new i.Matrix4().makeScale(.001,.001,.001)),t.position.set(e.position.x/1e3,e.position.z/1e3,-e.position.y/1e3);let r=new i.Box3().setFromObject(t);this.disposeGeom(t);let n=this.editor.wallHelp.addOBBbox(e,1735416);if(n.name="modelBox",n.layers.set(2),"UWindowMesh"==e.type&&(n.position.y+=(r.max.y-r.min.y)/2),"LWindowMesh"==e.type){let e=new i.Vector3;r.getCenter(e),n.position.copy(e.clone())}this.editor.modelHelperGroup.add(n),n.material.depthTest=!1,e.parameter.box=n;let o=this.editor.get3DWallByMesh(e);o&&this.addMarkLabel(o)}disposeGeom(e){if(e.isMesh&&e.geometry.dispose(),e.isGroup||e.isObject3D)for(;e.children.length>0;){let t=e.children.shift();"Group"==t.type?this.disposeGeom(t):t.isObject3D&&t.children.length>0?this.disposeGeom(t):t.geometry.dispose()}}removeBox(){this.editor.modelHelperGroup.children.slice(0).forEach(e=>{"modelBox"==e.name&&this.editor.modelHelperGroup.remove(e),"label"==e.name&&this.editor.modelHelperGroup.remove(e)}),this.labelTextArr.forEach(e=>{e.dom.remove()})}getBox(){let e=this.editor.modelHelperGroup.children.slice(0);for(let t=0;t<e.length;t++)if("modelBox"==e[t].name)return e[t]}addMarkLabel(e){let t=this.getBox();t.geometry.computeBoundingBox();let r=t.geometry.boundingBox,n=new i.Vector3(r.min.x,0,0).applyEuler(t.rotation).add(t.position),o=new i.Vector3(r.max.x,0,0).applyEuler(t.rotation).add(t.position);this.rayCasterFunc(n,n.clone().sub(o),e,"leftInput"),this.rayCasterFunc(o,o.clone().sub(n),e,"rightInput");let a=new i.Vector3(0,r.max.y,0).applyEuler(t.rotation).add(t.position),s=new i.Vector3(0,r.min.y,0).applyEuler(t.rotation).add(t.position);this.rayCasterFunc(a,a.clone().sub(s),e,"frontInput"),this.rayCasterFunc(s,s.clone().sub(a),e,"backInput")}removeLabel(){this.editor.modelHelperGroup.children.slice(0).forEach(e=>{"label"==e.name&&this.editor.modelHelperGroup.remove(e)}),this.labelTextArr.forEach(e=>{e.dom.remove()})}rayCasterFunc(e,t,o,s){this.ray.set(e,t.normalize());let l=Array.from(o.geometry.attributes.position.array),h=new i.Vector3,c=new i.Vector2(1e3*o.startPoint.x,1e3*o.startPoint.y),d=new i.Vector2(1e3*o.endPoint.x,1e3*o.endPoint.y),u=c.distanceTo(d),p=d.clone().sub(c).angle();for(let c=0;c<l.length/9;c++){let d=o.localToWorld(new i.Vector3(l[9*c],l[9*c+1],l[9*c+2])),m=o.localToWorld(new i.Vector3(l[9*c+3],l[9*c+4],l[9*c+5])),f=o.localToWorld(new i.Vector3(l[9*c+6],l[9*c+7],l[9*c+8]));if(this.ray.intersectTriangle(d,m,f,!1,h),!h.equals(new i.Vector3)){let l=(0,r.CommonFunc).createThreeDimensionLabel(e,h);l.layers.set(2),this.editor.modelHelperGroup.add(l);let c=this.editor.getScreenPosition(new i.Vector3(l.center.x,l.center.y,l.center.z)),d=new(0,n.UIInput)(Math.round(1e3*l.labelLength)).setClass("showDistance").setId(s).setFontSize("15px").setWidth("40px").setStyle(["transform"],["rotate("+p+"deg)"]).setMarginTop(c.y+"px").setMarginLeft(c.x+"px").onKeyDown((function(e){if("Tab"==e.key&&(e.preventDefault(),document.getElementsById(s)[0].focus()),"13"==e.keyCode){this.editor.execute();let e=document.getElementById(s).value,r=e-Math.round(1e3*l.labelLength);if("frontInput"==s&&(t=new i.Vector3(0,0,1),r=-r),"backInput"==s&&(t=new i.Vector3(0,0,-1)),e>u)return;"frontInput"==s||"backInput"==s?this.selected.parameter.tdm.floorHei+=r:this.selected.position.add(t.clone().negate().setLength(r)),this.addBox(this.selected),this.addMarkLabel(o),this.syncPosition2(o);let n=this.editor.getWallByMesh(this.selected);this.editor.wallGroup3D.remove(this.selected),this.editor.partRefreshWall(n),this.removeBox();let h="";this.editor.wallGroup3D.children.forEach(e=>{"CodeModel"==e.modelType&&(0,a.UtilCore).isSameVector(e.position,this.selected.position)&&(h=e)}),this.editor.clickSelect[0].object=h,this.editor.add3DDoorDialog(h),this.editor.doorHelperGroupClean()}}).bind(this));d.setAttribute("worldPosition",l.center.x+"/"+l.center.y+"/"+l.center.z),this.labelTextArr.push(d),this.editor.uiPanelBox.add(d);return}}}getHoleByWallID(e){let t,n=[],o;this.editor.wallGroup3D.children.forEach(t=>{-1==["LWindowMesh","UWindowMesh"].indexOf(t.type)&&"ArcBaseWindowMesh"!=t.type&&("CodeModel"==t.modelType&&t.parameter.tdm.wallId==e&&n.push(t),"3DWall"==t.modelType&&t.wallID==e&&(o=t))}),(0,r.CommonFunc).removeItemFromArr(n,this.selected);let a=o.endPoint.clone().sub(o.startPoint).angle(),s=[];for(let e=0;e<n.length;e++){let t=n[e].parameter.tdm,r="archDoor"==t.modelType||"archWindow"==t.modelType,o=this.digHole.createBooleanMesh(t.doorWid,t.height,t.wallDep+2,r,a);o.position.add(new i.Vector3(t.center.x,t.center.y,t.height/2+t.floorHei)),o.updateMatrix(),s.push(o)}if(s.length>0){t=s[0];for(let e=1;e<s.length;e++)t=this.digHole.boolean(t,s[e],"union")}return t}getRotation(e){let t=new i.Vector2(1e3*e.startPoint.x,1e3*e.startPoint.y);return new i.Vector2(1e3*e.endPoint.x,1e3*e.endPoint.y).sub(t).angle()}getProjectPoint(e,t){let n;let o=new i.Vector2(1e3*e.startPoint.x,1e3*e.startPoint.y),a=new i.Vector2(1e3*e.endPoint.x,1e3*e.endPoint.y);if(t.x=Math.round(1e5*t.x)/100,t.y=-Math.round(1e5*t.z)/100,e.arcCenter){let t=e.arcCenter.distanceTo(a);n=(0,r.CommonFunc).getCircleEquation(e.arcCenter,t)}else n=(0,r.CommonFunc).getLineEquation(o,a);return(0,r.CommonFunc).getProjectPoint(n,t)}createTmpBox(e){let t;this.editor.wallGroup3D.children.forEach(i=>{if(i.wallID==this.selected.parameter.tdm.wallId){t=i,(0,r.CommonFunc).removeItemFromArr(e,i);return}});let n=new i.Mesh(t.origin3DWall.geometry,new i.MeshBasicMaterial({color:65280}));n.layers.mask=t.layers.mask,n.rotation.x=-Math.PI/2,n.position.set(t.position.x,t.position.z,-t.position.y),n.startPoint=t.startPoint.clone(),n.endPoint=t.endPoint.clone(),n.wallID=t.wallID,t.isArc&&(n.arcCenter=t.arcCenter),n.modelType="3DWall";let o=new i.Matrix4().makeScale(.001,.001,.001);return n.applyMatrix4(o),n.updateMatrixWorld(),n}}}),parcelRequire.register("RhAiw",function(e,t){$parcel$export(e.exports,"Tween",()=>c),$parcel$export(e.exports,"update",()=>u);var i,r=parcelRequire("9Mq5w"),n={Linear:{None:function(e){return e}},Bounce:{In:function(e){return 1-n.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*n.Bounce.In(2*e):.5*n.Bounce.Out(2*e-1)+.5}}},o=i="undefined"==typeof self&&void 0!==r&&r.hrtime?function(){var e=r.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return new Date().getTime()},a=function(){function e(){this._tweens={},this._tweensAddedDuringUpdate={}}return e.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},e.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},e.prototype.update=function(e,t){void 0===e&&(e=o()),void 0===t&&(t=!1);var i=Object.keys(this._tweens);if(0===i.length)return!1;for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<i.length;r++){var n=this._tweens[i[r]],a=!t;n&&!1===n.update(e,a)&&!t&&delete this._tweens[i[r]]}i=Object.keys(this._tweensAddedDuringUpdate)}return!0},e}(),s={Linear:function(e,t){var i=e.length-1,r=i*t,n=Math.floor(r),o=s.Utils.Linear;return t<0?o(e[0],e[1],r):t>1?o(e[i],e[i-1],i-r):o(e[n],e[n+1>i?i:n+1],r-n)},Bezier:function(e,t){for(var i=0,r=e.length-1,n=Math.pow,o=s.Utils.Bernstein,a=0;a<=r;a++)i+=n(1-t,r-a)*n(t,a)*e[a]*o(r,a);return i},CatmullRom:function(e,t){var i=e.length-1,r=i*t,n=Math.floor(r),o=s.Utils.CatmullRom;return e[0]===e[i]?(t<0&&(n=Math.floor(r=i*(1+t))),o(e[(n-1+i)%i],e[n],e[(n+1)%i],e[(n+2)%i],r-n)):t<0?e[0]-(o(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[i]-(o(e[i],e[i],e[i-1],e[i-1],r-i)-e[i]):o(e[n?n-1:0],e[n],e[i<n+1?i:n+1],e[i<n+2?i:n+2],r-n)},Utils:{Linear:function(e,t,i){return(t-e)*i+e},Bernstein:function(e,t){var i=s.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:function(){var e=[1];return function(t){var i=1;if(e[t])return e[t];for(var r=t;r>1;r--)i*=r;return e[t]=i,i}}(),CatmullRom:function(e,t,i,r,n){var o=(i-e)*.5,a=(r-t)*.5,s=n*n;return(2*t-2*i+o+a)*(n*s)+(-3*t+3*i-2*o-a)*s+o*n+t}}},l=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),h=new a,c=function(){function e(e,t){void 0===t&&(t=h),this._object=e,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=n.Linear.None,this._interpolationFunction=s.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=l.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.to=function(e,t){return this._valuesEnd=Object.create(e),void 0!==t&&(this._duration=t),this},e.prototype.duration=function(e){return void 0===e&&(e=1e3),this._duration=e,this},e.prototype.start=function(e){if(void 0===e&&(e=o()),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var t in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(t),this._valuesStart[t]=this._valuesStartRepeat[t];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},e.prototype._setupProperties=function(e,t,i,r){for(var n in i){var o=e[n],a=Array.isArray(o),s=a?"array":typeof o,l=!a&&Array.isArray(i[n]);if("undefined"!==s&&"function"!==s){if(l){var h=i[n];if(0===h.length)continue;h=h.map(this._handleRelativeValue.bind(this,o)),i[n]=[o].concat(h)}if(("object"===s||a)&&o&&!l){for(var c in t[n]=a?[]:{},o)t[n][c]=o[c];r[n]=a?[]:{},this._setupProperties(o,t[n],i[n],r[n])}else void 0===t[n]&&(t[n]=o),a||(t[n]*=1),l?r[n]=i[n].slice().reverse():r[n]=t[n]||0}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying&&(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object)),this},e.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},e.prototype.pause=function(e){return void 0===e&&(e=o()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this)),this},e.prototype.resume=function(e){return void 0===e&&(e=o()),this._isPaused&&this._isPlaying&&(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this)),this},e.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},e.prototype.group=function(e){return void 0===e&&(e=h),this._group=e,this},e.prototype.delay=function(e){return void 0===e&&(e=0),this._delayTime=e,this},e.prototype.repeat=function(e){return void 0===e&&(e=0),this._initialRepeat=e,this._repeat=e,this},e.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},e.prototype.yoyo=function(e){return void 0===e&&(e=!1),this._yoyo=e,this},e.prototype.easing=function(e){return void 0===e&&(e=n.Linear.None),this._easingFunction=e,this},e.prototype.interpolation=function(e){return void 0===e&&(e=s.Linear),this._interpolationFunction=e,this},e.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},e.prototype.onStart=function(e){return this._onStartCallback=e,this},e.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},e.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},e.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},e.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},e.prototype.onStop=function(e){return this._onStopCallback=e,this},e.prototype.update=function(e,t){if(void 0===e&&(e=o()),void 0===t&&(t=!0),this._isPaused)return!0;var i,r,n=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>n)return!1;t&&this.start(e)}if(this._goToEnd=!1,e<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),!1===this._onEveryStartCallbackFired&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0),r=(e-this._startTime)/this._duration,r=0===this._duration||r>1?1:r;var a=this._easingFunction(r);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,a),this._onUpdateCallback&&this._onUpdateCallback(this._object,r),1===r){if(this._repeat>0){for(i in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[i]||(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo&&this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i];this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,l=this._chainedTweens.length;s<l;s++)this._chainedTweens[s].start(this._startTime+this._duration);return this._isPlaying=!1,!1}}return!0},e.prototype._updateProperties=function(e,t,i,r){for(var n in i)if(void 0!==t[n]){var o=t[n]||0,a=i[n],s=Array.isArray(e[n]),l=Array.isArray(a),h=!s&&l;h?e[n]=this._interpolationFunction(a,r):"object"==typeof a&&a?this._updateProperties(e[n],o,a,r):"number"==typeof(a=this._handleRelativeValue(o,a))&&(e[n]=o+(a-o)*r)}},e.prototype._handleRelativeValue=function(e,t){return"string"!=typeof t?t:"+"===t.charAt(0)||"-"===t.charAt(0)?e+parseFloat(t):parseFloat(t)},e.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],i=this._valuesEnd[e];"string"==typeof i?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(i):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},e}();l.nextId;var d=h;d.getAll.bind(d),d.removeAll.bind(d),d.add.bind(d),d.remove.bind(d);var u=d.update.bind(d)}),parcelRequire.register("9Mq5w",function(e,t){var i,r,n,o=e.exports={};function a(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function l(e){if(i===setTimeout)return setTimeout(e,0);if((i===a||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}function h(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{return r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:a}catch(e){i=a}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var c=[],d=!1,u=-1;function p(){d&&n&&(d=!1,n.length?c=n.concat(c):u=-1,c.length&&m())}function m(){if(!d){var e=l(p);d=!0;for(var t=c.length;t;){for(n=c,c=[];++u<t;)n&&n[u].run();u=-1,t=c.length}n=null,d=!1,h(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}o.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];c.push(new f(e,t)),1!==c.length||d||l(m)},f.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}),parcelRequire.register("9SxgN",function(e,t){$parcel$export(e.exports,"OBJExporter",()=>r);var i=parcelRequire("4xklQ");class r{parse(e){let t="",r=0,n=0,o=0,a=new i.Vector3,s=new i.Color,l=new i.Vector3,h=new i.Vector2,c=[];function d(e){let s=0,d=0,u=0,p=e.geometry,m=new i.Matrix3,f=p.getAttribute("position"),g=p.getAttribute("normal"),y=p.getAttribute("uv"),x=p.getIndex();if(t+="o "+e.name+"\n",e.material&&e.material.name&&(t+="usemtl "+e.material.name+"\n"),void 0!==f)for(let i=0,r=f.count;i<r;i++,s++)a.fromBufferAttribute(f,i),a.applyMatrix4(e.matrixWorld),t+="v "+a.x+" "+a.y+" "+a.z+"\n";if(void 0!==y)for(let e=0,i=y.count;e<i;e++,u++)h.fromBufferAttribute(y,e),t+="vt "+h.x+" "+h.y+"\n";if(void 0!==g){m.getNormalMatrix(e.matrixWorld);for(let e=0,i=g.count;e<i;e++,d++)l.fromBufferAttribute(g,e),l.applyMatrix3(m).normalize(),t+="vn "+l.x+" "+l.y+" "+l.z+"\n"}if(null!==x)for(let e=0,i=x.count;e<i;e+=3){for(let t=0;t<3;t++){let i=x.getX(e+t)+1;c[t]=r+i+(g||y?"/"+(y?n+i:"")+(g?"/"+(o+i):""):"")}t+="f "+c.join(" ")+"\n"}else for(let e=0,i=f.count;e<i;e+=3){for(let t=0;t<3;t++){let i=e+t+1;c[t]=r+i+(g||y?"/"+(y?n+i:"")+(g?"/"+(o+i):""):"")}t+="f "+c.join(" ")+"\n"}r+=s,n+=u,o+=d}function u(e){let i=0,n=e.geometry,o=e.type,s=n.getAttribute("position");if(t+="o "+e.name+"\n",void 0!==s)for(let r=0,n=s.count;r<n;r++,i++)a.fromBufferAttribute(s,r),a.applyMatrix4(e.matrixWorld),t+="v "+a.x+" "+a.y+" "+a.z+"\n";if("Line"===o){t+="l ";for(let e=1,i=s.count;e<=i;e++)t+=r+e+" ";t+="\n"}if("LineSegments"===o)for(let e=1,i=e+1,n=s.count;e<n;e+=2,i=e+1)t+="l "+(r+e)+" "+(r+i)+"\n";r+=i}function p(e){let i=0,n=e.geometry,o=n.getAttribute("position"),l=n.getAttribute("color");if(t+="o "+e.name+"\n",void 0!==o){for(let r=0,n=o.count;r<n;r++,i++)a.fromBufferAttribute(o,r),a.applyMatrix4(e.matrixWorld),t+="v "+a.x+" "+a.y+" "+a.z,void 0!==l&&(s.fromBufferAttribute(l,r).convertLinearToSRGB(),t+=" "+s.r+" "+s.g+" "+s.b),t+="\n";t+="p ";for(let e=1,i=o.count;e<=i;e++)t+=r+e+" ";t+="\n"}r+=i}return e.traverse(function(e){!0===e.isMesh&&d(e),!0===e.isLine&&u(e),!0===e.isPoints&&p(e)}),t}}}),parcelRequire.register("47Y2g",function(e,t){$parcel$export(e.exports,"MobileMain",()=>w);var i=parcelRequire("g4HAh"),r=parcelRequire("7WCxl"),n=parcelRequire("ia4Lh"),o=parcelRequire("4xklQ"),a=parcelRequire("9HO6e"),s=parcelRequire("dVRrd"),l=parcelRequire("gDTsF"),h=parcelRequire("3BPdS"),c=parcelRequire("kLdsz"),d=parcelRequire("eTLBN"),u=parcelRequire("hWloQ"),p=parcelRequire("gMHcS");let{unify:m,subtract:f,intersect:g,innerClip:y,outerClip:x}=d;class w{static update3dScene(){editor.wallGroup3D.children.slice(0).forEach(e=>{e.useScene||e.parent.remove(e)}),editor.floorGroup.children=[],editor.floorGroup2d.children.slice(0).forEach(e=>{let t=e.room;t.generateWall3D(),t.innerWall3Ds.length>0&&editor.wallGroup3D.add(...t.innerWall3Ds),editor.wallGroup3D.add(...t.wall3Ds),editor.floorGroup.add(t.floor3D)}),editor.floorGroup.position.y=.01}static readCache(e){if(!e)return;e=JSON.parse(e),editor.list.removeAll.dispatch("noSave",!1);let t=0;e.roomArr.forEach(i=>{let r=new c.Room(i);if(e.baseWalls){let i=e.baseWalls[t];for(let e=0;e<r.baseWalls.length;e++){let t=w.getWallInnerPoint(r.baseWalls[e]);i.forEach(i=>{if((0,a.UtilCore).checkSameWallByPoint(i.start,i.end,t[0],t[1]))for(let t in i)"start"!=t&&"end"!=t&&(r.baseWalls[e][t]=i[t])})}}let n=[r.floor].concat(r.baseWalls);w.addRoomMain(n),e.roomNameArr[t]&&(r.roomName=e.roomNameArr[t],r.floor.area=e.roomNameArr[t]+"\n"+r.floor.area),w.updateRoomNamePosition(r.floor),t++});let i=0;editor.floorGroup2d.children.slice(0).forEach(t=>{let r=t.room;e.innerWalls[i]&&e.innerWalls[i].forEach(e=>{let t=!!e.autoCompletion&&e.autoCompletion,i=(0,c.Room).addWall(1,t,r,(0,l.point)(e.start.x,e.start.y),(0,l.point)(e.end.x,e.end.y))[0];i.thickness=e.thickness,i.positionLock=e.positionLock,i.lengthLock=e.lengthLock,editor.wallGroup.add(i)}),i++});let r=editor.toolType;e.windowArr.forEach(e=>{editor.currentPoint=new o.Vector3(e.position[0],e.position[1],0),editor.toolType=e.modelType,new(0,p.DrawDoorCommand)({noShowDialog:!0,modelType:e.modelType,windowThick:e.windowThick,width:e.width,LWidth:e.LWidth,RWidth:e.RWidth,dir:e.doorDir,positionLock:e.positionLock,lengthLock:e.lengthLock}).execute()}),e.outerWalls&&e.outerWalls.forEach(e=>{let t=!!e.autoCompletion&&e.autoCompletion,i=(0,c.Room).addWall(1,t,!1,(0,l.point)(e.start.x,e.start.y),(0,l.point)(e.end.x,e.end.y)),r=i[0];r.thickness=e.thickness,r.positionLock=e.positionLock,r.lengthLock=e.lengthLock,editor.wallGroup.add(r),editor.wallGroup3D.add(i[1])}),editor.toolType=r,w.updateLineDimensionsLine()}static updateRoomNamePosition(e){e.updateMatrixWorld();let t=(0,s.MobileListener).getFloorCenter(e);e.room.roomName&&0>e.area.indexOf(e.room.roomName)&&(e.area=e.room.roomName+"\n"+e.area);let i=editor.getScreenPosition(t.clone()),r=document.getElementById("roomName"+e.room.uuid);r.innerText=e.area+"m\xb2",r.setAttribute("worldPosition",t.x+"/"+t.y+"/1"),r.setAttribute("center",t.x.toFixed(2)+"/"+t.y.toFixed(2)),e.roomCenter=[t.x.toFixed(2),t.y.toFixed(2)],r.style.marginTop=i.y+"px",r.style.marginLeft=i.x+"px"}static updateLineDimensionsLine(){let e=[],t=[],i=new u.WallHelp;editor.pointHelperGroup.children.slice(0).forEach(e=>{e.useType="dragPoint",e.parent.remove(e)}),editor.floorGroup2d.children.forEach(r=>{if(r.visible){e=e.concat(r.allRoomPoints);for(let e=0;e<r.allRoomPoints.length;e++){let n=r.allRoomPoints[e],o=r.allRoomPoints[0];e!=r.allRoomPoints.length-1&&(o=r.allRoomPoints[e+1]),t.push([r.allRoomPoints[e],o]);let s=!1;if(editor.pointHelperGroup.children.slice(0).forEach(e=>{e.center&&(0,a.UtilCore).isSameVector(n,e.center)&&(s=!0)}),!s){let e=i.createDragPoint(n,"",240);e.useType="wallExtremePoint";let t=editor.getPointScale();e.scale.set(t,t,1),editor.pointHelperGroup.add(e)}}}});let r=[],n=[],s=e[0],h=e[0],c=e[0],d=e[0];if(e.forEach(e=>{0>r.indexOf(e.x)&&r.push(e.x),0>n.indexOf(e.y)&&n.push(e.y),e.x>h.x&&(h=e),e.x<s.x&&(s=e),e.y>c.y&&(c=e),e.y<d.y&&(d=e)}),editor.helperGroup.children.slice(0).forEach(e=>{"outerLine"==e.useType&&(editor.removeInputByClassName(editor.uiPanelBox.dom,"showWallLength"+e.uuid),editor.helperGroup.remove(e))}),0==e.length)return;let p=Math.min.apply(null,r),m=Math.max.apply(null,r),f=Math.min.apply(null,n),g=Math.max.apply(null,n),y=1500,x=[[(0,l.point)(p-y,g),(0,l.point)(p-y,f)],[(0,l.point)(p,f-y),(0,l.point)(m,f-y)],[(0,l.point)(m+y,f),(0,l.point)(m+y,g)],[(0,l.point)(p,g+y),(0,l.point)(m,g+y)]],b=new l.Segment(x[0][0],x[0][1]),v=new l.Segment(x[1][0],x[1][1]),M=new l.Segment(x[2][0],x[2][1]),S=new l.Segment(x[3][0],x[3][1]),P=[],T=[],_=[],C=[],D=[];if(t.forEach(e=>{let t=new o.Vector3(1,0),i=new o.Vector3(0,1),r=e[0].clone().sub(e[1]);r.clone().dot(t),r.clone().dot(i),t.length(),i.length();let n=new l.Segment((0,l.point)(e[0].x,e[0].y),(0,l.point)(e[1].x,e[1].y)),s=n.distanceTo(b),h=n.distanceTo(M),c=s[0]<h[0]?x[0]:x[2],d=s[0]<h[0]?"left":"right",u=(0,a.UtilCore).handleLineData(c[0],c[1]),p=(0,a.UtilCore).smallDistanceByPointOnLine(u,e[0]),m=(0,a.UtilCore).smallDistanceByPointOnLine(u,e[1]);"left"==d&&T.push((0,l.point)(p.x,p.y),(0,l.point)(m.x,m.y)),"right"==d&&C.push((0,l.point)(p.x,p.y),(0,l.point)(m.x,m.y));let f=n.distanceTo(v),g=n.distanceTo(S);c=f[0]<g[0]?x[1]:x[3],d=f[0]<g[0]?"bot":"top",u=(0,a.UtilCore).handleLineData(c[0],c[1]),p=(0,a.UtilCore).smallDistanceByPointOnLine(u,e[0]),m=(0,a.UtilCore).smallDistanceByPointOnLine(u,e[1]),"bot"==d&&_.push((0,l.point)(p.x,p.y),(0,l.point)(m.x,m.y)),"top"==d&&D.push((0,l.point)(p.x,p.y),(0,l.point)(m.x,m.y))}),0==T.length||0==_.length||0==C.length||0==D.length)return;let A=[b.sortPoints(T),v.sortPoints(_),M.sortPoints(C),S.sortPoints(D)],E=0;T=(A=w.sortPointByLine([T,_,C,D],[b,v,M,S]))[0],_=A[1],C=A[2],D=A[3];let L=w.getResWall(w.getWallByPoint(s),s,new o.Vector3(0,1,0)),I=w.getResWall(w.getWallByPoint(h),h,new o.Vector3(0,1,0)),R=w.getResWall(w.getWallByPoint(c),c,new o.Vector3(1,0,0)),W=w.getResWall(w.getWallByPoint(d),d,new o.Vector3(1,0,0)),V=A[1][0].x<A[1][A[1].length-1].x?A[1][0]:A[1][A[1].length-1],k=A[1][0].x>A[1][A[1].length-1].x?A[1][0]:A[1][A[1].length-1],B=A[0][0].y>A[0][A[0].length-1].y?A[0][0]:A[0][A[0].length-1],O=A[0][0].y<A[0][A[0].length-1].x?A[0][0]:A[0][A[0].length-1];_.push(w.toPoint((0,a.UtilCore).toVector2(V).add(new(0,o.Vector2)(-1,0).setLength(L.thickness?L.thickness:240)))),_.push(w.toPoint((0,a.UtilCore).toVector2(k).add(new(0,o.Vector2)(1,0).setLength(I.thickness?I.thickness:240)))),T.push(w.toPoint((0,a.UtilCore).toVector2(B).add(new(0,o.Vector2)(0,1).setLength(R.thickness?R.thickness:240)))),T.push(w.toPoint((0,a.UtilCore).toVector2(O).add(new(0,o.Vector2)(0,-1).setLength(W.thickness?W.thickness:240)))),(A=w.sortPointByLine([T,_,C,D],[b,v,M,S])).forEach(e=>{let t=new o.Vector3(1,0,0);1==E&&(t=new o.Vector3(0,1,0)),2==E&&(t=new o.Vector3(-1,0,0)),3==E&&(t=new o.Vector3(0,-1,0));for(let i=0;i<e.length;i++){if(i==e.length-1)continue;let r=e[i+1],n=w.addLineWallHelper(e[i],r,t);editor.helperGroup.add(n),P.push(n)}E++}),P.forEach(e=>{e.useType="outerLine"}),editor.updateDom()}static sortPointByLine(e,t){e[0]=t[0].sortPoints(e[0]),e[1]=t[1].sortPoints(e[1]),e[2]=t[2].sortPoints(e[2]),e[3]=t[3].sortPoints(e[3]);let i=e[0][0],r=e[0][e[0].length-1];i.y<r.y&&(i=r,r=e[0][0]);let n=e[2][0],o=e[2][e[2].length-1];n.y<o.y&&(n=o,o=e[2][0]);let a=e[1][0],s=e[1][e[1].length-1];a.x>s.x&&(a=s,s=e[1][0]);let h=e[3][0],c=e[3][e[3].length-1];return h.x>c.x&&(h=c,c=e[3][0]),i.y!=n.y&&(i.y>n.y?e[2].push((0,l.point)(n.x,i.y)):e[0].push((0,l.point)(i.x,n.y))),r.y!=o.y&&(r.y<o.y?e[2].push((0,l.point)(o.x,r.y)):e[0].push((0,l.point)(r.x,o.y))),a.x!=h.x&&(a.x>h.x?e[1].push((0,l.point)(h.x,a.y)):e[3].push((0,l.point)(a.x,h.y))),s.x!=c.x&&(s.x<c.x?e[1].push((0,l.point)(c.x,s.y)):e[3].push((0,l.point)(s.x,c.y))),[t[0].sortPoints(e[0]),t[1].sortPoints(e[1]),t[2].sortPoints(e[2]),t[3].sortPoints(e[3])]}static toPoint(e){return(0,l.point)(e.x,e.y)}static getResWall(e,t,i){let r="1",n="";return e.forEach(e=>{let o=w.getMeshOtherPoint(e,t).clone().sub(t).angleTo(i);("1"==r||o<r)&&(n=e,r=o)}),n}static addLineWallHelper(e,t,i,r=280,n="#07FE4A",a=6){e=new o.Vector3(e.x,e.y,0),t=new o.Vector3(t.x,t.y,0),i.setLength(r);let s=e.clone().add(i),l=t.clone().add(i),c=w.createEndpoint(e.clone(),i),d=w.createEndpoint(t.clone(),i),u=e.clone().add(s.clone().sub(l).setLength(100)),p=t.clone().add(l.clone().sub(s).setLength(100)),m=[s,c[0],e,c[1],c[2],c[3],c[4],e,u,p,t,d[0],t,d[1],d[2],d[3],d[4],t,l],f=w.addLine(m,1.5,n);f.position.z=5;let g=new o.Vector3((e.x+t.x)/2,(e.y+t.y)/2,0),y=Math.round(e.clone().distanceTo(t.clone()));f.center=g,f.lineLength=y,f.startPoint=e,f.endPoint=t;let x=new(0,o.Vector2)(e.x,e.y).sub(new o.Vector2(t.x,t.y)).angle();(x=180/Math.PI*x)>180&&x<270?x=360-x+180:x>90&&x<=180?(x*=-1,x+=180):x=360-x,f.fontAngle=x;let b=editor.getScreenPosition(f.center.clone()),v=new(0,h.UIText)(f.lineLength).setClass("showWallLength"+f.uuid).setWidth("40px").setMarginTop(b.y+"px").setMarginLeft(b.x+"px").setStyle(["transform"],["rotate("+x+"deg)"]),M=f.center.x+"/"+f.center.y+"/"+f.center.z;return v.setAttribute("worldPosition",M),v.setAttribute("angle",x),f.domClass="showWallLength"+f.uuid,0!=f.lineLength&&editor.uiPanelBox.add(v),f}static updateScene(e){let t=e.room;editor.floorGroup2d.children.slice(0).forEach(i=>{if(e.room.uuid==i.room.uuid)return;let r=i.room,n=g(r.flattenPolygon,t.cPoly);if(n.vertices.length&&n.area()>1e3){r.booleanRoom.push(t),t.booleanRoom.push(r);let e=f(m(r.flattenPolygon,t.cPoly),t.cPoly).toJSON()[0],i=[];for(let t in e)0==t?i.push([e[t].ps.x,e[t].ps.y],[e[t].pe.x,e[t].pe.y]):i.push([e[t].pe.x,e[t].pe.y]);let n=r.updatePolygon(i);w.updateRoomNamePosition(n)}})}static containsArray(e,t){return e.some(e=>JSON.stringify(e)===JSON.stringify(t))}static updateAllScene(e){let t=[];return e.allRoomPoints.forEach(e=>{w.containsArray(t,[e.x,e.y])||t.push([e.x,e.y])}),t.push(t[0]),e.room.updatePolygon(t)}static addRoomMain(e){let t="";return e.forEach(i=>{if(i.oldPosition=i.position.clone(),"wall"==i.useType&&editor.wallGroup.add(i),"floor"==i.useType&&editor.floorGroup2d.add(i),"3dwall"==i.useType&&editor.wallGroup3D.add(i),"3dfloor"==i.useType&&(editor.floorGroup.add(i),editor.floorGroup.position.y=.01),"floor"==i.useType){t=i;let r=i.area,n=(0,s.MobileListener).getFloorCenter(i),o=editor.getScreenPosition(n.clone()),a=new(0,h.UIText)(r+"m\xb2").setId("roomName"+i.room.uuid).setClass("roomName").setStyle(["white-space"],["pre"]).setMarginTop(o.y+"px").setMarginLeft(o.x+"px");a.setAttribute("worldPosition",n.x+"/"+n.y+"/1"),a.setAttribute("roomArea",r+"m\xb2"),a.setAttribute("center",n.x.toFixed(2)+"/"+n.y.toFixed(2)),i.roomCenter=[n.x.toFixed(2),n.y.toFixed(2)],i.allPoints=i.allRoomPoints.slice(0),editor.uiPanelBox.add(a),editor.floorGroup2d.add(i),i.moveRoomArr=e}}),t}static adsorptionWall(e,t){let i=t.clone().sub(editor.downPoint).clone(),r=[],n=w.getWallInnerPoint(e);(n=n.concat(w.getWallOuterPoint(e))).forEach(e=>{editor.floorGroup2d.children.forEach(t=>{let i=t.allRoomPoints;for(let t=0;t<i.length;t++){let n=i[0];t<i.length-1&&(n=i[t+1]);let s=new l.Line(new l.Point(i[t].x,i[t].y),new l.Point(n.x,n.y)),h=w.getWallByInnerPoint(i[t],n),c=new(0,l.Point)(e.x,e.y).projectionOn(s);c=(0,a.UtilCore).toVector2(c);let d=new o.Vector2(e.x,e.y),u=Math.round(c.distanceTo(d)),p=i[t],m=n;if(u>270)continue;let f=c.clone().sub(d).normalize(),g={dir:f,dis:u,p1:p,p2:m,current:c,centerWall:h,roomPoint:e},y=!1;r.forEach(e=>{(0,a.UtilCore).isMobileSameVector(e.dir,f,!1)&&(y=!0,e.dis>u&&(e=g))}),y||r.push(g)}})}),r.forEach(e=>{w.addAdsorptionLine(e.p1,e.p2);let t=(0,a.UtilCore).toVector3(e.current).clone().sub(e.roomPoint);t.z=0,i.add(t)}),editor.lastMoveVec||(editor.lastMoveVec=new o.Vector2(0,0));let s=i.clone();i.sub(editor.lastMoveVec),editor.lastMoveVec=s.clone(),e.position.copy(editor.currentPoint)}static adsorptionRoom(e,t){let i=t.clone().sub(editor.downPoint),r=i.clone();editor.moveRoomArr.forEach(e=>{e.updateMatrixWorld(),"floor"==e.useType&&(e.allRoomPoints=[],e.allPoints.forEach(t=>{let r=t.clone().add(i);e.allRoomPoints.push(r)}))});let n=e.allRoomPoints;editor.helperGroup.children.slice(0).forEach(e=>{"drawLine"==e.name&&editor.helperGroup.remove(e)});let s=[];n.forEach(t=>{editor.floorGroup2d.children.forEach(i=>{if(i.room.uuid==e.room.uuid)return;let r=i.allRoomPoints;for(let e=0;e<r.length;e++){let i=r[0];e<r.length-1&&(i=r[e+1]);let n=new l.Line(new l.Point(r[e].x,r[e].y),new l.Point(i.x,i.y)),h=w.getWallByInnerPoint(r[e],i),c=w.getWallOuterPoint(h),d=new l.Line(new l.Point(c[0].x,c[0].y),new l.Point(c[1].x,c[1].y)),u=new(0,l.Point)(t.x,t.y).projectionOn(n),p=new(0,l.Point)(t.x,t.y).projectionOn(d);u=(0,a.UtilCore).toVector2(u),p=(0,a.UtilCore).toVector2(p);let m=new o.Vector2(t.x,t.y),f=u.distanceTo(m)<p.distanceTo(m),g=Math.round(u.distanceTo(m)),y=f?r[e]:c[0],x=f?i:c[1];if(g>270)continue;let b=u.clone().sub(m).normalize(),v={dir:b,dis:g,p1:y,p2:x,current:u,centerWall:h,roomPoint:t,disFlag:f};f||(v.current=p);let M=!1;s.forEach(e=>{(0,a.UtilCore).isMobileSameVector(e.dir,b,!1)&&(M=!0,e.dis>g&&(e=v))}),M||s.push(v)}})}),s.forEach(e=>{w.addAdsorptionLine(e.p1,e.p2);let t=(0,a.UtilCore).toVector3(e.current).clone().sub(e.roomPoint);t.z=0,r.add(t)}),editor.lastMoveVec||(editor.lastMoveVec=new o.Vector2(0,0));let h=r.clone();r.sub(editor.lastMoveVec),editor.lastMoveVec=h.clone();let c="";editor.moveRoomArr.forEach(e=>{"floor"==e.useType&&(e.room.roomMove(r),c=e.room)}),r.z=0;let d=editor.currentPoint.clone();editor.doorGroup.children.slice(0).forEach(e=>{w.checkDoorIsInRoom(e,c)&&(editor.currentPoint=e.position.add(r),new(0,p.DrawDoorCommand)({currentDoor:e,valueType:"centerPoint",moveType:"centerDrag",noShowDialog:!0}).main())}),editor.currentPoint=d.clone()}static getNewWindowPosition(e,t,i){if(!t.centerWall){t.parent&&t.parent.remove(t);return}let r=t.leftWindow&&t.leftWindow[0]&&(i.uuid==t.leftWindow[0].uuid||i.uuid==t.rightWindow[0].uuid);if(!(t.centerWall.uuid==i.uuid||r))return"";if("UWindow"==t.modelType&&(i.uuid==t.leftWindow[0].uuid||i.uuid==t.rightWindow[0].uuid))return t.position.clone();let n=(0,a.UtilCore).toVector3(e[0][0]),o=(0,a.UtilCore).toVector3(e[1][0]),s=n.clone().add(e[0][1]),h=o.clone().add(e[1][1]),c=new l.Line(new l.Point(n.x,n.y),new l.Point(o.x,o.y)),d=(0,l.point)(t.position.x,t.position.y).projectionOn(c),u=(0,a.UtilCore).toVector3(d).distanceTo(n),p=(0,a.UtilCore).toVector3(d).distanceTo(o),m=s.clone().sub(h);return u<p?s.add(m.negate().setLength(u)):h.add(m.setLength(p))}static adsorptionPointByWall(e,t=""){return editor.helperGroup.children.slice(0).forEach(e=>{"drawLine"==e.name&&editor.helperGroup.remove(e)}),editor.wallGroup.children.slice(0).forEach(i=>{if(t){let e=!1;if(t.forEach(t=>{t.uuid==i.uuid&&(e=!0)}),e)return}let r=w.getWallInnerPoint(i),n=w.getWallOuterPoint(i),o=new l.Line(new l.Point(r[0].x,r[0].y),new l.Point(r[1].x,r[1].y)),a=new l.Line(new l.Point(n[0].x,n[0].y),new l.Point(n[1].x,n[1].y)),s=new l.Point(e.x,e.y),h=s.distanceTo(o)[0]<s.distanceTo(a)[0],c=h?s.distanceTo(o)[0]:s.distanceTo(a)[0],d=h?o:a;if(c<240){let t=s.projectionOn(d);e.x=t.x,e.y=t.y,w.addAdsorptionLine(r[0],r[1])}}),e}static adsorptionPoint(e,t="",i=""){let r=[];return editor.floorGroup2d.children.forEach(e=>{i&&i.room.uuid==e.room.uuid||(r=r.concat(e.allRoomPoints))}),editor.helperGroup.children.slice(0).forEach(e=>{"drawLine"==e.name&&editor.helperGroup.remove(e)}),r.forEach(i=>{!(t&&(0,a.UtilCore).isSameVector(t,i))&&(240>Math.abs(e.x-i.x)&&(e.x=i.x,w.addAdsorptionLine(e,i)),240>Math.abs(e.y-i.y)&&(e.y=i.y,w.addAdsorptionLine(e,i)))}),e}static getSpecialArr(){let e=[];return editor.wallGroup.children.slice(0).forEach(t=>{let i=w.getWallInnerPoint(t);e.push([i[0],i[1]])}),e}static adsorptionPointNew(e,t,i=""){let r=new l.Point(e.x,e.y),n="",o=!1,s="",h=[];return editor.helperGroup.children.slice(0).forEach(e=>{"drawLine"==e.name&&editor.helperGroup.remove(e)}),t.forEach(t=>{if(o)return;let c=new l.Point(t[0].x,t[0].y),d=new l.Point(t[1].x,t[1].y),u=new l.Line(c,d),p=r.projectionOn(u),m=r.distanceTo(u)[0],f=c.distanceTo(r)[0],g=d.distanceTo(r)[0],y="";if(f<240&&(y=t[0].clone()),g<240&&(y=t[1].clone()),""!=y){let i=f<g?f:g;if(s&&s<i)return;s=i,e=y.clone(),w.addAdsorptionLine(t[0],t[1]),o=!0;return}if(m<editor.config.pointArea){if(n&&m>n)return;n=m,e=(0,a.UtilCore).toVector3(p);let i=c.distanceTo(p),r=d.distanceTo(p);(i<editor.config.pointArea||r<editor.config.pointArea)&&(i<editor.config.pointArea&&(e=(0,a.UtilCore).toVector3(c)),r<editor.config.pointArea&&(e=(0,a.UtilCore).toVector3(d))),w.addAdsorptionLine(t[0],t[1]),h.push(t[0],t[1])}else{if(i&&((0,a.UtilCore).isSameVector(i,t[0])||(0,a.UtilCore).isSameVector(i,t[1])))return;let r=!0,n=!0;h.forEach(e=>{(0,a.UtilCore).isSameVector(t[0],e)&&(r=!1),(0,a.UtilCore).isSameVector(t[1],e)&&(n=!1)}),Math.abs(t[0].x-e.x)<editor.config.pointArea-90&&r&&(e.x=t[0].x),Math.abs(t[0].y-e.y)<editor.config.pointArea-90&&r&&(e.y=t[0].y),Math.abs(t[1].x-e.x)<editor.config.pointArea-90&&n&&(e.x=t[1].x),Math.abs(t[1].y-e.y)<editor.config.pointArea-90&&n&&(e.y=t[1].y)}}),e}static addAdsorptionLine(e,t){let i=e.clone().add(t.clone().sub(e).setLength(1e5)),r=e.clone().add(e.clone().sub(t).setLength(1e5)),n=w.addLine([i,r],1.5);n.name="drawLine";let o=w.addLine([i,r],1.5,"#000",!0);o.position.z=5,o.name="drawLine",editor.helperGroup.add(n,o)}static getSpecialPoint(e,t){let i=!1,r=new o.Vector3;t.clone();let n=[],l=[];editor.floorGroup2d.children.forEach(t=>{t.room.uuid!=e.room.uuid&&(n=n.concat(t.allRoomPoints),l.push([t.allRoomPoints,t]))});let h=e.allRoomPoints;editor.helperGroup.children.slice(0).forEach(e=>{"drawLine"==e.name&&editor.helperGroup.remove(e)});let c=[];return h.forEach(e=>{let t=[];n.forEach(e=>{t.push(e.x,e.y)});for(let t=0;t<n.length;t++){let h=n[0];t<n.length-1&&(h=n[t+1]);let d=(0,a.UtilCore).handleLineData(n[t],h),u=(0,a.UtilCore).smallDistanceByPointOnLine(d,e),p=new o.Vector2(e.x,e.y);if(u.distanceTo(p)>600)continue;let m=u.clone().sub(p).normalize(),f=!1;if(c.forEach(e=>{(0,a.UtilCore).isSameVector(e,m)&&(f=!0)}),c.push(m),!f){let o=n[t].clone().add(h.clone().sub(n[t]).setLength(1e5)),c=n[t].clone().add(n[t].clone().sub(h).setLength(1e5)),p=w.addLine([o,c],1.5);p.name="drawLine";let m=w.addLine([o,c],1.5,"#000",!0);m.position.z=5,m.name="drawLine",editor.helperGroup.add(p,m);let f="";l.forEach(e=>{if(e[0].forEach(i=>{if((0,a.UtilCore).isSameVector(i,n[t])){f=e[1];return}}),f)return});let g=(0,s.MobileListener).getFloorCenter(f),y=(0,a.UtilCore).smallDistanceByPointOnLine(d,g),x=480,b=u.clone().add(y.clone().sub(g).setLength(x));r.add(b.clone().sub(e)),i=!0}}}),[r=new o.Vector3(r.x,r.y,0),i]}static addAngleHelper(e,t,i,r=3){let n=e.clone().distanceTo(t),s=e.clone().distanceTo(i),l=n<s?n:s,c=t.clone().sub(e),d=i.clone().sub(e),u=(0,a.UtilCore).toVector3(c).angleTo((0,a.UtilCore).toVector3(d));u=1*(180/Math.PI*u).toFixed(1);let p=(0,a.UtilCore).toVector2(c).angle(),m=(0,a.UtilCore).toVector2(d).angle(),f=(0,a.UtilCore).getClockWise(t,e,i);f=f>0;let g=new o.EllipseCurve(e.x,e.y,l/r,l/r,p,m,f).getPoints(50),y=w.addRealLine(g);y.name="drawAngleLine",y.position.z=5,editor.helperGroup.add(y);let x=g[Math.round(g.length/2)],b=editor.getScreenPosition((0,a.UtilCore).toVector3(x)),v=new(0,h.UIText)(u+"\xb0").setClass("showMoveAngle").setFontSize("15px").setWidth("40px").setMarginTop(b.y+"px").setMarginLeft(b.x+"px"),M=x.x+"/"+x.y+"/0";return v.setAttribute("worldPosition",M),v.setAttribute("angle",u),editor.uiPanelBox.add(v),u}static addRoomInnerLine(e){let t=e.allRoomPoints,i=[];t.forEach(e=>{i.push(e.clone())});let r=i[0];i.push(r);let n=w.addLine(i);n.name="roomOuterLine",editor.helperGroup.add(n)}static getLinkPoint(e,t){let i=0,r=t[t.length-1],n=t[0],o=t[0],s=t[0],l=0;for(let r=0;r<t.length;r++)(0,a.UtilCore).isSameVector(e,t[r])&&(i=r,l++);return 1!=l&&(t.splice(i,1),i-=1),i<t.length-1&&(n=t[i+1]),0!=i&&(r=t[i-1]),i==t.length-2&&(s=t[0]),i==t.length-1&&(s=t[1]),i!=t.length-2&&i!=t.length-1&&(s=t[i+2]),0==i&&(o=t[t.length-2]),1==i&&(o=t[t.length-1]),0!=i&&1!=i&&(o=t[i-2]),[r,o,n,s]}static getRoomByPoint(e){let t=[];return editor.floorGroup2d.children.slice(0).forEach(i=>{let r=i.allRoomPoints,n=!1;r.forEach(t=>{(0,a.UtilCore).isSameVector(t,e)&&(n=!0)}),n&&t.push(i)}),t}static addPointHelper(e){let t=w.getRoomByPoint(e);if(1!=t.length)return;let i=w.getLinkPoint(e,t[0].allRoomPoints),r=w.createMoveHelper(e,4),n=w.getWallByInnerPoint(e,i[2]),o=w.getWallByInnerPoint(e,i[0]);r.pointArr=[e,i[2],i[0],i[3],i[1],t[0],[n,o]],r.useType="extremePoint",r.name="roomOuterLine",editor.helperGroup.add(r)}static updateRoomNameVal(e){editor.removeInputById(editor.uiPanelBox.dom,"roomName"+e.room.uuid);let t=(0,s.MobileListener).getFloorCenter(e),i=editor.getScreenPosition(t.clone());e.room.roomName&&0>e.area.indexOf(e.room.roomName)&&(e.area=e.room.roomName+"\n"+e.area);let r=e.area,n=new(0,h.UIText)(r+"m\xb2").setId("roomName"+e.room.uuid).setClass("roomName").setStyle(["white-space"],["pre"]).setMarginTop(i.y+"px").setMarginLeft(i.x+"px");n.setAttribute("worldPosition",t.x+"/"+t.y+"/1"),n.setAttribute("roomArea",r+"m\xb2"),n.setAttribute("center",t.x.toFixed(2)+"/"+t.y.toFixed(2)),editor.uiPanelBox.add(n)}static addRoomHelper(e,t="",i=""){let r=(0,s.MobileListener).getFloorCenter(e),n=!1;t?n=w.checkAdsorb(w.getWallByInnerPoint(t,i)):w.updateRoomNameVal(e);let h=e.allRoomPoints;h||(h=e.allPoints);let c=[];e.updateMatrixWorld();let d=0,u=0;for(let r=0;r<h.length;r++){let s=h[r].clone();c.push(s);let p=w.createMoveHelper(s,4),m=h[0];r<h.length-1&&(m=h[r+1]);let f=new o.Vector3((m.x+h[r].x)/2,(m.y+h[r].y)/2,0),g=w.createMoveHelper(f,2),y=new(0,o.Vector2)(m.x,m.y).sub(new o.Vector2(h[r].x,h[r].y)).angle(),x=h[h.length-1];0!=r&&(x=h[r-1]);let b=h[0];r==h.length-2&&(b=h[0]),r==h.length-1&&(b=h[1]),r!=h.length-2&&r!=h.length-1&&(b=h[r+2]);let v=h[0];0==r&&(v=h[h.length-2]),1==r&&(v=h[h.length-1]),0!=r&&1!=r&&(v=h[r-2]),g.rotation.z=y+Math.PI/2;let M=w.getWallByInnerPoint(h[r],m),S=w.getWallByPoint(h[r]);if(0==S.length)continue;let P=w.getWallByPoint(m),T=S[0];T.uuid==M.uuid&&(T=S[1]),g.pointArr=[h[r],m,x,b,v,e,[M,T]],p.pointArr=[h[r],m,x,b,v,e,[M,T]],p.useType="extremePoint",g.useType="centerPoint",p.name="roomOuterLine",g.name="roomOuterLine";let _=[],C=[];S.forEach(e=>{e.positionLock&&_.push(e),e.lengthLock&&C.push(e)});let D=[];P.forEach(e=>{e.lengthLock&&D.push(e)});let A=_.length>=2||C.length>=2||_.length>=1&&C.length>=1;S.forEach(e=>{A||editor.doorGroup.children.slice(0).forEach(t=>{A||"UWindow"!=t.modelType||t.centerWall.uuid!=e.uuid&&t.leftWindow[0].uuid!=e.uuid&&t.rightWindow[0].uuid!=e.uuid||(A=!0)})});let E=M.positionLock||!M.lengthLock&&C.length+D.length>=1,L="";if(t){let e=t&&(0,a.UtilCore).isSameVector(t,h[r]),s=i&&(0,a.UtilCore).isSameVector(i,h[r]);e&&(d=r),s&&(u=r);let c=new o.Vector3((t.x+i.x)/2,(t.y+i.y)/2,0);if((e||s)&&!A&&editor.helperGroup.add(p),(0,a.UtilCore).isSameVector(c,f)&&!E&&editor.helperGroup.add(g),(0,a.UtilCore).isSameVector(c,f)&&!E&&n){let e=new(0,o.Vector2)(t.x,t.y).sub(new o.Vector2(i.x,i.y)).angle(),r=new(0,l.Point)(c.x,c.y).projectionOn(n),a=new(0,o.Vector3)(r.x,r.y,0).sub(c).normalize().setLength(1200);c.add(a),(L=w.createMoveHelper(c,2)).rotation.z=e+Math.PI/2,L.otherWallLine=n.corerArr,L.moveDir=a.clone().negate()}}else{E||editor.helperGroup.add(g),A||editor.helperGroup.add(p);let e=w.checkAdsorb(w.getWallByInnerPoint(s,m));if(e){let t=new(0,l.Point)(f.x,f.y).projectionOn(e),i=new(0,o.Vector3)(t.x,t.y,0).sub(f).normalize().setLength(1200),r=f.clone().add(i);(L=w.createMoveHelper(r,2)).rotation.z=y+Math.PI/2,L.otherWallLine=e.corerArr,L.moveDir=i.clone().negate()}}L&&(L.name="roomOuterLine",L.useType="publicCenterPoint",L.pointArr=[h[r],m,x,b,v,e,[M,T]],editor.helperGroup.add(L))}let p=c[0];c.push(p),t&&(c=[t,i]);let m=w.addLine(c);m.name="roomOuterLine",m.position.z=10;let f=new o.Box3().setFromObject(e),g=f.getSize(new o.Vector3),y=(r=r.clone()).clone();r.y-=g.y;let x=w.createRotHelper(r);return x.useType="rotatePoint",x.name="roomOuterLine",x.roomCenter=y.clone(),x.floorMsg=e,editor.helperGroup.add(m),e.rotationLock||t||editor.helperGroup.add(x),[d,u]}static addRealLine(e,t="#00ff00"){let i=new(0,o.BufferGeometry)().setFromPoints(e),r=new o.LineBasicMaterial({color:t}),n=new o.Line(i,r);return n}static addLine(e,t=5,a="#00ff00",s=!1){let l=[];e.forEach(e=>{l.push(e)});let h=[];l.forEach(e=>{h.push(e.x,e.y,0)});var c=new(0,i.LineGeometry)().setPositions(h),d=new r.LineMaterial({color:a,linewidth:t,dashed:s,side:o.DoubleSide,transparent:!1,dashSize:2,gapSize:5});d.resolution.set(window.innerWidth,window.innerHeight);var u=new n.Line2(c,d);return u.position.z=4,u.computeLineDistances(),u}static addCircle(e,t,i=400){var r=new o.CircleGeometry(i/3,32),n=new o.MeshBasicMaterial({color:t,transparent:!0}),a=new o.Mesh(r,n);return a.position.set(e.x,e.y,10),a.name="drawAngleLine",a}static createRotHelper(e,t=2){let i=new o.Group;i.position.copy(e),i.name="roomOuterLine",i.useType="dragPoint";let r=new o.CircleGeometry(500,32),n=new o.Mesh(r,new o.MeshBasicMaterial({color:"#000000",transparent:!0,opacity:.3}));n.position.z=50;let a=w.createArcArrowMesh(70);return i.add(a,n),i}static createArcArrowMesh(e){let t=new o.Shape;t.moveTo(5*e,0),t.lineTo(10*e/3,5*e),w.getArcPoint(new o.Vector2(0,0),new o.Vector2(5*e/2,5*e/2),new o.Vector2(5*e/2,-(5*e)/2),!1).forEach(e=>{t.lineTo(e.x,e.y)}),w.getArcPoint(new o.Vector2(0,0),new o.Vector2(5*e/4,-(5*e)/4),new o.Vector2(5*e/4,5*e/4),!0).forEach(e=>{t.lineTo(e.x,e.y)}),t.lineTo(0,0),t.lineTo(5*e,0);let i=new o.ShapeGeometry(t),r=new o.Mesh(i,new o.MeshBasicMaterial({color:"#fff"}));return r.position.z=60,r}static getArcPoint(e,t,i,r){let n=e.clone().distanceTo(t),s=e.clone().distanceTo(i),l=n<s?n:s,h=t.clone().sub(e),c=i.clone().sub(e),d=(0,a.UtilCore).toVector3(h).angleTo((0,a.UtilCore).toVector3(c));d=1*(180/Math.PI*d).toFixed(1);let u=(0,a.UtilCore).toVector2(h).angle(),p=(0,a.UtilCore).toVector2(c).angle();return new o.EllipseCurve(e.x,e.y,l,l,u,p,r).getPoints(50)}static createMoveHelper(e,t=2){let i=new o.Group;i.position.copy(e),i.name="roomOuterLine",i.useType="dragPoint";let r=new o.CircleGeometry(500,32),n=new o.Mesh(r,new o.MeshBasicMaterial({color:"#000000",transparent:!0,opacity:.3}));n.position.z=50;let a=70,s=w.createArrowMesh(a),l=90;s.position.x=l;let h=w.createArrowMesh(a);h.position.x=-l,h.rotation.z=Math.PI,i.add(n,s,h);let c=editor.getPointScale();if(i.scale.set(c,c,1),4!=t)return i;let d=w.createArrowMesh(a);d.position.y=l,d.rotation.z=Math.PI/2;let u=w.createArrowMesh(a);return u.position.y=-l,u.rotation.z=-Math.PI/2,i.add(d,u),i.name="roomOuterLine",i}static createArrowMesh(e=50){let t=new o.Shape;t.moveTo(0,0),t.lineTo(0,e),t.lineTo(e,e),t.lineTo(e,2*e),t.lineTo(5*e,0),t.lineTo(e,-(2*e)),t.lineTo(e,-e),t.lineTo(0,-e),t.lineTo(0,0);let i=new o.ShapeGeometry(t),r=new o.Mesh(i,new o.MeshBasicMaterial({color:"#fff"}));return r.position.z=60,r}static getWallJson(e){return{thickness:e.thickness?e.thickness:240,positionLock:!!e.positionLock&&e.positionLock,lengthLock:!!e.lengthLock&&e.lengthLock,autoCompletion:e.originMode}}static getAllJson(){let e={roomArr:[],windowArr:[],roomNameArr:[],innerWalls:[],outerWalls:[],baseWalls:[]};return editor.floorGroup2d.children.slice(0).forEach(t=>{let i=[],r=[];t.room.baseWalls.forEach(e=>{let t=w.getWallInnerPoint(e),i=w.getWallJson(e);i.start=t[0],i.end=t[1],r.push(i)}),t.room.innerWalls.forEach(e=>{let t=w.getWallJson(e);t.start=e.originPointA,t.end=e.originPointB,i.push(t)}),i.length>0&&e.innerWalls.push(i),r.length>0&&e.baseWalls.push(r);let n=t.allRoomPoints,o=[],a=t.area.split("\n");e.roomNameArr.push(a.length>1?a[0]:""),n.forEach(e=>{o.push([e.x,e.y])}),o.push(o[0]),e.roomArr.push(o)}),editor.doorGroup.children.slice(0).forEach(t=>{let i={modelType:t.modelType,position:[t.center.x,t.center.y,t.center.z],windowThick:t.wallDep,width:t.doorWid,doorDir:t.doorDir,positionLock:t.positionLock,lengthLock:t.lengthLock};t.leftWindow&&(i.LWidth=t.leftWindow[1],i.RWidth=t.rightWindow[1]),e.windowArr.push(i)}),editor.wallGroup.children.slice(0).forEach(t=>{if("outerRoom"==t.useScene){let i=w.getWallJson(t);i.start=t.originPointA,i.end=t.originPointB,e.outerWalls.push(i)}}),e}static checkWallAngle(e,t,i,r,n){let o=e.clone().sub(t),a=r.clone().sub(t),s=e.clone().sub(i),l=n.clone().sub(i),h=t.clone().sub(e),c=i.clone().sub(e);return[180*o.angleTo(a)/Math.PI,180*s.angleTo(l)/Math.PI,180*h.angleTo(c)/Math.PI]}static checkLineCross(e){let t=!1,i=e.allRoomPoints.slice(0),r=[];for(let e=0;e<i.length;e++){r.push((0,l.point)(i[e].x,i[e].y));let n=i[0];e!=i.length-1&&(n=i[e+1]);let o=(0,a.UtilCore).handleLineData(i[e],n);for(let r=0;r<i.length;r++){let s=i[r],l=i[0];if(r!=i.length-1&&(l=i[r+1]),r==e)continue;let h=(0,a.UtilCore).handleLineData(s,l),c=(0,a.UtilCore).lineIsIntersection(o,h);if(c){let r=(0,a.UtilCore).checkWallContainPoint(c.x,c.y,s.x,s.y,l.x,l.y),o=(0,a.UtilCore).checkWallContainPoint(c.x,c.y,i[e].x,i[e].y,n.x,n.y);r&&o&&(t=!0)}}}if(t)return t;let n=new l.Polygon;return n.addFace(r),editor.floorGroup2d.children.forEach(i=>{if(i.room.uuid==e.room.uuid)return;let r=i.allRoomPoints.slice(0),o=[];r.forEach(e=>{o.push((0,l.point)(e.x,e.y))});let a=new l.Polygon;if(a.addFace(o),0!=n.intersect(a).length){t=!0;return}}),t}static getLineIntersectionPoint(e,t){let i=(0,l.point)(e.x,e.y),r=(0,l.vector)(1,0),n=(0,l.vector)(0,1);"hWall"==t&&(r=(0,l.vector)(0,1),n=(0,l.vector)(1,0));let o="",a="",s="",h="",c="",d="",u="",p=(0,l.ray)(i,r),m=(0,l.ray)(i,r.invert()),f=(0,l.ray)(i,n),g=(0,l.ray)(i,n.invert());return editor.floorGroup2d.children.forEach(e=>{let t=[],r=[],n=e.allRoomPoints.slice(0);for(let e=0;e<n.length;e++){t.push((0,l.point)(n[e].x,n[e].y));let i=n[0];e!=n.length-1&&(i=n[e+1]),r.push([(0,l.point)(n[e].x,n[e].y),(0,l.point)(i.x,i.y)])}let y=new l.Polygon;y.addFace(t),i.on(y)&&r.forEach(t=>{let i=(0,l.segment)(t[0],t[1]),r=p.intersect(i),n=m.intersect(i),y=f.intersect(i),x=g.intersect(i);r.length>0&&(o=r[0],s=t,c=e),n.length>0&&(a=n[0],h=t,c=e),y.length>0&&(d=y[0]),x.length>0&&(u=x[0])})}),[o,a,s,h,c,d,u]}static checkDoorIsInRoom(e,t){let i=e.centerWall;return!!t.baseWalls.includes(i)}static getRoomByWall(e){let t="";return editor.floorGroup2d.children.forEach(i=>{if(i.room.baseWalls.includes(e)&&(t=i),t)return}),t}static getSendVec(e,t,i,r){let n=(0,a.UtilCore).handleLineData(e,t),o=(0,a.UtilCore).moveLineToPoint(i,n),s=(0,a.UtilCore).handleLineData(t,r);return(0,a.UtilCore).lineIsIntersection(s,o).sub(t)}static checkAdsorb(e){if(!e)return!1;let t=w.getWallInnerPoint(e),i=t[0],r=t[1],n=w.getRoomByWall(e),o=e.thickness,a=!1,s=[],h=new l.Line(new l.Point(i.x,i.y),new l.Point(r.x,r.y)),c=new l.Segment(new l.Point(i.x,i.y),new l.Point(r.x,r.y));return editor.floorGroup2d.children.forEach(e=>{if(e.uuid==n.uuid)return;let t=e.allRoomPoints;for(let e=0;e<t.length;e++){let n=t[e],d=t[0];e!=t.length-1&&(d=t[e+1]);let u=t[t.length-1];0!=e&&(u=t[e-1]);let p=t[0];e==t.length-2&&(p=t[0]),e==t.length-1&&(p=t[1]),e!=t.length-2&&e!=t.length-1&&(p=t[e+2]);let m=new l.Line(new l.Point(n.x,n.y),new l.Point(d.x,d.y)),f=new l.Segment(new l.Point(n.x,n.y),new l.Point(d.x,d.y));if(m.startPoint=new l.Point(n.x,n.y),m.endPoint=new l.Point(d.x,d.y),m.lastPoint=new l.Point(u.x,u.y),m.mostNextPoint=new l.Point(p.x,p.y),!h.parallelTo(m))continue;let g=new(0,l.Point)(i.x,i.y).projectionOn(m),y=new(0,l.Point)(r.x,r.y).projectionOn(m),x=g.distanceTo(new l.Point(i.x,i.y));if(x&&Math.abs(x[0]-o)>100)continue;let b=new(0,l.Point)(n.x,n.y).projectionOn(h),v=new(0,l.Point)(d.x,d.y).projectionOn(h),M=!1;if(f.contains(g)||f.contains(y)||c.contains(b)||c.contains(v)){let e=w.getWallByInnerPoint(m.startPoint,m.endPoint),t=w.getRoomByWall(e);m.otherWall=e,m.otherRoom=t}(f.contains(g)||f.contains(y))&&(a=m,s.push(m),M=!0),(c.contains(b)||c.contains(v))&&(a=m,M||s.push(m))}}),a&&(a.corerArr=s),a}static sendLine(e,t,i,r,n,o,s,h){let c,d,u,p,m,f,g,y,x=e.clone().sub(t).normalize();h<0&&x.negate();let b=t.clone().sub(e).normalize();h<0&&b.negate();let v=w.getSendVec(e,i,e.clone().add(x.clone().setLength(100)),n).normalize(),M=w.getSendVec(t,r,t.clone().add(b.clone().setLength(100)),o).normalize(),S=v.clone(),P=M.clone();0==v.x&&0==v.y&&(v=x),0==M.x&&0==M.y&&(M=b);let T=(0,l.point)(e.x,e.y),_=(0,l.point)(t.x,t.y),C=(0,l.point)(i.x,i.y),D=(0,l.point)(r.x,r.y),A=(0,l.ray)(T,(0,l.vector)(-x.y,x.x)),E=(0,l.ray)(_,(0,l.vector)(-b.y,b.x)),L=(0,l.ray)(C,(0,l.vector)(-v.y,v.x)),I=(0,l.ray)(D,(0,l.vector)(-M.y,M.x)),R=w.getWallByInnerPoint(e,t),W=w.checkAdsorb(w.getWallByInnerPoint(e,i)),V=w.checkAdsorb(w.getWallByInnerPoint(t,r));editor.floorGroup2d.children.forEach(e=>{if(e.room.uuid==s.room.uuid)return;let t=e.allRoomPoints;for(let e=0;e<t.length;e++){let i=t[0];e!=t.length-1&&(i=t[e+1]);let r=(0,l.segment)((0,l.point)(t[e].x,t[e].y),(0,l.point)(i.x,i.y)),n=w.getWallByInnerPoint(t[e],i),o=R.thickness>n.thickness?R.thickness:n.thickness,s=A.intersect(r),h=E.intersect(r),x=L.intersect(r),b=I.intersect(r);s.length>0&&!c&&(c=s[0],m=o),s.length>0&&!(0,a.UtilCore).isSameVector(c,T)&&s[0].distanceTo(T)[0]<T.distanceTo(c)[0]&&(c=s[0],m=o),h.length>0&&!d&&(d=h[0],f=o),h.length>0&&!(0,a.UtilCore).isSameVector(d,_)&&h[0].distanceTo(_)[0]<_.distanceTo(d)[0]&&(d=h[0],f=o),x.length>0&&!u&&(u=x[0],g=o),x.length>0&&!(0,a.UtilCore).isSameVector(u,C)&&x[0].distanceTo(C)[0]<C.distanceTo(u)[0]&&(u=x[0],g=o),b.length>0&&!p&&(p=b[0],y=o),b.length>0&&!(0,a.UtilCore).isSameVector(p,D)&&b[0].distanceTo(D)[0]<D.distanceTo(p)[0]&&(p=b[0],y=o)}});let k="",B="",O=x,F=b,z=[c,d,u,p];return z[0]&&(k=(0,l.point)(e.x,e.y).distanceTo(z[0])[0]-m,O=x,k<=m&&(k=.01)),z[2]&&z[0]&&(0,l.point)(i.x,i.y).distanceTo(z[2])[0]<k&&(k=(0,l.point)(i.x,i.y).distanceTo(z[2])[0]-g,O=v,k<=g&&(k=.01)),z[2]&&!z[0]&&(k=(0,l.point)(i.x,i.y).distanceTo(z[2])[0]-g,O=v,k<=g&&(k=.01)),z[1]&&(B=(0,l.point)(t.x,t.y).distanceTo(z[1])[0]-f,F=b,B<=f&&(B=.01)),z[3]&&z[1]&&(0,l.point)(r.x,r.y).distanceTo(z[3])[0]<B&&(B=(0,l.point)(r.x,r.y).distanceTo(z[3])[0]-y,F=M,B<=y&&(B=.01)),z[3]&&!z[1]&&(B=(0,l.point)(r.x,r.y).distanceTo(z[3])[0]-y,F=M,B<=y&&(B=.01)),W&&!V&&(k=.01),!W&&V&&(B=.01),[k,B,O,F,[x,b,S,P]]}static changeWallByInput(e,t,i,r){let n=e;e=Math.abs(e);let s=0;t[0]&&(s+=t[0]),t[1]&&(s+=t[1]),e>s&&t[0]&&t[1]&&(e=s,editor.list.showToast.dispatch("此值已经超过最大空间"));let h=[],c=w.getWallByInnerPoint(r[0],r[2]),d=w.getWallByInnerPoint(r[1],r[3]),u=w.getWallByInnerPoint(r[0],r[1]),p=w.getWallByInnerPoint(r[2],r[4]),m=w.getWallByInnerPoint(r[3],r[5]),f=c.positionLock,g=d.positionLock,y=c.lengthLock,x=d.lengthLock,b=(0,a.UtilCore).checkPointIsInLine(r[2],r[0],r[1]),v=(0,a.UtilCore).checkPointIsInLine(r[3],r[0],r[1]);if(t[0]||t[1]){let i=[];t[0]&&i.push(t[0]),t[1]&&i.push(t[1]);let r=Math.min.apply(null,i);h=r>=e/2?[e/2,e/2]:t[0]==r?[r,e-r]:[e-r,r]}else h=[e/2,e/2];f&&g?(editor.list.showToast.dispatch("两边均锁定,请先解锁"),h=[.01,.01]):f&&!g?(n>0&&t[1]&&t[1]<e?(editor.list.showToast.dispatch("尺寸超出空间,请重新输入"),h=[.01,.01]):h=[.01,e],m.lengthLock&&(editor.list.showToast.dispatch("墙体锁定,请先解锁"),h=[.01,.01])):!f&&g&&(n>0&&t[0]&&t[0]<e?(editor.list.showToast.dispatch("尺寸超出空间,请重新输入"),h=[.01,.01]):h=[e,.01],p.lengthLock&&(editor.list.showToast.dispatch("墙体锁定,请先解锁"),h=[.01,.01])),b&&!v&&(h=[e,.01],!y||u.lengthLock||d.positionLock||m.lengthLock?y&&!(!u.lengthLock&&!d.positionLock&&!m.lengthLock)&&(editor.list.showToast.dispatch("两边均锁定,请先解锁"),h=[.01,.01]):n>0&&t[1]&&t[1]<e?(editor.list.showToast.dispatch("尺寸超出空间,请重新输入"),h=[.01,.01]):h=[.01,e]),!b&&v&&(h=[.01,e],!x||u.lengthLock||c.positionLock||p.lengthLock?x&&!(!u.lengthLock&&!c.positionLock&&!p.lengthLock)&&(editor.list.showToast.dispatch("两边均锁定,请先解锁"),h=[.01,.01]):n>0&&t[0]&&t[0]<e?(editor.list.showToast.dispatch("尺寸超出空间,请重新输入"),h=[.01,.01]):h=[e,.01]);let M=[],S=[],P=t[2].clone().setLength(h[0]),T=t[3].clone().setLength(h[1]),_=t[2].clone().setLength(h[0]),C=t[3].clone().setLength(h[1]),D=(0,a.UtilCore).handleLineData(r[0].clone(),r[1].clone()),A=(0,a.UtilCore).handleLineData(r[0].clone(),r[2].clone()),E=(0,a.UtilCore).handleLineData(r[1].clone(),r[3].clone()),L=(0,a.UtilCore).handleLineData(r[2].clone(),r[4].clone()),I=(0,a.UtilCore).handleLineData(r[3].clone(),r[5].clone());if(!(0,a.UtilCore).isMobileSameVector(t[4][0],t[4][2])){if((0,a.UtilCore).isMobileSameVector(t[4][0],t[2])){let e=(0,a.UtilCore).moveLineToPoint(r[0].clone().add(P),A),i=(0,a.UtilCore).lineIsIntersection(e,L);if(i){let e=i.distanceTo(r[2]);_=t[4][2].clone().setLength(e)}}else{let e=(0,a.UtilCore).moveLineToPoint(r[2].clone().add(P),A),i=(0,a.UtilCore).lineIsIntersection(e,D);if(i){let e=i.distanceTo(r[0]);P=t[4][0].clone().setLength(e)}}}if(!(0,a.UtilCore).isMobileSameVector(t[4][1],t[4][3])){if((0,a.UtilCore).isMobileSameVector(t[4][1],t[3])){let e=(0,a.UtilCore).moveLineToPoint(r[1].clone().add(T),E),i=(0,a.UtilCore).lineIsIntersection(e,I);if(i){let e=i.distanceTo(r[3]);C=t[4][3].clone().setLength(e)}}else{let e=(0,a.UtilCore).moveLineToPoint(r[3].clone().add(T),E),i=(0,a.UtilCore).lineIsIntersection(e,E);if(i){let e=i.distanceTo(r[1]);C=t[4][1].clone().setLength(e)}}}return p.lengthLock&&(_=new o.Vector3(0,0,0)),m.lengthLock&&(C=new o.Vector3(0,0,0)),M.push([(0,l.point)(i[r[6]].x,i[r[6]].y),P]),i[r[6]].add(P),M.push([(0,l.point)(r[2].x,r[2].y),_]),r[2].add(_),S.push([(0,l.point)(i[r[7]].x,i[r[7]].y),T]),i[r[7]].add(T),S.push([(0,l.point)(r[3].x,r[3].y),C]),r[3].add(C),w.updateLineDimensionsLine(),[i[r[6]],i[r[7]],M,S]}static isRectangle(e,t,i,r){let n=e.distanceTo(i),o=t.distanceTo(r);if(n===o){let n=w.dotProductBetweenEdges(e,t,i),o=w.dotProductBetweenEdges(t,i,r),a=w.dotProductBetweenEdges(i,r,e);return 0===n&&0==o&&0==a}return!1}static dotProductBetweenEdges(e,t,i){let r=e.clone().sub(t).normalize(),n=i.clone().sub(t).normalize();return r.dot(n)}static getRoomAdjoinPoint(e,t,i,r){let n=e[e.length-1],o=e[0],a=e[0],s=e[0],l=i.clone(),h=r.clone(),c=t[0],d=t[1];return c>d&&(l=r.clone(),h=i.clone(),c=t[1],d=t[0]),0!=c&&(n=e[c-1]),1==c&&(a=e[e.length-1]),0==c&&(a=e[e.length-2]),1!=c&&0!=c&&(a=e[c-2]),d!=e.length-1&&(o=e[d+1]),d==e.length-2&&(s=e[0]),d==e.length-1&&(s=e[1]),d!=e.length-2&&d!=e.length-1&&(s=e[d+2]),[l,h,n,o,a,s,c,d]}static getRoomAdjoinPointByWall(e,t,i){let r=e[e.length-1],n=e[0],o=e[0],s=e[0],l=i.clone(),h=t.clone(),c=0,d=0;for(let t=0;t<e.length;t++)(0,a.UtilCore).isSameVector(e[t],l)&&(c=t,0!=t&&(r=e[t-1]),1==t&&(o=e[e.length-1]),0==t&&(o=e[e.length-2]),1!=t&&0!=t&&(o=e[t-2])),(0,a.UtilCore).isSameVector(e[t],h)&&(d=t,t!=e.length-1&&(n=e[t+1]),t==e.length-2&&(s=e[0]),t==e.length-1&&(s=e[1]),t!=e.length-2&&t!=e.length-1&&(s=e[t+2]));return[l,h,r,n,o,s,c,d]}static changeRoomLengthByFloor(e,t){editor.execute();let i=editor.clickSelect,r=i.allRoomPoints.slice(0);if(w.isRectangle((0,a.UtilCore).toVector2(r[0]),(0,a.UtilCore).toVector2(r[1]),(0,a.UtilCore).toVector2(r[2]),(0,a.UtilCore).toVector2(r[3]))){editor.helperGroup.children.slice(0).forEach(e=>{"roomOuterLine"==e.name&&editor.helperGroup.remove(e)});let n=0,o=1;"X"==t?r[0].x==r[o].x&&(n=1,o=2):r[0].y==r[o].y&&(n=1,o=2);let s=[];i.allRoomPoints.slice(0).forEach(e=>{s.push(e.clone())});let l=i.allRoomPoints,h=w.getRoomAdjoinPoint(l,[n,o],r[n],r[o]),c=r[n].distanceTo(r[o]),d=w.sendLine(h[0],h[1],h[2],h[3],h[4],h[5],i,1*e-c),u=w.changeWallByInput(1*e-c,d,l,h);if(w.checkLineCross(i)){i.allRoomPoints=s,w.updateLineDimensionsLine(),editor.list.showToast.dispatch("此值已经超过最大空间,请核对后重新输入"),w.addRoomHelper(i);let e=w.getDialogMsg(i);editor.list.showModelMsg.dispatch(e);return}let m=w.getWallByInnerPoint(u[2][0][0],u[2][1][0]),f=w.getWallByInnerPoint(u[3][0][0],u[3][1][0]),g=w.getWallByInnerPoint(u[2][0][0],u[3][0][0]),y=w.getWallByPoint(u[2][1][0],m),x={},b=w.getWallByPoint(u[3][1][0],f),v=y.concat(b);v.forEach(e=>{let t=w.getWallInnerPoint(e);x[e.uuid]=t.slice(0)}),i.room.edgeMove(u[2]),i.room.edgeMove(u[3]),editor.doorGroup.children.slice(0).forEach(e=>{let t="";e.centerWall.uuid==m.uuid&&(t=[u[2],m]),e.centerWall.uuid==f.uuid&&(t=[u[3],f]),e.centerWall.uuid==g.uuid&&(t=[[u[2][0],u[3][0]],g]),v.length>0&&v.forEach(t=>{if(!e.parent||e.centerWall.uuid!=t.uuid)return;let i=x[t.uuid],r=u[2][1];b.includes(t)&&(r=u[3][1]);let n=(0,a.UtilCore).toVector3(r[0]).add(r[1]),o=w.getMeshOtherPoint(t,n),s=(0,a.UtilCore).isSameVector(r[0],i[0])?i[1]:i[0];editor.currentPoint=w.getNewWindowPosition([r,[s,o.clone().sub(s)]],e,t),new(0,p.DrawDoorCommand)({currentDoor:e,valueType:"centerPoint",moveType:"centerDrag",noShowDialog:!0}).main()}),t&&(editor.currentPoint=w.getNewWindowPosition(t[0],e,t[1]),new(0,p.DrawDoorCommand)({currentDoor:e,valueType:"centerPoint",moveType:"centerDrag",noShowDialog:!0}).main())});let M=i;w.updateRoomNamePosition(M),editor.clickSelect=M,w.addRoomHelper(M)}}static changeRoomLengthByWall(e){editor.execute();let t=editor.clickSelect,i=(0,a.UtilCore).toVector3(t.getVertex(2)),r=(0,a.UtilCore).toVector3(t.getVertex(5)),n=w.getRoomByWall(t);if(n){let o=[];n.allRoomPoints.slice(0).forEach(e=>{o.push(e.clone())}),editor.helperGroup.children.slice(0).forEach(e=>{"roomOuterLine"==e.name&&editor.helperGroup.remove(e)});let s=n.allRoomPoints,l=w.getRoomAdjoinPointByWall(s,i,r),h=i.distanceTo(r),c=w.sendLine(l[0],l[1],l[2],l[3],l[4],l[5],n,1*e-h),d=w.changeWallByInput(1*e-h,c,n.allRoomPoints,l);if(w.checkLineCross(n)){n.allRoomPoints=o,w.updateLineDimensionsLine(),editor.list.showToast.dispatch("此值已经超过最大空间,请核对后重新输入"),w.addRoomHelper(n,i,r);let e=w.getDialogMsg(t);editor.list.showModelMsg.dispatch(e);return}editor.helperGroup.children.slice(0).forEach(e=>{"roomOuterLine"==e.name&&editor.helperGroup.remove(e)});let u=w.getWallByInnerPoint(d[2][0][0],d[2][1][0]),m=w.getWallByInnerPoint(d[3][0][0],d[3][1][0]),f=w.getWallByInnerPoint(d[2][0][0],d[3][0][0]),g=w.getWallByPoint(d[2][1][0],u),y={},x=w.getWallByPoint(d[3][1][0],m),b=g.concat(x);b.forEach(e=>{let t=w.getWallInnerPoint(e);y[e.uuid]=t.slice(0)}),n.room.edgeMove(d[2]),n.room.edgeMove(d[3]),editor.doorGroup.children.slice(0).forEach(e=>{let t="";e.centerWall.uuid==u.uuid&&(t=[d[2],u]),e.centerWall.uuid==m.uuid&&(t=[d[3],m]),e.centerWall.uuid==f.uuid&&(t=[[d[2][0],d[3][0]],f]),b.length>0&&b.forEach(t=>{if(!e.parent||e.centerWall.uuid!=t.uuid)return;let i=y[t.uuid],r=d[2][1];x.includes(t)&&(r=d[3][1]);let n=(0,a.UtilCore).toVector3(r[0]).add(r[1]),o=w.getMeshOtherPoint(t,n),s=(0,a.UtilCore).isSameVector(r[0],i[0])?i[1]:i[0];editor.currentPoint=w.getNewWindowPosition([r,[s,o.clone().sub(s)]],e,t),new(0,p.DrawDoorCommand)({currentDoor:e,valueType:"centerPoint",moveType:"centerDrag",noShowDialog:!0}).main()}),t&&(editor.currentPoint=w.getNewWindowPosition(t[0],e,t[1]),new(0,p.DrawDoorCommand)({currentDoor:e,valueType:"centerPoint",moveType:"centerDrag",noShowDialog:!0}).main())});let v=n;w.updateScene(n),w.addRoomHelper(v,d[0].clone(),d[1].clone()),w.updateRoomNamePosition(v);let M=w.getWallByInnerPoint(d[0],d[1]);if(M){editor.clickSelect=M;let e=w.getWallInnerPoint(M);(0,a.UtilCore).checkSameWallByPoint(e[0],e[1],i,r)||(M.lengthLock=!0);let t=w.getDialogMsg(M);editor.list.showModelMsg.dispatch(t)}}}static getWallByInnerPoint(e,t){let i="";return editor.wallGroup.children.forEach(r=>{let n=(0,a.UtilCore).toVector3(r.getVertex(2)),o=(0,a.UtilCore).toVector3(r.getVertex(5)),s=(0,a.UtilCore).isSameVector(n,e)&&(0,a.UtilCore).isSameVector(o,t),l=(0,a.UtilCore).isSameVector(n,t)&&(0,a.UtilCore).isSameVector(o,e);(s||l)&&(i=r)}),i}static getWallInnerPoint(e){return[(0,a.UtilCore).toVector3(e.getVertex(2)),(0,a.UtilCore).toVector3(e.getVertex(5))]}static getWallOuterPoint(e){return[(0,a.UtilCore).toVector3(e.getVertex(3)),(0,a.UtilCore).toVector3(e.getVertex(0))]}static getWallByPoint(e,t=""){let i=[];return editor.wallGroup.children.forEach(r=>{if(t&&r.uuid==t.uuid)return;let n=(0,a.UtilCore).toVector3(r.getVertex(2)),o=(0,a.UtilCore).toVector3(r.getVertex(5));((0,a.UtilCore).isSameVector(n,e)||(0,a.UtilCore).isSameVector(o,e))&&i.push(r)}),i}static delMain(e){if("delAll"==e){editor.removeScene("","all"),editor.saveSceneJson();return}if(!editor.clickSelect)return;let t=editor.clickSelect.useType,i=editor.clickSelect;if("floor"==t)i.parent.remove(i),i.allWalls.slice(0).forEach(e=>{e.parent.remove(e)}),editor.helperGroup.children.slice(0).forEach(e=>{"roomOuterLine"==e.name&&editor.helperGroup.remove(e)}),editor.removeInputById(editor.uiPanelBox.dom,"roomName"+i.room.uuid);else if("wall"==t){let e=w.getRoomByWall(i);if(editor.helperGroup.children.slice(0).forEach(e=>{"roomOuterLine"==e.name&&editor.helperGroup.remove(e)}),e)e.room.deleteWall(i);else if(i.parent.remove(i),i.roomMsg){let e=i.roomMsg.innerWalls.indexOf(i);i.roomMsg.innerWalls.splice(e,1);let t=(0,c.Room).generateWall3DBy2(i),r=i.roomMsg.innerWall3Ds.indexOf(t);i.roomMsg.innerWall3Ds.splice(r,1),t.parent.remove(t)}editor.doorGroup.children.slice(0).forEach(e=>{e.centerWall.uuid==i.uuid&&e.parent.remove(e),e.leftWindow&&(e.leftWindow[0].uuid==i.uuid||e.rightWindow[0].uuid==i.uuid)&&e.parent.remove(e)})}else if("dragPoint"==t){i=i.parent;let e=w.getRoomByPoint(i.position),t=w.getLinkPoint(i.position,e[0].allRoomPoints),r=(0,a.UtilCore).handleLineData(t[0],i.position);if(!(0,a.UtilCore).pointInLine(t[2],r)){editor.list.showToast.dispatch("只允许删除共线墙端点");return}i.parent.remove(i),editor.helperGroup.children.slice(0).forEach(e=>{"roomOuterLine"==e.name&&editor.helperGroup.remove(e)}),e[0].room.mergeParalleledWall((0,l.point)(i.position.x,i.position.y))}let r="";i.parent&&(r=i.parent.modelType),r&&(r.toLowerCase().indexOf("door")>-1||r.toLowerCase().indexOf("window")>-1)&&(i.parent.parent.remove(i.parent),w.removeDoorHelper()),w.updateLineDimensionsLine(),editor.saveSceneJson(),editor.list.showModelMsg.dispatch("")}static autoSetCamera(e){let t=new o.Box3().setFromObject(e),i=t.getSize(new o.Vector3),r=t.getCenter(new o.Vector3),n=Math.max(i.x,i.y,i.z);if(0==n)return;"2dwall"==e.name&&i.x!=i.x&&(n/=2),n*=-1;let a=window.innerWidth/window.innerHeight;editor.camera.left=n*a,editor.camera.right=-n*a,editor.camera.top=-n,editor.camera.bottom=n,editor.camera.position.z=1e3,editor.camera.position.x=r.x,editor.camera.position.y=r.y,editor.controlsArr[0].target.copy(editor.camera.position),editor.camera.zoom=1,editor.camera.updateProjectionMatrix(),editor.controlsArr[0].update(),w.updateLineDimensionsLine(),editor.floorGroup2d.children.forEach(e=>{w.updateRoomNamePosition(e)}),editor.updateDom()}static addWallHelper(e){let t=(0,a.UtilCore).toVector3(e.getVertex(2)),i=(0,a.UtilCore).toVector3(e.getVertex(5)),r=w.getRoomByWall(e);if(r)w.addRoomHelper(r,t.clone(),i.clone());else{new o.Vector3((t.x+i.x)/2,(t.y+i.y)/2,0);let e=w.createMoveHelper(t,4),r=w.createMoveHelper(i,4),n=[t,i],a=w.addLine(n);a.name="roomOuterLine",a.position.z=10,editor.helperGroup.add(a,e,r)}}static getDialogMsg(e){let t={type:e.useType,positionLock:e.positionLock};if("floor"==e.useType){let i=e.allRoomPoints;t.rotationLock=e.rotationLock;let r=e.area.split("\n");if(t.area=r[r.length-1],t.type="room",t.roomName=r.length>1?r[0]:"",4==i.length&&w.isRectangle((0,a.UtilCore).toVector2(i[0]),(0,a.UtilCore).toVector2(i[1]),(0,a.UtilCore).toVector2(i[2]),(0,a.UtilCore).toVector2(i[3]))){let e=0,r=1;i[0].x==i[r].x&&(e=1,r=2);let n=e-1;n<0&&(n=i.length-1);let o=Math.round(i[e].distanceTo(i[r])),a=Math.round(i[e].distanceTo(i[n]));t.width=o,t.height=a}}else if("wall"==e.useType){let i=(0,a.UtilCore).toVector3(e.getVertex(2)),r=(0,a.UtilCore).toVector3(e.getVertex(5));t.lengthLock=e.lengthLock;let n=Math.round(i.distanceTo(r));t.width=n,t.height=240}return t}static isClockwise(e){let t=0;for(let i=0;i<e.length;i++){let r=e[i],n=e[(i+1)%e.length],o=(n.x-r.x)*(n.y+r.y);t+=o}return t>0}static getMeshOtherPoint(e,t){let i=w.getWallInnerPoint(e),r=i[0];return(0,a.UtilCore).isSameVector(t,i[0])&&(r=i[1]),r}static getRoomOuterDir(e,t){let i=w.getRoomByPoint(e),r=(0,s.MobileListener).getFloorCenter(i[0]),n=new l.Point(r.x,r.y),o=new l.Line(new l.Point(e.x,e.y),new l.Point(t.x,t.y)),h=n.projectionOn(o);return(0,a.UtilCore).toVector3(h).sub(r)}static removeDoorHelper(){editor.helperGroup.children.slice(0).forEach(e=>{"roomOuterLine"==e.name&&editor.helperGroup.remove(e),"doorLineHelper"==e.useType&&(editor.removeInputByClassName(editor.uiPanelBox.dom,"showDoorLength"+e.uuid),editor.helperGroup.remove(e))})}static addDoorHelper(e){let t=e.modelType,i="";"LWindow"==t?w.addLWindowHelper(e):i="UWindow"==t?w.addUWindowHelper(e):w.addLineWindowHelper(e);let r=w.makeShowDoorJson(e);i&&(r.inputArr[0].value=i[0].lineLength,r.inputArr[1].value=i[1].lineLength,r.inputArr[2].value=i[2].lineLength),editor.list.showModelMsg.dispatch(r)}static createEndpoint(e,t,i=100){let r=t.clone().setLength(i),n=t.clone().negate().setLength(i),a=r.clone().applyAxisAngle(new o.Vector3(0,0,1),70),s=a.clone().negate().setLength(i),l=e.clone().add(r),h=e.clone().add(n),c=e.clone().add(a),d=e.clone().add(s);return[l,h,e,c,d]}static getWallLine(e){let t=w.getWallInnerPoint(e);return new l.Line(new l.Point(t[0].x,t[0].y),new l.Point(t[1].x,t[1].y))}static addDoorLineHelper(e,t,i,r="",n=450){e=new o.Vector3(e.x,e.y,0),t=new o.Vector3(t.x,t.y,0);let a=new(0,o.Vector3)().subVectors(t,e),s=new(0,o.Vector3)(-a.y,a.x,0).negate();s.setLength(n);let l=e.clone().add(s.setLength(n)),c=t.clone().add(s.setLength(n)),d=[l,c];d=(d=w.createEndpoint(l,s).concat(d)).concat(w.createEndpoint(c,s));let u=w.addLine(d,1.5);u.lineCenter=new o.Vector3((l.x+c.x)/2,(l.y+c.y)/2,0),u.lineLength=Math.round(e.distanceTo(t)),u.useType="doorLineHelper",u.position.z=20;let p=editor.getScreenPosition(u.lineCenter.clone()),m=new(0,o.Vector2)(e.x,e.y).sub(new o.Vector2(t.x,t.y)).angle();(m=180/Math.PI*m)>180&&m<270?m=360-m+180:m>90&&m<=180?(m*=-1,m+=180):m=360-m;let f=new(0,h.UIText)(u.lineLength).setClass("showDoorLength"+u.uuid).setWidth("40px").setColor(i).setMarginTop(p.y+"px").setMarginLeft(p.x+"px").setStyle(["transform"],["rotate("+m+"deg)"]),g=u.lineCenter.x+"/"+u.lineCenter.y+"/"+u.lineCenter.z;if(f.setAttribute("worldPosition",g),editor.uiPanelBox.add(f),r){let e=w.createMoveHelper(r[0],2),t=new(0,o.Vector2)(r[0].x,r[0].y).sub(new o.Vector2(r[1].x,r[1].y)).angle();e.rotation.z=t,e.useType="doorDragPoint",editor.helperGroup.add(e)}return u}static getSamePointTwoWall(e,t){let i=w.getWallInnerPoint(e),r=w.getWallInnerPoint(t),n=i[0],o=i[1],s=r[0],l=r[1],h=(0,a.UtilCore).isSameVector(n,s),c=(0,a.UtilCore).isSameVector(n,l),d=(0,a.UtilCore).isSameVector(o,s),u=(0,a.UtilCore).isSameVector(o,l);return(!!h||!!c||!!d||!!u)&&(h||c?n:d||u?o:void 0)}static addLWindowHelper(e){if(e.leftWindow){let t=e.leftWindow[0],i=e.leftWindow[1],r=e.rightWindow[0],n=e.rightWindow[1],o=w.getSamePointTwoWall(t,r),a=w.getMeshOtherPoint(t,o),s=w.getMeshOtherPoint(r,o),l=o.clone().add(a.clone().sub(o.clone()).setLength(i)),h=o.clone().add(s.clone().sub(o.clone()).setLength(n)),c=e.lengthLock,d=w.addDoorLineHelper(o,l,editor.config.inputColor.windowLeft,c?"":[l,o]),u=w.addDoorLineHelper(h,o,editor.config.inputColor.windowRight,c?"":[h,o]);editor.helperGroup.add(d,u)}}static addUWindowHelper(e){if(e.leftWindow){let t=e.leftWindow[2],i=e.rightWindow[2],r=w.getSamePointTwoWall(e.centerWall,e.leftWindow[0]),n=w.getSamePointTwoWall(e.centerWall,e.rightWindow[0]),o=r.clone().add(t.clone().sub(r.clone()).setLength(e.leftWindow[1])),s=n.clone().add(i.clone().sub(n.clone()).setLength(e.rightWindow[1])),l=e.lengthLock,h=w.addDoorLineHelper(o,r,editor.config.inputColor.windowLeft,l?"":[(0,a.UtilCore).toVector3(o),(0,a.UtilCore).toVector3(r)]),c=w.addDoorLineHelper(n,s,editor.config.inputColor.windowRight,l?"":[(0,a.UtilCore).toVector3(s),(0,a.UtilCore).toVector3(n)]),d=w.addDoorLineHelper(r,n,editor.config.inputColor.windowCenter);return editor.helperGroup.add(h,c,d),[h,d,c]}}static addLineWindowHelper(e){let t=e.wallStartPoint.clone(),i=e.wallEndPoint.clone(),r=e.startPoint.clone(),n=e.endPoint.clone(),o=(0,l.point)(t.x,t.y),s=(0,l.point)(i.x,i.y),h=new l.Line(o,s),c=(0,l.point)(r.x,r.y).projectionOn(h),d=(0,l.point)(n.x,n.y).projectionOn(h),u=h.sortPoints([o,s,c,d]);e.sortArr=u;let p=e.lengthLock,m=w.addDoorLineHelper(u[0],u[1],editor.config.inputColor.windowLeft),f=w.addDoorLineHelper(u[1],u[2],editor.config.inputColor.windowCenter,p?"":[(0,a.UtilCore).toVector3(u[1]),(0,a.UtilCore).toVector3(u[2])]),g=w.addDoorLineHelper(u[2],u[3],editor.config.inputColor.windowRight,p?"":[(0,a.UtilCore).toVector3(u[2]),(0,a.UtilCore).toVector3(u[3])]);return editor.helperGroup.add(m,f,g),[m,f,g]}static makeShowDoorJson(e){let t={},i=e.modelType;return(t="LWindow"==i?{type:"window",inputArr:[{inputType:"leftWidth",value:Math.round(e.leftWindow[1]),disabled:!!e.lengthLock,color:editor.config.inputColor.windowLeft},{inputType:"rightWidth",value:Math.round(e.rightWindow[1]),disabled:!!e.lengthLock,color:editor.config.inputColor.windowRight}]}:"UWindow"==i?{type:"window",inputArr:[{inputType:"leftWidth",value:Math.round(e.leftWindow[1]),disabled:!!e.lengthLock,color:editor.config.inputColor.windowLeft},{inputType:"width",value:Math.round(e.doorWid),disabled:!0,color:editor.config.inputColor.windowCenter},{inputType:"rightWidth",value:Math.round(e.rightWindow[1]),disabled:!!e.lengthLock,color:editor.config.inputColor.windowRight}]}:{type:i.toLowerCase().indexOf("door")>-1?"door":"window",inputArr:[{inputType:"leftWidth",value:1e3,disabled:!!e.lengthLock,color:editor.config.inputColor.windowLeft},{inputType:"width",value:Math.round(e.doorWid),disabled:!!e.lengthLock,color:editor.config.inputColor.windowCenter},{inputType:"rightWidth",value:1e3,disabled:!!e.lengthLock,color:editor.config.inputColor.windowRight}]}).positionLock=e.positionLock,t.lengthLock=e.lengthLock,t}}}),parcelRequire.register("dVRrd",function(e,t){$parcel$export(e.exports,"MobileListener",()=>h);var i=parcelRequire("4xklQ"),r=parcelRequire("9HO6e"),n=parcelRequire("3BPdS"),o=parcelRequire("47Y2g"),a=parcelRequire("gDTsF"),s=parcelRequire("gMHcS"),l=parcelRequire("kLdsz");class h{static onTouchStart(e){if(!editor.camera.isOrthographicCamera||e.touches.length>=2)return;editor.startMove=!1,editor.selDom="";let t=e.changedTouches[0];editor.list.getDomByPoint.dispatch(t.clientX,t.clientY,"touchStart"),editor.currentDom&&(editor.selDom=editor.currentDom),editor.downPoint=editor.getWorldPosition(e),editor.lastClientY=e.changedTouches[0].clientY,editor.specialPointArr=(0,o.MobileMain).getSpecialArr(),"wall"==editor.toolType&&(editor.downAdsorptionPoint=(0,o.MobileMain).adsorptionPointNew(editor.downPoint.clone(),editor.specialPointArr)),editor.downEvent=e,editor.controlsArr[0].enablePan=!1;let n=h.getObject(e);if(editor.downSel=n,n.length>0&&editor.clickSelect&&"free"==editor.toolType){let e=n[0].object;if("floor"==e.useType&&editor.clickSelect.uuid==e.uuid){if(e.positionLock){editor.controlsArr[0].enablePan=!0;return}editor.execute(),editor.moveRoomArr=[e.room.floor].concat(e.room.baseWalls),e.allPoints=e.allRoomPoints.slice(0)}if(("extremePoint"==e.parent.useType||"centerPoint"==e.parent.useType||"publicCenterPoint"==e.parent.useType)&&(editor.execute(),editor.currentSel=e.parent),e.parent.useType&&(editor.currentSelArc=e.parent),"wall"==e.useType){if(e.positionLock)return;let t=(0,o.MobileMain).getWallInnerPoint(e),n=new i.Vector2((t[0].x+t[1].x)/2,(t[0].y+t[1].y)/2);editor.execute(),editor.helperGroup.children.forEach(e=>{"centerPoint"==e.useType&&(0,r.UtilCore).isSameVector(e.position,n)&&(editor.currentSel=e)})}if(e.parent.modelType&&(e.parent.modelType.toLowerCase().indexOf("door")>-1||e.parent.modelType.toLowerCase().indexOf("window")>-1)&&e.parent.positionLock){editor.controlsArr[0].enablePan=!0;return}}else editor.currentDom||(editor.controlsArr[0].enablePan=!0)}static onTouchMove(e){if(!editor.camera.isOrthographicCamera||e.touches.length>=2)return;let t=editor.toolType;editor.currentPoint=editor.getWorldPosition(e);let c=e.changedTouches[0].clientY;var d=-((c-editor.lastClientY)*1);editor.lastClientY=c;let u=e.changedTouches[0],p="";if(editor.downSel.length>0&&(p=editor.downSel[0].object),editor.selDom&&editor.list.getDomByPoint.dispatch(u.clientX,u.clientY,"touchMove",d),!editor.currentDom&&editor.selCacheJson&&(window.editor.list.dragRoomForMobile.dispatch(editor.selCacheJson),editor.execute(),editor.downPoint=new i.Vector3(0,0,0),(0,o.MobileMain).addRoomMain(editor.moveRoomArr),editor.selCacheJson="",editor.clickSelect=[]),!editor.currentDom&&editor.selWallCacheJson){editor.execute();let e=JSON.parse(editor.selWallCacheJson).roomArr,t=(0,l.Room).addWall(1,!1,"",(0,a.point)(e[0][0],e[0][1]),(0,a.point)(e[1][0],e[1][1]));editor.wallGroup.add(t[0]),editor.wallGroup3D.add(t[1]),editor.selWallCacheJson="",editor.moveDrawWall=t[0]}if(editor.moveRoomArr){editor.controlsArr[0].enablePan=!1;let e="";editor.moveRoomArr.forEach(t=>{"floor"==t.useType&&(e=t)}),editor.pointHelperGroup.children.slice(0).forEach(e=>{e.useType="dragPoint",e.parent.remove(e)}),(0,o.MobileMain).adsorptionRoom(e,editor.currentPoint.clone()),editor.helperGroup.children.slice(0).forEach(e=>{"roomOuterLine"==e.name&&editor.helperGroup.remove(e)});let t="";editor.moveRoomArr.forEach(e=>{"floor"==e.useType&&(t=e,editor.clickSelect&&editor.clickSelect.uuid==e.uuid&&(0,o.MobileMain).addRoomHelper(e),(0,o.MobileMain).updateRoomNamePosition(e))}),editor.booleanFloor=t}else if(editor.currentSel){editor.pointHelperGroup.children.slice(0).forEach(e=>{e.useType="dragPoint",e.parent.remove(e)});let e=editor.currentSel.pointArr[0],t=editor.currentSel.pointArr[1],n=editor.currentSel.pointArr[2],l=editor.currentSel.pointArr[3],h=editor.currentSel.pointArr[4],c=editor.currentSel.pointArr[5],d=editor.currentSel.pointArr[6],u=-1,p="";editor.helperGroup.children.slice(0).forEach(e=>{"roomOuterLine"==e.name&&(editor.helperGroup.remove(e),e.domClass&&editor.removeInputByClassName(editor.uiPanelBox.dom,"showWallLength"+e.uuid))});for(let t=0;t<c.allRoomPoints.slice(0).length;t++)(0,r.UtilCore).isSameVector(c.allRoomPoints.slice(0)[t],e)&&(u=t);let m=!1,f=[],g=[],y=[],x=editor.currentSel.useType,w=(0,o.MobileMain).getWallByInnerPoint(e,t);if("extremePoint"==x){if(editor.currentPoint=(0,o.MobileMain).adsorptionPointNew(editor.currentPoint,editor.specialPointArr,e),(0,r.UtilCore).isSameVector(e,editor.currentPoint))return;let i=new a.Line(new a.Point(t.x,t.y),new a.Point(n.x,n.y)),s=new a.Point(editor.currentPoint.x,editor.currentPoint.y),y=s.distanceTo(i)[0],x=s.projectionOn(i);if(y<100&&(editor.currentPoint=(0,r.UtilCore).toVector3(x)),!d[0].lengthLock&&d[1].lengthLock||d[0].lengthLock&&!d[1].lengthLock){let i=e.distanceTo(t),r=t.clone();d[1].lengthLock&&(i=e.distanceTo(n),r=n.clone());let o=r.clone().add(editor.currentPoint.clone().sub(r).setLength(i));editor.currentPoint=o.clone()}if(d[0].positionLock||d[1].positionLock){let e=(0,o.MobileMain).getWallInnerPoint(d[0].positionLock?d[0]:d[1]),t=(0,r.UtilCore).handleLineData(e[0],e[1]);editor.currentPoint=(0,r.UtilCore).toVector3((0,r.UtilCore).smallDistanceByPointOnLine(t,editor.currentPoint))}let w=editor.currentPoint.clone();w.z=e.z,p=(0,r.UtilCore).handleLineData(w,t),f=[c.allRoomPoints[u].clone()],c.allRoomPoints[u]=w.clone(),g=[w.clone().sub(f[0])];let b=(0,o.MobileMain).checkWallAngle(w,n,t,h,l);m=b[0]<=4.5||b[1]<=4.5||b[2]<=4.5,editor.helperGroup.children.slice(0).forEach(e=>{"drawAngleLine"==e.name&&editor.helperGroup.remove(e)}),editor.removeInputByClassName(editor.uiPanelBox.dom,"showMoveAngle"),(0,o.MobileMain).addAngleHelper(n,h,w);let v=(0,o.MobileMain).addAngleHelper(w,n,t);(0,o.MobileMain).addAngleHelper(t,l,w),editor.list.showModelMsg.dispatch({type:"point",angle:v})}else if("centerPoint"==x||"publicCenterPoint"==x){let i=(0,o.MobileMain).getWallByInnerPoint(e,n),s=(0,o.MobileMain).getWallByInnerPoint(t,l);"publicCenterPoint"==x?editor.currentPoint.add(editor.currentSel.moveDir):editor.currentPoint=(0,o.MobileMain).adsorptionPointByWall(editor.currentPoint,[w]);let h=(0,r.UtilCore).handleLineData(e,n),d=(0,r.UtilCore).handleLineData(t,l),m=(0,r.UtilCore).handleLineData(e,t),g=(0,r.UtilCore).moveLineToPoint(editor.currentPoint,m.slice(0)),b=(0,r.UtilCore).lineIsIntersection(g,h),v=(0,r.UtilCore).lineIsIntersection(g,d),M="";if(!b){let t=(0,r.UtilCore).getCenterNormalLine(e,h);if(b=(0,r.UtilCore).lineIsIntersection(g,t),(0,r.UtilCore).toVector3(e).distanceTo((0,r.UtilCore).toVector3(b))>10){if(!v){let t=c.room.edgeMoveAddWall2(w,(0,r.UtilCore).toVector2(b.clone().sub(e)));editor.wallGroup.add(...t),M=b;let i=(0,o.MobileMain).getLinkPoint(M,c.allRoomPoints.slice(0));editor.currentSel.pointArr[0]=M,editor.currentSel.pointArr[1]=i[2],editor.currentSel.pointArr[2]=i[0],editor.currentSel.pointArr[3]=i[3],editor.currentSel.pointArr[4]=i[1];return}let t=c.room.edgeMoveAddWall((0,r.UtilCore).toVector2(b),(0,r.UtilCore).toVector2(e),w);editor.wallGroup.add(t);let i=(0,o.MobileMain).getWallInnerPoint(t);M=(0,r.UtilCore).isSameVector(b,i[0])?i[0]:i[1]}else b=e}if(!v){let e=(0,r.UtilCore).getCenterNormalLine(t,d);if(v=(0,r.UtilCore).lineIsIntersection(g,e),(0,r.UtilCore).toVector3(t).distanceTo((0,r.UtilCore).toVector3(v))>10){let e=c.room.edgeMoveAddWall((0,r.UtilCore).toVector2(v),(0,r.UtilCore).toVector2(t),w);editor.wallGroup.add(e);let i=(0,o.MobileMain).getWallInnerPoint(e),n=(0,r.UtilCore).isSameVector(v,i[0])?i[0]:i[1],a=(0,o.MobileMain).getWallInnerPoint(w);M=(0,r.UtilCore).isSameVector(n,a[1])?a[0]:a[1]}else v=t}if((0,r.UtilCore).isSameVector(b,n)&&(0,r.UtilCore).isSameVector(v,l)){let e=v.clone().sub(t);c.room.deleteTooShortWall(w,[i,s],e),M=b,i.parent.remove(i),s.parent.remove(s)}else{if((0,r.UtilCore).isSameVector(b,n)){let e=v.clone().sub(t);c.room.deleteTooShortWall(w,i,e),M=b,i.parent.remove(i)}if((0,r.UtilCore).isSameVector(v,l)){let t=b.clone().sub(e);c.room.deleteTooShortWall(w,s,t),s.parent.remove(s),M=b}}if(M){let e=(0,o.MobileMain).getLinkPoint(M,c.allRoomPoints.slice(0));editor.currentSel.pointArr[0]=M,editor.currentSel.pointArr[1]=e[2],editor.currentSel.pointArr[2]=e[0],editor.currentSel.pointArr[3]=e[3],editor.currentSel.pointArr[4]=e[1];return}b=(0,r.UtilCore).toVector3(b),v=(0,r.UtilCore).toVector3(v),p=(0,r.UtilCore).handleLineData(b,v);let S=c.allRoomPoints[u].clone();f.push([(0,a.point)(S.x,S.y),b.clone().sub(S)]),c.allRoomPoints[u]=b.clone(),editor.currentSel.pointArr[0]=b.clone();let P=u+1;u==c.allRoomPoints.slice(0).length-1&&(P=0);let T=c.allRoomPoints[P].clone();f.push([(0,a.point)(T.x,T.y),v.clone().sub(c.allRoomPoints[P].clone())]),c.allRoomPoints[P]=v.clone(),editor.currentSel.pointArr[1]=v.clone(),"publicCenterPoint"==x&&editor.currentSel.otherWallLine.forEach(e=>{let t=e.otherRoom,i=e.otherWall,n=e.startPoint.clone(),o=e.endPoint.clone(),s=editor.currentSel.moveDir.clone().negate(),l=editor.currentPoint.clone().add(s.setLength(i.thickness?i.thickness:240)),h=(0,r.UtilCore).handleLineData(n,e.lastPoint),c=(0,r.UtilCore).handleLineData(o,e.mostNextPoint),d=(0,r.UtilCore).moveLineToPoint(l,m.slice(0)),u=(0,r.UtilCore).lineIsIntersection(d,h),p=(0,r.UtilCore).lineIsIntersection(d,c);b.distanceTo(e.startPoint)>b.distanceTo(e.endPoint)&&(n=e.endPoint.clone(),o=e.startPoint.clone()),y.push([(0,a.point)(n.x,n.y),(0,r.UtilCore).toVector3(u).clone().sub((0,r.UtilCore).toVector3(n))]),y.push([(0,a.point)(o.x,o.y),(0,r.UtilCore).toVector3(p).clone().sub((0,r.UtilCore).toVector3(o))]),t.allRoomPoints.forEach(e=>{(0,r.UtilCore).isSameVector(e,n)&&e.add(f[0][1]),(0,r.UtilCore).isSameVector(e,o)&&e.add(f[1][1])})})}let b=(0,o.MobileMain).checkLineCross(c);if((0,o.MobileMain).isClockwise(c.allRoomPoints)&&(b=!0),b||m)c.allRoomPoints[u]=e.clone(),editor.currentSel.pointArr[0]=e.clone(),c.allRoomPoints[u+1]=t.clone(),editor.currentSel.pointArr[1]=t.clone(),editor.helperGroup.children.slice(0).forEach(e=>{"drawAngleLine"==e.name&&editor.helperGroup.remove(e)}),editor.removeInputByClassName(editor.uiPanelBox.dom,"showMoveAngle");else{if(editor.removeInputById(editor.uiPanelBox.dom,"roomName"+c.room.uuid),"extremePoint"==editor.currentSel.useType){let e=c.room.vertexMove((0,a.point)(f[0].x,f[0].y),(0,a.point)(g[0].x,g[0].y));e&&(editor.currentSel.pointArr[0]=(0,r.UtilCore).toVector3(e)),editor.doorGroup.children.slice(0).forEach(t=>{d.forEach(r=>{if(!t.centerWall){t.parent&&t.parent.remove(t);return}if(t.centerWall.uuid!=r.uuid)return;let n=[[(0,o.MobileMain).getMeshOtherPoint(r,e),new i.Vector3(0,0,0)],[f[0],g[0]]];editor.currentPoint=(0,o.MobileMain).getNewWindowPosition(n,t,r),new(0,s.DrawDoorCommand)({currentDoor:t,valueType:"centerPoint",moveType:"centerDrag",noShowDialog:!0}).main()})})}if("centerPoint"==editor.currentSel.useType||"publicCenterPoint"==editor.currentSel.useType){let e=(0,o.MobileMain).getWallByPoint(f[0][0],w),t=(0,o.MobileMain).getWallByPoint(f[1][0],w),n=e.concat(t),l=c.room.edgeMove([f[0],f[1]]);if(l[0]&&(editor.currentSel.pointArr[0]=(0,r.UtilCore).toVector3(l[0])),l[1]&&(editor.currentSel.pointArr[1]=(0,r.UtilCore).toVector3(l[1])),"publicCenterPoint"==editor.currentSel.useType){let e=editor.currentSel.otherWallLine,t=0;e.forEach(e=>{let i=e.otherRoom,r=i.room.edgeMove([y[t],y[t+1]]);r[0]&&(e.startPoint=new a.Point(r[0].x,r[0].y)),r[1]&&(e.endPoint=new a.Point(r[1].x,r[1].y)),t+=2,(0,o.MobileMain).updateRoomNameVal(i)})}editor.doorGroup.children.slice(0).forEach(e=>{let a="";if(e.centerWall.uuid==w.uuid&&(a=[f,w]),n.length>0&&n.forEach(n=>{if(!e.parent)return;let a=f[0];t.includes(n)&&(a=f[1]);let l=(0,r.UtilCore).toVector3(a[0]).add(a[1]),h=(0,o.MobileMain).getMeshOtherPoint(n,l);editor.currentPoint=(0,o.MobileMain).getNewWindowPosition([a,[h,new i.Vector3(0,0,0)]],e,n),new(0,s.DrawDoorCommand)({currentDoor:e,valueType:"centerPoint",moveType:"centerDrag",noShowDialog:!0}).main()}),!a)return;let l=(0,o.MobileMain).getNewWindowPosition(a[0],e,a[1]);editor.currentPoint=l,new(0,s.DrawDoorCommand)({currentDoor:e,valueType:"centerPoint",moveType:"centerDrag",noShowDialog:!0}).main()})}editor.newRoom=c,editor.newRoom&&(editor.currentSel.pointArr[5]=editor.newRoom);let h=n.clone().sub(e),u=l.clone(),p=t.clone();"extremePoint"==editor.currentSel.useType&&(u=t.clone(),p=e.clone());let m=u.clone().sub(p),x=new(0,i.Vector3)(-h.y,h.x,0).setLength(480),b=new(0,i.Vector3)(m.y,-m.x,0).setLength(480),v=(0,o.MobileMain).addLineWallHelper(e.clone().add(x),n.clone().add(x),x),M=(0,o.MobileMain).addLineWallHelper(u.clone().add(b),p.clone().add(b),b);v.name="roomOuterLine",M.name="roomOuterLine",editor.helperGroup.add(v,M)}}else if(editor.currentSelArc&&"rotatePoint"==editor.currentSelArc.useType){editor.startMove||editor.execute(),editor.helperGroup.children.slice(0).forEach(e=>{"roomOuterLine"==e.name&&editor.helperGroup.remove(e)});let e=editor.currentSelArc.position.clone().clone().sub(editor.currentSelArc.roomCenter),t=editor.currentPoint.clone().sub(editor.currentSelArc.roomCenter),i=e.angleTo(t),r=180*i/Math.PI,l=10;r<10&&(i=0),r<100&&r>90-l&&(i=Math.PI/2),r<180+l&&r>180-l&&(i=Math.PI),editor.currentPoint.x<editor.currentSelArc.roomCenter.x&&(i*=-1);let c=i;editor.lastRot&&(c-=editor.lastRot),editor.lastRot=i;let d=editor.currentSelArc.floorMsg.room,u=document.getElementById("realRoomAngle"),p=Math.round(180*i/Math.PI)+"\xb0";if(u)u.innerHTML=p;else{let e=editor.getScreenPosition(h.getFloorCenter(editor.currentSelArc.floorMsg).clone()),t=new(0,n.UIText)(p).setId("realRoomAngle").setWidth("40px").setFontSize("50px").setMarginTop(e.y-30+"px").setMarginLeft(e.x+"px");editor.uiPanelBox.add(t)}let m={};editor.doorGroup.children.slice(0).forEach(e=>{if(!(0,o.MobileMain).checkDoorIsInRoom(e,d))return;let t=(0,o.MobileMain).getWallLine(e.centerWall),i=(0,o.MobileMain).getWallInnerPoint(e.centerWall),r=new a.Point(e.position.x,e.position.y).projectionOn(t),n=r.distanceTo((0,a.point)(i[0].x,i[0].y))[0],s=r.distanceTo((0,a.point)(i[1].x,i[1].y))[0],l=n<s?[n,0]:[s,1];m[e.centerWall.uuid]=l}),d.rotation(c),(0,o.MobileMain).checkLineCross(editor.currentSelArc.floorMsg)&&d.rotation(-c),(0,o.MobileMain).updateLineDimensionsLine(),(0,o.MobileMain).addRoomInnerLine(editor.currentSelArc.floorMsg),editor.doorGroup.children.slice(0).forEach(e=>{if(!(0,o.MobileMain).checkDoorIsInRoom(e,d))return;let t=(0,o.MobileMain).getWallInnerPoint(e.centerWall),i=m[e.centerWall.uuid];editor.currentPoint=t[0].clone().add(t[1].clone().sub(t[0]).setLength(i[0])),1==i[1]&&(editor.currentPoint=t[1].clone().add(t[0].clone().sub(t[1]).setLength(i[0]))),new(0,s.DrawDoorCommand)({currentDoor:e,valueType:"centerPoint",moveType:"centerDrag",noShowDialog:!0}).main()}),editor.newRoom=editor.currentSelArc.floorMsg}else if(editor.currentSelArc&&"doorDragPoint"==editor.currentSelArc.useType){editor.startMove||editor.execute();let e=editor.currentSelArc.position.clone(),t=editor.clickSelect.parent,n=new a.Point(editor.currentPoint.x,editor.currentPoint.y),l="";if("UWindow"==t.modelType||"LWindow"==t.modelType){let i=e.distanceTo((0,r.UtilCore).toVector3(t.leftWindow[2])),h=e.distanceTo((0,r.UtilCore).toVector3(t.rightWindow[2])),c=i<h?t.leftWindow[0]:t.rightWindow[0],d="UWindow"==t.modelType?(0,o.MobileMain).getSamePointTwoWall(c,t.centerWall):(0,o.MobileMain).getSamePointTwoWall(t.leftWindow[0],t.rightWindow[0]),u=(0,o.MobileMain).getWallLine(c);(0,o.MobileMain).getWallInnerPoint(c);let p={currentDoor:t,valueType:"doorLeftWidth",value:(l=n.projectionOn(u)).distanceTo((0,a.point)(d.x,d.y))[0],moveType:"pointDrag"};i>h&&(p.valueType="doorRightWidth"),new(0,s.DrawDoorCommand)(p).main()}else{let o=[t.wallStartPoint,t.wallEndPoint],h=new a.Line(new a.Point(o[0].x,o[0].y),new a.Point(o[1].x,o[1].y)),c=new a.Point(t.startPoint.x,t.startPoint.y),d=new a.Point(t.endPoint.x,t.endPoint.y);l=n.projectionOn(h);let u=c.projectionOn(h),p=d.projectionOn(h);(0,r.UtilCore).isSameVector(u,e)?(t.center=new i.Vector3((l.x+p.x)/2,(l.y+p.y)/2,0),t.doorWid=(0,r.UtilCore).toVector3(l).distanceTo((0,r.UtilCore).toVector3(p))):(t.center=new i.Vector3((l.x+u.x)/2,(l.y+u.y)/2,0),t.doorWid=(0,r.UtilCore).toVector3(l).distanceTo((0,r.UtilCore).toVector3(u))),new(0,s.DrawDoorCommand)({currentDoor:t,valueType:"doorWidth",value:t.doorWid,moveType:"pointDrag"}).main()}editor.currentSelArc.position.copy((0,r.UtilCore).toVector3(l))}else if(editor.moveDrawWall)editor.controlsArr[0].enablePan=!1,(0,o.MobileMain).adsorptionWall(editor.moveDrawWall,editor.currentPoint.clone());else if(editor.controlsArr[0].enablePan=!1,"hWall"==editor.toolType||"vWall"==editor.toolType){editor.helperGroup.children.slice(0).forEach(e=>{"drawAngleLine"==e.name&&editor.helperGroup.remove(e)});let e=(0,o.MobileMain).getLineIntersectionPoint(editor.currentPoint,editor.toolType),t="#000000";if(e[0]&&e[1]){let n=(0,o.MobileMain).addCircle(e[2][0],"#2EE6B8"),a=(0,o.MobileMain).addCircle(e[2][1],"#2EE6B8"),s=(0,o.MobileMain).addCircle(e[3][0],"#2EE6B8"),l=(0,o.MobileMain).addCircle(e[3][1],"#2EE6B8"),h=new i.Vector2((e[2][0].x+e[2][1].x)/2,(e[2][0].y+e[2][1].y)/2),c=new i.Vector2((e[3][0].x+e[3][1].x)/2,(e[3][0].y+e[3][1].y)/2),d=(0,r.UtilCore).toVector2(e[0]).distanceTo(h),u=(0,r.UtilCore).toVector2(e[1]).distanceTo(c),p=d<u?d:u;if(p<200){if(d==p){let t=h.clone().sub((0,r.UtilCore).toVector2(e[0]));e[0]=h,e[1]=(0,r.UtilCore).toVector2(e[1]).add(t)}else{let t=c.clone().sub((0,r.UtilCore).toVector2(e[1]));e[0]=(0,r.UtilCore).toVector2(e[0]).add(t),e[1]=c}t="#FFAB00";let i=(0,o.MobileMain).addCircle(e[0],"#ffffff",280),n=(0,o.MobileMain).addCircle(e[1],"#ffffff",280);i.position.z=11,n.position.z=11,editor.helperGroup.add(i,n)}let m=(0,o.MobileMain).addCircle(h,"#FFAB00"),f=(0,o.MobileMain).addCircle(c,"#FFAB00"),g=(0,o.MobileMain).addLine([e[0],e[1]],3,t,!0);g.material.dashSize=3,g.material.gapSize=3,g.position.z=10,g.name="drawAngleLine",editor.helperGroup.add(g,n,a,s,l,m,f),editor.splitRoomMsg=e,editor.helperGroup.children.slice(0).forEach(e=>{"wallLineHelper"==e.useType&&(editor.removeInputByClassName(editor.uiPanelBox.dom,"showWallLength"+e.uuid),editor.helperGroup.remove(e))});let y=[];e[5]&&y.push(editor.addLineWallHelper(e[5],editor.currentPoint,!1,e[5],editor.currentPoint,0)),e[6]&&y.push(editor.addLineWallHelper(e[6],editor.currentPoint,!1,e[5],editor.currentPoint,0)),y.forEach(e=>{e.useType="wallLineHelper"})}}else if("wall"==editor.toolType){if(!editor.allowDraw)return;editor.helperGroup.children.slice(0).forEach(e=>{"drawAngleLine"==e.name&&editor.helperGroup.remove(e)});let e=(0,o.MobileMain).adsorptionPointNew(editor.currentPoint,editor.specialPointArr),t=editor.downAdsorptionPoint;400>Math.abs(t.x-e.x)&&(e.x=t.x),400>Math.abs(t.y-e.y)&&(e.y=t.y);let i=(0,o.MobileMain).addLine([t,e],5,"#000000");i.position.z=10,i.name="drawAngleLine",editor.helperGroup.add(i),(0,r.UtilCore).isSameVector(t,e)||(editor.splitRoomMsg=[t,e])}else if(t.toLowerCase().indexOf("door")>-1||t.toLowerCase().indexOf("window")>-1){if(editor.currentDom)return;editor.controlsArr[0].enablePan=!1,editor.helperGroup.children.slice(0).forEach(e=>{"roomOuterLine"==e.name&&editor.helperGroup.remove(e)}),new(0,s.DrawDoorCommand)().main()}else if(p&&p.parent.modelType&&(p.parent.modelType.toLowerCase().indexOf("door")>-1||p.parent.modelType.toLowerCase().indexOf("window")>-1)){if(p.parent.positionLock)return;editor.startMove||editor.execute(),new(0,s.DrawDoorCommand)({currentDoor:editor.clickSelect.parent,valueType:"centerPoint",moveType:"centerDrag"}).main()}else editor.currentDom||(editor.controlsArr[0].enablePan=!0);editor.startMove=!0}static onTouchEnd(e){if(!editor.camera.isOrthographicCamera||e.touches.length>=2)return;document.getElementById("realRoomAngle")&&document.getElementById("realRoomAngle").remove(),editor.startMove=!1,editor.currentPoint=editor.getWorldPosition(e),editor.currentSel="",editor.selCacheJson="";let t=editor.downEvent.changedTouches[0],i=e.changedTouches[0],n=Math.abs(t.screenX-i.screenX)<editor.config.screenMoveArea&&Math.abs(t.screenY-i.screenY)<editor.config.screenMoveArea;editor.helperGroup.children.slice(0).forEach(e=>{("drawLine"==e.name||"drawAngleLine"==e.name)&&editor.helperGroup.remove(e),"wallLineHelper"==e.useType&&(editor.removeInputByClassName(editor.uiPanelBox.dom,"showWallLength"+e.uuid),editor.helperGroup.remove(e))}),editor.removeInputByClassName(editor.uiPanelBox.dom,"showMoveAngle");let c=e.changedTouches[0];if(editor.selDom&&editor.list.getDomByPoint.dispatch(c.clientX,c.clientY,"touchEnd"),n){if(editor.currentDom&&"wall"==editor.toolType)editor.helperGroup.children.slice(0).forEach(e=>{"roomOuterLine"==e.name&&editor.helperGroup.remove(e)}),editor.list.showModelMsg.dispatch({type:"drawWall",autoCompletion:editor.config.mobileConfig.autoCompletion,hvSwitch:editor.config.mobileConfig.hvSwitch});else if(editor.currentDom&&"wall"!=editor.toolType)editor.list.showToast.dispatch("拖动添加这个元素");else{let t=h.getObject(e);if(editor.helperGroup.children.slice(0).forEach(e=>{"roomOuterLine"==e.name&&editor.helperGroup.remove(e),"doorLineHelper"==e.useType&&(editor.removeInputByClassName(editor.uiPanelBox.dom,"showDoorLength"+e.uuid),editor.helperGroup.remove(e))}),t.length>0&&"free"==editor.toolType){let e=t[0].object;editor.clickSelect=e;let i=(0,o.MobileMain).getDialogMsg(e);if("floor"==e.useType)(0,o.MobileMain).addRoomHelper(e),editor.list.showModelMsg.dispatch(i);else if("wall"==e.useType){if(2==t.length){let n=t[1].object;if("wall"==n.useType){let t=(0,o.MobileMain).getWallInnerPoint(e),a=(0,o.MobileMain).getWallInnerPoint(n),s=(0,r.UtilCore).handleLineData(t[0],t[1]),l=(0,r.UtilCore).handleLineData(a[0],a[1]),h=(0,r.UtilCore).smallDistanceByPointOnLine(s,editor.currentPoint.clone()),c=(0,r.UtilCore).smallDistanceByPointOnLine(l,editor.currentPoint.clone()),d=h.clone().distanceTo(editor.currentPoint.clone());c.clone().distanceTo(editor.currentPoint.clone())<d&&(e=n,editor.clickSelect=e,i=(0,o.MobileMain).getDialogMsg(e))}}(0,o.MobileMain).addWallHelper(e),editor.list.showModelMsg.dispatch(i)}if("dragPoint"==e.useType){(0,o.MobileMain).addPointHelper(e.parent.center);let t=(0,o.MobileMain).getWallByPoint(e.parent.center),i=e.parent.center,r="";t.forEach(e=>{let n=(0,o.MobileMain).getMeshOtherPoint(e,i).clone().sub(i);t.forEach(t=>{if(t.uuid==e.uuid)return;let a=(0,o.MobileMain).getMeshOtherPoint(t,i).clone().sub(i).angleTo(n);r||(r=a),a<r&&(r=a)})}),editor.list.showModelMsg.dispatch({type:"point",angle:Math.round(180*r/Math.PI)})}let n="";e.parent&&(n=e.parent.modelType),n&&(n.toLowerCase().indexOf("door")>-1||n.toLowerCase().indexOf("window")>-1)&&(0,o.MobileMain).addDoorHelper(e.parent)}else editor.clickSelect="","free"==editor.toolType&&editor.list.showModelMsg.dispatch("")}}else{if(editor.newRoom){editor.helperGroup.children.slice(0).forEach(e=>{"roomOuterLine"==e.name&&(editor.helperGroup.remove(e),e.domClass&&editor.removeInputByClassName(editor.uiPanelBox.dom,"showWallLength"+e.uuid))}),(0,o.MobileMain).addRoomHelper(editor.newRoom);let e=(0,o.MobileMain).getDialogMsg(editor.newRoom);editor.list.showModelMsg.dispatch(e),editor.newRoom=""}if(editor.booleanFloor){(0,o.MobileMain).updateScene(editor.booleanFloor),editor.helperGroup.children.slice(0).forEach(e=>{"roomOuterLine"==e.name&&editor.helperGroup.remove(e)});let e=(0,o.MobileMain).getDialogMsg(editor.booleanFloor);editor.list.showModelMsg.dispatch(e),(0,o.MobileMain).addRoomHelper(editor.booleanFloor),editor.clickSelect&&0!=editor.clickSelect.length||(0,o.MobileMain).autoSetCamera(editor.booleanFloor),editor.clickSelect=editor.booleanFloor,editor.booleanFloor=""}if(("hWall"==editor.toolType||"vWall"==editor.toolType||"wall"==editor.toolType)&&(editor.helperGroup.children.slice(0).forEach(e=>{"roomOuterLine"==e.name&&editor.helperGroup.remove(e)}),editor.clickSelect="",editor.splitRoomMsg)){editor.execute();let e=!editor.config.mobileConfig.autoCompletion,t=!1;if(editor.downSel&&0!=editor.downSel.length){let e="";editor.downSel.forEach(t=>{"floor"==t.object.useType&&(e=t.object)}),"floor"==e.useType&&(t=e.room)}let i=(0,l.Room).addWall(1,e,t,(0,a.point)(editor.splitRoomMsg[0].x,editor.splitRoomMsg[0].y),(0,a.point)(editor.splitRoomMsg[1].x,editor.splitRoomMsg[1].y));editor.wallGroup.add(i[0]),t||editor.wallGroup3D.add(i[1])}let e=editor.toolType;!editor.currentDom&&(e.toLowerCase().indexOf("door")>-1||e.toLowerCase().indexOf("window")>-1)&&editor.execute(new s.DrawDoorCommand,"放置门窗"),(0,o.MobileMain).updateLineDimensionsLine()}editor.downSel=[],editor.selDom="",editor.moveRoomArr="",editor.splitRoomMsg="",editor.currentSelArc="",delete editor.moveDrawWall,delete editor.lastMoveVec,delete editor.lastRot}static onMouseWheel(e){}static getFloorCenter(e){e.updateMatrixWorld();let t=new i.Vector3;return e.geometry.computeBoundingBox(),t.addVectors(e.geometry.boundingBox.min,e.geometry.boundingBox.max),t.multiplyScalar(.5),e.localToWorld(t),t}static getObject(e){editor.mouse.x=e.changedTouches[0].pageX/window.innerWidth*2-1,editor.mouse.y=-(2*(e.changedTouches[0].pageY/window.innerHeight))+1,editor.raycaster.setFromCamera(editor.mouse,editor.camera);let t=editor.pointHelperGroup.children.concat(editor.otherMeshs);t=(t=(t=(t=t.concat(editor.wallGroup.children)).concat(editor.floorGroup2d.children)).concat(editor.doorGroup.children)).concat(editor.helperGroup.children);var i=editor.raycaster.intersectObjects(t,!0);if(i.length>0&&"floor"==i[0].useType){let e=[];i.forEach(t=>{"Wall2"==t.object.type&&e.push(t)}),e.length>0&&(i=e)}return i}}}),parcelRequire.register("gMHcS",function(e,t){$parcel$export(e.exports,"DrawDoorCommand",()=>l);var i=parcelRequire("4xklQ"),r=parcelRequire("47Y2g"),n=parcelRequire("gDTsF"),o=parcelRequire("9QhXH"),a=parcelRequire("9HO6e"),s=parcelRequire("dVRrd");class l{constructor(e={}){this.param=e,this.doorWid=1e3,this.toolType=editor.toolType,this.wallDepth=240,this.start=new i.Vector2(1,0),this.end=new i.Vector2(2,0),this.dir="outside",this.angle=0,this.res=[],this.LWidth=1200,this.RWidth=1200,this.leftWall="",this.rightWall="",this.centerWall="",this.positionLock=!!e.hasOwnProperty("positionLock")&&e.positionLock,this.lengthLock=!!e.hasOwnProperty("lengthLock")&&e.lengthLock}main(){if(!editor.currentPoint)return;let e=editor.currentPoint.clone(),t="";if(this.param.currentDoor){if(editor.currentDraw=this.param.currentDoor,this.positionLock=editor.currentDraw.positionLock,this.lengthLock=editor.currentDraw.lengthLock,this.toolType=this.param.currentDoor.modelType,e=this.param.currentDoor.center.clone(),"doorWidth"==this.param.valueType)this.doorWid=1*this.param.value;else if("doorRightWidth"==this.param.valueType||"doorLeftWidth"==this.param.valueType){if("UWindow"==this.toolType||"LWindow"==this.toolType)this.LWidth=editor.currentDraw.leftWindow[1],this.RWidth=editor.currentDraw.rightWindow[1],"doorLeftWidth"==this.param.valueType&&(this.LWidth=1*this.param.value),"doorRightWidth"==this.param.valueType&&(this.RWidth=1*this.param.value);else{let t=editor.currentDraw.sortArr,i=t[0].distanceTo(t[1]);this.doorWid=Math.round(t[1].distanceTo(t[2])[0]);let r=(0,a.UtilCore).toVector3(t[1]).sub((0,a.UtilCore).toVector3(t[0]));"doorRightWidth"==this.param.valueType&&(r.negate(),i=t[2].distanceTo(t[3])),r.setLength(1*this.param.value-Math.round(i[0])),e.add(r)}}else"centerPoint"==this.param.valueType&&(e=editor.currentPoint.clone(),"UWindow"==this.toolType||"LWindow"==this.toolType?(this.LWidth=editor.currentDraw.leftWindow[1],this.RWidth=editor.currentDraw.rightWindow[1]):this.doorWid=editor.currentDraw.doorWid)}else this.param.modelType&&(this.toolType=this.param.modelType,this.windowThick=this.param.windowThick,this.doorWid=this.param.width,this.LWidth=this.param.LWidth,this.RWidth=this.param.RWidth,this.dir=this.param.dir);if("LWindow"==this.toolType?(t=this.getNearWallForLWindow(e,2),this.leftWall=t[3],this.rightWall=t[4]):"UWindow"==this.toolType?(t=this.getNearWallForUWindow(e,2),this.leftWall=t[4],this.rightWall=t[5],this.centerWall=t[3]):t=this.getNearPoint(e),1!=t.length){if(this.res=t,editor.currentDraw&&(editor.currentDraw.parent.remove(editor.currentDraw),(0,r.MobileMain).removeDoorHelper()),t.length>=3){e=(0,a.UtilCore).toVector3(t[0]),this.start=t[1],this.end=t[2],this.wallDepth=1*t[3].thickness;let n=t[1].distanceTo(t[2]);n<=this.doorWid&&(this.doorWid=n);let o=(0,a.UtilCore).toVector2(t[2]).sub((0,a.UtilCore).toVector2(t[1]));this.angle=o.angle();let s=this.end.clone().sub(this.start);if(s=new(0,i.Vector3)(-s.y,s.x,0).setLength(this.wallDepth/2),e.add(s),"LWindow"==this.toolType&&this.rightWall){let t=(0,r.MobileMain).getWallInnerPoint(this.rightWall),i=(0,r.MobileMain).getRoomOuterDir(t[0],t[1]).setLength(this.rightWall.thickness/2);e.add(i)}}if("door"==this.toolType)editor.currentDraw=(0,o.DM).createBaseDoor(e,this.doorWid,this.dir,this.angle,this.wallDepth,this.start,this.end);else if("slidingdoor"==this.toolType)editor.currentDraw=(0,o.DM).createSlidingDoor(e,this.doorWid,this.angle,this.wallDepth,this.start,this.end,this.dir);else if("window"==this.toolType)editor.currentDraw=(0,o.DM).createBaseWindow(e,this.doorWid,this.angle,this.wallDepth,this.start,this.end);else if("childMotherDoor"==this.toolType)editor.currentDraw=(0,o.DM).createLashDoor(e,this.doorWid,this.angle,this.wallDepth,this.start,this.end,this.dir);else if("singleDoubleDoor"==this.toolType)editor.currentDraw=(0,o.DM).createDODoor(e,this.doorWid,this.angle,this.wallDepth,this.start,this.end,this.dir);else if("archDoor"==this.toolType)editor.currentDraw=(0,o.DM).createSectorDoor(e,this.doorWid,this.angle,this.wallDepth,this.start,this.end);else if("frenchwindows"==this.toolType)editor.currentDraw=(0,o.DM).createFrenchWindow(e,this.doorWid,this.angle,this.wallDepth,this.start,this.end);else if("baywindow"==this.toolType||"straightBayWindow"==this.toolType){let t=this.wallDepth;t>=500&&(t=this.wallDepth-500),editor.currentDraw=(0,o.DM).createPanoramicWindow(e,this.doorWid,this.angle,t,this.start,this.end)}else"LWindow"==this.toolType?editor.currentDraw=(0,o.DM).createLWindowNew(e,this.leftWall,this.rightWall,this.LWidth,this.RWidth):"UWindow"==this.toolType&&(editor.currentDraw=(0,o.DM).createUWindow(e,this.leftWall,this.centerWall,this.rightWall,this.LWidth,this.RWidth));editor.currentDraw&&(editor.currentDraw.position.z=15,editor.currentDraw.centerWall=this.res[3],editor.currentDraw&&(editor.scene.add(editor.currentDraw),t.length>=3&&!this.param.noShowDialog&&(0,r.MobileMain).addDoorHelper(editor.currentDraw),("pointDrag"==this.param.moveType||"centerDrag"==this.param.moveType)&&(this.param.noShowDialog||(editor.clickSelect=editor.currentDraw.children[0]),editor.doorGroup.add(editor.currentDraw),this.res.length<3&&editor.currentDraw&&"centerDrag"!=this.param.moveType&&editor.currentDraw.parent.remove(editor.currentDraw),editor.currentDraw=""),editor.currentDraw.positionLock=this.positionLock,editor.currentDraw.lengthLock=this.lengthLock))}}execute(){this.main(),editor.currentDraw&&(editor.doorGroup.add(editor.currentDraw),(0,r.MobileMain).removeDoorHelper(),this.res.length<3&&editor.currentDraw?editor.currentDraw.parent.remove(editor.currentDraw):this.param.noShowDialog?editor.list.showModelMsg.dispatch(""):((0,r.MobileMain).addDoorHelper(editor.currentDraw),editor.clickSelect=editor.currentDraw.children[0]),editor.currentDraw="",editor.toolType="free")}undo(e){(0,r.MobileMain).readCache(e)}redo(e){(0,r.MobileMain).readCache(e)}getNearPoint(e){let t=new n.Point(e.x,e.y),i=[];return editor.wallGroup.children.slice(0).forEach(e=>{let o=(0,r.MobileMain).getWallInnerPoint(e),a=new n.Line(new n.Point(o[0].x,o[0].y),new n.Point(o[1].x,o[1].y)),s=t.distanceTo(a)[0],l=new n.Segment(new n.Point(o[0].x,o[0].y),new n.Point(o[1].x,o[1].y)),h=t.projectionOn(a);if(editor.config.drawDoorArea>=s&&l.contains(new n.Point(h.x,h.y))){let t=o[0].distanceTo(o[1]),r=Math.round(h.distanceTo(new n.Point(o[0].x,o[0].y))),a=Math.round(h.distanceTo(new n.Point(o[1].x,o[1].y))),s=o[1].clone().sub(o[0]);t>=this.doorWid&&(t=this.doorWid);let l=30;if(r-t/2<30){i=[h=o[0].clone().add(s.clone().setLength(t/2)),o[0],o[1],e];return}if(a-t/2<l){i=[h=o[1].clone().add(s.clone().negate().setLength(t/2)),o[0],o[1],e];return}if(r<=t/2||a<=t/2){i=["notAllowMove1"];return}0==i.length&&(i=[h,o[0],o[1],e]);return}}),i}getNearWallForLWindow(e,t){let i=[];return editor.wallGroup.children.slice(0).forEach(n=>{let o=(0,r.MobileMain).getWallInnerPoint(n),l=o[0],h=o[1],c="";if((0,a.UtilCore).toVector3(l).distanceTo(e)<=editor.config.drawDoorArea&&(c=l),(0,a.UtilCore).toVector3(h).distanceTo(e)<=editor.config.drawDoorArea&&(c=h),""==c)return;let d=(0,r.MobileMain).getWallByPoint(c);if(d.length!=t)return;let u=(0,r.MobileMain).getRoomByWall(n),p=(0,s.MobileListener).getFloorCenter(u),m=(0,r.MobileMain).getMeshOtherPoint(d[0],c),f=(0,r.MobileMain).getMeshOtherPoint(d[1],c),g=(0,a.UtilCore).getClockWise(m,c,f),y=(0,r.MobileMain).getWallInnerPoint(d[0]),x=(0,r.MobileMain).getWallInnerPoint(d[1]);d[0].startPoint=y[0],d[0].endPoint=y[1],d[1].startPoint=x[0],d[1].endPoint=x[1],g<0&&(i=[c,y[0],y[1],d[0],d[1],p]),g>0&&(i=[c,x[0],x[1],d[1],d[0],p])}),i}getNearWallForUWindow(e){let t=[],o=new n.Point(e.x,e.y);return editor.wallGroup.children.slice(0).forEach(e=>{let l=(0,r.MobileMain).getWallInnerPoint(e);e.startPoint=(0,a.UtilCore).toVector2(l[0]),e.endPoint=(0,a.UtilCore).toVector2(l[1]);let h=new n.Segment(new n.Point(l[0].x,l[0].y),new n.Point(l[1].x,l[1].y)),c=o.distanceTo(h)[0],d=new n.Line(new n.Point(l[0].x,l[0].y),new n.Point(l[1].x,l[1].y)),u=o.projectionOn(d),p=h.contains(new n.Point(u.x,u.y));if(editor.config.drawDoorArea>=c&&p){let o=(0,r.MobileMain).getWallByPoint(l[0],e),h=(0,r.MobileMain).getWallByPoint(l[1],e);if(1!=o.length||1!=h.length)return;let c=(0,r.MobileMain).getMeshOtherPoint(o[0],l[0]),u=(0,r.MobileMain).getMeshOtherPoint(h[0],l[1]),p=!1;if(new(0,n.Point)(c.x,c.y).leftTo(d)===new(0,n.Point)(u.x,u.y).leftTo(d)&&(p=!0),!p)return;let m=l[0].clone().sub(l[1]),f=c.clone().sub(l[0]),g=u.clone().sub(l[1]);if(!(0==m.dot(f)&&0==m.dot(g)))return;let y=new i.Vector3((l[0].x+l[1].x)/2,(l[0].y+l[1].y)/2,0),x=(0,a.UtilCore).getClockWise(c,l[0],l[1]),w=(0,r.MobileMain).getRoomByWall(e),b=(0,s.MobileListener).getFloorCenter(w);x>0&&(t=[y,l[0],l[1],e,h[0],o[0],b]),x<0&&(t=[y,l[0],l[1],e,o[0],h[0],b])}}),t}}}),parcelRequire.register("kLdsz",function(e,t){$parcel$export(e.exports,"Room",()=>P);var i=parcelRequire("4xklQ"),r=parcelRequire("8DRdc"),n=parcelRequire("7RZ5r");parcelRequire("3XJrN");var o=parcelRequire("7BJhL"),a=parcelRequire("6Hryq"),s=parcelRequire("94t2y"),l=parcelRequire("ckwVR"),h=parcelRequire("4J2OP"),c=parcelRequire("gDTsF"),d=parcelRequire("eTLBN"),u=parcelRequire("9HO6e"),p=parcelRequire("hrM0U");let{unify:m,subtract:f,intersect:g,innerClip:y,outerClip:x}=d;i.BufferGeometry.prototype.computeBoundsTree=h.computeBoundsTree,i.BufferGeometry.prototype.disposeBoundsTree=h.disposeBoundsTree,c.Point.prototype.toArray=function(){return[this.x,this.y]},c.Vector.prototype.setLength=function(e){return this.normalize().multiply(e)},c.Vector.prototype.toVector2=function(){return new i.Vector2(this.x,this.y)},c.Polygon.prototype.center=function(){let e=[],t=this.edges.values(),i=t.next();for(;!i.done;){let r=i.value;e.push([r.shape.middle().x,r.shape.middle().y]),i=t.next()}let r=e.reduce((e,t)=>e+t[0],0),n=e.reduce((e,t)=>e+t[1],0);return new c.Point(r/this.edges.size,n/this.edges.size)};let w=240,b=240,v=240,M={steps:2,depth:2800,bevelEnabled:!0,bevelThickness:0,bevelSize:0,bevelSegments:1},S={id:1};class P{constructor(e,t=new i.Vector2){for(let i in e)e[i][0]+=t.x,e[i][1]+=t.y;this.deletedWallPillar=!0,this.baseWallStyle=1,this.innerWallStyle=0,this.innerWalls=[],this.innerWall3Ds=[],this.wall3Ds=[],this.polygon=[e],this.firstGenerate(),this.name=S.id++,this.booleanRoom=[],this.uuid=i.MathUtils.generateUUID(),P.instances.push(this)}firstGenerate(){this.baseWalls=[];for(let e=1;e<this.polygon[0].length;e++)this.generateWall(new c.Point(this.polygon[0][e][0],this.polygon[0][e][1]),new c.Point(this.polygon[0][e-1][0],this.polygon[0][e-1][1]));this.handleWall();let e=this.getInnerPoints();return this.updateFlattenNew(e),this.generateFloorNew(e),this.generateCPolyNew(e),this.floor.allWalls=this.baseWalls,this.floor.room=this,this.floor}generateWall(e,t,n=!1){this.getRandom(0,1)||this.getRandom(0,1);let o=new r.Wall2DGeometry({start:{x:e.x,y:e.y},end:{x:t.x,y:t.y},line:this.baseWallStyle,thickness:w}),a=new i.MeshBasicMaterial({color:3552822,side:i.DoubleSide,transparent:!0,opacity:.8}),s=new r.Wall2(o,a);if(s.start=o.startP,s.startPoint=new i.Vector3(o.startP.x,o.startP.y,0),s.end=o.endP,s.endPoint=new i.Vector3(o.endP.x,o.endP.y,0),s.line=o.style,s.thickness=w,o.translate(0,0,1),s.computeLineEquation(),s.isDeleted=!1,n)return s;this.baseWalls.push(s)}handleWall(){let e=[];this.baseWalls.forEach(t=>{t.getRightWall(e),t.handle(),e.push(t)})}getInnerPoints(){let e=Array.from(this.baseWalls),t=[],i=e.shift();return this.getFloorPoints(i,t),this.getInnerPolyArr(e,t),t}updateFlattenNew(e){let t=new c.Polygon,i=Array.from(e);i.shift(),t.addFace(i),this.flattenPolygon=t}generateFloorNew(e){let t,r=new i.Shape,n=new i.Shape,o=this.pointsOffset(e,-.001);r.moveTo(e[0].x,e[0].y);for(let t=1;t<e.length;t++)r.lineTo(e[t].x,e[t].y);n.moveTo(o[0].x,o[0].y);for(let e=1;e<o.length;e++)n.lineTo(o[e].x,o[e].y);let a=new i.ExtrudeGeometry(n,M);this.booleanMesh=new i.Mesh(a,new i.MeshStandardMaterial({color:16777215})),this.booleanMesh.layers.set(1);let s=new i.ShapeGeometry(r);this.floor3D&&(t=this.floor3D.parent)&&t.remove(this.floor3D),this.floor3D=new i.Mesh(s,new i.MeshStandardMaterial({color:14275757,side:i.DoubleSide})),this.floor3D.useType="3dfloor",this.floor3D.layers.set(1),t&&t.add(this.floor3D);let l=s.clone().translate(0,0,5);this.floor=new i.Mesh(l,new i.MeshBasicMaterial({color:14275757,side:i.DoubleSide})),this.floor.useType="floor",this.updateAllRoomPoints(),this.area=this.flattenPolygon.area()/1e6,this.floor.area=this.area.toFixed(2)}pointsOffset(e,t){let i=e.map(e=>new c.Vector(e.x,e.y)),r=[];for(let e=1;e<i.length;e++){let n=new c.Vector(i[e].x-i[e-1].x,i[e].y-i[e-1].y);n=n.rotate90CCW().setLength(t);let o=i[e-1].add(n),a=i[e].add(n);r.push(new c.Line(new c.Point(o.x,o.y),new c.Point(a.x,a.y)))}r.push(r[0]);let n=[];for(let e=1;e<r.length;e++)if(!r[e-1].parallelTo(r[e])){let t=r[e-1].intersect(r[e])[0];n.push(t)}return n.push(n[0]),n}updateAllRoomPoints(){let e=Array.from(this.baseWalls),t=[],i=e.shift();for(t.push(i.parameter.outerSegment.ps,i.parameter.outerSegment.pe);e.length;){let i=t[t.length-1],r=!1;if(e.forEach((n,o)=>{let a=n.parameter.outerSegment;if(a.ps.equalTo(i)){t.push(a.pe),e.splice(o,1),r=!0;return}if(a.pe.equalTo(i)){t.push(a.ps),e.splice(o,1),r=!0;return}}),!r){0!=e.length&&console.log("maybe some point can not find equal point.");break}}t.shift(),t.reverse(),this.floor.allRoomPoints=[],t.forEach(e=>{this.floor.allRoomPoints.push((0,u.UtilCore).toVector3(e))})}generateCPolyNew(e){let t=e.map(e=>new c.Vector(e.x,e.y)),i=[];for(let e=1;e<t.length;e++){let r=new c.Vector(t[e].x-t[e-1].x,t[e].y-t[e-1].y);r=r.rotate90CCW().setLength(b);let n=t[e-1].add(r),o=t[e].add(r);i.push(new c.Line(new c.Point(n.x,n.y),new c.Point(o.x,o.y)))}i.push(i[0]);let r=[];for(let e=1;e<i.length;e++)if(!i[e-1].parallelTo(i[e])){let t=i[e-1].intersect(i[e])[0];r.push(t)}let n=[];for(let e=0;e<r.length;e++){let t=e==r.length-1?0:e+1;n.push(new c.Segment(r[e],r[t]))}this.cPoly=new c.Polygon,this.cPoly.addFace(n)}generateWall3D(){let e=Array.from(this.baseWalls);if(this.wall3Ds.length)for(let t of this.wall3Ds)e.forEach((i,r)=>{if(t.w2u==i.uuid){e.splice(r,1);return}});for(let t of e){let e=P.generateWall3DBy2(t);for(let t in this.booleanRoom)e=this.boolean(e,this.booleanRoom[t].booleanMesh);this.wall3Ds.push(e)}this.updateWall3D()}static generateWall3DBy2(e){let t=new i.Shape,r=e.geometry.attributes.position;t.moveTo(r.getX(0),r.getY(0)),[1,2,5,4,3,0].forEach(e=>{t.lineTo(r.getX(e),r.getY(e))});let o=new i.ExtrudeGeometry(t,M),a=new n.Wall3(o,new i.MeshStandardMaterial({color:16777215}));return a.w2u=e.uuid,a.layers.set(1),a.castShadow=!0,a}roomMove(e){this.updateInnerWall(e),this.updateWall(e),this.updateThisPolygon(),this.updateFloorNew()}updateWall(e){for(let t of this.baseWalls){let i=t.geometry.attributes.position;for(let r=0;r<i.count;r++){let n=new c.Point(i.getX(r)+e.x,i.getY(r)+e.y);t.updateVertex(r,n)}t.updateLines(),t.geometry.computeBoundingSphere(),t.geometry.computeVertexNormals()}}updateInnerWall(...e){function t(e,t){let i=e.geometry.attributes.position;for(let r=0;r<i.count;r++){let n=new c.Point(i.getX(r)+t.x,i.getY(r)+t.y);e.updateVertex(r,n)}e.updateLines(),e.geometry.computeBoundingSphere(),e.geometry.computeVertexNormals()}if(1==e.length&&e[0]instanceof i.Vector3)for(let i of this.innerWalls)t(i,e[0]);if(2==e.length&&t(e[0],e[1]),3==e.length){let t=e[0],i=e[1],r=e[2],n=t.getIndex(i),o=new c.Point(i.x+r.x,i.y+r.y);t.updateVertex(n,o);let a=t.getVertex(2),s=t.getVertex(5),l=s.clone().sub(a),h=new(0,c.Vector)(l.x,l.y).rotate90CCW().setLength(t.thickness/2).toVector2(),d=a.clone().add(h);t.updateVertex(1,d);let u=d.clone().add(h);t.updateVertex(0,u);let p=s.clone().add(h);t.updateVertex(4,p);let m=p.clone().add(h);t.updateVertex(3,m)}}updateThisPolygon(){let e=[],t=[],i=Array.from(this.baseWalls),r=i.shift();e.push(r.end,r.start),t.push(r.end.toArray(),r.start.toArray()),this.recursiveFunction(i,e,t),this.polygon=[t]}recursiveFunction(e,t,i){if(e.length){let r=t[t.length-1],n=!1;e.forEach((o,a)=>{if(o.start.equals(r)){t.push(o.end),i.push(o.end.toArray()),e.splice(a,1),n=!0;return}if(o.end.equals(r)){t.push(o.start),i.push(o.start.toArray()),e.splice(a,1),n=!0;return}}),n&&e.length?this.recursiveFunction(e,t,i):0!=e.length&&console.log("something went wrong.")}}updateFloorNew(){let e=this.getInnerPoints(),t=new i.Shape,r=new i.Shape,n=this.pointsOffset(e,-.001);t.moveTo(e[0].x,e[0].y);for(let i=1;i<e.length;i++)t.lineTo(e[i].x,e[i].y);r.moveTo(n[0].x,n[0].y);for(let e=1;e<n.length;e++)r.lineTo(n[e].x,n[e].y);let o=new i.ExtrudeGeometry(r,M);this.booleanMesh.geometry.dispose(),this.booleanMesh.geometry=o;let a=new i.ShapeGeometry(t);this.floor3D.geometry.dispose(),this.floor3D.geometry=a,this.floor.geometry.dispose(),this.floor.geometry=a.clone(),this.floor.geometry.translate(0,0,5),this.updateFlattenNew(e),this.generateCPolyNew(e),this.updateAllRoomPoints(),this.area=this.flattenPolygon.area()/1e6,this.floor.area=this.area.toFixed(2)}updateWall3D(e=!1){for(let t of e?[e]:Array.from(this.baseWalls)){let e=new i.Shape,r=t.geometry.attributes.position;e.moveTo(r.getX(0),r.getY(0)),[1,2,5,4,3,0].forEach(t=>{e.lineTo(r.getX(t),r.getY(t))});let n=new i.ExtrudeGeometry(e,M),o=this.wall3Ds.filter(e=>e.w2u==t.uuid)[0];o.geometry.dispose(),o.geometry=n;let a=this.boolean(o,this.booleanMesh);o.geometry=a.geometry}}vertexMove(e,t){let r=this.getWallsByPoint(e),n=new i.Vector2(e.x,e.y),o=new i.Vector2(t.x,t.y),a=n.add(o);for(let t of r){let i=t.getIndex(e),r;0==i&&(r=a.distanceTo(t.getVertex(3))),1==i&&(r=a.distanceTo(t.getVertex(4))),2==i&&(r=a.distanceTo(t.getVertex(5))),3==i&&(r=a.distanceTo(t.getVertex(0))),4==i&&(r=a.distanceTo(t.getVertex(1))),5==i&&(r=a.distanceTo(t.getVertex(2)))}for(let t of r){let r,n,o=t.getIndex(e),s,l;if((0==o||3==o)&&(s="inner"),(1==o||4==o)&&(s="middle"),2==o||5==o){if(s="outer",2==o){l=t.getPoint(5);let e=t.getVertex(5),o=a.clone().sub(e);n=new(0,c.Vector)(o.x,o.y).rotate90CW().normalize(),r=new(0,i.Vector2)(n.x,n.y).setLength(t.thickness/2)}if(5==o){l=t.getPoint(2);let e=t.getVertex(2),o=a.clone().sub(e);n=new(0,c.Vector)(o.x,o.y).rotate90CCW().normalize(),r=new(0,i.Vector2)(n.x,n.y).setLength(t.thickness/2)}}switch(s){case"inner":t.parameter.innerLine.pt=l.clone(),t.parameter.innerLine.norm=n;break;case"middle":t.parameter.middleLine.pt=l.clone(),t.parameter.middleLine.norm=n;break;case"outer":if(o<3){t.parameter.outerLine=new c.Line(new c.Point(a.x,a.y),l);let e=new(0,i.Vector2)(l.x,l.y).add(r),n=a.clone().add(r);t.parameter.middleLine=new c.Line(new c.Point(n.x,n.y),new c.Point(e.x,e.y));let o=e.add(r),s=n.add(r);t.parameter.innerLine=new c.Line(new c.Point(s.x,s.y),new c.Point(o.x,o.y))}else{t.parameter.outerLine=new c.Line(l,new c.Point(a.x,a.y));let e=new(0,i.Vector2)(l.x,l.y).add(r),n=a.clone().add(r);t.parameter.middleLine=new c.Line(new c.Point(e.x,e.y),new c.Point(n.x,n.y));let o=e.add(r),s=n.add(r);t.parameter.innerLine=new c.Line(new c.Point(o.x,o.y),new c.Point(s.x,s.y))}}this.updateWallWithSameVertex(l,!1,l)}let s=this.updateWallWithSameVertex(e,!0,a);return this.updateThisPolygon(),this.updateFloorNew(),s}getWallsByPoint(e){let t=[];for(let i of this.baseWalls)for(let r of i.parameter.vertices)r.equalTo(e)&&t.push(i);return t}updateWallWithSameVertex(e,t=!1,i=!1){let r,n,o,a=this.getWallsByPoint(e),s=a[0],l=a[1];s.parameter.innerLine.parallelTo(l.parameter.innerLine)?(n=(o=new c.Point(i.x,i.y)).projectionOn(s.parameter.middleLine),r=o.projectionOn(s.parameter.innerLine)):(r=s.parameter.innerLine.intersect(l.parameter.innerLine)[0],n=s.parameter.middleLine.intersect(l.parameter.middleLine)[0],o=s.parameter.outerLine.intersect(l.parameter.outerLine)[0]);let h=s.getIndex(e),d=l.getIndex(e),u=h<3?0:3;s.updateVertex(u,r),s.updateVertex(u+1,n),t&&s.updateVertex(u+2,o);let p=d<3?0:3;return l.updateVertex(p,r),l.updateVertex(p+1,n),t&&l.updateVertex(p+2,o),l.getPoint(p+2)}edgeMove(e){let t,i=this.getWallsByPoint(e[0][0]),r=this.getWallsByPoint(e[1][0]);r.includes(i[0])&&(t=i[0]),r.includes(i[1])&&(t=i[1]);let n=[];return e.forEach(e=>{n.push(this.vertexMove(e[0],e[1]))}),n}rotation(e){let t=this.flattenPolygon.center();[...this.baseWalls,...this.innerWalls].forEach(i=>{let r=i.geometry.attributes.position;for(let n=0;n<r.count;n++){let o=new c.Point(r.getX(n),r.getY(n)).rotate(e,t);i.updateVertex(n,o)}r.needsUpdate=!0,i.geometry.computeBoundingBox(),i.geometry.computeBoundingSphere(),i.geometry.computeVertexNormals(),i.updateLines()}),this.updateThisPolygon(),this.updateFloorNew()}spliteWall(e,t){t instanceof c.Point||(t=e.parameter.outerSegment.middle());let n=new r.Wall2(e.geometry.clone(),new i.MeshBasicMaterial({color:3552822,side:i.DoubleSide,transparent:!0,opacity:.8}));n.computeLineEquation(),n.start=e.start.clone(),n.end=e.end.clone(),n.startPoint=e.startPoint.clone(),n.endPoint=e.endPoint.clone(),this.baseWalls.push(n),e.thickness&&(n.thickness=e.thickness),e.positionLock&&(n.positionLock=e.positionLock),e.lengthLock&&(n.lengthLock=e.lengthLock),n.line=e.line,n.isDeleted=!1,e.isDeleted&&(n.isDeleted=e.isDeleted);let o=t.projectionOn(e.parameter.middleLine),a=t.projectionOn(e.parameter.innerLine);return e.updateVertex(3,a),e.updateVertex(4,o),e.updateVertex(5,t),n.updateVertex(0,a),n.updateVertex(1,o),n.updateVertex(2,t),this.updateThisPolygon(),this.updateFloorNew(),console.log("floor - allRoomPoints - ",this.floor.allRoomPoints),n}mergeParalleledWall(e){let t,i,r=this.getWallsByPoint(e),n=r[0],o=r[1];n.parameter.outerSegment.length<o.parameter.outerSegment.length?(t=o,i=n):(t=n,i=o),this.baseWalls.splice(this.baseWalls.indexOf(i),1),this.removeWall3DBy2(i),i.parent.remove(i);let a=i.getIndex(e),s=2==a?i.getPoint(5):i.getPoint(2);t.updateVertex(2==a?5:2,s),this.updateWallByOuterPoints(t),this.updateThisPolygon(),this.updateFloorNew()}edgeMoveAddWall(e,t,i){let r=i.getIndex(t),n=5==r?2:5,o=i.getPoint(n),a=e.clone().sub(t),s=i.getVertex(5),l=i.getVertex(2),h=s.clone().sub(l),d=new(0,c.Vector)(h.x,h.y).rotate90CCW().setLength(i.thickness/2);this.vertexMove(o,a);let u=2==r?0:3;for(let e=0;e<3;e++){let t=i.getVertex(u+e).clone().add(a);i.updateVertex(u+e,t)}e=i.getVertex(u+2);let m=2==n?0:3;o=i.getPoint(n);let f=this.getWallsByPoint(o);f.splice(f.indexOf(i),1);let g=f[0],y=i.getVertex(n),x=new(0,c.Vector)(y.x,y.y).add(d),w=x.clone().add(d),b=i.getPoint(u+1),v=new c.Line(new c.Point(x.x,x.y),b).intersect(g.parameter.middleLine)[0],M=i.getPoint(m+1),S=g.getIndex(M);g.updateVertex(S,v),i.updateVertex(m+1,v),b=i.getPoint(u);let P=new c.Line(new c.Point(w.x,w.y),b).intersect(g.parameter.innerLine)[0],T=i.getPoint(m);S=g.getIndex(T),g.updateVertex(S,P),i.updateVertex(m,P),i.updateLines();let _=i.getVertex(n),C,D=i.getPoint(2),A=i.getPoint(5),E=new c.Vector(A.x-D.x,A.y-D.y),L=new c.Vector(e.x-t.x,e.y-t.y);C=E.angleTo(L)<Math.PI?(0,p.CommonFunc).getClockWise(t,e,_)?this.generateWall(t,e,!0):this.generateWall(e,t,!0):(0,p.CommonFunc).getClockWise(t,e,_)?this.generateWall(e,t,!0):this.generateWall(t,e,!0);let I=Array.from(this.baseWalls);return this.baseWalls.push(C),C.getRightWall(I),C.handle(),this.updateThisPolygon(),this.updateFloorNew(),C}edgeMoveAddWall2(e,t){let i,r,n=e.getVertex(2),o=e.getVertex(5),a=n.clone().add(t),s=o.clone().add(t),l=new c.Vector(o.x-n.x,o.y-n.y),h=new c.Vector(a.x-n.x,a.y-n.y),d=new c.Vector(s.x-o.x,s.y-o.y);a=e.updateVertex(2,a),s=e.updateVertex(5,s),this.updateWallByOuterPoints(e),i=l.angleTo(h)<Math.PI?(0,p.CommonFunc).getClockWise(n,a,o)?this.generateWall(n,a,!0):this.generateWall(a,n,!0):(0,p.CommonFunc).getClockWise(n,a,o)?this.generateWall(a,n,!0):this.generateWall(n,a,!0),r=l.angleTo(d)<Math.PI?(0,p.CommonFunc).getClockWise(o,s,n)?this.generateWall(o,s,!0):this.generateWall(s,o,!0):(0,p.CommonFunc).getClockWise(o,s,n)?this.generateWall(s,o,!0):this.generateWall(o,s,!0);let u=Array.from(this.baseWalls);return this.baseWalls.push(i,r),i.getRightWall(u),i.handle(),r.getRightWall(u),r.handle(),this.updateThisPolygon(),this.updateFloorNew(),[i,r]}updateWallByOuterPoints(e){let t,i,r,n,o=e.getVertex(2),a=e.getVertex(5);i=a.clone().sub(o),r=0,n=3,t=new(0,c.Vector)(i.x,i.y).rotate90CCW().setLength(e.thickness/2).toVector2();let s=o.clone().add(t);e.updateVertex(r+1,s);let l=s.clone().add(t);e.updateVertex(r,l);let h=a.clone().add(t);e.updateVertex(n+1,h);let d=h.clone().add(t);e.updateVertex(n,d),e.updateLines();let u=Array.from(this.baseWalls);u.splice(u.indexOf(e),1),e.getRightWall(u),e.handle()}deleteTooShortWall(e,t,i){if(t instanceof Array)for(let i of t){let t=P.getCommonPoint(e.parameter.outerSegment,i.parameter.outerSegment),r=i.getIndex(t),n=e.getIndex(t);this.baseWalls.splice(this.baseWalls.indexOf(i),1),this.removeWall3DBy2(i),e.updateVertex(n,i.getPoint(2==r?5:2))}else{let r=P.getCommonPoint(e.parameter.outerSegment,t.parameter.outerSegment),n=t.getIndex(r),o=e.getIndex(r),a=2==o?5:2;this.vertexMove(e.getPoint(a),i),this.baseWalls.splice(this.baseWalls.indexOf(t),1),this.removeWall3DBy2(t),e.updateVertex(o,t.getPoint(2==n?5:2))}this.updateWallByOuterPoints(e),this.updateThisPolygon(),this.updateFloorNew()}removeWall3DBy2(e){this.wall3Ds.forEach((t,i)=>{if(t.w2u==e.uuid){t.parent&&t.parent.remove(t),this.wall3Ds.splice(i,1);return}})}static getCommonPoint(e,t){return e.start.equalTo(t.start)||e.start.equalTo(t.end)?e.start:!!(e.end.equalTo(t.start)||e.end.equalTo(t.end))&&e.end}static addWall(e,t,n,...o){let a,s,l,h,d,u,p,m,f,g,y,x,w,b,M;if(2==o.length){if(a=new c.Ray,o[1]instanceof c.Point){let e=new c.Vector(o[1].x-o[0].x,o[1].y-o[0].y);s=o[0].clone(),l=o[1].clone(),a.pt=l,a.norm=e.rotate90CCW().normalize()}o[1]instanceof c.Vector&&(s=o[0].clone(),l=o[0].clone(),a.pt=o[0],a.norm=o[1])}else s=(a=o[0]).pt.clone(),l=a.pt.clone();let S=a.norm.clone().setLength(v/2),T=a.norm.clone().invert().setLength(v/2);switch(e){case 0:d=s,m=l,b=a,y=new c.Ray(s.clone(),T.clone().normalize()),h=s.clone().translate(S.clone()),p=l.clone().translate(S.clone()),g=new c.Ray(h,T.clone().normalize()),w=new c.Ray(p,S.clone().normalize()),u=s.clone().translate(T.clone()),f=l.clone().translate(T.clone()),x=new c.Ray(u,T.clone().normalize()),M=new c.Ray(f,S.clone().normalize());break;case 1:h=s,p=l,w=a,g=new c.Ray(s.clone(),T.clone().normalize()),d=s.clone().translate(T.clone()),m=l.clone().translate(T.clone()),y=new c.Ray(d,T.clone().normalize()),b=new c.Ray(m,S.clone().normalize()),u=d.clone().translate(T.clone()),f=m.clone().translate(T.clone()),x=new c.Ray(u,T.clone().normalize()),M=new c.Ray(f,S.clone().normalize());break;case 2:u=s,f=l,M=a,x=new c.Ray(s,T.clone().normalize()),d=s.clone().translate(S.clone()),m=l.clone().translate(S.clone()),y=new c.Ray(d,T.clone().normalize()),b=new c.Ray(m,S.clone().normalize()),h=d.clone().translate(S.clone()),p=m.clone().translate(S.clone()),g=new c.Ray(h,T.clone().normalize()),w=new c.Ray(p,S.clone().normalize())}let _=[h,d,u,p,m,f],C=new r.Wall2DGeometry(_),D=new i.MeshBasicMaterial({color:3552822,side:i.DoubleSide,transparent:!0,opacity:.8});C.translate(0,0,6);let A=new r.Wall2(C,D);0==e&&(A.startP=new i.Vector2(_[1].x,_[1].y),A.endP=new i.Vector2(_[4].x,_[4].y)),1==e&&(A.startP=new i.Vector2(_[0].x,_[0].y),A.endP=new i.Vector2(_[3].x,_[3].y)),2==e&&(A.startP=new i.Vector2(_[2].x,_[2].y),A.endP=new i.Vector2(_[5].x,_[5].y)),A.computeLineEquation(),A.startPoint=new i.Vector3(A.startP.x,A.startP.y,0),A.endPoint=new i.Vector3(A.endP.x,A.endP.y,0);let E=[,,,],L=[,,,],I=1/0,R=1/0,W=1/0,V=1/0,k=1/0,B=1/0;function O(e){let t=g.intersect(e);if(t.length){let i=t[0].distanceTo(h)[0];!(i<I)||(I=i,A.updateVertex(0,t[0]),E[0]&&E[0].equalTo(e)||(E[0]=e))}let i=w.intersect(e);if(i.length){let t=i[0].distanceTo(p)[0];!(t<R)||(R=t,A.updateVertex(3,i[0]),L[0]&&L[0].equalTo(e)||(L[0]=e))}let r=y.intersect(e);if(r.length){let t=r[0].distanceTo(d)[0];!(t<W)||(W=t,A.updateVertex(1,r[0]),E[1]&&E[1].equalTo(e)||(E[1]=e))}let n=b.intersect(e);if(n.length){let t=n[0].distanceTo(m)[0];!(t<V)||(V=t,A.updateVertex(4,n[0]),L[1]&&L[1].equalTo(e)||(L[1]=e))}let o=x.intersect(e);if(o.length){let t=o[0].distanceTo(u)[0];!(t<k)||(k=t,A.updateVertex(2,o[0]),E[2]&&E[2].equalTo(e)||(E[2]=e))}let a=M.intersect(e);if(a.length){let t=a[0].distanceTo(f)[0];!(t<B)||(B=t,A.updateVertex(5,a[0]),L[2]&&L[2].equalTo(e)||(L[2]=e))}}if(t){if(n){let e=n.flattenPolygon.edges.values(),t=e.next();for(;!t.done;)O(t.value.shape),t=e.next();for(let e of n.innerWalls){let t=e.parameter.innerSegment,i=e.parameter.outerSegment;O(t),O(i)}}else P.instances.forEach(e=>{e.baseWalls.forEach(e=>{O(e.parameter.innerSegment),O(e.parameter.outerSegment)}),e.innerWalls.forEach(e=>{O(e.parameter.innerSegment),O(e.parameter.outerSegment)})})}if(!E.includes(void 0)){if(!E[0].equalTo(E[1])){let e=P.getCommonPoint(E[0],E[1]);if(!e){let t=new c.Line(E[0].ps,E[0].pe),i=new c.Line(E[1].ps,E[1].pe);e=t.intersect(i)[0]}A.updateVertex(1,e)}if(!E[1].equalTo(E[2])){let e=P.getCommonPoint(E[1],E[2]);if(!e){let t=new c.Line(E[1].ps,E[1].pe),i=new c.Line(E[2].ps,E[2].pe);e=t.intersect(i)[0]}A.updateVertex(1,e)}}if(!L.includes(void 0)){if(!L[0].equalTo(L[1])){let e=P.getCommonPoint(L[0],L[1]);if(!e){let t=new c.Line(L[0].ps,L[0].pe),i=new c.Line(L[1].ps,L[1].pe);e=t.intersect(i)[0]}A.updateVertex(4,e)}if(!L[1].equalTo(L[2])){let e=P.getCommonPoint(L[1],L[2]);if(!e){let t=new c.Line(L[1].ps,L[1].pe),i=new c.Line(L[2].ps,L[2].pe);e=t.intersect(i)[0]}A.updateVertex(4,e)}}let F=new c.Polygon,z=[];z.push(new c.Segment(A.getPoint(0),A.getPoint(1))),z.push(new c.Segment(A.getPoint(1),A.getPoint(2))),z.push(new c.Segment(A.getPoint(0),A.getPoint(3))),z.push(new c.Segment(A.getPoint(3),A.getPoint(4))),z.push(new c.Segment(A.getPoint(4),A.getPoint(5))),z.push(new c.Segment(A.getPoint(2),A.getPoint(5))),F.addFace(z),A.polygon=F,A.originPointA=s,A.originPointB=l,A.originType=e,A.originMode=t;let U=P.generateWall3DBy2(A);return n&&(n.innerWalls.push(A),n.innerWall3Ds.push(U)),n||(A.useScene="outerRoom",U.useScene="outerRoom"),A.roomMsg=n,[A,U]}deleteWall(e){e.isDeleted=!e.isDeleted,this.updateFloorNew()}boolean(e,t,r="subtract"){"subtract"==r&&(r=o.SUBTRACTION),"union"==r&&(r=o.ADDITION),"intersect"==r&&(r=o.INTERSECTION),e.updateMatrixWorld(!0);let n=new a.Brush(e.geometry,e.material),h=new a.Brush(t.geometry,t.material);n.applyMatrix4(e.matrix),h.applyMatrix4(t.matrix),n.updateMatrixWorld(),h.updateMatrixWorld(),n.geometry.computeBoundsTree({maxLeafTris:5,strategy:parseFloat(l.CENTER)}),n.geometry.boundsTree.splitStrategy=l.CENTER,h.geometry.computeBoundsTree({maxLeafTris:5,strategy:parseFloat(l.CENTER)}),h.geometry.boundsTree.splitStrategy=l.CENTER;let c=new s.Evaluator;if(c.attributes=["position","normal"],c.debug.enabled=!0,c.useGroups=!0,r==o.ADDITION||r==o.INTERSECTION)return c.evaluate(n,h,r);if(r==o.SUBTRACTION){let e=new i.Mesh(new i.BufferGeometry,new i.MeshStandardMaterial({color:16711680,flatShading:!1,polygonOffset:!0,polygonOffsetUnits:.1,polygonOffsetFactor:.1}));return e.castShadow=!0,e.receiveShadow=!0,c.evaluate(n,h,r,e),e}}updatePolygon(e){let t=this.polygon[0],i=[new c.Point(t[0][0],t[0][1])],r=[new c.Point(e[0][0],e[0][1])],n=[],o=[];for(let e=1;e<t.length;e++){let r=new c.Point(t[e][0],t[e][1]);i.push(r),n.push(new c.Segment(i[e-1],r))}for(let t=1;t<e.length;t++){let i=new c.Point(e[t][0],e[t][1]);r.push(i),o.push(new c.Segment(r[t-1],i))}let a=[],s=[];for(let e of(n.forEach((e,t)=>{for(let t of o){if(this.sameSeg(e,t)){a.push([e,t]);break}if(this.includeSeg(e,t)){s.push([e,t]);break}}}),[...a,...s].forEach(e=>{n.splice(n.indexOf(e[0]),1),o.splice(o.indexOf(e[1]),1)}),n.forEach(e=>{this.removeWallBySegment(e)}),o)){let t=this.generateWall(e.ps,e.pe,!0),i=Array.from(this.baseWalls);t.getRightWall(i),t.handle(),this.baseWalls.push(t),this.baseWalls[0].parent.add(t)}for(let e of s){let t=e[0],i=e[1],r=this.findWallBySegment(t),n=this.getSegSamePoint(i,t),o=n.equalTo(i.ps)?i.pe:i.ps,a=r.getIndex(n);r.updateVertex(2==a?5:2,o),this.updateWallByOuterPoints(r)}return this.updateThisPolygon(),this.updateFloorNew(),this.floor}sameSeg(e,t){return!!(e.contains(t.ps)&&e.contains(t.pe)&&t.contains(e.ps)&&t.contains(e.pe))}includeSeg(e,t){return!!(e.contains(t.ps)&&e.contains(t.pe))}removeWallBySegment(e){let t=this.findWallBySegment(e);t.parent.remove(t),this.baseWalls.splice(this.baseWalls.indexOf(t),1),this.removeWall3DBy2(t)}findWallBySegment(e){let t;for(let i of this.baseWalls)if(0==i.line&&(t=i.parameter.middleSegment),1==i.line&&(t=i.parameter.outerSegment),2==i.line&&(t=i.parameter.innerSegment),this.sameSeg(e,t))return i}getSegSamePoint(e,t){return e.contains(t.ps)?t.ps:!!e.contains(t.pe)&&t.pe}addWallBySegment(e){}updateFlatten(){let e=this.polygon[0],t=new c.Polygon;this.vertices=[],this.points=[];for(let t=0;t<e.length;t++)this.vertices.push(new(0,i.Vector2)().fromArray(e[t])),this.points.push(new c.Point(e[t][0],e[t][1]));let r=[];for(let e=0;e<this.points.length-1;e++){let t=e==this.points.length-2?0:e+1;r.push(new c.Segment(this.points[e],this.points[t]))}t.addFace(r),this.flattenPolygon=t}updatePolygonBack(e){this.polygon=[e];let t=!1,i=this.floor;this.baseWalls&&(this.floor.parent&&(t=!0),this.floor.parent.remove(this.floor),editor.wallGroup.remove(...this.baseWalls)),this.baseWalls=[];for(let t=1;t<e.length;t++)this.generateWall(new c.Point(e[t][0],e[t][1]),new c.Point(e[t-1][0],e[t-1][1]));return this.handleWall(),this.updateFlatten(),this.generateFloor(),this.generateCPoly(),this.generateWall3D(),this.floor.allWalls=this.baseWalls,this.floor.room=this,i&&i.allPoints&&(this.floor.allPoints=i.allPoints),t&&(editor.wallGroup.add(...this.baseWalls),editor.floorGroup2d.add(this.floor),editor.moveRoomArr&&(editor.moveRoomArr=[this.floor].concat(this.baseWalls.slice(0)))),this.floor}updateFloor(e,...t){let r=[];if(e)r=this.updateInnerPolygon(!1);else{let e=this.floor.geometry.attributes.position;if(1==t.length){let n=t[0];for(let t=0;t<e.count;t++)e.setXY(t,e.getX(t)+n.x,e.getY(t)+n.y),r.push(new i.Vector2(e.getX(t),e.getY(t)))}if(2==t.length){let n=t[0],o=t[1];if(!o)return;for(let t=0;t<e.count;t++)new c.Point(e.getX(t),e.getY(t)).equalTo(n)&&e.setXY(t,o.x,o.y),r.push(new i.Vector2(e.getX(t),e.getY(t)))}r.push(r[0])}let n=new i.Shape;n.moveTo(r[0].x,r[0].y);for(let e=1;e<r.length;e++)n.lineTo(r[e].x,r[e].y);this.floor.geometry=new i.ShapeGeometry(n),this.floor.geometry.translate(0,0,5)}updateInnerPolygon(e=!0){let t=Array.from(this.baseWalls),i=[],r=t.shift();if(this.getFloorPoints(r,i),this.getInnerPolyArr(t,i),!e)return i;let n=new c.Polygon;i.shift(),n.addFace(i),this.innerPolygon=n,this.area=n.area()/1e6,this.floor.area=this.area.toFixed(2),this.updateAllRoomPoints()}getAnotherWallByCommonPoint(e,t){let i=this.getWallsByPoint(t);if(2==i.length)return i.splice(i.indexOf(e),1),i[0];console.log("not find enough wall - ",i)}getAnotherWall(e,t){let i=this.getWallsByPoint(e);return i.splice(i.indexOf(t),1),1==i.length&&i[0]}generateInnerWall(){}updateFloor3D(){this.floor3D.geometry.dispose(),this.floor3D.geometry=this.floor.geometry.clone()}getFloorPoints(e,t){let i=e.parameter.outerSegment;if(e.isDeleted){let r=i.ps.projectionOn(e.parameter.innerLine),n=i.pe.projectionOn(e.parameter.innerLine);t.push(i.ps,r,n,i.pe)}else t.push(i.ps,i.pe)}getInnerPolyArr(e,t){if(e.length){let i=t[t.length-1],r=!1;e.forEach((n,o)=>{let a=n.parameter.outerSegment;if(a.ps.equalTo(i)){if(n.isDeleted){if(this.deletedWallPillar){let e=a.ps.projectionOn(n.parameter.innerLine),i=a.pe.projectionOn(n.parameter.innerLine);t.push(e,i,a.pe)}}else t.push(a.pe);e.splice(o,1),r=!0;return}if(a.pe.equalTo(i)){if(n.isDeleted){if(this.deletedWallPillar){let e=a.ps.projectionOn(n.parameter.innerLine),i=a.pe.projectionOn(n.parameter.innerLine);t.push(i,e,a.ps)}else 1==e.length?wallList[0]:wallList[wallList.length-2]}else t.push(a.ps);e.splice(o,1),r=!0;return}}),r&&e.length?this.getInnerPolyArr(e,t):0!=e.length&&console.log("maybe some point can not find equal point.")}}generateFloor(){let e,t=new i.Shape,r=this.updateInnerPolygon(!1);t.moveTo(r[0].x,r[0].y);for(let e=1;e<r.length;e++)t.lineTo(r[e].x,r[e].y);let n=new c.Polygon;r.shift(),n.addFace(r);let o=new i.ExtrudeGeometry(t,M);this.booleanMesh=new i.Mesh(o,new i.MeshStandardMaterial({color:16777215})),this.booleanMesh.layers.set(1),this.floor3D&&(e=this.floor3D.parent)&&e.remove(this.floor3D);let a=new i.ShapeGeometry(t);this.floor3D=new i.Mesh(a,new i.MeshStandardMaterial({color:14275757,side:i.DoubleSide})),this.floor3D.useType="3dfloor",this.floor3D.layers.set(1),e&&e.add(this.floor3D);let s=a.clone().translate(0,0,5);this.floor=new i.Mesh(s,new i.MeshBasicMaterial({color:14275757,side:i.DoubleSide}));let l=r.slice(0);l.reverse(),this.floor.allRoomPoints=[],this.floor.useType="floor",l.forEach(e=>{let t=(0,u.UtilCore).toVector3(e);this.floor.allRoomPoints.push(t)}),this.innerPolygon=n,this.area=n.area()/1e6,this.floor.area=this.area.toFixed(2)}generateCPoly(){let e=[],t=this.polygon[0],r=new(0,i.Vector2)().fromArray(t[0]);for(let n=1;n<t.length;n++){let o=new(0,i.Vector2)().fromArray(t[n]),a=r.clone().sub(o);a=new(0,i.Vector2)(-a.y,a.x).setLength(b);let s=r.clone().add(a),l=o.clone().add(a);e.push(new c.Line(new c.Point(s.x,s.y),new c.Point(l.x,l.y))),r=o}e.unshift(e[e.length-1]);let n=[];for(let t=1;t<e.length;t++)if(!e[t-1].parallelTo(e[t])){let i=e[t-1].intersect(e[t])[0];n.push(i)}let o=[];for(let e=0;e<n.length;e++){let t=e==n.length-1?0:e+1;o.push(new c.Segment(n[e],n[t]))}this.cPoly=new c.Polygon,this.cPoly.addFace(o)}equalPolygon(e){if(this.polygon.length!=e.length)return!1;for(let t=0;t<e.length;t++)if(e[t]instanceof Array){let i=Array.from(e[t]);if(this.polygon[t].length!=i.length)return!1;for(let e=0;e<this.polygon[t].length;e++)if(!this.isInclude(this.polygon[t][e],i))return!1}return!0}isInclude(e,t){for(let i=0;i<t.length;i++)if(e[0]==t[i][0]&&e[1]==t[i][1])return!0;return!1}getRandom(e,t){return Math.floor(Math.random()*(t-e+1))+e}}P.instances=[]}),parcelRequire.register("8DRdc",function(e,t){$parcel$export(e.exports,"Wall2DGeometry",()=>o),$parcel$export(e.exports,"Wall2",()=>a);var i=parcelRequire("4xklQ"),r=parcelRequire("3XJrN"),n=parcelRequire("gDTsF");class o extends i.BufferGeometry{constructor(...e){super(),this.type="Wall2DGeometry";let t=this,r=[],o=[];if(e[0]instanceof Array){let t=e[0];for(let e of t)o.push(...e.toArray(),0);s(t.length/3)}else if(e[0]instanceof Object){let t=e[0];this.startP=new i.Vector2(t.start.x,t.start.y),this.endP=new i.Vector2(t.end.x,t.end.y),this.line=new n.Line(new n.Point(t.start.x,t.start.y),new n.Point(t.end.x,t.end.y)),this.style=t.line,this._start=new i.Vector2,this._end=new i.Vector2,this._normal=new i.Vector2,a(t)}function a(e){t._start.set(e.start.x,e.start.y),t._end.set(e.end.x,e.end.y);let r=[];if(e.isArc){let n=new i.Vector2(e.cp.x,e.cp.y),o=CommonFunc.getCircleCenter(n,t._start,t._end),a=o.distanceTo(t._start),s=t._start.clone().sub(o).angle(),l=t._end.clone().sub(o).angle();t.beginAngle=s,t.endAngle=l;let h=Math.round(Math.PI/Math.asin(e.thickness/2/(a+e.thickness/2))/2);if(h=h>100?100:h,"circle"==e.isArc){let i=new Path;i.arc(o.x,o.y,a,s,l,t.clockWise);let n=i.getPoints(h),c=new Path;c.arc(o.x,o.y,a-e.thickness/2,s,l,t.clockWise);let d=c.getPoints(h),u=new Path;u.arc(o.x,o.y,a+e.thickness/2,s,l,t.clockWise);let p=u.getPoints(h);for(let e in n)t.clockWise?r.push(p[e],n[e],d[e]):r.push(d[e],n[e],p[e])}e.isArc}else{switch(t._normal.set(t.line.norm.x,t.line.norm.y).setLength(e.thickness/2),e.line){case 0:r.push(t._start.clone().add(t._normal)),r.push(t._start.clone()),r.push(t._start.clone().add(t._normal.clone().negate())),r.push(t._end.clone().add(t._normal)),r.push(t._end.clone()),r.push(t._end.clone().add(t._normal.clone().negate()));break;case 1:r[2]=t._start.clone(),r[1]=t._start.clone().add(t._normal),r[0]=r[1].clone().add(t._normal),r[5]=t._end.clone(),r[4]=t._end.clone().add(t._normal),r[3]=r[4].clone().add(t._normal);break;case 2:let i=t._normal.clone().negate();r.push(t._start.clone()),r.push(t._start.clone().add(i)),r.push(r[1].clone().add(i)),r.push(t._end.clone()),r.push(t._end.clone().add(i)),r.push(r[4].clone().add(i))}r.forEach(e=>{o.push(...e.toArray(),0)}),s(r.length/3)}}function s(e){for(let t=0;t<2;t++)for(let i=0;i<e-1;i++){let e=3*i+t,n=3*i+t+1,o=3*i+t+3,a=3*i+t+4;r.push(e,n,a),r.push(o,e,a)}}this.setIndex(r),this.setAttribute("position",new i.Float32BufferAttribute(o,3))}}class a extends i.Mesh{constructor(e,t){super(e,t),this.type="Wall2",this.useType="wall",this.parameter={clockWiseST:2*Math.PI,clockWiseSF:2*Math.PI,clockWiseET:2*Math.PI,clockWiseEF:2*Math.PI}}resetClockwiseAngle(){this.parameter.clockWiseST=2*Math.PI,this.parameter.clockWiseSF=2*Math.PI,this.parameter.clockWiseET=2*Math.PI,this.parameter.clockWiseEF=2*Math.PI}computeLineEquation(){this.parameter.vertices=[this.getPoint(0),this.getPoint(1),this.getPoint(2),this.getPoint(3),this.getPoint(4),this.getPoint(5)],this.parameter.innerLine=new r.Edge(this.getVertex(0),this.getVertex(3)),this.parameter.middleLine=new r.Edge(this.getVertex(1),this.getVertex(4)),this.parameter.outerLine=new r.Edge(this.getVertex(2),this.getVertex(5)),this.geometry.attributes.position,this.parameter.innerLine=new n.Line(this.getPoint(0),this.getPoint(3)),this.parameter.innerSegment=new n.Segment(this.getPoint(0),this.getPoint(3)),this.parameter.middleLine=new n.Line(this.getPoint(1),this.getPoint(4)),this.parameter.middleSegment=new n.Segment(this.getPoint(1),this.getPoint(4)),this.parameter.outerLine=new n.Line(this.getPoint(2),this.getPoint(5)),this.parameter.outerSegment=new n.Segment(this.getPoint(2),this.getPoint(5))}getVertex(e){return new i.Vector2(this.geometry.attributes.position.getX(e),this.geometry.attributes.position.getY(e))}getPoint(e){return new n.Point(this.geometry.attributes.position.getX(e),this.geometry.attributes.position.getY(e))}getRightWall(e){if(this.parameter.clockWiseST=2*Math.PI,this.parameter.clockWiseSF=2*Math.PI,this.parameter.clockWiseET=2*Math.PI,this.parameter.clockWiseEF=2*Math.PI,e.forEach(e=>{let t=this.getSameVertex(e);t&&this.getPosition(e,this.getIndex(t),e.getIndex(t))}),this.parameter.clockWiseSTW){let e=this.parameter.clockWiseSTW;this.parameter.clockWiseSTP.split("").map(e=>parseInt(e))[1]<3?(e.parameter.clockWiseSF=this.parameter.clockWiseST,e.parameter.clockWiseSFW=this,e.parameter.clockWiseSFP=this.parameter.clockWiseSTP.split("").reverse().join("")):(e.parameter.clockWiseEF=this.parameter.clockWiseST,e.parameter.clockWiseEFW=this,e.parameter.clockWiseEFP=this.parameter.clockWiseSTP.split("").reverse().join(""))}if(this.parameter.clockWiseSFW){let e=this.parameter.clockWiseSFW;this.parameter.clockWiseSFP.split("").map(e=>parseInt(e))[1]<3?(e.parameter.clockWiseST=this.parameter.clockWiseSF,e.parameter.clockWiseSTW=this,e.parameter.clockWiseSTP=this.parameter.clockWiseSFP.split("").reverse().join("")):(e.parameter.clockWiseET=this.parameter.clockWiseSF,e.parameter.clockWiseETW=this,e.parameter.clockWiseETP=this.parameter.clockWiseSFP.split("").reverse().join(""))}if(this.parameter.clockWiseETW){let e=this.parameter.clockWiseETW;this.parameter.clockWiseETP.split("").map(e=>parseInt(e))[1]<3?(e.parameter.clockWiseSF=this.parameter.clockWiseET,e.parameter.clockWiseSFW=this,e.parameter.clockWiseSFP=this.parameter.clockWiseETP.split("").reverse().join("")):(e.parameter.clockWiseEF=this.parameter.clockWiseET,e.parameter.clockWiseEFW=this,e.parameter.clockWiseEFP=this.parameter.clockWiseETP.split("").reverse().join(""))}if(this.parameter.clockWiseEFW){let e=this.parameter.clockWiseEFW;this.parameter.clockWiseEFP.split("").map(e=>parseInt(e))[1]<3?(e.parameter.clockWiseST=this.parameter.clockWiseEF,e.parameter.clockWiseSTW=this,e.parameter.clockWiseSTP=this.parameter.clockWiseEFP.split("").reverse().join("")):(e.parameter.clockWiseET=this.parameter.clockWiseEF,e.parameter.clockWiseETW=this,e.parameter.clockWiseETP=this.parameter.clockWiseEFP.split("").reverse().join(""))}}getPosition(e,t,r){let n=new i.Vector2,o=new i.Vector2;if(t<3){n.subVectors(this.end,this.start),r<3?o.subVectors(e.end,e.start):o.subVectors(e.start,e.end);let i=this.getIncludeAngle(n,o),a=2*Math.PI-i;i<this.parameter.clockWiseST&&(this.parameter.clockWiseST=i,this.parameter.clockWiseSTW=e,this.parameter.clockWiseSTP=[t,r].join("")),a<this.parameter.clockWiseSF&&(this.parameter.clockWiseSF=a,this.parameter.clockWiseSFW=e,this.parameter.clockWiseSFP=[t,r].join(""))}else{n.subVectors(this.start,this.end),r<3?o.subVectors(e.end,e.start):o.subVectors(e.start,e.end);let i=this.getIncludeAngle(n,o),a=2*Math.PI-i;i<this.parameter.clockWiseET&&(this.parameter.clockWiseET=i,this.parameter.clockWiseETW=e,this.parameter.clockWiseETP=[t,r].join("")),a<this.parameter.clockWiseEF&&(this.parameter.clockWiseEF=a,this.parameter.clockWiseEFW=e,this.parameter.clockWiseEFP=[t,r].join(""))}}getSameVertex(e){for(let t in this.parameter.vertices)for(let i in e.parameter.vertices)if(this.parameter.vertices[t].equalTo(e.parameter.vertices[i]))return this.parameter.vertices[t]}getIndex(e){for(let t in this.parameter.vertices)if(this.parameter.vertices[t].equalTo(e))return t}getIncludeAngle(e,t){let i=Math.atan2(e.y,e.x)-Math.atan2(t.y,t.x);return i<0&&(i=2*Math.PI+i),i}handle(){this.parameter.clockWiseSTW&&this.dispatch(this.parameter.clockWiseSTW,this.parameter.clockWiseSTP,!0),this.parameter.clockWiseSFW&&this.dispatch(this.parameter.clockWiseSFW,this.parameter.clockWiseSFP,!1),this.parameter.clockWiseETW&&this.dispatch(this.parameter.clockWiseETW,this.parameter.clockWiseETP,!0),this.parameter.clockWiseEFW&&this.dispatch(this.parameter.clockWiseEFW,this.parameter.clockWiseEFP,!1)}dispatch(e,t,i){let r;switch(t){case"00":case"01":case"02":case"10":case"11":case"12":case"20":case"21":case"22":case"33":case"34":case"35":case"43":case"44":case"45":case"53":case"54":break;case"03":i&&(this.parameter.middleLine.parallelTo(e.parameter.middleLine)||(r=this.parameter.middleLine.intersect(e.parameter.middleLine),this.updateIntersect(1,r[0],e,4)),this.parameter.outerLine.parallelTo(e.parameter.outerLine)||(r=this.parameter.outerLine.intersect(e.parameter.outerLine),this.updateIntersect(2,r[0],e,5)));break;case"04":i?this.parameter.middleLine.parallelTo(e.parameter.middleLine)||(r=this.parameter.middleLine.intersect(e.parameter.middleLine),this.updateIntersect(1,r[0],e,4),r=this.parameter.outerLine.intersect(e.parameter.outerLine),this.updateIntersect(2,r[0],e,5)):this.parameter.innerLine.parallelTo(e.parameter.innerLine)||(r=this.parameter.innerLine.intersect(e.parameter.innerLine),this.updateIntersect(0,r[0],e,3));break;case"05":i&&!this.parameter.innerLine.parallelTo(e.parameter.innerLine)&&(r=this.parameter.innerLine.intersect(e.parameter.innerLine),this.updateIntersect(0,r[0],e,3),r=this.parameter.middleLine.intersect(e.parameter.middleLine),this.updateIntersect(1,r[0],e,4),r=this.parameter.outerLine.intersect(e.parameter.outerLine),this.updateIntersect(2,r[0],e,5));break;case"13":i?this.parameter.outerLine.parallelTo(e.parameter.outerLine)||(r=this.parameter.outerLine.intersect(e.parameter.outerLine),this.updateIntersect(2,r[0],e,5),r=this.parameter.middleLine.intersect(e.parameter.middleLine),this.updateIntersect(1,r[0],e,4)):this.parameter.innerLine.parallelTo(e.parameter.innerLine)||(r=this.parameter.innerLine.intersect(e.parameter.innerLine),this.updateIntersect(0,r[0],e,3));break;case"14":i?this.parameter.outerLine.parallelTo(e.parameter.outerLine)||(r=this.parameter.outerLine.intersect(e.parameter.outerLine),this.updateIntersect(2,r[0],e,5)):this.parameter.innerLine.parallelTo(e.parameter.innerLine)||(r=this.parameter.innerLine.intersect(e.parameter.innerLine),this.updateIntersect(0,r[0],e,3));break;case"15":case"24":i?this.parameter.outerLine.parallelTo(e.parameter.outerLine)||(r=this.parameter.outerLine.intersect(e.parameter.outerLine),this.updateIntersect(2,r[0],e,5)):this.parameter.innerLine.parallelTo(e.parameter.innerLine)||(r=this.parameter.innerLine.intersect(e.parameter.innerLine),this.updateIntersect(0,r[0],e,3),r=this.parameter.middleLine.intersect(e.parameter.middleLine),this.updateIntersect(1,r[0],e,4));break;case"23":i||this.parameter.innerLine.parallelTo(e.parameter.innerLine)||(r=this.parameter.innerLine.intersect(e.parameter.innerLine),this.updateIntersect(0,r[0],e,3),r=this.parameter.middleLine.intersect(e.parameter.middleLine),this.updateIntersect(1,r[0],e,4),r=this.parameter.outerLine.intersect(e.parameter.outerLine),this.updateIntersect(2,r[0],e,5));break;case"25":if(!i){if(this.parameter.middleLine.parallelTo(e.parameter.middleLine)){let t=this.getPoint(2),i=t.projectionOn(this.parameter.middleLine);this.updateIntersect(1,i,e,4);let r=t.projectionOn(this.parameter.innerLine);this.updateIntersect(0,r,e,3)}else r=this.parameter.middleLine.intersect(e.parameter.middleLine),this.updateIntersect(1,r[0],e,4),r=this.parameter.innerLine.intersect(e.parameter.innerLine),this.updateIntersect(0,r[0],e,3)}break;case"30":i||(this.parameter.middleLine.parallelTo(e.parameter.middleLine)||(r=this.parameter.middleLine.intersect(e.parameter.middleLine),this.updateIntersect(4,r[0],e,1)),this.parameter.outerLine.parallelTo(e.parameter.outerLine)||(r=this.parameter.outerLine.intersect(e.parameter.outerLine),this.updateIntersect(5,r[0],e,2)));break;case"31":i?this.parameter.innerLine.parallelTo(e.parameter.innerLine)||(r=this.parameter.innerLine.intersect(e.parameter.innerLine),this.updateIntersect(3,r[0],e,0)):this.parameter.outerLine.parallelTo(e.parameter.outerLine)||(r=this.parameter.outerLine.intersect(e.parameter.outerLine),this.updateIntersect(5,r[0],e,2),r=this.parameter.middleLine.intersect(e.parameter.middleLine),this.updateIntersect(4,r[0],e,1));break;case"32":i||this.parameter.outerLine.parallelTo(e.parameter.outerLine)||(r=this.parameter.outerLine.intersect(e.parameter.outerLine),this.updateIntersect(5,r[0],e,2),r=this.parameter.middleLine.intersect(e.parameter.middleLine),this.updateIntersect(4,r[0],e,1),r=this.parameter.innerLine.intersect(e.parameter.innerLine),this.updateIntersect(3,r[0],e,0));break;case"40":i?this.parameter.innerLine.parallelTo(e.parameter.innerLine)||(r=this.parameter.innerLine.intersect(e.parameter.innerLine),this.updateIntersect(3,r[0],e,0)):this.parameter.outerLine.parallelTo(e.parameter.outerLine)||(r=this.parameter.middleLine.intersect(e.parameter.middleLine),this.updateIntersect(4,r[0],e,1),r=this.parameter.outerLine.intersect(e.parameter.outerLine),this.updateIntersect(5,r[0],e,2));break;case"41":i?this.parameter.innerLine.parallelTo(e.parameter.innerLine)||(r=this.parameter.innerLine.intersect(e.parameter.innerLine),this.updateIntersect(3,r[0],e,0)):this.parameter.outerLine.parallelTo(e.parameter.outerLine)||(r=this.parameter.outerLine.intersect(e.parameter.outerLine),this.updateIntersect(5,r[0],e,2));break;case"42":case"51":i?this.parameter.innerLine.parallelTo(e.parameter.innerLine)||(r=this.parameter.innerLine.intersect(e.parameter.innerLine),this.updateIntersect(3,r[0],e,0),r=this.parameter.middleLine.intersect(e.parameter.middleLine),this.updateIntersect(4,r[0],e,1)):this.parameter.outerLine.parallelTo(e.parameter.outerLine)||(r=this.parameter.outerLine.intersect(e.parameter.outerLine),this.updateIntersect(5,r[0],e,2));break;case"50":i&&!this.parameter.innerLine.parallelTo(e.parameter.innerLine)&&(r=this.parameter.innerLine.intersect(e.parameter.innerLine),this.updateIntersect(3,r[0],e,0),r=this.parameter.middleLine.intersect(e.parameter.middleLine),this.updateIntersect(4,r[0],e,1),r=this.parameter.outerLine.intersect(e.parameter.outerLine),this.updateIntersect(5,r[0],e,2));break;case"52":if(i){if(this.parameter.middleLine.parallelTo(e.parameter.middleLine)){let t=this.getPoint(5),i=t.projectionOn(this.parameter.middleLine);this.updateIntersect(4,i,e,1);let r=t.projectionOn(this.parameter.innerLine);this.updateIntersect(3,r,e,0)}else r=this.parameter.middleLine.intersect(e.parameter.middleLine),this.updateIntersect(4,r[0],e,1),r=this.parameter.innerLine.intersect(e.parameter.innerLine),this.updateIntersect(3,r[0],e,0)}}}updateIntersect(e,t,i,r){this.updateVertex(e,t),i&&i.updateVertex(r,t)}updateVertex(e,t){let r=this.geometry.attributes.position;r.setXY(e,t.x,t.y);let o=new n.Point(r.getX(e),r.getY(e));return this.parameter.vertices[e]=o,0==this.line&&(1==e&&(this.start=new i.Vector2(o.x,o.y)),4==e&&(this.end=new i.Vector2(o.x,o.y))),1==this.line&&(2==e&&(this.start=new i.Vector2(o.x,o.y)),5==e&&(this.end=new i.Vector2(o.x,o.y))),2==this.line&&(0==e&&(this.start=new i.Vector2(o.x,o.y)),3==e&&(this.end=new i.Vector2(o.x,o.y))),0==e&&(this.parameter.innerSegment=new n.Segment(o,this.parameter.innerSegment.pe)),1==e&&(this.parameter.middleSegment=new n.Segment(o,this.parameter.middleSegment.pe)),2==e&&(this.parameter.outerSegment=new n.Segment(o,this.parameter.outerSegment.pe)),3==e&&(this.parameter.innerSegment=new n.Segment(this.parameter.innerSegment.ps,o)),4==e&&(this.parameter.middleSegment=new n.Segment(this.parameter.middleSegment.ps,o)),5==e&&(this.parameter.outerSegment=new n.Segment(this.parameter.outerSegment.ps,o)),this.geometry.attributes.position.needsUpdate=!0,this.updateBounding(),this.getVertex(e)}updateBounding(){this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere(),this.geometry.computeVertexNormals()}updateLines(e="all"){("all"==e||"inner"==e)&&(this.parameter.innerLine=new n.Line(this.getPoint(0),this.getPoint(3))),("all"==e||"middle"==e)&&(this.parameter.middleLine=new n.Line(this.getPoint(1),this.getPoint(4))),("all"==e||"outer"==e)&&(this.parameter.outerLine=new n.Line(this.getPoint(2),this.getPoint(5)))}updateTerminal(e,t){console.log("position - ",t,"need update terminal")}setPolygon(){}}}),parcelRequire.register("3XJrN",function(e,t){$parcel$export(e.exports,"Edge",()=>r);var i=parcelRequire("4xklQ");class r{constructor(e=new i.Vector2,t=new i.Vector2){this.start=e,this.end=t,this.hasEquation=!1,this.getEquation()}getEquation(){this.start.equals(this.end)||(this.hasEquation=!0,this.slope=(this.start.y-this.end.y)/(this.start.x-this.end.x),Math.abs(this.slope)==1/0?this.constant=this.keepDecimalRound(this.start.x,3):this.constant=this.keepDecimalRound(this.start.y-this.slope*this.start.x,3))}getRelation(e){if(this.hasEquation&&e.hasEquation)return(Math.abs(this.slope)==1/0&&(this.slope=1/0),Math.abs(e.slope)==1/0&&(e.slope=1/0),this.slope!=e.slope)?2:this.constant==e.constant?1:0}isIntersectWith(e){return 2==this.getRelation(e)}getIntersect(e){let t=new i.Vector2;return 0==this.slope?(t.y=this.constant,Math.abs(e.slope)==1/0?t.x=e.constant:t.x=(t.y-e.constant)/e.slope):Math.abs(this.slope)==1/0?(t.x=this.constant,0==e.slope?t.y=e.constant:t.y=e.slope*t.x+e.constant):0==e.slope?(t.y=e.constant,t.x=(t.y-this.constant)/this.slope):(Math.abs(e.slope)==1/0?t.x=e.constant:t.x=(e.constant-this.constant)/(this.slope-e.slope),t.y=this.slope*t.x+this.constant),t}keepDecimalRound(e,t){return Math.round(e*10**t)/10**t}}}),parcelRequire.register("7RZ5r",function(e,t){$parcel$export(e.exports,"Wall3",()=>r);var i=parcelRequire("4xklQ");class r extends i.Mesh{constructor(e,t){super(e,t),this.type="Wall3",this.useType="3dwall"}}}),parcelRequire.register("dyDlE",function(e,t){$parcel$export(e.exports,"rjh_SignalCore",()=>A),$parcel$export(e.exports,"rjh_MobileSignalCore",()=>E);var i=parcelRequire("4xklQ"),r=parcelRequire("djG6J"),n=parcelRequire("5tVpy"),o=parcelRequire("bX52j"),a=parcelRequire("2dMww"),s=parcelRequire("73HrS"),l=parcelRequire("5XTH3"),h=parcelRequire("eA4zA"),c=parcelRequire("9HO6e"),d=parcelRequire("hWloQ"),u=parcelRequire("6RSze"),p=parcelRequire("3BPdS"),m=parcelRequire("hmviW"),f=parcelRequire("hu0fb"),g=parcelRequire("0SNMV"),y=parcelRequire("6TG3N"),x=parcelRequire("5c6ha"),w=parcelRequire("cEaqU"),b=parcelRequire("aTa1F"),v=parcelRequire("eTMFK"),M=parcelRequire("47Y2g");parcelRequire("dVRrd");var S=parcelRequire("gMHcS"),P=new i.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.01,1e3);P.name="3dCamera",P.sceneModel="3D",P.position.set(-5,10,10),P.lookAt(new i.Vector3(0,0,0)),P.layers.set(1),P.layers.enable(2);var T=new i.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.01,1e3);T.name="3dRomaCamera",T.sceneModel="3D",T.position.set(0,0,0),T.lookAt(new i.Vector3(0,0,-1.65)),T.layers.set(1),T.layers.enable(2);var _=new i.OrthographicCamera(-1e4,1e4,5e3,-5e3,0,1e3);_.name="2dCamera",_.sceneModel="2D",_.position.set(0,0,1e3),_.lookAt(new i.Vector3(0,0,0));let C=window.innerWidth/window.innerHeight,D=-5e3;_.left=D*C,_.right=-D*C,_.top=-D,_.bottom=D;class A{constructor(e){e.dataVersion="0.0.1",e.cacheJson="",e.currentCacheJson="",e.config=new o.Config,e.progress=1,e.PolyK=PolyK,e.centerArea=e.config.centerArea,e.adsorbentModel=!0,e.orthogonalModel=!1,e.innerDraw=1,e.touchStart="",e.sceneActive=!1,e.copyFloorMaterial="",e.specialPointArr=[],e._DEFAULT_CAMERA=P.clone(),e._DEFAULT_CAMERA1=_.clone(),e.camera=_.clone(),e.miniMapCamera=P.clone(),e.wallDep=240,e.roomWallDep=240,e.scene=new i.Scene,e.cameraScene=new i.Scene,e.scene.name="Scene",e.floor="",e.themeColor="",e.gridProportion="",e.raycaster=new i.Raycaster,e.startPoint="",e.endPoint="",e.currentPoint="",e.currenDraw="",e.mouse=new i.Vector3(0,0,0),e.helperGroup=new i.Group,e.helperGroup.name="helperGroup",e.doorHelperGroup=new i.Group,e.doorHelperGroup.name="doorHelperGroup",e.circlePoint="",e.pointHelperGroup=new i.Group,e.pointHelperGroup.name="pointHelper",e.pointHelpGroup=new i.Group,e.pointHelpGroup.name="pointHelp",e.uiPanelBox=new p.UIPanel,e.uiPanelBox.setWidth(window.innerWidth+"px"),e.uiPanelBox.setHeight(window.innerHeight+"px"),e.statusJson=[],e.allWalls=[],e.otherMeshs=[],e.doorGroup=new i.Group,e.doorGroup.name="2dDoor",e.otherMember=[],e.wallGroup=new i.Group,e.wallGroup.name="2dwall",e.wallGroup3D=new i.Group,e.wallGroup3D.name="3dwall",e.memberGroup3D=new i.Group,e.memberGroup3D.name="3dMember",e.model3D=new i.Group,e.model3D.name="3dModel",e.model2D=new i.Group,e.model2D.position.z=.1,e.model2D.name="2dModel",e.modelHelperGroup=new i.Group,e.modelHelperGroup.name="3dModelSelectHelper",e.clickDepthMsg={},e.modelDotGroup=new i.Group,e.modelDotGroup.name="3dModelDotHelper",e.floorGroup=new i.Group,e.floorGroup.rotation.x=-Math.PI/2,e.floorGroup.name="floorGroup",e.doorHoleArr=[],e.wallGroup3D.rotation.x=-Math.PI/2,e.memberGroup3D.rotation.x=-Math.PI/2,e.cameras={},e.cameras[e.camera.uuid]=e.camera,e.cameras[P.uuid]=P,e.cameras[T.uuid]=T,e.lastCamera="3dCamera",e.toolType="free",e.chooseColor=new i.Color("#4169BB"),e.cancelChooseColor=new i.Color("rgb(144, 146, 146)"),e.cancelChooseShortColor=new i.Color("rgb(255, 255, 255)"),e.cancelChooseHeavyColor=new i.Color("rgb(0, 0, 0)"),e.boxLineMaterial=new i.LineBasicMaterial({color:"#000000",transparent:!0,opacity:.4,depthWrite:!1,side:i.DoubleSide}),e.selectObjArr=[],e.miniMapObj="",e.clickColor=new i.Color("#3A5FFF"),e.moveDoorColor=new i.Color("#00FFFF"),e.moveDoorOutColor=new i.Color("#000000"),e.downPoint="",e.currentDownSelect="",e.currentMoveSelect="",e.mouseCoverObj="",e.startChooseWall="",e.clickSelect=[],e.currentDoor="",e.moveStartPosition=new i.Vector3(0,0,0),e.allLinkWallByStartPoint=[],e.samePointWall=[],e.samePointByDrag="",e.menuSwitch=!1,e.viewportCamera=e.camera,e.globalControl="",e._scaleStart=new i.Vector3(1,1,1),e._offsetStart="",e.doorDistance="",e.miniControls2d="",e.miniControls3d="",e.floorGroup2d=new i.Group,e.floorGroup2d.name="floorGroup2d",e.lineGroup3D=new i.Group,e.lineGroup3D.name="3dBoxLine",e.lineGroup3D.rotation.x=-Math.PI/2,e.lineGroup3D.visible=!1,e.cameraRenderer=new i.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}),e.cameraRenderer.shadowMap.enabled=!0,e.cameraRenderer.setPixelRatio(window.devicePixelRatio),e.cameraRenderer.xr.enabled=!0,e.cameraRenderer.outputEncoding=i.sRGBEncoding,e.cameraRenderer.setSize(window.innerWidth,window.innerHeight),e.cameraRenderer.setClearColor(16777215,0),e.pngCamera=_.clone(),e.openRenderScene=!1,e.newRenderer=new i.WebGLRenderer({antialias:!0}),e.newRenderer.setClearColor(15264748),e.newRenderer.setPixelRatio(window.devicePixelRatio),e.newRenderer.shadowMap.enabled=!0,e.newRenderer.xr.enabled=!0,e.allRoomCenterCamera=new i.Group,e.splitRoomLineGroup=new i.Group,e.splitRoomLineGroup.name="splitRoomHelperGroup",e.splitRoomLine=new i.Group,[e.splitRoomLineGroup,e.splitRoomLine,e.model3D,e.model2D,e.lineGroup3D,e.wallGroup,e.floorGroup,e.wallGroup3D,e.memberGroup3D,e.pointHelpGroup,e.helperGroup,e.pointHelperGroup,e.doorHelperGroup,e.floorGroup2d,e.modelHelperGroup,e.allRoomCenterCamera,e.modelDotGroup,e.doorGroup].forEach(t=>{e.scene.add(t)}),e.roomList=[[],[]],e.allGroup3d=[e.lineGroup3D,e.floorGroup,e.wallGroup3D,e.memberGroup3D];var t=new i.MeshBasicMaterial({color:"#4169E1",side:i.DoubleSide});e.wallTool=new l.DrawWallTool(t);let S=new r.SceneCore(e);e.wallHelp=new d.WallHelp,e.wallHelper=new g.WallHelper(e);let C=e;e.debug=!1,e.list.sceneInit.add(function(e,t="PC",i=""){e&&$(e).empty(),C.dom=e,C.history=new n.History(C,t),C.activeTool&&C.activeTool.dispose(),C.activeTool=new a.ViewPort(C,e,t,i)}),e.list.resetCamera.add(function(){C.globalControl&&(C.globalControl.reset(),C.globalControl.object.isPerspectiveCamera&&(C.globalControl.object.zoomNum=1),C.updateDom(),C.list.changeCameraSlider.dispatch("2d",1),(0,c.UtilCore).updateLineDimensionsLine(C),C.autoShowHidden(1),C.globalControl.object.isPerspectiveCamera&&C.switchHelperGroup("hidden"))}),e.list.splitTool.add(function(e){C.toolType="splitTool",C.splitType=e,C.list.setViewportCamera.dispatch("2D",C)}),e.list.changeTheme.add(function(e){""!=e?(C.renderer.setClearColor(e),C.grid.children.concat(C.grid3d.children).forEach(e=>{("2dGrid1"==e.name||"3dGrid1"==e.name)&&(e.material.color=new i.Color(5263440)),("2dGrid2"==e.name||"3dGrid2"==e.name)&&(e.material.color=new i.Color(7894390))}),C.themeColor=e):(C.renderer.setClearColor(15264748),C.grid.children.concat(C.grid3d.children).forEach(e=>{("2dGrid1"==e.name||"3dGrid1"==e.name)&&(e.material.color=new i.Color(16777215)),("2dGrid2"==e.name||"3dGrid2"==e.name)&&(e.material.color=new i.Color(16777215))}),C.themeColor="")}),e.list.saveScene.add(function(e="cache"){"cache"==e?C.saveSceneJson():C.saveSceneJsonToFile()}),e.list.createMap.add(function(e,t){if(C.miniMapCamera.isOrthographicCamera){let i=e/t,r=-5e3;C.miniMapCamera.left=r*i,C.miniMapCamera.right=-r*i,C.miniMapCamera.top=-r,C.miniMapCamera.bottom=r}else C.miniMapCamera.aspect=e/t;if(C.newRenderer.setSize(e,t),C.miniMapCamera.updateProjectionMatrix(),C.roamTool){let i=e/(t+28),r=-5e3;C.miniCamera.camera.left=r*i,C.miniCamera.camera.right=-r*i,C.miniCamera.camera.top=-r,C.miniCamera.camera.bottom=r,C.miniCamera.renderer.setSize(e,t+28),C.miniCamera.camera.updateProjectionMatrix()}}),e.list.makeGroup.add(function(){let e=C.camera.isOrthographicCamera?"2d":"3d";C.makeGroup(e)}),e.list.explodeGroup.add(function(){let e=C.camera.isOrthographicCamera?"2d":"3d";C.explodeGroup(e)}),e.list.changeModel.add(function(e){C.grid3d.visible=!1,C.floorGroup.visible=!0;let t=C.model3D.children,r=!1,n=C.wallGroup3D.children;switch((n=(n=n.concat(C.model3D.children)).concat(C.floorGroup.children)).forEach(e=>{e.traverse(function(e){e.isMesh&&e.oldColor&&(e.material=e.oldColor.clone())})}),e){case"transparentModel":C.wallGroup3D.visible=!1,C.memberGroup3D.visible=!1,C.lineGroup3D.visible=!0,C.floorGroup.visible=!1,r=!0;break;case"materialModel":C.wallGroup3D.visible=!0,C.grid3d.visible=!0,C.memberGroup3D.visible=!0,C.lineGroup3D.visible=!1,r=!1;break;case"lineModel":C.wallGroup3D.visible=!1,C.memberGroup3D.visible=!1,C.lineGroup3D.visible=!0,r=!1;break;case"MLModel":C.wallGroup3D.visible=!0,C.memberGroup3D.visible=!0,C.lineGroup3D.visible=!0,r=!1;break;case"randomMaterialModel":let o={};n.forEach(e=>{e.traverse(function(e){e.isMesh&&(e.oldColor||(e.oldColor=e.material.clone()),setTimeout(()=>{let t=e.material.color.toArray(),r=t[0]+"-"+t[1]+"-"+t[2];if(o.hasOwnProperty(r))e.material=o[r].clone();else{let t=new i.MeshBasicMaterial;var n=new Float32Array([Math.random(),Math.random(),Math.random()]);t.color.fromArray(n),e.material=t,o[r]=e.material.clone()}},100))})}),r=!1}t.forEach(e=>{e.traverse(function(e){e.isMesh&&(e.material.emissive=new i.Color(0),e.material.wireframe=r)})})}),e.list.removeAll.add(function(e="save",t=!0,i="all"){let r="清空画布",n="清空画布会清除当前全部设计";"lable"==i&&(r="清空标注",n="清空标注会清除当前全部标注"),t?C.list.dialog.dispatch(r,n,["remove",e,i]):C.removeScene(e,i)}),e.list.activeTool.add(function(e,t=!0){if("close"==e){C.exitTool(t);return}C.camera.isOrthographicCamera||C.list.setViewportCamera.dispatch("2D",C),C.exitTool(!0,!1),("wall"==e||"room"==e)&&(C.dom.style.cursor="crosshair"),"figure"==e&&C.list.importMap.dispatch(),C.toolType=e}),e.list.importMap.add(function(){let e="清空提示",t="识别图片生成户型，将清空当前方案中所有设内容没确定继续？";C.execute(),C.list.dialog.dispatch(e,t,["importMap"])}),e.list.doCallback.add(function(e){switch(e[0]){case"remove":C.removeScene(e[1],e[2]);break;case"importMap":C.removeScene(""),C.importMapMain();break;case"delMap":C.execute(),C.delMap()}}),e.list.setScaleTool.add(function(){C.cleanScaleTool(),C.allHelperForScaleTool(new i.Vector3(-1e3,0,0),new i.Vector3(1e3,0,0))}),e.list.hiddenMap.add(function(){C.scene.children.forEach(e=>{"mapImage"==e.useType&&(e.visible=!e.visible)})}),e.list.delMap.add(function(){C.list.dialog.dispatch("删除底图","",["delMap"])}),e.list.showHiddenHelper.add(function(e,t,i=""){""==i&&(C.config.settingJsonCopy.hasOwnProperty(e)&&(C.config.settingJson[e]=t),i=C.config.settingJson),C.config.settingJson=i;let r=["roomName","roomArea","dimension"];for(let e in i)"only"==t&&0>r.indexOf(e)||C.showHiddenHelperMain(e,i[e])}),e.list.useModel.add(function(e,t,i,r=""){C.adsorbentModel=e,C.orthogonalModel=t,C.innerDraw=i,""!=r&&(C.wallDep=r)}),e.list.drawRoomChangeth.add(function(e){C.roomWallDep=1*e}),e.list.changeWallType.add(function(e){if(""==C.clickSelect||""==C.clickSelect[0].object)return;C.execute(),C.removeBSRHelper();let t=C.clickSelect[0].object;t.isArc==e?t.isArc=!1:t.isArc=e;let i=[];C.otherMeshs.forEach(e=>{e.wallId==t.wallID&&i.push(e)}),i.forEach(e=>{C.otherMeshs.splice(C.otherMeshs.indexOf(e),1),C.scene.remove(e)}),new(0,s.WallCore)(C).wallToJson();let r=(0,c.UtilCore).getRealWallByPosition(t.startPoint,t.endPoint,C.allWalls);C.clickSelect[0].object=r,r.material.color=C.clickColor}),e.list.splitWall.add(function(){if(""==C.clickSelect||""==C.clickSelect[0].object)return;C.execute();let e=C.clickSelect[0].object,t=new s.WallCore(C),r="",n=[];if(e.isArc){let t=new i.Vector2(e.startPoint.x,e.startPoint.y),r=new i.Vector2(e.endPoint.x,e.endPoint.y),o=r.clone().sub(t.clone()),a=new i.Vector2(-o.y,o.x),s=new i.Vector2(o.y,-o.x),l=t.clone().distanceTo(e.arcCenter.clone()),h=e.arcCenter.clone().add(a.setLength(l)),d=e.arcCenter.clone().add(s.setLength(l)),u=(0,c.UtilCore).getClockWise(t,e.cp,r),p=(0,c.UtilCore).getClockWise(t,h,r),m="";m=u*p>0?h:d,e.endPoint=m.clone();let f=e.geometry.attributes.position.array,g=(0,c.UtilCore).getPointInArc(t,m,u,e.arcCenter.clone(),l);e.cp=g;let y=C.addArcWall(t,r,e.cp,e.isArc);f=y.geometry.attributes.position.array,y.startPoint=m.clone();let x=(0,c.UtilCore).getPointInArc(m,r,u,e.arcCenter.clone(),l);y.cp=x,n=[e,y]}else r=new i.Vector2((e.startPoint.x+e.endPoint.x)/2,(e.startPoint.y+e.endPoint.y)/2),n=t.splitWall(e,r);t.wallToJson();let o=C.getDialogPosition(new i.Vector3(n[0].startPoint.x,n[0].startPoint.y,0),new i.Vector3(n[0].endPoint.x,n[0].endPoint.y,0)),a=Math.round(n[0].startPoint.clone().distanceTo(n[0].endPoint.clone())),l=(0,c.UtilCore).havePointWall(n[0].startPoint,C.allWalls).length>1,h=(0,c.UtilCore).havePointWall(n[0].endPoint,C.allWalls).length>1;C.list.showDialog.dispatch(0,"wall",o,[a,n[0].thickness,l,h]);let d=(0,c.UtilCore).getRealWallByPosition(n[0].startPoint,n[0].endPoint,C.allWalls);C.clickSelect[0].object=d,d.material.color=C.clickColor}),e.list.delWall.add(function(){if(C.execute(),""==C.clickSelect||""==C.clickSelect[0].object)return;let e=C.clickSelect[0].object,t=(0,c.UtilCore).havePointWall(e.startPoint,C.allWalls,e),i=(0,c.UtilCore).havePointWall(e.endPoint,C.allWalls,e);C.wallGroup.remove(e),C.allWalls.indexOf(e)>=0&&C.allWalls.splice(C.allWalls.indexOf(e),1),C.removeHelperByWall(e),2==t.length&&C.margeWall(t[0],t[1]),2==i.length&&C.margeWall(i[0],i[1]),new(0,s.WallCore)(C).wallToJson();let r=C.getAllWindowInWall(e);r.length>0&&r.forEach(e=>{C.scene.remove(e),C.otherMeshs.indexOf(e)>=0&&C.otherMeshs.splice(C.otherMeshs.indexOf(e),1)}),C.list.hiddenDialog.dispatch()}),e.list.delSplitLine.add(function(){if(""==C.clickSelect||""==C.clickSelect[0].object)return;C.execute();let e=C.clickSelect[0].object;C.splitRoomLine.remove(e),C.splitRoomLineGroup.children=[],C.list.hiddenDialog.dispatch(),C.clickSelect="",new(0,s.WallCore)(C).wallToJson()}),e.list.delDoor.add(function(){if(""==C.clickSelect||""==C.clickSelect[0].object)return;let e=C.clickSelect[0].object.parent;if(e.isLock){C.list.alert.dispatch("模型已锁定,请先解锁","warning");return}C.execute();let t=e.wallId?e.wallId:e.parameter.tdm.wallId,i=C.getWallById(t);C.removeDoor(e),C.doorHelperGroupClean(),C.list.hiddenDialog.dispatch(),C.clickSelect="",C.partRefreshWall(i)}),e.list.delMember.add(function(){if(""==C.clickSelect||""==C.clickSelect[0].object)return;let e=C.clickSelect[0].object.parent;if(C.camera.isOrthographicCamera||(e=C.clickSelect[0].object.twoD),e.isLock){C.list.alert.dispatch("模型已锁定,请先解锁","warning");return}C.execute(),C.removeMember(e),C.doorHelperGroupClean(),C.modelHelperGroup.children=[],C.list.hiddenDialog.dispatch(),C.clickSelect=""}),e.list.delModel.add(function(){if(""==C.clickSelect||""==C.clickSelect[0].object)return;let e=[];(e=1==C.selectObjArr.length?[C.clickSelect[0].object]:C.selectObjArr).forEach(e=>{let t=C.getOuterParent(e);if(t.isLock){1==C.selectObjArr.length&&C.list.alert.dispatch("模型已锁定,请先解锁","warning");return}C.execute();let i=C.getOuterParent(t,t,"outer"),r=t.parent;if("2DModel"==t.modelType||"2dModelGroup"==t.modelType){t.parent.remove(t);let e=C.get3DModelBy2DModel(t);e.parent.remove(e)}else{let e=C.get2DModelBy3DModel(t);i=C.getOuterParent(e,e,"outer"),r=e.parent,t.parent.remove(t),e.parent.remove(e)}if(C.doorHelperGroupClean(),C.modelHelperGroup.children=[],C.list.hiddenDialog.dispatch(),C.clickSelect="",C.clickDepthMsg.uuid){C.modelDotGroup.children=[];let e=i.param[0];C.refreshRealSizeByBox(i,r),C.updateModelPosition(r,i),C.addDashBoxFor2dGroup(i),C.addDashBoxForGroup(e)}})}),e.list.reverseDoor.add(function(){if(""==C.clickSelect||""==C.clickSelect[0].object)return;C.execute();let e=C.clickSelect[0].object.parent;if("LWindow"!=e.modelType&&"UWindow"!=e.modelType){if("door"==e.modelType||"childMotherDoor"==e.modelType)C.execute(new h.DrawCommand(C,"door","end",[0,0,"angle"],!0,"click"),"翻转");else{let t=e.parameter[0];e.rotation.z+=Math.PI,t.rotation.y+=Math.PI}}}),e.list.replaceDoor.add(function(){if(""==C.clickSelect||""==C.clickSelect[0].object)return;C.execute();let e=C.clickSelect[0].object.parent;if(!e.modelPath)return;let t=e.modelPath,i="";if(t.indexOf("_replace")>=0)i=t.replace(/_replace/g,"");else{let e=t.split("."),r=e.pop();i=e.join()+"_replace."+r}e.modelPath=i}),e.list.copyDoor.add(function(){if(""==C.clickSelect||""==C.clickSelect[0].object)return;let e=C.clickSelect[0].object.parent;"3dMember"==e.name&&(e=C.clickSelect[0].object.twoD),C.list.setViewportCamera.dispatch("2D",C),C.copyDoor=e,C.toolType=C.config.toolTypeConfig[e.modelType]}),e.list.GPURender.add(function(){C.list.hiddenDialog.dispatch(),C.switchHelperGroup("hidden"),new y.BaseRender(C)}),e.list.createRoom.add(function(e){S.createRoom(e)}),e.list.setRoomType.add(function(e){if(""==C.clickSelect||""==C.clickSelect[0].object)return;let t=C.clickSelect[0].object;t.roomName=e;let i=($("#roomName"+t.uuid).attr("roomName")+"\n"+$("#roomName"+t.uuid).attr("roomArea")).split("\n");i[0]=e,$("#roomName"+t.uuid).attr("roomName",e),$("#roomName"+t.uuid).text(i.join("\n")),C.saveSceneJson()}),e.list.setViewportCamera.add(e.setViewportCamera),e.list.executeTool.add(function(e){new(0,u.ToolsController)(C,e).main()}),e.list.dragRoomForMobile.add(e=>{(0,M.MobileMain).autoSetCamera(C.wallGroup),C.loadRoom(e)}),e.list.dragWallForMobile.add(e=>{C.toolType=e}),e.list.recoveryScene.add(function(e){C.list.alert.dispatch("正在加载户型"),C.removeScene(""),localStorage.setItem("sceneData",e),(e=JSON.parse(e)).cameraJson.sceneModel="2D",C.cacheJson=JSON.stringify(e),C.readCache(JSON.stringify(e)),C.miniMapObj=new x.CreateMiniMap(C,C.miniMapCamera,C.scene,C.newRenderer,C.miniDom,240,202),C.miniMapObj.main()}),e.list.saveWallModel.add(function(){C.camera.isOrthographicCamera||C.list.setViewportCamera.dispatch("2D",C);let e=new i.Group,t=["2dwall","floorGroup2d","flue","post","bridge"];C.scene.children.forEach(i=>{t.indexOf(i.name)>-1&&e.add(i.clone()),i.modelPath&&(i.modelPath.indexOf("door")>-1||i.modelPath.indexOf("window")>-1)&&e.add(i.clone())});let r=C.getSceneAllJson();r.mapJson={},r=JSON.stringify(r);let n=C.getTextCanvas2("roomName");C.initCameraPngScene(e,"2D"),C.cameraScene.add(n),setTimeout(function(){let e=C.cameraRenderer.domElement.toDataURL("image/png");n.parent.remove(n),C.list.alert.dispatch("户型保存成功"),C.list.saveWallJson.dispatch(e,r)},100)}),e.list.saveModel.add(function(){0!=C.selectObjArr.length&&(C.list.hiddenDialog.dispatch(),C.selectObjArr.forEach(e=>{let t="";t=C.camera.isOrthographicCamera?C.get3DModelBy2DModel(C.getOuterParent(e)):C.getOuterParent(e);let i="组合模型";if(t.imgPath){let e=t.imgPath.split("/");(i=e[e.length-1].split(".")).pop(),i=i.join("")}let r=t,n=t.clone();C.extendParam(r,n);var o=JSON.stringify(C.exportModelJson(n));C.initCameraPngScene(t),C.exportModelGlb(t),i||(i="默认模型"),setTimeout(function(){let e=C.cameraRenderer.domElement.toDataURL("image/png");C.list.popupSaveRecord.dispatch(e,o);var r=new Blob([o],{type:"text/plain"}),n=document.createElement("a");n.style.display="none",n.href=URL.createObjectURL(r),n.download=i+".json",n.click();var a=document.createElement("a");a.href=e,a.download=i+"iso.png",a.click(),C.initCameraPngScene(t,"top"),setTimeout(function(){let e=C.cameraRenderer.domElement.toDataURL("image/png");var r=document.createElement("a");r.href=e,r.download=i+".png",r.click(),C.initCameraPngScene(t,"right"),setTimeout(function(){let e=C.cameraRenderer.domElement.toDataURL("image/png");var t=document.createElement("a");t.href=e,t.download=i+"right.png",t.click()})},100)},100)}))}),e.list.exportGLTF.add(function(e){"pdf"==e?C.exportPDF():"jpg"==e?(C.list.switchCamera.dispatch("2D"),C.exportJPG()):"mobilePDF"==e?(C.list.switchCamera.dispatch("2D"),C.exportMobilePDF()):C.exportGLTF(e)}),e.list.smartRoom.add(function(e){if(1e4==e[0]){C.testSmartRoom();return}setTimeout(()=>{C.otherMeshs.length>0&&C.scene.remove(...C.otherMeshs),C.removeScene(""),C.camera.isOrthographicCamera||C.list.setViewportCamera.dispatch("2D",C);let t=new(0,m.Range)().getHome(e[0],e[1],e[2]);new(0,s.WallCore)(C).wallToJson("2D",t[0]),C.scene.add(...t[1]),C.otherMeshs=t[1],C.doorHoleArr=t[2],C.doorHelperGroupClean(),C.pointHelperGroup.children=[],C.model2D.children=[],C.model3D.children=[],C.exitTool(!0),C.list.executeTool.dispatch("moveFree")},100)}),e.list.changeCamera.add(function(e,t="",i=1){let r=.95*i,n=C.globalControl;n.object.isPerspectiveCamera?"max"==t?n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/r)):n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*r)):n.object.isOrthographicCamera&&("max"==t?n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/r)):n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*r))),n.object.updateProjectionMatrix(),C.globalControl.update(),C.updateDom()}),e.list.undo.add(function(){"PC"!=C.deviceType&&C.camera.isPerspectiveCamera&&C.list.switchCamera.dispatch("2D"),C.history.undo()}),e.list.redo.add(function(){"PC"!=C.deviceType&&C.camera.isPerspectiveCamera&&C.list.switchCamera.dispatch("2D"),C.history.redo()}),e.list.uploadFile.add(function(e,t,r=""){if(!(0>e.indexOf(".glb")||0>e.indexOf(".gltf")||0>e.indexOf(".json")))return;if(e&&C.list.progressOpen.dispatch(),e.indexOf(".json")>=0){var n=new FileReader;n.onload=()=>{localStorage.setItem("sceneData",n.result),C.cacheJson=n.result,C.readCache(n.result),C.list.progressClose.dispatch()},n.readAsText(t),C.list.progressChange.dispatch(100);return}let o=C.config.maxWidth,a=URL.createObjectURL(t);new f.GLTFLoader().load(a,function(n){let a=n.scene;var s=new i.Box3;s.setFromObject(a);let l=1*(s.max.x-s.min.x).toFixed(2),h=1*(s.max.y-s.min.y).toFixed(2),c=1*(s.max.z-s.min.z).toFixed(2);if(Math.abs(s.min.y)>=0){let e=new i.Vector3;s.getCenter(e);let t=new i.Group;a.position.set(-e.x,-e.y,-e.z),t.add(a),a=t}l>o&&a.scale.set(o/l,o/l,o/l),a.position.set(0,h/2,0),a.traverse(function(e){e.layers.set(2)});let d=e.split(".");d.pop();let u=d.join(".");a.name=u,a.modelType="3DModel",a.modelPosition="bottom",""!=r&&(a.position.set(r.location.x,r.location.y,r.location.z),a.rotation.y=r.rotation,r.rotate&&a.rotation.set(r.rotate.x,r.rotate.y,r.rotate.z),a.scale.set(r.width/l,r.height/h,r.depth/c),a.isLock=r.isLock,a.modelPosition=r.modelPosition,r.scale&&a.scale.copy(r.scale)),a.width=l,a.height=h,a.depth=c,a.imgPath="localPath",r?r.sliceArr&&(a.sliceArr=r.sliceArr):C.handleUpload(t,a),C.model3D.add(a),C.initCameraPngScene(a,"top"),setTimeout(function(){for(var e=C.cameraRenderer.domElement.toDataURL("image/png").split(","),t=e[0].match(/:(.*?);/)[1],n=atob(e[1]),o=n.length,s=new Uint8Array(o);o--;)s[o]=n.charCodeAt(o);var h=new Blob([s],{type:t});let d=new File([h],"upload.jpg",{type:"image/jpeg",lastModified:Date.now()}),u=new i.TextureLoader;u.setCrossOrigin("");let p=URL.createObjectURL(d);u.load(p,e=>{let t=new i.Mesh(new i.PlaneBufferGeometry(1e3*l,1e3*c),new i.MeshBasicMaterial({map:e,transparent:!0}));t.position.set(0,0,0),r.scale&&t.scale.set(r.scale.x,r.scale.z,r.scale.y),t.modelType="2DModel",C.model2D.add(t),t.modelId=a.uuid,t.param=[a],a.modelId=t.uuid,a.param=[t],t.name=a.name,t.modelPosition=a.modelPosition,""!=r||C.camera.isOrthographicCamera||(C.mouseCoverObj=a),""==r&&C.camera.isOrthographicCamera&&(C.mouseCoverObj=t),r&&("bottom"==a.modelPosition?a.visible=C.config.settingJson.showFloorFurniture:"top"==a.modelPosition?a.visible=C.config.settingJson.showCeilFurniture:a.visible=C.config.settingJson.showWallFurniture,t.visible=a.visible),C.synchroModel(a),C.list.progressClose.dispatch()})},100)},function(e){C.list.progressChange.dispatch(parseInt(e.loaded/e.total*100))},function(e){console.log(e)})}),e.list.loadGLTFJson.add(function(e,t="load"){if(0>e.indexOf("modelPosition")){var i=new XMLHttpRequest;i.open("GET",e,!0),i.send(null),i.onreadystatechange=function(){if(4==i.readyState&&(200==i.status||0==i.status)){let e=JSON.parse(i.responseText);C.loadGLTFJsonCore(e,t)}}}else{let i=JSON.parse(e);C.loadGLTFJsonCore(i,t)}}),e.list.replaceGltf.add(function(e){let t=e[0];t.indexOf("modelPosition")>=0?C.list.loadGLTFJson.dispatch(e[0],"replace"):t.indexOf(".json")>=0?C.list.loadGLTFJson.dispatch(e[0],"replace"):(C.list.loadGltf.dispatch(e,"",C.model3D,C.model2D,"replace"),window.intervalClear=setInterval(()=>{C.cleanInterval("replace")},100))}),e.list.loadGltf.add(function(e,t="",r=C.model3D,n=C.model2D,o="load"){C.doorHelperGroupClean();let a="",s="",l="",h="",c="",d="",u="",p="";if(""!=t?(s=t.imgPath,a=t.modelPath,d=t.location,u=t.rotation,l=t.modelPosition,t.scale&&(p=t.scale)):(a=e[0],s=e[1],l=e[2]),!a)return;let m=C.config.maxWidth,g=s.split("/"),y=g[g.length-1].split(".");y.pop(),y=y.join(""),g.pop();let x=g.join("/");x+="/"+y+".json";var w=new XMLHttpRequest;w.open("GET",x,!0),w.send(null),w.onreadystatechange=function(){if(4==w.readyState){if(200==w.status||0==w.status){let e=JSON.parse(w.responseText),p=e.boundingBox.xLen/1e3,g=e.boundingBox.yLen/1e3,x=e.boundingBox.zLen/1e3;""!=t&&(p=t.width,g=t.height,x=t.depth);let b=C.wallHelp.obbBoxMain(1e3*p,1e3*x,0),v=C.wallHelp.obbBoxMain(p,g,x);v.name="model3dBox",b.name="model2dBox",t.scale&&b.scale.set(t.scale.x,t.scale.z,t.scale.y),v.layers.set(2),p>m&&(v.scale.set(m/p,m/p,m/p),b.scale.set(m/p,m/p,m/p)),r.add(v),n.add(b),v.modelId=b.uuid,v.param=[b],v.modelPosition=l,v.height=g,b.modelId=v.uuid,b.param=[v],C.camera.isOrthographicCamera&&""==t&&(C.mouseCoverObj=b),C.camera.isOrthographicCamera||""!=t||(C.mouseCoverObj=v),""!=t?(b.position.set(1e3*d.x,-(1e3*d.z),0),t.imgLayer&&(b.position.z=t.imgLayer),b.rotation.z=u,v.position.set(d.x,d.y,d.z),v.rotation.y=u,t.rotate&&v.rotation.set(t.rotate.x,t.rotate.y,t.rotate.z),t.scale&&v.scale.copy(t.scale)):("top"==l?v.position.set(0,C.wallGroup3D.roomHeight/1e3-g/2,0):"bottom"==l?v.position.set(0,g/2,0):v.position.set(0,0,0),b.position.set(0,0,0),"load"!=o&&(b.position.set(9999,9999,9999),v.position.set(9999,9999,9999))),new(0,i.TextureLoader)().load(s,e=>{(h=new i.Mesh(new i.PlaneBufferGeometry(1e3*p,1e3*x),new i.MeshBasicMaterial({map:e,depthWrite:!1,transparent:!0,opacity:1}))).position.set(0,0,0),h.renderOrder=10,h.modelType="2DModel",""!=t&&(h.isLock=t.isLock,h.rotation.z=u,h.position.set(1e3*d.x,-(1e3*d.z),0),t.imgLayer&&(h.position.z=t.imgLayer),t.scale&&h.scale.set(t.scale.x,t.scale.z,t.scale.y)),n.add(h),h.modelId=v.uuid,h.param=[v],"load"!=o&&h.position.set(9999,9999,9999),C.camera.isOrthographicCamera||""!=t||h.position.set(1e4,1e4,1e4),b.modelUUID=h.uuid,new(0,f.GLTFLoader)().load(a,function(e){(c=e.scene).traverse(function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)}),c.position.set(1e4,1e4,1e4),c.modelType="3DModel",c.modelPosition=l,c.floorHei=0;var n=new i.Box3;n.setFromObject(c);var n=new i.Box3;n.setFromObject(c);let f=1*(n.max.x-n.min.x).toFixed(2),w=1*(n.max.y-n.min.y).toFixed(2),M=1*(n.max.z-n.min.z).toFixed(2);c.width=f,c.height=w,c.depth=M,c.name=y,h.name=y,c.modelId=h.uuid,c.param=[h],c.imgPath=s,c.modelPath=a,h.width=1e3*f,h.height=1e3*M,h.depth=1e3*w,h.imgPath=s,h.modelPath=a,v.modelUUID=c.uuid,c.visible=v.visible,h.visible=v.visible,r.add(c);let S=s.split("/"),P=S[S.length-2];if(h.modelRealType=P,c.modelRealType=P,C.camera.isOrthographicCamera||""!=t||(c.modelId=b.uuid,c.param=[b]),f>m&&(c.scale.set(m/f,m/f,m/f),h.scale.set(m/f,m/f,m/f)),""!=t){c.position.set(d.x,d.y,d.z),c.isLock=t.isLock,c.rotation.y=u,t.rotate&&c.rotation.set(t.rotate.x,t.rotate.y,t.rotate.z),h.modelId=c.uuid,h.param=[c];let e={x:p/f,y:x/M,z:g/w};h.geometry=new i.PlaneBufferGeometry(p/e.x*1e3,x/e.y*1e3),h.scale.set(e.x,e.y,e.z),c.scale.set(e.x,e.z,e.y),t.scale&&(c.scale.copy(t.scale),h.scale.set(t.scale.x,t.scale.z,t.scale.y));let r=C.getOuterParent(h);C.synchroModel(r),v.parent.remove(v),b.parent.remove(b)}"load"!=o&&(C.mouseCoverObj="",c.position.set(9999,9999,9999),c.param=[h],h.param=[c],v.parent.remove(v),b.parent.remove(b))})})}else new(0,f.GLTFLoader)().load(a,function(e){(c=e.scene).traverse(function(e){e.layers.set(2),e.isMesh&&(e.castShadow=e.receiveShadow=!0)}),c.position.set(1e5,1e4,0),C.camera.isOrthographicCamera||""!=t||(C.mouseCoverObj=c),c.modelType="3DModel",c.modelPosition=l;var p=new i.Box3;p.setFromObject(c);let f=1*(p.max.x-p.min.x).toFixed(2),g=1*(p.max.y-p.min.y).toFixed(2),x=1*(p.max.z-p.min.z).toFixed(2);c.scale.set(1,1,1),f>m&&c.scale.set(m/f,m/f,m/f),c.width=f,c.height=g,c.depth=x,c.floorHei=0,""!=d&&(c.position.set(d.x,d.y,d.z),c.rotation.y=u,t.rotate&&c.rotation.set(t.rotate.x,t.rotate.y,t.rotate.z),c.scale.set(t.width/f,t.height/g,t.depth/x)),c.modelPath=a,""!=t&&(c.isLock=t.isLock,t.scale&&c.scale.copy(t.scale)),r.add(c),new(0,i.TextureLoader)().load(s,e=>{if(f*=1e3,x=1e3*(g=1e3*x),(h=new i.Mesh(new i.PlaneBufferGeometry(f,g),new i.MeshBasicMaterial({map:e,depthWrite:!1,transparent:!0,opacity:1}))).position.set(1e5,1e4,0),h.renderOrder=10,C.camera.isOrthographicCamera&&""==t&&(C.mouseCoverObj=h),h.modelType="2DModel",h.width=1*f.toFixed(2),h.height=1*g.toFixed(2),h.depth=c.height,h.imgPath=s,h.modelPath=a,h.modelId=c.uuid,h.param=[c],c.modelId=h.uuid,c.param=[h],c.imgPath=s,c.name=y,h.name=y,n.add(h),""!=t){let e=new i.Vector3(1e3*d.x,-(1e3*d.z),0);h.position.set(e.x,e.y,e.z),t.imgLayer&&(h.position.z=t.imgLayer),h.isLock=t.isLock,t.scale&&h.scale.set(t.scale.x,t.scale.z,t.scale.y),"bottom"==c.modelPosition?c.visible=C.config.settingJson.showFloorFurniture:"top"==c.modelPosition?c.visible=C.config.settingJson.showCeilFurniture:c.visible=C.config.settingJson.showWallFurniture,h.visible=c.visible}let r=C.getOuterParent(c);C.synchroModel(r),"load"!=o&&(C.mouseCoverObj="",c.position.set(9999,9999,9999))})})}}}),e.list.change2DWall.add(function(e){switch(e[0]){case"circle":case"bezier":C.list.changeWallType.dispatch(e[0]);break;case"split":C.list.splitWall.dispatch();break;case"del":C.list.delWall.dispatch()}}),e.list.changeWallParam.add(function(e,t,i=!1){if(""==C.clickSelect||""==C.clickSelect[0].object)return;let r=C.clickSelect[0].object;if(r.material.color=C.clickColor,"len"==e){if(1>Math.abs(Math.round(r.startPoint.clone().distanceTo(r.endPoint.clone()))-t)&&!i)return;let e=(0,c.UtilCore).havePointWall(r.endPoint,C.allWalls).length>1,n=C.getWallHelperByWall(r);n&&C.removeHelperByWall(n),e?C.changeWallLength(r,t,"end"):C.changeWallLength(r,t,"start")}else"depth"==e?r.thickness=1*t:"wallType"==e?(C.execute(),r.style=t,1==r.style?r.height=1200:r.height=window.storeyHei,r.material.color=C.getWallColor(r),i=!0):(C.execute(),r.height=1*t);if(!i)return;if(new(0,s.WallCore)(C).wallToJson(),"depth"==e){let e=C.getAllWindowInWall(r);e.length>0&&e.forEach(e=>{C.currentDoor=e,C.currenDraw=e,new(0,h.DrawCommand)(C,"door","end",[1*t,0,"depth"]).execute(),C.doorHelperGroupClean(),C.currentDoor=""})}let n=(0,c.UtilCore).getRealWallByPosition(r.startPoint,r.endPoint,C.allWalls);C.clickSelect[0].object=n,C.currentDownSelect&&0!=C.currentDownSelect.length&&(C.currentDownSelect[0].object=n),C.allWalls.forEach(e=>{e.material.color=C.getWallColor(e)}),C.clickSelect[0].object.material.color=C.clickColor}),e.list.change2DFloor.add(function(e){switch(e){case"copy":let t=C.clickSelect[0].object;C.copyFloorMaterial=t.material;break;case"replaceOneself":C.execute(),C.list.replaceSelfMat.dispatch();break;case"replaceAll":C.execute(),C.list.replaceAllMat.dispatch()}}),e.list.replaceSelfMat.add(function(){e.selectObjArr.forEach(e=>{if(1==e.material.color.r)e.material=new i.MeshBasicMaterial({color:15264748,side:i.DoubleSide,transparent:e.material.transparent,opacity:e.material.opacity});else{let t=new i.TextureLoader().load("./static/assets/images/banner/floor.jpg");t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.material=new i.MeshBasicMaterial({map:t,transparent:e.material.transparent,opacity:e.material.opacity})}})}),e.list.replaceAllMat.add(function(){e.floorGroup2d.children.forEach(e=>{if(1==e.material.color.r)e.material=new i.MeshBasicMaterial({color:15264748,side:i.DoubleSide,transparent:e.material.transparent,opacity:e.material.opacity});else{let t=new i.TextureLoader().load("./static/assets/images/banner/floor.jpg");t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,e.material=new i.MeshBasicMaterial({map:t,transparent:e.material.transparent,opacity:e.material.opacity})}})}),e.list.change2DDoor.add(function(e){switch(e[0]){case"reverse":C.list.reverseDoor.dispatch();break;case"replace":C.list.replaceDoor.dispatch();break;case"copy":C.list.copyDoor.dispatch();break;case"lock":C.doorSetLock();break;case"del":C.list.delDoor.dispatch()}}),e.list.changeDoorParam.add(function(e,t,r=!1){if(""==C.clickSelect||""==C.clickSelect[0].object||"depth"==e)return;C.removeInputByClassName(C.uiPanelBox.dom,"showDistance");let n="";if(C.camera.isOrthographicCamera)"CodeModel"==(n=C.clickSelect[0].object.parent).modelType&&(n=n.parameter.tdm);else{let e=C.getOuterParent(C.clickSelect[0].object);e&&e.parameter?(n=e.parameter.tdm,C.clickSelect[0].object.parent=n):n=C.clickSelect[0].object.parent}if(C.currentDoor=n,"height"==e||"floorHei"==e?n[e]=1*t:C.execute(new h.DrawCommand(C,"door","end",[t,0,e,"noUpdate"],!1,"click"),"改变门尺寸"),C.camera.isOrthographicCamera||C.cleanWallHelper(),r){C.partRefreshWall(C.getWallById(n.wallId)),new(0,s.WallCore)(C).wallToJson("3D"),C.cleanWallHelper(),C.camera.isOrthographicCamera&&C.addLineHelperForDoor(C.currentDoor,!0);let e=C.get3DWindowBy2dWindow(n);if(e||(e=C.get3DWindowBy2dWindow(C.clickSelect[0].object.parent)),e){C.modelHelperGroup.children=[];let t=new(0,i.Box3)().setFromObject(e),r=C.wallHelp.addOBBbox(e,1735416);if(r.name="modelBox",r.layers.set(2),C.modelHelperGroup.add(r),r.material.depthTest=!1,e.parameter.box=r,"UWindowMesh"==e.type&&(r.position.y+=(t.max.y-t.min.y)/2),"LWindowMesh"==e.type){let e=new i.Vector3;t.getCenter(e),r.position.copy(e.clone())}C.camera.isOrthographicCamera||(C.clickSelect[0].object.parent=e)}}if(C.camera.isOrthographicCamera){let e=document.getElementById("showDoorLength_start");e&&e.select()}}),e.list.change2DMember.add(function(e){switch(e[0]){case"copy":C.list.copyDoor.dispatch();break;case"lock":C.memberSetLock();break;case"del":C.list.delMember.dispatch()}}),e.list.changeMemberParam.add(function(e,t,i=!1){if(""==C.clickSelect||""==C.clickSelect[0].object)return;let r=C.clickSelect[0].object.parent,n="";C.camera.isOrthographicCamera?(r=C.clickSelect[0].object.parent,n=C.clickSelect[0].object.parent.threeD):(r=C.clickSelect[0].object.twoD,n=C.clickSelect[0].object),C.doorHelperGroupClean();let o=0;if("depth"==e){if(o=r.depth/n.scale.z,r[e]=1*t,i&&C.camera.isOrthographicCamera){new(0,s.WallCore)(C).wallToJson();return}}else if("width"==e){let e=t/(1*r.width);r.scale.x=e}else if("height"==e){let e=t/(1*r.height);r.scale.y=e}else"rotation"==e&&(r.rotation.z=Math.PI/180*t);if(C.addLineHelperForMember(r),C.camera.isOrthographicCamera)C.synchroModel(r);else{let i=1,a=0;C.wallGroup3D.roomHeight&&(a=C.wallGroup3D.roomHeight),"depth"==e&&(i=t/o,"beam"==r.modelType?n.position.z=a-o/2-(t-o)/2:n.position.z=o/2+(t-o)/2),n.scale.set(r.scale.x,r.scale.y,i),n.rotation.z=r.rotation.z,C.modelHelperGroup.children=[],C.addBoxForGroup(n)}document.getElementById("showModelDistop")&&document.getElementById("showModelDistop").select()}),e.list.change2DModel.add(function(e){if(""!=C.clickSelect&&""!=C.clickSelect[0].object)switch(e[0]){case"topFloat":case"bottomFloat":C.modelFloat(e[0]);break;case"frontBackTurn":case"aroundTurn":C.modelReverse(e[0]);break;case"replace":C.modelReplace();break;case"copy":C.modelCopy();break;case"hidden":C.modelHidden();break;case"lock":C.modelSetLock();break;case"collect":case"del":C.list.delModel.dispatch();break;case"upload":C.exportModelImg();break;case"save":C.list.saveModel.dispatch()}}),e.list.change2DModelParam.add(function(e,t,r=!1){if(""==C.clickSelect||""==C.clickSelect[0].object)return;let n=C.getOuterParent(C.clickSelect[0].object),o=C.getOuterParent(C.clickSelect[0].object,C.clickSelect[0].object,"outer"),a=o,s=n;"2dModel"==o.parent.name?(n=n.param[0],a=o.param[0]):s=n.param[0],n.updateMatrixWorld(!0,!0);let l=C.getRealSize(n);if("size"==e){let e=n.height*n.scale.y;e=l[1],n.updateMatrixWorld(!0,!0);let r=new(0,i.Vector3)().setFromMatrixScale(n.matrixWorld).clone().divide(n.scale),o=t[0]/n.width/1e3,a=t[2]/n.height/1e3,s=t[1]/n.depth/1e3;if(r=new(0,i.Vector3)(o,a,s).divide(r),n.scale.copy(r),C.clickDepthMsg.uuid){let e=C.getOuterParent(n,n,"outer");C.refreshRealSizeByBox(e,n)}if(1!=a){let e=n.modelPosition;n.updateMatrixWorld(!0,!0);let t=C.getRealSize(n);n.updateMatrixWorld(!0,!0);let r=new(0,i.Vector3)().setFromMatrixScale(n.matrixWorld).clone().divide(n.scale),o=(t[1]-l[1])/2/r.y;"top"==e?n.position.y-=o:n.position.y+=o}C.synchroModel(n)}else if("floorHei"==e){let e=new i.Vector3(0,l[1]/2+t/1e3,0);n.parent.worldToLocal(e),n.position.y=e.y,s.groundHei=t/1e3}else"rotation"==e&&(t[0]=Math.PI/180*(360-t[0]),t[1]=Math.PI/180*t[1],t[2]=Math.PI/180*t[2],n.rotation.set(t[0],t[2],t[1]),C.synchroModel(n));C.doorHelperGroupClean(),C.modelHelperGroup.children.forEach(e=>{"Line2"==e.type&&e.parent.remove(e)}),C.addBoxForGroup(n),C.addLineHelperForMember(s),C.refreshRealSizeByBox(a,n),C.updateModelPosition(n.parent,a),document.getElementById("showModelDistop")&&document.getElementById("showModelDistop").select()}),e.list.change3DDoor.add(function(e){if(""==C.clickSelect||""==C.clickSelect[0].object)return;let t=C.getOuterParent(C.clickSelect[0].object),i=t.parameter.tdm;switch(e[0]){case"reverse":if("LWindow"==i.modelType||"UWindow"==i.modelType)return;t.parameter.box.parent&&t.parameter.box.parent.remove(t.parameter.box),"door"==i.modelType||"childMotherDoor"==i.modelType?(C.currentDoor=i,C.execute(new h.DrawCommand(C,"door","end",[0,0,"angle"],!0,"click"),"翻转"),C.doorHelperGroupClean(),C.clickSelect[0].object=C.currentDoor.parameter[0],t=C.clickSelect[0].object):(t.rotation.y+=Math.PI,i.rotation.z+=Math.PI),C.transform3DTool.selectObj(t);break;case"lock":C.doorSetLock();break;case"replace":case"collect":break;case"copy":C.door3DCopy();break;case"del":if(t.isLock){C.list.alert.dispatch("模型已锁定,请先解锁","warning");return}C.execute(),t.parent.remove(t),C.removeDoor(i);let r=C.getWallById(i.wallId);C.partRefreshWall(r),C.removeInputByClassName(C.uiPanelBox.dom,"showDistance"),t.parameter.box&&t.parameter.box.parent.remove(t.parameter.box),C.transform3DTool&&"ThreeDimensionMoveHelper"==C.transform3DTool.name&&C.transform3DTool.removeBox(),C.list.hiddenDialog.dispatch()}}),e.list.change3DModel.add(function(e){switch(e[0]){case"scale":C.transform3DTool.useTranslate(!1).useScale(!0).useRotate(!1).switchMove(!1);break;case"moveAndRotation":C.transform3DTool.useScale(!1).useRotate(!0).useTranslate(!0).switchMove(!0);break;case"rotation":C.transform3DTool.useTranslate(!1).useScale(!1).switchRot(!0).switchMove(!1);break;case"move":case"replaceMaterial":case"array":case"collection":break;case"replace":C.modelReplace();break;case"frontBackTurn":case"aroundTurn":C.modelReverse(e[0]);break;case"copy":C.modelCopy();break;case"lock":C.modelSetLock();break;case"hidden":C.modelHidden();break;case"del":C.list.delModel.dispatch();break;case"makeGroup":C.list.makeGroup.dispatch();break;case"explodeGroup":C.list.explodeGroup.dispatch();break;case"upload":C.exportModelImg();break;case"save":C.list.saveModel.dispatch();break;case"frontAligning":case"rearAligning":case"leftAligning":case"rightAligning":case"topAligning":case"bottomAligning":case"frontAndBackAligning":case"leftRightAligning":case"topBottomAligning":C.execute();let t=[],i=C.selectObjArr.slice(0);C.camera.isOrthographicCamera?i.forEach(e=>{t.push(C.get3DModelBy2DModel(C.getOuterParent(e)))}):i.forEach(e=>{t.push(C.getOuterParent(e))}),C.modelAlign(e[0],t)}}),C.list.setRoomOpacity.add(e=>{"opacity"==e[0]?(window.roomOpacity=e[1]/100,C.floorGroup2d.children.forEach(e=>{e.material.transparent=!0,e.material.opacity=roomOpacity}),C.floorGroup.children.forEach(e=>{e.roomName&&(e.material.transparent=!0,e.material.opacity=roomOpacity)}),C.allWalls.forEach(e=>{e.material.transparent=!0,e.material.opacity=roomOpacity}),C.wallGroup3D.children.forEach(e=>{"3DWall"==e.modelType&&(e.material.transparent=!0,e.material.opacity=roomOpacity)})):"floorHeight"==e[0]?(window.storeyHei=1*e[1],C.allWalls.forEach(e=>{e.height=window.storeyHei}),new(0,s.WallCore)(C).wallToJson()):"levelPly"==e[0]&&(window.floorDep=1*e[1],C.floorGroup.children.forEach(e=>{e.roomName&&e.refresh()}))}),C.list.showRenderView.add(()=>{if(0==C.floorGroup.children.length){let e="温馨提示",t="请先绘制一个封闭户型";C.list.dialog.dispatch(e,t,[""])}else C.list.renderURL.dispatch()}),C.list.initRenderMain.add(e=>{C.openRenderScene=!0,new b.RenderViewPort(e[0][0]),new v.RenderMiniMap(e[1][0]),new w.RenderCameraParam(e[2])}),C.list.renderCameraSize.add(e=>{let t=window.innerHeight-110,i=t*e[0]/e[1],r=window.innerWidth/2-i/2,n=window.innerHeight/2-t/2;i>window.innerWidth-650&&(t=(i=window.innerWidth-650)*e[1]/e[0],r=window.innerWidth/2-i/2+30,n=window.innerHeight/2-t/2),C.list.cameraShot.dispatch(i,t,r,n,!0)}),C.list.changRenderCameraInput.add((e,t)=>{if("height"==e)t=t.toString().replace("mm",""),C.renderViewCamera.position.y=t/1e3,C.renderViewControl.target.y=t/1e3;else{1*(t=t.toString().replace("\xb0",""))>=-5&&1*t<=5&&(t=0);let e=t*Math.PI/180;e>Math.PI/2&&(e=Math.PI/2),e<-Math.PI/2&&(e=-Math.PI/2);let n=C.getRenderCameraAngle();if(isNaN(n))return;n*=Math.PI/180,e-=n;var r=new i.Vector3;C.renderViewCamera.getWorldDirection(r);let o=-C.renderViewCamera.position.clone().distanceTo(r)*Math.sin(e);C.renderViewControl.target.y+=o}C.renderViewCamera.updateProjectionMatrix(),C.renderViewControl.update()})}}class E{constructor(e){e.list.deleteForMobile.add(t=>{e.execute(),(0,M.MobileMain).delMain(t)}),e.list.lockUnlockForMobile.add(t=>{if(0==e.clickSelect.length)return;let i=e.clickSelect,r=i.parent.modelType&&(i.parent.modelType.toLowerCase().indexOf("door")>-1||i.parent.modelType.toLowerCase().indexOf("window")>-1);r&&(i=i.parent);let n=Object.keys(t);n.forEach(e=>{i[e]=t[e]}),e.helperGroup.children.slice(0).forEach(t=>{"roomOuterLine"==t.name&&e.helperGroup.remove(t)}),"floor"==i.useType?(0,M.MobileMain).addRoomHelper(i):r?(0,M.MobileMain).addDoorHelper(i):(0,M.MobileMain).addWallHelper(i)}),e.list.changeRoomByInputForMobile.add(t=>{if(e.camera.isOrthographicCamera){if(t.roomWidth)(0,M.MobileMain).changeRoomLengthByFloor(1*t.roomWidth,"X");else if(t.roomHeight)(0,M.MobileMain).changeRoomLengthByFloor(1*t.roomHeight,"Y");else if(t.wallWidth)(0,M.MobileMain).changeRoomLengthByWall(1*t.wallWidth);else if(t.depth);else if(t.doorWidth||t.doorRightWidth||t.doorLeftWidth){let i=e.clickSelect.parent,r=Object.keys(t);e.execute(new S.DrawDoorCommand({currentDoor:i,valueType:r[0],value:1*t[r[0]]}))}}}),e.list.wallOperate.add(t=>{if(0!=e.clickSelect.length&&(e.execute(),"splitWall"==t.type)){let t=e.clickSelect,i=(0,M.MobileMain).getRoomByWall(t);if(!i){e.list.showToast.dispatch("只允许拆分围成房间的墙体","top");return}let r=i.room.spliteWall(t);e.wallGroup.add(r),e.helperGroup.children.slice(0).forEach(t=>{"roomOuterLine"==t.name&&e.helperGroup.remove(t)}),(0,M.MobileMain).addWallHelper(t),(0,M.MobileMain).updateLineDimensionsLine(),(0,M.MobileMain).update3dScene()}}),e.list.setWallParam.add(t=>{Object.keys(t).forEach(i=>{e.config.mobileConfig[i]=t[i]})}),e.list.switchCamera.add(t=>{let i=!0,r=0;if(e.list.showModelMsg.dispatch(""),e.list.switchCameraIcon.dispatch(t),"2D"==t){if(document.getElementsByClassName("Panel")[0].style.display="block",e.camera.isOrthographicCamera)return;e.camera=e.getOtherCamera(e.camera),e.floor.rotation.x==-Math.PI/2&&(e.floor.rotation.x=0),e.raycaster.layers.enable(0)}else(0,M.MobileMain).update3dScene(),r=1,i=!1,e.raycaster.layers.enable(2),e.camera=e.getOtherCamera(e.camera),0==e.floor.rotation.x&&(e.floor.rotation.x=-Math.PI/2),e.controlsArr[1].enablePan=!0,document.getElementsByClassName("Panel")[0].style.display="none";e.raycaster.layers.set(r),e.floor.layers.set(r),e.controlsArr[0].enabled=i,e.controlsArr[1].enabled=!i,e.viewportCamera=e.camera,e.camera.updateProjectionMatrix(),e.updateDom()}),e.list.cancelTool.add(()=>{e.toolType="free"}),e.list.setRoomName.add(t=>{if(0==e.clickSelect.length)return;e.execute(),e.helperGroup.children.slice(0).forEach(t=>{"roomOuterLine"==t.name&&e.helperGroup.remove(t)});let i=e.clickSelect,r=i.area.split("\n");i.room.roomName=t,i.area=t+"\n"+r[r.length-1],(0,M.MobileMain).addRoomHelper(e.clickSelect)}),e.list.orderOption.add(t=>{$.ajax({type:"GET",url:e.config.remoteUrl+"orderList.json",async:!0,cache:!0,dataType:"text",success:function(i,r){let n=JSON.parse(i),o=n.data,a=0,s=0,l=t.orderId;o.forEach(e=>{if(e.orderId==l){s=a;return}a++}),"del"==t.optionType&&o.splice(s,1),"rename"==t.optionType&&(o[s].orderName=t.orderName),n.data=o,e.saveAllOrder(n)},error:function(e){}})}),e.list.getFloorParam.add(()=>{let t=0;e.floorGroup2d.children.forEach(e=>{let i=e.area.split("\n");t+=1*(i.length>1?i[1]:i[0])});let i={storeyHei:window.storeyHei,storeyName:"未命名",area:Math.round(t)};e.list.sendFloorParam.dispatch(i)}),e.list.setFloorParam.add(e=>{"setFloorHei"==e.type&&(window.storeyHei=e.value)}),e.list.resetCameraForMobile.add(()=>{e.controlsArr[0].reset(),e.controlsArr[1].reset(),e.updateDom()})}}}),parcelRequire.register("djG6J",function(e,t){$parcel$export(e.exports,"SceneCore",()=>l);var i=parcelRequire("4xklQ"),r=parcelRequire("73HrS"),n=parcelRequire("hWloQ"),o=parcelRequire("6WmIx"),a=parcelRequire("c7cmF"),s=parcelRequire("3BPdS");parcelRequire("9HO6e");class l{static toolType="free";static dom="";constructor(e){this.editor=e,this.uiPanelBox="",this.scene="",this.camera="",this.renderer="",this.raycaster="",this.floor="",this.startPoint="",this.endPoint="",this.currenDraw="",this.helperGroup=new i.Group,this.labelRenderer="",this.chooseColor=new i.Color("#4169E1"),this.cancelChooseColor=new i.Color("#363636"),this.allMesh=[],this.allDrapMesh=[],this.curentChoose="",this.currentPoint="",this.downPoint=""}sceneInit(e){l.dom=e,this.uiPanelBox=new s.UIPanel,this.uiPanelBox.setWidth(window.innerWidth+"px"),this.uiPanelBox.setHeight(window.innerHeight+"px"),this.scene=new i.Scene,this.scene.background=new i.Color("#FFFFFF"),this.raycaster=new i.Raycaster,this.camera=new i.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,1e4),this.camera.position.set(0,0,1e4),this.camera.lookAt(this.scene.position);let t=new i.PlaneGeometry(2e5,2e5),r=new i.MeshStandardMaterial({color:16777215,roughness:1,metalness:0});this.floor=new i.Mesh(t,r),this.floor.material.opacity=0,this.floor.material.transparent=!0,this.scene.add(this.floor);let n=2e5,h=400,c=new i.GridHelper(n,h,255,1118481);c.material.opacity=.5,c.material.transparent=!0,c.rotation.x=-Math.PI/2,this.scene.add(c),this.scene.add(new i.HemisphereLight(8947831,7829384));let d=new i.DirectionalLight(16777215);d.position.set(0,6,0),this.scene.add(d);let u=new o.OrbitControls(this.camera,e);u.target.set(0,0,0),u.enableRotate=!1,u.minDistance=100,u.maxDistance=1e4,u.update(),this.renderer=new i.WebGLRenderer({antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.xr.enabled=!0,this.renderer.outputEncoding=i.sRGBEncoding,e.appendChild(this.renderer.domElement),e.parentNode.appendChild(this.uiPanelBox.dom),this.scene.add(this.helperGroup);let p=new a.DragControls(this.allDrapMesh,this.camera,e);return p.transformGroup=!0,p.addEventListener("drag",this.dragging.bind(this)),window.addEventListener("resize",this.onWindowResize),e.addEventListener("mousemove",this.mouseMove.bind(this)),e.addEventListener("mousedown",this.mouseDown.bind(this)),e.addEventListener("click",this.mouseClick.bind(this)),e.addEventListener("touchstart",this.onTouchStart.bind(this)),e.addEventListener("touchend",this.onTouchEnd.bind(this)),document.onkeydown=(function(e){switch(27==window.event.keyCode&&(l.toolType="free",this.editor.list.startPlayer.dispatch(),this.startPoint="",""!=this.currenDraw&&this.removeMesh(this.currenDraw),this.removeInputByClassName(this.uiPanelBox.dom,"moveInput"),this.removeInputByClassName(this.uiPanelBox.dom,"moveInput"),this.currenDraw),e.key.toLowerCase()){case"backspace":e.preventDefault();case"delete":let t=this.editor.selected;if(null===t)return;let i=t.parent;null!==i&&this.editor.execute(new RemoveObjectCommand(this.editor,t));break;case this.editor.config.getKey("settings/shortcuts/translate"):signals.transformModeChanged.dispatch("translate");break;case this.editor.config.getKey("settings/shortcuts/rotate"):signals.transformModeChanged.dispatch("rotate");break;case this.editor.config.getKey("settings/shortcuts/scale"):signals.transformModeChanged.dispatch("scale");break;case this.editor.config.getKey("settings/shortcuts/undo"):(this.editor.config.IS_MAC?e.metaKey:e.ctrlKey)&&(e.preventDefault(),this.editor.undo());break;case this.editor.config.getKey("settings/shortcuts/redo"):(this.editor.config.IS_MAC?e.metaKey:e.ctrlKey)&&(e.preventDefault(),this.editor.redo());break;case this.editor.config.getKey("settings/shortcuts/focus"):null!==this.editor.selected&&this.editor.focus(this.editor.selected)}}).bind(this),this}clearScene(e){for(var t=e.lastElementChild;t;)e.removeChild(t),t=e.lastElementChild}onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}dragging(e){if("controlPoint"==e.object.useType){let e=this.curentChoose.startPoint,t=this.curentChoose.endPoint,i=this.currentPoint;this.removeMesh(this.curentChoose);let o=new(0,r.WallCore)().createCurveWall(e,t,i),a=new(0,n.WallHelp)().createCurveHelp(e,t,o.controlPoint);this.allDrapMesh[0]=a.controlMesh,this.addMesh(o),a.wallId=o.id,this.helperGroup.add(a),this.curentChoose=o}}mouseDown(e){this.downPoint=this.getWorldPosition(e)}mouseMove(e){let t=new i.Vector3(0,0,0);t.x=e.clientX/window.innerWidth*2-1,t.y=-(2*(e.clientY/window.innerHeight))+1;let o=this.getWorldPosition(e);if(this.currentPoint=o,"free"!=l.toolType){if(!this.startPoint)return;if(""!=this.currenDraw&&this.removeMesh(this.currenDraw),this.editor.list.stopPlayer.dispatch(),"wall"==l.toolType){this.currenDraw=new(0,r.WallCore)().createLineWall(this.startPoint,o);let e=new(0,n.WallHelp)().drawWallHelp(this.startPoint,o);e.wallId=this.currenDraw.id,this.removeInputByClassName(this.uiPanelBox.dom,"moveInput");let t=this.getScreenPosition(e.arcCenter.clone()),i=new(0,s.UIInput)(e.realAngle).setClass("moveInput").setFontSize("15px").setWidth("40px").setMarginTop(t.y+"px").setMarginLeft(t.x+"px"),a=this.getScreenPosition(e.lineCenter.clone()),l=new(0,s.UIInput)(e.lineLength).setClass("moveInput").setFontSize("15px").setWidth("40px").setMarginTop(a.y+"px").setMarginLeft(a.x+"px");this.uiPanelBox.add(i),this.uiPanelBox.add(l),this.scene.add(this.currenDraw),this.helperGroup.add(e)}else"room"==l.toolType&&(this.currenDraw=new(0,r.RoomCore)().createRoom(this.startPoint,o),this.scene.add(this.currenDraw))}else{this.raycaster.setFromCamera(t,this.camera);for(let e=0;e<this.allMesh.length;e++)"wall"==this.allMesh[e].useType&&this.allMesh[e]!=this.curentChoose&&(this.allMesh[e].material.color=this.cancelChooseColor);l.dom.style.cursor="default";var a=this.raycaster.intersectObjects(this.allMesh);a.length>0&&"wall"==a[0].object.useType&&(a[0].object.material.color=this.chooseColor,l.dom.style.cursor="move")}}mouseClick(e){let t=this.getWorldPosition(e);if("free"!=l.toolType)this.startPoint?(this.endPoint=t,this.editor.list.startPlayer.dispatch(),"wall"==l.toolType?(this.currenDraw.material.color=this.cancelChooseColor,this.allMesh.push(this.currenDraw),this.removeInputByClassName(this.uiPanelBox.dom,"moveInput"),this.removeInputByClassName(this.uiPanelBox.dom,"moveInput"),this.removeMesh(this.currenDraw),this.editor.execute(new r.WallCore(this.editor,this.currenDraw),"画墙"),this.startPoint=t):"room"==l.toolType&&(this.removeMesh(this.currenDraw),this.editor.execute(new r.RoomCore(this.editor,this.currenDraw),"画房间"),this.startPoint=""),this.currenDraw=""):this.startPoint=t;else{let a=new i.Vector3(0,0,0);a.x=e.clientX/window.innerWidth*2-1,a.y=-(2*(e.clientY/window.innerHeight))+1,this.raycaster.setFromCamera(a,this.camera),l.dom.style.cursor="default";var o=this.raycaster.intersectObjects(this.allMesh);if(o.length>0){if("wall"==o[0].object.useType){o[0].object.material.color=this.chooseColor;let e=o[0].object.startPoint,t=o[0].object.endPoint;this.removeMesh(o[0].object),this.removeInputByClassName(this.uiPanelBox.dom,"showWallLength"+o[0].object.uuid);let i="";if(this.curentChoose){this.curentChoose.material.color=this.cancelChooseColor;for(let e=0;e<this.curentChoose.children.length;e++)"arcHelper"==this.curentChoose.children[e].useType&&this.curentChoose.remove(this.curentChoose.children[e])}if("lineWall"==o[0].object.wallType){i=new(0,r.WallCore)().createCurveWall(e,t);let o=new(0,n.WallHelp)().createCurveHelp(e,t,i.controlPoint);this.allDrapMesh[0]=o.controlMesh,this.addMesh(i),o.wallId=i.id,this.helperGroup.add(o)}else{i=new(0,r.WallCore)().createLineWall(e,t,!1);let o=new(0,n.WallHelp)().createLineDimensionsLine(e,t,!1),a=this.getScreenPosition(o.center.clone()),l=new(0,s.UIText)(o.lineLength).setClass("showWallLength"+i.uuid).setFontSize("15px").setWidth("20px").setMarginTop(a.y+"px").setMarginLeft(a.x+"px");this.uiPanelBox.add(l),o.wallId=i.id,this.helperGroup.add(o),this.addMesh(i)}i.material.color=this.chooseColor,this.curentChoose=i}}else{let e=this.downPoint.clone().distanceTo(t.clone());this.curentChoose&&"wall"==this.curentChoose.useType&&e<5&&(this.curentChoose.material.color=this.cancelChooseColor,this.removeHelperByWallId(this.curentChoose.id),this.curentChoose="")}}}onTouchStart(e){}onTouchEnd(e){}removeHelperByWallId(e){let t=this.helperGroup.children;for(let i=0;i<t.length;i++)t[i].wallId&&t[i].wallId==e&&this.helperGroup.remove(t[i])}createLastWall(e){let t=new(0,n.WallHelp)().createLineDimensionsLine(e.startPoint,e.endPoint,!1),i=this.getScreenPosition(t.center.clone()),r=new(0,s.UIText)(t.lineLength).setClass("showWallLength"+e.uuid).setFontSize("15px").setWidth("20px").setMarginTop(i.y+"px").setMarginLeft(i.x+"px");this.uiPanelBox.add(r),t.wallId=e.id,this.helperGroup.add(t),this.scene.add(e)}createRoom(e){this.scene.add(e)}removeMesh(e){this.allMesh.indexOf(e)>=0&&this.allMesh.splice(this.allMesh.indexOf(e),1),this.removeHelperByWallId(e.id),this.scene.remove(e),this.removeInputByClassName(this.uiPanelBox.dom,"showWallLength"+e.uuid)}addMesh(e){this.allMesh.push(e),this.scene.add(e)}removeInputByClassName(e,t){let i=e.children;for(let r=0;r<i.length;r++)i[r].className==t&&e.removeChild(i[r])}getWorldPosition(e){let t=new i.Vector3(0,0,0);t.x=e.clientX/window.innerWidth*2-1,t.y=-(2*(e.clientY/window.innerHeight))+1,this.raycaster.setFromCamera(t,this.camera);var r=this.raycaster.intersectObjects([this.floor]);let n=new i.Vector3(0,0,0);return r.length>0&&(n=r[0].point),n}getScreenPosition(e){e=e.project(this.camera);let t=window.innerWidth/2,i=window.innerHeight/2;return{x:Math.round(e.x*t+t)-22,y:Math.round(-e.y*i+i)-10}}getModelVertex(e){e.updateWorldMatrix(!0,!1);let t=e.geometry.attributes.position.array,r=new i.Vector3(t[0],t[1],0),n=new i.Vector3(t[6],t[7],0),o=new i.Vector3(t[9],t[10],0),a=new i.Vector3(t[3],t[4],0),s=new i.Vector3((r.x+n.x)/2,(r.y+n.y)/2,0),l=new i.Vector3((n.x+o.x)/2,(n.y+o.y)/2,0),h=new i.Vector3((r.x+a.x)/2,(r.y+a.y)/2,0),c=new i.Vector3((a.x+o.x)/2,(a.y+o.y)/2,0),d=[r,n,o,a,s,l,h,c];for(let t=0;t<d.length;t++)d[t]=e.localToWorld(d[t]);return d}animate(){this.renderer.setAnimationLoop(this.render.bind(this))}render(){this.renderer.render(this.scene,this.camera)}}}),parcelRequire.register("6WmIx",function(e,t){$parcel$export(e.exports,"OrbitControls",()=>a);var i=parcelRequire("4xklQ");let r={type:"change"},n={type:"start"},o={type:"end"};class a extends i.EventDispatcher{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new i.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:i.MOUSE.ROTATE,MIDDLE:i.MOUSE.DOLLY,RIGHT:i.MOUSE.PAN},this.touches={ONE:i.TOUCH.ROTATE,TWO:i.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",es),this._domElementKeyEvents=e},this.saveState=function(){a.target0.copy(a.target),a.position0.copy(a.object.position),a.zoom0=a.object.zoom},this.reset=function(){a.target.copy(a.target0),a.object.position.copy(a.position0),a.object.zoom=a.zoom0,a.object.updateProjectionMatrix(),a.dispatchEvent(r),a.update(),l=s.NONE},this.update=function(){let t=new i.Vector3,n=new(0,i.Quaternion)().setFromUnitVectors(e.up,new i.Vector3(0,1,0)),o=n.clone().invert(),f=new i.Vector3,g=new i.Quaternion,y=2*Math.PI;return function(){let e=a.object.position;t.copy(e).sub(a.target),t.applyQuaternion(n),c.setFromVector3(t),a.autoRotate&&l===s.NONE&&D(_()),a.enableDamping?(c.theta+=d.theta*a.dampingFactor,c.phi+=d.phi*a.dampingFactor):(c.theta+=d.theta,c.phi+=d.phi);let i=a.minAzimuthAngle,x=a.maxAzimuthAngle;return isFinite(i)&&isFinite(x)&&(i<-Math.PI?i+=y:i>Math.PI&&(i-=y),x<-Math.PI?x+=y:x>Math.PI&&(x-=y),i<=x?c.theta=Math.max(i,Math.min(x,c.theta)):c.theta=c.theta>(i+x)/2?Math.max(i,c.theta):Math.min(x,c.theta)),c.phi=Math.max(a.minPolarAngle,Math.min(a.maxPolarAngle,c.phi)),c.makeSafe(),c.radius*=u,c.radius=Math.max(a.minDistance,Math.min(a.maxDistance,c.radius)),!0===a.enableDamping?a.target.addScaledVector(p,a.dampingFactor):a.target.add(p),t.setFromSpherical(c),t.applyQuaternion(o),e.copy(a.target).add(t),a.object.lookAt(a.target),!0===a.enableDamping?(d.theta*=1-a.dampingFactor,d.phi*=1-a.dampingFactor,p.multiplyScalar(1-a.dampingFactor)):(d.set(0,0,0),p.set(0,0,0)),u=1,!!(m||f.distanceToSquared(a.object.position)>h||8*(1-g.dot(a.object.quaternion))>h)&&(a.dispatchEvent(r),f.copy(a.object.position),g.copy(a.object.quaternion),m=!1,!0)}}(),this.dispose=function(){a.domElement.removeEventListener("contextmenu",ec),a.domElement.removeEventListener("pointerdown",ee),a.domElement.removeEventListener("pointercancel",er),a.domElement.removeEventListener("wheel",ea),a.domElement.removeEventListener("pointermove",et),a.domElement.removeEventListener("pointerup",ei),null!==a._domElementKeyEvents&&a._domElementKeyEvents.removeEventListener("keydown",es)};let a=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},l=s.NONE,h=1e-6,c=new i.Spherical,d=new i.Spherical,u=1,p=new i.Vector3,m=!1,f=new i.Vector2,g=new i.Vector2,y=new i.Vector2,x=new i.Vector2,w=new i.Vector2,b=new i.Vector2,v=new i.Vector2,M=new i.Vector2,S=new i.Vector2,P=[],T={};function _(){return 2*Math.PI/60/60*a.autoRotateSpeed}function C(){return Math.pow(.95,a.zoomSpeed)}function D(e){d.theta-=e}function A(e){d.phi-=e}let E=function(){let e=new i.Vector3;return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),p.add(e)}}(),L=function(){let e=new i.Vector3;return function(t,i){!0===a.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(a.object.up,e)),e.multiplyScalar(t),p.add(e)}}(),I=function(){let e=new i.Vector3;return function(t,i){let r=a.domElement;if(a.object.isPerspectiveCamera){let n=a.object.position;e.copy(n).sub(a.target);let o=e.length();E(2*t*(o*=Math.tan(a.object.fov/2*Math.PI/180))/r.clientHeight,a.object.matrix),L(2*i*o/r.clientHeight,a.object.matrix)}else a.object.isOrthographicCamera?(E(t*(a.object.right-a.object.left)/a.object.zoom/r.clientWidth,a.object.matrix),L(i*(a.object.top-a.object.bottom)/a.object.zoom/r.clientHeight,a.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),a.enablePan=!1)}}();function R(e){a.object.isPerspectiveCamera?u/=e:a.object.isOrthographicCamera?(a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom*e)),a.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function W(e){a.object.isPerspectiveCamera?u*=e:a.object.isOrthographicCamera?(a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom/e)),a.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function V(e){f.set(e.clientX,e.clientY)}function k(e){v.set(e.clientX,e.clientY)}function B(e){x.set(e.clientX,e.clientY)}function O(e){g.set(e.clientX,e.clientY),y.subVectors(g,f).multiplyScalar(a.rotateSpeed);let t=a.domElement;D(2*Math.PI*y.x/t.clientHeight),A(2*Math.PI*y.y/t.clientHeight),f.copy(g),a.update()}function F(e){M.set(e.clientX,e.clientY),S.subVectors(M,v),S.y>0?R(C()):S.y<0&&W(C()),v.copy(M),a.update()}function z(e){w.set(e.clientX,e.clientY),b.subVectors(w,x).multiplyScalar(a.panSpeed),I(b.x,b.y),x.copy(w),a.update()}function U(e){e.deltaY<0?W(C()):e.deltaY>0&&R(C()),a.update()}function N(e){let t=!1;switch(e.code){case a.keys.UP:I(0,a.keyPanSpeed),t=!0;break;case a.keys.BOTTOM:I(0,-a.keyPanSpeed),t=!0;break;case a.keys.LEFT:I(a.keyPanSpeed,0),t=!0;break;case a.keys.RIGHT:I(-a.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),a.update())}function G(){if(1===P.length)f.set(P[0].pageX,P[0].pageY);else{let e=.5*(P[0].pageX+P[1].pageX),t=.5*(P[0].pageY+P[1].pageY);f.set(e,t)}}function H(){if(1===P.length)x.set(P[0].pageX,P[0].pageY);else{let e=.5*(P[0].pageX+P[1].pageX),t=.5*(P[0].pageY+P[1].pageY);x.set(e,t)}}function j(){let e=P[0].pageX-P[1].pageX,t=P[0].pageY-P[1].pageY,i=Math.sqrt(e*e+t*t);v.set(0,i)}function q(){a.enableZoom&&j(),a.enablePan&&H()}function X(){a.enableZoom&&j(),a.enableRotate&&G()}function Y(e){if(1==P.length)g.set(e.pageX,e.pageY);else{let t=em(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);g.set(i,r)}y.subVectors(g,f).multiplyScalar(a.rotateSpeed);let t=a.domElement;D(2*Math.PI*y.x/t.clientHeight),A(2*Math.PI*y.y/t.clientHeight),f.copy(g)}function J(e){if(1===P.length)w.set(e.pageX,e.pageY);else{let t=em(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);w.set(i,r)}b.subVectors(w,x).multiplyScalar(a.panSpeed),I(b.x,b.y),x.copy(w)}function Z(e){let t=em(e),i=e.pageX-t.x,r=e.pageY-t.y,n=Math.sqrt(i*i+r*r);M.set(0,n),S.set(0,Math.pow(M.y/v.y,a.zoomSpeed)),R(S.y),v.copy(M)}function Q(e){a.enableZoom&&Z(e),a.enablePan&&J(e)}function K(e){a.enableZoom&&Z(e),a.enableRotate&&Y(e)}function ee(e){!1!==a.enabled&&(0===P.length&&(a.domElement.setPointerCapture(e.pointerId),a.domElement.addEventListener("pointermove",et),a.domElement.addEventListener("pointerup",ei)),ed(e),"touch"===e.pointerType?el(e):en(e))}function et(e){!1!==a.enabled&&("touch"===e.pointerType?eh(e):eo(e))}function ei(e){eu(e),0===P.length&&(a.domElement.releasePointerCapture(e.pointerId),a.domElement.removeEventListener("pointermove",et),a.domElement.removeEventListener("pointerup",ei)),a.dispatchEvent(o),l=s.NONE}function er(e){eu(e)}function en(e){let t;switch(e.button){case 0:t=a.mouseButtons.LEFT;break;case 1:t=a.mouseButtons.MIDDLE;break;case 2:t=a.mouseButtons.RIGHT;break;default:t=-1}switch(t){case i.MOUSE.DOLLY:if(!1===a.enableZoom)return;k(e),l=s.DOLLY;break;case i.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===a.enablePan)return;B(e),l=s.PAN}else{if(!1===a.enableRotate)return;V(e),l=s.ROTATE}break;case i.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===a.enableRotate)return;V(e),l=s.ROTATE}else{if(!1===a.enablePan)return;B(e),l=s.PAN}break;default:l=s.NONE}l!==s.NONE&&a.dispatchEvent(n)}function eo(e){switch(l){case s.ROTATE:if(!1===a.enableRotate)return;O(e);break;case s.DOLLY:if(!1===a.enableZoom)return;F(e);break;case s.PAN:if(!1===a.enablePan)return;z(e)}}function ea(e){!1!==a.enabled&&!1!==a.enableZoom&&l===s.NONE&&(e.preventDefault(),a.dispatchEvent(n),U(e),a.dispatchEvent(o))}function es(e){!1!==a.enabled&&!1!==a.enablePan&&N(e)}function el(e){switch(ep(e),P.length){case 1:switch(a.touches.ONE){case i.TOUCH.ROTATE:if(!1===a.enableRotate)return;G(),l=s.TOUCH_ROTATE;break;case i.TOUCH.PAN:if(!1===a.enablePan)return;H(),l=s.TOUCH_PAN;break;default:l=s.NONE}break;case 2:switch(a.touches.TWO){case i.TOUCH.DOLLY_PAN:if(!1===a.enableZoom&&!1===a.enablePan)return;q(),l=s.TOUCH_DOLLY_PAN;break;case i.TOUCH.DOLLY_ROTATE:if(!1===a.enableZoom&&!1===a.enableRotate)return;X(),l=s.TOUCH_DOLLY_ROTATE;break;default:l=s.NONE}break;default:l=s.NONE}l!==s.NONE&&a.dispatchEvent(n)}function eh(e){switch(ep(e),l){case s.TOUCH_ROTATE:if(!1===a.enableRotate)return;Y(e),a.update();break;case s.TOUCH_PAN:if(!1===a.enablePan)return;J(e),a.update();break;case s.TOUCH_DOLLY_PAN:if(!1===a.enableZoom&&!1===a.enablePan)return;Q(e),a.update();break;case s.TOUCH_DOLLY_ROTATE:if(!1===a.enableZoom&&!1===a.enableRotate)return;K(e),a.update();break;default:l=s.NONE}}function ec(e){!1!==a.enabled&&e.preventDefault()}function ed(e){P.push(e)}function eu(e){delete T[e.pointerId];for(let t=0;t<P.length;t++)if(P[t].pointerId==e.pointerId){P.splice(t,1);return}}function ep(e){let t=T[e.pointerId];void 0===t&&(t=new i.Vector2,T[e.pointerId]=t),t.set(e.pageX,e.pageY)}function em(e){let t=e.pointerId===P[0].pointerId?P[1]:P[0];return T[t.pointerId]}a.domElement.addEventListener("contextmenu",ec),a.domElement.addEventListener("pointerdown",ee),a.domElement.addEventListener("pointercancel",er),a.domElement.addEventListener("wheel",ea,{passive:!1}),this.update()}}}),parcelRequire.register("c7cmF",function(e,t){$parcel$export(e.exports,"DragControls",()=>c);var i=parcelRequire("4xklQ");let r=new i.Plane,n=new i.Raycaster,o=new i.Vector2,a=new i.Vector3,s=new i.Vector3,l=new i.Vector3,h=new i.Matrix4;class c extends i.EventDispatcher{constructor(e,t,i){super(),i.style.touchAction="none";let c=null,d=null,u=[],p=this;function m(){i.addEventListener("pointermove",w),i.addEventListener("pointerdown",b),i.addEventListener("pointerup",v),i.addEventListener("pointerleave",v)}function f(){i.removeEventListener("pointermove",w),i.removeEventListener("pointerdown",b),i.removeEventListener("pointerup",v),i.removeEventListener("pointerleave",v),i.style.cursor=""}function g(){f()}function y(){return e}function x(){return n}function w(m){if(!1!==p.enabled){if(M(m),n.setFromCamera(o,t),c){n.ray.intersectPlane(r,s)&&c.position.copy(s.sub(a).applyMatrix4(h)),p.dispatchEvent({type:"drag",object:c});return}if("mouse"===m.pointerType||"pen"===m.pointerType){if(u.length=0,n.setFromCamera(o,t),n.intersectObjects(e,!0,u),u.length>0){let e=u[0].object;r.setFromNormalAndCoplanarPoint(t.getWorldDirection(r.normal),l.setFromMatrixPosition(e.matrixWorld)),d!==e&&null!==d&&(p.dispatchEvent({type:"hoveroff",object:d}),i.style.cursor="auto",d=null),d!==e&&(p.dispatchEvent({type:"hoveron",object:e}),i.style.cursor="pointer",d=e)}else null!==d&&(p.dispatchEvent({type:"hoveroff",object:d}),i.style.cursor="auto",d=null)}}}function b(d){!1!==p.enabled&&(M(d),u.length=0,n.setFromCamera(o,t),n.intersectObjects(e,!0,u),u.length>0&&(c=!0===p.transformGroup?e[0]:u[0].object,r.setFromNormalAndCoplanarPoint(t.getWorldDirection(r.normal),l.setFromMatrixPosition(c.matrixWorld)),n.ray.intersectPlane(r,s)&&(h.copy(c.parent.matrixWorld).invert(),a.copy(s).sub(l.setFromMatrixPosition(c.matrixWorld))),i.style.cursor="move",p.dispatchEvent({type:"dragstart",object:c})))}function v(){!1!==p.enabled&&(c&&(p.dispatchEvent({type:"dragend",object:c}),c=null),i.style.cursor=d?"pointer":"auto")}function M(e){let t=i.getBoundingClientRect();o.x=(e.clientX-t.left)/t.width*2-1,o.y=-(e.clientY-t.top)/t.height*2+1}m(),this.enabled=!0,this.transformGroup=!1,this.activate=m,this.deactivate=f,this.dispose=g,this.getObjects=y,this.getRaycaster=x}}}),parcelRequire.register("5tVpy",function(e,t){$parcel$export(e.exports,"History",()=>r);var i=parcelRequire("47Y2g");class r{constructor(e,t){this.editor=e,this.undos=[],this.undosJson=[],this.redos=[],this.redosJson=[],this.lastCmdTime=new Date,this.idCounter=0,this.deviceType=t,this.historyDisabled=!1,this.config=e.config;let i=this;this.editor.list.startPlayer.add(function(){i.historyDisabled=!1}),this.editor.list.stopPlayer.add(function(){i.historyDisabled=!0})}execute(e,t,r=""){let n=this.undos[this.undos.length-1],o=new Date().getTime()-this.lastCmdTime.getTime(),a=n&&n.updatable&&e.updatable&&n.object===e.object&&n.type===e.type&&n.script===e.script&&n.attributeName===e.attributeName;a&&"SetScriptValueCommand"===e.type?(n.update(e),e=n):a&&o<500?(n.update(e),e=n):(this.undos.push(e),0!=this.editor.statusJson.length?this.undosJson.push(JSON.stringify(this.editor.statusJson)):""!=r?this.undosJson.push(JSON.stringify(r)):"PC"==this.deviceType?this.undosJson.push(JSON.stringify(this.editor.getSceneAllJson())):this.undosJson.push(JSON.stringify((0,i.MobileMain).getAllJson())),""!=e&&(e.id=++this.idCounter)),""!=e&&(e.name=void 0!==t?t:e.name,e.execute(),e.inMemory=!0,this.config.getKey("settings/history")&&(e.json=e.toJSON())),this.lastCmdTime=new Date,this.redos=[],this.redosJson=[]}undo(){let e;if(this.historyDisabled)return;let t="";return this.undos.length>0&&(e=this.undos.pop(),t=this.undosJson.pop(),!1===e.inMemory&&e.fromJSON(e.json)),(void 0!==e||""==e)&&("PC"==this.deviceType?this.redosJson.push(JSON.stringify(this.editor.getSceneAllJson())):this.redosJson.push(JSON.stringify((0,i.MobileMain).getAllJson())),""==e?(this.editor.cacheJson=t,"PC"==this.deviceType?this.editor.readCache(t):(0,i.MobileMain).readCache(t)):e.undo(t),this.redos.push(e)),e}redo(){let e;if(this.historyDisabled)return;let t="";return this.redos.length>0&&(e=this.redos.pop(),t=this.redosJson.pop(),!1===e.inMemory&&e.fromJSON(e.json)),(void 0!==e||""==e)&&("PC"==this.deviceType?this.undosJson.push(JSON.stringify(this.editor.getSceneAllJson())):this.undosJson.push(JSON.stringify((0,i.MobileMain).getAllJson())),""==e?(this.editor.cacheJson=t,"PC"==this.deviceType?this.editor.readCache(t):(0,i.MobileMain).readCache(t)):e.redo(t),this.undos.push(e)),e}}}),parcelRequire.register("bX52j",function(e,t){$parcel$export(e.exports,"Config",()=>r);var i=parcelRequire("4xklQ");class r{constructor(){if(this.name="threejs-editor",this.centerArea=240,this.pointArea=240,this.drawDoorArea=500,this.doorWidth=750,this.angleToolChooseColor=new i.Color("rgb(26,122,248)"),this.angleToolUnChooseColor=new i.Color("rgb(153,193,244)"),this.drawDotMaterial=new i.LineDashedMaterial({color:0,depthTest:!1,dashSize:3,gapSize:3}),this.dotMaterial=new i.LineDashedMaterial({color:0,depthTest:!1,dashSize:30,gapSize:10}),this.boxColor="#396EFE",this.circleRadio=1500,this.boxLineWidth=3,this.boxLineColor=this.boxColor,this.wallNum=4,this.wallFirstMaterial=new i.MeshBasicMaterial({color:"#2D61A4",side:i.DoubleSide,transparent:!0,opacity:.8}),window.roomOpacity=.8,window.storeyHei=2800,window.floorDep=0,this.screenMoveArea=3,this.maxWidth=10,this.remoteUrl="https://rjhcdn.bsphpro.com/ocean/upload_data/uploads/",this.remoteCacheUrl="https://dev.rjhapi.bsphpro.com/ocean/upload",this.storage={language:"en",autosave:!0,"project/title":"","project/editable":!1,"project/vr":!1,"project/renderer/antialias":!0,"project/renderer/shadows":!0,"project/renderer/shadowType":1,"project/renderer/physicallyCorrectLights":!1,"project/renderer/toneMapping":0,"project/renderer/toneMappingExposure":1,"settings/history":!1,"settings/shortcuts/translate":"w","settings/shortcuts/rotate":"e","settings/shortcuts/scale":"r","settings/shortcuts/undo":"z","settings/shortcuts/redo":"y","settings/shortcuts/focus":"f"},this.mobileConfig={autoCompletion:!1,hvSwitch:!1},this.IS_MAC=navigator.platform.toUpperCase().indexOf("MAC")>=0,void 0===window.localStorage[this.name])window.localStorage[this.name]=JSON.stringify(this.storage);else{let e=JSON.parse(window.localStorage[this.name]);for(let t in e)this.storage[t]=e[t]}this.inputColor={windowLeft:"#A5A0F8",windowRight:"#91CDF9",windowCenter:"#FF8484"},this.toolTypeConfig={doubledoor:"doubledoor",door:"door",slidingdoor:"slidingdoor",window:"window",straightBayWindow:"baywindow",frenchwindows:"frenchwindows",doubledoor:"singleDoubleDoor",childMotherDoor:"childMotherDoor",passDoor:"pass",straightBayWindow:"straightBayWindow",LWindow:"LWindow",LBayWindow:"",UWindow:"UWindow",UBayWindow:"",dooropen:"dooropen",archDoor:"archDoor",archWindow:"archWindow",arcDoor:"",arcWindow:"arcWindow",beam:"bridge",pillars:"post",flue:"flue"},this.settingJson={roomName:!0,roomArea:!0,dimension:!0,showMember:!0,showFloorFurniture:!0,showWallFurniture:!0,showCeilFurniture:!0,showKitchen:!0,showAllHouseFurniture:!0},this.modelTypeJson={doubledoor:"双开门",door:"单开门",slidingdoor:"移门",window:"窗",straightBayWindow:"飘窗",frenchwindows:"落地窗",childMotherDoor:"字母门",passDoor:"垭口",LWindow:"L型窗",UWindow:"U型窗",dooropen:"门洞",archDoor:"拱形门",archWindow:"拱形窗",arcWindow:"弧形窗"};let e=Date.now();this.settingJsonCopy=JSON.parse(JSON.stringify(this.settingJson)),this.baseDoorFrame=new(0,i.TextureLoader)().load(window.url+"/assets/images/material/frame.jpg?"+e),this.baseDoorFace=new(0,i.TextureLoader)().load(window.url+"/assets/images/material/doorFace.jpg?"+e),this.slidingDoorframe=new(0,i.TextureLoader)().load(window.url+"/assets/images/material/sliddoorframe.jpg?"+e),this.slidingDoorFace=new(0,i.TextureLoader)().load(window.url+"/assets/images/material/sliddoorFace.jpg?"+e),this.lashDoorPartition=new(0,i.TextureLoader)().load(window.url+"/assets/images/material/zimudoorcrack.jpg?"+e),this.baseWindowFrame=new(0,i.TextureLoader)().load(window.url+"/assets/images/material/windowframe.jpg?"+e),this.baseWindowFace=new(0,i.TextureLoader)().load(window.url+"/assets/images/material/windowFace.jpg?"+e),this.passMeshTexture=new(0,i.TextureLoader)().load(window.url+"/assets/images/material/material01.jpg?"+e),this.sectorDoorTexture=new(0,i.TextureLoader)().load(window.url+"/assets/images/material/material02.jpg?"+e),this.marbleTexture=new(0,i.TextureLoader)().load(window.url+"/assets/images/material/marble.jpg?"+e),this.uvGridTexture=new(0,i.TextureLoader)().load(window.url+"/assets/images/banner/uvGrid.jpg?"+e),this.floorTexture=new(0,i.TextureLoader)().load(window.url+"/assets/images/banner/floor.jpg?"+e)}getKey(e){return this.storage[e]}setKey(){for(let e=0,t=arguments.length;e<t;e+=2)storage[arguments[e]]=arguments[e+1];window.localStorage[name]=JSON.stringify(storage)}clear(){delete window.localStorage[name]}}}),parcelRequire.register("2dMww",function(e,t){$parcel$export(e.exports,"ViewPort",()=>w);var i=parcelRequire("4xklQ"),r=parcelRequire("eiQg5");parcelRequire("5c6ha"),parcelRequire("g0ihB");var n=parcelRequire("73HrS"),o=parcelRequire("9HO6e"),a=parcelRequire("9QhXH"),s=parcelRequire("gLad4"),l=parcelRequire("1o48A"),h=parcelRequire("bIuaB"),c=parcelRequire("kS8hL"),d=parcelRequire("iQ5za"),u=parcelRequire("03OZ0");parcelRequire("lcWY1");var p=parcelRequire("fuGJl"),m=parcelRequire("RhAiw"),f=parcelRequire("hWloQ"),g=parcelRequire("15Luk"),y=parcelRequire("dVRrd"),x=parcelRequire("47Y2g");class w{static toolType="free";constructor(e,t,n,o){this.stats=new c.default,"PC"!=n&&document.body.appendChild(this.stats.dom),this.stats.dom.setAttribute("class","stats"),this.stats.dom.style.top=window.innerHeight-48+"px",e.deviceType=n,"PC"==n?e.storageName="sceneData":e.storageName="mobileSceneData",this.container=t,this.renderer=null,this.editor=e,this.editor.orderId=this.editor.getOrderId(),this.transformControls=new h.TransformControls(this.editor.camera,this.container),this.controls=new r.OrbitControls(this.editor.camera,this.container,e),this.editor.globalControl=this.controls,this.controls.target.set(0,0,0),this.controls.enableRotate=!1;let a=this.editor.getOtherCamera(this.editor.camera);this.controls3D=new r.OrbitControls(a,this.container,this.editor),this.controls3DRoam="",this.editor.controlsArr=[this.controls,this.controls3D],this.grid=new i.Group,this.editor.grid=this.grid,this.grid.name="2dGrid",this.grid3D=new i.Group,this.grid3D.name="3dGrid",this.editor.grid3d=this.grid3D,this.grid.rotation.x=-Math.PI/2,this.editor.createGrid(),this.editor.scene.add(this.grid),this.editor.scene.add(this.grid3D);let s=new i.PlaneGeometry(2e5,2e5),l=new i.MeshStandardMaterial({color:16777215,roughness:1,metalness:0,transparent:!0,opacity:0});this.editor.floor=new i.Mesh(s,l),this.editor.floor.name="auxiliaryFloor",this.editor.scene.add(this.editor.floor),new i.AxesHelper(500).layers.set(1),this.createRenderer();var p=new i.SphereGeometry(.1,8,8);let m=new i.PointLight(10394523,1,100);m.add(new i.Mesh(p,new i.MeshBasicMaterial({color:16711680}))),m.position.set(0,70,0),m.layers.enableAll(),this.editor.scene.add(m);let f=new i.AmbientLight(10394523);if(f.intensity=1,f.layers.enableAll(),f.position.set(0,0,800),this.editor.scene.add(f),e.list.viewportCameraChanged.add(this.viewportCameraChanged.bind(this)),window.addEventListener("resize",this.onWindowResize.bind(this)),window.addEventListener("beforeunload",(function(e){this.editor.uiPanelBox.dom.remove()}).bind(this)),"PC"==n)e.list.removeAll.dispatch("noSave",!1),this.editor.camera.updateProjectionMatrix(),window.addEventListener("mousewheel",this.onMousewheel.bind(this),!0),document.onkeydown=this.onkeydown.bind(this),document.onkeyup=this.onkeyup.bind(this),t.addEventListener("mousedown",this.onMouseDown.bind(this)),t.addEventListener("mouseup",this.onMouseUp.bind(this)),t.addEventListener("mousemove",this.mouseMove.bind(this)),t.addEventListener("touchstart",this.onTouchStart.bind(this)),t.addEventListener("touchmove",this.onTouchMove.bind(this)),t.addEventListener("touchend",this.onTouchEnd.bind(this)),t.addEventListener("dblclick",this.onDoubleClick.bind(this)),t.addEventListener("click",this.mouseClick.bind(this)),t.addEventListener("contextmenu",this.oncontextmenu.bind(this),!0);else{e.list.removeAll.dispatch("noSave",!1),this.editor.camera.position.set(0,0,1e3),this.editor.camera.lookAt(new i.Vector3(0,0,0)),this.editor.camera.updateProjectionMatrix(),t.addEventListener("touchstart",(0,y.MobileListener).onTouchStart.bind(this)),t.addEventListener("touchmove",(0,y.MobileListener).onTouchMove.bind(this)),t.addEventListener("touchend",(0,y.MobileListener).onTouchEnd.bind(this)),t.addEventListener("wheel",(0,y.MobileListener).onMouseWheel.bind(this)),this.controls.enablePan=!0,this.controls.touches.ONE=1,this.onWindowResize();let r=new(0,i.Matrix4)().makeScale(.001,.001,.001);1==this.editor.wallGroup3D.scale.x&&(this.editor.wallGroup3D.applyMatrix4(r),this.editor.lineGroup3D.applyMatrix4(r),this.editor.memberGroup3D.applyMatrix4(r),this.editor.floorGroup.applyMatrix4(r)),this.editor.list.switchCamera.dispatch("2D")}if(document.getElementsByClassName("Panel")[0].style.display="none",this.editor.miniDom=document.getElementById("scrollviewcontent"),this.editor.initMiniMap(),this.selectionBox2D=new d.SelectionBox(this.editor.camera,this.editor.scene),this.currentSelectionBoxHelper=new u.SelectionHelper(this.editor.renderer,"selectBox_choose",t),this.selectionBox3D=new d.SelectionBox(a,this.editor.scene),this.currentSelectionBox=this.selectionBox2D,window.autoSave=setInterval(()=>{this.editor.saveSceneJson()},3e4),this.editor.list.setDefaultParams.dispatch({roomOpacity:100*window.roomOpacity,storeyHei:window.storeyHei,floorDep:window.floorDep}),this.editor.list.getVersionNumber.dispatch(g.version),localStorage.getItem("RJH_WEB_userId")?this.editor.userId=localStorage.getItem("RJH_WEB_userId"):(this.editor.userId=this.editor.getOrderId(),localStorage.setItem("RJH_WEB_userId",this.editor.userId)),"create"==o){document.getElementsByClassName("Panel")[0].style.display="block",this.editor.currentCacheJson={},this.editor.saveSceneJson();return}if(o){let e=JSON.parse(o),t=e.sceneJson;this.editor.currentCacheJson=t,this.editor.cacheJson=o,this.editor.orderId=e.orderId,"PC"==n?lastJson.version&&this.editor.readCache(JSON.stringify(t)):((0,x.MobileMain).readCache(JSON.stringify(t)),this.editor.updateDom()),this.editor.saveSceneJson(),document.getElementsByClassName("Panel")[0].style.display="block";return}let w=localStorage.getItem(e.storageName);w?w.indexOf("version")>=0?(this.editor.cacheJson=w,this.editor.readCache(w)):$.ajax({type:"GET",url:this.editor.config.remoteUrl+w,async:!0,cache:!0,dataType:"text",success:function(t,i){let r=(t=JSON.parse(t)).sceneJson;e.currentCacheJson=t.sceneJson,e.cacheJson=JSON.stringify(r),"PC"==n?(r.version&&e.readCache(JSON.stringify(r)),document.getElementsByClassName("Panel")[0].style.display="block"):(e.orderId=t.orderId,document.getElementsByClassName("Panel")[0].style.display="block",r.version||(0,x.MobileMain).readCache(JSON.stringify(r)))},error:function(e){404==e.status&&localStorage.removeItem(this.storageName),document.getElementsByClassName("Panel")[0].style.display="block"}}):document.getElementsByClassName("Panel")[0].style.display="block"}dispose(){this.stats.dom.remove(),window.autoSave&&clearInterval(window.autoSave);let e=this.container;"PC"==this.deviceType?(window.removeEventListener("mousewheel",this.onMousewheel),document.removeEventListener("onkeydown",this.onkeydown),document.removeEventListener("onkeyup",this.onkeyup),e.removeEventListener("mousedown",this.onMouseDown),e.removeEventListener("mouseup",this.onMouseUp),e.removeEventListener("mousemove",this.mouseMove),e.removeEventListener("touchstart",this.onTouchStart),e.removeEventListener("touchmove",this.onTouchMove),e.removeEventListener("touchend",this.onTouchEnd),e.removeEventListener("dblclick",this.onDoubleClick),e.removeEventListener("click",this.mouseClick),e.removeEventListener("contextmenu",this.oncontextmenu)):(e.removeEventListener("touchstart",y.MobileListener.onTouchStart),e.removeEventListener("touchmove",y.MobileListener.onTouchMove),e.removeEventListener("touchend",y.MobileListener.onTouchEnd),e.removeEventListener("wheel",y.MobileListener.onMouseWheel))}createRenderer(){let e=new i.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});e.shadowMap.enabled=!0,e.shadowMap.type=i.PCFSoftShadowMap,e.setPixelRatio(window.devicePixelRatio),e.setSize(window.innerWidth,window.innerHeight),e.xr.enabled=!0,e.outputEncoding=i.sRGBEncoding,e.setClearColor(15264748),this.renderer=e,this.editor.renderer=e,this.container.appendChild(this.renderer.domElement),this.container.parentNode.appendChild(this.editor.uiPanelBox.dom),this.animate()}cameraChanged(){this.render()}animate(){this.renderer.setAnimationLoop(this.render.bind(this))}render(){m.update(),this.renderer.render(this.editor.scene,this.editor.viewportCamera),this.editor.newRenderer.render(this.editor.scene,this.editor.miniMapCamera),this.editor.cameraRenderer.render(this.editor.cameraScene,this.editor.pngCamera),this.editor.miniMapObj&&this.editor.miniMapObj.updateMapMan(),""!=this.controls3DRoam&&"3DRoam"==this.editor.viewportCamera.sceneModel&&this.controls3DRoam.animate(),this.stats.update(),this.editor.roamTool&&(this.editor.roamTool.needUpdate(),this.editor.roamTool.mmRenderer.render(this.editor.scene,this.editor.roamTool.mmCamera))}viewportCameraChanged(e,t=!0){this.editor.transform3DTool&&"ThreeDimensionMoveHelper"==this.editor.transform3DTool.name&&this.editor.transform3DTool.removeEventListener();let o=e.viewportCamera;this.editor.camera=o;let a=new n.WallCore(e);if(this.editor.baseRender&&($("#loading").remove(),$(".lil-gui.autoPlace").hide(),$(this.editor.dom).empty(),this.editor.dom.appendChild(this.renderer.domElement),this.editor.baseRender=!1,$("#sampele").remove(),this.render()),o.isOrthographicCamera){this.currentSelectionBox=this.selectionBox2D;let e=window.innerWidth/window.innerHeight,i=-5e3;this.editor.camera.left=i*e,this.editor.camera.right=-i*e,this.editor.camera.top=-i,this.editor.camera.bottom=i,this.controls.enabled=!0,""!=this.controls3D&&(this.controls3D.enabled=!1),this.editor.floor.rotation.x==-Math.PI/2&&(this.editor.floor.rotation.x=0),this.editor.globalControl=this.controls,this.editor.raycaster.layers.set(0),this.editor.floor.layers.set(0),this.editor.raycaster.layers.enable(0),t&&a.wallToJson()}else{if(this.currentSelectionBox=this.selectionBox3D,this.controls.enabled=!1,this.editor.raycaster.layers.set(1),this.editor.floor.layers.set(1),this.editor.raycaster.layers.enable(2),""!=this.controls3D&&(this.controls3D.enabled=!1),""!=this.controls3DRoam&&(this.controls3DRoam.enabled=!1),this.editor.camera.aspect=window.innerWidth/window.innerHeight,"3DRoam"==o.sceneModel){if(this.editor.roamTool);else{if(this.editor.roomList[0].length>0){let e=this.editor.roomList[0],t=this.editor.roomList[1],r=Math.max.apply(null,t),n=e[t.indexOf(r)];this.editor.camera.position.set(n[0]/1e3,.15,-n[1]/1e3),this.editor.camera.lookAt(new i.Vector3(0,.15,1))}this.editor.roamTool=new p.Roaming(this)}this.editor.globalControl=""}else""!=this.controls3D?this.controls3D.enabled=!0:this.controls3D=new r.OrbitControls(o,this.container,this.editor),this.editor.globalControl=this.controls3D;0==this.editor.floor.rotation.x&&(this.editor.floor.rotation.x=-Math.PI/2),t&&a.wallToJson("3D")}this.editor.list.hiddenDialog.dispatch(),this.editor.camera.updateProjectionMatrix(),this.render()}onMousewheel(e){this.editor.camera.isOrthographicCamera&&this.editor.updateDom()}onkeydown(e){if(!this.editor.sceneActive)return;if(this.editor.baseRender){this.editor.baseRender.onkeydown(e);return}let t=window.event.keyCode;if(74==e.keyCode||"j"==e.key.toLowerCase()||83==e.keyCode&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)){if(e.preventDefault(),this.editor.saveSceneJson(),"j"==e.key.toLowerCase()){var i=JSON.stringify(this.editor.getSceneAllJson()),r=new Blob([i],{type:"text/plain"}),n=document.createElement("a");n.style.display="none",n.href=URL.createObjectURL(r),n.download="rjh_test_"+Date.parse(new Date)+".json",n.click()}return}if(this.editor.roamTool&&this.editor.roamTool.onKeyDown(e),1*e.key.toLowerCase()!=2&&(this.editor.camera.oldRotDir="",this.editor.camera.cameraRotDir=""),32==t){if(e.preventDefault(),this.editor.clickSelect.length>0){let e=this.editor.getOuterParent(this.editor.clickSelect[0].object);if(e&&("3DModel"==e.modelType||"2DModel"==e.modelType||"2dModelGroup"==e.modelType||"modelGroup"==e.modelType)&&!this.editor.mouseCoverObj){if(("2DModel"==e.modelType||"2dModelGroup"==e.modelType)&&(e=e.param[0]),e.isLock)return;e.rotation.y<=0&&(e.rotation.y+=2*Math.PI),e.rotation.y-=Math.PI/180*45,this.editor.synchroModel(e),this.editor.updateModel(e),new(0,l.Model3DHelper)(this.editor).selectObj([e]);return}}this.editor.list.resetCamera.dispatch();return}switch(e.key.toLowerCase()){case"backspace":break;case"delete":if(""==this.editor.clickSelect||""==this.editor.clickSelect[0].object)return;let o=this.editor.clickSelect[0].object;if(!o)return;if(this.editor.list.resetproperty.dispatch({roomOpacity:100*window.roomOpacity,storeyHei:window.storeyHei,floorDep:window.floorDep}),"wall"==o.useType)this.editor.list.delWall.dispatch();else if("splitRoom"==o.useType||"splitFloor"==o.useType||"splitCeil"==o.useType)this.editor.list.delSplitLine.dispatch();else if("dragPoint"==o.useType)this.editor.delCommonPoint(o.parent.center);else{let e=o.parent,t=["beam","flue","pillars"];if(e&&t.indexOf(e.modelType)>=0)this.editor.list.delMember.dispatch();else if("2DModel"==o.modelType)this.editor.list.delModel.dispatch();else{let e=this.editor.getOuterParent(o);"3DModel"==e.modelType||"modelGroup"==e.modelType?this.editor.list.delModel.dispatch():"CodeModel"==e.modelType?(this.editor.list.change3DDoor.dispatch(["del"]),this.editor.list.hiddenDialog.dispatch()):this.editor.list.delDoor.dispatch()}}break;case this.editor.config.getKey("settings/shortcuts/undo"):(this.editor.config.IS_MAC?e.metaKey:e.ctrlKey)&&(e.preventDefault(),this.editor.undo());break;case this.editor.config.getKey("settings/shortcuts/redo"):(this.editor.config.IS_MAC?e.metaKey:e.ctrlKey)&&(e.preventDefault(),this.editor.redo());break;case this.editor.config.getKey("settings/shortcuts/focus"):null!==this.editor.selected&&this.editor.focus(this.editor.selected);break;case"escape":"3dRomaCamera"==this.editor.camera.name&&this.editor.list.exitRomaScene.dispatch(),this.editor.exitTool();break;case"w":case"a":case"s":case"d":case"q":case"e":this.editor.moveCurrentCamera(e.key.toLowerCase());break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"0":case"+":case"-":case"*":case"/":if(this.editor.camera.isOrthographicCamera||"body"!=e.target.localName)return;this.editor.setCurrentCamera(e.key.toLowerCase())}}onkeyup(e){this.editor.roamTool&&this.editor.roamTool.onKeyUp(e)}mouseMove(e){if(this.editor.baseRender)return;if(e.shiftKey&&(this.currentSelectionBox.endPoint.set(e.clientX/window.innerWidth*2-1,-(2*(e.clientY/window.innerHeight))+1,.5),this.currentSelectionBox.select()),this.editor.sceneActive=!0,this.editor.currentPoint=this.editor.getWorldPosition(e),this.editor.currentMoveSelect=[],this.editor.menuSwitch||(this.editor.currentMoveSelect=this.getObject(e)),"grab"!=this.editor.dom.style.cursor&&(this.editor.dom.style.cursor="default"),("wall"==this.editor.toolType||"room"==this.editor.toolType||"splitTool"==this.editor.toolType)&&(this.editor.dom.style.cursor="crosshair"),this.editor.copyFloorMaterial){let e=this.editor.getScreenPosition(this.editor.currentPoint.clone());this.editor.list.blackBox.dispatch(e.x,e.y,"点击应用到该房间")}if("free"!=this.editor.toolType)"wall"==this.editor.toolType||"room"==this.editor.toolType||"splitTool"==this.editor.toolType?(this.editor.orthogonalModel&&""!=this.editor.startPoint&&(this.editor.currentPoint=(0,o.UtilCore).handleOrthogonalPoint(this.editor.startPoint,this.editor.currentPoint)),this.editor.currentPoint=(0,o.UtilCore).handleSpecialPoint(this.editor.currentPoint.clone(),this.editor.specialPointArr,this.editor),""!=this.editor.startPoint&&(this.editor.endPoint=this.editor.currentPoint,this.editor.list.executeTool.dispatch("moveDraw"))):this.editor.list.executeTool.dispatch("moveDraw");else{if(this.controls3D.enablePan=!0,this.controls3D.enableRotate=!0,!this.editor.camera.isOrthographicCamera&&this.editor.currentDownSelect.length>0){let e=this.editor.getOuterParent(this.editor.currentDownSelect[0].object);e.modelType&&(e.modelType.indexOf("Model")>=0||e.modelType.indexOf("model")>=0)&&this.editor.clickSelect.length>0&&this.editor.currentDownSelect.length>0&&this.editor.getOuterParent(this.editor.currentDownSelect[0].object).uuid==this.editor.getOuterParent(this.editor.clickSelect[0].object).uuid&&(this.controls3D.enableRotate=!1)}!this.editor.camera.isOrthographicCamera&&0==this.editor.currentDownSelect.length&&this.editor.mouseCoverObj&&(this.controls3D.enableRotate=!1),this.editor.otherMeshs.concat(this.editor.otherMember).forEach(e=>{e.children.forEach(e=>{("Line"==e.type||"Line2"==e.type||"DWHelper"==e.type)&&e.material.color.equals(this.editor.moveDoorColor)&&!e.material.color.equals(this.editor.clickColor)&&(e.material.color=this.editor.moveDoorOutColor)})}),this.editor.splitRoomLineGroup.children.slice(0).forEach(e=>{"splitOuterLine"==e.useType&&this.editor.splitRoomLineGroup.remove(e)});let e="";if(this.editor.splitRoomLine.children.slice(0).forEach(t=>{let i=(0,o.UtilCore).smallDistanceByPointOnLine((0,o.UtilCore).handleLineData(t.startPoint,t.endPoint),this.editor.currentPoint.clone());(0,o.UtilCore).pointIsInLine(i,t.startPoint,t.endPoint)&&100>(0,o.UtilCore).toVector2(this.editor.currentPoint).distanceTo(i.clone())&&(e=t)}),""!=e){let t=(0,a.DM).createLine([e.startPoint,e.endPoint],"#00EEFF",!1,3);t.useType="splitOuterLine",this.editor.splitRoomLineGroup.add(t),this.editor.currentMoveSelect=[{object:e}]}if(""!=this.editor.downPoint){let e=this.editor.currentPoint.clone().distanceTo(this.editor.downPoint.clone()),t=40;if(this.editor.camera.isOrthographicCamera||(t/=1e3),e<t)return}this.editor.list.executeTool.dispatch("moveFree")}let t=!0,r=!1;if(this.editor.currentMoveSelect.length>0){let e=this.editor.currentMoveSelect[0].object,i=e.parent,n=["beam","flue","pillars"],o=i&&i.modelType&&(i.modelType.includes("Door")||i.modelType.includes("door")||i.modelType.includes("window")||i.modelType.includes("Window")||n.indexOf(i.modelType)>=0),a="2DModel"==this.editor.getOuterParent(e).modelType||"2dModelGroup"==this.editor.getOuterParent(e).modelType;t=a||o,o&&i.children.forEach(e=>{("Line"==e.type||"Line2"==e.type||"DWHelper"==e.type)&&e.material.color.equals(this.editor.clickColor)&&(r=!0)}),a&&this.editor.clickSelect.length>0&&e.uuid==this.editor.clickSelect[0].object.uuid&&(r=!0)}this.editor.currentMoveSelect.length>0&&"floor"==this.editor.currentMoveSelect[0].object.useType&&(t=!0),!t||r&&t?(this.controls.mouseButtons={LEFT:i.MOUSE.LEFT,RIGHT:i.MOUSE.PAN,MIDDLE:i.MOUSE.PAN},this.controls.touches={ONE:-1}):(e.shiftKey&&(this.controls3D.enableRotate=!1,this.controls3D.enablePan=!1),this.controls.mouseButtons={LEFT:i.MOUSE.PAN,RIGHT:i.MOUSE.PAN,MIDDLE:i.MOUSE.PAN},this.controls3D.mouseButtons.MIDDLE=i.MOUSE.PAN,this.controls.touches={ONE:i.TOUCH.PAN})}mouseClick(e){if(this.editor.baseRender)return;this.editor.splitRoomLineGroup.children=[];let t=!0,r=this.editor.downEvent,n=e,h=Math.abs(r.screenX-n.screenX)<this.editor.config.screenMoveArea&&Math.abs(r.screenY-n.screenY)<this.editor.config.screenMoveArea;if(!h&&"free"==this.editor.toolType&&this.controls.mouseButtons.LEFT==i.MOUSE.PAN){let e=this.editor.clickSelect;e&&e.length>0&&"CodeModel"==this.editor.getOuterParent(e[0].object).modelType&&this.editor.add3DDoorDialog(e[0].object),this.editor.currentDownSelect=[];return}if(h||"wall"!=this.editor.toolType&&"splitTool"!=this.editor.toolType&&"room"!=this.editor.toolType||""==this.editor.startPoint){if(h&&(this.editor.list.hiddenDialog.dispatch(),this.editor.list.closeReplaceView.dispatch(),this.editor.camera.isOrthographicCamera&&this.editor.changAllInputToText()),this.editor.pointHelperGroup.children.slice(0).forEach(e=>{"clickPoint"==e.useType&&e.parent.remove(e)}),""!=this.editor.mouseCoverObj&&this.editor.execute(new s.PreventObj(this.editor),"放置模型"),"free"!=this.editor.toolType){let t=this.editor.currentPoint.clone();(e.clientX||0!=e.changedTouches.length)&&(t=this.editor.getWorldPosition(e)),"wall"==this.editor.toolType||"splitTool"==this.editor.toolType?(t=(0,o.UtilCore).handleSpecialPoint(this.editor.currentPoint.clone(),this.editor.specialPointArr,this.editor),this.editor.allLinkWallByStartPoint=[],""==this.editor.startPoint?(this.editor.startPoint=t,this.editor.allLinkWallByStartPoint=(0,o.UtilCore).havePointWall(t,this.editor.allWalls)):(this.editor.endPoint=t,this.editor.statusJson=this.editor.getSceneAllJson(),this.editor.list.executeTool.dispatch("sureDraw"),this.editor.allLinkWallByStartPoint=(0,o.UtilCore).havePointWall(t,this.editor.allWalls),this.editor.startPoint=t,this.editor.currenDraw="",this.editor.specialPointArr=(0,o.UtilCore).getAllSpecialPoint(this.editor),"free"==this.editor.toolType&&(this.editor.startPoint=""))):"room"==this.editor.toolType?(t=(0,o.UtilCore).handleSpecialPoint(this.editor.currentPoint.clone(),this.editor.specialPointArr,this.editor),""==this.editor.startPoint?this.editor.startPoint=t:(this.editor.endPoint=t,this.editor.statusJson=this.editor.getSceneAllJson(),(0,o.UtilCore).toVector3(this.editor.startPoint.clone()).distanceTo((0,o.UtilCore).toVector3(t.clone()))>40&&this.editor.list.executeTool.dispatch("sureDraw"),this.editor.startPoint="",this.editor.currenDraw="",this.editor.specialPointArr=(0,o.UtilCore).getAllSpecialPoint(this.editor))):this.editor.list.executeTool.dispatch("sureDraw")}else{let r=this.getObject(e);if(r.length>0){if(this.editor.transform3DTool&&"ThreeDimensionMoveHelper"==this.editor.transform3DTool.name&&this.editor.transform3DTool.removeEventListener(),e.shiftKey||e.ctrlKey){let e=r[0].object;this.editor.selectObjArr.indexOf(e)>=0?this.editor.selectObjArr.splice(this.editor.selectObjArr.indexOf(e),1):this.editor.selectObjArr.push(r[0].object)}else this.editor.selectObjArr=[r[0].object];if(this.editor.camera.isOrthographicCamera){this.editor.clickSelect.length>0&&""!=this.editor.clickSelect[0].object&&"wall"==this.editor.clickSelect[0].object.useType&&(this.editor.clickSelect[0].object.material.color=this.editor.getWallColor(this.editor.clickSelect[0].object));let e=this.editor.clickSelect;this.editor.clickSelect=r;let n="";this.editor.currentDownSelect[0].object.parent&&(n=this.editor.currentDownSelect[0].object.parent.currentModel),n&&(this.editor.clickSelect[0].object=n);let s="";if(this.editor.splitRoomLine.children.slice(0).forEach(e=>{let t=(0,o.UtilCore).smallDistanceByPointOnLine((0,o.UtilCore).handleLineData(e.startPoint,e.endPoint),this.editor.currentPoint.clone());(0,o.UtilCore).pointIsInLine(t,e.startPoint,e.endPoint)&&100>(0,o.UtilCore).toVector2(this.editor.currentPoint).distanceTo(t.clone())&&(s=e)}),""!=s){let e=(0,a.DM).createLine([s.startPoint,s.endPoint],"#00EEFF",!1,3);e.useType="splitCheckLine",this.editor.splitRoomLineGroup.add(e),this.editor.clickSelect=[{object:s}]}let h=this.editor.clickSelect[0].object.useType;if((0,o.UtilCore).updateLineDimensionsLine(this.editor),"wall"==h){if(this.editor.currentDownSelect[0].object.parent&&this.editor.currentDownSelect[0].object.parent.uuid==this.editor.clickSelect[0].object.parent.uuid){this.editor.doorHelperGroupClean(),this.editor.clickSelect[0].object.material.color=this.editor.clickColor;let e=this.editor.clickSelect[0].object;e.children=[];let t=this.editor.getDialogPosition("","",this.editor.currentPoint.clone()),i=Math.round(e.startPoint.clone().distanceTo(e.endPoint.clone())),r=(0,o.UtilCore).havePointWall(e.startPoint,this.editor.allWalls),n=(0,o.UtilCore).havePointWall(e.endPoint,this.editor.allWalls),a=r.length>1,s=n.length>1;this.editor.changTextToInput(e);let l=(0,o.UtilCore).getLinkRealWall(r,e.startPoint,e.endPoint),h=(0,o.UtilCore).getLinkRealWall(n,e.endPoint,e.startPoint);l.forEach(t=>{this.editor.changTextToInput(t,e.startPoint,l,h,r,n)}),h.forEach(t=>{this.editor.changTextToInput(t,e.endPoint,h,l,n,r)}),this.editor.list.showDialog.dispatch(0,"wall",t,[i,e.thickness,a,s,e.style,e.height]),"bezier"==e.isArc&&this.editor.addBSRWallHelper(e)}else this.editor.clickSelect=e}else if("scaleRuleTool"==h||"scaleHelpTool"==h);else if("rotateTool"==h||"scalePoint"==h);else if("bseControl"==h);else if("splitRoom"==h||"splitFloor"==h||"splitCeil"==h);else if("floor"==h){if(this.editor.currentDownSelect[0].object.uuid==this.editor.clickSelect[0].object.uuid){this.editor.doorHelperGroupClean();let e=this.editor.clickSelect[0].object;editor.copyFloorMaterial&&(this.editor.execute(),e.material=editor.copyFloorMaterial);for(let t=0;t<e.allPoints.length;t++){let i=e.allPoints[t],r=e.allPoints[0];t!=e.allPoints.length-1&&(r=e.allPoints[t+1]);let n=(0,a.DM).createLine([i,r],"#00EEFF",!1,2.5);n.useType="splitCheckLine",this.editor.splitRoomLineGroup.add(n)}let t=this.editor.getDialogPosition("","",this.editor.currentPoint.clone());this.editor.list.showDialog.dispatch(3,"地面",t,[this.editor.clickSelect[0].object.roomName])}else this.editor.clickSelect=e}else if("dragPoint"==h){let e=this.editor.clickSelect[0].object,t=new(0,f.WallHelp)().createDoorOuterPoint(e.parent.center,2*e.parent.radio,"rgb(26, 122, 251)");t.useType="clickPoint",this.editor.pointHelperGroup.add(t)}else if("2DModel"==this.editor.clickSelect[0].object.modelType){this.editor.doorHelperGroupClean();let e=this.editor.getOuterParent(this.editor.clickSelect[0].object);if(!e.visible)return;let r=this.editor.getDialogPosition("","",this.editor.currentPoint.clone()),n=this.editor.clickSelect[0].object,o=this.editor.getOuterParent(n,n,"outer");if(this.editor.clickDepthMsg.uuid&&this.editor.clickDepthMsg.uuid==o.uuid&&(t=!1),this.editor.modelHelperGroup.children=[],this.editor.selectObjArr.length>1){let e=!1;this.editor.selectObjArr.forEach(t=>{let i=this.editor.getOuterParent(t);this.editor.addBoxFor2dGroup(i);let r=this.editor.get3DModelBy2DModel(i);this.editor.addBoxForGroup(r),e=i.isLock}),this.editor.list.showDialog.dispatch(9,"2d软装多选",r,[{isLock:e}])}else{let t=this.editor.get3DModelBy2DModel(e);if("Line2"==t.type&&this.editor.model3D.children.forEach(e=>{e.uuid==t.modelUUID&&(t=e)}),"Line2"==t.type)return;if(e.isLock){this.editor.addPositionHelper(e,!0),this.editor.addBoxFor2dGroup(e);let i=this.editor.wallHelp.addOBBbox(t,this.editor.config.boxColor);i.name="modelBox",i.layers.set(2),this.editor.modelHelperGroup.add(i)}else{let e={};this.editor.clickDepthMsg.uuid&&(e=this.editor.clickDepthMsg,this.editor.clickDepthMsg={uuid:o.param[0].uuid,depth:1,model:o.param[0]}),new(0,l.Model3DHelper)(this.editor).selectObj([t]),this.editor.clickDepthMsg=e}let r=this.editor.getDialogPosition("","",this.editor.currentPoint.clone()),n=t,a=this.editor.getRealSize(n),s=1e3*a[0].toFixed(3),h=1e3*a[1].toFixed(3),c=1e3*a[2].toFixed(3),d=1e3*n.width.toFixed(3),u=1e3*n.height.toFixed(3),p=1e3*n.depth.toFixed(3),m=new i.Vector3(0,n.position.y,0);n.parent.localToWorld(m);let f=1e3*(m.y-a[1]/2).toFixed(3),g=0;if("top"==n.modelPosition){let e=window.storeyHei;this.editor.wallGroup3D.roomHeight,(g=1e3*(e/1e3-n.height).toFixed(3))<10&&(g=0)}f<10&&(f=0);let y=360-Math.abs(parseInt(180/Math.PI*n.rotation.x)),x=parseInt(180/Math.PI*n.rotation.y),w=360-Math.abs(parseInt(180/Math.PI*n.rotation.z));x<0&&(x+=360),360==y&&(y=0),360==x&&(x=0),360==w&&(w=0);let b={isLock:e.isLock,width:s,height:h,depth:c,oldWidth:d,oldHeight:u,oldDepth:p,floorHei:f,rotation:[y,w,x],oldFloorHei:g};"2dModelGroup"==e.modelType?this.editor.list.showDialog.dispatch(14,"组合模型",r,[b]):("{}"!=JSON.stringify(this.editor.clickDepthMsg)&&(b.isGroupChild=!0),this.editor.list.showDialog.dispatch(8,"单品模型",r,[b]))}}else{let e=this.editor.clickSelect[0].object.parent,t=e;this.editor.cleanWallHelper(),this.editor.doorHelperGroupClean();let i=["beam","flue","pillars"];if(t&&this.editor.changeClickColor(t),i.indexOf(t.modelType)>=0){t.isLock?this.editor.addPositionHelper(e,!0):this.editor.addLineHelperForMember(e);let i=40,r=(0,o.UtilCore).toVector3(t.position.clone()).project(this.editor.camera),n=window.innerWidth/2,a=window.innerHeight/2,s=[Math.round(r.x*n+n),Math.round(-r.y*a+a)];s[0]+=i,s[1]-=2*i;let l=Math.round(180/Math.PI*t.rotation.z);l<0&&(l=360+l);let h=[Math.round(t.width*t.scale.x),Math.round(t.height*t.scale.y),Math.round(t.depth*t.scale.z),l,{isLock:t.isLock}],c=4;"flue"==t.modelType&&(c=5),"pillars"==t.modelType&&(c=6),this.editor.list.showDialog.dispatch(c,t.modelType,s,h)}else if(t.startPoint){this.editor.addLineHelperForDoor(e,!0);let i=Math.abs(Math.round(t.doorWid*t.scale.x)),r=this.editor.getDialogPosition("","",this.editor.currentPoint.clone()),n=t.modelType,o=this.editor.getWallByWallId(t.wallId),a=this.editor.config.modelTypeJson[t.modelType];n&&(n.includes("Door")||n.includes("door")?this.editor.list.showDialog.dispatch(2,a,r,[i,t.height,Math.round(t.wallDep),t.floorHei,o.height,{isLock:t.isLock}]):(n.includes("Window")||n.includes("window"))&&this.editor.list.showDialog.dispatch(1,a,r,[i,t.height,Math.round(t.wallDep),t.floorHei,o.height,{isLock:t.isLock}]),e.wallId&&(this.editor.currentDoor=e))}}}else if(this.editor.clickSelect=r,"CodeModel"==this.editor.getOuterParent(r[0].object).modelType)this.editor.add3DDoorDialog(r[0].object);else if("3dMember"==r[0].object.parent.name){let e=this.editor.get3DModelDialogPosition(r[0].object,30),t=4;this.editor.modelHelperGroup.children=[],this.editor.addBoxForGroup(r[0].object);let i=r[0].object.twoD;"flue"==i.modelType&&(t=5),"pillars"==i.modelType&&(t=6);let n=Math.round(180/Math.PI*i.rotation.z);n<0&&(n=360+n);let o=[Math.round(i.width*i.scale.x),Math.round(i.height*i.scale.y),Math.round(i.depth*i.scale.z),n,{isLock:i.isLock}];this.editor.list.showDialog.dispatch(t,r[0].object.modelType,e,o)}else if("3dwall"==r[0].object.parent.name)this.editor.modelHelperGroup.children=[];else{let e=this.editor.getOuterParent(r[0].object,r[0].object,"outer");if(!e.visible)return;this.editor.clickDepthMsg.uuid&&this.editor.clickDepthMsg.uuid==e.uuid&&(t=!1),h&&new(0,l.Model3DHelper)(this.editor).selectObj(this.editor.selectObjArr)}}else if(h){this.editor.otherMeshs.concat(this.editor.otherMember).forEach(e=>{e.children.forEach(e=>{("Line"==e.type||"Line2"==e.type||"DWHelper"==e.type)&&(e.material.color=this.editor.moveDoorOutColor)})}),this.editor.camera.isOrthographicCamera&&(this.editor.switchHelperGroup("show"),this.editor.clickSelect.length>0&&""!=this.editor.clickSelect[0].object&&"wall"==this.editor.clickSelect[0].object.useType&&(this.editor.clickSelect[0].object.material.color=this.editor.getWallColor(this.editor.clickSelect[0].object)),(0,o.UtilCore).updateLineDimensionsLine(this.editor)),this.editor.removeBSRHelper(),this.editor.selectObjArr=[],this.editor.list.hiddenDialog.dispatch(),this.editor.list.resetproperty.dispatch({roomOpacity:100*window.roomOpacity,storeyHei:window.storeyHei,floorDep:window.floorDep}),this.editor.currentDoor="",0==this.editor.currentDownSelect.length&&this.editor.doorHelperGroupClean(),this.editor.modelHelperGroup.children=[],this.editor.clickSelect=[],this.editor.destroy3DModelHelper();let e="";if(this.editor.splitRoomLine.children.slice(0).forEach(t=>{let i=(0,o.UtilCore).smallDistanceByPointOnLine((0,o.UtilCore).handleLineData(t.startPoint,t.endPoint),this.editor.currentPoint.clone());(0,o.UtilCore).pointIsInLine(i,t.startPoint,t.endPoint)&&100>(0,o.UtilCore).toVector2(this.editor.currentPoint).distanceTo(i.clone())&&(e=t)}),""!=e){let t=(0,a.DM).createLine([e.startPoint,e.endPoint],"#00EEFF",!1,3);t.useType="splitCheckLine",this.editor.splitRoomLineGroup.add(t),this.editor.clickSelect=[{object:e}]}this.editor.copyFloorMaterial=""}}t&&this.editor.clickDepthMsg.uuid&&h&&this.exitModelHierarchy(),this.editor.downPoint="",this.editor.currentDownSelect="",this.editor.statusJson=[]}}exitModelHierarchy(){this.editor.modelDotGroup.children=[],this.editor.clickDepthMsg={}}oncontextmenu(e){this.editor.clickSelect.length>0&&""!=this.editor.clickSelect[0].object&&"floor"!=this.editor.clickSelect[0].object.useType&&this.editor.updateDialogPosition(this.editor.clickSelect[0].object);let t=this.editor.downEvent,i=e;Math.abs(t.screenX-i.screenX)<this.editor.config.screenMoveArea&&Math.abs(t.screenY-i.screenY)<this.editor.config.screenMoveArea&&this.editor.exitTool(!0,!1)}onMouseDown(e){if(!this.editor.baseRender){if(this.editor.downEvent=e,2==e.button||1==e.button){this.editor.menuSwitch=!0;return}if(e.shiftKey&&this.currentSelectionBox.startPoint.set(e.clientX/window.innerWidth*2-1,-(2*(e.clientY/window.innerHeight))+1,.5),this.editor.statusJson=this.editor.getSceneAllJson(),this.editor.currentDownSelect=this.getObject(e),0==this.editor.currentDownSelect.length&&("default"==this.editor.dom.style.cursor||""==this.editor.dom.style.cursor)&&(this.editor.dom.style.cursor="grab"),this.editor.startChooseWall=this.getObject(e),this.editor.specialPointArr=(0,o.UtilCore).getAllSpecialPoint(this.editor),this.editor.currentDownSelect.length>0){let e=this.editor.currentDownSelect[0].object;if("wall"==e.useType)this.editor.moveStartPosition=e.position.clone();else{let e=this.editor.currentDownSelect[0].object;"Line2"==e.type&&e.parent.currentModel&&(this.editor.currentDownSelect[0].object=e.parent.currentModel);let t=this.editor.currentDownSelect[0].object.parent,r=this.editor.currentDownSelect[0].object;(r=this.editor.getOuterParent(r)).modelType&&r.modelType.indexOf("Model")>=0&&(t=r),this.editor._scaleStart=new i.Vector3().copy(t.scale),this.editor._offsetStart=new i.Vector3().copy(t.position),t.currentModel&&(this.editor._scaleStart=new i.Vector3().copy(t.currentModel.parent.scale),this.editor._offsetStart=new i.Vector3().copy(t.currentModel.parent.position)),t.wallId&&(this.editor.currentDoor=t)}}else this.editor.menuSwitch=!0;this.editor.downPoint=this.editor.getWorldPosition(e)}}onMouseUp(e){if(this.editor.baseRender)return;e.shiftKey&&(this.currentSelectionBox.endPoint.set(e.clientX/window.innerWidth*2-1,-(2*(e.clientY/window.innerHeight))+1,.5),this.currentSelectionBox.select()),e.preventDefault();let t=this.editor.downEvent,i=e;this.controls3D.enableRotate&&!this.editor.camera.isOrthographicCamera&&(this.editor.mouseCoverObj=""),this.editor.mouseCoverObj&&this.editor.execute(new s.PreventObj(this.editor),"放置模型");let r=this.editor.getWorldPosition(e);"free"==this.editor.toolType&&this.editor.downPoint&&r.clone().distanceTo(this.editor.downPoint.clone())>40&&this.editor.list.executeTool.dispatch("moveMesh"),this.editor.blackbox&&this.editor.blackbox.removeDom(),this.editor.blackbox="",this.editor.statusJson=[],this.editor.startChooseWall="",this.editor.menuSwitch=!1,"wall"!=this.editor.toolType&&"room"!=this.editor.toolType&&(this.editor.dom.style.cursor="default");let n=i.screenX-t.screenX,o=i.screenY-t.screenY;this.editor.list.updateDialog.dispatch(n,o)}onTouchStart(e){e.preventDefault(),this.editor.currentPoint=this.editor.getWorldPosition(e),""!=this.editor.touchStart&&(0,o.UtilCore).isSameVector(this.editor.touchStart,this.editor.currentPoint)?(this.editor.touchStart="",this.editor.exitTool()):this.editor.touchStart=this.editor.currentPoint,this.onMouseDown(e)}onTouchMove(e){this.mouseMove(e)}onTouchEnd(e){e.preventDefault(),this.onMouseUp(e),this.mouseClick(e)}onDoubleClick(e){if(!this.editor.baseRender&&this.editor.selectObjArr.length>0){let e=this.editor.selectObjArr[0],t=this.editor.getOuterParent(e);if("modelGroup"==t.modelType)this.editor.modelHelperGroup.children=[],this.editor.addDashBoxForGroup(t),this.editor.doorHelperGroupClean(),this.editor.clickDepthMsg={uuid:t.uuid,depth:1,model:t},this.editor.clickSelect[0].object=e,new(0,l.Model3DHelper)(this.editor).selectObj([e]),this.editor.addDashBoxFor2dGroup(t.param[0]);else if("2dModelGroup"==t.modelType){if(this.editor.modelHelperGroup.children=[],this.editor.addDashBoxForGroup(t.param[0]),this.editor.doorHelperGroupClean(),e.isLock){this.editor.addPositionHelper(e,!0),this.editor.addBoxFor2dGroup(e);let t=this.editor.wallHelp.addOBBbox(e.param[0],this.editor.config.boxColor);t.name="modelBox",t.layers.set(2),this.editor.modelHelperGroup.add(t)}else this.editor.clickDepthMsg={uuid:t.param[0].uuid,depth:1,model:t},new(0,l.Model3DHelper)(this.editor).selectObj([e.param[0].children[0]]),this.editor.addLineHelperForMember(e);this.editor.addDashBoxFor2dGroup(t),this.editor.clickDepthMsg={uuid:t.uuid,depth:1,model:t},this.editor.clickSelect[0].object=e;let r=this.editor.getDialogPosition("","",this.editor.currentPoint.clone());t=e;let n=this.editor.getRealSize(t),o=t.param[0],a=1e3*n[0].toFixed(3),s=1e3*n[1].toFixed(3),h=1e3*n[2].toFixed(3),c=1e3*o.width.toFixed(3),d=1e3*o.height.toFixed(3),u=1e3*o.depth.toFixed(3),p=new i.Vector3(0,o.position.y,0);o.parent.localToWorld(p);let m=1e3*(p.y-n[1]/2).toFixed(3),f=0;if("top"==o.modelPosition){let e=window.storeyHei;this.editor.wallGroup3D.roomHeight,(f=1e3*(e/1e3-o.height).toFixed(3))<10&&(f=0)}m<10&&(m=0);let g=360-Math.abs(parseInt(180/Math.PI*t.rotation.x)),y=360-Math.abs(parseInt(180/Math.PI*t.rotation.y)),x=360-Math.abs(parseInt(180/Math.PI*t.rotation.z));360==g&&(g=0),360==y&&(y=0),360==x&&(x=0);let w={isLock:t.isLock,width:a,height:s,depth:h,oldWidth:c,oldHeight:d,oldDepth:u,floorHei:m,rotation:[g,y,x],oldFloorHei:f};"2dModelGroup"==e.modelType?this.editor.list.showDialog.dispatch(10,"2d软装",r,[w]):(w.isGroupChild=!0,this.editor.list.showDialog.dispatch(8,"2d软装",r,[w]))}}}getObject(e){e.clientX||0==e.clientX?(this.editor.mouse.x=e.clientX/window.innerWidth*2-1,this.editor.mouse.y=-(2*(e.clientY/window.innerHeight))+1):(this.editor.mouse.x=e.changedTouches[0].pageX/window.innerWidth*2-1,this.editor.mouse.y=-(2*(e.changedTouches[0].pageY/window.innerHeight))+1),this.editor.raycaster.setFromCamera(this.editor.mouse,this.editor.camera);let t=this.editor.pointHelperGroup.children.concat(this.editor.otherMeshs);return t=(t=(t=(t=(t=(t=(t=t.concat(this.editor.allWalls)).concat(this.editor.otherMember)).concat(this.editor.wallGroup3D.children)).concat(this.editor.model3D.children)).concat(this.editor.model2D.children)).concat(this.editor.floorGroup2d.children)).concat(this.editor.memberGroup3D.children),this.editor.raycaster.intersectObjects(t,!0)}onWindowResize(){if(this.editor.camera.isOrthographicCamera){let e=window.innerWidth/window.innerHeight,t=-5e3;this.editor.camera.left=t*e,this.editor.camera.right=-t*e,this.editor.camera.top=-t,this.editor.camera.bottom=t}else this.editor.camera.aspect=window.innerWidth/window.innerHeight;this.editor.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}}}),parcelRequire.register("g0ihB",function(e,t){var i=parcelRequire("4xklQ"),r={inTouch:!1,rd:!1,md:!1,inZoom:!1,firstPosition:new i.Vector2(0,0),disVec2:0,disVec2_first:0,XcountOffset:0,YcountOffset:0,ZcountOffset:0,ctrlCamera:"",Init:function(e){e.removeEventListener("mousedown",r.OnForbidden,!1),e.removeEventListener("mouseup",r.OnForbidden,!1),e.removeEventListener("mousemove",r.OnForbidden,!1),e.removeEventListener("mouseout",r.OnForbidden,!1),e.removeEventListener("mousewheel",r.OnForbidden,!1),e.removeEventListener("touchstart",r.OnForbidden,!1),e.removeEventListener("touchmove",r.OnForbidden,!1),e.removeEventListener("touchend",r.OnForbidden,!1),e.addEventListener("mousedown",r.onCanvasMouseDown,!1),e.addEventListener("mouseup",r.onCanvasMouseUp,!1),e.addEventListener("mousemove",r.onCanvasMouseMove,!1),e.addEventListener("mouseout",r.onCanvasMouseOut,!1),e.addEventListener("mousewheel",r.OnMousewheel,!1),e.addEventListener("touchstart",r.OnTouchStart,!1),e.addEventListener("touchmove",r.OnTouchMove,!1),e.addEventListener("touchend",r.OnTouchEnd,!1),e.addEventListener("contextmenu",r.oncontextmenu.bind(this),!0)},oncontextmenu:function(e){e.preventDefault(),r.rd=!1},SetCtrlCamera:function(e){r.ctrlCamera=e},OnMousewheel:function(e){e.preventDefault(),r.ZcountOffset+=-(.1*e.wheelDelta),r.UpdateCamera()},OnForbidden:function(e){e.preventDefault()},onCanvasMouseDown:function(e){e.preventDefault(),r.ctrlCamera&&(2==e.button&&(r.rd=!0),1==e.button&&(r.md=!0),r.ctrlCamera.countXBegin=57.3*r.ctrlCamera.cameraRotX.rotation.x,r.ctrlCamera.countYBegin=57.3*r.ctrlCamera.cameraRotY.rotation.y,r.XcountOffset=0,r.YcountOffset=0,r.firstPosition=new i.Vector2(e.clientX,e.clientY),r.inTouch=!0,r.UpdateCamera())},onCanvasMouseUp:function(e){e.preventDefault(),r.inTouch=!1,r.md=!1,r.UpdateCamera()},onCanvasMouseMove:function(e){e.preventDefault(),r.inTouch&&(r.XcountOffset=r.firstPosition.x-e.clientX,r.YcountOffset=r.firstPosition.y-e.clientY),r.UpdateCamera()},onCanvasMouseOut:function(e){r.UpdateCamera()},OnTouchStart:function(e){e.preventDefault(),r.ctrlCamera&&(r.inTouch=!0,r.ctrlCamera.countXBegin=57.3*r.ctrlCamera.cameraRotX.rotation.x,r.ctrlCamera.countYBegin=57.3*r.ctrlCamera.cameraRotY.rotation.y,2==e.targetTouches.length?(r.ZcountOffset=0,r.disVec2=new i.Vector2(e.targetTouches[0].clientX-e.targetTouches[1].clientX,e.targetTouches[0].clientY-e.targetTouches[1].clientY),r.disVec2_first=r.disVec2.length(),r.ctrlCamera.countZBegin=r.ctrlCamera.Zcount):r.inZoom=!1,r.XcountOffset=0,r.YcountOffset=0,r.firstPosition.x=e.targetTouches[0].clientX,r.firstPosition.y=e.targetTouches[0].clientY,r.UpdateCamera())},OnTouchMove:function(e){if(e.preventDefault(),r.ctrlCamera){if(r.inTouch=!0,1!=e.targetTouches.length||r.inZoom){if(2==e.targetTouches.length){r.inZoom=!0,r.ctrlCamera.countXBegin=57.3*r.ctrlCamera.cameraRotX.rotation.x,r.ctrlCamera.countYBegin=57.3*r.ctrlCamera.cameraRotY.rotation.y;var t=new i.Vector2(e.targetTouches[0].clientX-e.targetTouches[1].clientX,e.targetTouches[0].clientY-e.targetTouches[1].clientY);r.ZcountOffset=(r.disVec2_first-t.length())*5}}else r.XcountOffset=r.firstPosition.x-e.targetTouches[0].clientX,r.YcountOffset=r.firstPosition.y-e.targetTouches[0].clientY;r.UpdateCamera()}},OnTouchEnd:function(e){e.preventDefault(),r.inTouch=!1,r.UpdateCamera(),r.ctrlCamera.maximumZ<.01&&(r.ctrlCamera.Xcount=0)},UpdateCamera:function(){r.ctrlCamera&&r.ctrlCamera.setUpdateState(r.XcountOffset,r.YcountOffset,r.ZcountOffset)}},n={walkingSpeed:.25,cameraName:"",compass:"",zhiBeiZhenCorrect:0,sommthFactor:.08,countXBegin:0,countYBegin:0,countZBegin:0,Xcount:0,Ycount:0,Zcount:0,Xsmooth:0,Ysmooth:0,Zsmooth:0,minimumX:0,maximumX:0,minimumZ:0,maximumZ:1e3,camera:"",camBase:"",cameraRotX:"",cameraRotY:"",defaultXcount:0,defaultYcount:0,defaultZcount:0,defaultPosX:0,defaultPosY:0,defaultPosZ:0,posX:0,posY:0,posZ:0,smoothPosX:0,smoothPosY:0,smoothPosZ:0,Init:function(e){n.viewport=e,n.camera=n.viewport.editor.camera,n.camBase=new i.Object3D,n.cameraRotX=new i.Object3D,n.cameraRotY=new i.Object3D,n.camBase.name="camBase",n.cameraRotX.name="cameraRotX",n.cameraRotY.name="cameraRotY",n.cameraRotX.add(n.camera),n.cameraRotY.add(n.cameraRotX),n.camBase.add(n.cameraRotY);var t=new i.BufferGeometry,r=new Float32Array([-1,-1,1,1,-1,1,1,1,1,1,1,1,-1,1,1,-1,-1,1]),o=new Float32Array([0,0,1,0,1,1,1,1,0,1,0,0]);t.setAttribute("position",new i.BufferAttribute(r,3)),t.setAttribute("uv",new i.BufferAttribute(o,2));var a=new i.MeshBasicMaterial({color:16777215});a.depthWrite=!1,a.depthFunc=i.AlwaysDepth,a.transparent=!0;var s=new i.Mesh(t,a);n.compass=s,n.compass.scale.x=.15,n.compass.scale.y=.15,n.compass.scale.z=.15,n.compass.position.x=-1,n.compass.position.y=.9,n.compass.position.z=-2,n.compass.renderOrder=1e4,n.camera.add(n.compass),n.compass.visible=!1},SetInitStates:function(e,t,i,r){n.camera.aspect=e,n.camera.fov=t,n.camera.near=i,n.camera.far=r,n.camera.updateProjectionMatrix()},SetupCameraCtrl:function(e,t){n.RecordDefaultState(e[0],e[1],e[2],-e[3],-e[4],e[5]),n.SetCameraPos(e[0],e[1],e[2]),console.log(),n.minimumX=e[9],n.maximumX=e[10],n.minimumZ=e[11],n.maximumZ=e[12],n.zhiBeiZhenCorrect=e[13],n.camBase.updateMatrix(),n.ResetCameraState(t),n.Zcount+=.01,r.ctrlCamera&&r.ctrlCamera.NeedUpdate()&&console.log("aaa")},RecordDefaultState:function(e,t,i,r,o,a){n.defaultPosX=e,n.defaultPosY=t,n.defaultPosZ=i,n.defaultXcount=r,n.defaultYcount=n.ModiferYCount(n.Ycount,o),n.defaultZcount=a},SetCameraPos:function(e,t,i){""!==e&&(n.posX=Number(e)),""!==t&&(n.posY=Number(t),n.camBase.position.y=n.posY),""!==i&&(n.posZ=Number(i))},ModiferYCount:function(e,t){var i,r=e%360,n=t%360;return n<0&&(n+=360),r<0&&(r+=360),r>n?(r-n>180&&(n+=360),i=e+n-r):(r-n<-180&&(r+=360),i=e-(r-n)),i},SetCameraXYZcount:function(e,t,i){""!=e&&(n.Xcount=-Number(e),n.countXBegin=n.Xcount),""!=t&&(n.Ycount=n.ModiferYCount(n.Ycount,-Number(t)),n.countYBegin=n.Ycount),""!=i&&(n.Zcount=Number(i),n.countZBegin=n.Zcount),r.XcountOffset=0,r.YcountOffset=0,r.ZcountOffset=0},SetCameraStates:function(e){n.SetCameraPos(e[0],e[1],e[2]),n.SetCameraXYZcount(e[3],e[4],e[5])},ResetCameraState:function(e){n.countXBegin=n.defaultXcount,n.countYBegin=n.defaultYcount,n.countZBegin=n.defaultZcount,n.Xcount=n.defaultXcount,n.Ycount=n.defaultYcount,n.Zcount=n.defaultZcount,n.posX=n.defaultPosX,n.posY=n.defaultPosY,n.posZ=n.defaultPosZ,r.XcountOffset=0,r.YcountOffset=0,r.ZcountOffset=0,e&&(n.Xsmooth=n.Xcount,n.Ysmooth=n.Ycount,n.Zsmooth=n.Zcount,n.smoothPosX=n.defaultPosX,n.smoothPosY=n.defaultPosY,n.smoothPosZ=n.defaultPosZ)},setUpdateState:function(e,t,i){n.Xcount=n.countXBegin+.5*t*.1,n.Ycount=n.countYBegin+.5*e*.1,n.Zcount=n.countZBegin+.1*i*.1},NeedUpdate:function(){if(n.Xcount=i.MathUtils.clamp(n.Xcount,-n.maximumX,-n.minimumX),n.Zcount=i.MathUtils.clamp(n.Zcount,n.minimumZ,n.maximumZ),n.Xsmooth=n.Xsmooth*(1-n.sommthFactor)+n.Xcount*n.sommthFactor,n.Ysmooth=n.Ysmooth*(1-n.sommthFactor)+n.Ycount*n.sommthFactor,n.Zsmooth=n.Zsmooth*(1-n.sommthFactor)+n.Zcount*n.sommthFactor,n.smoothPosX=n.smoothPosX*(1-n.sommthFactor)+n.posX*n.sommthFactor,n.smoothPosZ=n.smoothPosZ*(1-n.sommthFactor)+n.posZ*n.sommthFactor,n.camBase.position.x=n.smoothPosX,n.camBase.position.z=n.smoothPosZ,n.cameraRotX.rotation.x=n.Xsmooth/57.3,n.cameraRotY.rotation.y=n.Ysmooth/57.3,n.camera.position.z=n.Zsmooth,n.compass.rotation.z=-n.cameraRotY.rotation.y+n.zhiBeiZhenCorrect,r.inTouch&&n.Zcount<1){let a=new i.Vector3;n.cameraRotY.getWorldDirection(a);let s=new i.Vector3(a.x,a.y,a.z);r.rd?(a.x=-a.x,a.y=-a.y,a.z=-a.z):a=s,n.camBase.forward=a;var e=!0,t=new i.Ray(n.camBase.position,a);let l=[];o(n.camBase.parent);for(let r=0;r<l.length;r++){l[r].updateMatrix(),l[r].updateMatrixWorld(!0);let o=Array.from(l[r].geometry.attributes.position.array);if(l[r].geometry.index){let a=Array.from(l[r].geometry.index.array);for(let s=0;s<a.length/3;s++){let h=new i.Vector3(o[3*a[3*s]],o[3*a[3*s]+1],o[3*a[3*s]+2]),c=new i.Vector3(o[3*a[3*s+1]],o[3*a[3*s+1]+1],o[3*a[3*s+1]+2]),d=new i.Vector3(o[3*a[3*s+2]],o[3*a[3*s+2]+1],o[3*a[3*s+2]+2]);l[r].localToWorld(h),l[r].localToWorld(c),l[r].localToWorld(d);let u=new i.Vector3;if(t.intersectTriangle(h,c,d,!1,u),!u.equals(new i.Vector3)){if(1>n.camBase.position.distanceTo(u))return e=!1,!1;e=!0}}}else for(let r=0;r<o.length/9;r++){let a=new i.Vector3(o[9*r],o[9*r+1],o[9*r+2]),s=new i.Vector3(o[9*r+3],o[9*r+4],o[9*r+5]),l=new i.Vector3(o[9*r+6],o[9*r+7],o[9*r+8]),h=new i.Vector3;if(new i.Vector3,t.intersectTriangle(a,s,l,!1,h),!h.equals(new i.Vector3)){if(1>n.camBase.position.distanceTo(h))return e=!1,!1;e=!0}}}function o(e){e.children.length>0&&e.children.forEach(function(e){"Mesh"==e.type&&2==e.layers.mask&&l.push(e),"Group"==e.type&&o(e)})}e&&!r.md&&(n.posX=n.posX+.02*a.x*n.walkingSpeed,n.posZ=n.posZ+.02*a.z*n.walkingSpeed)}return!!(r.inTouch||Math.abs(n.Xsmooth-n.Xcount)>.001||Math.abs(n.Ysmooth-n.Ycount)>.001||Math.abs(n.Zsmooth-n.Zcount)>.001)}}}),parcelRequire.register("gLad4",function(e,t){$parcel$export(e.exports,"PreventObj",()=>o);var i=parcelRequire("4xklQ"),r=parcelRequire("1o48A"),n=parcelRequire("9HO6e");class o{constructor(e){this.editor=e}main(){if(""==this.editor.mouseCoverObj)return;this.editor.doorHelperGroupClean(),this.editor.switchHelperGroup("hidden");let e=this.editor.currentPoint.clone();if(0==e.x&&0==e.y&&0==e.z)return;let t="";if(this.editor.camera.isOrthographicCamera){"model2dBox"==this.editor.mouseCoverObj.name&&(this.editor.mouseCoverObj.parent&&this.editor.mouseCoverObj.parent.remove(this.editor.mouseCoverObj),this.editor.model2D.children.slice(0).forEach(e=>{e.uuid==this.editor.mouseCoverObj.modelUUID&&(this.editor.mouseCoverObj=e)}));let r="";this.editor.floorGroup2d.children.forEach(t=>{if("floor"==t.useType){let i=[];t.allPoints.forEach(e=>{i.push(e.x,e.y)}),this.editor.PolyK.ContainsPoint(i,e.x,e.y)&&(r=t.roomCenter)}}),this.editor.allWalls.forEach(t=>{let o=(0,n.UtilCore).smallDistanceByPointOnLine((0,n.UtilCore).handleLineData(t.startPoint,t.endPoint),e);if(!(0,n.UtilCore).pointIsInLine(o,t.startPoint,t.endPoint))return;let a=o.clone().distanceTo((0,n.UtilCore).toVector3(e)),s=Math.min(this.editor.mouseCoverObj.width,this.editor.mouseCoverObj.height),l=t.thickness/2+s/2;if(a<=l){let a=t.endPoint.clone().sub(t.startPoint.clone()).angle();r&&(0,n.UtilCore).getClockWise(t.startPoint,t.endPoint,new i.Vector2(r[0],r[1]))>0&&(a+=Math.PI),this.editor.mouseCoverObj.rotation.z=a,this.editor.mouseCoverObj.coverWallId=t.wallID,e=o.clone().add((0,n.UtilCore).toVector2(e).sub(o.clone()).setLength(l));let s=o.distanceTo(t.startPoint),h=o.distanceTo(t.endPoint);if(s<this.editor.mouseCoverObj.width/2+t.thickness/2){let r=this.editor.mouseCoverObj.width/2-s+t.thickness/2,n=t.endPoint.clone().sub(t.startPoint).setLength(r);n=new i.Vector3(n.x,n.y,e.z),e.add(n)}if(h<this.editor.mouseCoverObj.width/2+t.thickness/2){let r=this.editor.mouseCoverObj.width/2-h+t.thickness/2,n=t.startPoint.clone().sub(t.endPoint).setLength(r);n=new i.Vector3(n.x,n.y,e.z),e.add(n)}}}),this.editor.mouseCoverObj.position.set(e.x,e.y,0),this.editor.cleanModelHelper(),this.editor.addPositionHelper(this.editor.mouseCoverObj),t=this.editor.get3DModelBy2DModel(this.editor.mouseCoverObj),e=new i.Vector3(e.x/1e3,0,-e.y/1e3)}else{if("model3dBox"==this.editor.mouseCoverObj.name&&(this.editor.mouseCoverObj.parent&&this.editor.mouseCoverObj.parent.remove(this.editor.mouseCoverObj),this.editor.model3D.children.slice(0).forEach(e=>{e.uuid==this.editor.mouseCoverObj.modelUUID&&(this.editor.mouseCoverObj=e)})),"top"==(t=this.editor.mouseCoverObj).modelPosition);else{let t="";this.editor.floorGroup.children.forEach(i=>{if("Floor3D"==i.type){let r=[];i.allPoints.forEach(e=>{r.push(e.x,e.y)}),this.editor.PolyK.ContainsPoint(r,1e3*e.x,-(1e3*e.z))&&(t=i.roomCenter)}}),this.editor.wallGroup3D.children.forEach(r=>{if(!r.startPoint)return;let o=(0,n.UtilCore).get3dWallDistance(e,r);if(0==o.length)return;let a=o[0],s=r.thickness/2+this.editor.mouseCoverObj.depth/2;if(a<=s){let a=r.endPoint.clone().sub(r.startPoint.clone()).angle();t&&(0,n.UtilCore).getClockWise(r.startPoint,r.endPoint,new i.Vector2(t[0]/1e3,t[1]/1e3))>0&&(a+=Math.PI),this.editor.mouseCoverObj.rotation.y=a,this.editor.mouseCoverObj.coverWallId=r.wallID;let l=o[1];e=l.clone().add(e.clone().sub(l.clone()).setLength(s));let h=new i.Vector2(l.x,-l.z),c=h.distanceTo(r.startPoint),d=h.distanceTo(r.endPoint);if(c<this.editor.mouseCoverObj.width/2+r.thickness/2){let t=this.editor.mouseCoverObj.width/2-c+r.thickness/2,n=r.endPoint.clone().sub(r.startPoint).setLength(t);n=new i.Vector3(n.x,e.y,-n.y),e.add(n)}if(d<this.editor.mouseCoverObj.width/2+r.thickness/2){let t=this.editor.mouseCoverObj.width/2-d+r.thickness/2,n=r.startPoint.clone().sub(r.endPoint).setLength(t);n=new i.Vector3(n.x,e.y,-n.y),e.add(n)}}})}e.y=this.editor.currentPoint.y;let r=this.editor.get2DModelBy3DModel(this.editor.mouseCoverObj);""!=r&&r.position.set(1e3*e.x,-(1e3*e.z),0)}if(""==t||!t.parent)return;let r=this.editor.getRealSize(t);"top"==t.modelPosition?(t.position.set(e.x,this.editor.wallGroup3D.roomHeight/1e3-r[1]/2,e.z),t.floorHei=this.editor.wallGroup3D.roomHeight/1e3-r[1]):"bottom"==t.modelPosition?(t.position.set(e.x,r[1]/2,e.z),t.floorHei=0):(t.position.set(e.x,e.y+r[1]/2,e.z),t.floorHei=e.y);let o=t.position.clone();if(t.parent.worldToLocal(o),t.position.copy(o),this.editor.clickDepthMsg.uuid&&this.editor.checkModelIsInGroupModel(this.editor.mouseCoverObj)){var a=e.clone();let t=this.editor.mouseCoverObj;t.parent.uuid!=this.editor.clickDepthMsg.uuid&&("3dModel"==t.parent.name||"2dModel"==t.parent.name)&&(this.editor.clickDepthMsg.model.add(t),this.editor.clickDepthMsg.model.param[0].add(t.param[0])),this.editor.camera.isOrthographicCamera&&(a=this.editor.mouseCoverObj.position.clone(),t.parent.worldToLocal(a),t.position.x=a.x,t.position.y=a.y);let i=this.editor.getOuterParent(t,t,"outer");this.editor.refreshRealSizeByBox(i,t),this.editor.updateModelPosition(t.parent,i),this.editor.modelDotGroup.children=[],this.editor.camera.isOrthographicCamera?(this.editor.addDashBoxFor2dGroup(i),this.editor.addDashBoxForGroup(i.param[0]),this.editor.cleanModelHelper()):(this.editor.addDashBoxForGroup(i),this.editor.addDashBoxFor2dGroup(i.param[0]))}this.editor.synchroModel(this.editor.mouseCoverObj)}execute(){let e=this.editor.model2D.children,t="model2dBox";this.editor.camera.isOrthographicCamera&&(e=this.editor.model3D.children,t="model3dBox");let i=e.slice(0);this.editor.mouseCoverObj.parent.param&&(e=this.editor.mouseCoverObj.parent.param[0].children);let n="";if(e.forEach(e=>{e.name==t&&(n=e)}),""!=n){let e="";i.forEach(t=>{t.uuid==n.modelUUID&&(e=t)}),e.position.copy(n.position),e.rotation.copy(n.rotation),n.parent.add(e),n.parent.remove(n),this.editor.mouseCoverObj.modelId=e.uuid,this.editor.mouseCoverObj.param=[e],e.param=[this.editor.mouseCoverObj]}if(this.editor.cleanWallHelper(),this.editor.doorHelperGroupClean(),this.editor.camera.isOrthographicCamera?this.editor.mouseCoverObj.isLock?this.editor.addPositionHelper(this.editor.mouseCoverObj,!0):this.editor.addLineHelperForMember(this.editor.mouseCoverObj):new(0,r.Model3DHelper)(this.editor).selectObj([this.editor.mouseCoverObj]),"casualModel"==this.editor.mouseCoverObj.modelType){this.editor.selectObjArr=[this.editor.mouseCoverObj];let e=this.editor.camera.isOrthographicCamera?"2d":"3d";this.editor.explodeGroup(e,!1)}this.editor.mouseCoverObj=""}undo(){}redo(){}}}),parcelRequire.register("bIuaB",function(e,t){$parcel$export(e.exports,"TransformControls",()=>u);var i=parcelRequire("4xklQ");let r=new i.Raycaster,n=new i.Vector3,o=new i.Vector3,a=new i.Quaternion,s={X:new i.Vector3(1,0,0),Y:new i.Vector3(0,1,0),Z:new i.Vector3(0,0,1)},l={type:"change"},h={type:"mouseDown"},c={type:"mouseUp",mode:null},d={type:"objectChange"};class u extends i.Object3D{constructor(e,t){super(),void 0===t&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";let r=new R;this._gizmo=r,this.add(r);let n=new W;this._plane=n,this.add(n);let o=this;function a(e,t){let i=t;Object.defineProperty(o,e,{get:function(){return void 0!==i?i:t},set:function(t){i!==t&&(i=t,n[e]=t,r[e]=t,o.dispatchEvent({type:e+"-changed",value:t}),o.dispatchEvent(l))}}),o[e]=t,n[e]=t,r[e]=t}a("camera",e),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0);let s=new i.Vector3,h=new i.Vector3,c=new i.Quaternion,d=new i.Quaternion,u=new i.Vector3,x=new i.Quaternion,w=new i.Vector3,b=new i.Vector3,v=new i.Vector3,M=0,S=new i.Vector3;a("worldPosition",s),a("worldPositionStart",h),a("worldQuaternion",c),a("worldQuaternionStart",d),a("cameraPosition",u),a("cameraQuaternion",x),a("pointStart",w),a("pointEnd",b),a("rotationAxis",v),a("rotationAngle",M),a("eye",S),this._offset=new i.Vector3,this._startNorm=new i.Vector3,this._endNorm=new i.Vector3,this._cameraScale=new i.Vector3,this._parentPosition=new i.Vector3,this._parentQuaternion=new i.Quaternion,this._parentQuaternionInv=new i.Quaternion,this._parentScale=new i.Vector3,this._worldScaleStart=new i.Vector3,this._worldQuaternionInv=new i.Quaternion,this._worldScale=new i.Vector3,this._positionStart=new i.Vector3,this._quaternionStart=new i.Quaternion,this._scaleStart=new i.Vector3,this._getPointer=p.bind(this),this._onPointerDown=f.bind(this),this._onPointerHover=m.bind(this),this._onPointerMove=g.bind(this),this._onPointerUp=y.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye):this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(void 0===this.object||!0===this.dragging)return;r.setFromCamera(e,this.camera);let t=x(this._gizmo.picker[this.mode],r);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){r.setFromCamera(e,this.camera);let t=x(this._plane,r,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,h.mode=this.mode,this.dispatchEvent(h)}}pointerMove(e){let t=this.axis,i=this.mode,h=this.object,c=this.space;if("scale"===i?c="local":("E"===t||"XYZE"===t||"XYZ"===t)&&(c="world"),void 0===h||null===t||!1===this.dragging||-1!==e.button)return;r.setFromCamera(e,this.camera);let u=x(this._plane,r,!0);if(u){if(this.pointEnd.copy(u.point).sub(this.worldPositionStart),"translate"===i)this._offset.copy(this.pointEnd).sub(this.pointStart),"local"===c&&"XYZ"!==t&&this._offset.applyQuaternion(this._worldQuaternionInv),-1===t.indexOf("X")&&(this._offset.x=0),-1===t.indexOf("Y")&&(this._offset.y=0),-1===t.indexOf("Z")&&(this._offset.z=0),"local"===c&&"XYZ"!==t?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),h.position.copy(this._offset).add(this._positionStart),this.translationSnap&&("local"===c&&(h.position.applyQuaternion(a.copy(this._quaternionStart).invert()),-1!==t.search("X")&&(h.position.x=Math.round(h.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(h.position.y=Math.round(h.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(h.position.z=Math.round(h.position.z/this.translationSnap)*this.translationSnap),h.position.applyQuaternion(this._quaternionStart)),"world"===c&&(h.parent&&h.position.add(n.setFromMatrixPosition(h.parent.matrixWorld)),-1!==t.search("X")&&(h.position.x=Math.round(h.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(h.position.y=Math.round(h.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(h.position.z=Math.round(h.position.z/this.translationSnap)*this.translationSnap),h.parent&&h.position.sub(n.setFromMatrixPosition(h.parent.matrixWorld))));else if("scale"===i){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();0>this.pointEnd.dot(this.pointStart)&&(e*=-1),o.set(e,e,e)}else n.copy(this.pointStart),o.copy(this.pointEnd),n.applyQuaternion(this._worldQuaternionInv),o.applyQuaternion(this._worldQuaternionInv),o.divide(n),-1===t.search("X")&&(o.x=1),-1===t.search("Y")&&(o.y=1),-1===t.search("Z")&&(o.z=1);h.scale.copy(this._scaleStart).multiply(o),this.scaleSnap&&(-1!==t.search("X")&&(h.scale.x=Math.round(h.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(h.scale.y=Math.round(h.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(h.scale.z=Math.round(h.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===i){this._offset.copy(this.pointEnd).sub(this.pointStart);let e=20/this.worldPosition.distanceTo(n.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=0>this._endNorm.cross(this._startNorm).dot(this.eye)?1:-1):"XYZE"===t?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(n.copy(this.rotationAxis).cross(this.eye))*e):("X"===t||"Y"===t||"Z"===t)&&(this.rotationAxis.copy(s[t]),n.copy(s[t]),"local"===c&&n.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(n.cross(this.eye).normalize())*e),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===c&&"E"!==t&&"XYZE"!==t?(h.quaternion.copy(this._quaternionStart),h.quaternion.multiply(a.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),h.quaternion.copy(a.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),h.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(l),this.dispatchEvent(d)}}pointerUp(e){0===e.button&&(this.dragging&&null!==this.axis&&(c.mode=this.mode,this.dispatchEvent(c)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(l),this.dispatchEvent(d),this.pointStart.copy(this.pointEnd))}getRaycaster(){return r}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function p(e){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:e.button};{let t=this.domElement.getBoundingClientRect();return{x:(e.clientX-t.left)/t.width*2-1,y:-(e.clientY-t.top)/t.height*2+1,button:e.button}}}function m(e){if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(e))}}function f(e){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(e)),this.pointerDown(this._getPointer(e)))}function g(e){this.enabled&&this.pointerMove(this._getPointer(e))}function y(e){this.enabled&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(e)))}function x(e,t,i){let r=t.intersectObject(e,!0);for(let e=0;e<r.length;e++)if(r[e].object.visible||i)return r[e];return!1}let w=new i.Euler,b=new i.Vector3(0,1,0),v=new i.Vector3(0,0,0),M=new i.Matrix4,S=new i.Quaternion,P=new i.Quaternion,T=new i.Vector3,_=new i.Matrix4,C=new i.Vector3(1,0,0),D=new i.Vector3(0,1,0),A=new i.Vector3(0,0,1),E=new i.Vector3,L=new i.Vector3,I=new i.Vector3;class R extends i.Object3D{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";let e=new i.MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new i.LineBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),r=e.clone();r.opacity=.15;let n=t.clone();n.opacity=.5;let o=e.clone();o.color.setHex(16711680);let a=e.clone();a.color.setHex(65280);let s=e.clone();s.color.setHex(255);let l=e.clone();l.color.setHex(16711680),l.opacity=.5;let h=e.clone();h.color.setHex(65280),h.opacity=.5;let c=e.clone();c.color.setHex(255),c.opacity=.5;let d=e.clone();d.opacity=.25;let u=e.clone();u.color.setHex(16776960),u.opacity=.25;let p=e.clone();p.color.setHex(16776960);let m=e.clone();m.color.setHex(7895160);let f=new i.CylinderGeometry(0,.04,.1,12);f.translate(0,.05,0);let g=new i.BoxGeometry(.08,.08,.08);g.translate(0,.04,0);let y=new i.BufferGeometry;y.setAttribute("position",new i.Float32BufferAttribute([0,0,0,1,0,0],3));let x=new i.CylinderGeometry(.0075,.0075,.5,3);function w(e,t){let r=new i.TorusGeometry(e,.0075,3,64,t*Math.PI*2);return r.rotateY(Math.PI/2),r.rotateX(Math.PI/2),r}function b(){let e=new i.BufferGeometry;return e.setAttribute("position",new i.Float32BufferAttribute([0,0,0,1,1,1],3)),e}x.translate(0,.25,0);let v={X:[[new i.Mesh(f,o),[.5,0,0],[0,0,-Math.PI/2]],[new i.Mesh(f,o),[-.5,0,0],[0,0,Math.PI/2]],[new i.Mesh(x,o),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new i.Mesh(f,a),[0,.5,0]],[new i.Mesh(f,a),[0,-.5,0],[Math.PI,0,0]],[new i.Mesh(x,a)]],Z:[[new i.Mesh(f,s),[0,0,.5],[Math.PI/2,0,0]],[new i.Mesh(f,s),[0,0,-.5],[-Math.PI/2,0,0]],[new i.Mesh(x,s),null,[Math.PI/2,0,0]]],XYZ:[[new i.Mesh(new i.OctahedronGeometry(.1,0),d.clone()),[0,0,0]]],XY:[[new i.Mesh(new i.BoxGeometry(.15,.15,.01),c.clone()),[.15,.15,0]]],YZ:[[new i.Mesh(new i.BoxGeometry(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new i.Mesh(new i.BoxGeometry(.15,.15,.01),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},M={X:[[new i.Mesh(new i.CylinderGeometry(.2,0,.6,4),r),[.3,0,0],[0,0,-Math.PI/2]],[new i.Mesh(new i.CylinderGeometry(.2,0,.6,4),r),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new i.Mesh(new i.CylinderGeometry(.2,0,.6,4),r),[0,.3,0]],[new i.Mesh(new i.CylinderGeometry(.2,0,.6,4),r),[0,-.3,0],[0,0,Math.PI]]],Z:[[new i.Mesh(new i.CylinderGeometry(.2,0,.6,4),r),[0,0,.3],[Math.PI/2,0,0]],[new i.Mesh(new i.CylinderGeometry(.2,0,.6,4),r),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new i.Mesh(new i.OctahedronGeometry(.2,0),r)]],XY:[[new i.Mesh(new i.BoxGeometry(.2,.2,.01),r),[.15,.15,0]]],YZ:[[new i.Mesh(new i.BoxGeometry(.2,.2,.01),r),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new i.Mesh(new i.BoxGeometry(.2,.2,.01),r),[.15,0,.15],[-Math.PI/2,0,0]]]},S={START:[[new i.Mesh(new i.OctahedronGeometry(.01,2),n),null,null,null,"helper"]],END:[[new i.Mesh(new i.OctahedronGeometry(.01,2),n),null,null,null,"helper"]],DELTA:[[new i.Line(b(),n),null,null,null,"helper"]],X:[[new i.Line(y,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new i.Line(y,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new i.Line(y,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},P={XYZE:[[new i.Mesh(w(.5,1),m),null,[0,Math.PI/2,0]]],X:[[new i.Mesh(w(.5,.5),o)]],Y:[[new i.Mesh(w(.5,.5),a),null,[0,0,-Math.PI/2]]],Z:[[new i.Mesh(w(.5,.5),s),null,[0,Math.PI/2,0]]],E:[[new i.Mesh(w(.75,1),u),null,[0,Math.PI/2,0]]]},T={AXIS:[[new i.Line(y,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},_={XYZE:[[new i.Mesh(new i.SphereGeometry(.25,10,8),r)]],X:[[new i.Mesh(new i.TorusGeometry(.5,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new i.Mesh(new i.TorusGeometry(.5,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new i.Mesh(new i.TorusGeometry(.5,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new i.Mesh(new i.TorusGeometry(.75,.1,2,24),r)]]},C={X:[[new i.Mesh(g,o),[.5,0,0],[0,0,-Math.PI/2]],[new i.Mesh(x,o),[0,0,0],[0,0,-Math.PI/2]],[new i.Mesh(g,o),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new i.Mesh(g,a),[0,.5,0]],[new i.Mesh(x,a)],[new i.Mesh(g,a),[0,-.5,0],[0,0,Math.PI]]],Z:[[new i.Mesh(g,s),[0,0,.5],[Math.PI/2,0,0]],[new i.Mesh(x,s),[0,0,0],[Math.PI/2,0,0]],[new i.Mesh(g,s),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new i.Mesh(new i.BoxGeometry(.15,.15,.01),c),[.15,.15,0]]],YZ:[[new i.Mesh(new i.BoxGeometry(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new i.Mesh(new i.BoxGeometry(.15,.15,.01),h),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new i.Mesh(new i.BoxGeometry(.1,.1,.1),d.clone())]]},D={X:[[new i.Mesh(new i.CylinderGeometry(.2,0,.6,4),r),[.3,0,0],[0,0,-Math.PI/2]],[new i.Mesh(new i.CylinderGeometry(.2,0,.6,4),r),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new i.Mesh(new i.CylinderGeometry(.2,0,.6,4),r),[0,.3,0]],[new i.Mesh(new i.CylinderGeometry(.2,0,.6,4),r),[0,-.3,0],[0,0,Math.PI]]],Z:[[new i.Mesh(new i.CylinderGeometry(.2,0,.6,4),r),[0,0,.3],[Math.PI/2,0,0]],[new i.Mesh(new i.CylinderGeometry(.2,0,.6,4),r),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new i.Mesh(new i.BoxGeometry(.2,.2,.01),r),[.15,.15,0]]],YZ:[[new i.Mesh(new i.BoxGeometry(.2,.2,.01),r),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new i.Mesh(new i.BoxGeometry(.2,.2,.01),r),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new i.Mesh(new i.BoxGeometry(.2,.2,.2),r),[0,0,0]]]},A={X:[[new i.Line(y,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new i.Line(y,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new i.Line(y,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function E(e){let t=new i.Object3D;for(let i in e)for(let r=e[i].length;r--;){let n=e[i][r][0].clone(),o=e[i][r][1],a=e[i][r][2],s=e[i][r][3],l=e[i][r][4];n.name=i,n.tag=l,o&&n.position.set(o[0],o[1],o[2]),a&&n.rotation.set(a[0],a[1],a[2]),s&&n.scale.set(s[0],s[1],s[2]),n.updateMatrix();let h=n.geometry.clone();h.applyMatrix4(n.matrix),n.geometry=h,n.renderOrder=1/0,n.position.set(0,0,0),n.rotation.set(0,0,0),n.scale.set(1,1,1),t.add(n)}return t}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=E(v)),this.add(this.gizmo.rotate=E(P)),this.add(this.gizmo.scale=E(C)),this.add(this.picker.translate=E(M)),this.add(this.picker.rotate=E(_)),this.add(this.picker.scale=E(D)),this.add(this.helper.translate=E(S)),this.add(this.helper.rotate=E(T)),this.add(this.helper.scale=E(A)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){let t="scale"===this.mode?"local":this.space,i="local"===t?this.worldQuaternion:P;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let r=[];r=(r=(r=r.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(let e=0;e<r.length;e++){let t;let o=r[e];if(o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition),t=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(t*this.size/4),"helper"===o.tag){o.visible=!1,"AXIS"===o.name?(o.position.copy(this.worldPositionStart),o.visible=!!this.axis,"X"===this.axis&&(a.setFromEuler(w.set(0,0,0)),o.quaternion.copy(i).multiply(a),Math.abs(b.copy(C).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),"Y"===this.axis&&(a.setFromEuler(w.set(0,0,Math.PI/2)),o.quaternion.copy(i).multiply(a),Math.abs(b.copy(D).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),"Z"===this.axis&&(a.setFromEuler(w.set(0,Math.PI/2,0)),o.quaternion.copy(i).multiply(a),Math.abs(b.copy(A).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),"XYZE"===this.axis&&(a.setFromEuler(w.set(0,Math.PI/2,0)),b.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(M.lookAt(v,b,D)),o.quaternion.multiply(a),o.visible=this.dragging),"E"===this.axis&&(o.visible=!1)):"START"===o.name?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):"END"===o.name?(o.position.copy(this.worldPosition),o.visible=this.dragging):"DELTA"===o.name?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),n.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),n.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(n),o.visible=this.dragging):(o.quaternion.copy(i),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=-1!==this.axis.search(o.name)));continue}if(o.quaternion.copy(i),"translate"===this.mode||"scale"===this.mode){let e=.99,t=.2;"X"===o.name&&Math.abs(b.copy(C).applyQuaternion(i).dot(this.eye))>e&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"Y"===o.name&&Math.abs(b.copy(D).applyQuaternion(i).dot(this.eye))>e&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"Z"===o.name&&Math.abs(b.copy(A).applyQuaternion(i).dot(this.eye))>e&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"XY"===o.name&&Math.abs(b.copy(A).applyQuaternion(i).dot(this.eye))<t&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"YZ"===o.name&&Math.abs(b.copy(C).applyQuaternion(i).dot(this.eye))<t&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"XZ"===o.name&&Math.abs(b.copy(D).applyQuaternion(i).dot(this.eye))<t&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)}else"rotate"===this.mode&&(S.copy(i),b.copy(this.eye).applyQuaternion(a.copy(i).invert()),-1!==o.name.search("E")&&o.quaternion.setFromRotationMatrix(M.lookAt(this.eye,v,D)),"X"===o.name&&(a.setFromAxisAngle(C,Math.atan2(-b.y,b.z)),a.multiplyQuaternions(S,a),o.quaternion.copy(a)),"Y"===o.name&&(a.setFromAxisAngle(D,Math.atan2(b.x,b.z)),a.multiplyQuaternions(S,a),o.quaternion.copy(a)),"Z"===o.name&&(a.setFromAxisAngle(A,Math.atan2(b.y,b.x)),a.multiplyQuaternions(S,a),o.quaternion.copy(a)));o.visible=o.visible&&(-1===o.name.indexOf("X")||this.showX),o.visible=o.visible&&(-1===o.name.indexOf("Y")||this.showY),o.visible=o.visible&&(-1===o.name.indexOf("Z")||this.showZ),o.visible=o.visible&&(-1===o.name.indexOf("E")||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis?(o.material.color.setHex(16776960),o.material.opacity=1):this.axis.split("").some(function(e){return o.name===e})&&(o.material.color.setHex(16776960),o.material.opacity=1))}super.updateMatrixWorld(e)}}class W extends i.Mesh{constructor(){super(new i.PlaneGeometry(1e5,1e5,2,2),new i.MeshBasicMaterial({visible:!1,wireframe:!0,side:i.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(t="local"),E.copy(C).applyQuaternion("local"===t?this.worldQuaternion:P),L.copy(D).applyQuaternion("local"===t?this.worldQuaternion:P),I.copy(A).applyQuaternion("local"===t?this.worldQuaternion:P),b.copy(L),this.mode){case"translate":case"scale":switch(this.axis){case"X":b.copy(this.eye).cross(E),T.copy(E).cross(b);break;case"Y":b.copy(this.eye).cross(L),T.copy(L).cross(b);break;case"Z":b.copy(this.eye).cross(I),T.copy(I).cross(b);break;case"XY":T.copy(I);break;case"YZ":T.copy(E);break;case"XZ":b.copy(I),T.copy(L);break;case"XYZ":case"E":T.set(0,0,0)}break;default:T.set(0,0,0)}0===T.length()?this.quaternion.copy(this.cameraQuaternion):(_.lookAt(n.set(0,0,0),T,b),this.quaternion.setFromRotationMatrix(_)),super.updateMatrixWorld(e)}}}),parcelRequire.register("kS8hL",function(e,t){$parcel$export(e.exports,"default",()=>r);var i=function(){var e=0,t=document.createElement("div");function r(e){return t.appendChild(e.dom),e}function n(i){for(var r=0;r<t.children.length;r++)t.children[r].style.display=r===i?"block":"none";e=i}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",function(i){i.preventDefault(),n(++e%t.children.length)},!1);var o=(performance||Date).now(),a=o,s=0,l=r(new i.Panel("FPS","#0ff","#002")),h=r(new i.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=r(new i.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:t,addPanel:r,showPanel:n,begin:function(){o=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(h.update(e-o,200),e>=a+1e3&&(l.update(1e3*s/(e-a),100),a=e,s=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){o=this.end()},domElement:t,setMode:n}};i.Panel=function(e,t,i){var r=1/0,n=0,o=Math.round,a=o(window.devicePixelRatio||1),s=80*a,l=48*a,h=3*a,c=2*a,d=3*a,u=15*a,p=74*a,m=30*a,f=document.createElement("canvas");f.width=s,f.height=l,f.style.cssText="width:80px;height:48px";var g=f.getContext("2d");return g.font="bold "+9*a+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=i,g.fillRect(0,0,s,l),g.fillStyle=t,g.fillText(e,h,c),g.fillRect(d,u,p,m),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(d,u,p,m),{dom:f,update:function(l,y){r=Math.min(r,l),n=Math.max(n,l),g.fillStyle=i,g.globalAlpha=1,g.fillRect(0,0,s,u),g.fillStyle=t,g.fillText(o(l)+" "+e+" ("+o(r)+"-"+o(n)+")",h,c),g.drawImage(f,d+a,u,p-a,m,d,u,p-a,m),g.fillRect(d+p-a,u,a,m),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(d+p-a,u,a,o((1-l/y)*m))}}};var r=i}),parcelRequire.register("iQ5za",function(e,t){$parcel$export(e.exports,"SelectionBox",()=>v);var i=parcelRequire("4xklQ");let r=new i.Frustum,n=new i.Vector3,o=new i.Vector3,a=new i.Vector3,s=new i.Vector3,l=new i.Vector3,h=new i.Vector3,c=new i.Vector3,d=new i.Vector3,u=new i.Vector3,p=new i.Vector3,m=new i.Vector3,f=new i.Vector3,g=new i.Vector3,y=new i.Vector3,x=new i.Matrix4,w=new i.Quaternion,b=new i.Vector3;class v{constructor(e,t,r=Number.MAX_VALUE){this.camera=e,this.scene=t,this.startPoint=new i.Vector3,this.endPoint=new i.Vector3,this.collection=[],this.instances={},this.deep=r}select(e,t){return this.startPoint=e||this.startPoint,this.endPoint=t||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(r,this.scene),this.collection}updateFrustum(e,t){if(e=e||this.startPoint,t=t||this.endPoint,e.x===t.x&&(t.x+=Number.EPSILON),e.y===t.y&&(t.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera){o.copy(e),o.x=Math.min(e.x,t.x),o.y=Math.max(e.y,t.y),t.x=Math.max(e.x,t.x),t.y=Math.min(e.y,t.y),a.setFromMatrixPosition(this.camera.matrixWorld),s.copy(o),l.set(t.x,o.y,0),h.copy(t),c.set(o.x,t.y,0),s.unproject(this.camera),l.unproject(this.camera),h.unproject(this.camera),c.unproject(this.camera),f.copy(s).sub(a),g.copy(l).sub(a),y.copy(h).sub(a),f.normalize(),g.normalize(),y.normalize(),f.multiplyScalar(this.deep),g.multiplyScalar(this.deep),y.multiplyScalar(this.deep),f.add(a),g.add(a),y.add(a);let i=r.planes;i[0].setFromCoplanarPoints(a,s,l),i[1].setFromCoplanarPoints(a,l,h),i[2].setFromCoplanarPoints(h,c,a),i[3].setFromCoplanarPoints(c,s,a),i[4].setFromCoplanarPoints(l,h,c),i[5].setFromCoplanarPoints(y,g,f),i[5].normal.multiplyScalar(-1)}else if(this.camera.isOrthographicCamera){let i=Math.min(e.x,t.x),n=Math.max(e.y,t.y),o=Math.max(e.x,t.x),a=Math.min(e.y,t.y);s.set(i,n,-1),l.set(o,n,-1),h.set(o,a,-1),c.set(i,a,-1),d.set(i,n,1),u.set(o,n,1),p.set(o,a,1),m.set(i,a,1),s.unproject(this.camera),l.unproject(this.camera),h.unproject(this.camera),c.unproject(this.camera),d.unproject(this.camera),u.unproject(this.camera),p.unproject(this.camera),m.unproject(this.camera);let f=r.planes;f[0].setFromCoplanarPoints(s,d,u),f[1].setFromCoplanarPoints(l,u,p),f[2].setFromCoplanarPoints(p,m,c),f[3].setFromCoplanarPoints(m,d,s),f[4].setFromCoplanarPoints(l,h,c),f[5].setFromCoplanarPoints(p,u,d),f[5].normal.multiplyScalar(-1)}else console.error("THREE.SelectionBox: Unsupported camera type.")}searchChildInFrustum(e,t){if(t.isMesh||t.isLine||t.isPoints){if(t.isInstancedMesh){this.instances[t.uuid]=[];for(let i=0;i<t.count;i++)t.getMatrixAt(i,x),x.decompose(n,w,b),n.applyMatrix4(t.matrixWorld),e.containsPoint(n)&&this.instances[t.uuid].push(i)}else if(null===t.geometry.boundingSphere&&t.geometry.computeBoundingSphere(),n.copy(t.geometry.boundingSphere.center),n.applyMatrix4(t.matrixWorld),e.containsPoint(n)){let e="GridHelper"==t.type||"helperGroup"==t.parent.name||"auxiliaryFloor"==t.name;t.layers.mask!=this.camera.layers.mask||e||this.collection.push(t)}}if(t.children.length>0)for(let i=0;i<t.children.length;i++)t.children[i].layers.mask==this.camera.layers.mask&&this.searchChildInFrustum(e,t.children[i])}}}),parcelRequire.register("03OZ0",function(e,t){$parcel$export(e.exports,"SelectionHelper",()=>r);var i=parcelRequire("4xklQ");class r{constructor(e,t,r){this.element=document.createElement("div"),this.element.classList.add(t),this.element.style.pointerEvents="none",this.renderer=e,this.startPoint=new i.Vector2,this.pointTopLeft=new i.Vector2,this.pointBottomRight=new i.Vector2,this.isDown=!1,this.onPointerDown=(function(e){e.shiftKey&&(this.isDown=!0,this.onSelectStart(e))}).bind(this),this.onPointerMove=(function(e){this.onSelectMove(e)}).bind(this),this.onPointerUp=(function(e){this.isDown=!1,this.onSelectOver()}).bind(this),r.addEventListener("pointerdown",this.onPointerDown),r.addEventListener("pointermove",this.onPointerMove),r.addEventListener("pointerup",this.onPointerUp)}dispose(){dom.removeEventListener("pointerdown",this.onPointerDown),dom.removeEventListener("pointermove",this.onPointerMove),dom.removeEventListener("pointerup",this.onPointerUp)}onSelectStart(e){this.element.style.display="none",this.renderer.domElement.parentElement.appendChild(this.element),this.element.style.left=e.clientX+"px",this.element.style.top=e.clientY+"px",this.element.style.width="0px",this.element.style.height="0px",this.startPoint.x=e.clientX,this.startPoint.y=e.clientY}onSelectMove(e){this.element.style.display="block",this.pointBottomRight.x=Math.max(this.startPoint.x,e.clientX),this.pointBottomRight.y=Math.max(this.startPoint.y,e.clientY),this.pointTopLeft.x=Math.min(this.startPoint.x,e.clientX),this.pointTopLeft.y=Math.min(this.startPoint.y,e.clientY),this.element.style.left=this.pointTopLeft.x+"px",this.element.style.top=this.pointTopLeft.y+"px",this.element.style.width=this.pointBottomRight.x-this.pointTopLeft.x+"px",this.element.style.height=this.pointBottomRight.y-this.pointTopLeft.y+"px"}onSelectOver(){this.element.parentElement&&this.element.parentElement.removeChild(this.element)}}}),parcelRequire.register("fuGJl",function(e,t){$parcel$export(e.exports,"Roaming",()=>s);var i=parcelRequire("4xklQ"),r=parcelRequire("hrM0U"),n=parcelRequire("2XHRA"),o=parcelRequire("6WmIx"),a=parcelRequire("RhAiw");class s{constructor(e){this.Tween=new a.Tween,this.Tween.onUpdate(e=>{console.log(e.x,e.y,e.z),this.camBase.position.set(e.x,e.y,e.z),this.editor.miniCamera.position.x=1e3*this.camBase.position.x,this.editor.miniCamera.position.y=-(1e3*this.camBase.position.z),this.tmpCone&&e.x==this.tmpCone.position.x&&e.z==this.tmpCone.position.z&&(this.editor.scene.remove(this.tmpCone),this.tmpCone.geometry.dispose(),this.tmpCone=null)}),this.rotate=!1,this.viewport=e,this.editor=e.editor,this.camera=this.editor.camera,this.cameraRotX=new i.Object3D,this.cameraRotX.name="cameraRotX",this.cameraRotY=new i.Object3D,this.cameraRotY.name="cameraRotY",this.camBase=new i.Object3D,this.camBase.name="camBase",this.originPosition=this.camera.position.clone(),this.originPosition.y=1.7,this.camera.position.set(0,0,0),this.cameraRotX.add(this.camera),this.cameraRotY.add(this.cameraRotX),this.camBase.add(this.cameraRotY),this.setPosition(this.originPosition),this.camera.lookAt(new i.Vector3(1,1.7,0)),this.camera.realPosition=this.camBase.position,this.camera.realRotation=[this.cameraRotY.rotation,this.cameraRotX.rotation],this.tmpVec=new i.Vector3,this.moveSpeed=.02,this.keyPress={},this.ray=new i.Ray,this.canMove=!1,this.rayCaster=new i.Raycaster,this.handleListener(e.container),this.firstPosition=new i.Vector2,this.XcountOffset=0,this.YcountOffset=0,this.countXBegin=0,this.countYBegin=0,this.countZBegin=0,this.Xcount=0,this.Ycount=0,this.Zcount=0,this.createMinMap(),this.activeFlag=!0}active(){this.activeFlag=!0,this.editor.miniCamera.visible=!0}deactive(){this.activeFlag=!1,this.editor.miniCamera.visible=!1}handleListener(e){if(this.mouseDownHandler=this.onCanvasMouseDown.bind(this),this.mouseUpHandler=this.onCanvasMouseUp.bind(this),this.mouseMoveHandler=this.onCanvasMouseMove.bind(this),this.mouseWheelHandler=this.OnMousewheel.bind(this),this.editor.roamTool){let t=this.editor.roamTool;e.removeEventListener("mousedown",t.mouseDownHandler),e.removeEventListener("mouseup",t.mouseUpHandler),e.removeEventListener("mousemove",t.mouseMoveHandler),e.removeEventListener("wheel",t.mouseWheelHandler)}e.addEventListener("mousedown",this.mouseDownHandler,!1),e.addEventListener("mouseup",this.mouseUpHandler,!1),e.addEventListener("mousemove",this.mouseMoveHandler,!1),e.addEventListener("wheel",this.mouseWheelHandler,!1),e.addEventListener("contextmenu",this.OnForbidden.bind(this),!0)}OnForbidden(e){e.preventDefault()}onCanvasMouseDown(e){e.preventDefault();let t=new i.Vector2;t.x=e.clientX/window.innerWidth*2-1,t.y=-(2*(e.clientY/window.innerHeight))+1,this.getIntersect3(t),console.log("---------------------------------------------------------------------"),console.log(this.cameraRotX.rotation.x,this.cameraRotX.rotation.y,this.cameraRotX.rotation.z),console.log(this.cameraRotY.rotation.x,this.cameraRotY.rotation.y,this.cameraRotY.rotation.z),console.log(this.camera.rotation.x,this.camera.rotation.y,this.camera.rotation.z),console.log("---------------------------------------------------------------------"),this.camera&&(this.rotate=!0,this.countXBegin=this.cameraRotX.rotation.z,this.countYBegin=this.cameraRotY.rotation.y,this.XcountOffset=0,this.YcountOffset=0,this.firstPosition=new i.Vector2(e.clientX,e.clientY),this.updateCamera())}createCone(){this.tmpCone&&(this.editor.scene.remove(this.tmpCone),this.tmpCone.geometry.dispose(),this.tmpCone=null,console.log("A tween stop"),this.Tween.stop());let e=new i.ConeGeometry(.05,.15,32),t=new i.Mesh(e,new i.MeshBasicMaterial({color:16711680}));t.layers.mask=6,this.editor.scene.add(t),t.rotation.x=Math.PI,t.position.y=.075,this.tmpCone=t}onCanvasMouseUp(e){e.preventDefault(),this.rotate=!1,this.updateCamera()}onCanvasMouseMove(e){e.preventDefault(),this.rotate&&(this.XcountOffset=this.firstPosition.y-e.clientY,this.YcountOffset=this.firstPosition.x-e.clientX),this.updateCamera()}OnMousewheel(e){e.preventDefault();let t=this.getRadian(),r=Math.sin(t)*e.wheelDelta/1e3,n=Math.cos(t)*e.wheelDelta/1e3,o=new i.Vector3(r,0,n);this.canMove=!0,this.getIntersect2(o),this.canMove&&(this.camBase.position.add(o),this.editor.miniCamera.position.x=1e3*this.camBase.position.x,this.editor.miniCamera.position.y=1e3*this.camBase.position.z)}getIntersect(e){let t=this.getRadian();e||=new(0,i.Vector3)(Math.sin(t),0,Math.cos(t)).normalize(),this.ray.set(this.camBase.position,e);let r=1/0,n,o;return this.editor.wallGroup3D.children.forEach((e,t)=>{let a=new i.Vector3,s=new i.Vector3;this.ray.distanceSqToSegment(new i.Vector3(e.startPoint.x,0,e.startPoint.y),new i.Vector3(e.endPoint.x,0,e.endPoint.y),a,s);let l=s.distanceTo(a);l<r&&(r=l,n=t,o=a)}),{rayVec:e,minDist:r,minIndex:n,minPoint:o}}getIntersect2(e,t=!1){this.ray.set(this.camBase.localToWorld(this.camera.position.clone()),e);let r=Array.from(this.editor.wallGroup3D.children);r=r.concat(this.editor.floorGroup2d.children);for(let e=0;e<r.length;e++){let n=r[e];if("3DWall"==n.modelType||"floor"==n.useType){let e=Array.from(n.geometry.attributes.position.array);if(n.geometry.index){let r=Array.from(n.geometry.index.array);for(let o=0;o<r.length/3;o++){let a=new i.Vector3,s=new i.Vector3(e[3*r[3*o]],e[3*r[3*o]+1],e[3*r[3*o]+2]),l=new i.Vector3(e[3*r[3*o+1]],e[3*r[3*o+1]+1],e[3*r[3*o+1]+2]),h=new i.Vector3(e[3*r[3*o+2]],e[3*r[3*o+2]+1],e[3*r[3*o+2]+2]);if(s=n.localToWorld(s),l=n.localToWorld(l),h=n.localToWorld(h),"floor"==n.useType&&(s=new i.Vector3(s.x/1e3,s.z/1e3,-s.y/1e3),l=new i.Vector3(l.x/1e3,l.z/1e3,-l.y/1e3),h=new i.Vector3(h.x/1e3,h.z/1e3,-h.y/1e3)),this.ray.intersectTriangle(s,l,h,!0,a),!a.equals(new i.Vector3)){let e=this.camBase.position.distanceTo(a);if(t)return{point:a,obj:n};e<.3&&(this.canMove=!1)}}}else for(let r=0;r<e.length/9;r++){let o=new i.Vector3,a=new i.Vector3(e[9*r],e[9*r+1],e[9*r+2]),s=new i.Vector3(e[9*r+3],e[9*r+4],e[9*r+5]),l=new i.Vector3(e[9*r+6],e[9*r+7],e[9*r+8]);if(a=n.localToWorld(a),s=n.localToWorld(s),l=n.localToWorld(l),this.ray.intersectTriangle(a,s,l,!0,o),!o.equals(new i.Vector3)){let e=this.camBase.position.distanceTo(o);if(t)return{point:o,obj:n};e<.3&&(this.canMove=!1)}}}}}getIntersect3(e){this.rayCaster.setFromCamera(e,this.camera);let t=this.getIntersect2(this.rayCaster.ray.direction,!0);t&&0==t.point.y&&(this.createCone(),this.tmpCone.position.x=t.point.x,this.tmpCone.position.z=t.point.z,this.tween(this.camBase.position,new i.Vector3(t.point.x,this.camBase.position.y,t.point.z)))}tween(e,t){this.Tween._object={x:e.x,y:e.y,z:e.z},this.Tween._valuesStart={x:e.x,y:e.y,z:e.z};let i=this.cameraRot(e,t);this.Tween.to({x:t.x,y:t.y,z:t.z},i).start()}cameraRot(e,t){let r=t.distanceTo(e)/this.moveSpeed/3*10,n=new(0,i.Vector2)(t.z,t.x).sub(new i.Vector2(e.z,e.x)).angle(),o=(n-=Math.PI/2)-(this.cameraRotY.rotation.y<0?2*Math.PI+this.cameraRotY.rotation.y%(2*Math.PI):this.cameraRotY.rotation.y%(2*Math.PI));Math.abs(o)>Math.PI&&(o<0?o=2*Math.PI+o:o-=2*Math.PI);let a=10*Math.round(r/50);for(let e=0;e<a;e++)setTimeout(()=>{this.cameraRotY.rotation.y+=o/a,this.editor.miniCamera.rotation.z=this.cameraRotY.rotation.y},5*e);return r}getRadian(){return this.camera.getWorldDirection(this.tmpVec),Math.atan2(this.tmpVec.x,this.tmpVec.z)}updateCamera(){this.camera&&this.setUpdateState()}setUpdateState(){this.Xcount=this.countXBegin+10*Math.asin(this.XcountOffset/window.innerHeight/2),this.Ycount=this.countYBegin+10*Math.asin(this.YcountOffset/window.innerWidth/2),this.Zcount=this.countZBegin}onKeyDown(e){if(console.log("A---------------------------------------------------------------------"),console.log(this.cameraRotX.rotation.x,this.cameraRotX.rotation.y,this.cameraRotX.rotation.z),console.log(this.cameraRotY.rotation.x,this.cameraRotY.rotation.y,this.cameraRotY.rotation.z),console.log(this.camera.rotation.x,this.camera.rotation.y,this.camera.rotation.z),console.log("---------------------------------------------------------------------"),-1!=["w","a","s","d","q","e","W","A","S","D","Q","E","Shift"].indexOf(e.key)&&(e.preventDefault(),this.keyPress[e.key.toLowerCase()]=!0),32==e.keyCode&&(this.camBase.position.set(this.originPosition.x,17,this.originPosition.z),this.cameraRotX.rotation.z=-Math.PI/2,this.camera.rotation.y=-Math.PI/2,console.log(this.camera.rotation)),e.keyCode>48&&e.keyCode<=48+this.editor.floorGroup2d.children.length){let t=this.editor.floorGroup2d.children[e.keyCode-49].roomCenter,r=new i.Vector3(Number(t[0])/1e3,1.7,-Number(t[1])/1e3),n=this.camBase.position.distanceTo(r)/this.moveSpeed/3*10,o=-this.cameraRotX.rotation.z,a=10*Math.round(n/50);for(let e=0;e<a;e++)setTimeout(()=>{this.cameraRotX.rotation.z+=o/a,this.editor.miniCamera.rotation.z=this.cameraRotY.rotation.y},5*e);this.cameraRot(new(0,i.Vector3)().copy(this.camBase.position),r.clone()),this.Tween&&this.Tween.stop(),console.log(this.camBase.position.x,this.camBase.position.y,this.camBase.position.z),console.log(r.x,r.y,r.z),this.Tween._object={x:this.camBase.position.x,y:this.camBase.position.y,z:this.camBase.position.z},this.Tween._valuesStart={x:this.camBase.position.x,y:this.camBase.position.y,z:this.camBase.position.z},this.Tween.to({x:r.x,y:r.y,z:r.z},n).start(),this.camBase.position.copy(r)}this.canMove=!0,console.log("B---------------------------------------------------------------------"),console.log(this.cameraRotX.rotation.x,this.cameraRotX.rotation.y,this.cameraRotX.rotation.z),console.log(this.cameraRotY.rotation.x,this.cameraRotY.rotation.y,this.cameraRotY.rotation.z),console.log(this.camera.rotation.x,this.camera.rotation.y,this.camera.rotation.z),console.log("---------------------------------------------------------------------")}onKeyUp(e){-1!=["w","a","s","d","q","e","W","A","S","D","Q","E","Shift"].indexOf(e.key)&&(e.preventDefault(),this.keyPress[e.key.toLowerCase()]=!1),this.canMove=this.keyPress.w||this.keyPress.a||this.keyPress.s||this.keyPress.d||this.keyPress.q||this.keyPress.e}needUpdate(){if(this.activeFlag&&(this.rotate&&(this.camBase.position.y<=2.8&&(this.camera.rotation.y=-Math.PI/2),this.Xcount=(0,i.MathUtils).clamp(this.Xcount,-.7,.7),this.cameraRotX.rotation.z=this.Xcount,this.cameraRotY.rotation.y=this.Ycount,this.editor.miniCamera.rotation.z=this.cameraRotY.rotation.y),this.canMove)){this.tmpCone&&(this.editor.scene.remove(this.tmpCone),this.tmpCone.geometry.dispose(),this.tmpCone=null,console.log("C tween stop"),this.Tween.stop());let e=this.getRadian(),t=this.keyPress.shift?2:1,r=Math.sin(e)*this.moveSpeed*t,n=Math.cos(e)*this.moveSpeed*t,o=new i.Vector3;this.keyPress.w&&o.add(new i.Vector3(r,0,n)),this.keyPress.a&&o.add(new i.Vector3(n,0,-r)),this.keyPress.s&&o.add(new i.Vector3(-r,0,-n)),this.keyPress.d&&o.add(new i.Vector3(-n,0,r)),this.keyPress.q&&this.camBase.position.y<2.55&&o.add(new i.Vector3(0,this.moveSpeed,0)),this.keyPress.e&&this.camBase.position.y>.05&&o.add(new i.Vector3(0,-this.moveSpeed,0)),this.getIntersect2(o),this.canMove&&(this.camBase.position.add(o),this.editor.miniCamera.position.x=1e3*this.camBase.position.x,this.editor.miniCamera.position.y=-(1e3*this.camBase.position.z))}}restore(e,t){this.setPosition(e),this.cameraRotY.rotation.y=t.y,this.cameraRotX.rotation.z=t.z,this.editor.miniCamera.rotation.z=this.cameraRotY.rotation.y,this.editor.miniCamera.position.x=1e3*this.camBase.position.x,this.editor.miniCamera.position.y=-(1e3*this.camBase.position.z),this.camera.rotation.y=e.y>2.8?-Math.PI/2:0,console.log(this.camera.rotation.x,this.camera.rotation.y,this.camera.rotation.z),console.log(this.cameraRotX.rotation.x,this.cameraRotX.rotation.y,this.cameraRotX.rotation.z),console.log(this.cameraRotY.rotation.x,this.cameraRotY.rotation.y,this.cameraRotY.rotation.z)}setPosition(e){this.camBase.position.set(e.x,e.y,e.z)}createMinMap(){let e=document.getElementsByClassName("roaming_box")[0];for(let e in this.mmRenderer=new i.WebGLRenderer({antialias:!0}),this.mmRenderer.setClearColor(15264748),this.mmRenderer.setPixelRatio(window.devicePixelRatio),this.mmRenderer.shadowMap.enabled=!0,this.mmRenderer.xr.enabled=!0,this.editor.cameras)"2dCamera"==this.editor.cameras[e].name&&(this.mmCamera=this.editor.cameras[e].clone());let t=240,r=258,n=240/258,a=-5e3;this.mmCamera.left=a*n,this.mmCamera.right=-a*n,this.mmCamera.top=-a,this.mmCamera.bottom=a,this.mmRenderer.setSize(t,r),this.mmCamera.updateProjectionMatrix(),this.mmRenderer.render(this.editor.scene,this.mmCamera),this.mmRenderer.domElement.style.cssText="position: absolute;left: 0;top: 0;width: 100%;height: 100%;",e.appendChild(this.mmRenderer.domElement),this.addListener(e),this.createCamera(),this.editor.miniCamera.roamControls=new o.OrbitControls(this.mmCamera,e),this.editor.miniCamera.roamControls.enableRotate=!1,this.editor.miniCamera.roamControls.target.copy(this.mmCamera.position),this.editor.miniCamera.roamControls.update(),this.editor.miniCamera.camera=this.mmCamera,this.editor.miniCamera.renderer=this.mmRenderer}addListener(e){let t=this.rayCaster,r=this.editor,n=this.mmCamera,o=this.camBase,a=this.cameraRotY,s=r.floor.clone();s.rotation.x=0,s.material=s.material.clone(),s.material.color=new i.Color(16711680),s.layers.set(0),r.scene.add(s),e.addEventListener("pointermove",function(l){let h=new i.Vector2;h.x=(l.clientX+e.clientWidth-window.innerWidth)/e.clientWidth*2-1,h.y=-(2*(l.clientY/e.clientHeight))+1,t.setFromCamera(h,n);let c=t.intersectObjects(r.miniCamera.children,!0),d=t.intersectObjects([s],!0);if(r.miniCamera.canRot&&"ready"!=r.miniCamera.canRot){let e=d[0].point.clone().sub(r.miniCamera.position);r.miniCamera.rotation.z=new i.Vector2(e.x,e.y).angle(),a.rotation.y=r.miniCamera.rotation.z}if(c.length>0){if(1==c.length)r.miniCamera.nosc.visible=!0,r.miniCamera.selc.visible=!1,"ready"==r.miniCamera.canRot&&(r.miniCamera.nosr.visible=!0,r.miniCamera.selr.visible=!1,r.miniCamera.canRot=!1);else{let e=c[0].object.parent.name;if(r.miniCamera.canMove&&"ready"!=r.miniCamera.canMove){let e=d[0].point.clone().sub(r.miniCamera.originPosition);r.miniCamera.originPosition=d[0].point.clone(),r.miniCamera.position.add(e),o.position.x=r.miniCamera.position.x/1e3,o.position.z=-r.miniCamera.position.y/1e3}else"nosc"==e&&(r.miniCamera.nosc.visible=!1,r.miniCamera.selc.visible=!0,r.miniCamera.canMove="ready");r.miniCamera.canRot&&"ready"!=r.miniCamera.canRot?console.log(r.miniCamera.canRot,"旋转"):"nosr"==e&&(r.miniCamera.nosr.visible=!1,r.miniCamera.selr.visible=!0,r.miniCamera.canRot="ready")}}else r.miniCamera.nosc.visible=!0,r.miniCamera.selc.visible=!1,r.miniCamera.canMove=!1,"ready"==r.miniCamera.canRot?(r.miniCamera.nosr.visible=!0,r.miniCamera.selr.visible=!1,r.miniCamera.canRot=!1):r.miniCamera.canRot}),e.addEventListener("wheel",function(e){let t=r.miniCamera.position.clone(),o=r.miniCamera.scale;r.miniCamera.scale.set(1,1,1),r.miniCamera.applyMatrix4(new i.Matrix4().makeScale(1/n.zoom*o.x,1/n.zoom*o.y,1)),r.miniCamera.position.set(t.x,t.y,t.z)}),e.addEventListener("pointerdown",function(o){let a=new i.Vector2;a.x=(o.clientX+e.clientWidth-window.innerWidth)/e.clientWidth*2-1,a.y=-(2*(o.clientY/e.clientHeight))+1,t.setFromCamera(a,n);let l=t.intersectObjects([s],!1);"ready"==r.miniCamera.canMove&&(r.miniCamera.canMove=!0),"ready"==r.miniCamera.canRot&&(r.miniCamera.canRot=!0),(r.miniCamera.canMove||r.miniCamera.canRot&&"ready"!=r.miniCamera.canRot)&&(r.miniCamera.originPosition=l[0].point)}),e.addEventListener("pointerup",function(e){r.miniCamera.canMove&&(r.miniCamera.canMove="ready"),r.miniCamera.canRot&&(r.miniCamera.nosr.visible=!0,r.miniCamera.selr.visible=!1,r.miniCamera.canRot=!1)})}createCamera(){let e=1200,t=20,n=new i.Vector3(-e/2,-e/2,t),o=new i.Vector3(-e/2,e/6,t),a=new i.Vector3(-e/6,e/6,t),s=new i.Vector3(-e/3,e/2,t),l=new i.Vector3(e/3,e/2,t),h=new i.Vector3(e/6,e/6,t),c=new i.Vector3(e/2,e/6,t),d=new i.Vector3(e/2,-e/2,t);(0,r.CommonFunc).createShapeByPoints([n,o,a,s,l,h,c,d],new i.MeshBasicMaterial({color:16711680,side:2}));let u=new i.Group,p='<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 28 28" id="camera-hover" width="28" height="28"><g fill="#675D50" fill-rule="evenodd" stroke="#FFF"><path d="M17.5 7A2.5 2.5 0 0015 4.5H7A2.5 2.5 0 004.5 7v14A2.5 2.5 0 007 23.5h8a2.5 2.5 0 002.5-2.5V7zM23.5 7.717a.5.5 0 00-.741-.438l-4.482 2.468a1.5 1.5 0 00-.777 1.314v5.888a1.5 1.5 0 00.777 1.314l4.482 2.468a.5.5 0 00.741-.438V7.717z"></path></g></svg>';var{object:m,update:f}=this.renderSVG(p);let g=new i.Box3().setFromObject(m).getSize(new i.Vector3);m.position.x-=g.x/2,u.add(m),m.name="nosc",u.nosc=m;let y='<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 28 28" id="camera-hover" width="28" height="28"><g fill="#1A7AFB" fill-rule="evenodd" stroke="#FFF"><path d="M17.5 7A2.5 2.5 0 0015 4.5H7A2.5 2.5 0 004.5 7v14A2.5 2.5 0 007 23.5h8a2.5 2.5 0 002.5-2.5V7zM23.5 7.717a.5.5 0 00-.741-.438l-4.482 2.468a1.5 1.5 0 00-.777 1.314v5.888a1.5 1.5 0 00.777 1.314l4.482 2.468a.5.5 0 00.741-.438V7.717z"></path></g></svg>';var{object:m,update:f}=this.renderSVG(y);m.position.x-=g.x/2,u.add(m),m.name="selc",u.selc=m,m.visible=!1;let x=3e3,w=105/180*Math.PI,b=new i.Mesh(new i.CircleGeometry(x,32,-w/2,w),new i.MeshBasicMaterial({color:6774096,side:2,transparent:!0,opacity:.7}));b.name="circle";let v='<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 60 132" id="rotate" width="60" height="132"><g fill="#1E2329" fill-opacity=".5" fill-rule="evenodd" stroke="#FFF" stroke-width="3" transform="rotate(90 28.5 28.5)"><path d="M129.384 26.898L103.5 45.11V8.872l25.884 18.026zM2.616 26.898L28.5 45.11V8.873L2.616 26.898z"></path><circle cx="66" cy="27" r="25.5"></circle></g></svg>';var{object:m,update:f}=this.renderSVG(v);m.scale.x=10,m.scale.y=10,m.position.x=x,m.name="nosr",u.add(m),u.nosr=m;let M='<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 60 132" id="rotate" width="60" height="132"><g fill="#1A7AFB" fill-opacity=".5" fill-rule="evenodd" stroke="#FFF" stroke-width="3" transform="rotate(90 28.5 28.5)"><path d="M129.384 26.898L103.5 45.11V8.872l25.884 18.026zM2.616 26.898L28.5 45.11V8.873L2.616 26.898z"></path><circle cx="66" cy="27" r="25.5"></circle></g></svg>';var{object:m,update:f}=this.renderSVG(M);m.scale.x=10,m.scale.y=10,m.position.x=x,m.name="selr",m.visible=!1,u.selr=m,u.add(m,b),this.editor.miniCamera=u,this.editor.scene.add(u),u.rotation.z=this.cameraRotY.rotation.y,u.position.x=1e3*this.camBase.position.x,u.position.y=1e3*this.camBase.position.z,u.canMove=!1,u.canRot=!1}renderSVG(e){let t=new n.SVGLoader,r=t.parse(e),o=new i.Group,a=[],s=new i.LineBasicMaterial({color:"#FF0000",transparent:!0,opacity:.7});r.paths.forEach(e=>{let t=(0,n.SVGLoader).createShapes(e),r=new i.MeshBasicMaterial({color:e.color,transparent:!0,opacity:.7});t.forEach(e=>{let t=new i.ExtrudeBufferGeometry(e,{depth:1,bevelEnabled:!1}),n=new i.EdgesGeometry(t),l=new i.Mesh(t,r),h=new i.LineSegments(n,s);a.push({shape:e,mesh:l,lines:h}),o.add(l,h)})});let l=new i.Box3().setFromObject(o),h=l.getSize(new i.Vector3),c=-(h.y/2),d=-(h.x/2);return o.children.forEach(e=>{e.position.x=d-l.min.x,e.position.y=c-l.min.y}),o.position.z=100,o.applyMatrix4(new i.Matrix4().makeScale(30,30,1)),{object:o,update(e){a.forEach(t=>{let r=new i.ExtrudeBufferGeometry(t.shape,{depth:e,bevelEnabled:!1}),n=new i.EdgesGeometry(r);t.mesh.geometry.dispose(),t.lines.geometry.dispose(),t.mesh.geometry=r,t.lines.geometry=n})}}}}}),parcelRequire.register("2XHRA",function(e,t){$parcel$export(e.exports,"SVGLoader",()=>r);var i=parcelRequire("4xklQ");class r extends i.Loader{constructor(e){super(e),this.defaultDPI=90,this.defaultUnit="px"}load(e,t,r,n){let o=this,a=new i.FileLoader(o.manager);a.setPath(o.path),a.setRequestHeader(o.requestHeader),a.setWithCredentials(o.withCredentials),a.load(e,function(i){try{t(o.parse(i))}catch(t){n?n(t):console.error(t),o.manager.itemError(e)}},r,n)}parse(e){let t=this;function r(e,t){if(1!==e.nodeType)return;let i=b(e),a=!1,s=null;switch(e.nodeName){case"svg":case"g":t=m(e,t);break;case"style":o(e);break;case"path":t=m(e,t),e.hasAttribute("d")&&(s=n(e));break;case"rect":t=m(e,t),s=l(e);break;case"polygon":t=m(e,t),s=h(e);break;case"polyline":t=m(e,t),s=c(e);break;case"circle":t=m(e,t),s=d(e);break;case"ellipse":t=m(e,t),s=u(e);break;case"line":t=m(e,t),s=p(e);break;case"defs":a=!0;break;case"use":t=m(e,t);let f=e.getAttributeNS("http://www.w3.org/1999/xlink","href")||"",g=f.substring(1),y=e.viewportElement.getElementById(g);y?r(y,t):console.warn("SVGLoader: 'use node' references non-existent node id: "+g)}s&&(void 0!==t.fill&&"none"!==t.fill&&s.color.setStyle(t.fill),M(s,V),_.push(s),s.userData={node:e,style:t});let x=e.childNodes;for(let e=0;e<x.length;e++){let i=x[e];a&&"style"!==i.nodeName&&"defs"!==i.nodeName||r(i,t)}i&&(D.pop(),D.length>0?V.copy(D[D.length-1]):V.identity())}function n(e){let t=new i.ShapePath,r=new i.Vector2,n=new i.Vector2,o=new i.Vector2,s=!0,l=!1,h=e.getAttribute("d"),c=h.match(/[a-df-z][^a-df-z]*/ig);for(let e=0,i=c.length;e<i;e++){let i;let h=c[e],d=h.charAt(0),u=h.slice(1).trim();switch(!0===s&&(l=!0,s=!1),d){case"M":i=g(u);for(let e=0,a=i.length;e<a;e+=2)r.x=i[e+0],r.y=i[e+1],n.x=r.x,n.y=r.y,0===e?t.moveTo(r.x,r.y):t.lineTo(r.x,r.y),0===e&&o.copy(r);break;case"H":i=g(u);for(let e=0,a=i.length;e<a;e++)r.x=i[e],n.x=r.x,n.y=r.y,t.lineTo(r.x,r.y),0===e&&!0===l&&o.copy(r);break;case"V":i=g(u);for(let e=0,a=i.length;e<a;e++)r.y=i[e],n.x=r.x,n.y=r.y,t.lineTo(r.x,r.y),0===e&&!0===l&&o.copy(r);break;case"L":i=g(u);for(let e=0,a=i.length;e<a;e+=2)r.x=i[e+0],r.y=i[e+1],n.x=r.x,n.y=r.y,t.lineTo(r.x,r.y),0===e&&!0===l&&o.copy(r);break;case"C":i=g(u);for(let e=0,a=i.length;e<a;e+=6)t.bezierCurveTo(i[e+0],i[e+1],i[e+2],i[e+3],i[e+4],i[e+5]),n.x=i[e+2],n.y=i[e+3],r.x=i[e+4],r.y=i[e+5],0===e&&!0===l&&o.copy(r);break;case"S":i=g(u);for(let e=0,a=i.length;e<a;e+=4)t.bezierCurveTo(f(r.x,n.x),f(r.y,n.y),i[e+0],i[e+1],i[e+2],i[e+3]),n.x=i[e+0],n.y=i[e+1],r.x=i[e+2],r.y=i[e+3],0===e&&!0===l&&o.copy(r);break;case"Q":i=g(u);for(let e=0,a=i.length;e<a;e+=4)t.quadraticCurveTo(i[e+0],i[e+1],i[e+2],i[e+3]),n.x=i[e+0],n.y=i[e+1],r.x=i[e+2],r.y=i[e+3],0===e&&!0===l&&o.copy(r);break;case"T":i=g(u);for(let e=0,a=i.length;e<a;e+=2){let a=f(r.x,n.x),s=f(r.y,n.y);t.quadraticCurveTo(a,s,i[e+0],i[e+1]),n.x=a,n.y=s,r.x=i[e+0],r.y=i[e+1],0===e&&!0===l&&o.copy(r)}break;case"A":i=g(u,[3,4],7);for(let e=0,s=i.length;e<s;e+=7){if(i[e+5]==r.x&&i[e+6]==r.y)continue;let s=r.clone();r.x=i[e+5],r.y=i[e+6],n.x=r.x,n.y=r.y,a(t,i[e],i[e+1],i[e+2],i[e+3],i[e+4],s,r),0===e&&!0===l&&o.copy(r)}break;case"m":i=g(u);for(let e=0,a=i.length;e<a;e+=2)r.x+=i[e+0],r.y+=i[e+1],n.x=r.x,n.y=r.y,0===e?t.moveTo(r.x,r.y):t.lineTo(r.x,r.y),0===e&&o.copy(r);break;case"h":i=g(u);for(let e=0,a=i.length;e<a;e++)r.x+=i[e],n.x=r.x,n.y=r.y,t.lineTo(r.x,r.y),0===e&&!0===l&&o.copy(r);break;case"v":i=g(u);for(let e=0,a=i.length;e<a;e++)r.y+=i[e],n.x=r.x,n.y=r.y,t.lineTo(r.x,r.y),0===e&&!0===l&&o.copy(r);break;case"l":i=g(u);for(let e=0,a=i.length;e<a;e+=2)r.x+=i[e+0],r.y+=i[e+1],n.x=r.x,n.y=r.y,t.lineTo(r.x,r.y),0===e&&!0===l&&o.copy(r);break;case"c":i=g(u);for(let e=0,a=i.length;e<a;e+=6)t.bezierCurveTo(r.x+i[e+0],r.y+i[e+1],r.x+i[e+2],r.y+i[e+3],r.x+i[e+4],r.y+i[e+5]),n.x=r.x+i[e+2],n.y=r.y+i[e+3],r.x+=i[e+4],r.y+=i[e+5],0===e&&!0===l&&o.copy(r);break;case"s":i=g(u);for(let e=0,a=i.length;e<a;e+=4)t.bezierCurveTo(f(r.x,n.x),f(r.y,n.y),r.x+i[e+0],r.y+i[e+1],r.x+i[e+2],r.y+i[e+3]),n.x=r.x+i[e+0],n.y=r.y+i[e+1],r.x+=i[e+2],r.y+=i[e+3],0===e&&!0===l&&o.copy(r);break;case"q":i=g(u);for(let e=0,a=i.length;e<a;e+=4)t.quadraticCurveTo(r.x+i[e+0],r.y+i[e+1],r.x+i[e+2],r.y+i[e+3]),n.x=r.x+i[e+0],n.y=r.y+i[e+1],r.x+=i[e+2],r.y+=i[e+3],0===e&&!0===l&&o.copy(r);break;case"t":i=g(u);for(let e=0,a=i.length;e<a;e+=2){let a=f(r.x,n.x),s=f(r.y,n.y);t.quadraticCurveTo(a,s,r.x+i[e+0],r.y+i[e+1]),n.x=a,n.y=s,r.x=r.x+i[e+0],r.y=r.y+i[e+1],0===e&&!0===l&&o.copy(r)}break;case"a":i=g(u,[3,4],7);for(let e=0,s=i.length;e<s;e+=7){if(0==i[e+5]&&0==i[e+6])continue;let s=r.clone();r.x+=i[e+5],r.y+=i[e+6],n.x=r.x,n.y=r.y,a(t,i[e],i[e+1],i[e+2],i[e+3],i[e+4],s,r),0===e&&!0===l&&o.copy(r)}break;case"Z":case"z":t.currentPath.autoClose=!0,t.currentPath.curves.length>0&&(r.copy(o),t.currentPath.currentPoint.copy(r),s=!0);break;default:console.warn(h)}l=!1}return t}function o(e){if(e.sheet&&e.sheet.cssRules&&e.sheet.cssRules.length)for(let t=0;t<e.sheet.cssRules.length;t++){let i=e.sheet.cssRules[t];if(1!==i.type)continue;let r=i.selectorText.split(/,/gm).filter(Boolean).map(e=>e.trim());for(let e=0;e<r.length;e++){let t=Object.fromEntries(Object.entries(i.style).filter(([,e])=>""!==e));C[r[e]]=Object.assign(C[r[e]]||{},t)}}}function a(e,t,i,r,n,o,a,l){if(0==t||0==i){e.lineTo(l.x,l.y);return}r=r*Math.PI/180,t=Math.abs(t),i=Math.abs(i);let h=(a.x-l.x)/2,c=(a.y-l.y)/2,d=Math.cos(r)*h+Math.sin(r)*c,u=-Math.sin(r)*h+Math.cos(r)*c,p=t*t,m=i*i,f=d*d,g=u*u,y=f/p+g/m;if(y>1){let e=Math.sqrt(y);t*=e,i*=e,p=t*t,m=i*i}let x=p*g+m*f,w=(p*m-x)/x,b=Math.sqrt(Math.max(0,w));n===o&&(b=-b);let v=b*t*u/i,M=-b*i*d/t,S=Math.cos(r)*v-Math.sin(r)*M+(a.x+l.x)/2,P=Math.sin(r)*v+Math.cos(r)*M+(a.y+l.y)/2,T=s(1,0,(d-v)/t,(u-M)/i),_=s((d-v)/t,(u-M)/i,(-d-v)/t,(-u-M)/i)%(2*Math.PI);e.currentPath.absellipse(S,P,t,i,T,T+_,0===o,r)}function s(e,t,i,r){let n=e*i+t*r,o=Math.sqrt(e*e+t*t)*Math.sqrt(i*i+r*r),a=Math.acos(Math.max(-1,Math.min(1,n/o)));return e*r-t*i<0&&(a=-a),a}function l(e){let t=w(e.getAttribute("x")||0),r=w(e.getAttribute("y")||0),n=w(e.getAttribute("rx")||e.getAttribute("ry")||0),o=w(e.getAttribute("ry")||e.getAttribute("rx")||0),a=w(e.getAttribute("width")),s=w(e.getAttribute("height")),l=.448084975506,h=new i.ShapePath;return h.moveTo(t+n,r),h.lineTo(t+a-n,r),(0!==n||0!==o)&&h.bezierCurveTo(t+a-n*l,r,t+a,r+o*l,t+a,r+o),h.lineTo(t+a,r+s-o),(0!==n||0!==o)&&h.bezierCurveTo(t+a,r+s-o*l,t+a-n*l,r+s,t+a-n,r+s),h.lineTo(t+n,r+s),(0!==n||0!==o)&&h.bezierCurveTo(t+n*l,r+s,t,r+s-o*l,t,r+s-o),h.lineTo(t,r+o),(0!==n||0!==o)&&h.bezierCurveTo(t,r+o*l,t+n*l,r,t+n,r),h}function h(e){function t(e,t,i){let r=w(t),a=w(i);0===o?n.moveTo(r,a):n.lineTo(r,a),o++}let r=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,n=new i.ShapePath,o=0;return e.getAttribute("points").replace(r,t),n.currentPath.autoClose=!0,n}function c(e){function t(e,t,i){let r=w(t),a=w(i);0===o?n.moveTo(r,a):n.lineTo(r,a),o++}let r=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,n=new i.ShapePath,o=0;return e.getAttribute("points").replace(r,t),n.currentPath.autoClose=!1,n}function d(e){let t=w(e.getAttribute("cx")||0),r=w(e.getAttribute("cy")||0),n=w(e.getAttribute("r")||0),o=new i.Path;o.absarc(t,r,n,0,2*Math.PI);let a=new i.ShapePath;return a.subPaths.push(o),a}function u(e){let t=w(e.getAttribute("cx")||0),r=w(e.getAttribute("cy")||0),n=w(e.getAttribute("rx")||0),o=w(e.getAttribute("ry")||0),a=new i.Path;a.absellipse(t,r,n,o,0,2*Math.PI);let s=new i.ShapePath;return s.subPaths.push(a),s}function p(e){let t=w(e.getAttribute("x1")||0),r=w(e.getAttribute("y1")||0),n=w(e.getAttribute("x2")||0),o=w(e.getAttribute("y2")||0),a=new i.ShapePath;return a.moveTo(t,r),a.lineTo(n,o),a.currentPath.autoClose=!1,a}function m(e,t){t=Object.assign({},t);let i={};if(e.hasAttribute("class")){let t=e.getAttribute("class").split(/\s/).filter(Boolean).map(e=>e.trim());for(let e=0;e<t.length;e++)i=Object.assign(i,C["."+t[e]])}function r(r,n,o){void 0===o&&(o=function(e){return e.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),e}),e.hasAttribute(r)&&(t[n]=o(e.getAttribute(r))),i[r]&&(t[n]=o(i[r])),e.style&&""!==e.style[r]&&(t[n]=o(e.style[r]))}function n(e){return Math.max(0,Math.min(1,w(e)))}function o(e){return Math.max(0,w(e))}return e.hasAttribute("id")&&(i=Object.assign(i,C["#"+e.getAttribute("id")])),r("fill","fill"),r("fill-opacity","fillOpacity",n),r("fill-rule","fillRule"),r("opacity","opacity",n),r("stroke","stroke"),r("stroke-opacity","strokeOpacity",n),r("stroke-width","strokeWidth",o),r("stroke-linejoin","strokeLineJoin"),r("stroke-linecap","strokeLineCap"),r("stroke-miterlimit","strokeMiterLimit",o),r("visibility","visibility"),t}function f(e,t){return e-(t-e)}function g(e,t,i){let r;if("string"!=typeof e)throw TypeError("Invalid input: "+typeof e);let n={WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},o=0,a=1,s=2,l=3,h=o,c=!0,d="",u="",p=[];function m(e,t,i){let r=SyntaxError('Unexpected character "'+e+'" at index '+t+".");throw r.partial=i,r}function f(){""!==d&&(""===u?p.push(Number(d)):p.push(Number(d)*Math.pow(10,Number(u)))),d="",u=""}let g=e.length;for(let y=0;y<g;y++){if(r=e[y],Array.isArray(t)&&t.includes(p.length%i)&&n.FLAGS.test(r)){h=a,d=r,f();continue}if(h===o){if(n.WHITESPACE.test(r))continue;if(n.DIGIT.test(r)||n.SIGN.test(r)){h=a,d=r;continue}if(n.POINT.test(r)){h=s,d=r;continue}n.COMMA.test(r)&&(c&&m(r,y,p),c=!0)}if(h===a){if(n.DIGIT.test(r)){d+=r;continue}if(n.POINT.test(r)){d+=r,h=s;continue}if(n.EXP.test(r)){h=l;continue}n.SIGN.test(r)&&1===d.length&&n.SIGN.test(d[0])&&m(r,y,p)}if(h===s){if(n.DIGIT.test(r)){d+=r;continue}if(n.EXP.test(r)){h=l;continue}n.POINT.test(r)&&"."===d[d.length-1]&&m(r,y,p)}if(h===l){if(n.DIGIT.test(r)){u+=r;continue}if(n.SIGN.test(r)){if(""===u){u+=r;continue}1===u.length&&n.SIGN.test(u)&&m(r,y,p)}}n.WHITESPACE.test(r)?(f(),h=o,c=!1):n.COMMA.test(r)?(f(),h=o,c=!0):n.SIGN.test(r)?(f(),h=a,d=r):n.POINT.test(r)?(f(),h=s,d=r):m(r,y,p)}return f(),p}let y=["mm","cm","in","pt","pc","px"],x={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function w(e){let i,r="px";if("string"==typeof e||e instanceof String)for(let t=0,i=y.length;t<i;t++){let i=y[t];if(e.endsWith(i)){r=i,e=e.substring(0,e.length-i.length);break}}return"px"===r&&"px"!==t.defaultUnit?i=x.in[t.defaultUnit]/t.defaultDPI:(i=x[r][t.defaultUnit])<0&&(i=x[r].in*t.defaultDPI),i*parseFloat(e)}function b(e){if(!(e.hasAttribute("transform")||"use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))))return null;let t=v(e);return D.length>0&&t.premultiply(D[D.length-1]),V.copy(t),D.push(t),t}function v(e){let t=new i.Matrix3,r=A;if("use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))){let i=w(e.getAttribute("x")),r=w(e.getAttribute("y"));t.translate(i,r)}if(e.hasAttribute("transform")){let i=e.getAttribute("transform").split(")");for(let e=i.length-1;e>=0;e--){let n=i[e].trim();if(""===n)continue;let o=n.indexOf("("),a=n.length;if(o>0&&o<a){let e=n.slice(0,o),t=g(n.slice(o+1));switch(r.identity(),e){case"translate":if(t.length>=1){let e=t[0],i=0;t.length>=2&&(i=t[1]),r.translate(e,i)}break;case"rotate":if(t.length>=1){let e=0,i=0,n=0;e=-t[0]*Math.PI/180,t.length>=3&&(i=t[1],n=t[2]),E.identity().translate(-i,-n),L.identity().rotate(e),I.multiplyMatrices(L,E),E.identity().translate(i,n),r.multiplyMatrices(E,I)}break;case"scale":if(t.length>=1){let e=t[0],i=e;t.length>=2&&(i=t[1]),r.scale(e,i)}break;case"skewX":1===t.length&&r.set(1,Math.tan(t[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===t.length&&r.set(1,0,0,Math.tan(t[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===t.length&&r.set(t[0],t[2],t[4],t[1],t[3],t[5],0,0,1)}}t.premultiply(r)}}return t}function M(e,t){function i(e){W.set(e.x,e.y,1).applyMatrix3(t),e.set(W.x,W.y)}let r=S(t),n=e.subPaths;for(let e=0,o=n.length;e<o;e++){let o=n[e],a=o.curves;for(let e=0;e<a.length;e++){let n=a[e];n.isLineCurve?(i(n.v1),i(n.v2)):n.isCubicBezierCurve?(i(n.v0),i(n.v1),i(n.v2),i(n.v3)):n.isQuadraticBezierCurve?(i(n.v0),i(n.v1),i(n.v2)):n.isEllipseCurve&&(r&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),R.set(n.aX,n.aY),i(R),n.aX=R.x,n.aY=R.y,n.xRadius*=P(t),n.yRadius*=T(t))}}}function S(e){return 0!==e.elements[1]||0!==e.elements[3]}function P(e){let t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function T(e){let t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}let _=[],C={},D=[],A=new i.Matrix3,E=new i.Matrix3,L=new i.Matrix3,I=new i.Matrix3,R=new i.Vector2,W=new i.Vector3,V=new i.Matrix3,k=new DOMParser().parseFromString(e,"image/svg+xml");r(k.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4});let B={paths:_,xml:k.documentElement};return B}static createShapes(e){let t=999999999,r={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},n={loc:r.ORIGIN,t:0};function o(e,t,i,o){let s=e.x,l=t.x,h=i.x,c=o.x,d=e.y,u=t.y,p=i.y,m=o.y,f=(c-h)*(d-p)-(m-p)*(s-h),g=(l-s)*(d-p)-(u-d)*(s-h),y=(m-p)*(l-s)-(c-h)*(u-d),x=f/y,w=g/y;if(0===y&&0!==f||x<=0||x>=1||w<0||w>1)return null;if(0===f&&0===y){for(let h=0;h<2;h++){if(a(0===h?i:o,e,t),n.loc==r.ORIGIN){let e=0===h?i:o;return{x:e.x,y:e.y,t:n.t}}if(n.loc==r.BETWEEN){let e=+(s+n.t*(l-s)).toPrecision(10),t=+(d+n.t*(u-d)).toPrecision(10);return{x:e,y:t,t:n.t}}}return null}{for(let s=0;s<2;s++)if(a(0===s?i:o,e,t),n.loc==r.ORIGIN){let e=0===s?i:o;return{x:e.x,y:e.y,t:n.t}}let h=+(s+x*(l-s)).toPrecision(10),c=+(d+x*(u-d)).toPrecision(10);return{x:h,y:c,t:x}}}function a(e,t,i){let o;let a=i.x-t.x,s=i.y-t.y,l=e.x-t.x,h=e.y-t.y,c=a*h-l*s;if(e.x===t.x&&e.y===t.y){n.loc=r.ORIGIN,n.t=0;return}if(e.x===i.x&&e.y===i.y){n.loc=r.DESTINATION,n.t=1;return}if(c<-Number.EPSILON){n.loc=r.LEFT;return}if(c>Number.EPSILON){n.loc=r.RIGHT;return}if(a*l<0||s*h<0){n.loc=r.BEHIND;return}if(Math.sqrt(a*a+s*s)<Math.sqrt(l*l+h*h)){n.loc=r.BEYOND;return}o=0!==a?l/a:h/s,n.loc=r.BETWEEN,n.t=o}function s(e,t){let r=[],n=[];for(let a=1;a<e.length;a++){let s=e[a-1],l=e[a];for(let e=1;e<t.length;e++){let a=t[e-1],h=t[e],c=o(s,l,a,h);null!==c&&void 0===r.find(e=>e.t<=c.t+Number.EPSILON&&e.t>=c.t-Number.EPSILON)&&(r.push(c),n.push(new i.Vector2(c.x,c.y)))}}return n}function l(e,t,r){let n=new i.Vector2;t.getCenter(n);let o=[];return r.forEach(t=>{if(t.boundingBox.containsPoint(n)){let i=s(e,t.points);i.forEach(e=>{o.push({identifier:t.identifier,isCW:t.isCW,point:e})})}}),o.sort((e,t)=>e.point.x-t.point.x),o}function h(e,t,r,n,o){(null==o||""===o)&&(o="nonzero");let a=new i.Vector2;e.boundingBox.getCenter(a);let s=[new i.Vector2(r,a.y),new i.Vector2(n,a.y)],h=l(s,e.boundingBox,t);h.sort((e,t)=>e.point.x-t.point.x);let c=[],d=[];h.forEach(t=>{t.identifier===e.identifier?c.push(t):d.push(t)});let u=c[0].point.x,p=[],m=0;for(;m<d.length&&d[m].point.x<u;)p.length>0&&p[p.length-1]===d[m].identifier?p.pop():p.push(d[m].identifier),m++;if(p.push(e.identifier),"evenodd"===o){let t=p.length%2==0,i=p[p.length-2];return{identifier:e.identifier,isHole:t,for:i}}if("nonzero"===o){let i=!0,r=null,n=null;for(let e=0;e<p.length;e++){let o=p[e];i?(n=t[o].isCW,i=!1,r=o):n!==t[o].isCW&&(n=t[o].isCW,i=!0)}return{identifier:e.identifier,isHole:i,for:r}}console.warn('fill-rule: "'+o+'" is currently not implemented.')}let c=0,d=t,u=-t,p=e.subPaths.map(e=>{let r=e.getPoints(),n=-t,o=t,a=-t,s=t;for(let e=0;e<r.length;e++){let t=r[e];t.y>n&&(n=t.y),t.y<o&&(o=t.y),t.x>a&&(a=t.x),t.x<s&&(s=t.x)}return u<=a&&(u=a+1),d>=s&&(d=s-1),{curves:e.curves,points:r,isCW:(0,i.ShapeUtils).isClockWise(r),identifier:c++,boundingBox:new i.Box2(new i.Vector2(s,o),new i.Vector2(a,n))}});p=p.filter(e=>e.points.length>1);let m=p.map(t=>h(t,p,d,u,e.userData?.style.fillRule)),f=[];return p.forEach(e=>{let t=m[e.identifier];if(!t.isHole){let t=new i.Shape;t.curves=e.curves;let r=m.filter(t=>t.isHole&&t.for===e.identifier);r.forEach(e=>{let r=p[e.identifier],n=new i.Path;n.curves=r.curves,t.holes.push(n)}),f.push(t)}}),f}static getStrokeStyle(e,t,i,r,n){return{strokeColor:t=void 0!==t?t:"#000",strokeWidth:e=void 0!==e?e:1,strokeLineJoin:i=void 0!==i?i:"miter",strokeLineCap:r=void 0!==r?r:"butt",strokeMiterLimit:n=void 0!==n?n:4}}static pointsToStroke(e,t,n,o){let a=[],s=[],l=[];if(0===r.pointsToStrokeWithBuffers(e,t,n,o,a,s,l))return null;let h=new i.BufferGeometry;return h.setAttribute("position",new i.Float32BufferAttribute(a,3)),h.setAttribute("normal",new i.Float32BufferAttribute(s,3)),h.setAttribute("uv",new i.Float32BufferAttribute(l,2)),h}static pointsToStrokeWithBuffers(e,t,r,n,o,a,s,l){let h,c,d,u,p;let m=new i.Vector2,f=new i.Vector2,g=new i.Vector2,y=new i.Vector2,x=new i.Vector2,w=new i.Vector2,b=new i.Vector2,v=new i.Vector2,M=new i.Vector2,S=new i.Vector2,P=new i.Vector2,T=new i.Vector2,_=new i.Vector2,C=new i.Vector2,D=new i.Vector2,A=new i.Vector2,E=new i.Vector2;r=void 0!==r?r:12,n=void 0!==n?n:.001,l=void 0!==l?l:0,e=J(e);let L=e.length;if(L<2)return 0;let I=e[0].equals(e[L-1]),R=e[0],W=t.strokeWidth/2,V=1/(L-1),k=0,B,O=!1,F=0,z=3*l,U=2*l;N(e[0],e[1],m).multiplyScalar(W),v.copy(e[0]).sub(m),M.copy(e[0]).add(m),S.copy(v),P.copy(M);for(let i=1;i<L;i++){h=e[i],c=i===L-1?I?e[1]:void 0:e[i+1];let r=m;if(N(R,h,r),g.copy(r).multiplyScalar(W),T.copy(h).sub(g),_.copy(h).add(g),B=k+V,d=!1,void 0!==c){N(h,c,f),g.copy(f).multiplyScalar(W),C.copy(h).sub(g),D.copy(h).add(g),u=!0,g.subVectors(c,R),0>r.dot(g)&&(u=!1),1===i&&(O=u),g.subVectors(c,h),g.normalize();let e=Math.abs(r.dot(g));if(e>Number.EPSILON){let i=W/e;g.multiplyScalar(-i),y.subVectors(h,R),x.copy(y).setLength(i).add(g),A.copy(x).negate();let r=x.length(),n=y.length();y.divideScalar(n),w.subVectors(c,h);let o=w.length();switch(w.divideScalar(o),y.dot(A)<n&&w.dot(A)<o&&(d=!0),E.copy(x).add(h),A.add(h),p=!1,d?u?(D.copy(A),_.copy(A)):(C.copy(A),T.copy(A)):j(),t.strokeLineJoin){case"bevel":q(u,d,B);break;case"round":X(u,d),u?H(h,T,C,B,0):H(h,D,_,B,1);break;default:let a=W*t.strokeMiterLimit/r;a<1?"miter-clip"!==t.strokeLineJoin?q(u,d,B):(X(u,d),u?(w.subVectors(E,T).multiplyScalar(a).add(T),b.subVectors(E,C).multiplyScalar(a).add(C),G(T,B,0),G(w,B,0),G(h,B,.5),G(h,B,.5),G(w,B,0),G(b,B,0),G(h,B,.5),G(b,B,0),G(C,B,0)):(w.subVectors(E,_).multiplyScalar(a).add(_),b.subVectors(E,D).multiplyScalar(a).add(D),G(_,B,1),G(w,B,1),G(h,B,.5),G(h,B,.5),G(w,B,1),G(b,B,1),G(h,B,.5),G(b,B,1),G(D,B,1))):(d?(u?(G(M,k,1),G(v,k,0),G(E,B,0),G(M,k,1),G(E,B,0),G(A,B,1)):(G(M,k,1),G(v,k,0),G(E,B,1),G(v,k,0),G(A,B,0),G(E,B,1)),u?C.copy(E):D.copy(E)):u?(G(T,B,0),G(E,B,0),G(h,B,.5),G(h,B,.5),G(E,B,0),G(C,B,0)):(G(_,B,1),G(E,B,1),G(h,B,.5),G(h,B,.5),G(E,B,1),G(D,B,1)),p=!0)}}else j()}else j();I||i!==L-1||Y(e[0],S,P,u,!0,k),k=B,R=h,v.copy(C),M.copy(D)}if(I){if(d&&o){let e=E,t=A;O!==u&&(e=A,t=E),u?(p||O)&&(t.toArray(o,0),t.toArray(o,9),p&&e.toArray(o,3)):(p||!O)&&(t.toArray(o,3),t.toArray(o,9),p&&e.toArray(o,0))}}else Y(h,T,_,u,!1,B);return F;function N(e,t,i){return i.subVectors(t,e),i.set(-i.y,i.x).normalize()}function G(e,t,i){o&&(o[z]=e.x,o[z+1]=e.y,o[z+2]=0,a&&(a[z]=0,a[z+1]=0,a[z+2]=1),z+=3,s&&(s[U]=t,s[U+1]=i,U+=2)),F+=3}function H(e,t,i,n,o){m.copy(t).sub(e).normalize(),f.copy(i).sub(e).normalize();let a=Math.PI,s=m.dot(f);1>Math.abs(s)&&(a=Math.abs(Math.acos(s))),a/=r,g.copy(t);for(let t=0,i=r-1;t<i;t++)y.copy(g).rotateAround(e,a),G(g,n,o),G(y,n,o),G(e,n,.5),g.copy(y);G(y,n,o),G(i,n,o),G(e,n,.5)}function j(){G(M,k,1),G(v,k,0),G(T,B,0),G(M,k,1),G(T,B,1),G(_,B,0)}function q(e,t,i){t?(e?(G(M,k,1),G(v,k,0),G(T,B,0),G(M,k,1),G(T,B,0),G(A,B,1),G(T,i,0),G(C,i,0)):(G(M,k,1),G(v,k,0),G(_,B,1),G(v,k,0),G(A,B,0),G(_,B,1),G(_,i,1),G(D,i,0)),G(A,i,.5)):(e?(G(T,i,0),G(C,i,0)):(G(_,i,1),G(D,i,0)),G(h,i,.5))}function X(e,t){t&&(e?(G(M,k,1),G(v,k,0),G(T,B,0),G(M,k,1),G(T,B,0),G(A,B,1),G(T,k,0),G(h,B,.5),G(A,B,1),G(h,B,.5),G(C,k,0),G(A,B,1)):(G(M,k,1),G(v,k,0),G(_,B,1),G(v,k,0),G(A,B,0),G(_,B,1),G(_,k,1),G(A,B,0),G(h,B,.5),G(h,B,.5),G(A,B,0),G(D,k,1)))}function Y(e,i,r,n,a,s){switch(t.strokeLineCap){case"round":a?H(e,r,i,s,.5):H(e,i,r,s,.5);break;case"square":if(a)m.subVectors(i,e),f.set(m.y,-m.x),g.addVectors(m,f).add(e),y.subVectors(f,m).add(e),n?(g.toArray(o,3),y.toArray(o,0),y.toArray(o,9)):(g.toArray(o,3),g.toArray(o,9),y.toArray(o,0));else{m.subVectors(r,e),f.set(m.y,-m.x),g.addVectors(m,f).add(e),y.subVectors(f,m).add(e);let t=o.length;n?(g.toArray(o,t-3),y.toArray(o,t-6)):(g.toArray(o,t-6),y.toArray(o,t-3)),y.toArray(o,t-12)}}}function J(e){let t=!1;for(let i=1,r=e.length-1;i<r;i++)if(e[i].distanceTo(e[i+1])<n){t=!0;break}if(!t)return e;let i=[];i.push(e[0]);for(let t=1,r=e.length-1;t<r;t++)e[t].distanceTo(e[t+1])>=n&&i.push(e[t]);return i.push(e[e.length-1]),i}}}}),parcelRequire.register("15Luk",function(e,t){e.exports=JSON.parse('{"version":"3.6.0"}')}),parcelRequire.register("6RSze",function(e,t){$parcel$export(e.exports,"ToolsController",()=>m);var i=parcelRequire("6JsYu"),r=parcelRequire("e6bmt"),n=parcelRequire("8QOPd");parcelRequire("9HO6e");var o=parcelRequire("eA4zA"),a=parcelRequire("9xc3p"),s=parcelRequire("lYvzi"),l=parcelRequire("bXJaA"),h=parcelRequire("jqJhK"),c=parcelRequire("5Euub"),d=parcelRequire("4w6re"),u=parcelRequire("fcFxQ"),p=parcelRequire("hwhH1");class m{constructor(e,t){this.editor=e,this.useType=t}main(){switch(this.editor.toolType){case"wall":"moveDraw"==this.useType?(this.editor.list.stopPlayer.dispatch(),new(0,i.WallCommand)(this.editor).drawMain()):(this.editor.list.startPlayer.dispatch(),this.editor.execute(new i.WallCommand(this.editor),"画墙"));break;case"room":"moveDraw"==this.useType?(this.editor.list.stopPlayer.dispatch(),new(0,s.RoomCommand)(this.editor).drawMain()):(this.editor.list.startPlayer.dispatch(),this.editor.execute(new s.RoomCommand(this.editor),"画墙"));break;case"splitTool":"moveDraw"==this.useType?(this.editor.list.stopPlayer.dispatch(),new(0,u.SplitToolCommand)(this.editor).drawMain()):(this.editor.list.startPlayer.dispatch(),this.editor.execute(new u.SplitToolCommand(this.editor),"分割"));break;case"slidingdoor":case"doubledoor":case"window":case"baywindow":case"pass":case"frenchwindows":case"singledoor":case"singleDoubleDoor":case"childMotherDoor":case"moveDoor":case"straightWindow":case"straightBayWindow":case"UWindow":case"UBayWindow":case"UBayWindow":case"dooropen":case"archDoor":case"archWindow":case"arcDoor":case"arcWindow":case"LWindow":case"LBayWindow":case"UWindow":case"UBayWindow":case"door":"moveDraw"==this.useType?(this.editor.list.stopPlayer.dispatch(),new(0,o.DrawCommand)(this.editor).drawMain()):(this.editor.list.startPlayer.dispatch(),this.editor.execute(new o.DrawCommand(this.editor),"画门"));break;case"bridge":case"flue":case"post":"moveDraw"==this.useType?(this.editor.list.stopPlayer.dispatch(),new(0,a.MemberCommand)(this.editor).drawMain()):(this.editor.list.startPlayer.dispatch(),this.editor.execute(new a.MemberCommand(this.editor),"画梁"));break;case"free":if(""!=this.editor.currentDownSelect&&"moveMesh"==this.useType){if(10>this.editor.currentPoint.clone().distanceTo(this.editor.downPoint.clone()))return;let e=this.editor.currentDownSelect[0].object.useType;if("wall"==e)this.editor.execute(new n.MoveWallCommand(this.editor),"移动墙");else if("rotateTool"==e||"scaleTool"==e)this.editor.execute(new h.TransformToolCommand(this.editor),"旋转工具");else if("dragPoint"==e)this.editor.execute(new l.VertexMoveCommand(this.editor),"拖拽点");else if("scaleRuleTool"==e)this.editor.execute(new c.ScaleRuleToolCommand(this.editor),"比例尺");else if("scaleHelpTool"==e)this.editor.execute(new c.ScaleRuleToolCommand(this.editor,"move"),"比例尺");else if("bseControl"==e)this.editor.execute(new d.BezierMoveCommand(this.editor),"贝塞尔移动");else if("movePoint"==this.editor.currentDownSelect[0].object.useType)this.editor.execute(new o.DrawCommand(this.editor),"移动窗");else{let e=["beam","flue","pillars"],t=this.editor.currentDownSelect[0].object,i=e.indexOf(this.editor.currentDownSelect[0].object.parent.modelType)>=0||t.modelType&&t.modelType.indexOf("Model")>=0;if(this.editor.currentDownSelect[0].object.parent&&this.editor.currentDownSelect[0].object.parent.isLock)this.editor.doorHelperGroupClean();else if(i){let i=!1;(i=e.indexOf(this.editor.currentDownSelect[0].object.parent.modelType)>=0?this.editor.currentDownSelect[0].object.parent.isLock:this.editor.getOuterParent(t).isLock)||(e.indexOf(this.editor.currentDownSelect[0].object.parent.modelType)>=0?this.editor.execute(new p.MoveMemberCommand(this.editor),"移动"):0!=this.editor.clickSelect.length&&this.editor.execute(new h.TransformToolCommand(this.editor),"移动"))}else this.editor.execute(new o.DrawCommand(this.editor),"移动窗")}}else new(0,r.FreeMoveCommand)(this.editor).main()}}}}),parcelRequire.register("e6bmt",function(e,t){$parcel$export(e.exports,"FreeMoveCommand",()=>m);var i=parcelRequire("9HO6e"),r=parcelRequire("hWloQ"),n=parcelRequire("eA4zA"),o=parcelRequire("8QOPd"),a=parcelRequire("bXJaA"),s=parcelRequire("jqJhK"),l=parcelRequire("5Euub"),h=parcelRequire("4w6re"),c=parcelRequire("gLad4"),d=parcelRequire("9QhXH"),u=parcelRequire("4xklQ"),p=parcelRequire("hwhH1");class m{constructor(e){this.editor=e}main(){for(let e=0;e<this.editor.allWalls.length;e++){let t=this.editor.allWalls[e];if(t.children=[],!(this.editor.clickSelect.length>0)||this.editor.clickSelect[0].object!=t){if(t.isArc&&"bezier"==t.isArc){let e=this.editor.pointHelperGroup.children.slice(0),i=!1;e.some(e=>{if("bseControl"==e.useType)return i=!0,!0}),i||(t.material.color=this.editor.getWallColor(t))}else t.material.color=this.editor.getWallColor(t)}}let e=this.editor.pointHelperGroup.children.slice(0);for(let t=0;t<e.length;t++){let i=e[t];"moveOuterPoint"==i.useType&&this.editor.pointHelperGroup.remove(i),"rotateTool"==i.useType&&i.children.forEach(e=>{"Mesh"==e.type?e.material.color=this.editor.config.angleToolUnChooseColor:e.children[1].material.color=this.editor.config.angleToolUnChooseColor})}this.editor.modelHelperGroup.children.slice(0).forEach(e=>{"moveModelBox"==e.name&&e.parent.remove(e)});let t="";if(this.editor.currentMoveSelect.length>0){let e=this.editor.currentMoveSelect[0].object;if(t=e,e.parent&&e.parent.type&&"Group"==e.parent.type&&e.parent.children.forEach(e=>{("Line"==e.type||"Line2"==e.type||"DWHelper"==e.type)&&e.material.color.equals(this.editor.moveDoorOutColor)&&!e.material.color.equals(this.editor.clickColor)&&(e.material.color=this.editor.moveDoorColor)}),"CodeModel"==this.editor.getOuterParent(e).modelType){let t=this.editor.getOuterParent(e),i=new(0,u.Box3)().setFromObject(t),r=this.editor.wallHelp.addOBBbox(t,"#00EEFF");if(r.name="moveModelBox",r.layers.set(2),"UWindowMesh"==t.type&&(r.position.y+=(i.max.y-i.min.y)/2),"LWindowMesh"==t.type){let e=new u.Vector3;i.getCenter(e),r.position.copy(e.clone())}r.material.depthTest=!1,this.editor.modelHelperGroup.add(r);return}if("3dMember"==e.parent.name){let t=this.editor.wallHelp.addOBBbox(e,"#00EEFF");t.name="moveModelBox",t.layers.set(2),this.editor.modelHelperGroup.add(t);return}if("wall"==e.useType){if(this.editor.dom.style.cursor=(0,i.UtilCore).getCursorByWall(e),!(this.editor.clickSelect.length>0&&this.editor.clickSelect[0].object==e)&&0==this.editor.currentDownSelect.length&&(e.material.color=this.editor.chooseColor,!e.isArc)){let t=e.startPoint.clone().distanceTo(e.endPoint)/this.editor.config.wallNum,r=e.geometry.attributes.position.array,n=new u.Vector3(r[0],r[1],r[2]);new u.Vector3(r[3],r[4],r[5]);let o=new u.Vector3(r[6],r[7],r[8]),a=new u.Vector3(r[9],r[10],r[11]);new u.Vector3(r[12],r[13],r[14]);let s=new u.Vector3(r[15],r[16],r[17]),l=(0,i.UtilCore).toVector3(e.endPoint).sub((0,i.UtilCore).toVector3(e.startPoint)),h=(0,i.UtilCore).toVector3(e.startPoint).add(l.setLength(t)),c=(0,i.UtilCore).toVector3(e.startPoint).add(l.setLength(t*(this.editor.config.wallNum-1))),d=new u.Vector3(-l.y,l.x,0),p=h.clone().add(d.setLength(e.thickness/2)),m=h.clone().add(d.setLength(e.thickness/2).negate()),f=c.clone().add(d.setLength(e.thickness/2)),g=c.clone().add(d.setLength(e.thickness/2).negate()),y=this.editor.wallHelp.createSplitWallMesh([n,o,p,m],this.editor.config.wallFirstMaterial),x=this.editor.wallHelp.createSplitWallMesh([f,g,s,a],this.editor.config.wallFirstMaterial);e.add(y,x)}}else if("movePoint"==e.useType){let t=e.positionCenter;this.editor.pointHelperGroup.add(new(0,r.WallHelp)().createDoorOuterPoint(t))}else if("dragPoint"==e.useType){let t=e.parent.center;this.editor.pointHelperGroup.add(new(0,r.WallHelp)().createDoorOuterPoint(t,2*e.parent.radio,"rgb(26, 122, 251)")),this.editor.dom.style.cursor="move"}else if("rotateTool"==e.useType)e.parent.children.forEach(e=>{"Mesh"==e.type?e.material.color=this.editor.config.angleToolChooseColor:e.children[1].material.color=this.editor.config.angleToolChooseColor});else if("scalePoint"==e.useType)this.editor.dom.style.cursor=(0,i.UtilCore).getCursorByScaleTool(e.linePoint[0],e.linePoint[1]);else if("scaleRuleTool"==e.useType){let t=e.positionCenter;this.editor.pointHelperGroup.add(new(0,r.WallHelp)().createDoorOuterPoint(t,100,"rgb(26, 122, 251)"))}else if("bseControl"==e.useType)this.editor.dom.style.cursor="move";else if("floor"==e.useType)for(let t=0;t<e.allPoints.length;t++){let i=e.allPoints[t],r=e.allPoints[0];t!=e.allPoints.length-1&&(r=e.allPoints[t+1]);let n=(0,d.DM).createLine([i,r],"#00EEFF",!1,2.5);n.useType="splitOuterLine",this.editor.splitRoomLineGroup.add(n)}}if(this.editor.mouseCoverObj&&(t=this.editor.mouseCoverObj),t){let e=this.editor.getOuterParent(t);if(this.editor.mouseCoverObj&&(e=this.editor.mouseCoverObj),e&&!e.visible)return;let i=[];this.editor.selectObjArr.forEach(e=>{let t=this.editor.getOuterParent(e);i.push(t.uuid)});let r=0>i.indexOf(e.uuid);if(("3DModel"==e.modelType||"modelGroup"==e.modelType)&&r){let t=[e];"modelGroup"==e.modelType&&(t=t.concat(e.children.slice(0))),t.forEach(e=>{let t=this.editor.wallHelp.addOBBbox(e,"#00EEFF");t.name="moveModelBox",t.layers.set(2),this.editor.modelHelperGroup.add(t);let i=this.editor.wallHelp.addOBB2DBox(t,"#00EEFF");i.name="moveModelBox",this.editor.modelHelperGroup.add(i)})}else if(("2DModel"==e.modelType||"2dModelGroup"==e.modelType)&&r){let t=[e];"2dModelGroup"==e.modelType&&(t=t.concat(e.children.slice(0))),t.forEach(e=>{let t=this.editor.wallHelp.addOBBbox(e.param[0],"#00EEFF");t.name="moveModelBox",t.layers.set(2),this.editor.modelHelperGroup.add(t);let i=this.editor.wallHelp.addOBB2DBox(t,"#00EEFF");i.name="moveModelBox",this.editor.modelHelperGroup.add(i)})}}if(this.editor.currentDownSelect.length>0){if(this.editor.currentDownSelect[0].object.parent&&"CodeModel"==this.editor.currentDownSelect[0].object.parent.modelType)return;let e=this.editor.currentDownSelect[0].object.useType;if("wall"==e)new(0,o.MoveWallCommand)(this.editor).moveWallMain();else if("dragPoint"==e)new(0,a.VertexMoveCommand)(this.editor).moveVertexMain();else if("rotateTool"==e)new(0,s.TransformToolCommand)(this.editor,"rotateTool").drawMain();else if("scalePoint"==e)new(0,s.TransformToolCommand)(this.editor,"scaleTool").drawMain();else if("scaleRuleTool"==e)new(0,l.ScaleRuleToolCommand)(this.editor).drawMain();else if("scaleHelpTool"==e)new(0,l.ScaleRuleToolCommand)(this.editor,"move").drawMain();else if("bseControl"==e)new(0,h.BezierMoveCommand)(this.editor).drawMain(this.editor.currentDownSelect[0].object.wall);else if(this.editor.dom.style.cursor="move","movePoint"==this.editor.currentDownSelect[0].object.useType)new(0,n.DrawCommand)(this.editor,"door",this.editor.currentDownSelect[0].object.positionType).drawMain();else{let e=["beam","flue","pillars"],t=this.editor.currentDownSelect[0].object;if(e.indexOf(this.editor.currentDownSelect[0].object.parent.modelType)>=0||t.modelType&&t.modelType.indexOf("Model")>=0){let i=!1;if(i=e.indexOf(this.editor.currentDownSelect[0].object.parent.modelType)>=0?this.editor.currentDownSelect[0].object.parent.isLock:this.editor.getOuterParent(t).isLock){let e=this.editor.getScreenPosition(this.editor.currentPoint.clone());this.editor.list.blackBox.dispatch(e.x,e.y,"该模型已锁定,请先解锁")}else{let i=!1;if(this.editor.pointHelperGroup.children.forEach(e=>{("rotateTool"==e.useType||"scaleTool"==e.useType)&&(i=!0)}),i){let i=this.editor.getOuterParent(t);i&&i.modelType&&(i.modelType.indexOf("Model")>=0||i.modelType.indexOf("model")>=0)?this.editor.mouseCoverObj=i:e.indexOf(this.editor.currentDownSelect[0].object.parent.modelType)>=0?new(0,p.MoveMemberCommand)(this.editor).main():new(0,s.TransformToolCommand)(this.editor,"moveTool").drawMain()}}}else{let e=this.editor.getOuterParent(t);if(e&&e.modelType&&(e.modelType.indexOf("Model")>=0||e.modelType.indexOf("model")>=0)){let t=e.isLock;if(!e.visible)return;if(t){let e=this.editor.getScreenPosition(this.editor.currentPoint.clone());this.editor.list.blackBox.dispatch(e.x,e.y,"该模型已锁定,请先解锁")}else if(this.editor.mouseCoverObj=e,!this.editor.controlsArr[1].enableRotate){this.editor.modelHelperGroup.children=[],this.editor.list.hiddenDialog.dispatch();let t=this.editor.wallHelp.addOBBbox(e,"#00EEFF");t.name="moveModelBox",t.layers.set(2),this.editor.modelHelperGroup.add(t),this.editor.doorHelperGroupClean(),this.editor.addLineHelperForMember(e.param[0])}}else if(this.editor.currentDownSelect[0].object.parent.isLock){let e=this.editor.getScreenPosition(this.editor.currentPoint.clone());this.editor.list.blackBox.dispatch(e.x,e.y,"该模型已锁定,请先解锁")}else new(0,n.DrawCommand)(this.editor,"door").drawMain()}}}""==this.editor.mouseCoverObj||(this.editor.controlsArr[1].enableRotate||this.editor.camera.isOrthographicCamera)&&!this.editor.camera.isOrthographicCamera||new(0,c.PreventObj)(this.editor).main()}}}),parcelRequire.register("8QOPd",function(e,t){$parcel$export(e.exports,"MoveWallCommand",()=>c);var i=parcelRequire("9HO6e"),r=parcelRequire("73HrS"),n=parcelRequire("65FdD"),o=parcelRequire("eA4zA"),a=parcelRequire("4xklQ"),s=parcelRequire("hWloQ"),l=parcelRequire("9QhXH"),h=parcelRequire("5XTH3");class c{constructor(e){this.editor=e,this.moveCommandObj={},this.repairCommandObj=[],this.splitWallCommand="",this.sureMove=!1,this.wallCore=new r.WallCore(this.editor),this.wallHelper=new s.WallHelp(this.editor),this.spiltWall=[],this.spiltOldWall=[],this.linkWall=[]}moveWallMain(){if(!this.editor.startChooseWall[0]||this.editor.currentDownSelect.length>0&&"bezier"==this.editor.currentDownSelect[0].object.isArc)return;let e="",t="",r="",n=this.editor.currentDownSelect[0].object;r=n;let o=this.editor.allWalls.slice(0),s=[];this.editor.moveRule||(this.editor.moveRule=(0,i.UtilCore).getWallMoveRule(n,o,this.editor),o.forEach(e=>{let t=e.clone();t.startPoint=e.startPoint.clone(),t.endPoint=e.endPoint.clone(),s.push(t)}),this.editor.moveRule.push(s));let h=this.moveCoreMain(n,this.editor.moveRule);if(!r.isArc&&(!h||!h[0]||!h[1]))return;this.editor.scene.remove(n),this.editor.removeHelperByWall(n);let c=this.editor.allWalls.indexOf(n);if(c>=0&&this.editor.allWalls.splice(c,1),""!=this.editor.currenDraw){let e=this.editor.allWalls.indexOf(this.editor.currenDraw);e>=0&&this.editor.allWalls.splice(e,1),this.editor.scene.remove(this.editor.currenDraw),this.editor.removeHelperByWall(this.editor.currenDraw)}if(e=h[0],t=h[1],this.moveCommandObj.oldMesh=this.editor.startChooseWall[0].object,r.isArc){let e=r.startPoint,t=r.endPoint;""!=this.editor.circlePoint&&this.editor.scene.remove(this.editor.circlePoint),this.editor.circlePoint=this.wallHelper.createNormalPoint(this.editor.currentPoint),this.editor.scene.add(this.editor.circlePoint),this.editor.currenDraw=this.wallCore.createCircleWall(e,t,this.editor.currentPoint,r.isArc,this.moveCommandObj.oldMesh.thickness)}else this.editor.currenDraw=this.wallCore.createLineWall(e,t,this.moveCommandObj.oldMesh.thickness);this.editor.currenDraw.cover=h[2],this.editor.currenDraw.isArc=r.isArc,this.editor.currenDraw.style=r.style,this.editor.currenDraw.height=r.height,this.editor.currenDraw.thickness=r.thickness,this.moveCommandObj.currentMesh=this.editor.currenDraw;let d=(0,i.UtilCore).getAllWallLine(this.editor.currentDownSelect[0].object);this.editor.currentDownSelect&&(this.editor.currentDownSelect[0].object=this.editor.currenDraw),this.editor.scene.add(this.editor.currenDraw),this.editor.allWalls.push(this.editor.currenDraw);let u=d[0].concat(d[1]);u=(u=u.concat(d[3])).concat(d[2]);let p=this.editor.splitRoomLine.children.slice(0),m=(0,i.UtilCore).handleLineData(e,t);p.forEach(e=>{let t=e.startPoint,r=e.endPoint,n=this.editor.PolyK.ContainsPoint(u,t.x,t.y),o=this.editor.PolyK.ContainsPoint(u,r.x,r.y),a=(0,i.UtilCore).handleLineData(t,r),s=(0,i.UtilCore).lineIsIntersection(a,m);n&&s&&(this.editor.splitRoomLine.remove(e),this.editor.addSplitLine(s,r,e.useType)),o&&s&&(this.editor.splitRoomLine.remove(e),this.editor.addSplitLine(t,s,e.useType))}),this.editor.currenDraw.wallID=this.editor.startChooseWall[0].object.wallID,this.editor.otherMember.forEach(e=>{if(!e.parameter)return;let t=this.editor.startChooseWall[0].object;if(e.parameter.leftWall.includes(t.wallID)||e.parameter.rightWall.includes(t.wallID)){let t=(0,l.DM).memberJson([e]);this.editor.otherMember.splice(this.editor.otherMember.indexOf(e),1),this.editor.scene.remove(e),t.forEach(e=>{let t,i=new a.Vector3(e.location.x,e.location.y,e.location.z);"beam"==e.type&&((t=(0,l.DM).createBeam(i,"beam",e.angle,e.height,e.depth,this.editor.allWalls)).rotation.z=e.rotation,this.editor.otherMember.push(t),this.editor.scene.add(t))})}})}execute(){if(""!=this.editor.currenDraw&&(this.editor.currentDownSelect.length>0||"{}"!=JSON.stringify(this.moveCommandObj))){this.sureMove=!0,this.moveWallMain(),this.editor.moveRule="",""!=this.editor.circlePoint&&this.editor.scene.remove(this.editor.circlePoint),this.editor.circlePoint="";let e=this.editor.currenDraw;if(this.editor.currenDraw){this.editor.addLineWallHelper(this.editor.currenDraw.startPoint,this.editor.currenDraw.endPoint),this.splitWallCommand=new n.SplitWallCommand(this.editor),this.spiltWall.push(this.editor.currenDraw);let e=this.spiltWall.slice(0),t=[];e.forEach(e=>{t.push(e.wallID)}),this.linkWall.forEach(i=>{0>t.indexOf(i.wallID)&&e.push(i)}),e.forEach(e=>{this.editor.currenDraw=e,this.splitWallCommand.splitMain()})}this.editor.currenDraw=e;let t="";this.editor.startChooseWall?(t=this.editor.startChooseWall[0].object,this.editor.currenDraw.wallID=t.wallID):t=this.moveCommandObj.oldMesh;let s=this.editor.currenDraw,c=0,d=(0,l.DM).getWallJson(this.editor.allWalls),u=new h.DrawWallTool;this.editor.allWalls=u.create2DWall(d),this.editor.allWalls.pop(),this.spiltOldWall.forEach(e=>{let t=this.editor.getWallByWallId(this.spiltWall[c].wallID),r=(0,i.UtilCore).getNewPoint(t),n=(0,i.UtilCore).getNewPoint(t,"end");this.editor.getAllWindowInWall(t).forEach(a=>{if(!a.center)return;let s=(0,i.UtilCore).getNewPoint(e[0]),l=(0,i.UtilCore).getNewPoint(e[0],"end"),h=1*(0,i.UtilCore).toVector3(a.center).distanceTo((0,i.UtilCore).toVector3(s)),c=1*(0,i.UtilCore).toVector3(a.center).distanceTo((0,i.UtilCore).toVector3(l)),d=h,u="start";h>c&&(d=c,u="end");let p=r.clone().add(t.endPoint.clone().sub(t.startPoint.clone()).setLength(d));if("end"==u&&(p=n.clone().add(t.startPoint.clone().sub(t.endPoint.clone()).setLength(d))),this.editor.currentDoor=a,this.editor.currenDraw=a,"circle"==t.isArc){let i=t.cp.distanceTo(t.arcCenter),s=a.center.clone().sub(e[0].arcCenter.clone()),l=t.arcCenter.clone().add(s.setLength(i));new(0,o.DrawCommand)(this.editor,"door","end",[a,[l,r,n,t.arcCenter],"center"]).execute()}else new(0,o.DrawCommand)(this.editor,"door","end",[a,[p,r,n],"center"]).execute();this.editor.doorHelperGroupClean(),this.editor.currentDoor=""}),c+=1}),this.editor.currenDraw=s,this.editor.currenDraw.wallID=t.wallID;let p=new a.Vector3((t.startPoint.x+t.endPoint.x)/2,(t.startPoint.y+t.endPoint.y)/2),m=this.editor.getAllWindowInWall(t),f=0,g=0;if("circle"==t.isArc&&(f=this.editor.currenDraw.cp.distanceTo(this.editor.currenDraw.arcCenter),g=this.editor.currenDraw.arcCenter),m.length>0){let e=(0,i.UtilCore).getNewPoint(this.editor.currenDraw),r=(0,i.UtilCore).getNewPoint(this.editor.currenDraw,"end"),n=new a.Vector3((e.x+r.x)/2,(e.y+r.y)/2,0).clone().sub(p.clone());m.forEach(i=>{if(!i.center)return;this.editor.currentDoor=i;let a=i.center.clone().add(n.clone());if(this.editor.currenDraw=i,"circle"==t.isArc){let n=i.center.clone().sub(t.arcCenter.clone()),a=g.clone().add(n.setLength(f));new(0,o.DrawCommand)(this.editor,"door","end",[i,[a,e,r,g],"center"]).execute()}else new(0,o.DrawCommand)(this.editor,"door","end",[i,[a,e,r],"center"]).execute();this.editor.doorHelperGroupClean(),this.editor.currentDoor=""})}this.editor.currenDraw&&(this.delCommonPoint(this.editor.currenDraw.startPoint.clone()),this.delCommonPoint(this.editor.currenDraw.endPoint.clone())),this.editor.currenDraw="";let y=this.editor.allWalls.slice(0);y.forEach(e=>{let t=(0,i.UtilCore).getSamePositionWall(e,y).map(t=>t.isArc==e.isArc?t:null).filter(e=>e);if(t.length>1){let r=t.pop();(0,i.UtilCore).extendParamWall(e,r),t.forEach(e=>{this.editor.removeWall(e)})}(0,i.UtilCore).isSameVector(e.startPoint,e.endPoint)&&this.editor.removeWall(e)}),new(0,r.WallCore)(this.editor).wallToJson();let x=[];this.editor.otherMeshs.forEach(e=>{let t=this.editor.getWallByWallId(e.wallId),r=!1;""==t&&(r=!0,this.editor.allWalls.forEach(t=>{(0,i.UtilCore).pointInLine(e.center,(0,i.UtilCore).handleLineData(t.startPoint,t.endPoint))&&(0,i.UtilCore).pointIsInLine(e.center,t.startPoint,t.endPoint)&&(e.wallId=t.wallID,e.wallDep=t.thickness,e.wallStartPoint=t.startPoint,e.wallEndPoint=t.startPoint,r=!1)})),r&&x.push(e)}),x.forEach(e=>{this.editor.scene.remove(e),this.editor.otherMeshs.indexOf(e)>=0&&this.editor.otherMeshs.splice(this.editor.otherMeshs.indexOf(e),1)})}}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}delCommonPoint(e){let t=(0,i.UtilCore).havePointWall(e,this.editor.allWalls);2==t.length&&(0,i.UtilCore).wallIsInLine(t[0],t[1])&&(this.editor.pointHelperGroup.children.slice(0).forEach(e=>{("clickPoint"==e.useType||"moveOuterPoint"==e.useType)&&e.parent.remove(e)}),this.editor.margeWall(t[0],t[1]))}getNearPoint(e,t,r){let n=!!t&&(0,i.UtilCore).handleLineData(t.startPoint,t.endPoint),o=!!r&&(0,i.UtilCore).handleLineData(r.startPoint,r.endPoint),a="",s=0,l="",h=0;return this.editor.moveRule[7].forEach(t=>{if(t.uuid==e.uuid)return;let r=!!n&&(0,i.UtilCore).pointInLine(t.startPoint,n),c=!!n&&(0,i.UtilCore).pointInLine(t.endPoint,n),d=!!o&&(0,i.UtilCore).pointInLine(t.startPoint,o),u=!!o&&(0,i.UtilCore).pointInLine(t.endPoint,o);if(r||c||d||u){if(r||c){let i=t.startPoint;c&&(i=t.endPoint);let r=e.startPoint.clone().distanceTo(i);0==s?(a=i,s=r):r<s&&(a=i,s=r)}if(d||u){let i=t.startPoint;c&&(i=t.endPoint);let r=e.endPoint.clone().distanceTo(i);0==h?(l=i,h=r):r<h&&(l=i,h=r)}}}),[a,l,s,h]}moveCoreMain(e,t){let r=!1,n=t[0],o=t[1],a=t[2],s=t[3],l="",h="",c=(0,i.UtilCore).handleLineData(e.startPoint,e.endPoint),d=(0,i.UtilCore).moveLineToPoint(this.editor.currentPoint,c.slice(0)),u=this.getNearPoint(e,n,o),p="",m="";u[0]&&u[1]?u[2]>u[3]?(p=u[3],m=u[1]):(p=u[2],m=u[0]):(u[0]&&(p=u[2],m=u[0]),u[1]&&(p=u[3],m=u[1]));let f=this.editor.startChooseWall[0].object;if(f.uuid==e.uuid){let t=(0,i.UtilCore).handleLineData(f.startPoint,f.endPoint);if((0,i.UtilCore).getDistanceLine(t,d)<e.thickness)return}else if(e.cover){let t=e.cover.clone();if((0,i.UtilCore).smallDistanceByPointOnLine(d,t).clone().distanceTo((0,i.UtilCore).toVector3(t))<e.thickness)return}else""!=p&&p<e.thickness/2&&(d=(0,i.UtilCore).moveLineToPoint(m,c.slice(0)),r=m);if(0==a.length){let t=this.handleLineData(c,e.startPoint),r=(0,i.UtilCore).lineIsIntersection(d,t);r&&(l=r)}else if(1==a.length){let t=(0,i.UtilCore).handleLineData(n.startPoint,n.endPoint),r=(0,i.UtilCore).lineIsIntersection(d,t);if(r)l=r;else{let t=this.handleLineData(c,e.startPoint),r=(0,i.UtilCore).lineIsIntersection(d,t);r&&(l=r)}}else{let e=(0,i.UtilCore).handleLineData(n.startPoint,n.endPoint),t=(0,i.UtilCore).lineIsIntersection(d,e);t&&(l=t)}if(0==s.length){let t=this.handleLineData(c,e.endPoint),r=(0,i.UtilCore).lineIsIntersection(d,t);r&&(h=r)}else if(1==s.length){let t=(0,i.UtilCore).handleLineData(o.startPoint,o.endPoint),r=(0,i.UtilCore).lineIsIntersection(d,t);if(r)h=r;else{let t=this.handleLineData(c,e.endPoint),r=(0,i.UtilCore).lineIsIntersection(d,t);r&&(h=r)}}else{let e=(0,i.UtilCore).handleLineData(o.startPoint,o.endPoint),t=(0,i.UtilCore).lineIsIntersection(d,e);t&&(h=t)}return l&&h&&!e.isArc&&(this.editor.allWalls.slice(0).forEach(e=>{"move"==e.status&&this.editor.removeWall(e)}),n&&this.repairWallNew(l,this.editor.moveRule[4],e,n,a,"start",this.editor.moveRule[6]),o&&this.repairWallNew(h,this.editor.moveRule[5],e,o,s,"end",this.editor.moveRule[6])),[l,h,r]}repairWallNew(e,t,r,n,o,a,s){let l="",h="",c=0;if(this.editor.moveRule[7].forEach(o=>{if((0,i.UtilCore).checkSameWall(o,s))return;let a=(0,i.UtilCore).checkWallContainPoint(e.x,e.y,o.startPoint.x,o.startPoint.y,o.endPoint.x,o.endPoint.y),d=(0,i.UtilCore).checkWallContainPoint(o.startPoint.x,o.startPoint.y,e.x,e.y,t.x,t.y),u=(0,i.UtilCore).checkWallContainPoint(o.endPoint.x,o.endPoint.y,e.x,e.y,t.x,t.y),p=(0,i.UtilCore).handleLineData(n.startPoint,n.endPoint),m=(0,i.UtilCore).handleLineData(o.startPoint,o.endPoint),f=(0,i.UtilCore).lineIsIntersection(p,m);a&&!f&&(l=o);let g="";if(d&&(g=o.startPoint),u&&(g=o.endPoint),!g||(0,i.UtilCore).isSameVector(g,e)||(0,i.UtilCore).isSameVector(t,g)||o.uuid==r.uuid)return;let y=g.clone().distanceTo(e);0==c?(h=g,c=y):y<c&&(h=g)}),l)1==o.length?h?this.editor.removeWall(o[0]):this.repairWall(o[0],e,t):2==o.length&&this.mergeWall(o);else if(h){let t=(0,i.UtilCore).havePointWall(h,this.editor.moveRule[7],r);if(2==o.length&&this.mergeWall(o),t.length>1)this.repairWall(r,e,h,"newWall");else{let t=(0,i.UtilCore).havePointWall(h,this.editor.allWalls,r);this.repairWall(t[0],e,h)}}else 1!=o.length||(0,i.UtilCore).wallIsInLine(s,n)?(2==o.length&&this.mergeWall(o),(0,i.UtilCore).checkSameWallByPoint(n.startPoint,n.endPoint,e,t)||this.repairWall(r,e,t,"newWall")):this.repairWall(n,e,t)}getWallIntersection(e,t){if(e.isArc)return[1,1];let r=!1,n=e.startPoint,o=e.endPoint,a=(0,i.UtilCore).handleLineData(n,o),s="",l="",h=(0,i.UtilCore).moveLineToPoint(this.editor.currentPoint,a.slice(0));if(t[4]||t[5]){0!=t[0].length&&this.linkWall.push(...t[0]),0!=t[1].length&&this.linkWall.push(...t[1]);let s=t[0],l=t[2],c="start";if(t[5]&&(s=t[1],l=t[3],c="end"),t[4]&&t[5]){let r=(0,i.UtilCore).isSameVector(e.startPoint,t[2]),n=(0,i.UtilCore).isSameVector(e.endPoint,t[3]);n||r?n&&(s=t[0],l=t[2],c="start"):e.startPoint.clone().distanceTo(t[2].clone())<e.endPoint.clone().distanceTo(t[3].clone())?(s=t[0],l=t[2],c="start"):(s=t[1],l=t[3],c="end")}let d=l.clone().distanceTo((0,i.UtilCore).toVector3(n));"end"==c&&(d=l.clone().distanceTo((0,i.UtilCore).toVector3(o)));let u=this.editor.startChooseWall[0].object;if(u.wallID==e.wallID){let t=(0,i.UtilCore).handleLineData(u.startPoint,u.endPoint);if((0,i.UtilCore).getDistanceLine(t,h)<e.thickness)return}else if(e.cover){let t=e.cover.clone();if((0,i.UtilCore).smallDistanceByPointOnLine(h,t).clone().distanceTo((0,i.UtilCore).toVector3(t))<e.thickness)return}else 0!=d&&(h=(0,i.UtilCore).moveLineToPoint(l,a.slice(0)),r=l)}if(0==t[0].length){let e=this.handleLineData(a,n),t=(0,i.UtilCore).lineIsIntersection(h,e);t&&(s=t)}else if(1==t[0].length){let r=(0,i.UtilCore).handleLineData(t[0][0].startPoint,t[0][0].endPoint),o=(0,i.UtilCore).lineIsIntersection(h,r);if(o)s=o,(0,i.UtilCore).checkHaveSameVertex(e,t[0][0])&&this.repairWall(t[0][0],s,t[2]);else{let r=this.handleLineData(a,n),o=(0,i.UtilCore).lineIsIntersection(h,r);o&&(s=o,this.repairWall(e,t[2],s,"newWall"))}}else if(t[0].length>1){let r=(0,i.UtilCore).getRealWallByIntersection(e,this.editor.currentPoint.clone(),t[0],t[2],"start");r=this.editor.moveRule[0];let o=(0,i.UtilCore).handleLineData(r.startPoint,r.endPoint),l=(0,i.UtilCore).lineIsIntersection(h,o);if(2==t[0].length&&this.mergeWall(t[0]),l&&(s=l),l)(0,i.UtilCore).pointIsInLine(s,r.startPoint,r.endPoint)||this.repairWall(r,s,t[2],"noMarge");else{let r=this.handleLineData(a,n),o=(0,i.UtilCore).lineIsIntersection(h,r);o&&(s=o,this.repairWall(e,t[2],s,"newWall"))}}if(0==t[1].length){let e=this.handleLineData(a,o),t=(0,i.UtilCore).lineIsIntersection(h,e);t&&(l=t)}else if(1==t[1].length){let r=(0,i.UtilCore).handleLineData(t[1][0].startPoint,t[1][0].endPoint),n=(0,i.UtilCore).lineIsIntersection(h,r);if(n)l=n,(0,i.UtilCore).checkHaveSameVertex(e,t[1][0])&&this.repairWall(t[1][0],l,t[3]);else{let r=this.handleLineData(a,o),n=(0,i.UtilCore).lineIsIntersection(h,r);n&&(l=n,this.repairWall(e,t[3],l,"newWall"))}}else if(t[1].length>1){let r=(0,i.UtilCore).getRealWallByIntersection(e,this.editor.currentPoint.clone(),t[1],t[3],"end");r=this.editor.moveRule[1];let n=(0,i.UtilCore).handleLineData(r.startPoint,r.endPoint),s=(0,i.UtilCore).lineIsIntersection(h,n);if(2==t[1].length&&this.mergeWall(t[1]),s&&(l=s),s)(0,i.UtilCore).pointIsInLine(l,r.startPoint,r.endPoint)||this.repairWall(r,l,t[3],"noMarge");else{let r=this.handleLineData(a,o),n=(0,i.UtilCore).lineIsIntersection(h,r);n&&(l=n,this.repairWall(e,t[3],l,"newWall"))}}return[s,l,r]}handleLineData(e,t){let i=e.slice(0);return"X"==e[0]?(i[0]="Y",i[2]=t.x):"Y"==e[0]?(i[0]="X",i[2]=t.y):(i[0]="XY",i[1]=-1/e[1],i[2]=t.y-i[1]*t.x),i}mergeWall(e){if(2!=e.length)return"";let t=(0,i.UtilCore).handleLineData(e[0].startPoint,e[0].endPoint),r=(0,i.UtilCore).handleLineData(e[1].startPoint,e[1].endPoint);if(Math.abs(t[1]-r[1])>.1||t[0]!=r[0])return;let n=e[0],o=e[1];if(""!=n&&""!=o){let e=(0,i.UtilCore).isSameVector(n.startPoint,o.startPoint),t=(0,i.UtilCore).isSameVector(n.startPoint,o.endPoint),r=(0,i.UtilCore).isSameVector(n.endPoint,o.startPoint),a=(0,i.UtilCore).isSameVector(n.endPoint,o.endPoint),s="",l="";e?(s=n.endPoint,l=o.endPoint):t?(s=n.endPoint,l=o.startPoint):r?(s=n.startPoint,l=o.endPoint):a&&(s=n.startPoint,l=o.startPoint),this.editor.removeWall(n),this.editor.removeWall(o),this.editor.allWalls.forEach(e=>{if("mergeWall"!=e.statusWall)return;let t=s,r=l,n=e.startPoint,o=e.endPoint,a=(0,i.UtilCore).isSameVector(t,n)||(0,i.UtilCore).isSameVector(t,o),h=(0,i.UtilCore).isSameVector(r,n)||(0,i.UtilCore).isSameVector(r,o);a&&h&&this.editor.removeWall(e)});let h=this.editor.addWall(s,l);return h.statusWall="mergeWall",h.status="move",h.style=n.style,h.height=n.height,h.thickness=n.thickness,h}return""}repairWall(e,t,r,n=""){let o=(0,i.UtilCore).getMeshOtherPoint(e,r),a={oldMesh:this.editor.startChooseWall[0].object,currentMesh:"",center:t},s="";if("noMarge"==n){let e=240,n=r.clone().distanceTo(t.clone());if(r==t||n<=this.editor.centerArea)return;this.editor.allWalls.slice(0).forEach(n=>{let o=n.startPoint,a=n.endPoint;(0,i.UtilCore).checkContainWall(r,t,o,a)&&(this.editor.removeWall(n),e=1*n.thickness)}),s=this.editor.addWall(r,t,e)}else if("newWall"==n)s=this.editor.addWall(r,t);else{if((0,i.UtilCore).isSameVector(o,t))return;if(e.status="remove",this.editor.removeHelperByWall(e),e.isArc){let n=this.getArcOtherPoint(o,t,e,r);"bezier"==e.isArc&&(n=e.cp),(s=(0,i.UtilCore).isSameVector(e.startPoint,r)?this.editor.addArcWall(t,o,n,e.isArc):this.editor.addArcWall(o,t,n,e.isArc)).wallID=e.wallID}else s=(0,i.UtilCore).isSameVector(e.startPoint,r)?this.editor.addWall(t,o,1*e.thickness):this.editor.addWall(o,t,1*e.thickness);s.wallID=e.wallID}return""!=s&&(s.status="move",s.style=e.style,s.height=e.height,s.thickness=e.thickness,"newWall"!=n&&(this.spiltWall.push(s),this.spiltOldWall.push([e,e.startPoint,e.endPoint,o]))),a.currentMesh=s,this.sureMove&&this.repairCommandObj.push(a),s}getArcOtherPoint(e,t,i,r){let n=e.clone().distanceTo(i.arcCenter.clone()),o=new a.Vector2((e.x+r.x)/2,(e.y+r.y)/2),s=new a.Vector2((e.x+t.x)/2,(e.y+t.y)/2),l=e.clone().distanceTo(r.clone()),h=l/2/n,c=n*(e.clone().distanceTo(t.clone())/2)/(l/2),d=c*Math.sqrt(1-h*h),u=s.clone().add(i.arcCenter.clone().sub(o.clone()).setLength(d));return 1e-4>Math.abs(h-1)&&(u=s.clone()),u.clone().add(i.cp.clone().sub(i.arcCenter.clone()).setLength(c))}}}),parcelRequire.register("bXJaA",function(e,t){$parcel$export(e.exports,"VertexMoveCommand",()=>a);var i=parcelRequire("73HrS"),r=parcelRequire("9HO6e"),n=parcelRequire("eA4zA"),o=parcelRequire("65FdD");class a{constructor(e){this.editor=e,this.dis="",this.arr=[],this.oldWallArr=[]}moveVertexMain(e=!1){if("Mesh"==this.editor.currenDraw.type)return;let t=this.editor.currentDownSelect[0].object.parent.center,n=!1;if(this.editor.otherMeshs.forEach(e=>{if("UWindow"==e.modelType){let i=this.editor.getWallByWallId(e.wallId),o=e.leftWindow[0],a=e.rightWindow[0],s=(0,r.UtilCore).isSameVector(i.startPoint,t)||(0,r.UtilCore).isSameVector(i.endPoint,t),l=(0,r.UtilCore).isSameVector(o.startPoint,t)||(0,r.UtilCore).isSameVector(o.endPoint,t),h=(0,r.UtilCore).isSameVector(a.startPoint,t)||(0,r.UtilCore).isSameVector(a.endPoint,t);(s||l||h)&&(n=!0)}}),n)return;""!=this.editor.currenDraw&&this.editor.scene.remove(...this.editor.currenDraw),this.editor.currenDraw=[],0==this.editor.samePointWall.length&&(this.editor.samePointByDrag=t.clone(),this.editor.samePointWall=(0,r.UtilCore).havePointWall(t,this.editor.allWalls));let o=this.editor.samePointByDrag.clone();this.editor.samePointWall.forEach(n=>{this.editor.removeHelperByWall(n);let a=(0,r.UtilCore).isSameVector(o,n.endPoint),s=t,l=n.endPoint;a?(s=n.startPoint,l=t,e&&(n.endPoint=t)):e&&(n.startPoint=t);let h=new(0,i.WallCore)(this.editor).createLineWall(s,l,1*n.thickness);h.material.color=this.editor.getWallColor(h),h.wallID=n.wallID,this.editor.currenDraw.push(h),this.arr.push(h)}),this.editor.scene.add(...this.editor.currenDraw),this.editor.currentPoint=(0,r.UtilCore).handleSpecialPoint(this.editor.currentPoint.clone(),this.editor.specialPointArr,this.editor),this.editor.currentDownSelect[0].object.parent.center.x=this.editor.currentPoint.x,this.editor.currentDownSelect[0].object.parent.center.y=this.editor.currentPoint.y}execute(){this.splitWallCommand=new o.SplitWallCommand(this.editor);let e=[];this.editor.samePointWall.forEach(t=>{let i=(0,r.UtilCore).getNewPoint(t),n=(0,r.UtilCore).getNewPoint(t,"end");e.push([t.wallID,i,n])}),this.moveVertexMain(!0),this.arr.forEach(e=>{let t=this.editor.getWallByWallId(e.wallID);this.editor.currenDraw=t,this.splitWallCommand.splitMain()}),new(0,i.WallCore)(this.editor).wallToJson("2D",[],"noHole"),this.arr.forEach(t=>{let i=this.editor.getWallByWallId(t.wallID),o=this.editor.getAllWindowInWall(i);o.length>0&&o.forEach(t=>{if(!t.center)return;this.editor.currentDoor=t;let o=this.getOldWall(t.wallId,e);if(!o){this.editor.currenDraw=t,new(0,n.DrawCommand)(this.editor,"door","end",[t,[t.center,i,i],"wall"]).execute(),this.editor.doorHelperGroupClean(),this.editor.currentDoor="",this.editor.doorDistance="";return}let a=o[1],s=o[2],l=1*(0,r.UtilCore).toVector3(t.center).distanceTo((0,r.UtilCore).toVector3(a)),h=1*(0,r.UtilCore).toVector3(t.center).distanceTo((0,r.UtilCore).toVector3(s));""==this.editor.doorDistance&&(this.editor.doorDistance=l<h?[l,a,s,"start"]:[h,s,a,"end"]);let c=(0,r.UtilCore).getNewPoint(i),d=(0,r.UtilCore).getNewPoint(i,"end"),u=i.endPoint.clone().sub(i.startPoint.clone()),p=c.clone().add(u.setLength(this.editor.doorDistance[0]));"end"==this.editor.doorDistance[3]&&(u=i.startPoint.clone().sub(i.endPoint.clone()),p=d.clone().add(u.setLength(this.editor.doorDistance[0]))),this.editor.currenDraw=t,new(0,n.DrawCommand)(this.editor,"door","end",[t,[p,i,i],"wall"]).execute(),this.editor.doorHelperGroupClean(),this.editor.currentDoor="",this.editor.doorDistance=""})}),new(0,i.WallCore)(this.editor).wallToJson(),this.editor.addIntersectPointHelper(),this.editor.currenDraw="",this.editor.doorDistance="",this.editor.samePointWall=[],this.editor.samePoint=""}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}getOldWall(e,t){let i="";return t.forEach(t=>{t[0]==e&&(i=t)}),i}}}),parcelRequire.register("jqJhK",function(e,t){$parcel$export(e.exports,"TransformToolCommand",()=>o);var i=parcelRequire("hWloQ"),r=parcelRequire("4xklQ"),n=parcelRequire("9HO6e");class o{constructor(e,t){this.editor=e,this.tool=t,this.wallHelp=new i.WallHelp}drawMain(){let e=this.editor.currentDownSelect[0].object.parent.currentModel;this.editor.doorHelperGroupClean(),this.editor.cleanModelHelper(),""!=this.editor.currenDraw&&this.editor.scene.remove(this.editor.currenDraw),this.editor.scene.children.slice(0).forEach(e=>{"rotateTool"==e.useType&&this.editor.scene.remove(e)});let t="";if(e)t=e.parent,e.modelType&&e.modelType.indexOf("Model")>=0&&(t=e);else{t=this.editor.currentDownSelect[0].object.parent;let e=this.editor.currentDownSelect[0].object;(e=this.editor.getOuterParent(e)).modelType&&e.modelType.indexOf("Model")>=0&&(t=e)}if("rotateTool"==this.tool){let n=!1;this.editor.doorHelperGroup.children.forEach(e=>{if("rotateClock"==e.useType){n=!0;return}}),n||this.editor.doorHelperGroup.add(this.wallHelp.addRotateTool(e));let o=this.editor.currentDownSelect[0].object.parent;this.editor.currentDownSelect.length>0&&this.editor.pointHelperGroup.remove(o);let a=o.arcCenter,s=o.arcRadio,l=this.editor.currentPoint.clone().sub(a.clone());l.setLength(s);let h=a.clone().add(l),c=new r.Vector3(a.x,a.y-s,0),d=c.clone().sub(a.clone()).angleTo(h.clone().sub(a.clone()));h.x<c.x&&(d=2*Math.PI-d);for(let e=0;e<9;e++)10>=Math.abs(45*e-180/Math.PI*d)&&(d=e*(Math.PI/4));let u=parseInt(180/Math.PI*d);this.editor.currenDraw=this.wallHelp.makeRotateToolGem(a,d-Math.PI/2-Math.PI/4,d-Math.PI/2+Math.PI/4,s,this.editor.config.angleToolChooseColor,100),this.editor.currenDraw.currentModel=e,this.editor.scene.add(this.editor.currenDraw),t.currentAngle=d,t.quaternion.copy(new(0,r.Quaternion)().setFromAxisAngle(new r.Vector3(0,0,1),d));let p=new(0,i.WallHelp)().createHelperForMumber(t);this.editor.pointHelperGroup.add(p[0]),u<0&&(u+=360),360==u&&(u=0);let m=this.editor.getScreenPosition(this.editor.currentPoint.clone());this.editor.list.blackBox.dispatch(m.x,m.y,u)}else if("moveTool"==this.tool){let e=this.editor.currentPoint.clone();if((0,n.UtilCore).isSameVector(e,new r.Vector3(0,0,0)))return;let o=this.editor.downPoint,a=new r.Vector3;a.copy(e).sub(o),t.position.copy(a).add(this.editor._offsetStart);let s=new(0,i.WallHelp)().createHelperForMumber(t);this.editor.pointHelperGroup.add(...s)}else if("scaleTool"==this.tool){let r=["-XY","-X","-X-Y","Y","-Y","XY","X","X-Y"];e.updateMatrix();let n=new(0,i.WallHelp)().createHelperForMumber(t);this.editor.pointHelperGroup.add(n[0]);let o=this.scaleTool(t,r.indexOf(this.editor.currentDownSelect[0].object.scaleDir)+1,this.editor.currentPoint.clone());o.x>0&&o.y>0&&o.z>0&&this.applyScale(t,r.indexOf(this.editor.currentDownSelect[0].object.scaleDir)+1,o)}if(this.editor.synchroModel(t),this.editor.list.hiddenDialog.dispatch(),this.editor.clickDepthMsg.uuid){this.editor.modelDotGroup.children=[];let e=this.editor.getOuterParent(t,t,"outer"),i=e.param[0];this.editor.refreshRealSizeByBox(e,t),this.editor.updateModelPosition(t.parent,e),this.editor.addDashBoxFor2dGroup(e),this.editor.addDashBoxForGroup(i)}}execute(){""!=this.editor.currenDraw&&this.editor.scene.remove(this.editor.currenDraw);let e=this.editor.currentDownSelect[0].object.parent.currentModel;this.editor.currenDraw="";let t="";if(e)t=e.parent,e.modelType&&e.modelType.indexOf("Model")>=0&&(t=e);else{t=this.editor.currentDownSelect[0].object.parent;let e=this.editor.currentDownSelect[0].object;e.modelType&&e.modelType.indexOf("Model")>=0&&(t=e)}let i=this.editor.getOuterParent(t,t,"outer");"{}"==JSON.stringify(this.editor.clickDepthMsg)&&i&&i.uuid!=t.uuid&&(t=i),this.editor.addLineHelperForMember(t),this.editor.doorHelperGroup.children.forEach(e=>{if("rotateClock"==e.useType){this.editor.doorHelperGroup.remove(e);return}});let r=t;if(["beam","flue","pillars"].indexOf(r.modelType)>=0){let e=Math.round(180/Math.PI*r.rotation.z);e<0&&(e=360+e);let t=[Math.round(r.width*r.scale.x),Math.round(r.height*r.scale.y),Math.round(r.depth*r.scale.z),e,{isLock:r.isLock}],i=4;"flue"==r.modelType&&(i=5),"pillars"==r.modelType&&(i=6),this.editor.list.showDialog.dispatch(i,r.modelType,[],t)}else{if(!(e.modelType&&e.modelType.indexOf("Model")>=0))return;let i=this.editor.get3DModelBy2DModel(t);this.editor.updateModelProto(i)}}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}scaleTool(e,t,i){let n=new r.Vector3(1,1,1);var o=e.matrix.clone();e.position.set(0,0,0),e.rotation.set(0,0,0);var a=new(0,r.Box3)().setFromObject(e),s=(a.max.x-a.min.x)/2,l=(a.max.y-a.min.y)/2,h=(s**2+l**2)**.5;e.scale.set(1,1,1),e.updateMatrixWorld(!0),e.applyMatrix4(o);let c=i.clone();e.parent.worldToLocal(c);var d=c.clone().sub(e.position).length();if(-1!=[1,3,6,8].indexOf(t)){var u=(d+h)/(2*h);n.x=u,n.y=u}else -1!=[2,7].indexOf(t)?n.x=(d+s)/(2*s):n.y=(d+l)/(2*l);return n}applyScale(e,t,i){e.updateMatrix();var n=e.matrix.clone();e.position.set(0,0,0),e.rotation.set(0,0,0),e.scale.set(1,1,1),e.updateMatrixWorld(!0);var o=new(0,r.Box3)().setFromObject(e),a=(o.max.x-o.min.x)/2,s=(o.max.y-o.min.y)/2;o.max.z,o.min.z;var l=0,h=0,c=0;switch(t){case 1:l=-a,h=s;break;case 2:l=-a;break;case 3:l=-a,h=-s;break;case 4:h=s;break;case 5:h=-s;break;case 6:l=a,h=s;break;case 7:l=a;break;case 8:l=a,h=-s}var d=new(0,r.Matrix4)().makeTranslation(l,h,c),u=new(0,r.Matrix4)().makeScale(i.x,i.y,1),p=new(0,r.Matrix4)().makeTranslation(-l,-h,-c);u.multiply(d),p.multiply(u),n.multiply(p),e.applyMatrix4(n)}}}),parcelRequire.register("5Euub",function(e,t){$parcel$export(e.exports,"ScaleRuleToolCommand",()=>i);class i{constructor(e,t="scale"){this.editor=e,this.type=t}drawMain(){""!=this.editor.currenDraw&&this.editor.cleanScaleTool();let e=this.editor.currentPoint,t="";if("scale"==this.type){let i=this.editor.currentDownSelect[0].object.otherPosition,r=this.editor.currentDownSelect[0].object.positionType;t=i,"start"!=r?(e=i,t=this.editor.currentPoint,t=this.handlePoint(i,t)):e=this.handlePoint(i,e)}else{let i=this.editor.currentDownSelect[0].object.parent,r=this.editor.downPoint.clone(),n=this.editor.currentPoint,o=n.clone().sub(r.clone()).setLength(1*n.clone().distanceTo(r.clone()));e=i.startPoint.clone().add(o.clone()),t=i.endPoint.clone().add(o.clone())}this.editor.currenDraw=this.editor.allHelperForScaleTool(e,t)}execute(){this.drawMain(),this.editor.currenDraw=""}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}handlePoint(e,t){let i=80;return Math.abs(e.x-t.x)<=i&&(t.x=e.x),Math.abs(e.y-t.y)<=i&&(t.y=e.y),t}}}),parcelRequire.register("4w6re",function(e,t){$parcel$export(e.exports,"BezierMoveCommand",()=>r);var i=parcelRequire("73HrS");class r{constructor(e){this.editor=e,this.wallCore=new i.WallCore(e)}drawMain(){let e=this.editor.currentDownSelect[0].object.wall;this.editor.removeHelperByWall(e),e.cp=this.editor.currentPoint.clone();let t=e.startPoint,i=e.endPoint;""!=this.editor.currenDraw&&this.editor.scene.remove(this.editor.currenDraw),this.editor.currenDraw=this.wallCore.createCircleWall(t,i,this.editor.currentPoint,e.isArc),this.editor.scene.add(this.editor.currenDraw),this.editor.addBSRWallHelper(this.editor.currenDraw),this.editor.currenDraw.wallID=e.wallID}execute(){this.drawMain();let e=this.editor.allWalls.slice(0);e.forEach(e=>{e.wallID==this.editor.currenDraw.wallID&&(e.cp=this.editor.currentPoint)}),new(0,i.WallCore)(this.editor).wallToJson(),this.editor.addBSRWallHelper(this.editor.currenDraw);let t=this.editor.currentDownSelect[0].object.wall.wallID;(e=this.editor.allWalls.slice(0)).forEach(e=>{e.wallID==t&&(e.material.color=this.editor.chooseColor)}),this.editor.currenDraw=""}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}}}),parcelRequire.register("hwhH1",function(e,t){$parcel$export(e.exports,"MoveMemberCommand",()=>o);var i=parcelRequire("9QhXH"),r=parcelRequire("9HO6e"),n=parcelRequire("73HrS");class o{constructor(e){this.editor=e}main(){""==this.editor.currenDraw&&(this.editor.doorHelperGroupClean(),this.editor.currenDraw=this.editor.currentDownSelect[0].object.parent);let e=this.editor.currenDraw.name,t=Math.round(this.editor.currenDraw.width*this.editor.currenDraw.scale.x),n=Math.round(this.editor.currenDraw.height*this.editor.currenDraw.scale.y),o=Math.round(this.editor.currenDraw.depth*this.editor.currenDraw.scale.z),a=this.editor.currentPoint.clone(),s=this.editor.allWalls.slice(0),l="",h=this.editor.currenDraw.rotation.z;this.editor.allWalls.forEach(e=>{let i=(0,r.UtilCore).smallDistanceByPointOnLine((0,r.UtilCore).handleLineData(e.startPoint,e.endPoint),a);if(!(0,r.UtilCore).pointIsInLine(i,e.startPoint,e.endPoint))return;let o=i.clone().distanceTo((0,r.UtilCore).toVector3(a));o<=e.thickness/2&&(l=e);let s=Math.min(t,n),h=e.thickness/2+s/2;o<=h&&(a=i.add((0,r.UtilCore).toVector2(a).sub(i.clone()).setLength(h)))}),l||(this.editor.scene.remove(this.editor.currenDraw),this.editor.otherMember.indexOf(this.editor.currenDraw)>=0&&this.editor.otherMember.splice(this.editor.otherMember.indexOf(this.editor.currenDraw),1),"bridge"==e?this.editor.currenDraw=(0,i.DM).createBeam(a,"beam",h,n,o,s,t):"flue"==e?(this.editor.currenDraw=(0,i.DM).createFlue(a,t,n,0),this.editor.currenDraw.rotation.z=h):"post"==e&&(this.editor.currenDraw=(0,i.DM).createBeam(a,"pillars",0,n,o,s,t),this.editor.currenDraw.rotation.z=h),this.editor.cleanModelHelper(),this.editor.switchHelperGroup("hidden"),this.editor.addLineHelperForMember(this.editor.currenDraw),this.editor.currenDraw.name=e,this.editor.scene.add(this.editor.currenDraw))}execute(){this.main(),this.editor.otherMember.push(this.editor.currenDraw),this.editor.addLineHelperForMember(this.editor.currenDraw),this.editor.currenDraw="",new(0,n.WallCore)(this.editor).wallToJson()}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}}}),parcelRequire.register("9xc3p",function(e,t){$parcel$export(e.exports,"MemberCommand",()=>a);var i=parcelRequire("9HO6e"),r=parcelRequire("4xklQ"),n=parcelRequire("9QhXH"),o=parcelRequire("73HrS");class a{constructor(e,t=[],i=!0){this.editor=e,this.type=this.editor.toolType,this.param=t,this.redrew=i}drawMain(){let e=0,t=800;""!=this.editor.currenDraw&&(t=this.editor.currenDraw.width?this.editor.currenDraw.width:this.editor.currenDraw.realWidth,e=this.editor.currenDraw.angle,this.editor.scene.remove(this.editor.currenDraw),this.editor.otherMember.indexOf(this.editor.currenDraw)>=0&&this.editor.otherMember.splice(this.editor.otherMember.indexOf(this.editor.currenDraw),1)),this.editor.currentMoveSelect.forEach(t=>{let i=t.object;if(i.useType&&"wall"==i.useType){e=new(0,r.Vector2)(i.endPoint.x,i.endPoint.y).sub(new r.Vector2(i.startPoint.x,i.startPoint.y)).angle();return}});let o=this.type,a=this.editor.currentPoint,s=400,l=this.editor.allWalls.slice(0);if(("post"==o||"flue"==o)&&(s=650,t=650),this.editor.copyDoor&&(t=Math.round(this.editor.copyDoor.width*this.editor.copyDoor.scale.x),s=Math.round(this.editor.copyDoor.height*this.editor.copyDoor.scale.y),e=this.editor.copyDoor.rotation.z),0!=this.param.length){let i=this.editor.clickSelect[0].object.parent;t=i.width,s=i.height,a=i.center,o=this.param[2],e=i.angle,l=!1,"width"==this.param[0]&&(t=this.param[1]),"height"==this.param[0]&&(s=this.param[1])}else"bridge"!=o&&this.editor.allWalls.forEach(r=>{let n=(0,i.UtilCore).smallDistanceByPointOnLine((0,i.UtilCore).handleLineData(r.startPoint,r.endPoint),a);if(!(0,i.UtilCore).pointIsInLine(n,r.startPoint,r.endPoint))return;let o=n.clone().distanceTo((0,i.UtilCore).toVector3(a)),l=Math.min(t,s),h=r.thickness/2+l/2;o<=h&&(e=r.endPoint.clone().sub(r.startPoint.clone()).angle(),a=n.add((0,i.UtilCore).toVector2(a).sub(n.clone()).setLength(h)))});"bridge"==o?this.editor.currenDraw=(0,n.DM).createBeam(a,"beam",e,s,400,l,t):"flue"==o?(this.editor.currenDraw=(0,n.DM).createFlue(a,t,s,0),this.editor.currenDraw.rotation.z=e):"post"==o&&(this.editor.currenDraw=(0,n.DM).createBeam(a,"pillars",0,s,window.storeyHei,l,t),this.editor.currenDraw.rotation.z=e),this.editor.currenDraw.name=o,this.editor.scene.add(this.editor.currenDraw),this.editor.cleanModelHelper(),this.editor.switchHelperGroup("hidden"),this.editor.addPositionHelper(this.editor.currenDraw),this.param.length>0&&(this.editor.clickSelect[0].object.parent=this.editor.currenDraw,this.editor.currenDraw.position.copy(this.param[3]),this.editor.currenDraw.rotation.copy(this.param[4]),"rotation"==this.param[0]&&(this.editor.currenDraw.rotation.z=Math.PI/180*this.param[1]))}execute(){this.drawMain(),this.editor.otherMember.push(this.editor.currenDraw),this.editor.currenDraw="",this.redrew&&new(0,o.WallCore)(this.editor).wallToJson(),this.param.length>0&&(this.editor.doorHelperGroupClean(),this.editor.addLineHelperForMember(this.editor.clickSelect[0].object.parent))}undo(e){this.editor.readCache(e)}redo(e){this.editor.readCache(e)}}}),parcelRequire.register("hmviW",function(e,t){$parcel$export(e.exports,"Range",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("9QhXH");parcelRequire("hrM0U");class n{constructor(){this.thickness=240,this.height=window.storeyHei,this.bufferMeter=10,this.flat=!1,this.doorWidth=800,this.balconyWidth=1300,this.cornerWindowWidth=500,this.sitRoomWidthMin=4e3+this.thickness,this.sitRoomWidthMax=6e3+this.thickness,this.sitRoomHeightMin=3600+this.thickness,this.sitRoomHeightMax=4200+this.thickness,this.history=[],this.reset()}reset(){this.jsonArr=[],this.shape=[],this.doorArr=[],this.holeArr=[]}getHome(e=0,t=0,i=1){let r=0;0==e&&(t=(e=this.getRandom(1,3))>2?this.getRandom(1,2):1,i=e>2?this.getRandom(1,2):1,2==e&&(r=this.getRandom(0,1)),3==e&&(r=1)),this.room=e,this.hall=t,this.toilet=i,console.log(e+" 室 "+t+" 厅 1 厨 "+i+" 卫 "+r+" 过道"),this.createSittingRoom(),t>1&&this.createDiningRoom(),this.createKitchen(t),this.createToilet(t),this.flat=!0,e>1&&this.createSecondBedroom(),this.createMasterBedroom(e),e>2&&this.createStudy(),this.createBalcony("A");let n=this.handleSegment();n=this.getHoleData(n);let o=[this.masterC,this.sitRoomCenter,this.kitchenCenter,this.toiletC];return e>1&&o.push(this.secondBC),t>1&&o.push(this.diningRoomCenter),[n,this.doorArr,this.holeArr,o]}getHoleData(e){let t=1e3;console.log("获取门窗开洞数据");for(let r=0;r<e.length;r++){e[r].id=t++;let n=new i.Vector2(e[r].start.x,e[r].start.y),o=new i.Vector2(e[r].end.x,e[r].end.y),a=n.distanceTo(o),s=n.clone().add(o).divideScalar(2);if(Math.abs(s.x)<=this.sitRoomW/2&&Math.abs(s.y)<=this.sitRoomH/2)-1!=[0,1,4,5].indexOf(this.masterP)?(0==this.masterP&&s.y==this.masterC.y-this.masterH/2&&s.x-this.masterC.x==a/2+this.masterW/2&&(this.fillHoleData("baseDoor",e[r],800,2e3),this.setDWId("entry door",t-1)),5==this.masterP&&s.y==this.masterC.y+this.masterH/2&&s.x-this.masterC.x==a/2+this.masterW/2&&(this.fillHoleData("baseDoor",e[r],800,2e3),this.setDWId("entry door",t-1)),1==this.masterP&&s.y==this.masterC.y-this.masterH/2&&this.masterC.x-s.x==a/2+this.masterW/2&&(this.fillHoleData("baseDoor",e[r],800,2e3),this.setDWId("entry door",t-1)),4==this.masterP&&s.y==this.masterC.y+this.masterH/2&&s.x-this.masterC.x==a/2+this.masterW/2&&(this.fillHoleData("baseDoor",e[r],800,2e3),this.setDWId("entry door",t-1))):(2==this.masterP&&s.x==this.masterC.x-this.masterW/2&&this.masterC.y-s.y==a/2+this.masterH/2&&(this.fillHoleData("baseDoor",e[r],800,2e3),this.setDWId("entry door",t-1)),7==this.masterP&&s.x==this.masterC.x+this.masterW/2&&this.masterC.y-s.y==a/2+this.masterH/2&&(this.fillHoleData("baseDoor",e[r],800,2e3),this.setDWId("entry door",t-1)),3==this.masterP&&s.x==this.masterC.x-this.masterW/2&&s.y-this.masterC.y==a/2+this.masterH/2&&(this.fillHoleData("baseDoor",e[r],800,2e3),this.setDWId("entry door",t-1)),6==this.masterP&&s.x==this.masterC.x+this.masterW/2&&s.y-this.masterC.y==a/2+this.masterH/2&&(this.fillHoleData("baseDoor",e[r],800,2e3),this.setDWId("entry door",t-1))),-1!=[0,1,4,5].indexOf(this.balconyAP)?s.x==this.balconyAC.x&&Math.abs(s.y-this.balconyAC.y)==this.balconyAH/2&&(this.fillHoleData("slidingDoor",e[r],this.balconyAW-800,2e3),this.setDWId("slidingDoor",t-1)):s.y==this.balconyAC.y&&Math.abs(s.x-this.balconyAC.x)==this.balconyAW/2&&(this.fillHoleData("slidingDoor",e[r],this.balconyAH-800,2e3),this.setDWId("slidingDoor",t-1)),-1!=[0,1,4,5].indexOf(this.kitchenP)?(s.x==this.kitchenCenter.x&&((0==this.kitchenP||1==this.kitchenP)&&this.kitchenCenter.y-s.y==this.kitchenH/2&&(this.fillHoleData("baseDoor",e[r],800,2e3),this.setDWId("kitchen door",t-1)),(4==this.kitchenP||5==this.kitchenP)&&s.y-this.kitchenCenter.y==this.kitchenH/2&&(this.fillHoleData("baseDoor",e[r],800,2e3),this.setDWId("kitchen door",t-1))),Math.abs(s.x-this.toiletC.x)<this.toiletW/2&&Math.abs(s.y-this.toiletC.y)==this.toiletH/2&&(this.fillHoleData("baseDoor",e[r],800,2e3),this.setDWId("toilet door",t-1))):(s.y==this.kitchenCenter.y&&((2==this.kitchenP||3==this.kitchenP)&&this.kitchenCenter.x-s.x==this.kitchenW/2&&(this.fillHoleData("baseDoor",e[r],800,2e3),this.setDWId("kitchen door",t-1)),(6==this.kitchenP||7==this.kitchenP)&&s.x-this.kitchenCenter.x==this.kitchenW/2&&(this.fillHoleData("baseDoor",e[r],800,2e3),this.setDWId("kitchen door",t-1))),Math.abs(s.y-this.toiletC.y)<this.toiletH/2&&Math.abs(s.x-this.toiletC.x)==this.toiletW/2&&(this.fillHoleData("baseDoor",e[r],800,2e3),this.setDWId("toilet door",t-1))),(this.secondBP||0==this.secondBP)&&(-1!=[0,1,4,5].indexOf(this.secondBP)?(s.x==this.secondBC.x&&Math.abs(s.y-this.secondBC.y)==this.secondBH/2&&(this.fillHoleData("baseDoor",e[r],800,2e3),this.setDWId("secondBD door",t-1)),3==this.room&&Math.abs(s.x-this.secondBC.x)>this.secondBW/2&&Math.abs(s.y-this.secondBC.y)==this.secondBH/2&&(this.fillHoleData("baseDoor",e[r],800,2e3),this.setDWId("study door",t-1))):(s.y==this.secondBC.y&&Math.abs(s.x-this.secondBC.x)==this.secondBW/2&&(this.fillHoleData("baseDoor",e[r],800,2e3),this.setDWId("secondBD door",t-1)),3==this.room&&Math.abs(s.y-this.secondBC.y)>this.secondBH/2&&Math.abs(s.x-this.secondBC.x)==this.secondBW/2&&(this.fillHoleData("baseDoor",e[r],800,2e3),this.setDWId("study door",t-1)))),-1!=[0,1,4,5].indexOf(this.masterP)?s.x==this.masterC.x&&Math.abs(s.y-this.masterC.y)==this.masterH/2&&(this.fillHoleData("baseDoor",e[r],800,2e3),this.setDWId("masterBD door",t-1)):s.y==this.masterC.y&&Math.abs(s.x-this.masterC.x)==this.masterW/2&&(this.fillHoleData("baseDoor",e[r],800,2e3),this.setDWId("masterBD door",t-1));else{this.diningRoomP&&((0==this.kitchenP||1==this.kitchenP)&&s.x==this.toiletC.x&&this.toiletC.y-s.y==this.toiletH/2&&(this.fillHoleData("baseDoor",e[r],800,2e3),this.setDWId("toilet door",t-1)),(2==this.kitchenP||3==this.kitchenP)&&s.y==this.toiletC.y&&this.toiletC.x-s.x==this.toiletW/2&&(this.fillHoleData("baseDoor",e[r],800,2e3),this.setDWId("toilet door",t-1)),(4==this.kitchenP||5==this.kitchenP)&&s.x==this.toiletC.x&&s.y-this.toiletC.y==this.toiletH/2&&(this.fillHoleData("baseDoor",e[r],800,2e3),this.setDWId("toilet door",t-1)),(6==this.kitchenP||7==this.kitchenP)&&s.y==this.toiletC.y&&s.x-this.toiletC.x==this.toiletW/2&&(this.fillHoleData("baseDoor",e[r],800,2e3),this.setDWId("toilet door",t-1))),500==Math.abs(Math.abs(s.y-this.masterC.y)-this.masterH/2)&&(this.fillHoleData("baseWindow",e[r],a-240,2100),-1!=[1,2,5,6].indexOf(this.masterP)?this.setDWId("CW1",t-1):this.setDWId("CW2",t-1)),500==Math.abs(Math.abs(s.x-this.masterC.x)-this.masterW/2)&&(this.fillHoleData("baseWindow",e[r],a-240,2100),-1!=[3,4,7,0].indexOf(this.masterP)?this.setDWId("CW1",t-1):this.setDWId("CW2",t-1)),-1!=[0,1,4,5].indexOf(this.secondBP)?((0==this.secondBP||1==this.secondBP)&&s.y-this.secondBC.y==this.secondBH/2&&(s.x==this.secondBC.x?(this.fillHoleData("baseWindow",e[r],a-600,2100),this.setDWId("secondBD window",t-1)):3==this.room&&this.fillHoleData("panoramicWindow",e[r],a-230,2100,new i.Vector2(s.x,s.y+250))),(4==this.secondBP||5==this.secondBP)&&this.secondBC.y-s.y==this.secondBH/2&&(s.x==this.secondBC.x?(this.fillHoleData("baseWindow",e[r],a-600,2100),this.setDWId("secondBD window",t-1)):3==this.room&&this.fillHoleData("panoramicWindow",e[r],a-230,2100,new i.Vector2(s.x,s.y-250)))):((2==this.secondBP||3==this.secondBP)&&s.x-this.secondBC.x==this.secondBW/2&&(s.y==this.secondBC.y?(this.fillHoleData("baseWindow",e[r],a-600,2100),this.setDWId("secondBD window",t-1)):3==this.room&&(this.fillHoleData("panoramicWindow",e[r],a-230,2100,new i.Vector2(s.x+250,s.y)),this.setDWId("study pw",t-1))),(6==this.secondBP||7==this.secondBP)&&this.secondBC.x-s.x==this.secondBW/2&&(s.y==this.secondBC.y?(this.fillHoleData("baseWindow",e[r],a-600,2100),this.setDWId("secondBD window",t-1)):3==this.room&&(this.fillHoleData("panoramicWindow",e[r],a-230,2100,new i.Vector2(s.x-250,s.y)),this.setDWId("study pw",t-1)))),-1!=[0,1,4,5].indexOf(this.kitchenP)?(s.x==this.kitchenCenter.x&&((0==this.kitchenP||1==this.kitchenP)&&s.y-this.kitchenCenter.y==this.kitchenH/2&&(this.fillHoleData("baseWindow",e[r],a-600,2100),this.setDWId("kitchen window",t-1)),(4==this.kitchenP||5==this.kitchenP)&&this.kitchenCenter.y-s.y==this.kitchenH/2&&(this.fillHoleData("baseWindow",e[r],a-600,2100),this.setDWId("kitchen window",t-1))),s.x==this.toiletC.x&&((0==this.kitchenP||1==this.kitchenP)&&s.y-this.toiletC.y==this.toiletH/2&&(this.fillHoleData("baseWindow",e[r],a-600,2100),this.setDWId("toilet window",t-1)),(4==this.kitchenP||5==this.kitchenP)&&this.toiletC.y-s.y==this.toiletH/2&&(this.fillHoleData("baseWindow",e[r],a-600,2100),this.setDWId("toilet window",t-1)))):(s.y==this.kitchenCenter.y&&((2==this.kitchenP||3==this.kitchenP)&&s.x-this.kitchenCenter.x==this.kitchenW/2&&(this.fillHoleData("baseWindow",e[r],a-600,2100),this.setDWId("kitchen window",t-1)),(6==this.kitchenP||7==this.kitchenP)&&this.kitchenCenter.x-s.x==this.kitchenW/2&&(this.fillHoleData("baseWindow",e[r],a-600,2100),this.setDWId("kitchen window",t-1))),s.y==this.toiletC.y&&((2==this.kitchenP||3==this.kitchenP)&&s.x-this.toiletC.x==this.toiletW/2&&(this.fillHoleData("baseWindow",e[r],a-600,2100),this.setDWId("toilet window",t-1)),(6==this.kitchenP||7==this.kitchenP)&&this.toiletC.x-s.x==this.toiletW/2&&(this.fillHoleData("baseWindow",e[r],a-600,2100),this.setDWId("toilet window",t-1))));let n=a>1200?1200:a;-1!=[0,1,4,5].indexOf(this.balconyAP)?((0==this.balconyAP||1==this.balconyAP)&&(s.y>=this.balconyAC.y&&s.y-this.balconyAC.y<this.balconyAH/2&&Math.abs(this.balconyAC.x-s.x)==this.balconyAW/2&&(n<1200?this.fillHoleData("uwl",e[r],n,2100):this.fillHoleData("uwl",e[r],n,2100,new i.Vector2(s.x,s.y+a/2-480))),s.x==this.balconyAC.x&&s.y-this.balconyAC.y==this.balconyAH/2&&(this.fillHoleData("uWindow",e[r],a+240,2100,new i.Vector2(s.x,s.y-480)),this.setDWId("uw",t-1))),(4==this.balconyAP||5==this.balconyAP)&&(s.y<=this.balconyAC.y&&this.balconyAC.y-s.y<this.balconyAH/2&&Math.abs(this.balconyAC.x-s.x)==this.balconyAW/2&&(n<1200?this.fillHoleData("uwl",e[r],n,2100):this.fillHoleData("uwl",e[r],n,2100,new i.Vector2(s.x,s.y-a/2+480))),s.x==this.balconyAC.x&&this.balconyAC.y-s.y==this.balconyAH/2&&(this.fillHoleData("uWindow",e[r],a+240,2100,new i.Vector2(s.x,s.y+480)),this.setDWId("uw",t-1)))):((2==this.balconyAP||3==this.balconyAP)&&(s.x>=this.balconyAC.x&&s.x-this.balconyAC.x<this.balconyAW/2&&Math.abs(s.y-this.balconyAC.y)==this.balconyAH/2&&(n<1200?this.fillHoleData("uwl",e[r],n,2100):this.fillHoleData("uwl",e[r],n,2100,new i.Vector2(s.x+a/2-480,s.y))),s.y==this.balconyAC.y&&s.x-this.balconyAC.x==this.balconyAW/2&&(this.fillHoleData("uWindow",e[r],a+240,2100,new i.Vector2(s.x-480,s.y)),this.setDWId("uw",t-1))),(6==this.balconyAP||7==this.balconyAP)&&(s.x<=this.balconyAC.x&&this.balconyAC.x-s.x<this.balconyAW/2&&Math.abs(s.y-this.balconyAC.y)==this.balconyAH/2&&(n<1200?this.fillHoleData("uwl",e[r],n,2100):this.fillHoleData("uwl",e[r],n,2100,new i.Vector2(s.x-a/2+480,s.y))),s.y==this.balconyAC.y&&this.balconyAC.x-s.x==this.balconyAW/2&&(this.fillHoleData("uWindow",e[r],a+240,2100,new i.Vector2(s.x+480,s.y)),this.setDWId("uw",t-1))))}}return e}fillHoleData(e,t,r,n,o=!1){let a,s=t.thickness,l=t.id;o=o||new i.Vector2(t.start.x+t.end.x,t.start.y+t.end.y).divideScalar(2),e.includes("Door")?(a={location:{x:o.x,y:o.y,z:n/2},width:r,height:n,withSector:!1,offsetXY:0,wallID:l,windowThick:s},"sectorDoor"==e&&(a.height=n-r/2),"sectorDoor"==e&&(a.path="static/model/door/01/doorWithThresholdStone.glb"),"baseDoor"==e&&(a.path="static/model/door/baseDoor/baseDoor.glb"),"doubleOpenDoor"==e&&(a.path="static/model/door/doubleOpenDoor/doubleOpenDoor.glb"),"lashDoor"==e&&(a.path="static/model/door/lashDoor/lashDoor.glb"),"slidingDoor"==e&&(a.path="static/model/door/slidingDoor/slidingDoor.glb")):e.includes("Window")?(a={location:{x:o.x,y:o.y,z:n/2+500},width:r,height:n,withSector:!1,offsetXY:0,wallID:l,windowThick:s},"baseWindow"==e&&(a.path="static/model/window/baseWindow/baseWindow.glb"),"uWindow"==e&&(a.path="static/model/window/uWindow/uWindow.glb",a.windowThick+=960),"waveWindow"==e&&(a.path="static/model/window/waveWindow/waveWindow.glb",a.windowThick+=500),"panoramicWindow"==e&&(this.doorArr.forEach(e=>{"study pw"==e.name&&(e.wallId=l)}),a.path="static/model/window/panoramicWindow/panoramicWindow.glb",a.windowThick+=500)):a={location:{x:o.x,y:o.y,z:n/2+500},width:r,height:n,withSector:!1,offsetXY:0,wallID:l,windowThick:s},this.holeArr.push(a)}setDWId(e,t){for(let i=0;i<this.doorArr.length;i++)if(this.doorArr[i].name==e){this.doorArr[i].wallId=t;return}}createPanoramicWindow(e,t,r){let n=new i.Group,o=t-this.thickness,a=new i.Vector2(-o/2,-this.thickness/2),s=new i.Vector2(a.x,a.y+this.cornerWindowWidth),l=new i.Vector2(s.x+o,s.y),h=new i.Vector2(o/2,-this.thickness/2),c=this.createShapeByPointArr([s,l,h,a],13421772);n.add(c);let d=this.createLine([a,s,l,h,a]);n.add(d);let u=new i.Vector2(-o/2,this.thickness/2),p=new i.Vector2(u.x-this.thickness,u.y),m=new i.Vector2(p.x,p.y+this.cornerWindowWidth),f=new i.Vector2(m.x+t+this.thickness,m.y),g=new i.Vector2(f.x,f.y-this.cornerWindowWidth),y=new i.Vector2(g.x-this.thickness,g.y),x=new i.Vector2(u.x-this.thickness/2,u.y),w=new i.Vector2(x.x,x.y+this.cornerWindowWidth-this.thickness/2),b=new i.Vector2(w.x+o+this.thickness,w.y),v=new i.Vector2(b.x,b.y-this.cornerWindowWidth+this.thickness/2),M=this.createShapeByPointArr([p,m,f,g,y,l,s,u]);n.add(M);let S=this.createLine([u,p,m,f,g,y]);n.add(S);let P=this.createLine([x,w,b,v]);return n.add(P),n.rotation.z=r,n.position.set(e.x,e.y,10),n}createFrenchWindow(e,t,r){let n=new i.Group,o=new i.Vector2(-t/2,-this.thickness/2),a=new i.Vector2(-t/2,this.thickness/2),s=new i.Vector2(t/2,this.thickness/2),l=new i.Vector2(t/2,-this.thickness/2),h=this.createShapeByPointArr([a,s,l,o]),c=this.createLine([o,a,s,l,o]),d=new i.Vector2(-t/2,-this.thickness/6),u=new i.Vector2(t/2,-this.thickness/6),p=new i.Vector2(-t/2,0),m=new i.Vector2(t/2,0),f=new i.Vector2(-t/2,this.thickness/6),g=new i.Vector2(t/2,this.thickness/6),y=new i.Vector2(0,this.thickness/6),x=new i.Vector2(0,-this.thickness/6),w=this.createLine([d,u]),b=this.createLine([p,m]),v=this.createLine([f,g]),M=this.createLine([y,x]);return n.add(h,c,w,b,v,M),n.rotation.z=r,n.position.set(e.x,e.y,100),n}createLine(e,t=0){let r=new i.BufferGeometry().setFromPoints(e),n=new i.Line(r,new i.LineBasicMaterial({color:t}));return n.renderOrder=100,n}createShapeByPointArr(e,t=16777215){let r=new i.Shape;r.moveTo(e[e.length-1].x,e[e.length-1].y),e.forEach(e=>{r.lineTo(e.x,e.y)});let n=new i.ShapeGeometry(r),o=new i.Mesh(n,new i.MeshBasicMaterial({color:t}));return o.renderOrder=90,o}createBalcony(e){let t,n,o,a,s,l;if("A"==e){let e,h=[this.masterP,this.secondBP,this.kitchenP],c=[];(h.includes(0)||h.includes(1))&&c.push(0,1),(h.includes(2)||h.includes(3))&&c.push(2,3),(h.includes(4)||h.includes(5))&&c.push(4,5),(h.includes(6)||h.includes(7))&&c.push(6,7),console.log("Balcony position",t=this.getPosition(c));let d,u=0,p;0==parseInt(t/2)&&(d=this.sitRoomCenter.clone().add(new i.Vector2(0,this.sitRoomH/2))),1==parseInt(t/2)&&(d=this.sitRoomCenter.clone().add(new i.Vector2(this.sitRoomW/2,0)),u=-Math.PI/2),2==parseInt(t/2)&&(d=this.sitRoomCenter.clone().add(new i.Vector2(0,-this.sitRoomH/2))),3==parseInt(t/2)&&(d=this.sitRoomCenter.clone().add(new i.Vector2(-this.sitRoomW/2,0)),u=Math.PI/2),p=-1!=[0,1,4,5].indexOf(t)?this.sitRoomW-1e3:this.sitRoomH-1e3;let m=(0,r.DM).createSlidingDoor(d,p,u);m.name="slidingDoor",this.doorArr.push(m),-1!=[0,1,4,5].indexOf(t)?(s=this.sitRoomW,l=this.balconyWidth,o=this.sitRoomCenter.x,(0==t||1==t)&&(a=this.sitRoomCenter.y+this.sitRoomH/2+this.balconyWidth/2),(4==t||5==t)&&(a=this.sitRoomCenter.y-this.sitRoomH/2-this.balconyWidth/2)):(s=this.balconyWidth,l=this.sitRoomH,a=this.sitRoomCenter.y,(2==t||3==t)&&(o=this.sitRoomCenter.x+this.sitRoomW/2+this.balconyWidth/2),(6==t||7==t)&&(o=this.sitRoomCenter.x-this.sitRoomW/2-this.balconyWidth/2)),n=new i.Vector2(o,a),0==parseInt(t/2)&&(e=new i.Vector2(n.x,n.y+l/2)),1==parseInt(t/2)&&(e=new i.Vector2(n.x+s/2,n.y)),2==parseInt(t/2)&&(e=new i.Vector2(n.x,n.y-l/2)),3==parseInt(t/2)&&(e=new i.Vector2(n.x-s/2,n.y)),this.balconyAC=n,this.balconyAP=t,this.balconyAW=s,this.balconyAH=l}let h=new i.Vector2(n.x-s/2,n.y-l/2),c=new i.Vector2(n.x+s/2,n.y+l/2),d=this.createShape(h,c);this.shape.push(d)}createBaseDoor(e,t,r){let n,o,a,s,l,h,c,d,u=this.doorWidth,p=this.thickness,m=new i.Group,f=new i.Vector2().add(new i.Vector2(-u/2,0)).add(new i.Vector2(0,-p/2)),g=new i.Vector2().add(new i.Vector2(u/2,0)).add(new i.Vector2(0,p/2)),y=new i.Shape;y.moveTo(f.x,f.y),y.lineTo(f.x,g.y),y.lineTo(g.x,g.y),y.lineTo(g.x,f.y),y.lineTo(f.x,f.y);let x=new i.ShapeGeometry(y),w=new i.Mesh(x,new i.MeshBasicMaterial({color:16711680,side:i.DoubleSide}));w.name="DOOR AS",w.renderOrder=1,t?(l=(s=(a=(o=(n=new i.Vector2(g.x,f.y)).clone().add(new i.Vector2(0,p/2+u))).clone().add(new i.Vector2(-p/2,0))).clone().add(new i.Vector2(0,-u))).clone().add(new i.Vector2(p/2,0)),h=n.clone().add(new i.Vector2(-p/2,p)),c=-Math.PI):(l=(s=(a=(o=(n=f).clone().add(new i.Vector2(0,p/2+u))).clone().add(new i.Vector2(p/2,0))).clone().add(new i.Vector2(0,-u))).clone().add(new i.Vector2(-p/2,0)),h=n.clone().add(new i.Vector2(p/2,p)),c=0),d=Math.PI/2;let b=new i.BufferGeometry().setFromPoints([n,o,a,s,l]),v=new i.Line(b,new i.LineBasicMaterial({color:0}));v.name="DOOR AL",v.renderOrder=10;let M=new i.Path().arc(h.x,h.y,u-p/2,c,d,t).getPoints(),S=new i.BufferGeometry().setFromPoints(M),P=new i.Line(S,new i.LineBasicMaterial({color:0}));P.name="DOOR BL",P.renderOrder=10;let T=new i.Shape;T.moveTo(o.x,o.y),[a,s,l,o].forEach(e=>{T.lineTo(e.x,e.y)});let _=new i.ShapeGeometry(T),C=new i.Mesh(_,new i.MeshBasicMaterial({color:65280,side:i.DoubleSide}));C.name="DOOR BS",C.renderOrder=5,m.add(w,v,P,C);let D=0;return(0==r||1==r)&&(D=Math.PI),(2==r||3==r)&&(D=Math.PI/2),(6==r||7==r)&&(D=-Math.PI/2),m.rotation.z=D,m.position.set(e.x,e.y),m}createBaseWindow(e,t,r){let n=new i.Group,o=new i.Vector2().add(new i.Vector2(-t/2,this.thickness/2)),a=new i.Vector2().add(new i.Vector2(-t/2,0)),s=new i.Vector2().add(new i.Vector2(-t/2,-this.thickness/2)),l=new i.Vector2().add(new i.Vector2(t/2,this.thickness/2)),h=new i.Vector2().add(new i.Vector2(t/2,0)),c=new i.Vector2().add(new i.Vector2(t/2,-this.thickness/2)),d=new i.Shape;d.moveTo(o.x,o.y),[s,c,l,o].forEach(e=>{d.lineTo(e.x,e.y)});let u=new i.ShapeGeometry(d),p=new i.Mesh(u,new i.MeshBasicMaterial({color:16777215,side:i.DoubleSide}));p.name="WINDOW AS",p.renderOrder=10,n.add(p);let m=new i.BufferGeometry().setFromPoints([a,s,c,l,o,a,h]),f=new i.Line(m,new i.LineBasicMaterial({color:0}));return f.name="WINDOW AL",f.renderOrder=10,n.add(f),n.rotation.z=r,n.position.set(e.x,e.y,10),n}createSlidingDoor(e,t,r,n="Double"){let o=new i.Group,a=new i.Vector2().add(new i.Vector2(-t/2,this.thickness/2)),s=new i.Vector2().add(new i.Vector2(-t/2,-this.thickness/2)),l=new i.Vector2().add(new i.Vector2(t/2,-this.thickness/2)),h=new i.Vector2().add(new i.Vector2(t/2,this.thickness/2)),c=new i.Shape;c.moveTo(a.x,a.y),[s,l,h,a].forEach(e=>{c.lineTo(e.x,e.y)});let d=new i.ShapeGeometry(c),u=new i.Mesh(d,new i.MeshBasicMaterial({color:16777215,side:i.DoubleSide}));u.name="Sliding Door Base Shape",u.renderOrder=10,o.add(u);let p=new i.BufferGeometry().setFromPoints([a,s,l,h,a]),m=new i.Line(p,new i.LineBasicMaterial({color:0}));if(m.name="Sliding Door Border",m.renderOrder=10,o.add(m),"Single"==n&&(new i.Vector2(-t/16,this.thickness/4),new i.Vector2(-t/16,0)),"Double"==n){let e=new i.Vector2(-t/2+t/4/4*3+100,0),r=new i.Vector2(-t/2+100,0),n=r.clone().add(new i.Vector2(0,-this.thickness/4)),a=n.clone().add(new i.Vector2(t/4,0)),s=a.clone().add(new i.Vector2(0,this.thickness/4)),l=s.clone().add(new i.Vector2(t/16*3,0)),h=l.clone().add(new i.Vector2(0,this.thickness/4)),c=h.clone().add(new i.Vector2(-t/4,0)),d=new i.BufferGeometry().setFromPoints([e,r,n,a,s,l,h,c,e,s]),u=new i.Line(d,new i.LineBasicMaterial({color:0}));u.name="Left Sliding Door",u.renderOrder=10,o.add(u);let p=new i.Vector2(-e.x,e.y),m=new i.Vector2(-r.x,r.y),f=new i.Vector2(-n.x,n.y),g=new i.Vector2(-a.x,a.y),y=new i.Vector2(-s.x,s.y),x=new i.Vector2(-l.x,l.y),w=new i.Vector2(-h.x,h.y),b=new i.Vector2(-c.x,c.y),v=new i.BufferGeometry().setFromPoints([p,m,f,g,y,x,w,b,p,y]),M=new i.Line(v,new i.LineBasicMaterial({color:0}));M.name="Right Sliding Door",M.renderOrder=10,o.add(M)}return o.rotation.z=r,o.position.set(e.x,e.y,10),o}generateWindow(){console.log("主",this.masterP,"次",this.secondBP,"厨",this.kitchenP);let e=[this.masterP,this.secondBP,this.kitchenP],t=[];(e.includes(0)||e.includes(1))&&t.push(0,1),(e.includes(2)||e.includes(3))&&t.push(2,3),(e.includes(4)||e.includes(5))&&t.push(4,5),(e.includes(6)||e.includes(7))&&t.push(6,7);let n=this.getPosition(t),o,a=0,s;0==parseInt(n/2)&&(o=this.sitRoomCenter.clone().add(new i.Vector2(0,this.sitRoomH/2))),1==parseInt(n/2)&&(o=this.sitRoomCenter.clone().add(new i.Vector2(this.sitRoomW/2,0)),a=-Math.PI/2),2==parseInt(n/2)&&(o=this.sitRoomCenter.clone().add(new i.Vector2(0,-this.sitRoomH/2))),3==parseInt(n/2)&&(o=this.sitRoomCenter.clone().add(new i.Vector2(-this.sitRoomW/2,0)),a=Math.PI/2),s=-1!=[0,1,4,5].indexOf(n)?this.sitRoomW-1e3:this.sitRoomH-1e3;let l=(0,r.DM).createSlidingDoor(o,s,a);this.doorArr.push(l)}getHome2(){let e,t,i=0,r,n;return n=this.getRandom(0,1),t=(e=this.getRandom(1,3))>1?this.getRandom(1,2):1,r=e>2?this.getRandom(1,2):1,2==e&&(i=this.getRandom(0,1)),3==e&&(i=1),console.log(e+" 室 "+t+" 厅 1 厨 "+r+" 卫 "+i+" 过道 "+(n=1)+"玄关"),this.createSittingRoom(),this.createDiningRoom2(),this.createKitchen2(),1==n&&this.createPorch(),[this.shape,[]]}createDiningRoom2(){let e,t,r,n;let o=this.getRandom(0,3);if(this.sitRoomW>this.sitRoomH&&(e=[2,3,6,7][o]),this.sitRoomW<this.sitRoomH&&(e=[0,1,4,5][o]),this.sitRoomW==this.sitRoomH&&(e=this.getRandom(0,7)),r=this.getRandom(1600,3e3),n=this.getRandom(1600,2500),1==this.getRandom(0,1)){let e=r;r=n,n=e}-1!=[0,1,4,5].indexOf(e)&&1200>=Math.abs(this.sitRoomW-r)&&(r=this.sitRoomW,this.gmt=!0),-1!=[2,3,6,7].indexOf(e)&&1200>=Math.abs(this.sitRoomH-n)&&(n=this.sitRoomH,this.gmt=!0),t=this.computeXY(this.sitRoomCenter,this.sitRoomW,this.sitRoomH,r,n,e),this.diningRoomCenter=t,this.diningRoomW=r,this.diningRoomH=n,this.diningRoomP=e;let a=new i.Vector2(t.x-r/2,t.y-n/2),s=new i.Vector2(t.x+r/2,t.y+n/2),l=this.createShape(a,s);this.shape.push(l)}createKitchen2(){let e,t,r,n,o;console.log("餐厅位置",this.diningRoomP),-1!=[0,1,4,5].indexOf(this.diningRoomP)?(o=this.diningRoomH,n=this.getRandom(2500,3500),r=this.diningRoomCenter.y,-1!=[0,5].indexOf(this.diningRoomP)&&(t=this.diningRoomCenter.x+this.diningRoomW/2+n/2),-1!=[1,4].indexOf(this.diningRoomP)&&(t=this.diningRoomCenter.x-this.diningRoomW/2-n/2)):(n=this.diningRoomW,o=this.getRandom(2500,3500),t=this.diningRoomCenter.x,-1!=[2,7].indexOf(this.diningRoomP)&&(r=this.diningRoomCenter.y-this.diningRoomH/2-o/2),-1!=[3,6].indexOf(this.diningRoomP)&&(r=this.diningRoomCenter.y+this.diningRoomH/2+o/2)),e=new i.Vector2(t,r),this.kitchenCenter=e,this.kitchenW=n,this.kitchenH=o;let a=new i.Vector2(e.x-n/2,e.y-o/2),s=new i.Vector2(e.x+n/2,e.y+o/2),l=this.createShape(a,s);this.shape.push(l)}createToilet2(){let e,t,r,n,o;console.log("餐客一体",this.gmt),this.gmt?(console.log("A"),-1!=[0,1,4,5].indexOf(this.diningRoomP)&&(n=this.kitchenW,o=this.getRandom(1600,2e3),t=this.kitchenCenter.x,-1!=[0,1].indexOf(this.diningRoomP)&&(r=this.kitchenCenter.y-this.kitchenH/2-o/2),-1!=[4,5].indexOf(this.diningRoomP)&&(r=this.kitchenCenter.y+this.kitchenH/2+o/2)),-1!=[2,3,6,7].indexOf(this.diningRoomP)&&(o=this.kitchenH,n=this.getRandom(1600,2e3),r=this.kitchenCenter.y,-1!=[2,3].indexOf(this.diningRoomP)&&(t=this.kitchenCenter.x-this.kitchenW/2-n/2),-1!=[6,7].indexOf(this.diningRoomP)&&(t=this.kitchenCenter.x+this.kitchenW/2+n/2))):-1!=[0,1,4,5].indexOf(this.diningRoomP)?(o=this.diningRoomH,n=this.getRandom(1800,2500),r=this.diningRoomCenter.y,-1!=[0,5].indexOf(this.diningRoomP)&&(t=this.kitchenCenter.x+this.kitchenW/2+n/2),-1!=[1,4].indexOf(this.diningRoomP)&&(t=this.kitchenCenter.x-this.kitchenW/2-n/2)):(n=this.diningRoomW,o=this.getRandom(1800,2500),t=this.diningRoomCenter.x,-1!=[2,7].indexOf(this.diningRoomP)&&(r=this.kitchenCenter.y-this.kitchenH/2-o/2),-1!=[3,6].indexOf(this.diningRoomP)&&(r=this.kitchenCenter.y+this.kitchenH/2+o/2)),e=new i.Vector2(t,r);let a=new i.Vector2(e.x-n/2,e.y-o/2),s=new i.Vector2(e.x+n/2,e.y+o/2),l=this.createShape(a,s);this.shape.push(l)}computeXY(e,t,r,n,o,a){let s,l;return(0==a||5==a)&&(s=e.x-t/2+n/2),(1==a||4==a)&&(s=e.x+t/2-n/2),(0==a||1==a)&&(l=e.y+r/2+o/2),(4==a||5==a)&&(l=e.y-r/2-o/2),(2==a||7==a)&&(l=e.y+r/2-o/2),(3==a||6==a)&&(l=e.y-r/2+o/2),(2==a||3==a)&&(s=e.x+t/2+n/2),(6==a||7==a)&&(s=e.x-t/2-n/2),new i.Vector2(s,l)}createPorch(){this.getRandom(1300,3300),this.getRandom(1300,1500),this.getRandom(0,1)}createSittingRoom(){let e=this.getRandom(this.sitRoomWidthMin,this.sitRoomWidthMax),t=this.getRandom(this.sitRoomHeightMin,this.sitRoomHeightMax);if(this.getRandom(0,1)){let i=e;e=t,t=i}this.sitRoomCenter=new i.Vector2,this.sitRoomW=e,this.sitRoomH=t;let r=new i.Vector2(e/2,t/2),n=new i.Vector2(-e/2,-t/2);this.createShape(n,r)}createDiningRoom(){let e,t=this.getRandom(0,7),r=this.getRandom(1600,2500),n=this.getRandom(1600,2e3);if(-1==[0,1,4,5].indexOf(t)){let e=r;r=n,n=e}let o=this.getCenter(this.sitRoomCenter,this.sitRoomW,this.sitRoomH,r,n,t);0==t&&(e=o.clone().add(new i.Vector2(-r/2,-n/2-200-this.doorWidth/2))),1==t&&(e=o.clone().add(new i.Vector2(r/2,-n/2-200-this.doorWidth/2))),2==t&&(e=o.clone().add(new i.Vector2(-r/2-200-this.doorWidth/2,n/2))),3==t&&(e=o.clone().add(new i.Vector2(-r/2-200-this.doorWidth/2,-n/2))),4==t&&(e=o.clone().add(new i.Vector2(r/2,n/2+200+this.doorWidth/2))),5==t&&(e=o.clone().add(new i.Vector2(-r/2,n/2+200+this.doorWidth/2))),6==t&&(e=o.clone().add(new i.Vector2(r/2+200+this.doorWidth/2,-n/2))),7==t&&(e=o.clone().add(new i.Vector2(r/2+200+this.doorWidth/2,n/2))),this.diningRoomCenter=o,this.diningRoomW=r,this.diningRoomH=n,this.diningRoomP=t;let a=new i.Vector2(o.x-r/2,o.y-n/2),s=new i.Vector2(o.x+r/2,o.y+n/2),l=this.createShape(a,s);this.shape.push(l)}createKitchen(e){let t,n,o,a,s,l;e>1?(0==this.diningRoomP&&(t=1),1==this.diningRoomP&&(t=0),2==this.diningRoomP&&(t=3),3==this.diningRoomP&&(t=2),4==this.diningRoomP&&(t=5),5==this.diningRoomP&&(t=4),6==this.diningRoomP&&(t=7),7==this.diningRoomP&&(t=6)):t=this.getRandom(0,7),-1!=[0,1,4,5].indexOf(t)?(n=this.diningRoomW?this.sitRoomW-this.diningRoomW:this.getRandom(1600,2e3),o=this.getRandom(2500,3500)):(o=this.diningRoomW?this.sitRoomH-this.diningRoomH:this.getRandom(1600,2e3),n=this.getRandom(2500,3500)),a=this.getCenter(this.sitRoomCenter,this.sitRoomW,this.sitRoomH,n,o,t),-1!=[0,1,4,5].indexOf(t)?(s=a.x,(0==t||1==t)&&(l=a.y-o/2),(4==t||5==t)&&(l=a.y+o/2)):(l=a.y,(2==t||3==t)&&(s=a.x-n/2),(6==t||7==t)&&(s=a.x+n/2));let h=0;(4==t||5==t)&&(h=Math.PI),(2==t||3==t)&&(h=-Math.PI/2),(6==t||7==t)&&(h=Math.PI/2);let c=(0,r.DM).createBaseDoor(new i.Vector2(s,l),800,"inside",h);c.name="kitchen door",this.doorArr.push(c);let d,u,p,m=0;-1!=[0,1,4,5].indexOf(t)?(d=s,p=n-600,(0==t||1==t)&&(u=l+o),(4==t||5==t)&&(u=l-o)):(u=l,p=o-600,m=Math.PI/2,(2==t||3==t)&&(d=s+n),(6==t||7==t)&&(d=s-n));let f=(0,r.DM).createBaseWindow(new i.Vector2(d,u),p,m);f.name="kitchen window",this.doorArr.push(f),this.kitchenCenter=a,this.kitchenW=n,this.kitchenH=o,this.kitchenP=t;let g=new i.Vector2(a.x-n/2,a.y-o/2),y=new i.Vector2(a.x+n/2,a.y+o/2),x=this.createShape(g,y);this.shape.push(x)}createToilet(e){let t,n,o,a,s,l,h;e>1?-1!=[0,1,4,5].indexOf(this.diningRoomP)?(l=this.diningRoomCenter.x,t=this.diningRoomW,n=this.kitchenH-this.diningRoomH>=1800?this.kitchenH-this.diningRoomH:this.getRandom(1800,2500),(0==this.diningRoomP||1==this.diningRoomP)&&(s=this.diningRoomCenter.y+this.diningRoomH/2+n/2,h=this.diningRoomCenter.y+this.diningRoomH/2),(4==this.diningRoomP||5==this.diningRoomP)&&(s=this.diningRoomCenter.y-this.diningRoomH/2-n/2,h=this.diningRoomCenter.y-this.diningRoomH/2),a=this.diningRoomCenter.x):(h=this.diningRoomCenter.y,n=this.diningRoomH,t=this.kitchenW-this.diningRoomW>=1800?this.kitchenW-this.diningRoomW:this.getRandom(1800,2500),(2==this.diningRoomP||3==this.diningRoomP)&&(a=this.diningRoomCenter.x+this.diningRoomW/2+t/2,l=this.diningRoomCenter.x+this.diningRoomW/2),(6==this.diningRoomP||7==this.diningRoomP)&&(a=this.diningRoomCenter.x-this.diningRoomW/2-t/2,l=this.diningRoomCenter.x-this.diningRoomW/2),s=this.diningRoomCenter.y):-1!=[0,1,4,5].indexOf(this.kitchenP)?(t=this.sitRoomW-this.kitchenW>=1600?this.sitRoomW-this.kitchenW:this.getRandom(this.sitRoomW-this.kitchenW+this.thickness+this.bufferMeter,2e3),n=this.getRandom(1800,2500),(0==this.kitchenP||5==this.kitchenP)&&(a=this.kitchenCenter.x+this.kitchenW/2+t/2),(1==this.kitchenP||4==this.kitchenP)&&(a=this.kitchenCenter.x-this.kitchenW/2-t/2),l=a,(0==this.kitchenP||1==this.kitchenP)&&(h=(s=this.kitchenCenter.y-this.kitchenH/2+n/2)-n/2),(4==this.kitchenP||5==this.kitchenP)&&(h=(s=this.kitchenCenter.y+this.kitchenH/2-n/2)+n/2)):(n=this.sitRoomH-this.kitchenH>=1600?this.sitRoomH-this.kitchenH:this.getRandom(this.sitRoomH-this.kitchenH+this.thickness+this.bufferMeter,2e3),t=this.getRandom(1800,2500),(2==this.kitchenP||7==this.kitchenP)&&(s=this.kitchenCenter.y-this.kitchenH/2-n/2),(3==this.kitchenP||6==this.kitchenP)&&(s=this.kitchenCenter.y+this.kitchenH/2+n/2),h=s,(2==this.kitchenP||3==this.kitchenP)&&(l=(a=this.kitchenCenter.x-this.kitchenW/2+t/2)-t/2),(6==this.kitchenP||7==this.kitchenP)&&(l=(a=this.kitchenCenter.x+this.kitchenW/2-t/2)+t/2)),o=new i.Vector2(a,s);let c=0;(4==this.kitchenP||5==this.kitchenP)&&(c=Math.PI),(2==this.kitchenP||3==this.kitchenP)&&(c=-Math.PI/2),(6==this.kitchenP||7==this.kitchenP)&&(c=Math.PI/2);let d=(0,r.DM).createBaseDoor(new i.Vector2(l,h),800,"inside",c);d.name="toilet door",this.doorArr.push(d);let u,p,m,f=0;-1!=[0,1,4,5].indexOf(this.kitchenP)?(u=l,m=t-600,(0==this.kitchenP||1==this.kitchenP)&&(p=h+n),(4==this.kitchenP||5==this.kitchenP)&&(p=h-n)):(p=h,m=n-600,f=Math.PI/2,(2==this.kitchenP||3==this.kitchenP)&&(u=l+t),(6==this.kitchenP||7==this.kitchenP)&&(u=l-t));let g=(0,r.DM).createBaseWindow(new i.Vector2(u,p),m,f);g.name="toilet window",this.doorArr.push(g),this.toiletC=o,this.toiletW=t,this.toiletH=n;let y=new i.Vector2(o.x-t/2,o.y-n/2),x=new i.Vector2(o.x+t/2,o.y+n/2),w=this.createShape(y,x);this.shape.push(w)}createSecondBedroom(){let e,t,n,o,a=[];(0==this.kitchenP||1==this.kitchenP)&&(a=[0,1]),(2==this.kitchenP||3==this.kitchenP)&&(a=[2,3]),(4==this.kitchenP||5==this.kitchenP)&&(a=[4,5]),(6==this.kitchenP||7==this.kitchenP)&&(a=[6,7]);let s=this.getPosition(a);this.secondBedroomP=s;let l=this.getRandom(2500,3200),h=this.getRandom(2500,3e3);-1!=[0,1,4,5].indexOf(s)?(n=e=this.getCenterXY(this.sitRoomCenter.x,this.sitRoomW/2,l/2,s),(0==s||1==s)&&(o=(t=this.sitRoomCenter.y+this.sitRoomH/2+h/2)-h/2),(4==s||5==s)&&(o=(t=this.sitRoomCenter.y-this.sitRoomH/2-h/2)+h/2)):(o=t=this.getCenterXY(this.sitRoomCenter.y,this.sitRoomH/2,h/2,s),(2==s||3==s)&&(n=(e=this.sitRoomCenter.x+this.sitRoomW/2+l/2)-l/2),(6==s||7==s)&&(n=(e=this.sitRoomCenter.x-this.sitRoomW/2-l/2)+l/2));let c=new i.Vector2(e,t),d=0;(4==s||5==s)&&(d=Math.PI),(2==s||3==s)&&(d=-Math.PI/2),(6==s||7==s)&&(d=Math.PI/2);let u=(0,r.DM).createBaseDoor(new i.Vector2(n,o),800,"inside",d);u.name="secondBD door",this.doorArr.push(u);let p,m,f,g=0;-1!=[0,1,4,5].indexOf(s)?(p=n,f=l-600,(0==s||1==s)&&(m=o+h),(4==s||5==s)&&(m=o-h)):(m=o,f=h-600,g=Math.PI/2,(2==s||3==s)&&(p=n+l),(6==s||7==s)&&(p=n-l));let y=(0,r.DM).createBaseWindow(new i.Vector2(p,m),f,g);y.name="secondBD window",this.doorArr.push(y),this.secondBP=s,this.secondBC=c,this.secondBW=l,this.secondBH=h;let x=new i.Vector2(c.x-l/2,c.y-h/2),w=new i.Vector2(c.x+l/2,c.y+h/2),b=this.createShape(x,w);this.shape.push(b)}getCenterXY(e,t,i,r=0){let n;if(this.flat)n=-1!=[0,3,5,6].indexOf(r)?e-t+i:e+t-i;else{let r=e-t+this.thickness+this.bufferMeter-i,n=e+t-this.thickness-this.bufferMeter+i,o=e-t-this.thickness-this.bufferMeter+i,a=e-t+this.thickness+this.bufferMeter+i,s=e+t-this.thickness-this.bufferMeter-i,l=e+t+this.thickness+this.bufferMeter-i,h=e-t+i,c=e+t-i,d=this.getRandom(r,n);if(d>o&&d<a)return d==h?d:this.getCenterXY(e,t,i);if(d>s&&d<l)return d==c?d:this.getCenterXY(e,t,i)}return n}createMasterBedroom(e){let t,n,o,a,s=[];(0==this.kitchenP||1==this.kitchenP)&&(s=[0,1]),(2==this.kitchenP||3==this.kitchenP)&&(s=[2,3]),(4==this.kitchenP||5==this.kitchenP)&&(s=[4,5]),(6==this.kitchenP||7==this.kitchenP)&&(s=[6,7]),e>1&&((0==this.secondBedroomP||1==this.secondBedroomP)&&s.push(0,1),(2==this.secondBedroomP||3==this.secondBedroomP)&&s.push(2,3),(4==this.secondBedroomP||5==this.secondBedroomP)&&s.push(4,5),(6==this.secondBedroomP||7==this.secondBedroomP)&&s.push(6,7));let l=this.getPosition(s),h=this.getRandom(4e3,4500),c=this.getRandom(2800,3500),d=0;if(console.log(this.sitRoomW-h,this.sitRoomW-c),-1!=[0,1,4,5].indexOf(l)){if(this.sitRoomW-h<1e3){let e=h;h=c,c=e,this.sitRoomW-h>=1e3?d=(this.sitRoomW-h)/2:(h=this.sitRoomW-1e3,d=500)}else d=(this.sitRoomW-h)/2}else if(this.sitRoomH-c<1e3){let e=h;h=c,c=e,this.sitRoomH-c>=1e3?d=(this.sitRoomH-c)/2:(c=this.sitRoomH-1e3,d=500)}else d=(this.sitRoomH-c)/2;e>1?((0==this.secondBedroomP||1==this.secondBedroomP)&&(-1!=[2,3,6,7].indexOf(l)&&(n=this.getCenterXY(this.sitRoomCenter.y,this.sitRoomH/2,c/2,l),-1!=[2,3].indexOf(l)&&(t=this.sitRoomCenter.x+this.sitRoomW/2+h/2),-1!=[6,7].indexOf(l)&&(t=this.sitRoomCenter.x-this.sitRoomW/2-h/2)),(4==l||5==l)&&(n=this.sitRoomCenter.y-this.sitRoomH/2-c/2,t=this.getCenterXY(this.sitRoomCenter.x,this.sitRoomW/2,h/2,l))),(2==this.secondBedroomP||3==this.secondBedroomP)&&(-1!=[0,1,4,5].indexOf(l)&&(t=this.getCenterXY(this.sitRoomCenter.x,this.sitRoomW/2,h/2,l),-1!=[0,1].indexOf(l)&&(n=this.sitRoomCenter.y+this.sitRoomH/2+c/2),-1!=[4,5].indexOf(l)&&(n=this.sitRoomCenter.y-this.sitRoomH/2-c/2)),(6==l||7==l)&&(t=this.sitRoomCenter.x-this.sitRoomW/2-h/2,n=this.getCenterXY(this.sitRoomCenter.y,this.sitRoomH/2,c/2,l))),(4==this.secondBedroomP||5==this.secondBedroomP)&&(-1!=[2,3,6,7].indexOf(l)&&(n=this.getCenterXY(this.sitRoomCenter.y,this.sitRoomH/2,c/2,l),-1!=[2,3].indexOf(l)&&(t=this.sitRoomCenter.x+this.sitRoomW/2+h/2),-1!=[6,7].indexOf(l)&&(t=this.sitRoomCenter.x-this.sitRoomW/2-h/2)),(0==l||1==l)&&(n=this.sitRoomCenter.y+this.sitRoomH/2+c/2,t=this.getCenterXY(this.sitRoomCenter.x,this.sitRoomW/2,h/2,l))),(6==this.secondBedroomP||7==this.secondBedroomP)&&(-1!=[0,1,4,5].indexOf(l)&&(t=this.getCenterXY(this.sitRoomCenter.x,this.sitRoomW/2,h/2,l),-1!=[0,1].indexOf(l)&&(n=this.sitRoomCenter.y+this.sitRoomH/2+c/2),-1!=[4,5].indexOf(l)&&(n=this.sitRoomCenter.y-this.sitRoomH/2-c/2)),(2==l||3==l)&&(t=this.sitRoomCenter.x+this.sitRoomW/2+h/2,n=this.getCenterXY(this.sitRoomCenter.y,this.sitRoomH/2,c/2,l)))):(-1!=[0,1,4,5].indexOf(l)&&(t=this.getCenterXY(this.sitRoomCenter.x,this.sitRoomW/2,h/2,l),-1!=[0,1].indexOf(l)&&(n=this.sitRoomCenter.y+this.sitRoomH/2+c/2),-1!=[4,5].indexOf(l)&&(n=this.sitRoomCenter.y-this.sitRoomH/2-c/2)),-1!=[2,3,6,7].indexOf(l)&&(n=this.getCenterXY(this.sitRoomCenter.y,this.sitRoomH/2,c/2,l),-1!=[2,3].indexOf(l)&&(t=this.sitRoomCenter.x+this.sitRoomW/2+h/2),-1!=[6,7].indexOf(l)&&(t=this.sitRoomCenter.x-this.sitRoomW/2-h/2)));let u=new i.Vector2(t,n);-1!=[0,1,4,5].indexOf(l)?(o=u.x,(0==l||1==l)&&(a=u.y-c/2),(4==l||5==l)&&(a=u.y+c/2)):(a=u.y,(2==l||3==l)&&(o=u.x-h/2),(6==l||7==l)&&(o=u.x+h/2));let p=0;(4==l||5==l)&&(p=Math.PI),(2==l||3==l)&&(p=-Math.PI/2),(6==l||7==l)&&(p=Math.PI/2);let m=(0,r.DM).createBaseDoor(new i.Vector2(o,a),800,"inside",p);m.name="masterBD door",this.doorArr.push(m);let f=0,g=0;(0==l||5==l)&&(f=u.x+h/2+d),(1==l||4==l)&&(f=u.x-h/2-d),(0==l||1==l)&&(g=u.y-c/2),(4==l||5==l)&&(g=u.y+c/2),(2==l||3==l)&&(f=u.x-h/2),(6==l||7==l)&&(f=u.x+h/2),(2==l||7==l)&&(g=u.y-c/2-d),(3==l||6==l)&&(g=u.y+c/2+d);let y=0;(0==l||1==l)&&(y=Math.PI),(2==l||3==l)&&(y=Math.PI/2),(6==l||7==l)&&(y=-Math.PI/2);let x=(0,r.DM).createLashDoor(new i.Vector2(f,g),800,y);x.name="entry door",this.doorArr.push(x),this.masterP=l,this.masterC=u,this.masterW=h,this.masterH=c;let w=new i.Vector2(u.x-h/2,u.y-c/2),b=new i.Vector2(u.x+h/2,u.y+c/2),v=this.createShape(w,b,"CW");this.shape.push(v)}createStudy(){let e,t,n,o,a,s,l;if(0==this.secondBP&&(e=1),1==this.secondBP&&(e=0),2==this.secondBP&&(e=3),3==this.secondBP&&(e=2),4==this.secondBP&&(e=5),5==this.secondBP&&(e=4),6==this.secondBP&&(e=7),7==this.secondBP&&(e=6),-1!=[0,1,4,5].indexOf(e)){t=this.getRandom(2500,3200),n=this.secondBH,a=this.secondBC.y;let i=this.sitRoomW-this.secondBW;(0==e||1==e)&&(l=this.secondBC.y-this.secondBH/2),(4==e||5==e)&&(l=this.secondBC.y+this.secondBH/2),(0==e||5==e)&&(s=this.secondBC.x-this.secondBW/2-i/2),(1==e||4==e)&&(s=this.secondBC.x+this.secondBW/2+i/2)}else{t=this.secondBW,n=this.getRandom(2500,3e3),o=this.secondBC.x;let i=this.sitRoomH-this.secondBH;(2==e||3==e)&&(s=this.secondBC.x-this.secondBW/2),(6==e||7==e)&&(s=this.secondBC.x+this.secondBW/2),(2==e||7==e)&&(l=this.secondBC.y+this.secondBH/2+i/2),(3==e||6==e)&&(l=this.secondBC.y-this.secondBH/2-i/2)}(0==this.secondBP||5==this.secondBP)&&(o=this.secondBC.x+this.secondBW/2+t/2),(1==this.secondBP||4==this.secondBP)&&(o=this.secondBC.x-this.secondBW/2-t/2),(2==this.secondBP||7==this.secondBP)&&(a=this.secondBC.y-this.secondBH/2-n/2),(3==this.secondBP||6==this.secondBP)&&(a=this.secondBC.y+this.secondBH/2+n/2);let h=new i.Vector2(o,a),c=0;(4==this.secondBP||5==this.secondBP)&&(c=Math.PI),(2==this.secondBP||3==this.secondBP)&&(c=-Math.PI/2),(6==this.secondBP||7==this.secondBP)&&(c=Math.PI/2);let d=(0,r.DM).createBaseDoor(new i.Vector2(s,l),800,"inside",c);d.name="study door",this.doorArr.push(d);let u,p,m=0,f,g;-1!=[0,1,4,5].indexOf(e)?(f=h.x,(0==e||1==e)&&(g=h.y+n/2),(4==e||5==e)&&(g=h.y-n/2,m=Math.PI),p=t):(g=h.y,(2==e||3==e)&&(f=h.x+t/2,m=-Math.PI/2),(6==e||7==e)&&(f=h.x-t/2,m=Math.PI/2),p=n),u=new i.Vector2(f,g);let y=(0,r.DM).createPanoramicWindow(u,p,m);y.name="study pw",this.doorArr.push(y);let x=new i.Vector2(h.x-t/2,h.y-n/2),w=new i.Vector2(h.x+t/2,h.y+n/2),b=this.createShape(x,w);this.shape.push(b)}getCenter(e,t,r,n,o,a){let s,l;switch(a){case 0:s=e.x-t/2+n/2,l=e.y+r/2+o/2;break;case 1:s=e.x+t/2-n/2,l=e.y+r/2+o/2;break;case 2:s=e.x+t/2+n/2,l=e.y+r/2-o/2;break;case 3:s=e.x+t/2+n/2,l=e.y-r/2+o/2;break;case 4:s=e.x+t/2-n/2,l=e.y-r/2-o/2;break;case 5:s=e.x-t/2+n/2,l=e.y-r/2-o/2;break;case 6:s=e.x-t/2-n/2,l=e.y-r/2+o/2;break;case 7:s=e.x-t/2-n/2,l=e.y+r/2-o/2}return new i.Vector2(s,l)}createShape(e,t,r=""){let n=new i.Shape,o;if(""==r){n.moveTo(e.x,t.y),n.lineTo(t.x,t.y),n.lineTo(t.x,e.y),n.lineTo(e.x,e.y),n.lineTo(e.x,t.y);let r=new i.ShapeGeometry(n);o=new i.Mesh(r,new i.MeshBasicMaterial({color:16777215*Math.random(),side:i.DoubleSide})),this.jsonArr.push(this.createJsonBy2Point(new i.Vector2(e.x,t.y),new i.Vector2(t.x,t.y))),this.jsonArr.push(this.createJsonBy2Point(new i.Vector2(t.x,t.y),new i.Vector2(t.x,e.y))),this.jsonArr.push(this.createJsonBy2Point(new i.Vector2(t.x,e.y),new i.Vector2(e.x,e.y))),this.jsonArr.push(this.createJsonBy2Point(new i.Vector2(e.x,e.y),new i.Vector2(e.x,t.y)))}return"CW"==r&&(o=this.addCornerWindow(e,t,n)),o}addCornerWindow(e,t,n){let o,a,s,l,h,c,d,u,p=2500,m=1400;if(this.masterH>this.masterW){let e=p;p=m,m=e}(0==this.masterP||7==this.masterP)&&(o=e.clone(),a=new i.Vector2(e.x,t.y-m+this.cornerWindowWidth),s=new i.Vector2(e.x-this.cornerWindowWidth,a.y),l=new i.Vector2(s.x,s.y+m),h=new i.Vector2(l.x+p,l.y),c=new i.Vector2(h.x,h.y-this.cornerWindowWidth),d=t.clone(),u=new i.Vector2(t.x,e.y)),(1==this.masterP||2==this.masterP)&&(u=e.clone(),o=new i.Vector2(e.x,t.y),a=new i.Vector2(t.x-p+this.cornerWindowWidth,t.y),s=new i.Vector2(a.x,a.y+this.cornerWindowWidth),l=new i.Vector2(s.x+p,s.y),h=new i.Vector2(l.x,l.y-m),c=new i.Vector2(h.x-this.cornerWindowWidth,h.y),d=new i.Vector2(t.x,e.y)),(3==this.masterP||4==this.masterP)&&(d=e.clone(),u=new i.Vector2(e.x,t.y),o=t.clone(),a=new i.Vector2(t.x,e.y+m-this.cornerWindowWidth),s=new i.Vector2(a.x+this.cornerWindowWidth,a.y),l=new i.Vector2(s.x,s.y-m),h=new i.Vector2(l.x-p,l.y),c=new i.Vector2(h.x,h.y+this.cornerWindowWidth)),(5==this.masterP||6==this.masterP)&&(d=new i.Vector2(e.x,t.y),u=t.clone(),o=new i.Vector2(t.x,e.y),a=new i.Vector2(e.x+p-this.cornerWindowWidth,e.y),s=new i.Vector2(a.x,a.y-this.cornerWindowWidth),l=new i.Vector2(s.x-p,s.y),h=new i.Vector2(l.x,l.y+m),c=new i.Vector2(h.x+this.cornerWindowWidth,h.y)),n.moveTo(o.x,o.y);let f=[a,s,l,h,c,d,u,o];f.forEach(e=>{n.lineTo(e.x,e.y)});for(let e=0;e<f.length;e++)e==f.length-1?this.jsonArr.push(this.createJsonBy2Point(f[e],f[0])):this.jsonArr.push(this.createJsonBy2Point(f[e],f[e+1]));let g,y=0,x,w=0,b=s.clone().add(l).divideScalar(2),v=l.clone().add(h).divideScalar(2);[0,7,3,4].includes(this.masterP)?(g=m-this.thickness,y=Math.PI/2,x=p-this.thickness):(g=p-this.thickness,x=m-this.thickness,w=Math.PI/2);let M=(0,r.DM).createBaseWindow(b,g,y),S=(0,r.DM).createBaseWindow(v,x,w);return M.name="CW1",S.name="CW2",this.doorArr.push(M,S),n}handleSegment(){let e=[];for(;this.jsonArr.length>0;){let t=this.jsonArr.shift();if(0==e.length)e.push(t);else{let i=e.length,r=[],n=!0;for(let o=0;o<i;o++){let i=this.handleIntersect(t,e.shift());i.length>1&&(n=!1),r.push(...i)}n&&r.push(t),e=this.mergeArr(r)}}return e=this.handleInclude(e),this.doorArr.forEach(t=>{for(let r=0;r<e.length;r++){let n=e[r],o=new i.Vector3(n.start.x,n.start.y,0),a=new i.Vector3(n.end.x,n.end.y,0),s=o.clone().add(a).divideScalar(2);if(t.position.x==s.x&&t.position.y==s.y){t.wallStartPoint=o,t.wallEndPoint=a;break}}}),console.log("finalArr",e),e}handleInclude(e){let t=[];for(let r=0;r<e.length;r++){let n=[],o=[],a=new i.Vector2(e[r].start.x,e[r].start.y),s=new i.Vector2(e[r].end.x,e[r].end.y);for(let t=0;t<e.length;t++)if(r!=t){let r=new i.Vector2(e[t].start.x,e[t].start.y),l=new i.Vector2(e[t].end.x,e[t].end.y);r.distanceTo(l)<a.distanceTo(s)&&((r.equals(a)||l.equals(a))&&n.push(e[t]),(r.equals(s)||l.equals(s))&&o.push(e[t]))}for(let a=0;a<n.length;a++){let s=new i.Vector2(n[a].start.x,n[a].start.y),l=new i.Vector2(n[a].end.x,n[a].end.y);for(let n=0;n<o.length;n++){let a=new i.Vector2(o[n].start.x,o[n].start.y),h=new i.Vector2(o[n].end.x,o[n].end.y);(s.equals(a)||s.equals(h)||l.equals(a)||l.equals(h))&&t.push(e[r])}}}return t.forEach(t=>{e.splice(e.indexOf(t),1)}),e}handleIntersect(e,t){let r=e.equation,n=t.equation,o=new i.Vector2(e.start.x,e.start.y),a=new i.Vector2(e.end.x,e.end.y),s=new i.Vector2(t.start.x,t.start.y),l=new i.Vector2(t.end.x,t.end.y);if("Y"==r[0]){if("Y"==n[0]){if(r[1]!=n[1])return[t];{let i=Math.min(s.x,l.x),r=Math.max(s.x,l.x),n=s.x==i?s:l,h=s.x==r?s:l;if(o.x<i){if(a.x<i||a.x==i)return[t];if(a.x>i&&a.x<r)return[this.createJsonBy2Point(o,n),this.createJsonBy2Point(n,a),this.createJsonBy2Point(a,h)];if(a.x==r)return[this.createJsonBy2Point(o,n),t];if(a.x>r)return[this.createJsonBy2Point(o,n),t,this.createJsonBy2Point(h,a)]}if(o.x==i){if(a.x<i)return[t];if(a.x>i&&a.x<r)return[e,this.createJsonBy2Point(a,h)];if(a.x==r)return[t];if(a.x>r)return[t,this.createJsonBy2Point(h,a)]}if(o.x>i&&o.x<r){if(a.x<i)return[this.createJsonBy2Point(a,n),this.createJsonBy2Point(n,o),this.createJsonBy2Point(o,h)];if(a.x==i)return[e,this.createJsonBy2Point(o,h)];if(a.x>i&&a.x<o.x)return[this.createJsonBy2Point(n,a),e,this.createJsonBy2Point(o,h)];if(a.x>o.x&&a.x<r)return[this.createJsonBy2Point(n,o),e,this.createJsonBy2Point(a,h)];if(a.x==r)return[this.createJsonBy2Point(n,o),e];if(a.x>r)return[this.createJsonBy2Point(n,o),this.createJsonBy2Point(o,h),this.createJsonBy2Point(h,a)]}if(o.x==r){if(a.x<i)return[this.createJsonBy2Point(a,n),t];if(a.x==i)return[t];if(a.x>i&&a.x<r)return[this.createJsonBy2Point(n,a),e];if(a.x>r)return[t]}if(o.x>r){if(a.x<i)return[this.createJsonBy2Point(a,n),t,this.createJsonBy2Point(h,o)];if(a.x==i)return[t,this.createJsonBy2Point(h,o)];if(a.x>i&&a.x<r)return[this.createJsonBy2Point(n,a),this.createJsonBy2Point(a,h),this.createJsonBy2Point(h,o)];if(a.x==r||a.x>r)return[t]}}}if("X"==n[0]){let e=Math.min(o.x,a.x),h=Math.max(o.x,a.x),c=o.x==e?o:a,d=o.x==h?o:a,u=Math.min(s.y,l.y),p=Math.max(s.y,l.y),m=s.y==u?s:l,f=s.y==p?s:l,g=r[1]>u&&r[1]<p,y=n[1]>e&&n[1]<h;if(!g||!y)return[t];{let e=new i.Vector2(n[1],r[1]);return[this.createJsonBy2Point(c,e),this.createJsonBy2Point(e,d),this.createJsonBy2Point(m,e),this.createJsonBy2Point(e,f)]}}}else if("X"==r[0]){if("X"==n[0]){if(r[1]!=n[1])return[t];{let i=Math.min(s.y,l.y),r=Math.max(s.y,l.y),n=s.y==i?s:l,h=s.y==r?s:l;if(o.y<i){if(a.y<i||a.y==i)return[t];if(a.y>i&&a.y<r)return[this.createJsonBy2Point(o,n),this.createJsonBy2Point(n,a),this.createJsonBy2Point(a,h)];if(a.y==r)return[this.createJsonBy2Point(o,n),t];if(a.y>r)return[this.createJsonBy2Point(o,n),t,this.createJsonBy2Point(h,a)]}if(o.y==i){if(a.y<i)return[t];if(a.y>i&&a.y<r)return[e,this.createJsonBy2Point(a,h)];if(a.y==r)return[t];if(a.y>r)return[t,this.createJsonBy2Point(h,a)]}if(o.y>i&&o.y<r){if(a.y<i)return[this.createJsonBy2Point(a,n),this.createJsonBy2Point(n,o),this.createJsonBy2Point(o,h)];if(a.y==i)return[e,this.createJsonBy2Point(o,h)];if(a.y>i&&a.y<o.y)return[this.createJsonBy2Point(n,a),e,this.createJsonBy2Point(o,h)];if(a.y>o.y&&a.y<r)return[this.createJsonBy2Point(n,o),e,this.createJsonBy2Point(a,h)];if(a.y==r)return[this.createJsonBy2Point(n,o),e];if(a.y>r)return[this.createJsonBy2Point(n,o),this.createJsonBy2Point(o,h),this.createJsonBy2Point(h,a)]}if(o.y==r){if(a.y<i)return[this.createJsonBy2Point(a,n),t];if(a.y==i)return[t];if(a.y>i&&a.y<r)return[this.createJsonBy2Point(n,a),e];if(a.y>r)return[t]}if(o.y>r){if(a.y<i)return[this.createJsonBy2Point(a,n),t,this.createJsonBy2Point(h,o)];if(a.y==i)return[t,this.createJsonBy2Point(h,o)];if(a.y>i&&a.y<r)return[this.createJsonBy2Point(n,a),this.createJsonBy2Point(a,h),this.createJsonBy2Point(h,o)];if(a.y==r||a.y>r)return[t]}}}if("Y"==n[0]){let e=Math.min(s.x,l.x),h=Math.max(s.x,l.x),c=s.x==e?s:l,d=s.x==h?s:l,u=Math.min(o.y,a.y),p=Math.max(o.y,a.y),m=o.y==u?o:a,f=o.y==p?o:a,g=r[1]>e&&r[1]<h,y=n[1]>u&&n[1]<p;if(!g||!y)return[t];{let e=new i.Vector2(r[1],n[1]);return[this.createJsonBy2Point(c,e),this.createJsonBy2Point(e,d),this.createJsonBy2Point(m,e),this.createJsonBy2Point(e,f)]}}}return[]}mergeArr(e){let t=[];return e.forEach(e=>{t.length>0&&this.isInclude(t,e)||t.push(e)}),t}isInclude(e,t){let r=new i.Vector2(t.start.x,t.start.y),n=new i.Vector2(t.end.x,t.end.y);for(let t=0;t<e.length;t++){let o=new i.Vector2(e[t].start.x,e[t].start.y),a=new i.Vector2(e[t].end.x,e[t].end.y),s=o.equals(r)&&a.equals(n),l=o.equals(n)&&a.equals(r);if(s||l)return!0}return!1}handleCollinear(){}createJsonBy2Point(e,t){let i=this.getLineData(e,t);return{start:{x:e.x,y:e.y,z:0},end:{x:t.x,y:t.y,z:0},style:2,line:0,isArc:!1,thickness:this.thickness,height:this.height,direction:"",offsetXY:100,equation:i}}getLineData(e,t){if(e.x==t.x)var i="X",r=e.x;else if(e.y==t.y)var i="Y",r=e.y;else{var i=(e.y-t.y)/(e.x-t.x);i=Math.round(1e4*i)/1e4;var r=e.y-i*e.x}return[i,r=Math.round(1e3*r)/1e3]}getRandom(e,t){return Math.floor(Math.random()*(t-e+1))+e}getPosition(e=[]){let t=this.getRandom(0,7);return -1!=e.indexOf(t)&&(t=this.getPosition(e)),t}filterArray(e){let t=[];return e.forEach(e=>{let i=!0;t.forEach(r=>{r?e[0]===r[0]&&e[1]===r[1]&&(i=!1):t.push(e)}),i&&t.push(e)}),t}}}),parcelRequire.register("6TG3N",function(e,t){$parcel$export(e.exports,"BaseRender",()=>p);var i=parcelRequire("4xklQ"),r=parcelRequire("yHpto"),n=parcelRequire("6XpV3"),o=parcelRequire("3RVm4"),a=parcelRequire("3J0DK"),s=parcelRequire("1EKZI"),l=parcelRequire("awRkS"),h=parcelRequire("hu0fb"),c=parcelRequire("d14eh"),d=parcelRequire("8S9CF"),u=parcelRequire("cc4Nq");class p{constructor(e){this.editor=e,this.editor.baseRender=this,this.maxSamples=300,this.material="Aluminum",this.denoiseEnabled=!0,this.denoiseSigma=1,this.denoiseThreshold=.1,this.denoiseKSigma=1,this.updateFlag=!1,$("#loading").length>0&&$("#loading").remove(),$("#samples").length>0&&$("#samples").remove();let t="<div id= loading>正在加载</div>";$("body").append(t),$("#loading").css({color:"#000",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)","font-weight":"bold","font-size":"32px"}),this.newMain()}generateRadialFloorTexture(e){let t=new Uint8Array(e*e*4);for(let i=0;i<e;i++)for(let r=0;r<e;r++){let n=i/(e-1),o=r/(e-1),a=2*(n-.5),s=2*(o-.5),l=Math.max(Math.min(1-Math.sqrt(a**2+s**2),1),0);l=Math.min(l=l**2*1.5,1);let h=r*e+i;t[4*h+0]=255,t[4*h+1]=255,t[4*h+2]=255,t[4*h+3]=255*l}let r=new i.DataTexture(t,e,e);return r.format=i.RGBAFormat,r.type=i.UnsignedByteType,r.minFilter=i.LinearFilter,r.magFilter=i.LinearFilter,r.wrapS=i.RepeatWrapping,r.wrapT=i.RepeatWrapping,r.needsUpdate=!0,r}async newMain(){$(this.editor.dom).empty();let e=new i.WebGLRenderer({antialias:!0});e.setSize(window.innerWidth,window.innerHeight),e.setClearColor(16777215,0),e.toneMapping=i.ACESFilmicToneMapping,e.outputEncoding=i.sRGBEncoding,e.setClearColor(0,0),this.editor.dom.appendChild(e.domElement),this.scene=new i.Scene;let t=new a.PathTracingRenderer(e),h=new s.PhysicalPathTracingMaterial;t.setSize(window.innerWidth,window.innerHeight);let c="";for(let e in this.editor.cameras)"3dCamera"==this.editor.cameras[e].name&&(c=this.editor.cameras[e]);t.camera=c,t.material=h,t.alpha=!0,this.ptRenderer=t,this.fsQuad=new r.FullScreenQuad(new i.MeshBasicMaterial({map:t.target.texture,blending:i.CustomBlending,premultipliedAlpha:e.getContextAttributes().premultipliedAlpha})),this.denoiseQuad=new r.FullScreenQuad(new o.DenoiseMaterial({map:t.target.texture,blending:i.CustomBlending,premultipliedAlpha:e.getContextAttributes().premultipliedAlpha})),this.editor.controlsArr[1].object=c,this.editor.controlsArr[1].update(),this.editor.controlsArr[1].addEventListener("change",()=>{t.reset()}),this.editor.controlsArr[0].enabled=!1,this.editor.controlsArr[1].enabled=!0,this.envMapGenerator=new n.BlurredEnvMapGenerator(e),this.renderer=e,this.camera=c;let p=new i.Scene;this.scene=p,this.envMapGenerator=new n.BlurredEnvMapGenerator(e);let m=new i.Group,f=new i.Group;this.editor.wallGroup3D.children.slice(0).forEach(e=>{"3DWall"==e.modelType&&f.add(e.clone()),"CodeModel"==e.modelType&&f.add(this.editor.codeModelCopy(e))});let g=this.editor.floorGroup.clone();g.children.slice(0).forEach(e=>{0==e.position.z&&e.parent.remove(e)}),m.add(f,this.editor.memberGroup3D.clone(),g,this.editor.model3D.clone()),this.materials=[];let y=new d.PathTracingSceneWorker,x=await y.generate(m,{onProgress:e=>{let t=Math.floor(100*e);$("#loading").html("加载中 : "+t+"%"),100==t&&$("#loading").html("解析中...")}});x.scene.traverse(e=>{e.layers.set(2)}),this.scene.add(x.scene),this.result=x;let{bvh:w,textures:b,materials:v}=x,M=w.geometry,S=t.material;S.bvh.updateFrom(w),S.normalAttribute.updateFrom(M.attributes.normal),S.tangentAttribute.updateFrom(M.attributes.tangent),S.uvAttribute.updateFrom(M.attributes.uv),S.materialIndexAttribute.updateFrom(M.attributes.materialIndex),S.textures.setTextures(e,2048,2048,b),S.materials.updateFrom(v,b),y.dispose();let P=this,T=new Promise(e=>{new(0,l.RGBELoader)().load("https://rjhcdn.bsphpro.com/ocean/static/3d-demo-data/hdri/hilly_terrain_01_1k.hdr",t=>{P.updateEnvBlur(t),P.ptRenderer.reset(),e()})}),_=fetch("https://rjhcdn.bsphpro.com/ocean/static/3d-demo-data/materials/material.json").then(e=>e.json()).then(e=>{this.database={},e.forEach(e=>{this.database[e.name]=e})});await Promise.all([_,T]),$("#loading").html("解析中..."),$("#loading").html("Loading : 解析完成"),document.getElementById("loading").remove();let C=new u.GUI,D=Object.keys(this.database);this.material=D[0];let A={材质:this.material,降噪:this.denoiseEnabled,去噪Sigma:this.denoiseSigma,去噪Threshold:this.denoiseThreshold,去噪KSigma:this.denoiseKSigma,samples:this.maxSamples};C.add(A,"材质",D).onChange(e=>{this.material=e,P.ptRenderer.reset()}),C.add(A,"samples",50,2e3).step(1).onChange(e=>{this.maxSamples=e,this.updateFlag=!0});let E=C.addFolder("Denoising");E.add(A,"降噪").onChange(e=>{this.denoiseEnabled=e,this.updateFlag=!0}),E.add(A,"去噪Sigma",.01,5).onChange(e=>{this.denoiseSigma=e,this.updateFlag=!0}),E.add(A,"去噪Threshold",.01,1).onChange(e=>{this.denoiseThreshold=e,this.updateFlag=!0}),E.add(A,"去噪KSigma",0,12).onChange(e=>{this.denoiseKSigma=e,this.updateFlag=!0}),$(".lil-gui.autoPlace").css({width:"13%",position:"fixed",right:"240px",top:"55px","z-index":"1001"}),$(".lil-gui .controller .widget").css({width:"48%","margin-left":"40px"}),C.open(),this.animate()}async main(){$(this.editor.dom).empty();let e=new i.WebGLRenderer({antialias:!0});e.setSize(window.innerWidth,window.innerHeight),e.setClearColor(16777215,0),e.toneMapping=i.ACESFilmicToneMapping,e.outputEncoding=i.sRGBEncoding,e.setClearColor(0,0),this.editor.dom.appendChild(e.domElement),this.scene=new i.Scene;let t=new a.PathTracingRenderer(e),p=new s.PhysicalPathTracingMaterial;t.setSize(window.innerWidth,window.innerHeight);let m=this.editor.camera;t.camera=m,t.material=p,t.alpha=!0,this.ptRenderer=t,this.fsQuad=new r.FullScreenQuad(new i.MeshBasicMaterial({map:t.target.texture,blending:i.CustomBlending,premultipliedAlpha:e.getContextAttributes().premultipliedAlpha})),this.denoiseQuad=new r.FullScreenQuad(new o.DenoiseMaterial({map:t.target.texture,blending:i.CustomBlending,premultipliedAlpha:e.getContextAttributes().premultipliedAlpha})),this.editor.controlsArr[1].object=m,this.editor.controlsArr[1].update(),this.editor.controlsArr[1].addEventListener("change",()=>{t.reset()}),this.envMapGenerator=new n.BlurredEnvMapGenerator(e),this.renderer=e,this.camera=m;let f=new i.Scene;this.scene=f,this.envMapGenerator=new n.BlurredEnvMapGenerator(e);let g=this,y=new Promise(e=>{new(0,l.RGBELoader)().load("https://rjhcdn.bsphpro.com/ocean/static/3d-demo-data/hdri/hilly_terrain_01_1k.hdr",t=>{g.updateEnvBlur(t),g.ptRenderer.reset(),e()})}),x=new d.PathTracingSceneWorker,w=new(0,h.GLTFLoader)().setMeshoptDecoder(c.MeshoptDecoder).loadAsync("https://rjhcdn.bsphpro.com/ocean/static/3d-demo-data/models/material-balls/glass.glb").then(e=>{let t=new i.Group;e.scene.scale.setScalar(.01),e.scene.updateMatrixWorld();let r=new i.Box3;r.setFromObject(e.scene);let n=new i.Mesh(new i.CylinderBufferGeometry(3,3,.05,200),new i.MeshPhysicalMaterial({color:16777215,roughness:0,metalness:.25}));n.geometry=n.geometry.toNonIndexed(),n.geometry.clearGroups(),n.position.y=r.min.y-.03;let o=this.editor.wallGroup3D.clone(),a=this.editor.wallGroup3D.children.slice(0),s=o.children,l=0;s.forEach(e=>{let t=a[l];if("CodeModel"==t.modelType){let i=e.children.slice(0),r=t.children.slice(0).length;e.children.splice(0,i.length-r)}l++});let h=this.editor.floorGroup.clone();h.children.slice(0).forEach(e=>{0==e.position.z&&e.parent.remove(e)}),t.add(o,this.editor.memberGroup3D.clone(),h,this.editor.model3D.clone());let c=new i.MeshPhysicalMaterial,d=new i.MeshPhysicalMaterial;return e.scene.traverse(e=>{e.geometry&&e.geometry.computeVertexNormals(),"Sphere_1"===e.name?e.material=d:e.material=c,"subsphere_1"===e.name&&(e.material=d)}),this.materials=[c,d,n.material],x.generate(t,{onProgress:e=>{let t=Math.floor(100*e);$("#loading").html("加载中 : "+t+"%"),100==t&&$("#loading").html("解析中...")}})}).then(i=>{i.scene.traverse(e=>{e.layers.set(2)}),this.scene.add(i.scene),this.result=i;let{bvh:r,textures:n,materials:o}=i,a=r.geometry,s=t.material;s.bvh.updateFrom(r),s.normalAttribute.updateFrom(a.attributes.normal),s.tangentAttribute.updateFrom(a.attributes.tangent),s.uvAttribute.updateFrom(a.attributes.uv),s.materialIndexAttribute.updateFrom(a.attributes.materialIndex),s.textures.setTextures(e,2048,2048,n),s.materials.updateFrom(o,n),x.dispose()}),b=fetch("https://rjhcdn.bsphpro.com/ocean/static/3d-demo-data/materials/material.json").then(e=>e.json()).then(e=>{this.database={},e.forEach(e=>{this.database[e.name]=e})});await Promise.all([b,w,y]),$("#loading").html("解析中..."),$("#loading").html("Loading : 解析完成"),document.getElementById("loading").remove();let v=new u.GUI,M=Object.keys(this.database);this.material=M[0];let S={材质:this.material,降噪:this.denoiseEnabled,去噪Sigma:this.denoiseSigma,去噪Threshold:this.denoiseThreshold,去噪KSigma:this.denoiseKSigma,samples:this.maxSamples};v.add(S,"材质",M).onChange(e=>{this.material=e,g.ptRenderer.reset()}),v.add(S,"samples",50,2e3).step(1).onChange(e=>{this.maxSamples=e,this.updateFlag=!0});let P=v.addFolder("Denoising");P.add(S,"降噪").onChange(e=>{this.denoiseEnabled=e,this.updateFlag=!0}),P.add(S,"去噪Sigma",.01,5).onChange(e=>{this.denoiseSigma=e,this.updateFlag=!0}),P.add(S,"去噪Threshold",.01,1).onChange(e=>{this.denoiseThreshold=e,this.updateFlag=!0}),P.add(S,"去噪KSigma",0,12).onChange(e=>{this.denoiseKSigma=e,this.updateFlag=!0}),$(".lil-gui.autoPlace").css({width:"13%",position:"fixed",right:"240px",top:"55px","z-index":"1001"}),$(".lil-gui .controller .widget").css({width:"48%","margin-left":"40px"}),v.open(),this.animate()}onkeydown(e){if(0>[87,83,65,68,69,81].indexOf(1*e.keyCode))return;var t=new i.Vector3;this.camera.getWorldDirection(t);let r=.1,n=new i.Vector3(t.z,t.y,-t.x),o=new i.Vector3(0,1,0),a=this.camera.position.clone();"87"==e.keyCode?(this.camera.position.add(t.multiplyScalar(r)),this.camera.position.y=a.y):"83"==e.keyCode?(this.camera.position.add(t.multiplyScalar(-r)),this.camera.position.y=a.y):"65"==e.keyCode?(this.camera.position.add(n.multiplyScalar(r)),this.camera.position.y=a.y):"68"==e.keyCode?(this.camera.position.add(n.multiplyScalar(-r)),this.camera.position.y=a.y):"69"==e.keyCode?this.camera.position.add(o.multiplyScalar(r)):"81"==e.keyCode&&this.camera.position.add(o.multiplyScalar(-r)),this.camera.updateProjectionMatrix(),this.ptRenderer.reset()}updateEnvBlur(e){let t=this.envMapGenerator.generate(e,0);this.ptRenderer.material.envMapInfo.updateFrom(t),this.scene.environment=t,this.scene.background=t}applyMaterialInfo(e,t){t.color.set(16777215),t.transmission=0,t.attenuationDistance=1/0,t.attenuationColor.set(16777215),t.specularColor.set(16777215),t.metalness=0,t.roughness=1,t.ior=1.5,t.thickness=1,e.specularColor&&t.specularColor.setRGB(...e.specularColor),"metalness"in e&&(t.metalness=e.metalness),"roughness"in e&&(t.roughness=e.roughness),"ior"in e&&(t.ior=e.ior),"transmission"in e&&(t.transmission=e.transmission),t.transmission?(e.color&&t.attenuationColor.setRGB(...e.color),t.attenuationDistance=200/e.density):e.color&&t.color.setRGB(...e.color)}animate(){if(!this.editor.baseRender||(requestAnimationFrame(this.animate.bind(this)),this.ptRenderer.samples>this.maxSamples&&!this.updateFlag))return;if(0==$("#sampele").length){let e="<div id= sampele>sampeles:0</div>";$("body").append(e),$("#sampele").css({color:"#000",position:"absolute",top:"90%",left:"82%",transform:"translate(-50%, -50%)","font-size":"20px"})}$("#sampele").text("samples:"+this.ptRenderer.samples),this.updateFlag=!1,this.renderer.render(this.scene,this.camera);let e=this.database[this.material];if(this.materials.length>0){let[t,i]=this.materials;this.applyMaterialInfo(e,t),i.color.setRGB(.5,.5,.5).convertSRGBToLinear(),i.roughness=1,i.metalness=0}this.ptRenderer.material.materials.updateFrom(this.result.materials,this.result.textures),this.ptRenderer.material.filterGlossyFactor=.5,this.ptRenderer.material.environmentIntensity=1,this.ptRenderer.material.backgroundBlur=.1,this.ptRenderer.material.bounces=15,this.ptRenderer.material.physicalCamera.updateFrom(this.camera),this.camera.updateMatrixWorld(),this.scene.background=this.scene.environment,this.ptRenderer.update(),this.ptRenderer.samples<1&&this.renderer.render(this.scene,this.camera),this.denoiseQuad.material.sigma=this.denoiseSigma,this.denoiseQuad.material.threshold=this.denoiseThreshold,this.denoiseQuad.material.kSigma=this.denoiseKSigma;let t=this.denoiseEnabled?this.denoiseQuad:this.fsQuad;this.renderer.autoClear=!1,t.material.map=this.ptRenderer.target.texture,t.render(this.renderer),this.renderer.autoClear=!0}}}),parcelRequire.register("yHpto",function(e,t){$parcel$export(e.exports,"FullScreenQuad",()=>o);var i=parcelRequire("4xklQ");let r=new i.OrthographicCamera(-1,1,1,-1,0,1),n=new i.BufferGeometry;n.setAttribute("position",new i.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),n.setAttribute("uv",new i.Float32BufferAttribute([0,2,0,0,2,0],2));class o{constructor(e){this._mesh=new i.Mesh(n,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,r)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}}),parcelRequire.register("6XpV3",function(e,t){$parcel$export(e.exports,"BlurredEnvMapGenerator",()=>s);var i=parcelRequire("4xklQ"),r=parcelRequire("yHpto"),n=parcelRequire("3rJsw"),o=parcelRequire("8ujoU");class a extends n.MaterialBase{constructor(){super({uniforms:{envMap:{value:null},blur:{value:0}},vertexShader:`

				varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}

			`,fragmentShader:`

				#include <common>
				#include <cube_uv_reflection_fragment>

				${o.shaderUtils}

				uniform sampler2D envMap;
				uniform float blur;
				varying vec2 vUv;
				void main() {

					vec3 rayDirection = equirectUvToDirection( vUv );
					gl_FragColor = textureCubeUV( envMap, rayDirection, blur );

				}

			`})}}class s{constructor(e){this.renderer=e,this.pmremGenerator=new i.PMREMGenerator(e),this.copyQuad=new r.FullScreenQuad(new a),this.renderTarget=new i.WebGLRenderTarget(1,1,{type:i.FloatType,format:i.RGBAFormat})}dispose(){this.pmremGenerator.dispose(),this.copyQuad.dispose(),this.renderTarget.dispose()}generate(e,t){let{pmremGenerator:r,renderTarget:n,copyQuad:o,renderer:a}=this,s=r.fromEquirectangular(e),{width:l,height:h}=e.image;n.setSize(l,h),o.material.envMap=s.texture,o.material.blur=t;let c=a.getRenderTarget(),d=a.autoClear;a.setRenderTarget(n),a.autoClear=!0,o.render(a),a.setRenderTarget(c),a.autoClear=d;let u=new Float32Array(l*h*4);a.readRenderTargetPixels(n,0,0,l,h,u);let p=new i.DataTexture(u,l,h,i.RGBAFormat,i.FloatType);return p.minFilter=e.minFilter,p.magFilter=e.magFilter,p.wrapS=e.wrapS,p.wrapT=e.wrapT,p.mapping=i.EquirectangularReflectionMapping,p.needsUpdate=!0,p}}}),parcelRequire.register("3rJsw",function(e,t){$parcel$export(e.exports,"MaterialBase",()=>r);var i=parcelRequire("4xklQ");class r extends i.ShaderMaterial{constructor(e){for(let t in super(e),this.uniforms)Object.defineProperty(this,t,{get(){return this.uniforms[t].value},set(e){this.uniforms[t].value=e}})}setDefine(e,t){null==t?e in this.defines&&(delete this.defines[e],this.needsUpdate=!0):this.defines[e]!==t&&(this.defines[e]=t,this.needsUpdate=!0)}}}),parcelRequire.register("8ujoU",function(e,t){$parcel$export(e.exports,"shaderUtils",()=>i);let i=`

	// https://github.com/KhronosGroup/glTF/blob/main/extensions/2.0/Khronos/KHR_materials_volume/README.md#attenuation
	vec3 transmissionAttenuation( float dist, vec3 attColor, float attDist ) {

		vec3 ot = - log( attColor ) / attDist;
		return exp( - ot * dist );

	}

	// https://google.github.io/filament/Filament.md.html#materialsystem/diffusebrdf
	float schlickFresnel( float cosine, float f0 ) {

		return f0 + ( 1.0 - f0 ) * pow( 1.0 - cosine, 5.0 );

	}

	vec3 schlickFresnel( float cosine, vec3 f0 ) {

		return f0 + ( 1.0 - f0 ) * pow( 1.0 - cosine, 5.0 );

	}

	// https://raytracing.github.io/books/RayTracingInOneWeekend.html#dielectrics/schlickapproximation
	float iorRatioToF0( float iorRatio ) {

		return pow( ( 1.0 - iorRatio ) / ( 1.0 + iorRatio ), 2.0 );

	}

	float schlickFresnelFromIor( float cosine, float iorRatio ) {

		// Schlick approximation
		float r_0 = iorRatioToF0( iorRatio );
		return schlickFresnel( cosine, r_0 );

	}

	// forms a basis with the normal vector as Z
	mat3 getBasisFromNormal( vec3 normal ) {

		vec3 other;
		if ( abs( normal.x ) > 0.5 ) {

			other = vec3( 0.0, 1.0, 0.0 );

		} else {

			other = vec3( 1.0, 0.0, 0.0 );

		}

		vec3 ortho = normalize( cross( normal, other ) );
		vec3 ortho2 = normalize( cross( normal, ortho ) );
		return mat3( ortho2, ortho, normal );

	}

	vec3 getHalfVector( vec3 a, vec3 b ) {

		return normalize( a + b );

	}

	// The discrepancy between interpolated surface normal and geometry normal can cause issues when a ray
	// is cast that is on the top side of the geometry normal plane but below the surface normal plane. If
	// we find a ray like that we ignore it to avoid artifacts.
	// This function returns if the direction is on the same side of both planes.
	bool isDirectionValid( vec3 direction, vec3 surfaceNormal, vec3 geometryNormal ) {

		bool aboveSurfaceNormal = dot( direction, surfaceNormal ) > 0.0;
		bool aboveGeometryNormal = dot( direction, geometryNormal ) > 0.0;
		return aboveSurfaceNormal == aboveGeometryNormal;

	}

	vec3 getHemisphereSample( vec3 n, vec2 uv ) {

		// https://www.rorydriscoll.com/2009/01/07/better-sampling/
		// https://graphics.pixar.com/library/OrthonormalB/paper.pdf
		float sign = n.z == 0.0 ? 1.0 : sign( n.z );
		float a = - 1.0 / ( sign + n.z );
		float b = n.x * n.y * a;
		vec3 b1 = vec3( 1.0 + sign * n.x * n.x * a, sign * b, - sign * n.x );
		vec3 b2 = vec3( b, sign + n.y * n.y * a, - n.y );

		float r = sqrt( uv.x );
		float theta = 2.0 * PI * uv.y;
		float x = r * cos( theta );
		float y = r * sin( theta );
		return x * b1 + y * b2 + sqrt( 1.0 - uv.x ) * n;

	}

	// https://www.shadertoy.com/view/wltcRS
	uvec4 s0;

	void rng_initialize(vec2 p, int frame) {

		// white noise seed
		s0 = uvec4( p, uint( frame ), uint( p.x ) + uint( p.y ) );

	}

	// https://www.pcg-random.org/
	void pcg4d( inout uvec4 v ) {

		v = v * 1664525u + 1013904223u;
		v.x += v.y * v.w;
		v.y += v.z * v.x;
		v.z += v.x * v.y;
		v.w += v.y * v.z;
		v = v ^ ( v >> 16u );
		v.x += v.y*v.w;
		v.y += v.z*v.x;
		v.z += v.x*v.y;
		v.w += v.y*v.z;

	}

	// returns [ 0, 1 ]
	float rand() {

		pcg4d(s0);
		return float( s0.x ) / float( 0xffffffffu );

	}

	vec2 rand2() {

		pcg4d( s0 );
		return vec2( s0.xy ) / float(0xffffffffu);

	}

	vec3 rand3() {

		pcg4d(s0);
		return vec3( s0.xyz ) / float( 0xffffffffu );

	}

	vec4 rand4() {

		pcg4d(s0);
		return vec4(s0)/float(0xffffffffu);

	}

	// https://github.com/mrdoob/three.js/blob/dev/src/math/Vector3.js#L724
	vec3 randDirection() {

		vec2 r = rand2();
		float u = ( r.x - 0.5 ) * 2.0;
		float t = r.y * PI * 2.0;
		float f = sqrt( 1.0 - u * u );

		return vec3( f * cos( t ), f * sin( t ), u );

	}

	vec2 triangleSample( vec2 a, vec2 b, vec2 c ) {

		// get the edges of the triangle and the diagonal across the
		// center of the parallelogram
		vec2 e1 = a - b;
		vec2 e2 = c - b;
		vec2 diag = normalize( e1 + e2 );

		// pick a random point in the parallelogram
		vec2 r = rand2();
		if ( r.x + r.y > 1.0 ) {

			r = vec2( 1.0 ) - r;

		}

		return e1 * r.x + e2 * r.y;

	}

	// samples an aperture shape with the given number of sides. 0 means circle
	vec2 sampleAperture( int blades ) {

		if ( blades == 0 ) {

			vec2 r = rand2();
			float angle = 2.0 * PI * r.x;
			float radius = sqrt( rand() );
			return vec2( cos( angle ), sin( angle ) ) * radius;

		} else {

			blades = max( blades, 3 );

			vec3 r = rand3();
			float anglePerSegment = 2.0 * PI / float( blades );
			float segment = floor( float( blades ) * r.x );

			float angle1 = anglePerSegment * segment;
			float angle2 = angle1 + anglePerSegment;
			vec2 a = vec2( sin( angle1 ), cos( angle1 ) );
			vec2 b = vec2( 0.0, 0.0 );
			vec2 c = vec2( sin( angle2 ), cos( angle2 ) );

			return triangleSample( a, b, c );

		}

	}

	float colorToLuminance( vec3 color ) {

		// https://en.wikipedia.org/wiki/Relative_luminance
		return 0.2126 * color.r + 0.7152 * color.g + 0.0722 * color.b;

	}

	// ray sampling x and z are swapped to align with expected background view
	vec2 equirectDirectionToUv( vec3 direction ) {

		// from Spherical.setFromCartesianCoords
		vec2 uv = vec2( atan( direction.z, direction.x ), acos( direction.y ) );
		uv /= vec2( 2.0 * PI, PI );

		// apply adjustments to get values in range [0, 1] and y right side up
		uv.x += 0.5;
		uv.y = 1.0 - uv.y;
		return uv;

	}

	vec3 equirectUvToDirection( vec2 uv ) {

		// undo above adjustments
		uv.x -= 0.5;
		uv.y = 1.0 - uv.y;

		// from Vector3.setFromSphericalCoords
		float theta = uv.x * 2.0 * PI;
		float phi = uv.y * PI;

		float sinPhi = sin( phi );

		return vec3( sinPhi * cos( theta ), cos( phi ), sinPhi * sin( theta ) );

	}

	// Fast arccos approximation used to remove banding artifacts caused by numerical errors in acos.
	// This is a cubic Lagrange interpolating polynomial for x = [-1, -1/2, 0, 1/2, 1].
	// For more information see: https://github.com/gkjohnson/three-gpu-pathtracer/pull/171#issuecomment-1152275248
	float acosApprox( float x ) {

		x = clamp( x, -1.0, 1.0 );
		return ( - 0.69813170079773212 * x * x - 0.87266462599716477 ) * x + 1.5707963267948966;

	}

	// An acos with input values bound to the range [-1, 1].
	float acosSafe( float x ) {

		return acos( clamp( x, -1.0, 1.0 ) );

	}

	float saturateCos( float val ) {

		return clamp( val, 0.001, 1.0 );

	}

	float square( float t ) {

		return t * t;

	}

	vec2 square( vec2 t ) {

		return t * t;

	}

	vec3 square( vec3 t ) {

		return t * t;

	}

	vec4 square( vec4 t ) {

		return t * t;

	}

	// Finds the point where the ray intersects the plane defined by u and v and checks if this point
	// falls in the bounds of the rectangle on that same plane.
	// Plane intersection: https://lousodrome.net/blog/light/2020/07/03/intersection-of-a-ray-and-a-plane/
	bool intersectsRectangle( vec3 center, vec3 normal, vec3 u, vec3 v, vec3 rayOrigin, vec3 rayDirection, out float dist ) {

		float t = dot( center - rayOrigin, normal ) / dot( rayDirection, normal );

		if ( t > EPSILON ) {

			vec3 p = rayOrigin + rayDirection * t;
			vec3 vi = p - center;

			// check if p falls inside the rectangle
			float a1 = dot( u, vi );
			if ( abs( a1 ) <= 0.5 ) {

				float a2 = dot( v, vi );
				if ( abs( a2 ) <= 0.5 ) {

					dist = t;
					return true;

				}

			}

		}

		return false;

	}

	// Finds the point where the ray intersects the plane defined by u and v and checks if this point
	// falls in the bounds of the circle on that same plane. See above URL for a description of the plane intersection algorithm.
	bool intersectsCircle( vec3 position, vec3 normal, vec3 u, vec3 v, vec3 rayOrigin, vec3 rayDirection, out float dist ) {

		float t = dot( position - rayOrigin, normal ) / dot( rayDirection, normal );

		if ( t > EPSILON ) {

			vec3 hit = rayOrigin + rayDirection * t;
			vec3 vi = hit - position;

			float a1 = dot( u, vi );
			float a2 = dot( v, vi );

			if( length( vec2( a1, a2 ) ) <= 0.5 ) {

				dist = t;
				return true;

			}

		}

		return false;

	}

	// power heuristic for multiple importance sampling
	float misHeuristic( float a, float b ) {

		float aa = a * a;
		float bb = b * b;
		return aa / ( aa + bb );

	}

`}),parcelRequire.register("3RVm4",function(e,t){$parcel$export(e.exports,"DenoiseMaterial",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("3rJsw");class n extends r.MaterialBase{constructor(e){super({blending:i.NoBlending,transparent:!1,depthWrite:!1,depthTest:!1,defines:{USE_SLIDER:0},uniforms:{sigma:{value:5},threshold:{value:.03},kSigma:{value:1},map:{value:null}},vertexShader:`

				varying vec2 vUv;

				void main() {

					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

				}

			`,fragmentShader:`

				//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
				//  Copyright (c) 2018-2019 Michele Morrone
				//  All rights reserved.
				//
				//  https://michelemorrone.eu - https://BrutPitt.com
				//
				//  me@michelemorrone.eu - brutpitt@gmail.com
				//  twitter: @BrutPitt - github: BrutPitt
				//
				//  https://github.com/BrutPitt/glslSmartDeNoise/
				//
				//  This software is distributed under the terms of the BSD 2-Clause license
				//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

				uniform sampler2D map;

				uniform float sigma;
				uniform float threshold;
				uniform float kSigma;

				varying vec2 vUv;

				#define INV_SQRT_OF_2PI 0.39894228040143267793994605993439
				#define INV_PI 0.31830988618379067153776752674503

				// Parameters:
				//	 sampler2D tex	 - sampler image / texture
				//	 vec2 uv		   - actual fragment coord
				//	 float sigma  >  0 - sigma Standard Deviation
				//	 float kSigma >= 0 - sigma coefficient
				//		 kSigma * sigma  -->  radius of the circular kernel
				//	 float threshold   - edge sharpening threshold
				vec4 smartDeNoise( sampler2D tex, vec2 uv, float sigma, float kSigma, float threshold ) {

					float radius = round( kSigma * sigma );
					float radQ = radius * radius;

					float invSigmaQx2 = 0.5 / ( sigma * sigma );
					float invSigmaQx2PI = INV_PI * invSigmaQx2;

					float invThresholdSqx2 = 0.5 / ( threshold * threshold );
					float invThresholdSqrt2PI = INV_SQRT_OF_2PI / threshold;

					vec4 centrPx = texture2D( tex, uv );
					centrPx.rgb *= centrPx.a;

					float zBuff = 0.0;
					vec4 aBuff = vec4( 0.0 );
					vec2 size = vec2( textureSize( tex, 0 ) );

					vec2 d;
					for ( d.x = - radius; d.x <= radius; d.x ++ ) {

						float pt = sqrt( radQ - d.x * d.x );

						for ( d.y = - pt; d.y <= pt; d.y ++ ) {

							float blurFactor = exp( - dot( d, d ) * invSigmaQx2 ) * invSigmaQx2PI;

							vec4 walkPx = texture2D( tex, uv + d / size );
							walkPx.rgb *= walkPx.a;

							vec4 dC = walkPx - centrPx;
							float deltaFactor = exp( - dot( dC.rgba, dC.rgba ) * invThresholdSqx2 ) * invThresholdSqrt2PI * blurFactor;

							zBuff += deltaFactor;
							aBuff += deltaFactor * walkPx;

						}

					}

					return aBuff / zBuff;

				}

				void main() {

					gl_FragColor = smartDeNoise( map, vec2( vUv.x, vUv.y ), sigma, kSigma, threshold );
					#include <tonemapping_fragment>
					#include <encodings_fragment>
					#include <premultiplied_alpha_fragment>

				}

			`}),this.setValues(e)}}}),parcelRequire.register("3J0DK",function(e,t){$parcel$export(e.exports,"PathTracingRenderer",()=>s);var i=parcelRequire("4xklQ"),r=parcelRequire("yHpto"),n=parcelRequire("7aklN");function*o(){let{_renderer:e,_fsQuad:t,_blendQuad:r,_primaryTarget:n,_blendTargets:o,alpha:a,camera:s,material:l}=this,h=r.material,[c,d]=o;for(;;){a?(h.opacity=1/(this.samples+1),l.blending=i.NoBlending,l.opacity=1):(l.opacity=1/(this.samples+1),l.blending=i.NormalBlending);let o=n.width,u=n.height;l.resolution.set(o,u),l.seed++;let p=this.tiles.x||1,m=this.tiles.y||1,f=p*m,g=1/e.getPixelRatio();for(let i=0;i<m;i++)for(let y=0;y<p;y++){l.cameraWorldMatrix.copy(s.matrixWorld),l.invProjectionMatrix.copy(s.projectionMatrixInverse);let x=0;s.projectionMatrix.elements[15]>0&&(x=1),s.isEquirectCamera&&(x=2),l.setDefine("CAMERA_TYPE",x);let w=e.getRenderTarget(),b=e.autoClear,v=y,M=i;if(!this.stableTiles){let e=this._currentTile%(p*m);v=e%p,M=~~(e/p),this._currentTile=e+1}e.setRenderTarget(n),e.setScissorTest(!0),e.setScissor(g*Math.ceil(v*o/p),g*Math.ceil((m-M-1)*u/m),g*Math.ceil(o/p),g*Math.ceil(u/m)),e.autoClear=!1,t.render(e),e.setScissorTest(!1),e.setRenderTarget(w),e.autoClear=b,a&&(h.target1=c.texture,h.target2=n.texture,e.setRenderTarget(d),r.render(e),e.setRenderTarget(w)),this.samples+=1/f,yield}[c,d]=[d,c],this.samples=Math.round(this.samples)}}let a=new i.Color;class s{get material(){return this._fsQuad.material}set material(e){this._fsQuad.material=e}get target(){return this._alpha?this._blendTargets[1]:this._primaryTarget}set alpha(e){e||(this._blendTargets[0].dispose(),this._blendTargets[1].dispose()),this._alpha=e,this.reset()}get alpha(){return this._alpha}constructor(e){this.camera=null,this.tiles=new i.Vector2(1,1),this.samples=0,this.stableNoise=!1,this.stableTiles=!0,this._renderer=e,this._alpha=!1,this._fsQuad=new r.FullScreenQuad(null),this._blendQuad=new r.FullScreenQuad(new n.BlendMaterial),this._task=null,this._currentTile=0,this._primaryTarget=new i.WebGLRenderTarget(1,1,{format:i.RGBAFormat,type:i.FloatType}),this._blendTargets=[new i.WebGLRenderTarget(1,1,{format:i.RGBAFormat,type:i.FloatType}),new i.WebGLRenderTarget(1,1,{format:i.RGBAFormat,type:i.FloatType})]}setSize(e,t){this._primaryTarget.setSize(e,t),this._blendTargets[0].setSize(e,t),this._blendTargets[1].setSize(e,t),this.reset()}dispose(){this._primaryTarget.dispose(),this._blendTargets[0].dispose(),this._blendTargets[1].dispose(),this._fsQuad.dispose(),this._blendQuad.dispose(),this._task=null}reset(){let{_renderer:e,_primaryTarget:t,_blendTargets:i}=this,r=e.getRenderTarget(),n=e.getClearAlpha();e.getClearColor(a),e.setRenderTarget(t),e.setClearColor(0,0),e.clearColor(),e.setRenderTarget(i[0]),e.setClearColor(0,0),e.clearColor(),e.setRenderTarget(i[1]),e.setClearColor(0,0),e.clearColor(),e.setClearColor(a,n),e.setRenderTarget(r),this.samples=0,this._task=null,this.stableNoise&&(this.material.seed=0)}update(){this._task||(this._task=o.call(this)),this._task.next()}}}),parcelRequire.register("7aklN",function(e,t){$parcel$export(e.exports,"BlendMaterial",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("3rJsw");class n extends r.MaterialBase{constructor(e){super({blending:i.NoBlending,uniforms:{target1:{value:null},target2:{value:null},opacity:{value:1}},vertexShader:`

				varying vec2 vUv;

				void main() {

					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

				}`,fragmentShader:`

				uniform float opacity;

				uniform sampler2D target1;
				uniform sampler2D target2;

				varying vec2 vUv;

				void main() {

					vec4 color1 = texture2D( target1, vUv );
					vec4 color2 = texture2D( target2, vUv );

					float invOpacity = 1.0 - opacity;
					float totalAlpha = color1.a * invOpacity + color2.a * opacity;

					if ( color1.a != 0.0 || color2.a != 0.0 ) {

						gl_FragColor.rgb = color1.rgb * ( invOpacity * color1.a / totalAlpha ) + color2.rgb * ( opacity * color2.a / totalAlpha );
						gl_FragColor.a = totalAlpha;

					} else {

						gl_FragColor = vec4( 0.0 );

					}

				}`}),this.setValues(e)}}}),parcelRequire.register("1EKZI",function(e,t){$parcel$export(e.exports,"PhysicalPathTracingMaterial",()=>x);var i=parcelRequire("4xklQ"),r=parcelRequire("3rJsw"),n=parcelRequire("jzv0I"),o=parcelRequire("kEmYZ"),a=parcelRequire("5jaKi"),s=parcelRequire("j4aeK"),l=parcelRequire("iZpZ1"),h=parcelRequire("jrTmV"),c=parcelRequire("hOrGl"),d=parcelRequire("dbKnp"),u=parcelRequire("gGzlF"),p=parcelRequire("8ujoU"),m=parcelRequire("g7oWa"),f=parcelRequire("7xwJT"),g=parcelRequire("3Rd4a"),y=parcelRequire("jHXX6");class x extends r.MaterialBase{onBeforeRender(){this.setDefine("FEATURE_DOF",0===this.physicalCamera.bokehSize?0:1)}constructor(e){super({transparent:!0,depthWrite:!1,defines:{FEATURE_MIS:1,FEATURE_DOF:1,FEATURE_GRADIENT_BG:0,TRANSPARENT_TRAVERSALS:5,CAMERA_TYPE:0},uniforms:{resolution:{value:new i.Vector2},bounces:{value:3},physicalCamera:{value:new m.PhysicalCameraUniform},bvh:{value:new o.MeshBVHUniformStruct},normalAttribute:{value:new n.FloatVertexAttributeTexture},tangentAttribute:{value:new n.FloatVertexAttributeTexture},uvAttribute:{value:new n.FloatVertexAttributeTexture},colorAttribute:{value:new n.FloatVertexAttributeTexture},materialIndexAttribute:{value:new n.UIntVertexAttributeTexture},materials:{value:new l.MaterialsTexture},textures:{value:new h.RenderTarget2DArray().texture},lights:{value:new g.LightsInfoUniformStruct},iesProfiles:{value:new y.IESProfilesTexture().texture},cameraWorldMatrix:{value:new i.Matrix4},invProjectionMatrix:{value:new i.Matrix4},backgroundBlur:{value:0},environmentIntensity:{value:1},environmentRotation:{value:new i.Matrix3},envMapInfo:{value:new f.EquirectHdrInfoUniform},seed:{value:0},opacity:{value:1},filterGlossyFactor:{value:0},bgGradientTop:{value:new i.Color(1118481)},bgGradientBottom:{value:new i.Color(0)},backgroundAlpha:{value:1}},vertexShader:`

				varying vec2 vUv;
				void main() {

					vec4 mvPosition = vec4( position, 1.0 );
					mvPosition = modelViewMatrix * mvPosition;
					gl_Position = projectionMatrix * mvPosition;

					vUv = uv;

				}

			`,fragmentShader:`
				#define RAY_OFFSET 1e-4

				precision highp isampler2D;
				precision highp usampler2D;
				precision highp sampler2DArray;
				vec4 envMapTexelToLinear( vec4 a ) { return a; }
				#include <common>

				${a.shaderStructs}
				${a.shaderIntersectFunction}
				${s.shaderMaterialStructs}
				${s.shaderLightStruct}

				${p.shaderUtils}
				${c.shaderMaterialSampling}
				${d.shaderEnvMapSampling}

				uniform mat3 environmentRotation;
				uniform float backgroundBlur;
				uniform float backgroundAlpha;

				#if FEATURE_GRADIENT_BG

				uniform vec3 bgGradientTop;
				uniform vec3 bgGradientBottom;

				#endif

				#if FEATURE_DOF

				uniform PhysicalCamera physicalCamera;

				#endif

				uniform vec2 resolution;
				uniform int bounces;
				uniform mat4 cameraWorldMatrix;
				uniform mat4 invProjectionMatrix;
				uniform sampler2D normalAttribute;
				uniform sampler2D tangentAttribute;
				uniform sampler2D uvAttribute;
				uniform sampler2D colorAttribute;
				uniform usampler2D materialIndexAttribute;
				uniform BVH bvh;
				uniform float environmentIntensity;
				uniform float filterGlossyFactor;
				uniform int seed;
				uniform float opacity;
				uniform sampler2D materials;
				uniform LightsInfo lights;
				uniform sampler2DArray iesProfiles;

				${u.shaderLightSampling}

				uniform EquirectHdrInfo envMapInfo;

				uniform sampler2DArray textures;
				varying vec2 vUv;

				float applyFilteredGlossy( float roughness, float accumulatedRoughness ) {

					return clamp(
						max(
							roughness,
							accumulatedRoughness * filterGlossyFactor * 5.0 ),
						0.0,
						1.0
					);

				}

				vec3 sampleBackground( vec3 direction ) {

					#if FEATURE_GRADIENT_BG

					direction = normalize( direction + randDirection() * 0.05 );

					float value = ( direction.y + 1.0 ) / 2.0;
					value = pow( value, 2.0 );

					return mix( bgGradientBottom, bgGradientTop, value );

					#else

					vec3 sampleDir = normalize( direction + getHemisphereSample( direction, rand2() ) * 0.5 * backgroundBlur );
					return environmentIntensity * sampleEquirectEnvMapColor( sampleDir, envMapInfo.map );

					#endif

				}

				// step through multiple surface hits and accumulate color attenuation based on transmissive surfaces
				bool attenuateHit( BVH bvh, vec3 rayOrigin, vec3 rayDirection, int traversals, bool isShadowRay, out vec3 color ) {

					// hit results
					uvec4 faceIndices = uvec4( 0u );
					vec3 faceNormal = vec3( 0.0, 0.0, 1.0 );
					vec3 barycoord = vec3( 0.0 );
					float side = 1.0;
					float dist = 0.0;

					color = vec3( 1.0 );

					for ( int i = 0; i < traversals; i ++ ) {

						if ( bvhIntersectFirstHit( bvh, rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist ) ) {

							// TODO: attenuate the contribution based on the PDF of the resulting ray including refraction values
							// Should be able to work using the material BSDF functions which will take into account specularity, etc.
							// TODO: should we account for emissive surfaces here?

							vec2 uv = textureSampleBarycoord( uvAttribute, barycoord, faceIndices.xyz ).xy;
							vec4 vertexColor = textureSampleBarycoord( colorAttribute, barycoord, faceIndices.xyz );
							uint materialIndex = uTexelFetch1D( materialIndexAttribute, faceIndices.x ).r;
							Material material = readMaterialInfo( materials, materialIndex );

							// adjust the ray to the new surface
							bool isBelowSurface = dot( rayDirection, faceNormal ) < 0.0;
							vec3 point = rayOrigin + rayDirection * dist;
							vec3 absPoint = abs( point );
							float maxPoint = max( absPoint.x, max( absPoint.y, absPoint.z ) );
							rayOrigin = point + faceNormal * ( maxPoint + 1.0 ) * ( isBelowSurface ? - RAY_OFFSET : RAY_OFFSET );

							if ( ! material.castShadow && isShadowRay ) {

								continue;

							}

							// Opacity Test

							// albedo
							vec4 albedo = vec4( material.color, material.opacity );
							if ( material.map != - 1 ) {

								vec3 uvPrime = material.mapTransform * vec3( uv, 1 );
								albedo *= texture2D( textures, vec3( uvPrime.xy, material.map ) );

							}

							if ( material.vertexColors ) {

								albedo *= vertexColor;

							}

							// alphaMap
							if ( material.alphaMap != - 1 ) {

								albedo.a *= texture2D( textures, vec3( uv, material.alphaMap ) ).x;

							}

							// transmission
							float transmission = material.transmission;
							if ( material.transmissionMap != - 1 ) {

								vec3 uvPrime = material.transmissionMapTransform * vec3( uv, 1 );
								transmission *= texture2D( textures, vec3( uvPrime.xy, material.transmissionMap ) ).r;

							}

							// metalness
							float metalness = material.metalness;
							if ( material.metalnessMap != - 1 ) {

								vec3 uvPrime = material.metalnessMapTransform * vec3( uv, 1 );
								metalness *= texture2D( textures, vec3( uvPrime.xy, material.metalnessMap ) ).b;

							}

							float alphaTest = material.alphaTest;
							bool useAlphaTest = alphaTest != 0.0;
							float transmissionFactor = ( 1.0 - metalness ) * transmission;
							if (
								transmissionFactor < rand() && ! (
									// material sidedness
									material.side != 0.0 && side == material.side

									// alpha test
									|| useAlphaTest && albedo.a < alphaTest

									// opacity
									|| material.transparent && ! useAlphaTest && albedo.a < rand()
								)
							) {

								return true;

							}

							if ( side == 1.0 && isBelowSurface ) {

								// only attenuate by surface color on the way in
								color *= mix( vec3( 1.0 ), albedo.rgb, transmissionFactor );

							} else if ( side == - 1.0 ) {

								// attenuate by medium once we hit the opposite side of the model
								color *= transmissionAttenuation( dist, material.attenuationColor, material.attenuationDistance );

							}

						} else {

							return false;

						}

					}

					return true;

				}

				// returns whether the ray hit anything before a certain distance, not just the first surface. Could be optimized to not check the full hierarchy.
				bool anyCloserHit( BVH bvh, vec3 rayOrigin, vec3 rayDirection, float maxDist ) {

					uvec4 faceIndices = uvec4( 0u );
					vec3 faceNormal = vec3( 0.0, 0.0, 1.0 );
					vec3 barycoord = vec3( 0.0 );
					float side = 1.0;
					float dist = 0.0;
					bool hit = bvhIntersectFirstHit( bvh, rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist );
					return hit && dist < maxDist;

				}

				// tentFilter from Peter Shirley's 'Realistic Ray Tracing (2nd Edition)' book, pg. 60
				// erichlof/THREE.js-PathTracing-Renderer/
				float tentFilter( float x ) {

					return x < 0.5 ? sqrt( 2.0 * x ) - 1.0 : 1.0 - sqrt( 2.0 - ( 2.0 * x ) );

				}

				vec3 ndcToRayOrigin( vec2 coord ) {

					vec4 rayOrigin4 = cameraWorldMatrix * invProjectionMatrix * vec4( coord, - 1.0, 1.0 );
					return rayOrigin4.xyz / rayOrigin4.w;
				}

				void getCameraRay( out vec3 rayDirection, out vec3 rayOrigin ) {

					vec2 ssd = vec2( 1.0 ) / resolution;

					// Jitter the camera ray by finding a uv coordinate at a random sample
					// around this pixel's UV coordinate
					vec2 jitteredUv = vUv + vec2( tentFilter( rand() ) * ssd.x, tentFilter( rand() ) * ssd.y );

					#if CAMERA_TYPE == 2

						// Equirectangular projection

						vec4 rayDirection4 = vec4( equirectUvToDirection( jitteredUv ), 0.0 );
						vec4 rayOrigin4 = vec4( 0.0, 0.0, 0.0, 1.0 );

						rayDirection4 = cameraWorldMatrix * rayDirection4;
						rayOrigin4 = cameraWorldMatrix * rayOrigin4;

						rayDirection = normalize( rayDirection4.xyz );
						rayOrigin = rayOrigin4.xyz / rayOrigin4.w;

					#else

						// get [- 1, 1] normalized device coordinates
						vec2 ndc = 2.0 * jitteredUv - vec2( 1.0 );

						rayOrigin = ndcToRayOrigin( ndc );

						#if CAMERA_TYPE == 1

							// Orthographic projection

							rayDirection = ( cameraWorldMatrix * vec4( 0.0, 0.0, - 1.0, 0.0 ) ).xyz;
							rayDirection = normalize( rayDirection );

						#else

							// Perspective projection

							rayDirection = normalize( mat3(cameraWorldMatrix) * ( invProjectionMatrix * vec4( ndc, 0.0, 1.0 ) ).xyz );

						#endif

					#endif

					#if FEATURE_DOF
					{

						// depth of field
						vec3 focalPoint = rayOrigin + normalize( rayDirection ) * physicalCamera.focusDistance;

						// get the aperture sample
						vec2 apertureSample = sampleAperture( physicalCamera.apertureBlades ) * physicalCamera.bokehSize * 0.5 * 1e-3;

						// rotate the aperture shape
						float ac = cos( physicalCamera.apertureRotation );
						float as = sin( physicalCamera.apertureRotation );
						apertureSample = vec2(
							apertureSample.x * ac - apertureSample.y * as,
							apertureSample.x * as + apertureSample.y * ac
						);
						apertureSample.x *= saturate( physicalCamera.anamorphicRatio );
						apertureSample.y *= saturate( 1.0 / physicalCamera.anamorphicRatio );

						// create the new ray
						rayOrigin += ( cameraWorldMatrix * vec4( apertureSample, 0.0, 0.0 ) ).xyz;
						rayDirection = focalPoint - rayOrigin;

					}
					#endif

					rayDirection = normalize( rayDirection );

				}

				void main() {

					rng_initialize( gl_FragCoord.xy, seed );

					vec3 rayDirection;
					vec3 rayOrigin;

					getCameraRay( rayDirection, rayOrigin );

					// inverse environment rotation
					mat3 invEnvironmentRotation = inverse( environmentRotation );

					// final color
					gl_FragColor = vec4( 0.0 );
					gl_FragColor.a = 1.0;

					// hit results
					uvec4 faceIndices = uvec4( 0u );
					vec3 faceNormal = vec3( 0.0, 0.0, 1.0 );
					vec3 barycoord = vec3( 0.0 );
					float side = 1.0;
					float dist = 0.0;

					// path tracing state
					float accumulatedRoughness = 0.0;
					float accumulatedClearcoatRoughness = 0.0;
					bool transmissiveRay = true;
					int transparentTraversals = TRANSPARENT_TRAVERSALS;
					vec3 throughputColor = vec3( 1.0 );
					SampleRec sampleRec;
					int i;
					bool isShadowRay = false;

					for ( i = 0; i < bounces; i ++ ) {

						bool hit = bvhIntersectFirstHit( bvh, rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist );

						LightSampleRec lightHit = lightsClosestHit( lights.tex, lights.count, rayOrigin, rayDirection );

						if ( lightHit.hit && ( lightHit.dist < dist || !hit ) ) {

							if ( i == 0 || transmissiveRay ) {

								gl_FragColor.rgb += lightHit.emission * throughputColor;

							} else {

								#if FEATURE_MIS

								// NOTE: we skip MIS for spotlights since we haven't fixed the forward
								// path tracing code path, yet
								if ( lightHit.type == SPOT_LIGHT_TYPE ) {

									gl_FragColor.rgb += lightHit.emission * throughputColor;

								} else {

									// weight the contribution
									float misWeight = misHeuristic( sampleRec.pdf, lightHit.pdf / float( lights.count + 1u ) );
									gl_FragColor.rgb += lightHit.emission * throughputColor * misWeight;

								}

								#else

								gl_FragColor.rgb += lightHit.emission * throughputColor;

								#endif

							}
							break;

						}

						if ( ! hit ) {

							if ( i == 0 || transmissiveRay ) {

								gl_FragColor.rgb += sampleBackground( environmentRotation * rayDirection ) * throughputColor;
								gl_FragColor.a = backgroundAlpha;

							} else {

								#if FEATURE_MIS

								// get the PDF of the hit envmap point
								vec3 envColor;
								float envPdf = envMapSample( environmentRotation * rayDirection, envMapInfo, envColor );
								envPdf /= float( lights.count + 1u );

								// and weight the contribution
								float misWeight = misHeuristic( sampleRec.pdf, envPdf );
								gl_FragColor.rgb += environmentIntensity * envColor * throughputColor * misWeight;

								#else

								gl_FragColor.rgb +=
									environmentIntensity *
									sampleEquirectEnvMapColor( environmentRotation * rayDirection, envMapInfo.map ) *
									throughputColor;

								#endif

							}
							break;

						}

						uint materialIndex = uTexelFetch1D( materialIndexAttribute, faceIndices.x ).r;
						Material material = readMaterialInfo( materials, materialIndex );

						if ( material.matte && i == 0 ) {

							gl_FragColor = vec4( 0.0 );
							break;

						}

						// if we've determined that this is a shadow ray and we've hit an item with no shadow casting
						// then skip it
						if ( ! material.castShadow && isShadowRay ) {

							vec3 point = rayOrigin + rayDirection * dist;
							vec3 absPoint = abs( point );
							float maxPoint = max( absPoint.x, max( absPoint.y, absPoint.z ) );
							rayOrigin = point - ( maxPoint + 1.0 ) * faceNormal * RAY_OFFSET;

							continue;

						}

						// uv coord for textures
						vec2 uv = textureSampleBarycoord( uvAttribute, barycoord, faceIndices.xyz ).xy;
						vec4 vertexColor = textureSampleBarycoord( colorAttribute, barycoord, faceIndices.xyz );

						// albedo
						vec4 albedo = vec4( material.color, material.opacity );
						if ( material.map != - 1 ) {

							vec3 uvPrime = material.mapTransform * vec3( uv, 1 );
							albedo *= texture2D( textures, vec3( uvPrime.xy, material.map ) );
						}

						if ( material.vertexColors ) {

							albedo *= vertexColor;

						}

						// alphaMap
						if ( material.alphaMap != - 1 ) {

							albedo.a *= texture2D( textures, vec3( uv, material.alphaMap ) ).x;

						}

						// possibly skip this sample if it's transparent, alpha test is enabled, or we hit the wrong material side
						// and it's single sided.
						// - alpha test is disabled when it === 0
						// - the material sidedness test is complicated because we want light to pass through the back side but still
						// be able to see the front side. This boolean checks if the side we hit is the front side on the first ray
						// and we're rendering the other then we skip it. Do the opposite on subsequent bounces to get incoming light.
						float alphaTest = material.alphaTest;
						bool useAlphaTest = alphaTest != 0.0;
						if (
							// material sidedness
							material.side != 0.0 && side != material.side

							// alpha test
							|| useAlphaTest && albedo.a < alphaTest

							// opacity
							|| material.transparent && ! useAlphaTest && albedo.a < rand()
						) {

							vec3 point = rayOrigin + rayDirection * dist;
							vec3 absPoint = abs( point );
							float maxPoint = max( absPoint.x, max( absPoint.y, absPoint.z ) );
							rayOrigin = point - ( maxPoint + 1.0 ) * faceNormal * RAY_OFFSET;

							// only allow a limited number of transparency discards otherwise we could
							// crash the context with too long a loop.
							i -= sign( transparentTraversals );
							transparentTraversals -= sign( transparentTraversals );
							continue;

						}

						// fetch the interpolated smooth normal
						vec3 normal = normalize( textureSampleBarycoord(
							normalAttribute,
							barycoord,
							faceIndices.xyz
						).xyz );

						// roughness
						float roughness = material.roughness;
						if ( material.roughnessMap != - 1 ) {

							vec3 uvPrime = material.roughnessMapTransform * vec3( uv, 1 );
							roughness *= texture2D( textures, vec3( uvPrime.xy, material.roughnessMap ) ).g;

						}

						// metalness
						float metalness = material.metalness;
						if ( material.metalnessMap != - 1 ) {

							vec3 uvPrime = material.metalnessMapTransform * vec3( uv, 1 );
							metalness *= texture2D( textures, vec3( uvPrime.xy, material.metalnessMap ) ).b;

						}

						// emission
						vec3 emission = material.emissiveIntensity * material.emissive;
						if ( material.emissiveMap != - 1 ) {

							vec3 uvPrime = material.emissiveMapTransform * vec3( uv, 1 );
							emission *= texture2D( textures, vec3( uvPrime.xy, material.emissiveMap ) ).xyz;

						}

						// transmission
						float transmission = material.transmission;
						if ( material.transmissionMap != - 1 ) {

							vec3 uvPrime = material.transmissionMapTransform * vec3( uv, 1 );
							transmission *= texture2D( textures, vec3( uvPrime.xy, material.transmissionMap ) ).r;

						}

						// normal
						vec3 baseNormal = normal;
						if ( material.normalMap != - 1 ) {

							vec4 tangentSample = textureSampleBarycoord(
								tangentAttribute,
								barycoord,
								faceIndices.xyz
							);

							// some provided tangents can be malformed (0, 0, 0) causing the normal to be degenerate
							// resulting in NaNs and slow path tracing.
							if ( length( tangentSample.xyz ) > 0.0 ) {

								vec3 tangent = normalize( tangentSample.xyz );
								vec3 bitangent = normalize( cross( normal, tangent ) * tangentSample.w );
								mat3 vTBN = mat3( tangent, bitangent, normal );

								vec3 uvPrime = material.normalMapTransform * vec3( uv, 1 );
								vec3 texNormal = texture2D( textures, vec3( uvPrime.xy, material.normalMap ) ).xyz * 2.0 - 1.0;
								texNormal.xy *= material.normalScale;
								normal = vTBN * texNormal;

							}

						}

						normal *= side;

						// clearcoat
						float clearcoat = material.clearcoat;
						if ( material.clearcoatMap != - 1 ) {

							vec3 uvPrime = material.clearcoatMapTransform * vec3( uv, 1 );
							clearcoat *= texture2D( textures, vec3( uvPrime.xy, material.clearcoatMap ) ).r;

						}

						// clearcoatRoughness
						float clearcoatRoughness = material.clearcoatRoughness;
						if ( material.clearcoatRoughnessMap != - 1 ) {

							vec3 uvPrime = material.clearcoatRoughnessMapTransform * vec3( uv, 1 );
							clearcoat *= texture2D( textures, vec3( uvPrime.xy, material.clearcoatRoughnessMap ) ).g;

						}

						// clearcoatNormal
						vec3 clearcoatNormal = baseNormal;
						if ( material.clearcoatNormalMap != - 1 ) {

							vec4 tangentSample = textureSampleBarycoord(
								tangentAttribute,
								barycoord,
								faceIndices.xyz
							);

							// some provided tangents can be malformed (0, 0, 0) causing the normal to be degenerate
							// resulting in NaNs and slow path tracing.
							if ( length( tangentSample.xyz ) > 0.0 ) {

								vec3 tangent = normalize( tangentSample.xyz );
								vec3 bitangent = normalize( cross( clearcoatNormal, tangent ) * tangentSample.w );
								mat3 vTBN = mat3( tangent, bitangent, clearcoatNormal );

								vec3 uvPrime = material.clearcoatNormalMapTransform * vec3( uv, 1 );
								vec3 texNormal = texture2D( textures, vec3( uvPrime.xy, material.clearcoatNormalMap ) ).xyz * 2.0 - 1.0;
								texNormal.xy *= material.clearcoatNormalScale;
								clearcoatNormal = vTBN * texNormal;

							}

						}

						clearcoatNormal *= side;

						// sheenColor
						vec3 sheenColor = material.sheenColor;
						if ( material.sheenColorMap != - 1 ) {

							vec3 uvPrime = material.sheenColorMapTransform * vec3( uv, 1 );
							sheenColor *= texture2D( textures, vec3( uvPrime.xy, material.sheenColorMap ) ).rgb;

						}

						// sheenRoughness
						float sheenRoughness = material.sheenRoughness;
						if ( material.sheenRoughnessMap != - 1 ) {

							vec3 uvPrime = material.sheenRoughnessMapTransform * vec3( uv, 1 );
							sheenRoughness *= texture2D( textures, vec3( uvPrime.xy, material.sheenRoughnessMap ) ).a;

						}

						// iridescence
						float iridescence = material.iridescence;
						if ( material.iridescenceMap != - 1 ) {

							vec3 uvPrime = material.iridescenceMapTransform * vec3( uv, 1 );
							iridescence *= texture2D( textures, vec3( uvPrime.xy, material.iridescenceMap ) ).r;

						}

						// iridescence thickness
						float iridescenceThickness = material.iridescenceThicknessMaximum;
						if ( material.iridescenceThicknessMap != - 1 ) {

							vec3 uvPrime = material.iridescenceThicknessMapTransform * vec3( uv, 1 );
							float iridescenceThicknessSampled = texture2D( textures, vec3( uvPrime.xy, material.iridescenceThicknessMap ) ).g;
							iridescenceThickness = mix( material.iridescenceThicknessMinimum, material.iridescenceThicknessMaximum, iridescenceThicknessSampled );

						}

						iridescence = iridescenceThickness == 0.0 ? 0.0 : iridescence;

						// specular color
						vec3 specularColor = material.specularColor;
						if ( material.specularColorMap != - 1 ) {

							vec3 uvPrime = material.specularColorMapTransform * vec3( uv, 1 );
							specularColor *= texture2D( textures, vec3( uvPrime.xy, material.specularColorMap ) ).rgb;

						}

						// specular intensity
						float specularIntensity = material.specularIntensity;
						if ( material.specularIntensityMap != - 1 ) {

							vec3 uvPrime = material.specularIntensityMapTransform * vec3( uv, 1 );
							specularIntensity *= texture2D( textures, vec3( uvPrime.xy, material.specularIntensityMap ) ).a;

						}

						SurfaceRec surfaceRec;
						surfaceRec.normal = normal;
						surfaceRec.faceNormal = faceNormal;
						surfaceRec.transmission = transmission;
						surfaceRec.ior = material.ior;
						surfaceRec.emission = emission;
						surfaceRec.metalness = metalness;
						surfaceRec.color = albedo.rgb;
						surfaceRec.clearcoat = clearcoat;
						surfaceRec.sheenColor = sheenColor;
						surfaceRec.iridescence = iridescence;
						surfaceRec.iridescenceIor = material.iridescenceIor;
						surfaceRec.iridescenceThickness = iridescenceThickness;
						surfaceRec.specularColor = specularColor;
						surfaceRec.specularIntensity = specularIntensity;
						surfaceRec.attenuationColor = material.attenuationColor;
						surfaceRec.attenuationDistance = material.attenuationDistance;

						// apply perceptual roughness factor from gltf
						// https://registry.khronos.org/glTF/specs/2.0/glTF-2.0.html#microfacet-surfaces
						surfaceRec.roughness = roughness * roughness;
						surfaceRec.clearcoatRoughness = clearcoatRoughness * clearcoatRoughness;
						surfaceRec.sheenRoughness = sheenRoughness * sheenRoughness;

						// frontFace is used to determine transmissive properties and PDF. If no transmission is used
						// then we can just always assume this is a front face.
						surfaceRec.frontFace = side == 1.0 || transmission == 0.0;
						surfaceRec.iorRatio = material.thinFilm || surfaceRec.frontFace ? 1.0 / material.ior : material.ior;
						surfaceRec.thinFilm = material.thinFilm;

						// Compute the filtered roughness value to use during specular reflection computations.
						// The accumulated roughness value is scaled by a user setting and a "magic value" of 5.0.
						// If we're exiting something transmissive then scale the factor down significantly so we can retain
						// sharp internal reflections
						surfaceRec.filteredRoughness = applyFilteredGlossy( surfaceRec.roughness, accumulatedRoughness );
						surfaceRec.filteredClearcoatRoughness = applyFilteredGlossy( surfaceRec.clearcoatRoughness, accumulatedClearcoatRoughness );

						mat3 normalBasis = getBasisFromNormal( surfaceRec.normal );
						mat3 invBasis = inverse( normalBasis );

						mat3 clearcoatNormalBasis = getBasisFromNormal( clearcoatNormal );
						mat3 clearcoatInvBasis = inverse( clearcoatNormalBasis );

						vec3 outgoing = - normalize( invBasis * rayDirection );
						vec3 clearcoatOutgoing = - normalize( clearcoatInvBasis * rayDirection );
						sampleRec = bsdfSample( outgoing, clearcoatOutgoing, normalBasis, invBasis, clearcoatNormalBasis, clearcoatInvBasis, surfaceRec );

						isShadowRay = sampleRec.specularPdf < rand();

						// adjust the hit point by the surface normal by a factor of some offset and the
						// maximum component-wise value of the current point to accommodate floating point
						// error as values increase.
						vec3 point = rayOrigin + rayDirection * dist;
						vec3 absPoint = abs( point );
						float maxPoint = max( absPoint.x, max( absPoint.y, absPoint.z ) );
						rayDirection = normalize( normalBasis * sampleRec.direction );

						bool isBelowSurface = dot( rayDirection, faceNormal ) < 0.0;
						rayOrigin = point + faceNormal * ( maxPoint + 1.0 ) * ( isBelowSurface ? - RAY_OFFSET : RAY_OFFSET );

						// direct env map sampling
						#if FEATURE_MIS

						// uniformly pick a light or environment map
						if( rand() > 1.0 / float( lights.count + 1u ) ) {

							// sample a light or environment
							LightSampleRec lightSampleRec = randomLightSample( lights.tex, iesProfiles, lights.count, rayOrigin );

							bool isSampleBelowSurface = dot( faceNormal, lightSampleRec.direction ) < 0.0;
							if ( isSampleBelowSurface ) {

								lightSampleRec.pdf = 0.0;

							}

							// check if a ray could even reach the light area
							if (
								lightSampleRec.pdf > 0.0 &&
								isDirectionValid( lightSampleRec.direction, normal, faceNormal ) &&
								! anyCloserHit( bvh, rayOrigin, lightSampleRec.direction, lightSampleRec.dist )
							) {

								// get the material pdf
								vec3 sampleColor;
								float lightMaterialPdf = bsdfResult( outgoing, clearcoatOutgoing, normalize( invBasis * lightSampleRec.direction ), normalize( clearcoatInvBasis * lightSampleRec.direction ), surfaceRec, sampleColor );
								bool isValidSampleColor = all( greaterThanEqual( sampleColor, vec3( 0.0 ) ) );
								if ( lightMaterialPdf > 0.0 && isValidSampleColor ) {

									// weight the direct light contribution
									float lightPdf = lightSampleRec.pdf / float( lights.count + 1u );
									float misWeight = misHeuristic( lightPdf, lightMaterialPdf );
									gl_FragColor.rgb += lightSampleRec.emission * throughputColor * sampleColor * misWeight / lightPdf;

								}

							}

						} else {

							// find a sample in the environment map to include in the contribution
							vec3 envColor, envDirection;
							float envPdf = randomEnvMapSample( envMapInfo, envColor, envDirection );
							envDirection = invEnvironmentRotation * envDirection;

							// this env sampling is not set up for transmissive sampling and yields overly bright
							// results so we ignore the sample in this case.
							// TODO: this should be improved but how? The env samples could traverse a few layers?
							bool isSampleBelowSurface = dot( faceNormal, envDirection ) < 0.0;
							if ( isSampleBelowSurface ) {

								envPdf = 0.0;

							}

							// check if a ray could even reach the surface
							vec3 attenuatedColor;
							if (
								envPdf > 0.0 &&
								isDirectionValid( envDirection, normal, faceNormal ) &&
								! attenuateHit( bvh, rayOrigin, envDirection, bounces - i, isShadowRay, attenuatedColor )
							) {

								// get the material pdf
								vec3 sampleColor;
								float envMaterialPdf = bsdfResult( outgoing, clearcoatOutgoing, normalize( invBasis * envDirection ), normalize( clearcoatInvBasis * envDirection ), surfaceRec, sampleColor );
								bool isValidSampleColor = all( greaterThanEqual( sampleColor, vec3( 0.0 ) ) );
								if ( envMaterialPdf > 0.0 && isValidSampleColor ) {

									// weight the direct light contribution
									envPdf /= float( lights.count + 1u );
									float misWeight = misHeuristic( envPdf, envMaterialPdf );
									gl_FragColor.rgb += attenuatedColor * environmentIntensity * envColor * throughputColor * sampleColor * misWeight / envPdf;

								}

							}

						}
						#endif

						// accumulate a roughness value to offset diffuse, specular, diffuse rays that have high contribution
						// to a single pixel resulting in fireflies
						if ( ! isBelowSurface ) {

							// determine if this is a rough normal or not by checking how far off straight up it is
							vec3 halfVector = normalize( outgoing + sampleRec.direction );
							accumulatedRoughness += sin( acosApprox( halfVector.z ) );

							vec3 clearcoatHalfVector = normalize( clearcoatOutgoing + sampleRec.clearcoatDirection );
							accumulatedClearcoatRoughness += sin( acosApprox( clearcoatHalfVector.z ) );

							transmissiveRay = false;

						}

						// accumulate color
						gl_FragColor.rgb += ( emission * throughputColor );

						// skip the sample if our PDF or ray is impossible
						if ( sampleRec.pdf <= 0.0 || ! isDirectionValid( rayDirection, normal, faceNormal) ) {

							break;

						}

						throughputColor *= sampleRec.color / sampleRec.pdf;

						// attenuate the throughput color by the medium color
						if ( side == - 1.0 ) {

							throughputColor *= transmissionAttenuation( dist, surfaceRec.attenuationColor, surfaceRec.attenuationDistance );

						}

						// discard the sample if there are any NaNs
						if ( any( isnan( throughputColor ) ) || any( isinf( throughputColor ) ) ) {

							break;

						}

					}

					gl_FragColor.a *= opacity;

				}

			`}),this.setValues(e)}}}),parcelRequire.register("jzv0I",function(e,t){$parcel$export(e.exports,"UIntVertexAttributeTexture",()=>s),$parcel$export(e.exports,"FloatVertexAttributeTexture",()=>l);var i=parcelRequire("4xklQ");function r(e){switch(e){case 1:return"R";case 2:return"RG";case 3:case 4:return"RGBA"}throw Error()}function n(e){switch(e){case 1:return i.RedFormat;case 2:return i.RGFormat;case 3:case 4:return i.RGBAFormat}}function o(e){switch(e){case 1:return i.RedIntegerFormat;case 2:return i.RGIntegerFormat;case 3:case 4:return i.RGBAIntegerFormat}}class a extends i.DataTexture{constructor(){super(),this.minFilter=i.NearestFilter,this.magFilter=i.NearestFilter,this.generateMipmaps=!1,this.overrideItemSize=null,this._forcedType=null}updateFrom(e){let t,a,s,l;let h=this.overrideItemSize,c=e.itemSize,d=e.count;if(null!==h){if(c*d%h!=0)throw Error("VertexAttributeTexture: overrideItemSize must divide evenly into buffer length.");e.itemSize=h,e.count=d*c/h}let u=e.itemSize,p=e.count,m=e.normalized,f=e.array.constructor,g=f.BYTES_PER_ELEMENT,y=this._forcedType,x=u;if(null===y)switch(f){case Float32Array:y=i.FloatType;break;case Uint8Array:case Uint16Array:case Uint32Array:y=i.UnsignedIntType;break;case Int8Array:case Int16Array:case Int32Array:y=i.IntType}let w=r(u);switch(y){case i.FloatType:s=1,a=n(u),m&&1===g?(l=f,w+="8",f===Uint8Array?t=i.UnsignedByteType:(t=i.ByteType,w+="_SNORM")):(l=Float32Array,w+="32F",t=i.FloatType);break;case i.IntType:w+=8*g+"I",s=m?Math.pow(2,8*f.BYTES_PER_ELEMENT-1):1,a=o(u),1===g?(l=Int8Array,t=i.ByteType):2===g?(l=Int16Array,t=i.ShortType):(l=Int32Array,t=i.IntType);break;case i.UnsignedIntType:w+=8*g+"UI",s=m?Math.pow(2,8*f.BYTES_PER_ELEMENT-1):1,a=o(u),1===g?(l=Uint8Array,t=i.UnsignedByteType):2===g?(l=Uint16Array,t=i.UnsignedShortType):(l=Uint32Array,t=i.UnsignedIntType)}3===x&&(a===i.RGBAFormat||a===i.RGBAIntegerFormat)&&(x=4);let b=Math.ceil(Math.sqrt(p)),v=x*b*b,M=new l(v),S=e.normalized;e.normalized=!1;for(let t=0;t<p;t++){let i=x*t;M[i]=e.getX(t)/s,u>=2&&(M[i+1]=e.getY(t)/s),u>=3&&(M[i+2]=e.getZ(t)/s,4===x&&(M[i+3]=1)),u>=4&&(M[i+3]=e.getW(t)/s)}e.normalized=S,this.internalFormat=w,this.format=a,this.type=t,this.image.width=b,this.image.height=b,this.image.data=M,this.needsUpdate=!0,this.dispose(),e.itemSize=c,e.count=d}}class s extends a{constructor(){super(),this._forcedType=i.UnsignedIntType}}class l extends a{constructor(){super(),this._forcedType=i.FloatType}}}),parcelRequire.register("kEmYZ",function(e,t){$parcel$export(e.exports,"MeshBVHUniformStruct",()=>s);var i=parcelRequire("4xklQ"),r=parcelRequire("jzv0I"),n=parcelRequire("ckwVR"),o=parcelRequire("kBHG0");function a(e,t,r){let a=e._roots;if(1!==a.length)throw Error("MeshBVHUniformStruct: Multi-root BVHs not supported.");let s=a[0],l=new Uint16Array(s),h=new Uint32Array(s),c=new Float32Array(s),d=s.byteLength/n.BYTES_PER_NODE,u=2*Math.ceil(Math.sqrt(d/2)),p=new Float32Array(4*u*u),m=Math.ceil(Math.sqrt(d)),f=new Uint32Array(2*m*m);for(let e=0;e<d;e++){let t=e*n.BYTES_PER_NODE/4,i=2*t,r=(0,o.BOUNDING_DATA_INDEX)(t);for(let t=0;t<3;t++)p[8*e+0+t]=c[r+0+t],p[8*e+4+t]=c[r+3+t];if((0,o.IS_LEAF)(i,l)){let r=(0,o.COUNT)(i,l),n=(0,o.OFFSET)(t,h),a=4294901760|r;f[2*e+0]=a,f[2*e+1]=n}else{let i=4*(0,o.RIGHT_NODE)(t,h)/n.BYTES_PER_NODE,r=(0,o.SPLIT_AXIS)(t,h);f[2*e+0]=r,f[2*e+1]=i}}t.image.data=p,t.image.width=u,t.image.height=u,t.format=i.RGBAFormat,t.type=i.FloatType,t.internalFormat="RGBA32F",t.minFilter=i.NearestFilter,t.magFilter=i.NearestFilter,t.generateMipmaps=!1,t.needsUpdate=!0,t.dispose(),r.image.data=f,r.image.width=m,r.image.height=m,r.format=i.RGIntegerFormat,r.type=i.UnsignedIntType,r.internalFormat="RG32UI",r.minFilter=i.NearestFilter,r.magFilter=i.NearestFilter,r.generateMipmaps=!1,r.needsUpdate=!0,r.dispose()}class s{constructor(){this.autoDispose=!0,this.index=new r.UIntVertexAttributeTexture,this.position=new r.FloatVertexAttributeTexture,this.bvhBounds=new i.DataTexture,this.bvhContents=new i.DataTexture,this.index.overrideItemSize=3}updateFrom(e){let{geometry:t}=e;a(e,this.bvhBounds,this.bvhContents),this.index.updateFrom(t.index),this.position.updateFrom(t.attributes.position)}dispose(){let{index:e,position:t,bvhBounds:i,bvhContents:r}=this;e&&e.dispose(),t&&t.dispose(),i&&i.dispose(),r&&r.dispose()}}}),parcelRequire.register("5jaKi",function(e,t){$parcel$export(e.exports,"shaderStructs",()=>i),$parcel$export(e.exports,"shaderIntersectFunction",()=>r);let i=`
#ifndef TRI_INTERSECT_EPSILON
#define TRI_INTERSECT_EPSILON 1e-5
#endif

#ifndef INFINITY
#define INFINITY 1e20
#endif

struct BVH {

	usampler2D index;
	sampler2D position;

	sampler2D bvhBounds;
	usampler2D bvhContents;

};
`,r=`

// Utilities
uvec4 uTexelFetch1D( usampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

ivec4 iTexelFetch1D( isampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 texelFetch1D( sampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {

	return
		barycoord.x * texelFetch1D( tex, faceIndices.x ) +
		barycoord.y * texelFetch1D( tex, faceIndices.y ) +
		barycoord.z * texelFetch1D( tex, faceIndices.z );

}

void ndcToCameraRay(
	vec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,
	out vec3 rayOrigin, out vec3 rayDirection
) {

	// get camera look direction and near plane for camera clipping
	vec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );
	vec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );
	float near = abs( nearVector.z / nearVector.w );

	// get the camera direction and position from camera matrices
	vec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );
	direction /= direction.w;
	direction = cameraWorld * direction - origin;

	// slide the origin along the ray until it sits at the near clip plane position
	origin.xyz += direction.xyz * near / dot( direction, lookDirection );

	rayOrigin = origin.xyz;
	rayDirection = direction.xyz;

}

// Raycasting
float intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax ) {

	// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/
	// https://tavianator.com/2011/ray_box.html
	vec3 invDir = 1.0 / rayDirection;

	// find intersection distances for each plane
	vec3 tMinPlane = invDir * ( boundsMin - rayOrigin );
	vec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );

	// get the min and max distances from each intersection
	vec3 tMinHit = min( tMaxPlane, tMinPlane );
	vec3 tMaxHit = max( tMaxPlane, tMinPlane );

	// get the furthest hit distance
	vec2 t = max( tMinHit.xx, tMinHit.yz );
	float t0 = max( t.x, t.y );

	// get the minimum hit distance
	t = min( tMaxHit.xx, tMaxHit.yz );
	float t1 = min( t.x, t.y );

	// set distance to 0.0 if the ray starts inside the box
	float dist = max( t0, 0.0 );

	return t1 >= dist ? dist : INFINITY;

}

bool intersectsTriangle(
	vec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,
	out vec3 barycoord, out vec3 norm, out float dist, out float side
) {

	// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d
	vec3 edge1 = b - a;
	vec3 edge2 = c - a;
	norm = cross( edge1, edge2 );

	float det = - dot( rayDirection, norm );
	float invdet = 1.0 / det;

	vec3 AO = rayOrigin - a;
	vec3 DAO = cross( AO, rayDirection );

	vec4 uvt;
	uvt.x = dot( edge2, DAO ) * invdet;
	uvt.y = - dot( edge1, DAO ) * invdet;
	uvt.z = dot( AO, norm ) * invdet;
	uvt.w = 1.0 - uvt.x - uvt.y;

	// set the hit information
	barycoord = uvt.wxy; // arranged in A, B, C order
	dist = uvt.z;
	side = sign( det );
	norm = side * normalize( norm );

	// add an epsilon to avoid misses between triangles
	uvt += vec4( TRI_INTERSECT_EPSILON );

	return all( greaterThanEqual( uvt, vec4( 0.0 ) ) );

}

bool intersectTriangles(
	BVH bvh, vec3 rayOrigin, vec3 rayDirection, uint offset, uint count,
	inout float minDistance,

	// output variables
	out uvec4 faceIndices, out vec3 faceNormal, out vec3 barycoord,
	out float side, out float dist
) {

	bool found = false;
	vec3 localBarycoord, localNormal;
	float localDist, localSide;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( bvh.index, i ).xyz;
		vec3 a = texelFetch1D( bvh.position, indices.x ).rgb;
		vec3 b = texelFetch1D( bvh.position, indices.y ).rgb;
		vec3 c = texelFetch1D( bvh.position, indices.z ).rgb;

		if (
			intersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )
			&& localDist < minDistance
		) {

			found = true;
			minDistance = localDist;

			faceIndices = uvec4( indices.xyz, i );
			faceNormal = localNormal;

			side = localSide;
			barycoord = localBarycoord;
			dist = localDist;

		}

	}

	return found;

}

float intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, BVH bvh, uint currNodeIndex ) {

	vec3 boundsMin = texelFetch1D( bvh.bvhBounds, currNodeIndex * 2u + 0u ).xyz;
	vec3 boundsMax = texelFetch1D( bvh.bvhBounds, currNodeIndex * 2u + 1u ).xyz;
	return intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax );

}

bool bvhIntersectFirstHit(
	BVH bvh, vec3 rayOrigin, vec3 rayDirection,

	// output variables
	out uvec4 faceIndices, out vec3 faceNormal, out vec3 barycoord,
	out float side, out float dist
) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ 60 ];
	stack[ 0 ] = 0u;

	float triangleDistance = 1e20;
	bool found = false;
	while ( ptr > - 1 && ptr < 60 ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance = intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh, currNodeIndex );
		if ( boundsHitDistance == INFINITY || boundsHitDistance > triangleDistance ) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh.bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );

		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;

			found = intersectTriangles(
				bvh, rayOrigin, rayDirection, offset, count, triangleDistance,
				faceIndices, faceNormal, barycoord, side, dist
			) || found;

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;

			bool leftToRight = rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;

			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return found;

}
`}),parcelRequire.register("j4aeK",function(e,t){$parcel$export(e.exports,"shaderMaterialStructs",()=>i),$parcel$export(e.exports,"shaderLightStruct",()=>r);let i=`

	struct PhysicalCamera {

		float focusDistance;
		float anamorphicRatio;
		float bokehSize;
		int apertureBlades;
		float apertureRotation;

	};

	struct EquirectHdrInfo {

		sampler2D marginalWeights;
		sampler2D conditionalWeights;
		sampler2D map;

		float totalSumWhole;
		float totalSumDecimal;

	};

	struct Material {

		vec3 color;
		int map;

		float metalness;
		int metalnessMap;

		float roughness;
		int roughnessMap;

		float ior;
		float transmission;
		int transmissionMap;

		float emissiveIntensity;
		vec3 emissive;
		int emissiveMap;

		int normalMap;
		vec2 normalScale;

		float clearcoat;
		int clearcoatMap;
		int clearcoatNormalMap;
		vec2 clearcoatNormalScale;
		float clearcoatRoughness;
		int clearcoatRoughnessMap;

		int iridescenceMap;
		int iridescenceThicknessMap;
		float iridescence;
		float iridescenceIor;
		float iridescenceThicknessMinimum;
		float iridescenceThicknessMaximum;

		vec3 specularColor;
		int specularColorMap;

		float specularIntensity;
		int specularIntensityMap;
		bool thinFilm;

		vec3 attenuationColor;
		float attenuationDistance;

		int alphaMap;

		bool castShadow;
		float opacity;
		float alphaTest;

		float side;
		bool matte;

		vec3 sheenColor;
		int sheenColorMap;
		float sheenRoughness;
		int sheenRoughnessMap;

		bool vertexColors;
		bool transparent;

		mat3 mapTransform;
		mat3 metalnessMapTransform;
		mat3 roughnessMapTransform;
		mat3 transmissionMapTransform;
		mat3 emissiveMapTransform;
		mat3 normalMapTransform;
		mat3 clearcoatMapTransform;
		mat3 clearcoatNormalMapTransform;
		mat3 clearcoatRoughnessMapTransform;
		mat3 sheenColorMapTransform;
		mat3 sheenRoughnessMapTransform;
		mat3 iridescenceMapTransform;
		mat3 iridescenceThicknessMapTransform;
		mat3 specularColorMapTransform;
		mat3 specularIntensityMapTransform;

	};

	mat3 readTextureTransform( sampler2D tex, uint index ) {

		mat3 textureTransform;

		vec4 row1 = texelFetch1D( tex, index );
		vec4 row2 = texelFetch1D( tex, index + 1u );

		textureTransform[0] = vec3(row1.r, row2.r, 0.0);
		textureTransform[1] = vec3(row1.g, row2.g, 0.0);
		textureTransform[2] = vec3(row1.b, row2.b, 1.0);

		return textureTransform;

	}

	Material readMaterialInfo( sampler2D tex, uint index ) {

		uint i = index * 45u;

		vec4 s0 = texelFetch1D( tex, i + 0u );
		vec4 s1 = texelFetch1D( tex, i + 1u );
		vec4 s2 = texelFetch1D( tex, i + 2u );
		vec4 s3 = texelFetch1D( tex, i + 3u );
		vec4 s4 = texelFetch1D( tex, i + 4u );
		vec4 s5 = texelFetch1D( tex, i + 5u );
		vec4 s6 = texelFetch1D( tex, i + 6u );
		vec4 s7 = texelFetch1D( tex, i + 7u );
		vec4 s8 = texelFetch1D( tex, i + 8u );
		vec4 s9 = texelFetch1D( tex, i + 9u );
		vec4 s10 = texelFetch1D( tex, i + 10u );
		vec4 s11 = texelFetch1D( tex, i + 11u );
		vec4 s12 = texelFetch1D( tex, i + 12u );
		vec4 s13 = texelFetch1D( tex, i + 13u );
		vec4 s14 = texelFetch1D( tex, i + 14u );

		Material m;
		m.color = s0.rgb;
		m.map = int( round( s0.a ) );

		m.metalness = s1.r;
		m.metalnessMap = int( round( s1.g ) );
		m.roughness = s1.b;
		m.roughnessMap = int( round( s1.a ) );

		m.ior = s2.r;
		m.transmission = s2.g;
		m.transmissionMap = int( round( s2.b ) );
		m.emissiveIntensity = s2.a;

		m.emissive = s3.rgb;
		m.emissiveMap = int( round( s3.a ) );

		m.normalMap = int( round( s4.r ) );
		m.normalScale = s4.gb;

		m.clearcoat = s4.a;
		m.clearcoatMap = int( round( s5.r ) );
		m.clearcoatRoughness = s5.g;
		m.clearcoatRoughnessMap = int( round( s5.b ) );
		m.clearcoatNormalMap = int( round( s5.a ) );
		m.clearcoatNormalScale = s6.rg;

		m.sheenColor = s7.rgb;
		m.sheenColorMap = int( round( s7.a ) );
		m.sheenRoughness = s8.r;
		m.sheenRoughnessMap = int( round( s8.g ) );

		m.iridescenceMap = int( round( s8.b ) );
		m.iridescenceThicknessMap = int( round( s8.a ) );
		m.iridescence = s9.r;
		m.iridescenceIor = s9.g;
		m.iridescenceThicknessMinimum = s9.b;
		m.iridescenceThicknessMaximum = s9.a;

		m.specularColor = s10.rgb;
		m.specularColorMap = int( round( s10.a ) );

		m.specularIntensity = s11.r;
		m.specularIntensityMap = int( round( s11.g ) );
		m.thinFilm = bool( s11.b );

		m.attenuationColor = s12.rgb;
		m.attenuationDistance = s12.a;

		m.alphaMap = int( round( s13.r ) );

		m.opacity = s13.g;
		m.alphaTest = s13.b;
		m.side = s13.a;

		m.matte = bool( s14.r );
		m.castShadow = ! bool( s14.g );
		m.vertexColors = bool( s14.b );
		m.transparent = bool( s14.a );

		uint firstTextureTransformIdx = i + 15u;

		m.mapTransform = m.map == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx );
		m.metalnessMapTransform = m.metalnessMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 2u );
		m.roughnessMapTransform = m.roughnessMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 4u );
		m.transmissionMapTransform = m.transmissionMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 6u );
		m.emissiveMapTransform = m.emissiveMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 8u );
		m.normalMapTransform = m.normalMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 10u );
		m.clearcoatMapTransform = m.clearcoatMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 12u );
		m.clearcoatNormalMapTransform = m.clearcoatNormalMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 14u );
		m.clearcoatRoughnessMapTransform = m.clearcoatRoughnessMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 16u );
		m.sheenColorMapTransform = m.sheenColorMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 18u );
		m.sheenRoughnessMapTransform = m.sheenRoughnessMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 20u );
		m.iridescenceMapTransform = m.iridescenceMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 22u );
		m.iridescenceThicknessMapTransform = m.iridescenceThicknessMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 24u );
		m.specularColorMapTransform = m.specularColorMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 26u );
		m.specularIntensityMapTransform = m.specularIntensityMap == - 1 ? mat3( 0 ) : readTextureTransform( tex, firstTextureTransformIdx + 28u );

		return m;

	}

`,r=`

	#define RECT_AREA_LIGHT_TYPE 0
	#define CIRC_AREA_LIGHT_TYPE 1
	#define SPOT_LIGHT_TYPE 2

	struct LightsInfo {

		sampler2D tex;
		uint count;

	};

	struct Light {

		vec3 position;
		int type;

		vec3 color;
		float intensity;

		vec3 u;
		vec3 v;
		float area;

		// spot light fields
		float radius;
		float near;
		float decay;
		float distance;
		float coneCos;
		float penumbraCos;
		int iesProfile;

	};

	Light readLightInfo( sampler2D tex, uint index ) {

		uint i = index * 6u;

		vec4 s0 = texelFetch1D( tex, i + 0u );
		vec4 s1 = texelFetch1D( tex, i + 1u );
		vec4 s2 = texelFetch1D( tex, i + 2u );
		vec4 s3 = texelFetch1D( tex, i + 3u );

		Light l;
		l.position = s0.rgb;
		l.type = int( round( s0.a ) );

		l.color = s1.rgb;
		l.intensity = s1.a;

		l.u = s2.rgb;
		l.v = s3.rgb;
		l.area = s3.a;

		if ( l.type == SPOT_LIGHT_TYPE ) {

			vec4 s4 = texelFetch1D( tex, i + 4u );
			vec4 s5 = texelFetch1D( tex, i + 5u );
			l.radius = s4.r;
			l.near = s4.g;
			l.decay = s4.b;
			l.distance = s4.a;

			l.coneCos = s5.r;
			l.penumbraCos = s5.g;
			l.iesProfile = int( round ( s5.b ) );

		}

		return l;

	}

	struct SpotLight {

		vec3 position;
		int type;

		vec3 color;
		float intensity;

		vec3 u;
		vec3 v;
		float area;

		float radius;
		float near;
		float decay;
		float distance;
		float coneCos;
		float penumbraCos;
		int iesProfile;

	};

`}),parcelRequire.register("iZpZ1",function(e,t){$parcel$export(e.exports,"MaterialsTexture",()=>l);var i=parcelRequire("4xklQ");let r=45,n=4*r,o=55,a=56,s=57;class l extends i.DataTexture{constructor(){super(new Float32Array(4),1,1),this.format=i.RGBAFormat,this.type=i.FloatType,this.wrapS=i.ClampToEdgeWrapping,this.wrapT=i.ClampToEdgeWrapping,this.generateMipmaps=!1,this.threeCompatibilityTransforms=!1}setCastShadow(e,t){let i=this.image.data,r=e*n+s;i[r]=t?0:1}getCastShadow(e){let t=e*n+s;return!this.image.data[t]}setSide(e,t){let r=this.image.data,a=e*n+o;switch(t){case i.FrontSide:r[a]=1;break;case i.BackSide:r[a]=-1;break;case i.DoubleSide:r[a]=0}}getSide(e){let t=e*n+o;switch(this.image.data[t]){case 0:return i.DoubleSide;case 1:return i.FrontSide;case -1:return i.BackSide}return 0}setMatte(e,t){let i=this.image.data,r=e*n+a;i[r]=t?1:0}getMatte(e){let t=e*n+a;return!!this.image.data[t]}updateFrom(e,t){function i(e,i,r=-1){return i in e?t.indexOf(e[i]):r}function n(e,t,i){return t in e?e[t]:i}function o(e){return e.map||e.specularMap||e.displacementMap||e.normalMap||e.bumpMap||e.roughnessMap||e.metalnessMap||e.alphaMap||e.emissiveMap||e.clearcoatMap||e.clearcoatNormalMap||e.clearcoatRoughnessMap||e.iridescenceMap||e.iridescenceThicknessMap||e.specularIntensityMap||e.specularColorMap||e.transmissionMap||e.thicknessMap||e.sheenColorMap||e.sheenRoughnessMap||null}function a(e,t,i,r){let n;if(n=c?o(e):e[t]&&e[t].isTexture?e[t]:null){let e=n.matrix.elements,t=0;i[r+t++]=e[0],i[r+t++]=e[3],i[r+t++]=e[6],t++,i[r+t++]=e[1],i[r+t++]=e[4],i[r+t++]=e[7],t++}return 8}let s=0,l=e.length*r,h=Math.ceil(Math.sqrt(l)),{threeCompatibilityTransforms:c,image:d}=this;d.width!==h&&(this.dispose(),d.data=new Float32Array(h*h*4),d.width=h,d.height=h);let u=d.data;for(let r=0,o=e.length;r<o;r++){let o=e[r];u[s++]=o.color.r,u[s++]=o.color.g,u[s++]=o.color.b,u[s++]=i(o,"map"),u[s++]=n(o,"metalness",0),u[s++]=t.indexOf(o.metalnessMap),u[s++]=n(o,"roughness",0),u[s++]=t.indexOf(o.roughnessMap),u[s++]=n(o,"ior",1.5),u[s++]=n(o,"transmission",0),u[s++]=i(o,"transmissionMap"),u[s++]=n(o,"emissiveIntensity",0),"emissive"in o?(u[s++]=o.emissive.r,u[s++]=o.emissive.g,u[s++]=o.emissive.b):(u[s++]=0,u[s++]=0,u[s++]=0),u[s++]=i(o,"emissiveMap"),u[s++]=i(o,"normalMap"),"normalScale"in o?(u[s++]=o.normalScale.x,u[s++]=o.normalScale.y):(u[s++]=1,u[s++]=1),u[s++]=n(o,"clearcoat",0),u[s++]=i(o,"clearcoatMap"),u[s++]=n(o,"clearcoatRoughness",0),u[s++]=i(o,"clearcoatRoughnessMap"),u[s++]=i(o,"clearcoatNormalMap"),"clearcoatNormalScale"in o?(u[s++]=o.clearcoatNormalScale.x,u[s++]=o.clearcoatNormalScale.y):(u[s++]=1,u[s++]=1),s++,s++,"sheenColor"in o?(u[s++]=o.sheenColor.r,u[s++]=o.sheenColor.g,u[s++]=o.sheenColor.b):(u[s++]=0,u[s++]=0,u[s++]=0),u[s++]=i(o,"sheenColorMap"),u[s++]=n(o,"sheenRoughness",0),u[s++]=i(o,"sheenRoughnessMap"),u[s++]=i(o,"iridescenceMap"),u[s++]=i(o,"iridescenceThicknessMap"),u[s++]=n(o,"iridescence",0),u[s++]=n(o,"iridescenceIOR",1.3);let l=n(o,"iridescenceThicknessRange",[100,400]);u[s++]=l[0],u[s++]=l[1],"specularColor"in o?(u[s++]=o.specularColor.r,u[s++]=o.specularColor.g,u[s++]=o.specularColor.b):(u[s++]=1,u[s++]=1,u[s++]=1),u[s++]=i(o,"specularColorMap"),u[s++]=n(o,"specularIntensity",1),u[s++]=i(o,"specularIntensityMap"),u[s++]=0===n(o,"thickness",0)&&n(o,"attenuationDistance",1/0)===1/0,s++,"attenuationColor"in o?(u[s++]=o.attenuationColor.r,u[s++]=o.attenuationColor.g,u[s++]=o.attenuationColor.b):(u[s++]=1,u[s++]=1,u[s++]=1),u[s++]=n(o,"attenuationDistance",1/0),u[s++]=i(o,"alphaMap"),u[s++]=o.opacity,u[s++]=o.alphaTest,s++,s++,s++,u[s++]=Number(o.vertexColors),u[s++]=Number(o.transparent),s+=a(o,"map",u,s),s+=a(o,"metalnessMap",u,s),s+=a(o,"roughnessMap",u,s),s+=a(o,"transmissionMap",u,s),s+=a(o,"emissiveMap",u,s),s+=a(o,"normalMap",u,s),s+=a(o,"clearcoatMap",u,s),s+=a(o,"clearcoatNormalMap",u,s),s+=a(o,"clearcoatRoughnessMap",u,s),s+=a(o,"sheenColorMap",u,s),s+=a(o,"sheenRoughnessMap",u,s),s+=a(o,"iridescenceMap",u,s),s+=a(o,"iridescenceThicknessMap",u,s),s+=a(o,"specularColorMap",u,s),s+=a(o,"specularIntensityMap",u,s)}this.needsUpdate=!0}}}),parcelRequire.register("jrTmV",function(e,t){$parcel$export(e.exports,"RenderTarget2DArray",()=>o);var i=parcelRequire("4xklQ"),r=parcelRequire("yHpto");let n=new i.Color;class o extends i.WebGLArrayRenderTarget{constructor(...e){super(...e);let t=this.texture;t.format=i.RGBAFormat,t.type=i.UnsignedByteType,t.minFilter=i.LinearFilter,t.magFilter=i.LinearFilter,t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping,t.setTextures=(...e)=>{this.setTextures(...e)};let n=new r.FullScreenQuad(new i.MeshBasicMaterial);this.fsQuad=n}setTextures(e,t,r,o){let a=e.getRenderTarget(),s=e.toneMapping,l=e.getClearAlpha();e.getClearColor(n);let h=o.length||1;this.setSize(t,r,h),e.setClearColor(0,0),e.toneMapping=i.NoToneMapping;let c=this.fsQuad;for(let t=0,i=h;t<i;t++){let i=o[t];i&&(i.matrixAutoUpdate=!1,i.matrix.identity(),c.material.map=i,c.material.transparent=!0,e.setRenderTarget(this,t),c.render(e),i.updateMatrix(),i.matrixAutoUpdate=!0)}c.material.map=null,e.setClearColor(n,l),e.setRenderTarget(a),e.toneMapping=s}dispose(){super.dispose(),this.fsQuad.dispose()}}}),parcelRequire.register("hOrGl",function(e,t){$parcel$export(e.exports,"shaderMaterialSampling",()=>o);var i=parcelRequire("3DxO5"),r=parcelRequire("49T3W"),n=parcelRequire("7hp2H");let o=`

struct SurfaceRec {
	vec3 normal;
	vec3 faceNormal;
	bool frontFace;
	float roughness;
	float filteredRoughness;
	float metalness;
	vec3 color;
	vec3 emission;
	float transmission;
	bool thinFilm;
	float ior;
	float iorRatio;
	float clearcoat;
	float clearcoatRoughness;
	float filteredClearcoatRoughness;
	vec3 sheenColor;
	float sheenRoughness;
	float iridescence;
	float iridescenceIor;
	float iridescenceThickness;
	vec3 specularColor;
	float specularIntensity;
	vec3 attenuationColor;
	float attenuationDistance;
};

struct SampleRec {
	float specularPdf;
	float pdf;
	vec3 direction;
	vec3 clearcoatDirection;
	vec3 color;
};

${i.shaderGGXFunctions}
${r.shaderSheenFunctions}
${n.shaderIridescenceFunctions}

// diffuse
float diffusePDF( vec3 wo, vec3 wi, SurfaceRec surf ) {

	// https://raytracing.github.io/books/RayTracingTheRestOfYourLife.html#lightscattering/thescatteringpdf
	float cosValue = wi.z;
	return cosValue / PI;

}

vec3 diffuseDirection( vec3 wo, SurfaceRec surf ) {

	vec3 lightDirection = randDirection();
	lightDirection.z += 1.0;
	lightDirection = normalize( lightDirection );

	return lightDirection;

}

vec3 diffuseColor( vec3 wo, vec3 wi, SurfaceRec surf ) {

	// TODO: scale by 1 - F here
	// note on division by PI
	// https://seblagarde.wordpress.com/2012/01/08/pi-or-not-to-pi-in-game-lighting-equation/
	float metalFactor = ( 1.0 - surf.metalness );
	return surf.color * metalFactor * wi.z / PI;

}

// specular
float specularPDF( vec3 wo, vec3 wi, SurfaceRec surf ) {

	// See 14.1.1 Microfacet BxDFs in https://www.pbr-book.org/
	float filteredRoughness = surf.filteredRoughness;
	vec3 halfVector = getHalfVector( wi, wo );

	float incidentTheta = acos( wo.z );
	float D = ggxDistribution( halfVector, filteredRoughness );
	float G1 = ggxShadowMaskG1( incidentTheta, filteredRoughness );
	float ggxPdf = D * G1 * max( 0.0, abs( dot( wo, halfVector ) ) ) / abs ( wo.z );
	return ggxPdf / ( 4.0 * dot( wo, halfVector ) );

}

vec3 specularDirection( vec3 wo, SurfaceRec surf ) {

	// sample ggx vndf distribution which gives a new normal
	float filteredRoughness = surf.filteredRoughness;
	vec3 halfVector = ggxDirection(
		wo,
		filteredRoughness,
		filteredRoughness,
		rand(),
		rand()
	);

	// apply to new ray by reflecting off the new normal
	return - reflect( wo, halfVector );

}

vec3 specularColor( vec3 wo, vec3 wi, SurfaceRec surf ) {

	// if roughness is set to 0 then D === NaN which results in black pixels
	float metalness = surf.metalness;
	float filteredRoughness = surf.filteredRoughness;

	vec3 halfVector = getHalfVector( wo, wi );
	float iorRatio = surf.iorRatio;
	float G = ggxShadowMaskG2( wi, wo, filteredRoughness );
	float D = ggxDistribution( halfVector, filteredRoughness );

	float f0 = iorRatioToF0( iorRatio );
	vec3 F = vec3( schlickFresnel( dot( wi, halfVector ), f0 ) );

	float cosTheta = min( wo.z, 1.0 );
	float sinTheta = sqrt( 1.0 - cosTheta * cosTheta );
	bool cannotRefract = iorRatio * sinTheta > 1.0;
	if ( cannotRefract ) {

		F = vec3( 1.0 );

	}

	vec3 iridescenceFresnel = evalIridescence( 1.0, surf.iridescenceIor, dot( wi, halfVector ), surf.iridescenceThickness, vec3( f0 ) );
	vec3 metalF = mix( F, iridescenceFresnel, surf.iridescence );
	vec3 dialectricF = F * surf.specularIntensity;
	F = mix( dialectricF, metalF, metalness );

	vec3 color = mix( surf.specularColor, surf.color, metalness );
	color = mix( color, vec3( 1.0 ), F );
	color *= G * D / ( 4.0 * abs( wi.z * wo.z ) );
	color *= mix( F, vec3( 1.0 ), metalness );
	color *= wi.z; // scale the light by the direction the light is coming in from

	return color;

}

/*
// transmission
function transmissionPDF( wo, wi, material, surf ) {

	// See section 4.2 in https://www.cs.cornell.edu/~srm/publications/EGSR07-btdf.pdf

	const { roughness, ior } = material;
	const { frontFace } = hit;
	const ratio = frontFace ? ior : 1 / ior;
	const minRoughness = Math.max( roughness, MIN_ROUGHNESS );

	halfVector.set( 0, 0, 0 ).addScaledVector( wi, ratio ).addScaledVector( wo, 1.0 ).normalize().multiplyScalar( - 1 );

	const denom = Math.pow( ratio * halfVector.dot( wi ) + 1.0 * halfVector.dot( wo ), 2.0 );
	return ggxPDF( wo, halfVector, minRoughness ) / denom;

}

function transmissionDirection( wo, hit, material, lightDirection ) {

	const { roughness, ior } = material;
	const { frontFace } = hit;
	const ratio = frontFace ? 1 / ior : ior;
	const minRoughness = Math.max( roughness, MIN_ROUGHNESS );

	// sample ggx vndf distribution which gives a new normal
	ggxDirection(
		wo,
		minRoughness,
		minRoughness,
		Math.random(),
		Math.random(),
		halfVector,
	);

	// apply to new ray by reflecting off the new normal
	tempDir.copy( wo ).multiplyScalar( - 1 );
	refract( tempDir, halfVector, ratio, lightDirection );

}

function transmissionColor( wo, wi, material, hit, colorTarget ) {

	const { metalness, transmission } = material;
	colorTarget
		.copy( material.color )
		.multiplyScalar( ( 1.0 - metalness ) * wo.z )
		.multiplyScalar( transmission );

}
*/

// TODO: This is just using a basic cosine-weighted specular distribution with an
// incorrect PDF value at the moment. Update it to correctly use a GGX distribution
float transmissionPDF( vec3 wo, vec3 wi, SurfaceRec surf ) {

	float iorRatio = surf.iorRatio;
	float cosTheta = min( wo.z, 1.0 );
	float sinTheta = sqrt( 1.0 - cosTheta * cosTheta );
	float reflectance = schlickFresnelFromIor( cosTheta, iorRatio );
	bool cannotRefract = iorRatio * sinTheta > 1.0;
	if ( cannotRefract ) {

		return 0.0;

	}

	return 1.0 / ( 1.0 - reflectance );

}

vec3 transmissionDirection( vec3 wo, SurfaceRec surf ) {

	float roughness = surf.roughness;
	float iorRatio = surf.iorRatio;

	vec3 halfVector = normalize( vec3( 0.0, 0.0, 1.0 ) + randDirection() * roughness );
	vec3 lightDirection = refract( normalize( - wo ), halfVector, iorRatio );

	if ( surf.thinFilm ) {

		lightDirection = - refract( normalize( - lightDirection ), - vec3( 0.0, 0.0, 1.0 ), 1.0 / iorRatio );

	}
	return normalize( lightDirection );

}

vec3 transmissionColor( vec3 wo, vec3 wi, SurfaceRec surf ) {

	// only attenuate the color if it's on the way in
	vec3 col = surf.thinFilm || surf.frontFace ? surf.color : vec3( 1.0 );
	return surf.transmission * col;

}

// clearcoat
float clearcoatPDF( vec3 wo, vec3 wi, SurfaceRec surf ) {

	// See equation (27) in http://jcgt.org/published/0003/02/03/
	float filteredClearcoatRoughness = surf.filteredClearcoatRoughness;
	vec3 halfVector = getHalfVector( wi, wo );
	return ggxPDF( wo, halfVector, filteredClearcoatRoughness ) / ( 4.0 * dot( wi, halfVector ) );

}

vec3 clearcoatDirection( vec3 wo, SurfaceRec surf ) {

	// sample ggx vndf distribution which gives a new normal
	float filteredClearcoatRoughness = surf.filteredClearcoatRoughness;
	vec3 halfVector = ggxDirection(
		wo,
		filteredClearcoatRoughness,
		filteredClearcoatRoughness,
		rand(),
		rand()
	);

	// apply to new ray by reflecting off the new normal
	return - reflect( wo, halfVector );

}

void clearcoatColor( inout vec3 color, vec3 wo, vec3 wi, SurfaceRec surf ) {

	float ior = 1.5;
	bool frontFace = surf.frontFace;
	float filteredClearcoatRoughness = surf.filteredClearcoatRoughness;

	vec3 halfVector = getHalfVector( wo, wi );
	float iorRatio = frontFace ? 1.0 / ior : ior;
	float G = ggxShadowMaskG2( wi, wo, filteredClearcoatRoughness );
	float D = ggxDistribution( halfVector, filteredClearcoatRoughness );

	float F = schlickFresnelFromIor( dot( wi, halfVector ), ior );
	float cosTheta = min( wo.z, 1.0 );
	float sinTheta = sqrt( 1.0 - cosTheta * cosTheta );
	bool cannotRefract = iorRatio * sinTheta > 1.0;
	if ( cannotRefract ) {

		F = 1.0;

	}

	float fClearcoat = F * D * G / ( 4.0 * abs( wi.z * wo.z ) );

	color = color * ( 1.0 - surf.clearcoat * F ) + fClearcoat * surf.clearcoat * wi.z;

}

// sheen
vec3 sheenColor( vec3 wo, vec3 wi, SurfaceRec surf ) {

	vec3 halfVector = getHalfVector( wo, wi );

	float cosThetaO = saturateCos( wo.z );
	float cosThetaI = saturateCos( wi.z );
	float cosThetaH = halfVector.z;

	float D = velvetD( cosThetaH, surf.sheenRoughness );
	float G = velvetG( cosThetaO, cosThetaI, surf.sheenRoughness );

	// See equation (1) in http://www.aconty.com/pdf/s2017_pbs_imageworks_sheen.pdf
	vec3 color = surf.sheenColor;
	color *= D * G / ( 4.0 * abs( cosThetaO * cosThetaI ) );
	color *= wi.z;

	return color;

}

// bsdf
void getLobeWeights( vec3 wo, vec3 clearcoatWo, SurfaceRec surf, out float diffuseWeight, out float specularWeight, out float transmissionWeight, out float clearcoatWeight ) {

	float metalness = surf.metalness;
	float transmission = surf.transmission;

	// TODO: we should compute a half vector ahead of time and pass it into the sampling functions
	// so all functions will use the same half vector
	float iorRatio = surf.iorRatio;
	float cosTheta = min( wo.z, 1.0 );
	float sinTheta = sqrt( 1.0 - cosTheta * cosTheta );
	float reflectance = schlickFresnelFromIor( cosTheta, iorRatio );
	bool cannotRefract = iorRatio * sinTheta > 1.0;
	if ( cannotRefract ) {

		reflectance = 1.0;

	}

	float transSpecularProb = mix( reflectance, 1.0, metalness );
	float diffSpecularProb = 0.5 + 0.5 * metalness;

	clearcoatWeight = surf.clearcoat * schlickFresnel( clearcoatWo.z, 0.04 );
	diffuseWeight = ( 1.0 - transmission ) * ( 1.0 - diffSpecularProb ) * ( 1.0 - clearcoatWeight );
	specularWeight = transmission * transSpecularProb + ( 1.0 - transmission ) * diffSpecularProb * ( 1.0 - clearcoatWeight );
	transmissionWeight = transmission * ( 1.0 - transSpecularProb ) * ( 1.0 - clearcoatWeight );

	float totalWeight = diffuseWeight + specularWeight + transmissionWeight + clearcoatWeight;
	diffuseWeight /= totalWeight;
	specularWeight /= totalWeight;
	transmissionWeight /= totalWeight;
	clearcoatWeight /= totalWeight;

}

float bsdfPdf( vec3 wo, vec3 clearcoatWo, vec3 wi, vec3 clearcoatWi, SurfaceRec surf, out float specularPdf, float diffuseWeight, float specularWeight, float transmissionWeight, float clearcoatWeight ) {

	float metalness = surf.metalness;
	float transmission = surf.transmission;

	float iorRatio = surf.iorRatio;
	float cosTheta = min( wo.z, 1.0 );
	float sinTheta = sqrt( 1.0 - cosTheta * cosTheta );
	float reflectance = schlickFresnelFromIor( cosTheta, iorRatio );
	bool cannotRefract = iorRatio * sinTheta > 1.0;
	if ( cannotRefract ) {

		reflectance = 1.0;

	}

	float spdf = 0.0;
	float dpdf = 0.0;
	float tpdf = 0.0;
	float cpdf = 0.0;

	if ( wi.z < 0.0 ) {

		if( transmissionWeight > 0.0 ) {

			tpdf = transmissionPDF( wo, wi, surf );

		}

	} else {

		if( diffuseWeight > 0.0 ) {

			dpdf = diffusePDF( wo, wi, surf );

		}

		if( specularWeight > 0.0 ) {

			spdf = specularPDF( wo, wi, surf );

		}

	}

	if( clearcoatWi.z >= 0.0 && clearcoatWeight > 0.0 ) {

		cpdf = clearcoatPDF( clearcoatWo, clearcoatWi, surf );

	}

	float pdf =
		  dpdf * diffuseWeight
		+ spdf * specularWeight
		+ tpdf * transmissionWeight
		+ cpdf * clearcoatWeight;

	// retrieve specular rays for the shadows flag
	specularPdf = spdf * specularWeight + cpdf * clearcoatWeight;

	return pdf;

}

vec3 bsdfColor( vec3 wo, vec3 clearcoatWo, vec3 wi, vec3 clearcoatWi, SurfaceRec surf, float diffuseWeight, float specularWeight, float transmissionWeight, float clearcoatWeight ) {

	vec3 color = vec3( 0.0 );
	if ( wi.z < 0.0 ) {

		if( transmissionWeight > 0.0 ) {

			color = transmissionColor( wo, wi, surf );

		}

	} else {

		if( diffuseWeight > 0.0 ) {

			color = diffuseColor( wo, wi, surf );
			color *= 1.0 - surf.transmission;

		}

		if( specularWeight > 0.0 ) {

			color += specularColor( wo, wi, surf );

		}

		color *= sheenAlbedoScaling( wo, wi, surf );
		color += sheenColor( wo, wi, surf );

	}

	if( clearcoatWi.z >= 0.0 && clearcoatWeight > 0.0 ) {

		clearcoatColor( color, clearcoatWo, clearcoatWi, surf );

	}

	return color;

}

float bsdfResult( vec3 wo, vec3 clearcoatWo, vec3 wi, vec3 clearcoatWi, SurfaceRec surf, out vec3 color ) {

	float diffuseWeight;
	float specularWeight;
	float transmissionWeight;
	float clearcoatWeight;
	getLobeWeights( wo, clearcoatWo, surf, diffuseWeight, specularWeight, transmissionWeight, clearcoatWeight );

	float specularPdf;
	color = bsdfColor( wo, clearcoatWo, wi, clearcoatWi, surf, diffuseWeight, specularWeight, transmissionWeight, clearcoatWeight );
	return bsdfPdf( wo, clearcoatWo, wi, clearcoatWi, surf, specularPdf, diffuseWeight, specularWeight, transmissionWeight, clearcoatWeight );

}

SampleRec bsdfSample( vec3 wo, vec3 clearcoatWo, mat3 normalBasis, mat3 invBasis, mat3 clearcoatNormalBasis, mat3 clearcoatInvBasis, SurfaceRec surf ) {

	float diffuseWeight;
	float specularWeight;
	float transmissionWeight;
	float clearcoatWeight;
	getLobeWeights( wo, clearcoatWo, surf, diffuseWeight, specularWeight, transmissionWeight, clearcoatWeight );

	float pdf[4];
	pdf[0] = diffuseWeight;
	pdf[1] = specularWeight;
	pdf[2] = transmissionWeight;
	pdf[3] = clearcoatWeight;

	float cdf[4];
	cdf[0] = pdf[0];
	cdf[1] = pdf[1] + cdf[0];
	cdf[2] = pdf[2] + cdf[1];
	cdf[3] = pdf[3] + cdf[2];

	if( cdf[3] != 0.0 ) {

		float invMaxCdf = 1.0 / cdf[3];
		cdf[0] *= invMaxCdf;
		cdf[1] *= invMaxCdf;
		cdf[2] *= invMaxCdf;
		cdf[3] *= invMaxCdf;

	} else {

		cdf[0] = 1.0;
		cdf[1] = 0.0;
		cdf[2] = 0.0;
		cdf[3] = 0.0;

	}

	vec3 wi;
	vec3 clearcoatWi;

	float r = rand();
	if ( r <= cdf[0] ) { // diffuse

		wi = diffuseDirection( wo, surf );
		clearcoatWi = normalize( clearcoatInvBasis * normalize( normalBasis * wi ) );

	} else if ( r <= cdf[1] ) { // specular

		wi = specularDirection( wo, surf );
		clearcoatWi = normalize( clearcoatInvBasis * normalize( normalBasis * wi ) );

	} else if ( r <= cdf[2] ) { // transmission / refraction

		wi = transmissionDirection( wo, surf );
		clearcoatWi = normalize( clearcoatInvBasis * normalize( normalBasis * wi ) );

	} else if ( r <= cdf[3] ) { // clearcoat

		clearcoatWi = clearcoatDirection( clearcoatWo, surf );
		wi = normalize( invBasis * normalize( clearcoatNormalBasis * clearcoatWi ) );

	}

	SampleRec result;
	result.pdf = bsdfPdf( wo, clearcoatWo, wi, clearcoatWi, surf, result.specularPdf, diffuseWeight, specularWeight, transmissionWeight, clearcoatWeight );
	result.color = bsdfColor( wo, clearcoatWo, wi, clearcoatWi, surf, diffuseWeight, specularWeight, transmissionWeight, clearcoatWeight );
	result.direction = wi;
	result.clearcoatDirection = clearcoatWi;

	return result;

}
`}),parcelRequire.register("3DxO5",function(e,t){$parcel$export(e.exports,"shaderGGXFunctions",()=>i);let i=`
// The GGX functions provide sampling and distribution information for normals as output so
// in order to get probability of scatter direction the half vector must be computed and provided.
// [0] https://www.cs.cornell.edu/~srm/publications/EGSR07-btdf.pdf
// [1] https://hal.archives-ouvertes.fr/hal-01509746/document
// [2] http://jcgt.org/published/0007/04/01/
// [4] http://jcgt.org/published/0003/02/03/

// trowbridge-reitz === GGX === GTR

vec3 ggxDirection( vec3 incidentDir, float roughnessX, float roughnessY, float random1, float random2 ) {

	// TODO: try GGXVNDF implementation from reference [2], here. Needs to update ggxDistribution
	// function below, as well

	// Implementation from reference [1]
	// stretch view
	vec3 V = normalize( vec3( roughnessX * incidentDir.x, roughnessY * incidentDir.y, incidentDir.z ) );

	// orthonormal basis
	vec3 T1 = ( V.z < 0.9999 ) ? normalize( cross( V, vec3( 0.0, 0.0, 1.0 ) ) ) : vec3( 1.0, 0.0, 0.0 );
	vec3 T2 = cross( T1, V );

	// sample point with polar coordinates (r, phi)
	float a = 1.0 / ( 1.0 + V.z );
	float r = sqrt( random1 );
	float phi = ( random2 < a ) ? random2 / a * PI : PI + ( random2 - a ) / ( 1.0 - a ) * PI;
	float P1 = r * cos( phi );
	float P2 = r * sin( phi ) * ( ( random2 < a ) ? 1.0 : V.z );

	// compute normal
	vec3 N = P1 * T1 + P2 * T2 + V * sqrt( max( 0.0, 1.0 - P1 * P1 - P2 * P2 ) );

	// unstretch
	N = normalize( vec3( roughnessX * N.x, roughnessY * N.y, max( 0.0, N.z ) ) );

	return N;

}

// Below are PDF and related functions for use in a Monte Carlo path tracer
// as specified in Appendix B of the following paper
// See equation (34) from reference [0]
float ggxLamda( float theta, float roughness ) {

	float tanTheta = tan( theta );
	float tanTheta2 = tanTheta * tanTheta;
	float alpha2 = roughness * roughness;

	float numerator = - 1.0 + sqrt( 1.0 + alpha2 * tanTheta2 );
	return numerator / 2.0;

}

// See equation (34) from reference [0]
float ggxShadowMaskG1( float theta, float roughness ) {

	return 1.0 / ( 1.0 + ggxLamda( theta, roughness ) );

}

// See equation (125) from reference [4]
float ggxShadowMaskG2( vec3 wi, vec3 wo, float roughness ) {

	float incidentTheta = acos( wi.z );
	float scatterTheta = acos( wo.z );
	return 1.0 / ( 1.0 + ggxLamda( incidentTheta, roughness ) + ggxLamda( scatterTheta, roughness ) );

}

// See equation (33) from reference [0]
float ggxDistribution( vec3 halfVector, float roughness ) {

	float a2 = roughness * roughness;
	a2 = max( EPSILON, a2 );
	float cosTheta = halfVector.z;
	float cosTheta4 = pow( cosTheta, 4.0 );

	if ( cosTheta == 0.0 ) return 0.0;

	float theta = acosSafe( halfVector.z );
	float tanTheta = tan( theta );
	float tanTheta2 = pow( tanTheta, 2.0 );

	float denom = PI * cosTheta4 * pow( a2 + tanTheta2, 2.0 );
	return ( a2 / denom );

}

// See equation (3) from reference [2]
float ggxPDF( vec3 wi, vec3 halfVector, float roughness ) {

	float incidentTheta = acos( wi.z );
	float D = ggxDistribution( halfVector, roughness );
	float G1 = ggxShadowMaskG1( incidentTheta, roughness );

	return D * G1 * max( 0.0, dot( wi, halfVector ) ) / wi.z;

}
`}),parcelRequire.register("49T3W",function(e,t){$parcel$export(e.exports,"shaderSheenFunctions",()=>i);let i=`

// See equation (2) in http://www.aconty.com/pdf/s2017_pbs_imageworks_sheen.pdf
float velvetD( float cosThetaH, float roughness ) {

	float alpha = max( roughness, 0.07 );
	alpha = alpha * alpha;

	float invAlpha = 1.0 / alpha;

	float sqrCosThetaH = cosThetaH * cosThetaH;
	float sinThetaH = max( 1.0 - sqrCosThetaH, 0.001 );

	return ( 2.0 + invAlpha ) * pow( sinThetaH, 0.5 * invAlpha ) / ( 2.0 * PI );

}

float velvetParamsInterpolate( int i, float oneMinusAlphaSquared ) {

	const float p0[5] = float[5]( 25.3245, 3.32435, 0.16801, -1.27393, -4.85967 );
	const float p1[5] = float[5]( 21.5473, 3.82987, 0.19823, -1.97760, -4.32054 );

	return mix( p1[i], p0[i], oneMinusAlphaSquared );

}

float velvetL( float x, float alpha ) {

	float oneMinusAlpha = 1.0 - alpha;
	float oneMinusAlphaSquared = oneMinusAlpha * oneMinusAlpha;

	float a = velvetParamsInterpolate( 0, oneMinusAlphaSquared );
	float b = velvetParamsInterpolate( 1, oneMinusAlphaSquared );
	float c = velvetParamsInterpolate( 2, oneMinusAlphaSquared );
	float d = velvetParamsInterpolate( 3, oneMinusAlphaSquared );
	float e = velvetParamsInterpolate( 4, oneMinusAlphaSquared );

	return a / ( 1.0 + b * pow( abs( x ), c ) ) + d * x + e;

}

// See equation (3) in http://www.aconty.com/pdf/s2017_pbs_imageworks_sheen.pdf
float velvetLambda( float cosTheta, float alpha ) {

	return abs( cosTheta ) < 0.5 ? exp( velvetL( cosTheta, alpha ) ) : exp( 2.0 * velvetL( 0.5, alpha ) - velvetL( 1.0 - cosTheta, alpha ) );

}

// See Section 3, Shadowing Term, in http://www.aconty.com/pdf/s2017_pbs_imageworks_sheen.pdf
float velvetG( float cosThetaO, float cosThetaI, float roughness ) {

	float alpha = max( roughness, 0.07 );
	alpha = alpha * alpha;

	return 1.0 / ( 1.0 + velvetLambda( cosThetaO, alpha ) + velvetLambda( cosThetaI, alpha ) );

}

float directionalAlbedoSheen( float cosTheta, float alpha ) {

	cosTheta = saturate( cosTheta );

	float c = 1.0 - cosTheta;
	float c3 = c * c * c;

	return 0.65584461 * c3 + 1.0 / ( 4.16526551 + exp( -7.97291361 * sqrt( alpha ) + 6.33516894 ) );

}

float sheenAlbedoScaling( vec3 wo, vec3 wi, SurfaceRec surf ) {

	float alpha = max( surf.sheenRoughness, 0.07 );
	alpha = alpha * alpha;

	float maxSheenColor = max( max( surf.sheenColor.r, surf.sheenColor.g ), surf.sheenColor.b );

	float eWo = directionalAlbedoSheen( saturateCos( wo.z ), alpha );
	float eWi = directionalAlbedoSheen( saturateCos( wi.z ), alpha );

	return min( 1.0 - maxSheenColor * eWo, 1.0 - maxSheenColor * eWi );

}

// See Section 5, Layering, in http://www.aconty.com/pdf/s2017_pbs_imageworks_sheen.pdf
float sheenAlbedoScaling( vec3 wo, SurfaceRec surf ) {

	float alpha = max( surf.sheenRoughness, 0.07 );
	alpha = alpha * alpha;

	float maxSheenColor = max( max( surf.sheenColor.r, surf.sheenColor.g ), surf.sheenColor.b );

	float eWo = directionalAlbedoSheen( saturateCos( wo.z ), alpha );

	return 1.0 - maxSheenColor * eWo;

}

`}),parcelRequire.register("7hp2H",function(e,t){$parcel$export(e.exports,"shaderIridescenceFunctions",()=>i);let i=`

// XYZ to sRGB color space
const mat3 XYZ_TO_REC709 = mat3(
	 3.2404542, -0.9692660,  0.0556434,
	-1.5371385,  1.8760108, -0.2040259,
	-0.4985314,  0.0415560,  1.0572252
);

vec3 fresnel0ToIor( vec3 fresnel0 ) {

	vec3 sqrtF0 = sqrt( fresnel0 );
	return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );

}

// Conversion FO/IOR
vec3 iorToFresnel0( vec3 transmittedIor, float incidentIor ) {

	return square( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );

}

// ior is a value between 1.0 and 3.0. 1.0 is air interface
float iorToFresnel0( float transmittedIor, float incidentIor ) {

	return square( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ) );

}

// Fresnel equations for dielectric/dielectric interfaces. See https://belcour.github.io/blog/research/2017/05/01/brdf-thin-film.html
vec3 evalSensitivity( float OPD, vec3 shift ) {

	float phase = 2.0 * PI * OPD * 1.0e-9;

	vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
	vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
	vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );

	vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - square( phase ) * var );
	xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * square( phase ) );
	xyz /= 1.0685e-7;

	vec3 srgb = XYZ_TO_REC709 * xyz;
	return srgb;

}

// See Section 4. Analytic Spectral Integration, A Practical Extension to Microfacet Theory for the Modeling of Varying Iridescence, https://hal.archives-ouvertes.fr/hal-01518344/document
vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {

	vec3 I;

	// Force iridescenceIor -> outsideIOR when thinFilmThickness -> 0.0
	float iridescenceIor = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );

	// Evaluate the cosTheta on the base layer (Snell law)
	float sinTheta2Sq = square( outsideIOR / iridescenceIor ) * ( 1.0 - square( cosTheta1 ) );

	// Handle TIR:
	float cosTheta2Sq = 1.0 - sinTheta2Sq;
	if ( cosTheta2Sq < 0.0 ) {

		return vec3( 1.0 );

	}

	float cosTheta2 = sqrt( cosTheta2Sq );

	// First interface
	float R0 = iorToFresnel0( iridescenceIor, outsideIOR );
	float R12 = schlickFresnel( cosTheta1, R0 );
	float R21 = R12;
	float T121 = 1.0 - R12;
	float phi12 = 0.0;
	if ( iridescenceIor < outsideIOR ) {

		phi12 = PI;

	}
	float phi21 = PI - phi12;

	// Second interface
	vec3 baseIOR = fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) ); // guard against 1.0
	vec3 R1 = iorToFresnel0( baseIOR, iridescenceIor );
	vec3 R23 = schlickFresnel( cosTheta2, R1 );
	vec3 phi23 = vec3( 0.0 );
	if ( baseIOR[0] < iridescenceIor ) {

		phi23[ 0 ] = PI;

	}
	if ( baseIOR[1] < iridescenceIor ) {

		phi23[ 1 ] = PI;

	}
	if ( baseIOR[2] < iridescenceIor ) {

		phi23[ 2 ] = PI;

	}

	// Phase shift
	float OPD = 2.0 * iridescenceIor * thinFilmThickness * cosTheta2;
	vec3 phi = vec3( phi21 ) + phi23;

	// Compound terms
	vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
	vec3 r123 = sqrt( R123 );
	vec3 Rs = square( T121 ) * R23 / ( vec3( 1.0 ) - R123 );

	// Reflectance term for m = 0 (DC term amplitude)
	vec3 C0 = R12 + Rs;
	I = C0;

	// Reflectance term for m > 0 (pairs of diracs)
	vec3 Cm = Rs - T121;
	for ( int m = 1; m <= 2; ++ m )
	{
		Cm *= r123;
		vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
		I += Cm * Sm;
	}

	// Since out of gamut colors might be produced, negative color values are clamped to 0.
	return max( I, vec3( 0.0 ) );
}

`}),parcelRequire.register("dbKnp",function(e,t){$parcel$export(e.exports,"shaderEnvMapSampling",()=>i);let i=`

vec3 sampleEquirectEnvMapColor( vec3 direction, sampler2D map ) {

	return texture2D( map, equirectDirectionToUv( direction ) ).rgb;

}

float envMapDirectionPdf( vec3 direction ) {

	vec2 uv = equirectDirectionToUv( direction );
	float theta = uv.y * PI;
	float sinTheta = sin( theta );
	if ( sinTheta == 0.0 ) {

		return 0.0;

	}

	return 1.0 / ( 2.0 * PI * PI * sinTheta );

}

float envMapSample( vec3 direction, EquirectHdrInfo info, out vec3 color ) {

	vec2 uv = equirectDirectionToUv( direction );
	color = texture2D( info.map, uv ).rgb;

	float totalSum = info.totalSumWhole + info.totalSumDecimal;
	float lum = colorToLuminance( color );
	ivec2 resolution = textureSize( info.map, 0 );
	float pdf = lum / totalSum;

	return float( resolution.x * resolution.y ) * pdf * envMapDirectionPdf( direction );

}

float randomEnvMapSample( EquirectHdrInfo info, out vec3 color, out vec3 direction ) {

	// sample env map cdf
	vec2 r = rand2();
	float v = texture2D( info.marginalWeights, vec2( r.x, 0.0 ) ).x;
	float u = texture2D( info.conditionalWeights, vec2( r.y, v ) ).x;
	vec2 uv = vec2( u, v );

	vec3 derivedDirection = equirectUvToDirection( uv );
	direction = derivedDirection;
	color = texture2D( info.map, uv ).rgb;

	float totalSum = info.totalSumWhole + info.totalSumDecimal;
	float lum = colorToLuminance( color );
	ivec2 resolution = textureSize( info.map, 0 );
	float pdf = lum / totalSum;

	return float( resolution.x * resolution.y ) * pdf * envMapDirectionPdf( direction );

}

`}),parcelRequire.register("gGzlF",function(e,t){$parcel$export(e.exports,"shaderLightSampling",()=>i);let i=`

float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {

	return smoothstep( coneCosine, penumbraCosine, angleCosine );

}

float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {

	// based upon Frostbite 3 Moving to Physically-based Rendering
	// page 32, equation 26: E[window1]
	// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), EPSILON );

	if ( cutoffDistance > 0.0 ) {

		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );

	}

	return distanceFalloff;

}

float getPhotometricAttenuation( sampler2DArray iesProfiles, int iesProfile, vec3 posToLight, vec3 lightDir, vec3 u, vec3 v ) {

    float cosTheta = dot( posToLight, lightDir );
    float angle = acos( cosTheta ) * ( 1.0 / PI );

    return texture2D( iesProfiles, vec3( 0.0, angle, iesProfile ) ).r;

}

struct LightSampleRec {

	bool hit;
	float dist;
	vec3 direction;
	float pdf;
	vec3 emission;
	int type;

};

LightSampleRec lightsClosestHit( sampler2D lights, uint lightCount, vec3 rayOrigin, vec3 rayDirection ) {

	LightSampleRec lightSampleRec;
	lightSampleRec.hit = false;

	uint l;
	for ( l = 0u; l < lightCount; l ++ ) {

		Light light = readLightInfo( lights, l );

		vec3 u = light.u;
		vec3 v = light.v;

		// check for backface
		vec3 normal = normalize( cross( u, v ) );
		if ( dot( normal, rayDirection ) < 0.0 ) {
			continue;
		}

		u *= 1.0 / dot( u, u );
		v *= 1.0 / dot( v, v );

		float dist;

		if(
			( light.type == RECT_AREA_LIGHT_TYPE && intersectsRectangle( light.position, normal, u, v, rayOrigin, rayDirection, dist ) ) ||
			( light.type == CIRC_AREA_LIGHT_TYPE && intersectsCircle( light.position, normal, u, v, rayOrigin, rayDirection, dist ) )
		) {

			if ( dist < lightSampleRec.dist || ! lightSampleRec.hit ) {

				float cosTheta = dot( rayDirection, normal );

				lightSampleRec.hit = true;
				lightSampleRec.dist = dist;
				lightSampleRec.pdf = ( dist * dist ) / ( light.area * cosTheta );
				lightSampleRec.emission = light.color * light.intensity;
				lightSampleRec.direction = rayDirection;
				lightSampleRec.type = light.type;

			}

		} else if ( light.type == SPOT_LIGHT_TYPE ) {

			// TODO: forward path tracing sampling needs to be made consistent with direct light sampling logic
			// float radius = light.radius;
			// vec3 lightNormal = normalize( cross( light.u, light.v ) );
			// float angle = acos( light.coneCos );
			// float angleTan = tan( angle );
			// float startDistance = radius / max( angleTan, EPSILON );

			// u = light.u / radius;
			// v = light.v / radius;

			// if (
			// 	intersectsCircle( light.position - normal * startDistance, normal, u, v, rayOrigin, rayDirection, dist ) &&
			// 	( dist < lightSampleRec.dist || ! lightSampleRec.hit )
			// ) {

			// 	float cosTheta = dot( rayDirection, normal );
			// 	float spotAttenuation = light.iesProfile != - 1 ?
			// 		getPhotometricAttenuation( iesProfiles, light.iesProfile, rayDirection, normal, u, v )
			// 		: getSpotAttenuation( light.coneCos, light.penumbraCos, cosTheta );

			// 	float distanceAttenuation = getDistanceAttenuation( dist, light.distance, light.decay );

			// 	lightSampleRec.hit = true;
			// 	lightSampleRec.dist = dist;
			// 	lightSampleRec.direction = rayDirection;
			// 	lightSampleRec.emission = light.color * light.intensity * distanceAttenuation * spotAttenuation;
			// 	lightSampleRec.pdf = ( dist * dist ) / ( light.area * cosTheta );

			// }

		}

	}

	return lightSampleRec;

}

LightSampleRec randomAreaLightSample( Light light, vec3 rayOrigin ) {

	LightSampleRec lightSampleRec;
	lightSampleRec.hit = true;
	lightSampleRec.type = light.type;

	lightSampleRec.emission = light.color * light.intensity;

	vec3 randomPos;
	if( light.type == RECT_AREA_LIGHT_TYPE ) {

		// rectangular area light
		randomPos = light.position + light.u * ( rand() - 0.5 ) + light.v * ( rand() - 0.5 );

	} else if( light.type == 1 ) {

		// circular area light
		float r = 0.5 * sqrt( rand() );
		float theta = rand() * 2.0 * PI;
		float x = r * cos( theta );
		float y = r * sin( theta );

		randomPos = light.position + light.u * x + light.v * y;

	}

	vec3 toLight = randomPos - rayOrigin;
	float lightDistSq = dot( toLight, toLight );
	lightSampleRec.dist = sqrt( lightDistSq );

	vec3 direction = toLight / lightSampleRec.dist;
	lightSampleRec.direction = direction;

	vec3 lightNormal = normalize( cross( light.u, light.v ) );
	lightSampleRec.pdf = lightDistSq / ( light.area * dot( direction, lightNormal ) );

	return lightSampleRec;

}

LightSampleRec randomSpotLightSample( Light light, sampler2DArray iesProfiles, vec3 rayOrigin ) {

	float radius = light.radius * sqrt( rand() );
	float theta = rand() * 2.0 * PI;
	float x = radius * cos( theta );
	float y = radius * sin( theta );

	vec3 u = light.u;
	vec3 v = light.v;
	vec3 normal = normalize( cross( u, v ) );

	float angle = acos( light.coneCos );
	float angleTan = tan( angle );
	float startDistance = light.radius / max( angleTan, EPSILON );

	vec3 randomPos = light.position - normal * startDistance + u * x + v * y;
	vec3 toLight = randomPos - rayOrigin;
	float lightDistSq = dot( toLight, toLight );
	float dist = sqrt( lightDistSq );

	vec3 direction = toLight / max( dist, EPSILON );
	float cosTheta = dot( direction, normal );

	float spotAttenuation = light.iesProfile != - 1 ?
		  getPhotometricAttenuation( iesProfiles, light.iesProfile, direction, normal, u, v )
		: getSpotAttenuation( light.coneCos, light.penumbraCos, cosTheta );

	float distanceAttenuation = getDistanceAttenuation( dist, light.distance, light.decay );
	LightSampleRec lightSampleRec;
	lightSampleRec.hit = true;
	lightSampleRec.type = light.type;
	lightSampleRec.dist = dist;
	lightSampleRec.direction = direction;
	lightSampleRec.emission = light.color * light.intensity * distanceAttenuation * spotAttenuation;

	// TODO: this makes the result consistent between MIS and non MIS paths but at radius 0 the pdf is infinite
	// and the intensity of the light is not correct
	lightSampleRec.pdf = 1.0;
	// lightSampleRec.pdf = lightDistSq / ( light.area * cosTheta );

	return lightSampleRec;

}

LightSampleRec randomLightSample( sampler2D lights, sampler2DArray iesProfiles, uint lightCount, vec3 rayOrigin ) {

	// pick a random light
	uint l = uint( rand() * float( lightCount ) );
	Light light = readLightInfo( lights, l );

	if ( light.type == SPOT_LIGHT_TYPE ) {

		return randomSpotLightSample( light, iesProfiles, rayOrigin );

	} else {

		// sample the light
		return randomAreaLightSample( light, rayOrigin );

	}

}

`}),parcelRequire.register("g7oWa",function(e,t){$parcel$export(e.exports,"PhysicalCameraUniform",()=>r);var i=parcelRequire("eeDSQ");class r{constructor(){this.bokehSize=0,this.apertureBlades=0,this.apertureRotation=0,this.focusDistance=10,this.anamorphicRatio=1}updateFrom(e){e instanceof i.PhysicalCamera?(this.bokehSize=e.bokehSize,this.apertureBlades=e.apertureBlades,this.apertureRotation=e.apertureRotation,this.focusDistance=e.focusDistance,this.anamorphicRatio=e.anamorphicRatio):(this.bokehSize=0,this.apertureRotation=0,this.apertureBlades=0,this.focusDistance=10,this.anamorphicRatio=1)}}}),parcelRequire.register("eeDSQ",function(e,t){$parcel$export(e.exports,"PhysicalCamera",()=>r);var i=parcelRequire("4xklQ");class r extends i.PerspectiveCamera{set bokehSize(e){this.fStop=this.getFocalLength()/e}get bokehSize(){return this.getFocalLength()/this.fStop}constructor(...e){super(...e),this.fStop=1.4,this.apertureBlades=0,this.apertureRotation=0,this.focusDistance=25,this.anamorphicRatio=1}}}),parcelRequire.register("7xwJT",function(e,t){$parcel$export(e.exports,"EquirectHdrInfoUniform",()=>a);var i=parcelRequire("4xklQ");function r(e,t,i=0,r=e.length){let n=0,o=r;for(;n<o;){let r=~~(.5*o+.5*n);e[i+r]<t?n=r+1:o=r}return n}function n(e,t,i){return .2126*e+.7152*t+.0722*i}function o(e){let t=e.clone();t.source=new i.Source({...t.image});let{width:r,height:n,data:o}=t.image,a=o;if(t.type===i.HalfFloatType){for(let e in a=new Float32Array(o.length),o)a[e]=(0,i.DataUtils).fromHalfFloat(o[e]);t.image.data=a,t.type=i.FloatType}if(t.flipY){let e=a;a=a.slice();for(let t=0;t<n;t++)for(let i=0;i<r;i++){let o=n-t-1,s=4*(t*r+i),l=4*(o*r+i);a[l+0]=e[s+0],a[l+1]=e[s+1],a[l+2]=e[s+2],a[l+3]=e[s+3]}t.flipY=!1,t.image.data=a}return t}class a{constructor(){let e=new i.DataTexture;e.type=i.FloatType,e.format=i.RedFormat,e.minFilter=i.LinearFilter,e.magFilter=i.LinearFilter,e.generateMipmaps=!1;let t=new i.DataTexture;t.type=i.FloatType,t.format=i.RedFormat,t.minFilter=i.LinearFilter,t.magFilter=i.LinearFilter,t.generateMipmaps=!1,this.marginalWeights=e,this.conditionalWeights=t,this.map=null,this.totalSumWhole=0,this.totalSumDecimal=0}dispose(){this.marginalWeights.dispose(),this.conditionalWeights.dispose(),this.map&&this.map.dispose()}updateFrom(e){let t=o(e);t.wrapS=i.RepeatWrapping,t.wrapT=i.RepeatWrapping;let{width:a,height:s,data:l}=t.image,h=new Float32Array(a*s),c=new Float32Array(a*s),d=new Float32Array(s),u=new Float32Array(s),p=0,m=0;for(let e=0;e<s;e++){let t=0;for(let i=0;i<a;i++){let r=e*a+i,o=l[4*r+0],s=l[4*r+1],d=l[4*r+2],u=n(o,s,d);t+=u,p+=u,h[r]=u,c[r]=t}if(0!==t)for(let i=e*a,r=e*a+a;i<r;i++)h[i]/=t,c[i]/=t;m+=t,d[e]=t,u[e]=m}if(0!==m)for(let e=0,t=d.length;e<t;e++)d[e]/=m,u[e]/=m;let f=new Float32Array(s),g=new Float32Array(a*s);for(let e=0;e<s;e++){let t=(e+1)/s,i=r(u,t);f[e]=i/s}for(let e=0;e<s;e++)for(let t=0;t<a;t++){let i=e*a+t,n=(t+1)/a,o=r(c,n,e*a,a);g[i]=o/a}this.dispose();let{marginalWeights:y,conditionalWeights:x}=this;y.image={width:s,height:1,data:f},y.needsUpdate=!0,x.image={width:a,height:s,data:g},x.needsUpdate=!0;let w=~~p,b=p-w;this.totalSumWhole=w,this.totalSumDecimal=b,this.map=t}}}),parcelRequire.register("3Rd4a",function(e,t){$parcel$export(e.exports,"LightsInfoUniformStruct",()=>s);var i=parcelRequire("4xklQ");let r=6,n=0,o=1,a=2;class s{constructor(){let e=new i.DataTexture(new Float32Array(4),1,1);e.format=i.RGBAFormat,e.type=i.FloatType,e.wrapS=i.ClampToEdgeWrapping,e.wrapT=i.ClampToEdgeWrapping,e.generateMipmaps=!1,this.tex=e,this.count=0}updateFrom(e,t=[]){let s=this.tex,l=Math.max(e.length*r,1),h=Math.ceil(Math.sqrt(l));s.image.width!==h&&(s.dispose(),s.image.data=new Float32Array(h*h*4),s.image.width=h,s.image.height=h);let c=s.image.data,d=new i.Vector3,u=new i.Vector3,p=new i.Matrix4,m=new i.Quaternion,f=new i.Vector3,g=new i.Vector3,y=new i.Vector3;for(let i=0,s=e.length;i<s;i++){let s=e[i],l=i*r*4,h=0;s.getWorldPosition(u),c[l+h++]=u.x,c[l+h++]=u.y,c[l+h++]=u.z;let x=n;if(s.isRectAreaLight&&s.isCircular?x=o:s.isSpotLight&&(x=a),c[l+h++]=x,c[l+h++]=s.color.r,c[l+h++]=s.color.g,c[l+h++]=s.color.b,c[l+h++]=s.intensity,s.getWorldQuaternion(m),s.isRectAreaLight)d.set(s.width,0,0).applyQuaternion(m),c[l+h++]=d.x,c[l+h++]=d.y,c[l+h++]=d.z,h++,u.set(0,s.height,0).applyQuaternion(m),c[l+h++]=u.x,c[l+h++]=u.y,c[l+h++]=u.z,c[l+h++]=d.cross(u).length()*(s.isCircular?Math.PI/4:1);else if(s.isSpotLight){let e=s.radius;f.setFromMatrixPosition(s.matrixWorld),g.setFromMatrixPosition(s.target.matrixWorld),p.lookAt(f,g,y),m.setFromRotationMatrix(p),d.set(1,0,0).applyQuaternion(m),c[l+h++]=d.x,c[l+h++]=d.y,c[l+h++]=d.z,h++,u.set(0,1,0).applyQuaternion(m),c[l+h++]=u.x,c[l+h++]=u.y,c[l+h++]=u.z,c[l+h++]=Math.PI*e*e,c[l+h++]=e,c[l+h++]=s.shadow.camera.near,c[l+h++]=s.decay,c[l+h++]=s.distance,c[l+h++]=Math.cos(s.angle),c[l+h++]=Math.cos(s.angle*(1-s.penumbra)),c[l+h++]=t.indexOf(s.iesTexture)}}s.needsUpdate=!0,this.count=e.length}}}),parcelRequire.register("jHXX6",function(e,t){$parcel$export(e.exports,"IESProfilesTexture",()=>a);var i=parcelRequire("4xklQ"),r=parcelRequire("yHpto"),n=parcelRequire("f6my6");let o=new i.Color;class a extends i.WebGLArrayRenderTarget{constructor(...e){super(...e);let t=this.texture;t.format=i.RGBAFormat,t.type=i.FloatType,t.minFilter=i.LinearFilter,t.magFilter=i.LinearFilter,t.wrapS=i.ClampToEdgeWrapping,t.wrapT=i.ClampToEdgeWrapping,t.generateMipmaps=!1,t.updateFrom=(...e)=>{this.updateFrom(...e)};let o=new r.FullScreenQuad(new i.MeshBasicMaterial);this.fsQuad=o,this.iesLoader=new n.IESLoader}async updateFrom(e,t){let r=e.getRenderTarget(),n=e.toneMapping,a=e.getClearAlpha();e.getClearColor(o);let s=t.length||1;this.setSize(360,180,s),e.setClearColor(0,0),e.toneMapping=i.NoToneMapping;let l=this.fsQuad;for(let i=0,r=s;i<r;i++){let r=t[i];r&&(r.matrixAutoUpdate=!1,r.matrix.identity(),l.material.map=r,l.material.transparent=!0,e.setRenderTarget(this,i),l.render(e),r.updateMatrix(),r.matrixAutoUpdate=!0)}l.material.map=null,e.setClearColor(o,a),e.setRenderTarget(r),e.toneMapping=n,l.dispose()}dispose(){super.dispose(),this.fsQuad.dispose()}}}),parcelRequire.register("f6my6",function(e,t){$parcel$export(e.exports,"IESLoader",()=>n);var i=parcelRequire("4xklQ");function r(e){let t;let i=this,r=e.split("\n"),n=0;function o(e){e=(e=(e=e.replace(/^\s+|\s+$/g,"")).replace(/,/g," ")).replace(/\s\s+/g," ");let t=e.split(" ");return t}function a(e,t){for(;;){let i=r[n++],a=o(i);for(let e=0;e<a.length;++e)t.push(Number(a[e]));if(t.length===e)break}}function s(){let e=r[n++],t=o(e);i.tiltData.lampToLumGeometry=Number(t[0]),t=o(e=r[n++]),i.tiltData.numAngles=Number(t[0]),a(i.tiltData.numAngles,i.tiltData.angles),a(i.tiltData.numAngles,i.tiltData.mulFactors)}function l(){let e=[];a(10,e),i.count=Number(e[0]),i.lumens=Number(e[1]),i.multiplier=Number(e[2]),i.numVerAngles=Number(e[3]),i.numHorAngles=Number(e[4]),i.gonioType=Number(e[5]),i.units=Number(e[6]),i.width=Number(e[7]),i.length=Number(e[8]),i.height=Number(e[9])}function h(){let e=[];a(3,e),i.ballFactor=Number(e[0]),i.blpFactor=Number(e[1]),i.inputWatts=Number(e[2])}for(i.verAngles=[],i.horAngles=[],i.candelaValues=[],i.tiltData={},i.tiltData.angles=[],i.tiltData.mulFactors=[];!(t=r[n++]).includes("TILT"););!t.includes("NONE")&&t.includes("INCLUDE")&&s(),l(),h();for(let e=0;e<i.numHorAngles;++e)i.candelaValues.push([]);a(i.numVerAngles,i.verAngles),a(i.numHorAngles,i.horAngles);for(let e=0;e<i.numHorAngles;++e)a(i.numVerAngles,i.candelaValues[e]);for(let e=0;e<i.numHorAngles;++e)for(let t=0;t<i.numVerAngles;++t)i.candelaValues[e][t]*=i.candelaValues[e][t]*i.multiplier*i.ballFactor*i.blpFactor;let c=-1;for(let e=0;e<i.numHorAngles;++e)for(let t=0;t<i.numVerAngles;++t){let r=i.candelaValues[e][t];c=c<r?r:c}let d=!0;if(d&&c>0)for(let e=0;e<i.numHorAngles;++e)for(let t=0;t<i.numVerAngles;++t)i.candelaValues[e][t]/=c}class n extends i.Loader{_getIESValues(e){let t=360,r=180,n=t*r,o=new Float32Array(n);function a(t,r){let n=0,o=0,a=0,s=0,l=0,h=0;for(let t=0;t<e.numHorAngles-1;++t)if(r<e.horAngles[t+1]||t==e.numHorAngles-2){o=t,a=e.horAngles[t],s=e.horAngles[t+1];break}for(let i=0;i<e.numVerAngles-1;++i)if(t<e.verAngles[i+1]||i==e.numVerAngles-2){n=i,l=e.verAngles[i],h=e.verAngles[i+1];break}let c=s-a,d=h-l;if(0===d)return 0;let u=0===c?0:(r-a)/c,p=(t-l)/d,m=0===c?o:o+1,f=(0,i.MathUtils).lerp(e.candelaValues[o][n],e.candelaValues[m][n],u),g=(0,i.MathUtils).lerp(e.candelaValues[o][n+1],e.candelaValues[m][n+1],u),y=(0,i.MathUtils).lerp(f,g,p);return y}let s=e.horAngles[0],l=e.horAngles[e.numHorAngles-1];for(let e=0;e<n;++e){let i=e%t,r=Math.floor(e/t);l-s!=0&&(i<s||i>=l)&&(i%=2*l)>l&&(i=2*l-i),o[e]=a(r,i)}return o}load(e,t,n,o){let a=new i.FileLoader(this.manager);a.setResponseType("text"),a.setCrossOrigin(this.crossOrigin),a.setWithCredentials(this.withCredentials),a.setPath(this.path),a.setRequestHeader(this.requestHeader);let s=new i.DataTexture(null,360,180,i.RedFormat,i.FloatType);return s.minFilter=i.LinearFilter,s.magFilter=i.LinearFilter,a.load(e,e=>{let i=new r(e);s.image.data=this._getIESValues(i),s.needsUpdate=!0,void 0!==t&&t(s)},n,o),s}parse(e){let t=new r(e),n=new i.DataTexture(null,360,180,i.RedFormat,i.FloatType);return n.minFilter=i.LinearFilter,n.magFilter=i.LinearFilter,n.image.data=this._getIESValues(t),n.needsUpdate=!0,n}}}),parcelRequire.register("awRkS",function(e,t){$parcel$export(e.exports,"RGBELoader",()=>r);var i=parcelRequire("4xklQ");class r extends i.DataTextureLoader{constructor(e){super(e),this.type=i.HalfFloatType}parse(e){let t=-1,r=1,n=2,o=3,a=4,s=function(e,i){switch(e){case r:console.error("THREE.RGBELoader Read Error: "+(i||""));break;case n:console.error("THREE.RGBELoader Write Error: "+(i||""));break;case o:console.error("THREE.RGBELoader Bad File Format: "+(i||""));break;default:console.error("THREE.RGBELoader: Error: "+(i||""))}return t},l=1,h=2,c=4,d="\n",u=function(e,t,i){let r=128;t=t||1024;let n=e.pos,o=-1,a=0,s="",l=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+r)));for(;0>(o=l.indexOf(d))&&a<t&&n<e.byteLength;)s+=l,a+=l.length,n+=r,l+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+r)));return -1<o&&(!1!==i&&(e.pos+=a+o+1),s+l.slice(0,o))},p=function(e){let t,i;let n=/^#\?(\S+)/,a=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,d=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,p=/^\s*FORMAT=(\S+)\s*$/,m=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,f={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(t=u(e)))return s(r,"no header found");if(!(i=t.match(n)))return s(o,"bad initial token");for(f.valid|=l,f.programtype=i[1],f.string+=t+"\n";!1!==(t=u(e));){if(f.string+=t+"\n","#"===t.charAt(0)){f.comments+=t+"\n";continue}if((i=t.match(a))&&(f.gamma=parseFloat(i[1])),(i=t.match(d))&&(f.exposure=parseFloat(i[1])),(i=t.match(p))&&(f.valid|=h,f.format=i[1]),(i=t.match(m))&&(f.valid|=c,f.height=parseInt(i[1],10),f.width=parseInt(i[2],10)),f.valid&h&&f.valid&c)break}return f.valid&h?f.valid&c?f:s(o,"missing image size specifier"):s(o,"missing format specifier")},m=function(e,t,i){let n=t;if(n<8||n>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(n!==(e[2]<<8|e[3]))return s(o,"wrong scanline width");let l=new Uint8Array(4*t*i);if(!l.length)return s(a,"unable to allocate buffer space");let h=0,c=0,d=4*n,u=new Uint8Array(4),p=new Uint8Array(d),m=i;for(;m>0&&c<e.byteLength;){if(c+4>e.byteLength)return s(r);if(u[0]=e[c++],u[1]=e[c++],u[2]=e[c++],u[3]=e[c++],2!=u[0]||2!=u[1]||(u[2]<<8|u[3])!=n)return s(o,"bad rgbe scanline format");let t=0,i;for(;t<d&&c<e.byteLength;){i=e[c++];let r=i>128;if(r&&(i-=128),0===i||t+i>d)return s(o,"bad scanline data");if(r){let r=e[c++];for(let e=0;e<i;e++)p[t++]=r}else p.set(e.subarray(c,c+i),t),t+=i,c+=i}let a=n;for(let e=0;e<a;e++){let t=0;l[h]=p[e+t],t+=n,l[h+1]=p[e+t],t+=n,l[h+2]=p[e+t],t+=n,l[h+3]=p[e+t],h+=4}m--}return l},f=function(e,t,i,r){let n=e[t+3],o=Math.pow(2,n-128)/255;i[r+0]=e[t+0]*o,i[r+1]=e[t+1]*o,i[r+2]=e[t+2]*o,i[r+3]=1},g=function(e,t,r,n){let o=e[t+3],a=Math.pow(2,o-128)/255;r[n+0]=(0,i.DataUtils).toHalfFloat(Math.min(e[t+0]*a,65504)),r[n+1]=(0,i.DataUtils).toHalfFloat(Math.min(e[t+1]*a,65504)),r[n+2]=(0,i.DataUtils).toHalfFloat(Math.min(e[t+2]*a,65504)),r[n+3]=(0,i.DataUtils).toHalfFloat(1)},y=new Uint8Array(e);y.pos=0;let x=p(y);if(t!==x){let e=x.width,r=x.height,n=m(y.subarray(y.pos),e,r);if(t!==n){let t,o,a;switch(this.type){case i.FloatType:a=n.length/4;let s=new Float32Array(4*a);for(let e=0;e<a;e++)f(n,4*e,s,4*e);t=s,o=i.FloatType;break;case i.HalfFloatType:a=n.length/4;let l=new Uint16Array(4*a);for(let e=0;e<a;e++)g(n,4*e,l,4*e);t=l,o=i.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:e,height:r,data:t,header:x.string,gamma:x.gamma,exposure:x.exposure,type:o}}}return null}setDataType(e){return this.type=e,this}load(e,t,r,n){function o(e,r){switch(e.type){case i.FloatType:case i.HalfFloatType:e.encoding=i.LinearEncoding,e.minFilter=i.LinearFilter,e.magFilter=i.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)}return super.load(e,o,r,n)}}}),parcelRequire.register("d14eh",function(e,t){$parcel$export(e.exports,"MeshoptDecoder",()=>i);var i=function(){var e,t="b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",i="b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb",r=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),n=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if("object"!=typeof WebAssembly)return{supported:!1};var o=WebAssembly.validate(r)?i:t,a=WebAssembly.instantiate(s(o),{}).then(function(t){(e=t.instance).exports.__wasm_call_ctors()});function s(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;++i){var r=e.charCodeAt(i);t[i]=r>96?r-97:r>64?r-39:r+4}for(var o=0,i=0;i<e.length;++i)t[o++]=t[i]<60?n[t[i]]:(t[i]-60)*64+t[++i];return t.buffer.slice(0,o)}function l(t,i,r,n,o,a){var s=e.exports.sbrk,l=r+3&-4,h=s(l*n),c=s(o.length),d=new Uint8Array(e.exports.memory.buffer);d.set(o,c);var u=t(h,r,n,c,o.length);if(0==u&&a&&a(h,l,n),i.set(d.subarray(h,h+r*n)),s(h-s(0)),0!=u)throw Error("Malformed buffer data: "+u)}var h={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},c={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},d=[],u=0;function p(e){var t={object:new Worker(e),pending:0,requests:{}};return t.object.onmessage=function(e){var i=e.data;t.pending-=i.count,t.requests[i.id][i.action](i.value),delete t.requests[i.id]},t}function m(e){for(var t="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(s(o))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+l.toString()+g.toString(),i=new Blob([t],{type:"text/javascript"}),r=URL.createObjectURL(i),n=0;n<e;++n)d[n]=p(r);URL.revokeObjectURL(r)}function f(e,t,i,r,n){for(var o=d[0],a=1;a<d.length;++a)d[a].pending<o.pending&&(o=d[a]);return new Promise(function(a,s){var l=new Uint8Array(i),h=u++;o.pending+=e,o.requests[h]={resolve:a,reject:s},o.object.postMessage({id:h,count:e,size:t,source:l,mode:r,filter:n},[l.buffer])})}function g(t){a.then(function(){var i=t.data;try{var r=new Uint8Array(i.count*i.size);l(e.exports[i.mode],r,i.count,i.size,i.source,e.exports[i.filter]),self.postMessage({id:i.id,count:i.count,action:"resolve",value:r},[r.buffer])}catch(e){self.postMessage({id:i.id,count:i.count,action:"reject",value:e})}})}return{ready:a,supported:!0,useWorkers:function(e){m(e)},decodeVertexBuffer:function(t,i,r,n,o){l(e.exports.meshopt_decodeVertexBuffer,t,i,r,n,e.exports[h[o]])},decodeIndexBuffer:function(t,i,r,n){l(e.exports.meshopt_decodeIndexBuffer,t,i,r,n)},decodeIndexSequence:function(t,i,r,n){l(e.exports.meshopt_decodeIndexSequence,t,i,r,n)},decodeGltfBuffer:function(t,i,r,n,o,a){l(e.exports[c[o]],t,i,r,n,e.exports[h[a]])},decodeGltfBufferAsync:function(t,i,r,n,o){return d.length>0?f(t,i,r,c[n],h[o]):a.then(function(){var a=new Uint8Array(t*i);return l(e.exports[c[n]],a,t,i,r,e.exports[h[o]]),a})}}}()}),parcelRequire.register("8S9CF",function(e,t){$parcel$export(e.exports,"PathTracingSceneWorker",()=>o);var i=parcelRequire("kstDR"),r=parcelRequire("ckwVR"),n=parcelRequire("gLAEi");class o extends i.PathTracingSceneGenerator{constructor(){super(),this.bvhGenerator=new n.GenerateMeshBVHWorker}generate(e,t={}){let{bvhGenerator:i}=this,{geometry:n,materials:o,textures:a,lights:s,spotLights:l}=this.prepScene(e),h={strategy:r.SAH,...t,maxLeafTris:1},c=i.generate(n,h);return c.then(t=>({scene:e,materials:o,textures:a,lights:s,spotLights:l,bvh:t}))}dispose(){this.bvhGenerator.dispose()}}}),parcelRequire.register("kstDR",function(e,t){$parcel$export(e.exports,"PathTracingSceneGenerator",()=>s);var i=parcelRequire("4xklQ"),r=parcelRequire("1DCdP"),n=parcelRequire("ckwVR"),o=parcelRequire("8NtlR"),a=parcelRequire("bovSc");class s{prepScene(e){e=Array.isArray(e)?e:[e];let t=[],r=[];for(let n=0,a=e.length;n<a;n++)e[n].traverse(e=>{if(e.isSkinnedMesh||e.isMesh&&e.morphTargetInfluences){let r=new o.StaticGeometryGenerator(e);r.attributes=["position","color","normal","tangent","uv","uv2"],r.applyWorldTransforms=!1;let n=new i.Mesh(r.generate(),e.material);n.matrixWorld.copy(e.matrixWorld),n.matrix.copy(e.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale),t.push(n)}else e.isMesh?t.push(e):(e.isRectAreaLight||e.isSpotLight)&&r.push(e)});return{...(0,a.mergeMeshes)(t,{attributes:["position","normal","tangent","uv","color"]}),lights:r}}generate(e,t={}){let{materials:i,textures:o,geometry:a,lights:s}=this.prepScene(e),l={strategy:n.SAH,...t,maxLeafTris:1};return{scene:e,materials:i,textures:o,lights:s,bvh:new r.MeshBVH(a,l)}}}}),parcelRequire.register("8NtlR",function(e,t){$parcel$export(e.exports,"StaticGeometryGenerator",()=>M);var i=parcelRequire("4xklQ");let r=new i.Vector3,n=new i.Vector3,o=new i.Vector3,a=new i.Vector4,s=new i.Vector3,l=new i.Vector3,h=new i.Vector4,c=new i.Vector4,d=new i.Matrix4,u=new i.Matrix4;function p(e,t){if(!e&&!t)return;let i=e.count===t.count,r=e.normalized===t.normalized,n=e.array.constructor===t.array.constructor,o=e.itemSize===t.itemSize;if(!i||!r||!n||!o)throw Error()}function m(e,t=null){let r=e.array.constructor,n=e.normalized,o=e.itemSize,a=null===t?e.count:t;return new i.BufferAttribute(new r(o*a),o,n)}function f(e,t,i=0){if(e.isInterleavedBufferAttribute){let r=e.itemSize;for(let n=0,o=e.count;n<o;n++){let o=n+i;t.setX(o,e.getX(n)),r>=2&&t.setY(o,e.getY(n)),r>=3&&t.setZ(o,e.getZ(n)),r>=4&&t.setW(o,e.getW(n))}}else{let r=t.array,n=r.constructor,o=r.BYTES_PER_ELEMENT*e.itemSize*i,a=new n(r.buffer,o,e.array.length);a.set(e.array)}}function g(e,t,i){let r=e.elements,n=t.elements;for(let e=0,t=n.length;e<t;e++)r[e]+=n[e]*i}function y(e,t,i){let r=e.skeleton,n=e.geometry,o=r.bones,a=r.boneInverses;h.fromBufferAttribute(n.attributes.skinIndex,t),c.fromBufferAttribute(n.attributes.skinWeight,t),d.elements.fill(0);for(let e=0;e<4;e++){let t=c.getComponent(e);if(0!==t){let i=h.getComponent(e);u.multiplyMatrices(o[i].matrixWorld,a[i]),g(d,u,t)}}return d.multiply(e.bindMatrix).premultiply(e.bindMatrixInverse),i.transformDirection(d),i}function x(e,t,i,r,n){s.set(0,0,0);for(let o=0,a=e.length;o<a;o++){let a=t[o],h=e[o];0!==a&&(l.fromBufferAttribute(h,r),i?s.addScaledVector(l,a):s.addScaledVector(l.sub(n),a))}n.add(s)}function w(e,t={useGroups:!1,updateIndex:!1,skipAttributes:[]},r=new i.BufferGeometry){let n=null!==e[0].index,{useGroups:o=!1,updateIndex:a=!1,skipAttributes:s=[]}=t,l=new Set(Object.keys(e[0].attributes)),h={},c=0;r.clearGroups();for(let t=0;t<e.length;++t){let i=e[t],a=0;if(n!==(null!==i.index))throw Error("StaticGeometryGenerator: All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them.");for(let e in i.attributes){if(!l.has(e))throw Error('StaticGeometryGenerator: All geometries must have compatible attributes; make sure "'+e+'" attribute exists among all geometries, or in none of them.');void 0===h[e]&&(h[e]=[]),h[e].push(i.attributes[e]),a++}if(a!==l.size)throw Error("StaticGeometryGenerator: Make sure all geometries have the same number of attributes.");if(o){let e;if(n)e=i.index.count;else if(void 0!==i.attributes.position)e=i.attributes.position.count;else throw Error("StaticGeometryGenerator: The geometry must have either an index or a position attribute");r.addGroup(c,e,t),c+=e}}if(n){let t=!1;if(!r.index){let n=0;for(let t=0;t<e.length;++t)n+=e[t].index.count;r.setIndex(new i.BufferAttribute(new Uint32Array(n),1,!1)),t=!0}if(a||t){let t=r.index,i=0,n=0;for(let r=0;r<e.length;++r){let o=e[r],a=o.index;if(!0!==s[r])for(let e=0;e<a.count;++e)t.setX(i,a.getX(e)+n),i++;n+=o.attributes.position.count}}}for(let e in h){let t=h[e];if(!(e in r.attributes)){let i=0;for(let e in t)i+=t[e].count;r.setAttribute(e,m(h[e][0],i))}let i=r.attributes[e],n=0;for(let e=0,r=t.length;e<r;e++){let r=t[e];!0!==s[e]&&f(r,i,n),n+=r.count}}return r}function b(e,t){if(null===e||null===t)return e===t;if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}class v{constructor(e){this.matrixWorld=new i.Matrix4,this.geometryHash=null,this.boneMatrices=null,this.primitiveCount=-1,this.mesh=e,this.update()}update(){let e=this.mesh,t=e.geometry,i=e.skeleton,r=(t.index?t.index.count:t.attributes.position.count)/3;if(this.matrixWorld.copy(e.matrixWorld),this.geometryHash=t.attributes.position.version,this.primitiveCount=r,i){i.boneTexture||i.computeBoneTexture(),i.update();let e=i.boneMatrices;this.boneMatrices&&this.boneMatrices.length===e.length?this.boneMatrices.set(e):this.boneMatrices=e.slice()}else this.boneMatrices=null}didChange(){let e=this.mesh,t=e.geometry,i=(t.index?t.index.count:t.attributes.position.count)/3,r=this.matrixWorld.equals(e.matrixWorld)&&this.geometryHash===t.attributes.position.version&&b(e.skeleton&&e.skeleton.boneMatrices||null,this.boneMatrices)&&this.primitiveCount===i;return!r}}class M{constructor(e){Array.isArray(e)||(e=[e]);let t=[];e.forEach(e=>{e.traverseVisible(e=>{e.isMesh&&t.push(e)})}),this.meshes=t,this.useGroups=!0,this.applyWorldTransforms=!0,this.attributes=["position","normal","color","tangent","uv","uv2"],this._intermediateGeometry=Array(t.length).fill().map(()=>new i.BufferGeometry),this._diffMap=new WeakMap}getMaterials(){let e=[];return this.meshes.forEach(t=>{Array.isArray(t.material)?e.push(...t.material):e.push(t.material)}),e}generate(e=new i.BufferGeometry){let t=[],{meshes:r,useGroups:n,_intermediateGeometry:o,_diffMap:a}=this;for(let e=0,i=r.length;e<i;e++){let i=r[e],n=o[e],s=a.get(i);!s||s.didChange(i)?(this._convertToStaticGeometry(i,n),t.push(!1),s?s.update():a.set(i,new v(i))):t.push(!0)}for(let i in w(o,{useGroups:n,skipAttributes:t},e),e.attributes)e.attributes[i].needsUpdate=!0;return e}_convertToStaticGeometry(e,t=new i.BufferGeometry){let s=e.geometry,l=this.applyWorldTransforms,h=this.attributes.includes("normal"),c=this.attributes.includes("tangent"),d=s.attributes,u=t.attributes;t.index||(t.index=s.index),u.position||t.setAttribute("position",m(d.position)),h&&!u.normal&&d.normal&&t.setAttribute("normal",m(d.normal)),c&&!u.tangent&&d.tangent&&t.setAttribute("tangent",m(d.tangent)),p(s.index,t.index),p(d.position,u.position),h&&p(d.normal,u.normal),c&&p(d.tangent,u.tangent);let g=d.position,w=h?d.normal:null,b=c?d.tangent:null,v=s.morphAttributes.position,M=s.morphAttributes.normal,S=s.morphAttributes.tangent,P=s.morphTargetsRelative,T=e.morphTargetInfluences,_=new i.Matrix3;_.getNormalMatrix(e.matrixWorld);for(let t=0,i=d.position.count;t<i;t++)r.fromBufferAttribute(g,t),w&&n.fromBufferAttribute(w,t),b&&(a.fromBufferAttribute(b,t),o.fromBufferAttribute(b,t)),T&&(v&&x(v,T,P,t,r),M&&x(M,T,P,t,n),S&&x(S,T,P,t,o)),e.isSkinnedMesh&&(e.boneTransform(t,r),w&&y(e,t,n),b&&y(e,t,o)),l&&r.applyMatrix4(e.matrixWorld),u.position.setXYZ(t,r.x,r.y,r.z),w&&(l&&n.applyNormalMatrix(_),u.normal.setXYZ(t,n.x,n.y,n.z)),b&&(l&&o.transformDirection(e.matrixWorld),u.tangent.setXYZW(t,o.x,o.y,o.z,a.w));for(let e in this.attributes){let i=this.attributes[e];"position"!==i&&"tangent"!==i&&"normal"!==i&&i in d&&(u[i]||t.setAttribute(i,m(d[i])),p(d[i],u[i]),f(d[i],u[i]))}return t}}}),parcelRequire.register("bovSc",function(e,t){$parcel$export(e.exports,"mergeMeshes",()=>s);var i=parcelRequire("4xklQ"),r=parcelRequire("6bzcU");function n(e,t,r){let n;let o=e.index,a=e.attributes.position,s=a.count,l=o?o.count:s,h=e.groups;0===h.length&&(h=[{count:l,start:0,materialIndex:0}]),n=r.length<=255?new Uint8Array(s):new Uint16Array(s);for(let e=0;e<h.length;e++){let i=h[e],a=i.start,s=i.count,c=Math.min(s,l-a),d=Array.isArray(t)?t[i.materialIndex]:t,u=r.indexOf(d);for(let e=0;e<c;e++){let t=a+e;o&&(t=o.getX(t)),n[t]=u}}return new i.BufferAttribute(n,1,!1)}function o(e,t){if(t)for(let i in e.attributes)t.includes(i)||e.deleteAttribute(i)}function a(e,t){let{attributes:n=[],normalMapRequired:o=!1}=t;if(!e.attributes.normal&&n&&n.includes("normal")&&e.computeVertexNormals(),!e.attributes.uv&&n&&n.includes("uv")){let t=e.attributes.position.count;e.setAttribute("uv",new i.BufferAttribute(new Float32Array(2*t),2,!1))}if(!e.attributes.tangent&&n&&n.includes("tangent")){if(o)null===e.index&&(e=(0,r.mergeVertices)(e)),e.computeTangents();else{let t=e.attributes.position.count;e.setAttribute("tangent",new i.BufferAttribute(new Float32Array(4*t),4,!1))}}if(!e.attributes.color&&n&&n.includes("color")){let t=e.attributes.position.count,r=new Float32Array(4*t);r.fill(1),e.setAttribute("color",new i.BufferAttribute(r,4))}if(!e.index){let t=e.attributes.position.count,i=Array(t);for(let e=0;e<t;e++)i[e]=e;e.setIndex(i)}}function s(e,t={}){t={attributes:null,cloneGeometry:!0,...t};let i=[],s=new Set;for(let t=0,i=e.length;t<i;t++){let i=e[t];!1!==i.visible&&(Array.isArray(i.material)?i.material.forEach(e=>s.add(e)):s.add(i.material))}let l=Array.from(s);for(let r=0,s=e.length;r<s;r++){let s=e[r];if(!1===s.visible)continue;s.updateMatrixWorld();let h=e[r].geometry,c=t.cloneGeometry?h.clone():h;c.applyMatrix4(s.matrixWorld),a(c,{attributes:t.attributes,normalMapRequired:!!s.material.normalMap}),o(c,t.attributes);let d=n(c,s.material,l);c.setAttribute("materialIndex",d),i.push(c)}let h=new Set;l.forEach(e=>{for(let t in e){let i=e[t];i&&i.isTexture&&h.add(i)}});let c=(0,r.mergeBufferGeometries)(i,!1),d=Array.from(h);return{geometry:c,materials:l,textures:d}}}),parcelRequire.register("6bzcU",function(e,t){$parcel$export(e.exports,"mergeBufferGeometries",()=>r),$parcel$export(e.exports,"mergeVertices",()=>o);var i=parcelRequire("4xklQ");function r(e,t=!1){let r=null!==e[0].index,o=new Set(Object.keys(e[0].attributes)),a=new Set(Object.keys(e[0].morphAttributes)),s={},l={},h=e[0].morphTargetsRelative,c=new i.BufferGeometry,d=0;for(let i=0;i<e.length;++i){let n=e[i],u=0;if(r!==(null!==n.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+i+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let e in n.attributes){if(!o.has(e))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+i+'. All geometries must have compatible attributes; make sure "'+e+'" attribute exists among all geometries, or in none of them.'),null;void 0===s[e]&&(s[e]=[]),s[e].push(n.attributes[e]),u++}if(u!==o.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+i+". Make sure all geometries have the same number of attributes."),null;if(h!==n.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+i+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let e in n.morphAttributes){if(!a.has(e))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+i+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===l[e]&&(l[e]=[]),l[e].push(n.morphAttributes[e])}if(c.userData.mergedUserData=c.userData.mergedUserData||[],c.userData.mergedUserData.push(n.userData),t){let e;if(r)e=n.index.count;else{if(void 0===n.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+i+". The geometry must have either an index or a position attribute"),null;e=n.attributes.position.count}c.addGroup(d,e,i),d+=e}}if(r){let t=0,i=[];for(let r=0;r<e.length;++r){let n=e[r].index;for(let e=0;e<n.count;++e)i.push(n.getX(e)+t);t+=e[r].attributes.position.count}c.setIndex(i)}for(let e in s){let t=n(s[e]);if(!t)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+e+" attribute."),null;c.setAttribute(e,t)}for(let e in l){let t=l[e][0].length;if(0===t)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[e]=[];for(let i=0;i<t;++i){let t=[];for(let r=0;r<l[e].length;++r)t.push(l[e][r][i]);let r=n(t);if(!r)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+e+" morphAttribute."),null;c.morphAttributes[e].push(r)}}return c}function n(e){let t,r,n;let o=0;for(let i=0;i<e.length;++i){let a=e[i];if(a.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===t&&(t=a.array.constructor),t!==a.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===r&&(r=a.itemSize),r!==a.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===n&&(n=a.normalized),n!==a.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;o+=a.array.length}let a=new t(o),s=0;for(let t=0;t<e.length;++t)a.set(e[t].array,s),s+=e[t].array.length;return new i.BufferAttribute(a,r,n)}function o(e,t=1e-4){t=Math.max(t,Number.EPSILON);let r={},n=e.getIndex(),o=e.getAttribute("position"),a=n?n.count:o.count,s=0,l=Object.keys(e.attributes),h={},c={},d=[],u=["getX","getY","getZ","getW"];for(let t=0,i=l.length;t<i;t++){let i=l[t];h[i]=[];let r=e.morphAttributes[i];r&&(c[i]=Array(r.length).fill().map(()=>[]))}let p=Math.log10(1/t),m=Math.pow(10,p);for(let t=0;t<a;t++){let i=n?n.getX(t):t,o="";for(let t=0,r=l.length;t<r;t++){let r=l[t],n=e.getAttribute(r),a=n.itemSize;for(let e=0;e<a;e++)o+=`${~~(n[u[e]](i)*m)},`}if(o in r)d.push(r[o]);else{for(let t=0,r=l.length;t<r;t++){let r=l[t],n=e.getAttribute(r),o=e.morphAttributes[r],a=n.itemSize,s=h[r],d=c[r];for(let e=0;e<a;e++){let t=u[e];if(s.push(n[t](i)),o)for(let e=0,r=o.length;e<r;e++)d[e].push(o[e][t](i))}}r[o]=s,d.push(s),s++}}let f=e.clone();for(let t=0,r=l.length;t<r;t++){let r=l[t],n=e.getAttribute(r),o=new n.array.constructor(h[r]),a=new i.BufferAttribute(o,n.itemSize,n.normalized);if(f.setAttribute(r,a),r in c)for(let t=0;t<c[r].length;t++){let n=e.morphAttributes[r][t],o=new n.array.constructor(c[r][t]),a=new i.BufferAttribute(o,n.itemSize,n.normalized);f.morphAttributes[r][t]=a}}return f.setIndex(d),f}}),parcelRequire.register("gLAEi",function(e,t){$parcel$export(e.exports,"GenerateMeshBVHWorker",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("1DCdP");class n{constructor(){this.running=!1,this.worker=new Worker(parcelRequire("7rjBa")),this.worker.onerror=e=>{if(e.message)throw Error(`GenerateMeshBVHWorker: Could not create Web Worker with error "${e.message}"`);throw Error("GenerateMeshBVHWorker: Could not create Web Worker.")}}generate(e,t={}){if(this.running)throw Error("GenerateMeshBVHWorker: Already running job.");if(null===this.worker)throw Error("GenerateMeshBVHWorker: Worker has been disposed.");let{worker:n}=this;return this.running=!0,new Promise((o,a)=>{n.onerror=e=>{a(Error(`GenerateMeshBVHWorker: ${e.message}`)),this.running=!1},n.onmessage=s=>{this.running=!1;let{data:l}=s;if(l.error)a(Error(l.error)),n.onmessage=null;else if(l.serialized){let{serialized:a,position:s}=l,h=(0,r.MeshBVH).deserialize(a,e,{setIndex:!1}),c=Object.assign({setBoundingBox:!0},t);if(e.attributes.position.array=s,e.index)e.index.array=a.index;else{let t=new i.BufferAttribute(a.index,1,!1);e.setIndex(t)}c.setBoundingBox&&(e.boundingBox=h.getBoundingBox(new i.Box3)),o(h),n.onmessage=null}else t.onProgress&&t.onProgress(l.progress)};let s=e.index?e.index.array:null,l=e.attributes.position.array;if(l.isInterleavedBufferAttribute||s&&s.isInterleavedBufferAttribute)throw Error("GenerateMeshBVHWorker: InterleavedBufferAttribute are not supported for the geometry attributes.");let h=[l];s&&h.push(s),n.postMessage({index:s,position:l,options:{...t,onProgress:null,includedProgressCallback:!!t.onProgress,groups:[...e.groups]}},h.map(e=>e.buffer).filter(e=>"undefined"==typeof SharedArrayBuffer||!(e instanceof SharedArrayBuffer)))})}dispose(){this.worker.terminate(),this.worker=null}terminate(){console.warn('GenerateMeshBVHWorker: "terminate" is deprecated. Use "dispose" instead.'),this.dispose()}}}),parcelRequire.register("7rjBa",function(e,t){var i=parcelRequire("eZOna");let r=new URL(parcelRequire("dRo73").resolve("6lZac"),import.meta.url);e.exports=i(r.toString(),r.origin,!0)}),parcelRequire.register("eZOna",function(e,t){e.exports=function(e,t,i){if(t===self.location.origin)return e;var r=i?"import "+JSON.stringify(e)+";":"importScripts("+JSON.stringify(e)+");";return URL.createObjectURL(new Blob([r],{type:"application/javascript"}))}}),parcelRequire.register("cEaqU",function(e,t){$parcel$export(e.exports,"RenderCameraParam",()=>h);var i=parcelRequire("4xklQ"),r=parcelRequire("90poP"),n=parcelRequire("1cnge"),o=parcelRequire("9HO6e"),a=parcelRequire("hWloQ"),s=parcelRequire("3BPdS"),l=parcelRequire("jv0lw");class h{constructor(e){this.container=e,this.floorHei=2800,this.width=240,this.height=216,this.uiPanelBox=new s.UIPanel,this.uiPanelBox.setWidth(this.width+"px"),this.uiPanelBox.setHeight(this.height+"px"),this.container.appendChild(this.uiPanelBox.dom),this.camera=new i.OrthographicCamera(-1e4,1e4,5e3,-5e3,0,1e3);let t=this.width/this.height,r=-5e3;this.camera.left=r*t,this.camera.right=-r*t,this.camera.top=-r,this.camera.bottom=r,this.camera.position.set(0,0,1e3),this.camera.lookAt(new n.Vector3(0,0,0)),this.raycaster=new i.Raycaster,this.scene=new i.Scene,this.renderer="";let o=new i.PlaneGeometry(2e5,2e5),h=new i.MeshBasicMaterial({color:16777215,roughness:1,metalness:0,transparent:!0,opacity:0});this.floor=new i.Mesh(o,h),this.scene.add(this.floor),this.createRenderer();let c=(0,l.CameraMesh).createCamera();c.name="cameraGroup",c.position.x=4800,this.cameraGroup=c,editor.renderCameraGroup=c,this.scene.add(c);let d=new n.Vector3(0,4500,0),u=new n.Vector3(0,-4500,0),p=new(0,a.WallHelp)().createLineDimensionsLine(d,u,!0,100,"#fff");p.position.x=4800,this.scene.add(p),$("#cemeraHeight").val(Math.round(1e3*editor.renderViewCamera.position.y)+"mm");let m=editor.getRenderCameraAngle();isNaN(m)||$("#cemeraAngle").val(m+"\xb0");let f=new(0,s.UIText)("0mm",!1).setMarginTop(this.height-20+"px").setMarginLeft(this.width-60+"px").setFontSize("10px").setWidth("10px").setFontWeight("1"),g=new(0,s.UIText)(this.floorHei+"mm",!1).setMarginTop("5px").setMarginLeft(this.width-80+"px").setFontSize("10px").setWidth("10px").setFontWeight("1");this.uiPanelBox.add(f,g),this.camera.updateProjectionMatrix(),e.addEventListener("mousedown",this.onMouseDown.bind(this)),document.body.addEventListener("mouseup",this.onMouseUp.bind(this)),e.addEventListener("mousemove",this.mouseMove.bind(this))}onMouseDown(){let e=this.getObject(event);e.length>0&&(this.downSel=e[0].object.parent)}onMouseUp(){this.downSel=""}mouseMove(e){let t=this.getObject(e);if(t.length>0){let e=t[0].object.parent,o=this.cameraGroup[e.name+"_move"];if(o?o.visible=!0:this.cameraGroup.children.forEach(e=>{e.name.indexOf("_move")>=0&&(e.visible=!1)}),this.downSel){let e=t[0].point.clone();if("nosc"==this.downSel.name){e.y>4e3&&(e.y=4e3),e.y<-4e3&&(e.y=-4e3),this.cameraGroup.position.y=e.y;let t=Math.round(this.floorHei*(e.y+4e3)/8e3);editor.renderViewCamera.position.y=t/1e3,editor.renderViewControl.target.y=t/1e3;let i=Math.round(1e3*editor.renderViewCamera.position.y);$("#cemeraHeight").val()!=i+"mm"&&$("#cemeraHeight").val(i+"mm")}else if("nosr"==this.downSel.name){let t=this.cameraGroup.position.clone(),o=new r.Vector2(e.x,e.y),a=new r.Vector2(t.x,t.y),s=o.sub(a).angle();(s-=Math.PI)>Math.PI/2&&(s=Math.PI/2),s<-Math.PI/2&&(s=-Math.PI/2);var n=new i.Vector3;editor.renderViewCamera.getWorldDirection(n);let l=-editor.renderViewCamera.position.clone().distanceTo(n)*Math.sin(s);editor.renderViewControl.target.set(n.x,n.y+l,n.z);let h=editor.getRenderCameraAngle();!isNaN(h)&&($("#cemeraAngle").val(h+"\xb0"),h>=-5&&h<=5&&(editor.renderViewControl.target.y=editor.renderViewCamera.position.y))}editor.renderViewCamera.updateProjectionMatrix(),editor.renderViewControl.update()}}}createRenderer(){let e=new i.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});e.shadowMap.enabled=!0,e.shadowMap.type=i.PCFSoftShadowMap,e.setPixelRatio(window.devicePixelRatio),e.setSize(this.width,this.height),e.setClearColor("#2A2E34"),e.xr.enabled=!0,e.outputEncoding=i.sRGBEncoding,this.renderer=e,this.container.appendChild(this.renderer.domElement),this.animate()}animate(){this.renderer.setAnimationLoop(this.render.bind(this))}render(){if(this.renderer.render(this.scene,this.camera),!editor.renderViewCamera.isOrthographicCamera){let e=editor.renderViewControl.target.clone().sub(editor.renderViewCamera.position),t=(0,o.UtilCore).calculateAngleWithHorizontalPlane(e);isNaN(t)||(editor.renderViewCamera.position.y<editor.renderViewControl.target.y&&(t*=-1),t>=-5*Math.PI/180&&t<=5*Math.PI/180&&(t=0),this.cameraGroup.rotation.z=t,this.cameraGroup.position.y=8e6*editor.renderViewCamera.position.y/this.floorHei-4e3)}}getScreen(e,t){let i=e.project(t),r=window.innerWidth/2,n=(window.innerHeight-52)/2;return[Math.round(i.x*r+r),Math.round(-i.y*n+n)]}getObject(e){let t=new n.Vector3;this.domRect=this.container.getBoundingClientRect(),t.x=(e.clientX+17+this.width-window.innerWidth)/this.width*2-1,t.y=-(2*((e.clientY-120-this.height)/this.height))+1,t.z=0,this.raycaster.setFromCamera(t,this.camera);let i=[this.floor];return this.cameraGroup.children.forEach(e=>{"Group"==e.type&&e.visible&&i.push(e)}),this.raycaster.intersectObjects(i,!0)}}}),parcelRequire.register("jv0lw",function(e,t){$parcel$export(e.exports,"CameraMesh",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("2XHRA");parcelRequire("9QhXH"),parcelRequire("hWloQ");class n{static createCamera(e=!1){let t=new i.Group,r='<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 28 28" id="camera-hover" width="28" height="28"><g fill="#675D50" fill-rule="evenodd" stroke="#FFF"><path d="M17.5 7A2.5 2.5 0 0015 4.5H7A2.5 2.5 0 004.5 7v14A2.5 2.5 0 007 23.5h8a2.5 2.5 0 002.5-2.5V7zM23.5 7.717a.5.5 0 00-.741-.438l-4.482 2.468a1.5 1.5 0 00-.777 1.314v5.888a1.5 1.5 0 00.777 1.314l4.482 2.468a.5.5 0 00.741-.438V7.717z"></path></g></svg>';var{object:o,update:a}=n.renderSVG(r);o.scale.set(60,60,1);let s=new i.Box3().setFromObject(o).getSize(new i.Vector3);o.position.x=s.x/2,o.position.y+=s.y/2+250,o.rotateZ(Math.PI),o.renderOrder=5,t.add(o),o.name="nosc",t.nosc=o;let l='<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 28 28" id="camera-hover" width="28" height="28"><g fill="#338BFF" fill-rule="evenodd" stroke="#FFF"><path d="M17.5 7A2.5 2.5 0 0015 4.5H7A2.5 2.5 0 004.5 7v14A2.5 2.5 0 007 23.5h8a2.5 2.5 0 002.5-2.5V7zM23.5 7.717a.5.5 0 00-.741-.438l-4.482 2.468a1.5 1.5 0 00-.777 1.314v5.888a1.5 1.5 0 00.777 1.314l4.482 2.468a.5.5 0 00.741-.438V7.717z"></path></g></svg>';var{object:o,update:a}=n.renderSVG(l);o.scale.set(60,60,1),o.position.x=s.x/2,o.position.y+=s.y/2+250,o.rotateZ(Math.PI),t.add(o),o.name="nosc_move",t.nosc_move=o,o.visible=!1,o.renderOrder=5;let h=4e3,c=150/180*Math.PI;e&&(c=.75*Math.PI);let d=new i.Mesh(new i.CircleGeometry(h,32,c,(Math.PI-c)*2),new i.MeshBasicMaterial({color:"#305086",side:2,transparent:!0}));d.position.set(-s.x/2-200,0,0),t.add(d);let u=new i.Mesh(new i.CircleGeometry(h,32,c,(Math.PI-c)*2),new i.MeshBasicMaterial({color:"#15171A",side:2,transparent:!0,opacity:.8}));u.name="circle",u.position.set(-s.x/2-200,0,0),t.add(u),t.circleMesh=u,u.visible=!1,e&&(d.visible=!1,d.name="circle_move",t.circle_move=d,u.visible=!0,d.material.opacity=.8);let p='<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 60 132" id="rotate" width="100" height="150"><g fill="#1E2329" fill-opacity=".5" fill-rule="evenodd" stroke="#FFF" stroke-width="30" transform="rotate(90 28.5 28.5)"><path d="M129.384 26.898L103.5 45.11V8.872l25.884 18.026zM2.616 26.898L28.5 45.11V8.873L2.616 26.898z"></path><circle cx="66" cy="27" r="25.5"></circle></g></svg>';var{object:o,update:a}=n.renderSVG(p);o.scale.x=15,o.scale.y=15,o.position.x=-h-1600,o.position.y-=900,o.name="nosr",t.add(o),t.nosr=o;let m='<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 60 132" id="rotate" width="100" height="150"><g fill="#338BFF" fill-opacity=".5" fill-rule="evenodd" stroke="#FFF" stroke-width="30" transform="rotate(90 28.5 28.5)"><path d="M129.384 26.898L103.5 45.11V8.872l25.884 18.026zM2.616 26.898L28.5 45.11V8.873L2.616 26.898z"></path><circle cx="66" cy="27" r="25.5"></circle></g></svg>';var{object:o,update:a}=n.renderSVG(m);return o.scale.x=15,o.scale.y=15,o.position.x=-h-1600,o.position.y-=900,o.name="nosr_move",o.visible=!1,t.nosr_move=o,t.add(o),t}static renderSVG(e){let t=new r.SVGLoader,n=t.parse(e),o=new i.Group,a=[],s=new i.LineBasicMaterial({color:"#FFF",transparent:!0});return n.paths.forEach(e=>{let t=(0,r.SVGLoader).createShapes(e),n=new i.MeshBasicMaterial({color:e.color,transparent:!0,side:i.DoubleSide});t.forEach(e=>{let t=new i.ExtrudeBufferGeometry(e,{depth:1}),r=new i.EdgesGeometry(t),l=new i.Mesh(t,n),h=new i.LineSegments(r,s);h.renderOrder=100,a.push({shape:e,mesh:l,lines:h}),o.add(l,h)})}),o.applyMatrix4(new i.Matrix4().makeScale(50,50,1)),{object:o,update(e){a.forEach(t=>{let r=new i.ExtrudeBufferGeometry(t.shape,{depth:e,bevelEnabled:!1}),n=new i.EdgesGeometry(r);t.mesh.geometry.dispose(),t.lines.geometry.dispose(),t.mesh.geometry=r,t.lines.geometry=n})}}}}}),parcelRequire.register("aTa1F",function(e,t){$parcel$export(e.exports,"RenderViewPort",()=>n);var i=parcelRequire("4xklQ"),r=parcelRequire("iW9hg");class n{constructor(e){editor.list.hiddenDialog.dispatch(),this.container=e,this.width=window.innerWidth,this.height=window.innerHeight,this.camera=new i.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.01,8e4),this.camera.lookAt(new i.Vector3(0,0,0)),this.camera.layers.set(1),this.camera.layers.enable(2),editor.renderViewCamera=this.camera;let t=new i.OrthographicCamera(-100,100,50,-50,0,10),n=this.width/this.height,o=-50;t.left=o*n,t.right=-o*n,t.top=-o,t.bottom=o,t.position.set(0,0,10),t.lookAt(new i.Vector3(0,0,0)),editor.renderMiniMapCamera=t;let a="static/assets/images/",s=".png",l=[a+"px"+s,a+"nx"+s,a+"py"+s,a+"ny"+s,a+"pz"+s,a+"nz"+s],h=new i.CubeTextureLoader().load(l);this.scene=new i.Scene,editor.renderScene=this.scene,this.scene.background=h;let c=new i.PlaneGeometry(2e5,2e5),d=new i.MeshBasicMaterial({color:16777215,roughness:1,metalness:0,transparent:!0,opacity:0});this.floor=new i.Mesh(c,d),editor.renderFloor2d=this.floor,this.scene.add(this.floor),new i.AxesHelper(5e4).layers.set(2),this.createRenderer(),this.controls=new r.OrbitControls(this.camera,this.container),this.controls.target.set(0,0,0),editor.renderViewControl=this.controls;let u=new i.Group,p=new i.Group,m=new i.Group,f=new i.Group,g=new i.Group,y=new i.Group,x=new i.Group;editor.renderFloorGroup=g,editor.renderModel3dGroup=u,editor.renderWall3dGroup=f,editor.renderMember3dGroup=x;let w=new i.Group;editor.wallGroup3D.children.slice(0).forEach(e=>{if("3DWall"==e.modelType){let t=e.clone();t.modelType="3dWall",f.add(t)}if((e.type.indexOf("Door")>-1||e.type.indexOf("door")>-1)&&f.add(editor.codeModelCopy(e)),e.type.indexOf("Window")>-1||e.type.indexOf("window")>-1){let t=editor.codeModelCopy(e);t.name="window",f.add(t)}}),editor.scene.children.forEach(e=>{e.modelType&&w.add(e.clone())}),editor.floorGroup.children.forEach(e=>{g.add(e.clone())}),editor.floorGroup2d.children.forEach(e=>{y.add(e.clone())}),editor.memberGroup3D.children.forEach(e=>{x.add(e.clone())}),editor.model3D.children.forEach(e=>{u.add(e.clone())}),editor.model2D.children.forEach(e=>{p.add(e.clone())}),editor.wallGroup.children.forEach(e=>{m.add(e.clone())});let b=[f,g,x],v=new(0,i.Matrix4)().makeScale(.001,.001,.001);b.forEach(e=>{e.rotation.x=-Math.PI/2,e.applyMatrix4(v),this.scene.add(e)}),this.scene.add(u);let M=[y,p,m,w],S=new(0,i.Matrix4)().makeScale(.01,.01,.01);M.forEach(e=>{e.applyMatrix4(S),this.scene.add(e)});let P=new i.Box3().setFromObject(f).getCenter(new i.Vector3),T=new i.Box3().setFromObject(f).getSize(new i.Vector3);editor.renderSceneCenter=T.z,this.camera.position.x=P.x,this.camera.position.z=P.z+T.z,this.camera.position.y=P.y,this.controls.target.set(P.x,P.y,P.z),this.camera.updateProjectionMatrix(),this.controls.update();let _=new i.PointLight(10394523);_.position.set(0,700,0),_.layers.enableAll();let C=new i.AmbientLight(10394523);C.intensity=1,C.layers.enableAll(),C.position.set(0,700,0),this.scene.add(_),this.scene.add(C)}createRenderer(){let e=new i.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});e.shadowMap.enabled=!0,e.shadowMap.type=i.PCFSoftShadowMap,e.setPixelRatio(window.devicePixelRatio),e.setSize(window.innerWidth,window.innerHeight),e.xr.enabled=!0,e.outputEncoding=i.sRGBEncoding,this.renderer=e,editor.RenderRend=this.renderer,this.container.appendChild(this.renderer.domElement),this.animate()}animate(){this.renderer.setAnimationLoop(this.render.bind(this))}render(){this.renderer.render(this.scene,this.camera)}}}),parcelRequire.register("iW9hg",function(e,t){$parcel$export(e.exports,"OrbitControls",()=>s);var i=parcelRequire("4xklQ"),r=parcelRequire("9HO6e");let n={type:"change"},o={type:"start"},a={type:"end"};class s extends i.EventDispatcher{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new i.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:i.MOUSE.ROTATE,MIDDLE:i.MOUSE.DOLLY,RIGHT:i.MOUSE.PAN},this.touches={ONE:i.TOUCH.ROTATE,TWO:i.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return d.phi},this.getAzimuthalAngle=function(){return d.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",el),this._domElementKeyEvents=e},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(n),s.update(),h=l.NONE},this.update=function(){let t=new i.Vector3,r=new(0,i.Quaternion)().setFromUnitVectors(e.up,new i.Vector3(0,1,0)),o=r.clone().invert(),a=new i.Vector3,g=new i.Quaternion,y=2*Math.PI;return function(){let e=s.object.position;t.copy(e).sub(s.target),t.applyQuaternion(r),d.setFromVector3(t),s.autoRotate&&h===l.NONE&&A(C()),s.enableDamping?(d.theta+=u.theta*s.dampingFactor,d.phi+=u.phi*s.dampingFactor):(d.theta+=u.theta,d.phi+=u.phi);let i=s.minAzimuthAngle,x=s.maxAzimuthAngle;return isFinite(i)&&isFinite(x)&&(i<-Math.PI?i+=y:i>Math.PI&&(i-=y),x<-Math.PI?x+=y:x>Math.PI&&(x-=y),i<=x?d.theta=Math.max(i,Math.min(x,d.theta)):d.theta=d.theta>(i+x)/2?Math.max(i,d.theta):Math.min(x,d.theta)),d.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,d.phi)),d.makeSafe(),d.radius*=p,d.radius=Math.max(s.minDistance,Math.min(s.maxDistance,d.radius)),!0===s.enableDamping?s.target.addScaledVector(m,s.dampingFactor):s.target.add(m),t.setFromSpherical(d),t.applyQuaternion(o),e.copy(s.target).add(t),s.object.lookAt(s.target),!0===s.enableDamping?(u.theta*=1-s.dampingFactor,u.phi*=1-s.dampingFactor,m.multiplyScalar(1-s.dampingFactor)):(u.set(0,0,0),m.set(0,0,0)),p=1,!!(f||a.distanceToSquared(s.object.position)>c||8*(1-g.dot(s.object.quaternion))>c)&&(s.dispatchEvent(n),a.copy(s.object.position),g.copy(s.object.quaternion),f=!1,!0)}}(),this.dispose=function(){s.domElement.removeEventListener("contextmenu",ed),s.domElement.removeEventListener("pointerdown",et),s.domElement.removeEventListener("pointercancel",en),s.domElement.removeEventListener("wheel",es),s.domElement.removeEventListener("pointermove",ei),s.domElement.removeEventListener("pointerup",er),null!==s._domElementKeyEvents&&s._domElementKeyEvents.removeEventListener("keydown",el)};let s=this,l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},h=l.NONE,c=1e-6,d=new i.Spherical,u=new i.Spherical,p=1,m=new i.Vector3,f=!1,g=new i.Vector2,y=new i.Vector2,x=new i.Vector2,w=new i.Vector2,b=new i.Vector2,v=new i.Vector2,M=new i.Vector2,S=new i.Vector2,P=new i.Vector2,T=[],_={};function C(){return 2*Math.PI/60/60*s.autoRotateSpeed}function D(){return Math.pow(.95,s.zoomSpeed)}function A(e){u.theta-=e}function E(e){u.phi-=e}let L=function(){let e=new i.Vector3;return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),m.add(e)}}(),I=function(){let e=new i.Vector3;return function(t,i){!0===s.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(s.object.up,e)),e.multiplyScalar(t),m.add(e)}}(),R=function(){let e=new i.Vector3;return function(t,i){let r=s.domElement;if(s.object.isPerspectiveCamera){let n=s.object.position;e.copy(n).sub(s.target);let o=e.length();L(2*t*(o*=Math.tan(s.object.fov/2*Math.PI/180))/r.clientHeight,s.object.matrix),I(2*i*o/r.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(L(t*(s.object.right-s.object.left)/s.object.zoom/r.clientWidth,s.object.matrix),I(i*(s.object.top-s.object.bottom)/s.object.zoom/r.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function W(e){s.object.isPerspectiveCamera?p/=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*e)),s.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function V(e){s.object.isPerspectiveCamera?p*=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/e)),s.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function k(e){g.set(e.clientX,e.clientY)}function B(e){M.set(e.clientX,e.clientY)}function O(e){w.set(e.clientX,e.clientY)}function F(e){if(editor.list.horizontalLine.dispatch("#ff0000","red"),y.set(e.clientX,e.clientY),y.x==g.x&&y.y==g.y)return;x.subVectors(y,g).multiplyScalar(s.rotateSpeed),s.domElement;let t=!0,n=new i.Vector2(editor.renderViewCamera.position.x,editor.renderViewCamera.position.z),o=new i.Vector2(editor.renderViewControl.target.x,editor.renderViewControl.target.z),a=n.distanceTo(o);editor.renderViewCamera.oldDis&&(a=editor.renderViewCamera.oldDis);let l=1*Math.PI/180,h=a*Math.tan(l);y.y>g.y&&(h*=-1);let c=n.clone().add(o.clone().sub(n).setLength(a));if(y.x<g.x&&(l*=-1),c.rotateAround(n,l),Math.abs(g.x-y.x)>Math.abs(g.y-y.y))editor.renderViewControl.target.x=c.x,editor.renderViewControl.target.z=c.y;else{let e=editor.renderViewControl.target.clone().sub(editor.renderViewCamera.position),i=(0,r.UtilCore).calculateAngleWithHorizontalPlane(e);editor.renderViewCamera.position.y<editor.renderViewControl.target.y&&(i*=-1);let n=Math.round(180*i/Math.PI),o=4,s=n>=-4&&n<=o;editor.renderViewControl.target.y+=h;let l=editor.renderViewControl.target.clone().sub(editor.renderViewCamera.position),c=(0,r.UtilCore).calculateAngleWithHorizontalPlane(l);if(isNaN(c))return;editor.renderViewCamera.position.y<editor.renderViewControl.target.y&&(c*=-1);let d=Math.round(180*c/Math.PI),u=d>=-o&&d<=o,p=document.getElementById("white"),m=document.querySelector(".shot_box").clientHeight,f=p?p.offsetTop:m/2+7*d,x=5;h>0&&(x*=-1);let w=f+x;if(s){if(Math.abs(y.y-g.y)<o)editor.renderViewControl.target.y=editor.renderViewCamera.position.y,t=!1,w=m/2;else{let e=a*Math.tan(o*Math.PI/180);y.y>g.y&&(e*=-1),editor.renderViewControl.target.y+=e;let t=25;e>0&&(t*=-1),w+=t}}!s&&u&&(editor.renderViewControl.target.y=editor.renderViewCamera.position.y,w=m/2);let b="#fff";w==m/2&&(b="#00ff00"),w>=0&&w<=m&&editor.list.horizontalLine.dispatch(b,"white",w);let v=editor.getRenderCameraAngle();isNaN(v)||$("#cemeraAngle").val(v+"\xb0")}editor.renderViewCamera.lookAt(editor.renderViewControl.target),editor.renderViewCamera.updateProjectionMatrix(),editor.renderViewControl.update(),t&&g.copy(y)}function z(e){S.set(e.clientX,e.clientY),P.subVectors(S,M),P.y>0?W(D()):P.y<0&&V(D()),M.copy(S),s.update()}function U(e){b.set(e.clientX,e.clientY),v.subVectors(b,w).multiplyScalar(s.panSpeed),R(v.x,0),w.copy(b),s.update()}function N(e){e.deltaY<0?V(D()):e.deltaY>0&&W(D()),s.update()}function G(e){let t=!1;switch(e.code){case s.keys.UP:R(0,s.keyPanSpeed),t=!0;break;case s.keys.BOTTOM:R(0,-s.keyPanSpeed),t=!0;break;case s.keys.LEFT:R(s.keyPanSpeed,0),t=!0;break;case s.keys.RIGHT:R(-s.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),s.update())}function H(){if(1===T.length)g.set(T[0].pageX,T[0].pageY);else{let e=.5*(T[0].pageX+T[1].pageX),t=.5*(T[0].pageY+T[1].pageY);g.set(e,t)}}function j(){if(1===T.length)w.set(T[0].pageX,T[0].pageY);else{let e=.5*(T[0].pageX+T[1].pageX),t=.5*(T[0].pageY+T[1].pageY);w.set(e,t)}}function q(){let e=T[0].pageX-T[1].pageX,t=T[0].pageY-T[1].pageY,i=Math.sqrt(e*e+t*t);M.set(0,i)}function X(){s.enableZoom&&q(),s.enablePan&&j()}function Y(){s.enableZoom&&q(),s.enableRotate&&H()}function J(e){if(1==T.length)y.set(e.pageX,e.pageY);else{let t=ef(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);y.set(i,r)}x.subVectors(y,g).multiplyScalar(s.rotateSpeed);let t=s.domElement;A(2*Math.PI*x.x/t.clientHeight),E(2*Math.PI*x.y/t.clientHeight),g.copy(y)}function Z(e){if(1===T.length)b.set(e.pageX,e.pageY);else{let t=ef(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);b.set(i,r)}v.subVectors(b,w).multiplyScalar(s.panSpeed),R(v.x,v.y),w.copy(b)}function Q(e){let t=ef(e),i=e.pageX-t.x,r=e.pageY-t.y,n=Math.sqrt(i*i+r*r);S.set(0,n),P.set(0,Math.pow(S.y/M.y,s.zoomSpeed)),W(P.y),M.copy(S)}function K(e){s.enableZoom&&Q(e),s.enablePan&&Z(e)}function ee(e){s.enableZoom&&Q(e),s.enableRotate&&J(e)}function et(e){!1!==s.enabled&&(0===T.length&&(s.domElement.setPointerCapture(e.pointerId),s.domElement.addEventListener("pointermove",ei),s.domElement.addEventListener("pointerup",er)),eu(e),"touch"===e.pointerType?eh(e):eo(e))}function ei(e){!1!==s.enabled&&("touch"===e.pointerType?ec(e):ea(e))}function er(e){editor.renderViewCamera.oldDis="",ep(e),0===T.length&&(s.domElement.releasePointerCapture(e.pointerId),s.domElement.removeEventListener("pointermove",ei),s.domElement.removeEventListener("pointerup",er)),s.dispatchEvent(a),h=l.NONE,setTimeout(()=>{editor.list.deleteLine.dispatch()},500)}function en(e){ep(e)}function eo(e){let t;let r=new i.Vector2(editor.renderViewCamera.position.x,editor.renderViewCamera.position.z),n=new i.Vector2(editor.renderViewControl.target.x,editor.renderViewControl.target.z),a=r.distanceTo(n);switch(editor.renderViewCamera.oldDis=a,e.button){case 0:t=s.mouseButtons.LEFT;break;case 1:t=s.mouseButtons.MIDDLE;break;case 2:t=s.mouseButtons.RIGHT;break;default:t=-1}switch(t){case i.MOUSE.DOLLY:if(!1===s.enableZoom)return;B(e),h=l.DOLLY;break;case i.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===s.enablePan)return;O(e),h=l.PAN}else{if(!1===s.enableRotate)return;k(e),h=l.ROTATE}break;case i.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===s.enableRotate)return;k(e),h=l.ROTATE}else{if(!1===s.enablePan)return;O(e),h=l.PAN}break;default:h=l.NONE}h!==l.NONE&&s.dispatchEvent(o)}function ea(e){switch(h){case l.ROTATE:if(!1===s.enableRotate)return;F(e);break;case l.DOLLY:if(!1===s.enableZoom)return;z(e);break;case l.PAN:if(!1===s.enablePan)return;U(e)}}function es(e){!1!==s.enabled&&!1!==s.enableZoom&&h===l.NONE&&(e.preventDefault(),s.dispatchEvent(o),N(e),s.dispatchEvent(a))}function el(e){!1!==s.enabled&&!1!==s.enablePan&&G(e)}function eh(e){switch(em(e),T.length){case 1:switch(s.touches.ONE){case i.TOUCH.ROTATE:if(!1===s.enableRotate)return;H(),h=l.TOUCH_ROTATE;break;case i.TOUCH.PAN:if(!1===s.enablePan)return;j(),h=l.TOUCH_PAN;break;default:h=l.NONE}break;case 2:switch(s.touches.TWO){case i.TOUCH.DOLLY_PAN:if(!1===s.enableZoom&&!1===s.enablePan)return;X(),h=l.TOUCH_DOLLY_PAN;break;case i.TOUCH.DOLLY_ROTATE:if(!1===s.enableZoom&&!1===s.enableRotate)return;Y(),h=l.TOUCH_DOLLY_ROTATE;break;default:h=l.NONE}break;default:h=l.NONE}h!==l.NONE&&s.dispatchEvent(o)}function ec(e){switch(em(e),h){case l.TOUCH_ROTATE:if(!1===s.enableRotate)return;J(e),s.update();break;case l.TOUCH_PAN:if(!1===s.enablePan)return;Z(e),s.update();break;case l.TOUCH_DOLLY_PAN:if(!1===s.enableZoom&&!1===s.enablePan)return;K(e),s.update();break;case l.TOUCH_DOLLY_ROTATE:if(!1===s.enableZoom&&!1===s.enableRotate)return;ee(e),s.update();break;default:h=l.NONE}}function ed(e){!1!==s.enabled&&e.preventDefault()}function eu(e){T.push(e)}function ep(e){delete _[e.pointerId];for(let t=0;t<T.length;t++)if(T[t].pointerId==e.pointerId){T.splice(t,1);return}}function em(e){let t=_[e.pointerId];void 0===t&&(t=new i.Vector2,_[e.pointerId]=t),t.set(e.pageX,e.pageY)}function ef(e){let t=e.pointerId===T[0].pointerId?T[1]:T[0];return _[t.pointerId]}s.domElement.addEventListener("contextmenu",ed),s.domElement.addEventListener("pointerdown",et),s.domElement.addEventListener("pointercancel",en),s.domElement.addEventListener("wheel",es,{passive:!1}),this.update()}}}),parcelRequire.register("eTMFK",function(e,t){$parcel$export(e.exports,"RenderMiniMap",()=>o);var i=parcelRequire("4xklQ"),r=parcelRequire("jv0lw"),n=parcelRequire("iW9hg");class o{constructor(e){if(this.container=e,this.width=272,this.height=183,this.scene=editor.renderScene,this.camera=editor.renderMiniMapCamera,this.renderer="",this.createRenderer(),this.raycaster=new i.Raycaster,this.controls=new n.OrbitControls(this.camera,this.container),this.controls.target.set(0,0,0),this.camera.isOrthographicCamera){this.controls.enableRotate=!1,this.controls.mouseButtons={LEFT:i.MOUSE.PAN,RIGHT:i.MOUSE.PAN,MIDDLE:i.MOUSE.PAN};let e=this.width/this.height,t=-50;this.camera.left=t*e,this.camera.right=-t*e,this.camera.top=-t,this.camera.bottom=t}else this.controls.enableRotate=!0,this.camera.aspect=this.width/this.height,this.controls.mouseButtons={LEFT:i.MOUSE.LEFT,RIGHT:i.MOUSE.PAN};this.camera.updateProjectionMatrix();let t=(0,r.CameraMesh).createCamera(!0);t.name="cameraGroup",t.position.z=10,t.rotation.z=this.camera.rotation.z-Math.PI/2,this.cameraGroup=t;let o=new(0,i.Matrix4)().makeScale(.01,.01,.01);this.cameraGroup.applyMatrix4(o),this.scene.add(t),e.addEventListener("mousedown",this.onMouseDown.bind(this)),e.addEventListener("mouseup",this.onMouseUp.bind(this)),e.addEventListener("mousemove",this.mouseMove.bind(this)),this.needUpdate=!0}onMouseDown(){let e=this.getObject(event);this.needUpdate=!1,e.length>0&&(this.downSel=e[0].object.parent,this.downPoint=e[0].point.clone(),this.oldPos=this.cameraGroup.position.clone(),"nosc"==this.downSel.name||"cameraGroup"==this.downSel.name||"nosr"==this.downSel.name?this.camera.isOrthographicCamera?this.controls.enablePan=!1:(this.controls.enablePan=!1,this.controls.enableRotate=!1):this.camera.isOrthographicCamera?this.controls.enablePan=!0:(this.controls.enablePan=!0,this.controls.enableRotate=!0))}onMouseUp(){this.downSel="",this.downPoint="",this.oldPos="",this.needUpdate=!0}mouseMove(e){let t=this.getObject(e);if(t.length>0){let e=t[0].object.parent,r=this.cameraGroup[e.name+"_move"];if(t[0].object.name.indexOf("circle")>=0&&(r=this.cameraGroup.circle_move),r?r.visible=!0:this.cameraGroup.children.forEach(e=>{e.name.indexOf("_move")>=0&&(e.visible=!1)}),this.downSel){let e=t[0].point.clone();if("nosc"==this.downSel.name||"cameraGroup"==this.downSel.name){let t=e.clone().sub(this.downPoint),i=this.oldPos.clone().add(t);this.cameraGroup.position.x=i.x,this.cameraGroup.position.y=i.y;let r=editor.renderViewCamera.position.clone();editor.renderViewCamera.position.x=this.cameraGroup.position.x/10,editor.renderViewCamera.position.z=-this.cameraGroup.position.y/10;let n=editor.renderViewCamera.position.clone().sub(r);editor.renderViewControl.target.add(n)}else if("nosr"==this.downSel.name){let t=this.cameraGroup.position.clone(),r=new i.Vector2(e.x,e.y),n=new i.Vector2(t.x,t.y),o=r.sub(n).angle();o-=Math.PI,this.cameraGroup.rotation.z=o;let a=editor.renderSceneCenter,s=-a*Math.cos(o),l=a*Math.sin(o);editor.renderViewControl.target.x=s,editor.renderViewControl.target.z=l}editor.renderViewCamera.updateProjectionMatrix(),editor.renderViewControl.update()}}}createRenderer(){let e=new i.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});e.shadowMap.enabled=!0,e.shadowMap.type=i.PCFSoftShadowMap,e.setPixelRatio(window.devicePixelRatio),e.setSize(this.width,this.height),e.setClearColor("#2A2E34"),e.xr.enabled=!0,e.outputEncoding=i.sRGBEncoding,this.renderer=e,this.container.appendChild(this.renderer.domElement),this.animate()}animate(){this.renderer.setAnimationLoop(this.render.bind(this))}render(){if(this.renderer.render(this.scene,this.camera),!editor.renderViewCamera.isOrthographicCamera&&this.needUpdate){this.cameraGroup.position.x=10*editor.renderViewCamera.position.x,this.cameraGroup.position.y=-(10*editor.renderViewCamera.position.z);let e=new i.Vector2(editor.renderViewCamera.position.x,editor.renderViewCamera.position.z),t=new i.Vector2(editor.renderViewControl.target.x,editor.renderViewControl.target.z).clone().sub(e).angle();t-=Math.PI,this.cameraGroup.rotation.z=-t}}getObject(e){let t=new i.Vector3;this.domRect=this.container.getBoundingClientRect(),t.x=(e.clientX+this.width-window.innerWidth)/this.width*2-1,t.y=-(2*((e.clientY+108-this.height)/this.height))+1,t.z=0,this.raycaster.setFromCamera(t,this.camera);let r=[editor.renderFloor2d];return this.cameraGroup.children.forEach(e=>{e.visible&&r.push(e)}),this.raycaster.intersectObjects(r,!0)}}}),parcelRequire.register("ajbOv",function(e,t){e.exports=import("./"+parcelRequire("dRo73").resolve("fF1VX")).then(()=>parcelRequire("iNXBD"))});